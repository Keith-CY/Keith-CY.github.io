<!DOCTYPE html>
<html  lang="en">
<head>
    <meta charset="utf-8">
<title>EzCook</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />







<link rel="icon" href="/images/logo.png">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css">


    
    
    
    <style>body>.footer,body>.navbar,body>.section{opacity:0}</style>
    

    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">
    

    
    

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">


    
    
    
    

<link rel="stylesheet" href="/css/back-to-top.css">


    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-136207372-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-136207372-1');
</script>


    
    
<link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>

    
    
    

    
    
    
        <script async="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    

    


<link rel="stylesheet" href="/css/style.css">
</head>
<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/logo.png" alt="EzCook" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item"
                href="/">Home</a>
                
                <a class="navbar-item"
                href="/archives">Archives</a>
                
                <a class="navbar-item"
                href="/categories">Categories</a>
                
                <a class="navbar-item"
                href="/tags">Tags</a>
                
                <a class="navbar-item"
                href="/about">About</a>
                
                <a class="navbar-item"
                href="/resume">Resume</a>
                
            </div>
            
            <div class="navbar-end">
                
                    
                    
                    <a class="navbar-item" target="_blank" title="GitHub" href="https://github.com/keith-CY">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                    
                    <a class="navbar-item" target="_blank" title="Gmail" href="mailto:keithwhisper@gmail.com">
                        
                        <i class="fas fa-envelope"></i>
                        
                    </a>
                    
                
                
                
                <a class="navbar-item search" title="Search" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-6-widescreen has-order-2 column-main">
    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-22T03:42:52.000Z">2017-08-22</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    20 minutes read (About 3006 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/22/Scaling-Node-js-App/">Scaling Node.js App</a>
            
        </h1>
        <div class="content">
            <h3 id="Strategies-of-Scalability"><a href="#Strategies-of-Scalability" class="headerlink" title="Strategies of Scalability"></a>Strategies of Scalability</h3><p>The workload is the most popular reason we scale our applications, but it’s not the only reason. We also scale our applications to increase their availability and tolerance to failure.</p>
<h4 id="Cloning"><a href="#Cloning" class="headerlink" title="Cloning"></a>Cloning</h4><p>The easiest thing to do to scale a big application is to clone it mulitple times and have each cloned instance handle part of the workload(with a load balancer). This does not cost a lot in term of development time and it’s highly effective. This strategy is the minimum you should do and Node.js has the built-in module, <code>cluster</code>, to make is easier for you to implement the cloning strategy on a single server.</p>
<h4 id="Decomposing"><a href="#Decomposing" class="headerlink" title="Decomposing"></a>Decomposing</h4><p>We can also scale an application by decomposiing it based on functionalities and services. This means having mulitple, different applications with different code bases and sometimes with their own dedicated databases and User Interfaces.</p>
<p>This strategy is commonly associated with the term <strong>Microservice</strong>, where micro indicates that those services should be small as possible, but in reality, the size of the service is not what’s important but rather the enforement of loose coupling and high cohesion between services.</p>
<h4 id="Splitting"><a href="#Splitting" class="headerlink" title="Splitting"></a>Splitting</h4><p>We can also split the application into multiple instances where each instance is responsible for only a part of the application’s data. This strategy is often named <strong>horizontal partitioning</strong>, or <strong>sharding</strong>, in database. Data partitioning requires a lookup step before each operation to determine which instance of the application to use.</p>
<p>Successfully scaling a big application should eventually implement all three strategies.</p>
<h3 id="The-Cluster-Module"><a href="#The-Cluster-Module" class="headerlink" title="The Cluster Module"></a>The Cluster Module</h3><p>The cluster module can be used to enable load balancing over an environement’s multiple CPU cores. It’s based on the child process module <code>fork</code> method and it basically allows us to fork the main application process as many times as we have CPU cores. It will then take over and load balance all requests to the main process across all forked processs.</p>
<p>The cluster module is Node’s helper for us to implement the cloning scalability strategy, but only on one machine. When you have a big machine with a lot resources or when it’s easier and cheaper to add more resources to one machine ratherthan adding new machine, the cluster module is a greate option for a really quick implementation of the cloning strategy.</p>
<p>Even small machines usually have multiple cores and even if you’re not worried about the load on your Node server, you should enable the cluster module anyway to increase your server availability and fault-tolerance.</p>
<p>It’s a simple step and when using a process manager like PM2, for example, it becomes as simple as just providing an argument to the launch command.</p>
<p>The structure of what the cluster module does is simple. We create a <em>master process</em> and that master process <em>forks</em> a number of <em>worker processes</em> and manage them. Each worker process represents an instance of the application that we want to scale. All incoming requests are handled by the master process, which is the one that decides which worker process should handle the incoming request.</p>
<p><img src="https://cdn-images-1.medium.com/max/1000/1*C7ICI8d7aAna_zTZvZ64MA.png" alt=""></p>
<p>The master process’s job is easy because it actually just uses a <em>round-robin</em> algorithm to pick a worker process. This is enabled by default on all platform except windows and it can be globally modified to let the load-balancing be handled by the operation system self.</p>
<p>The round-robin algorithm distributes the load evenly across all available processes on a rotational basis. The first request is forwarded to the first worker process, the second to the next worker process in the list, and so on. When the end of the list is reached, the algorithm starts again from the beginning.</p>
<h3 id="Load-Balancing-an-HTTP-Server"><a href="#Load-Balancing-an-HTTP-Server" class="headerlink" title="Load-Balancing an HTTP Server"></a>Load-Balancing an HTTP Server</h3><p>Let’s clone and load balance a simple HTTP server using the cluster module.</p>
<p>Here’s the simple Node’s hello-world example server slightly modified to simulate some CPU work before responding:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// server.js</span></div><div class="line"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>)</div><div class="line"><span class="hljs-keyword">const</span> pid = process.pid</div><div class="line"></div><div class="line">http.createServer(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</div><div class="line">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1e7</span>; i++) &#123;</div><div class="line">    <span class="hljs-comment">// simulate CPU work</span></div><div class="line">  &#125;</div><div class="line">  res.end(<span class="hljs-string">`Handled by process <span class="hljs-subst">$&#123;pid&#125;</span>`</span>)</div><div class="line">&#125;).listen(<span class="hljs-number">8080</span>, () =&gt; &#123;</div><div class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Started process <span class="hljs-subst">$&#123;pid&#125;</span>`</span>)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>Before we create a cluster to clone this server into multiple workers, let’s do a simple benchmark of how many requests this server can handle per second. We can use <strong>Apache benchmarking tool</strong> for that.</p>
<p>After running the simple <code>server.js</code> code above, run this <code>ab</code> command:</p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ab -c200 http://localhost:8080/</div></pre></td></tr></table></figure>
<p>This command will test-load the server with 200 concurrent connections for 10 seconds.</p>
<p><img src="https://cdn-images-1.medium.com/max/1000/1*w8VmzV81atlTzHn7pDXu1g.png" alt=""></p>
<p>The single node server was able to handle about 51 requests per seconds.</p>
<p>Now that we have a reference benchmark, we can scale the application with the cloning strategy using the cluster module.</p>
<p>On the same level as the <code>server.js</code> file above, we can create a new file(<code>cluster.js</code>) <strong>for the master process</strong> with this content:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// cluster.js</span></div><div class="line"><span class="hljs-keyword">const</span> cluster = <span class="hljs-built_in">require</span>(<span class="hljs-string">'cluster'</span>)</div><div class="line"><span class="hljs-keyword">const</span> os = <span class="hljs-built_in">require</span>(<span class="hljs-string">'os'</span>)</div><div class="line"></div><div class="line"><span class="hljs-keyword">if</span> (cluster.isMaster) &#123;</div><div class="line">  <span class="hljs-keyword">const</span> cpu = os.cpus().length</div><div class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Forking for <span class="hljs-subst">$&#123;cpu&#125;</span> CPUS`</span>)</div><div class="line">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; cpus; i++) &#123;</div><div class="line">    cluster.fork()</div><div class="line">  &#125;</div><div class="line">&#125; <span class="hljs-keyword">else</span> &#123;</div><div class="line">  <span class="hljs-built_in">require</span>(./server)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>In <code>cluster.js</code>, we first required both the <code>cluster</code> module and the <code>os</code> module, we use the <code>os</code> module to read the number of CPUS cores we can work with using <code>os.cpus()</code>.</p>
<p>The <code>cluster</code> module gives us the handy Boolean flag <code>isMaster</code> to determine if this <code>cluster.js</code> file is being loaded as a master process or not. The first time we execute this file, we will be executing the master process and that <code>isMaster</code> flag will be set to true. In this case, we can instruct the master process to fork our server as many times as we have CPU cores.</p>
<p>Now we just read the number of CPUs we have using the <code>os</code> module, then with a for loop over that number, we call the <code>cluster.fork</code> method. The for loop will simple create as many workers as the number of CPUs in the system to take advantage of all the available processing power.</p>
<p>When the <code>cluster.fork</code> line is executed from the master process, the current file, <code>cluster.js</code>, is run again, but this time in <em>worker mode</em> with the <code>isMaster</code> flag set to false.</p>
<p><em>There is actually another flag set to true in this case if you need to use it, which is the <code>isWorker</code></em> flag.</p>
<p>When the application runs as a worker, it can start doing the actual work. This is where we need to define our server logic, which, for this example, we can do by requiring the <code>server.js</code> file that we already have.</p>
<p>That’s basically it. That’s how easy it is to take advantage of all the processing power in a machine. To test the cluster, run the <code>cluster.js</code> file.</p>
<p><img src="https://cdn-images-1.medium.com/max/800/1*c0S-W4GYgCGB_maJ94ZLPw.png" alt=""></p>
<p>It’s important to understand that these are completely different Node.js processes. Each worker process here will have its own event loop and memory space.</p>
<p>When we now hit the web server multiple times, the requests will start to get handled by different worker processes with different process ids. The worker will not be exactly rotated in sequence because the cluster module performs some optimizations when picking the next worker, but the load will be somehow distributed among the different worker process.</p>
<p>We can use the same <code>ab</code> command above to load-test this cluster of processes:</p>
<p><img src="https://cdn-images-1.medium.com/max/1000/1*5_EogHG-Egf2uAMOj9PmCA.png" alt=""></p>
<p>Now the cluster can handle 181 requests per seconds.</p>
<h3 id="Broadcasting-Messages-to-All-Workers"><a href="#Broadcasting-Messages-to-All-Workers" class="headerlink" title="Broadcasting Messages to All Workers"></a>Broadcasting Messages to All Workers</h3><p>Communicating between the master process and the workers is simple because under the hood the cluster module is just using the <code>child_process.fork</code> API, which means we also have communication channels available between the master process and each workers.</p>
<p>Based on the <code>server.js</code>/<code>cluster.js</code> example above, we can access the list of worker objects using <code>cluster.workers</code>, which is an object that holds a reference to all workers and can be used to read information about these workers. Since we have communication channels between master process and all workers, to broadcast a message to all them we just need a simple loop over all the workers:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-built_in">Object</span>.values(cluster.workers).forEach(<span class="hljs-function"><span class="hljs-params">worker</span> =&gt;</span> &#123;</div><div class="line">  worker.send(<span class="hljs-string">`Hello Worker <span class="hljs-subst">$&#123;worker.pid&#125;</span>`</span>)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>We simple used <code>Object.values</code> to get an array of all workers from the <code>cluster.workers</code> object. Then for each worker we can use the <code>send</code> function to send over any value that we want.</p>
<p>In a worker file, <code>server.js</code> in our example, to read a message received from this master process, we can register a handler for the <code>message</code> event on the global <code>process</code> object:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">process.on(<span class="hljs-string">'message'</span>, (msg) =&gt; &#123;</div><div class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Message from master: <span class="hljs-subst">$&#123;msg&#125;</span>`</span>)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p><img src="https://cdn-images-1.medium.com/max/1000/1*6XfoWiNKTCiDjqar7L5_xw.png" alt=""></p>
<p>Every worker received a message from the master process. <em>Note how the workers did not start in order</em>.</p>
<p>Let’s make this communication example a little bit more practical. Let’s say we want our server to reply with the number of users we have created in our database. We will create a mock function that returns the number of users we have in the database and just have it square its value every time it’s called:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// **** Mock DB Call</span></div><div class="line"><span class="hljs-keyword">const</span> numberOfUsersInDB = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;</div><div class="line">  <span class="hljs-keyword">this</span>.count = <span class="hljs-keyword">this</span>.count || <span class="hljs-number">5</span></div><div class="line">  <span class="hljs-keyword">this</span>.count = <span class="hljs-keyword">this</span>.count * <span class="hljs-keyword">this</span>.count</div><div class="line">  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.count</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Every time <code>numberOfUsersInDB</code> is called, we’ll assume that a database connection has been made.</p>
<p>In the master process mode, we can use the same loop to broadcast the users count value to all workers:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// Right After the fork loop within the isMaster=true block</span></div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> updateWorkers = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</div><div class="line">  <span class="hljs-keyword">const</span> usersCount = numberOfUsersInDB()</div><div class="line">  <span class="hljs-built_in">Object</span>.values(cluster.workers).forEach(<span class="hljs-function"><span class="hljs-params">worker</span> =&gt;</span> &#123;</div><div class="line">    worker.send(&#123;</div><div class="line">      usersCount,</div><div class="line">    &#125;)</div><div class="line">  &#125;)</div><div class="line">&#125;</div><div class="line"></div><div class="line">updateWorkers()</div><div class="line">setInterval(updateWorkers, <span class="hljs-number">10000</span>)</div></pre></td></tr></table></figure>
<p>Here we’re invoking <code>updateWorkers</code> for the first time and then invoking it every 10 seconds using a <code>setInterval</code>. This way, every 10 seconds, all workers will receive the new user count value over the process communication channel and only one database connection will be made.</p>
<p>In the server code, we can use the <code>userCount</code> value using the same <code>message</code> event handler. We can simply cache that value with a module global variable and use it anywhere we want.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>)</div><div class="line"><span class="hljs-keyword">const</span> pid = process.pid</div><div class="line"></div><div class="line"><span class="hljs-keyword">let</span> usersCount</div><div class="line"></div><div class="line">http.createServer(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</div><div class="line">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1e7</span>; i++);</div><div class="line">  res.write(<span class="hljs-string">`Handled by process: <span class="hljs-subst">$&#123;pid&#125;</span>`</span>)</div><div class="line">  res.end(<span class="hljs-string">`Users: &#123;usersCount&#125;`</span>)</div><div class="line">&#125;).listen(<span class="hljs-number">8080</span>, () =&gt; &#123;</div><div class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Start process <span class="hljs-subst">$&#123;pid&#125;</span>`</span>)</div><div class="line">&#125;)</div><div class="line"></div><div class="line">process.on(<span class="hljs-string">'message'</span>, msg =&gt; &#123;</div><div class="line">  usersCount = msg.usersCount</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>The above code makes the worker web server respond with the cached <code>usersCount</code> value. If you test the cluster code now, during the first 10 seconds you’ll get ‘25’ as the users count from all workers(and only one DB request would be made). Then after another 10 seconds, all workers would start reporting the new user count: 625(and only one DB request would be made).</p>
<p>This is all possible thanks to the communication channels between the master process and all workers.</p>
<h3 id="Increasing-Server-Availability"><a href="#Increasing-Server-Availability" class="headerlink" title="Increasing Server Availability"></a>Increasing Server Availability</h3><p>One of the problems in running a single instance of a Node application is that when that instance crashes, it has to be restarted. This means some downtime between these two actions, even if the process was automated as it should.</p>
<p>This also applies to the case when the server has to be restarted to deploy new code. With one instance, there will be downtime which affects the availability of the system.</p>
<p>When we have multiple instances, the availability of the system can be easily increased with just a few extra lines of code.</p>
<p>To simulate a random crash in the server process, we can simply do a <code>process.exit</code> call inside a timer that fires after a random amount of time:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// In server.js</span></div><div class="line">setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</div><div class="line">  process.exit(<span class="hljs-number">1</span>) <span class="hljs-comment">// death by random timeout</span></div><div class="line">&#125;, <span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">10000</span>)</div></pre></td></tr></table></figure>
<p>When a worker process exits like this, the master process will be notified using the <code>exit</code> event on the <code>cluster</code> model object. We can register a handler for that event and just fork a new worker process when any worker process exits.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// Right after the fork loop within the isMaster=true block</span></div><div class="line"></div><div class="line">cluster.on(<span class="hljs-string">'exit'</span>, (worker, code, signal) =&gt; &#123;</div><div class="line">  <span class="hljs-keyword">if</span> (code !== <span class="hljs-number">0</span> &amp;&amp; !worker.exitedAfterDisconnect) &#123;</div><div class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Worker <span class="hljs-subst">$&#123;worker.id&#125;</span> crashed. Starting a new worker...`</span>)</div><div class="line">    cluster.fork()</div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>It’s good to add the if condition above to make sure the worker process actually crashed and was not manually disconnected or killed by the master process itself.</p>
<p>If the main process is going to kill the worker, it can use the <code>disconnect</code> methods on the worker and in that case, the <code>exitedAfterDisconnect</code> flag will be set to true. The if statement above will guard to not fork a new worker for that case.</p>
<p>If we run the cluster with the handler above(and the random crash in server.js), after a random number of seconds, workers will start to crash and the master process will immediately fork new workers to increase the availability of the system.</p>
<p>You can actually measure the availability using the same <code>ab</code> command and see how many requests the server will not be able to handle overall.</p>
<p><img src="https://cdn-images-1.medium.com/max/1000/1*B72o6QhsyiNnEQU5Wx20RQ.png" alt=""></p>
<h3 id="Zero-downtime-Restarts"><a href="#Zero-downtime-Restarts" class="headerlink" title="Zero-downtime Restarts"></a>Zero-downtime Restarts</h3><p>We have multiple instances running, so instead of restarting them together, we can simply restart them one at a time to allow other workers to continue to serve requests while one worker is being restarted.</p>
<p>Implementing this with the cluster module is easy. Since we don’t want to restart the master process once it’s up, we need a way to send this master process a command to instruct it to start restarting its workers. This is easy on Linux system because we can simply listen to a process signal like <code>SIGUSR2</code>, which we can trigger by using the <code>kill</code> command on the process id and passing that signal:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// In Node</span></div><div class="line">process.on(<span class="hljs-string">'SIGUSR2'</span>, () =&gt; &#123; ... &#125;)</div><div class="line"><span class="hljs-comment">// To trigger that</span></div><div class="line">$ kill -SIGUSR2 PID</div></pre></td></tr></table></figure>
<p>This way, the master process will not be killed and we have a way to instruct it to start doing something.</p>
<p><strong><code>SIGUSR2</code> is a proper signal to use here because this will be a user command. If you’re wondering why not <code>SIGUSR1</code>, it’s because Node uses that for its debugger and you want to avoid any conflicts.</strong>.</p>
<p>When the master process receives the <code>SIGUSR2</code> signal, that means it’s time for it to restart its workers, but we want to do that one worker at a time. This simply means the master process should only restart the next worker when it’s done restarting the current one.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">restartWorker</span> = (<span class="hljs-params">workerIndex</span>) =&gt; </span>&#123;</div><div class="line">  <span class="hljs-keyword">const</span> worker = workers[workerIndex]</div><div class="line">  <span class="hljs-keyword">if</span> (!worker) <span class="hljs-keyword">return</span></div><div class="line"></div><div class="line">  worker.on(<span class="hljs-string">'exit'</span>, () =&gt; &#123;</div><div class="line">    <span class="hljs-keyword">if</span> (!worker.exitedAfterDisconnect) <span class="hljs-keyword">return</span></div><div class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Exited process <span class="hljs-subst">$&#123;worker.process.pid&#125;</span>`</span>)</div><div class="line"></div><div class="line">    cluster.fork().on(<span class="hljs-string">'listening'</span>, () =&gt; &#123;</div><div class="line">      restartWorker(workerIndex + <span class="hljs-number">1</span>)</div><div class="line">    &#125;)</div><div class="line">  &#125;)</div><div class="line">  worker.disconnect()</div><div class="line">&#125;</div><div class="line"></div><div class="line">restartWorker(<span class="hljs-number">0</span>)</div></pre></td></tr></table></figure>
<p>Inside the <code>restartWorker</code> function, we got a reference to the worker to be restarted and since we will be calling this function recursively to form a sequence, we need a stop condition. When we no longer have a worker to restart, we can just return.</p>
<p>We then basically want to disconnect this worker (using <code>worker.disconnect</code>), but before restarting the next worker, we need to fork a new worker to replace this current one that we’re disconnecting.</p>
<p>We can use the <code>exit</code> event on the worker itself to fork a new worker when the current one exists, but we have to make sure that the exit action was actually triggered after a normal disconnect call. We can use the <code>exitedAfterDisconnect</code> flag. If this flag is not true, the exit was caused by something else other than our disconnect call and in that case, we should just return and do nothing. But if the flag is set to true, we can go ahead and fork a new worker to replace the one that we’re disconnecting.</p>
<p>When this new forked worker is ready, we can restart the next one.</p>
<p>However, remember that the fork process is not synchronous, so we can’t just restart the next worker after the fork call. Instead, we can monitor the <code>listening</code> event on the newly forked worker, which tells us that this worker is connected and ready. When we get this event, we can safely restart the next worker in sequence.</p>
<p>That’s all we need for a zero-downtime restart.</p>
<p>Process monitors like PM2, make all the tasks we went through so far extremely easy and give a log more features to monitor the health of a Node’s application.</p>
<h3 id="Shared-State-and-Sticky-Load-Balancing"><a href="#Shared-State-and-Sticky-Load-Balancing" class="headerlink" title="Shared State and Sticky Load Balancing"></a>Shared State and Sticky Load Balancing</h3><p>When we load balance a Node application, we lost some features that are only suitable for a single process. This problem is somehow similar to what’s known in other languages as thread safety, which is about sharing data between threads. In our case, it’s sharing data between worker processes.</p>
<p>For example, with a cluster setup, we can no longer cache things in memory because every worker process will have its own memory space, If we cache something in one worker’s memory, other workers will not have access to it.</p>
<p>If we need to cache things with a cluster setup, we have to use a separate entity and read/write to that entity’s API from all workers. This entity can be a database server or if you want to use in-memory cache you can use a server like Redis or create a dedicated Node process with a read/write API for all other workers to communicate with.</p>
<p><img src="https://cdn-images-1.medium.com/max/1000/1*dIR_CAkmtPFgtaGTOKBFkA.png" alt=""></p>
<p>Don’t look at this as a disadvantage, because using a separate entity for your application caching is part of <em>decomposing</em> your app for scalability. You should probably be doing that even if you’re running on a single core machine.</p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-21T16:11:11.000Z">2017-08-22</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    a minute read (About 139 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/22/Mock-Data-for-Node-js/">Mock Data for Node.js</a>
            
        </h1>
        <div class="content">
            <h3 id="Faker-js"><a href="#Faker-js" class="headerlink" title="Faker.js"></a>Faker.js</h3><p>It’s a wonderful node module to create fake/mock data.</p>
<p>Faker.js has its own API, and it’s huge.</p>
<p>It has a vast API for almost every use case with an excellent <a href="https://github.com/marak/Faker.js/" target="_blank" rel="noopener">documentation</a></p>
<p>Let’s consider a test case where I want some a <em>user</em> to have following amount of fields:</p>
<ul>
<li><p>name</p>
</li>
<li><p>email</p>
</li>
<li><p>website</p>
</li>
<li><p>address</p>
</li>
<li><p>bio</p>
</li>
<li><p>image/avatar</p>
</li>
</ul>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">const</span> faker = <span class="hljs-built_in">require</span>(<span class="hljs-string">'faker'</span>)</div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> User = &#123;</div><div class="line">  <span class="hljs-attr">name</span>: faker.name.findName(),</div><div class="line">  <span class="hljs-attr">email</span>: faker.internet.email(),</div><div class="line">  <span class="hljs-attr">website</span>: faker.internet.url(),</div><div class="line">  <span class="hljs-attr">address</span>: faker.address.streetAddress() + faker.address.city() + faker.address.country(),</div><div class="line">  <span class="hljs-attr">bio</span>: faker.lorem.sentences(),</div><div class="line">  <span class="hljs-attr">image</span>: faker.image.avatar(),</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Faker-js-Data"><a href="#Faker-js-Data" class="headerlink" title="Faker.js Data"></a>Faker.js Data</h3><p>List of data that can generate faker.js:</p>
<ul>
<li><p>address</p>
</li>
<li><p>commerce</p>
</li>
<li><p>company</p>
</li>
<li><p>date</p>
</li>
<li><p>finance</p>
</li>
<li><p>hacker</p>
</li>
<li><p>helpers</p>
</li>
<li><p>image</p>
</li>
<li><p>internet</p>
</li>
<li><p>lorem</p>
</li>
<li><p>name</p>
</li>
<li><p>phone</p>
</li>
<li><p>random</p>
</li>
<li><p>system</p>
</li>
</ul>
<h3 id="Use-in-Browser"><a href="#Use-in-Browser" class="headerlink" title="Use in Browser"></a>Use in Browser</h3><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;script src=<span class="hljs-string">'faker.js'</span>&gt;<span class="hljs-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span></div><div class="line">&lt;script&gt;</div><div class="line">  <span class="hljs-keyword">var</span> randomName = faker.name.findName()</div><div class="line">&lt;<span class="hljs-regexp">/script&gt;</span></div></pre></td></tr></table></figure>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-20T13:54:19.000Z">2017-08-20</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    6 minutes read (About 910 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/20/Analyzing-Runtime-Performacne-with-Chrome-DevTools/">Analyzing Runtime Performacne With Chrome DevTools</a>
            
        </h1>
        <div class="content">
            <h3 id="Get-Started"><a href="#Get-Started" class="headerlink" title="Get Started"></a>Get Started</h3><ul>
<li><p>Open Chrome in Incognito Mode. Incognito Mode ensures that Chrome runs in a clean state. For example, if you have a lot of extensions installed, those extensions might create noise in you performance meaturements.</p>
</li>
<li><p>Load the following page in your Incognito window. This is the demo that you’re going to profile. The page shows a bunch of little blue squares moving up and down.</p>
</li>
</ul>
<p><code>https://googlechrome.github.io/devtools-samples/jank/</code></p>
<ul>
<li>Press <code>Command + Option + I</code> in Mac to open DevTools.</li>
</ul>
<h3 id="Simulate-a-Mobile-CPU"><a href="#Simulate-a-Mobile-CPU" class="headerlink" title="Simulate a Mobile CPU"></a>Simulate a Mobile CPU</h3><p>Mobile devices have much less CPU power than desktops and laptops. Whenevery you profile a page, use <strong>CPU Throttling</strong> to simulate how your page performs on mobile devices.</p>
<ul>
<li><p>In DevTools, click the <strong>Performacne</strong> tab.</p>
</li>
<li><p>Make sure that the <strong>Screenshots</strong> checkbox is enabled.</p>
</li>
<li><p>Click <strong>Capture Setting</strong>(the gear icon). DevTools reveals settings related to how it captures performances metrics.</p>
</li>
<li><p>For <strong>CPU</strong>, select <strong>2x slowdown</strong>. DevTools throttle your CPU so that it’s 2 times slower than usual.</p>
</li>
</ul>
<p><img src="https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/imgs/throttling.svg" alt=""></p>
<h3 id="Set-up-the-demo"><a href="#Set-up-the-demo" class="headerlink" title="Set up the demo"></a>Set up the demo</h3><ul>
<li><p>Keep clicking <strong>Add 10</strong> until the blue squares move noticeably slower than before.</p>
</li>
<li><p>Click <strong>Optimize</strong>, the blue squares should move faster and more smoothly.</p>
</li>
<li><p>Click <strong>Un-Optimize</strong>. The blue squares move slower and with more jank again.</p>
</li>
</ul>
<h3 id="Record-runtime-performance"><a href="#Record-runtime-performance" class="headerlink" title="Record runtime performance."></a>Record runtime performance.</h3><p>When you ran the optimized version of the page, the blue squares move faster. Why is that? Both version are supposed to move each square the same amount of spaces in the same amount of time. Take a recording in the Performance panel to learn how to detect the performance bottlenect in the un-optimized version.</p>
<ul>
<li>In DevTools, click <strong>Record</strong> DevTools captures performance metrics as the page run.</li>
</ul>
<p><img src="https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/imgs/profiling.png" alt="Profiling the Page"></p>
<ul>
<li><p>Wait a few seconds</p>
</li>
<li><p>Click <strong>Stop</strong>, DevTools stops recording, processes the data, then displays the results on the Performance panel.</p>
</li>
</ul>
<p><img src="https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/imgs/results.png" alt=""></p>
<h3 id="Analyze-the-results"><a href="#Analyze-the-results" class="headerlink" title="Analyze the results"></a>Analyze the results</h3><p>The main metrics for measuring the performance of any animation is frames per second (FPS). Users are happy when animations runs at 60 FPS.</p>
<ul>
<li>Look at the <strong>FPS</strong> Chart</li>
</ul>
<p><img src="https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/imgs/fps-chart.svg" alt=""></p>
<p>Whenever you see a red bar above <strong>FPS</strong>, it means that the framerate dropped so low that it’s propably harming the user experience. In general, the highter the green bar, the higher the FPS.</p>
<ul>
<li>Below the <strong>FPS</strong> chart you see the CPU chart.</li>
</ul>
<p><img src="https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/imgs/cpu-summary.svg" alt=""></p>
<p>The colors in the CPU chart corresponds to the colors in the Summary tab, at the bottom of the Performance panel. The fact that the CPU chart is full of color means that the CPU was maxed out during the recording.</p>
<ul>
<li><p>Hover your mouse over the <strong>FPS</strong>, <strong>CPU</strong>, or <strong>NET</strong> charts. DevTools shows a screenshot of the page at that point in time. Move your mouse left and right to replay the recoding. This is called srubbing, and it’s useful for manually analyzing the progression of animations.</p>
</li>
<li><p>In <strong>Frames</strong> section, hover your mouse over one of the green squares, DevTools shows you the FPS for that particular frame.</p>
</li>
</ul>
<p>Of course, with this demo, it’s pretty obvious that the page is not performing well. But in real scenarios, it may not be so clear, so having all of these tools to make measurements comes in handy.</p>
<h3 id="Find-Bottleneck"><a href="#Find-Bottleneck" class="headerlink" title="Find Bottleneck"></a>Find Bottleneck</h3><ul>
<li>Note the summary tab. When no events are selected, this tab shows you a breakdown of activity. The page spent most of its time rendering. Since performance is the art of doing less work, your goal is to reduce the amount of time spent doing rendering work.</li>
</ul>
<p><img src="https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/imgs/summary.svg" alt=""></p>
<ul>
<li>Expand the <strong>Main</strong> section. DevTools shows you a flame chart of activity on the main thread, over time. The x-axis represents the recoding, over time. Each bar represents an event. A wider bar means that event took longer. The y-axis represents the call stack. When you see events stacked on top of each other, it means the upper events caused the lower events.</li>
</ul>
<p><img src="https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/imgs/main.svg" alt=""></p>
<ul>
<li>There’s a lot of data in the recording. Zoom in on a single <strong>Animation Frame Field</strong> event by clicking, holding, and dragging your mouse over the <strong>Overview</strong>, which is the section that includes <strong>CPU</strong>, <strong>FPS</strong>, and <strong>NET</strong> charts. The <strong>Main</strong> section and <strong>Summary</strong> tab only display information for the selected portion of the recording.</li>
</ul>
<p><img src="https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/imgs/zoomed.png" alt=""></p>
<ul>
<li><p>Note the red triangle in the top-right of the <strong>Animation Frame Fired</strong> event. Whenever you see a red triangle, it’s a warning that there may be an issue related to this event.</p>
</li>
<li><p>Click the <strong>Animation Frame Fired</strong> event. The <strong>Summary</strong> tab now shows you information about that event. Note that <strong>reveal</strong> link. Click that causes DevTools to highlight the event that initiate the <strong>Animation Frame Fired</strong> event.</p>
</li>
<li><p>Under the <strong>app.update</strong> event, there’s a bunch of purple events. If they were wider, it looks as though each one might have a red triangle on it. Click one of the purple <strong>Layout</strong> events now. DevTools provides more information about the event in the <strong>Summary</strong> tab.</p>
</li>
</ul>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-18T09:49:07.000Z">2017-08-18</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    11 minutes read (About 1706 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/18/Requiring-Modules-in-Node-js/">Requiring Modules in Node.js</a>
            
        </h1>
        <div class="content">
            <figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">const</span> config = <span class="hljs-built_in">require</span>(<span class="hljs-string">'/path/to/file'</span>)</div></pre></td></tr></table></figure>
<p>The main object exported by the <code>require</code> module is a function. When Node invokes that <code>require()</code> function with a local file path as the function’s only argument, Node goes through the following sequence of steps:</p>
<ul>
<li><p><strong>Resolving</strong>: To find the absolute path of the file.</p>
</li>
<li><p><strong>Loading</strong>: To determine the type of the file content.</p>
</li>
<li><p><strong>Wrapping</strong>: To give the file its private scope. This is what makes both the <code>require</code> and <code>module</code> objects local to every file we require.</p>
</li>
<li><p><strong>Evaluating</strong>: This is what the VM eventually does with the loaded code.</p>
</li>
<li><p><strong>Caching</strong>: So that when we require this file again, we don’t go over all the steps another time.</p>
</li>
</ul>
<h4 id="Resolving-a-local-path"><a href="#Resolving-a-local-path" class="headerlink" title="Resolving a local path"></a>Resolving a local path</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// in NODE REPL</span></div><div class="line">&gt; <span class="hljs-built_in">module</span></div><div class="line">Module: &#123;</div><div class="line">  <span class="hljs-attr">id</span>: <span class="hljs-string">'&lt;repl&gt;'</span>,</div><div class="line">  <span class="hljs-attr">exports</span>: &#123;&#125;,</div><div class="line">  <span class="hljs-attr">parent</span>: <span class="hljs-literal">undefined</span>,</div><div class="line">  <span class="hljs-attr">fielname</span>: <span class="hljs-literal">null</span>,</div><div class="line">  <span class="hljs-attr">loaded</span>: <span class="hljs-literal">false</span>,</div><div class="line">  <span class="hljs-attr">children</span>: [],</div><div class="line">  <span class="hljs-attr">paths</span>: [...]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Every module object gets an <code>id</code> property to identify it. This <code>id</code> is usually the full path to the file, but in a REPL session it’s simply <code>&lt;repl&gt;</code>.</p>
<p>Node modules have a one-to-one relation with files on the file-system. We require a module by loading the content of a file into memory.</p>
<p>However, since Node allows many ways to require a file(for example, with a relative path or a pre-configured path), before we can load the content of a file into the memory we need to find the absolute location of that file.</p>
<p>When we require a <code>find-me</code> module, without specifying a path:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-built_in">require</span>(<span class="hljs-string">'find-me'</span>)</div></pre></td></tr></table></figure>
<p>Node will look for <code>find-me.js</code> in all the paths specified by <code>module.paths</code> in order.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// in NODE REPL</span></div><div class="line">&gt; <span class="hljs-built_in">module</span>.paths</div><div class="line">[ <span class="hljs-string">'/Users/samer/learn-node/repl/node_modules'</span>,</div><div class="line">  <span class="hljs-string">'/Users/samer/learn-node/node_modules'</span>,</div><div class="line">  <span class="hljs-string">'/Users/samer/node_modules'</span>,</div><div class="line">  <span class="hljs-string">'/Users/node_modules'</span>,</div><div class="line">  <span class="hljs-string">'/node_modules'</span>,</div><div class="line">  <span class="hljs-string">'/Users/samer/.node_modules'</span>,</div><div class="line">  <span class="hljs-string">'/Users/samer/.node_libraries'</span>,</div><div class="line">  <span class="hljs-string">'/usr/local/Cellar/node/7.7.1/lib/node'</span> ]</div></pre></td></tr></table></figure>
<p>The paths list is basically a list of node_modules directories under every directory from the current directory to the root directory. It also includes a few legacy directories whose use is not recommended.</p>
<p>If Node can’t find <code>find-me.js</code> in any of these paths, it will throw a ‘cannot find module error’.</p>
<h4 id="Requiring-a-folder"><a href="#Requiring-a-folder" class="headerlink" title="Requiring a folder"></a>Requiring a folder</h4><p>Modules don’t have to be files. We can also create a <code>find-me</code> folder under <code>node_modules</code> and place an <code>index.js</code> file in there. The same <code>require(&#39;fine-me&#39;)</code> line will use that folder’s <code>index.js</code> file.</p>
<p>An <code>index.js</code> file will be used by default when we require a folder, but we can control what file name to start under the folder using the <code>main</code> property in <code>package.json</code>.</p>
<h4 id="require-resolve"><a href="#require-resolve" class="headerlink" title="require.resolve"></a>require.resolve</h4><p>If you want to only resolve the module and not execute it, you can use the <code>require.resolve</code> function. This behaves exactly the same as the main <code>require</code> function, but does not execute the file.</p>
<p><strong>This can be used, for example, to check whether an optional package is installed or not and only use it when it’s available</strong>.</p>
<h4 id="exports-module-exports-and-asynchronous-loading-of-modules"><a href="#exports-module-exports-and-asynchronous-loading-of-modules" class="headerlink" title="exports, module.exports, and asynchronous loading of modules"></a>exports, module.exports, and asynchronous loading of modules</h4><p>In any module, exports is a special object.</p>
<p><code>exports</code> variable inside each module is just a reference to <code>module.exports</code> which manages the exported properties.</p>
<p>When we reassign the <code>exports</code> variable, that reference is lost and we would be introducing a new variable instead of changing the <code>module.exports</code> object.</p>
<p>The <code>module.exports</code> object in every module is what the <code>require</code> function returns when we require that module.</p>
<p>Let’s talk about the <code>loaded</code> attribute on every module. The <code>module</code> module use the <code>loaded</code> attribute to track which modules have been loaded(true value) and which modules are still being loaded(false value).</p>
<p>The <code>exports</code> object becomes complete when Node finishes loading the module(and label it so). The whole process of requiring/loading a module is <em>synchronous</em>. That’s why we were able to see the modules fully loaded after one cycle of the event loop.</p>
<p>This also means that we cannot change the <code>exports</code> object asynchronously.</p>
<h4 id="JSON-and-C-C-addons"><a href="#JSON-and-C-C-addons" class="headerlink" title="JSON and C/C++ addons"></a>JSON and C/C++ addons</h4><p>We can natively require JSON files and C++ addon files with the require function. You don’t need to specify the extensions.</p>
<p>If a file extension was not specified, the first thing Node will try to resolve is a <code>.js</code>, then <code>.json</code>, and it will parse the <code>.json</code> file if found as a JSON text file. After that Node will try to find a binary <code>.node</code> file.</p>
<p>Requiring JSON file is useful, for example, everything you need to manage in that file is some static configuration values, or some values that you periodically read from an external source. For example, if we had the following <code>config.json</code> file:</p>
<figure class="highlight json hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="hljs-attr">"host"</span>: <span class="hljs-string">"localhost"</span>,</div><div class="line">  <span class="hljs-attr">"port"</span>: <span class="hljs-number">8080</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>We can require it directly like this:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">const</span> &#123; host, port &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./config'</span>)</div></pre></td></tr></table></figure>
<h3 id="All-code-you-write-in-Node-will-be-wrapped-in-functions"><a href="#All-code-you-write-in-Node-will-be-wrapped-in-functions" class="headerlink" title="All code you write in Node will be wrapped in functions"></a>All code you write in Node will be wrapped in functions</h3><p>Node’s wrapping of modules is often misunderstood. To understand it, let me remind you about the <code>exports/module.exports</code> relation.</p>
<p>We can use the <code>exports</code> object to export properties, but we cannot replace the <code>exports</code> object directly because it’s just a reference to <code>module.exports</code>.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">exports.id = <span class="hljs-number">52</span>; <span class="hljs-comment">// This is ok</span></div><div class="line">exports = &#123; <span class="hljs-attr">id</span>: <span class="hljs-number">52</span> &#125;; <span class="hljs-comment">// This will not work</span></div><div class="line"><span class="hljs-built_in">module</span>.exports = &#123; <span class="hljs-attr">id</span>: <span class="hljs-number">52</span> &#125;; <span class="hljs-comment">// This is ok</span></div></pre></td></tr></table></figure>
<p>How exactly does this <code>exports</code> object, which appears to be global for every module, get defined as a reference on the <code>module</code> object?</p>
<p>In a browser, when we declare a variable in a script like this:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">var</span> answer = <span class="hljs-number">12</span>;</div></pre></td></tr></table></figure>
<p>That <code>answer</code> variable will be globally available in all scripts after the script that define it.</p>
<p>This is not the case in Node. When we define a variable in one module, the other module modules in the program will not have access to that variable. So how come variables in Node are magically scoped?</p>
<p>The answer is simple. Before compiling a module, Node wraps the module code in a function, which we can inspect using the <code>wrapper</code> property of the <code>module</code> module.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">~ $ node</div><div class="line">&gt; <span class="hljs-built_in">require</span>(<span class="hljs-string">'module'</span>).wrapper</div><div class="line">[ <span class="hljs-string">'(function (exports, require, module, __filename, __dirname) &#123; '</span>,</div><div class="line">  <span class="hljs-string">'\n&#125;);'</span> ]</div><div class="line">&gt;</div></pre></td></tr></table></figure>
<p>Node does not execute any code you write in a file directly. It executes this wrapper function which will have your code in its body.</p>
<p>This is what keeps the top-level variables that are defined in any module scoped to that module.</p>
<p>This wrapper function has 5 arguments: <code>exports</code>, <code>require</code>, <code>module</code>, <code>__filename</code>, <code>__dirname</code>. This is what makes them appear to look global when in fact they are specific to each module.</p>
<p>All of these arguments get their value when Node execute the wrapper function. <code>exports</code> is defined as a reference to <code>module.exports</code> prior to that. <code>require</code> and <code>module</code> are both specific to the function to be executed, and <code>__dirname</code>/<code>__filename</code> variables will contain the wrapped module’s directory path and absolute filename.</p>
<p>Since every module gets wrapped in a function, we can actually access that function’s arguments with the <code>arguments</code> keyword:</p>
<figure class="highlight hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">~/learn-node $ echo "console.log(arguments)" &gt; index.js</div><div class="line">~/learn-node $ node index.js</div><div class="line">&#123; '0': &#123;&#125;,</div><div class="line">  '1':</div><div class="line">   &#123; [Function: require]</div><div class="line">     resolve: [Function: resolve],</div><div class="line">     main:</div><div class="line">      Module &#123;</div><div class="line">        id: '.',</div><div class="line">        exports: &#123;&#125;,</div><div class="line">        parent: null,</div><div class="line">        filename: '/Users/samer/index.js',</div><div class="line">        loaded: false,</div><div class="line">        children: [],</div><div class="line">        paths: [Object] &#125;,</div><div class="line">     extensions: &#123; ... &#125;,</div><div class="line">     cache: &#123; '/Users/samer/index.js': [Object] &#125; &#125;,</div><div class="line">  '2':</div><div class="line">   Module &#123;</div><div class="line">     id: '.',</div><div class="line">     exports: &#123;&#125;,</div><div class="line">     parent: null,</div><div class="line">     filename: '/Users/samer/index.js',</div><div class="line">     loaded: false,</div><div class="line">     children: [],</div><div class="line">     paths: [ ... ] &#125;,</div><div class="line">  '3': '/Users/samer/index.js',</div><div class="line">  '4': '/Users/samer' &#125;</div></pre></td></tr></table></figure>
<p>What happens is roughly equivalent to:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">require, module, __filename, __dirname</span>) </span>&#123;</div><div class="line">  <span class="hljs-keyword">let</span> exports = <span class="hljs-built_in">module</span>.exports;</div><div class="line">  <span class="hljs-comment">// Your Code...</span></div><div class="line">  <span class="hljs-keyword">return</span> <span class="hljs-built_in">module</span>.exports;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>If we change the whole <code>exports</code> object, it would no longer be a reference to <code>module.exports</code>.</p>
<h4 id="The-require-object"><a href="#The-require-object" class="headerlink" title="The require object"></a>The require object</h4><p>There is nothing special about <code>require</code>. It’s an object that acts mainly as a function that takes a module name or path and return the <code>module.exports</code> object. We can simply override the <code>require</code> object with our own logic if we want to.</p>
<p>For exmaple, maybe for testing purposes, we want every <code>require</code> call to be mocked by default and just return a fake object instead of the required module exports object.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-built_in">require</span> = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;</div><div class="line">  <span class="hljs-keyword">return</span> &#123; <span class="hljs-attr">mocked</span>: <span class="hljs-literal">true</span> &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>After doing the above reassignment of <code>require</code>, every <code>require(&#39;something&#39;)</code> call in the script will just return the mocked object.</p>
<p>The require object also has properties of its own. We’ve seen the <code>resolve</code> property, which is a function that performs only the resolving step of the require process. We’ve also seen <code>require.extensions</code> above.</p>
<p>There is also <code>require.main</code> which can be helpful to determine if the script is being required or run directly.</p>
<p>Say, for example, that we have this simple <code>printFrame</code> function in <code>print-in-frame.js</code></p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// In print-in-frame.js</span></div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> printFrame = <span class="hljs-function">(<span class="hljs-params">size, header</span>) =&gt;</span> &#123;</div><div class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'*'</span>.repeat(size))</div><div class="line">  <span class="hljs-built_in">console</span>.log(header)</div><div class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'*'</span>.repeat(size))</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>We want to use this file in two ways:</p>
<ul>
<li>From the command line directly like this:</li>
</ul>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">node <span class="hljs-built_in">print</span>-in-frame 8 hello</div></pre></td></tr></table></figure>
<ul>
<li>With <code>require</code></li>
</ul>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">const</span> print = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./print-in-frame.js'</span>)</div><div class="line">print(<span class="hljs-number">5</span>, <span class="hljs-string">'hello'</span>)</div></pre></td></tr></table></figure>
<p>Those are two different usages. We need a way to determine if the file is being run as a stand-alone script or if it is being required by other scripts.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">const</span> printFrame = <span class="hljs-function">(<span class="hljs-params">size, header</span>) =&gt;</span> &#123;</div><div class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'*'</span>.repeat(size))</div><div class="line">  <span class="hljs-built_in">console</span>.log(header)</div><div class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'*'</span>.repeat(size))</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-keyword">if</span> (<span class="hljs-built_in">require</span>.main === <span class="hljs-built_in">module</span>) &#123;</div><div class="line">  <span class="hljs-comment">// the file is being executed directly</span></div><div class="line">  printFrame(process.argv[<span class="hljs-number">2</span>], process.argv[<span class="hljs-number">3</span>])</div><div class="line">&#125; <span class="hljs-keyword">else</span> &#123;</div><div class="line">  <span class="hljs-built_in">module</span>.exports = printFrame</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="All-module-can-be-cached"><a href="#All-module-can-be-cached" class="headerlink" title="All module can be cached"></a>All module can be cached</h3><p>Caching is important to understand.</p>
<p>Say that we have the following <code>ascii-art.js</code> file that prints a cool looking header:</p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">#####</span></div><div class="line"><span class="hljs-comment">#</span></div><div class="line"><span class="hljs-comment">#####</span></div><div class="line"><span class="hljs-comment">#</span></div><div class="line"><span class="hljs-comment">#</span></div></pre></td></tr></table></figure>
<p>We want to display this header every time we <code>require</code> the file, so when we require the file twice, we want the header to show twice:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-built_in">require</span>(<span class="hljs-string">'./ascii-arg'</span>); <span class="hljs-comment">// it will show the header</span></div><div class="line"><span class="hljs-built_in">require</span>(<span class="hljs-string">'./ascii-arg'</span>); <span class="hljs-comment">// it won't show the header</span></div></pre></td></tr></table></figure>
<p>The second require will not show the header because of modules’ caching. Node caches the first call and does not load the file on the second call.</p>
<p>We can see this cache by printing <code>require.cache</code> after the first require. The cache registry is simply an object that has a property for every required module. Those properties values are the <code>module</code> objects used for each module. We can simply delete a property from that <code>require.cache</code> object to invalidate that cache. If we do that, Node will reload the module to recache it.</p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-18T03:14:46.000Z">2017-08-18</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    9 minutes read (About 1288 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/18/Concurrency-and-Parallelism-Understanding-I-O/">Concurrency and Parallelism: Understanding I/O</a>
            
        </h1>
        <div class="content">
            <p><a href="https://blog.risingstack.com/concurrency-and-parallelism-understanding-i-o/" target="_blank" rel="noopener">Original Post</a></p>
<p>Concurrency is much border, genral problem than parallelism. If you have tasks having inputs and outputs, and you want to schedule them so that they produce correct results, you are solving a concurrency problem.</p>
<p>Take a look at this diagram:</p>
<p><img src="https://blog-assets.risingstack.com/2017/02/cuncurrency-paralellism-diagram-of-tasks-with-dependencies.png" alt=""></p>
<p>It shows a data flow with input and output dependencies. Here tasks 2, 3, 4 can run concurrently after 1. There is no specific order between them, so we have multiple alternatives for running it sequetially. Showing only two of them:</p>
<p><img src="https://blog-assets.risingstack.com/2017/02/concurrent-data-flow-path-13245.png" alt=""></p>
<p>Alternatively, these tasks can run in parallel, e.g. on another processor core, another processor, or an entirely seperate computer.</p>
<p>On these diagrams, thread means a computation carried out on dedicated processor core, not an OS thread, as they are not necessarily parallel.</p>
<p><img src="https://blog-assets.risingstack.com/2017/02/paralellized-tasks-diagram.png" alt=""></p>
<p>If we only have one processor, why do we even bother with writing concurrent application? The processing time will not get shorter, and we add the overhead of scheduling. As a matter of fact, any modern operating system will also slice up the concurrent tasks and interleave them, so each of the slices will run for a short time.</p>
<h5 id="There-are-various-reasons-for-this"><a href="#There-are-various-reasons-for-this" class="headerlink" title="There are various reasons for this:"></a>There are various reasons for this:</h5><ul>
<li><p>We human like to interact with the computer in real time, e.g. as I type this text, I want to see it appearing on the screen immediately, at the same time listening to my favorite tracklist, and getting notifications about my incoming emails. Just imagine that you cannot drag a window while the movie keeps on playing it.</p>
</li>
<li><p>Not all operations are carried out on the computer’s CPU. If you want to write to an HDD for example, a lot of time is spent seeking to the position, writing the sectors, etc, and the intermittent time can be spent to do something else.</p>
</li>
</ul>
<p>These require the operating system kernel to run tasks in an interleaved manner, referred to as <code>time-sharing</code>. This is a very important property of modern operating systems.</p>
<h3 id="Processes-and-Threads"><a href="#Processes-and-Threads" class="headerlink" title="Processes and Threads"></a>Processes and Threads</h3><blockquote>
<p>A process is a running instance of a computer program. It is what you see in the task manager of your operating system or <code>top</code>.</p>
</blockquote>
<p>A process consists of allocated memory which holds the program code, its data, a heap for dynamic memory allocation, and a lot more. However, it is not the unit for multi-tasking in desktop operating systems.</p>
<blockquote>
<p>Thread is the default unit - the task - of CPU usage. COde executed in a single thread is what we usually refer to as sequential or synchronous execution.</p>
</blockquote>
<p>Threads are supported by nearly all operating systems and can be created with system calls. They have theri own <code>call stack</code>, <code>virual CPU</code> and <code>local storage</code> but share the application’s <code>heap</code>, data, codebase and resources.</p>
<p>They also serve as the unit of scheduling in the kernel. For this reason, we call them <code>kernel threads</code>, clarifying that they are native to the operating system and scheduled by the kernel, which distinguishes them from use-space threads, also called <code>green threads</code> which are scheduled by some user space schedular such as a library or VM.</p>
<p><img src="https://blog-assets.risingstack.com/2017/02/kernel-processes-and-threads-1.png" alt=""></p>
<p>Most desktop and sever operating system kernels use preemptive schedulers, as does the Linux, macOS and Windows kernel. We can assume that threads are preemptive scheduled, distinguishing them from their non-preemptive(cooperative) counterparts, called <code>fiber</code>. This preemptive scheduling is the reason that a hanging process doesn’t stall the whole computer.</p>
<p>The hanging time slices are interleaved with other processes’ and the OS’ code, so the system as a whole remains responsive.</p>
<p>Context switching(switching between threads) is done at frequent intervals by the kernel, creating the illusion that our programs are running in parallel, whereas in reality, they are running concurrently but sequentially in short slices.</p>
<h3 id="CPU-vs-I-O"><a href="#CPU-vs-I-O" class="headerlink" title="CPU vs. I/O"></a>CPU vs. I/O</h3><p>Programs usually don’t only consist of numeric, arithmetic and logic computations, in fact, a lot of times they merely write something to the file system, do network requests or access peripheries such as the console or an external device.</p>
<p>While the first kind of workload is CPU intensive, the latter requries performing I/O in the majority of the time.</p>
<p>Doing I/O is a kernel space operation, initiated with a system call, so it results in a privilege context switch.</p>
<p>When an I/O operation is requested with a blocking  system call, we are talking about <em>blocking I/O</em>.</p>
<p>This can deteriorate concurrency under implementation, concretely those that use <em>many-to-one mapping</em>. This means that all threads in a process share a common kernel thread, which implies that every thread is blocked when one does blocking I/O.</p>
<p>No wonder that modern OSes don’t do this. Instead, they use <code>one-to-one</code> mapping, i.e. map a kernel thread to each user-space thread, allowing another thread to run when one makes a blocking system call, which means that they are unaffected by the above adverse effect.</p>
<h3 id="I-O-favors-Blocking-vs-Non-Blocking-Sycn-vs-Async"><a href="#I-O-favors-Blocking-vs-Non-Blocking-Sycn-vs-Async" class="headerlink" title="I/O favors: Blocking vs. Non-Blocking, Sycn vs. Async"></a>I/O favors: Blocking vs. Non-Blocking, Sycn vs. Async</h3><p>Doing I/O usually consiss of two distinct steps:</p>
<ul>
<li><p>checking the device</p>
<ul>
<li><p>blocking: waiting for the device to be ready</p>
</li>
<li><p>non-blocking: e.g. polling periodically until ready</p>
</li>
</ul>
</li>
<li><p>transmitting:</p>
<ul>
<li><p>synchronous: executing the operation (e.g. read or write) initiated by the program.</p>
</li>
<li><p>asynchronous: executing the operation as response to an event from the kernel(asynchronous/event drive)</p>
</li>
</ul>
</li>
</ul>
<p>You can mix the two steps in every fashion</p>
<h3 id="Busy-Waiting-Polling-and-the-Event-Loop"><a href="#Busy-Waiting-Polling-and-the-Event-Loop" class="headerlink" title="Busy-Waiting, Polling, and the Event Loop"></a>Busy-Waiting, Polling, and the Event Loop</h3><p>Busy-waiting is the act of repeatedly checking a resource, such as I/O for availability in a <em>tight loop</em>. The absence of the tight loop is what distinguishes <code>polling</code> for busy-waiting.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// tight-loop example</span></div><div class="line"><span class="hljs-keyword">while</span> (pthread_mutex_trylock(&amp;my_mutex) == EBUSY) &#123; &#125;</div><div class="line"><span class="hljs-comment">// mutex is unlocked</span></div><div class="line">do_stuff()</div><div class="line"></div><div class="line"><span class="hljs-comment">// polling example</span></div><div class="line"><span class="hljs-keyword">while</span> (pthread_mutex_trylock(&amp;my_mutex) == EBUSY) &#123;</div><div class="line">  sleep(POLL_INTERVAL)</div><div class="line">&#125;</div><div class="line"><span class="hljs-comment">// mutex is unlocked</span></div><div class="line">do_stuff()</div></pre></td></tr></table></figure>
<p>The difference between the two code is apparent. The <code>sleep</code> function puts the current thread of execution to sleep, yield control to the kernel to schedule something else to run.</p>
<p>It is also obvious that both of them offer a technique of turning non-blocking code into blocking code, because control won’t pass the loop until the mutex becomes free. This means that <code>do_stuff</code> is blocked.</p>
<p>Let’s say we have more of thse mutexes or any arbitrary I/O device that can be polled. We can invert control-flow by assigning handlers to be called when the resource is ready. If we periodically check the resources in the llop and execute the associated handlers on completion, we created what is called an <code>event loop</code>.</p>
<h3 id="TCP-server-example"><a href="#TCP-server-example" class="headerlink" title="TCP server example"></a>TCP server example</h3><p>The following exmaple will illustrate the differences between working with <em>synchronous, blocking</em> and <em>non-blocking</em> network I/O. It is a dead-simple TCP echo server. After the client connects, every line is echoed back to the socket until the client write ‘bye’.</p>
<h4 id="Single-threaded"><a href="#Single-threaded" class="headerlink" title="Single threaded"></a>Single threaded</h4><p>The first version uses the standard POSIX procedure of <code>sys/socket.h</code>.</p>
<p>The server is single-threaded, it waits until a client connects.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// wait for a connection, then accept() it</span></div><div class="line"><span class="hljs-keyword">if</span> ((conn_s) = accept(list_s, NULL, NULL) &lt; <span class="hljs-number">0</span>) &#123;</div><div class="line">  <span class="hljs-comment">// exit w err</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Then it reads from the socket each line and echoes it back until the client closes connection or prints the word ‘bye’ on a line.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">bye = <span class="hljs-number">0</span></div><div class="line"><span class="hljs-keyword">while</span>(!bye) &#123;</div><div class="line">  read_line_from_socket(conn_s, buffer, MAX_LINE - <span class="hljs-number">1</span>)</div><div class="line">  <span class="hljs-keyword">if</span> (!strncmp(buffer, <span class="hljs-string">'bye\n'</span>, MAX_LINE - <span class="hljs-number">1</span>)) bye = <span class="hljs-number">1</span></div><div class="line">  write_line_to_socket(conn_s, buffer, strlen(buffer))</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-keyword">if</span> (close(conn_s) &lt; <span class="hljs-number">0</span>) &#123;</div><div class="line">  <span class="hljs-comment">// exit w err</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-17T03:23:44.000Z">2017-08-17</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    7 minutes read (About 987 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/17/Advanced-Topics-of-TS/">Advanced Topics of TS</a>
            
        </h1>
        <div class="content">
            <h3 id="Iterators-and-Generators"><a href="#Iterators-and-Generators" class="headerlink" title="Iterators and Generators"></a>Iterators and Generators</h3><p>Iterators are basically objects that can be hold more than one item. Iterators are collections of objects or variables or items that can be iterated on to do some sort of processing on each item in the collection. Arrays are an exmaple of iterators.</p>
<p>In TypeScript, an object is demmed iterable if it has an implementation for <code>Symbol.iterator</code> property. Some built-in types like <strong>Array, Map, Set, String, Int32Array</strong>, etc. have their <code>Symbol.iterator</code> property already implemented.</p>
<p><code>Symbol.iterator</code> function on an object is responsible for returning the list of values to iterate on.</p>
<p><code>for...of...</code> statements</p>
<p><code>for...of...</code> loops over an iterable object will invoke the <code>Symbol.iterable</code> property on the object.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">let</span> someArray = [<span class="hljs-number">1</span>, <span class="hljs-string">'string'</span>, <span class="hljs-literal">false</span>]</div><div class="line"></div><div class="line"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> entry <span class="hljs-keyword">of</span> someArray) &#123;</div><div class="line">  <span class="hljs-built_in">console</span>.log(entry) <span class="hljs-comment">// 1, 'string', false</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Intersection-Types"><a href="#Intersection-Types" class="headerlink" title="Intersection Types"></a>Intersection Types</h3><p>An intersection type combines multiple types into one. This is allows you to add together existing types to get a single type that has all the features you need.</p>
<h4 id="Union-Types"><a href="#Union-Types" class="headerlink" title="Union Types"></a>Union Types</h4><p>Union Types are closely related to intersection types, but they are used very differently. Occasionally, you’ll run into a library that expects a parameter to be either a <code>number</code> or a <code>string</code>.</p>
<h3 id="Type-Guards"><a href="#Type-Guards" class="headerlink" title="Type Guards"></a>Type Guards</h3><p>Union Types are useful for modeling situations when values can overlap in the types they can take on.</p>
<p>TypeScript has what is called a <code>type guard</code>.</p>
<p>A type guard is some expression that performs a runtime check that guarantees the type in some scope. To define a type guard, we simply need to define a function whose return type is a <code>type predicate</code>.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isFish</span>(<span class="hljs-params">pet: Fish | Bird</span>): <span class="hljs-title">pet</span> <span class="hljs-title">is</span> <span class="hljs-title">Fish</span> </span>&#123;</div><div class="line">  <span class="hljs-keyword">return</span> (&lt;Fish&gt;pet).swim !== undefined</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>pet is Fish</code> is our type predicate in this example. A predicate takes the form <code>parameterName is Type</code>, where <code>parameterName</code> must be the name of a parameter from the current function signature.</p>
<p>Any time <code>isFish</code> is called with some variable, TypeScript will <code>narrow</code> that variable to that specific type if the original type is compatible.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">if</span> (isFish(pet)) &#123;</div><div class="line">  pet.swim()</div><div class="line">&#125; <span class="hljs-keyword">else</span> &#123;</div><div class="line">  pet.fly()</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Notice that TypeScript not only knows that <code>pet is Fish</code> in the if branch, it also knows that in the else branch you <strong>don’t</strong> have a fish, so you must have a <code>Bird</code>.</p>
<h4 id="typeof-type-guards"><a href="#typeof-type-guards" class="headerlink" title="typeof type guards"></a><code>typeof</code> type guards</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isNumber</span>(<span class="hljs-params">x: any</span>): <span class="hljs-title">x</span> <span class="hljs-title">is</span> <span class="hljs-title">number</span> </span>&#123;</div><div class="line">  <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> x === <span class="hljs-string">'number'</span></div><div class="line">&#125;</div><div class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isString</span>(<span class="hljs-params">x: any</span>): <span class="hljs-title">x</span> <span class="hljs-title">is</span> <span class="hljs-title">string</span> </span>&#123;</div><div class="line">  <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> x === <span class="hljs-string">'string'</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">padLeft</span>(<span class="hljs-params">value: string, padding: string | number</span>) </span>&#123;</div><div class="line">  <span class="hljs-keyword">if</span> (isNumber(padding)) &#123;</div><div class="line">    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Array</span>(padding + <span class="hljs-number">1</span>).join(<span class="hljs-string">' '</span>) + value</div><div class="line">  &#125;</div><div class="line">  <span class="hljs-keyword">if</span> (isString(padding)) &#123;</div><div class="line">    <span class="hljs-keyword">return</span> padding + value</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`Expected string or number, got <span class="hljs-subst">$&#123;padding&#125;</span>`</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>However, having to define a functino to figure out if a typeis a primitive is kind of a pain.</p>
<p>TypeScript will recognize <code>typeof x === &#39;number&#39;</code> as a type guard on its own. This means we could just write checks inline.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">padLeft</span> (<span class="hljs-params">value: string, padding: number | string </span>) </span>&#123;</div><div class="line">  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> padding === <span class="hljs-string">'number'</span>) &#123;</div><div class="line">    <span class="hljs-comment">// ...</span></div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> padding === <span class="hljs-string">'string'</span>) &#123;</div><div class="line">    <span class="hljs-comment">// ...</span></div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`Expected string or number, got <span class="hljs-subst">$&#123;padding&#125;</span>`</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>These <code>typeof</code> <em>type guards</em> are recognized in two different forms: <code>typeof v === &#39;typename&#39;</code> and <code>typeof v !== &#39;typename&#39;</code>.</p>
<h4 id="instanceof-type-guards"><a href="#instanceof-type-guards" class="headerlink" title="instanceof type guards"></a><code>instanceof</code> type guards</h4><p><code>instanceof</code> <em>type guards</em> are a way of narrowing types using their constructor function.</p>
<p>The right side of the <code>instanceof</code> needs to be a constructor function, and TypeScript narrow down to:</p>
<ul>
<li><p>the type of the function’s <code>prototype</code> property if its type is not any.</p>
</li>
<li><p>the union of types returned by that type’s construct signatures.</p>
</li>
</ul>
<p>in that order.</p>
<h3 id="Generics"><a href="#Generics" class="headerlink" title="Generics"></a>Generics</h3><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">identity</span>&lt;<span class="hljs-title">T</span>&gt;(<span class="hljs-params">arg: T</span>): <span class="hljs-title">T</span> </span>&#123;</div><div class="line">  <span class="hljs-keyword">return</span> arg</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>We add a type variable <code>T</code> to the identity function. This T allows us to capture the type the user of the code provides, so that we can use that information later.</p>
<p>We say that this version of the <code>identity</code> function is generic, as it works over a range of types.</p>
<p>Once we’ve written the generic identity function, we can call it in one of two ways.</p>
<p>The first way is to pass all of the arguments, including the type argument, to the function.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">let</span> output = identity&lt;string&gt;(<span class="hljs-string">'myString'</span>); <span class="hljs-comment">// type of output will be string</span></div></pre></td></tr></table></figure>
<p>Here we explicitly set T to be <code>string</code> as one of the arguments to the function call, denoted using <code>&lt;&gt;</code> around the arguments rather than ().</p>
<p>The second way is also perphaps the most common. Here we use <em>type argument inference</em> – that is, we want the compiler to set the value of T for us automatically based on the type of the argument we pass in.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">let</span> output = identity(<span class="hljs-string">'myString'</span>); <span class="hljs-comment">// type of output will be 'string'</span></div></pre></td></tr></table></figure>
<h4 id="Working-with-Generic-Type-Variables"><a href="#Working-with-Generic-Type-Variables" class="headerlink" title="Working with Generic Type Variables"></a>Working with Generic Type Variables</h4><p>When you begin to use generics, you’ll notice that when you create generic functinos like <code>identity</code>, the compiler will enfore that you use any generically typed parameters in the body of the function correctly.</p>
<h4 id="Generic-Types"><a href="#Generic-Types" class="headerlink" title="Generic Types"></a>Generic Types</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">identity</span>&lt;<span class="hljs-title">T</span>&gt;(<span class="hljs-params">arg: T</span>): <span class="hljs-title">T</span> </span>&#123;</div><div class="line">  <span class="hljs-keyword">return</span> arg;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-keyword">let</span> myIdentity: &lt;T&gt;(arg: T) =&gt; T = identity</div><div class="line"></div><div class="line">// we can also write the generic type as a call signature of an object literal type:</div><div class="line"></div><div class="line">let myIdentity: &#123;&lt;T&gt;(arg: T) : T&#125; = identity</div><div class="line"></div><div class="line">interface GenericIdentityFn &#123;</div><div class="line">  &lt;T&gt;(arg: T): T</div><div class="line">&#125;</div><div class="line"></div><div class="line">// or</div><div class="line"></div><div class="line">interface GenericIdentityFn&lt;T&gt; &#123;</div><div class="line">  (arg: T): T</div><div class="line">&#125;</div><div class="line"></div><div class="line">let myIdentity: GenericIdentityFn&lt;number&gt; = identity</div></pre></td></tr></table></figure>
<h4 id="Generic-Classes"><a href="#Generic-Classes" class="headerlink" title="Generic Classes"></a>Generic Classes</h4><p>A generic class has a similar shape to a generic interface.</p>
<p>Generic classes have a generic type parameter list in angle brackets(&lt;&gt;) following the name of the class.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GenericNumber</span>&lt;<span class="hljs-title">T</span>&gt; </span>&#123;</div><div class="line">  zeroValue: T;</div><div class="line">  add: <span class="hljs-function">(<span class="hljs-params">x: T, y: T</span>) =&gt;</span> T;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-keyword">let</span> myGenericNumber = <span class="hljs-keyword">new</span> GenericNumber&lt;number&gt;()</div></pre></td></tr></table></figure>
<p>Generic classes are only generic over their instance side rather than their static side.</p>
<h3 id="Decorator"><a href="#Decorator" class="headerlink" title="Decorator"></a>Decorator</h3><p>A <em>Decorator</em> is a special kind of declaration that can be attached to a class declaration, method, accessor, property, or parameter.</p>
<p>Sometimes it is required to have additional features to support annotating or modifying classes and class members. Decorators provide a way to add both annotation and a meta-programming syntax for class declarations and members.</p>
<p>Decoration use the form <code>@expression</code>, where <code>expression</code> must evaluate to a function that will be called at runtime with information about the decorated declaration.</p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-15T09:20:51.000Z">2017-08-15</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    9 minutes read (About 1335 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/15/Note-2-on-TS2-of-edX/">Note(2) on TS2 of edX</a>
            
        </h1>
        <div class="content">
            <h3 id="Modules"><a href="#Modules" class="headerlink" title="Modules"></a>Modules</h3><p>Modules are used for code organization as well as code sharing.</p>
<p>Modules are executed within their own scope, not in the global scope. This means that variables, functions, classes, etc. declared in a module are not visible outside the module unless they are explicitly exported using <code>export</code>. Conversely, to consume a variable, function, class, interface, etc. exported from a different module, it has to be imported using <code>import</code>.</p>
<p>Modules are declarative.</p>
<p>In TypeScript any file containing a top-level <code>import</code> or <code>export</code> is considered a module.</p>
<h4 id="Export"><a href="#Export" class="headerlink" title="Export"></a>Export</h4><p>Exporting a declaration.</p>
<p>Any declaration(such as variable, function, class, type alias, or interface) can be exported by adding the <code>export</code> keyword.</p>
<p>A module can wrap one or more modules and combine all their exports using <code>export * from</code> syntax.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// allValidator.ts</span></div><div class="line"><span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">'./StringValidator'</span></div><div class="line"><span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">'./LetterOnlyValidator'</span></div><div class="line"><span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">'./ZipCodeValidator'</span></div></pre></td></tr></table></figure>
<p>Import can be renamed.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">import</span> &#123; ZipCodeValidator <span class="hljs-keyword">as</span> ZCV &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'./ZipCodeValidator'</span></div></pre></td></tr></table></figure>
<h4 id="Default-exports"><a href="#Default-exports" class="headerlink" title="Default exports"></a>Default exports</h4><p>Each module can optionally export a <code>default</code> export. Default exports are marked with the keyword <code>default</code>, and there can only be one <code>default</code> export per module.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// jQuery.ts</span></div><div class="line">declare <span class="hljs-keyword">let</span> $: Jquery;</div><div class="line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> $;</div><div class="line"></div><div class="line"><span class="hljs-comment">// App.ts</span></div><div class="line"><span class="hljs-keyword">import</span> $ <span class="hljs-keyword">from</span> <span class="hljs-string">'jQuery'</span></div></pre></td></tr></table></figure>
<h3 id="Declaration-Files"><a href="#Declaration-Files" class="headerlink" title="Declaration Files"></a>Declaration Files</h3><p>Declarations are used to describe code that exists elsewhere using the <code>declare</code> keyword. The goad of this is to be able to use this code in TypeScript applications without having to rewrite the code in TypeScript.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">declare <span class="hljs-keyword">var</span> mynumber: any;</div><div class="line">mynumber = <span class="hljs-number">300</span>; <span class="hljs-comment">// ok</span></div></pre></td></tr></table></figure>
<p>You can save these declaration in a <code>.ts</code> file or in a <code>.d.ts</code> file, we call these file with <code>.d.ts</code> extension <strong>declaration files</strong>.</p>
<p>It’s good practice to keep your declarations in separate <code>.d.ts</code> file.</p>
<p>If a file has the extension <code>.d.ts</code> then each root level definition must have the <code>declare</code> keyword prefixed to it. This tells the developer that there will be no code emitted by TypeScript. The developer needs to ensure that the declared item will exist at runtime.</p>
<p>For example, lets assume we have the following JavaScript code(message.js)</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">showMessage</span> (<span class="hljs-params">message</span>) </span>&#123;</div><div class="line">  alert(message)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>If you want to call the <code>showMessage</code> function in your TypeScript code, TypeScript will not recognize that this function exists. It does not know its name or its parameter. This can be fixed by describing the <code>showMessage</code> function in a definition file as (message.d.ts):</p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-built_in">declare</span> <span class="hljs-keyword">function</span> showMessage(message: string)</div></pre></td></tr></table></figure>
<p>Now you can use the function <code>showMessage</code> in TypeScript without compile errors.</p>
<h4 id="d-ts-files-and-ts-files"><a href="#d-ts-files-and-ts-files" class="headerlink" title=".d.ts files and .ts files"></a>.d.ts files and .ts files</h4><p>Anything allowed in a <code>.d.ts</code> file mayu also appear in a <code>.ts</code> file, but not the reverse. Therefore, <code>.d.ts</code> allows a subset of TypeScript features. A <code>.d.ts</code> file is only allowed to contain TypeScript code that doesn’t generate any JavaSAcript code in the output. If you attempt to use any feature of TypeScript that would generate JavaScript, you’ll get an error.</p>
<p>Interfaces are allowed, because they disappear completely after compilation.</p>
<p>Const enums are also allowed, unlike ordinary enums which generate an object in the output JavaScript.</p>
<p>Top level classes, variables, modules, and functions must be prefixed with <code>declare</code>.</p>
<p>It is a common practice to see a top-lvel <code>declare module</code> and then all definition inside it are therefore also declaraion.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">declare <span class="hljs-built_in">module</span> Something &#123;</div><div class="line">  <span class="hljs-keyword">var</span> x;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Working-with-other-JavaScript-Libraries"><a href="#Working-with-other-JavaScript-Libraries" class="headerlink" title="Working with other JavaScript Libraries."></a>Working with other JavaScript Libraries.</h3><p>To describe the shape of libraries not written in TypeScript, we need to declare the API that the library exposes.</p>
<p>We call declarations that don’t define an implementation ‘ambient’. Typically these are defined in <code>.d.ts</code> files.</p>
<h4 id="Ambient-Modules"><a href="#Ambient-Modules" class="headerlink" title="Ambient Modules"></a>Ambient Modules</h4><p>We can define each module in its own <code>.d.ts</code> file with top-level export declarations, but it’s more convenient to write them as one large <code>.d.ts</code> file. To do so, we use a construct similar to ambient namespaces, but we use the <code>module</code> keyword and the quoted name of the module which will be available to a later import.</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">// node.d.ts</div><div class="line">declare module &apos;url&apos; &#123;</div><div class="line">  export interface Url &#123;</div><div class="line">    protocol?: string;</div><div class="line">    hostname?: string;</div><div class="line">    pathname?: string;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  export function parse (urlStr: string, parseQueryString?, slashesDenotateHost?): Url</div><div class="line">&#125;</div><div class="line"></div><div class="line">declare module &apos;path&apos; &#123;</div><div class="line">  export function normalize(p: string): string;</div><div class="line">  export function join(...paths: any[]): string;</div><div class="line">  export var sep: string;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Now we can use <code>/// &lt;reference&gt;node.d.ts</code> and then load the modules using <code>import url = require(&#39;url&#39;)</code> or <code>import * as URL from &#39;url&#39;</code></p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">/// &lt;reference path='node.d.ts' /&gt;</span></div><div class="line"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> URL <span class="hljs-keyword">from</span> <span class="hljs-string">'url'</span></div><div class="line"><span class="hljs-keyword">let</span> myUrl = URL.parse(<span class="hljs-string">'http://www.typescriptlang.org'</span>)</div></pre></td></tr></table></figure>
<h3 id="Module-Resolution"><a href="#Module-Resolution" class="headerlink" title="Module Resolution"></a>Module Resolution</h3><h4 id="Relative-vs-Non-relative-module-imports"><a href="#Relative-vs-Non-relative-module-imports" class="headerlink" title="Relative vs Non-relative module imports"></a>Relative vs Non-relative module imports</h4><p>Module imports are resolved differently based on whether the module reference is relative or non-relative.</p>
<p>A <em>relative import</em> is one that starts with <code>/, ./, ../</code>.</p>
<p>Any other import is considered <em>non-relative</em>.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> $ <span class="hljs-keyword">from</span> <span class="hljs-string">'jquery'</span></div><div class="line"><span class="hljs-keyword">import</span> &#123; Component &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span></div></pre></td></tr></table></figure>
<p>A relative import is resolved relative to the importing file and <em>cannot</em> resolve to an ambient module declaration.</p>
<p>A non-relative import can be resolved relative to <code>baseUrl</code>, or through path mapping. They can also resolve to ambient module declaations.</p>
<h4 id="Module-Resolution-Strategies"><a href="#Module-Resolution-Strategies" class="headerlink" title="Module Resolution Strategies"></a>Module Resolution Strategies</h4><p>There are two possible module resolution strategies: <code>Node</code> and <code>Classic</code>.</p>
<p>You can use the <code>--moduleResolution</code> flag to specify the module resolution strategy. If not specified, the default is <code>Classic</code> for  <code>--module AMD | System | ES2015 | Node</code>.</p>
<h3 id="Modules-or-Namespaces"><a href="#Modules-or-Namespaces" class="headerlink" title="Modules or Namespaces"></a>Modules or Namespaces</h3><h4 id="Namespaces-vs-Modules"><a href="#Namespaces-vs-Modules" class="headerlink" title="Namespaces vs Modules"></a>Namespaces vs Modules</h4><p>If fact, namespaces were previously refered to as <em>internal modules</em> while modules where refered to as <em>external modules</em>.</p>
<h4 id="When-to-use-namespaces-and-when-to-use-moduels"><a href="#When-to-use-namespaces-and-when-to-use-moduels" class="headerlink" title="When to use namespaces and when to use moduels"></a>When to use namespaces and when to use moduels</h4><ul>
<li><p>When first moving to a module-based organization, a common tendency is to wrap exports in an additional layer of namespaces. Modules have their own scope, and only exported declaration are visible from outside the module. With this in mind, namespaces provide very little, if any, value when working with modules.</p>
</li>
<li><p>On the oraganization front, namespaces are handy for grouping together logically-related objects and types in the global.</p>
</li>
<li><p>Namespaces are important to avoid naming collisions in the scope.</p>
</li>
</ul>
<h3 id="Reg-Flags"><a href="#Reg-Flags" class="headerlink" title="Reg Flags"></a>Reg Flags</h3><p><strong>Dont’t use namespace in modules</strong></p>
<p>All of the following are reg flags for module structuring.</p>
<ul>
<li><p>A file whose only top-level declaration is <code>export namespace Foo { ... }</code>(remove <code>Foo</code> and move everything ‘up’ a level.)</p>
</li>
<li><p>A file that has a single <code>export class</code> or <code>export function</code>(consider using <code>export default</code>)</p>
</li>
<li><p>Multiple files that have the same <code>export namespace Foo</code> at top-level(don’t think that these are going to combine into one).</p>
</li>
</ul>
<h3 id="Best-Practice"><a href="#Best-Practice" class="headerlink" title="Best Practice"></a>Best Practice</h3><ul>
<li><p>While <code>namespaces</code> are still available in TypeScript, it is better to use modules as much as possible. This is because in most cases you will need to use external libraries in your application. In that case you will have to deal with modules because modules are the way to go with external none TypeScript libraries. Mixing namespaces and modules in one application is not a recommended practice.</p>
</li>
<li><p>Use modules and not namespaces if you are going to share your code as components or libraries to be consumed by other applications.</p>
</li>
<li><p>Use namespaces if your application is small and within the same application and when you do have any external dependencies like using external libraries or offering your code to be used by other application. You can still use modules in this case.</p>
</li>
</ul>
<h3 id="Working-with-External-Libraries"><a href="#Working-with-External-Libraries" class="headerlink" title="Working with External Libraries"></a>Working with External Libraries</h3><p>Importing a JavaScript Library.</p>
<p>There are two options to bring a javascript library in your typescrpt project:</p>
<ul>
<li><p>Manual download: this is by manually copying some definitions files for the obejcts used in the JavaScript Libraries into your TypeScript Project so that TypeScript can recognize and be able to support the typings. There is a big effort form the TypeScript community to provide those declaration files for almost all the third party JavaScript Libraries out there for developers to copy and include in their projects without having to rewrite the types themselves. This project is called the definitely typed project.</p>
</li>
<li><p>Using TyepSearch: This will automatically install the definition files for the imported libraries. The TypeSearch project that is a Microsoft initiative that uses npm to install lthe library definition files automatically with no need to manually copy any files.</p>
</li>
</ul>
<h4 id="Combine-two-namespaces-with-same-identifier"><a href="#Combine-two-namespaces-with-same-identifier" class="headerlink" title="Combine two namespaces with same identifier"></a>Combine two namespaces with same identifier</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// extendedNamespace_part2.d.ts</span></div><div class="line">namespace ArrayUtilities &#123;</div><div class="line">  <span class="hljs-comment">// ...</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-comment">// extendedNamespace_part1.d.ts</span></div><div class="line"><span class="hljs-comment">/// &lt;reference path="extendedNamespace_part2.d.t.s" /&gt;</span></div><div class="line">namespace ArrayUtilities &#123;</div><div class="line">  <span class="hljs-comment">// ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-11T04:01:59.000Z">2017-08-11</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    22 minutes read (About 3267 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/11/Note-on-TS2-of-edX/">Note on TS2 of edX</a>
            
        </h1>
        <div class="content">
            <h3 id="Classification-of-types-in-TypeScript"><a href="#Classification-of-types-in-TypeScript" class="headerlink" title="Classification of types in TypeScript"></a>Classification of types in TypeScript</h3><p>Types are classified into two main classes in TypeScript:</p>
<h4 id="Basic-or-Primitive-Types"><a href="#Basic-or-Primitive-Types" class="headerlink" title="Basic or Primitive Types"></a>Basic or Primitive Types</h4><ul>
<li><p>boolean</p>
</li>
<li><p>number</p>
</li>
<li><p>string</p>
</li>
<li><p>array: <code>number[]</code>, <code>Array&lt;number&gt;</code></p>
</li>
<li><p>tuple: <code>[string, number]</code></p>
</li>
<li><p>enum: <code>enum Color {Red, Green = 2, Blue}</code>, <code>let c : Color = Color.blue</code></p>
</li>
<li><p>null</p>
</li>
<li><p>undefined</p>
</li>
<li><p>any</p>
</li>
<li><p>void: exists purely to indicate the absence of a value, such as in a function with no return value.</p>
</li>
</ul>
<h4 id="Complex-or-Non-Primitive-Types"><a href="#Complex-or-Non-Primitive-Types" class="headerlink" title="Complex or Non-Primitive Types"></a>Complex or Non-Primitive Types</h4><ul>
<li><p>classes</p>
</li>
<li><p>interface</p>
</li>
</ul>
<h4 id="Type-Assertions"><a href="#Type-Assertions" class="headerlink" title="Type Assertions"></a>Type Assertions</h4><p>Sometimes you’ll end up in a situation where you’ll know more about a value than TypeScript does. Usually this will happen when you know the type of some entity could be more specific than its current type.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">let</span> someValue : any = <span class="hljs-string">'this is a string'</span></div><div class="line"></div><div class="line"><span class="hljs-keyword">let</span> strLength : number = (<span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>someValue).length</span></div><div class="line">let strLength : numner = (someValue as string).length</div></pre></td></tr></table></figure>
<h3 id="Complex-Types-in-TypeScript"><a href="#Complex-Types-in-TypeScript" class="headerlink" title="Complex Types in TypeScript"></a>Complex Types in TypeScript</h3><ul>
<li><p>Interface</p>
</li>
<li><p>Class Types</p>
</li>
<li><p>Function Types</p>
</li>
<li><p>Indexable Types</p>
</li>
<li><p>Classes</p>
</li>
</ul>
<h4 id="Excess-Property"><a href="#Excess-Property" class="headerlink" title="Excess Property"></a>Excess Property</h4><p>If <code>SquareConfig</code> can have <code>color</code> and <code>width</code> propertes, but could <em>also</em> have any number of other properties, then we could define it like so:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">interface SquareConfig &#123;</div><div class="line">  color?: string;</div><div class="line">  width?: number;</div><div class="line">  [propName: string]: any;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Class-Types"><a href="#Class-Types" class="headerlink" title="Class Types"></a>Class Types</h4><p>Implementing an interface</p>
<p>One of the most common use of interfaces in language like C# and java, that of explicitly enforcing that a class meets a particular contract, is also possible in TypeScript.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">interface ClockInterface &#123;</div><div class="line">  <span class="hljs-attr">currentTime</span>: <span class="hljs-built_in">Date</span>,</div><div class="line">  setTime(d: <span class="hljs-built_in">Date</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Clock</span> <span class="hljs-title">implements</span> <span class="hljs-title">ClockInterface</span> </span>&#123;</div><div class="line">  currentTime: <span class="hljs-built_in">Date</span>;</div><div class="line">  setDate(d: <span class="hljs-built_in">Date</span>) &#123;</div><div class="line">    <span class="hljs-keyword">this</span>.currentTime = d;</div><div class="line">  &#125;</div><div class="line">  <span class="hljs-keyword">constructor</span> (h: number, m: number) &#123;</div><div class="line"></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Difference-between-the-static-and-instance-sides-of-classes"><a href="#Difference-between-the-static-and-instance-sides-of-classes" class="headerlink" title="Difference between the static and instance sides of classes"></a>Difference between the static and instance sides of classes</h4><p>When working with classes and interfaces, it helps to keep in mind that a class has <code>two</code> types: the type of the static side and the type of the instance side.</p>
<p>You may notice that if you create an interface with a constructor signature and try to create a class that implements this interface you get an error:</p>
<p>This is because when a class implements an interface, only the <strong>instance side</strong> of the class is checked. Since the constructor sits in the static side, it is not included in this check.</p>
<p>Instead, you would need to work with the static side of the class directly. In this example, we define two interfaces, <code>ClockConstructor</code> for the constructor and <code>Clockinterface</code> for the instance methods.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">interface ClockConstructor &#123;</div><div class="line">  <span class="hljs-keyword">new</span> (hour: number, <span class="hljs-attr">minute</span>: number): ClockInterface;</div><div class="line">&#125;</div><div class="line"></div><div class="line">interface ClockInterface &#123;</div><div class="line">  tick()</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createClock</span>(<span class="hljs-params">ctor: ClockConstructor, hour: number, minute: number</span>): <span class="hljs-title">ClockInterface</span> </span>&#123;</div><div class="line">  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ctor(hour, minute)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Function-Types"><a href="#Function-Types" class="headerlink" title="Function Types"></a>Function Types</h4><p>To describe a function type with an interface, we give the interface a call signature. This is like a function declaration with only the parameter list and return type given. Each parameter in the parameters list requires both name and type.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">interface SearchFunc &#123;</div><div class="line">  (source: string, <span class="hljs-attr">subString</span>: string): boolean;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Once defined, we can use this function type interface like we would other interfaces.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">let</span> mySearch: SearchFunc</div><div class="line">mySearch = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">source, subString</span>) </span>&#123;</div><div class="line">  <span class="hljs-keyword">let</span> result = source.search(subString)</div><div class="line">  <span class="hljs-keyword">return</span> result &gt; <span class="hljs-number">-1</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>For function types to correctly type-check, the names of the parameters do not need to match. We could have, for example, written the above example like this:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">let</span> mySearch: SearchFunc</div><div class="line">mySearch = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">src: string, sub: string</span>): <span class="hljs-title">boolean</span> </span>&#123;</div><div class="line">  <span class="hljs-keyword">let</span> result = src.search(sub)</div><div class="line">  <span class="hljs-keyword">return</span> result &gt; <span class="hljs-number">-1</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Function parameters are checked one at a time, with the type in each corresponding parameter position checked against each other. If you do not want to specify types at all, TypeScript’s contextual typing can infer the argument types since the function value is assigned directly to a variable of type <code>SearchFunc</code></p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">let</span> mySearch: SearchFunc</div><div class="line">mySearch = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">src, sub</span>) </span>&#123;</div><div class="line">  <span class="hljs-keyword">let</span> result = src.search(sub)</div><div class="line">  <span class="hljs-keyword">return</span> result &gt; <span class="hljs-number">-1</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Indexable-Types"><a href="#Indexable-Types" class="headerlink" title="Indexable Types"></a>Indexable Types</h4><p>Intexable types have an <em>index signature</em> that describes the types we can use to index into the object, along with the corresponding return types when indexing.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">interface StringArray &#123;</div><div class="line">  [index: number]: string;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-keyword">let</span> myArray: StringArray;</div><div class="line">myArray = [<span class="hljs-string">'Bob'</span>, <span class="hljs-string">'Fred'</span>];</div></pre></td></tr></table></figure>
<p>Above we have a StringArray interface that has an index signature. This index signature states that when a StringArray is indexed with a number, it will return a string.</p>
<p>There are two types of supported index signature: string an number. It is possible to support both types of indexer, but the type returned from a numeric indexer must be a subtype of the type returned from the string indexer. This is because when indexing witha  number, javascript will actually convert that to a string before indexing into a object.</p>
<h3 id="Classes"><a href="#Classes" class="headerlink" title="Classes"></a>Classes</h3><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Greeter</span> </span>&#123;</div><div class="line">  greeting: string;</div><div class="line">  <span class="hljs-keyword">constructor</span> (message: string) &#123;</div><div class="line">    <span class="hljs-keyword">this</span>.greeting = message</div><div class="line">  &#125;</div><div class="line">  greet () &#123;</div><div class="line">    <span class="hljs-keyword">return</span> <span class="hljs-string">"Hello, "</span> + <span class="hljs-keyword">this</span>.greeting;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-keyword">let</span> greeter = <span class="hljs-keyword">new</span> Greeter(<span class="hljs-string">'World'</span>)</div></pre></td></tr></table></figure>
<p>This class has three members: a property called <code>greeting</code>, a constructor, and a method <code>greet</code>.</p>
<p>In the last line we construct an instance of the Greeter class using <code>new</code>. This calls into the constructor we defined earlier, creating a new object with the Greeter shape, and running the constructor to initialize it.</p>
<h4 id="Public-Private-and-Protected-Modifiers"><a href="#Public-Private-and-Protected-Modifiers" class="headerlink" title="Public, Private, and Protected Modifiers"></a>Public, Private, and Protected Modifiers</h4><p>Public by default.</p>
<p>When a member is marked <code>private</code>, it cannot be accessed from outside of its containing class.</p>
<p>When comparing types that have <code>private</code> and <code>protected</code> members, TypeScript treats these types differently. For two types to be considered compatible, if one of them has a <code>private</code> member, then the other must have a <code>private</code> member that originated in the same declaration.</p>
<p>The <code>protected</code> modifier acts much like the <code>private</code> modifier with the exectpion the members declared <code>protected</code> can also be accessed by instance of deriving classes.</p>
<p>A constructor may also be marked <code>protected</code>. This means that the class cannot be instantiated outside of its containing class, but can be extended.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span> </span>&#123;</div><div class="line">  protected name: string;</div><div class="line">  protected <span class="hljs-keyword">constructor</span> (theName: string) &#123;</div><div class="line">    <span class="hljs-keyword">this</span>.name = theName</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-comment">// Employee can extend Person</span></div><div class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Employee</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Person</span> </span>&#123;</div><div class="line">  private department: string;</div><div class="line">  <span class="hljs-keyword">constructor</span> (name: string, department: string) &#123;</div><div class="line">    <span class="hljs-keyword">super</span>(name)</div><div class="line">    <span class="hljs-keyword">this</span>.department = department</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-keyword">let</span> howard = <span class="hljs-keyword">new</span> Employee(<span class="hljs-string">'Howard'</span>, <span class="hljs-string">'Sales'</span>)</div><div class="line"><span class="hljs-keyword">let</span> john = <span class="hljs-keyword">new</span> Persno(<span class="hljs-string">'john'</span>) <span class="hljs-comment">// Error, the 'Person' constructor is protceted.</span></div></pre></td></tr></table></figure>
<p>You can make properties readonly by using the <code>readonly</code> keyword. Readonly properties must be initilized at their declaration or in the constructor.</p>
<h4 id="Parameter-Propertes"><a href="#Parameter-Propertes" class="headerlink" title="Parameter Propertes"></a>Parameter Propertes</h4><p><em>Parameter Properties</em> let you create and initialize a member in one place.</p>
<h4 id="Accessors"><a href="#Accessors" class="headerlink" title="Accessors"></a>Accessors</h4><p>TypeScript supports <strong>getter/setters</strong> as a way of intercepting accesses to a member of an object. This gives you a way of having finer-grained control over how a member is accessed on each object.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">let</span> passcode = <span class="hljs-string">'secret passcode'</span></div><div class="line"></div><div class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Employee</span> </span>&#123;</div><div class="line">  private _fullName: string;</div><div class="line">  get fullName(): string &#123;</div><div class="line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._fullName</div><div class="line">  &#125;</div><div class="line">  set fullName (newName: string) &#123;</div><div class="line">    <span class="hljs-keyword">if</span> (passcode &amp;&amp; passcode === <span class="hljs-string">'secret passcode'</span>) &#123;</div><div class="line">      <span class="hljs-keyword">this</span>._fullName = newName</div><div class="line">    &#125; <span class="hljs-keyword">else</span> &#123;</div><div class="line">      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Error: Unauthorized update of employee'</span>)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Accessors with a get and no set are automatically inferred to be <code>readonly</code>.</p>
<h3 id="Static-Properties"><a href="#Static-Properties" class="headerlink" title="Static Properties"></a>Static Properties</h3><p>Static Members of a class are those visible on class itself rather than on the instance.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Grid</span> </span>&#123;</div><div class="line">  <span class="hljs-keyword">static</span> origin = &#123;<span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>&#125;</div><div class="line">  calculatedDistanceFromOrigin(point: &#123; <span class="hljs-attr">x</span>:number, <span class="hljs-attr">y</span>: number &#125;) &#123;</div><div class="line">    <span class="hljs-keyword">let</span> xDist = (point.x - Grid.origin.x)</div><div class="line">    <span class="hljs-keyword">let</span> yDist = (point.y - Grid.origin.y)</div><div class="line">    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Math</span>.sqrt(xDist * xDist + yDist * yDist) / <span class="hljs-keyword">this</span>.scale</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="hljs-keyword">constructor</span> (public scale: number) &#123;</div><div class="line">    <span class="hljs-comment">// ...</span></div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-keyword">let</span> grid1 = <span class="hljs-keyword">new</span> Grid(<span class="hljs-number">1.0</span>)</div><div class="line"><span class="hljs-keyword">let</span> grid2 = <span class="hljs-keyword">new</span> Grid(<span class="hljs-number">5.0</span>)</div></pre></td></tr></table></figure>
<h3 id="Abstract-Classes"><a href="#Abstract-Classes" class="headerlink" title="Abstract Classes"></a>Abstract Classes</h3><p>Abstract Classes are base classes from which other classes may be derived. They may not be instantiated directly. Unlike an interface, an abstract class may contain implementation details for its members. The <code>abstract</code> keyword is used to define abstract classes as well as abstract methods within an abstract class.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">abstract <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Animal</span> </span>&#123;</div><div class="line">  abstract makeSound(): <span class="hljs-keyword">void</span>;</div><div class="line">   move () : <span class="hljs-keyword">void</span> &#123;</div><div class="line">     <span class="hljs-built_in">console</span>.log &#123;<span class="hljs-string">'roaming the earth...'</span>&#125;</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Methods within an abstract class that are marked as abstract do not contain an implementation and must be implemented in derived classes. Abstract methods share a similar syntax to interface methods. Both define the signature of a method without including a method body. However, abstract methods must include the <code>abstract</code> keyword and may optionally include access modifier.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">abstract <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Department</span> </span>&#123;</div><div class="line">  <span class="hljs-keyword">constructor</span> (public name: string) &#123;</div><div class="line">    <span class="hljs-comment">// ...</span></div><div class="line">  &#125;</div><div class="line"></div><div class="line">  printName () : <span class="hljs-keyword">void</span> &#123;</div><div class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Department name: '</span> + <span class="hljs-keyword">this</span>.name)</div><div class="line">  &#125;</div><div class="line">  abstract printMeeting (): <span class="hljs-keyword">void</span> <span class="hljs-comment">// must be implemented in derived classes</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AccountingDepartment</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Department</span> </span>&#123;</div><div class="line">  <span class="hljs-keyword">constructor</span> () &#123;</div><div class="line">    <span class="hljs-keyword">super</span>(<span class="hljs-string">'Accounting and Auditing'</span>)</div><div class="line">  &#125;</div><div class="line">  printMeeting () : <span class="hljs-keyword">void</span> &#123;</div><div class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'The Accounting Department meets each Monday at 10am'</span>)</div><div class="line">  &#125;</div><div class="line">  generateReports () : <span class="hljs-keyword">void</span> &#123;</div><div class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Generating accounting reports...'</span>)</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-keyword">let</span> department: Department; <span class="hljs-comment">// ok to create a reference to an abstract type</span></div><div class="line">department = <span class="hljs-keyword">new</span> Department(); <span class="hljs-comment">// error: cannot create an instance of an abstract class</span></div><div class="line">department = <span class="hljs-keyword">new</span> AccountingDepartment(); <span class="hljs-comment">// ok to create and assign a non-abstract subclass</span></div><div class="line">department.printName()</div><div class="line">department.printMeeting()</div><div class="line">department.generateReports()</div></pre></td></tr></table></figure>
<h3 id="Advanced-Techniques"><a href="#Advanced-Techniques" class="headerlink" title="Advanced Techniques"></a>Advanced Techniques</h3><h4 id="Constructor-functions"><a href="#Constructor-functions" class="headerlink" title="Constructor functions"></a>Constructor functions</h4><p>When you declare a class in TypeScript, you are actually creating multiple delcaration at the same time. The first is the type of the <code>instance</code> of the class</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Greeter</span> </span>&#123;</div><div class="line">  greeting: string;</div><div class="line">  <span class="hljs-keyword">constructor</span> (message: string) &#123;</div><div class="line">    <span class="hljs-keyword">this</span>.greeting = message</div><div class="line">  &#125;</div><div class="line">  greet () &#123;</div><div class="line">    <span class="hljs-keyword">return</span> <span class="hljs-string">'Hello, '</span> + <span class="hljs-keyword">this</span>.message</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-keyword">let</span> greeter: Greeter</div><div class="line">greeter = <span class="hljs-keyword">new</span> Greeter(<span class="hljs-string">'world'</span>)</div><div class="line"><span class="hljs-built_in">console</span>.log(greeter.greet())</div></pre></td></tr></table></figure>
<p>Here, when we say <code>let greeter: Greeter</code> we’re using <code>Greeter</code> as the type of instance of the class <code>Greeter</code>. This is almost second nature to programmers from other oo language.</p>
<p>We’re also creating another value that we call the <code>constructor function</code>. This is the function that is called when we <code>new</code> up instance of the class. To see what this looks in practice, let’s take a look at the JavaScript created the above example:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">let</span> Greeter = (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;</div><div class="line">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Greeter</span>(<span class="hljs-params">message</span>) </span>&#123;</div><div class="line">    <span class="hljs-keyword">this</span>.greeting = message</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  Greeter.prototype.greet = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;</div><div class="line">    <span class="hljs-keyword">return</span> <span class="hljs-string">'Hello, '</span> + <span class="hljs-keyword">this</span>.greeting</div><div class="line">  &#125;</div><div class="line">  <span class="hljs-keyword">return</span> Greeter</div><div class="line">&#125;)()</div><div class="line"></div><div class="line"><span class="hljs-keyword">let</span> greeter</div><div class="line">greeter = <span class="hljs-keyword">new</span> Greeter(<span class="hljs-string">'world'</span>)</div><div class="line"><span class="hljs-built_in">console</span>.log(greeter.greet())</div></pre></td></tr></table></figure>
<p>Here <code>let Greeter</code> is going to be assigned the constructor function. When we call <code>new</code> and run this function, we get an instance of the class. The constructor function also contains all of the static members of the class. Another way to think of each class is that there is an <em>instance</em> side and a <em>static</em> side.</p>
<h4 id="Using-a-class-as-an-interface"><a href="#Using-a-class-as-an-interface" class="headerlink" title="Using a class as an interface"></a>Using a class as an interface</h4><p>As mentioned above, a class declaration creates two things: a type representing instances of the class, and a constructor function. Because classes creates types, you can use them in the same places you would be able to use interfaces:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Point</span> </span>&#123;</div><div class="line">  x: number;</div><div class="line">  y: number;</div><div class="line">&#125;</div><div class="line"></div><div class="line">interface Point3D extends Point &#123;</div><div class="line">  <span class="hljs-attr">z</span>: number;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-keyword">let</span> point3d: Point3D = &#123;</div><div class="line">  <span class="hljs-attr">x</span>: <span class="hljs-number">1</span>,</div><div class="line">  <span class="hljs-attr">y</span>: <span class="hljs-number">2</span>,</div><div class="line">  <span class="hljs-attr">z</span>: <span class="hljs-number">3</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Inheritance"><a href="#Inheritance" class="headerlink" title="Inheritance"></a>Inheritance</h3><p>In TypeScript, we can use common object-orientad pattern. Of course, one of the most fundamental patterns in class-based programming is being able to extend existing classes to create new ones using inheritance.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Animal</span> </span>&#123;</div><div class="line">  name: string;</div><div class="line">  <span class="hljs-keyword">constructor</span> (theName: string) &#123;</div><div class="line">    <span class="hljs-keyword">this</span>.name = theName</div><div class="line">  &#125;</div><div class="line">  move (distanceInMeters: number = <span class="hljs-number">0</span>) &#123;</div><div class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-keyword">this</span>.name&#125;</span> move <span class="hljs-subst">$&#123;distanceInMeters&#125;</span>`</span>)</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Snake</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Animal</span> </span>&#123;</div><div class="line">  <span class="hljs-keyword">constructor</span> (name: string) &#123;</div><div class="line">    <span class="hljs-keyword">super</span>(name)</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  move (distanceInMeters = <span class="hljs-number">5</span>) &#123;</div><div class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Slithering...'</span>)</div><div class="line">    <span class="hljs-keyword">super</span>.move(distanceInMeters)</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Horse</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Animal</span> </span>&#123;</div><div class="line">  <span class="hljs-keyword">constructor</span> (name: string) &#123;</div><div class="line">    <span class="hljs-keyword">super</span>(name)</div><div class="line">  &#125;</div><div class="line">  move (distanceInMeters = <span class="hljs-number">45</span>) &#123;</div><div class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Galloping...'</span>)</div><div class="line">    <span class="hljs-keyword">super</span>.move(distanceInMeters)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Derived classes that contain constructor functions must call <code>super()</code> which will execute the constructor function on the base class.</p>
<h4 id="Interfaces-Extending-Classes"><a href="#Interfaces-Extending-Classes" class="headerlink" title="Interfaces Extending Classes"></a>Interfaces Extending Classes</h4><p>When an interface type extends a class type it inherits the memembers of the class but not their implementations. <strong>It is as if the interface had declared all of the members of the class without providing an implementation.</strong> Interface inherit event the private and protected members of a base class. This means that when you create an interface that extends a class with private or protected memebrs, that interface type can only be implemented by the class or a subclass of it.</p>
<p>This is useful when you have a large inheritance hierarchy, but want to specify that you code works iwth only subclasses that have certain properties. The subclasses don’t have to be related besides inheriting from the base class.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Control</span> </span>&#123;</div><div class="line">  private state: any;</div><div class="line">&#125;</div><div class="line"></div><div class="line">interface SelectableControl extends Control &#123;</div><div class="line">  select () : <span class="hljs-keyword">void</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Button</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Control</span> </span>&#123;</div><div class="line">  select () &#123;&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TextBox</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Control</span> </span>&#123;</div><div class="line">  select () &#123;&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Image</span> </span>&#123;</div><div class="line">  select () &#123;&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Location</span> </span>&#123;</div><div class="line">  select () &#123;&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>In the above example, <code>SelectableControl</code> contains all of the members of Control, including the <code>private state</code> property. Since <code>state</code> is a private member it is only possible for descendants of Control to implement <code>SelectableControl</code>. This is because only descendants of Control will have a <code>state</code> private member that originates in the same declaration, which is a requirement for private members to be compatible.</p>
<p>Within the <code>Control</code> class it is possible to access the <code>state</code> private member through an instance of <code>SelectableControl</code>. Effectively, a <code>SelectableControl</code> acts like a <code>Control</code> that is known to have a <code>select</code> method. The <code>Button</code> and <code>TextBox</code> classes are subtypes of <code>SelectableControl</code>, but <code>Image</code> and <code>Location</code> are not.</p>
<h3 id="Type-Compatibility"><a href="#Type-Compatibility" class="headerlink" title="Type Compatibility"></a>Type Compatibility</h3><p>Type compatibility in TypeScript is based on structural subtyping. Structural typing is a way of relating types based on solely on their members. This is in contrast with normal typing.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">interface Named &#123;</div><div class="line">  <span class="hljs-attr">name</span>: string;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span> </span>&#123;</div><div class="line">  name: string;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-keyword">let</span> p: Named;</div><div class="line"></div><div class="line"><span class="hljs-comment">// OK, because of structural typing</span></div><div class="line">p = <span class="hljs-keyword">new</span> Person()</div></pre></td></tr></table></figure>
<p>A basic rule for TypeScript’s structural type system is that x is compatible with y if y has at least the same members as x.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">interface Named &#123;</div><div class="line">  <span class="hljs-attr">name</span>: string;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-keyword">let</span> x: Named;</div><div class="line"></div><div class="line"><span class="hljs-comment">// y's inferred type is &#123; name: string; location: string; &#125;</span></div><div class="line"><span class="hljs-keyword">let</span> y = &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span>, <span class="hljs-attr">location</span>: <span class="hljs-string">'Seattle'</span> &#125;</div><div class="line">x = y</div></pre></td></tr></table></figure>
<h4 id="Comparing-Two-Functions"><a href="#Comparing-Two-Functions" class="headerlink" title="Comparing Two Functions"></a>Comparing Two Functions</h4><p>While comparing primitive types and object types is relatively straightforward, the question of what kinds of functions should be considered compatible is a bit more involved.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">let</span> x = <span class="hljs-function">(<span class="hljs-params">a: number</span>) =&gt;</span> <span class="hljs-number">0</span>;</div><div class="line"><span class="hljs-keyword">let</span> y = <span class="hljs-function">(<span class="hljs-params">b: number, s: string</span>) =&gt;</span> <span class="hljs-number">0</span>;</div><div class="line"></div><div class="line">y = x <span class="hljs-comment">// ok</span></div><div class="line">x = y <span class="hljs-comment">// Error</span></div></pre></td></tr></table></figure>
<p>To check if x is assignable to y, we first look at the parameter list. Each parameter in x must have a corresponding parameter in y with a compatible type. Note that the name of the parameters are not considered, only their types. In this case, every parameter of x has a corresponding compatible parameter in y, so x is assignable to y.</p>
<p>To ensure that every parameter in x can be checked in y.</p>
<h4 id="Enums"><a href="#Enums" class="headerlink" title="Enums"></a>Enums</h4><p>Enums are compatible with numbers, and numers are compatible with enums.</p>
<p>Enum values from different enum types are considered incompatible.</p>
<h4 id="Classes-1"><a href="#Classes-1" class="headerlink" title="Classes"></a>Classes</h4><p>Classes work similarly to object literal types and interfaces with one exception: they have both a static and an instance type. When comparing two objects of a class type, only members of the instance are compared. Static memebrs and constructor do not affect compatibility.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Animal</span> </span>&#123;</div><div class="line">  feet: number;</div><div class="line">  <span class="hljs-keyword">constructor</span> (name: string, numFeet: number) &#123;</div><div class="line"></div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Size</span> </span>&#123;</div><div class="line">  feet: number;</div><div class="line">  <span class="hljs-keyword">constructor</span> (numFeet: number) &#123;</div><div class="line"></div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-keyword">let</span> a: Animal</div><div class="line"><span class="hljs-keyword">let</span> s: Size</div><div class="line"></div><div class="line">a = s <span class="hljs-comment">// ok</span></div><div class="line">s = a <span class="hljs-comment">// ok</span></div></pre></td></tr></table></figure>
<p>Private and protected members in a class affect their compatibility. When an instance of a class is checked for compatibility, if the target type contains a private member, then the source type must also contain a private member that originated from the same class.</p>
<h4 id="Contextual-Type"><a href="#Contextual-Type" class="headerlink" title="Contextual Type"></a>Contextual Type</h4><p>Type inference also work in ‘the other direction’ in some cases in TypeScript. This is known as ‘contextual typing’. Contextual typing occurs when the type of an expression is implied by its location.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-built_in">window</span>.onmousedown = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">mouseEvent</span>) </span>&#123;</div><div class="line">  <span class="hljs-built_in">console</span>.log(mouseEvent.buton) <span class="hljs-comment">// &lt;- Error</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Functions-and-function-Types"><a href="#Functions-and-function-Types" class="headerlink" title="Functions and function Types"></a>Functions and function Types</h3><p>TypeScript functions can be created both as a named function or as an anonymous function. This allows you to choose the most appropriate approach for your application, whether you’re building a list of functions in an API or a one-off function to hand off to another function.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// Named Function</span></div><div class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add</span>(<span class="hljs-params">x, y</span>) </span>&#123;</div><div class="line">  <span class="hljs-keyword">return</span> x + y</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-comment">// Anonymouse Function</span></div><div class="line"><span class="hljs-keyword">let</span> myAdd = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x, y</span>) </span>&#123; <span class="hljs-keyword">return</span> x + y &#125;</div></pre></td></tr></table></figure>
<h4 id="Function-Types-1"><a href="#Function-Types-1" class="headerlink" title="Function Types"></a>Function Types</h4><p>Typing the function.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add</span>(<span class="hljs-params">x: number, y: number</span>): <span class="hljs-title">number</span> </span>&#123;</div><div class="line">  <span class="hljs-keyword">return</span> x + y</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Writing the function type</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">let</span> myAdd: <span class="hljs-function">(<span class="hljs-params">x: number, y: number</span>) =&gt;</span> number = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">x, y</span>) </span>&#123; <span class="hljs-keyword">return</span> x + y &#125;</div></pre></td></tr></table></figure>
<p>A function’s type has the same two parts: the type of the arguments and the return type. When writing out the whole function type, both parts are required.</p>
<h3 id="Context-and-Scope"><a href="#Context-and-Scope" class="headerlink" title="Context and Scope"></a>Context and Scope</h3><p><code>this</code> and <code>arrow function</code>.</p>
<p>In JavaScript, <strong><code>this</code> is a variable that’s set when a function is called</strong>. This makes it a very powerful and flexible feature, but it comes at the cost of always having to know about the context that a function is executing in.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">let</span> deck = &#123;</div><div class="line">  <span class="hljs-attr">suits</span>: [<span class="hljs-string">'hearts'</span>, <span class="hljs-string">'spades'</span>, <span class="hljs-string">'clubs'</span>, <span class="hljs-string">'diamonds'</span>],</div><div class="line">  <span class="hljs-attr">cards</span>: <span class="hljs-built_in">Array</span>(<span class="hljs-number">52</span>),</div><div class="line">  <span class="hljs-attr">createCardPicker</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;</div><div class="line">    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;</div><div class="line">      <span class="hljs-keyword">let</span> pickedCard = <span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">52</span>)</div><div class="line">      <span class="hljs-keyword">let</span> pickedSuit = <span class="hljs-built_in">Math</span>.floor(pickedCard / <span class="hljs-number">13</span>)</div><div class="line">      <span class="hljs-keyword">return</span> &#123; <span class="hljs-attr">suit</span>: <span class="hljs-keyword">this</span>.suits[pickedSuit], <span class="hljs-attr">card</span>: pickedCard % <span class="hljs-number">13</span> &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Here the function returned by <code>createCardPicker</code> will be called by <code>window</code></p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">let</span> deck &#123;</div><div class="line">  <span class="hljs-attr">suits</span>: [<span class="hljs-string">'hearts'</span>, <span class="hljs-string">'spades'</span>, <span class="hljs-string">'clubs'</span>, <span class="hljs-string">'diamonds'</span>],</div><div class="line">  <span class="hljs-attr">cards</span>: <span class="hljs-built_in">Array</span>(<span class="hljs-number">52</span>),</div><div class="line">  <span class="hljs-attr">createCardPicker</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;</div><div class="line">    <span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> the line below is now an arrow function, which will capture 'this' when then function is declared.</span></div><div class="line">    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</div><div class="line">      <span class="hljs-keyword">let</span> pickedCard = <span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">52</span>)</div><div class="line">      <span class="hljs-keyword">let</span> pickedSuit = <span class="hljs-built_in">Math</span>.floor(pickedCard / <span class="hljs-number">13</span>)</div><div class="line">      <span class="hljs-keyword">return</span> &#123; <span class="hljs-attr">suit</span>: <span class="hljs-keyword">this</span>.suits[pickedSuit], <span class="hljs-attr">card</span>: pickedCard % <span class="hljs-number">13</span> &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Overloads"><a href="#Overloads" class="headerlink" title="Overloads"></a>Overloads</h3><p>JavaScript is inherently a very dynamic language. It’s not uncommon for a single JavaScript function to return different types of objects based on the shape of the arguments passed in.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">let</span> suits = [<span class="hljs-string">'hearts'</span>, <span class="hljs-string">'spades'</span>, <span class="hljs-string">'clubs'</span>, <span class="hljs-string">'diamonds'</span>]</div><div class="line"></div><div class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pickCard</span>(<span class="hljs-params">x</span>): <span class="hljs-title">any</span> </span>&#123;</div><div class="line">  <span class="hljs-comment">// Check to see if we're working with an object/array</span></div><div class="line">  <span class="hljs-comment">// if so, they gave us the deck and we'll pick the card</span></div><div class="line">  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> x == <span class="hljs-string">'object'</span>) &#123;</div><div class="line">    <span class="hljs-keyword">let</span> pickedCard = <span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random() * x.length)</div><div class="line">    <span class="hljs-keyword">return</span> pickedCard</div><div class="line">  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> x === <span class="hljs-string">'number'</span>) &#123;</div><div class="line">    <span class="hljs-keyword">let</span> pickedSuit = <span class="hljs-built_in">Math</span>.floor(x / <span class="hljs-number">13</span>)</div><div class="line">    <span class="hljs-keyword">return</span> &#123; <span class="hljs-attr">suit</span>: suits[pickedSuit], <span class="hljs-attr">card</span>: x % <span class="hljs-number">13</span> &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Here the <code>pickCard</code> function will return two different things based on what the user ahs passed in.</p>
<p>Use overloads.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">let</span> suits = [<span class="hljs-string">'hearts'</span>, <span class="hljs-string">'spades'</span>, <span class="hljs-string">'clubs'</span>, <span class="hljs-string">'diamonds'</span>]</div><div class="line"></div><div class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pickCard</span>(<span class="hljs-params">x: &#123; suit: string, card: number &#125;[]</span>): <span class="hljs-title">number</span></span></div><div class="line"><span class="hljs-title">function</span> <span class="hljs-title">pickCard</span>(<span class="hljs-params">x: number</span>): &#123; suit: string, <span class="hljs-attr">card</span>: number &#125;</div><div class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pickCard</span>(<span class="hljs-params">x</span>): <span class="hljs-title">any</span> </span>&#123;</div><div class="line">  <span class="hljs-comment">// Check to see if we're working with an object/array</span></div><div class="line">  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> x === <span class="hljs-string">'object'</span>) &#123;</div><div class="line">    <span class="hljs-comment">// ...</span></div><div class="line">  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> x === <span class="hljs-string">'number'</span>) &#123;</div><div class="line">    <span class="hljs-comment">// ...</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Note that the <code>function pickCard(x): any</code> is not part of the overload list.</p>
<h3 id="Namespaces"><a href="#Namespaces" class="headerlink" title="Namespaces"></a>Namespaces</h3><p>Namespaces are used as a way to organize the code so that you can keep track of your types and not worry about name collisions with other object. Instead of putting lots of different names into the global namespace, you can wrap up your object into a namespace. The choice of what objects go in what namespaces is totally up to your organization preference.</p>
<p>If you want the interfaces and classes in your namespaces to be visible outside the namespace, you need to preface their declaration with <code>export</code> keyword.</p>
<p>Also keep in mind that classes, interfaces and variable names within a namespace has to be unique.</p>
<h4 id="Multi-file-namespaces"><a href="#Multi-file-namespaces" class="headerlink" title="Multi-file namespaces"></a>Multi-file namespaces</h4><p>You can split a namespace across many files, even though the fiels a separate, they can each contribute to the same namespace and can be consumed as if they were all defined in one place. Because there are dependencies between files. you will add <code>reference</code> tags to tell the compiler about the relationship between the files.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// ZooAnimals.ts</span></div><div class="line"></div><div class="line">namespace Zoo &#123;</div><div class="line">  interface Animal &#123;</div><div class="line">    <span class="hljs-comment">//<span class="hljs-doctag">NOTE:</span> we do not need the 'export' here since this interface will only be accessible by enttites from within the Zoo namespace.</span></div><div class="line">    skinType: string;</div><div class="line">    isMammal() : boolean;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-comment">// ZooWild.ts</span></div><div class="line"><span class="hljs-comment">/// &lt;reference path="ZooAnimals.ts" /&gt;</span></div><div class="line">namespace Zoo &#123;</div><div class="line">  <span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Reptile</span> <span class="hljs-title">implements</span> <span class="hljs-title">Animal</span> </span>&#123;</div><div class="line">    <span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> we need the 'export' here to be able to access this class and instantiate objects of the Reptile type</span></div><div class="line">    skinType: <span class="hljs-string">'scales'</span>;</div><div class="line">    isMammal () &#123;</div><div class="line">      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-comment">// ZooBirds.ts</span></div><div class="line"><span class="hljs-comment">/// &lt;reference path="ZooAnimals.ts" /&gt;</span></div><div class="line">namespace Zoo &#123;jkj</div><div class="line">  <span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Bird</span> <span class="hljs-title">implements</span> <span class="hljs-title">Animal</span> </span>&#123;</div><div class="line">    skinType: <span class="hljs-string">'feather'</span></div><div class="line">    isMammal () &#123;</div><div class="line">      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Once there are multiple fiels involved, we’ll need to make sure all of the compiled code gets loaded, we can use concatenated output using the <code>--outFile</code> flag to compile all of the input files into a single JavaScript output file.</p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tsc --outFile zoo.js ZooAnimal.ts ZooWild.ts ZooBirds.ts</div></pre></td></tr></table></figure>
<h4 id="Referencing-namespacing-entities-in-your-code"><a href="#Referencing-namespacing-entities-in-your-code" class="headerlink" title="Referencing namespacing entities in your code"></a>Referencing namespacing entities in your code</h4><p>Namespaces can be accessed either in the same file where the namespace is defined or another .ts file. The only control on access is whether you are using the <code>export</code> keyword or not for the namespace entities.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">let</span> parrot = <span class="hljs-keyword">new</span> Zoo.Bird();</div></pre></td></tr></table></figure>
<h4 id="Aliases"><a href="#Aliases" class="headerlink" title="Aliases"></a>Aliases</h4><p>You can simplify working with namespaces by using Aliases. You can use <code>import q = x.y.z</code> to create shorter names for commonly-used objects.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">import</span> rep = Zoo.Reptitle;</div><div class="line"></div><div class="line"><span class="hljs-keyword">let</span> lizard: rep;</div></pre></td></tr></table></figure>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-10T12:05:02.000Z">2017-08-10</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    a few seconds read (About 92 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/10/Build-GraphQL-Server-with-Koa/">Build GraphQL Server With Koa</a>
            
        </h1>
        <div class="content">
            <p>Here is the example <a href="http://ezcook.de/2017/08/07/Build-GraphQL-Server-with-Express/" target="_blank" rel="noopener">Build GraphQL Server with Express</a></p>
<p>The only difference from that example is the way plugining middleware.</p>
<p>In <code>server.js</code> of Koa:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> Koa <span class="hljs-keyword">from</span> <span class="hljs-string">'koa'</span></div><div class="line"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> GraphqlHTTP <span class="hljs-keyword">from</span> <span class="hljs-string">'koa-graphql'</span></div><div class="line"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> Router <span class="hljs-keyword">from</span> <span class="hljs-string">'koa-router'</span></div><div class="line"><span class="hljs-keyword">import</span> Schema <span class="hljs-keyword">from</span> <span class="hljs-string">'./schema'</span></div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> PORT = <span class="hljs-number">3457</span></div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> Koa()</div><div class="line"><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> Router()</div><div class="line">router.all(<span class="hljs-string">'/graphql'</span>, GraphqlHTTP(&#123;</div><div class="line">  <span class="hljs-attr">schema</span>: Schema,</div><div class="line">  <span class="hljs-attr">pretty</span>: <span class="hljs-literal">true</span>,</div><div class="line">  <span class="hljs-attr">graphiql</span>: <span class="hljs-literal">true</span>,</div><div class="line">&#125;))</div><div class="line"></div><div class="line">app.use(router.routes()).use(router.allowedMethods())</div><div class="line"></div><div class="line">app.listen(PORT, () =&gt; &#123;</div><div class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'server is running at: '</span> + PORT)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-10T12:04:12.000Z">2017-08-10</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    a few seconds read (About 0 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/10/Build-GraphQL-Server-with-Express-1/">Build GraphQL Server With Express</a>
            
        </h1>
        <div class="content">
            
        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-09T05:59:40.000Z">2017-08-09</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    7 minutes read (About 1011 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/09/History-API/">History API</a>
            
        </h1>
        <div class="content">
            <p>The DOM window object provides access to the browser’s history through the <code>history</code> object.</p>
<h3 id="Moving-Forward-and-Backward"><a href="#Moving-Forward-and-Backward" class="headerlink" title="Moving Forward and Backward"></a>Moving Forward and Backward</h3><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-built_in">window</span>.history.back()</div><div class="line"><span class="hljs-built_in">window</span>.history.forward()</div></pre></td></tr></table></figure>
<h3 id="Moving-to-a-specific-point-in-history"><a href="#Moving-to-a-specific-point-in-history" class="headerlink" title="Moving to a specific point in history"></a>Moving to a specific point in history</h3><p>You can use the <code>go()</code> method to load a specific page from session history, identified by its relative position to the current page.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-built_in">window</span>.history.go(<span class="hljs-number">-1</span>)</div><div class="line"><span class="hljs-built_in">window</span>.history.go(<span class="hljs-number">1</span>)</div></pre></td></tr></table></figure>
<p>You can determine the number of pages in the history stack by looking at the value of the length property:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">var</span> numberOfEntries = <span class="hljs-built_in">window</span>.history.length</div></pre></td></tr></table></figure>
<h3 id="Adding-and-Modifying-History-Entries"><a href="#Adding-and-Modifying-History-Entries" class="headerlink" title="Adding and Modifying History Entries"></a>Adding and Modifying History Entries</h3><p><code>history.pushState()</code> and <code>history.replaceState()</code> methods work in conjunction with the <code>window.onpopstate</code> event.</p>
<p>Using <code>history.pushState()</code> changes the referrer that gets used in the HTTP header for <code>XMLHttpRequest</code> objects created after you change the state. The referrer will be the URL of the document whose window is this at the time of creation of the <code>XMLHttpRequest</code> object.</p>
<h4 id="Example-of-pushState-Method"><a href="#Example-of-pushState-Method" class="headerlink" title="Example of pushState() Method"></a>Example of pushState() Method</h4><p>Suppose <a href="http://mozilla.org/foo.html" target="_blank" rel="noopener">http://mozilla.org/foo.html</a> executes the following JS.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// history.pushState(StateObj, title, URL)</span></div><div class="line"><span class="hljs-keyword">var</span> stateObj = &#123; <span class="hljs-attr">foo</span>: <span class="hljs-string">'bar'</span> &#125;</div><div class="line">history.pushState(&#123; stateObj, <span class="hljs-string">'page 2'</span>, <span class="hljs-string">'bar.html'</span> &#125;)</div></pre></td></tr></table></figure>
<p>This will cause the URL bar to display <a href="http://mozilla.org/bar.html" target="_blank" rel="noopener">http://mozilla.org/bar.html</a>, but won’t cause the browser to load <code>bar.html</code> or even check that <code>bar.html</code> exists.</p>
<p>Suppose now that the user now navigates to <a href="http://google.com" target="_blank" rel="noopener">http://google.com</a>, then click back. At this point, the URL bar will display <a href="http://mozilla.org/bar.html" target="_blank" rel="noopener">http://mozilla.org/bar.html</a>, and the page will get a <code>popstate</code> event whose <code>state object</code> contains a copy of <code>stateObj</code>.</p>
<p>If we click back again, the URL change to <a href="http://mozilla.org/foo.html" target="_blank" rel="noopener">http://mozilla.org/foo.html</a>, and the document will get another <code>popstate</code> event, this time with a null state object.(which is different from replaceState).</p>
<h4 id="The-pushState-method"><a href="#The-pushState-method" class="headerlink" title="The pushState() method"></a>The pushState() method</h4><p><code>pushState()</code> takes three arguments: a state object, a title(which is currently ignored), and (optionally) a URL.</p>
<ul>
<li><code>state object</code> - The state object is a javascript object which is associated with the new history entry created by <code>pushState</code>. Whenever the user navigates to the new state, a <code>popstate</code> event is fired, and the state property of the event contains a copy of the history entry’s state object.</li>
</ul>
<p>The state object can be anything that can be serialized. Because Firefox saves the state objects to the user’s disk so they can be restored after the user restarts the browser, we impose a size limit of 640k characters on the serialized representation of a state object. If you pass a state object whose serialized representation is larger than this to <code>pushState()</code>, the method will throw an exception. If you need more space than this, you’re encouraged to use <code>sessionStorage</code> and/or <code>localStorage</code>.</p>
<ul>
<li><p><code>title</code> - Firefox currently ingores this parameter, although it may use it in the future. Passing the empty string here should be safe against future changes to the method.</p>
</li>
<li><p><code>URL</code> - The new history entry’s URL is given by this parameter. Note that the browser won’t attempt to load this URL after a call to <code>pushState()</code>, but it might attempt to load the URL later, for instance after the user restarts the browser. The new URL does not need to be absolute; if it’s relative, it’s resolved to the current URL. The new URL must be of the same origin as the current URL; otherwise <code>pushState</code> will throw an exception. The parameter is optional, if it isn’t specified, it’s set to the document’s current URL.</p>
</li>
</ul>
<p>In a sense, calling <code>pushState()</code> is similar to setting <code>window.location = &#39;#foo&#39;</code>, in that both will create and activate another history entry associated with the current document, but <code>pushState</code> has a few advantages:</p>
<ul>
<li><p>The new URL can be any URL in the same origin as the current URL. In contrast, setting <code>window.location</code> keeps you at the same document only if you modify only the hash</p>
</li>
<li><p>You don’t have to change the URL if you don’t want to. In contrast, setting <code>window.location = &#39;#foo&#39;</code> only creates a new history entry if the current hash isn’t <code>#hash</code></p>
</li>
<li><p>You can associate arbitrary data with your new history entry. With the hash-based approach, you need to encode all of the relevant data int o a short string.</p>
</li>
</ul>
<h4 id="The-replaceState-method"><a href="#The-replaceState-method" class="headerlink" title="The replaceState() method"></a>The replaceState() method</h4><p><code>history.replaceState()</code> operates exactly like <code>history.pushState()</code> except the <code>replaceState()</code> modifies the current history entry instead of creating a new one. Note that this doesn’t prevent the creation of a new entry in the global browser history.</p>
<p><code>replaceState()</code> is particularly useful when you want to upate the state object or URL of the current history entry in reponse to some user action.</p>
<h4 id="Example-of-replaceState-method"><a href="#Example-of-replaceState-method" class="headerlink" title="Example of replaceState() method"></a>Example of replaceState() method</h4><p>Suppose <a href="http://mozilla.org/foo.html" target="_blank" rel="noopener">http://mozilla.org/foo.html</a> executes the following JS:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">var</span> stateObj = &#123; <span class="hljs-attr">foo</span>: <span class="hljs-string">'bar'</span> &#125;</div><div class="line">history.replaceState(stateObj, <span class="hljs-string">'page 2'</span>, <span class="hljs-string">'bar.htmk'</span>)</div></pre></td></tr></table></figure>
<p>This will cause the URL bar to display <a href="http://mozilla.org/bar.html" target="_blank" rel="noopener">http://mozilla.org/bar.html</a>, but won’t cause the browser to load bar.html or even check that bar.html exists.</p>
<p>Suppose now that the user navigates to <a href="http://www.microsoft.com" target="_blank" rel="noopener">http://www.microsoft.com</a>, then clicks back. At this point, the URL bar will display <a href="http://mozilla.org/bar.html" target="_blank" rel="noopener">http://mozilla.org/bar.html</a>.</p>
<p>If you click back again, you will be nagivated to the page before foo.html. (which is different from pushState())</p>
<h3 id="The-popstate-event"><a href="#The-popstate-event" class="headerlink" title="The popstate event"></a>The popstate event</h3><p>A popstate event is dispatched to the <code>window</code> every time the active history entry changes. If the history entry being activated was created by a call to <code>pushState</code> or affected by <code>replaceState</code>, the <code>popstate</code> event’s <code>state</code> property contains a copy of the history entry’s state object.</p>
<h3 id="Reading-the-current-state"><a href="#Reading-the-current-state" class="headerlink" title="Reading the current state"></a>Reading the current state</h3><p>When your page loads, it might have a non-null state object. This can be happen, for example, if the page sets a state object(by <code>pushState</code>, or <code>replaceState</code>) and then the user restarts their browser. When your page reloads, the page will receive an <code>onload</code> event, but no <code>popstate</code> event. However if you read the <code>history.state</code> property, you’ll get back the state object you would have to gotten if a <code>popstate</code> had fired.</p>
<p>You can read it directly:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">const</span> currentState = history.state</div></pre></td></tr></table></figure>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-07T08:19:06.000Z">2017-08-07</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    12 minutes read (About 1751 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/07/Note-on-Sequelize/">Note on Sequelize</a>
            
        </h1>
        <div class="content">
            <p>Sequelize is a promise-based ORM for Node.</p>
<h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">const</span> Sequelize = <span class="hljs-built_in">require</span>(<span class="hljs-string">'sequelize'</span>)</div><div class="line"><span class="hljs-keyword">const</span> sequelize = <span class="hljs-keyword">new</span> Sequeslize(<span class="hljs-string">'database'</span>, <span class="hljs-string">'username'</span>, <span class="hljs-string">'password'</span>)</div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> User = sequelize.define(<span class="hljs-string">'user'</span>, &#123;</div><div class="line">  <span class="hljs-attr">username</span>: Sequelize.STRING,</div><div class="line">  <span class="hljs-attr">birthday</span>: Sequelize.DATE,</div><div class="line">&#125;)</div><div class="line"></div><div class="line">sequelize.sync().then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</div><div class="line">  User.create(&#123;</div><div class="line">    <span class="hljs-attr">username</span>: <span class="hljs-string">'Jane'</span>,</div><div class="line">    <span class="hljs-attr">birthday</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-number">1980</span>, <span class="hljs-number">5</span>, <span class="hljs-number">2</span>),</div><div class="line">  &#125;)</div><div class="line">&#125;).then(<span class="hljs-function"><span class="hljs-params">jane</span> =&gt;</span> &#123;</div><div class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'create successfully'</span>)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="Start"><a href="#Start" class="headerlink" title="Start"></a>Start</h3><h4 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h4><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">yarn add sequelize</div><div class="line"><span class="hljs-comment"># add one of the following:</span></div><div class="line">yarn add pg pg-hstore</div><div class="line">yarn add mysql2</div><div class="line">yarn add sqlite3</div><div class="line">yarn add tedious // MSSQL</div></pre></td></tr></table></figure>
<h4 id="Setup-a-connection"><a href="#Setup-a-connection" class="headerlink" title="Setup a connection"></a>Setup a connection</h4><p>Sequelize will setup a connection pool on initialization so you should ideally only ever create one instance per database if you’re connecting to the DB from a single process. If you’re connecting to the DB from multiple processes, you’ll have to create one instance per process, but each instance should have a maximum connection pool size of “max connection pool size divided by number of instances”. So, if you wanted a max connection pool size of 90 and you have 3 worker process, each process’s instance should have a max connection pool size of 30.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">const</span> Conn = <span class="hljs-keyword">new</span> Sequelize(<span class="hljs-string">'database'</span>, <span class="hljs-string">'username'</span>, <span class="hljs-string">'password'</span>, &#123;</div><div class="line">  <span class="hljs-attr">host</span>: <span class="hljs-string">'localhost'</span>,</div><div class="line">  <span class="hljs-attr">dialect</span>: <span class="hljs-string">'mysql'</span>|<span class="hljs-string">'sqlite'</span>|<span class="hljs-string">'postgres'</span>|<span class="hljs-string">'mssql'</span>,</div><div class="line">  <span class="hljs-attr">pool</span>: &#123;</div><div class="line">    <span class="hljs-attr">max</span>: <span class="hljs-number">5</span>,</div><div class="line">    <span class="hljs-attr">min</span>: <span class="hljs-number">0</span>,</div><div class="line">    <span class="hljs-attr">idle</span>: <span class="hljs-number">10000</span>,</div><div class="line">  &#125;,</div><div class="line">  <span class="hljs-attr">storage</span>: <span class="hljs-string">'path/to/database.sqlite'</span>,</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="hljs-comment">// or you can simply use a connection uri</span></div><div class="line"><span class="hljs-keyword">const</span> Conn = <span class="hljs-keyword">new</span> Sequelize(<span class="hljs-string">'postgres://user:pass@example.com:5432/dbname'</span>)</div></pre></td></tr></table></figure>
<h4 id="Test-the-connection"><a href="#Test-the-connection" class="headerlink" title="Test the connection"></a>Test the connection</h4><p>You can use the <code>.authenticate()</code> function like this to test the connection.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Conn.authenticate().then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</div><div class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Connection has been established successfully'</span>)</div><div class="line">&#125;).catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> &#123;</div><div class="line">  <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'Unable to connect to the database: '</span>, e)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h4 id="Model"><a href="#Model" class="headerlink" title="Model"></a>Model</h4><p>Models are defined with <code>Conn.define(&#39;name&#39;, {attributes}, {options})</code></p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">const</span> User = Conn.define(<span class="hljs-string">'user'</span>, &#123;</div><div class="line">  <span class="hljs-attr">firstName</span>: &#123;</div><div class="line">    <span class="hljs-attr">type</span>: Sequelize.STRING,</div><div class="line">  &#125;,</div><div class="line">  <span class="hljs-attr">lastName</span>: &#123;</div><div class="line">    <span class="hljs-attr">type</span>: Sequelize.STRING,</div><div class="line">  &#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="hljs-comment">// force: true will drop the table if it already exists</span></div><div class="line">User.sync(&#123; <span class="hljs-attr">force</span>: <span class="hljs-literal">true</span> &#125;).then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</div><div class="line">  <span class="hljs-comment">// Table created</span></div><div class="line">  <span class="hljs-keyword">return</span> User.create(&#123;</div><div class="line">    <span class="hljs-attr">firstName</span>: <span class="hljs-string">'John'</span>,</div><div class="line">    <span class="hljs-attr">lastName</span>: <span class="hljs-string">'Hank'</span>,</div><div class="line">  &#125;)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h4 id="Query"><a href="#Query" class="headerlink" title="Query"></a>Query</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">User.findAll().then(<span class="hljs-function"><span class="hljs-params">users</span> =&gt;</span> &#123;</div><div class="line">  <span class="hljs-built_in">console</span>.log(users)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h4 id="Application-wide-model-options"><a href="#Application-wide-model-options" class="headerlink" title="Application wide model options"></a>Application wide model options</h4><p>The Sequelize constructor takes a <code>define</code> option which will be used as the default options for all defined models.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">const</span> Conn = <span class="hljs-keyword">new</span> Sequelize(<span class="hljs-string">'connectionUri'</span>, &#123;</div><div class="line">  <span class="hljs-attr">define</span>: &#123;</div><div class="line">    <span class="hljs-attr">timestamps</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// true by default</span></div><div class="line">  &#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> User = Conn.define(<span class="hljs-string">'user'</span>, &#123;&#125;) <span class="hljs-comment">// timestamps is false by default</span></div><div class="line"><span class="hljs-keyword">const</span> Post = Conn.define(<span class="hljs-string">'post'</span>, &#123;&#125;, &#123;</div><div class="line">  <span class="hljs-attr">timestamps</span>: <span class="hljs-literal">true</span>,</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h4 id="Promises"><a href="#Promises" class="headerlink" title="Promises"></a>Promises</h4><p>Sequelize uses promises to control async control-flow.</p>
<p>Basically, a promise represents a value which will be present at some point.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">user = <span class="hljs-keyword">await</span> User.fineOne()</div><div class="line"><span class="hljs-built_in">console</span>.log(user)</div></pre></td></tr></table></figure>
<h3 id="Model-Definition"><a href="#Model-Definition" class="headerlink" title="Model Definition"></a>Model Definition</h3><p>To define mapping between a model and a table, use the <code>define</code> method. Sequelize will then automatically add the attributes <code>createdAt</code> and <code>updatedAt</code> to it. So you will be able to know when the database entry went into the db and when it was updated the last time.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">const</span> Project = Conn.define(<span class="hljs-string">'project'</span>, &#123;</div><div class="line">  <span class="hljs-attr">title</span>: Sequelize.STRING,</div><div class="line">  <span class="hljs-attr">description</span>: Sequelize.TEXT,</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> Task = Conn.define(<span class="hljs-string">'tastk'</span>, &#123;</div><div class="line">  <span class="hljs-attr">title</span>: Sequelize.STRING,</div><div class="line">  <span class="hljs-attr">description</span>: Sequelize.TEXT,</div><div class="line">  <span class="hljs-attr">deadline</span>: Sequelize.DATE,</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>You can also set some options on each column:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">const</span> Foo = Conn.define(<span class="hljs-string">'foo'</span>, &#123;</div><div class="line">  <span class="hljs-comment">// instantiating will automatically set the flat to true if not set</span></div><div class="line">  flag: &#123;</div><div class="line">    <span class="hljs-attr">type</span>: Sequelize.BOOLEAN,</div><div class="line">    <span class="hljs-attr">allowNull</span>: <span class="hljs-literal">false</span>,</div><div class="line">    <span class="hljs-attr">defaultValue</span>: <span class="hljs-literal">true</span>,</div><div class="line">  &#125;,</div><div class="line">  <span class="hljs-attr">myDate</span>: &#123;</div><div class="line">    <span class="hljs-attr">type</span>: Sequelize.DATE,</div><div class="line">    <span class="hljs-attr">defaultValue</span>: Sequelize.NOW,</div><div class="line">  &#125;,</div><div class="line">  <span class="hljs-attr">title</span>: &#123;</div><div class="line">    <span class="hljs-attr">type</span>: Sequelize.STRING,</div><div class="line">    <span class="hljs-attr">allowNull</span>: <span class="hljs-literal">false</span>,</div><div class="line">  &#125;,</div><div class="line">  <span class="hljs-attr">uniqueOne</span>: &#123;</div><div class="line">    <span class="hljs-attr">type</span>: Sequelize.STRING,</div><div class="line">    <span class="hljs-attr">unique</span>: <span class="hljs-string">'compositeIndex'</span>,</div><div class="line">  &#125;,</div><div class="line">  <span class="hljs-attr">uniqueTwo</span>: &#123;</div><div class="line">    <span class="hljs-attr">type</span>: Sequelize.INTEGER,</div><div class="line">    <span class="hljs-attr">unique</span>: <span class="hljs-string">'compositeIndex'</span>,</div><div class="line">  &#125;,</div><div class="line">  <span class="hljs-attr">foo</span>: &#123;</div><div class="line">    <span class="hljs-attr">type</span>: Sequelize.STRING,</div><div class="line">    <span class="hljs-attr">validate</span>: &#123;</div><div class="line">      <span class="hljs-attr">isEmail</span>: <span class="hljs-literal">true</span>,</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h3><p>You can also influence the way Sequelize hadnles your column names:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">const</span> Bar = Conn.define(<span class="hljs-string">'bar'</span>, &#123;</div><div class="line">  <span class="hljs-comment">/* ... */</span></div><div class="line">&#125;, &#123;</div><div class="line">  <span class="hljs-comment">// don't add the timestamp attributes(updatedAt, createdAt)</span></div><div class="line">  timestamps: <span class="hljs-literal">false</span>,</div><div class="line">  <span class="hljs-comment">// don't delete database entries but set the newly added attribute deletedAt to the current data(when deletion was done)</span></div><div class="line">  paranoid: <span class="hljs-literal">true</span>,</div><div class="line">  <span class="hljs-comment">// don't use camelcase for automatically added attributes but underscore style so updatedAt will be udpated_at</span></div><div class="line">  underscore: <span class="hljs-literal">true</span>,</div><div class="line">  <span class="hljs-comment">// disable the modification of table names; by default, sequelize will automatically transform all passes model names(first parameter of define) into plural. If you don't want that, set the following</span></div><div class="line">  freezeTableName: <span class="hljs-literal">true</span>,</div><div class="line">  <span class="hljs-comment">// define the table's name</span></div><div class="line">  tableName: <span class="hljs-string">'my_very_custom_table_name'</span>,</div><div class="line">  <span class="hljs-comment">// Enable optimistic locking. When enabled, sequelize will add a version count attribute to the model and throw an OptimisticLockingError error when stale instances are saved.</span></div><div class="line">  version: <span class="hljs-literal">true</span>,</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="Import"><a href="#Import" class="headerlink" title="Import"></a>Import</h3><p>You can also store your model definitions in a single file using the <code>import</code> method. The returned object is exactly the same as defined in the imported file’s function.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// in your server file</span></div><div class="line"><span class="hljs-keyword">const</span> Project = Conn.import(__dirname, <span class="hljs-string">"/path/to/models/project"</span>)</div><div class="line"></div><div class="line"><span class="hljs-comment">// The model definition file</span></div><div class="line"><span class="hljs-built_in">module</span>.exports = <span class="hljs-function">(<span class="hljs-params">Conn, DataType</span>) =&gt;</span> &#123;</div><div class="line">  <span class="hljs-keyword">return</span> Conn.define(<span class="hljs-string">'project'</span>, &#123;</div><div class="line">    <span class="hljs-attr">name</span>: DataTypes.STRING,</div><div class="line">    <span class="hljs-attr">description</span>: DataTypes.TEXT,</div><div class="line">  &#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>The <code>import</code> method can also accept a callback as an argument</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Conn.import(<span class="hljs-string">'project'</span>, (Conn, DataTypes) =&gt; &#123;</div><div class="line">  <span class="hljs-keyword">return</span> Conn.define(<span class="hljs-string">'project'</span>, &#123;</div><div class="line">    <span class="hljs-attr">name</span>: DataTypes.STRING,</div><div class="line">    <span class="hljs-attr">description</span>: DataTypes.TEXT,</div><div class="line">  &#125;)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="Database-Synchronization"><a href="#Database-Synchronization" class="headerlink" title="Database Synchronization"></a>Database Synchronization</h3><p>When starting a new project you won’t have a database structure and using sequelize you won’t need to. Just specify your model structures and let the library do the rest. Currently supported is the creation and deletion of tables.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// Create the Tables</span></div><div class="line">Project.sync()</div><div class="line">Task.sync()</div><div class="line"></div><div class="line"><span class="hljs-comment">// Force the Creation</span></div><div class="line">Project.sync(&#123; <span class="hljs-attr">force</span>: <span class="hljs-literal">true</span> &#125;) <span class="hljs-comment">// this will drop the table first and re-create it afterwards</span></div><div class="line"></div><div class="line"><span class="hljs-comment">// Drop the Tables</span></div><div class="line">Project.drop()</div><div class="line">Task.drop()</div><div class="line"></div><div class="line"><span class="hljs-comment">// Event Handling</span></div><div class="line">Project.[sync|drop]().then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</div><div class="line">  <span class="hljs-comment">// ok ... everything is nice</span></div><div class="line">&#125;).catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;</div><div class="line">  <span class="hljs-comment">// ooh, did you enter wrong database credentials</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>Because synchronizing and dropping all of your tables might be a lot of lines to write, you can also let Sequelize do the work for you:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// sync all models that aren't already in the database</span></div><div class="line">Conn.sync()</div><div class="line"></div><div class="line"><span class="hljs-comment">// Force sync all models</span></div><div class="line">Conn.sync(&#123; <span class="hljs-attr">force</span>: <span class="hljs-literal">true</span> &#125;)</div><div class="line"></div><div class="line"><span class="hljs-comment">// Drop all Tables</span></div><div class="line">Conn.drop()</div><div class="line"></div><div class="line"><span class="hljs-comment">// Emit Handling</span></div><div class="line">Conn.[sync|drop]().then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</div><div class="line">  <span class="hljs-comment">// ...</span></div><div class="line">&#125;).catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;</div><div class="line">  <span class="hljs-comment">// ...</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="Expansion-of-models"><a href="#Expansion-of-models" class="headerlink" title="Expansion of models"></a>Expansion of models</h3><p>Sequelize Models are ES6 classes, you can very easily add custom instance or class level methods.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">const</span> User = Conn.define(<span class="hljs-string">'user'</span>, &#123;</div><div class="line">  <span class="hljs-attr">firstName</span>: Sequelize.STRING,</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="hljs-comment">// add a class level method</span></div><div class="line">User.classLevelMethod = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;</div><div class="line">  retunr <span class="hljs-string">'foo'</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-comment">// add an instance level method</span></div><div class="line">User.prototype.instanceLevelMethod = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;</div><div class="line">  retunr <span class="hljs-string">'bar'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Indexes"><a href="#Indexes" class="headerlink" title="Indexes"></a>Indexes</h3><p>Sequelize supports adding indexes to the model definition which will be created during <code>Model.sync()</code> or <code>Conn.sync()</code></p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">Conn.define(<span class="hljs-string">'user'</span>, &#123;&#125;, &#123;</div><div class="line">  <span class="hljs-attr">indexes</span>: [</div><div class="line">    <span class="hljs-comment">// Create a unique index on poem</span></div><div class="line">    &#123;</div><div class="line">      <span class="hljs-attr">unique</span>: <span class="hljs-literal">true</span>,</div><div class="line">      <span class="hljs-attr">fields</span>: [<span class="hljs-string">'poen'</span>]</div><div class="line">    &#125;,</div><div class="line">    <span class="hljs-comment">// create a gin index on data with the jsonb_path_ops operator</span></div><div class="line">    &#123;</div><div class="line">      <span class="hljs-attr">fields</span>: [<span class="hljs-string">'data'</span>],</div><div class="line">      <span class="hljs-attr">using</span>: <span class="hljs-string">'gin'</span>,</div><div class="line">      <span class="hljs-attr">operator</span>: <span class="hljs-string">'jsonb_path_ops'</span>,</div><div class="line">    &#125;,</div><div class="line">    <span class="hljs-comment">// by default index name will be [table]_[fields]</span></div><div class="line">    <span class="hljs-comment">// create a multi column partial index</span></div><div class="line">    &#123;</div><div class="line">      <span class="hljs-attr">name</span>: <span class="hljs-string">'public_by_author'</span>,</div><div class="line">      <span class="hljs-attr">fields</span>: [<span class="hljs-string">'author'</span>, <span class="hljs-string">'status'</span>],</div><div class="line">      <span class="hljs-attr">where</span>: &#123;</div><div class="line">        <span class="hljs-attr">status</span>: <span class="hljs-string">'public'</span></div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  ]</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="Model-Usage"><a href="#Model-Usage" class="headerlink" title="Model Usage"></a>Model Usage</h3><h4 id="Data-Retrieval-Finders"><a href="#Data-Retrieval-Finders" class="headerlink" title="Data Retrieval / Finders"></a>Data Retrieval / Finders</h4><p>Finder methods are intended to query data from the database. They do not return plain objects but instead return <em>model instances</em>. Because finder methods return model instances you can call any model instance member.</p>
<h4 id="find-search-for-one-specific-element-in-the-database"><a href="#find-search-for-one-specific-element-in-the-database" class="headerlink" title="find - search for one specific element in the database"></a>find - search for one specific element in the database</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// search for known id</span></div><div class="line">Project.findById(<span class="hljs-number">123</span>).then(<span class="hljs-function"><span class="hljs-params">project</span> =&gt;</span> &#123;</div><div class="line">  <span class="hljs-comment">// project will be an instance of Project and store the content of the table entry with id 123. If such an entry is not defined you will get null</span></div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="hljs-comment">// search for attributes</span></div><div class="line">Project.findOne(&#123;</div><div class="line">  <span class="hljs-attr">where</span>: &#123;</div><div class="line">    <span class="hljs-attr">title</span>: <span class="hljs-string">'aProject'</span></div><div class="line">  &#125;</div><div class="line">&#125;).then(<span class="hljs-function"><span class="hljs-params">project</span> =&gt;</span> &#123;</div><div class="line">  <span class="hljs-comment">// project will be the first entry of the Projects table with the title 'aProject' || null</span></div><div class="line">&#125;)</div><div class="line"></div><div class="line">Project.findONe(&#123;</div><div class="line">  <span class="hljs-attr">where</span>: &#123;</div><div class="line">    <span class="hljs-attr">title</span>: <span class="hljs-string">'aProject'</span>,</div><div class="line">  &#125;,</div><div class="line">  <span class="hljs-attr">attributes</span>: [<span class="hljs-string">'id'</span>, [<span class="hljs-string">'name'</span>, <span class="hljs-string">'title'</span>]]</div><div class="line">&#125;).then(<span class="hljs-function"><span class="hljs-params">project</span> =&gt;</span> &#123;</div><div class="line">  <span class="hljs-comment">// project will be the first entry of the Projects table with the title 'aProject' || null</span></div><div class="line">  <span class="hljs-comment">// project.title will contain the name of the project</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h4 id="findOrCreate-Search-for-a-specific-element-or-create-it-if-not-available"><a href="#findOrCreate-Search-for-a-specific-element-or-create-it-if-not-available" class="headerlink" title="findOrCreate - Search for a specific element or create it if not available"></a>findOrCreate - Search for a specific element or create it if not available</h4><p>The method <code>findOrCreate</code> can be used to check if a certain element already exists in the database. If that is the case the method will result in a respective instance, if the element does not yet exists, it will be created.</p>
<p>Let’s assume we have an empty database with a <code>User</code> model which has a <code>username</code> and a <code>job</code></p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">User.findOrCreate(&#123;</div><div class="line">  <span class="hljs-attr">where</span>: &#123;</div><div class="line">    <span class="hljs-attr">username</span>: <span class="hljs-string">'sdepold'</span>,</div><div class="line">  &#125;,</div><div class="line">  <span class="hljs-attr">defaults</span>: &#123;</div><div class="line">    <span class="hljs-attr">job</span>: <span class="hljs-string">"Technical Lead JS"</span>,</div><div class="line">  &#125;</div><div class="line">&#125;).spread(<span class="hljs-function">(<span class="hljs-params">user, created</span>) =&gt;</span> &#123;</div><div class="line">  <span class="hljs-built_in">console</span>.log(user.get(&#123;</div><div class="line">    <span class="hljs-attr">plain</span>: <span class="hljs-literal">true</span>,</div><div class="line">  &#125;))</div><div class="line">  <span class="hljs-comment">/**</span></div><div class="line">   * findOrCreate returns an array containing the object that was found or created and a boolean will be true if a new object was created, and false if not</div><div class="line">    [ &#123;</div><div class="line">      username: 'sdepold',</div><div class="line">      job: 'Technical Lead JavaScript',</div><div class="line">      id: 1,</div><div class="line">      createdAt: Fri Mar 22 2013 21: 28: 34 GMT + 0100(CET),</div><div class="line">      updatedAt: Fri Mar 22 2013 21: 28: 34 GMT + 0100(CET)</div><div class="line">    &#125;,</div><div class="line">    true ]</div><div class="line">   */</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>The code created a new instance.</p>
<h4 id="fineAndCountAll-Search-for-multiple-elements-in-the-database-returns-both-data-and-total-count"><a href="#fineAndCountAll-Search-for-multiple-elements-in-the-database-returns-both-data-and-total-count" class="headerlink" title="fineAndCountAll - Search for multiple elements in the database, returns both data and total count"></a>fineAndCountAll - Search for multiple elements in the database, returns both data and total count</h4><h4 id="findAll-Search-for-multiple-elements-in-the-database"><a href="#findAll-Search-for-multiple-elements-in-the-database" class="headerlink" title="findAll - Search for multiple elements in the database"></a>findAll - Search for multiple elements in the database</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// find multiple entries</span></div><div class="line">Project.findAll().then(<span class="hljs-function"><span class="hljs-params">projects</span> =&gt;</span> &#123;</div><div class="line">  <span class="hljs-comment">// projects will be an array of all Project instances</span></div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="hljs-comment">// also possible</span></div><div class="line">Project.all().then(<span class="hljs-function"><span class="hljs-params">projects</span> =&gt;</span> &#123;</div><div class="line">  <span class="hljs-comment">// projects will be an array of all Project instances</span></div><div class="line">&#125;)</div><div class="line"><span class="hljs-comment">// search for specific attribute - hash usage</span></div><div class="line">Project.findAll(&#123;</div><div class="line">  <span class="hljs-attr">where</span>: &#123;</div><div class="line">    <span class="hljs-attr">name</span>: <span class="hljs-string">'A Project'</span>,</div><div class="line">  &#125;</div><div class="line">&#125;).then(<span class="hljs-function"><span class="hljs-params">projects</span> =&gt;</span> &#123;</div><div class="line">  <span class="hljs-comment">// ...</span></div><div class="line">&#125;)</div><div class="line"><span class="hljs-comment">// search within a specific range</span></div><div class="line">Project.findAll(&#123;</div><div class="line">  <span class="hljs-attr">where</span>: &#123;</div><div class="line">    <span class="hljs-attr">id</span>: [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>],</div><div class="line">  &#125;</div><div class="line">&#125;).then(<span class="hljs-function"><span class="hljs-params">projects</span> =&gt;</span> &#123;</div><div class="line">  <span class="hljs-comment">// return instances with id 1, 2, 3</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h4 id="Complex-filtering-OR-NOT-queries"><a href="#Complex-filtering-OR-NOT-queries" class="headerlink" title="Complex filtering /OR/NOT queries"></a>Complex filtering /OR/NOT queries</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">Project.findAll(&#123;</div><div class="line">  <span class="hljs-attr">where</span>: &#123;</div><div class="line">    <span class="hljs-attr">name</span>: <span class="hljs-string">'a project'</span>,</div><div class="line">    <span class="hljs-attr">$or</span>: [</div><div class="line">      &#123; <span class="hljs-attr">id</span>: [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>] &#125;,</div><div class="line">      &#123; <span class="hljs-attr">id</span>: &#123; <span class="hljs-attr">$gt</span>: <span class="hljs-number">10</span> &#125;&#125;,</div><div class="line">    ]</div><div class="line">  &#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line">Project.findAll(&#123;</div><div class="line">  <span class="hljs-attr">where</span>: &#123;</div><div class="line">    <span class="hljs-attr">name</span>: <span class="hljs-string">'a project'</span>,</div><div class="line">    <span class="hljs-attr">id</span>: &#123;</div><div class="line">      <span class="hljs-attr">$or</span>: [</div><div class="line">        [ <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>],</div><div class="line">        &#123; <span class="hljs-attr">$gt</span>: <span class="hljs-number">10</span> &#125;,</div><div class="line">      ]</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>Both pieces of code will generate the following:</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">SELECT * FROM `Projects` WHERE (</div><div class="line">  `Projects`.`name`=`a project`</div><div class="line">  AND (`Projects`.`id` IN (1,2,3) OR `Projects`.`id`&gt;10)</div><div class="line">  )</div></pre></td></tr></table></figure>
<h4 id="Manipulating-the-database-with-limit-offset-order-and-group"><a href="#Manipulating-the-database-with-limit-offset-order-and-group" class="headerlink" title="Manipulating the database with limit, offset, order and group"></a>Manipulating the database with limit, offset, order and group</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// limit the results of the query</span></div><div class="line">Project.findAll(&#123; <span class="hljs-attr">limit</span>: <span class="hljs-number">10</span> &#125;)</div><div class="line"></div><div class="line"><span class="hljs-comment">// step over the first 10 elements</span></div><div class="line">Project.findAll(&#123; <span class="hljs-attr">offset</span>: <span class="hljs-number">10</span> &#125;)</div><div class="line"></div><div class="line"><span class="hljs-comment">// step over the first 10 element and take 2</span></div><div class="line">Project.findAll(&#123; <span class="hljs-attr">offset</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">limit</span>: <span class="hljs-number">2</span> &#125;)</div></pre></td></tr></table></figure>
<p>The syntax for grouping and ordering are equal, so below it is only explained with a single example for group, and the rest for order.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// yields ORDER BY title DESC</span></div><div class="line">Project.findAll(&#123; <span class="hljs-attr">order</span>: <span class="hljs-string">'title DESC'</span> &#125;)</div><div class="line"></div><div class="line"><span class="hljs-comment">// yields GROUP BY name</span></div><div class="line">Project.findAll(&#123; <span class="hljs-attr">group</span>: <span class="hljs-string">'name'</span> &#125;)</div></pre></td></tr></table></figure>
<h4 id="Raw-queries"><a href="#Raw-queries" class="headerlink" title="Raw queries"></a>Raw queries</h4><p>Sometimes you might be expecting a massive dataset that you just want to display without manipulation. For each row you select, Sequelize creates an instance with functions for update, delete, get association etc. If you have thousands of rows, this might take some time. If you only need the raw data and don’t want to update anything, you can do like this to get the raw data.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// Are you expecting a massive dataset from the DB, and don't want to spend the time building DAOs for each entry? You can pass an extra query option to get the raw data insetead:</span></div><div class="line">Project.findAll(&#123;</div><div class="line">  <span class="hljs-attr">where</span>: &#123;</div><div class="line">    <span class="hljs-comment">// ...</span></div><div class="line">  &#125;,</div><div class="line">  <span class="hljs-attr">raw</span>: <span class="hljs-literal">true</span>,</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="Queries"><a href="#Queries" class="headerlink" title="Queries"></a>Queries</h3><h4 id="Attributes"><a href="#Attributes" class="headerlink" title="Attributes"></a>Attributes</h4><p>To select only some attributes, you can use the <code>attributes</code> option. Most often, you pass an array:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Model.findAll(&#123;</div><div class="line">  <span class="hljs-attr">attributes</span>: [<span class="hljs-string">'foo'</span>, <span class="hljs-string">'bar'</span>]</div><div class="line">&#125;)</div><div class="line"><span class="hljs-comment">// Equal to</span></div><div class="line">SELECT foo, bar ...</div></pre></td></tr></table></figure>
<h4 id="Where"><a href="#Where" class="headerlink" title="Where"></a>Where</h4><p>Whether you are querying with <code>findAll</code>/<code>find</code> or doing bulk <code>updates</code>/<code>destroy</code> you can pass a <code>where</code> object to filte the query.</p>
<p><code>where</code> generally takes an object from attribute:value pairs, where value can be primitive for equality matches or keyed objects for other operators.</p>
<p>It’s also possible to generate complex <code>AND</code>/<code>OR</code> conditions by nesting of <code>$or</code> and <code>$and</code></p>
<h4 id="Basics"><a href="#Basics" class="headerlink" title="Basics"></a>Basics</h4>
        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-06T18:09:58.000Z">2017-08-07</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    2 minutes read (About 288 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/07/Build-GraphQL-Server-with-Express/">Build GraphQL Server With Express</a>
            
        </h1>
        <div class="content">
            <h3 id="Step-1-Connect-to-Server"><a href="#Step-1-Connect-to-Server" class="headerlink" title="Step 1 - Connect to Server"></a>Step 1 - Connect to Server</h3><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// db.js</span></div><div class="line"><span class="hljs-keyword">const</span> Sequelize = <span class="hljs-built_in">require</span>(<span class="hljs-string">'sequelize'</span>)</div><div class="line"><span class="hljs-keyword">const</span> _ = <span class="hljs-built_in">require</span>(<span class="hljs-string">'lodash'</span>)</div><div class="line"><span class="hljs-keyword">const</span> Faker = <span class="hljs-built_in">require</span>(<span class="hljs-string">'faker'</span>)</div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> Conn = <span class="hljs-keyword">new</span> Sequelize(</div><div class="line">  <span class="hljs-string">'test'</span>,</div><div class="line">  <span class="hljs-string">'postgres'</span>,</div><div class="line">  <span class="hljs-string">'postgres'</span>,</div><div class="line">  &#123;</div><div class="line">    <span class="hljs-attr">dialect</span>: <span class="hljs-string">'postgres'</span>,</div><div class="line">    <span class="hljs-attr">host</span>: <span class="hljs-string">'localhost'</span>,</div><div class="line">  &#125;</div><div class="line">)</div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> Person = Conn.define(<span class="hljs-string">'person'</span>, &#123;</div><div class="line">  <span class="hljs-attr">firstName</span>: &#123;</div><div class="line">    <span class="hljs-attr">type</span>: Sequelize.STRING,</div><div class="line">    <span class="hljs-attr">allowNull</span>: <span class="hljs-literal">false</span>,</div><div class="line">  &#125;,</div><div class="line">  <span class="hljs-attr">lastName</span>: &#123;</div><div class="line">    <span class="hljs-attr">type</span>: Sequelize.STRING,</div><div class="line">    <span class="hljs-attr">allowNull</span>: <span class="hljs-literal">false</span>,</div><div class="line">  &#125;,</div><div class="line">  <span class="hljs-attr">email</span>: &#123;</div><div class="line">    <span class="hljs-attr">type</span>: Sequelize.STRING,</div><div class="line">    <span class="hljs-attr">allowNull</span>: <span class="hljs-literal">false</span>,</div><div class="line">    <span class="hljs-attr">validate</span>: &#123;</div><div class="line">      <span class="hljs-attr">isEmail</span>: <span class="hljs-literal">true</span>,</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> Post = Conn.define(<span class="hljs-string">'post'</span>, &#123;</div><div class="line">  <span class="hljs-attr">title</span>: &#123;</div><div class="line">    <span class="hljs-attr">type</span>: Sequelize.STRING,</div><div class="line">    <span class="hljs-attr">allowNull</span>: <span class="hljs-literal">false</span>,</div><div class="line">  &#125;,</div><div class="line">  <span class="hljs-attr">content</span>: &#123;</div><div class="line">    <span class="hljs-attr">type</span>: Sequelize.STRING,</div><div class="line">    <span class="hljs-attr">allowNull</span>: <span class="hljs-literal">false</span>,</div><div class="line">  &#125;,</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="hljs-comment">// Relationships</span></div><div class="line">Person.hasMany(Post)</div><div class="line">Post.belongsTo(Person)</div><div class="line"></div><div class="line">Conn.sync(&#123;</div><div class="line">  <span class="hljs-attr">force</span>: <span class="hljs-literal">true</span>,</div><div class="line">&#125;).then( <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</div><div class="line">  _.times(<span class="hljs-number">10</span>, () =&gt; &#123;</div><div class="line">    <span class="hljs-keyword">return</span> Person.create(&#123;</div><div class="line">      <span class="hljs-attr">firstName</span>: Faker.name.firstName(),</div><div class="line">      <span class="hljs-attr">lastName</span>: Faker.name.lastName(),</div><div class="line">      <span class="hljs-attr">email</span>: Faker.internet.email(),</div><div class="line">    &#125;).then(<span class="hljs-function"><span class="hljs-params">person</span> =&gt;</span> &#123;</div><div class="line">      <span class="hljs-keyword">return</span> person.createPost(&#123;</div><div class="line">        <span class="hljs-attr">title</span>: <span class="hljs-string">`Sample title by <span class="hljs-subst">$&#123;person.firstName&#125;</span>`</span>,</div><div class="line">        <span class="hljs-attr">content</span>: <span class="hljs-string">'This is a sample article'</span>,</div><div class="line">      &#125;)</div><div class="line">    &#125;)</div><div class="line">  &#125;)</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="hljs-built_in">module</span>.exports = Conn</div></pre></td></tr></table></figure>
<h3 id="Step-2-Build-Schema"><a href="#Step-2-Build-Schema" class="headerlink" title="Step 2 - Build Schema"></a>Step 2 - Build Schema</h3><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// schema.js</span></div><div class="line"><span class="hljs-keyword">const</span> Sequelize = <span class="hljs-built_in">require</span>(<span class="hljs-string">'sequelize'</span>)</div><div class="line"><span class="hljs-keyword">const</span> _ = <span class="hljs-built_in">require</span>(<span class="hljs-string">'lodash'</span>)</div><div class="line"><span class="hljs-keyword">const</span> Faker = <span class="hljs-built_in">require</span>(<span class="hljs-string">'faker'</span>)</div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> Conn = <span class="hljs-keyword">new</span> Sequelize(</div><div class="line">  <span class="hljs-string">'test'</span>,</div><div class="line">  <span class="hljs-string">'postgres'</span>,</div><div class="line">  <span class="hljs-string">'postgres'</span>,</div><div class="line">  &#123;</div><div class="line">    <span class="hljs-attr">dialect</span>: <span class="hljs-string">'postgres'</span>,</div><div class="line">    <span class="hljs-attr">host</span>: <span class="hljs-string">'localhost'</span>,</div><div class="line">  &#125;</div><div class="line">)</div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> Person = Conn.define(<span class="hljs-string">'person'</span>, &#123;</div><div class="line">  <span class="hljs-attr">firstName</span>: &#123;</div><div class="line">    <span class="hljs-attr">type</span>: Sequelize.STRING,</div><div class="line">    <span class="hljs-attr">allowNull</span>: <span class="hljs-literal">false</span>,</div><div class="line">  &#125;,</div><div class="line">  <span class="hljs-attr">lastName</span>: &#123;</div><div class="line">    <span class="hljs-attr">type</span>: Sequelize.STRING,</div><div class="line">    <span class="hljs-attr">allowNull</span>: <span class="hljs-literal">false</span>,</div><div class="line">  &#125;,</div><div class="line">  <span class="hljs-attr">email</span>: &#123;</div><div class="line">    <span class="hljs-attr">type</span>: Sequelize.STRING,</div><div class="line">    <span class="hljs-attr">allowNull</span>: <span class="hljs-literal">false</span>,</div><div class="line">    <span class="hljs-attr">validate</span>: &#123;</div><div class="line">      <span class="hljs-attr">isEmail</span>: <span class="hljs-literal">true</span>,</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> Post = Conn.define(<span class="hljs-string">'post'</span>, &#123;</div><div class="line">  <span class="hljs-attr">title</span>: &#123;</div><div class="line">    <span class="hljs-attr">type</span>: Sequelize.STRING,</div><div class="line">    <span class="hljs-attr">allowNull</span>: <span class="hljs-literal">false</span>,</div><div class="line">  &#125;,</div><div class="line">  <span class="hljs-attr">content</span>: &#123;</div><div class="line">    <span class="hljs-attr">type</span>: Sequelize.STRING,</div><div class="line">    <span class="hljs-attr">allowNull</span>: <span class="hljs-literal">false</span>,</div><div class="line">  &#125;,</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="hljs-comment">// Relationships</span></div><div class="line">Person.hasMany(Post)</div><div class="line">Post.belongsTo(Person)</div><div class="line"></div><div class="line">Conn.sync(&#123;</div><div class="line">  <span class="hljs-attr">force</span>: <span class="hljs-literal">true</span>,</div><div class="line">&#125;).then( <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</div><div class="line">  _.times(<span class="hljs-number">10</span>, () =&gt; &#123;</div><div class="line">    <span class="hljs-keyword">return</span> Person.create(&#123;</div><div class="line">      <span class="hljs-attr">firstName</span>: Faker.name.firstName(),</div><div class="line">      <span class="hljs-attr">lastName</span>: Faker.name.lastName(),</div><div class="line">      <span class="hljs-attr">email</span>: Faker.internet.email(),</div><div class="line">    &#125;).then(<span class="hljs-function"><span class="hljs-params">person</span> =&gt;</span> &#123;</div><div class="line">      <span class="hljs-keyword">return</span> person.createPost(&#123;</div><div class="line">        <span class="hljs-attr">title</span>: <span class="hljs-string">`Sample title by <span class="hljs-subst">$&#123;person.firstName&#125;</span>`</span>,</div><div class="line">        <span class="hljs-attr">content</span>: <span class="hljs-string">'This is a sample article'</span>,</div><div class="line">      &#125;)</div><div class="line">    &#125;)</div><div class="line">  &#125;)</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="hljs-built_in">module</span>.exports = Conn</div></pre></td></tr></table></figure>
<h3 id="Step-3-Add-GraphQL-to-Server"><a href="#Step-3-Add-GraphQL-to-Server" class="headerlink" title="Step 3 - Add GraphQL to Server"></a>Step 3 - Add GraphQL to Server</h3><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// server.js</span></div><div class="line"><span class="hljs-keyword">const</span> Express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>)</div><div class="line"><span class="hljs-keyword">const</span> GraphHTTP = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express-graphql'</span>)</div><div class="line"><span class="hljs-keyword">const</span> Schema = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./schema'</span>)</div><div class="line"></div><div class="line"><span class="hljs-comment">// Config</span></div><div class="line"><span class="hljs-keyword">const</span> APP_PORT = <span class="hljs-number">3000</span></div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> app = Express()</div><div class="line">app.use(<span class="hljs-string">'/graphql'</span>, GraphHTTP(&#123;</div><div class="line">  <span class="hljs-attr">schema</span>: Schema,</div><div class="line">  <span class="hljs-attr">pretty</span>: <span class="hljs-literal">true</span>,</div><div class="line">  <span class="hljs-attr">graphiql</span>: <span class="hljs-literal">true</span>,</div><div class="line">&#125;))</div><div class="line"></div><div class="line">app.listen(APP_PORT, () =&gt; &#123;</div><div class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Server listening at '</span> + APP_PORT)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-06T14:11:33.000Z">2017-08-06</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    3 minutes read (About 495 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/06/koa-graphql/">Koa-Graphql</a>
            
        </h1>
        <div class="content">
            <p>Create a GraphQL HTTP server with Koa.</p>
<h3 id="Usage-with-Koa-Router"><a href="#Usage-with-Koa-Router" class="headerlink" title="Usage with Koa-Router"></a>Usage with Koa-Router</h3><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">const</span> Koa = <span class="hljs-built_in">require</span>(<span class="hljs-string">'koa'</span>)</div><div class="line"><span class="hljs-keyword">const</span> Router = <span class="hljs-built_in">require</span>(<span class="hljs-string">'koa-router'</span>)</div><div class="line"><span class="hljs-keyword">const</span> GraphqlHTTP = <span class="hljs-built_in">require</span>(<span class="hljs-string">'koa-graphql'</span>)</div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> Koa()</div><div class="line"><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> Router()</div><div class="line"></div><div class="line">router.all(<span class="hljs-string">'/graphql'</span>, graphqlHTTP(&#123;</div><div class="line">  <span class="hljs-attr">schema</span>: MyGraphQLSchema,</div><div class="line">  <span class="hljs-attr">graphiql</span>: ture,</div><div class="line">&#125;))</div><div class="line"></div><div class="line">app.use(router.routes()).use(router.allowedMethods())</div></pre></td></tr></table></figure>
<h3 id="Options"><a href="#Options" class="headerlink" title="Options"></a>Options</h3><p>The <code>GraphqlHTTP</code> function accpets the following options:</p>
<ul>
<li><p><code>schema</code>: A <code>GraphQLSchema</code> instance from <code>graphql.js</code>, required.</p>
</li>
<li><p><code>graphiql</code>: If <code>true</code>, presetns <a href="https://github.com/graphql/graphiql" target="_blank" rel="noopener">GraphiQL</a> when the route with a <code>/graphiql</code> appended is loaded in a browser. We recommended that you set <code>graphiql</code> to <code>ture</code> when your app is in development, because it’s quite useful. You may or may not want it in production.</p>
</li>
<li><p><code>rootValue</code>: A value to pass as the <code>rootValue</code> to the <code>graphql()</code> function from <code>graphql.js</code></p>
</li>
<li><p><code>context</code>: A value to pass as the <code>context</code> to the <code>graphql()</code> function from <code>graphql.js</code>. If <code>context</code> is not provided, the <code>ctx</code> object is passes as the context.</p>
</li>
<li><p><code>pretty</code>: If <code>true</code>, any JSON response will be pretty-printed.</p>
</li>
<li><p><code>formatError</code>: An optional function which will be used to format any errors produced by fulfilling a GraphQL operation. If no function is provided, GraphQL’s default spec-compliant <code>formatError</code> function will be used.</p>
</li>
<li><p><code>extensions</code>: An optional function for adding additional metadata to the GraphQL response as a key-value object. The result will be added to <code>extensions</code> field in the resulting JSON. This is often useful place to add development time metadata such as the runtime of a query or the amount of resources consumed. This may be an async function. The function is given one object as an argument: <code>{ document, variables, operationName, result }</code></p>
</li>
<li><p><code>validationRules</code>: Optional additional validation rules queries must satisfy in addition to those defined by the GraphQL spec.</p>
</li>
</ul>
<h3 id="HTTP-Usage"><a href="#HTTP-Usage" class="headerlink" title="HTTP Usage"></a>HTTP Usage</h3><p>Once installed at a path, <code>koa-graphql</code> will accept requests with the parameters:</p>
<ul>
<li><p><code>query</code>: A string GraphQL document to be executed.</p>
</li>
<li><p><code>variables</code>: The runtime values to use for any GraphQL query variables as a JSON object.</p>
</li>
<li><p><code>operationName</code>: If the provided <code>query</code> contains mutiple named operations, this specifies which operation should be executed. If not provided, a 400 error will be returned if the <code>query</code> contains multiple named operations.</p>
</li>
<li><p><code>raw</code>: If the <code>graphql</code> option is enabled and the <code>raw</code> parameter is provided raw JSON will always be returned instead of GraphQL even when loaded from a browser.</p>
</li>
</ul>
<p>GraphQL will first look for each parameter in the URL’s query-string:</p>
<p><code>/graphql?query=query+getUser($id:ID){user(id:$id){name}}&amp;variables={&quot;id&quot;:&quot;4&quot;}</code></p>
<p>If not found in the query-string, it will look in the POST request body.</p>
<p>If the POST body has not been parsed, koa-graphql will interpret it depending on the provided <em>Contetn-Type</em> header:</p>
<ul>
<li><p><code>application/json</code>: the POST body will be parsed as a JSON object.</p>
</li>
<li><p><code>application/x-www-form-urlencoded</code>: this POST body will be parsed as a url-encoded string of key-value pairs.</p>
</li>
<li><p><code>application/graphql</code>: The POST body will be parsed as GraphQL query string, which provides the <code>query</code> parameter.</p>
</li>
</ul>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-04T08:23:33.000Z">2017-08-04</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    7 minutes read (About 1047 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/04/Note-on-GraphQL-2/">Note on GraphQL(2)</a>
            
        </h1>
        <div class="content">
            <h3 id="Execution"><a href="#Execution" class="headerlink" title="Execution"></a>Execution</h3><p>After being validated, a GraphQL query is executed by a GraphQL server which returns a result that mirrors the shape of the requested query, typically as JSON.</p>
<p>GraphQL cannot execute a query without a type system, let’s use an example type system to illustrate executing a query.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">type Query &#123;</div><div class="line">  human(id: ID!): Human</div><div class="line">&#125;</div><div class="line"></div><div class="line">type Human &#123;</div><div class="line">  <span class="hljs-attr">name</span>: <span class="hljs-built_in">String</span></div><div class="line">  appearsIn: [Episode]</div><div class="line">  starships: [Starship]</div><div class="line">&#125;</div><div class="line"></div><div class="line">enum Episode &#123;</div><div class="line">  NEWHOPE</div><div class="line">  EMPIRE</div><div class="line">  JEDI</div><div class="line">&#125;</div><div class="line"></div><div class="line">type Starship &#123;</div><div class="line">  <span class="hljs-attr">name</span>: <span class="hljs-built_in">String</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>In order to describe what happens when a query is executed, let’s use an example to walk through.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  human(id: <span class="hljs-number">1002</span>) &#123;</div><div class="line">    name</div><div class="line">    appearsIn</div><div class="line">    starships &#123;</div><div class="line">      name</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight json hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="hljs-attr">"data"</span>: &#123;</div><div class="line">    <span class="hljs-attr">"human"</span>: &#123;</div><div class="line">      <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Han Solo"</span>,</div><div class="line">      <span class="hljs-attr">"appearsIn"</span>: [</div><div class="line">        <span class="hljs-string">"NEWHOPE"</span>,</div><div class="line">        <span class="hljs-string">"EMPIRE"</span>,</div><div class="line">        <span class="hljs-string">"JEDI"</span></div><div class="line">      ],</div><div class="line">      <span class="hljs-attr">"starships"</span>: [</div><div class="line">        &#123;</div><div class="line">          <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Millenium Falcon"</span></div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Imperial shuttle"</span></div><div class="line">        &#125;</div><div class="line">      ]</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>You can think of each field in a GraphQL query as a function or method of the previous type which returns the next type.</p>
<p>Exactly this is how GraphQL works. Each field on each type is backed by a function called the <code>resolver</code> which is provided by the GraphQL Server Developer.</p>
<p>When a field is executed, the corresponding <code>resolver</code> is called to produce the next value.</p>
<p>If a field produces a scalar value like a string or number, then the execution completes.</p>
<p>However if a field produces an object value then the query will contain another selection of fields which apply to that object. This continues until scalar values are reached.</p>
<p>GraphQL queries always end at scalar values.</p>
<h4 id="Root-Fields-amp-Resolvers"><a href="#Root-Fields-amp-Resolvers" class="headerlink" title="Root Fields &amp; Resolvers"></a>Root Fields &amp; Resolvers</h4><p>At the top level of every GraphQL server is a type that represents all of the possible entry points into the GraphQL API, it’s often called the <code>Root Type</code> or the <code>Query Type</code>.</p>
<p>In this example, our Query Type provides a field called <code>human</code> which accepts the argument <code>id</code>. The resolver function for this field accesses a database and then constructs and returns a <code>Human</code> object.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Query: &#123;</div><div class="line">  human(obj, args, context) &#123;</div><div class="line">    <span class="hljs-keyword">return</span> context.db.loadHumanById(args.id).then(</div><div class="line">      <span class="hljs-function"><span class="hljs-params">userData</span> =&gt;</span> <span class="hljs-keyword">new</span> Human(userData)</div><div class="line">    )</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><p><code>obj</code> The previous object, which for a field on the root Query type if often not used.</p>
</li>
<li><p><code>args</code> The arguments provided to the field in the GraphQL query</p>
</li>
<li><p><code>context</code> A value which is provided to every resolver and holds important contextual information like the currently logged in user, or access to a database.</p>
</li>
</ul>
<h4 id="Asynchronous-Resolvers"><a href="#Asynchronous-Resolvers" class="headerlink" title="Asynchronous Resolvers"></a>Asynchronous Resolvers</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">human(obj, arg, context) &#123;</div><div class="line">  <span class="hljs-keyword">return</span> context.db.loadHumanById(args.id).then(</div><div class="line">    <span class="hljs-function"><span class="hljs-params">userData</span> =&gt;</span> <span class="hljs-keyword">new</span> Human(userData)</div><div class="line">  )</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>The context is used to provide access to a database which is used to load data for user by the <code>id</code> provided as an argument in the GraphQL query. Since loading from a database is an asynchronous operation, this returns a <strong>Promise</strong>. When the database returns, we can construct and return a new <code>Human</code> object.</p>
<p>Notice that while the resolver function needs to be aware of Promise, the GraphQL query does not. It simply expects the <code>human</code> field to return something which it can then ask the <code>name</code> of. During execution, GraphQL will wait for Promise to complete before continuing and will do so with optimal concurrency.</p>
<h4 id="Trivial-Resolvers"><a href="#Trivial-Resolvers" class="headerlink" title="Trivial Resolvers"></a>Trivial Resolvers</h4><p>Now that a <code>Human</code> object is available, GraphQL execution can continue with the fields requested on it.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Human: &#123;</div><div class="line">  name(obj, args, context) &#123;</div><div class="line">    <span class="hljs-keyword">return</span> obj.name</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>A GraphQL server is powered by a type system which is used to determine what to do next. Even before the <code>human</code> field returns anything, GraphQL knows that the next stop will be to resolve fields on the <code>Human</code> type since the type system tells it that the <code>human</code> field will return a <code>Human</code>.</p>
<p>Resolving the <code>name</code> in this case is very straight-forward. The name resolver function is called and the <code>obj</code> argument is the <code>new Human</code> object return from the previous field. In this case, we expect that Human object to have a <code>name</code>property which we can read and return directly.</p>
<h4 id="Scalar-Coercion"><a href="#Scalar-Coercion" class="headerlink" title="Scalar Coercion"></a>Scalar Coercion</h4><p>While the <code>name</code> field is being resolved, the <code>appearsIn</code> and <code>starships</code> fields can be resolved concurrently. The <code>appearsIn</code> field could also have a trivial resolver, but let’s take a closer look:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Human: &#123;</div><div class="line">  appearsIn(obj) &#123;</div><div class="line">    <span class="hljs-keyword">return</span> obj.appearsIn <span class="hljs-comment">// return [3, 4, 5]</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Notice that our type system claims <code>appearsIn</code> will return Enum values with known values, however this function is returning numbers. This is an example of scalar coercion. The type system knows what to expect and will convert the values returned by a resolver function into something that upholds the API contract. In this case, there may be an Enum defined on our server which uses numbers like 3, 4, 5 internally, but represents them as Enum values in the GraphQL type system.</p>
<h4 id="List-Resolvers"><a href="#List-Resolvers" class="headerlink" title="List Resolvers"></a>List Resolvers</h4><p>The <code>appearsIn</code> field above returned a list of Enum values, and since that’s what the type system expected, each item in the list was coerced to the appropriate enum values.</p>
<p>What happens when the <code>starships</code> field is resolved?</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">Human: &#123;</div><div class="line">  starships (obj, args, context) &#123;</div><div class="line">    <span class="hljs-keyword">return</span> obj.starshipIDs.map(</div><div class="line">      <span class="hljs-function"><span class="hljs-params">id</span> =&gt;</span> context.db.loadStarshipByID(id).then(</div><div class="line">        <span class="hljs-function"><span class="hljs-params">shipData</span> =&gt;</span> <span class="hljs-keyword">new</span> Starship(shipData)</div><div class="line">      )</div><div class="line">    )</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>The resolver for this field is not just returning a Promise, it’s returning a list of Promises. The <code>Human</code> object has a list of ids of the <code>Starships</code> they piloted, but we need to go load all of those ids to get read Starship objects.</p>
<p>GraphQL will wait for all of these Promises concurrently before continuing, and when left with a list of objects, it will concurrently continue yet again to load the <code>name</code> field on each of these items.</p>
<h3 id="Introspection"><a href="#Introspection" class="headerlink" title="Introspection"></a>Introspection</h3><p>We designed the type system, so we know what types are available, but if we didn’t, we can ask GraphQL by querying the <code>__schema</code> field, always available on the root type of a Query.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  __schema &#123;</div><div class="line">    types &#123;</div><div class="line">      name</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="hljs-comment">// produce</span></div><div class="line"></div><div class="line">&#123;</div><div class="line">  <span class="hljs-string">"data"</span>: &#123;</div><div class="line">    <span class="hljs-string">"__schema"</span>: &#123;</div><div class="line">      <span class="hljs-string">"types"</span>: [</div><div class="line">        &#123;</div><div class="line">          <span class="hljs-string">"name"</span>: <span class="hljs-string">"Query"</span></div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          <span class="hljs-string">"name"</span>: <span class="hljs-string">"Episode"</span></div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          <span class="hljs-string">"name"</span>: <span class="hljs-string">"Character"</span></div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          <span class="hljs-string">"name"</span>: <span class="hljs-string">"ID"</span></div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          <span class="hljs-string">"name"</span>: <span class="hljs-string">"String"</span></div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          <span class="hljs-string">"name"</span>: <span class="hljs-string">"Int"</span></div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          <span class="hljs-string">"name"</span>: <span class="hljs-string">"FriendsConnection"</span></div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          <span class="hljs-string">"name"</span>: <span class="hljs-string">"FriendsEdge"</span></div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          <span class="hljs-string">"name"</span>: <span class="hljs-string">"PageInfo"</span></div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          <span class="hljs-string">"name"</span>: <span class="hljs-string">"Boolean"</span></div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          <span class="hljs-string">"name"</span>: <span class="hljs-string">"Review"</span></div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          <span class="hljs-string">"name"</span>: <span class="hljs-string">"SearchResult"</span></div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          <span class="hljs-string">"name"</span>: <span class="hljs-string">"Human"</span></div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          <span class="hljs-string">"name"</span>: <span class="hljs-string">"LengthUnit"</span></div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          <span class="hljs-string">"name"</span>: <span class="hljs-string">"Float"</span></div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          <span class="hljs-string">"name"</span>: <span class="hljs-string">"Starship"</span></div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          <span class="hljs-string">"name"</span>: <span class="hljs-string">"Droid"</span></div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          <span class="hljs-string">"name"</span>: <span class="hljs-string">"Mutation"</span></div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          <span class="hljs-string">"name"</span>: <span class="hljs-string">"ReviewInput"</span></div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          <span class="hljs-string">"name"</span>: <span class="hljs-string">"__Schema"</span></div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          <span class="hljs-string">"name"</span>: <span class="hljs-string">"__Type"</span></div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          <span class="hljs-string">"name"</span>: <span class="hljs-string">"__TypeKind"</span></div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          <span class="hljs-string">"name"</span>: <span class="hljs-string">"__Field"</span></div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          <span class="hljs-string">"name"</span>: <span class="hljs-string">"__InputValue"</span></div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          <span class="hljs-string">"name"</span>: <span class="hljs-string">"__EnumValue"</span></div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          <span class="hljs-string">"name"</span>: <span class="hljs-string">"__Directive"</span></div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          <span class="hljs-string">"name"</span>: <span class="hljs-string">"__DirectiveLocation"</span></div><div class="line">        &#125;</div><div class="line">      ]</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Let’s group them:</p>
<ul>
<li><p><code>Query</code>, <code>Character</code>, <code>Human</code>, <code>Episode</code>, <code>Droid</code>. These are the ones that we defined in our type system.</p>
</li>
<li><p><code>String</code>, <code>Boolean</code>. These are built-in scalars that the type system provided.</p>
</li>
<li><p><code>__Schema</code>, <code>__Type</code>, <code>__TypeKind</code>, <code>__Field</code>, <code>__InputValue</code>, <code>__EnumValue</code>, <code>__Directive</code>. These are preceded with a double underscore, indicating that they are part of the introspection system.</p>
</li>
</ul>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-03T12:00:29.000Z">2017-08-03</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    13 minutes read (About 1878 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/03/Note-on-GraphQL-1/">Note on GraphQL(1)</a>
            
        </h1>
        <div class="content">
            <p>GraphQL is a query language for your API, and a server-side runtime for executing queries by using a type system you define for your data.</p>
<p>A GraphQL service is created by defining types and fields on those types, then providing functions for each field on each type.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">type Query &#123;</div><div class="line">  <span class="hljs-attr">me</span>: User</div><div class="line">&#125;</div><div class="line"></div><div class="line">type User &#123;</div><div class="line">  <span class="hljs-attr">id</span>: ID</div><div class="line">  name: <span class="hljs-built_in">String</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Along with functions for each field on each type:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Query_me</span>(<span class="hljs-params">request</span>) </span>&#123;</div><div class="line">  <span class="hljs-keyword">return</span> request.auth.user;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">User_name</span>(<span class="hljs-params">user</span>) </span>&#123;</div><div class="line">  <span class="hljs-keyword">return</span> user.getName()</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Once a GraphQL service is running (typically at a URL on a web service), it can be sent GraphQL queries to validate and execute. A received query is first checked to ensure it only refers to the types and fields defined, then runs the provided functions to produce a result.</p>
<p>For example the query:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  me &#123;</div><div class="line">    name</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="hljs-comment">// produce</span></div><div class="line">&#123;</div><div class="line">  <span class="hljs-string">"me"</span>: &#123;</div><div class="line">    <span class="hljs-string">"name"</span>: <span class="hljs-string">"Luck"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Fields"><a href="#Fields" class="headerlink" title="Fields"></a>Fields</h3><p>GraphQL is about asking for specific fields on objects.</p>
<p>GraphQL queries can traverse related objects and their fields, letting clients fetch lots of related data in one request, instead of making several roundtrips as one would need in a classic RESTFul architecture.</p>
<h3 id="Arguments"><a href="#Arguments" class="headerlink" title="Arguments"></a>Arguments</h3><p>In GraphQL, every field and nested object can get its own set of arguments, making GraphQL a complete replacement for making multiple API fetches. You can even pass arguments into scalar fields, to implement data transformations once on the server, instead of on every separately.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  human(id: <span class="hljs-string">'1000'</span>) &#123;</div><div class="line">    name</div><div class="line">    height(uint: FOOT)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Arguments can be of many different types. GraphQL comes with a default set of types, but a GraphQL server can also declare its own custom types, as long as they can be serialized into your transport format.</p>
<h3 id="Aliases"><a href="#Aliases" class="headerlink" title="Aliases"></a>Aliases</h3><p>You can’t directly query for the same field with different arguments, so you need alias to rename the result</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="hljs-attr">empireHero</span>: hero(episode: EMPIRE) &#123;</div><div class="line">    name</div><div class="line">  &#125;</div><div class="line">  jediHero: hero(episode: JEDI) &#123;</div><div class="line">    name</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="hljs-comment">// produce</span></div><div class="line">&#123;</div><div class="line">  <span class="hljs-string">"data"</span>: &#123;</div><div class="line">    <span class="hljs-string">"empireHero"</span>: &#123;</div><div class="line">      <span class="hljs-string">"name"</span>: <span class="hljs-string">"..."</span></div><div class="line">    &#125;,</div><div class="line">    <span class="hljs-string">"jediHero"</span>: &#123;</div><div class="line">      <span class="hljs-string">"name"</span>: <span class="hljs-string">"..."</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>In the above example, the two <code>hero</code> fields would have conflicted, but since we can alias them to different names, we can get both results in one request.</p>
<h3 id="Fragments"><a href="#Fragments" class="headerlink" title="Fragments"></a>Fragments</h3><p>GraphQL includes reusable units called <em>fragments</em>. Fragments let you construct sets of fields, and then include them in queries where you need to.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="hljs-attr">leftComparison</span>: hero(episode: EMPIRE) &#123;</div><div class="line">    ...comparisonFields</div><div class="line">  &#125;</div><div class="line">  rightComparison: hero(episode: JEDI) &#123;</div><div class="line">    ...comparisonFields</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">fragment comparisonFields on Character &#123;</div><div class="line">  name</div><div class="line">  appearsIn</div><div class="line">  friends &#123;</div><div class="line">    name</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Variables"><a href="#Variables" class="headerlink" title="Variables"></a>Variables</h3><p>When we start working with variables, we need to do three things:</p>
<ul>
<li><p>Replace the static values in the query with <code>$variableName</code></p>
</li>
<li><p>Declare <code>$variableName</code> as one of the variables accepted by the query</p>
</li>
<li><p>Pass <code>variableName: value</code> in the separate, transport-specific(usually JSON) variables dictionary</p>
</li>
</ul>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">query HeroNameAndFriends($episode: Episode) &#123;</div><div class="line">  hero(episode: $episode) &#123;</div><div class="line">    name</div><div class="line">    friends &#123;</div><div class="line">      name</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-comment">// Variables</span></div><div class="line">&#123;</div><div class="line">  <span class="hljs-string">'episode'</span>: <span class="hljs-string">'JEDI'</span>,</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Now in our client code, we can simply pass a different variable rather than needing to construct an entirely new query.</p>
<h4 id="Variable-Definitions"><a href="#Variable-Definitions" class="headerlink" title="Variable Definitions"></a>Variable Definitions</h4><p>The variable definitions are the part that looks like <code>($episode: Episode)</code> in the query above. It works just like the argument definition for a function in a types language. It lists all of the variables, prefixed by <code>$</code>, followed by their type, in this case <code>Episode</code>.</p>
<p>All declared variables must be either scalars, enums, or input object types.</p>
<p>Variable Definition can be optional or required. In the case above, since there isn’t an <code>!</code> next to the <code>Episode</code> type, it’s optional. But if the field you are passing the variable into requires a non-null argument, then the variable must be required.</p>
<h4 id="Default-Variables"><a href="#Default-Variables" class="headerlink" title="Default Variables"></a>Default Variables</h4><p>Default variables can also be assigned to the variables in the query by adding the default value after the type declaration.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">query HeroNameAndFriends($episode: Episode = <span class="hljs-string">'JEDI'</span>) &#123;</div><div class="line">  hero(episode: $episode) &#123;</div><div class="line">    name</div><div class="line">    friends &#123;</div><div class="line">      name</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Directives"><a href="#Directives" class="headerlink" title="Directives"></a>Directives</h3><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">query Hero($episode: Episode, <span class="hljs-attr">$withFriends</span>: <span class="hljs-built_in">Boolean</span>!) &#123;</div><div class="line">  hero(episode: $episode) &#123;</div><div class="line">    name</div><div class="line">    friends @include(<span class="hljs-keyword">if</span>: $withFriends) &#123;</div><div class="line">      name</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="hljs-comment">// variables</span></div><div class="line">&#123;</div><div class="line">  <span class="hljs-string">"episode"</span>: <span class="hljs-string">"JEDI"</span>,</div><div class="line">  <span class="hljs-string">"withFriends"</span>: <span class="hljs-literal">false</span>,</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>We needed to use a new feature in GraphQL called <em>directive</em>. A directive can be attached to a field or fragment inclusion, and can affect execution of the query in any way the server desires. The core GraphQL specification includes exactly two directives, which must be supported by any spec-compliant GraphQL server implementation:</p>
<ul>
<li><p>@include(if: Boolean): Only include this field in the result if the argument is <code>true</code></p>
</li>
<li><p>@skip(if: Boolean): Skip this field if the argument is <code>true</code></p>
</li>
</ul>
<h3 id="Mutations"><a href="#Mutations" class="headerlink" title="Mutations"></a>Mutations</h3><p>If mutation field returns an object type, you can ask for nested fields. This can be useful for fetching the new state of an object after an update.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">mutation CreateReviewForEpisode ($ep: Episode!, <span class="hljs-attr">$review</span>: ReviewInput!) &#123;</div><div class="line">  createReview(episode: $ep, <span class="hljs-attr">review</span>: $Review) &#123;</div><div class="line">    stars</div><div class="line">    commentary</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="hljs-comment">// Variables</span></div><div class="line">&#123;</div><div class="line">  <span class="hljs-string">"ep"</span>: <span class="hljs-string">"JEDI"</span>,</div><div class="line">  <span class="hljs-string">"review"</span>: &#123;</div><div class="line">    <span class="hljs-string">"star"</span>: <span class="hljs-number">5</span>,</div><div class="line">    <span class="hljs-string">"commentary"</span>: <span class="hljs-string">"This is a great movie"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Here the <code>createReview</code> returns the <code>star</code> and <code>commentary</code> fields of the newly created review.</p>
<h4 id="Multiple-fields-in-mutations"><a href="#Multiple-fields-in-mutations" class="headerlink" title="Multiple fields in mutations"></a>Multiple fields in mutations</h4><p>A mutation can contain multiple fields, just like a query. There’s one important distinction between queries and mutations, other than the name.</p>
<p>While query fields are executed in parallel, mutation fields run in series, one after the other. This means that if we send two <code>incrementCredits</code> mutations in one request, the first is guaranteed to finished before the second begins, ensuring that we don’t end up with a race condition with ourselves.</p>
<h3 id="Inline-Fragments"><a href="#Inline-Fragments" class="headerlink" title="Inline Fragments"></a>Inline Fragments</h3><p>GraphQL include the ability to define interfaces and union types.</p>
<p>If you are querying a field that returns an interface or a union type, you will need to use <em>inline fragments</em> to access data on the underlaying concrete type.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">query HeroForEpisode ($ep: Episode!) &#123;</div><div class="line">  hero (episode: $ep) &#123;</div><div class="line">    name</div><div class="line">    ... on Droid &#123;</div><div class="line">      primaryFunction</div><div class="line">    &#125;</div><div class="line">    ... on Human &#123;</div><div class="line">      height</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="hljs-comment">// Variables</span></div><div class="line">&#123;</div><div class="line">  <span class="hljs-string">"ep"</span>: <span class="hljs-string">"JEDI"</span></div><div class="line">&#125;</div><div class="line"><span class="hljs-comment">// produce</span></div><div class="line">&#123;</div><div class="line">  <span class="hljs-string">"data"</span>: &#123;</div><div class="line">    <span class="hljs-string">"hero"</span>: &#123;</div><div class="line">      <span class="hljs-string">"name"</span>: <span class="hljs-string">"..."</span>,</div><div class="line">      <span class="hljs-string">"primaryFunction"</span>: <span class="hljs-string">"..."</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>In this query, the <code>hero</code> field returns the type <code>Character</code>, which might be either a <code>Human</code> or a <code>Droid</code> depending on the <code>episode</code> argument. In the direct selection, you can ask for fields that exists on the <code>Character</code> interface such as <code>name</code>.</p>
<p>To ask for a field on the concrete type, you need to use a <em>inline fragment</em> with a type condition. Because the first fragment is labeled as <code>... on Droid</code>, the <code>primaryFunction</code> field will only be executed if the <code>Character</code> returned from <code>hero</code> is of the <code>Droid</code> type.</p>
<p>Named fragments can also be used in the same way, since a named fragment always has a type attached.</p>
<h4 id="Meta-fields"><a href="#Meta-fields" class="headerlink" title="Meta fields"></a>Meta fields</h4><p>Given that there are some situations where you don’t know what type you will get back from the GraphQL service, you need some way to determine how to handle that data on the client. GraphQL allows you to request <code>__typename</code>, a meta field, at any point in a query to get the name of the object type at that point.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  search(text: <span class="hljs-string">"an"</span>) &#123;</div><div class="line">    __typename</div><div class="line">    ... on Human &#123;</div><div class="line">      name</div><div class="line">    &#125;</div><div class="line">    ... on Droid &#123;</div><div class="line">      name</div><div class="line">    &#125;</div><div class="line">    ... on Starship &#123;</div><div class="line">      name</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="hljs-comment">// produce</span></div><div class="line">&#123;</div><div class="line">  <span class="hljs-string">"data"</span>: &#123;</div><div class="line">    <span class="hljs-string">"search"</span>: [</div><div class="line">      &#123;</div><div class="line">        <span class="hljs-string">"__typename"</span>: <span class="hljs-string">"Human"</span>,</div><div class="line">        <span class="hljs-string">"name"</span>: <span class="hljs-string">"Han"</span>,</div><div class="line">      &#125;, &#123;</div><div class="line">        <span class="hljs-string">"__typename"</span>: <span class="hljs-string">"Human"</span>,</div><div class="line">        <span class="hljs-string">"name"</span>: <span class="hljs-string">"ELX"</span>,</div><div class="line">      &#125;, &#123;</div><div class="line">        <span class="hljs-string">"__typename"</span>: <span class="hljs-string">"Starship"</span>,</div><div class="line">        <span class="hljs-string">"name"</span>: <span class="hljs-string">"TIE"</span></div><div class="line">      &#125;</div><div class="line">    ]</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>In the above query, <code>search</code> returns a union type that can be one of three options. It would be impossible to tell apart the different types from the client without the <code>__typename</code> field.</p>
<h3 id="Schemas-and-Types"><a href="#Schemas-and-Types" class="headerlink" title="Schemas and Types"></a>Schemas and Types</h3><h4 id="Type-System"><a href="#Type-System" class="headerlink" title="Type System"></a>Type System</h4><p>GraphQL query language is basically about selecting fields on objects.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  hero &#123;</div><div class="line">    name</div><div class="line">    appearsIn</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li><p>We start with a special ‘root’ object</p>
</li>
<li><p>We select the <code>hero</code> field on that</p>
</li>
<li><p>For the object returned by <code>hero</code>, we select the <code>name</code> and <code>appearsIn</code> fields</p>
</li>
</ol>
<h4 id="Object-Types-and-Fields"><a href="#Object-Types-and-Fields" class="headerlink" title="Object Types and Fields"></a>Object Types and Fields</h4><p>The most basic components of a GraphQL schema are object types, which just represent a kind of object you can fetch from your service, and what fields it has. In the GraphQL schema language, we might represent it like this:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">type Character &#123;</div><div class="line">  <span class="hljs-attr">name</span>: <span class="hljs-built_in">String</span>!</div><div class="line">  appearsIn: [Episode]!</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><p><code>Character</code> is a <em>GraphQL Type</em>, meaning it’s a type with some fields. Most of the types in your schema will be object types.</p>
</li>
<li><p><code>name</code> and <code>appearsIn</code> are <em>fields</em> on the <code>Character</code> type. That means that <code>name</code> and <code>appearsIn</code> are the only fields that can appear in any part of a GraphQL query that operates on the <code>Character</code> type.</p>
</li>
<li><p><code>String</code> is one of the built-in <em>scalar</em> types</p>
</li>
<li><p><code>String!</code> means that the field is <code>non-nullable</code>, meaning that the GraphQL service promises to always give you a value when you query this field.</p>
</li>
<li><p><code>[Episode]!</code> represents an <em>array</em> of <code>Episode</code> objects. Since it is also <em>non-nullable</em>, you can always expect an array ( with zero or more items) when you query the <code>appearsIn</code> field.</p>
</li>
</ul>
<h4 id="Arguments-1"><a href="#Arguments-1" class="headerlink" title="Arguments"></a>Arguments</h4><p>Every field on a GraphQL object type can have zero or more arguments, for example the <code>length</code> field below:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">type Starship &#123;</div><div class="line">  <span class="hljs-attr">id</span>: ID!</div><div class="line">  name: <span class="hljs-built_in">String</span>!</div><div class="line">  length(uint: LengthUint = METER): Float</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>All arguments are named.</p>
<h4 id="The-Query-and-Mutation-Types"><a href="#The-Query-and-Mutation-Types" class="headerlink" title="The Query and Mutation Types"></a>The Query and Mutation Types</h4><p>Most types in schema will just be normal object types, but there are two types that are special within a schema:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">schema &#123;</div><div class="line">  <span class="hljs-attr">query</span>: Query</div><div class="line">  mutation: Mutation</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Every GraphQL service has a <code>query</code> type and may not have a <code>mutation</code> type. These types are the same as a regular object type, but they are special because they define the <em>entry point</em> of every GraphQL query.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">query &#123;</div><div class="line">  hero &#123;</div><div class="line">    name</div><div class="line">  &#125;</div><div class="line">  droid(id: <span class="hljs-string">'2000'</span>) &#123;</div><div class="line">    name</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>That means that the GraphQL service needs to have a <code>Query</code> type with <code>hero</code> and <code>droid</code> fields:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">type Query &#123;</div><div class="line">  hero(episode: Episode): Character</div><div class="line">  droid(id: ID!): Droid</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Mutations work in a similar way - you define fields on the <code>Mutation</code> type, and those are available as the root mutation fields you can call in your query.</p>
<h4 id="Scalar-Types"><a href="#Scalar-Types" class="headerlink" title="Scalar Types"></a>Scalar Types</h4><ul>
<li><p><code>Int</code>: A signed 32-bit integer</p>
</li>
<li><p><code>Float</code>: A signed double-precision floating-point value</p>
</li>
<li><p><code>String</code>: A UTF-8 character sequence</p>
</li>
<li><p><code>Boolean</code>: true or false</p>
</li>
<li><p><code>ID</code>: The ID Scalar type represents a unique identifier, often used to refetch an object or as the key for a cache. The ID types serialized in the same way as a String; However, defining it as an <code>ID</code> signifies that it is not intended to be human-readable.</p>
</li>
</ul>
<p>In most GraphQL service implementation, there is also a way to specify custom scalar types.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">scalar <span class="hljs-built_in">Date</span></div></pre></td></tr></table></figure>
<h4 id="Enumeration-Types"><a href="#Enumeration-Types" class="headerlink" title="Enumeration Types"></a>Enumeration Types</h4><p>Also called <em>Enums</em>, enumeration types are a special kind of scalar that is restricted to a particular set of allowed values.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">enum Episode &#123;</div><div class="line">  NEWHOPE</div><div class="line">  EMPIRE</div><div class="line">  JEDI</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>This means that wherever we use the type <code>Episode</code> in our schema, we expect it to be exactly one of <code>NEWHOPE</code>, <code>EMPIRE</code>, <code>JEDI</code>.</p>
<h4 id="Lists-and-Non-Null"><a href="#Lists-and-Non-Null" class="headerlink" title="Lists and Non-Null"></a>Lists and Non-Null</h4><p>Object types, scalars, and enums are the only kinds of types you can define in GraphQL, but when you use the types in other parts of the schema, or in your query variable declarations, you can apply additional <em>type modifier</em> that affects validation of those values.</p>
<h4 id="Interfaces"><a href="#Interfaces" class="headerlink" title="Interfaces"></a>Interfaces</h4><p>An <em>Interface</em> is an abstract type that includes a certain set of fields that a type must include to implement the interface.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// define</span></div><div class="line">interface Character &#123;</div><div class="line">  <span class="hljs-attr">id</span>: ID!</div><div class="line">  name: <span class="hljs-built_in">String</span>!</div><div class="line">  friends: [Character]</div><div class="line">  appearsIn: [Episode]!</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-comment">// implement</span></div><div class="line">type Human implements Character &#123;</div><div class="line">  <span class="hljs-attr">id</span>: ID!</div><div class="line">  name: <span class="hljs-built_in">String</span>!</div><div class="line">  friends: [Character]</div><div class="line">  appearsIn: [Episode]!</div><div class="line">  starships: [Starship]</div><div class="line">  totalCredits: Int</div><div class="line">&#125;</div><div class="line"></div><div class="line">type Droid implements Character &#123;</div><div class="line">  <span class="hljs-attr">id</span>: ID!</div><div class="line">  name: <span class="hljs-built_in">String</span>!</div><div class="line">  friends: [Character]</div><div class="line">  appearsId: [Episode]!</div><div class="line">  primaryFunction: <span class="hljs-built_in">String</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Union-Types"><a href="#Union-Types" class="headerlink" title="Union Types"></a>Union Types</h4><p>Union Types are similar to interfaces, but they don’t get to specify any common fields between the types.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">union SearchResult = Human | Droid | Starship</div></pre></td></tr></table></figure>
<h4 id="Input-Types"><a href="#Input-Types" class="headerlink" title="Input Types"></a>Input Types</h4><p>In GraphQL schema language, input types look exactly the same as regular object types, but with the keyword <code>input</code> instead of <code>type</code>:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">input ReviewInput &#123;</div><div class="line">  <span class="hljs-attr">stars</span>: Int!</div><div class="line">  commentary: <span class="hljs-built_in">String</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">mutation CreateReviewForEpisode($ep: Episode!, <span class="hljs-attr">$review</span>: ReviewInput!) &#123;</div><div class="line">  createReview(episode: $ep, <span class="hljs-attr">review</span>: $review) &#123;</div><div class="line">    stars</div><div class="line">    commentary</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="hljs-comment">// Variables</span></div><div class="line"></div><div class="line">&#123;</div><div class="line">  <span class="hljs-string">"ep"</span>: <span class="hljs-string">"JEDI"</span>,</div><div class="line">  <span class="hljs-string">"review"</span>: &#123;</div><div class="line">    <span class="hljs-string">"stars"</span>: <span class="hljs-number">5</span>,</div><div class="line">    <span class="hljs-string">"commentary"</span>: <span class="hljs-string">"Commentary"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-03T07:18:35.000Z">2017-08-03</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    2 minutes read (About 226 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/03/List-of-HTTP-Status-Code/">List of HTTP Status Code</a>
            
        </h1>
        <div class="content">
            <h3 id="1xx"><a href="#1xx" class="headerlink" title="1xx"></a>1xx</h3><ul>
<li><p>100 (continue)</p>
</li>
<li><p>101 (Switching Protocols)</p>
</li>
</ul>
<h3 id="2xx"><a href="#2xx" class="headerlink" title="2xx"></a>2xx</h3><ul>
<li><p>200 (OK)</p>
</li>
<li><p>201 (Created): respond to POST Request in RESTFul.</p>
</li>
<li><p>202 (Accepted): Server fetch the request, but not respond immediately.</p>
</li>
<li><p>203 (Non-Authoritative Information).</p>
</li>
<li><p>204 (No Content): Server has handled the request, but no content need to be respond.</p>
</li>
<li><p>205 (Reset Content): Server has handled the request, and no content need to be respond. But server request client to reset the document(recover to that before submission).</p>
</li>
<li><p>206 (Partial Content): HTTP allowed transferring by piece of data.</p>
</li>
</ul>
<h3 id="3xx"><a href="#3xx" class="headerlink" title="3xx"></a>3xx</h3><p><code>3xx</code> request more operation from client, usually redirect to other page.</p>
<p>Destination redirect to will be specified in <code>Location</code> in header.</p>
<ul>
<li><p>301 (Moved Permanently): The resource has been moved to new position.</p>
</li>
<li><p>302 (Found): The resource will be returned from other url temporarily.</p>
</li>
<li><p>303 (See Other)</p>
</li>
<li><p>304 (Not Modified): Usually work with <code>Etag</code></p>
</li>
</ul>
<p>Server will return <code>304</code> with <code>Etag: &#39;***&#39;</code> to specify resource version. Next time the client request the resource with <code>If-None-Match: &#39;***&#39;</code>, and server checks if the <code>Etag</code> is same to <code>If-None-Match</code>. If same, then return 304.</p>
<h3 id="4xx"><a href="#4xx" class="headerlink" title="4xx"></a>4xx</h3><p>Client Error.</p>
<ul>
<li><p>400 (Bad Request)</p>
</li>
<li><p>401 (Unauthorized): Server responds with <code>WWW-Authenticate</code> for authorization info, and client should request with <code>authorization</code> in header next time.</p>
</li>
<li><p>403 (Forbidden): Server got the request, and refuse to handle.</p>
</li>
<li><p>404 (Method Not Allowed)</p>
</li>
<li><p>413 (Request Entity Too Large)</p>
</li>
<li><p>414 (Request-URI Too Large)</p>
</li>
</ul>
<h3 id="5xx"><a href="#5xx" class="headerlink" title="5xx"></a>5xx</h3><p>Server Error.</p>
<ul>
<li><p>500 (Internal Server Error): Server Bug.</p>
</li>
<li><p>502 (Bad Gateway): The Proxy receive invalid response from upstream server.</p>
</li>
<li><p>504 (Gateway Time-out).</p>
</li>
</ul>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-01T06:07:35.000Z">2017-08-01</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    12 minutes read (About 1727 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/01/Short-Clip-of-RxJS/">Short Clip of RxJS</a>
            
        </h1>
        <div class="content">
            <h3 id="Creation"><a href="#Creation" class="headerlink" title="Creation"></a>Creation</h3><p><code>Rx.Observable.create</code> is an alias for the <code>Observable</code> constructor, and it takes one argument: the <code>subscribe</code> function.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">var</span> observable = Rx.Observable.create(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">subscribe</span> (<span class="hljs-params">observer</span>) </span>&#123;</div><div class="line">  observer.next(<span class="hljs-number">1</span>)</div><div class="line">  <span class="hljs-comment">// ...</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>Observable can be created with <code>create</code>, but usually we use the so-called <code>creation operators</code>, like, <code>of</code>, <code>from</code>, <code>interval</code>, etc.</p>
<h3 id="Subscription"><a href="#Subscription" class="headerlink" title="Subscription"></a>Subscription</h3><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">observable.subscribe(&#123;</div><div class="line">  <span class="hljs-attr">next</span>: <span class="hljs-built_in">console</span>.log,</div><div class="line">  <span class="hljs-attr">error</span>: <span class="hljs-built_in">console</span>.error,</div><div class="line">  <span class="hljs-attr">complete</span>: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'done'</span>),</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>Subscribing to an Observable is like calling a function, providing callbacks where the data will be delivered to.</p>
<h3 id="Execution"><a href="#Execution" class="headerlink" title="Execution"></a>Execution</h3><p>The code inside <code>Observable.create(function subscribe (observer) { /*...*/ })</code> represents an <code>Observable execution</code>, a lazy computation that only happens for each Observer that subscribes. The execution produces multiple values over time, either synchronous or asynchronous.</p>
<p>There are three types of values on Observable Execution can deliver:</p>
<ul>
<li><p>‘Next’ notification: sends a value such as a Number, a String, an Object, etc.</p>
</li>
<li><p>‘Error’ notification: sends a JavaScript Error or exception.</p>
</li>
<li><p>‘Complete’ notification: does not send a value.</p>
</li>
</ul>
<p>In an Observable Execution, zero to infinite Next notifications may be delivered. If either an Error or Complete notification is delivered, then nothing else can be delivered afterwards.</p>
<p>It’s a good idea to wrap any code in <code>subscribe</code> with <code>try/catch</code> block that will deliver an Error notification if it catches an exception:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">var</span> observable = Rx.Observable.create(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">subscribe</span> (<span class="hljs-params">observer</span>) </span>&#123;</div><div class="line">  <span class="hljs-keyword">try</span>&#123;</div><div class="line">    observer.next(<span class="hljs-number">1</span>)</div><div class="line">    observer.next(<span class="hljs-number">2</span>)</div><div class="line">    observer.complete()</div><div class="line">  &#125; <span class="hljs-keyword">catch</span> (err) &#123;</div><div class="line">    observer.error(err)</div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="Disposing-Observable-Executions"><a href="#Disposing-Observable-Executions" class="headerlink" title="Disposing Observable Executions"></a>Disposing Observable Executions</h3><p>Because Observable Executions may be infinite, and it’s common for an Observer to want abort execution in finite time, we need an API for cancelling an execution. Since each execution is exclusive to one Observer only, once the Observer is done receiving values, it has to have a way to stop the execution, in order to avoid wasting computation power or memory resources.</p>
<p><code>observable.subscribe</code> will return the <code>Subscription</code> object.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">var</span> subscription = observable.subscribe(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(x))</div></pre></td></tr></table></figure>
<p>The <code>Subscription</code> represents the ongoing execution, and has a minimal API which allows you to cancel that execution.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">subscription.unsubscribe()</div></pre></td></tr></table></figure>
<p>When you subscribe, you get back a Subscription, which represents the ongoing execution. Just call <code>unsubscribe()</code> to cancel the execution.</p>
<p>You can return a custom <code>unsubscribe</code> function within <code>function subscribe()</code></p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">var</span> observale = Rx.Observable.create(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">subscribe</span> (<span class="hljs-params">observer</span>) </span>&#123;</div><div class="line">  <span class="hljs-keyword">var</span> intervalID = setInterval(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</div><div class="line">    observer.next(<span class="hljs-string">'hi'</span>)</div><div class="line">  &#125;, <span class="hljs-number">1000</span>)</div><div class="line"></div><div class="line">  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">unsubscribe</span>(<span class="hljs-params"></span>) </span>&#123;</div><div class="line">    clearInterval(intervalID)</div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="Observer"><a href="#Observer" class="headerlink" title="Observer"></a>Observer</h3><p>An Observer is a consumer of values delivered by an Observable. Observers are simply a set of callbacks, one of each type of notification delivered by the Observable: <code>next</code>, <code>error</code>, <code>complete</code>.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">var</span> observer = &#123;</div><div class="line">  <span class="hljs-attr">next</span>: <span class="hljs-built_in">console</span>.log,</div><div class="line">  <span class="hljs-attr">error</span>: <span class="hljs-built_in">console</span>.error,</div><div class="line">  <span class="hljs-attr">complete</span>: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'done'</span>),</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>To use the observer, provide it to the <code>subscirbe</code> of an Observable.</p>
<p>When subscribing to an Observable, you may also just provide the callbacks as arguments, without being attached to an Observer object.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">observable.subscribe(<span class="hljs-built_in">console</span>.log)</div><div class="line"><span class="hljs-comment">// it will be treated as</span></div><div class="line">observable.subscribe(&#123;</div><div class="line">  <span class="hljs-built_in">console</span>.log,</div><div class="line">  err =&gt; <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'Observer got an error: '</span> + err),</div><div class="line">  () =&gt; <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Observable got a complete notification'</span>),</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="Subscription-1"><a href="#Subscription-1" class="headerlink" title="Subscription"></a>Subscription</h3><p>A Subscription is an object that represents a disposable resource, usually the execution of an Observable. A subscription has one important method, <code>unsubscribe</code>, that takes no arguments and just disposes the resources held by the subscription.</p>
<p>Subscriptions can also be put together, so that a call to an <code>unsubscribe()</code> of one Subscription may unsubscribe multiple Subscriptions. You can do this by ‘ading’ one subscription into another:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">var</span> observable1 = Rx.Observable.interval(<span class="hljs-number">300</span>)</div><div class="line"><span class="hljs-keyword">var</span> observable2 = Rx.Observable.interval(<span class="hljs-number">500</span>)</div><div class="line"></div><div class="line"><span class="hljs-keyword">var</span> subscription = observable.subscribe(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'first: '</span> + x))</div><div class="line"><span class="hljs-keyword">var</span> childSubscription = observable2.subscribe(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'second: '</span> + x))</div><div class="line"></div><div class="line">subscription.ad(childSubscription)</div><div class="line">subscription.unsubscribe()</div></pre></td></tr></table></figure>
<h3 id="Subject"><a href="#Subject" class="headerlink" title="Subject"></a>Subject</h3><p>A RxJS Subject is a special type of Observable that allows values to multicasted to many Observers. While plain Observable are unicast(each subscribed Observer owns an independent execution of the Observable), Subjects are multicast.</p>
<p>A Subject is like an Observable, but can mutlicast to many Observers. Subjects are like <code>EventEmitter</code>: they maintain a registry of many listener.</p>
<p><code>Every Subject is an Observable</code>. Given a Subject, you can <code>subscribe</code> to it, providing an Observer, which will start receiving values normally.</p>
<p><code>Every Subject is an Observer</code>. It is an object with the methods <code>next()</code>, <code>error(e)</code>, and <code>complete()</code>.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">var</span> subject = <span class="hljs-keyword">new</span> Rx.Subject()</div><div class="line"></div><div class="line">subject.subscribe(&#123;</div><div class="line">  <span class="hljs-attr">next</span>: <span class="hljs-function">(<span class="hljs-params">v</span>) =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'observerA: '</span> + v)</div><div class="line">&#125;)</div><div class="line">subject.subscribe(&#123;</div><div class="line">  <span class="hljs-attr">next</span>: <span class="hljs-function">(<span class="hljs-params">v</span>) =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'observerB: '</span> + v)</div><div class="line">&#125;)</div><div class="line"><span class="hljs-comment">// as observable</span></div><div class="line">subject.next(<span class="hljs-number">1</span>)</div><div class="line">subject.next(<span class="hljs-number">2</span>)</div><div class="line"></div><div class="line"><span class="hljs-keyword">var</span> observable = Rx.Observable.from([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>])</div><div class="line"><span class="hljs-comment">// as observer</span></div><div class="line">observable.subscribe(subject)</div></pre></td></tr></table></figure>
<h3 id="multicasted-Observables"><a href="#multicasted-Observables" class="headerlink" title="multicasted Observables"></a>multicasted Observables</h3><p>A multicasted Observable uses a Subject under the hood to make multiple Observers see the same Observable execution.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">var</span> source = Rx.Observable.from([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>])</div><div class="line"><span class="hljs-keyword">var</span> subject = <span class="hljs-keyword">new</span> Rx.Subject()</div><div class="line"><span class="hljs-keyword">var</span> multicasted = source.multicast(subject)</div><div class="line"></div><div class="line"><span class="hljs-comment">// There are, under the hood, `subject.subscribe(&#123;...&#125;)`</span></div><div class="line">multicasted.subscribe(&#123;</div><div class="line">  <span class="hljs-attr">next</span>: <span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`observerA <span class="hljs-subst">$&#123;v&#125;</span>`</span>)</div><div class="line">&#125;)</div><div class="line">multicasted.subscribe(&#123;</div><div class="line">  <span class="hljs-attr">next</span>: <span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`observerB <span class="hljs-subst">$&#123;v&#125;</span>`</span>)</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="hljs-comment">// This is, under the hood, `source.subscribe(subject)`</span></div><div class="line">multicasted.connect()</div></pre></td></tr></table></figure>
<p><code>multicast</code> returns an Observable that looks like a normal Observale, but works like a subject when it comes to subscribing. <code>multicast</code> returns a <code>COnnectableObservable</code>, which is simply an Observable with the <code>connect</code> method.</p>
<p><strong>The <code>connect</code> method is important to determine exactly when the shared Observable execution will start</strong>. Because <code>connect()</code> does <code>source.subscribe(subject)</code> under the hood, <code>connect()</code> returns a Subscription, whcih you can unsubscribe from in order to cancel the shared Observable execution.</p>
<h3 id="Reference-Counting"><a href="#Reference-Counting" class="headerlink" title="Reference Counting"></a>Reference Counting</h3><p>Calling <code>connect()</code> manually and handling the Subscription is often cumbersome. Ususally we want to <em>automatically</em> connect when the first Observer arrives, and automatically cancel the shared execution when the last Observer unsubscribe.</p>
<p>Consider the following example where subscriptions occurs as outlined by this list:</p>
<ol>
<li>First Observer subscribes to the mutlicasted Observable.</li>
<li><strong>The multicasted Observable is connected</strong></li>
<li>The <code>next</code> value 0 is delivered to the first Observable.</li>
<li>Second Observer subscribes to the multicasted Observable.</li>
<li>The <code>next</code> value 1 is delivered to the first Observer.</li>
<li>The <code>next</code> value 1 is delivered to the second Observer.</li>
<li>First Observer unsubscribes from the mutlicasted Observable.</li>
<li>The <code>next</code> value 2 is delivered to the second Observer.</li>
<li>Second Observer unsubscribes from the mutlicasted Observable.</li>
<li><strong>The connection to the multicasted Observable is unsubscribed</strong>.</li>
</ol>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">var</span> source = Rx.Observable.interval(<span class="hljs-number">500</span>)</div><div class="line"><span class="hljs-keyword">var</span> subject = <span class="hljs-keyword">new</span> Rx.Subject()</div><div class="line"><span class="hljs-keyword">var</span> multicasted = source.multicast(subject)</div><div class="line"><span class="hljs-keyword">var</span> subscription1, subscription2, subscriptionConnect</div><div class="line"></div><div class="line">subscription1 = multicasted.subscribe(&#123;</div><div class="line">  <span class="hljs-attr">next</span>: <span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'observerA: '</span> + v)</div><div class="line">&#125;)</div><div class="line"></div><div class="line">subscriptionConnect = multicasted.connect()</div><div class="line"></div><div class="line">setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</div><div class="line">  subscription2 = multicasted.subscribe(&#123;</div><div class="line">    <span class="hljs-attr">next</span>: <span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'observerB: '</span> + v)</div><div class="line">  &#125;)</div><div class="line">&#125;, <span class="hljs-number">600</span>)</div><div class="line"></div><div class="line">setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</div><div class="line">  subscription1.unsubscribe()</div><div class="line">&#125;, <span class="hljs-number">1200</span>)</div><div class="line"></div><div class="line">setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</div><div class="line">  subscription2.unsubscribe()</div><div class="line">  subscriptionConnect.unsubscribe()</div><div class="line">&#125;, <span class="hljs-number">2000</span>)</div></pre></td></tr></table></figure>
<p>If we wish to avoid explicit calls to <code>connect()</code>, we can use ConnectableObservable’s <code>refCount()</code> method(reference Counting), which returns an Observable that keeps track of how many subscribers it has. When the number of subscribers increases from 0 to 1, it will call <code>connect()</code> for us, which starts the shared execution. Only when the number of subscribers decreases from 1 to 0 will it be fully unsubscribed, stopping further execution.</p>
<p><code>refCount</code> makes the multicasted Observable automatically start executing when the first subscriber arrives and stop executing when the last subscriber leaves.</p>
<p>Below is an example:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">var</span> source = Rx.Observable.interval(<span class="hljs-number">500</span>)</div><div class="line"><span class="hljs-keyword">var</span> subject = <span class="hljs-keyword">new</span> Rx.Subject()</div><div class="line"><span class="hljs-keyword">var</span> refCounted = source.multicast(subject).refCount()</div><div class="line"><span class="hljs-keyword">var</span> subscription1, subscription2, subscriptionConnect</div><div class="line"></div><div class="line"><span class="hljs-built_in">console</span>.log(<span class="hljs-string">'observerA subscribed'</span>)</div><div class="line">subscription1 = refCounted.subscribe(&#123;</div><div class="line">  <span class="hljs-attr">next</span>: <span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'observerA: '</span> + v)</div><div class="line">&#125;)</div><div class="line"></div><div class="line">setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</div><div class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'observerB subscribed'</span>)</div><div class="line">  subscription2 = refCounted.subscribe(&#123;</div><div class="line">    <span class="hljs-attr">next</span>: <span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'observerB: '</span> + v)</div><div class="line">  &#125;)</div><div class="line">&#125;, <span class="hljs-number">600</span>)</div><div class="line"></div><div class="line">setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</div><div class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'observerA unsubscribed'</span>)</div><div class="line">  subscription1.unsubscribe()</div><div class="line">&#125;, <span class="hljs-number">1200</span>)</div><div class="line"></div><div class="line">setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</div><div class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'observerB unsubscribed'</span>)</div><div class="line">  subscription2.unsubscribe()</div><div class="line">&#125;, <span class="hljs-number">2000</span>)</div></pre></td></tr></table></figure>
<p>The <code>refCount()</code> method only exists on ConnectableObservable, and it returns an <code>Observable</code>, not another ConnectableObservable.</p>
<h3 id="BehaviorSubject"><a href="#BehaviorSubject" class="headerlink" title="BehaviorSubject"></a>BehaviorSubject</h3><p>One of the variant of Subjects is the <code>BehaviorSubject</code>, which has a notion of ‘the current value’. It stores the latest value emitted to its consumers, and whenever a new Observer subscribes, it will immediately receive the ‘current value’ from the <code>BehaviorSubject</code>.</p>
<p>BehaviorSubjects are useful for representing ‘values over time’. For instance, an event stream of birthdays is a Subject, but the stream of a person’s age would be a BehaviorSubject.</p>
<h3 id="ReplaySubject"><a href="#ReplaySubject" class="headerlink" title="ReplaySubject"></a>ReplaySubject</h3><p>A <code>ReplaySubject</code> is similar to a <code>BehaviorSubject</code> in that it can send old values to new subscribers, but it can also <em>record</em> a part of the Observable execution.</p>
<p>A <code>ReplaySubject</code> records multiple values from the Observable execution and replays them to new subscribers.</p>
<p>When creating a <code>ReplaySubject</code>, you can specify how many values to replay:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">var</span> subject = <span class="hljs-keyword">new</span> Rx.ReplaySubject(<span class="hljs-number">3</span>) <span class="hljs-comment">// buffer 3 values for new subscribers</span></div><div class="line"></div><div class="line">subject.subscribe(&#123;</div><div class="line">  <span class="hljs-attr">next</span>: <span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'ObserverA: '</span> + v)</div><div class="line">&#125;)</div><div class="line"></div><div class="line">subject.next(<span class="hljs-number">1</span>)</div><div class="line">subject.next(<span class="hljs-number">2</span>)</div><div class="line">subject.next(<span class="hljs-number">3</span>)</div><div class="line">subject.next(<span class="hljs-number">4</span>)</div><div class="line"></div><div class="line">subject.subscribe(&#123;</div><div class="line">  <span class="hljs-attr">next</span>: <span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'ObserverB: '</span> + v)</div><div class="line">&#125;)</div><div class="line"></div><div class="line">subject.next(<span class="hljs-number">5</span>)</div></pre></td></tr></table></figure>
<p>You can also specify a <em>window time</em> in milliseconds, besides of the buffer size, to determine how old the recorded values can be.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">var</span> subject = <span class="hljs-keyword">new</span> Rx.ReplaySubject(<span class="hljs-number">3</span>, <span class="hljs-number">500</span>)</div><div class="line"></div><div class="line"><span class="hljs-comment">// ...</span></div></pre></td></tr></table></figure>
<h3 id="AsyncSubject"><a href="#AsyncSubject" class="headerlink" title="AsyncSubject"></a>AsyncSubject</h3><p>The AsyncSubject is a variant where only the last value of the Observale execution is sent to its observers, and only when the execution completes.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">var</span> subject = <span class="hljs-keyword">new</span> Rx.AsyncSubject()</div><div class="line"></div><div class="line">subject.subscribe(&#123;</div><div class="line">  <span class="hljs-attr">next</span>: <span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'ObserverA: '</span> + v)</div><div class="line">&#125;)</div><div class="line"></div><div class="line">subject.next(<span class="hljs-number">1</span>)</div><div class="line">subject.next(<span class="hljs-number">2</span>)</div><div class="line">subject.next(<span class="hljs-number">3</span>)</div><div class="line">subject.next(<span class="hljs-number">4</span>)</div><div class="line"></div><div class="line">subject.subscribe(&#123;</div><div class="line">  <span class="hljs-attr">next</span>: <span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'ObserverB: '</span> + v)</div><div class="line">&#125;)</div><div class="line"></div><div class="line">subject.next(<span class="hljs-number">5</span>)</div><div class="line">subject.complete()</div></pre></td></tr></table></figure>
<h3 id="Operators"><a href="#Operators" class="headerlink" title="Operators"></a>Operators</h3><p>An Operator is a function which creates a new Observable based on the current Observable. This is a pure operation: the previous Observable stays unmodified.</p>
<p>An Operator is essentially a pure function which takes one Observable as input and generates another Observable as output.</p>
<p>Subscirbing to the output Observable will also subscribe to the input Observable.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">multiplyTen</span>(<span class="hljs-params">input</span>) </span>&#123;</div><div class="line">  <span class="hljs-keyword">var</span> output = Rx.Observable.create(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">subscribe</span>(<span class="hljs-params">observer</span>) </span>&#123;</div><div class="line">    input.subscribe(&#123;</div><div class="line">      <span class="hljs-attr">next</span>: <span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> observer.next(<span class="hljs-number">10</span> * v),</div><div class="line">      <span class="hljs-attr">error</span>: <span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> observer.error(err),</div><div class="line">      <span class="hljs-attr">complete</span>: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> observer.compelte()</div><div class="line">    &#125;)</div><div class="line">  &#125;)</div><div class="line">  <span class="hljs-keyword">return</span> output</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-keyword">var</span> input = Rx.Observable.from([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>])</div><div class="line"><span class="hljs-keyword">var</span> output = multiplyTen(input)</div><div class="line">output.subscribe(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(x))</div></pre></td></tr></table></figure>
<p>Notice that a subscribe to <code>output</code> will cause <code>input</code> Observable to be subscirbed. It’s called <code>operator subscription chain</code>.</p>
<h3 id="Instance-Operators"><a href="#Instance-Operators" class="headerlink" title="Instance Operators"></a>Instance Operators</h3><p>Instance operators are methods on Observable instances.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">Rx.Observable.prototype.multiplyByTen = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">multiplyByTen</span> (<span class="hljs-params"></span>) </span>&#123;</div><div class="line">  <span class="hljs-keyword">var</span> input = <span class="hljs-keyword">this</span></div><div class="line">  <span class="hljs-keyword">return</span> Rx.Observable.create(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">subscirbe</span> (<span class="hljs-params">observer</span>) </span>&#123;</div><div class="line">    input.subscribe(&#123;</div><div class="line">      <span class="hljs-attr">next</span>: <span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> observer.next(<span class="hljs-number">10</span> * v),</div><div class="line">      <span class="hljs-attr">error</span>: <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> observer.error(err),</div><div class="line">      <span class="hljs-attr">complete</span>: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> observer.complete(),</div><div class="line">    &#125;)</div><div class="line">  &#125;)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-keyword">var</span> observable = Rx.Observable.from([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]).multiplyByTen()</div></pre></td></tr></table></figure>
<p>Instance operators are functions that use the <code>this</code> keyword to <code>infer</code> waht is the input Observable.</p>
<h3 id="Static-Operators"><a href="#Static-Operators" class="headerlink" title="Static Operators"></a>Static Operators</h3><p>Static operators are functions attached ot the Observable class directly. A static operator uses no <code>this</code> keyword internally, but instead relies entirely on its arguments.</p>
<p>Static Operators are usually used to create Observables from scratch.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">var</span> observable = Rx.Observable.interval(<span class="hljs-number">1000</span> <span class="hljs-comment">/* number of milliseconds */</span>)</div></pre></td></tr></table></figure>
<p>Some combination operators may be static, such as <code>merge</code>, <code>combineLatest</code>, <code>concat</code>, etc. These make sense as static operators because they take <code>multiple</code> Observables as input, not just one.</p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-01T04:07:29.000Z">2017-08-01</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    2 minutes read (About 233 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/01/http-cache-Etag-Last-Modified-Cache-Control/">Http Cache: Etag, Last-Modified, Cache-Control</a>
            
        </h1>
        <div class="content">
            <h3 id="Cache-Control"><a href="#Cache-Control" class="headerlink" title="Cache-Control"></a>Cache-Control</h3><p><code>Cache-Control</code> general-header field is used to specify deirectives that MUST be obeyed by all caching mechanisms along the request/response chain.</p>
<p>When the <code>Cache-Control</code> allow to cache, like <code>Cache-Control: public, max-age: 86400</code>, it means that in this day the browser can use the cahce directly without any request to server.a</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">import</span> http: <span class="hljs-string">'http'</span></div><div class="line"><span class="hljs-keyword">let</span> server = http.createServer(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</div><div class="line">  res.setHeader(<span class="hljs-string">'Cache-Control'</span>, <span class="hljs-string">'public'</span>, <span class="hljs-string">'max-age=86400'</span>)</div><div class="line">  res.end(<span class="hljs-string">'hello world'</span>)</div><div class="line">&#125;)</div><div class="line"></div><div class="line">server.listen(<span class="hljs-number">3000</span>)</div></pre></td></tr></table></figure>
<h3 id="Etag"><a href="#Etag" class="headerlink" title="Etag"></a>Etag</h3><p>Used for conditional HTTP request.</p>
<p><code>Etag</code> represents Version of Resource, browser will add <code>If-None-Match</code> in headers with request. If the resource on server has not been modified, code 304 will be returned.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">import</span> http <span class="hljs-keyword">from</span> <span class="hljs-string">'http'</span></div><div class="line"></div><div class="line"><span class="hljs-keyword">let</span> server = http.createServer(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</div><div class="line">  <span class="hljs-built_in">console</span>.log(req.url, req.headers[<span class="hljs-string">'if-none-match'</span>])</div><div class="line">  <span class="hljs-keyword">if</span> (req.headers[<span class="hljs-string">'if-none-match'</span>]) &#123;</div><div class="line">    <span class="hljs-comment">// check if resource modified</span></div><div class="line">    res.statusCode = <span class="hljs-number">304</span></div><div class="line">    res.end()</div><div class="line">  &#125; <span class="hljs-keyword">else</span> &#123;</div><div class="line">    res.setHeader(<span class="hljs-string">'Etag'</span>, <span class="hljs-string">'0000000'</span>)</div><div class="line">    res.end(<span class="hljs-string">'hello world'</span>)</div><div class="line">  &#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line">server.listen(<span class="hljs-number">3000</span>)</div></pre></td></tr></table></figure>
<h3 id="Last-Modified"><a href="#Last-Modified" class="headerlink" title="Last-Modified"></a>Last-Modified</h3><p>Similar to <code>Etag</code>, <code>Last-Modified</code> represents if the resource modified. It uses <code>time when modified</code> instead of <code>version tag</code>.</p>
<p>The key in header is <code>If-Modified-Since</code></p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">import</span> http <span class="hljs-keyword">from</span> <span class="hljs-string">'http'</span></div><div class="line"></div><div class="line"><span class="hljs-keyword">let</span> server = http.createServer(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</div><div class="line">  <span class="hljs-built_in">console</span>.log(req.url, req.headers[<span class="hljs-string">'if-modified-since'</span>])</div><div class="line">  <span class="hljs-keyword">if</span> (req.headers[<span class="hljs-string">'if-modified-since'</span>]) &#123;</div><div class="line">    <span class="hljs-comment">// check timestamp</span></div><div class="line">    res.statusCode = <span class="hljs-number">304</span></div><div class="line">    res.end()</div><div class="line">  &#125; <span class="hljs-keyword">else</span> &#123;</div><div class="line">    res.setHeader(<span class="hljs-string">'Last-Modified'</span>, <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().toString())</div><div class="line">    res.end(<span class="hljs-string">'hello world'</span>)</div><div class="line">  &#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line">server.listen(<span class="hljs-number">3000</span>)</div></pre></td></tr></table></figure>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-07-31T07:27:46.000Z">2017-07-31</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    3 minutes read (About 450 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/07/31/WebSocket-on-Node/">WS on Node</a>
            
        </h1>
        <div class="content">
            <h3 id="Create-WS-Server"><a href="#Create-WS-Server" class="headerlink" title="Create WS Server"></a>Create WS Server</h3><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// get WS Object</span></div><div class="line"><span class="hljs-keyword">const</span> WebSocket = <span class="hljs-built_in">require</span>(<span class="hljs-string">'ws'</span>)</div><div class="line"></div><div class="line"><span class="hljs-comment">// Create new Server Instance</span></div><div class="line"><span class="hljs-keyword">const</span> ws = <span class="hljs-keyword">new</span> WebSocket.Server(&#123;</div><div class="line">  <span class="hljs-attr">port</span>: <span class="hljs-number">80</span>, <span class="hljs-comment">// port</span></div><div class="line">  verifyClient: socketverify <span class="hljs-comment">// (optional)function to verify connection</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h4 id="new-WebSocket-Server-options-callback"><a href="#new-WebSocket-Server-options-callback" class="headerlink" title="new WebSocket.Server(options[, callback])"></a>new WebSocket.Server(options[, callback])</h4><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">options: &#123;</div><div class="line">  host: string,</div><div class="line">  port: number,</div><div class="line">  backlog: number, // the maximum length of the queue of pending connection.</div><div class="line">  server: http.Server | https.Server, // a pre-created Node Http Server.</div><div class="line">  verifyClient: function, // a function which can be used to validate incoming connections.</div><div class="line">  handleProtocols: function, // a function which can be used to handle the WebSocket subprotocols.</div><div class="line">  path: string, // Accept only connections matching this path.</div><div class="line">  noServer: boolean, // Enable no server mode.</div><div class="line">  clientTracking: boolean, // Specifies whether or not track clients.</div><div class="line">  perMessageDeflate: boolean | object, // Enable/Disable permessage-deflate.</div><div class="line">  maxPayload: number, // Maximum allowed message size in bytes.</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Create a new server instance. One of <code>port</code>, <code>server</code>, or <code>noServer</code> must be provided or an error is thrown.</p>
<h3 id="Set-VerifyClient"><a href="#Set-VerifyClient" class="headerlink" title="Set VerifyClient"></a>Set VerifyClient</h3><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">socketverify</span>(<span class="hljs-params">info</span>) </span>&#123;</div><div class="line">  <span class="hljs-comment">// connect if return true</span></div><div class="line">  <span class="hljs-keyword">var</span> origin = info.origin.match(<span class="hljs-comment">/*...*/</span>)</div><div class="line">  <span class="hljs-keyword">if</span> (<span class="hljs-comment">/*...*/</span>) &#123;</div><div class="line">    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span></div><div class="line">  &#125;</div><div class="line">  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>If <code>verifyClient</code> is not set then the handshake is automatically accepted. If it is is provided with a single argument then that is:</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">info: &#123;</div><div class="line">  origin: string, // The value in the Origin header indicated by the client.</div><div class="line">  req: http.incomingMessage, // The client HTTP GET request.</div><div class="line">  secure: boolean, // `true` is `req.connection.authorized` or `req.connection.encrypted` is set.</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>If the <code>verifyClient</code> provided with 2 arguments, the second one is <code>cb</code>, which accepts <code>result: boolean</code>, <code>code: number</code>, <code>name: string</code>.</p>
<h3 id="Handle-Request"><a href="#Handle-Request" class="headerlink" title="Handle Request"></a>Handle Request</h3><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">ws.on(<span class="hljs-string">'connect'</span>, (socket) =&gt; &#123;</div><div class="line">  <span class="hljs-comment">// the socket is a connect to client</span></div><div class="line">  <span class="hljs-comment">// usually you should push it in an array for management</span></div><div class="line">  socket.onmessage = message</div><div class="line">  socket.onclose = close</div><div class="line">  socket.onerror = error</div><div class="line">  socket.onopen = open</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">message</span>(<span class="hljs-params">msg</span>) </span>&#123;</div><div class="line">  <span class="hljs-comment">// ...</span></div><div class="line">&#125;</div><div class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">error</span>(<span class="hljs-params">err</span>) </span>&#123;</div><div class="line">  <span class="hljs-comment">// ...</span></div><div class="line">&#125;</div><div class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">close</span>(<span class="hljs-params"></span>) </span>&#123;</div><div class="line">  <span class="hljs-comment">// ...</span></div><div class="line">&#125;</div><div class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">open</span>(<span class="hljs-params"></span>) </span>&#123;</div><div class="line">  <span class="hljs-comment">// ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Events"><a href="#Events" class="headerlink" title="Events"></a>Events</h4><h3 id="Methods"><a href="#Methods" class="headerlink" title="Methods"></a>Methods</h3><h4 id="Sending-msg"><a href="#Sending-msg" class="headerlink" title="Sending msg"></a>Sending msg</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">socket.send(data[, options[, callback]])</div></pre></td></tr></table></figure>
<ul>
<li><p>data: binary or string</p>
</li>
<li><p>options:</p>
<ul>
<li><p>mask: true | false  是否使用掩码</p>
</li>
<li><p>binary: true | false 是否二进制流</p>
</li>
<li><p>compress: true | false 是否压缩</p>
</li>
</ul>
</li>
<li><p>callback: 回调</p>
</li>
</ul>
<h4 id="close-connection"><a href="#close-connection" class="headerlink" title="close connection"></a>close connection</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">socket.close([code], [data])</div></pre></td></tr></table></figure>
<ul>
<li><p>code: 返回一个状态码</p>
</li>
<li><p>data: 结束连接时发送的信息</p>
</li>
</ul>
<h4 id="pause"><a href="#pause" class="headerlink" title="pause"></a>pause</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">socket.pause()</div></pre></td></tr></table></figure>
<h4 id="resume"><a href="#resume" class="headerlink" title="resume"></a>resume</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">socket.resume()</div></pre></td></tr></table></figure>
<h4 id="PING"><a href="#PING" class="headerlink" title="PING"></a>PING</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">socket.ping([data], [options], [dontFailWhenClosed])</div></pre></td></tr></table></figure>
<ul>
<li><p>data: ping 的时候发送的信息</p>
</li>
<li><p>options: 同 send</p>
</li>
<li><p>dontFailWhenClosed: true | false // 如果连接断开, 是否抛出错误</p>
</li>
</ul>
<h4 id="PONG"><a href="#PONG" class="headerlink" title="PONG"></a>PONG</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">socket.pong([data], [options], [dontFailWhenClosed])</div></pre></td></tr></table></figure>
<p>Ping 和 Pong 的区别在于, 一个包含 ping 帧(0x9), 一个包含 pong 帧(0xA)</p>
<p>pong 是对于接到 ping 之后的回应, 让双方都知道连接还存在</p>
<h4 id="stream"><a href="#stream" class="headerlink" title="stream"></a>stream</h4><h4 id="terminate"><a href="#terminate" class="headerlink" title="terminate"></a>terminate</h4>
        </div>
        
        
        
    </div>
</div>









    
<div class="card card-transparent">
    <nav class="pagination is-centered" role="navigation" aria-label="pagination">
        <div class="pagination-previous">
            <a class="is-flex-grow has-text-black-ter" href="/page/4/">Previous</a>
        </div>
        <div class="pagination-next">
            <a class="is-flex-grow has-text-black-ter" href="/page/6/">Next</a>
        </div>
        <ul class="pagination-list is-hidden-mobile">
            
            <li><a class="pagination-link has-text-black-ter" href="/">1</a></li>
            
            <li><span class="pagination-ellipsis has-text-black-ter">&hellip;</span></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/4/">4</a></li>
            
            <li><a class="pagination-link is-current" href="/page/5/">5</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/6/">6</a></li>
            
            <li><span class="pagination-ellipsis has-text-black-ter">&hellip;</span></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/16/">16</a></li>
            
        </ul>
    </nav>
</div>
</div>
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered">
                <div>
                    
                        <img class="image is-128x128 has-mb-6" src="/images/avatar.jpg" alt="Keith Chen">
                    
                    
                    <p class="is-size-4 is-block">
                        Keith Chen
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        FE Engineer on Blockchain
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>30°17&#39;37N, 120°9&#39;41E</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Posts
                    </p>
                    <p class="title has-text-weight-normal">
                        309
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Categories
                    </p>
                    <p class="title has-text-weight-normal">
                        7
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Tags
                    </p>
                    <p class="title has-text-weight-normal">
                        93
                    </p>
                </div>
            </div>
        </nav>
        <div class="level">
            <a class="level-item button is-link is-rounded" href="https://github.com/keith-CY" target="_blank">
                Follow</a>
        </div>
        
        
    </div>
</div>
    
        
    
        

<div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Links
        </h3>
        <ul class="menu-list">
        
            <li>
                <a class="level is-mobile" href="https://github.com/keith-CY" target="_blank">
                    <span class="level-left">
                        <span class="level-item">Keith CY</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">github.com</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="https://www.linkedin.com/in/宇-陈-644b61ba" target="_blank">
                    <span class="level-left">
                        <span class="level-item">Yu Chen</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">www.linkedin.com</span>
                    </span>
                </a>
            </li>
        
        </ul>
        </div>
    </div>
</div>


    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Categories
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/Soup/">
            <span class="level-start">
                <span class="level-item">Soup</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Uncategorized/">
            <span class="level-start">
                <span class="level-item">Uncategorized</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/github/">
            <span class="level-start">
                <span class="level-item">github</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">4</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/github/note/">
            <span class="level-start">
                <span class="level-item">note</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/note/">
            <span class="level-start">
                <span class="level-item">note</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">141</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/note/workNote/">
            <span class="level-start">
                <span class="level-item">workNote</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">19</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/workNote/">
            <span class="level-start">
                <span class="level-item">workNote</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">5</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Tag Cloud
        </h3>
        <a href="/tags/AJAX/" style="font-size: 10.91px;">AJAX</a> <a href="/tags/BOOTSTRAP/" style="font-size: 10px;">BOOTSTRAP</a> <a href="/tags/Bash/" style="font-size: 11.82px;">Bash</a> <a href="/tags/BlockChain/" style="font-size: 10px;">BlockChain</a> <a href="/tags/Blockchain/" style="font-size: 10px;">Blockchain</a> <a href="/tags/CORS/" style="font-size: 10px;">CORS</a> <a href="/tags/CSS/" style="font-size: 10.91px;">CSS</a> <a href="/tags/CSS3/" style="font-size: 20px;">CSS3</a> <a href="/tags/Closure/" style="font-size: 10px;">Closure</a> <a href="/tags/CommonJS/" style="font-size: 10px;">CommonJS</a> <a href="/tags/Contract-Ethereum-Web3/" style="font-size: 10px;">Contract, Ethereum, Web3</a> <a href="/tags/Contract-Solidity/" style="font-size: 10px;">Contract, Solidity</a> <a href="/tags/D3-Example/" style="font-size: 10px;">D3, Example</a> <a href="/tags/DAPP-Solidity/" style="font-size: 10px;">DAPP, Solidity</a> <a href="/tags/DApp-Solidity/" style="font-size: 10px;">DApp, Solidity</a> <a href="/tags/DOM/" style="font-size: 12.73px;">DOM</a> <a href="/tags/DevTools/" style="font-size: 10px;">DevTools</a> <a href="/tags/Drizzle-Ethereum-BlockChain/" style="font-size: 10px;">Drizzle, Ethereum, BlockChain</a> <a href="/tags/ES6/" style="font-size: 10.91px;">ES6</a> <a href="/tags/ESLint/" style="font-size: 10px;">ESLint</a> <a href="/tags/ETH-Wallet/" style="font-size: 10px;">ETH, Wallet</a> <a href="/tags/Elixir-Phoenix-SCSS/" style="font-size: 10px;">Elixir, Phoenix, SCSS</a> <a href="/tags/Erlang-Elixir-GenServer/" style="font-size: 10px;">Erlang, Elixir, GenServer</a> <a href="/tags/Ethereum/" style="font-size: 10px;">Ethereum</a> <a href="/tags/Ethereum-IPFS/" style="font-size: 10px;">Ethereum, IPFS</a> <a href="/tags/FP/" style="font-size: 10px;">FP</a> <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/GitHub-Workflow/" style="font-size: 10px;">GitHub, Workflow</a> <a href="/tags/Go-Http-Web/" style="font-size: 10px;">Go, Http, Web</a> <a href="/tags/GraphQL-Apollo-TypeScript/" style="font-size: 10px;">GraphQL, Apollo, TypeScript</a> <a href="/tags/Gulp/" style="font-size: 11.82px;">Gulp</a> <a href="/tags/HTML5/" style="font-size: 15.45px;">HTML5</a> <a href="/tags/HTTP2-Node/" style="font-size: 10px;">HTTP2, Node</a> <a href="/tags/Html-Picture/" style="font-size: 10px;">Html, Picture</a> <a href="/tags/Immutable/" style="font-size: 10px;">Immutable</a> <a href="/tags/Int8Array/" style="font-size: 10px;">Int8Array</a> <a href="/tags/JSON-RPC/" style="font-size: 10px;">JSON-RPC</a> <a href="/tags/JavaScript/" style="font-size: 10px;">JavaScript</a> <a href="/tags/Javascript/" style="font-size: 19.09px;">Javascript</a> <a href="/tags/Koa/" style="font-size: 10.91px;">Koa</a> <a href="/tags/Koa-NPM-Package/" style="font-size: 10px;">Koa, NPM, Package</a> <a href="/tags/MDL/" style="font-size: 16.36px;">MDL</a> <a href="/tags/Material-Design/" style="font-size: 17.27px;">Material Design</a> <a href="/tags/Mock-JavaScript/" style="font-size: 10px;">Mock, JavaScript</a> <a href="/tags/MySQL/" style="font-size: 10px;">MySQL</a> <a href="/tags/NODE/" style="font-size: 13.64px;">NODE</a> <a href="/tags/NPM/" style="font-size: 10.91px;">NPM</a> <a href="/tags/Nginx/" style="font-size: 10px;">Nginx</a> <a href="/tags/Nock/" style="font-size: 10px;">Nock</a> <a href="/tags/Node-CLI/" style="font-size: 10.91px;">Node, CLI</a> <a href="/tags/Node-Fastify/" style="font-size: 10.91px;">Node, Fastify</a> <a href="/tags/Node-Graphql-Koa/" style="font-size: 10px;">Node, Graphql, Koa</a> <a href="/tags/Node-js/" style="font-size: 10.91px;">Node.js</a> <a href="/tags/Node-js-Nest-js/" style="font-size: 10px;">Node.js, Nest.js</a> <a href="/tags/Phoenix-Elixir-Ecto/" style="font-size: 10px;">Phoenix, Elixir, Ecto</a> <a href="/tags/Promise/" style="font-size: 11.82px;">Promise</a> <a href="/tags/Protobuf/" style="font-size: 10px;">Protobuf</a> <a href="/tags/Pug-HTML/" style="font-size: 10px;">Pug, HTML</a> <a href="/tags/React/" style="font-size: 18.18px;">React</a> <a href="/tags/React-Docker/" style="font-size: 10px;">React, Docker</a> <a href="/tags/React-Router-Code-splitting/" style="font-size: 10px;">React, Router, Code-splitting</a> <a href="/tags/React-Native/" style="font-size: 10px;">React-Native</a> <a href="/tags/React-Redux/" style="font-size: 10px;">React-Redux</a> <a href="/tags/React-Router/" style="font-size: 10.91px;">React-Router</a> <a href="/tags/Redux/" style="font-size: 14.55px;">Redux</a> <a href="/tags/RegExp/" style="font-size: 10px;">RegExp</a> <a href="/tags/Ruby-Rails/" style="font-size: 10px;">Ruby, Rails</a> <a href="/tags/Ruby-Rails-RoR-Mina/" style="font-size: 10px;">Ruby, Rails, RoR, Mina</a> <a href="/tags/Rust-Rocket/" style="font-size: 10px;">Rust, Rocket</a> <a href="/tags/RxJS/" style="font-size: 10px;">RxJS</a> <a href="/tags/Smart-Contract-Web3/" style="font-size: 10px;">Smart Contract, Web3</a> <a href="/tags/Solidity/" style="font-size: 12.73px;">Solidity</a> <a href="/tags/Solidity-Error-Handling/" style="font-size: 10px;">Solidity, Error Handling</a> <a href="/tags/Solidity-Public-External/" style="font-size: 10px;">Solidity, Public, External</a> <a href="/tags/Solidity-Smart-Contract/" style="font-size: 10px;">Solidity, Smart Contract</a> <a href="/tags/Thunk/" style="font-size: 10.91px;">Thunk</a> <a href="/tags/Trick/" style="font-size: 11.82px;">Trick</a> <a href="/tags/Web/" style="font-size: 10px;">Web</a> <a href="/tags/Webpack/" style="font-size: 10px;">Webpack</a> <a href="/tags/Webpack-DLL/" style="font-size: 10px;">Webpack, DLL</a> <a href="/tags/automatic/" style="font-size: 10px;">automatic</a> <a href="/tags/babel/" style="font-size: 10px;">babel</a> <a href="/tags/babel-polyfill/" style="font-size: 10px;">babel-polyfill</a> <a href="/tags/blockchain-bitcoin-bip/" style="font-size: 10.91px;">blockchain, bitcoin, bip</a> <a href="/tags/commandline/" style="font-size: 10px;">commandline</a> <a href="/tags/github/" style="font-size: 10.91px;">github</a> <a href="/tags/jQuery/" style="font-size: 10px;">jQuery</a> <a href="/tags/lecture-yc/" style="font-size: 10px;">lecture, yc</a> <a href="/tags/precache/" style="font-size: 10px;">precache</a> <a href="/tags/shell/" style="font-size: 10px;">shell</a> <a href="/tags/webpack/" style="font-size: 17.27px;">webpack</a> <a href="/tags/webpack2/" style="font-size: 11.82px;">webpack2</a> <a href="/tags/测试/" style="font-size: 11.82px;">测试</a>
    </div>
</div>

    
    
        <div class="column-right-shadow is-hidden-widescreen ">
        
            
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Recent
        </h3>
        
        <article class="media">
            
            <a href="/2019/10/10/Basic-components-in-nest-js/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/gallery/thumbnails/nestjs_components.png" alt="Basic Components in nest.js">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-10-10T06:26:41.000Z">2019-10-10</time></div>
                    <a href="/2019/10/10/Basic-components-in-nest-js/" class="has-link-black-ter is-size-6">Basic Components in nest.js</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/09/16/Snippet-of-GitHub-Actions/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/gallery/thumbnails/github_actions.png" alt="Snippet of GitHub Actions">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-09-16T07:14:02.000Z">2019-09-16</time></div>
                    <a href="/2019/09/16/Snippet-of-GitHub-Actions/" class="has-link-black-ter is-size-6">Snippet of GitHub Actions</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/08/30/Methods-of-the-String-in-JavaScript/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Methods of the String in JavaScript ">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-08-30T06:26:54.000Z">2019-08-30</time></div>
                    <a href="/2019/08/30/Methods-of-the-String-in-JavaScript/" class="has-link-black-ter is-size-6">Methods of the String in JavaScript </a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/04/20/note-on-bip-173/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/gallery/thumbnails/segwit.png" alt="Note-on-Bip-173">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-04-20T08:36:54.000Z">2019-04-20</time></div>
                    <a href="/2019/04/20/note-on-bip-173/" class="has-link-black-ter is-size-6">Note-on-Bip-173</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/04/17/notes-of-building-product-talking-to-users-and-growing/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="[WIP]notes of Building Product, Talking to Users and Growing">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-04-17T03:32:32.000Z">2019-04-17</time></div>
                    <a href="/2019/04/17/notes-of-building-product-talking-to-users-and-growing/" class="has-link-black-ter is-size-6">[WIP]notes of Building Product, Talking to Users and Growing</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>

        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Archives
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2019/10/">
                <span class="level-start">
                    <span class="level-item">October 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/09/">
                <span class="level-start">
                    <span class="level-item">September 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/08/">
                <span class="level-start">
                    <span class="level-item">August 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/04/">
                <span class="level-start">
                    <span class="level-item">April 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/03/">
                <span class="level-start">
                    <span class="level-item">March 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/11/">
                <span class="level-start">
                    <span class="level-item">November 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/09/">
                <span class="level-start">
                    <span class="level-item">September 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/08/">
                <span class="level-start">
                    <span class="level-item">August 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/07/">
                <span class="level-start">
                    <span class="level-item">July 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/05/">
                <span class="level-start">
                    <span class="level-item">May 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/04/">
                <span class="level-start">
                    <span class="level-item">April 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/03/">
                <span class="level-start">
                    <span class="level-item">March 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/02/">
                <span class="level-start">
                    <span class="level-item">February 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/01/">
                <span class="level-start">
                    <span class="level-item">January 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/12/">
                <span class="level-start">
                    <span class="level-item">December 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/11/">
                <span class="level-start">
                    <span class="level-item">November 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">12</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/10/">
                <span class="level-start">
                    <span class="level-item">October 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/09/">
                <span class="level-start">
                    <span class="level-item">September 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">18</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/08/">
                <span class="level-start">
                    <span class="level-item">August 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">31</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/07/">
                <span class="level-start">
                    <span class="level-item">July 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">19</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/06/">
                <span class="level-start">
                    <span class="level-item">June 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">14</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/05/">
                <span class="level-start">
                    <span class="level-item">May 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">15</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/04/">
                <span class="level-start">
                    <span class="level-item">April 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">9</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/03/">
                <span class="level-start">
                    <span class="level-item">March 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/02/">
                <span class="level-start">
                    <span class="level-item">February 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/01/">
                <span class="level-start">
                    <span class="level-item">January 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/12/">
                <span class="level-start">
                    <span class="level-item">December 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/11/">
                <span class="level-start">
                    <span class="level-item">November 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/10/">
                <span class="level-start">
                    <span class="level-item">October 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/09/">
                <span class="level-start">
                    <span class="level-item">September 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">16</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/08/">
                <span class="level-start">
                    <span class="level-item">August 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">30</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/07/">
                <span class="level-start">
                    <span class="level-item">July 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">43</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/06/">
                <span class="level-start">
                    <span class="level-item">June 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">25</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/05/">
                <span class="level-start">
                    <span class="level-item">May 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">24</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
        
        </div>
    
</div>

                




<div class="column is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only has-order-3 column-right ">
    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Recent
        </h3>
        
        <article class="media">
            
            <a href="/2019/10/10/Basic-components-in-nest-js/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/gallery/thumbnails/nestjs_components.png" alt="Basic Components in nest.js">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-10-10T06:26:41.000Z">2019-10-10</time></div>
                    <a href="/2019/10/10/Basic-components-in-nest-js/" class="has-link-black-ter is-size-6">Basic Components in nest.js</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/09/16/Snippet-of-GitHub-Actions/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/gallery/thumbnails/github_actions.png" alt="Snippet of GitHub Actions">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-09-16T07:14:02.000Z">2019-09-16</time></div>
                    <a href="/2019/09/16/Snippet-of-GitHub-Actions/" class="has-link-black-ter is-size-6">Snippet of GitHub Actions</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/08/30/Methods-of-the-String-in-JavaScript/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Methods of the String in JavaScript ">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-08-30T06:26:54.000Z">2019-08-30</time></div>
                    <a href="/2019/08/30/Methods-of-the-String-in-JavaScript/" class="has-link-black-ter is-size-6">Methods of the String in JavaScript </a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/04/20/note-on-bip-173/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/gallery/thumbnails/segwit.png" alt="Note-on-Bip-173">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-04-20T08:36:54.000Z">2019-04-20</time></div>
                    <a href="/2019/04/20/note-on-bip-173/" class="has-link-black-ter is-size-6">Note-on-Bip-173</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/04/17/notes-of-building-product-talking-to-users-and-growing/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="[WIP]notes of Building Product, Talking to Users and Growing">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-04-17T03:32:32.000Z">2019-04-17</time></div>
                    <a href="/2019/04/17/notes-of-building-product-talking-to-users-and-growing/" class="has-link-black-ter is-size-6">[WIP]notes of Building Product, Talking to Users and Growing</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>

    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Archives
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2019/10/">
                <span class="level-start">
                    <span class="level-item">October 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/09/">
                <span class="level-start">
                    <span class="level-item">September 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/08/">
                <span class="level-start">
                    <span class="level-item">August 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/04/">
                <span class="level-start">
                    <span class="level-item">April 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/03/">
                <span class="level-start">
                    <span class="level-item">March 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/11/">
                <span class="level-start">
                    <span class="level-item">November 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/09/">
                <span class="level-start">
                    <span class="level-item">September 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/08/">
                <span class="level-start">
                    <span class="level-item">August 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/07/">
                <span class="level-start">
                    <span class="level-item">July 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/05/">
                <span class="level-start">
                    <span class="level-item">May 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/04/">
                <span class="level-start">
                    <span class="level-item">April 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/03/">
                <span class="level-start">
                    <span class="level-item">March 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/02/">
                <span class="level-start">
                    <span class="level-item">February 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/01/">
                <span class="level-start">
                    <span class="level-item">January 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/12/">
                <span class="level-start">
                    <span class="level-item">December 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/11/">
                <span class="level-start">
                    <span class="level-item">November 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">12</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/10/">
                <span class="level-start">
                    <span class="level-item">October 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/09/">
                <span class="level-start">
                    <span class="level-item">September 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">18</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/08/">
                <span class="level-start">
                    <span class="level-item">August 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">31</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/07/">
                <span class="level-start">
                    <span class="level-item">July 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">19</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/06/">
                <span class="level-start">
                    <span class="level-item">June 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">14</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/05/">
                <span class="level-start">
                    <span class="level-item">May 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">15</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/04/">
                <span class="level-start">
                    <span class="level-item">April 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">9</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/03/">
                <span class="level-start">
                    <span class="level-item">March 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/02/">
                <span class="level-start">
                    <span class="level-item">February 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/01/">
                <span class="level-start">
                    <span class="level-item">January 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/12/">
                <span class="level-start">
                    <span class="level-item">December 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/11/">
                <span class="level-start">
                    <span class="level-item">November 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/10/">
                <span class="level-start">
                    <span class="level-item">October 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/09/">
                <span class="level-start">
                    <span class="level-item">September 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">16</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/08/">
                <span class="level-start">
                    <span class="level-item">August 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">30</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/07/">
                <span class="level-start">
                    <span class="level-item">July 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">43</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/06/">
                <span class="level-start">
                    <span class="level-item">June 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">25</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/05/">
                <span class="level-start">
                    <span class="level-item">May 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">24</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
    
    
</div>

            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/logo.png" alt="EzCook" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2019 Chen Yu&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a
                        href="http://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a>
                
                <br>
                <span id="busuanzi_container_site_uv">
                Visited by <span id="busuanzi_value_site_uv">0</span> users
                </span>
                
                </p>
            </div>
            <div class="level-end">
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("en");</script>


    
    
    
    <script src="/js/animation.js"></script>
    

    
    
    
    <script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
    <script src="/js/gallery.js" defer></script>
    

    
    

<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


    
    
<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>

    
    

<a id="back-to-top" title="Back to Top" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>


    
    

    
    
    
    
    
    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>
    <script src="/js/clipboard.js" defer></script>
    

    
    
    

    


<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>
</html>