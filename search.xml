<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>RSS for Next.js</title>
      <link href="/2021/02/17/rss-for-next-js/"/>
      <url>/2021/02/17/rss-for-next-js/</url>
      
        <content type="html"><![CDATA[<h2 id="What-is-an-RSS-feed"><a href="#What-is-an-RSS-feed" class="headerlink" title="What is an RSS feed"></a>What is an RSS feed</h2><p>RSS(RDF Site Summary or Really Simple Syndication) feed is an XML file for subscribers to fetch recently updated content. It is a specific page on a website(usually <code>/rss.xml</code>) which returns all, or part of a website’s content in a listed structured XML format.</p><h2 id="Why-do-you-need-an-RSS-feed"><a href="#Why-do-you-need-an-RSS-feed" class="headerlink" title="Why do you need an RSS feed"></a>Why do you need an RSS feed</h2><p>RSS feed is an important part of any website that has frequent updates. With RSS, your subscribers can easily get your new update and have immediate interaction on it.</p><h2 id="How-to-create-rss-feed-in-Next-js"><a href="#How-to-create-rss-feed-in-Next-js" class="headerlink" title="How to create rss feed in Next.js"></a>How to create rss feed in Next.js</h2><p><em>We will do this work based on <a href="https://github.com/vercel/next.js/tree/canary/examples/blog-starter">next-blog-starter</a></em></p><p>Create a <code>rss.js</code> file in the <code>lib</code> directory with the following codes:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; BLOG_URL, BLOG_TITLE &#125; <span class="keyword">from</span> <span class="string">&#x27;lib/constants&#x27;</span></span><br><span class="line"><span class="keyword">import</span> markdownToHtml <span class="keyword">from</span> <span class="string">&#x27;lib/markdownToHtml&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> generateRssItem = <span class="keyword">async</span> (post) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> content = <span class="keyword">await</span> markdownToHtml(post.content ?? <span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;item&gt;</span></span><br><span class="line"><span class="string">      &lt;guid&gt;<span class="subst">$&#123;BLOG_URL&#125;</span>/posts/<span class="subst">$&#123;post.slug&#125;</span>&lt;/guid&gt;</span></span><br><span class="line"><span class="string">      &lt;title&gt;<span class="subst">$&#123;post.title&#125;</span>&lt;/title&gt;</span></span><br><span class="line"><span class="string">      &lt;description&gt;<span class="subst">$&#123;post.excerpt&#125;</span>&lt;/description&gt;</span></span><br><span class="line"><span class="string">      &lt;link&gt;<span class="subst">$&#123;BLOG_URL&#125;</span>/posts/<span class="subst">$&#123;post.slug&#125;</span>&lt;/link&gt;</span></span><br><span class="line"><span class="string">      &lt;pubDate&gt;<span class="subst">$&#123;<span class="keyword">new</span> <span class="built_in">Date</span>(post.date).toUTCString()&#125;</span>&lt;/pubDate&gt;</span></span><br><span class="line"><span class="string">      &lt;content:encoded&gt;&lt;![CDATA[$<span class="subst">$&#123;content&#125;</span>]]&gt;&lt;/content:encoded&gt;</span></span><br><span class="line"><span class="string">    &lt;/item&gt;</span></span><br><span class="line"><span class="string">  `</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> generateRss = <span class="keyword">async</span> (posts) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> itemList = <span class="keyword">await</span> <span class="built_in">Promise</span>.all(posts.map(generateRssItem))</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;rss xmlns:dc=&quot;http://purl.org/dc/elements/1.1/&quot; xmlns:content=&quot;http://purl.org/rss/1.0/modules/content/&quot; xmlns:atom=&quot;http://www.w3.org/2005/Atom&quot; xmlns:media=&quot;http://search.yahoo.com/mrss/&quot; version=&quot;2.0&quot;&gt;</span></span><br><span class="line"><span class="string">      &lt;channel&gt;</span></span><br><span class="line"><span class="string">        &lt;title&gt;<span class="subst">$&#123;BLOG_TITLE&#125;</span>&lt;/title&gt;</span></span><br><span class="line"><span class="string">        &lt;link&gt;<span class="subst">$&#123;BLOG_URL&#125;</span>&lt;/link&gt;</span></span><br><span class="line"><span class="string">        &lt;lastBuildDate&gt;<span class="subst">$&#123;<span class="keyword">new</span> <span class="built_in">Date</span>(posts[<span class="number">0</span>].date).toUTCString()&#125;</span>&lt;/lastBuildDate&gt;</span></span><br><span class="line"><span class="string">        &lt;atom:link href=&quot;<span class="subst">$&#123;BLOG_URL&#125;</span>&quot; rel=&quot;self&quot; type=&quot;application/rss+xml&quot; /&gt;</span></span><br><span class="line"><span class="string">        <span class="subst">$&#123;itemList.join(<span class="string">&#x27;&#x27;</span>)&#125;</span></span></span><br><span class="line"><span class="string">      &lt;/channel&gt;</span></span><br><span class="line"><span class="string">    &lt;/rss&gt;</span></span><br><span class="line"><span class="string">  `</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Generate-Rss-Feed-XML-at-building-time"><a href="#Generate-Rss-Feed-XML-at-building-time" class="headerlink" title="Generate Rss Feed XML at building time"></a>Generate Rss Feed XML at building time</h2><p>To do so, we just need to generate the xml file in <code>getStaticProps</code> which is called at building time and write the result of <code>generateRss</code> into the <code>public</code> directory.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getStaticProps = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> posts = getAllPosts([<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;date&#x27;</span>, <span class="string">&#x27;slug&#x27;</span>, <span class="string">&#x27;excerpt&#x27;</span>, <span class="string">&#x27;content&#x27;</span>])</span><br><span class="line">  <span class="keyword">const</span> rss = <span class="keyword">await</span> generateRss(posts)</span><br><span class="line">  fs.writeFileSync(path.join(process.cwd(), <span class="string">&#x27;public&#x27;</span>, <span class="string">&#x27;rss.xml&#x27;</span>), rss)</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    props: &#123;</span><br><span class="line">      allPosts,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Start the server and visit <code>localhost:3000/rss.xml</code> you can fetch your rss feed right now.</p><p>Tip: Remember to include <code>public/rss.xml</code> in the <code>.gitignore</code> file.</p>]]></content>
      
      
      
        <tags>
            
            <tag> Headless </tag>
            
            <tag> Tool </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Learning From Failure</title>
      <link href="/2020/12/27/Learning-from-Failure/"/>
      <url>/2020/12/27/Learning-from-Failure/</url>
      
        <content type="html"><![CDATA[<p>This is a brief note on <a href="https://sre.google/sre-book/postmortem-culture/">Postmortem Culture: Learning from Failure</a></p><blockquote><p>The cost of failure is education - Devin Carraway</p></blockquote><p>The postmortem concept is well known in technology industries, it’s a written record of an indicent and its impact, the actions taken to mitigate or resolve the issue, the root-causes and the follow-up actions to prevent likelihood of recurring.</p><p>The primary goals of writing a postmortem are to ensure that the incident is documented, that all contributing root causes are well understood, and, especially that the effective preventive actions are put in place to reduce them.</p><p>Writing a postmortem is not punishment - it is a learning oppotunity for the entire system.</p><h2 id="Don’t-be-critic"><a href="#Don’t-be-critic" class="headerlink" title="Don’t be critic"></a>Don’t be critic</h2><p>Blameless postmortems are a tenet of SRE culture. For a postmortem to be blameless, it must focus on identifying the contributing causes of the incident without indicting any individual or team for bad or inappropriate behavior. A blameless written postmortem assumes that everyone involved in an incident had good intentions and did the right thing with the information they had. If a culture of finger pointing and shaming individuals or teams for doing the “wrong” thing prevails, people will not bring issues to light for fear of punishment.</p><p>Blameless culture originated in the healthcare and avionics industries where mistakes can be fatal. These industries nurture an enviroment where every “mistake” is seen as an oppotunity to strengthen the system. When postmortems shift from allocating blames to investigating the systematic reasons <strong>why an individual or team has incomplete or incorrect information</strong>, effective prevention plans can be put in place. <strong>You can’t “fix” people, but you can fix systems and processes to better support people making the right choices when designing and maintaining complex systems</strong>.</p><h2 id="Keep-it-in-mind"><a href="#Keep-it-in-mind" class="headerlink" title="Keep it in mind"></a>Keep it in mind</h2><blockquote><p>Avoid Blame and Keep It Constructive</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Soup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Project </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rules for My Code to Be Reviewed</title>
      <link href="/2020/12/23/Rules-for-my-code-to-be-reviewed/"/>
      <url>/2020/12/23/Rules-for-my-code-to-be-reviewed/</url>
      
        <content type="html"><![CDATA[<p>I’ve read a post <a href="https://mtlynch.io/code-review-love/">How to Make Your Code Reviewer Fall in Love with You</a> and found some rules for myself.</p><p>One rule to rules all rules.</p><blockquote><p>Value your reviewer’s time.</p></blockquote><h2 id="Rule-1"><a href="#Rule-1" class="headerlink" title="Rule 1"></a>Rule 1</h2><p>Review my code first before sending request to my teammates. And do not just check mistakes, imagine that I’m reading it the first time and what might lead myself into a muddle.</p><h2 id="Rule-2"><a href="#Rule-2" class="headerlink" title="Rule 2"></a>Rule 2</h2><p>Write a clear changelist description. A good changelist explains <strong>what</strong> the change achieves and <strong>why</strong> they should be changed. Remember that the changelist is not just for my teammates, they might be read by my followers in the future, or by my partners through our promotion. Thus, the changelist should summarize any background knowledge the reader needs.</p><h2 id="Rule-3"><a href="#Rule-3" class="headerlink" title="Rule 3"></a>Rule 3</h2><p>Answer questions with the code itself. When my reviewer expresses confusion about how the code works, the solution isn’t to explain it to that one person, but explain it to <em>everyone</em>.</p><h2 id="Rule-5"><a href="#Rule-5" class="headerlink" title="Rule 5"></a>Rule 5</h2><p>Narrowly scope changes. The best changelist just <em>do one thing</em>. The smaller and simpler the change, the easier it is for the reviewer to keel all the context in their head.</p><p>Last but not least, a reviewer generates high-quality feedback when they can focus on the really interesting parts of my code. If they are bothered by my simple mistakes, I suffer them too.</p><p>And remember that communication via words could be frighteningly easy for simple misunderstanding or thoughtless commments. Emotions run hot when critiquing someone else’s work. so be conscious of pitfalls that could make my reviewers feel attacked or disrespected.</p>]]></content>
      
      
      <categories>
          
          <category> Soup </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>The Elements of Documentation</title>
      <link href="/2020/12/15/The-Elements-of-Documentation/"/>
      <url>/2020/12/15/The-Elements-of-Documentation/</url>
      
        <content type="html"><![CDATA[<p>This is a glimpse of <a href="https://medium.com/capital-one-tech/art-of-open-source-documentation-5b8b3f5b0ab">Art of Open Source Documentation</a></p><blockquote><p>Documentation helps your users succeed with your software, empowers them to be self-sufficient, enables them to give further feedback, and is the organizational backbone of your project.</p></blockquote><p>There’re three elements of a good documentation</p><ol><li><p>WHAT problem your project solves</p><blockquote><p>If people don’t know why your project exists, they won’t use it.</p></blockquote></li><li><p>WHY your project values</p><blockquote><p>If your project cannot offer special and unique value, people won’t use it.</p></blockquote></li><li><p>HOW to use your project</p><blockquote><p>If people can’t figure out how to use your code, they won’t use it.</p></blockquote></li></ol><p>There’re several rules for the three elements above,</p><ol><li><p>State the goal of your code;</p></li><li><p>Use a lot of hyperlinks to provide more information – this is a great way to keep your docs clean and to define jargony and niche terms;</p></li><li><p>Provide a Table of Content to help contributors organize their work. The open source maintainer acts as a sort of curator, who not only invites everyone to participate, but makes sure there’s a <strong>sense of order, common voice, and good user experience</strong>;</p></li><li><p>Use a tool to track revision history to help your users understand what has been updated;</p></li><li><p>Since you may not have a tech writer dedicated to your project, it also makes sense to use description tools that allow you to automate a lot of the doc writing. This leaves room for your community to annotate with that personal touch;</p></li><li><p>Create a <a href="https://github.blog/2012-09-17-contributing-guidelines/">CONTRIBUTING file</a> to communicate with your users how best to collaborate.</p></li><li><p>Finally(and important in my mind), while the main purpose of the open source world is not profitability, you should look through your docs for potential to monetize. As you annotate your code and docs, always keep an eye out for pathways for upsells and better marketing. And while docs aren’t blogs, that doesn’t mean you can’t add social media share buttons to create more virality around your open source project.</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> Soup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Project </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Understanding Financial Markets</title>
      <link href="/2020/11/08/Understanding-Financial-Markets/"/>
      <url>/2020/11/08/Understanding-Financial-Markets/</url>
      
        <content type="html"><![CDATA[<h2 id="Module-1-General-Introduction-and-Key-Concepts"><a href="#Module-1-General-Introduction-and-Key-Concepts" class="headerlink" title="Module 1: General Introduction and Key Concepts"></a>Module 1: General Introduction and Key Concepts</h2><h3 id="1-1-Investment-Management-in-a-nutshell"><a href="#1-1-Investment-Management-in-a-nutshell" class="headerlink" title="1.1 Investment Management in a nutshell"></a>1.1 Investment Management in a nutshell</h3><p>Investment management is about managing risk!</p><p>The key to successful Investment Management is to constantly be aware of the underlying risks:</p><ol><li><p>Country Risk<br>A country can be subject to a political problem at some point, and so the authorities, the government decides to shut the borders. And also there’s some restriction on captical movements.</p></li><li><p>Market Risk</p></li><li><p>Currency Risk</p></li><li><p>Liquidity Risk<br>If you’re investing in what we call small caps, i.e., firms which have a small capitalization on the stock market. The problem is that their liquidity is less. And when everyone is rushing for the exit, everyone wants to sell, and nobody wants to buy. So these stocks get hurt badly.</p></li><li><p>Inflation Risk</p></li><li><p>Shortfall Risk<br>Shortfall risk is the possibility that the performance of your portfolio does not allow you to reach the financial goal you set it up for.</p></li></ol><p>Investment management is a two-step approach, whether you’re shooting for income or growth, all that defines your profile. And that goes into what we call your <em>strategic asset allocation</em>, the outcome will be that you need over a horizon of five to ten years, the optimal asset allocation is 10% cash, 40% fixed income, and 50% equities.</p><p>Once you have defined the strategic asset allocation, then you move on to the <em>tactical asset allocation</em>.</p><p>You should shoot for a strategic asset allocation for the long run but then adjust this asset allocation on a tactical basis.</p><h4 id="Know-youself-in-market"><a href="#Know-youself-in-market" class="headerlink" title="Know youself in market"></a>Know youself in market</h4><p>Decide whether you want to:</p><ol><li>Be a hunter: directly involved in the investment management process.</li><li>Be a farmer: Delegate the investment decision and monitor the result.</li></ol><h4 id="Key-takeaways-when-investing-in-bonds"><a href="#Key-takeaways-when-investing-in-bonds" class="headerlink" title="Key takeaways when investing in bonds"></a>Key takeaways when investing in bonds</h4><ul><li>Beware of the limitation of benchmarking in the bond market</li><li>Consider the fundamentals of the borrower you lend to</li><li>The lower the starting yield, the lower the expected return</li><li>Buy bonds if you expect a macroeconomic slowdown and conversely</li></ul><h4 id="Key-takeaways-when-investing-in-equities"><a href="#Key-takeaways-when-investing-in-equities" class="headerlink" title="Key takeaways when investing in equities"></a>Key takeaways when investing in equities</h4><ul><li>Beware of the limitation of benchmarking in the equity market</li><li>Strong GDP growth does not always imply higher equity returns</li><li>Don’t chase past performance</li><li>Look for truly active manager</li></ul><h3 id="1-2-Fundamentals"><a href="#1-2-Fundamentals" class="headerlink" title="1.2. Fundamentals"></a>1.2. Fundamentals</h3><h4 id="1-2-1-The-role-of-financial-markets"><a href="#1-2-1-The-role-of-financial-markets" class="headerlink" title="1.2.1 The role of financial markets"></a>1.2.1 The role of financial markets</h4><h5 id="4-kinds-of-participants"><a href="#4-kinds-of-participants" class="headerlink" title="4 kinds of participants"></a>4 kinds of participants</h5><ol><li>Firms: firms need to raise a lot of capical and will proceed with an <em>initial public offering</em> where investors would bring their savings to them. It’s called the primary market.</li><li>Investors: not limited to specific persons, it also can be an org, a fund, and a portfolio. They allocate their savings to productive investment opportunities. and also can sell their shares between themselves. It’s called the secondary market.</li><li>Government: it has a place to ensure market itegrity, to protect investors against abuse.</li><li>Financial intermediates: all the chain of brokers, market makers, banks and institutions that make the interface between investors or between the investors and the firms.</li></ol><h5 id="2-kinds-of-markets"><a href="#2-kinds-of-markets" class="headerlink" title="2 kinds of markets"></a>2 kinds of markets</h5><ol><li>Primary market: where the transfer of resources to productive investment oppotunities occur.</li><li>Secondary market: allow investors to trade among themselves to buy and sell securities mainly for liquidity reasons and for portfolio reallocations.</li></ol><h5 id="functions"><a href="#functions" class="headerlink" title="functions"></a>functions</h5><ol><li>Core function: a financial market serves to transfer resources, namely savings, from investors to firms, corporations, that need to make investments.</li><li>Pooling of resources and subdivision of shares: pool money from a lot of shareholders, little investors, institutional investors to be able to raise such amounts in terms of billions of dollars of market capitalications.</li><li>Transfer resources across time and across space.</li><li>Help participants manage risks: One way of managing risks is to keep <em>diversification</em>, so you need diversified portfolio. The second way to manage risks is to use <em>derivative products</em> that allow you to insure your portfolio against a drop, for instance, S&amp;P 500. The third way of managing risks is through <em>securization</em>.</li><li>Provide information: every time you trade, that the buyer and seller meet, there’s going to be a transaction price. That price informs you on the value of a firm.</li></ol><h4 id="1-2-2-Basic-concepts-in-finance"><a href="#1-2-2-Basic-concepts-in-finance" class="headerlink" title="1.2.2 Basic concepts in finance"></a>1.2.2 Basic concepts in finance</h4><ol><li>Return: we should look at the past and not just focus on the last performance.</li><li>Risk: the easiest way to take a tradeoff between reward and risk is to use the return-risk ratio. Take the reward divided by the volatility, divided by the risk, and pick the higher one to invest.</li><li>Risk distribution: ~</li></ol><h4 id="1-2-2-Basic-concepts-in-Investment-Management"><a href="#1-2-2-Basic-concepts-in-Investment-Management" class="headerlink" title="1.2.2 Basic concepts in Investment Management"></a>1.2.2 Basic concepts in Investment Management</h4><ol><li><p>Descipline and planning are key</p><ol><li><p>Defining your goals and your investment time frame</p><ol><li><p>Growth assets: designed to provide most of their returns in the form of capital growth over time. Growth assets tend to have more volatile returns over the shorter term, but they have the potential to produce higher returns over the longer term.</p></li><li><p>Income assets: provide returns in the form of income and include cash investments, bonds and certain equities. Income assets tend to provide more stable, but lower returns.</p></li><li><p>Risks</p><ol><li>Country Risk: domestic events, such as political upheaval, financial troubles, or natural disasters</li><li>Currency Risk: changes in currency exchange rate cause the value of an investment to decline</li><li>Inflation Risk: inflation is a measure of the rate of increase in general prices for goods and services. The risk that inflation poses is that it can erode the value or purchasing power of your investments.</li><li>Liquidity Risk: the chance that an investment may be difficult to buy or sell.</li><li>Market Risk: investment returns will fluctuate across the market in which you are invested.</li><li>Short Fall Risk: possibility that you portfolio will fail to meet your longer-term financial goals.</li></ol></li><li><p>Recognize the importance of cost and tax</p><table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>Initial charge</td><td>This represents the charge the fund manager</td></tr><tr><td>Exit Fee</td><td>Fund management companies sometimes levy an exit fee and generally return the proceeds to the fund to cover the costs of setting the underlying securities.</td></tr><tr><td>Annual Management Charge(AMC)</td><td>The Annual Management Charge covers the fund manager’s ongoing costs of managing a fund</td></tr><tr><td>Ongoing Charges Figure(OCF)</td><td>Each share class of a Fund, or unit class in the case of FTSE Unit Trust Funds, has an Ongoing Charges Figure(OCF) which is based on projected expenses for a given period. The OFC covers administration, audit, depositary, legal, registration and regulartory expense incurred in respect of the Funds.</td></tr></tbody></table></li></ol></li><li><p>Understanding asset allocation<br>Asset Classes</p><ol><li><p>Equities: also called stocks or shares, represent ownership in a company. This ownership gives you the right to share in that company’s future financial performance.</p></li><li><p>Bonds: a bond is a load made to the bond’s issuer, which could be a company, a government, or some other institution. Bonds can be useful in a portfolio as they provides income, typically paid twice a year. Bonds are issued for a set period and when that period expires(reaches its maturity), the issuer will repay the face value of the bond.</p></li><li><p>Property: for most people, their major investment in property will be owning their own home. For investors who want to increase their exposure to property, it is possible to diversify into commercial property, such as office space, retail outlets or industrial property. These funds earn returns from both rents on the property they own and the potential gains in the value of that property.</p></li><li><p>Cash Investments: includes cash holdings in bank or building society accounts, as well as investments in money market funds. Cash investment offer liquidity - the ability to withdraw cash easily while cash investment tend to be the least volatile of the major asset classes, historically they tend to provide the lowest returns.</p></li></ol><p>Asset allocation simply means deciding how to spread your money across the different asset classes(including equities, bonds, properties and cash) and how much you want to hold in each.</p><table><thead><tr><th>Asset Class</th><th>Key characteristics</th><th>Potentially Suitable for</th></tr></thead><tbody><tr><td>Equities</td><td>Potantial for captical growth, and may offer income through the payment of dividends.</td><td>Medium-to-long-term investors(five years plus)</td></tr><tr><td>Bonds</td><td>Can provide a steady and reliable income stream with potential for capital growth and usually offers a higher interest rate, or yield, than cash.</td><td>Short, medium or long-term investors</td></tr><tr><td>Property</td><td>Provides the benefits of diversification through access to properties in retail, office, industrial, tourism and infrastructure sectors.</td><td>Medium-to-long-term investors(five years plus).</td></tr><tr><td>Cash</td><td>May be suitable for short-term needs, such as an impending down payment on a new home. Usually includes higher interest paying securities, as well as bank and building society accounts or term deposits (a cash deposit at a financial institution that has a fixed term)</td><td>Short-term investors(up to three years)</td></tr></tbody></table></li><li><p>Looking after your investments over time</p></li><li><p>Keeping market movements into perspective, recognizing the potential impact of risk and regularly rebalancing your portfolio</p></li></ol></li></ol><h4 id="1-2-3-Focus-on-the-advantages-private-investors-enjoy"><a href="#1-2-3-Focus-on-the-advantages-private-investors-enjoy" class="headerlink" title="1.2.3 Focus on the advantages private investors enjoy"></a>1.2.3 Focus on the advantages private investors enjoy</h4><ol><li>The ability to deal with illiquidity: private investor typically don’t have the same liquidity needs as professional investors.</li><li>Private investors can also typically take a much longer term view than professional investor, who typically face daily mark to markets and career risk if they under perform for even a short period of time.</li><li>Professional investors are usually tracking benchmark on US or European equity while private investors are inherently benchmark agnostic, so two areas in particular we focus on had been structurally overpriced. Then arbitrage can be made by selling overpriced insurance to markets which is full of individual investors.</li></ol><hr><h2 id="Module-2-Major-Financial-Markets"><a href="#Module-2-Major-Financial-Markets" class="headerlink" title="Module 2: Major Financial Markets"></a>Module 2: Major Financial Markets</h2><h3 id="2-1-Equities"><a href="#2-1-Equities" class="headerlink" title="2.1 Equities"></a>2.1 Equities</h3><h4 id="2-1-1-How-much-is-a-company-worth-on-the-stock-market"><a href="#2-1-1-How-much-is-a-company-worth-on-the-stock-market" class="headerlink" title="2.1.1 How much is a company worth on the stock market"></a>2.1.1 How much is a company worth on the stock market</h4><h4 id="2-1-2-How-to-follow-the-stock-market"><a href="#2-1-2-How-to-follow-the-stock-market" class="headerlink" title="2.1.2 How to follow the stock market"></a>2.1.2 How to follow the stock market</h4><h4 id="2-1-3-How-do-we-rate-our-equity-recommendations"><a href="#2-1-3-How-do-we-rate-our-equity-recommendations" class="headerlink" title="2.1.3 How do we rate our equity recommendations"></a>2.1.3 How do we rate our equity recommendations</h4><h3 id="2-2-Fixed-Income"><a href="#2-2-Fixed-Income" class="headerlink" title="2.2 Fixed Income"></a>2.2 Fixed Income</h3><h4 id="2-2-1-Fixed-income-–-government-bonds-merits"><a href="#2-2-1-Fixed-income-–-government-bonds-merits" class="headerlink" title="2.2.1 Fixed income – government bonds: merits"></a>2.2.1 Fixed income – government bonds: merits</h4><h4 id="2-2-2-Fixed-income-–-government-bonds-risks"><a href="#2-2-2-Fixed-income-–-government-bonds-risks" class="headerlink" title="2.2.2 Fixed income – government bonds: risks"></a>2.2.2 Fixed income – government bonds: risks</h4><h4 id="2-2-3-Fixed-income-–-corporate-bonds-and-high-yield"><a href="#2-2-3-Fixed-income-–-corporate-bonds-and-high-yield" class="headerlink" title="2.2.3 Fixed income – corporate bonds and high yield"></a>2.2.3 Fixed income – corporate bonds and high yield</h4><h4 id="2-2-4-Money-markets"><a href="#2-2-4-Money-markets" class="headerlink" title="2.2.4 Money markets"></a>2.2.4 Money markets</h4><h4 id="2-2-5-Currencies-a-separate-asset-class"><a href="#2-2-5-Currencies-a-separate-asset-class" class="headerlink" title="2.2.5 Currencies: a separate asset class?"></a>2.2.5 Currencies: a separate asset class?</h4><h4 id="2-2-6-What-is-the-real-value-of-a-currency"><a href="#2-2-6-What-is-the-real-value-of-a-currency" class="headerlink" title="2.2.6 What is the real value of a currency?"></a>2.2.6 What is the real value of a currency?</h4><h3 id="2-3-What-Return-for-What-Risk"><a href="#2-3-What-Return-for-What-Risk" class="headerlink" title="2.3 What Return for What Risk"></a>2.3 What Return for What Risk</h3><h4 id="2-3-1-Risk-adjusted-in-practice"><a href="#2-3-1-Risk-adjusted-in-practice" class="headerlink" title="2.3.1 Risk-adjusted in practice"></a>2.3.1 Risk-adjusted in practice</h4><h4 id="2-3-2-The-risks-and-returns-of-financial-markets"><a href="#2-3-2-The-risks-and-returns-of-financial-markets" class="headerlink" title="2.3.2 The risks and returns of financial markets"></a>2.3.2 The risks and returns of financial markets</h4><hr><h2 id="Module-3-Other-Financial-Markets"><a href="#Module-3-Other-Financial-Markets" class="headerlink" title="Module 3: Other Financial Markets"></a>Module 3: Other Financial Markets</h2><h3 id="3-1-Emerging-Markets-and-Gold"><a href="#3-1-Emerging-Markets-and-Gold" class="headerlink" title="3.1 Emerging Markets and Gold"></a>3.1 Emerging Markets and Gold</h3><h4 id="3-1-1-Emerging-markets-stocks"><a href="#3-1-1-Emerging-markets-stocks" class="headerlink" title="3.1.1 Emerging markets: stocks"></a>3.1.1 Emerging markets: stocks</h4><h4 id="3-1-2-Emerging-markets-bonds"><a href="#3-1-2-Emerging-markets-bonds" class="headerlink" title="3.1.2 Emerging markets: bonds"></a>3.1.2 Emerging markets: bonds</h4><h4 id="3-1-3-Gold-the-ultimate-currency"><a href="#3-1-3-Gold-the-ultimate-currency" class="headerlink" title="3.1.3 Gold: the ultimate currency?"></a>3.1.3 Gold: the ultimate currency?</h4><h3 id="3-2-Alternative-Assets"><a href="#3-2-Alternative-Assets" class="headerlink" title="3.2 Alternative Assets"></a>3.2 Alternative Assets</h3><h4 id="3-2-1-Real-estate"><a href="#3-2-1-Real-estate" class="headerlink" title="3.2.1 Real estate"></a>3.2.1 Real estate</h4><h4 id="3-2-2-Hedge-funds-definition-and-origins"><a href="#3-2-2-Hedge-funds-definition-and-origins" class="headerlink" title="3.2.2 Hedge funds: definition and origins"></a>3.2.2 Hedge funds: definition and origins</h4><h4 id="3-2-3-Hedge-funds-going-long-…-or-short"><a href="#3-2-3-Hedge-funds-going-long-…-or-short" class="headerlink" title="3.2.3 Hedge funds: going long … or short?"></a>3.2.3 Hedge funds: going long … or short?</h4><h4 id="3-2-4-Private-markets"><a href="#3-2-4-Private-markets" class="headerlink" title="3.2.4 Private markets"></a>3.2.4 Private markets</h4><hr><h2 id="Module-4-Financial-Markets-and-the-Economy"><a href="#Module-4-Financial-Markets-and-the-Economy" class="headerlink" title="Module 4: Financial Markets and the Economy"></a>Module 4: Financial Markets and the Economy</h2><h3 id="4-1-Central-Banks-as-Key-Players"><a href="#4-1-Central-Banks-as-Key-Players" class="headerlink" title="4.1 Central Banks as Key Players"></a>4.1 Central Banks as Key Players</h3><h4 id="4-1-1-Central-bank’s-conventional-policies"><a href="#4-1-1-Central-bank’s-conventional-policies" class="headerlink" title="4.1.1 Central bank’s conventional policies"></a>4.1.1 Central bank’s conventional policies</h4><h4 id="4-1-2-Central-bank’s-unconventional-policies"><a href="#4-1-2-Central-bank’s-unconventional-policies" class="headerlink" title="4.1.2 Central bank’s unconventional policies"></a>4.1.2 Central bank’s unconventional policies</h4><h3 id="4-2-The-Growth-inflation-Mix"><a href="#4-2-The-Growth-inflation-Mix" class="headerlink" title="4.2 The Growth-inflation Mix"></a>4.2 The Growth-inflation Mix</h3><h4 id="4-2-1-The-link-between-equity-markets-and-the-growth-inflation-mix"><a href="#4-2-1-The-link-between-equity-markets-and-the-growth-inflation-mix" class="headerlink" title="4.2.1 The link between equity markets and the growth-inflation mix"></a>4.2.1 The link between equity markets and the growth-inflation mix</h4><h4 id="4-2-2-The-link-between-bond-markets-and-the-growth-inflation-mix"><a href="#4-2-2-The-link-between-bond-markets-and-the-growth-inflation-mix" class="headerlink" title="4.2.2 The link between bond markets and the growth-inflation mix"></a>4.2.2 The link between bond markets and the growth-inflation mix</h4><h3 id="4-3-The-Impact-of-the-Interest-Rate-Environment"><a href="#4-3-The-Impact-of-the-Interest-Rate-Environment" class="headerlink" title="4.3 The Impact of the Interest Rate Environment"></a>4.3 The Impact of the Interest Rate Environment</h3><h4 id="4-3-1-How-interest-rates-affect-equity-and-bond-portfolios"><a href="#4-3-1-How-interest-rates-affect-equity-and-bond-portfolios" class="headerlink" title="4.3.1 How interest rates affect equity and bond portfolios"></a>4.3.1 How interest rates affect equity and bond portfolios</h4>]]></content>
      
      
      <categories>
          
          <category> Finance </category>
          
          <category> Market </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Financial Market </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Wallet Auth RFC</title>
      <link href="/2020/09/03/wallet-auth-rfc/"/>
      <url>/2020/09/03/wallet-auth-rfc/</url>
      
        <content type="html"><![CDATA[<h2 id="Abstract"><a href="#Abstract" class="headerlink" title="Abstract"></a>Abstract</h2><p>This specification describes the authorization and authentication process between security-sensitive wallets and untrusted applications.</p><p>Since key-related resources should not be accessible to any untrusted applications, such as a website, until the user grants specific permissions on it, most of the endpoints should be guarded by an authentication system.</p><p>This specification defines some aspects of the authentication system, including:</p><ul><li>Depiction of permission;</li><li>Two JSON-RPC methods to get and request permissions;</li><li>Two expressive user interfaces to inform permissions to grant and revoke;</li><li>Authorization process between application, wallet and user;</li><li>Authentication process between application and wallet;</li></ul><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>Wallets co-operating with untrusted applications are doing works viz.</p><ul><li>Provide available addresses;</li><li>Provide live cells (including deps) for constructing transactions;</li><li>Switch between blockchain nodes to submit transactions;</li><li>Sign and send transactions proposed from applications;</li><li>Sign and verify messages from applications.</li></ul><p>Some of them should be prohibited until the owner of the wallet grants related permissions on the requester.</p><p>For universal experience between a variety of applications and wallets, this specification proposes a canonical process for these tasks. Following this guide, developers can implement permission systems in a general way, and users can avoid mental burden on permission-grants between different applications.</p><h2 id="Specification"><a href="#Specification" class="headerlink" title="Specification"></a>Specification</h2><h3 id="Permission-Restriction"><a href="#Permission-Restriction" class="headerlink" title="Permission Restriction"></a>Permission Restriction</h3><p>This specification imposes three restrictions on each permission,</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">restrictions:</span></span><br><span class="line">  <span class="attr">deps:</span> <span class="string">string[]</span> <span class="comment"># required permissions for this permission</span></span><br><span class="line">  <span class="attr">expiration:</span> <span class="string">string</span> <span class="string">|</span> <span class="literal">null</span> <span class="comment"># timestamp of expiration datetime, null for permanent</span></span><br><span class="line">  <span class="attr">limit:</span> <span class="string">string</span> <span class="string">|</span> <span class="literal">null</span> <span class="comment"># limitation of invocation, null for unlimited</span></span><br></pre></td></tr></table></figure><h3 id="Permission-Requests"><a href="#Permission-Requests" class="headerlink" title="Permission Requests"></a>Permission Requests</h3><p>This specification defines two requests in JSON-RPC method:</p><h4 id="Get-Permission-List"><a href="#Get-Permission-List" class="headerlink" title="Get Permission List"></a>Get Permission List</h4><p><code>get_permission_list</code> queries the permission list provided by the wallet. On handling this kind of request, wallet should return the list of permissions in the following format.</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">permission_name:</span></span><br><span class="line">  <span class="attr">is_granted:</span> <span class="string">boolean</span> <span class="comment"># is granted or not</span></span><br><span class="line">  <span class="attr">restriction:</span></span><br><span class="line">    <span class="attr">deps:</span> <span class="string">string[]</span> <span class="comment"># required permissions for this permission</span></span><br><span class="line">    <span class="attr">expiration:</span> <span class="string">string</span> <span class="string">|</span> <span class="literal">null</span> <span class="comment"># timestamp of expiration datetime, null for permanent</span></span><br><span class="line">    <span class="attr">limit:</span> <span class="string">string</span> <span class="string">|</span> <span class="literal">null</span> <span class="comment"># limitation of invocation, null for unlimited</span></span><br></pre></td></tr></table></figure><h4 id="Request-Permissions"><a href="#Request-Permissions" class="headerlink" title="Request Permissions"></a>Request Permissions</h4><p>To request particular permissions, application should POST a request in following format:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">id:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">jsonrpc:</span> <span class="string">&#x27;2.0&#x27;</span><span class="string">,</span></span><br><span class="line"><span class="attr">method:</span> <span class="string">&#x27;request_permissions&#x27;</span><span class="string">,</span></span><br><span class="line"><span class="attr">params:</span></span><br><span class="line">  <span class="attr">app:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">string</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">string</span> <span class="string">|</span> <span class="literal">null</span></span><br><span class="line">  <span class="attr">permissions:</span></span><br><span class="line">    <span class="attr">permission_name:</span></span><br><span class="line">      <span class="attr">restriction:</span></span><br><span class="line">        <span class="attr">expiration:</span> <span class="string">string</span> <span class="string">|</span> <span class="literal">null</span></span><br><span class="line">        <span class="attr">limit:</span> <span class="string">string</span> <span class="string">|</span> <span class="literal">null</span></span><br><span class="line">      <span class="attr">reason:</span> <span class="string">string</span> <span class="string">|</span> <span class="literal">null</span></span><br></pre></td></tr></table></figure><p>The payload in this request indicates the details as follows:</p><ul><li>Application is requesting <code>permission_name</code> permission</li><li>The <code>permission_request</code> should be available until <code>expiration</code>, eternal if <code>expiration</code> is <code>null</code></li><li>The <code>permission_request</code> will be revoked automatically after <code>limit</code> invocations, <code>null</code> for unlimited.</li><li>Reason to request <code>permission_name</code></li></ul><p>Users should be informed with all this information in a proper way, including extra info about the requester.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">┌───────────────────────────────────────────────┐</span><br><span class="line">│ **         Request for Permissions         ** │</span><br><span class="line">├───────────────────────────────────────────────┤</span><br><span class="line">│ Application : app_name                        │</span><br><span class="line">│ Description : app_description                 │</span><br><span class="line">│ Origin      : app_origin                      │</span><br><span class="line">├───────────────────────────────────────────────┤</span><br><span class="line">│ **          Requested Permissions          ** │</span><br><span class="line">├──────────┬─────────────────┬──────────────────┤</span><br><span class="line">│ [x] name │ expiration time │ invocation limit │</span><br><span class="line">│          ├-----------------┴------------------┤</span><br><span class="line">│          │ Reason                             │</span><br><span class="line">├──────────┼─────────────────┬──────────────────┤</span><br><span class="line">│ [x] name │ expiration time │ invocation limit │</span><br><span class="line">├──────────┴─────────────┬───┴──────────────────┤</span><br><span class="line">│          Deny          │         Grant        │</span><br><span class="line">└────────────────────────┴──────────────────────┘</span><br></pre></td></tr></table></figure><p>With this interface, requested permissions can be granted as needed, which makes the permission system more flexible.</p><p>Once user confirms, wallet should return:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">id:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">jsonrpc:</span> <span class="string">&#x27;2.0&#x27;</span></span><br><span class="line"><span class="attr">result:</span></span><br><span class="line">  <span class="attr">permissions:</span></span><br><span class="line">    <span class="attr">permission_name:</span></span><br><span class="line">      <span class="attr">is_granted:</span> <span class="string">boolean</span></span><br><span class="line">      <span class="attr">message:</span> <span class="string">string</span> <span class="string">|</span> <span class="literal">null</span> <span class="comment"># reason for rejection, user rejected, permission unrecogonized, dep permissions are not granted, etc.</span></span><br><span class="line">  <span class="attr">error:</span> <span class="comment"># unexpected error thrown in the procedure, like database error, etc</span></span><br><span class="line">  <span class="attr">message:</span> <span class="comment"># expected exception, such as user denied, password incorrect, permission deps required</span></span><br></pre></td></tr></table></figure><p>If user denies, the wallet should return:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">id:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">jsonrpc:</span> <span class="string">&#x27;2.0&#x27;</span></span><br><span class="line"><span class="attr">result:</span></span><br><span class="line">  <span class="attr">code:</span> <span class="number">401</span></span><br><span class="line">  <span class="attr">message:</span> <span class="string">permission</span> <span class="string">request</span> <span class="string">is</span> <span class="string">denied</span></span><br></pre></td></tr></table></figure><h3 id="Revoke-Permissions"><a href="#Revoke-Permissions" class="headerlink" title="Revoke Permissions"></a>Revoke Permissions</h3><p>A grant should be able to revoke freely in a kind way with essential annotations:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">┌───────────────────────────────────────────────┐</span><br><span class="line">│ **            Revoke Permission            ** │</span><br><span class="line">├───────────────────────────────────────────────┤</span><br><span class="line">│ Application : app_name                        │</span><br><span class="line">│ Origin      : app_origin                      │</span><br><span class="line">│ Permission  : permission_name                 │</span><br><span class="line">├─────────────┬─────────────────────────────────┤</span><br><span class="line">│ Dependents  │ permission_name                 │</span><br><span class="line">│             ├---------------------------------┤</span><br><span class="line">│             │ permission_name                 │</span><br><span class="line">├─────────────┴─────────┬───────────────────────┤</span><br><span class="line">│         Cancel        │        Confirm        │</span><br><span class="line">└───────────────────────┴───────────────────────┘</span><br></pre></td></tr></table></figure><h3 id="Authorization-Process"><a href="#Authorization-Process" class="headerlink" title="Authorization Process"></a>Authorization Process</h3><p>The authorization process is a sequence of simple tasks that including <code>application requests permissions</code>, <code>inform user necessary information</code>, <code>handle confirmation/rejection/exception</code>.</p><pre class="mermaid">sequenceDiagram  participant Application  participant Auth  participant User  Application ->> Auth: Request Permissions  Auth -->> Application: If Exception Thrown  Auth ->> User: App[x] Requests Permissions  User ->> Auth: Pick Some or Deny  Auth ->> Application: Permissions Granted  Auth -->> Application: Request Denied</pre><p>This specification has defined a method to request permissions and an advisable user interface to ask user for confirmation. Now the handlers on confirmation, rejection and exception should be complemented in this procedure.</p><p>There are three kinds of result in the end:</p><ol><li>Some permissions are granted;</li><li>Request is denied;</li><li>Exception occurs.</li></ol><p>All these cases are covered by three fields of result of <code>request_permissions</code> defined above:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">permissions:</span> <span class="comment"># result of request_permissions mentioned above, null for exception</span></span><br><span class="line"><span class="attr">error:</span> <span class="comment"># unexpected error thrown in the procedure, like database error, etc</span></span><br><span class="line"><span class="attr">message:</span> <span class="comment"># expected exception, such as user denied, password incorrect, permission deps required</span></span><br></pre></td></tr></table></figure><p><code>error</code> and <code>message</code> are worthy distinguishing since they describe different kinds of exception.</p><p><code>error</code> means an unexpected exception is thrown, like database error or internal exception. While <code>message</code> indicates an expected behavior is delivered, e.g. user denied, or password is incorrect, etc.</p><p>With all of these definition, the workflow should be much clearer:</p><pre class="mermaid">graph TDApp[Application] -->|Request| A{Auth}A -->|Granted| G[permissions: non-null<br/>error: null<br/>message: null]A -->|Denied, Password Error, Dep Error| D[permissions: null<br/>error: null<br/>message: non-null]A -->|Unknown Exception| U[permissions: null<br/>error: non-null<br/>message: null]</pre><h3 id="Authentication-Process-Discretionary"><a href="#Authentication-Process-Discretionary" class="headerlink" title="Authentication Process[Discretionary]"></a>Authentication Process[Discretionary]</h3><blockquote><p>Defining the process of authentication is good for writing SOLID code but it’s not mandatory in this system.</p></blockquote><p>Name authentication mechanism <code>Strategy</code>, which is a concept from <a href="http://www.passportjs.org/">passport</a>, and classify them into <code>LocalStrategy</code>, <code>JwtStrategy</code>, etc. by concrete mechanisms (More strategies can be found in <a href="http://www.passportjs.org/packages/">Passport</a>).</p><p>Suppose an endpoint <code>get_xxx</code> should be protected by the auth module <code>auth</code>.</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Verify &#123;</span><br><span class="line">  (payload: <span class="built_in">string</span>) : &#123;</span><br><span class="line">    permissions: Permission[] | <span class="literal">null</span>,</span><br><span class="line">    error?: <span class="built_in">Error</span> | <span class="literal">null</span>,</span><br><span class="line">    message?: <span class="built_in">string</span> | <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Strategy&lt;T <span class="keyword">extends</span> Verify&gt; &#123;</span><br><span class="line"></span><br><span class="line">  #name: <span class="built_in">string</span></span><br><span class="line">  #verify: T</span><br><span class="line"></span><br><span class="line">  get name() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.#name</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">constructor</span>(<span class="params">name: <span class="built_in">string</span>, verify: T</span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>.#verify = verify</span><br><span class="line">    <span class="built_in">this</span>.#name = name</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> validate(req: HttpRequest): ReturnType&lt;Verify&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; payload &#125; = <span class="built_in">this</span>.getPayload(req)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.#verify(payload)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">protected</span> getPayload: <span class="function">(<span class="params">req: HttpRequest</span>) =&gt;</span> &#123; payload: <span class="built_in">string</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Register authentication strategy</span></span><br><span class="line">auth.use(<span class="keyword">new</span> Strategy(</span><br><span class="line">  <span class="string">&#x27;custom&#x27;</span>,</span><br><span class="line">  (payload: <span class="built_in">string</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> permissions = app.getPermissions(payload)</span><br><span class="line">    <span class="keyword">if</span> (!permissions.xxx.is_granted) &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        permissions: <span class="literal">null</span>,</span><br><span class="line">        message: <span class="string">`Permission xxx is not granted`</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      permissions,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">))</span><br><span class="line"><span class="comment">// Protect endpoint with speicified strategy</span></span><br><span class="line">app.post(<span class="string">`get_xxx`</span>, auth.authenticate(<span class="string">&#x27;custom&#x27;</span>))</span><br></pre></td></tr></table></figure><p>With this configuration, <code>app</code> invokes <code>auth.validate</code> on each post request before <code>get_xxx</code> route handler and if validation fails, the message will be passed to the router handler for the next step.</p><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>This specification illustrates several facets of authorization and authentication from perspectives of applications, wallets and users. With the APIs defined in this specification, developer experience is unified across different applications while with the request/revoke UIs pictured above, the user experience is also improved across various wallets.</p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul><li><a href="https://github.com/ethereum/EIPs/blob/master/EIPS/eip-2255.md">Wallet Permissions System</a></li><li><a href="https://ethereum-magicians.org/t/web3-login-permissions/3583">Web3 Login Permissions</a></li><li><a href="https://tools.ietf.org/html/rfc2617">HTTP Authentication: Basic and Digest Access Authentication</a></li><li><a href="https://tools.ietf.org/html/rfc6750">The OAuth 2.0 Authorization Framework: Bearer Token Usage</a></li><li><a href="http://www.passportjs.org/docs/">Passport</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Blockchain </category>
          
          <category> CKB </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RFC </tag>
            
            <tag> CKB </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shorthand of Wallet Permissions System</title>
      <link href="/2020/08/31/shorthand-of-wallet-permissions-system/"/>
      <url>/2020/08/31/shorthand-of-wallet-permissions-system/</url>
      
        <content type="html"><![CDATA[<p><a href="https://github.com/ethereum/EIPs/blob/master/EIPS/eip-2255.md">EIP 2255</a></p><h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>A proposed standard interface for restricting and permitting access to security-sensitive methods within a restricted web3 context like a website or “dapp”.</p><p>Many web3 applications today begin their sessions with a series of repetitive requests:</p><ul><li>Reveal your wallet address to this site</li><li>Switch to a preferred network</li><li>Sign a cryptographic challenge</li><li>Grant a token allowance to our contract</li><li>Send a transaction to our contract</li></ul><p>Many of these can be generalized into a set of human-readable permissions prompts on the original sign-in screen, and additional permissions could be requested only as needed.</p><h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2><p>This proposal adds two new methods</p><ul><li><h2 id="wallet-getPermissions-get-an-array-of-current-permissions-empty-by-default"><a href="#wallet-getPermissions-get-an-array-of-current-permissions-empty-by-default" class="headerlink" title="wallet_getPermissions: get an array of current permissions(empty by default)."></a><code>wallet_getPermissions</code>: get an array of current permissions(empty by default).</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> response = <span class="keyword">await</span> provider.request(&#123;</span><br><span class="line">  method: <span class="string">&#x27;wallet_getPermissions&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * [</span></span><br><span class="line"><span class="comment"> *   &#123;</span></span><br><span class="line"><span class="comment"> *     invoker: &#x27;url&#x27;, // unique domain string used to identify the source of the current dapp</span></span><br><span class="line"><span class="comment"> *     parentCapability: &#x27;eth_accounts&#x27;, // the basis of these permissions</span></span><br><span class="line"><span class="comment"> *     caveats: [ // the specific restrictions applied to the permitted method</span></span><br><span class="line"><span class="comment"> *       &#123;</span></span><br><span class="line"><span class="comment"> *         type: &#x27;fileterResponse&#x27;,</span></span><br><span class="line"><span class="comment"> *         value: [&#x27;...&#x27;]</span></span><br><span class="line"><span class="comment"> *       &#125;</span></span><br><span class="line"><span class="comment"> *     ]</span></span><br><span class="line"><span class="comment"> *   &#125;</span></span><br><span class="line"><span class="comment"> * ]</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure></li><li><p><code>wallet_requestPermissions</code>: request some permissions.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> response = <span class="keyword">await</span> provider.request(&#123;</span><br><span class="line">  method: <span class="string">&#x27;wallet_requestPermissions&#x27;</span>,</span><br><span class="line">  params: [&#123;</span><br><span class="line">    <span class="string">&#x27;eth_accounts&#x27;</span>: &#123;&#125;</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ul><h2 id="Discussion"><a href="#Discussion" class="headerlink" title="Discussion"></a>Discussion</h2><p><a href="https://ethereum-magicians.org/t/web3-login-permissions/3583">Discussion: EIP-2255</a></p><ul><li>Wallet should make dangerous permission <em>look dangerous</em>. This isn’t an excuse to get users to click blindly. This is a time to rebuild the user’s sense of responsibility.</li><li>Wallet should expose permissions that are <em>meaningful to user</em>. A token allowance is meaningful, but a hex blob is not. If we can identify the terms that convey the true risk a user is taking, I believe we can allow the risks a user takes to be much more comprehensible to them, which allows them to participate in informed consent. We cannot stop users from being reckless, but we can empower them to be careful with fewer steps.</li><li>Wallets should allow users to <em>attenuate</em> permissions(add caveats), or reduce their impact when possible. An app may request a login, but the user may say “Just for the next 30 minutes”.</li></ul>]]></content>
      
      
      <categories>
          
          <category> Blockchain </category>
          
          <category> Ethereum </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ethereum </tag>
            
            <tag> Blockchain </tag>
            
            <tag> RFC </tag>
            
            <tag> EIP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Type Id on CKB</title>
      <link href="/2020/08/31/type-id-on-ckb/"/>
      <url>/2020/08/31/type-id-on-ckb/</url>
      
        <content type="html"><![CDATA[<h2 id="What-is-Type-Id"><a href="#What-is-Type-Id" class="headerlink" title="What is Type Id"></a>What is Type Id</h2><p>Type Id is a digest of a unique type script.</p><p>The unique type script consists of three parts:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">code_hash:</span> <span class="string">type</span> <span class="string">id</span> <span class="string">contract</span> <span class="string">code</span> <span class="string">hash</span></span><br><span class="line"><span class="attr">hash_type:</span> <span class="string">type</span> <span class="comment"># use the `type` kind code hash for upgradability</span></span><br><span class="line"><span class="attr">args:</span> <span class="string">hash(this_transaction.inputs[0])</span> <span class="string">|</span> <span class="string">output_index_of_this_cell</span></span><br></pre></td></tr></table></figure><p>The uniqueness of the generated type script is guaranteed by the <code>type id contract</code> and <code>hash(this_transaction.input[0]) | output_index_of_this_cell</code> since</p><blockquote><p>No man ever steps in the same river twice, for it’s not the same river and he’s not the same man.</p></blockquote><p>The <code>type id contract</code> checks if the <code>unique_type_script.args</code> matches the <code>deployment_transaction.inputs[0]</code>. Once it’s deployed on the chain successfully, the <code>deployment_transaction.inputs[0]</code> cannot be used to deploy the same <code>unique type script</code> again since it’s comsumed, like the water gone, i.e. the <code>unique_type_script.args</code> cannot be used to deploy again and the uniqueness of the <code>unique type script</code> is promised.</p><h2 id="Why-Type-Id-is-Important"><a href="#Why-Type-Id-is-Important" class="headerlink" title="Why Type Id is Important"></a>Why Type Id is Important</h2><p>The contract cell, i.e. the cell dep referenced in a transaction, is upgradable when it’s located via its type script. By deploying a new cell with new contract code but having the same type script as the deprecated one, it can be indexed by the same <code>[code_hash, hash_type]</code> conditions.</p><pre class="mermaid">graph LR  id1[code_hash: hash_a, hash_type: type]-->|OutPoint of Deprecated Cell|id2[Deprecated Contract]  id1[code_hash: hash_a, hash_type: type]-->|OutPoint of Latest Deployed Cell|id3[Latest Deploayed Contract]</pre><p>By this way, an attacker can deploy a malicious contract with the same type script of the targeted contract to bypass script validation and confuse users.</p><pre class="mermaid">graph LR  id1[code_hash: hash_a, hash_type: type]-->|OutPoint of Deprecated Cell|id2[Deprecated Contract]  id1[code_hash: hash_a, hash_type: type]-->|OutPoint of Latest Deployed Cell|id3[Latest Deploayed Contract]  id1[code_hash: hash_a, hash_type: type]-->|OutPoint of Malicious Cell|id3[Malicious Contract]</pre><p>An exclusive type script is necessary in this mode.</p><h2 id="How-to-Create-a-Unique-Type-Script"><a href="#How-to-Create-a-Unique-Type-Script" class="headerlink" title="How to Create a Unique Type Script"></a>How to Create a Unique Type Script</h2><p>There are 4 rules to deploy an unique type script(with unique <code>args</code>)</p><ol><li><p>Count how many output cells use current <strong>type script</strong>, if there’re more than one cell with current <strong>type script</strong>, throw an error since an attacker is trying to create more than one cells with the same type script, which is not expected.</p></li><li><p>Count how many input cells use current <strong>type script</strong>, if there’s only one input cell with the current <strong>type script</strong>, return success.</p></li><li><p>Use CKB Syscall to read the first input’s OutPoint in the current transaction and if it matches the <code>args</code> field of the type script, return success.</p><ul><li>Since the first input can only be comsumed once, its unique OutPoint guarantees the uniqueness of the type script.</li><li>An attacker cannot use the same <code>args</code> to deploy the type script since the unique cell has been consumed.</li></ul></li><li><p>Otherwise throw an error.</p></li></ol><h2 id="Get-Unique-Type-Id"><a href="#Get-Unique-Type-Id" class="headerlink" title="Get Unique Type Id"></a>Get Unique Type Id</h2><p>Simply hash the type script</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hash([codeHash, hashType, args]) | output_index</span><br></pre></td></tr></table></figure><h2 id="Resolve-Scripts-in-CKB-Transaction-via-Type-Id"><a href="#Resolve-Scripts-in-CKB-Transaction-via-Type-Id" class="headerlink" title="Resolve Scripts in CKB Transaction via Type Id"></a>Resolve Scripts in CKB Transaction via Type Id</h2><p>Since Type Script is used, the contract depends on it has <code>hash type = type</code>.</p><p>In this case, the ckb vm loops all cell deps and try to find a dep whose type script has the corresponding <code>hash(type script)</code>.</p><p>Once a cell dep meeting the condition is found, it’s used as the dependency of the contract.</p><h2 id="Appendix"><a href="#Appendix" class="headerlink" title="Appendix"></a>Appendix</h2><p>The <code>type id contract</code> can be implemented in CKB VM, but now it exists in CKB node as a <a href="https://github.com/nervosnetwork/ckb/blob/develop/script/src/type_id.rs">system script</a> and can be referenced by a special code hash, ascii code in hex of the text <code>TYPE_ID</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x00000000000000000000000000000000000000000000000000545950455f4944</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Blockchain </category>
          
          <category> CKB </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Blockchain </tag>
            
            <tag> CKB </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shorthand of Ethereum Provider</title>
      <link href="/2020/08/27/shorthand-of-ethereum-provider/"/>
      <url>/2020/08/27/shorthand-of-ethereum-provider/</url>
      
        <content type="html"><![CDATA[<p><a href="https://github.com/ethereum/EIPs/blob/master/EIPS/eip-1193.md">EIP 1193</a></p><h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>A JavaScript Ethereum Provider API for consistency across clients and applications.</p><p>This EIP formalizes an Ethereum Provider API to promote wallet interoperability. The API is designed to be <strong>minimal, event-driven, and agonstic of transport and RPC protocols</strong></p><p><strong>It’s functionality is easily extended by defining new RPC methods and message event types</strong></p><h2 id="Terminology"><a href="#Terminology" class="headerlink" title="Terminology"></a>Terminology</h2><ul><li>Provider: a JavaScript object made available to a consumer, that provides access to Ethereum by menas of Clients<ul><li>e.g. window.ethereum</li></ul></li><li>Client: An endpoint that receives Remote Procedure Call (RPC)<ul><li>e.g. server of MetaMask</li></ul></li><li>Wallet: An end-user application that manages private keys, performs signing operations, and acts as a middleware between the Provider and the Client<ul><li>e.g. MetaMask</li><li>Application send message via provider to wallet and wallet proxy the message to the client</li></ul></li><li>Remote Procedure Call (RPC)</li></ul><h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2><h3 id="request"><a href="#request" class="headerlink" title="request"></a>request</h3><blockquote><p>The <code>request</code> method is intended as a <strong>transport- and protocol-agnostic</strong> wrapper function for Remote Procedure Calls</p></blockquote><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> RequestArguments &#123;</span><br><span class="line">  <span class="keyword">readonly</span> method: <span class="built_in">string</span></span><br><span class="line">  <span class="keyword">readonly</span> params: <span class="keyword">readonly</span> unknown[] | <span class="built_in">object</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Provider.request(args: RequestArguments): <span class="built_in">Promise</span>&lt;unknown&gt;</span><br></pre></td></tr></table></figure><p>The provider must identify requested RPC method by the value of <code>RequestArguments.method</code></p><p>If the requested RPC method takes any parameters, the Provider must accept as the value of <code>RequestArguments.params</code></p><p>RPC requests must be handled such that the returned Promise either resolves with a value per the requested RPC method’s specification, or rejects with an error.</p><h3 id="Events"><a href="#Events" class="headerlink" title="Events"></a>Events</h3><p>The provider must implement the following event handling methods:</p><ul><li>on</li><li>removeListener</li></ul><p>These methods must be implemented per the Node.js <code>EventEmitter</code> API</p><blockquote><p>To satisfy these requirements, Provider implementers should consider simply extending the Node.js <code>EventEmitter</code> class and bundling it for the target environment.</p></blockquote><h4 id="Message-Event"><a href="#Message-Event" class="headerlink" title="Message Event"></a>Message Event</h4><blockquote><p>The <code>message</code> event is intended for arbitrary notifications not covered by other events.</p></blockquote><p>When emitted, the <code>message</code> event must be emitted with an object argument of the following form:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> ProviderMessage &#123;</span><br><span class="line">  <span class="keyword">readonly</span> <span class="keyword">type</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="keyword">readonly</span> data: unknown</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Subscriptions-Event"><a href="#Subscriptions-Event" class="headerlink" title="Subscriptions Event"></a>Subscriptions Event</h4><p>If the provider supports Ethereum RPC subscriptions, the provider must emit the <code>message</code> event when it receives a subscription notification.</p><p>If the provider receives a subscription message, the provider must emit a <code>message</code> event with a <code>ProviderMessage</code> object of the following form:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> EthSubscription <span class="keyword">extends</span> ProviderMessage &#123;</span><br><span class="line">  <span class="keyword">readonly</span> <span class="keyword">type</span>: <span class="string">&#x27;eth_subscription&#x27;</span></span><br><span class="line">  <span class="keyword">readonly</span> data: &#123;</span><br><span class="line">    <span class="keyword">readonly</span> subscription: <span class="built_in">string</span></span><br><span class="line">    <span class="keyword">readonly</span> result: unknown</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Connect-Event"><a href="#Connect-Event" class="headerlink" title="Connect Event"></a>Connect Event</h4><p>If the provider becomes connected, the provider must emit the event named <code>connected</code>.</p><p>This includes when:</p><ul><li>The provider first connects to a chain after initialization.</li><li>The provider connects to a chain after the <code>disconnect</code> event was emitted.</li></ul><p>This event must be emitted with an object of the following form:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> ProviderConnectInfo &#123;</span><br><span class="line">  <span class="keyword">readonly</span> chainId: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Disconnect-Event"><a href="#Disconnect-Event" class="headerlink" title="Disconnect Event"></a>Disconnect Event</h4><p>If the provider becomes disconnected from all chains, the provider must emit the event named <code>disconnect</code> with value <code>error: ProviderRpcError</code>, per the interface defined in teh RPC Errors.</p><h4 id="ChainChanged-Event"><a href="#ChainChanged-Event" class="headerlink" title="ChainChanged Event"></a>ChainChanged Event</h4><p>If the chain the provider is connected to changes, the provider must emit the event named <code>chainChanged</code> with the value <code>chainId: string</code>.</p><h4 id="AccountsChanged"><a href="#AccountsChanged" class="headerlink" title="AccountsChanged"></a>AccountsChanged</h4><p>If the accounts available to the provider change, the provider must emit the event named <code>accountsChanged</code> wth value <code>accounts: string[]</code>, containing the account addresses per the <code>eth_accounts</code> Ethereum RPC method.</p><h2 id="Rational"><a href="#Rational" class="headerlink" title="Rational"></a>Rational</h2><p>The purpose of a Provider is to provide a consumer with access to Ethereum. In general, a Provider must enable an Ethereum web application to do <em>two</em> things:</p><ul><li>Make Ethereum RPC requests</li><li>Respond to <strong>state changes</strong> in the Provider’s Ethereum chain, Client, and Wallet.</li></ul><h2 id="Backwards-Compatibility"><a href="#Backwards-Compatibility" class="headerlink" title="Backwards Compatibility"></a>Backwards Compatibility</h2><p>Many providers adopted a draft version of this specification before it was finalized.</p><p>Providers that only implement this specification will not be compatible with Ethereum web applications that target the legacy API.</p><blockquote><p>The Provider is intended to pass messages between an Ethereum Client and an Ethereum application. It is <em>not</em> responsible for private key or account management; It merely processes RPC messages and emits events.<br>Consequently, account security and user privacy need to be implemented in middlewares between the Provider and its client. In practice, we call these middleware applications “Wallet”, and they usually manage the user’s private keys and accounts.</p></blockquote><blockquote><p>The Provider can be thought of as an extension of the Wallet, exposed in an <strong>untrusted</strong> environment, under the control of some third party(e.g. website)</p></blockquote><h3 id="Rules"><a href="#Rules" class="headerlink" title="Rules"></a>Rules</h3><ul><li>The Provider does not contain any private user data</li><li>The Provider and Wallet programs are isolated from each other</li><li>The Wallet and/or Client rate-limit requests from the Provider</li><li>The Wallet and/or Client validate all data sent from the Provider</li></ul><h2 id="Discussion"><a href="#Discussion" class="headerlink" title="Discussion"></a>Discussion</h2><p><a href="https://github.com/ethereum/EIPs/issues/2319">Discussion: EIP-1193</a></p><h2 id="Key-Updates"><a href="#Key-Updates" class="headerlink" title="Key Updates"></a>Key Updates</h2><p><a href="https://github.com/ethereum/EIPs/pull/2702">#2702</a> - Normative change, don’t require Provider to implement the <code>emit</code> method since it’s an implementation detail.</p><p><a href="https://github.com/ethereum/EIPs/pull/2695">#2695</a> - Remove all deprecated methods and events from teh API documentation, since they were only specified in the API documentation.</p><p><a href="https://github.com/ethereum/EIPs/pull/2673">#2673</a></p><ul><li>Remove index signature from interfaces<ul><li>i.e. no more <code>[key: string]: unknown</code>, the ability to add properties is implied</li></ul></li><li><code>RequestArguments</code><ul><li><code>params?: unknown</code> -&gt; <code>params?: unknown[] | object</code></li><li>Explicitly define relationship between <code>RequstArguments</code> fields and RPC method names and parameters<br>:</li><li><code>request</code> takes a single, options bag argument, <strong>to make it as extensible as possible</strong>. We are extremely unlikely to have to revisit it ever again.<ul><li>If devs find the options bag unergonomic, they can define their wrapper functions</li></ul></li></ul></li></ul><p><a href="https://github.com/ethereum/EIPs/pull/2590">#2590</a></p><ul><li>New signature for the <code>request</code> method, <code>Provider.request(args: RequestArguments): Promise&lt;unknown&gt;</code><ul><li>This is motivated by discussions with @frozeman and others, and enables a future for the Provider interface generally and the <code>request</code> method specifically where any of the following holds:</li><li>Multiple chains are served by a single Provider at once.</li><li><strong>Multiple protocols</strong> are served by a single Provider at once</li><li>The Provider needs some kind of metadata submitted along with <code>request</code> calls, for reasons we are unable to anticipate today</li></ul></li></ul><blockquote><p>IMO this is the most meaningful point to take this update: <strong>Multiple protocols</strong> are served by a single Provider at once.</p></blockquote><p><a href="https://github.com/ethereum/EIPs/pull/2577">#2577</a></p><ul><li>Deprecates <code>send</code> and <code>sendAsync</code></li><li>Specifies a new method <code>request</code>, with the same Promise signature as the <code>send</code> currently, per @MicahZoltu’s suggestion<ul><li>On the topic of alternate names, perhaps, <code>ethereum.request(...)</code>?. Since JSON-RPC is a request-response pairing I think this name makes sense.</li></ul></li><li>Changes the interface of the <code>notification</code> event, such that a generalized object is emitted.</li><li>Makes the spec transpot- and RPC protocol-agnostic, per the contributions of @ryanio</li><li>Add the <code>message</code> event for generalized messaging.</li></ul>]]></content>
      
      
      <categories>
          
          <category> Blockchain </category>
          
          <category> Ethereum </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ethereum </tag>
            
            <tag> Blockchain </tag>
            
            <tag> RFC </tag>
            
            <tag> EIP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Inspect-protobuf.js</title>
      <link href="/2020/01/17/Inspect-protobuf-js/"/>
      <url>/2020/01/17/Inspect-protobuf-js/</url>
      
        <content type="html"><![CDATA[<p><a href="https://ezcook.de/2017/12/22/Start-in-Protobuf/">Start in protobuf</a></p><p><strong>Protocol Buffers</strong> are a language-neutral, platform-neutral, extensible way of serializing structured data.</p><h2 id="Basic-usage"><a href="#Basic-usage" class="headerlink" title="Basic usage"></a>Basic usage</h2><h3 id="Using-JSON-descriptors"><a href="#Using-JSON-descriptors" class="headerlink" title="Using JSON descriptors"></a>Using JSON descriptors</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// awesome.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;nested&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;AwesomeMessage&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;fields&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;awesomeField&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;string&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;id&quot;</span>: <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><table><thead><tr><th>Type(T)</th><th>Extends</th><th>Type-specific properties</th></tr></thead><tbody><tr><td>Root</td><td>Namespace</td><td>nested</td></tr><tr><td>Type</td><td>Namespace</td><td>fields</td></tr><tr><td>Enum</td><td>ReflectionObject</td><td>values</td></tr><tr><td>Field</td><td>ReflectionObject</td><td>rule, type, id</td></tr><tr><td>MapField</td><td>Field</td><td>keyType</td></tr><tr><td>OneOf</td><td>ReflectionObject</td><td>oneof(array of field names)</td></tr><tr><td>Service</td><td>Namespace</td><td>methods</td></tr><tr><td>Method</td><td>ReflectionObject</td><td>type, requestType,responseType,requestStream,responseStream</td></tr></tbody></table><ul><li><code>T#fromJSON(name, json)</code> creates the responsive reflection object JSON descriptor</li><li><code>T#toJSON()</code> creates a JSON descriptor from the responsive reflection object</li></ul><h3 id="Using-reflection-only"><a href="#Using-reflection-only" class="headerlink" title="Using reflection only"></a>Using reflection only</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Root = protobuf.Root</span><br><span class="line"><span class="keyword">const</span> Type = protobuf.Type</span><br><span class="line"><span class="keyword">const</span> Field = protobuf.Field</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> AwesomeMessage = <span class="keyword">new</span> Type(<span class="string">&#x27;AwesomeMessage&#x27;</span>).add(<span class="keyword">new</span> Field(<span class="string">&#x27;awesomeField&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;string&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> root = <span class="keyword">new</span> Root().define(<span class="string">&#x27;awesomepackage&#x27;</span>).add(AwesomeMessage)</span><br></pre></td></tr></table></figure><hr><h2 id="Inspect-the-protobuf-js"><a href="#Inspect-the-protobuf-js" class="headerlink" title="Inspect the protobuf.js"></a>Inspect the protobuf.js</h2><blockquote><p>The code snippets following have been converted into class-style.</p></blockquote><h3 id="Protobuf-ReflectionObject"><a href="#Protobuf-ReflectionObject" class="headerlink" title="Protobuf ReflectionObject"></a>Protobuf ReflectionObject</h3><p>Located at <code>src/object.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> Root</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ReflectionObject</span> </span>&#123;</span><br><span class="line">  name: string <span class="comment">// unique name within its namespace</span></span><br><span class="line">  options: object</span><br><span class="line">  parent: string | <span class="literal">null</span> = <span class="literal">null</span> <span class="comment">// parent namespace</span></span><br><span class="line">  resolved: boolean = <span class="literal">false</span> <span class="comment">// whether already resolved or not</span></span><br><span class="line">  comment: string | <span class="literal">null</span> = <span class="literal">null</span> <span class="comment">// comment text, if any</span></span><br><span class="line">  filename: string | <span class="literal">null</span> = <span class="literal">null</span> <span class="comment">// defining file name</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>(name: string, options: object) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!isString(name)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">&#x27;name must be a string&#x27;</span>)</span><br><span class="line">    <span class="built_in">this</span>.name = name</span><br><span class="line">    <span class="keyword">if</span> (!isObject(options)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">&#x27;options must be an object&#x27;</span>)</span><br><span class="line">    <span class="built_in">this</span>.options = options</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@property <span class="variable">root</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@description </span>Reference to the root namespace</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  root: &#123;</span><br><span class="line">    get() &#123;</span><br><span class="line">      <span class="keyword">let</span> ptr = <span class="built_in">this</span>;</span><br><span class="line">      <span class="keyword">while</span>(ptr.parent !== <span class="literal">null</span>) &#123;</span><br><span class="line">        ptr = ptr.parent</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> ptr</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@property <span class="variable">fullName</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@description </span>full name including leading dot.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  fullName:&#123;</span><br><span class="line">    get() &#123;</span><br><span class="line">      <span class="keyword">let</span> path = [<span class="built_in">this</span>.name]</span><br><span class="line">      <span class="keyword">let</span> ptr = <span class="built_in">this</span>.parent</span><br><span class="line">      <span class="keyword">while</span>(ptr) &#123;</span><br><span class="line">        path.unshift(ptr.name)</span><br><span class="line">        ptr = ptr.parent</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> path.join(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@method <span class="variable">toJSON</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@description </span>Converts this reflection object to its descriptor representation</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  toJSON() &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="built_in">Error</span>() <span class="comment">// not implemented, shouldn&#x27;t happen</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@method <span class="variable">onAdd</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@description </span>called when this object is added to a parent</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  onAdd(parent) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.parent &amp;&amp; <span class="built_in">this</span>.parent !== parent) &#123;</span><br><span class="line">      <span class="built_in">this</span>.parent.remove(<span class="built_in">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">this</span>.parent = parent</span><br><span class="line">    <span class="built_in">this</span>.resolved = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">let</span> root = parent.root</span><br><span class="line">    <span class="keyword">if</span> (root <span class="keyword">instanceof</span> Root) &#123;</span><br><span class="line">      root._handleAdd(<span class="built_in">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@method <span class="variable">onRemove</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@description </span>called when this object is removed from a parent</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  onRemove(parent) &#123;</span><br><span class="line">    <span class="keyword">let</span> root = parent.root</span><br><span class="line">    <span class="keyword">if</span> (root <span class="keyword">instanceof</span> Root) &#123;</span><br><span class="line">      root._handleRemove(<span class="built_in">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">this</span>.parent = <span class="literal">null</span></span><br><span class="line">    <span class="built_in">this</span>.resolved = <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@method <span class="variable">resolve</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@description </span>resovles this objects type references</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  resolve() &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.resolved) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.root <span class="keyword">instanceof</span> Root) &#123;</span><br><span class="line">      <span class="built_in">this</span>.resolved = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@method <span class="variable">getOption</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@description </span>gets an option value</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  getOption(name) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.options) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.options[name]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">undefined</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@method </span>set an option</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  setOption(name, value, ifNotSet) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!ifNotSet || !<span class="built_in">this</span>.options || <span class="built_in">this</span>.options[name]===<span class="literal">undefined</span>) &#123;</span><br><span class="line">      (<span class="built_in">this</span>.options || <span class="built_in">this</span>.options = &#123;&#125;)[name] = valeu</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  setOptions(options, ifNotSet) &#123;</span><br><span class="line">    <span class="keyword">if</span> (options) &#123;</span><br><span class="line">      <span class="built_in">Object</span>.keys(options).forEach(<span class="function"><span class="params">name</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.setOption(name, options[name], ifNotSet)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  toString() &#123;</span><br><span class="line">    <span class="keyword">const</span> className = <span class="built_in">this</span>.constructor.className</span><br><span class="line">    <span class="keyword">const</span> fullName = <span class="built_in">this</span>.fullName</span><br><span class="line">    <span class="keyword">if</span> (fullName.length) &#123;</span><br><span class="line">      <span class="keyword">return</span> className + <span class="string">&#x27; &#x27;</span> + fullName</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> className</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@description </span>set up cyclic dependencies(called in index-light)</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  _configure = (Root_) &#123;</span><br><span class="line">    Root = Root_</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Protobuf-Namespace"><a href="#Protobuf-Namespace" class="headerlink" title="Protobuf Namespace"></a>Protobuf Namespace</h3><p>Located at <code>src/namespace.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> Type, Service, Enum</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@function <span class="variable">arrayToJSON</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>convert an array of reflection objects to JSON</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">arrayToJSON</span>(<span class="params">array, toJSONOptions</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!(array &amp;&amp; array.length)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">undefined</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> obj = &#123;&#125;</span><br><span class="line">  array.forEach(<span class="function"><span class="params">reflection</span> =&gt;</span> &#123;</span><br><span class="line">    obj[reflection.name] = reflection.toJSON(toJSONOptions)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> obj</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clearCache</span>(<span class="params">namepsace: Namespace</span>) </span>&#123;</span><br><span class="line">  namespace._nestedArray = <span class="literal">null</span></span><br><span class="line">  <span class="keyword">return</span> namespace</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Namespace</span> <span class="keyword">extends</span> <span class="title">ReflectionObject</span> </span>&#123;</span><br><span class="line">  nested: boolean = <span class="literal">undefined</span> <span class="comment">// nested objects by name</span></span><br><span class="line">  _nestedArray: ReflectionObject[] | <span class="literal">null</span> = <span class="literal">null</span> <span class="comment">// cached nested objects as an array</span></span><br><span class="line"></span><br><span class="line">  nestedArray:&#123;</span><br><span class="line">    get() &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>._nestedArray || (<span class="built_in">this</span>._nestedArray = util.toArray(<span class="built_in">this</span>.nested))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> arrayToJSON = arrayToJSON</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@mehtod <span class="variable">fromJSON</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@description </span>construct a namespace from JSON</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">static</span> fromJSON(name, json) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Namespace(name, json.options).addJSON(json.nested)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@mehtod <span class="variable">isReservedId</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@description </span>test if the specified id is reserved</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">static</span> isReservedId(reserved, id) &#123;</span><br><span class="line">    <span class="keyword">if</span> (reserved) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; reserved.length; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> reserved[i] !== <span class="string">&#x27;string&#x27;</span> &amp;&amp; reserved[i][<span class="number">0</span>] &lt;= id &amp;&amp; reserved[i][<span class="number">1</span>] &gt; id) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@method <span class="variable">isReservedName</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@description </span>test if the specified name is reserved</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  isReservedName(reserved, name) &#123;</span><br><span class="line">    <span class="keyword">if</span> (reserved) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; reserved.length; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (reserved[i] === name) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>(name, options) &#123;</span><br><span class="line">    <span class="built_in">super</span>(name, options)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@method <span class="variable">toJSON</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@description </span>convert this namespace to a namespace descriptor</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">static</span> toJSON(toJSONOptions) &#123;</span><br><span class="line">    <span class="keyword">return</span> util.toObject([</span><br><span class="line">      <span class="string">&#x27;options&#x27;</span>: <span class="built_in">this</span>.options,</span><br><span class="line">      <span class="string">&#x27;nested&#x27;</span>: arrayToJSON(<span class="built_in">this</span>.nestedArray, toJSONOptions)</span><br><span class="line">    ])</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@method <span class="variable">addJSON</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@description </span>Add nested objects to this namespace from nested object descriptors</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  addJSON(nestedJSON) &#123;</span><br><span class="line">    <span class="keyword">const</span> ns = <span class="built_in">this</span></span><br><span class="line">    <span class="keyword">if</span> (nestedJSON) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> names = <span class="built_in">Object</span>.keys(nestedJSON), i = <span class="number">0</span>, nested; i&lt; names.length; ++i) &#123;</span><br><span class="line">          nested = nestedJSON[names[i]]</span><br><span class="line">          ns.add(</span><br><span class="line">            (nested.fields !== <span class="literal">undefined</span> ? Type.fromJSON : nested.values !== <span class="literal">undefined</span> ? Enum.fromJSON : nested.methods !== <span class="literal">undefined</span> ? Service.fromJSON:nested.id !== <span class="literal">undefined</span> ? Field.fromJSON : Namespace.fromJSON)(names[i], nested)</span><br><span class="line">          )</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">this</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  get(name) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.nested &amp;&amp; <span class="built_in">this</span>.nested[name] || <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  getEnum(name) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.nested &amp;&amp; <span class="built_in">this</span>.nested[name] <span class="keyword">instanceof</span> Enum) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.nested[name].value</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`no such enum: <span class="subst">$&#123;name&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@mehtod <span class="variable">add</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@description </span>add a nested object to this namespace</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  add(object) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!(object <span class="keyword">instanceof</span> Field &amp;&amp; object.extend !== <span class="literal">undefined</span> || object <span class="keyword">instanceof</span> Type || object <span class="keyword">instanceof</span> Enum || object <span class="keyword">instanceof</span> Servce || object <span class="keyword">instanceof</span> Namespace)) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">&#x27;object must be a valid nested object&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.nested)&#123;</span><br><span class="line">      <span class="built_in">this</span>.nested = &#123;&#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> prev = <span class="built_in">this</span>.get(object.name)</span><br><span class="line">      <span class="keyword">if</span> (prev) &#123;</span><br><span class="line">        <span class="keyword">if</span> (prev <span class="keyword">instanceof</span> Namespace &amp;&amp; object <span class="keyword">instanceof</span> Namespace &amp;&amp; !(prev <span class="keyword">instanceof</span> Type || prev <span class="keyword">instanceof</span> Service)) &#123;</span><br><span class="line">          <span class="keyword">let</span> nested = prev.nestedArray</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; nested.length; ++i) &#123;</span><br><span class="line">            object.add(nested[i])</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="built_in">this</span>.remove(prev)</span><br><span class="line">          <span class="keyword">if</span> (!<span class="built_in">this</span>.nested) &#123;</span><br><span class="line">            <span class="built_in">this</span>.nested = &#123;&#125;</span><br><span class="line">          &#125;</span><br><span class="line">          object.setOptions(prev.options, <span class="literal">true</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`duplicate name <span class="subst">$&#123;object.name&#125;</span> in <span class="subst">$&#123;<span class="built_in">this</span>&#125;</span>`</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">this</span>.nested[object.name] = object</span><br><span class="line">    object.onAdd(<span class="built_in">this</span>)</span><br><span class="line">    <span class="keyword">return</span> clearCache(<span class="built_in">this</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Protobuf-Root"><a href="#Protobuf-Root" class="headerlink" title="Protobuf Root"></a>Protobuf Root</h3><h3 id="Protobuf-Enum"><a href="#Protobuf-Enum" class="headerlink" title="Protobuf Enum"></a>Protobuf Enum</h3><h3 id="Protobuf-Type"><a href="#Protobuf-Type" class="headerlink" title="Protobuf Type"></a>Protobuf Type</h3><h3 id="Protobuf-Field"><a href="#Protobuf-Field" class="headerlink" title="Protobuf Field"></a>Protobuf Field</h3><h3 id="Protobuf-OneOf"><a href="#Protobuf-OneOf" class="headerlink" title="Protobuf OneOf"></a>Protobuf OneOf</h3><h3 id="Protobuf-MapField"><a href="#Protobuf-MapField" class="headerlink" title="Protobuf MapField"></a>Protobuf MapField</h3><h3 id="Protobuf-Service"><a href="#Protobuf-Service" class="headerlink" title="Protobuf Service"></a>Protobuf Service</h3><h3 id="Protobuf-Method"><a href="#Protobuf-Method" class="headerlink" title="Protobuf Method"></a>Protobuf Method</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> ProtoBuf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Crx-Config</title>
      <link href="/2020/01/06/crx-config/"/>
      <url>/2020/01/06/crx-config/</url>
      
        <content type="html"><![CDATA[<p>This is a detailed customized chrome extension configuration cheatsheet.</p><h2 id="Manifest"><a href="#Manifest" class="headerlink" title="Manifest"></a>Manifest</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// required</span></span><br><span class="line">  <span class="attr">&quot;manifest_version&quot;</span>: <span class="number">2</span>, <span class="comment">// integer indicates the version of the manifest file format.</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Name of Extension&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;Version of Extension&quot;</span>, <span class="comment">// One to four dot-separated integers indicating the version of the extension, &quot;1.2.3.1234&quot;, and there&#x27;s a field named &quot;version_name&quot; for displaying purpose, &quot;version_name&quot;: &quot;1.0 beta&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Recommended</span></span><br><span class="line">  <span class="attr">&quot;default_locale&quot;</span>: <span class="string">&quot;en&quot;</span>, <span class="comment">// this field is required in extensions that have a &#x27;_locales&#x27; directory and must be absent in extensions that have no &#x27;_locales&#x27; directory.</span></span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;Description of Extension&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;icons&quot;</span>: &#123;</span><br><span class="line">    <span class="comment">// One or more icons that represent the extension, app, or theme.</span></span><br><span class="line">    <span class="attr">&quot;16&quot;</span>: <span class="string">&quot;icon16.png&quot;</span>, <span class="comment">// is used as the favicon for an extension&#x27;s pages</span></span><br><span class="line">    <span class="attr">&quot;48&quot;</span>: <span class="string">&quot;icon48.png&quot;</span>, <span class="comment">// 48 x 48 icon is for extension management page</span></span><br><span class="line">    <span class="attr">&quot;128&quot;</span>: <span class="string">&quot;icon128.png&quot;</span> <span class="comment">// You should always provides a 128 x 128 icon, it&#x27;s used during installation and by the Chrome Extension Store.</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Pick one or none</span></span><br><span class="line">  <span class="attr">&quot;browser_action&quot;</span>: &#123;</span><br><span class="line">    <span class="comment">// use browser actions to put icons in the main chrome toolbar, to the right of the address bar. It can have a tooltip, a badge and a popup</span></span><br><span class="line">    <span class="attr">&quot;default_icon&quot;</span>: &#123;</span><br><span class="line">      <span class="comment">// optional, you can use browserAction.setBadgeText, browserAction.setBadgeBackgroundColor to set the badge</span></span><br><span class="line">      <span class="attr">&quot;16&quot;</span>: <span class="string">&quot;images/icon16.png&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;24&quot;</span>: <span class="string">&quot;images/icon24.png&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;32&quot;</span>: <span class="string">&quot;images/icon32.png&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;default_title&quot;</span>: <span class="string">&quot;Tooltip of Extension&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;default_popup&quot;</span>: <span class="string">&quot;popup.html&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;page_action&quot;</span>: &#123;</span><br><span class="line">    <span class="comment">// use the chrome.pageAction API to put icons in the main chrome toolbar, to the right of the address bar. Page actions represent actions that can be taken on the current page, but that aren&#x27;t applicable to all pages. Page actions appear grayed out when inactive.</span></span><br><span class="line">    <span class="attr">&quot;default_icons&quot;</span>: &#123;</span><br><span class="line">      <span class="comment">// optional</span></span><br><span class="line">      <span class="attr">&quot;16&quot;</span>: <span class="string">&quot;images/icon16.png&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;24&quot;</span>: <span class="string">&quot;images/icon24.png&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;32&quot;</span>: <span class="string">&quot;images/icon32.png&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;default_title&quot;</span>: <span class="string">&quot;Tooltip of Extension&quot;</span>, <span class="comment">// optional</span></span><br><span class="line">    <span class="attr">&quot;default_popup&quot;</span>: <span class="string">&quot;popup.html&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Optional</span></span><br><span class="line">  <span class="attr">&quot;action&quot;</span>: <span class="string">&quot;//TODO&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;author&quot;</span>: <span class="string">&quot;//TODO&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;automation&quot;</span>: <span class="string">&quot;//TODO&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;background&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;scripts&quot;</span>: [],</span><br><span class="line">    <span class="attr">&quot;persistent&quot;</span>: <span class="literal">false</span>, <span class="comment">// Recommended to be false</span></span><br><span class="line">    <span class="attr">&quot;service_worker&quot;</span>: <span class="string">&quot;path to the sw&quot;</span> <span class="comment">// Optional</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;chrome_settings_override&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;homepage&quot;</span>: <span class="string">&quot;url of homepage&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;search_provider&quot;</span>: &#123;&#125;,</span><br><span class="line">    <span class="attr">&quot;startup_pages&quot;</span>: []</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;chrome_ui_overrides&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;bookmarks_ui&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;remove_bookmark_shortcut&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">&quot;remove_button&quot;</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;chrome_url_overrides&quot;</span>: &#123;&#125;, <span class="comment">// used to override pages provided by chrome. In addition to HTML, an override page usually has CSS and JavaScript Code.</span></span><br><span class="line">  <span class="attr">&quot;commands&quot;</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">&quot;content_capabilities&quot;</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">&quot;content_scripts&quot;</span>: [&#123;&#125;],</span><br><span class="line">  <span class="attr">&quot;content_security_poligy&quot;</span>: <span class="string">&quot;policyString&quot;</span>a,</span><br><span class="line">  <span class="attr">&quot;converted_from_user-script&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;devtools_page&quot;</span>: <span class="string">&quot;//TODO&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;event_rules&quot;</span>: [],</span><br><span class="line">  <span class="attr">&quot;externally_connectable&quot;</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">&quot;file_browser_handlers&quot;</span>: [],</span><br><span class="line">  <span class="attr">&quot;file_system_provider_capabilities&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;configurable&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;multiple_mounts&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;source&quot;</span>: <span class="string">&quot;network&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;homepage_url&quot;</span>: <span class="string">&quot;http://path/to/homepage&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;import&quot;</span>: [], <span class="comment">// shared modules</span></span><br><span class="line">  <span class="attr">&quot;export&quot;</span>: [], <span class="comment">// shared modules</span></span><br><span class="line">  <span class="attr">&quot;incognito&quot;</span>: <span class="string">&quot;//TODO&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;input_components&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;key&quot;</span>: <span class="string">&quot;publicKey&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;minimum_chrome_version&quot;</span>: <span class="string">&quot;versionString&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;nacl_modules&quot;</span>: [],</span><br><span class="line">  <span class="attr">&quot;oauth2&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;offline_enabled&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;omnibox&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;keyboard&quot;</span>: <span class="string">&quot;aString&quot;</span> <span class="comment">// The omnibox allows you to register a keyword with chrome&#x27;s address bar.</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;optional_permissions&quot;</span>: [<span class="string">&quot;tabs&quot;</span>],</span><br><span class="line">  <span class="attr">&quot;options_page&quot;</span>: <span class="string">&quot;options.html&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;options_ui&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;chrome_style&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;page&quot;</span>: <span class="string">&quot;options.html&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;permissions&quot;</span>: [<span class="string">&quot;tabs&quot;</span>],</span><br><span class="line">  <span class="attr">&quot;platforms&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;replacement_web_app&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;requirements&quot;</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">&quot;sandbox&quot;</span>: [],</span><br><span class="line">  <span class="attr">&quot;short_name&quot;</span>: <span class="string">&quot;short name&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;signature&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;spellcheck&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;storage&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;managed_schema&quot;</span>: <span class="string">&quot;schema.json&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;system_indicator&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;tts_engine&quot;</span>: &#123;&#125;,</span><br><span class="line">  &quot;update_url&quot;: &quot;http://path/to/updateInfo.xml&quot;,,</span><br><span class="line">  &quot;version_name&quot;: &quot;0.1 beta&quot;,</span><br><span class="line">  &quot;web_accessible_resource&quot;: []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="BrowerAction-Methods"><a href="#BrowerAction-Methods" class="headerlink" title="BrowerAction Methods"></a>BrowerAction Methods</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chrome.browserAction.method(params)</span><br></pre></td></tr></table></figure><ul><li>setTitle({ title: string, tabId?: number }, callback)</li><li>getTitle({ tabId?: number }, <string>callback)</li><li>setIcon({ imageData?: ImageDataType | object, path?: string | object, tabId?: number }, callback)</li><li>setPopup({ tabId?: number, popup: string }, callback)</li><li>getPopup({ tabId?: number }, <string>callback)</li><li>setBadgeText({ text: string, tabId?: number }, callback)</li><li>getBadgeText({ tabId?: number }, <string>callback)</li><li>setBadgeBackgroundColor({ color: string or ColorArray, tabId?: number }, callback)</li><li>getBadgeBackgroundColor({ tabId?: number }, callback)</li><li>enable({ tabId?: number }, callback)</li><li>disable({ tabId?: number }, callback)</li></ul><h2 id="BrowserAction-Events"><a href="#BrowserAction-Events" class="headerlink" title="BrowserAction Events"></a>BrowserAction Events</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chrome.browserAction.onClicked.addEventListener(<span class="function">(<span class="params">tab: tabs.Tab</span>) =&gt;</span> &#123;&#125;)</span><br></pre></td></tr></table></figure><h2 id="PageAction-Methods"><a href="#PageAction-Methods" class="headerlink" title="PageAction Methods"></a>PageAction Methods</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chrome.pageAction.method(params)</span><br></pre></td></tr></table></figure><ul><li>show({ tabId: number }, callback), the page action is shown whenever the tab is selected</li><li>hide({ tabId: number }, callback), hide the page action, means set the page action gray</li><li>setTitle({ tabId: number, title: string }, callback)</li><li>getTitle({ tabId: number }, <string>callback)</li><li>setIcon({ imageData: object | ImageDataType, path?: string | object, }), the path to the icons could be a dictionary {size =&gt; relative image path}, the actual image to be used is chosen depending on screen’s pixel density. Note that path = ‘foo’ equals to path = { ‘16’: foo }, implicitly converted into a dictionary.</li><li>setPopup({ tabId: number, popup: string }, callback)</li><li>getPopup({ tabId }, <string>callback)</li></ul><h2 id="PageAction-Events"><a href="#PageAction-Events" class="headerlink" title="PageAction Events"></a>PageAction Events</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chrome.pageAction.onClicked.addEventListener(<span class="function">(<span class="params">tab: tabs.Tab</span>) =&gt;</span> &#123;&#125;)</span><br></pre></td></tr></table></figure><h2 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h2><p>Extensions are event-driven programs used to modify or enhance the chrome browsing experience. Events are browser triggers and extensions monitor them in background scripts, then react to specified instructions.</p><p>A background page is loaded when it is needed, and unloaded when it goes idle.</p><pre><code>- The extension is first installed or updated to a new version.- The background page was listening for an event, and the event is dispatched.- A content script or other extension sends a message.- Another view in the extension, such as a popup, calls `runtime.getBackgroundPage`.</code></pre><h3 id="Register-background-scripts"><a href="#Register-background-scripts" class="headerlink" title="Register background scripts"></a>Register background scripts</h3><p>Background scripts are registered in the manifest under the “background” field. They are listed in an array of “background.scripts”.</p><p>Remember to set “persistent” to false unless the extension uses <code>chrome.webRequest</code> API to block or modify network requests.</p><h3 id="Initialize-the-extension"><a href="#Initialize-the-extension" class="headerlink" title="Initialize the extension"></a>Initialize the extension</h3><p>Listen to <code>runtime.onInstalled</code> event to initialize an extension on installation. Use this event to set a state or for one-time initialization, such as a context menu.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">chrome.runtime.onInstalled.addListener(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  chrome.contextMenu.create(&#123;</span><br><span class="line">    id: <span class="string">&#x27;sampleContextMneu&#x27;</span>,</span><br><span class="line">    title: <span class="string">&#x27;Sample Context Menu&#x27;</span>,</span><br><span class="line">    contexts: [<span class="string">&#x27;selection&#x27;</span>],</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Set-up-listeners"><a href="#Set-up-listeners" class="headerlink" title="Set up listeners"></a>Set up listeners</h3><p>Structure background scripts around events the extension depends on. Defining functionally relevant events allows background scripts to lie dormant until those events are fired and prevents the extension from missing important triggers.</p><p>Listeners must be registered synchronously from the start of the page.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This will run when a bookmark is created</span></span><br><span class="line">chrome.bookmark.onCreated.addListener(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// do something</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Do not register listeners asynchronously, as they will not be properly triggered.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DO NOT DO THIS</span></span><br><span class="line">chrome.runtime.onInstalled.addListener(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  chrome.bookmarks.onCreated.addListener(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Filter-events"><a href="#Filter-events" class="headerlink" title="Filter events"></a>Filter events</h3><p>Use APIs that supports <code>event filters</code> to restrict listeners to the cases the extension cares about. If an extension is listening for the <code>tabs.onUpdated</code> event, try using the <code>webNavigation.onCompleted</code> event with filters instead, as the tabs API does not support filters.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">chrome.webNavigation.onCompleted.addListener(</span><br><span class="line">  () =&gt; &#123;</span><br><span class="line">    alert(<span class="string">&#x27;This is my favorite website&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    url: [</span><br><span class="line">      &#123;</span><br><span class="line">        urlMatches: <span class="string">&#x27;http://www.google.com&#x27;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="React-to-listeners"><a href="#React-to-listeners" class="headerlink" title="React to listeners"></a>React to listeners</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">chrome.runtime.onMessage.addListener(<span class="function">(<span class="params">message, callback</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (message.data === <span class="string">&#x27;setAlarm&#x27;</span>) &#123;</span><br><span class="line">    chrome.alarms.create(&#123; <span class="attr">delayInMinutes</span>: <span class="number">5</span> &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (message.data === <span class="string">&#x27;runLogic&#x27;</span>) &#123;</span><br><span class="line">    chrome.tabs.executeScript(&#123; <span class="attr">file</span>: <span class="string">&#x27;logic.js&#x27;</span> &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (message.data === <span class="string">&#x27;changeColor&#x27;</span>) &#123;</span><br><span class="line">    chrome.tabs.executeScript(&#123;</span><br><span class="line">      code: <span class="string">&#x27;document.body.style.backgroundColor=&quot;orange&quot;&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Unload-background-scripts"><a href="#Unload-background-scripts" class="headerlink" title="Unload background scripts"></a>Unload background scripts</h3><p>Data should be persisted periodically so that important information is not lost if an extension crashes without receiving <code>onSuspend</code>. Use the <code>storage</code> API to assist with this.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chrome.storage.local.set(&#123; <span class="attr">variable</span>: <span class="string">&#x27;info&#x27;</span> &#125;)</span><br></pre></td></tr></table></figure><p>If an extension uses <code>message passing</code>, ensure all ports are closed. The background script will not unload until all message ports have shut.</p><p>Listen to <code>runtime.Port.onDisconnect</code> event will give insight to when open ports are closing. Manually close them with <code>runtime.Port.disconnect</code>.</p><p>Background scripts unload themself after a few seconds of inactivity. If any last minute cleanup is required, listen to <code>runtime.onSuspend</code> event.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">chrome.runtime.onSuspend.addListener(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;unloading&#x27;</span>)</span><br><span class="line">  chrome.browserAction.setBadgeText(&#123; <span class="attr">text</span>: <span class="string">&#x27;&#x27;</span> &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="Content-scripts"><a href="#Content-scripts" class="headerlink" title="Content scripts"></a>Content scripts</h2><p>Content scripts are files that run in the context of web pages. By using the standard DOM, they are able to read details of the web pages the browser visits, make changes to them and pass information to their parent extension.</p><p>Content scripts can access chrome APIs used by their parent extension by exchanging messages with the extension. They can also access the URL of an extension’s file with <code>chrome.runtime.getURL()</code> and use the result the same as other URLs.</p><p>Content scripts can access the following chrome APIs directly:</p><ul><li>i18n</li><li>storage</li><li>runtime<ul><li>connect</li><li>getManifest</li><li>getURL</li><li>id</li><li>onConnect</li><li>onMessage</li><li>sendMessage</li></ul></li></ul><p>Content scripts are unable to access other APIs directly.</p><h3 id="Work-in-isolated-worlds"><a href="#Work-in-isolated-worlds" class="headerlink" title="Work in isolated worlds"></a>Work in isolated worlds</h3><p>Content scripts live in an isolated world, allowing a content script to makes chagnes to its JavaScript environment without conflicting with the page or additional content scripts.</p><h3 id="Inject-scripts"><a href="#Inject-scripts" class="headerlink" title="Inject scripts"></a>Inject scripts</h3><p>Content scripts can be programmatically or declaratively injected.</p><h4 id="Inject-Programmatically"><a href="#Inject-Programmatically" class="headerlink" title="Inject Programmatically"></a>Inject Programmatically</h4><p>Use programmatic injection for content scripts that need to run on specific occasions.</p><p>To inject a programmatic content script, provide the <code>activeTab</code> permission in the manifest. This grants secure access to the active site’s host and temporary access to the <code>tabs</code> permission, enabling the content script to run on the current active tab without specifying <code>cross-origin premissions</code>.</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;permissions&quot;</span>: [<span class="string">&quot;activeTab&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Then content scripts can be injected as code</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">chrome.runtime.onMessage.addListener(<span class="function">(<span class="params">message, callback</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (message === <span class="string">&#x27;changeColor&#x27;</span>) &#123;</span><br><span class="line">    chrome.tabs.executeScript(&#123;</span><br><span class="line">      code: <span class="string">&#x27;document.body.style.backgroundColor=&quot;orange&quot;&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (message === <span class="string">&#x27;runContentScript&#x27;</span>) &#123;</span><br><span class="line">    chrome.tabs.executeScript(&#123;</span><br><span class="line">      file: <span class="string">&#x27;contentScript.js&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="Inject-declaratively"><a href="#Inject-declaratively" class="headerlink" title="Inject declaratively"></a>Inject declaratively</h4><p>Use declarative injection for content scripts that should be automatically run on specified pages.</p><p>Declaratively injected scripts are registered in the manifest.content_scripts field.</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;content_scripts&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;matches&quot;</span>: [<span class="string">&quot;http://*.nytimes.com/*&quot;</span>], <span class="comment">// required, specifies which pages this content script will be injected into.</span></span><br><span class="line">      <span class="attr">&quot;css&quot;</span>: [<span class="string">&quot;myStyles.css&quot;</span>], <span class="comment">// optional, the list of css files to be injected into the pages. They are injected orderly.</span></span><br><span class="line">      <span class="attr">&quot;js&quot;</span>: [<span class="string">&quot;contentScript.js&quot;</span>], <span class="comment">// optional, the list of js files to be injected into orderly.</span></span><br><span class="line">      <span class="attr">&quot;match_about_blank&quot;</span>: <span class="literal">false</span>, <span class="comment">// optional, whether or not to inject into the blank pages</span></span><br><span class="line">      <span class="attr">&quot;run_at&quot;</span>: <span class="string">&quot;document_idel&quot;</span>, <span class="comment">// controls when the files are injected, the preferred and default config is document_idle.</span></span><br><span class="line">      <span class="attr">&quot;all_frames&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Chrome-Permissions"><a href="#Chrome-Permissions" class="headerlink" title="Chrome Permissions"></a>Chrome Permissions</h2><p>Use the <code>chrome.permission</code> API to request declared optional permissions at run time rather than install time, so users understand why the permissions are needed and grant only those that are necessary.</p><h3 id="Decide-which-permissions-are-required-and-which-are-optional"><a href="#Decide-which-permissions-are-required-and-which-are-optional" class="headerlink" title="Decide which permissions are required and which are optional"></a>Decide which permissions are required and which are optional</h3><p>An extension can declare both required and optional permissions. In general, you should:</p><ul><li>Use required permissions when they are needed for your extension’s basic functionality.</li><li>Use optional permissions when they are needed for optional features in your extension.</li></ul><p>Advantages of required permissions:</p><ul><li>Fewer prompts: An extension can prompt the user once to accept all permissions.</li><li>Simpler development: Required permissions are guaranteed to be present.</li></ul><p>Advantages of optional permissions:</p><ul><li>Better security</li><li>Better information for users: An extension can explain why it needs a particular permission when the user enables the relevant feature.</li><li>Easier upgrades: When you upgrades your extension, chrome will not disable it for your users if the upgrade adds optional rather than required permissions.</li></ul><p>Declare optional permissions in your extension manifest with the <code>optional_permissions</code> key, using the same format as the <code>permission</code> field.</p><h3 id="Request-optional-permissions"><a href="#Request-optional-permissions" class="headerlink" title="Request optional permissions"></a>Request optional permissions</h3><p>Request the permission from within a user gesture using <code>permissions.request()</code>.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.querySelector(<span class="string">&#x27;#my-button&#x27;</span>).addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  chrome.permissions.request(</span><br><span class="line">    &#123;</span><br><span class="line">      permissions: [<span class="string">&#x27;tabs&#x27;</span>],</span><br><span class="line">      origins: [<span class="string">&#x27;http://www.google.com&#x27;</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">    (granted) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (granted) &#123;</span><br><span class="line">        <span class="comment">// do something</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// do something</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  )</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Check-the-extension’s-current-permissions"><a href="#Check-the-extension’s-current-permissions" class="headerlink" title="Check the extension’s current permissions"></a>Check the extension’s current permissions</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">chrome.permissions.contains(</span><br><span class="line">  &#123;</span><br><span class="line">    permissions: [<span class="string">&#x27;tabs&#x27;</span>],</span><br><span class="line">    origins: [<span class="string">&#x27;http://www.google.com&#x27;</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  (result) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (result) &#123;</span><br><span class="line">      <span class="comment">// the extension has the permissions</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// the extension doesn&#x27;t have the permissions</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="Remove-the-permissions"><a href="#Remove-the-permissions" class="headerlink" title="Remove the permissions"></a>Remove the permissions</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">chrome.permissions.remove(</span><br><span class="line">  &#123;</span><br><span class="line">    permissions: [<span class="string">&#x27;tabs&#x27;</span>],</span><br><span class="line">    origins: [<span class="string">&#x27;http://www.google.com&#x27;</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  (removed) =&gt; &#123;</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">  &#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="Requirements"><a href="#Requirements" class="headerlink" title="Requirements"></a>Requirements</h2><p>Technologies required by the app or extension. Hosting sites such as chrome web store may use this list to dissuade users from installing apps or extensions that will not work on their computer.</p><p>Supported requirements currently include “3D” and “plugins”.</p><h2 id="Messages"><a href="#Messages" class="headerlink" title="Messages"></a>Messages</h2><p>Since content scripts run in the context of a web page and not the extension, they often need some way of communicating with the rest of the extension. For example, an RSS reader extension might use content script to detect the presence of an RSS feed on a page, then notify the background page in order to display a page action icon for that page.</p><p>Communication between extensions and their content script scripts works by using message passing. Either side can listen for message sent from the other end, and respond on the same channel. A message can contain any valid JSON object.</p><h3 id="Simple-one-time-requests"><a href="#Simple-one-time-requests" class="headerlink" title="Simple one-time requests"></a>Simple one-time requests</h3><p>If you only need to send a single message to another part of your extension, you should use the simplified <code>runtime.sendMessage</code> and <code>tabs.sendMessage</code>. This lets you send a one-time JSON-serializable message from a content script to extension, or vice versa, respectively.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// send a request from content script</span></span><br><span class="line">chrome.runtime.sendMessage(&#123; <span class="attr">greeting</span>: <span class="string">&#x27;hello&#x27;</span> &#125;, <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// send a request from the extension to a content script works similar, except that you need to specify which tab to send it to.</span></span><br><span class="line">chrome.tabs.query(&#123; <span class="attr">active</span>: <span class="literal">true</span>, <span class="attr">currentWindow</span>: <span class="literal">true</span> &#125;, <span class="function">(<span class="params">tabs</span>) =&gt;</span> &#123;</span><br><span class="line">  chrome.tabs.sendMessage(tabs[<span class="number">0</span>].id, &#123; <span class="attr">greeting</span>: <span class="string">&#x27;hello&#x27;</span> &#125;, <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>On the receiving end, you need to set up an <code>runtime.onMessage</code> event listener to handle the message.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">chrome.runtime.onMessage.addListener(<span class="function">(<span class="params">req, sender, sendRespond</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(sender.tab ? <span class="string">`from a content script: <span class="subst">$&#123;sender.tab.url&#125;</span>`</span> : <span class="string">`from the extension`</span>)</span><br><span class="line">  <span class="keyword">if</span> (req.greeting === <span class="string">&#x27;hello&#x27;</span>) &#123;</span><br><span class="line">    sendResponse(&#123; <span class="attr">farewell</span>: <span class="string">&#x27;goodbye&#x27;</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>In the above example, the <code>sendResponse</code> is called synchronously. If you want to call the <code>sendResponse</code> asynchronously, simple <code>return true</code> at the end.</p><blockquote><p>Note: If multiple pages are listening on the onMessage events, only the first to call <code>sendResponse</code> for a particular event will succeed in sending response. Other response will be ignored.</p></blockquote><blockquote><p>Note: call sendResponse synchronously or return true. Without return true, sendResponse(undefined) will be called automatically and implicitly.</p></blockquote><h3 id="Long-lived-connections"><a href="#Long-lived-connections" class="headerlink" title="Long-lived connections"></a>Long-lived connections</h3><p>Sometimes it’s useful to have a conversation lasting longer than one-time request.</p><p>You can open a long-lived channel from content script to an extension page, or vice versa, by using <code>runtime.connect</code> or <code>tab.connect</code>.</p><p>When establishing a connection, each end is given a <code>runtime.Port</code> object which is used for sending and receiving messages through that connection.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> port = chrome.runtime.connect(&#123; <span class="attr">name</span>: <span class="string">&#x27;knockknock&#x27;</span> &#125;)</span><br><span class="line">port.postMessage(&#123; <span class="attr">joke</span>: <span class="string">&#x27;Knock knock&#x27;</span> &#125;)</span><br><span class="line">port.onMessage.addListener(<span class="function">(<span class="params">msg</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (msg.question === <span class="string">&quot;Who&#x27;s there?&quot;</span>) &#123;</span><br><span class="line">    port.postMessage(&#123; <span class="attr">answer</span>: <span class="string">&#x27;Madame&#x27;</span> &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (msg.question === <span class="string">&#x27;Madame who?&#x27;</span>) &#123;</span><br><span class="line">    port.postMessage(&#123; <span class="attr">answer</span>: <span class="string">&#x27;Madame... Bovary&#x27;</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Chrome </tag>
            
            <tag> Extensions </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Introduction to MACD</title>
      <link href="/2019/12/03/Introduction-to-MACD/"/>
      <url>/2019/12/03/Introduction-to-MACD/</url>
      
        <content type="html"><![CDATA[<p>Moving Average Convergence Divergence(MACD) is a market indicator on trending momentum to show the relationshops between two moving averages of a security’ price.</p><p>The MACD is calculated bey subtracting the long-term Exponential Moving Average(EMA) from the short-term EMA.</p><p>The display of MACD is the MACD line, and a nine-day EMA of the MACD called the ‘signal line’, is then plotted on the top of MACD line. It functions as a trigger of buying or selling. Traders could buy the security when the MACD crosses above the signal line and sell the security when the MACD crosses below the signal line.</p><p>Synopsis</p><ul><li><p>MACD is calculated by substracting the long-term EMA from the short-term EMA.</p></li><li><p>MACD triggers technical signals when it crosses above to buy or below to sell its signal line.</p></li><li><p>The speed of crossovers is also taken as a signal of the market to overbuy or oversell.</p></li><li><p>MACD helps investors understand whether the bullish or bearish momentum the market is.</p></li></ul><p>The MACD has a positive value whenever the short-term EMA is above the long-term EMA and a negative value when the short-term EMA is below the long-term EMA.</p><p>The more distant the MACD is above or below it’s baseline, the growing of distance between two EMAs is faster.</p><p>As the following chart shows:</p><p><img src="https://www.investopedia.com/thmb/jbHkw_VcrdOx5ehBVmGTE9OOYPI=/640x0/filters:no_upscale():max_bytes(150000):strip_icc():format(webp)/Figure2-5c425aecc9e77c0001bc2f4f.png"></p><p>MACD is often displayed in a histogram foramt, which graphs the distance between the MACD and its baseline.</p><p>If the MACD is above the baseline, the histogram will be above the MACD’s baseline, otherwise the histogram will be below the MACD’s baseline.</p><p>Traders use the MACD histogram to identify when bullish or bearish momentum is high.</p><h2 id="MACD-vs-RSI"><a href="#MACD-vs-RSI" class="headerlink" title="MACD vs. RSI"></a>MACD vs. RSI</h2><p>The relative strength indicator(RSI) aims to signal whether a market is considered to be overbought or oversold in relation to recent price levels.</p><p>The RSI is an oscillator that calculates average price gains and losses over a given period.</p><p>MACD measures <strong>the relationship between two EMAs</strong>, while the RSI measures <strong>price change in relation to recent price highs and lows</strong>.</p>]]></content>
      
      
      
        <tags>
            
            <tag> Economics </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Basic Components in nest.js</title>
      <link href="/2019/10/10/Basic-components-in-nest-js/"/>
      <url>/2019/10/10/Basic-components-in-nest-js/</url>
      
        <content type="html"><![CDATA[<h2 id="Module"><a href="#Module" class="headerlink" title="Module"></a>Module</h2><p>A module in a nest.js application is used to organize related controllers and service providers into a single logical file.</p><p>Simply use the <code>@Module</code> decorator with metadata to the module class to designate what controllers, service providers, and other related resources will be instantiated and used later.</p><p>Nest also ships a <code>@Global</code> decorator to allow the module to be shared with other module implicitly.</p><p>And nest module system has a feature called Dynamic modules, which enable you to produce customized modules.</p><p>The most general useage of dynamic modules is to connect the database:</p><ul><li>The Dynamic module provides a Connection object. In addition, based on the options passed for the module’s <code>forRoot()</code> static function, the module adds more providers and exports them to the modules where it’s imported.</li></ul><h2 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h2><p>A controller is responsible for handling incoming HTTP requests, processing them and formulating a proper HTTP response to the client.</p><p>A controller groups a set of route handlers - we call them actions - in a class.</p><h2 id="Provider"><a href="#Provider" class="headerlink" title="Provider"></a>Provider</h2><p>A provider is used to encapsulate related business logic and functions.</p><h2 id="Dependency-Injection-DI-and-Inversion-of-Controller-IoC"><a href="#Dependency-Injection-DI-and-Inversion-of-Controller-IoC" class="headerlink" title="Dependency Injection(DI) and Inversion of Controller(IoC)"></a>Dependency Injection(DI) and Inversion of Controller(IoC)</h2><p>// TODO</p><h2 id="Middleware"><a href="#Middleware" class="headerlink" title="Middleware"></a>Middleware</h2><p>Middleware is used to access the current request, response.</p><p>Middleware is executed precedes the route handler.</p><h2 id="Exception-Filter"><a href="#Exception-Filter" class="headerlink" title="Exception Filter"></a>Exception Filter</h2><p>Nestjs comes with a built-in general-purpose global exception filter that handles all thrown exceptions in the application.</p><p>Specially, it handles exceptions that are of type HttpException or any other exception class that it inherits from HttpException.</p><h2 id="Pipe"><a href="#Pipe" class="headerlink" title="Pipe"></a>Pipe</h2><p>A pipe in nest.js is a class annotated with the <code>Injectable</code> decorator and used to transform data from one format to another, to validate route handler parameters and to produce a new data format based on input parameters.</p><p>Nest.js comes with two built-in pipes: <code>ValidationPipe</code>, and <code>ParseIntPipe</code>.</p><h2 id="Guard"><a href="#Guard" class="headerlink" title="Guard"></a>Guard</h2><p>A guard is a class annotated with <code>Injectable</code> decorator. It extends <code>CanActivate</code> class and implements the <code>canActivate()</code> method.</p><p>It decides whether the route handler executes the current request or not, based on the value returned from the <code>canActivate()</code> method.</p><h2 id="Interceptor"><a href="#Interceptor" class="headerlink" title="Interceptor"></a>Interceptor</h2><p>interceptor originates from the Aspect-Oriented Programming concepts.</p><p>An interceptor manipulates requests and responses.</p><h2 id="GraphQL"><a href="#GraphQL" class="headerlink" title="GraphQL"></a>GraphQL</h2><p>// TODO</p><h2 id="WebSocket"><a href="#WebSocket" class="headerlink" title="WebSocket"></a>WebSocket</h2><p>// TODO</p>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
            <tag> Nest.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Snippet of GitHub Actions</title>
      <link href="/2019/09/16/Snippet-of-GitHub-Actions/"/>
      <url>/2019/09/16/Snippet-of-GitHub-Actions/</url>
      
        <content type="html"><![CDATA[<h2 id="Core-Conceptions-for-GitHub-Actions"><a href="#Core-Conceptions-for-GitHub-Actions" class="headerlink" title="Core Conceptions for GitHub Actions"></a>Core Conceptions for GitHub Actions</h2><ol><li>Workflow</li></ol><p>A configurable automated process</p><ol start="2"><li>Workflow run</li></ol><p>An instance of the workflow that runs when the pre-configured event occurs</p><ol start="3"><li>Workflow file</li></ol><p>The YAML file that defines the workflow configuration with at least one job.</p><ol start="4"><li>Job</li></ol><p>A defined task made up of steps. Each job is run in a <em>fresh instance</em> of the virtual environement.</p><ol start="5"><li>Step</li></ol><p>A step is a set of tasks performed by a job. Each step in a job executes in the same virtual environment, allowing the actions in that job to share information using the filesystem.</p><ol start="6"><li>Action</li></ol><p>Individual tasks that combined as steps to create a job. Actions are the smallest portable building block of a workflow.</p><h2 id="Configuring-a-workflow"><a href="#Configuring-a-workflow" class="headerlink" title="Configuring a workflow"></a>Configuring a workflow</h2><h3 id="About-workflows"><a href="#About-workflows" class="headerlink" title="About workflows"></a>About workflows</h3><ol><li>Store workflows in the <code>.github/workflows</code> directory in the root of the repository</li></ol><h3 id="Create-a-workflow-file"><a href="#Create-a-workflow-file" class="headerlink" title="Create a workflow file"></a>Create a workflow file</h3><ol><li>At the root of the repository, create a directory named <code>./github/workflows</code> to store the workflow files.</li><li>In <code>.github/workflows</code>, add a <code>.yml</code> or <code>.yaml</code> file for the workflow.</li><li>Use <code>Workflow syntax for GitHub Actions</code> reference documentation to choose events to trigger an action, add actions, and customize the workflows.</li><li>Commit the changes in the workflow file to the branch where the workflow is desired to run.</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Greet</span> <span class="string">Everyone</span></span><br><span class="line"><span class="comment"># This workflow is triggered on pushes to the repository</span></span><br><span class="line"><span class="attr">on:</span> [<span class="string">push</span>]</span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">build:</span></span><br><span class="line">    <span class="comment"># Job name is Greeting</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Greeting</span></span><br><span class="line">    <span class="comment"># This job runs on Linux</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="comment"># This step uses GitHub&#x27;s hello-world-javascript-action</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Hello</span> <span class="string">World</span></span><br><span class="line">        <span class="attr">use:</span> <span class="string">actions/hello-world-javascript-action@v1</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">who-to-greet:</span> <span class="string">&#x27;Mona the Octocat&#x27;</span></span><br><span class="line">        <span class="attr">id:</span> <span class="string">hello</span></span><br><span class="line">      <span class="comment"># This step prints an output (time) from the previous step&#x27;s action</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Echo</span> <span class="string">the</span> <span class="string">greeting&#x27;s</span> <span class="string">time</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">echo</span> <span class="string">&#x27;The time was $\&#123;\&#123; steps.hello.outputs.time &#125;&#125;.&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="Configuring-a-build-matrix"><a href="#Configuring-a-build-matrix" class="headerlink" title="Configuring a build matrix"></a>Configuring a build matrix</h3><p>To test across multiple operating system, platforms, and language versions at the same time, a matrix could be set up.</p><p>A build matrix provides different configurations for the virtual environment to test.</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">runs-on:</span> <span class="string">$\&#123;\&#123;</span> <span class="string">matrix.os</span> <span class="string">&#125;&#125;</span></span><br><span class="line"><span class="attr">strategy:</span></span><br><span class="line">  <span class="attr">matrix::</span></span><br><span class="line">    <span class="attr">os:</span> [<span class="string">ubuntu-14.04</span>, <span class="string">ubuntu-18.04</span>]</span><br><span class="line">    <span class="attr">node:</span> [<span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>]</span><br></pre></td></tr></table></figure><h3 id="Using-the-checkout-action"><a href="#Using-the-checkout-action" class="headerlink" title="Using the checkout action"></a>Using the checkout action</h3><p>There are several standard actions you can use in your workflow. The checkout action is a standard action that you must include in your workflow before other actions when:</p><ul><li>Your workflow requires a copy of your repository’s code, such as when you’re building and testing your repository or using continuous integration.</li><li>There’s at least one action in your workflow that is defined in the same repository.</li></ul><p>To use the standard checkout action without furthur specifications, including this step:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/checkout@v1</span></span><br></pre></td></tr></table></figure><p>Using <code>v1</code> in this example ensures you’re using a stable version of the checkout action.</p><p>The <em>shallow clone</em> your repository, or copy only the latest version of your repository, set the <code>fetch-deptch</code> with the <code>with</code> syntax:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/checkout@v1</span></span><br><span class="line">  <span class="attr">with:</span></span><br><span class="line">    <span class="attr">fetch-depth:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><h3 id="Referencing-actions-in-your-workflow"><a href="#Referencing-actions-in-your-workflow" class="headerlink" title="Referencing actions in your workflow"></a>Referencing actions in your workflow</h3><p>To reference actions in your workflow file with the correct syntax, you must consider where the action is defined.</p><p>Workflows can use actions defined in</p><ul><li>A public repository</li><li>The same repository where your workflow file references the actions</li><li>A publised Docker container image on Docker Hub</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">my_first_job:</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/setup-node@v1</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">node-version:</span> <span class="number">10.</span><span class="string">x</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">./.github/actions/hello-world-action</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">docker://alpine:3.8</span></span><br></pre></td></tr></table></figure><h2 id="Workflow-syntax-for-GitHub-Actions"><a href="#Workflow-syntax-for-GitHub-Actions" class="headerlink" title="Workflow syntax for GitHub Actions"></a>Workflow syntax for GitHub Actions</h2><h3 id="name"><a href="#name" class="headerlink" title="name"></a>name</h3><p>The name of the workflow.</p><h3 id="on"><a href="#on" class="headerlink" title="on"></a>on</h3><p><strong>Required</strong> The name of the <a href="https://help.github.com/en/articles/events-that-trigger-workflows">GitHub event</a> that triggers the workflow.<br><code>string</code>, <code>array</code> and <code>map</code> are acceptable</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">on:</span> <span class="string">push</span></span><br><span class="line"><span class="attr">on:</span> [<span class="string">push</span>, <span class="string">pull_request</span>]</span><br></pre></td></tr></table></figure><h4 id="on-lt-push-pull-request-gt-lt-tag-branches-gt"><a href="#on-lt-push-pull-request-gt-lt-tag-branches-gt" class="headerlink" title="on.&lt;push|pull_request&gt;.&lt;tag|branches&gt;"></a>on.&lt;push|pull_request&gt;.&lt;tag|branches&gt;</h4><p>When using the <code>push</code> and <code>pull_request</code> events, you can configure a workflow to run on specific branches or tags</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;release/*&#x27;</span></span><br><span class="line">    <span class="attr">tags:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">v1</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">v1.0</span></span><br></pre></td></tr></table></figure><h4 id="on-lt-push-pull-request-gt-paths"><a href="#on-lt-push-pull-request-gt-paths" class="headerlink" title="on.&lt;push|pull_request&gt;.paths"></a>on.&lt;push|pull_request&gt;.paths</h4><p>When using the <code>push</code> and <code>pull_request</code> events, you can configure a workflow to run when at least one modified file matches a pattern defined in <code>paths</code>.</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;!*.js&#x27;</span></span><br><span class="line">      <span class="string">```</span></span><br></pre></td></tr></table></figure><h3 id="jobs"><a href="#jobs" class="headerlink" title="jobs"></a>jobs</h3><p>A workflow run is made up of one or more jobs. Jobs run in <em>parallel</em> by default. To run jobs sequentially, you can define dependencies on other jobs using the <code>jobs.&lt;job_id&gt;.needs</code> keywords.</p><p>Each job runs in a <em>fresh instance</em> of the virtual environment specified by <code>runs-on</code>.</p><h4 id="jobs-1"><a href="#jobs-1" class="headerlink" title="jobs."></a>jobs.<job_id></h4><p>Each job must have an id to associate with the job. The key <code>job_id</code> is a string and its value is a map of the job’s configuration data.</p><p>You must replace <code>&lt;job_id&gt;</code> with a string that is unique to the <code>jobs</code> object. The <code>&lt;job_id&gt;</code> must start with a letter or <code>_</code> and contain only alphanumeric characters, <code>-</code> or <code>_</code>.</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">my_first_job:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">My</span> <span class="string">first</span> <span class="string">job</span></span><br><span class="line">  <span class="attr">my_second_job:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">My</span> <span class="string">second</span> <span class="string">job</span></span><br></pre></td></tr></table></figure><h4 id="jobs-name"><a href="#jobs-name" class="headerlink" title="jobs..name"></a>jobs.<job_id>.name</h4><p>The name of the job displayed on GitHub</p><h4 id="jobs-needs"><a href="#jobs-needs" class="headerlink" title="jobs..needs"></a>jobs.<job_id>.needs</h4><p>Identifies any jobs that must complete successfully before this job will run. It can be a string or array of string</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">job1:</span></span><br><span class="line">  <span class="attr">job2:</span></span><br><span class="line">    <span class="attr">needs:</span> <span class="string">job1</span></span><br><span class="line">  <span class="attr">job3:</span></span><br><span class="line">    <span class="attr">needs:</span> [<span class="string">job1</span>, <span class="string">job2</span>]</span><br></pre></td></tr></table></figure><h4 id="jobs-runs-on"><a href="#jobs-runs-on" class="headerlink" title="jobs.runs-on"></a>jobs<job_id>.runs-on</h4><p><strong>Required</strong> The type of virtual host machine to run the job on. Each job runs with a fresh instance of the virtual environment specified by <code>runs-on</code>:</p><p>Available virtual machine types are:</p><ul><li>ubuntu-latest, ubuntu-18.04 or ubuntu-16.04</li><li>windows-latest, windows-2019 or windows-2016</li><li>macOS-latest, macOS-10.14</li></ul><h4 id="jobs-steps"><a href="#jobs-steps" class="headerlink" title="jobs..steps"></a>jobs.<job_id>.steps</h4><p>A job contains a sequence of tasks called <code>steps</code>. Steps can run commands, run setup tasks, or run an action in your repository, a public repository, or an action published in a Docker registry.</p><p>Each step run in its own <em>process</em> in the virtual environment and has access to the workspace and filesystem. Because steps run in their own process, changes to environment variables are not preserved between steps.</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Greeting</span> <span class="string">from</span> <span class="string">Mona</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span> <span class="string">push</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">my-job:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">My</span> <span class="string">Job</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Print</span> <span class="string">a</span> <span class="string">greeting</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">          <span class="attr">MY_VAR:</span> <span class="string">Hi</span> <span class="string">there!</span> <span class="string">My</span> <span class="string">name</span> <span class="string">is</span></span><br><span class="line">          <span class="attr">FIRST_NAME:</span> <span class="string">Mona</span></span><br><span class="line">          <span class="attr">LAST_NAME:</span> <span class="string">Octocat</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line">          <span class="string">echo</span> <span class="string">$MY_VAR</span> <span class="string">$FIRST_NAME</span> <span class="string">$LAST_NAME.</span></span><br></pre></td></tr></table></figure><h5 id="jobs-steps-id"><a href="#jobs-steps-id" class="headerlink" title="jobs..steps.id"></a>jobs.<job_id>.steps.id</h5><p>A unique identifier for the step. You can use the <code>id</code> to reference the step in contexts.</p><h5 id="jobs-steps-if"><a href="#jobs-steps-if" class="headerlink" title="jobs..steps.if"></a>jobs.<job_id>.steps.if</h5><p>You can use the <code>if</code> conditional to prevent a step from running unless a condition is met.</p><p>Expression in an <code>if</code> conditional do not require the <code>$\&#123;\&#123; &#125;&#125;</code> syntax.</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">steps:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">My</span> <span class="string">first</span> <span class="string">step</span></span><br><span class="line">    <span class="attr">if:</span> <span class="string">github.event_name</span> <span class="string">==</span> <span class="string">&#x27;pull_request&#x27;</span> <span class="string">&amp;&amp;</span> <span class="string">github.event.action</span> <span class="string">==</span> <span class="string">&#x27;unassigned&#x27;</span></span><br><span class="line">    <span class="attr">run:</span> <span class="string">echo</span> <span class="string">This</span> <span class="string">event</span> <span class="string">is</span> <span class="string">a</span> <span class="string">pull</span> <span class="string">request</span> <span class="string">that</span> <span class="string">had</span> <span class="string">an</span> <span class="string">assignee</span> <span class="string">removed</span></span><br></pre></td></tr></table></figure><h5 id="jobs-step-name"><a href="#jobs-step-name" class="headerlink" title="jobs..step.name"></a>jobs.<job_id>.step.name</h5><p>A name for the step to display on GitHub.</p><h5 id="jobs-steps-uses"><a href="#jobs-steps-uses" class="headerlink" title="jobs..steps.uses"></a>jobs.<job_id>.steps.uses</h5><p>Selects an action to run as part of a step in your job. An action is a reusable unit of code.</p><p>The version of the action is strongly recommended to be included in the action by specifying a Git Ref, SHA, or Docker tag number.</p><h5 id="jobs-steps-with"><a href="#jobs-steps-with" class="headerlink" title="jobs..steps.with"></a>jobs.<job_id>.steps.with</h5><p>A <code>map</code> of the input parameters defined by the action. Each input parameter is a key/pair. Input parameters are set as environment variables.</p><p>The variable is prefixed with <code>INPUT_</code> and converted to uppercase.</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">my_first_step:</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">My</span> <span class="string">first</span> <span class="string">step</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/hello_world@master</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">first_name:</span> <span class="string">Mona</span> <span class="comment"># INPUT_FIRST_NAME</span></span><br><span class="line">          <span class="attr">middle_name:</span> <span class="string">The</span> <span class="comment"># INPUT_MIDDLE_NAME</span></span><br><span class="line">          <span class="attr">last_name:</span> <span class="string">Octocat</span> <span class="comment"># INPUT_LAST_NAME</span></span><br></pre></td></tr></table></figure><h5 id="jobs-steps-with-args"><a href="#jobs-steps-with-args" class="headerlink" title="jobs..steps.with.args"></a>jobs.<job_id>.steps.with.args</h5><p>// TODO:</p><h5 id="jobs-steps-with-entrypoint"><a href="#jobs-steps-with-entrypoint" class="headerlink" title="jobs.steps.with.entrypoint"></a>jobs<job_id>.steps.with.entrypoint</h5><p>// TODO:</p><h5 id="jobs-steps-env"><a href="#jobs-steps-env" class="headerlink" title="jobs..steps.env"></a>jobs.<job_id>.steps.env</h5><p>Sets environment variables for steps to use in the virtual environment. Public actions may specify expected environment variables in the README file.</p><p>If you are setting a secret in an environment variable, you must set secrets using the <code>secrets</code> context.</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">steps:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">My</span> <span class="string">first</span> <span class="string">step</span></span><br><span class="line">    <span class="attr">env:</span></span><br><span class="line">      <span class="attr">GITHUB_TOKEN:</span> <span class="string">$\&#123;\&#123;</span> <span class="string">secrets.GITHUB_TOKEN</span> <span class="string">&#125;&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Git </tag>
            
            <tag> Github Action </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Methods of the String in JavaScript </title>
      <link href="/2019/08/30/Methods-of-the-String-in-JavaScript/"/>
      <url>/2019/08/30/Methods-of-the-String-in-JavaScript/</url>
      
        <content type="html"><![CDATA[<ol><li><p><code>String.prototype.charAt(index: number): string</code>: Returns the character(exactly one UTF-16 code unit) at the specified index.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;hello world&#x27;</span>.charAt(<span class="number">1</span>) <span class="comment">// returns &#x27;e&#x27;</span></span><br></pre></td></tr></table></figure></li><li><p><code>String.prototype.charCodeAt(index: number): number</code>: Returns a number that is the UTF-16 code unit value at the specified index.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;hello world&#x27;</span>.charCodeAt(<span class="number">1</span>) <span class="comment">// returns 101</span></span><br></pre></td></tr></table></figure></li><li><p><code>String.prototype.codePointAt(index: string): number</code>: Returns a nonnegative integer Number that is the code point value of the UTF-16 encoded code point starting at the specified index.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;hello world&#x27;</span>.codePointAt(<span class="number">1</span>) <span class="comment">// returns 101</span></span><br></pre></td></tr></table></figure></li><li><p><code>String.prototype.concat(str: string, ...rest: string[]): string</code>: Combines the texts and returns a new string.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;hello world&#x27;</span>.concat(<span class="string">&#x27;, &#x27;</span>, <span class="string">&#x27;and welcome&#x27;</span>) <span class="comment">// returns &#x27;hello world, and welcome&#x27;</span></span><br></pre></td></tr></table></figure></li><li><p><code>String.prototype.includes(str: string): boolean</code>: Determines whether one string may be found within another string.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;hello world&#x27;</span>.includes(<span class="string">&#x27;world&#x27;</span>) <span class="comment">// returns true</span></span><br></pre></td></tr></table></figure></li><li><p><code>String.prototype.endsWith(str: string): boolean</code>: Determines whether a string ends with the characters of another string.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;hello world&#x27;</span>.endsWith(<span class="string">&#x27;world&#x27;</span>) <span class="comment">// returns true</span></span><br></pre></td></tr></table></figure></li><li><p><code>String.prototype.indexOf(str: string): number</code>: Returns the index of the specified string, -1 for not found.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s.indexOf(<span class="string">&#x27;world&#x27;</span>) <span class="comment">// returns 6</span></span><br></pre></td></tr></table></figure></li><li><p><code>String.prototype.lastIndexOf(str: string)</code>: Returns the index of the specified string, but search starts from the end, -1 for not found</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;world hello world&#x27;</span>.indexOf(<span class="string">&#x27;world&#x27;</span>) <span class="comment">// returns 0</span></span><br><span class="line"><span class="string">&#x27;world hello world&#x27;</span>.lastIndexOf(<span class="string">&#x27;world&#x27;</span>) <span class="comment">// returns 12</span></span><br></pre></td></tr></table></figure></li><li><p><code>String.prototype.localeCompare(str: string)</code>: Returns a number indicating whether a reference string comes before or after or is the same as the given string in sort order.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = <span class="string">&#x27;réservé&#x27;</span> <span class="comment">// with accents, lowercase</span></span><br><span class="line"><span class="keyword">const</span> b = <span class="string">&#x27;RESERVE&#x27;</span> <span class="comment">// no accents, uppercase</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(a.localeCompare(b))</span><br><span class="line"><span class="comment">// expected output: 1</span></span><br><span class="line"><span class="built_in">console</span>.log(a.localeCompare(b, <span class="string">&#x27;en&#x27;</span>, &#123; <span class="attr">sensitivity</span>: <span class="string">&#x27;base&#x27;</span> &#125;))</span><br><span class="line"><span class="comment">// expected output: 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// The letter &quot;a&quot; is before &quot;c&quot; yielding a negative value</span></span><br><span class="line"><span class="string">&#x27;a&#x27;</span>.localeCompare(<span class="string">&#x27;c&#x27;</span>) <span class="comment">// -2 or -1 (or some other negative value)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Alphabetically the word &quot;check&quot; comes after &quot;against&quot; yielding a positive value</span></span><br><span class="line"><span class="string">&#x27;check&#x27;</span>.localeCompare(<span class="string">&#x27;against&#x27;</span>) <span class="comment">// 2 or 1 (or some other positive value)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// &quot;a&quot; and &quot;a&quot; are equivalent yielding a neutral value of zero</span></span><br><span class="line"><span class="string">&#x27;a&#x27;</span>.localeCompare(<span class="string">&#x27;a&#x27;</span>) <span class="comment">// 0</span></span><br></pre></td></tr></table></figure></li><li><p><code>String.prototype.match(regexp): string[] | null</code>: Used to match a regular expression against a string, null for not found</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> paragraph = <span class="string">`The quick brown fox jumps over the lazy dog. It barked`</span></span><br><span class="line"><span class="keyword">const</span> regex = <span class="regexp">/[A-Z]/g</span></span><br><span class="line">paragraph.match(regex) <span class="comment">// returns [&quot;T&quot;, &quot;I&quot;]</span></span><br></pre></td></tr></table></figure></li><li><p><code>String.prototype.matchAll(regex): Iterator</code>: Returns an iterator of all matches.</p></li><li><p><code>String.prototype.normalize</code>: Returns the Unicode Normalization Form of the calling string value.</p></li><li><p><code>String.prototype.padEnd()</code>: Pads the current string with a given string(repeated if needed) so that the resulting string reaches a given length. The padding is appliced fromthe end of the current string.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;Breaded Mushrooms&#x27;</span>.padEnd(<span class="number">25</span>, <span class="string">&#x27;.&#x27;</span>) <span class="comment">// returns &quot;Breaded Mushrooms........&quot;</span></span><br></pre></td></tr></table></figure></li><li><p><code>String.prototype.padStart()</code>: Pads the current string from the start with a given string to create a new string from a given length</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;Breaded Mushrooms&#x27;</span>.padStart(<span class="number">25</span>, <span class="string">&#x27;.&#x27;</span>) <span class="comment">// returns &quot;........Breaded Mushrooms&quot;</span></span><br></pre></td></tr></table></figure></li><li><p><code>String.prototype.repeat(times: number)</code>: Returns a string consisting of the elements of the object repeated the given times.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;hello world&#x27;</span>.repeat(<span class="number">3</span>) <span class="comment">// &quot;hello worldhello worldhello world&quot;</span></span><br></pre></td></tr></table></figure></li><li><p><code>String.prototype.replace(pattern: regexp | string, replacement): string</code>: Returns a new string with some or all matches of a <code>pattern</code> replaced by a <code>replacement</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;hello world&#x27;</span>.replace(<span class="regexp">/world/</span>, <span class="string">&#x27;hello&#x27;</span>) <span class="comment">// returns &#x27;hello hello&#x27;</span></span><br></pre></td></tr></table></figure></li><li><p><code>String.prototype.search(pattern: regexp): number</code>: Executes a search for a match between a regular expression and this string, returns the index of matched string.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;hello world&#x27;</span>.search(<span class="regexp">/ll/</span>) <span class="comment">// returns 2</span></span><br></pre></td></tr></table></figure></li><li><p><code>String.prototype.slice(start: number[, end: number]): string</code>: Returns a new string extracted from the original string from [start, end).</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;hello&#x27;</span>.slice(<span class="number">1</span>, <span class="number">2</span>) <span class="comment">// returns &#x27;e&#x27;</span></span><br></pre></td></tr></table></figure></li><li><p><code>String.prototype.split(pattern): string[]</code>: Splits a string into an array of strings by separating the string into substrings.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;hello world&#x27;</span>.split(<span class="string">&#x27; &#x27;</span>) <span class="comment">// [&#x27;hello&#x27;, &#x27;world&#x27;]</span></span><br></pre></td></tr></table></figure></li><li><p><code>String.prototype.startsWith()</code>: Determines whether a string begins with the characters of another string.</p></li><li><p><code>String.prototype.substring</code>: Returns the characters in a string between two indices into the string.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;hello world&#x27;</span>.substring(<span class="number">1</span>, <span class="number">2</span>) <span class="comment">// returns &#x27;e&#x27;</span></span><br></pre></td></tr></table></figure><p>It seems that the <code>String.prototype.substring</code> works like <code>String.prototype.slice</code>, but if the <code>start &gt; end</code>, <code>String.prototype.substring</code> swaps the two parameters while <code>String.prototype.slice</code> return ‘’.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;hello world&#x27;</span>.substring(<span class="number">2</span>, <span class="number">1</span>) <span class="comment">// returns &#x27;e&#x27;</span></span><br><span class="line"><span class="string">&#x27;hello world&#x27;</span>.slice(<span class="number">2</span>, <span class="number">1</span>) <span class="comment">// returns &#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>And <code>String.prototype.slice</code> accepts netagive indices as start from the end of the string, while <code>String.prototype.substring</code> treats negative and NaN as 0.</p><p>Note <code>String.prototype.substr</code> is deprecated</p></li><li><p><code>String.prototype.toLocaleLowerCase()</code>: The characters within a string are converted to lower case while respecting the current locale. For most languages, this will return the same as <code>toLowerCase()</code></p></li><li><p><code>String.prototype.toLocaleUpperCase()</code>: The characters within a string are converted to upper case while respecting the current locale. For most languages, this will return the same as <code>toUpperCase()</code></p></li><li><p><code>String.prototype.toLowerCase()</code>: Returns the calling string value converted to lower case.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;HELLO WORLD&#x27;</span>.toLowerCase() <span class="comment">// returns &#x27;hello world&#x27;</span></span><br></pre></td></tr></table></figure></li><li><p><code>String.prototype.toUpperCase()</code>: Returns the calling string value converted to upper case.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;hello world&#x27;</span>.toUpperCase() <span class="comment">// returns &#x27;HELLO WORLD&#x27;</span></span><br></pre></td></tr></table></figure></li><li><p><code>String.prototype.toString()</code>: Returns a string representing the specified object.</p></li><li><p><code>String.prototype.trim()</code>: Trims whitespaces from the beginning and end of a string</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;   hello world   &#x27;</span>.trim() <span class="comment">// returns &#x27;hello wrold&#x27;</span></span><br></pre></td></tr></table></figure></li><li><p><code>String.prototype.trimStart()</code>, <code>String.prototype.trimLeft()</code>: Trims whitespaces from the beginning of the string.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;   hello world   &#x27;</span>.trimStart() <span class="comment">// returns &#x27;hello world   &#x27;</span></span><br></pre></td></tr></table></figure></li><li><p><code>String.prototype.trimEnd()</code>, <code>String.prototype.trimRight()</code>: Trims whitespace from the end of the string.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;   hello world   &#x27;</span>.trimEnd() <span class="comment">// return &#x27;   hello world&#x27;</span></span><br></pre></td></tr></table></figure></li><li><p><code>String.prototype.valueOf</code>: Returns the primitive value of the specified object.</p></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Note on Bip 173</title>
      <link href="/2019/04/20/note-on-bip-173/"/>
      <url>/2019/04/20/note-on-bip-173/</url>
      
        <content type="html"><![CDATA[<p><a href="https://github.com/bitcoin/bips/blob/master/bip-0173.mediawiki">wiki</a></p><h1 id="Abstract"><a href="#Abstract" class="headerlink" title="Abstract"></a>Abstract</h1><p>BIP 173 proposed a checksummed base32 format, <strong>Bech32</strong> and a standard for native segregated witness output addresses using it to replace BIP 142. This format is not required for using segwit, but is more efficient, flexible and nicer to use.</p><h1 id="Bech32"><a href="#Bech32" class="headerlink" title="Bech32"></a>Bech32</h1><p>A Bech32 string is at most <strong>90</strong> characters long and consists of:</p><ul><li><p>The <strong>human-readable part(hrp)</strong>, which is intended to convey <strong>the type of data</strong>, or anything else that is relevant to the reader.</p></li><li><p>The <strong>separator</strong> which is always <strong>“1”</strong>. In case “1” is allowed inside the hrp, the last one in the string is the separator.</p></li><li><p>The <strong>data part</strong>, which is at least <strong>6</strong> characters long and only consists of alphanumeric characters excluding “1”, “b”, “i”, “o”.</p></li></ul><h2 id="Checksum"><a href="#Checksum" class="headerlink" title="Checksum"></a>Checksum</h2><p>The last six characters of the data part form a chechsum and contain no information.</p><h2 id="Segwit-address-format"><a href="#Segwit-address-format" class="headerlink" title="Segwit address format"></a>Segwit address format</h2><p>A segwit address is a Bech32 encoding of:</p><ul><li><p>The human-readable part “bc” for mainnet and the “tb” for testnet.</p></li><li><p>The data-part values:</p><ul><li><p>1 byte: the witness version</p></li><li><p>A convention of the 2-to-40-byte witness program to base32:</p><ul><li><p>Start with the bits of the witness program, most significant bit per btye first.</p></li><li><p>Re-arrange those bits into groups of 5, and pad with zeros at the end if needed.</p></li><li><p>Translate those bits to characters.</p></li></ul></li></ul></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Blockchain </tag>
            
            <tag> Bitcoin </tag>
            
            <tag> BIP </tag>
            
            <tag> RFC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[WIP]notes of Building Product, Talking to Users and Growing</title>
      <link href="/2019/04/17/notes-of-building-product-talking-to-users-and-growing/"/>
      <url>/2019/04/17/notes-of-building-product-talking-to-users-and-growing/</url>
      
        <content type="html"><![CDATA[<p><a href="https://genius.com/Adora-cheung-lecture-4-building-product-talking-to-users-and-growing-annotated">original notes</a></p><ol><li><p>You need a lot of feedback. Maybe you get a lot of people to your site, but no one sticks around because you didn’t get that initial user feedback.</p></li><li><p>When you have an idea, you should really think about what the idea is really solving. Like what is the actual problem. You should describe your problem in one sentence, and then you should think.</p></li><li><p>When you have a problem and are able to state it, you should think about</p></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Keystore</title>
      <link href="/2019/03/16/keystore/"/>
      <url>/2019/03/16/keystore/</url>
      
        <content type="html"><![CDATA[<p><a href="https://medium.com/@julien.maffre/what-is-an-ethereum-keystore-file-86c8c5917b97">Original</a></p><h1 id="What-is-a-keystore-file"><a href="#What-is-a-keystore-file" class="headerlink" title="What is a keystore file"></a>What is a keystore file</h1><p>A keystore file is en encrypted version of your unique private key that you will use to sign your transactions. If you lose this file your lose your assets.</p><h1 id="What-do-keystore-files-look-like"><a href="#What-do-keystore-files-look-like" class="headerlink" title="What do keystore files look like"></a>What do keystore files look like</h1><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;crypto&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;cipher&quot;</span>: <span class="string">&quot;aes-128-ctr&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;cipherparams&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;iv&quot;</span>: <span class="string">&quot;83dbcc02d8ccb40e466191a123791e0e&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;ciphertext&quot;</span>: <span class="string">&quot;d172bf743a674da9cdad04534d56926ef8358534d458fffccd4e6ad2fbde479c&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;kdf&quot;</span>: <span class="string">&quot;scrypt&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;kdfparams&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;dklen&quot;</span>: <span class="number">32</span>,</span><br><span class="line">      <span class="attr">&quot;n&quot;</span>: <span class="number">262144</span>,</span><br><span class="line">      <span class="attr">&quot;r&quot;</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="attr">&quot;p&quot;</span>: <span class="number">8</span>,</span><br><span class="line">      <span class="attr">&quot;salt&quot;</span>: <span class="string">&quot;ab0c7876052600dd703518d6fc3fe8984592145b591fc8fb5c6d43190334ba19&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;mac&quot;</span>: <span class="string">&quot;2103ac29920d71da29f15d75b4a16dbe95cfd7ff8faea1056c33131d846e3097&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;id&quot;</span>: <span class="string">&quot;3198bc9c-6672-5ab3-d995-4942343ae5b6&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="number">3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Thses fields mean:</p><ul><li><p>cipher: The name of a symmetric AES algorithm</p></li><li><p>cipherparams: The parameters required for the “cipher” algorithm above</p></li><li><p>ciphertext: The private key encrypted using the “cipher” algorithm above</p></li><li><p>kdf: A key derivation function used to let you encrypt your keystore file with a password</p></li><li><p>kdfparams: The parameters required for the “kdf” algorithm above</p></li><li><p>mac: A code used to verify your password</p></li></ul><h1 id="Work-flow"><a href="#Work-flow" class="headerlink" title="Work flow"></a>Work flow</h1><ol><li>Encrypting your private key</li></ol><p>These symmetric algorithms use a key to encrypt some data. The resulting data is encrypted and can be decrypted with the same method and the same key.</p><p>The relation between cipher, cipherparams, ciphertext:</p><ul><li><p>cipher is the symmetric algorithm used to encrypt the private key.</p></li><li><p>cipherparams are the parameters required for teh symmetric algorithm.</p></li><li><p>ciphertext is the encrypted input of the symmetric input.</p></li></ul><p>You get the decryption-key as the output of the kdf.</p><p><img src="https://cdn-images-1.medium.com/max/800/1*nNI586I7fXesxYNls1pm2A.png"></p><p>By this, you need to retrieve your decryption-key(namely the key used in encryption) to decrypt your private key.</p><p><img src="https://cdn-images-1.medium.com/max/800/1*3a9LeWT9B9CSu7a3x8GdKw.png"></p><ol start="2"><li>Protect with your passphrase</li></ol><p>To make sure unlocking your account is easy, you don’t need to remember your very long and non-user-friendly decrption-key that is used to decrypt ciphertext. Instead, the developers have opted for a passphrase-based protection.</p><p>The keystore use a kdf(key derivation function) that computes the decryption-key given a passphrase and a list of parameters.</p><ul><li><p>kdf is the key derivation function used to compute the decryption-key from your passphrase.</p></li><li><p>kdfparams are the parameters required for the function</p></li></ul><p>By the passphrase with kdfparams, the kdf returns your decrption-key.</p><p><img src="https://cdn-images-1.medium.com/max/800/1*nNI586I7fXesxYNls1pm2A.png"></p><ol start="3"><li>Make sure your passphrase is right</li></ol><p>We need to guarantee that the passphrase typed to unlock the account is right, that it is the same one as the one entered when the keystore is generated.</p><p>This is where the field mac in the keystore works. Just after the kdf is executed, its result(decryption-key) and ciphertext are processed and compared to mac. If the result is the same as mac, then the passphrase was right and the decrption-key is correct.</p><p><img src="https://cdn-images-1.medium.com/max/800/1*YaBR2RaF0-RulLc-pUmdyQ.png"></p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p><img src="https://cdn-images-1.medium.com/max/1200/1*jHfiOdfCKhyCq5V39vty-A.png"></p>]]></content>
      
      
      
        <tags>
            
            <tag> Blockchain </tag>
            
            <tag> Wallet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Note on Bip 32</title>
      <link href="/2019/03/05/note-on-bip32/"/>
      <url>/2019/03/05/note-on-bip32/</url>
      
        <content type="html"><![CDATA[<p><a href="https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki">wiki</a></p><p>The specification consists of two parts:</p><ol><li><p>a system for deriving a tree of keypairs from a single seed.</p></li><li><p>demostrate how to build a wallet structure on top of such a tree.</p></li></ol><h1 id="Specification-Key-derivation"><a href="#Specification-Key-derivation" class="headerlink" title="Specification: Key derivation"></a>Specification: Key derivation</h1><h2 id="Convention"><a href="#Convention" class="headerlink" title="Convention"></a>Convention</h2><p>In this text we assume the public key cryptography used in Bitcoin, namely elliptic curve cryttography using the field and curve parameters defined by secp256k1. Variables below are either:</p><ul><li><p>Integers modulo the order of the curve (referred to as n)</p></li><li><p>Coordinates of points on the curve</p></li><li><p>Byte sequences</p></li></ul><p>Addition (+) of two coordinate pair is defined as application of the EC group operation. Concatenation(||) is the operation of appending one byte sequence onto another.</p><h2 id="Extended-Keys"><a href="#Extended-Keys" class="headerlink" title="Extended Keys"></a>Extended Keys</h2><p>We are going to define a function to derive a number of child keys from a parent key. In order to prevent these from depending solely on the key itself, we extend both private key and public key first with an extra 256 bits of entropy. This extention, called the <strong>chain code</strong>, is identical for corresponding private key and public keys, and consist of 256 bits, namely 32 bytes.</p><p>We represent an extended private key as <code>(k, c)</code>, with <code>k</code> the normal private key and the c, the <code>chain code</code>. And extended public key is represented as <code>(K, c)</code>, with <code>K = point(k)</code> and the c the chain code.</p><p>Each extended key has 2^31 <strong>normal child keys</strong>, and 2^31 <strong>hardened child keys</strong>. Each of these child keys has an index. The normal child keys use indices <code>0</code> through <code>2^31 - 1</code>.</p><p>The hardened child keys use indices <code>2^31 - 1</code> through <code>2^32 - 1</code>.</p><p>To ease notation for hardened key indices, a number i_H represents i + 2 ^ 31.</p><h2 id="Child-key-derivation-CKB-function"><a href="#Child-key-derivation-CKB-function" class="headerlink" title="Child key derivation (CKB) function"></a>Child key derivation (CKB) function</h2><p>Given a parent extended key and an index i, it is possible to compute the corresponding child extended key. The algorithm to do so depends on whether the child is a hardened key or not.</p><h3 id="Private-parent-key-gt-private-child-key"><a href="#Private-parent-key-gt-private-child-key" class="headerlink" title="Private parent key =&gt; private child key"></a>Private parent key =&gt; private child key</h3><p>The function CKDpriv((k_par, c_par), i) =&gt; (k_i, c_i) computes a child extended private key from the parent extended private key.</p><ul><li>Check whether i &gt;= 2^31(whether the child is a hardened key)<ul><li>if so (hardened child): return failure</li><li>if not (normal child), let I = HMAC-SHA512(Key = c_par, Data = ser_P(K_par)||ser_32(i))</li></ul></li><li>Split I into two 32-byte sequences, I_L, and I_R.</li><li>The returned child key k_i is parse_256(I_L) + k_par(mod n)</li><li>The returned chain code c_i is I_R</li></ul><h3 id="Private-parent-key-gt-public-child-key"><a href="#Private-parent-key-gt-public-child-key" class="headerlink" title="Private parent key =&gt; public child key"></a>Private parent key =&gt; public child key</h3><h3 id="Public-parent-key-gt-private-child-key"><a href="#Public-parent-key-gt-private-child-key" class="headerlink" title="Public parent key =&gt; private child key"></a>Public parent key =&gt; private child key</h3><p>This is not possible.</p><h2 id="The-key-tree"><a href="#The-key-tree" class="headerlink" title="The key tree"></a>The key tree</h2><p>The next step is cascading serveral CKD construction to build a tree. We start with one root, the master extended key m. By evaluating CKBpriv(m, i) for several values of i, we get a number of level-1 derived nodes. As each of these is again an extended key, CKDpriv can be applied to those as well.</p><p>To shorten notation, we will write <code>CKDpriv(CKDpriv(CKDpriv(m, 3_H), 2), 5)</code> as <code>m/3_H/2/5</code>. Equivalently for public keys, we write <code>CKDpub(CKDpub(CKDpub(M, 3), 2), 5)</code> as <code>M/3/2/5</code>. This results in the following identities:</p><ul><li>N(m/a/b/c) = N(m/a/b)/c = N(m/a)/b/b = N(m)/a/b/c = M/a/b/c</li><li>N(m/a_H/b/c) = N(m/a_H/b)/c = N(m/a_H)/b/c</li></ul><p>However, N(m/a_H) cannot be rewritten as N(m)/a_H, as the latter is not possible.</p><h2 id="Key-identifiers"><a href="#Key-identifiers" class="headerlink" title="Key identifiers"></a>Key identifiers</h2><p>Extended keys can be identified by the Hash160(RIPED160 after SHA256) of the serialized ECDSA public key K, ignoring the chain code. This corresponds exactly to the data used in traditional Bitcoin addresses. It is not advised to represent this data in base58 format though, as it may be interpreted as an address that way.</p><p>The first 32 bits of the identifier are called <code>key finterprint</code>.</p><h2 id="Serialization-format"><a href="#Serialization-format" class="headerlink" title="Serialization format"></a>Serialization format</h2><p>Extended public and private keys are serialized as follows:</p><ul><li>4 bytes: version bytes (mainnet: 0x0488B21E public, 0x0488ADE4 private; testnet: 0x043587CF public, 0x04358394 private)</li><li>1 byte: depth: 0x00 for master nodes, 0x01 for level-1 derived keys.</li><li>4 bytes: the fingerprint of the parent’s key (0x00000000 if master key)</li><li>4 bytes: child number, 0x00000000 if master key</li><li>32 bytes: the chain code</li><li>33 bytes: the public key or private key data</li></ul><p>The 78 bytes structure can be encoded like other Bitcoin data in Base58, by first adding 32 checksum bits(derived from the double SHA256 checksum), and then conventing to the Base58 representation.</p><h1 id="Master-key-generation"><a href="#Master-key-generation" class="headerlink" title="Master key generation"></a>Master key generation</h1><p>The total number of possible extended keypairs is almost 2^512, but the produced keys are only 256 bits long, and offer about half of that in terms of security. Therefore the master keys are not generated directly, but instead from a potentially short seed value.</p><ul><li>Generate a seed byte sequence S of a chosen length(between 128 and 512 bits, 256 bits is advised) from a (P)RNG.</li><li>Calculate I = HMAC-SHA512(Key = “Bitcoin seed”, Data = S)</li><li>Split I into two 32-byte sequence, I_L and I_R</li><li>Use parse_256(I_L) as master secret key and I_R as master chain code.</li></ul><p>In case I_L is 0 or &gt;= n, the master key is invalid.</p><p><img src="https://github.com/bitcoin/bips/raw/master/bip-0032/derivation.png"></p><h1 id="Specification-Wallet-Structure"><a href="#Specification-Wallet-Structure" class="headerlink" title="Specification: Wallet Structure"></a>Specification: Wallet Structure</h1><h2 id="The-default-wallet-layout"><a href="#The-default-wallet-layout" class="headerlink" title="The default wallet layout"></a>The default wallet layout</h2><p>An HD Wallet is organized as several ‘accounts’. Accounts are numbered, the default account (“”) being numbered 0. Clients are not required to support more than one account, if not, they only use the default account.</p><p>Each account is composed of two keypair chains: an internal and an external one. The external keychain is used to generate new public addresses, while the internal one is used for all other operations(change addresses, generate addresses, anything that doesn’t need to be communicated).</p>]]></content>
      
      
      
        <tags>
            
            <tag> Blockchain </tag>
            
            <tag> Bitcoin </tag>
            
            <tag> BIP </tag>
            
            <tag> RFC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>React Hooks</title>
      <link href="/2018/11/20/React-Hooks/"/>
      <url>/2018/11/20/React-Hooks/</url>
      
        <content type="html"><![CDATA[<h1 id="Basic-Hooks"><a href="#Basic-Hooks" class="headerlink" title="Basic Hooks"></a>Basic Hooks</h1><h2 id="useState"><a href="#useState" class="headerlink" title="useState"></a><code>useState</code></h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [state, setState] = useState(initialState)</span><br></pre></td></tr></table></figure><p>Returns a stateful value and a function to update it.</p><p>During subsequent re-renders, the first value returned by <code>useState</code> will always be the most recent state after applying updates.</p><h3 id="Functional-updates"><a href="#Functional-updates" class="headerlink" title="Functional updates"></a>Functional updates</h3><p>If the new state is computed using the previous state, you can pass a function to <code>setState</code>. The function will receive the previous value and return an updated value.</p><blockquote><p>Note: Unlike the <code>setState</code> method found in class component, <code>useState</code> does not automatically merge upate objects.</p></blockquote><blockquote><p><code>useReducer</code> is more suited for managing state objects that contains multiple sub-values.</p></blockquote><h3 id="Lazy-initialization"><a href="#Lazy-initialization" class="headerlink" title="Lazy initialization"></a>Lazy initialization</h3><p>The <code>initialState</code> argument is the state used during the initial render. <strong>In subsequent renders, it is disregarded. If the initial state is the result of an expensive computation, you may provide a function instead, which will be executed only on the initial render.</strong></p><h2 id="useEffect"><a href="#useEffect" class="headerlink" title="useEffect"></a><code>useEffect</code></h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useEffect(didUpdate)</span><br></pre></td></tr></table></figure><p>Accept a function that contains imperative, possibly effectful code.</p><p>Mutations, subscriptions, timers, logging and other side effects are not allowed inside the main body of a function component. Instead, use <code>useEffect</code>. The functino passed to <code>useEffect</code> will run after the render is committed to the screen.</p><p>By default, effects run after every completed render, but you can choose to fire it only when certain values have changed.</p><h3 id="Cleaning-up-an-effect"><a href="#Cleaning-up-an-effect" class="headerlink" title="Cleaning up an effect"></a>Cleaning up an effect</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> subscription = props.source.subscribe()</span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// Clean up the subscription</span></span><br><span class="line">    subscription.unsubscribe()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Timing-of-effects"><a href="#Timing-of-effects" class="headerlink" title="Timing of effects"></a>Timing of effects</h3><p>Unlike <code>componentDidMount</code> and <code>componentDidUpdate</code>, the function passed to <code>useEffect</code> fires after layout and paint, during a deferred event. This makes it suitable for the many common side effects, like setting up subscriptions and event handlers, because most types fo work shouldn’t block the browser from updating the screen.</p><p><code>useMutationEffect</code> and <code>useLayoutEffect</code> have the same signature as <code>useEffect</code> and only differ in when they are fired.</p><p>Although <code>useEffect</code> is deferred until after the browser has painted, it’s guaranteed to fire before any new renders.</p><h3 id="Conditionally-firing-an-effect"><a href="#Conditionally-firing-an-effect" class="headerlink" title="Conditionally firing an effect"></a>Conditionally firing an effect</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">useEffect(</span><br><span class="line">  () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> subscription = props.source.subscribe()</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> subscription.unsubscribe()</span><br><span class="line">  &#125;,</span><br><span class="line">  [props.source],</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="useContext"><a href="#useContext" class="headerlink" title="useContext"></a><code>useContext</code></h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> context = useContext(Context)</span><br></pre></td></tr></table></figure><p>Accepts a context object(the value returned from <code>React.createContext</code>) and returns the current context value, as given by the nearest context provider for the given context.</p><p>When the provider updates, this hook will trigger a rerender with the latest context value.</p><h1 id="Additional-Hooks"><a href="#Additional-Hooks" class="headerlink" title="Additional Hooks"></a>Additional Hooks</h1><h2 id="useReducer"><a href="#useReducer" class="headerlink" title="useReducer"></a><code>useReducer</code></h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [state, dispatch] = useReducer(reducer, initialState)</span><br></pre></td></tr></table></figure><p>An alternative to <code>useState</code>. Accepts a reducer of type <code>(state, action) =&gt; newState</code>, and returns the current state paired with a <code>dispatch</code> method.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> initialState = &#123; <span class="attr">count</span>: <span class="number">0</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reducer</span>(<span class="params">state, action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;reset&#x27;</span>: &#123;</span><br><span class="line">      <span class="keyword">return</span> initialState</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;increment&#x27;</span>: &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">count</span>: state.count + <span class="number">1</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;decrement&#x27;</span>: &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">count</span>: state.count - <span class="number">1</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Counter</span>(<span class="params">&#123; initialCount &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [state, dispatch] = useReducer(reducer, &#123; <span class="attr">count</span>: initialCount &#125;)</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      Count: &#123;state.count&#125;</span><br><span class="line">      &lt;button onClick=&#123;<span class="function">() =&gt;</span> dispatch(&#123; <span class="attr">type</span>: <span class="string">&#x27;reset&#x27;</span> &#125;)&#125;&gt;Reset&lt;/button&gt;</span><br><span class="line">    &lt;/&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Lazy-initialization-1"><a href="#Lazy-initialization-1" class="headerlink" title="Lazy initialization"></a>Lazy initialization</h3><p><code>useReducer</code> accepts an optional third argument, <code>initialAction</code>. If provided, the initial action is applied during the initial render. This is useful for computing an initial state that includes values passed via props.</p><h2 id="useCallback"><a href="#useCallback" class="headerlink" title="useCallback"></a><code>useCallback</code></h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> memoizedCallback = useCallback(</span><br><span class="line">  () =&gt; &#123;</span><br><span class="line">    doSomething(a, b)</span><br><span class="line">  &#125;,</span><br><span class="line">  [a, b],</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>Returns <code>memoized</code> callback.</p><p>Pass an inline callback and an array of inputs, <code>useCallback</code> will return a memoized version of the callback that only changes if one of the inputs has changed. This is useful when passing callbacks to optimized child components that rely on reference equality to prevent unnecessary render.</p><blockquote><p>Note: The array of inputs is not passed as arguments to the callback. Conceptually, though, that’s what represent: every value referenced inside the callback should also appear in the inputs array.</p></blockquote><h2 id="useMemo"><a href="#useMemo" class="headerlink" title="useMemo"></a><code>useMemo</code></h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> memoizedValue = useMemo(<span class="function">() =&gt;</span> computeExpensiveValue(a, b), [a, b])</span><br></pre></td></tr></table></figure><p>Returns a <code>memoized</code> value.</p><p>Pass a “create” function and an array of inputs, <code>useMemo</code> will only recompute the memoized value when one of the inputs has changed. This optimization helps to avoid expensive calculations on every render.</p><p>If no array is provided, a new value will be computed whenever a new function instance is passed as the first argument.(With an inline function, on every render)</p><h2 id="useRef"><a href="#useRef" class="headerlink" title="useRef"></a><code>useRef</code></h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> refContainer = useRef(initialValue)</span><br></pre></td></tr></table></figure><p><code>useRef</code> returns a mutable ref object whose <code>.current</code> property is initialized to the passed argument(<code>initialValue</code>). The returned object will persist for the full lifetime of the component.</p><p>A common use case is to access a child imperatively:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">TextInputFocusButton</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> inputEl = useRef(<span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">const</span> onButtonClick = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    inputEl.current.focus()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;input ref=&#123;inputEl&#125; type=<span class="string">&quot;text&quot;</span> /&gt;</span><br><span class="line">      &lt;button onClick=&#123;onButtonClick&#125;&gt;Focus the input&lt;/button&gt;</span><br><span class="line">    &lt;/&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="useImperativeMethods"><a href="#useImperativeMethods" class="headerlink" title="useImperativeMethods"></a><code>useImperativeMethods</code></h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useImperativeMethods(ref, createInstance, [inputs])</span><br></pre></td></tr></table></figure><p><code>useImperativeMethods</code> customizes the instance value that is exposed to parent component when use <code>ref</code>. As always, imperative code using refs should be avoided in most cases. <code>useImperativeMethods</code> should be used with <code>forwardRef</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FancyInput</span>(<span class="params">props, ref</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> inputRef = useRef()</span><br><span class="line">  useImperativeMethods(ref, <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    focus: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      inputRef.current.focus()</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;))</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;inputRef&#125;</span> /&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line">FancyInput = forwardRef(FancyInput)</span><br></pre></td></tr></table></figure><p>In this example, a parent component that renders <code>&lt;FancyInput ref=&#123;fancyInputRef&#125; /&gt;</code> would be able to call <code>fancyInputRef.current.focus()</code>.</p><h2 id="useMutationEffect"><a href="#useMutationEffect" class="headerlink" title="useMutationEffect"></a><code>useMutationEffect</code></h2><p>The signature is identical to <code>useEffect</code>, but it fires synchronously during the same phase that React performs its DOM mutations, before sibling components has been updated.</p><p>Prefer the standard <code>useEffect</code> when possible to avoid blocking visual updates.</p><blockquote><p>Note: Avoid reading from the DOM in <code>useMutationEffect</code>. If you do, you can cause performance problems by introducing <code>layout trash</code>.</p></blockquote><h2 id="useLayoutEffect"><a href="#useLayoutEffect" class="headerlink" title="useLayoutEffect"></a><code>useLayoutEffect</code></h2><p>The signature is identical to <code>useEffect</code> but it fires synchronously <strong>after</strong> all DOM mutations.</p><p>Use this to read layout from the DOM and synchronously re-render. Updates scheduled inside <code>useLayoutEffect</code> will be flushed synchronously, before the browser has a chance to paint.</p><blockquote><p>Fires in the same phase as <code>componentDidMount</code> and <code>componentDidUpdate</code></p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> React </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>5 Tips in CRA@2.0</title>
      <link href="/2018/11/11/5-tips-in-CRA-2-0/"/>
      <url>/2018/11/11/5-tips-in-CRA-2-0/</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.telerik.com/blogs/5-things-i-didnt-know-about-create-react-app">Original</a></p><p>It’s fucking long time not learning React.</p><p>Five Tips</p><ol><li>Displaying Lint Error in the Editor</li></ol><p>Create <code>.eslintrc</code> with content of</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;extends: &quot;react-app&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>Formatting Code Automatically</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev prettier husky lint-staged</span><br></pre></td></tr></table></figure><p>And add scripts in <code>package.json</code></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;husky&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;hooks&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;pre-commit&quot;</span>: <span class="string">&quot;lint-staged&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;lint-staged&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;src/**/*.&#123;js,jsx,json,css&#125;&quot;</span>: [<span class="string">&quot;prettier --write&quot;</span>, <span class="string">&quot;git add&quot;</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>I prefer to use <code>prettier</code> with <code>eslint</code></p><ol start="3"><li>Developing Components in Isolation</li></ol><p>…</p><p>I use <code>bit</code></p><ol start="4"><li>Making a Progressive Web App</li></ol><p>In <code>src/index.js</code>, change <code>serviceWorker.unregister()</code> to <code>serviceWorker.register()</code></p><ol start="5"><li>Code Splitting</li></ol><p>Create React App v2 supports code splitting via dynamic <code>import()</code> statements. That is, if it encouters a call to <code>import(&#39;./someModule&#39;)</code> when building your app, it will create a new chunk for someModule and all its dependencies, totally seperate from your entry bundle.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Formik &#125; <span class="keyword">from</span> <span class="string">&#x27;formik&#x27;</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> Yup <span class="keyword">from</span> <span class="string">&#x27;yup&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> formValidator = Yup.object().shape(<span class="comment">/* ... */</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Form</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Formik</span> <span class="attr">validationSchema</span>=<span class="string">&#123;formValidator&#125;</span>&gt;</span>&#123;/* ... */&#125;<span class="tag">&lt;/<span class="name">Formik</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    Form: <span class="literal">undefined</span>,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  showForm = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">default</span>: Form &#125; = <span class="keyword">await</span> <span class="keyword">import</span>(<span class="string">&#x27;./Form&#x27;</span>)</span><br><span class="line">    <span class="built_in">this</span>.setState(&#123; Form &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; Form &#125; = <span class="built_in">this</span>.state</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;app&quot;</span>&gt;</span>&#123;Form ? <span class="tag">&lt;<span class="name">Form</span> /&gt;</span> : <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.showForm&#125;</span>&gt;</span>Show Form<span class="tag">&lt;/<span class="name">button</span>&gt;</span>&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> React </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Analysis of Ujo</title>
      <link href="/2018/09/10/Analysis-of-Ujo/"/>
      <url>/2018/09/10/Analysis-of-Ujo/</url>
      
        <content type="html"><![CDATA[<h1 id="What-is-Ujo"><a href="#What-is-Ujo" class="headerlink" title="What is Ujo"></a>What is Ujo</h1><p>The Ujo platform uses blockchain technology to create a transparent and decentralized database of rights and rights owners, automating royalty payments using smart contracts and cryptocurrency.</p><p>Ujo Music is a ConsenSys spoke, with a vision for a music industry that allows creators to grow and thrive independently. It is a platform that uses the ethereum blockchain as the substrate for innovation by empowering artists, digitizing their music rights and metadata, sharing this information in an open environment, thus enabling new applications, products and services to license their catelogs and pay artists directly with minimal friction.</p><h1 id="History"><a href="#History" class="headerlink" title="History"></a>History</h1><p>2015.10, <strong>IMOGEN HEAP</strong>: In 2015 Imogen Heap collaborated with Ujo to demonstrate how Ethereum could usher in a modern music supply chain built on a backbone of prompt and transparent payments</p><h1 id="Why-use-Ujo"><a href="#Why-use-Ujo" class="headerlink" title="Why use Ujo"></a>Why use Ujo</h1><h1 id="How-does-Ujo-work"><a href="#How-does-Ujo-work" class="headerlink" title="How does Ujo work"></a>How does Ujo work</h1><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul><li>[1] (Ujo FAQ)[<a href="https://ujomusic.com/faq]">https://ujomusic.com/faq]</a></li><li>[2] (Imogen Heap)[<a href="https://imogen2.surge.sh/#/imogen_heap/tiny_human/tiny_human]">https://imogen2.surge.sh/#/imogen_heap/tiny_human/tiny_human]</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Ethereum </tag>
            
            <tag> Blockchain </tag>
            
            <tag> Product </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Development of Neuron Web Extension</title>
      <link href="/2018/08/27/development-of-neuron-web-extension/"/>
      <url>/2018/08/27/development-of-neuron-web-extension/</url>
      
        <content type="html"><![CDATA[<h1 id="Create-Project"><a href="#Create-Project" class="headerlink" title="Create Project"></a>Create Project</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create-react-app neuron-web scripts-version=react-scripts-ts</span><br></pre></td></tr></table></figure><h1 id="Add-Manifest"><a href="#Add-Manifest" class="headerlink" title="Add Manifest"></a>Add Manifest</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; .&#x2F;public&#x2F;manifest.json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;short_name&quot;: &quot;NeuronWeb&quot;,</span><br><span class="line">  &quot;name&quot;: &quot;Neuron Web&quot;,</span><br><span class="line">  &quot;start_url&quot;: &quot;.&#x2F;index.html&quot;,</span><br><span class="line">  &quot;display&quot;: &quot;standalone&quot;,</span><br><span class="line">  &quot;theme_color&quot;: &quot;#000&quot;,</span><br><span class="line">  &quot;background_color&quot;: &quot;#fff&quot;,</span><br><span class="line">  &quot;browser_action&quot;: &#123;</span><br><span class="line">    &quot;default_popup&quot;: &quot;.&#x2F;index.html&quot;,</span><br><span class="line">    &quot;default_title&quot;: &quot;NervosWeb&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;manifest_version&quot;: 2,</span><br><span class="line">  &quot;version&quot;: &quot;1.0&quot;,</span><br><span class="line">  &quot;permissions&quot;: [</span><br><span class="line">    &quot;tabs&quot;,</span><br><span class="line">    &quot;activeTab&quot;,</span><br><span class="line">    &quot;clipboardWrite&quot;,</span><br><span class="line">    &quot;http:&#x2F;&#x2F;**&#x2F;*&quot;,</span><br><span class="line">    &quot;https:&#x2F;&#x2F;**&#x2F;*&quot;</span><br><span class="line">  ],</span><br><span class="line">  &quot;content_security_policy&quot;: &quot;script-src &#39;self&#39; &#39;unsafe-eval&#39;; object-src &#39;self&#39;&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Add-Style-Dependencies"><a href="#Add-Style-Dependencies" class="headerlink" title="Add Style Dependencies"></a>Add Style Dependencies</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://fonts.googleapis.com/css?family=Roboto:300,400,500&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add @mateiral-ui/&#123;core,icons&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Chrome </tag>
            
            <tag> Extension </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Details in Web3 -- Contract</title>
      <link href="/2018/07/21/Details-in-Web3-Contract/"/>
      <url>/2018/07/21/Details-in-Web3-Contract/</url>
      
        <content type="html"><![CDATA[<h1 id="Basic-Usage"><a href="#Basic-Usage" class="headerlink" title="Basic Usage"></a>Basic Usage</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// To initialize a contract</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Contract = <span class="built_in">require</span>(<span class="string">&#x27;web3-eth-contract&#x27;</span>)</span><br><span class="line">Contract.setProvider(<span class="string">&#x27;ws://localhost:8546&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> contract = <span class="keyword">new</span> Contract(abi, address, options)</span><br></pre></td></tr></table></figure><h1 id="Import"><a href="#Import" class="headerlink" title="Import"></a>Import</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _ = <span class="built_in">require</span>(<span class="string">&#x27;underscore&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> core = <span class="built_in">require</span>(<span class="string">&#x27;web3-core&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> Method = <span class="built_in">require</span>(<span class="string">&#x27;web3-core-method&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> utils = <span class="built_in">require</span>(<span class="string">&#x27;web3-utils&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> Subscription = <span class="built_in">require</span>(<span class="string">&#x27;web3-core-subscription&#x27;</span>).subscription</span><br><span class="line"><span class="keyword">var</span> formatters = <span class="built_in">require</span>(<span class="string">&#x27;web3-core-helpers&#x27;</span>).formatters</span><br><span class="line"><span class="keyword">var</span> errors = <span class="built_in">require</span>(<span class="string">&#x27;web3-core-helpers&#x27;</span>).errors</span><br><span class="line"><span class="keyword">var</span> promiEvent = <span class="built_in">require</span>(<span class="string">&#x27;web3-core-promievent&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> abi = <span class="built_in">require</span>(<span class="string">&#x27;web3-eth-abi&#x27;</span>)</span><br></pre></td></tr></table></figure><h1 id="Contract-Constructor"><a href="#Contract-Constructor" class="headerlink" title="Contract Constructor"></a>Contract Constructor</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Should be called to create new contract instance</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @method Contract</span></span><br><span class="line"><span class="comment"> * @constructor</span></span><br><span class="line"><span class="comment"> * @param &#123;Array&#125; jsonInterface</span></span><br><span class="line"><span class="comment"> * @param &#123;String&#125; address</span></span><br><span class="line"><span class="comment"> * @param &#123;Object&#125; options</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Contract = <span class="function"><span class="keyword">function</span> <span class="title">Contract</span>(<span class="params">jsonInterface, address, options</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> _this = <span class="built_in">this</span></span><br><span class="line">  <span class="keyword">var</span> args = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// check if the instance is initialized correctly</span></span><br><span class="line">  <span class="keyword">if</span> (!(<span class="built_in">this</span> <span class="keyword">instanceof</span> Contract)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(</span><br><span class="line">      <span class="string">&#x27;Please use the &quot;new&quot; keyword to instantiate a web3.eth.contract() object!&#x27;</span>,</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// sets _requestManager</span></span><br><span class="line">  core.packageInit(<span class="built_in">this</span>, [<span class="built_in">this</span>.constructor.currentProvider])</span><br><span class="line"></span><br><span class="line">  <span class="comment">// set clearSubscriptions</span></span><br><span class="line">  <span class="built_in">this</span>.clearSubscriptions = <span class="built_in">this</span>._requestManager.clearSubscriptions</span><br><span class="line">  <span class="comment">// check params jsonInterface</span></span><br><span class="line">  <span class="keyword">if</span> (!jsonInterface || !<span class="built_in">Array</span>.isArray(jsonInterface)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(</span><br><span class="line">      <span class="string">&#x27;You must provide the json interface of the contract when instantiating a contract object&#x27;</span>,</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// clear the options object</span></span><br><span class="line">  <span class="built_in">this</span>.options = &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> lastArg = args[args.length - <span class="number">1</span>]</span><br><span class="line">  <span class="comment">// set options</span></span><br><span class="line">  <span class="keyword">if</span> (_.isObject(lastArg) &amp;&amp; !_.isArray(lastArray)) &#123;</span><br><span class="line">    options = lastArgs</span><br><span class="line">    <span class="built_in">this</span>.options = _.extend(<span class="built_in">this</span>.options, <span class="built_in">this</span>._getOrSetDefaultOptions(options))</span><br><span class="line">    <span class="comment">// clear address if the fact is options, in this case the address is not passed in.</span></span><br><span class="line">    <span class="keyword">if</span> (_.isObject(address)) &#123;</span><br><span class="line">      address = <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// set address</span></span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(<span class="built_in">this</span>.options, <span class="string">&#x27;address&#x27;</span>, &#123;</span><br><span class="line">    set: <span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (value) &#123;</span><br><span class="line">        _this._address = utils.toChecksumAddress(</span><br><span class="line">          formatters.inputAddressFormatter(<span class="string">&#x27;value&#x27;</span>),</span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    get: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> _this._address</span><br><span class="line">    &#125;,</span><br><span class="line">    enumerable: <span class="literal">true</span>,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// add method and event signature when the jsonInterface gets set</span></span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(<span class="built_in">this</span>.options, <span class="string">&#x27;jsonInterface&#x27;</span>, &#123;</span><br><span class="line">    set: <span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">      _this.methods = &#123;&#125;</span><br><span class="line">      _this.events = &#123;&#125;</span><br><span class="line"></span><br><span class="line">      _this._jsonInterface = value.map(<span class="function"><span class="params">method</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> func, funcName</span><br><span class="line">        <span class="keyword">if</span> (method.name) &#123;</span><br><span class="line">          funcName = utils._jsonInterfaceMethodToString(method)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (method.type === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">          method.signature = abi.encodeFunctionSignature(funcName)</span><br><span class="line">          func = _this._createTxObject.bind(&#123;</span><br><span class="line">            method: method,</span><br><span class="line">            parent: _this,</span><br><span class="line">          &#125;)</span><br><span class="line"></span><br><span class="line">          <span class="comment">// add method only if not one already exists</span></span><br><span class="line">          <span class="keyword">if</span> (!_this.methods[method.name]) &#123;</span><br><span class="line">            _this.methods[method.name] = func</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> cascadeFunc = _this._createTxObject.bind(&#123;</span><br><span class="line">              method: method,</span><br><span class="line">              parent: _this,</span><br><span class="line">              nextMethod: _this.methods[method.name],</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="built_in">this</span>.methods[method.name] = cascadeFunc</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="comment">// definitely add the method based on its signature</span></span><br><span class="line">          _this.methods[method.signature] = func</span><br><span class="line">          <span class="comment">//add method by name</span></span><br><span class="line">          _this.methods[method.name] = func</span><br><span class="line">          <span class="comment">// event</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.type === <span class="string">&#x27;event&#x27;</span>) &#123;</span><br><span class="line">          method.signature = abi.encodeEventSignature(funcName)</span><br><span class="line">          <span class="keyword">var</span> event = _this._on.bind(_this, method.signature)</span><br><span class="line"></span><br><span class="line">          <span class="comment">// add method only if not already exists</span></span><br><span class="line">          <span class="keyword">if</span> (</span><br><span class="line">            !_this.events[method.name] ||</span><br><span class="line">            _this.events[method.name].name === <span class="string">&#x27;bound&#x27;</span></span><br><span class="line">          ) &#123;</span><br><span class="line">            _this.events[method.name] = event</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// definitely add the method based on its signature</span></span><br><span class="line">          _this.events[method.signature] = event</span><br><span class="line"></span><br><span class="line">          <span class="comment">// add event by name</span></span><br><span class="line">          _this.events[funcName] = event</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> method</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// add allEvents</span></span><br><span class="line">      _this.events.allEvents = _this._on.bind(_this, <span class="string">&#x27;allevents&#x27;</span>)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> _this._jsonInterface</span><br><span class="line">    &#125;,</span><br><span class="line">    get: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> _this._jsonInterface</span><br><span class="line">    &#125;,</span><br><span class="line">    enumerable: <span class="literal">true</span>,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// get default account from the Class</span></span><br><span class="line">  <span class="keyword">var</span> defaultAccount = <span class="built_in">this</span>.constructor.defaultAccount</span><br><span class="line">  <span class="keyword">var</span> defaultBlock = <span class="built_in">this</span>.constructor.defaultBlock || <span class="string">&#x27;latest&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(<span class="built_in">this</span>, <span class="string">&#x27;defaultAccount&#x27;</span>, &#123;</span><br><span class="line">    get: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> defaultAddress</span><br><span class="line">    &#125;,</span><br><span class="line">    set: <span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (value) &#123;</span><br><span class="line">        defaultAccount = utils.toChecksumAddress(</span><br><span class="line">          formatters.inputAddressFormatter(value),</span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> value</span><br><span class="line">    &#125;,</span><br><span class="line">    enumerable: <span class="literal">true</span>,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(<span class="built_in">this</span>, <span class="string">&#x27;defaultBlock&#x27;</span>, &#123;</span><br><span class="line">    get: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> defaultBlock</span><br><span class="line">    &#125;,</span><br><span class="line">    set: <span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">      defaultBlock = value</span><br><span class="line">      <span class="keyword">return</span> value</span><br><span class="line">    &#125;,</span><br><span class="line">    enumerable: <span class="literal">true</span>,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// properties</span></span><br><span class="line">  <span class="built_in">this</span>.methods = &#123;&#125;</span><br><span class="line">  <span class="built_in">this</span>.events = &#123;&#125;</span><br><span class="line">  <span class="built_in">this</span>._address = <span class="literal">null</span></span><br><span class="line">  <span class="built_in">this</span>._jsonInterface = []</span><br><span class="line"></span><br><span class="line">  <span class="comment">// set getter/setter properties</span></span><br><span class="line">  <span class="built_in">this</span>.options.address = address</span><br><span class="line">  <span class="built_in">this</span>.options.jsonInterface = jsonInterface</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Contract.setProvider = <span class="function"><span class="keyword">function</span>(<span class="params">provider, accounts</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Contract.currentProvider = provider</span></span><br><span class="line">  core.packageInit(<span class="built_in">this</span>, [provider])</span><br><span class="line">  <span class="built_in">this</span>._ethAccounts = accounts</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Get the callback and modify the array if necessary</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@method <span class="variable">_getCallback</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Array&#125;</span> <span class="variable">args</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;Function&#125;</span> </span>the callback</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Contract.prototype._getCallback = <span class="function"><span class="keyword">function</span> <span class="title">getCallback</span>(<span class="params">args</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (args &amp;&amp; _.isFunction(args[args.length - <span class="number">1</span>])) &#123;</span><br><span class="line">    <span class="keyword">return</span> args.pop() <span class="comment">// modify the args array!</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Checks that no listener with name &#x27;newListener&#x27; or &#x27;removeListener&#x27; is added</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@method <span class="variable">_checkLister</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String&#125;</span> <span class="variable">type</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String&#125;</span> <span class="variable">event</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;Object&#125;</span> </span>the contract instance</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Contract.prototype._checkListerner = <span class="function"><span class="keyword">function</span>(<span class="params">type, event</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (event === type) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(</span><br><span class="line">      <span class="string">`The event <span class="subst">$&#123;type&#125;</span> is a reserved event name, you can&#x27;t use it`</span>,</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Use default values, if options are not avaible</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@method <span class="variable">_getOrSetDefaultOptions</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Object&#125;</span> </span>options the options given by the user</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;Object&#125;</span> </span>the options with gaps filled by defaults</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Contract.prototype._getOrSetDefaultOptions = <span class="function"><span class="keyword">function</span> <span class="title">getOrSetDefaultOptions</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  options,</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> gasPrice = options.gasPrice ? <span class="built_in">String</span>(options.gasPrice)&#125; : <span class="literal">null</span></span><br><span class="line">  <span class="keyword">var</span> <span class="keyword">from</span> = options.from ? utils.toChecksumAddress(formatters.inputAddressFormatter(options.from)): <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">  options.data = option.data || <span class="built_in">this</span>.options.data</span><br><span class="line"></span><br><span class="line">  option.from = <span class="keyword">from</span> || <span class="built_in">this</span>.options.from</span><br><span class="line">  option.gasPrice = gasPrice || <span class="built_in">this</span>.options.gasPrice</span><br><span class="line">  options.gas = options.gas || options.gasLimit || <span class="built_in">this</span>.options.gas</span><br><span class="line"></span><br><span class="line">  <span class="keyword">delete</span> options.gasLimit</span><br><span class="line">  <span class="keyword">return</span> options</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span></span></span><br><span class="line"><span class="comment">// _encodeEventABI</span></span><br><span class="line"><span class="comment">// _decodeEventABI</span></span><br><span class="line"><span class="comment">// _encodeMethodABI</span></span><br><span class="line"><span class="comment">// _decodeMethodABI</span></span><br><span class="line"><span class="comment">// _decodeMethodReturn</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Deploys a contract and fire events based on its state: transactionHash, receipt</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * All event listeners will be removed, once the last possible event is fired (&#x27;error&#x27; or &#x27;receipt&#x27;)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@method <span class="variable">deploy</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Object&#125;</span> <span class="variable">options</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> <span class="variable">callback</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;Object&#125;</span> </span>EventEmitter possible are &quot;error&quot;, &quot;transactionHash&quot;, and &quot;receipt&quot;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Contract.prototype.deploy = <span class="function"><span class="keyword">function</span>(<span class="params">options, callback</span>) </span>&#123;</span><br><span class="line">  options = options || &#123;&#125;</span><br><span class="line">  options.arguments = options.arguments || []</span><br><span class="line">  options = <span class="built_in">this</span>._getOrSetDefaultOptions(options)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// return error if no &#x27;data&#x27; is specified</span></span><br><span class="line">  <span class="keyword">if</span> (!options.data) &#123;</span><br><span class="line">    <span class="keyword">return</span> utils._fireError(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;No &quot;data&quot; specifed in neither the given options, nor the default options&#x27;</span>), <span class="literal">null</span>, <span class="literal">null</span>, callback)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> <span class="keyword">constructor</span> = _.find(this.options.jsonInterface, function(method) &#123;</span><br><span class="line">    <span class="keyword">return</span> (method.type === <span class="string">&#x27;contructor&#x27;</span>)</span><br><span class="line">  &#125;) || &#123;&#125;</span><br><span class="line"></span><br><span class="line">  constructor.signature = &#x27;constructor&#x27;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">this</span>._createTxObject.apply(&#123;</span><br><span class="line">    method: <span class="keyword">constructor</span>,</span><br><span class="line">    parent: this,</span><br><span class="line">    deployData: options.data,</span><br><span class="line">    _ethAccounts: this.<span class="keyword">constructor</span>._ethAccounts</span><br><span class="line">  &#125;, options.arguments)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// TODO:</span><br><span class="line">// _generateEventOptions</span><br><span class="line">// clone</span><br><span class="line">// once</span><br><span class="line">// _on</span><br><span class="line">// getPastEvents</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * returns the an object with call, send, estimate functions</span><br><span class="line"> *</span><br><span class="line"> * @method _createTxObject</span><br><span class="line"> * @return &#123;<span class="built_in">Object</span>&#125; an object <span class="keyword">with</span> functions to call the method</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">Contract.prototype._createTxObject = <span class="function"><span class="keyword">function</span> <span class="title">_createTxObject</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> args = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>)</span><br><span class="line">  <span class="keyword">var</span> txObject = &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">this</span>.method.type === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">    txObject.call = <span class="built_in">this</span>.parent._executeMethod.bind(txObject, <span class="string">&#x27;call&#x27;</span>)</span><br><span class="line">    txObject.call.request = <span class="built_in">this</span>.parent._executeMethod.bind(txObject, <span class="string">&#x27;call&#x27;</span>, <span class="literal">true</span>) <span class="comment">// to make batch request</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  txObject.send = <span class="built_in">this</span>.parent._executeMethod.bind(txObject, <span class="string">&#x27;send&#x27;</span>)</span><br><span class="line">  txObject.send.request = <span class="built_in">this</span>.parent._executeMethod.bind(txObject)</span><br><span class="line">  txObject.encodeABI = <span class="built_in">this</span>.parent._encodeMethodABI.bind(txObject)</span><br><span class="line">  txObject.estimateGas = <span class="built_in">this</span>.parent._executeMethod.bind(txObject, <span class="string">&#x27;estimate&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// check arguments length</span></span><br><span class="line">  <span class="keyword">if</span> (args &amp;&amp; <span class="built_in">this</span>.method.inputs &amp;&amp; args.length !== <span class="built_in">this</span>.method.inputs.length) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.nextMethod) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.nextMethod.apply(<span class="literal">null</span>, args)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> errors.InvalidNumberOfParams(args.length, <span class="built_in">this</span>.method.inputs.length, <span class="built_in">this</span>.method.name)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  txObject.arguments = args || []</span><br><span class="line">  txObject._method = <span class="built_in">this</span>.method</span><br><span class="line">  txObject._parent = <span class="built_in">this</span>.parent</span><br><span class="line">  txObject._ethAccounts = <span class="built_in">this</span>.parent.constructor._ethAccounts || <span class="built_in">this</span>._ethAccounts</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(<span class="built_in">this</span>.deployData) &#123;</span><br><span class="line">    txObject._deployData = <span class="built_in">this</span>.deployData</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> txObject</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// _processExecuteArguments</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Execute a call, transact or estimateGas on a contract function</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@method <span class="variable">_executeMethod</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>type the type this execute function should execute</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Boolean&#125;</span> </span>makeRequest if true, it simply returns the request parameters, rather than execute it.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">Contract.prototype._executeMethod = <span class="function"><span class="keyword">function</span> <span class="title">_executeMethod</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> _this = <span class="built_in">this</span></span><br><span class="line">  <span class="keyword">var</span> args = <span class="built_in">this</span>._parent._processExecuteArguments.call(<span class="built_in">this</span>, <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>))</span><br><span class="line">  <span class="keyword">var</span> defer = promiEvent((args.type !== <span class="string">&#x27;send))</span></span><br><span class="line"><span class="string">  var ethAccounts = _this.constructor._ethAccounts || _this._ethAccounts</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  // simply return request for batch requests</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  if (args.generateRequest) &#123;</span></span><br><span class="line"><span class="string">    // handle batch request</span></span><br><span class="line"><span class="string">    var payload = &#123;</span></span><br><span class="line"><span class="string">      params: [formatters.inputCallFormatter.call(this._parent, args.options)],</span></span><br><span class="line"><span class="string">      callback: args.callback,</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    if (args.type === &#x27;</span>call<span class="string">&#x27;) &#123;</span></span><br><span class="line"><span class="string">      payload.params.push(formatters.inputDefaultBlockNumber.call(this._parent, args.defaultBlockNumber))</span></span><br><span class="line"><span class="string">      payload.method = &#x27;</span>eth_call<span class="string">&#x27;</span></span><br><span class="line"><span class="string">      payload.format = this._parent.decodeMethodReturn.bind(null, this._method.outputs)</span></span><br><span class="line"><span class="string">    &#125; else &#123;</span></span><br><span class="line"><span class="string">      payload.method = &#x27;</span>eth_sendTransaction<span class="string">&#x27;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    return payload</span></span><br><span class="line"><span class="string">  &#125; else &#123;</span></span><br><span class="line"><span class="string">    // handle call or send</span></span><br><span class="line"><span class="string">    switch (args.type) &#123;</span></span><br><span class="line"><span class="string">      case &#x27;</span>estimate<span class="string">&#x27;: &#123;</span></span><br><span class="line"><span class="string">        var estimateGas = (new Method(&#123;</span></span><br><span class="line"><span class="string">          name: &#x27;</span>estimateGas<span class="string">&#x27;,</span></span><br><span class="line"><span class="string">          call: &#x27;</span>eth_estimateGas<span class="string">&#x27;,</span></span><br><span class="line"><span class="string">          params: 1,</span></span><br><span class="line"><span class="string">          inputFormatter: [formatter.inputCallFormatter],</span></span><br><span class="line"><span class="string">          outputFormatter: utils.hexToNumber,</span></span><br><span class="line"><span class="string">          requestManager: _this._parent._requestManager,</span></span><br><span class="line"><span class="string">          accounts: ethAccounts, // specify accounts</span></span><br><span class="line"><span class="string">          defaultAccount: _this._parent.defaultAccount,</span></span><br><span class="line"><span class="string">          defaultBlock: _this._parent.defaultBlock,</span></span><br><span class="line"><span class="string">        &#125;)).createFunction();</span></span><br><span class="line"><span class="string">        return estimateGas(args.options, args.callback)</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">      case &#x27;</span>call<span class="string">&#x27;: &#123;</span></span><br><span class="line"><span class="string">        var call = (new Method(&#123;</span></span><br><span class="line"><span class="string">           name: &#x27;</span>call<span class="string">&#x27;,</span></span><br><span class="line"><span class="string">           call: &#x27;</span>eth_call<span class="string">&#x27;,</span></span><br><span class="line"><span class="string">           params: 2,</span></span><br><span class="line"><span class="string">           inputFormatter: [formatters.inputCallFormatter, formatters.inputDefaultBlockNumberFormatter],</span></span><br><span class="line"><span class="string">           outputFormatter: result =&gt; &#123;</span></span><br><span class="line"><span class="string">             return _this._parent.decodeMethodReturn(_this._method.outputs, result)</span></span><br><span class="line"><span class="string">           &#125;,</span></span><br><span class="line"><span class="string">           requestManager: _this._parent._requestManager,</span></span><br><span class="line"><span class="string">           accounts: ethAccounts, // is eth.accounts (necessary for wallet signing)</span></span><br><span class="line"><span class="string">           defaultAccount: _this._parent.defaultAccount,</span></span><br><span class="line"><span class="string">           defaultBlock: _this._parent.defaultBlock,</span></span><br><span class="line"><span class="string">        &#125;)).createFunction()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        return call(args.options, args.defaultBlock, args.callback)</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">      case &#x27;</span>send<span class="string">&#x27;: &#123;</span></span><br><span class="line"><span class="string">        if(!utils.isAddress(args.options.from)) &#123;</span></span><br><span class="line"><span class="string">            return utils._fireError(new Error(&#x27;</span>No <span class="string">&quot;from&quot;</span> address specified <span class="keyword">in</span> neither the given options, nor the <span class="keyword">default</span> options.<span class="string">&#x27;), defer.eventEmitter, defer.reject, args.callback);</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        if (_.isBoolean(this._method.payable) &amp;&amp; !this._method.payable &amp;&amp; args.options.value &amp;&amp; args.options.value &gt; 0) &#123;</span></span><br><span class="line"><span class="string">            return utils._fireError(new Error(&#x27;</span>Can not send value to non-payable contract method or <span class="keyword">constructor</span>&#x27;), defer.eventEmitter, defer.reject, args.callback);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // make sure receipt logs are decoded</span><br><span class="line">        var extraFormatters = &#123;</span><br><span class="line">          receiptFormatter: <span class="function"><span class="params">receipt</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (_.isArray(receipt.logs)) &#123;</span><br><span class="line">              <span class="comment">// decode logs</span></span><br><span class="line">              <span class="keyword">var</span> events = _.map(receipt.logs, <span class="function"><span class="params">log</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> _this._parent._decodeEventABI.call(&#123;</span><br><span class="line">                  name: <span class="string">&#x27;ALLEVENT&#x27;</span>,</span><br><span class="line">                  jsonInterface: _this._parent.options.jsonInterface,</span><br><span class="line">                &#125;, log)</span><br><span class="line">              &#125;)</span><br><span class="line"></span><br><span class="line">              <span class="comment">// make sure log names keys</span></span><br><span class="line">              receipt.events = &#123;&#125;</span><br><span class="line">              <span class="keyword">var</span> count = <span class="number">0</span></span><br><span class="line">              events.forEach(<span class="function"><span class="params">ev</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (ev.event) &#123;</span><br><span class="line">                  <span class="comment">// if &gt; 1 of the same event, don&#x27;t overwrite any existing events</span></span><br><span class="line">                  <span class="keyword">if</span> (receipt.events[ev.event]) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(receipt.events[ev.event])) &#123;</span><br><span class="line">                      receipt.events[ev.event].push(ev)</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                      receipt.events[ev.event] = [receipt.events[ev.event], ev]</span><br><span class="line">                    &#125;</span><br><span class="line">                  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    receipt.event[ev.event] = ev</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                  receipt.events[count] = ev</span><br><span class="line">                  count++</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;)</span><br><span class="line">              <span class="keyword">delete</span> receipt.logs</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> receipt</span><br><span class="line">          &#125;,</span><br><span class="line"></span><br><span class="line">          contractDeployFormatter: <span class="function"><span class="params">receipt</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> newContract = _this._parent.clone()</span><br><span class="line">            newContract.options.address = receipt.contractAddress</span><br><span class="line">            <span class="keyword">return</span> newContract</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> sendTransaction = (<span class="keyword">new</span> Method(&#123;</span><br><span class="line">          name: <span class="string">&#x27;sendTransaction&#x27;</span>,</span><br><span class="line">          call: <span class="string">&#x27;eth_sendTransaction&#x27;</span>,</span><br><span class="line">          params: <span class="number">1</span>,</span><br><span class="line">          inputFormatter: [formatters.inputTransactionFormatter],</span><br><span class="line">          requestManager: _this._parent.requestManager,</span><br><span class="line">          accounts: _this.constructor._ethAccount || _this._ethAccounts, <span class="comment">// is eth.accounts,</span></span><br><span class="line">          defaultAccount: _this._parent.defaultAccount,</span><br><span class="line">          defaultBlock: _this._parent.defaultBlock,</span><br><span class="line">          extraFormatter: extraFormatters,</span><br><span class="line">        &#125;)).createFunction()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sendTransaction(args.options, args.callback)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Ethereum </tag>
            
            <tag> Smart Contract </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RxjsV6</title>
      <link href="/2018/07/10/RxjsV6/"/>
      <url>/2018/07/10/RxjsV6/</url>
      
        <content type="html"><![CDATA[<h3 id="animationFrame-scheduler"><a href="#animationFrame-scheduler" class="headerlink" title="animationFrame - scheduler"></a>animationFrame - scheduler</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> animationFrame: any;</span><br></pre></td></tr></table></figure><p>Perform task when <code>window.requestAnimationFrame</code> would fire.</p><p>When <code>animationFrame</code> scheduler is used with delay, it will fall back to <code>async</code> scheduler behaviour.</p><p>Without delay, <code>animationFrame</code> scheduler can be used to create smooth browser animations. It makes sure scheduled task will happen just before next browser content repaint, thus performing animations as efficiently as possible.</p>]]></content>
      
      
      
        <tags>
            
            <tag> RxJS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Content Parser in CITA</title>
      <link href="/2018/05/17/content-parser-in-cita/"/>
      <url>/2018/05/17/content-parser-in-cita/</url>
      
        <content type="html"><![CDATA[<p>The parse now we used is</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> parser = <span class="function">(<span class="params">content: string</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> bytes = hexToBytes(content)</span><br><span class="line">  <span class="keyword">const</span> decoded = pb.UnverifiedTransaction.deserializeBinary(bytes)</span><br><span class="line">  <span class="keyword">const</span> tx = decoded.getTransaction()</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="keyword">from</span>: tx.getFrom ? tx.getFrom() : <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    to: tx.getTo ? tx.getTo() : <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    data: tx.getData ? tx.getData() : <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    value: tx.getValue ? tx.getValue().toString() : <span class="string">&#x27;&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Here we use these methods:</p><ul><li><p>hexToBytes(content) =&gt; bytes</p></li><li><p>pb.UnverifiesTransaction.deserializeBinary(bytes) =&gt; decoded</p></li><li><p>decoded.getTransaction() =&gt; transaction</p></li><li><p>transaction.{getFrom, getTo, getValue, getData}</p></li></ul><h5 id="hexToBytes"><a href="#hexToBytes" class="headerlink" title="hexToBytes"></a>hexToBytes</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> hexToBytes = <span class="function">(<span class="params">hex: string</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> _hex = hex.startsWith(<span class="string">&#x27;0x&#x27;</span>) ? hex.slice(<span class="number">2</span>) : hex <span class="comment">// remove 0x prefix</span></span><br><span class="line">  <span class="keyword">let</span> result = []</span><br><span class="line">  <span class="keyword">while</span> (_hex.length &gt;= <span class="number">2</span>) &#123;</span><br><span class="line">    result.push(<span class="built_in">parseInt</span>(_hex.substring(<span class="number">0</span>, <span class="number">2</span>), <span class="number">16</span>)) <span class="comment">// parse hex to bytes(int8 array)</span></span><br><span class="line">    _hex = _hex.substring(<span class="number">2</span>, _hex.length)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="pb-UnverifiedTransaction-deserializeBinary"><a href="#pb-UnverifiedTransaction-deserializeBinary" class="headerlink" title="pb.UnverifiedTransaction.deserializeBinary"></a>pb.UnverifiedTransaction.deserializeBinary</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> jspb = <span class="built_in">require</span>(<span class="string">&#x27;google-protobuf&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> goog = jspb</span><br><span class="line"></span><br><span class="line">proto.UnverifiedTransaction = <span class="function"><span class="params">opt_data</span> =&gt;</span> &#123;</span><br><span class="line">  jspb.Message.initialize(<span class="built_in">this</span>, opt_data, <span class="number">0</span>, <span class="number">-1</span>, <span class="literal">null</span>, <span class="literal">null</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">proto.UnverifiedTransaction.deserializeBinaryFromReader = <span class="function">(<span class="params">msg, reader</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">while</span> (reader.nextField()) &#123;</span><br><span class="line">    <span class="keyword">if</span> (reader.isEndGroup()) &#123;</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> field = reader.getFieldNumber()</span><br><span class="line">    <span class="keyword">switch</span> (field) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>: &#123;</span><br><span class="line">        <span class="keyword">let</span> value = <span class="keyword">new</span> proto.Transaction()</span><br><span class="line">        reader.readMessage(value.proto.Transaction.deserializeBinaryFromReader)</span><br><span class="line">        msg.setTransaction(value)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>: &#123;</span><br><span class="line">        <span class="keyword">let</span> value = <span class="comment">/** @type &#123;!Uint8Array&#125; */</span> (reader.readBytes())</span><br><span class="line">        msg.setSignature(value)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>: &#123;</span><br><span class="line">        <span class="keyword">let</span> value = <span class="comment">/** @type &#123;!proto.Crypto&#125; */</span> (reader.readEnum())</span><br><span class="line">        msg.setCrypto(value)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">default</span>: &#123;</span><br><span class="line">        reader.skipField()</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> msg</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">proto.UnverifiedTransaction.deserializeBinary = <span class="function"><span class="params">bytes</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> reader = <span class="keyword">new</span> jspb.BinaryReader(bytes)</span><br><span class="line">  <span class="keyword">const</span> msg = <span class="keyword">new</span> proto.UnverifiedTransaction()</span><br><span class="line">  <span class="keyword">return</span> proto.UnverifiedTransaction.deserializeBinaryFromReader(msg, reader)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Blockchain </tag>
            
            <tag> CITA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GenServer in Erlang</title>
      <link href="/2018/05/16/GenServer-in-Erlang/"/>
      <url>/2018/05/16/GenServer-in-Erlang/</url>
      
        <content type="html"><![CDATA[<p><a href="https://medium.com/learn-elixir/genserver-explained-in-5-minutes-ae5823af4d44">Original</a></p><p><code>GenServer</code> is essential part of OTP, which simplifies repeating tasks, letting programmer concentrate on logic of the application, and not on handling edge cases and repeated error handling.</p><p><img src="https://cdn-images-1.medium.com/max/800/1*TpSDUSS0z3lgrUg1uEOUZg.gif" alt="Every Time When GenServer callback is called"></p><p>The idea behind <code>GenServer</code> is simple - you start separate process, that holds some state, then on each incoming message(be that <code>call</code> or <code>cast</code>) it may change it internal state and also generate some response(in case of <code>call</code>)</p><p>In this manual <code>calling process</code> is named <code>Alice</code> and newly process is <code>Bob</code>.</p><h5 id="Programming-without-GenServer-as-you-would-done-it-manually"><a href="#Programming-without-GenServer-as-you-would-done-it-manually" class="headerlink" title="Programming without GenServer, as you would done it manually"></a>Programming without GenServer, as you would done it manually</h5><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">SimpleGenServerMock</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">start_link</span></span>() <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># runs in the *caller* context `Alice`</span></span><br><span class="line">    spawn_link(__MODULE__, <span class="symbol">:init</span>, [])</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">call</span></span>(pid, arguments) <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># runs in the *caller* context `Alice`</span></span><br><span class="line">    send pid, &#123;<span class="symbol">:call</span>, <span class="keyword">self</span>(), arguments&#125;</span><br><span class="line">    receive</span><br><span class="line">      &#123;<span class="symbol">:response</span>, data&#125; -&gt; data</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">cast</span></span>(pid, arguments) <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># runs in `caller` context `Alice`</span></span><br><span class="line">    send pid, &#123;<span class="symbol">:cast</span>, arguments&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">init</span></span>() <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># runs in the *server* context `Bob`</span></span><br><span class="line">    initial_state = <span class="number">1</span></span><br><span class="line">    loop(initial_state)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">loop</span></span>(state) <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># runs in the *server* context `Bob`</span></span><br><span class="line"></span><br><span class="line">    receive command <span class="keyword">do</span></span><br><span class="line">      &#123;<span class="symbol">:call</span>, pid, <span class="symbol">:get_data</span>&#125; -&gt;</span><br><span class="line">        <span class="comment"># do some work on data here and update state</span></span><br><span class="line">        &#123;new_state, data&#125; = &#123;state, state&#125;</span><br><span class="line">        send pid, &#123;<span class="symbol">:response</span>, data&#125;</span><br><span class="line">        loop(new_state)</span><br><span class="line">      &#123;<span class="symbol">:cast</span>, <span class="symbol">:increment</span>&#125; -&gt;</span><br><span class="line">        <span class="comment"># do some work on data here and update state</span></span><br><span class="line">        new_state = state + <span class="number">1</span></span><br><span class="line">        loop(new_state)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>Code <code>initial_state = 1</code> is exactly same code we write in <code>init</code> callback. Internal state of the server is simply an integer. Usually it is a map, tuple or list with settings and state.</p><p><code>&#123;state, state&#125;</code> means that we do not want to update the state and want to return state as result. This is the code which goes in <code>handle_call</code> callback in <code>Bob</code>.</p><p>And code <code>new_state = state + 1</code> is the code which goes into <code>handle_cast</code> callback, because we do not need to respond with result, we just change server <code>Bob</code> internal state.</p><p>Working with module will look like:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pid = SimpleGenServerMock.start_link()</span><br><span class="line">counter = SimpleGenServerMock.call(pid, :get_data)</span><br><span class="line">IO.puts <span class="string">&quot;Counter: #&#123;counter&#125;&quot;</span></span><br><span class="line">SimpleGenServerMock.cast(pid, :increment)</span><br><span class="line">counter = SimpleGenServerMock.call(pid, :get_data)</span><br><span class="line">IO.puts <span class="string">&quot;Counter: #&#123;counter&#125;&quot;</span></span><br></pre></td></tr></table></figure><h5 id="Same-Server-With-GenServer-Behaviour"><a href="#Same-Server-With-GenServer-Behaviour" class="headerlink" title="Same Server With GenServer Behaviour"></a>Same Server With GenServer Behaviour</h5><p>Now if we want to re-write same code using <code>GenServer</code> it will look like this:</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">SimpleGenServerBehaviour</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">use</span> GenServer</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">start_link</span></span>() <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># runs in the *caller* context `Alice`</span></span><br><span class="line">    GenServer.start_link(__MODULE__, [])</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">init</span></span>(_) <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># runs in the *server* context `Bob`</span></span><br><span class="line">    &#123;<span class="symbol">:ok</span>, <span class="number">1</span>&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">handle_call</span></span>(<span class="symbol">:get_data</span>, _from, state) <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># runs in the *server* context `Bob`</span></span><br><span class="line">    &#123;<span class="symbol">:reply</span>, state, state&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">handle_cast</span></span>(<span class="symbol">:increment</span>, state) <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># runs in the *server* context `Bob`</span></span><br><span class="line">    &#123;<span class="symbol">:noreply</span>, state + <span class="number">1</span>&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>While in this example it did not saved a lot of lines for more complicated code having <code>GenServer</code> deal with all complexity saves a lot of tying. Also you got timeout, named processes and stable, production proven error hanlding for free.</p><p>Using GenServer behaviour is very similar to code we wrote before:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;:ok, pid&#125; = GenServer.start_link(SimpleGenServerBehaviour, [])</span><br><span class="line">counter = GenServer.call(SimpleGenServerBehaviour, :get_data)</span><br><span class="line">GenServer.cast(SimpleGenServerBehaviour, :increment)</span><br></pre></td></tr></table></figure><p>Better to implement start in the module</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">Stack</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">use</span> GenServer</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">start_link</span></span>(defaut) <span class="keyword">do</span></span><br><span class="line">    GenServer.start_link(default)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">push</span></span>(pid, item) <span class="keyword">do</span></span><br><span class="line">    GenServer.cast(pid, &#123;<span class="symbol">:push</span>, item&#125;)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">pop</span></span>(pid) <span class="keyword">do</span></span><br><span class="line">    GenServer.call(pid, <span class="symbol">:pop</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Server callbacks</span></span><br><span class="line"></span><br><span class="line">  <span class="variable">@impl</span> ture</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">handle_call</span></span>(<span class="symbol">:pop</span>, _from, [h | t]) <span class="keyword">do</span></span><br><span class="line">    &#123;<span class="symbol">:reply</span>, h, t&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="variable">@impl</span> <span class="keyword">true</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">handle_cast</span></span>(&#123;<span class="symbol">:push</span>, item&#125;, state) <span class="keyword">do</span></span><br><span class="line">    &#123;<span class="symbol">:noreply</span>, [item | state]&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h5 id="Receiving-Regular-Messages"><a href="#Receiving-Regular-Messages" class="headerlink" title="Receiving Regular Messages"></a>Receiving Regular Messages</h5><p>The goal of <code>GenServer</code> is to abstract the “receive” loop for developers, automatically handling system messages, support code changes, synchronous calls and more. Therefore, you should never call your own “recieve” inside the GenServer callbacks as doing will cause the GenServer misbehave.</p><p>Besides the synchronous and asynchronous communication provided by <code>call/3</code> and <code>cast/2</code>, regular messages sent by functions such as <code>Kernal/send2</code>, <code>Process.send_after/4</code> and similar, can be handled inside the <code>handle_info/2</code> callback.</p><p><code>handle_info/2</code> can be used in many sinutations, such as handling monitor DOWN messages sent by <code>Process.monitor/1</code>. Another use case for <code>handle_info/2</code> is to perform periodic work, with the help of <code>Process.send_after/4</code>:</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">MyApp.Periodically</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">use</span> GenServer</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">start_link</span></span> <span class="keyword">do</span></span><br><span class="line">    GenServer.start_link(__MODULE__, %&#123;&#125;)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="variable">@impl</span> <span class="keyword">true</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">init</span></span>(state) <span class="keyword">do</span></span><br><span class="line">    schedule_work() <span class="comment"># Schedule work to be performed on start</span></span><br><span class="line">    &#123;<span class="symbol">:ok</span>, state&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="variable">@impl</span> <span class="keyword">true</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">handle_info</span></span>(<span class="symbol">:work</span>, state) <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># Do the desired work here</span></span><br><span class="line">    schedule_work() <span class="comment"># Reschedule once more</span></span><br><span class="line">    &#123;<span class="symbol">:noreply</span>, state&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">schedule_work</span></span>() <span class="keyword">do</span></span><br><span class="line">    Process.send_after(<span class="keyword">self</span>(), <span class="symbol">:work</span>, <span class="number">1000</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Elixir </tag>
            
            <tag> Erlang </tag>
            
            <tag> GenServer </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Association in Phoenix</title>
      <link href="/2018/05/15/Association-in-Phoenix/"/>
      <url>/2018/05/15/Association-in-Phoenix/</url>
      
        <content type="html"><![CDATA[<p><a href="http://blog.plataformatec.com.br/2015/08/working-with-ecto-associations-and-embeds/">Original</a></p><h3 id="Associations"><a href="#Associations" class="headerlink" title="Associations"></a>Associations</h3><p>Associations in Ecto are used when two difference sources(tables) are linked via foreign keys.</p><p>A classic example of this setup is “Post has many comments”. First create the two tables in migrations</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">create table(<span class="symbol">:posts</span>) <span class="keyword">do</span></span><br><span class="line">  add <span class="symbol">:title</span>, <span class="symbol">:string</span></span><br><span class="line">  add <span class="symbol">:body</span>, <span class="symbol">:text</span></span><br><span class="line"></span><br><span class="line">  timestamps()</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">create table(<span class="symbol">:comments</span>) <span class="keyword">do</span></span><br><span class="line">  add <span class="symbol">:post_id</span>, references(<span class="symbol">:posts</span>)</span><br><span class="line">  add <span class="symbol">:body</span>, <span class="symbol">:text</span></span><br><span class="line"></span><br><span class="line">  timestamps()</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>Each comment contains a <code>post_id</code> column that by default points to a post <code>id</code></p><p>And now defined the schemas</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">MyApp.Post</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">use</span> Ecto.Schema</span><br><span class="line"></span><br><span class="line">  schema <span class="string">&quot;posts&quot;</span> <span class="keyword">do</span></span><br><span class="line">    field <span class="symbol">:title</span></span><br><span class="line">    field <span class="symbol">:body</span></span><br><span class="line">    has_many <span class="symbol">:comments</span>, MyApp.Comment</span><br><span class="line">    timestamps</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">MyApp.Comment</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">use</span> Ecto.Schema</span><br><span class="line"></span><br><span class="line">  schema <span class="string">&quot;comments&quot;</span> <span class="keyword">do</span></span><br><span class="line">    field <span class="symbol">:body</span></span><br><span class="line">    belongs_to <span class="symbol">:post</span>, MyApp.Post</span><br><span class="line">    timestamps</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h3 id="Querying-associations"><a href="#Querying-associations" class="headerlink" title="Querying associations"></a>Querying associations</h3><p>One of the benefits of defining associations is taht they can be used in queries. For example:</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Repo.all from p <span class="keyword">in</span> Post, <span class="symbol">preload:</span> [<span class="symbol">:comments</span>]</span><br></pre></td></tr></table></figure><p>Now all posts will be fetched from the database with their associated comments. The example above will perform two queries: one for loading all posts and another for loading all comments. This is often the most efficient way of loading associations from the database(even if two queries are performed) because we need to receive and parse only POSTS + COMMENTS results.</p><p>It is also possible to preload associations using joins while performing more complex queries. For example, imagine both posts and comments have votes and you want only comments with more votes than the post itself:</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Repo.all from p <span class="keyword">in</span> Post,</span><br><span class="line">      <span class="symbol">join:</span> c <span class="keyword">in</span> assoc(p, <span class="symbol">:comments</span>),</span><br><span class="line">      <span class="symbol">where:</span> c.votes &gt; p.votes</span><br><span class="line">      <span class="symbol">preload:</span> [<span class="symbol">comments:</span> c]</span><br></pre></td></tr></table></figure><h3 id="Manipulating-associations"><a href="#Manipulating-associations" class="headerlink" title="Manipulating associations"></a>Manipulating associations</h3><p>While Ecto 2.0 allows you insert a post with multiple comments in one operation:</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Repo.insert!(%Post&#123;</span><br><span class="line">  <span class="symbol">title:</span> <span class="string">&quot;Hello&quot;</span>,</span><br><span class="line">  <span class="symbol">body:</span> <span class="string">&quot;world&quot;</span>,</span><br><span class="line">  <span class="symbol">comments:</span> [</span><br><span class="line">    %Comment&#123;<span class="symbol">body:</span> <span class="string">&quot;Excellent&quot;</span>&#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Many times you may want to break it into distinct steps so you have more flexibility in managing those entries. For example, you could use changesets to build your posts and comments along the way</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">post = Ecto.Changeset.change(%Post&#123;&#125;, <span class="symbol">title:</span> <span class="string">&quot;Hello&quot;</span>, <span class="symbol">body:</span> <span class="string">&quot;World&quot;</span>)</span><br><span class="line">comment = Ecto.Changeset.change(%Comment&#123;&#125;, <span class="symbol">body:</span> <span class="string">&quot;Excellent&quot;</span>)</span><br><span class="line">post_with_comments = Ecto.Changeset.put_assoc(post, <span class="symbol">:comments</span>, [comment]) <span class="comment"># Main Step</span></span><br><span class="line">Repo.insert!(post_with_comments)</span><br></pre></td></tr></table></figure><p>Or by handling each entry individually inside a transation:</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Repo.transaction <span class="keyword">fn</span> -&gt;</span><br><span class="line">  post = Repo.insert!(%Post&#123;<span class="symbol">title:</span> <span class="string">&quot;Hello&quot;</span>, <span class="symbol">body:</span> <span class="string">&quot;World&quot;</span>&#125;)</span><br><span class="line">  <span class="comment"># Build a comment from the post struct</span></span><br><span class="line">  comment = Ecto.build_assoc(post, <span class="symbol">:comments</span>, <span class="symbol">body:</span> <span class="string">&quot;Execellent&quot;</span>)</span><br><span class="line">  Repo.insert!(comment)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p><code>Ecto.build_assoc/3</code> builds the comment using the id currently set in the post struct. It is equivalnet to:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%Comment&#123;post_id: post.id, body: &quot;Execellent&quot;&#125;</span><br></pre></td></tr></table></figure><p>The Ecto.build_assoc/3 function is specially useful in Phoenix controllers. For example when creating the post, one would do:</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Ecto.build_assoc(current_user, <span class="symbol">:post</span>)</span><br></pre></td></tr></table></figure><p>As we likely want to associate the post to the user currently signed in the application. In another controller, we could build a comment for an existing post with:</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Ecto.build_assoc(post, <span class="symbol">:comments</span>)</span><br></pre></td></tr></table></figure><p>Ecto does not provide functions like <code>post.comments &lt;&lt; comment</code> that allows mixing persisted data with non-persisted data. The only macha</p>]]></content>
      
      
      
        <tags>
            
            <tag> Phoenix </tag>
            
            <tag> Elixir </tag>
            
            <tag> Ecto </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Difference Bwtween Build_assoc, Put_assoc, and Cast_assoc</title>
      <link href="/2018/05/15/cast-assoc/"/>
      <url>/2018/05/15/cast-assoc/</url>
      
        <content type="html"><![CDATA[<h3 id="Cast-Assoc-code"><a href="#Cast-Assoc-code" class="headerlink" title="Cast Assoc code"></a>Cast Assoc <a href="https://github.com/elixir-ecto/ecto/blob/v2.2.10/lib/ecto/changeset.ex#L659">code</a></h3><blockquote><p>cast_assoc(changeset, name, opts \ [])</p></blockquote><p>Casts the given association with the <code>changeset params</code></p><p>This function should be used when working withe the entire association at once(and not a single element of a many-style association) and using data external to the application.</p><p>When updating the data, this function requires the association to have been preloaded in the changeset struct. Missing data will invoke the <code>:on_replace</code> behaviour defined on the association. Preloading is not necessary for newly built structs.</p><p>The parameters for the given association will be retrieved from <code>changeset.params</code>. Those parameters are expected to be a map with attributes, similar to the ones passed to <code>cast/4</code>. Once parameter are retrieved, <code>cast_assoc/3</code> will match those parameters with the associations already in the changeset record</p><p>For example, imagine a user has many addresses relationship where post data is sent as follow</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">%&#123;<span class="string">&quot;name&quot;</span> =&gt; <span class="string">&quot;John Doe&quot;</span>, <span class="string">&quot;addresses&quot;</span> =&gt; [</span><br><span class="line">  %&#123;<span class="string">&quot;street&quot;</span> =&gt; <span class="string">&quot;Some where&quot;</span>, <span class="string">&quot;country&quot;</span> =&gt; <span class="string">&quot;Brzil&quot;</span>, <span class="string">&quot;id&quot;</span> =&gt; 1&#125;,</span><br><span class="line">  %&#123;<span class="string">&quot;street&quot;</span> =&gt; <span class="string">&quot;Else where&quot;</span>, <span class="string">&quot;country&quot;</span> =&gt; <span class="string">&quot;Poland&quot;</span>&#125;,</span><br><span class="line">]&#125;</span><br></pre></td></tr></table></figure><p>and then</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">user</span><br><span class="line">|&gt; Repo.preload(<span class="symbol">:addresses</span>)</span><br><span class="line">|&gt; Ecto.Changeset.cast(params, [])</span><br><span class="line">|&gt; Ecto.Changeset.cast_assoc(<span class="symbol">:addresses</span>)</span><br></pre></td></tr></table></figure><p>Once <code>cast_assoc/3</code> is called, Ecto will compare those params with the addresses already associated with the user and acts as follows:</p><ul><li><p>If the parameter does not contain an ID, the parameter data will be passed to <code>changeset/2</code> with a new struct and become an insert operation</p></li><li><p>If the parameter contains an ID and there is no associated child with such ID, the parameter data will be passed to <code>changeset/2</code> with a new struct and become an insert operation</p></li><li><p>If the parameter contains an ID and there is an associated children with such ID, the parameter data will be passed to <code>changeset/2</code> with the existing struct and become an update operation.</p></li><li><p>If there is an associated child with an ID and its ID is not given as parameter, the <code>:on_replace</code> callback for that association will be invoked</p></li></ul><h5 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h5><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">`cast_assoc/<span class="number">3</span>` is useful <span class="keyword">when</span> the associated data is managed alongside the parent struct, all at once.</span><br><span class="line"></span><br><span class="line">To work <span class="keyword">with</span> a single element of an association, other functions are more appropriate. For example to insert a single associated struct <span class="keyword">for</span> a `has_many` association it<span class="string">&#x27;s much easier to construct the associated struct with `Ecto.build_assoc/3` and persist it directly with `Ecto.Repo.insert/2`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Furthurmore, if each side of the association is managed seperately, it is prefereable to use `put_assoc/3` and directly instruct Ecto how the association should look like.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">For example, imagine you are receiving a set of tags you want to associate to an user. Those tags are meant to **exist upfront**. Using `cast_assoc/3` won&#x27;</span>t work as desired because the tags are <span class="keyword">not</span> managed alongside the user. In such cases, `put_assoc/<span class="number">3</span>` will work as desired. With the given <span class="symbol">parameters:</span></span><br><span class="line"></span><br><span class="line">  %&#123;<span class="string">&quot;name&quot;</span> =&gt; <span class="string">&quot;John Doe&quot;</span>, <span class="string">&quot;tags&quot;</span> =&gt; [<span class="string">&quot;linear&quot;</span>]&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">and</span> <span class="keyword">then</span></span><br><span class="line"></span><br><span class="line">  tags = Repo.all(from t <span class="keyword">in</span> Tag, <span class="symbol">where:</span> t.name <span class="keyword">in</span> ^params[<span class="string">&quot;tags&quot;</span>])</span><br><span class="line"></span><br><span class="line">  user</span><br><span class="line">  |&gt; Repo.preload(<span class="symbol">:tags</span>)</span><br><span class="line">  |&gt; Ecto.Changeset.cast(params) <span class="comment"># no need to allow :tags as we put them directly</span></span><br><span class="line">  |&gt; Ecto.Changeset.put_assoc(<span class="symbol">:tags</span>, tags) <span class="comment"># explicitly set the tags</span></span><br><span class="line"></span><br><span class="line">note the changeset must have been previously `cast` using `cast/<span class="number">4</span>` before this function is called.</span><br></pre></td></tr></table></figure><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cast_assoc</span></span>(changeset, name, opts \\ []) <span class="keyword">when</span> is_atom(name) <span class="keyword">do</span></span><br><span class="line">  cast_relation(<span class="symbol">:assoc</span>, changeset, name, opts)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">defp</span> <span class="title">cast_relation</span></span>(type, %Changeset&#123;&#125; = changeset, key, opts) <span class="keyword">do</span></span><br><span class="line">  &#123; key, param_key &#125; = cast_key(key)</span><br><span class="line">  %&#123;<span class="symbol">data:</span> data, <span class="symbol">types:</span> types, <span class="symbol">params:</span> params, changes, changes &#125; = changeset</span><br><span class="line">  %&#123;<span class="symbol">related:</span> related&#125; = relation = relation!(<span class="symbol">:cast</span>, type, key, Map.get(types, key))</span><br><span class="line">  params = params || %&#123;&#125;</span><br><span class="line"></span><br><span class="line">  &#123;changeset, required?&#125; = if opts[<span class="symbol">:required</span>] <span class="keyword">do</span></span><br><span class="line">    &#123;update_in(changeset.required, &amp;[key|&amp;<span class="number">1</span>]), <span class="keyword">true</span>&#125;</span><br><span class="line">  else</span><br><span class="line">    &#123;changeset, <span class="keyword">false</span>&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  on_cast = Keyword.get_lazy(opts, <span class="symbol">:with</span>, <span class="keyword">fn</span> -&gt; on_cast_default(type, related) <span class="keyword">end</span>)</span><br><span class="line">  original = Map.get(data, key)</span><br><span class="line"></span><br><span class="line">  changeset = <span class="keyword">case</span> Map.fetch(params, params_key) <span class="keyword">do</span></span><br><span class="line">    &#123;<span class="symbol">:ok</span>, value&#125; -&gt;</span><br><span class="line">      current = Relation.load!(data, original)</span><br><span class="line">      <span class="keyword">case</span> Relation.cast(relation, value, current, on_cast) <span class="keyword">do</span></span><br><span class="line">        &#123;<span class="symbol">:ok</span>, change, relation_valid?&#125; <span class="keyword">when</span> change != original -&gt;</span><br><span class="line">          missing_relation(%&#123;changeset |  <span class="symbol">change:</span> Map.put(changes, key, changes), <span class="symbol">valid?:</span> changeset.valid? <span class="keyword">and</span> relation_valid?&#125;, key, current, required?, relation, opts)</span><br><span class="line">        <span class="symbol">:error</span> -&gt;</span><br><span class="line">          %&#123;changeset | <span class="symbol">errors:</span> [&#123;key, &#123;message(opts, <span class="symbol">:invalid_message</span>, <span class="string">&quot;is invalid&quot;</span>), [<span class="symbol">type:</span> expected_relation_type(relation)]&#125;&#125; | changeset.errors], valid? <span class="keyword">false</span>&#125;</span><br><span class="line">        _ -&gt; missing_relation(changeset, key, current, required?, relation, opts)</span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">    <span class="symbol">:error</span> -&gt; missing_relation(changeset, key, current, required?, relation, opts)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  update_in changeset.types[key], <span class="keyword">fn</span> &#123;type, relation&#125; -&gt;</span><br><span class="line">    &#123;type, %&#123;relation | <span class="symbol">on_cast:</span> on_cast&#125;&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h3 id="Put-Assoc"><a href="#Put-Assoc" class="headerlink" title="Put Assoc"></a>Put Assoc</h3><p>As alternative to <code>cast_assoc/3</code></p><p><code>cast_assoc/3</code> is useful when the associated data is managed alongside the parent struct, all at once.</p><p>If each side of the association is managed seperately, it is preferable to use <code>put_assoc/3</code> and directly instruct Ecto how the association should look like.</p><p>For example, imagine you are receiving a set of tags you want to associate to an user. Those tags are meant to exist upfront. Using <code>cast_assoc/3</code> won’t work as desired because the tags are not managed alongside the user. In such cases, <code>put_assoc/3</code> will work as desired.</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%&#123;<span class="string">&quot;name&quot;</span> =&gt; <span class="string">&quot;John Doe&quot;</span>, <span class="string">&quot;tags&quot;</span> =&gt; [<span class="string">&quot;lieanr&quot;</span>]&#125;</span><br></pre></td></tr></table></figure><p>and then:</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tags = Repo.all(from t <span class="keyword">in</span> Tag, <span class="symbol">where:</span> t.name <span class="keyword">in</span> ^params[<span class="string">&quot;tags&quot;</span>])</span><br><span class="line"></span><br><span class="line">user</span><br><span class="line">|&gt; Repo.preload(<span class="symbol">:tags</span>)</span><br><span class="line">|&gt; Ecto.Changeset.cast(params)</span><br><span class="line">|&gt;  Ecto.Changeset.put_assoc(<span class="symbol">:tags</span>, tags)</span><br></pre></td></tr></table></figure><h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><h5 id="Build-Assoc"><a href="#Build-Assoc" class="headerlink" title="Build_Assoc"></a>Build_Assoc</h5><p>Gen an instance with foreign key</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">iex&gt; post = Ecto.build_assoc(user, :posts, %&#123;header: <span class="string">&quot;Clickbait header&quot;</span>, body: <span class="string">&quot;No real contet&quot;</span>&#125;)</span><br><span class="line">%EctoAssoc.Post&#123;__meta__: <span class="comment">#Ecto.Schema.Metadata&lt;:built, &quot;posts&quot;&gt;,</span></span><br><span class="line">  body: <span class="string">&quot;No real content&quot;</span>, header: <span class="string">&quot;Clickbait header&quot;</span>, id: nil,</span><br><span class="line">  user: <span class="comment">#Ecto.Association.NotLoaded&lt;association :user is not loaded&gt;, user_id: 1&#125;</span></span><br><span class="line"></span><br><span class="line">iex&gt; Repo.insert!(post)</span><br></pre></td></tr></table></figure><h5 id="Put-Assoc-1"><a href="#Put-Assoc-1" class="headerlink" title="Put_Assoc"></a>Put_Assoc</h5><p>Add association to changeset which is not persisted</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iex&gt; post_changeset = Ecto.Changeset.change(post)</span><br><span class="line">iex&gt; post_with_tags = Ecto.Changeset.put_assoc(post_changeset, :tags, [misc_tag])</span><br><span class="line">iex&gt; Repo.insert!(post_with_tags)</span><br></pre></td></tr></table></figure><h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h3><p><code>cast_assoc</code> when you want to cast external parameters, like the ones from a form, into an association.</p><p><code>put_assoc</code> when you already have an <strong>association struct</strong></p><p><code>build_assoc</code> receive an existing struct(for example <code>user</code>), that was persisted to the database, and builds a struct(for example <code>post</code>, based on its association(for example <code>:posts</code>), with the foreign key field(for example <code>user_id</code>).</p>]]></content>
      
      
      
        <tags>
            
            <tag> Elixir </tag>
            
            <tag> Ecto </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Introduction to Object.getOwnPropertyDescriptors</title>
      <link href="/2018/04/14/Introduction-to-Object-getOwnPropertyDescriptors/"/>
      <url>/2018/04/14/Introduction-to-Object-getOwnPropertyDescriptors/</url>
      
        <content type="html"><![CDATA[<h3 id="Object-getOwnPropertyDescriptors"><a href="#Object-getOwnPropertyDescriptors" class="headerlink" title="Object.getOwnPropertyDescriptors"></a>Object.getOwnPropertyDescriptors</h3><p>This method returns all properties including <code>getter</code> and <code>setter</code>.</p><p><code>Object.assign</code> shallow copies all the properties excluding <code>getter</code> and <code>setter</code> of the original source object.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> car = &#123;</span><br><span class="line">  name: <span class="string">&#x27;BMW&#x27;</span>,</span><br><span class="line">  price: <span class="number">100000</span>,</span><br><span class="line">  get discount () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.d</span><br><span class="line">  &#125;</span><br><span class="line">  set discount (x) &#123;</span><br><span class="line">    <span class="built_in">this</span>.d = x</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.getOwnPropertyDescriptor(car, <span class="string">&#x27;discount&#x27;</span>) <span class="comment">// &#123;get, set, enumerable, configurable&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> assignedCar = <span class="built_in">Object</span>.assign(&#123;&#125;, car)</span><br><span class="line"><span class="built_in">Object</span>.getOwnPropertyDescriptor(assignedCar, <span class="string">&#x27;discount&#x27;</span>) <span class="comment">// &#123;value: undefined&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> definedCar = <span class="built_in">Object</span>.defineProperties(&#123;&#125;, <span class="built_in">Object</span>.getOwnPropertyDescriptors(car))</span><br><span class="line"><span class="built_in">Object</span>.getOwnPropertyDescriptor(definedCar, <span class="string">&#x27;discount&#x27;</span>) <span class="comment">// &#123;get, set, enumerable, configurable&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Enable Sass/scss in Phoenix</title>
      <link href="/2018/04/06/enable-sass-scss-in-phoenix/"/>
      <url>/2018/04/06/enable-sass-scss-in-phoenix/</url>
      
        <content type="html"><![CDATA[<h1 id="Step-1-Add-brunch"><a href="#Step-1-Add-brunch" class="headerlink" title="Step 1: Add brunch"></a>Step 1: Add brunch</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> assets &amp;&amp; yarn add sass-brunch</span><br></pre></td></tr></table></figure><h1 id="Step-2-Add-plugin-in-brunch-config-js"><a href="#Step-2-Add-plugin-in-brunch-config-js" class="headerlink" title="Step 2: Add plugin in brunch-config.js"></a>Step 2: Add plugin in brunch-config.js</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// brunch-config.js</span></span><br><span class="line">plugins: &#123;</span><br><span class="line">  sass: &#123;</span><br><span class="line">    mode: <span class="string">&#x27;native&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Step3-Enable-hot-reload"><a href="#Step3-Enable-hot-reload" class="headerlink" title="Step3: Enable hot-reload"></a>Step3: Enable hot-reload</h1><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/<span class="regexp">/ dev.exs</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ add sass and scss to the pattern</span></span><br><span class="line"><span class="regexp">config :citaDappStore, CitaDappStoreWeb.Endpoint,</span></span><br><span class="line"><span class="regexp">  live_reload: [</span></span><br><span class="line"><span class="regexp">    patterns: [</span></span><br><span class="line"><span class="regexp">      ~r&#123;priv/static</span><span class="regexp">/.*(js|css|png|jpeg|jpg|gif|svg|sass|scss)$&#125;,</span></span><br><span class="line"><span class="regexp">      ~r&#123;priv/gettext</span><span class="regexp">/.*(po)$&#125;,</span></span><br><span class="line"><span class="regexp">      ~r&#123;lib/cita</span>DappStore_web/views/.*(ex)<span class="variable">$&#125;</span>,</span><br><span class="line">      <span class="string">~r&#123;lib/citaDappStore_web/templates/.*(eex)$&#125;</span></span><br><span class="line">    ]</span><br><span class="line">  ]</span><br></pre></td></tr></table></figure><p>That’s all.</p>]]></content>
      
      
      
        <tags>
            
            <tag> Phoenix </tag>
            
            <tag> Elixir </tag>
            
            <tag> SCSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Model Generator of Rails</title>
      <link href="/2018/03/14/Model-Generator-of-Rails/"/>
      <url>/2018/03/14/Model-Generator-of-Rails/</url>
      
        <content type="html"><![CDATA[<p><a href="https://railsguides.net/advanced-rails-model-generators/">Original</a></p><h3 id="Basic-Usage"><a href="#Basic-Usage" class="headerlink" title="Basic Usage"></a>Basic Usage</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rails g model User email</span><br></pre></td></tr></table></figure><p>This command will generate user model with email field type of string, migration which creates user table, test for model and factory.</p><p>If you want to have model with different type of string pass type after field name following by <code>:</code>.</p><p>The whole list of available types:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">integer</span><br><span class="line">primary_key</span><br><span class="line">decimal</span><br><span class="line">float</span><br><span class="line">boolean</span><br><span class="line">binary</span><br><span class="line">string</span><br><span class="line">text</span><br><span class="line">date</span><br><span class="line">time</span><br><span class="line">datetime</span><br><span class="line">timestamp</span><br></pre></td></tr></table></figure><p>You are able to pass -option parameter to generator. It will inherit generating class from passed name to achieve STI(Single Table Inheritance):</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rails g model admin --parent user</span><br></pre></td></tr></table></figure><p>This example generates model:</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Admin</span> &lt; User</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>Interesting fact that if you generate model in some scope passing model like <em>admin/user</em> of <em>Admin::User</em>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rails g model admin/user</span><br></pre></td></tr></table></figure><p>you will get generated model in scope <code>app/models/admin/user.rb</code>, defined scope <code>app/models/admin.rb</code> which is required to define module.</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">module</span> <span class="title">Admin</span></span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">table_name_prefix</span></span></span><br><span class="line">   <span class="string">&#x27;admin_&#x27;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>It means that generated table name for <em>Admin::User</em> starts with prefix _admin_user_. This feature allows to have seperated namespaced models as in rails code as in db schema.</p><h3 id="Advantage-useage"><a href="#Advantage-useage" class="headerlink" title="Advantage useage"></a>Advantage useage</h3><p>Sometimes you have to automatically add index for columns in your migration. It’s not a problem.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rails g model user email:index location_id:<span class="built_in">integer</span>:index</span><br></pre></td></tr></table></figure><p>Or uniq index</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rails g model user pseudo:string:uniq</span><br></pre></td></tr></table></figure><p>Set limit for field of integer, string, text and binary fields</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rails g model product <span class="string">&#x27;price:decimal&#123;10,2&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>The last useful feature of generators - it’s options to generate reference columns (fields which are used in rails as foreign_key)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rails g model photo album:references</span><br></pre></td></tr></table></figure><p>This command will generate photos table with integer field _album_id_ and also it will add index for this field automatically.</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CreatePhotos</span> &lt; ActiveRecord::Migration</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">change</span></span></span><br><span class="line">    create_table <span class="symbol">:photos</span> <span class="keyword">do</span> <span class="params">|t|</span></span><br><span class="line">      t.references <span class="symbol">:album</span></span><br><span class="line"></span><br><span class="line">      t.timestamps</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    add_index <span class="symbol">:photos</span>, <span class="symbol">:album_id</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Ruby </tag>
            
            <tag> Rails </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Error Handling in Solidity</title>
      <link href="/2018/03/13/Error-Handling-in-Solidity/"/>
      <url>/2018/03/13/Error-Handling-in-Solidity/</url>
      
        <content type="html"><![CDATA[<p>Solidity uses state-reverting exceptions to handle errors. Such an exception will undo all changes made to the state in the current call(and all its sub-calls) and also flag an error to the caller. The convenience function <code>assert</code> and <code>require</code> can be used to check for conditions and throw an exception if the condition is not met.</p><p>The <code>assert</code> function should only be used to test for internal errors, and to check invariants.</p><p>The <code>require</code> function should be used to ensure valid conditions, such as inputs, or contract state variables are met, or to validate return values from calls to external contracts.</p><p>If used properly, analysis tools can evaluate your contract to identify the conditions and function calls which will reach a failing <code>assert</code>. Properly functioning code should never reach a failing assert statement. If this happens there is a bug in your contract which you should fix.</p><p>There are two ways to trigger exceptions:</p><ul><li><p>The <code>revert</code> function can be used to flag an error and revert the current call. In the future, it might be possible to also include details about error in a call to <code>revert</code>.</p></li><li><p>The <code>throw</code> keyword can also be used as an alternative to <code>revert()</code></p></li></ul><blockquote><p>From 0.4.13, the <code>throw</code> is deprecated.</p></blockquote><p>When exceptions happen in a sub-call, they ‘bubble up’ automatically. Exceptions to this rule are <code>send</code> and the low-level functions <code>call</code>, <code>delegatecall</code> and <code>callcode</code> – those return <code>false</code> in case of an exception instead of ‘bubble up’.</p><blockquote><p>low-level function <code>call</code>, <code>delegatecall</code>, <code>callcode</code> return false when exceptions occur.</p></blockquote><p>Catch exceptions is not yet possible.</p>]]></content>
      
      
      
        <tags>
            
            <tag> Solidity </tag>
            
            <tag> Error Handling </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Start in Drizzle </title>
      <link href="/2018/03/13/Start-in-Drizzle/"/>
      <url>/2018/03/13/Start-in-Drizzle/</url>
      
        <content type="html"><![CDATA[<p>Drizzle is a collection of front-end libraries that make wirting dapp front-ends easier and more predicable. The core of Drizzle is based on Redux Store, so you can access to the spectacular development tools around Redux. We take care of synchronizing your contract data, transaction data and more. Things stay fast because you declare what to keep in sync.</p><ul><li><p>Fully reactive contract data, including state, events and transactions</p></li><li><p>Declarative, so you’re not wasting valuable cycles on unneeded data.</p></li><li><p>Maintainer access to underlying functionaliy. Web3 and your contract’s methods are still there, untouched.</p></li></ul><h3 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add drizzle</span><br></pre></td></tr></table></figure><p>If use React you can use <a href="https://github.com/trufflesuite/drizzle-react">drizzle-react</a> and (optionally) its companion <a href="https://github.com/trufflesuite/drizzle-react-components">drizzle-react-components</a></p><blockquote><p>Drizzle uses web3 1.0 and web sockets, be sure your development environment can support these.</p></blockquote><ol><li>Import the provider</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Drizzle, generateStore &#125; <span class="keyword">from</span> <span class="string">&#x27;drizzle&#x27;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>Create an <code>options</code> object and pass in the desired contract artifacts for Drizzle to instantiate. Other options are available, just keep going on.</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// import contract</span></span><br><span class="line"><span class="keyword">import</span> SimpleStorage <span class="keyword">from</span> <span class="string">&#x27;./../build/contracts/SimpleStorage.json&#x27;</span></span><br><span class="line"><span class="keyword">import</span> TutorialToken <span class="keyword">from</span> <span class="string">&#x27;./../build/contracts/TutorialToken.json&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> options = &#123;</span><br><span class="line">  contracts: [</span><br><span class="line">    SimpleStorage</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> drizzleStore = generateStore(<span class="built_in">this</span>.props.options)</span><br><span class="line"><span class="keyword">const</span> drizzle = <span class="keyword">new</span> Drizzle(<span class="built_in">this</span>.props.options, drizzleStore)</span><br></pre></td></tr></table></figure><h3 id="Contract-Interaction"><a href="#Contract-Interaction" class="headerlink" title="Contract Interaction"></a>Contract Interaction</h3><p>Drizzle provides helpful methods on top of the default web3 Contract methods to keep you calls and transactions in sync with the store.</p><h4 id="cacheCall"><a href="#cacheCall" class="headerlink" title="cacheCall()"></a>cacheCall()</h4><p>Gets contract data. Calling the <code>cacheCall()</code> function on a contract will execute the desired call and return a <strong>corresponding key</strong> so the data can be retrieved from the store.</p><p>When a new block is received, Drizzle will refresh the store automatically <em>if</em> any transactions in the block touched our contract.</p><blockquote><p>Note: We have to check that Drizzle is <strong>initialized before fetching data</strong>. A simple if statement such as below is fine for display a few pieces of data, but a better approach for larger dapps is to use a <code>loading component</code>. Drizzle built one in <code>drizzle-react-component</code> as well.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Assuming we&#x27;re observing the store for changes</span></span><br><span class="line"><span class="keyword">var</span> state = drizzle.store.getState()</span><br><span class="line"></span><br><span class="line"><span class="comment">// If Drizzle is initialized (and therefore web3, accounts, and contracts ), continue</span></span><br><span class="line"><span class="keyword">if</span> (state.drizzleStatus.initialized) &#123;</span><br><span class="line">  <span class="comment">// Declare this call to be cached and synchornized. We&#x27;ll receive the store key for recall</span></span><br><span class="line">  <span class="keyword">const</span> dataKey = drizzle.contracts.SimpleStorage.methods.storedData.cacheCall()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Use the dataKey to display data from the store</span></span><br><span class="line">  <span class="keyword">return</span> state.contracts.SimpleStorage.methods.storedData[dataKey].value</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// If Drizzle isn&#x27;t initialized, display some loading indication</span></span><br><span class="line"><span class="keyword">return</span> <span class="string">&#x27;loading&#x27;</span></span><br></pre></td></tr></table></figure><p>The Contract instance has all of its standard web3 properties and methods. For example, you could still call as normal if you don’t want something in the store:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drizzle.contracts.SimpleStorage.methods.storedData().call() <span class="comment">// different from methods.storedData.cacheCall()</span></span><br></pre></td></tr></table></figure><h3 id="cacheSend"><a href="#cacheSend" class="headerlink" title="cacheSend()"></a>cacheSend()</h3><p>Sends a contract transaction. Calling the <code>cacheSend()</code> function on a contract will send the desired transaction and return a correnponding hash so the status can be retrieved from the store. The last argument can optionally be an options object with the typical <strong>from, gas, gasPrice</strong> keys. Drizzle will update the transaction’s state in the store(pending, success, error) and store the transaction receipt.</p><blockquote><p>Note: We have to check that Drizzle is initialized before fetching data. A simple if statement such as below is fine for display a few pieces of data, but a better approach for larger dapps is to use a loading component.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Assuming we&#x27;re observing the store of changes</span></span><br><span class="line"><span class="keyword">var</span> state = drizzle.store.getState()</span><br><span class="line"></span><br><span class="line"><span class="comment">// if Drizzle is initialized ( and therefore web3, accounts, and contracts ), continue</span></span><br><span class="line"><span class="keyword">if</span> (state.drizzleStatus.initialized) &#123;</span><br><span class="line">  <span class="comment">// Declare this transaction to be observed. We&#x27;ll receive the stackId of reference.</span></span><br><span class="line">  <span class="keyword">const</span> stackId = drizzle.contracts.SimpleStorage.methods.set.cacacheSend(<span class="number">2</span>, &#123;<span class="attr">from</span>: <span class="string">&#x27;0x3f...&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Use the dataKey to display the transaction status</span></span><br><span class="line">  <span class="keyword">if</span> (state.transactionStack[stackId]) &#123;</span><br><span class="line">    <span class="keyword">const</span> txHash = state.trasnactionStack[stackId]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> state.transactions[txHash].status</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// If Drizzle isn&#x27;t initialized, display some loading indication.</span></span><br><span class="line"><span class="keyword">return</span> <span class="string">&#x27;loading&#x27;</span></span><br></pre></td></tr></table></figure><p>The contract instance has all of its standard web3 properties and methods.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drizzle.contracts.SimpleStorage.methods.set(<span class="number">2</span>).send(&#123;<span class="attr">from</span>: <span class="string">&#x27;0x3f...&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure><h3 id="Options"><a href="#Options" class="headerlink" title="Options"></a>Options</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  contracts,</span><br><span class="line">  events: &#123;</span><br><span class="line">    contractsName: [</span><br><span class="line">      eventName</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  web3: &#123;</span><br><span class="line">    fallback: &#123;</span><br><span class="line">      type</span><br><span class="line">      url</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>Contracts: Array, Required, an array of contract artifacts files</p></li><li><p>Events: Object, an object consisting of contract names each containing an array of strings of the event names we’d like to listen for and sync with the store</p></li><li><p>Web3: Object, options regarding web3 instantiation</p></li><li><p>Fallback: Object, an object consisting of the type and url of a fallback web3 provider. This is used if no injected provider, such as MetaMask or Mist, is detect.</p><ul><li><p>type: string, the type of web3 fallback, currently <code>ws</code> is the only possibility</p></li><li><p>url: string, the full websocket url. For example, <code>ws://127.0.0.1:8546</code></p></li></ul></li></ul><h3 id="How-data-stays-fresh"><a href="#How-data-stays-fresh" class="headerlink" title="How data stays fresh"></a>How data stays fresh</h3><ol><li>Once initialized, Drizzle instantiates <code>web3</code> and our desired contracts, then observes the chain by subscribing to new block headers</li></ol><p><img src="https://github.com/trufflesuite/drizzle/blob/master/readme/drizzle-sync1.png?raw=true"></p><ol start="2"><li>Drizzle keeps track of contract calls so it knows what to synchronize</li></ol><p><img src="https://github.com/trufflesuite/drizzle/blob/master/readme/drizzle-sync2.png?raw=true"></p><ol start="3"><li>When a new block header comes in, Drizzle checks that the block isn’t pending, then goes through the transactions looking to see if any of them touched our contracts</li></ol><p><img src="https://github.com/trufflesuite/drizzle/blob/master/readme/drizzle-sync3.png?raw=true"></p><ol start="4"><li>If they did, we replay the calls already in the store to refresh any potentially altered data. If they didn’t we continue with the store data.</li></ol><p><img src="https://github.com/trufflesuite/drizzle/blob/master/readme/drizzle-sync4.png?raw=true"></p>]]></content>
      
      
      
        <tags>
            
            <tag> Ethereum </tag>
            
            <tag> Blockchain </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Constant, View, and Pure in Solidity</title>
      <link href="/2018/03/12/Constant-View-and-Pure-in-Solidity/"/>
      <url>/2018/03/12/Constant-View-and-Pure-in-Solidity/</url>
      
        <content type="html"><![CDATA[<h3 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h3><ul><li><p><code>pure</code> for functions: Disallows modifition or access of state - this is not enforeced yet.</p></li><li><p><code>view</code> for functions: Disallow modifition of state - this is not enforced yet.</p></li><li><p><code>payable</code> for functions: Allows them to receive Ether together with a call.</p></li><li><p><code>constant</code> for <strong>state variables</strong>: Disallow assignment (except initialization), does not occupy storage slot.</p></li><li><p><code>anonymouse</code> for <strong>events</strong>: Does not store event signature as <strong>topic</strong>(indexable).</p></li><li><p><code>indexed</code> for <strong>event parameters</strong>: Stores the parameter as <strong>topic</strong>(indexable).</p></li></ul><p><a href="https://ethereum.stackexchange.com/questions/25200/solidity-what-is-the-difference-between-view-and-constant">Question</a></p><blockquote><p>Q: Solidity 0.4.16 introduced the <code>view</code> and <code>constant</code> function modifiers. <a href="http://solidity.readthedocs.io/en/latest/miscellaneous.html#modifiers">The documentation</a> says:</p></blockquote><blockquote><p>constant for functions: Same as view</p></blockquote><blockquote><p>Does this mean <code>view</code> is just an alias for <code>constant</code>?</p></blockquote><p>Answer: This is discussed <a href="https://github.com/ethereum/solidity/issues/992">here</a></p><ol><li><p>The keyword <code>view</code> is introduced for functions (it replaces constant). Calling a view cannot alter the behavior of future interaction with any contract. This means such functions cannot use <code>SSTORE</code>, cannot <code>send</code> or <code>receive</code> ether and can only call other <code>view</code> or <code>pure</code> functions.</p></li><li><p>The keyword <code>pure</code> is introduced for functions, they are view functions with the additional restriction that their value only depends on the function arguments(pure function). This means they cannot use <code>SSTORE</code>, <code>SLOAD</code>, cannot <code>send</code> or <code>receive</code> ether, cannot use <code>msg</code> or <code>block</code> and can only call other <code>pure</code> function.</p></li><li><p>The keyword <code>constant</code> is <strong>invalid</strong> on functions</p></li><li><p>The keyword <code>constant</code> on any variable means it cannot be modified (and could be placed into memory or bytecode by the optimiser)</p></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> Solidity </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Writing Upgradable Contracts in Solidity</title>
      <link href="/2018/03/05/Writing-Upgradable-Contracts-in-Solidity/"/>
      <url>/2018/03/05/Writing-Upgradable-Contracts-in-Solidity/</url>
      
        <content type="html"><![CDATA[<p><a href="https://blog.colony.io/writing-upgradeable-contracts-in-solidity-6743f0eecc88">Original</a></p><p>Ethereum contracts are immutable – once deployed to the blockchain they cannot be updated, yet the need to change their logic with time is ultimately necessary.</p><p>During a contract upgrade the following factors need to be considered:</p><ul><li><p>Block gas limit(4712388 for Homestead)</p><p>Upgrade transaction tend to be large due to the amount of processing they have to complete e.g. <em>deploy a contract, move data, move references</em>.</p></li><li><p>Inter-contract dependencies</p><p><em>when a contract is compiled, all of its imports are compiled into the contract thus leading to a ripple effect when you want to swap out a contract which is being referenced by other contract</em>.</p></li></ul><p>These two are related, as having more dependencies affects the size of your deployed contracts and the overall transaction size of the upgrade. The implementation patterns below work to <em>minimise the upgrade gas costs as well as loosening the coupling of contracts without breaking Solidity type safety</em>.</p><p>Note that for the sake of simplying the examples, we have omitted the implementation of security and permission.</p><h3 id="Avoiding-large-data-copy-operations"><a href="#Avoiding-large-data-copy-operations" class="headerlink" title="Avoiding large data copy operations"></a>Avoiding large data copy operations</h3><p>Storing data is expensive(<code>SSTORE</code> operation costs 5000 or 20000 gas) and upgrading contracts containing large storage variables runs the chance of hitting the transaction gas limit during the copying of its data.</p><p><strong>You may therefore want to isolate your datastore from the rest of your code, and make it as flexible as possible, so that it is unlikely to need to be upgrade.</strong></p><p>Depending on your circumstances, how large of a datastore you need and whether you expect its structure to change often, you may choose a strict definition or a loosely typed flat store. Below is an example of the latter which implements support for storing a <em>sha3</em> key and value pairs. It is the more flexible and extensible option. This ensures data schema changes can be implemented without requiring upgrades to the storage contract.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">contract EternalStorage &#123;</span><br><span class="line">  mapping(<span class="function"><span class="params">bytes32</span> =&gt;</span> uint) UIntStorage;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getUIntValue</span>(<span class="params">bytes32 record</span>) <span class="title">constant</span> <span class="title">returns</span> (<span class="params">uint</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> UIntStorage[record];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setUIntValue</span>(<span class="params">bytes32 record, uint value</span>) </span>&#123;</span><br><span class="line">    UIntStorage[record] = value;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  mapping(<span class="function"><span class="params">bytes32</span> =&gt;</span> string) StringStorage;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getStringValue</span>(<span class="params">bytes32 record</span>) <span class="title">constant</span> <span class="title">returns</span> (<span class="params">string</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> StringStorage(record);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setStringValue</span>(<span class="params">bytes32 record, string value</span>) </span>&#123;</span><br><span class="line">    StringStorage[record] = value;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  mapping(<span class="function"><span class="params">bytes32</span> =&gt;</span> address) AddressStorage;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getAddressValue</span>(<span class="params">bytes32 record</span>) <span class="title">constant</span> <span class="title">returns</span> (<span class="params">address</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> AddressStorage[record];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setAddressValue</span>(<span class="params">bytes32 record, address value</span>) </span>&#123;</span><br><span class="line">    AddressStorage[record] = value;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  mapping(<span class="function"><span class="params">bytes32</span> =&gt;</span> bytes) BytesStorage;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getBytesValue</span>(<span class="params">bytes32 record</span>) <span class="title">constant</span> <span class="title">returns</span> (<span class="params">bytes</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> BytesStorage[record];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setBytesValue</span>(<span class="params">bytes32 record, bytes value</span>) </span>&#123;</span><br><span class="line">    BytesStorage[record] = value;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  mapping (<span class="function"><span class="params">bytes32</span> =&gt;</span> bool) BooleanStorage;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getBooleanValue</span>(<span class="params">bytes32 record</span>) <span class="title">constant</span> <span class="title">returns</span> (<span class="params">bool</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> BooleanStorage[record];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setBooleanValue</span>(<span class="params">bytes32 record, bool value</span>) </span>&#123;</span><br><span class="line">    BooleanStorage[record] = value;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  mapping (<span class="function"><span class="params">bytes32</span> =&gt;</span> int) IntStorage;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getIntValue</span>(<span class="params">bytes32 record</span>) <span class="title">constant</span> <span class="title">returns</span> (<span class="params">int</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> IntStorage[record];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setIntValue</span>(<span class="params">bytes32 record, int value</span>) </span>&#123;</span><br><span class="line">    IntStorage[record] = value;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>For upgrades you can then just switch the upgraded contract to point to the new EternalStorage contract instance without having a copy of its data.</p><h3 id="Use-Libraries-to-Encapsulate-Logic"><a href="#Use-Libraries-to-Encapsulate-Logic" class="headerlink" title="Use Libraries to Encapsulate Logic"></a>Use Libraries to Encapsulate Logic</h3><p>Libraries are special form of contracts that are singletons and not allowed any storage variables.</p><p>The advantage of libraries in the context of upgrades is that they allow encapsulation of business logic or data management logic into singleton instance that cost only upgrading one and not many contracts.</p><p>Example below shows a library used for adding a <em>Proposal</em> to storage.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;EternalStorage.sol&quot;</span>;</span><br><span class="line"></span><br><span class="line">library ProposalsLibrary &#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getProposalCount</span>(<span class="params">address _storageContract</span>) <span class="title">constant</span> <span class="title">returns</span> (<span class="params">uint256</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> EternalStorage(_storageContract).getUIntValue(sha3(<span class="string">&quot;proposalCount&quot;</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">addProposal</span>(<span class="params">address _storageContract, bytes32 _name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> idx = getProposalCount(_storageContract);</span><br><span class="line">    EternalStorage(_storageContract).setBytes32Value(sha3(<span class="string">&quot;proposal_name&quot;</span>, idx), _name);</span><br><span class="line">    EternalStorage(_storageContract).setUIntValue(sha3(<span class="string">&quot;proposal_eth&quot;</span>, idx), <span class="number">0</span>);</span><br><span class="line">    EternalStorage(_storageContract).setUIntValue(sha3(<span class="string">&quot;ProposalCount&quot;</span>), idx + <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Under the cover, library functions are called using <code>delegatecall</code> from the calling contract which has the advantage of passing the <code>msg.sender</code> and <code>msg.value</code> seamlessly. You can therefore write your library code as if it were just part of your contract, without having to worry about the sender or value chagning.</p><p>The example below shows a sample <code>Organization</code> contract using <code>ProposalsLibrary</code> to interact with data storage.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;ProposalsLibrary.sol&quot;</span>;</span><br><span class="line"></span><br><span class="line">contract Organization &#123;</span><br><span class="line">  using ProposalsLibrary <span class="keyword">for</span> address;</span><br><span class="line">  address public eternalStorage;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">Organization</span>(<span class="params">address _eternalStorage</span>) </span>&#123;</span><br><span class="line">    eternalStorage = _eternalStorage;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">addProposal</span>(<span class="params">bytes32 _name</span>) </span>&#123;</span><br><span class="line">    eternalStorage.addProposal(_name);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>With libraries, there is a slight gas overhead on each call. However, it makes deploying a new contract much cheaper.</p><h3 id="Use-‘interface’-to-decouple-inter-contract-communication"><a href="#Use-‘interface’-to-decouple-inter-contract-communication" class="headerlink" title="Use ‘interface’ to decouple inter-contract communication"></a>Use ‘interface’ to decouple inter-contract communication</h3><p>Abstract Contract implementation behind an interface that only define its function siguatures.</p><p>This is a well known pattern in object oriented programming.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;ITokenLedger.sol&quot;</span>;</span><br><span class="line"></span><br><span class="line">contract Organization &#123;</span><br><span class="line">  ITokenLedger public tokenLedger;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">Organization</span>(<span class="params">address _tokenLedger</span>) </span>&#123;</span><br><span class="line">    tokenLedger = ITokenLedger(_tokenLedger);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">generateToekns</span>(<span class="params">uint256 _amount</span>) </span>&#123;</span><br><span class="line">    tokenLedger.generateTokens(_amount);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Here instead of importing the entire <code>TokenLedger.sol</code> contract, we use an interface containing just the function signatures. This eases any possible upgrades to TokenLedger which don’t affect its interface, too, which with this model can be implemented without redeploying the Organization contract.</p>]]></content>
      
      
      
        <tags>
            
            <tag> Ethereum </tag>
            
            <tag> Blockchain </tag>
            
            <tag> Smart Contract </tag>
            
            <tag> Solidity </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockerizing a React App</title>
      <link href="/2018/02/28/Dockerizing-a-React-App/"/>
      <url>/2018/02/28/Dockerizing-a-React-App/</url>
      
        <content type="html"><![CDATA[<p><a href="http://mherman.org/blog/2017/12/07/dockerizing-a-react-app/">Original</a></p><h3 id="Project-Setup"><a href="#Project-Setup" class="headerlink" title="Project Setup"></a>Project Setup</h3><p>Install <code>create-react-app</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g create-react-app@1.5.2</span><br></pre></td></tr></table></figure><p>Creating a new app</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">create-react-app docker-app</span><br><span class="line"><span class="built_in">cd</span> docker-app</span><br></pre></td></tr></table></figure><h3 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h3><p>Add a <code>Dockerfile</code> to the project root</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># base image</span><br><span class="line">FROM node:9.6.1</span><br><span class="line"></span><br><span class="line"># set working directory</span><br><span class="line">RUN mkdir &#x2F;usr&#x2F;src&#x2F;app</span><br><span class="line">WORKDIR &#x2F;usr&#x2F;src&#x2F;app</span><br><span class="line"></span><br><span class="line"># add &#96;&#x2F;usr&#x2F;src&#x2F;app&#x2F;node_modules&#x2F;.bin&#96; to $PATH</span><br><span class="line">ENV PATH &#x2F;usr&#x2F;src&#x2F;app&#x2F;node_modules&#x2F;.bin:$PATH</span><br><span class="line"></span><br><span class="line"># install and cache app dependencies</span><br><span class="line">COPY package.json &#x2F;usr&#x2F;src&#x2F;app&#x2F;package.json</span><br><span class="line">RUN npm install</span><br><span class="line">RUN npm install react-scripts@1.1.1 -g</span><br><span class="line"></span><br><span class="line"># start app</span><br><span class="line">CMP [&quot;npm&quot;, &quot;start&quot;]</span><br></pre></td></tr></table></figure><p>Add a <code>.dockerignore</code> to speed up the Docker build process as our local dependencies will not be sent to the Docker Daemon</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node_modules</span><br></pre></td></tr></table></figure><p>Build and tag the Docker Image</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t docker-app:1.0.0</span><br></pre></td></tr></table></figure><p>Then spin up the container once the image is built.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -v <span class="variable">$&#123;PWD&#125;</span>:/usr/src/app -v /usr/src/app/node_modules -p 3000:3000 --rm docker-app:1.0.0</span><br></pre></td></tr></table></figure><p>Now you can visit your app <code>http://localhost:3000</code></p><h3 id="Docker-Compose"><a href="#Docker-Compose" class="headerlink" title="Docker Compose"></a>Docker Compose</h3><p>Add a <code>docker-compose.yml</code> to the project root.</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.3&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">docker-app:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">docker-app</span></span><br><span class="line">    <span class="attr">build:</span></span><br><span class="line">      <span class="attr">context:</span> <span class="string">.</span></span><br><span class="line">      <span class="attr">dockerfile:</span> <span class="string">Dockerfile</span></span><br><span class="line">    <span class="attr">volumnes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;.:/usr/src/app&#x27;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;/usr/src/app/node_modules&#x27;</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;3000:3000&#x27;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">NODE_ENV=development</span></span><br></pre></td></tr></table></figure><p>Take note of the volumes. Without the data volume <code>/usr/src/app/node_modules</code>, the <code>node_modules</code> directory would be overwritten by the mounting of the host directory at runtime that were installed when the container was built.</p><p>BUild the image and fire up the container</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d --build</span><br></pre></td></tr></table></figure><p>Ensure the app is running in the browser.</p><p>Bring down the container before moving on</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose stop</span><br></pre></td></tr></table></figure><h3 id="Production"><a href="#Production" class="headerlink" title="Production"></a>Production</h3><p>Let’s create a seperate <code>Dockerfile</code> for use in production called <code>Dockerfile-prod</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># build environment</span><br><span class="line">FROM node:9.6.1 as builder</span><br><span class="line">RUN mkdir &#x2F;usr&#x2F;src&#x2F;app</span><br><span class="line">WORKDIR &#x2F;usr&#x2F;src&#x2F;app</span><br><span class="line">ENV PATH &#x2F;usr&#x2F;src&#x2F;app&#x2F;node_moudles&#x2F;.bin:$PATH</span><br><span class="line">COPY package.json &#x2F;usr&#x2F;src&#x2F;app&#x2F;package.json</span><br><span class="line">RUN npm install</span><br><span class="line">RUN npm install react-scripts@1.1.1 -g</span><br><span class="line">COPY . &#x2F;usr&#x2F;src&#x2F;app</span><br><span class="line">RUN npm run build</span><br><span class="line"></span><br><span class="line"># production environment</span><br><span class="line">FROM nginx:1.13.9-alpine</span><br><span class="line">COPY --from&#x3D;builder &#x2F;usr&#x2F;src&#x2F;app&#x2F;build &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html</span><br><span class="line">EXPOSE 80</span><br><span class="line">CMD [&quot;nginx&quot;,&quot;-g&quot;,&#39;deamon off;&quot;]</span><br></pre></td></tr></table></figure><p>Using the production Dockerfile, build and tag the Docker Image:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -f Dockerfile-prod -t docker-app-prod .</span><br></pre></td></tr></table></figure><p>Spin up the container</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -p 80:80 --rm docker-app-prod</span><br></pre></td></tr></table></figure><p>Add Prod Docker Compose as `docker-compose-prod.yml’</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.3&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">docker-app-prod:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">docker-app-prod</span></span><br><span class="line">    <span class="attr">build:</span></span><br><span class="line">      <span class="attr">context:</span> <span class="string">.</span></span><br><span class="line">      <span class="attr">dockerfile:</span> <span class="string">Dockerfile-prod</span></span><br><span class="line">    <span class="attr">prots:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;80:80&quot;</span></span><br></pre></td></tr></table></figure><p>Fire up the container</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose -f docker-compose-prod.yml up -d --build</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> React </tag>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Deploy RoR With Mina</title>
      <link href="/2018/02/24/Deploy-RoR-with-Mina/"/>
      <url>/2018/02/24/Deploy-RoR-with-Mina/</url>
      
        <content type="html"><![CDATA[<h3 id="Mina-Setup"><a href="#Mina-Setup" class="headerlink" title="Mina Setup"></a>Mina Setup</h3><p>Let’s take a look at setting up Mina with Puma. First, you’ll need to add Mina and mina-puma in Gemfile.</p><p>Then install gems and execute the initial Mina Command for generating a <code>config/deploy.rb</code>.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bundle</span><br><span class="line">mina init</span><br></pre></td></tr></table></figure><h3 id="Detailed-Explanations-for-the-Mina-deploy-file"><a href="#Detailed-Explanations-for-the-Mina-deploy-file" class="headerlink" title="Detailed Explanations for the Mina deploy file"></a>Detailed Explanations for the Mina deploy file</h3><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Set the domain or ip address of the remote server.</span></span><br><span class="line">set <span class="symbol">:domain</span>, <span class="string">&#x27;yourdomain&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the folder of the remote server where Mina will deploy your app.</span></span><br><span class="line">set <span class="symbol">:deploy_to</span>, <span class="string">&#x27;path/to/directory&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set a link to the repository. Better git protocol.</span></span><br><span class="line">set <span class="symbol">:repository</span>, <span class="string">&#x27;git@...&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the name of a branch you plan to deploy as default master.</span></span><br><span class="line">set <span class="symbol">:branch</span>, <span class="string">&#x27;master&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Fill in the names of the files and directories that will be symlinks to the shared directory.</span></span><br><span class="line"><span class="comment"># All folders will be created automatically on Mina Setup.</span></span><br><span class="line"><span class="comment"># Don&#x27;t forget to add a path to the uploads folder if you are using Dragonfly or Carrierwaves.</span></span><br><span class="line"><span class="comment"># Otherwise, you will lose your uploads on each deploy.</span></span><br><span class="line">set <span class="symbol">:shared_dirs</span>, fetch(<span class="symbol">:shared_dirs</span>, []).push(<span class="string">&#x27;log&#x27;</span>, <span class="string">&#x27;tmp/pids&#x27;</span>, <span class="string">&#x27;tmp/sockets&#x27;</span>, <span class="string">&#x27;public/uploads&#x27;</span>)</span><br><span class="line">set <span class="symbol">:shared_files</span>, fetch(<span class="symbol">:shared_files</span>, []).push(<span class="string">&#x27;config/database.yml&#x27;</span>, <span class="string">&#x27;config/secrets.yml&#x27;</span>, <span class="string">&#x27;config/puma.rb&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Username of ssh for access to the remote server.</span></span><br><span class="line">set <span class="symbol">:user</span>, <span class="string">&#x27;root&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># This is not a required field, you can use it to set an app name for easy recognition.</span></span><br><span class="line">set <span class="symbol">:application_name</span>, <span class="string">&#x27;MyApp&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set ruby version. If you have RVM installed globally, you&#x27;ll also need to set an RVM path,</span></span><br><span class="line"><span class="comment"># like set:rvm_use_path, &#x27;/usr/local/rvm/scripts/rvm&#x27;.</span></span><br><span class="line"><span class="comment"># You can find the RVM location with rvm info command.</span></span><br><span class="line">task <span class="symbol">:environment</span> <span class="keyword">do</span></span><br><span class="line">  invoke <span class="symbol">:<span class="string">&#x27;rvm:use&#x27;</span></span>, <span class="string">&#x27;ruby-2.5.1@default&#x27;</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>By default, Mina will create all folders mentioned in shared_dirs and shared_files.</p><p>You deploy section in deploy.rb should look like this:</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">task <span class="symbol">:deploy</span> <span class="keyword">do</span></span><br><span class="line">  deploy <span class="keyword">do</span></span><br><span class="line">    comment <span class="string">&quot;Deploying <span class="subst">#&#123;fetch(<span class="symbol">:application_name</span>)&#125;</span> to <span class="subst">#&#123;fetch(<span class="symbol">:domain</span>)&#125;</span>:<span class="subst">#&#123;fetch(<span class="symbol">:deploy_to</span>)&#125;</span>&quot;</span></span><br><span class="line">    invoke <span class="symbol">:<span class="string">&#x27;git:clone&#x27;</span></span></span><br><span class="line">    invoke <span class="symbol">:<span class="string">&#x27;deploy:link_shared_paths&#x27;</span></span></span><br><span class="line">    invoke <span class="symbol">:<span class="string">&#x27;rvm:load_env_vars&#x27;</span></span></span><br><span class="line">    invoke <span class="symbol">:<span class="string">&#x27;bundle:install&#x27;</span></span></span><br><span class="line">    invoke <span class="symbol">:<span class="string">&#x27;rails:db_migrate&#x27;</span></span></span><br><span class="line">    command <span class="string">%&#123;<span class="subst">#&#123;fetch(<span class="symbol">:rails</span>) <span class="symbol">db:</span>seed&#125;</span>&#125;</span></span><br><span class="line">    invoke <span class="symbol">:<span class="string">&#x27;rails:assets_precompile&#x27;</span></span></span><br><span class="line">    invoke <span class="symbol">:<span class="string">&#x27;deploy:cleanup&#x27;</span></span></span><br><span class="line"></span><br><span class="line">    on <span class="symbol">:launch</span> <span class="keyword">do</span></span><br><span class="line">      invoke <span class="symbol">:<span class="string">&#x27;puma:phased_restart&#x27;</span></span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h3 id="Puma-Setup"><a href="#Puma-Setup" class="headerlink" title="Puma Setup"></a>Puma Setup</h3><p>Create or fill a puma.rb file in a config folder</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">environment <span class="string">&quot;productino&quot;</span></span><br><span class="line"></span><br><span class="line">bind <span class="string">&quot;unix:///&#123;path_to_your_app&#125;/shared/tmp/sockets/puma.sock&quot;</span></span><br><span class="line">pidfile <span class="string">&quot;/&#123;path_to_your_app&#125;/shared/tmp/pids/puma.pid&quot;</span></span><br><span class="line">state_path <span class="string">&quot;/&#123;path_to_your_app&#125;/shared/tmp/sockets/puma.state&quot;</span></span><br><span class="line">directory <span class="string">&quot;/&#123;path_to_your_app&#125;/current&quot;</span></span><br><span class="line"></span><br><span class="line">workers <span class="number">2</span></span><br><span class="line">threads <span class="number">1</span>,<span class="number">2</span></span><br><span class="line"></span><br><span class="line">daemonize <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">activate_control_app <span class="string">&#x27;unix:///&#123;path_to_your_app&#125;/shared/tmp/sockets/pumactl.sock&#x27;</span></span><br><span class="line"></span><br><span class="line">prune_bundler</span><br></pre></td></tr></table></figure><h3 id="Fill-database-yml-and-secrets-yml"><a href="#Fill-database-yml-and-secrets-yml" class="headerlink" title="Fill database.yml and secrets.yml"></a>Fill database.yml and secrets.yml</h3><h3 id="Setup-nginx"><a href="#Setup-nginx" class="headerlink" title="Setup nginx"></a>Setup nginx</h3><p>Create file myapp.conf in a <code>/nginx/etc/conf.d</code> folder with similar content.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">upstream mysite &#123;</span><br><span class="line">  server unix:&#x2F;&#x2F;&#x2F;home&#x2F;admin&#x2F;mysite&#x2F;shared&#x2F;tmp&#x2F;sockets&#x2F;puma.sock fail_timeout&#x3D;0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">  listen 80;</span><br><span class="line">  listen [::]:80;</span><br><span class="line"></span><br><span class="line">  server_name mysite.com;</span><br><span class="line">  root &#x2F;home&#x2F;admin&#x2F;mysite&#x2F;current&#x2F;public;</span><br><span class="line"></span><br><span class="line">  location ~ ^&#x2F;assets&#x2F; &#123;</span><br><span class="line">    expires max;</span><br><span class="line">    gzip_static on;</span><br><span class="line">    gzip_vary on;</span><br><span class="line">    add_header Cache-Control public;</span><br><span class="line">    break;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  location &#x2F; &#123;</span><br><span class="line">    proxy_pass http:&#x2F;&#x2F;mysite;</span><br><span class="line">    proxy_set_header Host $host;</span><br><span class="line">    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  location ~ ^&#x2F;(500|404|422).html &#123;</span><br><span class="line">    root &#x2F;home&#x2F;admin&#x2F;mysite&#x2F;current&#x2F;public;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  error_page 500 502 503 504 &#x2F;500.html;</span><br><span class="line">  error_page 404 &#x2F;404.html;</span><br><span class="line">  error_page 422 &#x2F;422.html;</span><br><span class="line"></span><br><span class="line">  client_max_body_size 4G;</span><br><span class="line">  keepalive_timeout 10;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Ruby </tag>
            
            <tag> Rails </tag>
            
            <tag> RoR </tag>
            
            <tag> Mina </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>What Blockchain Came With</title>
      <link href="/2018/02/14/What-Blockchain-came-with/"/>
      <url>/2018/02/14/What-Blockchain-came-with/</url>
      
        <content type="html"><![CDATA[<p><a href="http://naotu.baidu.com/file/1d400c82d65cd3fd530ffc55d8eb3783?token=5e57783dc51b3617">MindMap</a></p><embed src="http://naotu.baidu.com/file/1d400c82d65cd3fd530ffc55d8eb3783?token=5e57783dc51b3617" width="100%" height="30vh">]]></content>
      
      
      
        <tags>
            
            <tag> Blockchain </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ethereum + IPFS</title>
      <link href="/2018/02/14/Ethereum-IPFS/"/>
      <url>/2018/02/14/Ethereum-IPFS/</url>
      
        <content type="html"><![CDATA[<p><a href="http://naotu.baidu.com/file/2b8d146aa6314a4205c8573a7e84f834?token=c4a7105f4f935d63">MindMap</a></p><embed src="http://naotu.baidu.com/file/2b8d146aa6314a4205c8573a7e84f834?token=c4a7105f4f935d63" width="100%" height="30vh">]]></content>
      
      
      
        <tags>
            
            <tag> Ethereum </tag>
            
            <tag> Blockchain </tag>
            
            <tag> IPFS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gas Used by Public and External Function in Solidity</title>
      <link href="/2018/01/29/Gas-Used-by-Public-and-External-Function-in-Solidity/"/>
      <url>/2018/01/29/Gas-Used-by-Public-and-External-Function-in-Solidity/</url>
      
        <content type="html"><![CDATA[<p><a href="https://ethereum.stackexchange.com/questions/19380/external-vs-public-best-practices?answertab=active#tab-top">Original</a></p><p>A simple example demostrating this effect looks like this:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">contract Test &#123;</span><br><span class="line">  function test(uint[20] a) public returns (uint) &#123;</span><br><span class="line">    return a[10] * 2;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function test2(uint[20] a) external returnss (uint) &#123;</span><br><span class="line">    return a[10] * 2;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Calling each function, the <code>public</code> function uses 496 gas, while the <code>external</code> function uses 261 gas.</p><p>The difference is because in public functions, Solidity immediately copies array argument to <strong>memory</strong>, while external functions can read directly from <strong>calldata</strong>. Memory allocation is expensive, whereas reading from calldata is cheap.</p><p>The reason that <code>public</code> functions need to write all the arguments to memory is that public functions may be called internally, which is actually an entirely different process than external calls.</p><p>Internal calls are executed via jumps in the code, and array arguments are passed internally by pointers to memory. Thus, <strong>when the compiler generates the code for an internal function, that function expects its arguments to be located in memory</strong>.</p><p>For external functions, the compiler doesn’t need to allow internal calls, and so it allows arguments to be read directly from calldata, saving the copying step.</p><p>As for best practices, you should use <code>external</code> fi you expect that the function will only ever be called externally, and use public if you need to call the function internally. It almost never makes sense to use the <code>this.f()</code> pattern, as this requires a real <code>CALL</code> to be executed, which is expensive. Also, passing arrays via this method would be far more expensive than passing them internally.</p>]]></content>
      
      
      
        <tags>
            
            <tag> Ethereum </tag>
            
            <tag> Blockchain </tag>
            
            <tag> Smart Contract </tag>
            
            <tag> Solidity </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>智能合约编写注意事项</title>
      <link href="/2018/01/29/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E7%BC%96%E5%86%99%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9/"/>
      <url>/2018/01/29/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E7%BC%96%E5%86%99%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9/</url>
      
        <content type="html"><![CDATA[<p><a href="https://medium.com/loom-network/how-to-secure-your-smart-contracts-6-solidity-vulnerabilities-and-how-to-avoid-them-part-1-c33048d4d17d">原文连接</a></p><h3 id="Overflow-与-Underflow"><a href="#Overflow-与-Underflow" class="headerlink" title="Overflow 与 Underflow"></a>Overflow 与 Underflow</h3><p>Solidity 可以处理 256 位数字, 最高为 2**256 - 1, 所以对 (2 ** 256 - 1) 加 1 会导致归 0.</p><p>同理, 对 unsigned 类型 0 做减 1 运算会得到 (2**256 - 1)</p><p>测试代码如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity 0.4.18;</span><br><span class="line"></span><br><span class="line">contract OverflowUnderflow &#123;</span><br><span class="line">    uint public zero &#x3D; 0;</span><br><span class="line">    uint public max &#x3D; 2**256 - 1;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; zero will end up at  2 ** 256 - 1</span><br><span class="line">    function underflow() public &#123;</span><br><span class="line">        zero -&#x3D; 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function overflow() public &#123;</span><br><span class="line">        max +&#x3D; 1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>尽管他们同样危险, 但是在智能合约中, underflow 造成的影响更大.</p><p>比如, 账号 A 持有 X tokens, 如果他发起一笔 X + 1 tokens 的交易, 如果代码不进行校验, 则账号 A 的余额可能发生 underflow 导致余额变多.</p><p>可以引入 <strong>SafeMath Library</strong> 解决</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity 0.4.18;</span><br><span class="line"></span><br><span class="line">library SafeMath &#123;</span><br><span class="line">    function mul(uint256 a, uint256 b) internal pure returns (uint256) &#123;</span><br><span class="line">        if (a&#x3D;&#x3D;0) &#123;</span><br><span class="line">            return 0;</span><br><span class="line">        &#125;</span><br><span class="line">        uint c &#x3D; a * b;</span><br><span class="line">        assert(c &#x2F; a &#x3D;&#x3D; b);</span><br><span class="line">        return c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function div(uint256 a, uint256 b) internal pure returns (uint256) &#123;</span><br><span class="line">        uint256 c &#x3D; a &#x2F; b;</span><br><span class="line">        return c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function sub(uint256 a, uint256 b) internal pure returns (uint256) &#123;</span><br><span class="line">        assert(b &lt;&#x3D; a);</span><br><span class="line">        return a - b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function add(uint256 a, uint256 b) internal pure returns (uint256) &#123;</span><br><span class="line">        uint256 c &#x3D; a + b;</span><br><span class="line">        assert(c &gt;&#x3D; a);</span><br><span class="line">        return c;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract OverflowUnderflow &#123;</span><br><span class="line">    using SafeMath for uint;</span><br><span class="line">    uint public zero &#x3D; 0;</span><br><span class="line">    uint public max &#x3D; 2 ** 256 - 1;</span><br><span class="line"></span><br><span class="line">    function underflow() public &#123;</span><br><span class="line">        zero &#x3D; zero.sub(1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function overflow() public &#123;</span><br><span class="line">        max &#x3D; max.add(1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Visibility-与-Delegatecall"><a href="#Visibility-与-Delegatecall" class="headerlink" title="Visibility 与 Delegatecall"></a>Visibility 与 Delegatecall</h3><ul><li><p><strong>Public</strong> functions 可以被任意地址调用</p></li><li><p><strong>External</strong> functions 只能从合约外部调用</p></li><li><p><strong>Private</strong> functions 只能从合约内部调用</p></li><li><p><strong>Internal</strong> functions 允许从合约及其子合约调用</p></li></ul><p><strong>External</strong> functions 消耗的 gas 比 public 少, 因为其使用 <code>calldata</code> 而 <strong>Public</strong> 需要复制所有参数到 memory.</p><h5 id="Delegatecall"><a href="#Delegatecall" class="headerlink" title="Delegatecall"></a>Delegatecall</h5><p>引自 <a href="http://solidity.readthedocs.io/en/develop/introduction-to-smart-contracts.html?highlight=delegatecall#delegatecall-callcode-and-libraries">Solidity Docs</a></p><blockquote><p>Delegatecall is identical to a message call apart from the fact that the code at the target address is executed in the context of the calling contract and <code>msg.sender</code> and <code>msg.value</code> do not change their values.</p><p>This means that a contract can dynamically load code from a different address at runtime. Storage, current address and balance still refer to the calling contract, only the code is taken from the called address.</p></blockquote><p>这个特性可以用于构建 Library 和模块化代码. 但是与此同时, 这也有可能造成别人对你的代码进行操作.</p><p>下例中, 攻击者调用 <code>pwn</code> 方法获得了合约的拥有权.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity 0.4.18;</span><br><span class="line"></span><br><span class="line">contract Delegate &#123;</span><br><span class="line">    address public owner;</span><br><span class="line"></span><br><span class="line">    function Delegate(address _owner) public &#123;</span><br><span class="line">        owner &#x3D; _owner;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function pwn() public &#123;</span><br><span class="line">        owner &#x3D; msg.sender;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract Deletagion &#123;</span><br><span class="line">    address public owner;</span><br><span class="line">    Delegate delegate;</span><br><span class="line"></span><br><span class="line">    function Delegation(address _delegateAddreses) public &#123;</span><br><span class="line">        delegate &#x3D; Delegate(_delegateAddreses);</span><br><span class="line">        owner &#x3D; msg.sender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; an attacker can call Delegate.pwn() in the context of Delegation, this means that pwn() will modify the state of **Delegation** and not Delegate, the result is that the attacker takes unauthorized ownership of the contract.</span><br><span class="line">    function () public &#123;</span><br><span class="line">        if(delegate.delegatecall(msg.data)) &#123;</span><br><span class="line">            this;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Reentrancy-TheDAO-hack"><a href="#Reentrancy-TheDAO-hack" class="headerlink" title="Reentrancy(TheDAO hack)"></a>Reentrancy(TheDAO hack)</h3><p>Solidity 中 <code>call</code> 函数被调用时, 如果带有 value 参数, 则会转发所有他所收到的 gas.</p><p>在一下代码片段中, <code>call</code> 函数在 sender 的余额实际减少前被调用. 这里有一个漏洞曾导致 TheDAO 攻击.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function withdraw(uint _amount) public &#123;</span><br><span class="line">  if(balances[msg.sender] &gt;&#x3D; _amount) &#123;</span><br><span class="line">    if(msg.sender.call.value(_amount)()) &#123;</span><br><span class="line">      _amount;</span><br><span class="line">    &#125;</span><br><span class="line">    balances[msg.sender] -&#x3D; amount;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>引自 <a href="https://www.reddit.com/r/ethereum/comments/4oi2ta/i_think_thedao_is_getting_drained_right_now/d4cxvc3/">Reddit</a> 的解释</p><blockquote><p>In simple words, it’s like the bank teller doesn’t change your balance until she has given you all the money you requested. “Can I withdraw $500? Wait, before that , can I withdraw $500?”</p></blockquote><blockquote><p>And so on. The smart contracts as designed only check you have $500 at beginning once, and allow themselves to be interrupted.</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> Ethereum </tag>
            
            <tag> Blockchain </tag>
            
            <tag> Smart Contract </tag>
            
            <tag> Solidity </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Start in Protobuf</title>
      <link href="/2017/12/22/Start-in-Protobuf/"/>
      <url>/2017/12/22/Start-in-Protobuf/</url>
      
        <content type="html"><![CDATA[<p><strong>Protocol Buffers</strong> are a language-neutral, platform-neutral, extensible way of serializing structured data for use in commnucations protocols, data storage, and more, originally designed at Google.</p><p><strong>Protobuf.js</strong> is a pure JS implementation with <strong>TypeScript</strong> support for node.js and browser. It’s easy to use, blazingly fast and works out of the box with <code>.proto</code> files.</p><h3 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h3><p>Node.js</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install protobufjs</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> protobuf = <span class="built_in">require</span>(<span class="string">&#x27;protobufjs&#x27;</span>)</span><br></pre></td></tr></table></figure><p>Browsers</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../protobuf.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Distributions"><a href="#Distributions" class="headerlink" title="Distributions"></a>Distributions</h3><p>Where bundle size is a factor, there are additional stripped-down versions of the full-library(~19kb gzipped) available that excldue certain functinality</p><ul><li>when working with JSON descriptor, and/or reflection only, see the light-library(~16kb gzipped) that excludes the parser. CommonJS entry point is:</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> protobuf = <span class="built_in">require</span>(<span class="string">&#x27;protobufjs/light&#x27;</span>)</span><br></pre></td></tr></table></figure><p>When working with statically generated code only, see the minimal library(~6.5kb gzipped) that also excludes reflection. CommonJS entry point is:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> protobuf = <span class="built_in">require</span>(<span class="string">&#x27;protobufjs/minimal`)</span></span><br></pre></td></tr></table></figure><h3 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h3><p>Because JS is a dynamically typed language, protobuf.js introduces the concept of a <strong>valid message</strong> in order to provide the best possible performance.</p><h4 id="Valid-Message"><a href="#Valid-Message" class="headerlink" title="Valid Message"></a>Valid Message</h4><blockquote><p>A valid message is an object not missing any required fields and exclusively composed of JS types understood by the wire format writer.</p></blockquote><p>There are two possible types of valid messages and the encoder is able to work with both these for convenience:</p><ul><li><p><strong>Message Instance</strong> (explicit instance of message classes with default values on their prototype) always (have to) satisfy the requirements of a valid message by design.</p></li><li><p><strong>Plain JavaScript Objects</strong> that just so happen to be composed in a way satisfying the requirements of a valid message as well.</p></li></ul><p>In a nutshell, the wire format writer understoods the following types:</p><table><thead><tr><th>Field Type</th><th>Expected JS type(create, encode)</th><th>Conversion (fromObject)</th></tr></thead><tbody><tr><td>s-/u-/int32<br>s-/fixed32</td><td><code>number</code> (32 bit integer)</td><td>`value</td></tr><tr><td>s-/u-/int64<br>s-/fixed64</td><td><code>Long</code>-like(optimal)<br><code>number</code>(53 bit integer)</td><td><code>Long.fromValue(value)</code> with long.js<br><code>parseInt(value, 10)</code> otherwise</td></tr><tr><td>float<br>double</td><td><code>number</code></td><td><code>Number(value)</code></td></tr><tr><td>bool</td><td><code>boolean</code></td><td><code>Boolean(value)</code></td></tr><tr><td>string</td><td><code>string</code></td><td><code>String(value)</code></td></tr><tr><td>bytes</td><td><code>Uint8Array</code>(optimal)<br><code>Buffer</code>(optimal under node)<br><code>Array.&lt;number&gt;</code>(8 bit integers)</td><td><code>base64.decode(value)</code> if a <code>string</code><br><code>Object</code> with non-zero<code>.length</code> is assumed to be buffer-like</td></tr><tr><td>enum</td><td><code>number</code> (32 bit integer)</td><td>Looks up the numeric id if a <code>string</code></td></tr><tr><td>message</td><td>Valid Message</td><td><code>Message.fromObject(value)</code></td></tr></tbody></table><ul><li><p>Explicit <code>undefined</code> and <code>null</code> are considered as not set if the field is optional</p></li><li><p>Repeated fields are <code>Array.&lt;T&gt;</code></p></li><li><p>Map fields are <code>Object.&lt;string, T&gt;</code> with the key being the string representation of the respective value or an 8 character long binary hash string for <code>Long</code>-likes.</p></li><li><p>Types marked as <em>optimal</em> provide the best performance because no conversion step(i.e. number to low and high bits or base64 string to buffer) is required.</p></li></ul><p>For performance reasons, each message class provides a distinct set of methods with each method doing just one thing. This avoid unnecessary assertions / redundant operations where performance is a concern but also forces a user to perform verification explicityly where necessary.</p><h3 id="Methods"><a href="#Methods" class="headerlink" title="Methods"></a>Methods</h3><ul><li><p>Message.verify(message: Object): null | string</p></li><li><p>Message.encode(message: Message | Object[, writer: Writer]): Writer</p></li><li><p>Message.encodeDelimited(message: Message | Object[, writer: Writer]): Writer</p></li><li><p>Message.decode(reader: Reader | Uint8Array): Message</p></li><li><p>Message.toObject(message: Message[, options: ConversionOptions]): Object</p></li><li><p>Message.verify(message: Object): null | string</p><p>Verifies that a plain js object satisfies the requirements of a valid message and thus can be encoded without issues. Instead of throwing, it returns the error message as a string, if any:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> payload = <span class="string">&#x27;invalid (not an object)&#x27;</span></span><br><span class="line"><span class="keyword">var</span> err = AwesomeMessage.verify(payload)</span><br><span class="line"><span class="keyword">if</span> (err) <span class="keyword">throw</span> <span class="built_in">Error</span>(err)</span><br></pre></td></tr></table></figure></li><li><p>Message.encode(message: Message | Object[, writer: Writer]): Writer</p></li></ul><p>Encodes a message instance or valid plain javascript object. This method does not implicit verify the message and it’s up to user to make sure that the payload is a valid message.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> buffer = AwesomeBuffer.encode(message).finish()</span><br></pre></td></tr></table></figure><ul><li>Message.encodeDelimited(message: Message | Object[, writer: Writer]): Writer</li></ul><p>Works like <code>Message.encode</code> but additionally prepends the length of the message as a varint.</p><ul><li>Message.decode(reader: Reader): Message</li></ul><p>Decode a buffer to a message instance. If required fields are missing, it throws a <code>util.ProtocolError</code> with an <code>instance</code> property set to the so far decoded message. If the wire format is invalid, it throws an <code>Error</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="keyword">var</span> decodedMessage = AwesomeMessage.decode(buffer)</span><br><span class="line">&#125; cache (e) &#123;</span><br><span class="line">  <span class="keyword">if</span> (e <span class="keyword">instanceof</span> protobuf.util.ProtocolError) &#123;</span><br><span class="line">    <span class="comment">// e.instance holds the so far decoded message with missing required fields</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// wire format is invalid</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Message.decodeDelimited(reader: Reader | Uint8Array): Message</li></ul><p>works like Message.decode but additionally reads the length of the message prepended as a varint</p><ul><li>Message.create(properties: Object): Message</li></ul><p>Creates a new message instance from a set of properties that satisfy the requirements of a valid message. Where applicable, it is recommended to prefer <code>Message.create</code> over <code>Message.fromObject</code> because it doesn’t perform possibly redundant conversion.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> message = AwesomeMessage.create(&#123; <span class="attr">awesomeField</span>: <span class="string">&#x27;AwesomeString&#x27;</span> &#125;)</span><br></pre></td></tr></table></figure><ul><li>Message.fromObject(object: Object): Message</li></ul><p>Converts any non-valid plain javascript object to a message instance using the conversion steps outlined within the table above.</p><ul><li>Message.toObject(message: Message[, options: ConversionOptions]): Object</li></ul><p>Converts a message instance to an arbitrary plain javascript object for interoperability with other libraries or storage. The resulting plain javascript object might still satisify the requirements of a vlaid message depending on the actual conversion options specified, but most of the time it does not.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> object = AwesomeMessage.toObject(message, &#123;</span><br><span class="line">  enums: <span class="built_in">String</span>,</span><br><span class="line">  longs: <span class="built_in">String</span>,</span><br><span class="line">  bytes: <span class="built_in">String</span>,</span><br><span class="line">  defaults: <span class="literal">true</span>,</span><br><span class="line">  arrays: <span class="literal">true</span>,</span><br><span class="line">  objects: <span class="literal">true</span>,</span><br><span class="line">  oneofs: <span class="literal">true</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>For reference, the following diagram aims to display relationships between the different methods and the concepts of a valid message:</p><p><img src="https://camo.githubusercontent.com/f090df881cc6c82ecb7c5d09c9fad550fdfd153e/687474703a2f2f64636f64652e696f2f70726f746f6275662e6a732f746f6f6c7365742e737667"></p><blockquote><p>In other words: <code>verify</code> indicates that calling <code>create</code> or <code>encode</code> directly on the plain object will [result in a valid message respectively] succeed. <code>fromObject</code>, on the other hand, does conversion from a broader range of plain objects to create valid message.</p></blockquote><h3 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h3><h4 id="Using-proto-files"><a href="#Using-proto-files" class="headerlink" title="Using .proto files"></a>Using .proto files</h4><p>It is possible to load existing .proto files using the full library, which parses and compiles the definitions to ready to use (reflection-based) message classes:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">package awesomepackage</span><br><span class="line">syntax = <span class="string">&quot;proto3&quot;</span></span><br><span class="line"></span><br><span class="line">message AwesomeMessage &#123;</span><br><span class="line">  string awesome_field = <span class="number">1</span>; becomes awesomeField</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">protobuf.load(<span class="string">&#x27;awesome.proto&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, root</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="keyword">throw</span> err</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// Obtain a message type</span></span><br><span class="line">  <span class="keyword">var</span> AwesomeMessage = root.lookupType(<span class="string">&#x27;awesomepackage.AwesomeMessage&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Exemplary payload</span></span><br><span class="line">  <span class="keyword">var</span> payload = &#123; <span class="attr">awesomeField</span>: <span class="string">&#x27;AwesomeField&#x27;</span> &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Verify the payload if necessary(i.e. when possible incomplete or invalid)</span></span><br><span class="line">  <span class="keyword">var</span> errMsg = AwesomeMessage.verify(payload)</span><br><span class="line">  <span class="keyword">if</span> (errMsg) <span class="keyword">throw</span> <span class="built_in">Error</span>(errMsg)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Create a new message</span></span><br><span class="line">  <span class="keyword">var</span> message = AwesomeMessage.create(payload) <span class="comment">// or use .fromObject if conversion is necessary</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Encode a message to an Uint8Array(browser) or Buffer (node)</span></span><br><span class="line">  <span class="keyword">var</span> buffer = AwesomeMessage.encode(message).finish()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ... do something with message</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Decode an Uint8Array(browser) or Buffer(node) to a message</span></span><br><span class="line">  <span class="keyword">var</span> message = AwesomeMessage.decode(buffer)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...do something with message</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// If the application uses length-delimited buffers, there is also encodeDelimited and decodeDelimited.</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Maybe conver the message back to a plain object</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> object = AwesomeMessage.toObject(message, &#123;</span><br><span class="line">    loings: <span class="built_in">String</span>,</span><br><span class="line">    enums: <span class="built_in">String</span>,</span><br><span class="line">    bytes: <span class="built_in">String</span>,</span><br><span class="line">    <span class="comment">// see Conversions</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Additionally, promise syntax can be used by omitting the callback, if preferred:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protobuf.load(<span class="string">&#x27;awesome.proto&#x27;</span>).then(<span class="function"><span class="params">root</span> =&gt;</span> &#123;&#125;)</span><br></pre></td></tr></table></figure><h3 id="Using-JSON-Descriptors"><a href="#Using-JSON-Descriptors" class="headerlink" title="Using JSON Descriptors"></a>Using JSON Descriptors</h3><p>The library utilize JSON descriptor that are equivalent to a .proto definition. For example, the following is identical to the .proto definition seen above:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// awesome.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;nested&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;AwesomeMessage&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;fields&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;awesomeField: &#123;</span></span><br><span class="line">          &quot;type&quot;: &quot;string&quot;,</span><br><span class="line">          &quot;id&quot;, 1</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>JSON descriptor closely resemble the internal reflection structure:</p><p>Exclusively using JSON descriptor instead of .proto files enables the use of just the light library(the parser isn’t requried in this case)</p><p>A JSON descriptor can either be loaded the usual way:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">protobuf.load(<span class="string">&#x27;awesome.json&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, root</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> <span class="built_in">Error</span>(err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Or it can be loaded inline:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> jsonDescriptor = <span class="built_in">require</span>(<span class="string">&#x27;./awesome.json&#x27;</span>) <span class="comment">// exemplary for node</span></span><br><span class="line"><span class="keyword">var</span> root = protobuf.Root.fromJSON(jsonDescriptor)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Continue at &#x27;Obtain a message type&#x27; above</span></span><br></pre></td></tr></table></figure><p><a href="https://github.com/dcodeIO/ProtoBuf.js/">More Info here</a></p><h3 id="Usage-with-TypeScript"><a href="#Usage-with-TypeScript" class="headerlink" title="Usage with TypeScript"></a>Usage with TypeScript</h3><p>The library ships with its own type definitions and modern editors will automatically detect and use them for code completion.</p><p>The npm package depends on <code>@types/node</code> because of <code>Buffer</code> and <code>@types/long</code> because of <code>Long</code>. If you are not building for node and/or using long.js, it should be safe to exclude them manually.</p><h4 id="Using-the-JS-API"><a href="#Using-the-JS-API" class="headerlink" title="Using the JS API"></a>Using the JS API</h4><p>The API shown above works pretty much the same with TypeScript. However, because everything is typed, accessing fields on instances of dynamically generated message classes requries either using bracket-notation(i.e. message[‘awesomeField’]), or explicit casts.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; load &#125; <span class="keyword">from</span> <span class="string">&#x27;protobufjs&#x27;</span></span><br><span class="line"></span><br><span class="line">load(<span class="string">&#x27;awesome.proto&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, root</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> <span class="built_in">Error</span>(err)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> AwesomeMessage = root.lookupType(<span class="string">&#x27;awesomepackage.AwesomeMessage&#x27;</span>)</span><br><span class="line">  <span class="keyword">let</span> message = AwesomeMessage.create(&#123; <span class="attr">awesomeField</span>: <span class="string">&#x27;hello&#x27;</span> &#125;)</span><br><span class="line">  cnosole.log(<span class="string">`message = <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(message)&#125;</span>`</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> buffer = AwesomeMessage.encode(message).finish()</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Buffer = <span class="subst">$&#123;<span class="built_in">Array</span>.prototype.toString.call(buffer)&#125;</span>`</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> decoded = AwesomeMessage.decode(buffer)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`decoded = <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(decoded)&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> ProtoBuf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Get the Most Out of the CommonsChunkPlugin</title>
      <link href="/2017/12/07/Get-the-most-out-of-the-CommonsChunkPlugin/"/>
      <url>/2017/12/07/Get-the-most-out-of-the-CommonsChunkPlugin/</url>
      
        <content type="html"><![CDATA[<p><a href="https://medium.com/webpack/webpack-bits-getting-the-most-out-of-the-commonschunkplugin-ab389e5f318">Original</a></p><p>Use <code>webpack-bundle-analyzer</code> to generate a fancy colorful image of all of your<br>bundles.</p><h3 id="Case-1-Many-vendor-bundles-with-duplicate-code"><a href="#Case-1-Many-vendor-bundles-with-duplicate-code" class="headerlink" title="Case 1: Many vendor bundles with duplicate code"></a>Case 1: Many vendor bundles with duplicate code</h3><p><img src="https://cdn-images-1.medium.com/max/2000/1*Mt5awEvcigXceRDpZRX4Dw.png"></p><p>Each single-page app is using a <code>new CommonsChunkPlugin</code> that targets just that<br>entry point, and its vendor code. This creates a bundle with only modules that<br>come from node_modules folder, and another bundle with just application code.</p><p>The configuration portion was provided:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.keys(activeApps).map(</span><br><span class="line">  app =&gt;</span><br><span class="line">    <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">      name: <span class="string">`<span class="subst">$&#123;app&#125;</span>_vendor`</span>,</span><br><span class="line">      chunk: [app],</span><br><span class="line">      minChunks: isVendor,</span><br><span class="line">    &#125;),</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>The <code>activeApps</code> variable most likely represents each of the individual entry<br>points.</p><p>Below are a few areas that could use some improvement.</p><p><img src="https://cdn-images-1.medium.com/max/800/1*D4m4sa9X1V05y7I7ZCMbZA.png"></p><h3 id="“Meta”-caching"><a href="#“Meta”-caching" class="headerlink" title="“Meta” caching"></a>“Meta” caching</h3><p>What we see above is many large libraries like momentjs, lodash, and jquery<br>being used across 6 or more vendor bundles. The strategy for add all vendor into<br>a seperate bundle is good, but we should also apply the same strategy acroll<br><strong>all vendor bundle</strong>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.optimizeCommonsChunkPlugin(&#123;</span><br><span class="line">  children: <span class="literal">true</span>,</span><br><span class="line">  minChunks: <span class="number">6</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>We are telling the webpack to follow:</p><blockquote><p>Hey webpack, look across all chunks(including the vendor ones that were<br>generated) and move any modules that occur in at least 6 chunks to a seperate<br>file.</p></blockquote><h3 id="Case-2-duplicate-vendors-across-async-chunks"><a href="#Case-2-duplicate-vendors-across-async-chunks" class="headerlink" title="Case 2: duplicate vendors across async chunks"></a>Case 2: duplicate vendors across async chunks</h3><p><img src="https://cdn-images-1.medium.com/max/2000/1*yRCgk_pzDpkMfQGKpCO_HA.jpeg"></p><p>As you can see, the same 2-3 components are used across all 40-50 async bundles</p><p><code>CommonsChunkPlugin</code> can solve this.</p><h4 id="Create-an-async-Commons-Chunk"><a href="#Create-an-async-Commons-Chunk" class="headerlink" title="Create an async Commons Chunk"></a>Create an async Commons Chunk</h4><p>The technique will be very simillar to the first, however we will need to set<br>the <code>async</code> property in the configuration option, to <code>true</code> as seen below:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">  <span class="keyword">async</span>: <span class="literal">true</span>,</span><br><span class="line">  children: <span class="literal">true</span>,</span><br><span class="line">  filename: <span class="string">&#x27;commonlazy.js&#x27;</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>In the same way – webpack will scan all chunks and look for common modules.<br>Since <code>async: true</code>, only code split bundles will be scanned.</p><p>Because we did not specify <code>minChunks</code>, the value default to 3. so what webpack<br>is being told is:</p><blockquote><p>Hey webpack, look through all normal [aka lazy loaded] chunks and if you find<br>the smae module that appears across 3 or more chunks, then seperate it out<br>into a seperate async commons chunk.</p></blockquote><h3 id="More-Control"><a href="#More-Control" class="headerlink" title="More Control"></a>More Control</h3><h4 id="minChunks-function"><a href="#minChunks-function" class="headerlink" title="minChunks function"></a>minChunks function</h4><p>There are scenario you don’t want to have a single shared bundle because not<br>every lazy/entry chunk may use it. The <code>minChunks</code> property also takes a<br>function. This can be your ‘filtering predicate’ for what modules are added to<br>your newly created bundle.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">  filename: <span class="string">&#x27;loash-moment-shared-bundle.js&#x27;</span>,</span><br><span class="line">  minChunks: <span class="function"><span class="keyword">function</span>(<span class="params">module, count</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="built_in">module</span>.resource &amp;&amp; <span class="regexp">/lodash|moment/</span>.test(<span class="built_in">module</span>.resource) &amp;&amp; count &gt;= <span class="number">3</span></span><br><span class="line">    )</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>This example says:</p><blockquote><p>Yo webpack, when you come across a module whos absolute path amtches lodash or<br>moment, and occurs across 3 seperate entries/chunks, then extract those<br>modules into a seperate bundle.</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> Webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Go Web</title>
      <link href="/2017/12/05/Go-Web/"/>
      <url>/2017/12/05/Go-Web/</url>
      
        <content type="html"><![CDATA[<p><a href="https://gowebexamples.com/hello-world/">Original</a></p><h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p>Go is a battery included programming language and has a webserver already built<br>in.</p><p>The <code>net/http</code> package from the standard library contains all functionalities<br>about the HTTP protocol.</p><p>This includes an HTTP client and an HTTP server.</p><h3 id="Registering-a-Request-Handler"><a href="#Registering-a-Request-Handler" class="headerlink" title="Registering a Request Handler"></a>Registering a Request Handler</h3><p>First, create a Handler which receives all incoming HTTP connections from<br>browsers, HTTP client or API requests. A handler in Go is a function with this<br>signature.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(w http.ResponseWriter, r *http.Request)</span></span></span><br></pre></td></tr></table></figure><p>The function receives two parameters:</p><ul><li><p>An <code>http.ResponseWriter</code> which is where you write your text/html response to.</p></li><li><p>An <code>http.Request</code> which contains all information about this HTTP request<br>including like URL or header fields</p></li></ul><p>Registering a request handler to the default HTTP Server is as simple as this:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http.HandleFunc(<span class="string">&quot;/&quot;</span>, <span class="function"><span class="keyword">func</span> <span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">  fmt.Fprintf(w, <span class="string">&quot;Hello, you&#x27;ve requested: %s\n&quot;</span>, r.URL.Path)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Listen-for-HTTP-Connections"><a href="#Listen-for-HTTP-Connections" class="headerlink" title="Listen for HTTP Connections"></a>Listen for HTTP Connections</h3><p>The request handler alone can not accept any HTTP connections from the outside.</p><p>An HTTP server has to listen on a port to pass connections on to the request<br>handler. Because port 80 is in most case the default port for HTTP traffic, this<br>server will also listen on it.</p><p>The following code will start Go’s default HTTP server and listen for<br>connections on port 80. You can navigate your browser to <code>http://localhost/</code> and<br>see your server handling yoru request</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http.ListenAndServe(<span class="string">&quot;:80&quot;</span>, <span class="literal">nil</span>)</span><br></pre></td></tr></table></figure><h3 id="The-Code"><a href="#The-Code" class="headerlink" title="The Code"></a>The Code</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span> <span class="params">()</span></span> &#123;</span><br><span class="line">  http.HandleFunc(<span class="string">&quot;/&quot;</span>, <span class="function"><span class="keyword">func</span> <span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">    fmt.Fprintf(w, <span class="string">&quot;Hello, you&#x27;ve requested: %s\n&quot;</span>, r.URL.Path)</span><br><span class="line">  &#125;)</span><br><span class="line">  http.ListenAndServe(<span class="string">&quot;:80&quot;</span>, <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Routing-using-gorilla-mux"><a href="#Routing-using-gorilla-mux" class="headerlink" title="Routing (using gorilla/mux)"></a>Routing (using gorilla/mux)</h3><p>Go’s <code>net/http</code> package provides a lot of functionalities for the HTTP protocol.<br>One thing it doesn’t do very well is complex request routing like segmenting a<br>request url into single parameters.</p><p>Use <code>gorilla/mux</code> package to create routes with named parameters, GET/POST<br>handlers and domain restrictions.</p><p><code>gorilla/mux</code> is a package which adapts to Go’s default HTTP router. It comes<br>with a lot of features to increase the productivity when writing web<br>applications. It is also compliant to Go’s default request handler signature<br><code>func (w http.ResponseWriter, r *http.Request)</code>, so package can be mixed and<br>matched with other HTTP libraries like middleware or existing applications. Use<br>the <code>go get</code> command to install the package from Github.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get -u github.com/gorilla/mux</span><br></pre></td></tr></table></figure><h4 id="Creating-a-new-Router"><a href="#Creating-a-new-Router" class="headerlink" title="Creating a new Router"></a>Creating a new Router</h4><p>First create a new request router. The router is the main router for your web<br>application and will later be passed as parameter to the server. It will receive<br>all HTTP connections and pass it on to the request handlers you will register on<br>it. You can create a new router like so:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">r := mux.NewRouter()</span><br></pre></td></tr></table></figure><h4 id="Registering-a-Request-Handler-1"><a href="#Registering-a-Request-Handler-1" class="headerlink" title="Registering a Request Handler"></a>Registering a Request Handler</h4><p>Once you have a new router you can register request handlers like usual. The<br>only difference is that instead of calling <code>http.HandleFunc(...)</code>, you call<br><code>HandleFunc</code> on your router like this <code>r.HandleFunc(...)</code></p><h4 id="URL-Parameters"><a href="#URL-Parameters" class="headerlink" title="URL Parameters"></a>URL Parameters</h4><p>The biggest strength of the <code>gorilla/mux</code> Router is the ability to extract<br>segments from the request URL. As an example, this is a URL in your application</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;books&#x2F;go-programming-bluepring&#x2F;page&#x2F;10</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">r.HandleFunc(<span class="string">&quot;/books/&#123;title&#125;/page/&#123;page&#125;&quot;</span>, <span class="function"><span class="keyword">func</span> <span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">  <span class="comment">// get the book</span></span><br><span class="line">  <span class="comment">// navigate to the page</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>The last thing to get the data from these segments. The package comes with the<br>function <code>mux.Vars(r)</code> which takes the <code>http.Request</code> as parameter and returns a<br>map of the segments.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">  vars := mux.Vars(r)</span><br><span class="line">  vars[<span class="string">&quot;title&quot;</span>]</span><br><span class="line">  vars[<span class="string">&quot;page&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Setting-the-HTTP-server’s-router"><a href="#Setting-the-HTTP-server’s-router" class="headerlink" title="Setting the HTTP server’s router"></a>Setting the HTTP server’s router</h4><p>Ever wondered what the <code>nil</code> in <code>http.ListenAndServe(&quot;:80&quot;, nil)</code> ment? It is<br>the parameter for the main router of the HTTP server. By default it’s <code>nil</code>,<br>which means to use the default router of the <code>net/http</code> package. To make use of<br>your own router, replace the <code>nil</code> with the variable of your router <code>r</code>.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http.ListenAndServe(<span class="string">&quot;:80&quot;</span>, r)</span><br></pre></td></tr></table></figure><h4 id="The-Code-1"><a href="#The-Code-1" class="headerlink" title="The Code"></a>The Code</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;net/http&quot;</span></span><br><span class="line">  <span class="string">&quot;github.com/gorilla/mux&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span> <span class="params">()</span></span> &#123;</span><br><span class="line">  r := mux.NewRouter()</span><br><span class="line">  r.HandleFunc(<span class="string">&quot;/books/&#123;title&#125;/page/&#123;page&#125;&quot;</span>, <span class="function"><span class="keyword">func</span> <span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">    vars := mux.Vars(r)</span><br><span class="line">    title := vars[<span class="string">&quot;title&quot;</span>]</span><br><span class="line">    page := vars[<span class="string">&quot;page&quot;</span>]</span><br><span class="line"></span><br><span class="line">    fmt.Fprintf(w, <span class="string">&quot;You&#x27;ve requested the book %s on page %s\n&quot;</span>, title, page)</span><br><span class="line">  &#125;)</span><br><span class="line">  http.ListenAndServe(<span class="string">&quot;:80&quot;</span>, r)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Features-of-the-gorilla-mux-Router"><a href="#Features-of-the-gorilla-mux-Router" class="headerlink" title="Features of the gorilla/mux Router"></a>Features of the <code>gorilla/mux</code> Router</h4><h5 id="Methods"><a href="#Methods" class="headerlink" title="Methods"></a>Methods</h5><p>Restrict the request handler to specific HTTP methods</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">r.HandleFunc(<span class="string">&quot;/books/&#123;title&#125;&quot;</span>, CreateBook).Methods(<span class="string">&quot;POST&quot;</span>)</span><br><span class="line">r.HandleFunc(<span class="string">&quot;/books/&#123;title&#125;&quot;</span>, ReadBook).Methods(<span class="string">&quot;GET&quot;</span>)</span><br><span class="line">r.HandleFunc(<span class="string">&quot;/books/&#123;title&#125;&quot;</span>, UpdateBook).Methods(<span class="string">&quot;PUT&quot;</span>)</span><br><span class="line">r.HandleFunc(<span class="string">&quot;/books/&#123;title&#125;&quot;</span>, DeleteBook).Methods(<span class="string">&quot;DELETE&quot;</span>)</span><br></pre></td></tr></table></figure><h5 id="Hostnames-amp-Subdomains"><a href="#Hostnames-amp-Subdomains" class="headerlink" title="Hostnames &amp; Subdomains"></a>Hostnames &amp; Subdomains</h5><p>Restrict the request handler to specific hostname or subdomain</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">r.HandleFunc(<span class="string">&quot;/books/&#123;title&#125;&quot;</span>, BookHandler).Host(<span class="string">&quot;www.mybookstore.com&quot;</span>)</span><br></pre></td></tr></table></figure><h5 id="Schemes"><a href="#Schemes" class="headerlink" title="Schemes"></a>Schemes</h5><p>Restrict the request handler to http/https</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">r.HandleFunc(<span class="string">&quot;/secure&quot;</span>, SecureHandler).Scheme(<span class="string">&quot;https&quot;</span>)</span><br><span class="line">r.HandleFunc(<span class="string">&quot;/insecure&quot;</span>, InsecureHandler).Scheme(<span class="string">&quot;http&quot;</span>)</span><br></pre></td></tr></table></figure><h5 id="Path-Prefixes-amp-Subrouters"><a href="#Path-Prefixes-amp-Subrouters" class="headerlink" title="Path Prefixes &amp; Subrouters"></a>Path Prefixes &amp; Subrouters</h5><p>Restrict the request handler to specific path prefixes.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bookrouter := r.Path.Prefix(<span class="string">&quot;/books&quot;</span>).subRouter()</span><br><span class="line">bookrouter.HandleFunc(<span class="string">&quot;/&quot;</span>, AllBooks)</span><br><span class="line">bookrouter.HandleFunc(<span class="string">&quot;/&#123;title&#125;&quot;</span>, GetBook)</span><br></pre></td></tr></table></figure><h3 id="Template"><a href="#Template" class="headerlink" title="Template"></a>Template</h3><p>Go’s <code>html/template</code> package provides a rich templating language for HTML<br>templates. It is mostly used in web applications to display data in a structured<br>way in a client’s browser. One great benefit of Go’s templating language is the<br>automatic escaping of data. There is no need to worry about XSS attacka as Go<br>parses the HTML template and escapes all inputs before displaying it to the<br>browser.</p><h4 id="First-Template"><a href="#First-Template" class="headerlink" title="First Template"></a>First Template</h4>]]></content>
      
      
      
        <tags>
            
            <tag> Go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Generate Ethereum Keys and Wallet Address</title>
      <link href="/2017/11/30/Generate-Ethereum-keys-and-wallet-address/"/>
      <url>/2017/11/30/Generate-Ethereum-keys-and-wallet-address/</url>
      
        <content type="html"><![CDATA[<p><a href="https://kobl.one/blog/create-full-ethereum-keypair-and-address/">Original</a></p><p>This article is a guide on how to generate an <strong>ECDSA</strong> private key and derives<br>its Ethereum address.</p><p>Use Openssl and keccak-256sum from a terminal.</p><blockquote><p>SHA3 != keccak. Ethereum is using the <strong>keccak-256</strong> algorithm and not the<br>standard sha3.</p></blockquote><blockquote><p>Ethereum use keccak-256, it should be noted that it does not follow the<br>FIPS-202 based standard(aka. SHA-3), which was finalized in August 2015</p></blockquote><blockquote><p>web3.utils.sha3 uses keccak-256 web3.sha3(string[, option]): keccak-256</p></blockquote><h3 id="Generate-the-EC-private-key"><a href="#Generate-the-EC-private-key" class="headerlink" title="Generate the EC private key"></a>Generate the EC private key</h3><p>First of all we use <strong>Openssl</strong> ecparam command to generate an elliptic curve<br>private key. Ethereum standard is to use the <strong>secp256k1</strong> curve. The same curve<br>is used in Bitcion.</p><p>This command will print the private key in BEM format(using the wonderful ASN.1<br>key structure) on stdout.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; openssl ecparam -name secp256k1 -genkey -noout</span><br><span class="line">-----BEGIN EC PRIVATE KEY-----</span><br><span class="line">MHQCAQEEIFDLYO9KuwsC4ej2UsdA4SYk7s3lb8aZuW+B8rjugrMmoAcGBSuBBAAK</span><br><span class="line">oUQDQgAEsNjwhFoLKLXGBxfpMv3ILhzg2FeySRlFhtjfi3s8YFZzJtmckVR3N/YL</span><br><span class="line">JLnUV7w3orZUyAz77k0ebug0ILd1lQ==</span><br><span class="line">-----END EC PRIVATE KEY-----</span><br></pre></td></tr></table></figure><p>On its own this command is not very useful for us, but if you pipe it with the<br>ec command it will display both private and public part in hexadecimal format,<br>and this is what we want.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt; openssl ecparam -name secp256k1 -genkey -noout | openssl ec -text -noout</span><br><span class="line"><span class="built_in">read</span> EC key</span><br><span class="line">Private-Key: (256 bit)</span><br><span class="line">priv:</span><br><span class="line">    20:80:65:a2:47:ed:be:5d:f4:d8:6f:bd:c0:17:13:</span><br><span class="line">    03:f2:3a:76:96:1b:e9:f6:01:38:50:dd:2b:dc:75:</span><br><span class="line">    9b:bb</span><br><span class="line">pub:</span><br><span class="line">    04:83:6b:35:a0:26:74:3e:82:3a:90:a0:ee:3b:91:</span><br><span class="line">    bf:61:5c:6a:75:7e:2b:60:b9:e1:dc:18:26:fd:0d:</span><br><span class="line">    d1:61:06:f7:bc:1e:81:79:f6:65:01:5f:43:c6:c8:</span><br><span class="line">    1f:39:06:2f:c2:08:6e:d8:49:62:5c:06:e0:46:97:</span><br><span class="line">    69:8b:21:85:5e</span><br><span class="line">ASN1 OID: secp256k1</span><br></pre></td></tr></table></figure><p>This command decodes the ASN.1 structure and derives the public key from the<br>private one.</p><p>Sometimes, Openssl is adding a null byte(0x00) in front of the private part, I<br>don’t know why it does that but you have to <strong>trim any leading zero bytes</strong> in<br>order to use it with Ethereum.</p><blockquote><p>The private key <strong>must be 32 bytes and not begin with 0x00</strong> and the public<br>one <strong>must be uncompressed and 64 bytes long</strong> or 65 with the constant (0x04)<br>prefix.</p></blockquote><h3 id="Derive-the-Ethereum-address-from-the-public-key"><a href="#Derive-the-Ethereum-address-from-the-public-key" class="headerlink" title="Derive the Ethereum address from the public key"></a>Derive the Ethereum address from the public key</h3><p>The public key is what we need in order to derive its Ethereum address. Every EC<br>Public key begins with ‘0x04’ prefix byte in order to hash it correctly.</p><blockquote><p>This prefix represents the encoding of the public key:</p><ul><li>0x04 - both x and y of the elliptic curve point follows</li><li>0x02, 0x03 - only x follows (y is either odd or even depending on the<br>prefix)</li></ul></blockquote><p>Use any method you like to get it in the form of an hexadecimal string(without<br>line return nor semicolon)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Extract the public key and remove the EC prefix 0x04</span></span><br><span class="line">&gt; cat Key | grep pub -A 5 | tail -n +2 |</span><br><span class="line">            tr -d <span class="string">&#x27;\n[:space:]:&#x27;</span> | sed <span class="string">&#x27;s/^04//&#x27;</span> &gt; pub</span><br><span class="line">836b35a026743e823a90a0ee3b91bf615c6a757e2b60b9e1dc1826fd0dd16106f7bc1e8179f665015f43c6c81f39062fc2086ed849625c06e04697698b21855e</span><br></pre></td></tr></table></figure><p>The pub file now contains the hexadecimal value of the public key without the<br>0x04 prefix.</p><p>An Ethereum address is made of 20 bytes(40 hex characters), it is commonly<br>represented by adding the 0x prefix. In order to derive it, one should take the<br>keccak-256 hash of the hexadecimal form of a public key, then <strong>keep only the<br>last 20 bytes</strong> (aka get rid of the first 12 bytes)</p><p>Simply pass the file containing the public key in hexadecimal format to the<br>keccak-256sum command. <strong>Do not forget to use the ‘-x’ option</strong> in order to<br>interpret it as hexadecimal and not a simple string.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Generate the hash and take the address part</span></span><br><span class="line">&gt; cat pub | keccak-256sum -x -l | tr -d <span class="string">&#x27; -&#x27;</span> | tail -c 41</span><br><span class="line">0bed7abd61247635c1973eb38474a2516ed1d884</span><br></pre></td></tr></table></figure><p>Which gives us the Ethereum address<br><code>0x0bed7abd61247635c1973eb38474a2516ed1d884</code>.</p><blockquote><p>CAUTION: if your final address looks like<br><code>0xdcc703c0E500B653Ca82273B7BFAd8045D85a470</code>, this means you have hashed an<br>empty public key. Sending funds to this address will lock them forever.</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> Ethereum </tag>
            
            <tag> Blockchain </tag>
            
            <tag> Wallet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Caution on Int8Array</title>
      <link href="/2017/11/29/Caution-on-Int8Array/"/>
      <url>/2017/11/29/Caution-on-Int8Array/</url>
      
        <content type="html"><![CDATA[<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> t = crypto.getRandomValues(<span class="keyword">new</span> <span class="built_in">Int8Array</span>(<span class="number">3</span>))</span><br><span class="line"><span class="comment">// Int8Array(3) [-15, -17, -90]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// t is not typeof Array</span></span><br><span class="line"><span class="built_in">Array</span>.isArray(t)</span><br><span class="line"><span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// element in Int8Array must be type Int8</span></span><br><span class="line"><span class="comment">// method map returns array of same type as origin array</span></span><br><span class="line"><span class="keyword">let</span> _t = []</span><br><span class="line">t.map(<span class="function"><span class="params">i</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> _tmp = i.toString(<span class="number">16</span>)</span><br><span class="line">  _t.push(_tmp)</span><br><span class="line">  <span class="keyword">return</span> _tmp</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// Int8Array(3) [0, -11, 0]</span></span><br><span class="line"><span class="comment">// _t: [&#x27;-f&#x27;, &#x27;-11&#x27;, &#x27;-5a&#x27;]</span></span><br><span class="line"></span><br><span class="line">t[<span class="number">0</span>] = <span class="string">&#x27;a&#x27;</span></span><br><span class="line"><span class="comment">// t: Int8Array(3) [0, -17, -90]</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Client Wallet Inspection</title>
      <link href="/2017/11/23/Client-Wallet-Inspection/"/>
      <url>/2017/11/23/Client-Wallet-Inspection/</url>
      
        <content type="html"><![CDATA[<iframe width='853' height='800' src='https://embed.coggle.it/diagram/WhaB3hE2BAABznZF/065e922ba0f89869d4682bb60d9e426164106f817068fedc350e1193c7322293' frameborder='0' allowfullscreen></iframe>]]></content>
      
      
      
        <tags>
            
            <tag> Ethereum </tag>
            
            <tag> Blockchain </tag>
            
            <tag> Wallet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>React-Lodable</title>
      <link href="/2017/11/23/react-lodable/"/>
      <url>/2017/11/23/react-lodable/</url>
      
        <content type="html"><![CDATA[<p><code>react-lodable</code> is a higher order component for loading components with dynamic<br>imports.</p><p>Code-splitting is the process of taking one large bundle containing your entire<br>app, and splitting them up into multiple smaller bundles which contain seperate<br>parts of your app.</p><p>This might seem difficult to do, but tools like Webpack have this built in, and<br>React Loadable is designed to make is super simple.</p><h4 id="Route-based-splitting-vs-Component-based-splitting"><a href="#Route-based-splitting-vs-Component-based-splitting" class="headerlink" title="Route-based splitting vs. Component-based splitting"></a>Route-based splitting vs. Component-based splitting</h4><p>A common piece of advice you will see is to break your app into seperate routes<br>and load each one asynchronously. This seems to work well enough for many apps<br>– a a user, clicking a link and waiting for a page to load is a familiar<br>experience on the web.</p><p>Namely, a route is simple a component.</p><p>But in fact there are more places than just routes where you can pretty easily<br>split apart your app: Modals, Tabs, and many more UI Components hide content<br>until the user has done something to reveal it.</p><p><img src="http://thejameskyle.com/img/react-loadable-component-splitting.png"></p><blockquote><p>Example: Maybe your app ahs a map buried inside of a tab component. Why would<br>you load a massive mapping library for the parent route every time the user<br>never to to that tab.</p></blockquote><p>React Loadable is a small library that makes component-centric code splitting<br>incredibly easy in React.</p><p><code>Loadable</code> is a higher-order component(a function that returns a component)<br>which lets you dynamically load any module before rendering it into your app.</p><p>We can make it by <code>dynamic import</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Bar <span class="keyword">from</span> <span class="string">&#x27;./components/Bar&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Bar</span> /&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>=&gt;</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    Bar: <span class="literal">null</span>,</span><br><span class="line">  &#125;</span><br><span class="line">  componentWillMount() &#123;</span><br><span class="line">    <span class="keyword">import</span>(<span class="string">&#x27;./components/Bar&#x27;</span>).then(<span class="function"><span class="params">Bar</span> =&gt;</span> <span class="built_in">this</span>.setState(&#123; Bar &#125;))</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123; Bar &#125; = <span class="built_in">this</span>.state</span><br><span class="line">    <span class="keyword">if</span> (!Bar) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Bar</span> /&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>But that’s whole bunch of work, and it doesn’t even handle a bunch of caess.<br>What about when <code>import()</code> fails? What about server-side rendering?</p><p><code>react-loadable</code> considers the unexpected cases.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Loadable <span class="keyword">from</span> <span class="string">&#x27;react-loadable&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> LoadableBar = Loadable(&#123;</span><br><span class="line">  loader: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./components/Bar&#x27;</span>),</span><br><span class="line">  loading: <span class="function">() =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Loading<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">LoadableBar</span> /&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>When you use <code>import()</code> with webpack2, it will<br><a href="https://webpack.js.org/guides/code-splitting/">automatically code-split</a> for<br>you with no additional configuration.</p><p>Define your Loading Component</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Loading</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Loading<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>When your loader fails, your Loading component will receive an error prop which<br>will be <code>true</code>(otherwise it will be <code>false</code>).</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Loading</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (props.error) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Error<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Sometimes components load really quickly(&lt;200ms) and the loading screen only<br>quickly flashes on the screen.</p><p>Your loading component will get a <code>pastDelay</code> props which will only be <code>true</code><br>once the component has taken longer to load than a set <code>delay</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Loading</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (props.error) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Error<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (props.pastDelay) &#123;</span><br><span class="line">    <span class="comment">// only show loading when it takes longer than 200ms</span></span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Loading<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This delay defaults to 200ms, but you can customize the delay in Loadable.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Loadable(&#123;</span><br><span class="line">  loader: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./components/Bar&#x27;</span>),</span><br><span class="line">  loading: <span class="function">() =&gt;</span> Loading,</span><br><span class="line">  delay: <span class="number">300</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Timing out when the loader is taking too long</p><p>Sometimes network connections suck and never resolve or fail, they just hang<br>there forever. This sucks for the user because they won’t know if it should<br>always take this long, or if they should try refreshing.</p><p>The Loading component will receive a <code>timeOut</code> prop which will be set to <code>true</code><br>when the loader has timed out.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Loading</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (props.error) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Error<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (props.timedOut) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Timed out<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (props.pastDelay) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Loading<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This feature is disabled by default, you can pass a <code>timeout</code> option to<br><code>Loadable</code> to enable it.</p><p>By default <code>Loadable</code> will render the <code>default</code> export of the returned module.<br>If you want to customize this behavior you can use the <code>render</code> option.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Loadable(&#123;</span><br><span class="line">  loader: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./myComponent&#x27;</span>),</span><br><span class="line">  render(loaded, props) &#123;</span><br><span class="line">    <span class="keyword">let</span> Component = loaded.namedExport</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Component</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span></span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>You can do whatever you want within <code>loader()</code> as long as it returns a promise<br>and you are able to render everything</p><p>You can load multiple resources in parallel with <code>Loadable.Map</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Loadable.Map(&#123;</span><br><span class="line">  loader: &#123;</span><br><span class="line">    Bar: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./Bar&#x27;</span>),</span><br><span class="line">    i18n: <span class="function">() =&gt;</span> fetch(<span class="string">&#x27;./i18n/bar.json&#x27;</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> res.json()),</span><br><span class="line">  &#125;,</span><br><span class="line">  render(loaded, props) &#123;</span><br><span class="line">    <span class="keyword">let</span> Bar = loaded.Bar.default</span><br><span class="line">    <span class="keyword">let</span> i18n = loaded.i18n</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Bar</span> &#123;<span class="attr">...props</span>&#125; <span class="attr">i18n</span>=<span class="string">&#123;i18n&#125;</span> /&gt;</span></span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>As an optimization, you can also decide to preload a component before it gets<br>rendered.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> LoadableBar = Loadable(&#123;</span><br><span class="line">  loader: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./Bar&#x27;</span>),</span><br><span class="line">  loading: Loading,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    showBar: <span class="literal">false</span>,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  onClick = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.setState(&#123; <span class="attr">showBar</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  onMouseOver = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    LoadableBar.preload()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;button onClick=&#123;<span class="built_in">this</span>.onClick&#125; onMouseOver=&#123;<span class="built_in">this</span>.onMouseOver&#125;&gt;</span><br><span class="line">          showbar</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">        &#123;<span class="built_in">this</span>.state.showBar &amp;&amp; <span class="xml"><span class="tag">&lt;<span class="name">LoadableBar</span> /&gt;</span></span>&#125;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Server-side-rendering-to-see-Github"><a href="#Server-side-rendering-to-see-Github" class="headerlink" title="Server-side rendering to see Github"></a>Server-side rendering to see <a href="https://github.com/thejameskyle/react-loadable">Github</a></h3>]]></content>
      
      
      
        <tags>
            
            <tag> React </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Difference Between Contract Calling in Web3</title>
      <link href="/2017/11/21/Difference-between-Contract-Calling-in-Web3/"/>
      <url>/2017/11/21/Difference-between-Contract-Calling-in-Web3/</url>
      
        <content type="html"><![CDATA[<p>After we get the instance of Contract(<code>testInstance</code>), we can invoke its method by three ways:</p><ul><li><p><code>testInstance.testFunc.sendTransaction()</code></p><ul><li>It will make a transaction which will be broadcasted into the net, use gas and return the <code>txHash</code></li></ul></li><li><p><code>testInstance.testFunc.call()</code></p><ul><li>Call the contract function in VM, no broadcast and no gas used, return the response from method</li></ul></li><li><p><code>testInstance.testFunc()</code></p><ul><li>If the testFunc is signified <code>constant</code>, which means it won’t change the state on chain, it won’t be executed(web3 will invoke it by <code>.call()</code>). If the testFunc is not <code>constant</code>, <code>sendTransaction()</code> will be invoked.</li></ul></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Blockchain </tag>
            
            <tag> Smart Contract </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JSON-PRC</title>
      <link href="/2017/11/21/JSON-PRC/"/>
      <url>/2017/11/21/JSON-PRC/</url>
      
        <content type="html"><![CDATA[<iframe width='100%' height='800px' src='https://embed.coggle.it/diagram/WhOeZuojMQABUzIo/99b086bdc0ebfc435ab27512cc9484dfe4d5352dc2ff34812c64d3706efe7066' frameborder='0' allowfullscreen></iframe>]]></content>
      
      
      
        <tags>
            
            <tag> JSON-RPC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Common Patterns in Contract</title>
      <link href="/2017/11/14/Common-Patterns-in-Contract/"/>
      <url>/2017/11/14/Common-Patterns-in-Contract/</url>
      
        <content type="html"><![CDATA[<h3 id="Withdrawal-from-Contract"><a href="#Withdrawal-from-Contract" class="headerlink" title="Withdrawal from Contract"></a>Withdrawal from Contract</h3><p>The recommended method of sending funds after an effect is using the withdrawal pattern.</p><p>Although the most intuitive method of sending Ether, as a result of an effect, is a direct <code>send</code> call, this is not recommended as it introduces a potential security risk.</p><p>This is an example of the withdrawal pattern in practice in a contract where the goal is to send the most money to the contract in order to become the “richest”.</p><p>In the following contract, if you are usurped as the richest, you will receive the funds of the person who has gone on to be the new richest:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.11</span>;</span><br><span class="line"></span><br><span class="line">contract WithdrawalContract &#123;</span><br><span class="line">  address public richest;</span><br><span class="line">  uint public mostSent;</span><br><span class="line"></span><br><span class="line">  mapping(<span class="function"><span class="params">address</span> =&gt;</span> uint) public pendingWithdrawals;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">WithdrawalContract</span>(<span class="params"></span>) <span class="title">payable</span> </span>&#123;</span><br><span class="line">    richest = msg.sender;</span><br><span class="line">    mostSent = msg.value;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">becomeRichest</span>(<span class="params"></span>) <span class="title">payable</span> <span class="title">returns</span> (<span class="params">bool</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (msg.value &gt; mostSent) &#123;</span><br><span class="line">      pendingWithdrawals[msg.sender] += msg.value;</span><br><span class="line">      richest = msg.sender;</span><br><span class="line">      mostSent = msg.value;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">withdraw</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    uint amount = pendingWithdrawals[msg.sender];</span><br><span class="line">    pendingWithdrawals[msg.sender] = <span class="number">0</span>;</span><br><span class="line">    msg.sender.transfer(amount);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>In the example above, if the Contract is attacked and the withdraw method stuck(for example, msg.sender.transfer(amount) fails), the Contract will keep working.</p><h3 id="Restricting-Access"><a href="#Restricting-Access" class="headerlink" title="Restricting Access"></a>Restricting Access</h3><p>Restricting access is a common pattern for contract.</p><p>Note that you can never restrict any human or computer from reading the content of your transactions or your contract’s state. You can make it a bit harder by using encryption, but if your contract is supposed to read the data, so will everyone else.</p><p>You can restrict read access to your contract’s state by <strong>other contract</strong>. This is actually the default unless you declare make your state variables <code>public</code>.</p><p>Furthermore, you can restrict who can make modifications to your contract’s state or call your contract’s functions.</p><p>The use of <strong>function modifier</strong> makes thse restrictions highly readable.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.11</span>;</span><br><span class="line"></span><br><span class="line">contract AccessRestriction &#123;</span><br><span class="line">    address public owner = msg.sender;</span><br><span class="line">    uint public creationTime = now;</span><br><span class="line"></span><br><span class="line">    modifier onlyBy(address _account) &#123;</span><br><span class="line">        <span class="built_in">require</span>(msg.sender == _account);</span><br><span class="line">        _;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">changeOwner</span>(<span class="params">address _newOwner</span>) <span class="title">onlyBy</span>(<span class="params">owner</span>) </span>&#123;</span><br><span class="line">        owner = _newOwner;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    modifier onlyAfter(uint _time) &#123;</span><br><span class="line">        <span class="built_in">require</span>(now &gt; _time);</span><br><span class="line">        _;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">disown</span>(<span class="params"></span>) <span class="title">onlyBy</span>(<span class="params">owner</span>) <span class="title">onlyAfter</span>(<span class="params">creationTime + <span class="number">6</span> weeks</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">delete</span> owner;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    modifier costs(uint _amount) &#123;</span><br><span class="line">        <span class="built_in">require</span>(msg.value &gt; _amount);</span><br><span class="line">        _;</span><br><span class="line">        <span class="keyword">if</span> (msg.value &gt; _amount)</span><br><span class="line">            msg.sender.send(msg.value - _amount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">forceOwnerChange</span>(<span class="params">address _newOwner</span>) <span class="title">costs</span>(<span class="params"><span class="number">200</span> ether</span>) </span>&#123;</span><br><span class="line">        owner = _newOwner;</span><br><span class="line">        <span class="keyword">if</span> (uint(owner) &amp; <span class="number">0</span> == <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="State-Machine"><a href="#State-Machine" class="headerlink" title="State Machine"></a>State Machine</h3><p>Contracts often act as a state machine, which means that they have certain <strong>stage</strong> in which they behave differently or in which different functions can be called.</p><p>A function call often ends a stage and transitions the contract into the next stage.</p><p>Function modifiers can be used in this situation to model the states and guard against incorrect usage of the contract.</p><p>In the following example, the modifier <code>atStage</code> ensures that the function can only be called at a certain stage, automatic timed transitions are handled by the modifier <code>timeTransitions</code>, which should be used for all functions.</p><blockquote><p>Modifier Order Matters: If <code>atStage</code> is combined with <code>timedTransitions</code>, make sure that you mention it after the latter, so that the new stage is taken into account.</p></blockquote><p>Finally, the modifier <code>transitionNext</code> can be used to automatically go to the next stage when the function finishes.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.11</span>;</span><br><span class="line"></span><br><span class="line">contract StateMachine &#123;</span><br><span class="line">    enum Stages &#123;</span><br><span class="line">        AcceptingBlindedBids,</span><br><span class="line">        RevealBids,</span><br><span class="line">        AnotherStage,</span><br><span class="line">        AreWeDoneYet,</span><br><span class="line">        Finished</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Stages public stage = Stages.AcceptingBlindedBids;</span><br><span class="line"></span><br><span class="line">    uint public creationTime = now;</span><br><span class="line"></span><br><span class="line">    modifier atStage(Stages _stage) &#123;</span><br><span class="line">        <span class="built_in">require</span>(stage == _stage);</span><br><span class="line">        _;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">nextStage</span>(<span class="params"></span>) <span class="title">internal</span> </span>&#123;</span><br><span class="line">        stage = Stages(uint(stage) + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    modifier timedTransitions() &#123;</span><br><span class="line">      <span class="keyword">if</span> (stage == Stages.AcceptingBlindedBids &amp;&amp; now &gt;= creationTime + <span class="number">10</span> days)</span><br><span class="line">          nextStage();</span><br><span class="line">      <span class="keyword">if</span> (stage == Stages.RevealBids &amp;&amp; now &gt;= creationTime + <span class="number">12</span> days)</span><br><span class="line">          nextStage();</span><br><span class="line">      _;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">bid</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        <span class="title">payable</span></span></span><br><span class="line"><span class="function">        <span class="title">timedTransitions</span></span></span><br><span class="line"><span class="function">        <span class="title">atStage</span>(<span class="params">Stages.AcceptingBlindedBids</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">reveal</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        <span class="title">timedTransitions</span></span></span><br><span class="line"><span class="function">        <span class="title">atStage</span>(<span class="params">Stages.RevealBids</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Ethereum </tag>
            
            <tag> Blockchain </tag>
            
            <tag> Smart Contract </tag>
            
            <tag> Solidity </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Solidity Style Guide</title>
      <link href="/2017/11/14/Solidity-Style-Guide/"/>
      <url>/2017/11/14/Solidity-Style-Guide/</url>
      
        <content type="html"><![CDATA[<h3 id="Layout"><a href="#Layout" class="headerlink" title="Layout"></a>Layout</h3><p>4 spaces per indentation level</p><p>Use spaces for indentation</p><p>Use blank lines</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">contract A &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract B &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Blank lines may be omitted between groups of related one-liners</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">contract A &#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">spam</span>(<span class="params"></span>);</span></span><br><span class="line"><span class="function">  <span class="title">function</span> <span class="title">ham</span>(<span class="params"></span>);</span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure><p>Use <code>UTF-8</code> or <code>ASCII</code> encoding</p><p>Place import statements at the top of the file</p><p>Functions should be be grouped according to their visibility and ordered:</p><ul><li><p>constructor</p></li><li><p>fallback function (if exists)</p></li><li><p>external</p></li><li><p>public</p></li><li><p>internal</p></li><li><p>private</p></li></ul><p>Within a grouping, place the <code>constant</code> functions last.</p><p>Use white spaces in expressions</p><p>Avoid extraneous whitespaces inthe following situations: immediately inside parenthesis, brackets or braces, with the exception of single line function declaration.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">spam(ham[<span class="number">1</span>], Coin(&#123;<span class="attr">name</span>: <span class="string">&quot;han&quot;</span>&#125;)):</span><br><span class="line"></span><br><span class="line"><span class="comment">// exception</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">singleLine</span>(<span class="params"></span>) </span>&#123; spam() &#125;</span><br></pre></td></tr></table></figure><p>More than one space around an assignment or other operator to align with</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x = <span class="number">1</span>;</span><br><span class="line">y = <span class="number">2</span>;</span><br><span class="line">long_variable = <span class="number">3</span>;</span><br></pre></td></tr></table></figure><p>Don’t include a whitespace in the fallback function</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// not </span></span><br><span class="line"><span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>For control structure whose body contains a single statement, omitting the braces is ok if the statement is contained on a single line</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (x &lt; <span class="number">10</span>)</span><br><span class="line">    x += <span class="number">1</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    x -= <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>Function declaration</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">increment</span>(<span class="params">uint x</span>) <span class="title">returns</span> (<span class="params">uint</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// visibility precedes custom modifier</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">increment</span>(<span class="params">uint x</span>) <span class="title">public</span> <span class="title">onlyOwner</span> <span class="title">returns</span> (<span class="params">uint</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// long parameters list</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">increment</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    uint x1,</span></span></span><br><span class="line"><span class="function"><span class="params">    uint x2,</span></span></span><br><span class="line"><span class="function"><span class="params">    uint x3,</span></span></span><br><span class="line"><span class="function"><span class="params">    uint x4,</span></span></span><br><span class="line"><span class="function"><span class="params">    uint x5,</span></span></span><br><span class="line"><span class="function"><span class="params">    uint x6,</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// long visibility modifier list</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">increment</span> (<span class="params">uint x</span>)</span></span><br><span class="line"><span class="function">    <span class="title">public</span></span></span><br><span class="line"><span class="function">    <span class="title">onlyOwner</span></span></span><br><span class="line"><span class="function">    <span class="title">priced</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Stirng should be quoted with double-quotes.</p><p>Contract and Library Names should be named using the CapWords style.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SimpleToken,</span><br><span class="line">SmartBank,</span><br></pre></td></tr></table></figure><p>Event Names should use CapWords</p><p>Function Names should use CamelCase</p><p>Function Arguments should use CamelCase</p><p>Local and State Variables should use CamelCase</p><p>Constants should be named with all captial letters with underscores seperating words: <code>MAX_BLOCKS</code></p><p>Modifier should use CamelCase</p>]]></content>
      
      
      
        <tags>
            
            <tag> Ethereum </tag>
            
            <tag> Blockchain </tag>
            
            <tag> Smart Contract </tag>
            
            <tag> Solidity </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Notes on Solidity in Depth</title>
      <link href="/2017/11/10/Notes-on-Solidity-in-Depth/"/>
      <url>/2017/11/10/Notes-on-Solidity-in-Depth/</url>
      
        <content type="html"><![CDATA[<h3 id="Layout-of-a-Solidity-Source-File"><a href="#Layout-of-a-Solidity-Source-File" class="headerlink" title="Layout of a Solidity Source File"></a>Layout of a Solidity Source File</h3><h4 id="Version-Pragma"><a href="#Version-Pragma" class="headerlink" title="Version Pragma"></a>Version Pragma</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.11</span>;</span><br></pre></td></tr></table></figure><h4 id="Importing-other-Source-File"><a href="#Importing-other-Source-File" class="headerlink" title="Importing other Source File"></a>Importing other Source File</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;filename&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> symbolName <span class="keyword">from</span> <span class="string">&quot;filename&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; symbol <span class="keyword">as</span> alias, symbol2 &#125; <span class="keyword">from</span> <span class="string">&quot;filename&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;filename&quot;</span> <span class="keyword">as</span> symbolName;</span><br></pre></td></tr></table></figure><p>In the above, <code>filename</code> is always treated as a path with <code>/</code> as directory seperator.</p><p>All path names are treated as absolute paths unless thay start with <code>.</code> or <code>..</code>.</p><h5 id="Remapping"><a href="#Remapping" class="headerlink" title="Remapping"></a>Remapping</h5><p>For example, remap <code>github.com/ethereum/dapp-bin/library</code> to <code>/usr/local/dapp-bin/library</code></p><p><strong>solc</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;github.com/ethereum/dapp-bin/library/iterable_mapping.sol` as it_mapping;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">solc github.com/ethereum/dapp-bin/=/usr/<span class="built_in">local</span>/dapp-bin/ source.sol</span><br></pre></td></tr></table></figure><h4 id="Comments"><a href="#Comments" class="headerlink" title="Comments"></a>Comments</h4><p>Single Line Comments: <code>//</code></p><p>Multi-line Comments: <code>/* ... */</code></p><p>Natspec Comments: <code>///</code> or <code>/** ... */</code></p><p>Natspec should be used directly above function declarations or statements.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.11</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** <span class="doctag">@title </span>Shape calculator */</span></span><br><span class="line">contract shapeCaculator &#123;</span><br><span class="line">  <span class="comment">/** <span class="doctag">@dev </span>Calculates a rectangle&#x27;s surface and perimeter.</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param </span>w Width of the rectangle.</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param </span>h Height of the rectangle.</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param </span>s The calculated surface.</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param </span>p The calculated perimeter.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">rectangle</span>(<span class="params">uint w, uint h</span>) <span class="title">returns</span> (<span class="params">uint s, uint p</span>) </span>&#123;</span><br><span class="line">    s = w * h;</span><br><span class="line">    p = <span class="number">2</span> * (w + h);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Structure-of-Contract"><a href="#Structure-of-Contract" class="headerlink" title="Structure of Contract"></a>Structure of Contract</h3><p>Contracts in Solidity are similar to classes in object-oriented languages. Each contract can contain declarations of <strong>State Variables</strong>, <strong>Functions</strong>, <strong>Function Modifiers</strong>, <strong>Events</strong>, <strong>Struct Types</strong> and <strong>Enum Types</strong>.</p><h4 id="State-Variables"><a href="#State-Variables" class="headerlink" title="State Variables"></a>State Variables</h4><p>State variables are values which are permanently stored in contract storage.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.11</span>;</span><br><span class="line"></span><br><span class="line">contract SimpleStorage &#123;</span><br><span class="line">  uint storedData; <span class="comment">// state variable</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Functions"><a href="#Functions" class="headerlink" title="Functions"></a>Functions</h4><p>Functions are executable units of code within a contract.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.11</span>;</span><br><span class="line"></span><br><span class="line">contract SimpleAuction &#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">bid</span>(<span class="params"></span>) <span class="title">payable</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Function-Modifiers"><a href="#Function-Modifiers" class="headerlink" title="Function Modifiers"></a>Function Modifiers</h4><p>Function modifiers can be used to amend the semantics of functions in a declarative way.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.11</span>;</span><br><span class="line"></span><br><span class="line">contract Purchase &#123;</span><br><span class="line">  address public seller;</span><br><span class="line"></span><br><span class="line">  modifier onlySeller () &#123; <span class="comment">// Modifier</span></span><br><span class="line">    <span class="built_in">require</span>(msg.sender == seller);</span><br><span class="line">    _;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">abort</span>(<span class="params"></span>) <span class="title">onlySeller</span> </span>&#123; <span class="comment">// Modifier usage</span></span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Events"><a href="#Events" class="headerlink" title="Events"></a>Events</h4><p>Events are convenience interfaces with the EVM logging facilities.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.11</span>;</span><br><span class="line"></span><br><span class="line">contract SimpleAuction &#123;</span><br><span class="line">  event HighestBidIncreased(address bidder, uint amount);</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">bid</span>(<span class="params"></span>) <span class="title">payable</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    HighestBidIncreased(msg.sender, msg.value);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Struct-Types"><a href="#Struct-Types" class="headerlink" title="Struct Types"></a>Struct Types</h4><p>Structs are custom defined types that can group several variables.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.11</span>;</span><br><span class="line"></span><br><span class="line">contract Ballot &#123;</span><br><span class="line">  struct Voter &#123;</span><br><span class="line">    uint weight;</span><br><span class="line">    bool voted;</span><br><span class="line">    address delegate;</span><br><span class="line">    uint vote;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Enum-Types"><a href="#Enum-Types" class="headerlink" title="Enum Types"></a>Enum Types</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.0</span>;</span><br><span class="line"></span><br><span class="line">contract Purchase &#123;</span><br><span class="line">  enum State &#123;</span><br><span class="line">    Created,</span><br><span class="line">    Locked,</span><br><span class="line">    Inactive</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Types"><a href="#Types" class="headerlink" title="Types"></a>Types</h4><ul><li><p><code>bool</code>: <code>true</code> or <code>false</code></p><ul><li><p><code>!</code> logical negation</p></li><li><p><code>&amp;&amp;</code> logical and</p></li><li><p><code>||</code> logical or</p></li><li><p><code>==</code> logical equality</p></li><li><p><code>!=</code> logical inequality</p></li></ul></li><li><p><code>int/uint</code>: <code>uint8</code> to <code>uint256</code>, <code>int8</code> to <code>int256</code></p><ul><li><p><code>&lt;=</code>, <code>&gt;=</code>, <code>==</code>, <code>!=</code>, <code>&lt;</code>, <code>&gt;</code></p></li><li><p><code>&amp;</code>, <code>|</code>, <code>^</code>, <code>~</code>, bit operators</p></li><li><p><code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>%</code>, <code>**</code>, <code>&lt;&lt;</code>, <code>&gt;&gt;</code></p></li></ul></li><li><p><code>address</code>: holds a 20 bytes value(size of an Ethereum address)</p><ul><li><code>&lt;=</code>, <code>=&gt;</code>, <code>==</code>, <code>!=</code>, <code>&lt;</code>, <code>&gt;</code></li></ul></li></ul><blockquote><p>Starting with version 0.5.0 contracts do not derive from the <code>address</code> type, but can still be explicitly converted to address.</p></blockquote><h4 id="Members-of-Address"><a href="#Members-of-Address" class="headerlink" title="Members of Address"></a>Members of Address</h4><ul><li><p><code>balance</code></p></li><li><p><code>transfer</code>, address.transfer(value), send value Wei to the address.</p></li><li><p><code>send</code>: Send is the low-level counterpart of <code>transfer</code>. If the execution fails, the current contract will not stop with an exception, but <code>send</code> will return <code>false</code></p></li></ul><blockquote><p>There are some dangers in using <code>send</code>: The transfer fails if the call stack depth is 1024 and it also fails if the recipient runs out of gas. So in order to make safe Ether transfers, always check the return value of <code>send</code>, use <code>transfer</code> or even better.</p></blockquote><ul><li><code>call</code>, <code>callcode</code>, and <code>delegatecall</code></li></ul><p>Furthermore, to interface with contracts that do not adhere to the ABI, the function <code>call</code> is provided which takes an arbitrary number of arguments of any type. The arguments are padding to 32 bytes and concatenated. One exception is the case where the first argument is encoded to exactly four bytes. In this case, it is not padding to allow the use of function signatures here.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">address nameReg = <span class="string">&#x27;0x72ba7d8e73fe8eb666ea66babc8116a41bfb10e2&#x27;</span>;</span><br><span class="line">nameReg.call(<span class="string">&#x27;register&#x27;</span>, <span class="string">&#x27;MyName&#x27;</span>);</span><br><span class="line">nameReg.call(bytes4(keccak256(<span class="string">&quot;fun(uint256))), );</span></span><br></pre></td></tr></table></figure><p><code>call</code> returns a boolean indicating whether the invoked function terminated (true) or caused an EVM exception (false). It is not possible to access the actual data returned.</p><p>It is possible to adjust the supplied gas with the <code>.gas()</code> modifier:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nameReg.call.gas(<span class="number">1000000000</span>)(<span class="string">&#x27;register&#x27;</span>, <span class="string">&#x27;myName&#x27;</span>);</span><br></pre></td></tr></table></figure><p>and supplied Ether value can be controlled too:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nameReg.call.value(<span class="number">1</span> ether)(<span class="string">&#x27;regiter&#x27;</span>, <span class="string">&#x27;myName&#x27;</span>);</span><br></pre></td></tr></table></figure><p>Chained</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nameReg.call.value(<span class="number">1</span> ether).gas(<span class="number">100000000</span>)(<span class="string">&#x27;register&#x27;</span>, <span class="string">&#x27;myName&#x27;</span>);</span><br></pre></td></tr></table></figure><p>In a similar way, the function <code>delegatecall</code> can be used: the difference is that only the code of the given address is used, all other aspects(storage, balance, …) are taken from the current contract. The purpose of <code>delegatecall</code> is to use library code which is stored in another contract. The user has to ensure that the layout of storage in both contracts is suitable for delegatecall to be used. Prior to homestead, only a limited variant called <code>callcode</code> was available that did not provide access to the original <code>msg.sender</code> and <code>msg.value</code>.</p><p>All three functions <code>call</code>, <code>delegatecall</code>, and <code>callcode</code> are very low-level functions and should only be used as a <em>last resort</em> as they break the type-safety of Solidity.</p><p>The <code>.gas()</code> option is available on all three methods, while the <code>.value()</code> option is not supported for <code>delegatecall</code>.</p><blockquote><p>All Contracts inherit the members of address, so it is possible to query the balance of the current contract using <code>this.balance</code>.</p></blockquote><blockquote><p>The use of <code>callcode</code> is discouraged and will be removed in the future.</p></blockquote><h4 id="Fixed-size-byte-array"><a href="#Fixed-size-byte-array" class="headerlink" title="Fixed-size byte array"></a>Fixed-size byte array</h4><ul><li><code>.length</code> yields the fixed length of the byte array(read-only)</li></ul><blockquote><p>It is possible to use an array of bytes as <code>byte[]</code>, but it is wasting a lot of space, 21 bytes every element, to be exact, when passing in calls. It is better to use <code>bytes</code>.</p></blockquote><h4 id="Dynamically-sized-byte-array"><a href="#Dynamically-sized-byte-array" class="headerlink" title="Dynamically-sized byte array"></a>Dynamically-sized byte array</h4><p><code>bytes</code>: dynamically-sized array, see Array, not a value-type.</p><p><code>string</code>: dynamically-sized UTF-8-encoded string, see Array, not a value-type.</p><h4 id="Address-Liberals"><a href="#Address-Liberals" class="headerlink" title="Address Liberals"></a>Address Liberals</h4><p>Hexadecimal literals that pass the address checksum test, for example <code>0xdCad3a6d3569DF655070DEd06cb7A1b2Ccd1D3AF</code> are of <code>address</code> type. Hexadecimal literals that are between 39 and 41 digits long and do not pass the checksum test produce a warning and are treated as regular rational number literals</p><h4 id="Rational-and-Integer-Literals"><a href="#Rational-and-Integer-Literals" class="headerlink" title="Rational and Integer Literals"></a>Rational and Integer Literals</h4><p>Integer literal are formed form a sequence of numbers in the range 0-9. They are interpreted as decimals, for example, <code>69</code> means sixty nine. Octal literals do not exist in Solidity and leading zeros are invalid.</p><p>Decimal fraction literals are formed by a <code>.</code> with at least one number on one side(<code>1.</code>, <code>.2</code>, <code>1.3</code>)</p><p>Scientific notation is also supported, where the base can have fractions, white the exponent cannot(2e10, -2e10, 2e-10, 2.5e10)</p><p>Number literal expressions retains arbitrary precision until they are converted to a non-literal type.</p><p>For example <code>(2**800 + 1) - 2**800</code> result in the constant <code>1</code>, <code>.5 * 8</code> results in the integer <code>4</code></p><blockquote><p>Number literal expressions are converted into a non-literal type as soon as they are used with non-literal expressions. Even though we know that the value of the expression assigned to <code>b</code> in the following example evaluates to an integer, but the partial expression <code>2.5 + a</code> does not type check so the code does not compile.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">uint128 a = <span class="number">1</span>;</span><br><span class="line">uint128 b = <span class="number">2.5</span> + a + <span class="number">0.5</span>;</span><br></pre></td></tr></table></figure><h4 id="String-Literals"><a href="#String-Literals" class="headerlink" title="String Literals"></a>String Literals</h4><p>String literals are written with either double or sinlge-quotes. They do not imply trailing zeros as in C, <code>&quot;foo&quot;</code> represents three bytes not four.</p><p>String Literal supports escape characters, such as <code>\n</code>, <code>\xNN</code> and <code>\uNNNN</code>.</p><h4 id="Hexadecimal-Literals"><a href="#Hexadecimal-Literals" class="headerlink" title="Hexadecimal Literals"></a>Hexadecimal Literals</h4><p><code>hex&quot;001122FF&quot;</code></p><h4 id="Enums"><a href="#Enums" class="headerlink" title="Enums"></a>Enums</h4><p>Enums are one way to create a user-defined type in Solidity. They are explicitly convertable to and from all integer types but implicit conversion is not allowed. The explicit conversions check the value ranges at runtime, and a failure causes an exception.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.11</span>;</span><br><span class="line"></span><br><span class="line">contract test &#123;</span><br><span class="line">  enum ActionChoices &#123;</span><br><span class="line">    GoLeft,</span><br><span class="line">    GoRight,</span><br><span class="line">    GoStraight,</span><br><span class="line">    GoStill</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ActionChoices choice;</span><br><span class="line">  ActionChoices constant defaultChoice = ActionChoices.GoStraight;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setGoStraight</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    choice = ActionChoices.GoStraight;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getChoice</span>(<span class="params"></span>) <span class="title">returns</span> (<span class="params">ActionChoices</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> choice;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getDefaultChoice</span>(<span class="params"></span>) <span class="title">returns</span> (<span class="params">uint</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> uint(defaultChoice);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Function-Types"><a href="#Function-Types" class="headerlink" title="Function Types"></a>Function Types</h4><p>Function types are notated as follows:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> (<span class="params">&lt;parameter types&gt;</span>) </span>&#123;internal|external&#125; [pure|constant|view|payable] [returns (<span class="xml"><span class="tag">&lt;<span class="name">return</span> <span class="attr">types</span>&gt;</span>)]</span></span><br></pre></td></tr></table></figure><p>In contrast to the parameter types, the return types cannot be empty - if the function type should not return anything, the whole <code>returns (&lt;return type&gt;)</code> part has to be omitted.</p><p>Public (or external) functions have a special member called <code>selector</code>, which returns the <code>ABI function selector</code>:</p><h4 id="Reference-Types"><a href="#Reference-Types" class="headerlink" title="Reference Types"></a>Reference Types</h4><p>Complex types, i.e. types which do not always fit into 256 bits have to be handled more carefully than than the value-types we have already seen. Since copying them can be quite expensive, we have to think about whether we want them to be store in <strong>memory</strong>(which is not persisting) or <strong>storage</strong>(where the state variables are held).</p><h4 id="Data-location"><a href="#Data-location" class="headerlink" title="Data location"></a>Data location</h4><p>Every complex type, i.e. <em>arrays</em> and <em>structs</em> has an additional annotation, the “data location” about where it is stored in <strong>memory</strong> or in <strong>storage</strong>. Depending on the context, there is always a default, but it can be overrideen by appeding either <code>storage</code> or <code>memory</code> to the type. The default for function parameters(including return parameters) is <strong>memory</strong> the default for local variable is <strong>storage</strong> and the location is forced to <strong>storage</strong> for state variables</p><p>There is also a third data location, <strong>calldata</strong>, which is a non-modificable, non-persistent area where function arguments are stored. Function parameter(not return parameters) of external functions are forced to <strong>calldata</strong> and behave mostly like <strong>memory</strong>.</p><p>Data locations are imortant because they change how assignment behave: assignments between storage and memory and also to a state variable always create an independent copy. Assignments to local storage variables only assign a reference though, and this reference always points to the state variable even if the latter is changed in the meantime. On the other hand, assignments from a memory stoted reference type to another memory-stored reference type do not create a copy.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.11</span>;</span><br><span class="line"></span><br><span class="line">contract C &#123;</span><br><span class="line">  uint[] x; <span class="comment">// the data location of x is storage</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// the data location of memoryArray is memory</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">uint[] memoryArray</span>) </span>&#123;</span><br><span class="line">    x = memoryArray; <span class="comment">// works, copy the whole array to storage</span></span><br><span class="line">    <span class="keyword">var</span> y = x; <span class="comment">// works, assigns a pointer, data location of y is storage</span></span><br><span class="line">    y[<span class="number">7</span>]; <span class="comment">// fine, returns the 8th element</span></span><br><span class="line">    y.length = <span class="number">2</span>; <span class="comment">// fine, modifies x through y</span></span><br><span class="line">    <span class="keyword">delete</span> x; <span class="comment">// fine, clears the array, also modifies y</span></span><br><span class="line">    <span class="comment">// the following does not work; it would need to create a new temporary / unamed array in storage, but storage is &#x27;statically&#x27; allocated</span></span><br><span class="line">    <span class="comment">// y = memoryArray;</span></span><br><span class="line">    <span class="comment">// This does not work either, since it would &#x27;reset&#x27; the pointer, but there is not sensible location it could point to.</span></span><br><span class="line">    <span class="comment">// delete y;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h5><ul><li><p>Forced data location:</p><ul><li><p>parameters(not return) of external functions: calldata</p></li><li><p>state variables: storage</p></li></ul></li><li><p>Default data location:</p><ul><li><p>parameters(also return) of functions: memory</p></li><li><p>all other local variables: storage</p></li></ul></li></ul><h4 id="Arrays"><a href="#Arrays" class="headerlink" title="Arrays"></a>Arrays</h4><p>An array of fixed size <code>k</code> and element type <code>T</code> is written as <code>T[k]</code></p><p>An array of dynamic size as <code>T[]</code></p><p>An array of 5 dynamic arrays of <code>uint</code> is <code>uint[][5]</code>. (note that the notation is reversed when compared to some other language). To access the second uint in the third dynamic array, you use <code>x[2][1]</code></p><p>Variables of type <code>bytes</code> and <code>string</code> are special arrays. A <code>bytes</code> is similar to <code>byte[]</code>, but it is packed tightly in calldata. <code>string</code> is equal to <code>bytes</code> but does not allow length or index access(for now).</p><p>So <code>bytes</code> should always be preferred over <code>byte[]</code> because it is cheaper.</p><h4 id="Structs"><a href="#Structs" class="headerlink" title="Structs"></a>Structs</h4><p>Solidity provides a way to define new types in the form of structs, which is shown in the following example:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.11</span>;</span><br><span class="line"></span><br><span class="line">contract CrowdFunding &#123;</span><br><span class="line">  struct Funder &#123;</span><br><span class="line">    address addr;</span><br><span class="line">    uint amount;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  struct Campaign &#123;</span><br><span class="line">    address beneficiary;</span><br><span class="line">    uint fundingGoal;</span><br><span class="line">    uint numFunders;</span><br><span class="line">    uint amount;</span><br><span class="line">    mapping(<span class="function"><span class="params">uint</span> =&gt;</span> Funder) funders;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>It is not possible for a struct to contain a member of its own type, although the struct itself can be the value type of a mapping member. This restriction is necessary, as the size of the struct has to be finite.</p><h4 id="Mappings"><a href="#Mappings" class="headerlink" title="Mappings"></a>Mappings</h4><p>Mapping types are declared as <code>mapping(_keyType =&gt; _valueType)</code>. Here <code>_keyType</code> can be almost any type except for a mapping, a dynamically sized array, a contract, an enum, and a struct. <code>_valueType</code> can actually be any type, including mappings.</p><p>Mappings can be seen as hash tables which are virtually initialized such that every possible key exists and is mapped to a value whose byte-representation is all zeros: a type’s default value.</p><p>Mappings are only allowed for state variables( or as storage reference types in internal function).</p><p>It is possible to mark mapping <code>public</code> and have Solidity create a getter. The <code>_keyType</code> will become a required parameter for the getter and it will return <code>_valueType</code>.</p><p>Mappings are not iterable, but it is possible to implement a data structure on top of them.</p><h4 id="Operators-Involving-LValues"><a href="#Operators-Involving-LValues" class="headerlink" title="Operators Involving LValues"></a>Operators Involving LValues</h4><p>LValue, i.e. a variable or something that can be assigned to.</p><h5 id="delete"><a href="#delete" class="headerlink" title="delete"></a>delete</h5><p><code>delete a</code> assigns the initial value for the type to a. I.e., for integers, it is equivalent to <code>a = 0</code>.</p><p><code>delete</code> has no effect on whole mappints. So if you delete a struct, it will reset all members that are not mappings and also recurse into the memebers unless they are mappings. However, individual keys and what they map to can be deleted.</p><p>It’s really important to note that <code>delete a</code> really behaves like an assignment to <code>a</code>, it stores a new object in <code>a</code>.</p><h4 id="Conversions-between-Elementary-Types"><a href="#Conversions-between-Elementary-Types" class="headerlink" title="Conversions between Elementary Types."></a>Conversions between Elementary Types.</h4><h5 id="Implicit-Conversions"><a href="#Implicit-Conversions" class="headerlink" title="Implicit Conversions"></a>Implicit Conversions</h5><p>In general, an implicit conversion between value-types is possible if it makes sense semantically and no information is lost: <code>uint8</code> is convertible to <code>uint16</code>, but <code>uint16</code> is not convertible to <code>uint8</code>. And <code>int8</code> is not convertible to <code>uint256</code>(because <code>uint256</code> cannot hold hold e.g. <code>-1</code>).</p><h5 id="Explicit-Conversions"><a href="#Explicit-Conversions" class="headerlink" title="Explicit Conversions"></a>Explicit Conversions</h5><p>If the compiler does not allow implicit conversion but you know what you are doing, an explicit type conversion is sometimes possible.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">int8 y = <span class="number">-3</span>;</span><br><span class="line">uint x = uint(y);</span><br></pre></td></tr></table></figure><h4 id="Type-Deduction"><a href="#Type-Deduction" class="headerlink" title="Type Deduction"></a>Type Deduction</h4><p>For convenience, it is not always necessary to explicitly specify the type of a variable, the compiler automatically infers it from the type of the first expression that is assigned to the variable:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">uint24 x = <span class="number">0x123</span>;</span><br><span class="line"><span class="keyword">var</span> y = x;</span><br></pre></td></tr></table></figure><h3 id="Units-and-Globally-Available-Variables"><a href="#Units-and-Globally-Available-Variables" class="headerlink" title="Units and Globally Available Variables"></a>Units and Globally Available Variables</h3><h4 id="Ether-Units"><a href="#Ether-Units" class="headerlink" title="Ether Units"></a>Ether Units</h4><p>A literal number can take a suffix of <code>wei</code>, <code>finney</code>, <code>szabo</code>, or <code>ether</code> to convert between the subdenominations of Ether, where Ether currency numbers without a postfix are assumed to be Wei.</p><p><code>2 ether === 2000 finney</code> evaluates to <code>true</code></p><h4 id="Time-Units"><a href="#Time-Units" class="headerlink" title="Time Units"></a>Time Units</h4><p>Suffixes like <code>seconds</code>, <code>minutes</code>, <code>hours</code>, <code>days</code>, <code>weeks</code> and <code>years</code> after literal numbers can be used to convert between units of time where seconds are the base unit.</p><p>Take care if you perform calendar calculations using these units, because not every year equals 365 days and not even every day has 24 hours because of leap seconds. Due to the fact that leap seconds cannot be predicted, an exact calendar library has to be updated by an external oracle.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">unit start, unit dayAfter</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (now &gt;= start + dayAfter + <span class="number">1</span> days) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Other Global Variables and Functions:</p><p><a href="http://ezcook.de/2017/11/10/Solidity-CheatSheet/">Post</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> Ethereum </tag>
            
            <tag> Blockchain </tag>
            
            <tag> Smart Contract </tag>
            
            <tag> Solidity </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Solidity CheatSheet</title>
      <link href="/2017/11/10/Solidity-CheatSheet/"/>
      <url>/2017/11/10/Solidity-CheatSheet/</url>
      
        <content type="html"><![CDATA[<h3 id="Global-Variables"><a href="#Global-Variables" class="headerlink" title="Global Variables"></a>Global Variables</h3><h4 id="Block"><a href="#Block" class="headerlink" title="Block"></a>Block</h4><ul><li><p>block.coinbase: address - current block miner’s address</p></li><li><p>block.difficulty: uint - current block difficulty</p></li><li><p>block.gaslimit: uint - current block gaslimit</p></li><li><p>block.number: uint - current block number</p></li><li><p>block.timestamp: uint - current block timestamp</p></li></ul><h4 id="Msg"><a href="#Msg" class="headerlink" title="Msg"></a>Msg</h4><ul><li><p>msg.data: bytes - complete calldata</p></li><li><p>msg.gas: uint - remaining gas</p></li><li><p>msg.sender: address - sender of the message(current call)</p></li><li><p>msg.value: uint - number of wei sent with the message</p></li></ul><h4 id="Now"><a href="#Now" class="headerlink" title="Now"></a>Now</h4><ul><li>now: uint - current block timestamp(alias for block.timestamp)</li></ul><h4 id="Tx"><a href="#Tx" class="headerlink" title="Tx"></a>Tx</h4><ul><li><p>tx.gasprice: uint - gas price of the transaction</p></li><li><p>tx.origin: address - sender of the transaction (full call chain)</p></li></ul><h3 id="Global-Functions"><a href="#Global-Functions" class="headerlink" title="Global Functions"></a>Global Functions</h3><ul><li><p>assert(bool condition): abort execution and revert state changes if condition is <code>false</code>(use for internal error)</p></li><li><p>require(bool condition): abort execution and revert state changes if condition is <code>false</code>(use for malformed input or error in external component)</p></li><li><p>revert(): abort execution and revert state changes</p></li><li><p>block.blockhash(uint blockNumber) returns (bytes32): hash of the given block - only works for 256 most recent blocks</p></li><li><p>sha256(…) returns (bytes32): compute the SHA-256 hash of the (tightly packed) arguments</p></li><li><p>keccak256(…) returns (bytes32): compute the Ethereum-SHA-3(Keccak-256) hash of the (tightly packed) arguments</p></li><li><p>sha3(…) returns (bytes32): alias for keccak256</p></li><li><p>ecrecover(bytes32 hash, uint8 v, bytes32 r, bytes32 s) returns (address): recover address associated with the public key from elliptic curve signature</p></li><li><p>addmod(uint x, uint y, uint k) returns (uint): compute <code>(x + y) % k</code> where the addition is performed with arbitrary precision and does not wrap around at 2 ** 256</p></li><li><p>mulmod(uint x, uint y, uint k) returns (uint): compute <code>(x * y) % k</code> where the addition is performed with arbitrary precision and does not wrap around 2 ** 256</p></li><li><p>selfdestruct(address recipient): destroy the current contract, sending its funds to the given address</p></li><li><p>suicide(address recipient): alias for selfdestruct</p></li><li><address>.balance: uint256: balance of the Address in Wei</li><li><address>.send(uint256 amount) returns (bool): send given amount of Wei to Address, returns `false` on failure</li><li><address>.transfer(uint256 amount): send given amount of Wei to Address, throws on failure.</li></ul><h3 id="Scope-Variables"><a href="#Scope-Variables" class="headerlink" title="Scope Variables"></a>Scope Variables</h3><ul><li><p>this: current contract’s type - the current contract, explicitly convertable to address</p></li><li><p>super: the contract one level higher in the inheritance hierarchy</p></li></ul><h3 id="Function-Visibility-Specifier"><a href="#Function-Visibility-Specifier" class="headerlink" title="Function Visibility Specifier"></a>Function Visibility Specifier</h3><ul><li><p>public: visible externally and internally(creates accessor function for storage/state variables)</p></li><li><p>private: only visible in the current contract</p></li><li><p>external: only visible externally(only for functions) - i.e. can only be message-called)</p></li><li><p>internal: only visible internally</p></li></ul><h3 id="Modifiers"><a href="#Modifiers" class="headerlink" title="Modifiers"></a>Modifiers</h3><ul><li><p>pure: for function - disallows modification or access of state - this is not enforced yet</p></li><li><p>view: for function - disallows modifiction of state - this is not enforced yet</p></li><li><p>payable: for function - allows them to receive Ether together with a call</p></li><li><p>constant: for state variable - disallow assignment(except initialization), does not occupy storage slot</p></li><li><p>contant: for function - same as view</p></li><li><p>anonymous: for events - does not store event signature as topic</p></li><li><p>indexed: for event parameters - store the parameter as topic</p></li></ul><p><img src="https://s3-eu-west-1.amazonaws.com/b9-academy-assets/public/solidity-cheatsheet.png"></p>]]></content>
      
      
      
        <tags>
            
            <tag> Ethereum </tag>
            
            <tag> Blockchain </tag>
            
            <tag> Smart Contract </tag>
            
            <tag> Solidity </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HTTP/2 by Node.js</title>
      <link href="/2017/11/07/HTTP-2-by-Node-js/"/>
      <url>/2017/11/07/HTTP-2-by-Node-js/</url>
      
        <content type="html"><![CDATA[<p><a href="https://dexecure.com/blog/how-to-create-http2-static-file-server-nodejs-with-examples/">Original</a></p><p>Websites delivered using HTTP/2 enjoys a wide range of new features including -</p><ul><li><p>fully multiplexed connections: all requests and responses to a domain are fully multiplexed via a single connection, making best use of available bandwidth.</p></li><li><p>header compression: repeated headers are compressed with HPACK compression so that they are not resent with every request and response.</p></li><li><p>PUSH: resources can be pre-emptively pushed by the server to the client, speeding up page load times.</p></li></ul><p>Node.js just launched support(v8.8.1) for HTTP/2 as part of their core. In this post, we will create a simple HTTP/2 server to serve static files and then demonstrate some cool features like HTTP/2 PUSH.</p><h3 id="Get-an-SSL-certificate"><a href="#Get-an-SSL-certificate" class="headerlink" title="Get an SSL certificate"></a>Get an SSL certificate</h3><p>Even though the HTTP/2 spec does not mandate HTTPS, browsers have decided that they will only support HTTP/2 on a HTTPS connection. This would also mitigate interference from older proxies which may not understand newer protocol.</p><p>For your local server, a self-signed certificate will work. You can find how to setup a self-signed certificate <a href="https://www.digitalocean.com/community/tutorials/how-to-create-a-self-signed-ssl-certificate-for-nginx-in-ubuntu-16-04">here</a></p><h3 id="Building-a-Static-File-Server"><a href="#Building-a-Static-File-Server" class="headerlink" title="Building a Static File Server"></a>Building a Static File Server</h3><p>Let us start with a simple server which just serves static files. Note that if you are using node.js 8.7.0, you need to run node with the <code>--expose-http2</code> flag.</p><p>We will be listening to the <code>stream</code> event and responding to it with the corresponding file from the server root(public, in this case) using the <code>respondWithFile</code> API. We are using the <code>mime-type</code> module to look up the correct mime type to send along with the response.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http2 = <span class="built_in">require</span>(<span class="string">&#x27;http2&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> mime = <span class="built_in">require</span>(<span class="string">&#x27;mime-types&#x27;</span>)</span><br><span class="line"></span><br><span class="line">cosnt &#123;</span><br><span class="line">  HTTP2_HEADER_PATH,</span><br><span class="line">  HTTP2_HEADER_METHOD,</span><br><span class="line">  HTTP_STATUS_NOT_FOUND,</span><br><span class="line">  HTTP_STATUS_INTERNAL_SERVER_ERROR</span><br><span class="line">&#125; = http2.constants</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> options = &#123;</span><br><span class="line">  key: fs.readFileSync(<span class="string">&#x27;./selfsigned.key&#x27;</span>),</span><br><span class="line">  cert: fs.readFileSync(<span class="string">&#x27;./selfsigned.crt&#x27;</span>),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http2.createSecureServer(options)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> serverRoot = <span class="string">&#x27;./public&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">respondToStreamError</span>(<span class="params">err, stream</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err)</span><br><span class="line">  <span class="keyword">if</span> (err.code === <span class="string">&#x27;ENOENT&#x27;</span>) &#123;</span><br><span class="line">    stream.respond(&#123;</span><br><span class="line">      <span class="string">&#x27;:stats&#x27;</span>: HTTPS_STATUS_NOT_FOUND,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    stream.respond(&#123;</span><br><span class="line">      <span class="string">&#x27;:status&#x27;</span>: HTTP_STATUS_INTERNAL_SERVER_ERROR,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  stream.end()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">&#x27;stream&#x27;</span>, <span class="function">(<span class="params">stream, headers</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> reqPath = headers[HTTP2_HEADER_PATH]</span><br><span class="line">  <span class="keyword">const</span> reqMethod = headers[HTTP2_METHOD]</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> fullPath = path.join(serverRoot, reqPath)</span><br><span class="line">  <span class="keyword">const</span> responseMimeType = mime.lookup(fullPath)</span><br><span class="line"></span><br><span class="line">  stream.respondWithFile(fullPath, &#123;</span><br><span class="line">    <span class="string">&#x27;content-type&#x27;</span>: responseMimeType</span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    onError: <span class="function"><span class="params">err</span> =&gt;</span> respondToStreamError(err, stream)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">443</span>)</span><br></pre></td></tr></table></figure><h3 id="Server-PUSH-Example"><a href="#Server-PUSH-Example" class="headerlink" title="Server PUSH Example"></a>Server PUSH Example</h3><p>Now we have simpel HTTP/2 server running, lets try to use one of the new featues in HTTP/2 - HTTP/2 PUSH. This can lead to significant performance improvements in high latency environments, if done correctly.</p><p>We are loading a simple HTML file pointing to style.css which references to our font file. The request to the font file is only made after css file is discovered in the HTML, downloaded and then parsed. This is how the waterfall would have usually looked like:</p><p><img src="https://dexecure.com//images/blog/waterfall-without-http2.53b722f2.png"></p><p>You can initate a new PUSH with the <code>pushStream</code> API. Since we know that the browser is going to be requesting the font file in the future, we can PUSH the font file as soon as the server receives the request for the HTML file.</p><p>When the actual request for the font file takes place, it is claimed from the PUSH cache, instead of making a network request then.</p><p><img src="https://dexecure.com//images/blog/waterfall-with-http2.b47218ea.png"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http2 = <span class="built_in">require</span>(<span class="string">&#x27;http2&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> mime = <span class="built_in">require</span>(<span class="string">&#x27;mime-types&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">  HTTP2_HEADER_PATH,</span><br><span class="line">  HTTP2_HEADER_METHOD,</span><br><span class="line">  HTTP_STATUS_NOT_FOUND,</span><br><span class="line">  HTTP_STATUS_INTERNAL_SERVER_ERROR,</span><br><span class="line">&#125; = http2.constants</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> options = &#123;</span><br><span class="line">  key: fs.readFileSync(<span class="string">&#x27;./selfsigned.key&#x27;</span>),</span><br><span class="line">  cert: fs.readFileSync(<span class="string">&#x27;./selfsigned.crt&#x27;</span>),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http2.createSecureServer(options)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> serverRoot = <span class="string">&#x27;./public&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">respondToStreamError</span> (<span class="params">err, stream</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err)</span><br><span class="line">  <span class="keyword">if</span> (err.code === <span class="string">&#x27;ENOENT&#x27;</span>) &#123;</span><br><span class="line">    stream.respond(&#123;</span><br><span class="line">      <span class="string">&#x27;:status&#x27;</span>: HTTP_STATUS_NOT_FOUND,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    stream.respond(&#123;</span><br><span class="line">      <span class="string">&#x27;:status&#x27;</span>: HTTP_STATUS_INTERNAL_SERVER_ERROR,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  stream.end()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">&#x27;stream&#x27;</span>, <span class="function">(<span class="params">stream, headers</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> reqPath = headers[HTTP2_HEADER_PATH]</span><br><span class="line">  <span class="keyword">const</span> reqMethod = headers[HTTP2_HEADER_METHOD]</span><br><span class="line">  <span class="keyword">const</span> fullPath = path.join(serverRoot, reqPath)</span><br><span class="line">  <span class="keyword">const</span> responseMimeType = mime.lookup(fullPath)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (fullPath.endsWith(<span class="string">&#x27;.html&#x27;</span>)) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;html&#x27;</span>)</span><br><span class="line">    <span class="comment">// handle the html file</span></span><br><span class="line">    stream.respondWithFile(fullPath, &#123;</span><br><span class="line">      <span class="string">&#x27;content-type&#x27;</span>: <span class="string">&#x27;text/html&#x27;</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">      onError: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        respondToStreamError(err, stream)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    stream.pushStream(&#123;</span><br><span class="line">      <span class="string">&#x27;:path&#x27;</span>: <span class="string">&#x27;/font.woff&#x27;</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">      parent: stream.id,</span><br><span class="line">    &#125;, <span class="function"><span class="params">pushStream</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;pushing&#x27;</span>)</span><br><span class="line">      pushStream.respondWithFile(path.join(serverRoot, <span class="string">&#x27;/font.woff&#x27;</span>), &#123;</span><br><span class="line">        <span class="string">&#x27;content-type&#x27;</span>: <span class="string">&#x27;text/css&#x27;</span>,</span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        onError: <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">          respondToStreamError(err, pushStream)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// handle the static file</span></span><br><span class="line">    <span class="built_in">console</span>.log(fullPath)</span><br><span class="line">    stream.respondWithFile(fullPath, &#123;</span><br><span class="line">      <span class="string">&#x27;content-type&#x27;</span>: responseMimeType,</span><br><span class="line">    &#125;, &#123;</span><br><span class="line">      onError: <span class="function"><span class="params">err</span> =&gt;</span> respondToStreamError(err, stream)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">443</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
            <tag> HTTP2 </tag>
            
            <tag> HTTP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rocket of Rust</title>
      <link href="/2017/11/06/Rocket-of-Rust/"/>
      <url>/2017/11/06/Rocket-of-Rust/</url>
      
        <content type="html"><![CDATA[<h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p>Rocket’s design is centered around three core philosophies:</p><ul><li><p><strong>Function declaration and parameter type should contain all necessary information to validate and process a request</strong>. This immediately prohibits APIs where request state is retrieved from a global context. As a result, request handling is <strong>self-contained</strong> in Rocket: handlers are regular functions with regular arguments.</p></li><li><p><strong>All request handling information should be typed</strong>. Because the web and HTTP are themselves untyped(or stringly typed, as some call it), this means that something or someone has to convert strings to native types. Rocket does this for you with zero programming overhead.</p></li><li><p><strong>Decisions should not be forced</strong>. Templates, serialization, sessions and just about everything else are all pluggable, optional components. While Rocket has official support and libraries for each of these, they are completely optional and swappable.</p></li></ul><h3 id="Getting-Started"><a href="#Getting-Started" class="headerlink" title="Getting Started"></a>Getting Started</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo new hello-rocket --bin</span><br></pre></td></tr></table></figure><p>Add Dependencies</p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[dependencies]</span></span><br><span class="line"><span class="attr">rocket</span> = <span class="string">&quot;0.3.3&quot;</span></span><br><span class="line"><span class="attr">rocket_codegen</span> = <span class="string">&quot;0.3.3&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#![feature(plugin)]</span></span><br><span class="line"><span class="meta">#![plugin(rocket_codegen)]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">crate</span> rocket;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[get(<span class="meta-string">&quot;/&quot;</span>)]</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">index</span></span>() -&gt; &amp;<span class="symbol">&#x27;static</span> <span class="built_in">str</span> &#123;</span><br><span class="line">  <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span> </span>() &#123;</span><br><span class="line">  rocket::ignite().mount(<span class="string">&quot;/&quot;</span>, routes![index]).launch();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>It creates an <code>index</code> route, <em>mount</em> the route at the <code>/</code> path, and launches the application. Compile and run the program with <code>cargo run</code>, you should see the following:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">🔧  Configured <span class="keyword">for</span> development.</span><br><span class="line">    =&gt; address: localhost</span><br><span class="line">    =&gt; port: 8000</span><br><span class="line">    =&gt; <span class="built_in">log</span>: normal</span><br><span class="line">    =&gt; workers: [core count * 2]</span><br><span class="line">    =&gt; secret key: generated</span><br><span class="line">    =&gt; limits: forms = 32KiB</span><br><span class="line">    =&gt; tls: disabled</span><br><span class="line">🛰  Mounting <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">    =&gt; GET /</span><br><span class="line">🚀  Rocket has launched from http://localhost:8000</span><br></pre></td></tr></table></figure><h3 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h3><p>Rocket provides primitives to build web servers and applications with Rust: the rest is up to you. In short, Rocket provides <strong>routing, pre-processing of requests and psot-processing of response</strong>. Your application code instructs Rocket what to pre-process and post-process and fills the gaps between pre-processing and post-processing.</p><h4 id="LifeCycle"><a href="#LifeCycle" class="headerlink" title="LifeCycle"></a>LifeCycle</h4><p>Rocket’s main task is to listen for incoming web prequests, dispatch the request to the application code, and retur a response to the client. We call the process that goes form request to response the ‘lifecycle’. The lifecycle can be summarized as following sequence of steps:</p><ul><li><p><strong>Routing</strong></p><p>Rocket parse an incoming HTTP request into native structure that your code operates on indirectly. Rocket determines which request handler to invoke by matching against route attributes declared in your application.</p></li><li><p><strong>Validation</strong></p><p>Rocket validates the incoming request against types and guards present in the matched route. If validation fails, Rocket <em>forwards</em> the request to the next matching route or calls an <em>error handler</em>.</p></li><li><p><strong>Processing</strong></p><p>The request handler associated with the route is invoked with validated arguments. This is the main business logic of an application. Processing completes by returning a <code>Response</code>.</p></li><li><p><strong>Response</strong></p><p>The returned <code>Response</code> is processed. Rocket generates the appropriate HTTP response and sends it to the client. This completes the lifecycle. Rocket continues listening for requesting, restarting the lifecycle for each incoming request.</p></li></ul><h4 id="Routing"><a href="#Routing" class="headerlink" title="Routing"></a>Routing</h4><p>Rocket applications are centered around routes and handlers. A <em>route</em> is a combination of: </p><ul><li><p>A set of parameters to match an incoming request against.</p></li><li><p>A handler to process the request and return a response.</p></li></ul><p>A handler is simply a function that takes an arbirary number of arguments and returns any arbitrary type.</p><p>The parameters to match against include static paths, dynamic paths, path segments, forms, query string, request format specifiers and body data. Rocket uses attributes, which look like function decoration in other languages to make declaring routes easy. Routes are declared by annotating a function, the handler, with a set of parameters to match against. A complete route declaration looks like this:</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[get(<span class="meta-string">&quot;/world&quot;</span>)]</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">world</span></span>() -&gt; &amp;<span class="symbol">&#x27;static</span> <span class="built_in">str</span> &#123;</span><br><span class="line">  <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This declare the <code>world</code> route to match against the static path <code>/world</code> on incoming <code>GET</code> requests. The <code>world</code> route is simple, but additional route parameters are necessary when building more interesting application.</p><h4 id="Mounting"><a href="#Mounting" class="headerlink" title="Mounting"></a>Mounting</h4><p>Before Rocket can dispatch requests to a route, the route needs to be <em>mounted</em>. Mounting a route is like namespacing it. Routes are mounted via the <code>mount</code> method on a <code>Rocket</code> instance. A <code>Rocket</code> instance is typically created with the <code>racket::ignite()</code> static method.</p><p>The <code>mount</code> method takes:</p><ul><li><p>A path to namespace a list of routes under.</p></li><li><p>A list of route handlers through the <code>routes!</code> macro, typing Rocket’s code generation to your application.</p></li></ul><p>For instance, to mount the <code>world</code> route we declared above, we can write the following:</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rocket::ignite().mount(<span class="string">&quot;/hello&quot;</span>, routes![world]);</span><br></pre></td></tr></table></figure><p>This create a new <code>Rocket</code> instance via the <code>ignite</code> function and mounts the <code>world</code> route to the <code>/hello</code> path. As a result, <code>GET</code> requests to the <code>/hello/world</code> path will be directed to the <code>world</code> function.</p><h4 id="Namespacing"><a href="#Namespacing" class="headerlink" title="Namespacing"></a>Namespacing</h4><p>When a route is declared inside a module other than the root, you may find yourself with unexpected errors when mounting: </p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mod</span> other &#123;</span><br><span class="line">  <span class="meta">#[get(<span class="meta-string">&quot;/world&quot;</span>)]</span></span><br><span class="line">  <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">world</span></span>() -&gt; <span class="built_in">String</span> &#123;</span><br><span class="line">    <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span> </span>() &#123;</span><br><span class="line">  rocket::ignite().mount(<span class="string">&quot;/hello&quot;</span>, routes![world]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This occurs because the <code>routes!</code> macro implicitly converts the route’s name into the name of a structure generated by Rocket’s code generation. The solution is to name the route by a module path instead:</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rocket::ignite().mount(<span class="string">&quot;/hello&quot;</span>, routes![other::world]);</span><br></pre></td></tr></table></figure><h4 id="Launching"><a href="#Launching" class="headerlink" title="Launching"></a>Launching</h4><p>Now that Rocket knows about the route, you can tell Rocket to start accepting requests via the <code>launch</code> method. The method starts up the server and wait for incoming requests. When a request arrives, Rocket finds the matching route and dispatches the requests to the route’s handler.</p><p>We typically call <code>launch</code> from the <code>main</code> function. Our complete <em>Hello World</em> application thus looks like:</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#![feature(plugin)]</span></span><br><span class="line"><span class="meta">#![plugin(rocket_codegen)]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">crate</span> rocket;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[get(<span class="meta-string">&quot;/world&quot;</span>)]</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">world</span></span>() -&gt; <span class="built_in">String</span> &#123;</span><br><span class="line">  <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span> </span>() &#123;</span><br><span class="line">  rocket::ignite().mount(<span class="string">&quot;/hello&quot;</span>, routes![world]).launch();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Rust </tag>
            
            <tag> Rocket </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Fastify Plugin Guide</title>
      <link href="/2017/10/26/Fastify-Plugin-Guide/"/>
      <url>/2017/10/26/Fastify-Plugin-Guide/</url>
      
        <content type="html"><![CDATA[<p>In Fastify everything is a plugin, your routes, your utilities and so on are all plugins. And to add a new plugin, whatever its functionality is, in Fastify</p><h3 id="Registers"><a href="#Registers" class="headerlink" title="Registers"></a>Registers</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastify.register(<span class="built_in">require</span>(<span class="string">&#x27;./my-plugin&#x27;</span>, opts, callback))</span><br></pre></td></tr></table></figure><p>Register creates a new Fastify context, this means that if you do any change to the Fastify instance, that change will not be reflected into the context’s ancestors. In other words, encapsulated!</p><p>Required Plugins must expose a single function with the following signature:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">instance, opts, next</span>) </span>&#123;&#125;</span><br></pre></td></tr></table></figure><p>The Fastify’s plugin module is fully reentrant and graph-based, it handles without any kind of problem asynchronous code and it guarantees the load order of the plugins, even the close order.</p><h3 id="Decorators"><a href="#Decorators" class="headerlink" title="Decorators"></a>Decorators</h3><p>Fastify offers you a way nice and elegant to wrote an utility: decorator.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastify.decorate(<span class="string">&#x27;util&#x27;</span>, <span class="function">(<span class="params">a, b</span>) =&gt;</span> a + b)</span><br></pre></td></tr></table></figure><p>Now you can access your utility by doing <code>fastify.util</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fastify.register(<span class="function">(<span class="params">instance, opts, next</span>)=&gt;</span> &#123;</span><br><span class="line">  instance.decorate(<span class="string">&#x27;util&#x27;</span>, <span class="function">(<span class="params">a, b</span>) =&gt;</span> a + b)</span><br><span class="line">  next()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Hooks"><a href="#Hooks" class="headerlink" title="Hooks"></a>Hooks</h3><p>Execute your utility.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">fastify.register(<span class="function">(<span class="params">instance, opts, next</span>) =&gt;</span> &#123;</span><br><span class="line">  instance.decorate(<span class="string">&#x27;util&#x27;</span>, <span class="function">(<span class="params">req, key, value</span>) =&gt;</span> &#123; req.key = value &#125;)</span><br><span class="line"></span><br><span class="line">  instance.addHook(<span class="string">&#x27;preHandler&#x27;</span>, <span class="function">(<span class="params">req, reply, done</span>) =&gt;</span> &#123;</span><br><span class="line">    instance.util(req, <span class="string">&#x27;timestamp&#x27;</span>, <span class="keyword">new</span> <span class="built_in">Date</span>())</span><br><span class="line">    done()</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  instance.get(<span class="string">&#x27;/plugin1&#x27;</span>, <span class="function">(<span class="params">req, reply</span>) =&gt;</span> &#123;</span><br><span class="line">    reply.send(req)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  next()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fastify.get(<span class="string">&#x27;/plugin2&#x27;</span>, <span class="function">(<span class="params">req, reply</span>) =&gt;</span> &#123;</span><br><span class="line">  reply.send(req)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
            <tag> Fastify </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Time to Start Fastify</title>
      <link href="/2017/10/23/Time-to-start-fastify/"/>
      <url>/2017/10/23/Time-to-start-fastify/</url>
      
        <content type="html"><![CDATA[<h3 id="Getting-Started"><a href="#Getting-Started" class="headerlink" title="Getting Started"></a>Getting Started</h3><h4 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add fastify</span><br></pre></td></tr></table></figure><h4 id="First-Server"><a href="#First-Server" class="headerlink" title="First Server"></a>First Server</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Require the framework and instantiate it</span></span><br><span class="line"><span class="keyword">const</span> fastify = <span class="built_in">require</span>(<span class="string">&#x27;fastify&#x27;</span>)()</span><br><span class="line"></span><br><span class="line"><span class="comment">// Declare a route</span></span><br><span class="line">fastify.get(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, reply</span>) =&gt;</span> &#123;</span><br><span class="line">  reply.send(&#123;</span><br><span class="line">    hello: <span class="string">&#x27;world&#x27;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Run the server</span></span><br><span class="line">fastify.listen(<span class="number">3000</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Server is running on <span class="subst">$&#123;fastify.server.address().port&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="Schema-Serialization"><a href="#Schema-Serialization" class="headerlink" title="Schema Serialization"></a>Schema Serialization</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fastify = <span class="built_in">require</span>(<span class="string">&#x27;fastify&#x27;</span>)()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> opts = &#123;</span><br><span class="line">  schema: &#123;</span><br><span class="line">    response: &#123;</span><br><span class="line">      <span class="number">200</span>: &#123;</span><br><span class="line">        type: <span class="string">&#x27;object&#x27;</span>,</span><br><span class="line">        properties: &#123;</span><br><span class="line">          hello: &#123; <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span> &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Declare a route with an output shcema</span></span><br><span class="line">fastify.get(<span class="string">&#x27;/&#x27;</span>, opts, <span class="function">(<span class="params">req, reply</span>) =&gt;</span> &#123;</span><br><span class="line">  replysend(&#123; <span class="attr">hello</span>: <span class="string">&#x27;world&#x27;</span> &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fastify.listen(<span class="number">3000</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Server is running on <span class="subst">$&#123;fastify.server.address().port&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="Register"><a href="#Register" class="headerlink" title="Register"></a>Register</h4><p>Register routes in seperate files</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"><span class="keyword">const</span> fastify = <span class="built_in">require</span>(<span class="string">&#x27;fastify&#x27;</span>)()</span><br><span class="line"></span><br><span class="line">fastify.register(<span class="built_in">require</span>(<span class="string">&#x27;./route&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> opts = &#123;</span><br><span class="line">  hello: <span class="string">&#x27;world&#x27;</span>,</span><br><span class="line">  something: <span class="literal">true</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fastify.register([</span><br><span class="line">  <span class="built_in">require</span>(<span class="string">&#x27;./another-route&#x27;</span>),</span><br><span class="line">  <span class="built_in">require</span>(<span class="string">&#x27;./yet-another-route&#x27;</span>),</span><br><span class="line">], opts, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fastify.listen(<span class="number">3000</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Server is running on <span class="subst">$&#123;fastify.server.address().port&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// route.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = (fastify, options, next) &#123;</span><br><span class="line">  fastify.get(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, reply</span>) =&gt;</span> &#123;</span><br><span class="line">    replysend(&#123; <span class="attr">hello</span>: <span class="string">&#x27;world&#x27;</span> &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  next()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>or <code>async/await</code>:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="keyword">async</span> (fastify, options) =&gt; &#123;</span><br><span class="line">  fastify.get(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, reply</span>) =&gt;</span> &#123;</span><br><span class="line">    replysend(&#123; <span class="attr">hello</span>: <span class="string">&#x27;world&#x27;</span> &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Server-Methods"><a href="#Server-Methods" class="headerlink" title="Server Methods"></a>Server Methods</h3><h4 id="server"><a href="#server" class="headerlink" title="server"></a>server</h4><p><code>fastify.server</code>: The Node Core <code>server</code> object.</p><h4 id="ready"><a href="#ready" class="headerlink" title="ready"></a>ready</h4><p>Function  called when all the plugins has been loaded. It takes an error parameter if something went wrong.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastify.ready(<span class="function"><span class="params">err</span> =&gt;</span> &#123; <span class="keyword">if</span> (err) <span class="keyword">throw</span> err &#125;)</span><br></pre></td></tr></table></figure><h4 id="listen"><a href="#listen" class="headerlink" title="listen"></a>listen</h4><p>Starts the server on the given port after all the plugins loaded, internally waits for the <code>.ready()</code> event. The callback is the same as the Node Core.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fastify.listen(<span class="number">3000</span>, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Specifying an address is also supported:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fastify.listen(<span class="number">3000</span>, <span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="route"><a href="#route" class="headerlink" title="route"></a>route</h4><p>Method to add routes to the server, it also have shorthands.</p><h4 id="routes-iterator"><a href="#routes-iterator" class="headerlink" title="routes iterator"></a>routes iterator</h4><p>The fastify instance is an Iterable object with all the registered routes. The route properties are the same the developer has declared.</p><h4 id="close"><a href="#close" class="headerlink" title="close"></a>close</h4><p><code>fastify.close(callback)</code>, call this function to close the server instance and run the <code>onClose</code> hook.</p><h4 id="decorate"><a href="#decorate" class="headerlink" title="decorate*"></a>decorate*</h4><p>Function useful if you need to decorate the fastify instance, Reply or Request.</p><h4 id="register"><a href="#register" class="headerlink" title="register"></a>register</h4><p>Fastify allows the user to extends its functionalities with plugins. A plugin can be a set of routes, a server decorator or whatever.</p><h4 id="use"><a href="#use" class="headerlink" title="use"></a>use</h4><p>Function to add middlewares to Fastify.</p><h4 id="addHook"><a href="#addHook" class="headerlink" title="addHook"></a>addHook</h4><p>Function to add a specific hook in the lifecycle of Fastify.</p><h4 id="logger"><a href="#logger" class="headerlink" title="logger"></a>logger</h4><p>The logger instance.</p><h4 id="Inject"><a href="#Inject" class="headerlink" title="Inject"></a>Inject</h4><p>Fake http injection(for testing purpose).</p><h4 id="setSchemaCompiler"><a href="#setSchemaCompiler" class="headerlink" title="setSchemaCompiler"></a>setSchemaCompiler</h4><p>Set the schema compiler for all routes.</p><h4 id="setNotFoundHandler"><a href="#setNotFoundHandler" class="headerlink" title="setNotFoundHandler"></a>setNotFoundHandler</h4><p><code>fastify.setNotFoundHandler(handler(req, reply))</code>: set the 404 handler. This call is fully encapsulated, so different plugins can set different not found handlers.</p><h4 id="setErrorHandler"><a href="#setErrorHandler" class="headerlink" title="setErrorHandler"></a>setErrorHandler</h4><p><code>fastify.setErrorHandler(handler(err, reply))</code>: set a function that will be called whenever an error happens. The handler is fully encapsulated, so different plugins can set different error handlers.</p><h3 id="Routes"><a href="#Routes" class="headerlink" title="Routes"></a>Routes</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastify.route(options)</span><br></pre></td></tr></table></figure><ul><li><p><code>method</code>: currently it supports <code>DELETE</code>, <code>GET</code>, <code>HEAD</code>, <code>PATCH</code>, <code>POST</code>, <code>PUT</code>, and <code>OPTIONS</code>, it could be an array of methods.</p></li><li><p><code>url</code>: the path of the url to match this route (alias: <code>path</code>)</p></li><li><p><code>schema</code>: an object containing the schemas for the request and response. They need to be in <code>JSON Schema</code> format.</p><ul><li><p><code>body</code>: validates the body of the request if it is a POST or PUT.</p></li><li><p><code>querystring</code>: validates the querystring. This can be a complete JSON Schema Object, with the property <code>type</code> of <code>object</code> and <code>properties</code> object of parameters, or simply the values of what would be contained in the properties object as shown below.</p></li><li><p><code>params</code>: validates the params.</p></li><li><p><code>response</code>: fitler and generate a schema for the response, setting a schema allows us to have 10-20% more throughput.</p></li></ul></li><li><p><code>beforeHandler(req, res, done)</code>: a function called just before the request handler, useful if you need to perform authentication at route level for example, it could also be and array of functions.</p></li><li><p><code>handler(req, reply)</code>: the function that will handle this request.</p></li><li><p><code>request</code> if defined in <code>Request</code>.</p></li><li><p><code>reply</code> is defined in <code>Reply</code>.</p></li></ul><p>Exmaple</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">fastify.route(&#123;</span><br><span class="line">  method: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">  url: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">  schema: &#123;</span><br><span class="line">    querystring: &#123;</span><br><span class="line">      name: &#123; <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span> &#125;,</span><br><span class="line">      excitement: &#123; <span class="attr">type</span>: <span class="string">&#x27;integer&#x27;</span> &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    response: &#123;</span><br><span class="line">      <span class="number">200</span>: &#123;</span><br><span class="line">        type: <span class="string">&#x27;object&#x27;</span>,</span><br><span class="line">        properties: &#123;</span><br><span class="line">          hello: &#123; <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span> &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  handler: <span class="function"><span class="keyword">function</span> (<span class="params">req, reply</span>) </span>&#123;</span><br><span class="line">    reply.send(&#123;</span><br><span class="line">      hello: <span class="string">&#x27;world&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fastify.route(&#123;</span><br><span class="line">  method: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">  url: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">  schema: &#123;<span class="comment">/*..*/</span>&#125;,</span><br><span class="line">  beforeHandler: <span class="function"><span class="keyword">function</span> (<span class="params">req, reply, done</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// auth</span></span><br><span class="line">    done()</span><br><span class="line">  &#125;,</span><br><span class="line">  handler: <span class="function"><span class="keyword">function</span>(<span class="params">req, reply</span>) </span>&#123;</span><br><span class="line">    reply.send(&#123;</span><br><span class="line">      hello: <span class="string">&#x27;world&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="ShortHands"><a href="#ShortHands" class="headerlink" title="ShortHands"></a>ShortHands</h4><p><code>fastify.method(path, [options], handler)</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> opts = &#123;</span><br><span class="line">  schema: &#123;</span><br><span class="line">    response: &#123;</span><br><span class="line">      <span class="number">200</span>: &#123;</span><br><span class="line">        type: <span class="string">&#x27;object&#x27;</span>,</span><br><span class="line">        properites: &#123;</span><br><span class="line">          hello: &#123; <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span> &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fastify.get(<span class="string">&#x27;/&#x27;</span>, opts, <span class="function">(<span class="params">req, reply</span>) =&gt;</span> &#123;</span><br><span class="line">  reply.send(&#123;</span><br><span class="line">    hello: <span class="string">&#x27;world&#x27;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><code>fastify.all(path, [options], handler)</code> will add the same handler to all the supported methods.</p><h4 id="Async-Await"><a href="#Async-Await" class="headerlink" title="Async/Await"></a>Async/Await</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fastify.get(<span class="string">&#x27;/&#x27;</span>, options, <span class="keyword">async</span> (req, reply) =&gt; &#123;</span><br><span class="line">  <span class="keyword">var</span> data = <span class="keyword">await</span> getData()</span><br><span class="line">  <span class="keyword">var</span> processed = <span class="keyword">await</span> processData(data)</span><br><span class="line">  <span class="keyword">return</span> processed</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="Route-Prefixing"><a href="#Route-Prefixing" class="headerlink" title="Route Prefixing"></a>Route Prefixing</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"><span class="keyword">const</span> fastify = <span class="built_in">require</span>(<span class="string">&#x27;fastify&#x27;</span>)()</span><br><span class="line"></span><br><span class="line">fastify.register(<span class="built_in">require</span>(<span class="string">&#x27;./routes/v1/users&#x27;</span>), &#123;</span><br><span class="line">  prefix: <span class="string">&#x27;/v1&#x27;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// routes/v1/users</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">fastify, opts, next</span>) </span>&#123;</span><br><span class="line">  fastify.get(<span class="string">&#x27;/user&#x27;</span>, handler_v1)</span><br><span class="line">  next()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Now your client can access to <code>/v1/user</code>.</p><p>Be aware that if you use <code>fastify-plugin</code> this option won’t work.</p><h3 id="Logging"><a href="#Logging" class="headerlink" title="Logging"></a>Logging</h3><p>Logging is disabled by default, and you can enable it by passing <code>&#123; logger: true &#125;</code> or <code>&#123; logger: &#123; level: &#39;info&#39; &#125; &#125;</code> when you create the fastify instance.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fastify = <span class="built_in">require</span>(<span class="string">&#x27;fastify&#x27;</span>)(&#123;</span><br><span class="line">  logger: <span class="literal">true</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fastify.get(<span class="string">&#x27;/&#x27;</span>, options, <span class="function">(<span class="params">req, reply</span>) =&gt;</span> &#123;</span><br><span class="line">  req.log.info(<span class="string">&#x27;Some info about the current request&#x27;</span>)</span><br><span class="line">  reply.send(&#123;</span><br><span class="line">    hello: <span class="string">&#x27;world&#x27;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Middlewares"><a href="#Middlewares" class="headerlink" title="Middlewares"></a>Middlewares</h3><p>Fastify provides out of the box an asynchronous middleare engine compatible with Express and Restify middlewares.</p><p>Fastify middleware don’t support the full syntax <code>middleware(err, req, res, next)</code> because error handling is done inside Fastify.</p><p>Also if you are using a middleware taht bundles different, smaller middlewares such as helmet, we recommand to use the single module to get better performances.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fastify.use(<span class="built_in">require</span>(<span class="string">&#x27;cors&#x27;</span>)())</span><br><span class="line">fastify.use(<span class="built_in">require</span>(<span class="string">&#x27;dns-prefetch-control&#x27;</span>)())</span><br><span class="line">fastify.use(<span class="built_in">require</span>(<span class="string">&#x27;frameguard&#x27;</span>)())</span><br><span class="line">fastify.use(<span class="built_in">require</span>(<span class="string">&#x27;hide-powered-by&#x27;</span>)())</span><br><span class="line">fastify.use(<span class="built_in">require</span>(<span class="string">&#x27;hsts&#x27;</span>)())</span><br><span class="line">fastify.use(<span class="built_in">require</span>(<span class="string">&#x27;ienoopen&#x27;</span>)())</span><br><span class="line">fastify.use(<span class="built_in">require</span>(<span class="string">&#x27;x-xss-protection&#x27;</span>)())</span><br></pre></td></tr></table></figure><p>If you need to run a middleware only under certain path, just pass the path as first parameter to <code>use</code> and you are done.</p><p>Note that this does not support routes with parameters, (eg: <code>/users/:id/comments</code>) and wildcard is not supported in multiple paths.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> serveStatic = <span class="built_in">require</span>(<span class="string">&#x27;serve-static&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// single path</span></span><br><span class="line">fastify.use(<span class="string">&#x27;/css&#x27;</span>, servveStatic(<span class="string">&#x27;/asserts&#x27;</span>))</span><br><span class="line"><span class="comment">// wildcard path</span></span><br><span class="line">fastify.use(<span class="string">&#x27;/css/*&#x27;</span>, servveStatic(<span class="string">&#x27;/asserts&#x27;</span>))</span><br><span class="line"><span class="comment">// multiple paths</span></span><br><span class="line">fastify.use([<span class="string">&#x27;/css&#x27;</span>, <span class="string">&#x27;/js&#x27;</span>], servveStatic(<span class="string">&#x27;/asserts&#x27;</span>))</span><br></pre></td></tr></table></figure><h3 id="Hook"><a href="#Hook" class="headerlink" title="Hook"></a>Hook</h3><p>By using the hook you can interact directly inside the lifecycle of Fastify, there are three different Hooks that you can use(in order of execution):</p><ul><li><p><code>onRequest</code></p></li><li><p><code>preHandler</code></p></li><li><p><code>onResponse</code></p></li><li><p><code>onClose</code></p></li></ul><p>Example:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">fastify.addHook(<span class="string">&#x27;onRequest&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// some code</span></span><br><span class="line">  next()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fastify.addHook(<span class="string">&#x27;preHandler&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// some code</span></span><br><span class="line">  next()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fastify.addHook(<span class="string">&#x27;onResponse&#x27;</span>, <span class="function">(<span class="params">res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// some code</span></span><br><span class="line">  next()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>If you want to pass a custom error code to the user, just use the <code>reply.code()</code>:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fastify.addHook(<span class="string">&#x27;onRequest&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// some code</span></span><br><span class="line">  reply.code(<span class="number">400</span>)</span><br><span class="line">  next(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;some error&#x27;</span>))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>The error will be handled by <code>Reply</code></p><p>The unique hook that is not inside the lifecycle is <code>&#39;onClose&#39;</code>, this one is triggered when you call <code>fastify.close()</code> to stop the server, and it is useful if you have some plugins that need a ‘shutdown’ part, such as a connection to database.</p><p>Only for this hook the parameters of the functions changes.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fastify.addHook(<span class="string">&#x27;onClose&#x27;</span>, <span class="function">(<span class="params">instance, done</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// some code</span></span><br><span class="line">  done()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="Scope"><a href="#Scope" class="headerlink" title="Scope"></a>Scope</h4><p>Except for <code>onClose</code> all the hooks are encapsulated this means that you can decide where your hooks should run by using <code>register</code>.</p><h4 id="beforeHandler"><a href="#beforeHandler" class="headerlink" title="beforeHandler"></a>beforeHandler</h4><p><code>beforeHandler</code> is not a standard hook like <code>preHandler</code>, but is a function that your register right in the route option that will be executed only in the specified route.</p><p><code>beforeHandler</code> is executed always after the <code>preHandler</code> hook.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">fastify.addHook(<span class="string">&#x27;preHander&#x27;</span>, <span class="function">(<span class="params">req, reply, done</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//  your code</span></span><br><span class="line">  done()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fastify.route(&#123;</span><br><span class="line">  method: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">  url: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">  schema: &#123;<span class="comment">/*...*/</span>&#125;,</span><br><span class="line">  beforeHandler: <span class="function">(<span class="params">req, reply, done</span>) =&gt;</span> &#123;<span class="comment">/*...*/</span> ;done()&#125;</span><br><span class="line">  handler: <span class="function">(<span class="params">req, reply</span>) =&gt;</span> &#123; reply.send(&#123; <span class="attr">hello</span>: <span class="string">&#x27;world&#x27;</span> &#125;) &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fastify.route(&#123;</span><br><span class="line">  method: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">  url: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">  shcema: &#123;<span class="comment">/*...*/</span>&#125;,</span><br><span class="line">  beforeHandler: [</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">first</span> (<span class="params">req, reply, done</span>) </span>&#123;</span><br><span class="line">      done()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">second</span> (<span class="params">req, reply, done</span>) </span>&#123;</span><br><span class="line">      done()</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  handler: <span class="function"><span class="keyword">function</span> (<span class="params">req, reply</span>) </span>&#123;</span><br><span class="line">    reply.send(&#123; <span class="attr">hello</span>: <span class="string">&#x27;world&#x27;</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Decorators"><a href="#Decorators" class="headerlink" title="Decorators"></a>Decorators</h3><p>If you need to add functionalities to the Fastify instance, the <code>decorator</code> api is what you need.</p><p>This api allows you to add new properties to the Fastify instance, a property value is not restricted to be a function, could also be an object or a string for example.</p><h4 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h4><h5 id="decorate-1"><a href="#decorate-1" class="headerlink" title="decorate"></a>decorate</h5><p>Just call the <code>decorate</code> api and pass the name of the new property and its value.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fastify.decorate(<span class="string">&#x27;utility&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// something very useful</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>As said above, you can decorate the instance with other values and not only functions:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fastify.decorate(<span class="string">&#x27;conf&#x27;</span>, &#123;</span><br><span class="line">  db: <span class="string">&#x27;some db&#x27;</span>,</span><br><span class="line">  port: <span class="number">3000</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Once you decorate the instance you can access the value every time you need by using the name you passed as parameter:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fastify.utility()</span><br><span class="line"><span class="built_in">console</span>.log(fastify.conf.db)</span><br></pre></td></tr></table></figure><p>Decorators are not <em>overwritable</em>, if you try to declare a decorator already declared, <code>decorate</code> will throw an exception.</p><h5 id="decorateReply"><a href="#decorateReply" class="headerlink" title="decorateReply"></a>decorateReply</h5><p>As the name suggest, this api is needed if you want to add new methods to the <code>Reply</code> core object. Just call the <code>decorateReply</code> api and pass the name of the new property and its value.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fastify.decorateReply(<span class="string">&#x27;utility&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// something very useful</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Note: using an arrow function will break the binding of <code>this</code> to the Fastify <code>reply</code> instance.</p><h5 id="decorateRequest"><a href="#decorateRequest" class="headerlink" title="decorateRequest"></a>decorateRequest</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fastify.decorateRequest(<span class="string">&#x27;utility&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// something very useful</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Note: using an arrow function will break the binding of <code>this</code> to the Fastify <code>request</code> instance.</p><h5 id="extendServerError"><a href="#extendServerError" class="headerlink" title="extendServerError"></a>extendServerError</h5><p>If you need to extend the standard <code>server error</code>, this api is what you need.</p><p>You must pass a function that returns an Object, Fastify will extend the server error with the returned object of your function. The function will receive the original error object.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">fastify.extendServerError(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    timestamp: <span class="keyword">new</span> <span class="built_in">Date</span>(),</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  The resulting object will be: &#123;</span></span><br><span class="line"><span class="comment">    error: string,</span></span><br><span class="line"><span class="comment">    message: string,</span></span><br><span class="line"><span class="comment">    statusCode: number,</span></span><br><span class="line"><span class="comment">    timestamp: date,</span></span><br><span class="line"><span class="comment">  &#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h4 id="Sync-and-Async"><a href="#Sync-and-Async" class="headerlink" title="Sync and Async"></a>Sync and Async</h4><p><code>decorate</code> is synchronous API, if you need to add a decorator that has an asynchronous bootstrap, could happen that Fastify boots up before your decorator is ready. To avoid this issue you must use <code>register</code> api in combination with <code>fastify-plugin</code>.</p><h4 id="Dependencies"><a href="#Dependencies" class="headerlink" title="Dependencies"></a>Dependencies</h4><p>If your decorator depends on another decorator, you can declare the dependencies of your function, it’s pretty easy, you just need to add an array of strings(representing the names of the decorators your are depending on) as third parameter.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastify.decorate(<span class="string">&#x27;utility&#x27;</span>, fn, [<span class="string">&#x27;greet&#x27;</span>, <span class="string">&#x27;log&#x27;</span>])</span><br></pre></td></tr></table></figure><p>If a dependency is not satisfied, <code>decorate</code> will throw an exception.</p><h4 id="hasDecorator"><a href="#hasDecorator" class="headerlink" title="hasDecorator"></a>hasDecorator</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastify.hasDecorator(<span class="string">&#x27;utility&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="Validation-and-Serialize"><a href="#Validation-and-Serialize" class="headerlink" title="Validation and Serialize"></a>Validation and Serialize</h3><p>Fastify uses a schema based approach and even if it is not mandatory we recommend to use JSON Schema to validate you routes and serialize your output, internally Fastify compiles the schema in a highly performance function.</p><h4 id="Validation"><a href="#Validation" class="headerlink" title="Validation"></a>Validation</h4><p>The route validation internally uses <code>Ajv</code>, which is highly performant JSON validator. Validate the input is very easy, just add the fields that you need inside the route schema and you are done.</p><p>The supported validations are</p><ul><li><p>body: Validates the body of the request if it is a POST or PUT</p></li><li><p>querystring: Validates the querystring. This can be a complete JSON Schema object, with the property type of object and properties object of parameters, or simply the values of what would be contained in the properties object as shown below.</p></li><li><p>params: Validates teh route params.</p></li><li><p>headers: Validates teh request headers.</p></li></ul><p>Example:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> schema = &#123;</span><br><span class="line">  body: &#123;</span><br><span class="line">    type: <span class="string">&#x27;object&#x27;</span>,</span><br><span class="line">    properties: &#123;</span><br><span class="line">      someKey: &#123; <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span>&#125;,</span><br><span class="line">      someOtherKey: &#123; <span class="attr">type</span>: <span class="string">&#x27;number&#x27;</span> &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  querystring: &#123;</span><br><span class="line">    name: &#123; <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span> &#125;,</span><br><span class="line">    excitement: &#123; <span class="attr">type</span>: <span class="string">&#x27;integer&#x27;</span> &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  params: &#123;</span><br><span class="line">    type: <span class="string">&#x27;object&#x27;</span>,</span><br><span class="line">    properties: &#123;</span><br><span class="line">      par1: &#123; <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span> &#125;,</span><br><span class="line">      par2: &#123; <span class="attr">type</span>: <span class="string">&#x27;number&#x27;</span> &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  headers: &#123;</span><br><span class="line">    type: <span class="string">&#x27;object&#x27;</span>,</span><br><span class="line">    properties: &#123;</span><br><span class="line">      <span class="string">&#x27;x-foo&#x27;</span>: &#123; <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span> &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    required: [<span class="string">&#x27;x-foo&#x27;</span>],</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Schema-Compiler"><a href="#Schema-Compiler" class="headerlink" title="Schema Compiler"></a>Schema Compiler</h4><p>The <code>schemaCompiler</code> is a function that returns a function that validates the body, url parameters, headers and query string.</p><p>The default <code>schemaCompiler</code> returns a function that implements the <code>ajv</code> validation interface. <code>fastify</code> use it internally to speed the valiation up.</p><h4 id="Serialize"><a href="#Serialize" class="headerlink" title="Serialize"></a>Serialize</h4><p>Usually you will send your data to the clients via JSON, and Fastify has a powerful tools to help you: <code>fast-json-stringify</code>, which is used if you have provided an output schema in the route options.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> schema = &#123;</span><br><span class="line">  response: &#123;</span><br><span class="line">    <span class="number">200</span>: &#123;</span><br><span class="line">      type: <span class="string">&#x27;object&#x27;</span>,</span><br><span class="line">      properties: &#123;</span><br><span class="line">        value: &#123; <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span> &#125;,</span><br><span class="line">        otherValue: &#123; <span class="attr">type</span>: <span class="string">&#x27;boolean&#x27;</span> &#125;,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>As you can see the response schema is based on the status code, if you want to use the same schema for mutliple status code, you can use <code>2xx</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> schema = &#123;</span><br><span class="line">  response: &#123;</span><br><span class="line">    <span class="string">&#x27;2xx&#x27;</span>: &#123;</span><br><span class="line">      type: <span class="string">&#x27;object&#x27;</span>,</span><br><span class="line">      properties: &#123;</span><br><span class="line">        value: &#123; <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span> &#125;,</span><br><span class="line">        otherValue: &#123; <span class="attr">type</span>: <span class="string">&#x27;boolean&#x27;</span> &#125;,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="number">201</span>: &#123;</span><br><span class="line">      type: <span class="string">&#x27;object&#x27;</span>,</span><br><span class="line">      properties: &#123;</span><br><span class="line">        value: &#123; <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span> &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Lifecycle"><a href="#Lifecycle" class="headerlink" title="Lifecycle"></a>Lifecycle</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Incoming Request</span><br><span class="line">  │</span><br><span class="line">  └─▶ Instance Logger</span><br><span class="line">        │</span><br><span class="line">        └─▶ Routing</span><br><span class="line">             │</span><br><span class="line">       404 ◀─┴─▶ onRequest Hook</span><br><span class="line">                  │</span><br><span class="line">        4**&#x2F;5** ◀─┴─▶ run Middlewares</span><br><span class="line">                        │</span><br><span class="line">              4**&#x2F;5** ◀─┴─▶ Parsing</span><br><span class="line">                             │</span><br><span class="line">                       415 ◀─┴─▶ Validation</span><br><span class="line">                                   │</span><br><span class="line">                             400 ◀─┴─▶ preHandler Hook</span><br><span class="line">                                         │</span><br><span class="line">                               4**&#x2F;5** ◀─┴─▶ beforeHandler</span><br><span class="line">                                               │</span><br><span class="line">                                     4**&#x2F;5** ◀─┴─▶ User Handler</span><br><span class="line">                                                     │</span><br><span class="line">                                                     └─▶ Reply</span><br><span class="line">                                                          │ │</span><br><span class="line">                                                          │ └─▶ Outgoing Response</span><br><span class="line">                                                          │</span><br><span class="line">                                                          └─▶ onResponse Hook</span><br></pre></td></tr></table></figure><h3 id="Reply"><a href="#Reply" class="headerlink" title="Reply"></a>Reply</h3><p>The second parameter of the handler function is <code>Reply</code>.</p><p>Reply is a core Fastify object that exposes the following functions:</p><ul><li><p>.code(statusCode)</p></li><li><p>.header(name, value)</p></li><li><p>.type(value): Set the header <code>Content-Type</code></p></li><li><p>.redirect([code, ] url): default code 302</p></li><li><p>.serializer(function): Set a custom serializer for the payload</p></li><li><p>.send(payload)</p></li><li><p>.sent: A boolean value that you can use if you need to know it <code>send</code> has already been called.</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fastify.get(<span class="string">&#x27;/&#x27;</span>, options, <span class="function">(<span class="params">request, reply</span>) =&gt;</span> &#123;</span><br><span class="line">  reply</span><br><span class="line">    .code(<span class="number">200</span>)</span><br><span class="line">    .type(<span class="string">&#x27;application/json&#x27;</span>)</span><br><span class="line">    .send(&#123; <span class="attr">hello</span>: <span class="string">&#x27;world&#x27;</span> &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h4><p>If not set via <code>reply.code</code>, the resulting <code>statusCode</code> will be <code>200</code></p><h4 id="Header"><a href="#Header" class="headerlink" title="Header"></a>Header</h4><p>Sets a custom header to the response.</p><p>If you not set a <code>Content-Type</code> header, Fastify assumes that you are using <code>application/json</code>, unless you are send a stream, in that case Fastify recognize it and sets the <code>Content-Type</code> at <code>application/octet-stream</code>.</p><h4 id="Redirect"><a href="#Redirect" class="headerlink" title="Redirect"></a>Redirect</h4><p>Redirects a request to the specified url, the status code is optional, default to <code>302</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reply.redirect(<span class="string">&#x27;/home&#x27;</span>)</span><br></pre></td></tr></table></figure><h4 id="Type"><a href="#Type" class="headerlink" title="Type"></a>Type</h4><p>Sets the content type for the response.</p><p>It’s the shortcut for <code>reply.header(&#39;Content-Type&#39;, &#39;application/json&#39;)</code></p><h4 id="Serializer"><a href="#Serializer" class="headerlink" title="Serializer"></a>Serializer</h4><h4 id="Send"><a href="#Send" class="headerlink" title="Send"></a>Send</h4><h4 id="Objects"><a href="#Objects" class="headerlink" title="Objects"></a>Objects</h4><p>If you are sending JSON Objects, send will serialize the object with <code>fast-json-stringify</code> if you setted an output schema, otherwise <code>fast-safe-stringify</code></p><h4 id="Promises"><a href="#Promises" class="headerlink" title="Promises"></a>Promises</h4><p>Send handle natively the promsies and supports out of the box async-await:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">fastify.get(<span class="string">&#x27;/promises&#x27;</span>, options, <span class="function">(<span class="params">req, reply</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> promise = <span class="keyword">new</span> Prmise(<span class="comment">/*...*/</span>)</span><br><span class="line">  reply</span><br><span class="line">    .code(<span class="number">200</span>)</span><br><span class="line">    .send(promise)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fastify.get(<span class="string">&#x27;/async-await&#x27;</span>, options, <span class="keyword">async</span> (req, reply) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> res = <span class="keyword">await</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(resolve, <span class="number">200</span>, &#123; <span class="attr">hello</span>: <span class="string">&#x27;world&#x27;</span> &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="Streams"><a href="#Streams" class="headerlink" title="Streams"></a>Streams</h4><p>Send can also handle streams out of box, internally uses <code>pump</code> to avoid leaks of file description. If you are sneding a stream and you have not setted a <code>Content-Type</code> header, send will set it at <code>application/octet-stream</code>.</p><h4 id="Errors"><a href="#Errors" class="headerlink" title="Errors"></a>Errors</h4><p>If you pass to send an object that is an instance of Error, Fastify will automatically create error structured as the following:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  error: string, <span class="comment">// the http error message</span></span><br><span class="line">  message: string, <span class="comment">// the user error message</span></span><br><span class="line">  statusCode: number, <span class="comment">// the http status code</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Request"><a href="#Request" class="headerlink" title="Request"></a>Request</h3><p>The first parameter of the handler function is <code>Request</code>.</p><p>Request is a core Fastify object containing the following fields: </p><ul><li><p>query</p></li><li><p>body</p></li><li><p>params: the params matching the URL</p></li><li><p>headers</p></li><li><p>req: the incoming HTTP request from Node core</p></li><li><p>log</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fastify.post(<span class="string">&#x27;/:params&#x27;</span>, options, <span class="function">(<span class="params">req, reply</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(request.body)</span><br><span class="line">  <span class="built_in">console</span>.log(request.query)</span><br><span class="line">  <span class="built_in">console</span>.log(request.params)</span><br><span class="line">  <span class="built_in">console</span>.log(request.headers)</span><br><span class="line">  <span class="built_in">console</span>.log(request.req)</span><br><span class="line">  request.log.info(<span class="string">&#x27;some info&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Content-Type-Parser"><a href="#Content-Type-Parser" class="headerlink" title="Content Type Parser"></a>Content Type Parser</h3><p>Natively Fastify supports only <code>application/json</code> content-type. If you need to support different content types you can use the <code>addContentTypeParser</code> api.</p><h4 id="Catch-All"><a href="#Catch-All" class="headerlink" title="Catch All"></a>Catch All</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fastify.addContentTypeParser(<span class="string">&#x27;*&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, done</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> data = <span class="string">&#x27;&#x27;</span></span><br><span class="line">  req.on(<span class="string">&#x27;data&#x27;</span>, <span class="function"><span class="params">chunk</span> =&gt;</span> &#123;data += chunk&#125;)</span><br><span class="line">  req.on(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> done(data))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Plugins"><a href="#Plugins" class="headerlink" title="Plugins"></a>Plugins</h3><p>Fastify allows the user to extend its functionalities with plugins. A plugin can be a set of routes, a server decorator or whatever.</p><p>The API you will need for one or more plugins is <code>register</code>.</p><p>By default, <code>register</code> creates a <strong>new scope</strong>, this means that if you do some changes to the Fastify instance(via decorate), this change will not be reflected to the current context ancestors, but only to its sons.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fastify.register(plugin, [options])</span><br><span class="line"></span><br><span class="line">fastify.register([</span><br><span class="line">  <span class="built_in">require</span>(<span class="string">&#x27;./another-route&#x27;</span>),</span><br><span class="line">  <span class="built_in">require</span>(<span class="string">&#x27;./yet-another-route&#x27;</span>),</span><br><span class="line">], opts)</span><br></pre></td></tr></table></figure><h3 id="Craete-a-Plugin"><a href="#Craete-a-Plugin" class="headerlink" title="Craete a Plugin"></a>Craete a Plugin</h3><p>Create a plugin is very easy, you just need to create a function that takes three paremters, the <code>fastify</code> instance, an options object and the next callback.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">fastify, opts, next</span>) =&gt;</span> &#123;</span><br><span class="line">  fastify.decorate(<span class="string">&#x27;utility&#x27;</span>, <span class="function">() =&gt;</span> &#123;&#125;)</span><br><span class="line">  fastify.get(<span class="string">&#x27;/&#x27;</span>, handler)</span><br><span class="line">  next()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Handle-the-Scope"><a href="#Handle-the-Scope" class="headerlink" title="Handle the Scope"></a>Handle the Scope</h4><p>You have two ways to tell Fastify to avoid the creation of a new context:</p><ul><li><p>Use the <code>fastify-plugin</code> module</p></li><li><p>Use the <code>skip-override</code> hidden property</p></li></ul><p>We recomended to use the <code>fastify-plugin</code> module, because it solves this problem for you, and you can pass as parameter a version range of Fastify taht your plguin support.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fp = <span class="built_in">require</span>(<span class="string">&#x27;fastify-plguin&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = fp(<span class="function"><span class="keyword">function</span>(<span class="params">fastify, opts, next</span>) </span>&#123;</span><br><span class="line">  fastify.decorate(<span class="string">&#x27;utility&#x27;</span>, <span class="function">() =&gt;</span> &#123;&#125;)</span><br><span class="line">  next()</span><br><span class="line">&#125;, <span class="string">&#x27;0.x&#x27;</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
            <tag> Fastify </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Apollo With TypeScript</title>
      <link href="/2017/10/03/Apollo-with-TypeScript/"/>
      <url>/2017/10/03/Apollo-with-TypeScript/</url>
      
        <content type="html"><![CDATA[<p><a href="https://dev-blog.apollodata.com/getting-started-with-typescript-and-apollo-a9aa2c7dcf87">Original</a></p><p>Start with a simple React Component wrapped with the <code>graphql</code> higher order component from React Apollo.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> gql <span class="keyword">from</span> <span class="string">&#x27;graphql-tag&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; graphql &#125; <span class="keyword">from</span> <span class="string">&#x27;react-apollo&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> HERO_QUERY = gql<span class="string">`</span></span><br><span class="line"><span class="string">  query GetCharacter($episode: Episodi!) &#123;</span></span><br><span class="line"><span class="string">    hero(episode: $episode) &#123;</span></span><br><span class="line"><span class="string">      name</span></span><br><span class="line"><span class="string">      id</span></span><br><span class="line"><span class="string">      friends &#123;</span></span><br><span class="line"><span class="string">        name</span></span><br><span class="line"><span class="string">        id</span></span><br><span class="line"><span class="string">        appearsIn</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> withCharacter = graphql(HERO_QUER, &#123;</span><br><span class="line">  options: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    variables: &#123; <span class="attr">episode</span>: <span class="string">&#x27;JEDI&#x27;</span> &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> withCharacter(<span class="function">(<span class="params">&#123; data: &#123; loading, hero, error &#125;&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (loading) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Loading<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (error) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Error<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &#123;hero &amp;&amp;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          &lt;h3&gt;&#123;hero.name&#125;&lt;/h3&gt;</span><br><span class="line">          &#123;hero.friends.map(<span class="function"><span class="params">friend</span> =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">h6</span> <span class="attr">key</span>=<span class="string">&#123;friend.i&#125;</span>&gt;</span>&#123;friend.name&#125;<span class="tag">&lt;/<span class="name">h6</span>&gt;</span></span>&#125;&gt;&lt;/h6&gt;)&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>The above code pulls some data from a GraphQL API using a query and includes lifecycle information, such as loading and error information.</p><p>With a few minor changes, we can tell TypeScript how to support us in writing code within this render function.</p><ul><li>We need to tell TS what the shape of our data from our graphql server will look like. We manually write the types for our response data.</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> type Hero &#123;</span><br><span class="line">  name: string</span><br><span class="line">  id: string</span><br><span class="line">  appearsIn: string[]</span><br><span class="line">  friends: Hero[]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> type Response &#123;</span><br><span class="line">  hero: Hero</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> withCharacter = graphql&lt;Response&gt;(HERO_QUERY, &#123;</span><br><span class="line">  options: <span class="function">(<span class="params">&#123;episode&#125;</span>) =&gt;</span> (&#123;</span><br><span class="line">    variables: &#123; episode &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>The last line is where the magic happens. We tell TS what the shape of the result will look like from the server when the graphql enhancer wraps a component.</li></ul><p>If you already had your project set up with TS, and have already typed your response data, all you have to do is add the type to the <code>graphql</code> HOC and you are off!</p><h3 id="Take-Control-of-Your-Tree"><a href="#Take-Control-of-Your-Tree" class="headerlink" title="Take Control of Your Tree"></a>Take Control of Your Tree</h3><p>Wrapped components are almost always exported and used by a component somewhere else in your tree, so if your exported component has prop requirements, we need to tell TS so it can help prevent errors elsewhere in our tree. Since the <code>graphql</code> wrapper suppors polymorphic types, we can use the second type parameter of it to do just that.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> type InputProps = &#123;</span><br><span class="line">  episode: string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> withCharacter = graphql&lt;Response, InputProps&gt;(HERO_QUERY, &#123;</span><br><span class="line">  options: <span class="function">(<span class="params">&#123; episode &#125;</span>) =&gt;</span> (&#123;</span><br><span class="line">    variables: &#123; episode &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Then the code looks like:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> ApolloClient, &#123; createNetworkInterface &#125; <span class="keyword">from</span> <span class="string">&#x27;apollo-client&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; ApolloProvider &#125; <span class="keyword">from</span> <span class="string">&#x27;react-apollo&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Character <span class="keyword">from</span> <span class="string">&#x27;./Character&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> networkInterface = createNetworkInterface(&#123;</span><br><span class="line">  uri: <span class="string">&#x27;https://mpjk0plp9.lp.gql,zone/graphql&#x27;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> client = <span class="keyword">new</span> ApolloClient(&#123;</span><br><span class="line">  networkInterface,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; (</span><br><span class="line">  &lt;ApolloProvider client=&#123;client&#125;&gt;</span><br><span class="line">    &lt;Character /&gt;</span><br><span class="line">  &lt;/ApolloProvider&gt;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> TypeScript </tag>
            
            <tag> GraphQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Source Code of Koa-Static</title>
      <link href="/2017/09/30/source-code-of-koa-static/"/>
      <url>/2017/09/30/source-code-of-koa-static/</url>
      
        <content type="html"><![CDATA[<h3 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Module Dependencies</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> debug = <span class="built_in">require</span>(<span class="string">&#x27;debug&#x27;</span>)(<span class="string">&#x27;koa-static&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> assert = <span class="built_in">require</span>(<span class="string">&#x27;assert&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> send = <span class="built_in">require</span>(<span class="string">&#x27;koa-send&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Expose `serve()`</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = serve</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Serve static files from `root`</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String&#125;</span> <span class="variable">root</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Object&#125;</span> </span>[opts]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;Function&#125;</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@api <span class="variable">public</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">serve</span> (<span class="params">root, opts</span>) </span>&#123;</span><br><span class="line">  opts = opts || &#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ensure `root`</span></span><br><span class="line">  assert(root, <span class="string">&#x27;root directory is required to serve files&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// options</span></span><br><span class="line">  debug(<span class="string">&#x27;static %s %j&#x27;</span>, root, opts)</span><br><span class="line">  <span class="comment">// set opts.root to absolute one</span></span><br><span class="line">  opts.root = resolve(root)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// set default static file</span></span><br><span class="line">  <span class="keyword">if</span> (opts.index !== <span class="literal">false</span>) opts.index = opts.index || <span class="string">&#x27;index.html&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// if defer is supported</span></span><br><span class="line">  <span class="keyword">if</span> (!opts.defer) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">serve</span> (<span class="params">ctx, next</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">let</span> done = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (ctx.method === <span class="string">&#x27;HEAD&#x27;</span> || ctx.method === <span class="string">&#x27;GET&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          done = <span class="keyword">await</span> send(ctx, ctx.path, opts)</span><br><span class="line">        &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">          <span class="keyword">if</span> (err.status !== <span class="number">404</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> err</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!done) &#123;</span><br><span class="line">        <span class="keyword">await</span> next()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  retrun <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">serve</span> (<span class="params">ctx, next</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">await</span> next()</span><br><span class="line">    <span class="keyword">if</span>(ctx.method !== <span class="string">&#x27;HEAD&#x27;</span> &amp;&amp; ctx.method !== <span class="string">&#x27;GET&#x27;</span>) <span class="keyword">return</span></span><br><span class="line">    <span class="comment">// response is already handled</span></span><br><span class="line">    <span class="keyword">if</span> (ctx.body != <span class="literal">null</span> || ctx.status !== <span class="number">404</span>) <span class="keyword">return</span></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> send(ctx, ctx.path, opts)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="keyword">if</span> (err.status !== <span class="number">404</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> err</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line">app.use(<span class="built_in">require</span>(<span class="string">&#x27;koa-static&#x27;</span>)(root, opts))</span><br></pre></td></tr></table></figure><h3 id="Options"><a href="#Options" class="headerlink" title="Options"></a>Options</h3><ul><li><p>maxage: default to 0.</p></li><li><p>hidden: Allow transfer of hidden files, detault to false.</p></li><li><p>index: Default file name, detault to ‘index.html’.</p></li><li><p>defer: If true, serves after <code>return next()</code>.</p></li><li><p>gzip: default to true.</p></li><li><p>extensions: default to false.</p></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>React-Hot-Loader in Webpack With Ts-Loader</title>
      <link href="/2017/09/29/react-hot-loader-in-with-ts-loader/"/>
      <url>/2017/09/29/react-hot-loader-in-with-ts-loader/</url>
      
        <content type="html"><![CDATA[<p>It’s very easy to integrate <code>react-hot-loader</code> into webpack with <code>ts-loader</code>.</p><h3 id="Config-the-webpack"><a href="#Config-the-webpack" class="headerlink" title="Config the webpack"></a>Config the webpack</h3><h4 id="Add-Hot-Module-Replacement"><a href="#Add-Hot-Module-Replacement" class="headerlink" title="Add Hot Module Replacement"></a>Add Hot Module Replacement</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.entry</span></span><br><span class="line">app: [</span><br><span class="line">  <span class="string">&#x27;webpack/hot/only-dev-server&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;webpack-dev-server/client?http://localhost:8080&#x27;</span>,</span><br><span class="line">  path.resolve(__dirname, <span class="string">&#x27;./src&#x27;</span>),</span><br><span class="line">],</span><br><span class="line"></span><br><span class="line">plugins: [</span><br><span class="line">  <span class="keyword">new</span> webpack.HotModuleReplacementPlugin()</span><br><span class="line">],</span><br><span class="line"></span><br><span class="line">devServer: &#123;</span><br><span class="line">  hot: <span class="literal">true</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Add-React-Hot-Loader-into-webpack"><a href="#Add-React-Hot-Loader-into-webpack" class="headerlink" title="Add React-Hot-Loader into webpack"></a>Add React-Hot-Loader into webpack</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add react-hot-loader to entry point</span></span><br><span class="line"></span><br><span class="line">entry: [</span><br><span class="line">  <span class="string">&#x27;webpack/hot/only-dev-server&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;webpack-dev-server/client?http://localhost:8080&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;react-hot-loader/patch&#x27;</span>,</span><br><span class="line">  path.resolve(__dirname, <span class="string">&#x27;./src/&#x27;</span>),</span><br><span class="line">],</span><br><span class="line"><span class="comment">// add loader</span></span><br><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [</span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="regexp">/\.tsx$/</span>,</span><br><span class="line">      use: [<span class="string">&#x27;react-hot-loader/webpack/&#x27;</span>, <span class="string">&#x27;ts-loader&#x27;</span>],</span><br><span class="line">      exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">      include: path.resolve(__dirname, <span class="string">&#x27;./src&#x27;</span>),</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Wrap-Root-Container-into-module-hot-accept"><a href="#Wrap-Root-Container-into-module-hot-accept" class="headerlink" title="Wrap Root Container into module.hot.accept"></a>Wrap Root Container into <code>module.hot.accept</code></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">module</span>.hot) &#123;</span><br><span class="line">  <span class="built_in">module</span>.hot.accept(<span class="string">&#x27;./router&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> Root = <span class="built_in">require</span>(<span class="string">&#x27;./router&#x27;</span>).default</span><br><span class="line">    render(<span class="xml"><span class="tag">&lt;<span class="name">Root</span> /&gt;</span></span>, htmlDOM)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>Note, if you are using ts with babel-preset-es2015, you can set babel to ignore <code>es2015</code> module transform by</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;presets&quot;</span>: [[<span class="string">&quot;es2015&quot;</span>, &#123;<span class="attr">&quot;modules&quot;</span>: <span class="literal">false</span>&#125;]]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>because webpack 3 has built-in support for ES2015 modules. You won’t need to re-require you root module.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">module</span>.hot) &#123;</span><br><span class="line">  <span class="built_in">module</span>.hot.accept(<span class="string">&#x27;./router&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    render(<span class="xml"><span class="tag">&lt;<span class="name">Root</span> /&gt;</span></span>, htmlDOM)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>Same treatment in ts if your target is es6</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> React </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Methods of Observable</title>
      <link href="/2017/09/25/Methods-of-Observable/"/>
      <url>/2017/09/25/Methods-of-Observable/</url>
      
        <content type="html"><![CDATA[<p><a href="http://reactivex.io/rxjs/class/es6/Observable.js~Observable.html#instance-method-switchMap">Original</a><br><a href="https://rxviz.com/">Playground</a></p><h3 id="Observable"><a href="#Observable" class="headerlink" title="Observable"></a>Observable</h3><h5 id="Direct-Subclass"><a href="#Direct-Subclass" class="headerlink" title="Direct Subclass"></a>Direct Subclass</h5><ul><li><p>ConnectableObservable</p></li><li><p>GroupedObservable</p></li><li><p>Subject</p></li></ul><h5 id="Indirect-Subclass"><a href="#Indirect-Subclass" class="headerlink" title="Indirect Subclass"></a>Indirect Subclass</h5><ul><li><p>AnonymousSubject</p></li><li><p>AsyncSubject</p></li><li><p>BehaviorSubject</p></li><li><p>ReplaySubject</p></li></ul><h4 id="Static-Public-Methods"><a href="#Static-Public-Methods" class="headerlink" title="Static Public Methods"></a>Static Public Methods</h4><ul><li>bindCallback</li></ul><p><code>public static bindCallback(func: function, selector: function, schedular: Schedular): function(...params: *): Observable</code></p><p>Convert a callback API to a function that returns an Observable</p><blockquote><p>Give it a function f of type f(x, callback) and it will return a function g taht when called as g(x) will output an Observable.</p></blockquote><p><code>bindCallback</code> is not an operator because its input and output are not Observables.</p><p>The input is a function with some parameters, but the last parameter must be a callback function.</p><p>The output of the <code>bindCallback</code> is a function that takes the <strong>same</strong> parameters as original function takes, except the last one(the callback). When the output function is called with arguments, it will return an Observable.</p><p>If the original function’s callback takes one argument, the Observable will emit that value. If on the other hand callback is called with multiple values, resulting Observable will emit an array with these argumetns.</p><h5 id="More-in-Origin-Article"><a href="#More-in-Origin-Article" class="headerlink" title="More in Origin Article"></a>More in Origin Article</h5><ul><li>bindNodeCallback</li></ul><p><code>public static bindNodeCallback(func: function, scheduler: Schedular): function(...param: *): Observable</code></p><ul><li>combineLatest</li></ul><p><code>public static combineLatest(observable1: ObservableInput, observable2: ObservableInput, project: function, schedular: Schedular): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/combineLatest.png"></p><p>Combines multiple Observables to create an Observable whose values are calculated from the latest values of each of its input Observables.</p><blockquote><p><strong>Whenever</strong> any input Observable emits a value, it computes a formula using the latest values from all the inputs, then emits the output of the formula.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// combine two timer Observable</span></span><br><span class="line"><span class="keyword">const</span> firstTimer = Rx.Observable.timer(<span class="number">0</span>, <span class="number">1000</span>)</span><br><span class="line"><span class="keyword">const</span> secondTimer = Rx.Observable.timer(<span class="number">500</span>, <span class="number">1000</span>)</span><br><span class="line"><span class="keyword">const</span> combineTimers = Rx.Observable.combineLatest(firstTimer, secondTimer)</span><br><span class="line">combineTimers.subscribe(<span class="built_in">console</span>.log)</span><br><span class="line"><span class="comment">// logs</span></span><br><span class="line"><span class="comment">// [0, 0] after 0.5s, triggered by secondTimer</span></span><br><span class="line"><span class="comment">// [1, 0] after 1s, triggered by firstTimer</span></span><br><span class="line"><span class="comment">// [1, 1.5] after 1.5s, triggered by secondTimer</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// combine an array of observable</span></span><br><span class="line"><span class="keyword">const</span> observables = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>].map(<span class="function"><span class="params">n</span> =&gt;</span> Rx.Observable.of(n).delay(n * <span class="number">1000</span>).startWith(<span class="number">0</span>))</span><br><span class="line"><span class="keyword">const</span> combined = Rx.Observable.combineLatest(observables)</span><br><span class="line">combined.subscribe(<span class="built_in">console</span>.log)</span><br><span class="line"><span class="comment">// logs</span></span><br><span class="line"><span class="comment">// [0, 0, 0] immediately</span></span><br><span class="line"><span class="comment">// [1, 0, 0] after 1s triggered by observables[0]</span></span><br><span class="line"><span class="comment">// [1, 2, 0] after 2s triggered by observables[1]</span></span><br><span class="line"><span class="comment">// [1, 2, 4] after 4s triggered by observables[2]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// use project function to dynamically calculate the body-mass index</span></span><br><span class="line"><span class="keyword">const</span> weight = Rx.Observable.of(<span class="number">70</span>, <span class="number">72</span>, <span class="number">76</span>, <span class="number">79</span>, <span class="number">75</span>)</span><br><span class="line"><span class="keyword">const</span> height = Rx.Observable.of(<span class="number">1.76</span>, <span class="number">1.77</span>, <span class="number">1.78</span>)</span><br><span class="line"><span class="keyword">const</span> bmi = Rx.Observable.combineLatest(weight, height, <span class="function">(<span class="params">w, h</span>) =&gt;</span> w/(h*h))</span><br><span class="line">bmi.subscribe(<span class="built_in">console</span>.log)</span><br><span class="line"><span class="comment">// With output to console:</span></span><br><span class="line"><span class="comment">// BMI is 24.212293388429753</span></span><br><span class="line"><span class="comment">// BMI is 23.93948099205209</span></span><br><span class="line"><span class="comment">// BMI is 23.671253629592222</span></span><br></pre></td></tr></table></figure><ul><li>concat</li></ul><p><code>public static concat(input1: ObservableInput, input2: ObservableInput, scheduler: Schedular): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/concat.png"></p><p>Creates an output Observable which sequentially emits all values from given Observable and then moves on to the next.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Concatenate a timer counting form 0 to 3 with a synchronous sequence from 1 to 10</span></span><br><span class="line"><span class="keyword">var</span> timer = Rx.Observable.interval(<span class="number">1000</span>).take(<span class="number">4</span>)</span><br><span class="line"><span class="keyword">var</span> sequence = Rx.Observable.range(<span class="number">1</span>, <span class="number">10</span>)</span><br><span class="line"><span class="keyword">var</span> result = Rx.Observable.concat(timer, sequence)</span><br><span class="line"></span><br><span class="line"><span class="comment">// concatenate an array of 3 Observables, different from the one above</span></span><br><span class="line"><span class="keyword">var</span> timer1 = Rx.Observable.interval(<span class="number">1000</span>).take(<span class="number">10</span>)</span><br><span class="line"><span class="keyword">var</span> timer2 = Rx.Observable.interval(<span class="number">1000</span>).take(<span class="number">6</span>)</span><br><span class="line"><span class="keyword">var</span> timer3 = Rx.Observable.interval(<span class="number">1000</span>).take(<span class="number">10</span>)</span><br><span class="line"><span class="keyword">var</span> result = Rx.Observable.concat([timer1, timer2, timer3])</span><br></pre></td></tr></table></figure><ul><li>create</li></ul><p><code>public static create(onSubscription: function(observer: Observer): TearDownLogic): Observable</code></p><p>Creates a new Observable, that will execute the specified function when an Observer subscribes to it.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> observable = Rx.Observable.create(<span class="function"><span class="keyword">function</span>(<span class="params">observer</span>) </span>&#123;</span><br><span class="line">  observer.next(<span class="number">1</span>)</span><br><span class="line">  observer.next(<span class="number">2</span>)</span><br><span class="line">  observer.next(<span class="number">3</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>defer</li></ul><p><code>public static defer(observableFactory: function(): SubscribableOrPromise): Observable</code></p><p>Creates an Observable that, on subscribe, calls an Observable factory to make an Observable for each new Observer</p><blockquote><p>Creates the Observable lazily, that is, only when it is subscribed.</p></blockquote><p><img src="http://reactivex.io/rxjs/img/defer.png"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// when defer is called, it returns an Observable</span></span><br><span class="line"><span class="keyword">var</span> clicksOrInterval = Rx.Observable.defer(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">Math</span>.random() &gt; <span class="number">0.5</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> Rx.Observable.fromEvent(<span class="built_in">document</span>, <span class="string">&#x27;click&#x27;</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Rx.Observable.interval(<span class="number">1000</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>empty</li></ul><p><code>public static empty(scheduler: Scheduler): Observable</code></p><p>Creates an Observable that emits no items to the Observer and immediately emits a completion notification.</p><blockquote><p>Just emits ‘complete’ and nothing else</p></blockquote><p><img src="http://reactivex.io/rxjs/img/empty.png"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> result = Rx.Observable.empty().startWith(<span class="number">8</span>)</span><br></pre></td></tr></table></figure><ul><li>from</li></ul><p><code>public static from(ish: ObservableInput&lt;T&gt;, scheduler: Scheduler): Observable&lt;T&gt;</code></p><p>Creates an Observable from an Array, an array-like Object, a Promise, an iterable object, or an Observable-like Object</p><blockquote><p>Convert almost anything to an Observable</p></blockquote><p><img src="http://reactivex.io/rxjs/img/from.png"></p><ul><li>fromEvent</li></ul><p><code>public static fromEvent(target: EventTargetLike, eventName: string, options: EventListenerOptions, selector: SelectorMethodSignature&lt;T&gt;): Observable&lt;T&gt;</code></p><blockquote><p>Creates an Observable from DOM events, or Node EventEmitter events or others</p></blockquote><p><img src="http://reactivex.io/rxjs/img/fromEvent.png"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> clicks = Rx.Observable.fromEvent(<span class="built_in">document</span>, <span class="string">&#x27;click&#x27;</span>)</span><br></pre></td></tr></table></figure><ul><li>fromEventPattern</li></ul><p><code>public static fromEventPattern(addHandler: function(handler: Function): any, removeHandler: function(handler: Function, signal?: any): void, selector: function(...args: any): T): Observable&lt;T&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/fromEventPattern.png"></p><blockquote><p>Converts any addHandler/removeHandler API to an Observable</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addClickHandler</span>(<span class="params">handler</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">document</span>.addEventListener(<span class="string">&#x27;click&#x27;</span>, handler)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">removeClick</span>(<span class="params">handler</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">document</span>.removeEventListener(<span class="string">&#x27;click&#x27;</span>, handler)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> clicks = Rx.Observable.fromEventPattern(</span><br><span class="line">  addClickHandler,</span><br><span class="line">  removeClickHandler,</span><br><span class="line">)</span><br></pre></td></tr></table></figure><ul><li>fromPromise</li></ul><p><code>public static fromPromise(promise: Promise&lt;T&gt;, scheduler: Scheduler): Observable&lt;T&gt;</code></p><blockquote><p>Returns an Observable that just emit the Promise’s resolved value, then complete</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> result = Rx.Observable.fromPromise(fetch(<span class="string">&#x27;reqres.in/api/users&#x27;</span>))</span><br></pre></td></tr></table></figure><ul><li>interval</li></ul><p><code>public static interval(period: number, scheduler: Scheduler): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/interval.png"></p><blockquote><p>Emits incremental numbers periodically in time</p></blockquote><ul><li>merge</li></ul><p><code>public static merge(observables: ...ObservableInput, concurrent: number, scheduler: Scheduler): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/merge.png"></p><p>Creates an output Observable which concurrently emits all values from every given input Observable</p><blockquote><p>Flatten multiple Observables together by blending their values into one Observable</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> clicks = Rx.Observable.fromEvent(<span class="built_in">document</span>, <span class="string">&#x27;click&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> timer = Rx.Observable.interval(<span class="number">1000</span>)</span><br><span class="line"><span class="keyword">var</span> clicksOrTimer = Rx.Observable.merge(clicks, timer)</span><br></pre></td></tr></table></figure><ul><li>never</li></ul><p><code>public static never(): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/never.png"></p><p>Creates an Observable that emits no items to the Observer</p><blockquote><p>An Observable that never emits anything</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Rx.Observable.never().startWith(<span class="number">7</span>).subscribe(<span class="built_in">console</span>.log)</span><br><span class="line"><span class="comment">// won&#x27;t console 7</span></span><br></pre></td></tr></table></figure><ul><li>of</li></ul><p><code>public static of(values: ...T, scheduler: Scheduler): Observable&lt;T&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/of.png"></p><p>Creates an Observbale that emits some values you specify as arguments, immediately one after the other, and then emits a complete notification.</p><blockquote><p>Emits the arguments you provide, then complete.</p></blockquote><ul><li>range</li></ul><p><code>public static range(start: number, count: number, scheduler: Scheduler): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/range.png"></p><p>Creates an Observable that emits a sequence of numbers within a specified range.</p><blockquote><p>Emits a sequence of numbers in a range</p></blockquote><ul><li>throw</li></ul><p><code>public static throw(error: any, scheduler: Scheduler): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/throw.png"></p><blockquote><p>Just emit ‘error’ and nothing else.</p></blockquote><ul><li>timer</li></ul><p><code>public static timer(initialDelay: number|Date, period: number, scheduler: Scheduler): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/timer.png"></p><p>Creates an Observable that starts emitting after an <code>initialDelay</code> and emits ever increasing numbers after each <code>period</code> of time thereafter.</p><blockquote><p>It’s like interval, but you can specify when should the emissions start.</p></blockquote><ul><li>webSocket</li></ul><p><code>public static webSocket(urlConfigOrSource: string | WebSocketSubjectConfig): Observable</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> subject = Rx.Observable.webSocket(<span class="string">&#x27;ws://localhost:8001&#x27;</span>)</span><br></pre></td></tr></table></figure><ul><li>zip</li></ul><p><code>public static zip(observables: *): Observable&lt;R&gt;</code></p><p>Combines multiple Observables to create an Observable whose values are calculated from the valeus, in order, of each of its input Observables.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> age$ = Rx.Observable.of(<span class="number">27</span>, <span class="number">25</span>, <span class="number">29</span>)</span><br><span class="line"><span class="keyword">let</span> name$ = Rx.Observable.of(<span class="string">&#x27;Foo&#x27;</span>, <span class="string">&#x27;Bar&#x27;</span>, <span class="string">&#x27;Beer&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> isDev$ = Rx.Observable.of(<span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line">Rx.Observable.zip(age$, name$, isDev$, <span class="function">(<span class="params">age, name, isDev</span>) =&gt;</span> (&#123;age, name, isDev&#125;))</span><br><span class="line"><span class="comment">// outputs</span></span><br><span class="line"><span class="comment">// &#123; age: 27, name: &#x27;Foo&#x27;, isDev: true &#125;</span></span><br><span class="line"><span class="comment">// &#123; age: 25, name: &#x27;Bar&#x27;, isDev: true &#125;</span></span><br><span class="line"><span class="comment">// &#123; age: 29, name: &#x27;Beer&#x27;, isDev: false &#125;</span></span><br></pre></td></tr></table></figure><ul><li>constructor</li></ul><p><code>public constructor (subsribe: Function)</code></p><ul><li>audit</li></ul><p><code>public audit(durationSelector: function(value: T): SubscribableOrPromise): Observable&lt;T&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/audit.png"></p><p>Ignores source value for a duration determined by another Observable, then emis the most recent value from the source Observable, then repeats this process.</p><blockquote><p>It’s like auditTime, but the silencing duration is determined by a second Observable.</p></blockquote><p><code>audit</code> is similar to <code>throttle</code>, but emits the last value from the silenced time window.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> clicks = Rx.Observable.fromEvent(<span class="built_in">document</span>, <span class="string">&#x27;click&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> result = clicks.audit(<span class="function"><span class="params">ev</span> =&gt;</span> Rx.Observable.interval(<span class="number">1000</span>))</span><br></pre></td></tr></table></figure><ul><li>auditTime</li></ul><p><code>public auditTime(duration: number, scheduler: Scheduler): Observable&lt;T&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/auditTime.png"></p><p>Ignores source values for <code>duration</code> milliseconds, then emits the most recent value from the source Observable, then repeats this process.</p><p>Similar to <code>throttleTime</code></p><ul><li>buffer</li></ul><p><code>public buffer(closingNotifier: Observable&lt;any&gt;): Observable&lt;T&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/buffer.png"></p><p>Buffers the source Observable values until <code>closingNotifier</code> emits.</p><blockquote><p>Collect values from the past as an array, and emits that array when another Observable emits.</p></blockquote><ul><li>bufferCount</li></ul><p><code>public bufferCount(bufferSize: number, startBufferEvery: number): Observable&lt;T[]&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/bufferCount.png"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> interval = Rx.Observable.interval(<span class="number">1000</span>)</span><br><span class="line">interval.bufferCount(<span class="number">3</span>, <span class="number">2</span>)</span><br></pre></td></tr></table></figure><ul><li>bufferTime</li></ul><p><code>public bufferTime(bufferTimeSpan: number, bufferCreationIntervel: number, maxBufferSize: number, scheduler: Scheduler): Observable&lt;T[]&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/bufferTime.png"></p><p>Buffers the source Observable values for a specific time period.</p><blockquote><p>Collect values from the past as an array, and emits those array periodically in time.</p></blockquote><ul><li>bufferToggle</li></ul><p><code>public bufferToggle(openings: SubscribableOrPromise&lt;O&gt;, closingSelector: function(value: O): SubscribableOrPromise): Observable&lt;T[]&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/bufferToggle.png"></p><ul><li>bufferWhen</li></ul><p><code>public bufferWhen(closingSelector: function(): Obversable): Obversable&lt;T[]&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/bufferWhen.png"></p><p>Buffers the source Observable values, using a factory function of closing Observables to determine when to close, emit and reset the buffer.</p><ul><li>catch</li></ul><p><code>public catch(selector: function): Obversable</code></p><p><img src="http://reactivex.io/rxjs/img/catch.png"></p><p>Catches errors on the observable to be handled by returning a new obversable or throwing an error.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Rx.Observable.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">.map(<span class="function"><span class="params">n</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (n === <span class="number">4</span>) <span class="keyword">throw</span> <span class="string">&#x27;four&#x27;</span></span><br><span class="line">  <span class="keyword">return</span> n</span><br><span class="line">&#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> Rx.Observable.of(<span class="string">&#x27;I&#x27;</span> , <span class="string">&#x27;II&#x27;</span>, <span class="string">&#x27;III&#x27;</span>, <span class="string">&#x27;IV&#x27;</span>, <span class="string">&#x27;V&#x27;</span>))</span><br></pre></td></tr></table></figure><ul><li>combineAll</li></ul><p><code>public combineAll(project: function): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/combineAll.png"></p><p>Convert a higher-order Observable into a first-order Observable by waiting for the outer Observable to complete, then applying <code>combineLatest</code></p><p>Similar to CombineLatest</p><blockquote><p>Flatten an Observable-of-Observables by applying combineLatest when the Observable-of-Observable completes</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> clicks = Rx.Observable.fromEvent(<span class="built_in">document</span>, <span class="string">&#x27;click&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> higherOrder = clicks.map(<span class="function"><span class="params">ev</span> =&gt;</span></span><br><span class="line">  Rx.Observable.interval(<span class="built_in">Math</span>.random()*<span class="number">2000</span>).take(<span class="number">13</span>)</span><br><span class="line">).take(<span class="number">3</span>);</span><br><span class="line"><span class="keyword">var</span> result = higherOrder.combineAll();</span><br></pre></td></tr></table></figure><ul><li>combineLatest</li></ul><p><code>public combineLatest(other: ObservableInput, project: function): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/combineLatest.png"></p><p>Combines multiple Observables to create an Observable whose values are calculated from the latest values of each of its input Observable.</p><ul><li>concat</li></ul><p><code>public concat(other: ObservableInput, scheduler: Scheduler): Observable</code></p><ul><li>concatAll</li></ul><p><code>public concatAll(): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/concatAll.png"></p><p>Converts a higher-order Observable into a first-order Observable by concatenating the inner Observable in order.</p><blockquote><p>Flatten an Observable-of-Observable by putting one inner Observable after the other</p></blockquote><ul><li>concatMap</li></ul><p><code>public concatMap(project: function(value: T, ?index: number): ObservableInput, resultSelector: function(outerValue: T, innerValue: I, outerIndex: number, innerIndex: number): any): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/concatMap.png"></p><p>Projects each source value to an Observable which is merged in the output Observable, in a serialized fashion waiting for each one to complete before merging the next.</p><p>Map =&gt; Concat</p><blockquote><p>Map each value to an Observable, then flatten all of these inner Observables using concatAll</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> clicks = Rx.Observable.fromEvent(<span class="built_in">document</span>, <span class="string">&#x27;click&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> result = clicks.concatMap(<span class="function"><span class="params">ev</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> Rx.Observable.interval(<span class="number">1000</span>).take(<span class="number">4</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>concatMaoTo</li></ul><p><code>public concatMapTo(innerObservable: ObservableInput, resultSelector: function(outerValue: T, innerValue: I, outerIndex: number, innerIndex: number): any): Observer</code></p><p><img src="http://reactivex.io/rxjs/img/concatMapTo.png"></p><blockquote><p>It’s like concatMap, but maps each value always to the same inner Observable</p></blockquote><ul><li>count</li></ul><p><code>public count(predicate: function(value: T, i: number, source: Observable&lt;T&gt;): boolean): Observable</code></p><p>Counts the number of emissions on the source and emits the number when the source completes.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// count how many seconds have passed before the first click</span></span><br><span class="line"><span class="keyword">var</span> seconds = Rx.Observable.interval(<span class="number">1000</span>)</span><br><span class="line"><span class="keyword">var</span> clicks = Rx.Observable.fromEvent(<span class="built_in">document</span>, <span class="string">&#x27;click&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> secondsBeforeClick = seconds.takeUntil(clicks)</span><br><span class="line">secondsBeforeClick.count()</span><br><span class="line"></span><br><span class="line"><span class="comment">// count how many odd numbers are there between 1 and 7</span></span><br><span class="line"><span class="keyword">var</span> numbers = Rx.Observable.range(<span class="number">1</span>, <span class="number">7</span>)</span><br><span class="line">numbers.count(<span class="function"><span class="params">i</span> =&gt;</span> i % <span class="number">2</span>)</span><br></pre></td></tr></table></figure><ul><li>debounce</li></ul><p><code>public debounce(durationSelector: function(value: T): SubscribableOrPromise): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/debounce.png"></p><p>Emits a value from the source Observable only after a particular time span determined by another Observable has passes without another source emission.</p><blockquote><p>It’s like debounceTime, but the time span of emission silence is determined by a second Observable.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> clicks = Rx.Observable.fromEvent(<span class="built_in">document</span>, <span class="string">&#x27;click&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> result = clicks.debounce(<span class="function">() =&gt;</span> Rx.Observable.interval(<span class="number">1000</span>))</span><br></pre></td></tr></table></figure><ul><li>debounceTime</li></ul><p><code>public debounceTime(dueTime: number, scheduler: Scheduler): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/debounceTime.png"></p><p>Emits a value from the source Observable only after a particular time span has passed without another source emission.</p><blockquote><p>It’s like delay, but passes only the most recent value from each burst of emissions.</p></blockquote><ul><li>defaultEmpty</li></ul><p><img src="http://reactivex.io/rxjs/img/defaultIfEmpty.png"></p><p><code>public defaultIfEmpty(defaultValue: any): Observable</code></p><p>Emits a given value if the source Observable completes without emitting any <code>next</code> value, otherwise mirrors the source Observable.</p><blockquote><p>If the source Observable turns out to be empty, then this operator will emit a default value.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> clicks = Rx.Observable.fromEvent(<span class="built_in">document</span>, <span class="string">&#x27;click&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> clicksBeforeFive = clicks.takeUntil(Rx.Observable.interval(<span class="number">5000</span>))</span><br><span class="line">clicksBeforeFive.defaultIfEmpty(<span class="string">&#x27;no click&#x27;</span>)</span><br></pre></td></tr></table></figure><ul><li>delay</li></ul><p><code>public delay(delay: number|Date, scheduler: Scheduler): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/delay.png"></p><p>Delays the emission of items from the source Observable by a given timeout or until a given Date.</p><ul><li>delayWhen</li></ul><p><code>public delayWhen(delayDurationSelector: function(value: T): Observable): Observable</code></p><blockquote><p>It’s like delay, but the time span of the delay duration is determined by a second Observable.</p></blockquote><ul><li>dematerialize</li></ul><p><code>public dematerialize(): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/dematerialize.png"></p><p>Convert an Observable of Notification objects into the emissions that they represent.</p><blockquote><p>Unwraps Notification objects as actual next, error, and complete emissions. The opposite of materialize.</p></blockquote><p><code>dematerialize</code> is assumed to operate an Observable that only emits <code>Notification</code> objects as <code>next</code> emission, and does not emit any <code>error</code>. Such Observable is the output of a <code>materialize</code> operation. Those notifications are then unwrapped using the metadata they contain, and emitted as <code>next</code>, <code>error</code>and <code>complete</code> on the output Observable.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> notiA = <span class="keyword">new</span> Rx.Notification(<span class="string">&#x27;N&#x27;</span>, <span class="string">&#x27;A&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> notiB = <span class="keyword">new</span> Rx.Notification(<span class="string">&#x27;N&#x27;</span>, <span class="string">&#x27;B&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> notiE = <span class="keyword">new</span> Rx.Notification(<span class="string">&#x27;E&#x27;</span>, <span class="keyword">void</span> <span class="number">0</span>, <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">&#x27;x.toUpperCase is not a function&#x27;</span>))</span><br><span class="line"><span class="keyword">var</span> materialized = Rx.Observable.of(notiA, notiB, notiE)</span><br><span class="line"><span class="keyword">var</span> upperCase = materialized.dematerialize()</span><br></pre></td></tr></table></figure><ul><li>distinct</li></ul><p><code>public distinct(keySelector: function, flushes: Observable): Observable</code></p><p>Returns an Observable that emits all items emitted by the source Observable that are distinct by comparison from previous item<strong>s</strong>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Rx.Observable.of(<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">67</span>,<span class="number">6</span>,<span class="number">6</span>,).distinct()</span><br><span class="line"><span class="comment">// 1,2,3,4,5,67,6</span></span><br><span class="line"><span class="comment">// repeated 1 omitted</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// keySelector</span></span><br><span class="line">interface Person &#123;</span><br><span class="line">  age: number</span><br><span class="line">  name: string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Rx.Observable.of&lt;Person&gt;(</span><br><span class="line">  &#123; <span class="attr">age</span>: <span class="number">4</span>, <span class="attr">name</span>: <span class="string">&#x27;Foo&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">age</span>: <span class="number">7</span>, <span class="attr">name</span>: <span class="string">&#x27;Bar&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">age</span>: <span class="number">5</span>, <span class="attr">name</span>: <span class="string">&#x27;Foo&#x27;</span> &#125;,</span><br><span class="line">).distinct(<span class="function">(<span class="params">p: Person</span>) =&gt;</span> p.name)</span><br></pre></td></tr></table></figure><blockquote><p>Note: ‘1’ is different from 1</p></blockquote><ul><li>distinctUntilChanged</li></ul><p><code>public distinctUntilChanged(compare: function): Observable</code></p><p>Returns an Observable that emits all items emitted by the source Observable that are distinct by comparison from the previous item. (not items)</p><ul><li>distinctUntilKeyChanged</li></ul><p><code>public distinctUntilKeyChanged(key: string, compare: function): Observable</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">interface Person &#123;</span><br><span class="line">  age: number</span><br><span class="line">  name: string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Rx.Observable.of&lt;Person&gt;(</span><br><span class="line">  &#123; <span class="attr">age</span>: <span class="number">4</span>, <span class="attr">name</span>: <span class="string">&#x27;Foo&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">age</span>: <span class="number">5</span>, <span class="attr">name</span>: <span class="string">&#x27;Bar&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">age</span>: <span class="number">3</span>, <span class="attr">naem</span>: <span class="string">&#x27;For&#x27;</span> &#125;,</span><br><span class="line">).distinctUntilKeyChanged(<span class="string">&#x27;name&#x27;</span>, <span class="function">(<span class="params">x: string, y: string</span>) =&gt;</span> x.substring(<span class="number">0</span>, <span class="number">2</span>) === y.substring(<span class="number">0</span>, <span class="number">2</span>))</span><br></pre></td></tr></table></figure><ul><li>do</li></ul><p><code>public do(nextOrObserver: Observer|function, error: function, complete: function): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/do.png"></p><p>Perform a <strong>side effect</strong> for every emission on the source Observable, but return an Observable that is <strong>identical</strong> to the source.</p><blockquote><p>Intercepts each emission on the source and runs a function, but returns an output which is identical to the source.</p></blockquote><ul><li>elemetnAt</li></ul><p><code>public elementAt(index: number, defaultValue: T): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/elementAt.png"></p><p>Emits the single value at the specified <code>index</code> in a sequence of emissions from the source Observable.</p><blockquote><p>Emits only the i-th value , then completes.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> clicks = Rx.Observable.fromEvent(<span class="built_in">document</span>, <span class="string">&#x27;click&#x27;</span>)</span><br><span class="line">clicks.elementAt(<span class="number">2</span>)</span><br></pre></td></tr></table></figure><ul><li>every</li></ul><p><code>public every(predicate: function, thisArg: any): Observable</code></p><p>Returns an Observable that emits whether or not every item of the source satisfies the condition specified.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// all elements are less than 5, otherwise false</span></span><br><span class="line">Observable.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>)</span><br><span class="line">  .every(<span class="function"><span class="params">x</span> =&gt;</span> x &lt; <span class="number">5</span>)</span><br><span class="line">  .subscribe(<span class="function"><span class="params">x</span> =&gt;</span> <span class="built_in">console</span>.log(x)); <span class="comment">// -&gt; false</span></span><br></pre></td></tr></table></figure><ul><li>exhaust</li></ul><p><code>public exhaust(): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/exhaust.png"></p><p>Convert a higher-order Observable into a first-order Observable by dropping inner Observables while the previoud inner Observable has not yet completed.</p><blockquote><p>Flatten an Observable-of-Observables by dropping the next inner Observable while the current inner is still executing.</p></blockquote><p><code>exhaust</code> ingores every new inner Observable if the previous Observable has not yet completed.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> clicks = Rx.Observable.fromEvent(<span class="built_in">document</span>, <span class="string">&#x27;click&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> higherOrder = clicks.map(<span class="function"><span class="params">ev</span> =&gt;</span> Rx.Observable.interval(<span class="number">1000</span>).take(<span class="number">3</span>))</span><br><span class="line">higherOrder.exhaust()</span><br></pre></td></tr></table></figure><ul><li>exhaustMap</li></ul><p><code>public exhaustMap(project: function(value: T, ?index: number): ObservableInput, resultSelector: function(outerValue: T, innerValue: I, outerIndex: number, innerIndex: number): any): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/exhaustMap.png"></p><p>Projects each source value to an Observable which is merged in the output Observable only if the previous projected Observable has completed.</p><ul><li>expand</li></ul><p><code>public expand(project: function(value: T, index: number), concurrent: number, scheduler: Scheduler): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/expand.png"></p><p>Recursively projects each source value to an Observable which is merged in the output Observable.</p><blockquote><p>It’s similar to mergeMap, but applies the projection function to every source value as well as every output value. It’s recursive.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> clicks = Rx.Observable.fromEvent(<span class="built_in">document</span>, <span class="string">&#x27;click&#x27;</span>)</span><br><span class="line">clicks.mapTo(<span class="number">1</span>).expand(<span class="function"><span class="params">x</span> =&gt;</span> Rx.Observable.of(<span class="number">2</span>*x).delay(<span class="number">1000</span>)).take(<span class="number">10</span>)</span><br></pre></td></tr></table></figure><ul><li>filter</li></ul><p><code>public filter(predicate: function(value T, index: number): boolean, thisArg: any): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/filter.png"></p><p>Filter items emitted by the source Observable by only emitting those that satisfy a specified predicate.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> clicks = Rx.Observable.fromEvent(<span class="built_in">document</span>, <span class="string">&#x27;click&#x27;</span>)</span><br><span class="line">clicks.filter(<span class="function"><span class="params">ev</span> =&gt;</span> <span class="built_in">Math</span>.random() &gt; <span class="number">0.4</span>)</span><br></pre></td></tr></table></figure><ul><li>find</li></ul><p><code>public find(predicate: function(value: T, index: number, source: Observable&lt;T&gt;): boolean, thisArg: any): Observable&lt;T&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/find.png"></p><p>Emits only the first value emitted by the source Observable that meets some condition.</p><ul><li>findIndex</li></ul><p><code>public findIndex(predicate: function(value: T, index: number, source: Observable&lt;T&gt;): boolean, thisArg: any): Observable&lt;T&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/findIndex.png"></p><blockquote><p>It’s like find, but emits the index of the found value, not the value itself.</p></blockquote><ul><li>first</li></ul><p><code>public first(predicate: function(value: T, index: number, source: Obsevable&lt;T&gt;): boolean, resultSelector: function(value: T, index: number): R, defaultValue: R): Observable&lt;T|R&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/first.png"></p><p>Emits only the first value (or the fisrt value that meets some condition) emitted by the source Obsevable</p><ul><li>forEach</li></ul><p><code>public forEach(next: Function, PromiseCtor: PromiseConstructor): Promise</code></p><ul><li>groupBy</li></ul><p><code>public groupBy(keySelector: function(value: T): K, elementSelector: functioN(value: T): R, durationSelector: function(grouped: GroupedObservable&lt;K|R&gt;): Observable&lt;any&gt;): Observable&lt;GroupedObservable&lt;K, R&gt;&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/groupBy.png"></p><ul><li>ignoreElements</li></ul><p><code>public ignoreElements(): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/ignoreElements.png"></p><p>Iggnores all items emitted by the source Observable and only pass calls of <code>complete</code> or <code>error</code></p><ul><li>isEmpty()</li></ul><p><code>public isEmpty(): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/isEmpty.png"></p><ul><li>last</li></ul><p><code>public last(predicate: function): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/last.png"></p><ul><li>letProto</li></ul><p><code>public letProto(func: *): Observable&lt;T&gt;</code></p><ul><li>lift</li></ul><p><code>public lift(operator: Operator): Observable</code></p><p>Creates a new Observable, with this Observable as the source, and the passed operator defined as the new observable’s operator.</p><blockquote><p>Return a new Observable with the Operator applied.</p></blockquote><ul><li>map</li></ul><p><code>public map(project: function(value: T, index: number): R, thisArg: any): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/map.png"></p><p>Applies a given <code>project</code> function to each value emitted by the source Observable, and emits the resulting values as an Observable.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> clicks = Rx.Observable.fromEvent(<span class="built_in">document</span>, <span class="string">&#x27;click&#x27;</span>)</span><br><span class="line">clicks.map(<span class="function"><span class="params">ev</span> =&gt;</span> ev.clientX)</span><br></pre></td></tr></table></figure><ul><li>mapTo</li></ul><p><code>public mapTo(value: any): Observbale</code></p><p><img src="http://reactivex.io/rxjs/img/mapTo.png"></p><p>Emits the given constant value on the output Observable every time the source Observable emits a value.</p><ul><li>materialize</li></ul><p><code>public materialize(): Observable&lt;Notification&lt;T&gt;&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/materialize.png"></p><p>Represents all of the notifications from the source Observable as <code>next</code> emission marked with their orignal types within <code>Notification</code> objects.</p><ul><li>max</li></ul><p><code>public max(comparer: Function): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/max.png"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Rx.Observable.of(<span class="number">5</span>, <span class="number">3</span>, <span class="number">9</span>, <span class="number">8</span>).max()</span><br><span class="line"></span><br><span class="line">interface Person &#123;</span><br><span class="line">  name: string</span><br><span class="line">  age: number</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Rx.Observable.of&lt;Person&gt;(</span><br><span class="line">  &#123; <span class="attr">age</span>: <span class="number">7</span>, <span class="attr">name</span>: <span class="string">&#x27;Foo&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">age</span>: <span class="number">8</span>, <span class="attr">name</span>: <span class="string">&#x27;Bar&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">age</span>: <span class="number">0</span>, <span class="attr">name</span>: <span class="string">&#x27;For&#x27;</span> &#125;,</span><br><span class="line">)</span><br><span class="line">.max&lt;Person&gt;(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a.age - b.age)</span><br></pre></td></tr></table></figure><ul><li>merge</li></ul><p><code>public merge(other: ObservableInpt, concurrent: number, scheduler: Scheduer): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/merge.png"></p><p>Creates an output Observable which concurrently emits all values from every given input Observable.</p><blockquote><p>Flatten multiple Observable together by blending their values into one Observable.</p></blockquote><ul><li>mergeAll</li></ul><p><code>public mergeAll(concurrent: number): Obsevable</code></p><p><img src="http://reactivex.io/rxjs/img/mergeAll.png"></p><p>Converts a higher-order Observable into a first-order Observable which concurrently delivers all values that are emitted on the inner Observables.</p><ul><li>mergeMap</li></ul><p><code>public mergeMap(project: function(value: T, ?index: number): ObservableInput, resultSelector: function(outerValue: T, innerValue: I, outerIndex: number, innerIndex: number): any, concurrent: number): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/mergeMap.png"></p><p>Projects each source value to an Observable which is merged in the output Observable.</p><blockquote><p>Map each value to an Observable, then flattn all of these inner Observable using mergeAll</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> letters = Rx.Observable.of(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>)</span><br><span class="line">letters.mergeMap(<span class="function"><span class="params">letter</span> =&gt;</span> Rx.Observable.interval(<span class="number">1000</span>).map(<span class="function"><span class="params">i</span> =&gt;</span> i+letter))</span><br></pre></td></tr></table></figure><ul><li>mergeMapTo</li></ul><p><code>public mergeMapTo(innerObservable: ObservableInput, resultSelector: function(outerValue: T, innerValue: I, outerIndex: number, innerIndex: number): any, concurrent: number): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/mergeMapTo.png"></p><p>Projects each source value to the same Observable which is merged multiple times in the output Observable.</p><ul><li>mergeScan</li></ul><p><code>public mergeScan(accumulator: function(acc: R, value: T): Observable&lt;R&gt;, seed: *, concurrent: number): Observable&lt;R&gt;</code></p><p>Applies an accumulator function over the source Observable where the accumulator function itself retunrs an Observable, then each intermediate Observable is merged into the output Obsevable.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> click$ = Rx.Observable.fromEvent(<span class="built_in">document</span>, <span class="string">&#x27;click&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> one$ = click$.mapTo(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">const</span> seed = <span class="number">0</span></span><br><span class="line"><span class="keyword">const</span> count$ = one$.mergeScan(<span class="function">(<span class="params">acc, one</span>) =&gt;</span> Rx.Observable.of(acc + one), seed)</span><br></pre></td></tr></table></figure><ul><li>min</li></ul><p><code>public min(comparer: Function): Observable&lt;R&gt;</code></p><ul><li>multicast</li></ul><p><code>public multicast(subjectOrSubjectFactory: Function | Subject, selector: Function): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/multicast.png"></p><p>Returns an Observable tghat emits the results of invoking a specified selector on items emitted by a ConnectableObservable that shares a single subscription to the underlying stream.</p><ul><li>observeOn</li></ul><p><code>public observeOn(scheduler: *, delay: *): Observable&lt;R&gt;</code></p><ul><li>pairwise</li></ul><p><code>public pairwise(): Observable&lt;Array&lt;T&gt;&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/pairwise.png"></p><p>Groups pairs of consecutive emissions together and emits them as an array of two values.</p><blockquote><p>Puts the current value and previous value together as an array, and emits that.</p></blockquote><ul><li>partition</li></ul><p>`public partition(predicate: function(value: T, index: number): Boolean, thisArg: this): [Observable<T>, Observable<T>]</p><p><img src="http://reactivex.io/rxjs/img/partition.png"></p><p>Splits the source Observable into two, one with values that satisfy a predicate, and another values that don’t satisfy the predicate.</p><blockquote><p>It’s like filter, but returns two Observable, one like the output of filter, and the other with values that did not pass the condition.</p></blockquote><ul><li>pluck</li></ul><p><code>public pluck(properties: ...string): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/pluck.png"></p><p>Maps each source value (an object) to its specified nested property</p><blockquote><p>Like map, but meant only for picking on eof the nested properties of every emitted object.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> clicks$ = Rx.Observable.fromEvent(<span class="built_in">document</span>, <span class="string">&#x27;click&#x27;</span>)</span><br><span class="line">clicks$.pluck(<span class="string">&#x27;target&#x27;</span>, <span class="string">&#x27;tagName&#x27;</span>)</span><br></pre></td></tr></table></figure><ul><li>publish</li></ul><p><code>public publish(selector: Function): *</code></p><p>Returns a ConnectableObservable, which is a variety of Observable that waits until connect method is called before it begins emitting items to those Observers that have subscribed to it.</p><ul><li><p>publishBehavior</p></li><li><p>publishLast</p></li><li><p>publishReplay</p></li><li><p>race</p></li></ul><p><code>public race(...observables): Observable</code></p><p>Returns an Observable that mirrors the first source Observable to emit an item from the combination of this Observable and supplied Observables.</p><ul><li>reduce</li></ul><p><code>public reduce(accumulator: function(acc: R, value: T, index: number): R, seed: R): Observable&lt;R&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/reduce.png"></p><ul><li>repeat</li></ul><p><code>public repeat(count: number): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/repeat.png"></p><ul><li>repeatWhen</li></ul><p><code>public repeatWhen(notifier: functioN(notification: Observable): Observable): Observable</code></p><p>1<a href="http://reactivex.io/rxjs/img/repeatWhen.png"></a></p><ul><li>retry</li></ul><p><code>public retry(count: number): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/retry.png"></p><p>Returns an Observable that mirrors the source Observable with the exception of an <code>error</code>, if the source Observable calls <code>error</code>, this method will resubscribe to the source Observable for a maximum of <code>count</code> resubscriptions rather than propagating the <code>error</code> call.</p><ul><li>retryWhen</li></ul><p><code>public retryWhen(notifier: function(errors: Observable): Observable): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/retryWhen.png"></p><ul><li>sample</li></ul><p><code>public sample(notifier: Observable&lt;any&gt;): Observable&lt;T&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/sample.png"></p><p>Emits the most recently emitted value from the source Observable whenever another Observable, the <code>notifier</code> emits.</p><blockquote><p>It’s like sampleTime, but sampels whenever the notifier Observable emits.</p></blockquote><ul><li>sampleTime</li></ul><p><code>public sampleTime(period: number, scheduler: Scheduler): Observable&lt;T&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/sampleTime.png"></p><ul><li>scan</li></ul><p><code>public scan(accumulate: function(acc: R, value: T, index: number): R, seed: T|R): Observable&lt;R&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/scan.png"></p><p>Applies an accumulator function over the source Observable, and returns each intermediate result, with an optional seed value.</p><blockquote><p>It’s like reduce, but emits the current accumulation whenever the source emits a value</p></blockquote><ul><li>sequenceEqual(compareTo: Observbale, comparor: function): Observable`</li></ul><p><img src="http://reactivex.io/rxjs/img/sequenceEqual.png"></p><p>Compares all values of two observbales in sequence using an optional comparor function and returns an observable of a single boolean value representing whether or not the two sequences are equal.</p><blockquote><p>Checks to see of all values emitted by both observables are equal in order.</p></blockquote><ul><li>share</li></ul><p><code>public share(): Observable&lt;T&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/share.png"></p><p>Returns a new Observable that multicasts (shares) the original Observable. As long as there is at least one Subscriber this Observable will be subscribed and emitting data. When all subscribers have unsubscribed it will unsubscribe from the source Observable. Because the Observable is multicasting it makes the stream hot. This is an alias for .publish().refCount().</p><ul><li>single</li></ul><p><code>public single(predicate: Function): Observable&lt;T&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/single.png"></p><ul><li>skip</li></ul><p><code>public skip(count: number): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/skip.png"></p><ul><li>skipUntil</li></ul><p><code>public skipUntil(notifier: Observable): Observable&lt;T&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/skipUntil.png"></p><p>Returns an Observable that skips items emitted by the source Observable until a second Observable emits an item.</p><ul><li>skipWhile</li></ul><p><code>public skipWhile(predicate: Function): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/skipWhile.png"></p><p>Returns an Observable that skips all items emitted by the source Observable as long as a specified condition holds true, but emits all further source items as soon as the condition becomes false.</p><ul><li>startWith</li></ul><p><code>public startWith(values: ...T, scheduler: Scheduler): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/startWith.png"></p><p>Returns an Observable that emits the items you specified before it begins to emit items by the source Observable.</p><ul><li>subscribeOn</li></ul><p><code>public subscribeOn(scheduler: Scheduler): Observable&lt;T&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/subscribeOn.png"></p><p>Asynchornously subscribes Observables to this Observable on the specified Scheduler.</p><ul><li>switch</li></ul><p><code>public switch(): Observable&lt;T&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/switch.png"></p><p>Converts a higher-order Observable into a first-order Observable by subscribing to only the most recently emitted of those inner Observables.</p><blockquote><p>Flatten an Observable-of-Observables by dropping the previous inner Obsevable once a new one appears.</p></blockquote><ul><li>switchMap</li></ul><p><code>public switchMap(project: function(value: T, ?index: number): ObservableInput, resultSelector: function(outerValue: T, innerValue: I, outerIndex: number, innerIndex: number): any): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/switchMap.png"></p><p>Projects each source value to an Observable which is merged in the output Observable, emitting values only from the most recent projected Observable.</p><blockquote><p>Map each value to an Observable, then flatten all of these Observable using switch.</p></blockquote><ul><li>take</li></ul><p><code>public take(count: number): Observable&lt;T&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/take.png"></p><p>Emits only the first <code>count</code> values emitted by the source Observable.</p><blockquote><p>Take the first count value from the source, then complete.</p></blockquote><ul><li>takeLast</li></ul><p><code>takeLast(count: number): Observable&lt;T&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/takeLast.png"></p><p>Emits only the last <code>count</code> values emitted by the source Observable.</p><blockquote><p>Remembers the latest count values, then emits those only when the source completes.</p></blockquote><ul><li>takeUntil</li></ul><p><code>public takeUntil(notifier: Observable): Observable&lt;T&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/takeUntil.png"></p><p>Emits the values emitted by the source Observable until a <code>notifier</code> Observable emits a value.</p><blockquote><p>Let values pass until a second Observable, notifier, emits something. Then, it completes.</p></blockquote><ul><li>takeWhile</li></ul><p><code>public takeWhile(predicate: function(value: T, index: number): boolean): Observable&lt;T&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/takeWhile.png"></p><p>Emits values emitted by the source Observable so long as each value satisfies the given <code>predicate</code>, and then completes as soon as this <code>predicate</code> is not satisfied.</p><blockquote><p>Take values from the source only while they pass the condition given, when the first value does not satisfy, it completes.</p></blockquote><ul><li>throttle</li></ul><p><code>public throttle(durationSelector: function(value: T): SubscribableOrPromise): Observable&lt;T&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/throttle.png"></p><p>Emits a value from the source Observable, then ignores subsequent source values for a duration determined by another Observable, then repeats this process.</p><blockquote><p>It’s like throttleTime, but the silencing duration is determined by a second Observable.</p></blockquote><p>Cannot emit more than one values until the second Observable emits a value.</p><ul><li>throttleTime</li></ul><p><code>public throttleTime(duration: number, scheduler: Scheduler): Observable&lt;T&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/throttleTime.png"></p><p>Emits a value from the source Observable, then ignores subsequent source values for <code>duration</code> milliseconds, then repeats this process.</p><blockquote><p>Lets a value pass, then ignores source values for the next duration milliseconds.</p></blockquote><ul><li>timeInterval</li></ul><p><code>public timeInterval(scheduler: *): Observable&lt;TimeInterval&lt;any&gt;&gt;</code></p><ul><li>timeout</li></ul><p><code>public timeout(due: number, scheduler: Scheduler): Observable&lt;T&gt;</code></p><ul><li>timeoutWith</li></ul><p><code>public timeoutWith(due: *, withObservable: *, scheduler: Scheduler): Observable&lt;R&gt;</code></p><ul><li>timestamp</li></ul><p><code>public timestamp(scheduler: *): Observable&lt;Timestamp&lt;&gt;&gt;any</code></p><ul><li>toArray</li></ul><p><code>public toArray(): Observable&lt;any[]&gt;</code></p><ul><li>toPromise</li></ul><p><code>public toPromise(PromiseCtor: *): Promise&lt;T&gt;</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Rx.Observable.of(<span class="number">42</span>).toPromise().then(<span class="built_in">console</span>.log)</span><br></pre></td></tr></table></figure><ul><li>window</li></ul><p><code>public window(windowBoundaries: Observable&lt;any&gt;): Observable&lt;Observable&lt;T&gt;&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/window.png"></p><p>Branch out the source Observable values as a nested Observable whenever <code>windowBoundaries</code> emits.</p><blockquote><p>It’s like buffer, but emits a nested Observable instead of an array.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> clicks = Rx.Observable.fromEvent(<span class="built_in">document</span>, <span class="string">&#x27;click&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> interval = Rx.Observable.interval(<span class="number">1000</span>)</span><br><span class="line">clicks.window(interval)</span><br></pre></td></tr></table></figure><ul><li>windowCount</li></ul><p><code>public windowCount(windowSize: number, startWindowEvery: number): Observable&lt;Observable&lt;T&gt;&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/windowCount.png"></p><p>Branch out the source Observable values as a nested Observable with each nested Observable emitting at most <code>windowSize</code> values.</p><blockquote><p>It’s like bufferCount, but emits a nested Observable instead of an array.</p></blockquote><ul><li>windowToggle</li></ul><p><code>public windowToggle(openings: Observable&lt;O&gt;, closingSelectors: function(value: O): Observable): Observable&lt;Observable&lt;T&gt;&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/windowToggle.png"></p><p>Branch out the source Observable values as a nested Observable starting from an emission from <code>openings</code> and ending when the output of <code>closingSelector</code></p><ul><li>windowWhen(closingSelector: function(): Observable): Observable&lt;Observable<T>&gt;`</li></ul><p>Branch out the source Observable values as a nested Observable using a factory function of closing Observables to determine when to start a new window.</p><blockquote><p>It’s like bufferWhen, but emits a nested Observable instead of an array.</p></blockquote><ul><li>withLatestFrom</li></ul><p><code>public withLatestFrom(other: ObservableInput, project: Function): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/withLatestFrom.png"></p><p>Combines the source Observable with other Observables to create an Observable whose values are calculated from the latest values of each, only when the source emit.</p><blockquote><p>Whenever the source Observable emits a value, it computes a formula using that value plus the latest values from other input Observables, then emits the output of that formula.</p></blockquote><ul><li>zipAll</li></ul><p><code>public zipAll(project: *): Observable&lt;R&gt;</code></p><ul><li>zipProto</li></ul><p><code>public zipProto(observables: *): Observable&lt;R&gt;</code></p>]]></content>
      
      
      
        <tags>
            
            <tag> RxJS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HTTP Timings in Node.js</title>
      <link href="/2017/09/25/HTTP-Timings-in-Node-js/"/>
      <url>/2017/09/25/HTTP-Timings-in-Node-js/</url>
      
        <content type="html"><![CDATA[<p><a href="https://blog.risingstack.com/measuring-http-timings-node-js/">Original</a></p><h3 id="Some-Basic-Concepts"><a href="#Some-Basic-Concepts" class="headerlink" title="Some Basic Concepts:"></a>Some Basic Concepts:</h3><ul><li><p>IP(Internet Protocol): IP is a network-layer protocol, deals with network addressing and routing. IP is responsible for delivering packets from the source host to the destination host based on the packet headers across one or more IP network. It also defines packet structures that encapsulate the data to be delivered.</p></li><li><p>DNS(Domain Name Server): DNS is a hierarchical decentralized naming system used to resolve human-readable hostnames into machine-readable IP address.</p></li><li><p>TCP(Transmission Control Protocol): The TCP standard defines how to establish and maintain a network conversation between applications to exchange data. TCP provides reliable, ordered, and error-checked deliver of a stream of octects between applications running on hosts communicating over an IP network. An HTTP client initiates a request by establishing a TCP connection.</p></li><li><p>SSL(Secure Sockets Layer)/TLS(Transport Layer Security): TLS is a cryptographic protocol that provides communications security over a computer network. SSL is a deprecated predecessor to TLS. Both TLS and SSL use certificates to establish a secure connection. SSL certificates are not dependent on cryptographic protocols like TLS, a certificate contains a key pair: a public and a private key.</p></li></ul><p><img src="https://blog-assets.risingstack.com/2017/09/http-timing-nodejs.png"></p><p>Timings Explained:</p><ul><li><p>DNS Lookup: Time spent performing the DNS Lookup. DNS lookup resolves domain names to IP addresses.</p></li><li><p>TCP Connection: Time it took to establish TCP Connection between a source host and destination host. Connections must be properly established in a multi-step handshake process.</p></li><li><p>TLS handshake: Time spent completing a TLS handshake. During the handshake process endpoints exchange authentication and keys to establish or resume secure sessions. There is no TLS handshake with a not HTTPS request.</p></li><li><p>Time To First Byte(TTFB): Time spent waiting for the initial response. This time captures the latency of a round trip to the server in addition to the time spent waiting for the server to process the request and deliver the response.</p></li><li><p>Content Transfer: Time spent receiving the response data. The size of the response data and the available network bandwidth determinates its duration.</p></li></ul><h3 id="Measuring-HTTP-timings-in-Node-js"><a href="#Measuring-HTTP-timings-in-Node-js" class="headerlink" title="Measuring HTTP timings in Node.js"></a>Measuring HTTP timings in Node.js</h3><p>To measure HTTP timings in Node.js, we need to subscribe to a specific request, response and socket events. Here is a short code snippet how to do this.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> timings = &#123;</span><br><span class="line">  startAt: process.hrtime(),</span><br><span class="line">  dnsLookupAt: <span class="literal">undefined</span>,</span><br><span class="line">  tcpConnectionAt: <span class="literal">undefined</span>,</span><br><span class="line">  tlsHandshakeAt: <span class="literal">undefined</span>,</span><br><span class="line">  firstByteAt: <span class="literal">undefined</span>,</span><br><span class="line">  endAt: <span class="literal">undefined</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> req = http.request(&#123;...&#125;, <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.once(<span class="string">&#x27;readable&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    timings.firstByteAt = process.hrtime()</span><br><span class="line">  &#125;)</span><br><span class="line">  res.on(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">chunk</span>) =&gt;</span> &#123;</span><br><span class="line">    responseBody += chunk</span><br><span class="line">  &#125;)</span><br><span class="line">  res.on(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    timings.endAt = process.hrtime()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">req.on(<span class="string">&#x27;socket&#x27;</span>, <span class="function">(<span class="params">socket</span>) =&gt;</span> &#123;</span><br><span class="line">  socket.on(<span class="string">&#x27;lookup&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    timings.dnsLookupAt = process.hrtime()</span><br><span class="line">  &#125;)</span><br><span class="line">  socket.(<span class="string">&#x27;connect&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    timings.tcpConnectionAt = process.hrtime()</span><br><span class="line">  &#125;)</span><br><span class="line">  socket.on(<span class="string">&#x27;secureConnect, () =&gt; &#123;</span></span><br><span class="line"><span class="string">    timings.tlsHandshake = process.hrtime()</span></span><br><span class="line"><span class="string">  &#125;)</span></span><br><span class="line"><span class="string">&#125;)</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
            <tag> HTTP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Graphql-Koa-Starter</title>
      <link href="/2017/09/15/graphql-koa-starter/"/>
      <url>/2017/09/15/graphql-koa-starter/</url>
      
        <content type="html"><![CDATA[<h3 id="Init-Project"><a href="#Init-Project" class="headerlink" title="Init Project"></a>Init Project</h3><h3 id="Add-tsconfig"><a href="#Add-tsconfig" class="headerlink" title="Add tsconfig"></a>Add tsconfig</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// tsconfig.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;files&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;server.ts&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;outDir&quot;</span>: <span class="string">&quot;./build&quot;</span>,</span><br><span class="line">    <span class="string">&quot;target&quot;</span>: <span class="string">&quot;es2015&quot;</span>,</span><br><span class="line">    <span class="string">&quot;module&quot;</span>: <span class="string">&quot;commonjs&quot;</span>,</span><br><span class="line">    <span class="string">&quot;moduleResolution&quot;</span>: <span class="string">&quot;Node&quot;</span>,</span><br><span class="line">    <span class="string">&quot;sourceMap&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;pretty&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;strictNullChecks&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;lib&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;esnext&quot;</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;exclude&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;node_modules&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Add-tslint"><a href="#Add-tslint" class="headerlink" title="Add tslint"></a>Add tslint</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// tslint.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;rules&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;align&quot;</span>: [</span><br><span class="line">      <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;parameters&quot;</span>,</span><br><span class="line">      <span class="string">&quot;arguments&quot;</span>,</span><br><span class="line">      <span class="string">&quot;statements&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;ban&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;class-name&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;curly&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;eofline&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;forin&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;indent&quot;</span>: [</span><br><span class="line">      <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;spaces&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;interface-name&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;jsdoc-format&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;label-position&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;max-line-length&quot;</span>: [</span><br><span class="line">      <span class="literal">true</span>,</span><br><span class="line">      <span class="number">140</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;member-access&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;member-ordering&quot;</span>: [</span><br><span class="line">      <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;public-before-private&quot;</span>,</span><br><span class="line">      <span class="string">&quot;static-before-instance&quot;</span>,</span><br><span class="line">      <span class="string">&quot;variables-before-functions&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;no-any&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;no-arg&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;no-bitwise&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;no-conditional-assignment&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;no-console&quot;</span>: [</span><br><span class="line">      <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;debug&quot;</span>,</span><br><span class="line">      <span class="string">&quot;info&quot;</span>,</span><br><span class="line">      <span class="string">&quot;time&quot;</span>,</span><br><span class="line">      <span class="string">&quot;timeEnd&quot;</span>,</span><br><span class="line">      <span class="string">&quot;trace&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;no-construct&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;no-debugger&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;no-shadowed-variable&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;no-duplicate-variable&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;no-empty&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;no-eval&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;no-inferrable-types&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;no-internal-module&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;no-require-imports&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;no-string-literal&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;no-switch-case-fall-through&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;no-trailing-whitespace&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;no-var-keyword&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;no-var-requires&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;one-line&quot;</span>: [</span><br><span class="line">      <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;check-open-brace&quot;</span>,</span><br><span class="line">      <span class="string">&quot;check-catch&quot;</span>,</span><br><span class="line">      <span class="string">&quot;check-else&quot;</span>,</span><br><span class="line">      <span class="string">&quot;check-whitespace&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;quotemark&quot;</span>: [</span><br><span class="line">      <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;single&quot;</span>,</span><br><span class="line">      <span class="string">&quot;jsx-single&quot;</span>,</span><br><span class="line">      <span class="string">&quot;avoid-escape&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;radix&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;semicolon&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;switch-default&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;triple-equals&quot;</span>: [</span><br><span class="line">      <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;allow-null-check&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;typedef&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;typedef-whitespace&quot;</span>: [</span><br><span class="line">      <span class="literal">true</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;call-signature&quot;</span>: <span class="string">&quot;nospace&quot;</span>,</span><br><span class="line">        <span class="string">&quot;index-signature&quot;</span>: <span class="string">&quot;nospace&quot;</span>,</span><br><span class="line">        <span class="string">&quot;parameter&quot;</span>: <span class="string">&quot;nospace&quot;</span>,</span><br><span class="line">        <span class="string">&quot;property-declaration&quot;</span>: <span class="string">&quot;nospace&quot;</span>,</span><br><span class="line">        <span class="string">&quot;variable-declaration&quot;</span>: <span class="string">&quot;nospace&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;variable-name&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;whitespace&quot;</span>: [</span><br><span class="line">      <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;check-branch&quot;</span>,</span><br><span class="line">      <span class="string">&quot;check-decl&quot;</span>,</span><br><span class="line">      <span class="string">&quot;check-operator&quot;</span>,</span><br><span class="line">      <span class="string">&quot;check-separator&quot;</span>,</span><br><span class="line">      <span class="string">&quot;check-type&quot;</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Add-env"><a href="#Add-env" class="headerlink" title="Add env"></a>Add env</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// env.ts</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> envalid <span class="keyword">from</span> <span class="string">&#x27;envalid&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; url, bool, str &#125; = envalid</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> env = envalid.cleanEnv(process.env, &#123;</span><br><span class="line">  SERVICE_URI: str(&#123; <span class="keyword">default</span>: <span class="string">&#x27;https://reqres.in/api&#x27;</span> &#125;),</span><br><span class="line">  NODE_ENV: str(&#123; devDefault: <span class="string">&#x27;development&#x27;</span>, <span class="keyword">default</span>: <span class="string">&#x27;production&#x27;</span> &#125;),</span><br><span class="line">  LOG_LEVEL: str(&#123; <span class="keyword">default</span>: <span class="string">&#x27;info&#x27;</span> &#125;),</span><br><span class="line">  CORS: bool(&#123; devDefault: <span class="literal">true</span>, <span class="keyword">default</span>: <span class="literal">false</span> &#125;),</span><br><span class="line">  GRAPHIQL: bool(&#123; devDefault: <span class="literal">true</span>, <span class="keyword">default</span>: <span class="literal">true</span> &#125;),</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> env</span><br></pre></td></tr></table></figure><h3 id="Add-Nodemon"><a href="#Add-Nodemon" class="headerlink" title="Add Nodemon"></a>Add Nodemon</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;watch&quot;</span>: [<span class="string">&quot;src&quot;</span>],</span><br><span class="line">  <span class="attr">&quot;ext&quot;</span>: <span class="string">&quot;ts&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;ignore&quot;</span>: [<span class="string">&quot;src/**/*.spec.ts&quot;</span>],</span><br><span class="line">  <span class="attr">&quot;exec&quot;</span>: <span class="string">&quot;ts-node ./server.ts&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Create-Koa-APP"><a href="#Create-Koa-APP" class="headerlink" title="Create Koa APP"></a>Create Koa APP</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/app.ts</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> Koa <span class="keyword">from</span> <span class="string">&#x27;koa&#x27;</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> cors <span class="keyword">from</span> <span class="string">&#x27;koa-cors&#x27;</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> convert <span class="keyword">from</span> <span class="string">&#x27;koa-convert&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; apiRouter &#125; <span class="keyword">from</span> <span class="string">&#x27;./routers&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (process.env.CORS) &#123;</span><br><span class="line">  app.use(convert(cors()))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.use(apiRouter.routes()).use(apiRouter.allowedMethods())</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> app</span><br></pre></td></tr></table></figure><h3 id="Server-Startup"><a href="#Server-Startup" class="headerlink" title="Server Startup"></a>Server Startup</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.ts</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> chalk <span class="keyword">from</span> <span class="string">&#x27;chalk&#x27;</span></span><br><span class="line"><span class="keyword">import</span> env <span class="keyword">from</span> <span class="string">&#x27;./env&#x27;</span></span><br><span class="line">process.env = env</span><br><span class="line"><span class="keyword">import</span> app <span class="keyword">from</span> <span class="string">&#x27;./src/app&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> port = process.env.PORT || <span class="number">3001</span></span><br><span class="line"></span><br><span class="line">app.listen(port, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV === <span class="string">&#x27;development&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (process.env.GRAPHIQL) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;The GraphiQL App is running at: &#x27;</span>)</span><br><span class="line">      <span class="built_in">console</span>.log(chalk.cyan(<span class="string">`http://localhost:<span class="subst">$&#123;port&#125;</span>/api/graphiql`</span>))</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;Koa app is running at: &#x27;</span>)</span><br><span class="line">      <span class="built_in">console</span>.log(chalk.cyan(<span class="string">`http://localhost:<span class="subst">$&#123;port&#125;</span>`</span>))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Koa App is running&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Add-Router"><a href="#Add-Router" class="headerlink" title="Add Router"></a>Add Router</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/routers/graphql.ts</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> Router <span class="keyword">from</span> <span class="string">&#x27;koa-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> GraphQLHttp <span class="keyword">from</span> <span class="string">&#x27;koa-graphql&#x27;</span></span><br><span class="line"><span class="keyword">import</span> schema <span class="keyword">from</span> <span class="string">&#x27;../graphql/schema&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router()</span><br><span class="line"><span class="comment">// console.log(process.env)</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(process.env)</span><br><span class="line">router.all(<span class="string">&#x27;/&#x27;</span>, GraphQLHttp(&#123;</span><br><span class="line">  schema,</span><br><span class="line">  graphiql: process.env.GRAPHIQL,</span><br><span class="line">  pretty: <span class="literal">true</span>,</span><br><span class="line">  errorFormat: <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; message, locations, path, stack &#125; = error</span><br><span class="line">    <span class="built_in">console</span>.error(<span class="string">`GraphQL Error: `</span>, &#123;</span><br><span class="line">      message,</span><br><span class="line">      locations,</span><br><span class="line">      path,</span><br><span class="line">      stack,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/routers/index.ts</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> Router <span class="keyword">from</span> <span class="string">&#x27;koa-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> graphQLRouter <span class="keyword">from</span> <span class="string">&#x27;./graphql&#x27;</span></span><br><span class="line"><span class="keyword">import</span> testRouter <span class="keyword">from</span> <span class="string">&#x27;./test&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> apiRouter = <span class="keyword">new</span> Router(&#123;</span><br><span class="line">  prefix: <span class="string">&#x27;/api&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">apiRouter.use(<span class="string">&#x27;/graphql&#x27;</span>, graphQLRouter.routes(), graphQLRouter.allowedMethods())</span><br><span class="line">apiRouter.use(<span class="string">&#x27;/test&#x27;</span>, testRouter.routes(), testRouter.allowedMethods())</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">  apiRouter</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Config-Graphql"><a href="#Config-Graphql" class="headerlink" title="Config Graphql"></a>Config Graphql</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/graphql/model.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  GraphQLObjectType,</span><br><span class="line">  GraphQLString,</span><br><span class="line">  GraphQLNonNull,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;graphql&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> User = <span class="keyword">new</span> GraphQLObjectType(&#123;</span><br><span class="line">  name: <span class="string">&#x27;User&#x27;</span>,</span><br><span class="line">  description: <span class="string">&#x27;A User&#x27;</span>,</span><br><span class="line">  fields: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    id: &#123;</span><br><span class="line">      <span class="keyword">type</span>: <span class="keyword">new</span> GraphQLNonNull(GraphQLString),</span><br><span class="line">      resolve: <span class="function">(<span class="params">user</span>) =&gt;</span> user.id,</span><br><span class="line">    &#125;,</span><br><span class="line">    firstName: &#123;</span><br><span class="line">      <span class="keyword">type</span>: <span class="keyword">new</span> GraphQLNonNull(GraphQLString),</span><br><span class="line">      resolve: <span class="function"><span class="params">user</span> =&gt;</span> user.first_name</span><br><span class="line">    &#125;,</span><br><span class="line">    lastName: &#123;</span><br><span class="line">      <span class="keyword">type</span>: <span class="keyword">new</span> GraphQLNonNull(GraphQLString),</span><br><span class="line">      resolve: <span class="function"><span class="params">user</span> =&gt;</span> user.last_name</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">  User</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/graphql/query.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; GraphQLObjectType, GraphQLList &#125; <span class="keyword">from</span> <span class="string">&#x27;graphql&#x27;</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; User &#125; <span class="keyword">from</span> <span class="string">&#x27;./model&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> GraphQLObjectType(&#123;</span><br><span class="line">  name: <span class="string">&#x27;Query&#x27;</span>,</span><br><span class="line">  description: <span class="string">&#x27;Query of GraphQL&#x27;</span>,</span><br><span class="line">  fields: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    users: &#123;</span><br><span class="line">      <span class="keyword">type</span>: <span class="keyword">new</span> GraphQLList(User),</span><br><span class="line">      resolve: <span class="function">(<span class="params">root, args</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> axios(&#123;</span><br><span class="line">          url: <span class="string">&#x27;https://reqres.in/api/users&#x27;</span>,</span><br><span class="line">        &#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> res.data).then(<span class="function"><span class="params">res</span> =&gt;</span> res.data)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/graphql/schema.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; GraphQLSchema &#125; <span class="keyword">from</span> <span class="string">&#x27;graphql&#x27;</span></span><br><span class="line"><span class="keyword">import</span> query <span class="keyword">from</span> <span class="string">&#x27;./query&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> GraphQLSchema(&#123;</span><br><span class="line">  query</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> GraphQL </tag>
            
            <tag> Node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tag Picture in Html</title>
      <link href="/2017/09/15/tag-picture-in-html/"/>
      <url>/2017/09/15/tag-picture-in-html/</url>
      
        <content type="html"><![CDATA[<p>The <code>picture</code> element is a markup pattern that allows developers to declare multiple sources for an image.</p><p>This markup is a container used to specify multiple <code>&lt;source&gt;</code> elements for a specific <code>&lt;img&gt;</code> contained in it.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">picture</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">source</span> <span class="attr">media</span>=<span class="string">&quot;(min-width: 40em)&quot;</span> <span class="attr">srcset</span>=<span class="string">&quot;big.jpg 1x, big-hd.jgp 2x&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">source</span> <span class="attr">srcset</span>=<span class="string">&quot;small.jpg 1x, small-hd.jpg 2x&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;fallback.jpg&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">picture</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Use-the-media-attribute"><a href="#Use-the-media-attribute" class="headerlink" title="Use the media attribute"></a>Use the <code>media</code> attribute</h3><p>The <code>media</code> attribute lets you specify a media query that the user agent will evaluates to select a <code>&lt;source&gt;</code> element. If the media query evaluates to <code>false</code>, the <code>&lt;source&gt;</code> element is skipped.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;picture&gt;</span><br><span class="line">  &lt;source srcset=<span class="string">&quot;logo-wide.jpg&quot;</span> media=<span class="string">&quot;(min-width: 600px)&quot;</span>&gt;</span><br><span class="line">  &lt;img src=<span class="string">&quot;logo-narrow.jpg&quot;</span>&gt;</span><br><span class="line">&lt;/picture&gt;</span><br></pre></td></tr></table></figure><p>The <code>srcset</code> and <code>sizes</code> attributes extend the <code>img</code> and <code>source</code> elements to provide a list of available image sources and their sizes. Browsers can then use this information to pick the best image source.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span></span></span><br><span class="line"><span class="tag">  <span class="attr">srcset</span>=<span class="string">&quot;elva-fairy-320w.jpg 320w, elva-fairy-480w.jpg 480w, elva-fairy-800w.jpg 800w&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">sizes</span>=<span class="string">&quot;(max-width: 320px) 280px,</span></span></span><br><span class="line"><span class="tag"><span class="string">    (max-width: 480px) 440px,</span></span></span><br><span class="line"><span class="tag"><span class="string">    800px&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">src</span>=<span class="string">&quot;elva-fairy-800w.jpg&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">alt</span>=<span class="string">&quot;Elva dressed as a fairy&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></table></figure><p><code>srcset</code> defines the set of images we will allow the browser to choose between, and what size each image is.</p><p>Before each comma, we write:</p><ul><li><p>An <strong>Image filename</strong> (elva-fair-320w.jpg)</p></li><li><p>A space</p></li><li><p>The image’s inherit width in pixels(480w) - that this issue the <code>w</code> unit, not <code>px</code> as you might expect.</p></li></ul><p><code>sizes</code> defines a set of media conditions(e.g. screen widths) and indicates what image size would be best to choose, when certain media conditions are true.</p><p>Before each comma, we write:</p><ul><li><p>A <strong>media condition</strong>(max-width: 480px) – when the viewport width is 480 px or less</p></li><li><p>A space</p></li><li><p>The <strong>width of the slot</strong> the image will fill when the media condition is true(440px)</p></li></ul><h3 id="Resolution-switching"><a href="#Resolution-switching" class="headerlink" title="Resolution switching"></a>Resolution switching</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span></span></span><br><span class="line"><span class="tag">  <span class="attr">srcset</span>=<span class="string">&quot;elva-fairy-320w,jpg, elva-fairy-480w.jpg 1.5x, elva-fairy-640w.jpg 2x&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">src</span>=<span class="string">&quot;elva-fairy-640w.jpg&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">alt</span>=<span class="string">&quot;elva-fairy&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> HTML </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Simple Example of DAPP</title>
      <link href="/2017/09/13/Simple-Example-of-DAPP/"/>
      <url>/2017/09/13/Simple-Example-of-DAPP/</url>
      
        <content type="html"><![CDATA[<h3 id="Use-truffle-to-init-Project"><a href="#Use-truffle-to-init-Project" class="headerlink" title="Use truffle to init Project"></a>Use truffle to init Project</h3><h3 id="Contract-of-Adoption"><a href="#Contract-of-Adoption" class="headerlink" title="Contract of Adoption"></a>Contract of Adoption</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// contracts/Adoption.sol</span></span><br><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.4</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">constract Adoption &#123;</span><br><span class="line">    address[<span class="number">16</span>] public adopters;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">adopt</span> (<span class="params">uint petId</span>) <span class="title">public</span> <span class="title">returns</span> (<span class="params">uint</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">require</span>(petId &gt;= <span class="number">0</span> &amp;&amp; petId &lt;= <span class="number">15</span>);</span><br><span class="line">        adopters[petId] = msg.sender;</span><br><span class="line">        <span class="keyword">return</span> petId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getAdopters</span> (<span class="params"></span>) <span class="title">public</span> <span class="title">returns</span> (<span class="params">addresss[<span class="number">16</span>]</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> adopters;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Test"><a href="#Test" class="headerlink" title="Test"></a>Test</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// test/TestAdoption.sol</span></span><br><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.4</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;truffle/Assert.sol&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;truffle/DeployedAddress.sol&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;../contracts/Adoption.sol&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">contract TestAdoption &#123;</span><br><span class="line">  Adoption adoption = Adoption(DeployedAddress.Adoption());</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">testUserCanAdoptPet</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    uint returnedPetId = adoption.adopt(<span class="number">8</span>);</span><br><span class="line">    uint expected = <span class="number">8</span>;</span><br><span class="line">    Assert.equal(returenedPetId, expected, <span class="string">&quot;Adoption of Pet Id 8 should be recorded&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">testGetAdopterAddressByPetId</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    address expected = <span class="built_in">this</span>;</span><br><span class="line">    address adopter = adoption.adopters(<span class="number">8</span>);</span><br><span class="line">    Assert.equal(adopter, expected, <span class="string">&quot;Owner of Pet Id 8 should be recorded&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">testGetAdopterAddressByPetIdInArray</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    address expected = <span class="built_in">this</span>;</span><br><span class="line">    address[<span class="number">16</span>] memory adopters = adoption.getAdopters();</span><br><span class="line">    Assert(expected, adopters[<span class="number">8</span>], <span class="string">&quot;Owner of Pet Id 8 should be recoreded&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Compile"><a href="#Compile" class="headerlink" title="Compile"></a>Compile</h3><h3 id="Migrate"><a href="#Migrate" class="headerlink" title="Migrate"></a>Migrate</h3><h3 id="TestRPC"><a href="#TestRPC" class="headerlink" title="TestRPC"></a>TestRPC</h3><h3 id="MetaMask"><a href="#MetaMask" class="headerlink" title="MetaMask"></a>MetaMask</h3><h3 id="UI"><a href="#UI" class="headerlink" title="UI"></a>UI</h3><h4 id="initWeb3"><a href="#initWeb3" class="headerlink" title="initWeb3"></a>initWeb3</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> web3 !== <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">  App.web3Provider = web3.currentProvider</span><br><span class="line">  web3 = <span class="keyword">new</span> Web3(App.web3Provider)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  App.web3Provider = <span class="keyword">new</span> web3.providers.HttpProvider(<span class="string">&#x27;http://localhost:8545&#x27;</span>)</span><br><span class="line">  web3 = <span class="keyword">new</span> Web3(App.web3Provider)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="initContract"><a href="#initContract" class="headerlink" title="initContract"></a>initContract</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$.<span class="built_in">JSON</span>(<span class="string">&#x27;Adoption.json&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> AdoptionArtifact = data</span><br><span class="line">  App.contracts.Adoption = TruffleContract(AdoptionArtifact)</span><br><span class="line">  App.contracts.Adoption.setProvider(App.web3Provider)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="Invoke-Contract"><a href="#Invoke-Contract" class="headerlink" title="Invoke Contract"></a>Invoke Contract</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> adoptionInstance</span><br><span class="line">App.contracts.Adoption.deployed()</span><br><span class="line">.then(<span class="function"><span class="keyword">function</span> (<span class="params">instance</span>) </span>&#123;</span><br><span class="line">  adoptionInstance = instance</span><br><span class="line">  <span class="keyword">return</span> adoptionInstance.getAdopters.call()</span><br><span class="line">&#125;)</span><br><span class="line">.then(<span class="function"><span class="keyword">function</span> (<span class="params">adopters</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> petId = <span class="number">8</span></span><br><span class="line"><span class="keyword">let</span> adoptionInstance</span><br><span class="line">web3.eth.getAccounts(<span class="function"><span class="keyword">function</span> (<span class="params">error, accounts</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (error) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(error.message)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> account = accounts[<span class="number">0</span>]</span><br><span class="line">  App.contracts.Adoption.deployed()</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span> (<span class="params">instance</span>) </span>&#123;</span><br><span class="line">    adoptionInstance = instance</span><br><span class="line">    <span class="keyword">return</span> adoptionInstance.adopt(petId, &#123; <span class="attr">from</span>: account &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Ethereum </tag>
            
            <tag> Blockchain </tag>
            
            <tag> Smart Contract </tag>
            
            <tag> Solidity </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Options of Webpack Dll Plugin</title>
      <link href="/2017/09/12/options-of-webpack-dll-plugin/"/>
      <url>/2017/09/12/options-of-webpack-dll-plugin/</url>
      
        <content type="html"><![CDATA[<p>The <code>DllPlugin</code> and <code>DllReferencePlugin</code> provide means to split bundles in a way that can drastically improve build time performance.</p><h3 id="DllPlugin"><a href="#DllPlugin" class="headerlink" title="DllPlugin"></a>DllPlugin</h3><p>This plugin used in a separate webpack config exclusively to create a <code>dll-only-bundle</code>.</p><p>It creates a <code>manifest.json</code> file, which is used by the <code>DllReferencePlugin</code> to map dependencies.</p><ul><li><p><code>context</code>: (optional), context of requests in the manifest file(default to the webpack context).</p></li><li><p><code>name</code>: name of the exposed dll function(<code>TemplatePaths</code>: <code>[hash]</code> &amp; <code>[name]</code>)</p></li><li><p><code>path</code>: <strong>absolute path</strong> to the manifest json file(output)</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.DllPlugin(option)</span><br></pre></td></tr></table></figure><p>Creates a <code>manifest.json</code> which is written to the given <strong>absolute</strong> <code>path</code>.</p><p>It contains <strong>mappings</strong> from require and import requests, to module ids. It is used by the <code>DllReferencePlugin</code>.</p><p><strong>Combine this plugin with <code>output.library</code> option to expose(aka, put into the global scope) the dll function</strong></p><blockquote><p>output.library expose the name to global scope</p></blockquote><blockquote><p>DllReferencePlugin.name add the name to the mapping file.</p></blockquote><p>So it’s important to keep <code>output.library</code> and <code>DllReferencePlugin.name</code> same to set a right mapping.</p><h3 id="DllReferencePlugin"><a href="#DllReferencePlugin" class="headerlink" title="DllReferencePlugin"></a>DllReferencePlugin</h3><p>This plugin is used in the primary webpack config, it references the <strong>dll-only-bundle</strong> to require the pre-built dependencies.</p><ul><li><p><code>context</code>: <strong>absolute path</strong>, context of the requests in the manifest(or content property)</p></li><li><p><code>manifest</code>: an object containing <code>content</code> and <code>name</code> or a string to the <strong>absolute path</strong> of the JSON manifest to be loaded upon compilation.</p></li><li><p><code>content</code>: (optional), the mappings from request to module id(default to <code>manifest.content</code>)</p></li><li><p><code>name</code>: (optional), the name where the dll is exposed (default to <code>manifest.name</code>)</p></li><li><p><code>scope</code>: (optional), prefix which is used for accessing the content of the dll</p></li><li><p><code>sourceType</code>: (optional), how the dll is exposed.</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.DllReferencePlugin(options)</span><br></pre></td></tr></table></figure><p>References a dll manifest file to map dependencies names to module ids, then requires them as needed using the internal <code>__webpack_require__</code> function.</p><blockquote><p>Note: Keep the <code>name</code> consistent with <code>output.library</code></p></blockquote><h3 id="Modes"><a href="#Modes" class="headerlink" title="Modes"></a>Modes</h3><p>This plugin can be used in two different modes, <em>scoped</em> and <em>mapped</em>.</p><h4 id="Scoped-Mode"><a href="#Scoped-Mode" class="headerlink" title="Scoped Mode"></a>Scoped Mode</h4><p>The content of the dll is accessible under a module prefix, i.e. with <code>scope = &#39;xyz&#39;</code> a file named <code>abc</code> in the dll can be access via <code>require(xyz/abc)</code>.</p><h4 id="Mapped-Mode"><a href="#Mapped-Mode" class="headerlink" title="Mapped Mode"></a>Mapped Mode</h4><p>The content of the dll is mapped to the current directory. If a required file matches a file in the dll(after resolving), then the file from the dll is usd instead.</p><p>Because this happens after resolving every file in the dll bundle, the same paths must be available for the consumer of the dll bundle, i.e. if the dll contains <code>lodash</code> and the file <code>abc</code>, <code>require(&#39;lodash&#39;)</code> and <code>require(&#39;./abc&#39;)</code> will be used from the dll, rather than building them into the main bundle.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.dll.js</span></span><br><span class="line"><span class="keyword">new</span> webpack.DllPlugin(&#123;</span><br><span class="line">  context: __dirname,</span><br><span class="line">  name: <span class="string">&#x27;[name]_[hash]&#x27;</span>,</span><br><span class="line">  path: path.join(__dirname<span class="string">&#x27;, &#x27;</span>manifest.json<span class="string">&#x27;),</span></span><br><span class="line"><span class="string">&#125;)</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.base.js</span></span><br><span class="line"><span class="keyword">new</span> webpack.DllReferencePlugin(&#123;</span><br><span class="line">  context: __dirname,</span><br><span class="line">  manifest: <span class="built_in">require</span>(<span class="string">&#x27;./manifest.json&#x27;</span>),</span><br><span class="line">  name: <span class="string">&#x27;./my-dll.js&#x27;</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Notes"><a href="#Notes" class="headerlink" title="Notes"></a>Notes</h3><h4 id="Output-library-and-DllPlugin-name"><a href="#Output-library-and-DllPlugin-name" class="headerlink" title="Output.library and DllPlugin.name"></a>Output.library and DllPlugin.name</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">&#x27;lib&#x27;</span>),</span><br><span class="line">    filename: <span class="string">&#x27;[name]_[hash].js&#x27;</span>,</span><br><span class="line">    library: <span class="string">&#x27;[name]_[hash]&#x27;</span>, <span class="comment">// this set the exposed function name to [name]_[hash]</span></span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> webpack.DllPlugin(&#123;</span><br><span class="line">      path: path.resolve(__dirname, <span class="string">&#x27;lib&#x27;</span>, <span class="string">&#x27;[name]-manifest.json&#x27;</span>), <span class="comment">// put the manifest file in lib directory</span></span><br><span class="line">      name: <span class="string">&#x27;[name]_[hash]&#x27;</span>, <span class="comment">// be consistent with library name to make the map correct</span></span><br><span class="line">      context: __dirname,</span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Context-in-Dev-Config"><a href="#Context-in-Dev-Config" class="headerlink" title="Context in Dev Config"></a>Context in Dev Config</h4><p>Set the DllReferencePlugin.context same as DllPlugin.context so the manifest will bundle and resolve the dll files from the same root directory.</p><h4 id="Add-dll-bundle-to-html"><a href="#Add-dll-bundle-to-html" class="headerlink" title="Add dll bundle to html"></a>Add dll bundle to html</h4><p>After bundle the dll, I should insert it betore app.js in the html file to provide the <strong>global</strong> function.</p><ul><li>Step 1: Copy the dll files to the dist directory</li></ul><p>I use the <code>copy-webpack-plugin</code> plugin</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">new</span> CopyPlugin([</span><br><span class="line">  &#123; <span class="keyword">from</span> <span class="string">&#x27;./lib/*.js&#x27;</span> &#125; <span class="comment">// default to output.path, so the dll file will be copied to output.path/lib/*.js</span></span><br><span class="line">])</span><br></pre></td></tr></table></figure><ul><li>Generate a manifest of the dll files for html-webpack-plugin to insert to the template</li></ul><p>I use the <code>webpack-manifest-plugin</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.dll.js</span></span><br><span class="line"><span class="keyword">new</span> ManifestPlugin()</span><br></pre></td></tr></table></figure><p>It will generate the <code>manifest.json</code> in output.path</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;vendor.js&quot;</span>: <span class="string">&quot;vendor_0642aa84a6959d661519.js&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Insert the Manifest into the html</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//parse the json</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs)</span></span><br><span class="line"><span class="string">const manifest = JSON.parse(fs.readFileSync(require(&#x27;</span>./lib/manifest.json<span class="string">&#x27;)))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// insert</span></span><br><span class="line"><span class="string">new HtmlPlugin(&#123;</span></span><br><span class="line"><span class="string">  //...</span></span><br><span class="line"><span class="string">  dll: `./lib/$&#123;manifest[&#x27;</span>vendor.js<span class="string">&#x27;]&#125;`, // the dll file locates at ./lib/*.js</span></span><br><span class="line"><span class="string">&#125;)</span></span><br></pre></td></tr></table></figure><h3 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h3><h3 id="Dll-Config"><a href="#Dll-Config" class="headerlink" title="Dll Config"></a>Dll Config</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> ManifestPlugin = <span class="built_in">require</span>(<span class="string">&#x27;webpack-manifest-plugin&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    vendor: [<span class="string">&#x27;./src/vendor&#x27;</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">&#x27;[name]_[hash].js&#x27;</span>,</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">&#x27;lib&#x27;</span>),</span><br><span class="line">    library: <span class="string">&#x27;[name]_[hash]&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> webpack.DllPlugin(&#123;</span><br><span class="line">      name: <span class="string">&#x27;[name]_[hash]&#x27;</span>,</span><br><span class="line">      path: path.resolve(__dirname, <span class="string">&#x27;lib&#x27;</span>, <span class="string">&#x27;[name]-manifest.json&#x27;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> ManifestPlugin(),</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Dev-Config"><a href="#Dev-Config" class="headerlink" title="Dev Config"></a>Dev Config</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlPlugin = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> CopyPlugin = <span class="built_in">require</span>(<span class="string">&#x27;copy-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> manifest = <span class="built_in">JSON</span>.parse(fs.readFileSync(<span class="string">&#x27;./lib/manifest.json&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    app: [<span class="string">&#x27;./src/index&#x27;</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">&#x27;scripts/[name].bundle.js&#x27;</span>,</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> HtmlPlugin(&#123;</span><br><span class="line">      template: path.resolve(__dirname, <span class="string">&#x27;src&#x27;</span>, <span class="string">&#x27;templates&#x27;</span>, <span class="string">&#x27;index.html&#x27;</span>),</span><br><span class="line">      title: <span class="string">&#x27;dev&#x27;</span>,</span><br><span class="line">      dll: <span class="string">`./lib/<span class="subst">$&#123;manifest[<span class="string">&#x27;vendor.js&#x27;</span>]&#125;</span>`</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> webpack.DllReferencePlugin(&#123;</span><br><span class="line">      context: <span class="string">&#x27;.&#x27;</span>,</span><br><span class="line">      manifest: <span class="built_in">require</span>(<span class="string">&#x27;./lib/vendor-manifest&#x27;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> CopyPlugin([</span><br><span class="line">      &#123; <span class="attr">from</span>: <span class="string">&#x27;./lib/*.js&#x27;</span>&#125;</span><br><span class="line">    ]),</span><br><span class="line">  ]</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Optimize Web App</title>
      <link href="/2017/09/07/optimize-web-app/"/>
      <url>/2017/09/07/optimize-web-app/</url>
      
        <content type="html"><![CDATA[<h3 id="Optimizing-All-Assets"><a href="#Optimizing-All-Assets" class="headerlink" title="Optimizing All Assets"></a>Optimizing All Assets</h3><p>One of the most powerful, but under-utilized ways to significantly improve performance starts with understanding hwo the browser analyzes and serves assets. It turns out that browsers are pretty great at discovering resources while parsing and determing their priority of the fly. Here’s where the <strong>critical Request</strong> comes in:</p><blockquote><p>A request is critical if it contains assets that are necessary to render the content within the users’ viewport.</p></blockquote><p>For most sites, it’d be HTML, necessary CSS, a logo, a web font and maybe an image.</p><p>We can control this behavior by carefully picking critical resources and adjusting theri priority.</p><h4 id="preload"><a href="#preload" class="headerlink" title="preload"></a>preload</h4><p>With <code>&lt;link red=&#39;preload&#39;&gt;</code> we are <strong>able to manually force assets’ priority to <code>High</code> ensuring that desired content will be rendered on time</strong>.</p><p>This technique can yield significant improvements in Time to Interactive metric, making optimal user experience possible.</p><p><img src="https://cdn-images-1.medium.com/max/800/1*JT-53LslhwOOqTgv1dGoXg.png"></p><p>Critical requests still seem like a black box for many, and the lack of sharable materials doesn’t help to change that.jj</p><h3 id="Optimizing-Images"><a href="#Optimizing-Images" class="headerlink" title="Optimizing Images"></a>Optimizing Images</h3><p>Images often account for most of a web page’s transferred payload.</p><h4 id="Choosing-the-right-format"><a href="#Choosing-the-right-format" class="headerlink" title="Choosing the right format"></a>Choosing the right format</h4><p>The initial choice falls between vector and raster graphics:</p><ul><li><p><strong>Vector</strong>: resolution independent, usually significantly smaller in size. Perfect for logos, iconography and simple assets comprising of basic shapes.</p></li><li><p><strong>Raster</strong>: offers much more detailed results, ideal for photographs.</p></li></ul><p>After making this decision, there are a fair bit of formats to choose from: <code>JPEG</code>, <code>GIF</code>, <code>PNG-8</code>, <code>PNG-24</code> or newest formats such as <code>WEBP</code> or <code>JPEG-XR</code>, <code>JPEG-2000</code>.</p><ul><li><p><strong>JPEG</strong>: Imagery with many color(e.g. photos)</p></li><li><p><strong>PNG-8</strong>: Imagery with a few color</p></li><li><p><strong>PNG-24</strong>: Imagery with partial transparency</p></li><li><p><strong>GIF</strong>: Animated imagery</p></li></ul><h3 id="Experimenting-with-new-formats"><a href="#Experimenting-with-new-formats" class="headerlink" title="Experimenting with new formats"></a>Experimenting with new formats</h3><p><strong>WebP</strong> is easily the most popular contender, supporting both lossless and lossy compression, which makes it incredibly versatile. <strong>Lossless WebP is 26% smaller than PNGs and 25-34% smaller than JPGs</strong>. With 74% browser support it can safely be used with fallback. JPGs and PNGs can be converted to WebP in PS and other image processing app as well as through command line interface(<code>brew install webp</code>).</p><h3 id="Responsible-and-responsive-Imagery"><a href="#Responsible-and-responsive-Imagery" class="headerlink" title="Responsible and responsive Imagery"></a>Responsible and responsive Imagery</h3><p>W’re perfectly equipped to do so with <code>picture</code> element and <code>srcset</code> attribute(both have 85% support)</p><h4 id="The-srcset-attribute"><a href="#The-srcset-attribute" class="headerlink" title="The srcset attribute"></a>The srcset attribute</h4><p><code>srcset</code> works best in the resolution switching scenario – when we want to display imagery based on user’s screen density and size. Baseed on a set of predefined rules in <code>srcset</code> and <code>size</code> attributes the browser will pick the best image to serve accordingly to the viewport.</p><p><img src="https://cdn-images-1.medium.com/max/800/1*87BIfYsjZTh-bikjmp7eow.png"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span></span></span><br><span class="line"><span class="tag">  <span class="attr">srcset</span>=<span class="string">&quot;cat-320w.jpg 320w cat-480w.jpg 480w cat-800w.jpg 800w&quot;</span>,</span></span><br><span class="line"><span class="tag">  <span class="attr">sizes</span>=<span class="string">&quot;(max-width: 320px) 100vw, (max-width: 480px) 80vw, 800px&quot;</span>,</span></span><br><span class="line"><span class="tag">  <span class="attr">src</span>=<span class="string">&quot;cat-800w.jpg&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">alt</span>=<span class="string">&quot;cat&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></table></figure><h4 id="The-picture-element"><a href="#The-picture-element" class="headerlink" title="The picture element"></a>The picture element</h4><p><code>picture</code> element and the <code>media</code> attribute are designed to make art direction easy. BY providing different sources for varying conditions.</p><p><img src="https://cdn-images-1.medium.com/max/800/1*NeyfH6Vu1xCWE2SY5w1cDQ.png"></p><h4 id="Delivery-with-image-CNDs"><a href="#Delivery-with-image-CNDs" class="headerlink" title="Delivery with image CNDs"></a>Delivery with image CNDs</h4><h3 id="Optimizing-Web-Fonts"><a href="#Optimizing-Web-Fonts" class="headerlink" title="Optimizing Web Fonts"></a>Optimizing Web Fonts</h3><h4 id="Choose-the-right-format"><a href="#Choose-the-right-format" class="headerlink" title="Choose the right format"></a>Choose the right format</h4><p>There are four web font formats: <code>EOT</code>, <code>TTF</code>, <code>WOFF</code> and <code>WOFF2</code>.</p><p>TTF and WOFF are most widely adopted, boasting over 90% browser support. Depending on the support you’re targeting <strong>it’s most likely safe to server WOFF2</strong> and fall back to WOFF for older browsers. The advantage of using WOFF2 is a set of custom preprocessing and compression algorithms resulting in approx 30% file-size reduction and impoved parsing capabilities.</p><p>When defining the sources of web fonts in <code>@font-face</code> use the <code>format()</code> hint to specify which format should be utilized.</p><h4 id="use-Unicode-range-subsetting"><a href="#use-Unicode-range-subsetting" class="headerlink" title="use Unicode-range subsetting"></a>use Unicode-range subsetting</h4><h4 id="Establish-a-font-loading-strategy"><a href="#Establish-a-font-loading-strategy" class="headerlink" title="Establish a font loading strategy"></a>Establish a font loading strategy</h4><p>Fonts are render-blocking – because the browser has to build both the DOM and CSSOM first. Wdb fonts won’t be downloaded before they’re used in a CSS selector that matches an existing node. This behavior significantly delays text rendering, often causing the <strong>Flash of Invisible Text</strong>(FOIT).</p><p>Implementing a font strategy prevents users from not being able to access your content.</p><p><code>font-display</code> is a new CSS property providing a non-javascript reliant solution.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@font-face &#123;</span><br><span class="line">  font-family: Post Grotesk;</span><br><span class="line">  src: url(<span class="string">&#x27;/fonts/Post-Growtest.woff2&#x27;</span>) format(<span class="string">&#x27;woff2&#x27;</span>),</span><br><span class="line">       url(<span class="string">&#x27;/fonts/Post-Growtest.woff&#x27;</span> format(<span class="string">&#x27;woff&#x27;</span>)),</span><br><span class="line">  font-display: swap; <span class="comment">// show fallback until web font is ready</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Optmizing-JS"><a href="#Optmizing-JS" class="headerlink" title="Optmizing JS"></a>Optmizing JS</h3>]]></content>
      
      
      
        <tags>
            
            <tag> HTML </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Concept on BlockChain</title>
      <link href="/2017/09/07/Concept-on-BlockChain/"/>
      <url>/2017/09/07/Concept-on-BlockChain/</url>
      
        <content type="html"><![CDATA[<p>A Blockchain is</p><blockquote><p>A distributed database that is used to maintain a continuously growing list of records, called block.</p></blockquote><p>A Block contains following information:</p><ul><li><p>Index(Block #) - Which block is it? (Genesis block has index 0)</p></li><li><p>Hash: Is the block valid?</p></li><li><p>Previous Hash: It the previous block valid?</p></li><li><p>Timestamp: When was the block added?</p></li><li><p>Data: What information is stored on the block?</p></li><li><p>Nonce: How many iterations did we go through before we found a valid block?</p></li></ul><h3 id="Genesis-Block"><a href="#Genesis-Block" class="headerlink" title="Genesis Block"></a>Genesis Block</h3><p>Every Blockchain will st art with the <code>Genesis Block</code>, each block on the blockchain is dependent on the previous block, so the Genesis Block is needed to mine our first block.</p><h3 id="Hash"><a href="#Hash" class="headerlink" title="Hash"></a>Hash</h3><p>A <strong>hash value</strong> is a numeric value of a fixed length that uniquely identifies data.</p><p>The hash is calculated by taking the <strong>index</strong>, <strong>previous block hash</strong>, <strong>timestamp</strong>, <strong>block data</strong>, and <strong>nonce</strong> as input.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CryptoJS.SHA256(index + previousHash + timestamp + data + nonce)</span><br></pre></td></tr></table></figure><h3 id="Leading-0-in-the-block-hash"><a href="#Leading-0-in-the-block-hash" class="headerlink" title="Leading 0 in the block hash"></a>Leading 0 in the block hash</h3><p>Specified leading 0 is a minimum requirement for a valid hash. The number of leading 0 required is called <strong>difficulty</strong>.</p><p>The is also known as the <strong>Proof-of-Work</strong> system.</p><h3 id="Nonce"><a href="#Nonce" class="headerlink" title="Nonce"></a>Nonce</h3><p>A nonce is a number used to find a valid hash</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> nonce = <span class="number">0</span></span><br><span class="line"><span class="keyword">let</span> hash</span><br><span class="line"><span class="keyword">let</span> input</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (!isValidHashDifficulty(hash)) &#123;</span><br><span class="line">  nonce += <span class="number">1</span></span><br><span class="line">  input = index + previousHash + timeStamp + data + nonce</span><br><span class="line">  hash = CryptoJS.SHA256(input)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The nocne iterates until the hash is valid.</p><p>The process of finding a nonce that corresponds to a valid hash is <strong>mining</strong>.</p><p>As the difficulty <strong>increase</strong>, the number of possible valid hashes <strong>decrese</strong>. With less possible valid hashes, it takes more processing power to find a valid hash.</p><h3 id="Ethereum-Virtual-Machine-EVM"><a href="#Ethereum-Virtual-Machine-EVM" class="headerlink" title="Ethereum Virtual Machine (EVM)"></a>Ethereum Virtual Machine (EVM)</h3><p>The Ethereum Virtual Machine or EVM is the runtime environment for smart contracts in Ethereum. It is not only sandboxed but actually completely isolated, which means that code running inside the EVM has no access to network, filesystem or other processes. Smart contract even have limited access to other smart contracts.</p><h4 id="Accounts"><a href="#Accounts" class="headerlink" title="Accounts"></a>Accounts</h4><p>There are two kinds of accounts in Ethereum which share the same address space:</p><ul><li><p><code>External Account</code> that are controlled by public-private key pairs(i.e. humans)</p></li><li><p><code>Contract Account</code> that are controlled by the code stored together with accounts</p></li></ul><p>The address of an external account is determined from the public key while the address of a contract is determined at the time the contract is created(it is derived from the creator address and the number of transactions sent from the address, the so-called ‘nonce’).</p><p>Every account has a <strong>persistent key-value store mapping 256-bit words to 256-bit words</strong> called <strong>storage</strong>.</p><p>Every account has a <strong>balance</strong> in Ether(in <em>Wei</em> to be exact) which can be modified by sending transactions that include Ether.</p><h4 id="transactions"><a href="#transactions" class="headerlink" title="transactions"></a>transactions</h4><p>A transaction is a message that is sent from one account to another account(which might be the same or the special <strong>zero-account</strong>). It can include binary data(its payload) and Ether.</p><p>If the target account contains code, that code is executed and the payload is provided as input data.</p><p>If the target account is the <em>zero-account</em>(the account with the address 0), the transaction creates a <strong>new contract</strong>.</p><p>As memtioned, the address of that contract is not the zero address but an address derived from the sender and its number of transactions sent(nonce). <strong>The payload of such a contract creation transaction is taken to be EVM bytecode and executed to generate the new contract</strong></p><p>The output of the bytecode, namely the new contract, is permenantly stored.</p><h4 id="Gas"><a href="#Gas" class="headerlink" title="Gas"></a>Gas</h4><p>Each transaction is charged with a certain with a certain amount of <strong>gas</strong>, whose purpose is to limit the amount of work that is needed to executed the transaction and to pay for this execution.</p><p>While the EVM executes the transaction, the gas is gradually depleted according to specific rules.</p><p>The <code>gas price</code> is a value set by the creator of the transaction, who has to pay <code>gas_price * gas</code>.</p><h4 id="Storage-Memory-and-the-Stack"><a href="#Storage-Memory-and-the-Stack" class="headerlink" title="Storage, Memory and the Stack"></a>Storage, Memory and the Stack</h4><p>Each account has a persistent memory area which is called <strong>storage</strong>. Storage is a <strong>key-value</strong> store taht maps 256-bit word to 256-bit word.</p><p>The second memory area is called <strong>memory</strong>, of which a contract obtains a freshly cleared instance for each message call. Memory is linear and can be addressed at byte level, but reads are limited to a width of 256 bits, white writes can be either 8btis or 256bits wide.</p><p>Memory is expanded by a word(256-bit), when accessing (either reading or writing) a previously untouched memory word. At the time of expansion, the cost in gas must be paid. Memory is more costly the larger it grows(it scales quadratically).</p><p>The EVM is not a register machine but a stack machine, so all computations are performed on an area called the <strong>stack</strong>. It has limited to the top end in the following way:</p><ul><li><p>it is possible to copy one of the topmost 16 elements to the top of the stack or swap the topmost 2(or 1, or more, depending on the opeartion) element fomr the stack and push the result onto the stack.</p></li><li><p>All other operation take the topmost 2(or 1, or more, depending on the operation) elements from the stack and push the result onto the stack.</p></li><li><p>It is possible to move stack elements to storage or memory</p></li><li><p>It is not possible to just access arbitrary elements deeper in the stack without removing the top of the stack.</p></li></ul><h3 id="Instruction-Set"><a href="#Instruction-Set" class="headerlink" title="Instruction Set"></a>Instruction Set</h3><p>The instruction set of the EVM is kept minimal in order to avoid incorrect implementations which could cuase consensus problem. All instructions operate ont he basic data type, 256-bit words.</p><p>The usual arihmetic bit, logical and comparison operations are present. Conditional and unconditional jumps are possible. Furthermore, contracts can access relevant properties of the current block like its number and timestamp.</p><h3 id="Message-Calls"><a href="#Message-Calls" class="headerlink" title="Message Calls"></a>Message Calls</h3><p>Contracts can call other contracts or send Ether to non-contract accounts by the means of the message calls.</p><p>Message calls are similar to transactions, in that tehy have a <strong>source</strong>, a <strong>target</strong>, <strong>data payload</strong>, <strong>Ether</strong>, <strong>gas</strong>, and return <strong>data</strong>.</p><p>In fact, every transaction consists of a top-level message call which in turn can create further message calls.</p><p>A contract can decide how much of its remaining <strong>gas</strong> should be sent with the inner message call and how much it wants to retain. If an out-of-gas exception happens in the inner call(or any other exception), this will be signalled by an error value put onto the stack. In this case, only the gas sent together with the call is used up.</p><p>Summarily, a called contract(which can be the same as caller) will receive a <strong>freshly cleared instance of memoery</strong>, and has access to the call payload - which will be provided in a separate area called the <strong>calldata</strong>. After it has finished execution, it can return data which will be stored at a location in the caller’s memory preallocated by the caller.</p><p>Calls are limited to depth of 1024, which means that for more complex operations, loops should be preferred over recursive calls.</p><h3 id="Delegatecall-Callcode-and-Libraries"><a href="#Delegatecall-Callcode-and-Libraries" class="headerlink" title="Delegatecall / Callcode and Libraries"></a>Delegatecall / Callcode and Libraries</h3><p>There exists a special variant of a message call, named <strong>delegatecall</strong> which is identical to a message call apart from the fact taht the code at the target address is executed in the context of the calling contract and <code>msg.sender</code> and <code>msg.value</code> do not change their values.</p><p>This means that a contract can dynamically load code from a different address at runtime. Storage, current address and balance still refer to the calling contract, only the code is taken from teh called address.</p><p>This makes it possible to implement the ‘library’ feature in Solidity: Reusable library code that can be applied to a contract’s storage to implement a complex data structure.</p><h3 id="Logs"><a href="#Logs" class="headerlink" title="Logs"></a>Logs</h3><p>It is possible to store data in a special indexed data structure that maps all the way up to the block level. This feature called <strong>logs</strong> is used by Solidity in order to implement <strong>events</strong>. Contracts cannot access log data after it has been created, but they can efficiently accessed from outside the blockchain.</p><p>Since some part of the log data is stored in bloom filters, it is possible to search for this data in an efficient and crypographically secure way, so network peers that do not download the whole blockchain(‘light clients’) can still find these logs.</p><h3 id="Create"><a href="#Create" class="headerlink" title="Create"></a>Create</h3><p>Contracts can even create other contract s using a special opcode. The only difference between <strong>create calls</strong> and normal message calls is that the payload data is executed and the result stored as code and the caller/creator receives the address of the new contract on the stack.</p><h3 id="Self-destruct"><a href="#Self-destruct" class="headerlink" title="Self-destruct"></a>Self-destruct</h3><p>The only possible that code is removed from the blockchain is when a contract at that address performs the <code>selfdestruct</code> operation. The remaining Ether stored at that address is sent to a designed target and then the storage and code is removed from the state.</p><blockquote><p>Even if a contract’s code does not contain a call to <code>selfdestruct</code>, it can still perform that operation using <code>delegatecall</code> or <code>callcode</code>.</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> Blockchain </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Build Node CLI</title>
      <link href="/2017/09/06/Build-Node-CLI/"/>
      <url>/2017/09/06/Build-Node-CLI/</url>
      
        <content type="html"><![CDATA[<h3 id="Dependencies"><a href="#Dependencies" class="headerlink" title="Dependencies"></a>Dependencies</h3><ul><li><p>chalk: colorize the output</p></li><li><p>clear: clears the terminal screen</p></li><li><p>clui: draws command line tables, gauges and spinners</p></li><li><p>figlet: creates ASCII art from text</p></li><li><p>inquirer - create interactive command line user interface</p></li><li><p>minimist - parses argument options</p></li><li><p>preferences - manage CLI application encrypted preferences</p></li></ul><h4 id="chalk"><a href="#chalk" class="headerlink" title="chalk"></a>chalk</h4><ul><li><p><code>chalk.&lt;style&gt;[.&lt;style&gt;...](string, [string...])</code></p><p>  chalk.red.bold.underline(‘Hello’, ‘World’)</p></li><li><p>chalk`string {&lt;style&gt; &lt;style&gt;… string} string`</p><p>  chalk`There are { bold 5280 feet } in a mile `</p></li></ul><h4 id="clear"><a href="#clear" class="headerlink" title="clear"></a>clear</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> clear = <span class="built_in">require</span>(<span class="string">&#x27;clear&#x27;</span>)</span><br><span class="line">clear()</span><br></pre></td></tr></table></figure><h4 id="clui"><a href="#clui" class="headerlink" title="clui"></a>clui</h4><p>Display</p><ul><li><p>Gauge</p></li><li><p>PrograssBar</p></li><li><p>Sparklines</p></li><li><p>Spinners</p></li></ul><p>on Terminal</p><h4 id="figlet"><a href="#figlet" class="headerlink" title="figlet"></a>figlet</h4><p>Display ASCII font on Terminal</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">figlet.text(<span class="string">&#x27;Boo&#x27;</span>, &#123;</span><br><span class="line">  font: <span class="string">&#x27;Ghost&#x27;</span>,</span><br><span class="line">  horizontalLayout: <span class="string">&#x27;default&#x27;</span>,</span><br><span class="line">  verticalLayout: <span class="string">&#x27;default&#x27;</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="built_in">console</span>.log(err)</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">figlet.textSync(<span class="string">&#x27;Boo&#x27;</span>, &#123;</span><br><span class="line">  font: <span class="string">&#x27;Ghost&#x27;</span>,</span><br><span class="line">  horizontalLayout: <span class="string">&#x27;default&#x27;</span>,</span><br><span class="line">  verticalLayout: <span class="string">&#x27;default&#x27;</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="inquirer"><a href="#inquirer" class="headerlink" title="inquirer"></a>inquirer</h4><p>A collection of common interactive command line user interface.</p><ul><li><p><code>inquirer.prompt(questions) =&gt; promise</code></p><ul><li><p><code>questions</code> an Array containing <code>Question Object</code>(using the reactive interface, you can also pass a Rx.observable instance)</p><ul><li><code>Question Object</code>:</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//   type: string, //[&#x27;input&#x27;, &#x27;confirm&#x27;, &#x27;list&#x27;, &#x27;rawlist&#x27;, &#x27;expand&#x27;, &#x27;checkbox&#x27;, &#x27;password&#x27;, &#x27;editor&#x27;]</span></span><br><span class="line"><span class="comment">//   name: string, // the name to use when storeing the answer in the answer hash</span></span><br><span class="line"><span class="comment">//   message: string|function,  // The question to print, if defined as a function, the first parameter will be the current inquirer session answer</span></span><br><span class="line"><span class="comment">//   default: string|number|array|function, // default value to use</span></span><br><span class="line"><span class="comment">//   choices: array|function,</span></span><br><span class="line"><span class="comment">//   validate: function, // receive the user input and answers hash, should return true if the value is valid, and an error message(string) otherwise. If a false is returned, a default error message is provided.</span></span><br><span class="line"><span class="comment">//   filter: function, //</span></span><br><span class="line"><span class="comment">//   when: function|boolean, //</span></span><br><span class="line"><span class="comment">//   pageSize: number, //</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure><h4 id="minimist"><a href="#minimist" class="headerlink" title="minimist"></a>minimist</h4></li></ul></li></ul><h4 id="preferences"><a href="#preferences" class="headerlink" title="preferences"></a>preferences</h4><h3 id="Make-CLI-globally-available"><a href="#Make-CLI-globally-available" class="headerlink" title="Make CLI globally available"></a>Make CLI globally available</h3><p>Add a shebang line to the top of <code>index.js</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env node</span></span><br></pre></td></tr></table></figure><p>Then add a <code>bin</code> prototype to <code>package.json</code>.</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;bin&quot;: &#123;</span><br><span class="line">  &quot;cli-init&quot;: &quot;./index.js&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
            <tag> CLI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Start Up With Ts, React, Router, Redux, Rxjs</title>
      <link href="/2017/09/05/start-up-with-ts-react-router-redux-rxjs/"/>
      <url>/2017/09/05/start-up-with-ts-react-router-redux-rxjs/</url>
      
        <content type="html"><![CDATA[<p>The <a href="https://github.com/Keith-CY/starter-of-react-redux-router-rxjs.git">Repo</a></p><h3 id="Dependencies"><a href="#Dependencies" class="headerlink" title="Dependencies"></a>Dependencies</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&quot;devDependencies&quot;: &#123;</span><br><span class="line">  &quot;@types/react&quot;: &quot;^16.0.5&quot;,</span><br><span class="line">  &quot;@types/react-dom&quot;: &quot;^15.5.4&quot;,</span><br><span class="line">  &quot;@types/react-redux&quot;: &quot;^5.0.6&quot;,</span><br><span class="line">  &quot;@types/redux-actions&quot;: &quot;^1.2.8&quot;,</span><br><span class="line">  &quot;@types/webpack&quot;: &quot;^3.0.10&quot;,</span><br><span class="line">  &quot;@types/webpack-dev-server&quot;: &quot;^2.4.1&quot;,</span><br><span class="line">  &quot;autoprefixer&quot;: &quot;^7.1.3&quot;,</span><br><span class="line">  &quot;babel-core&quot;: &quot;^6.26.0&quot;,</span><br><span class="line">  &quot;babel-loader&quot;: &quot;^7.1.2&quot;,</span><br><span class="line">  &quot;babel-preset-env&quot;: &quot;^1.6.0&quot;,</span><br><span class="line">  &quot;babel-preset-react&quot;: &quot;^6.24.1&quot;,</span><br><span class="line">  &quot;bundle-loader&quot;: &quot;^0.5.5&quot;,</span><br><span class="line">  &quot;eslint&quot;: &quot;^4.6.1&quot;,</span><br><span class="line">  &quot;eslint-config-airbnb&quot;: &quot;^15.1.0&quot;,</span><br><span class="line">  &quot;eslint-plugin-import&quot;: &quot;^2.7.0&quot;,</span><br><span class="line">  &quot;eslint-plugin-jsx-a11y&quot;: &quot;^6.0.2&quot;,</span><br><span class="line">  &quot;eslint-plugin-react&quot;: &quot;^7.3.0&quot;,</span><br><span class="line">  &quot;html-webpack-plugin&quot;: &quot;^2.30.1&quot;,</span><br><span class="line">  &quot;node-sass&quot;: &quot;^4.5.3&quot;,</span><br><span class="line">  &quot;precss&quot;: &quot;^2.0.0&quot;,</span><br><span class="line">  &quot;redux-devtools&quot;: &quot;^3.4.0&quot;,</span><br><span class="line">  &quot;redux-devtools-dock-monitor&quot;: &quot;^1.1.2&quot;,</span><br><span class="line">  &quot;redux-devtools-log-monitor&quot;: &quot;^1.3.0&quot;,</span><br><span class="line">  &quot;rimraf&quot;: &quot;^2.6.1&quot;,</span><br><span class="line">  &quot;sass-loader&quot;: &quot;^6.0.6&quot;,</span><br><span class="line">  &quot;ts-loader&quot;: &quot;^2.3.4&quot;,</span><br><span class="line">  &quot;typescript&quot;: &quot;next&quot;,</span><br><span class="line">  &quot;uglifyjs-webpack-plugin&quot;: &quot;^0.4.6&quot;,</span><br><span class="line">  &quot;webpack&quot;: &quot;^3.5.5&quot;,</span><br><span class="line">  &quot;webpack-dashboard&quot;: &quot;^1.0.0-5&quot;,</span><br><span class="line">  &quot;webpack-dev-server&quot;: &quot;^2.7.1&quot;,</span><br><span class="line">  &quot;webpack-merge&quot;: &quot;^4.1.0&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;dependencies&quot;: &#123;</span><br><span class="line">  &quot;@types/node&quot;: &quot;^8.0.26&quot;,</span><br><span class="line">  &quot;@types/react-router-dom&quot;: &quot;^4.0.7&quot;,</span><br><span class="line">  &quot;babel-plugin-transform-runtime&quot;: &quot;^6.23.0&quot;,</span><br><span class="line">  &quot;extract-text-webpack-plugin&quot;: &quot;^3.0.0&quot;,</span><br><span class="line">  &quot;react&quot;: &quot;^15.6.1&quot;,</span><br><span class="line">  &quot;react-dom&quot;: &quot;^15.6.1&quot;,</span><br><span class="line">  &quot;react-redux&quot;: &quot;^5.0.6&quot;,</span><br><span class="line">  &quot;react-router&quot;: &quot;^4.2.0&quot;,</span><br><span class="line">  &quot;react-router-dom&quot;: &quot;^4.2.2&quot;,</span><br><span class="line">  &quot;redux&quot;: &quot;^3.7.2&quot;,</span><br><span class="line">  &quot;redux-actions&quot;: &quot;^2.2.1&quot;,</span><br><span class="line">  &quot;redux-observable&quot;: &quot;^0.16.0&quot;,</span><br><span class="line">  &quot;rxjs&quot;: &quot;^5.4.3&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Project-Structure"><a href="#Project-Structure" class="headerlink" title="Project Structure"></a>Project Structure</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── config</span><br><span class="line">│   ├── webpack.config.base.js</span><br><span class="line">│   ├── webpack.config.dev.js</span><br><span class="line">│   ├── webpack.config.prod.js</span><br><span class="line">├── src</span><br><span class="line">│   ├── actions</span><br><span class="line">│   │   ├── index.tsx</span><br><span class="line">│   │   ├── hello.tsx</span><br><span class="line">│   ├── components</span><br><span class="line">│   │   ├── AsyncRoute.tsx</span><br><span class="line">│   ├── containers</span><br><span class="line">│   │   ├── App.tsx</span><br><span class="line">│   │   ├── Header.tsx</span><br><span class="line">│   │   ├── Body.jsx</span><br><span class="line">│   │   ├── Footer.tsx</span><br><span class="line">│   │   ├── Index.tsx</span><br><span class="line">│   │   ├── Page2.tsx</span><br><span class="line">│   │   ├── DevTools.tsx</span><br><span class="line">│   ├── epics</span><br><span class="line">│   │   ├── index.tsx</span><br><span class="line">│   │   ├── hello.tsx</span><br><span class="line">│   ├── reducers</span><br><span class="line">│   │   ├── index.tsx</span><br><span class="line">│   │   ├── hello.tsx</span><br><span class="line">│   ├── store</span><br><span class="line">│   │   ├── index.tsx</span><br><span class="line">│   │   ├── configureStore.dev.tsx</span><br><span class="line">│   │   ├── configureStore.prod.tsx</span><br><span class="line">│   ├── templates</span><br><span class="line">│   │   ├── index.html</span><br><span class="line">│   ├── utils</span><br><span class="line">│   │   ├── connect.tsx</span><br><span class="line">│   │   ├── nav.tsx</span><br><span class="line">│   ├── app.tsx</span><br><span class="line">├── package.json</span><br><span class="line">├── tsconfig.json</span><br><span class="line">├── postcss.config.js</span><br><span class="line">├── .babelrc</span><br><span class="line">├── .eslintrc.js</span><br><span class="line">├── .gitignore</span><br><span class="line">├── yarn.lock</span><br></pre></td></tr></table></figure><h3 id="Step-1-Create-Project"><a href="#Step-1-Create-Project" class="headerlink" title="Step 1: Create Project"></a>Step 1: Create Project</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># init project</span></span><br><span class="line">yarn init -y</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># add eslint</span></span><br><span class="line">yarn add --dev eslint eslint-config-airbnb eslint-plugin-import eslint-plugin-jsx-a11y eslint-plugin-react</span><br><span class="line"></span><br><span class="line">eslint --init</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># add webpack</span></span><br><span class="line">yarn add --dev webpack webpack-dev-server webpack-dashboard webpack-merge @types/webpack @types/webpack-dev-server</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># add loader for jsx</span></span><br><span class="line">yarn add --dev babel-core babel-loader babel-preset-env babel-preset-react</span><br><span class="line"></span><br><span class="line"><span class="comment"># add loader for tsx</span></span><br><span class="line">yarn add --dev ts-loader typescript@next</span><br><span class="line"></span><br><span class="line"><span class="comment"># add loader for css</span></span><br><span class="line">yarn add --dev style-loader css-loader resolve-url-loader postcss-loader node-sass sass-loader</span><br><span class="line"></span><br><span class="line"><span class="comment"># add loader for file</span></span><br><span class="line">yarn add --dev url-loader file-loader</span><br><span class="line"></span><br><span class="line"><span class="comment"># add plugin for js</span></span><br><span class="line">yarn add babel-plugin-transform-runtime</span><br><span class="line"></span><br><span class="line"><span class="comment"># add plugin for postcss</span></span><br><span class="line">yarn add --dev autoprefixer precss</span><br><span class="line"></span><br><span class="line"><span class="comment"># add plugin for html</span></span><br><span class="line">yarn add --dev html-webpack-plugin</span><br><span class="line"></span><br><span class="line"><span class="comment"># add plugin for uglifyjs</span></span><br><span class="line">yarn add --dev uglifyjs-webpack-plugin</span><br><span class="line"></span><br><span class="line"><span class="comment"># add plugin for extract css</span></span><br><span class="line">yarn add --dev extract-text-webpack-plugin</span><br></pre></td></tr></table></figure><h3 id="set-gitignore"><a href="#set-gitignore" class="headerlink" title="set gitignore"></a>set gitignore</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Logs</span></span><br><span class="line">*.<span class="built_in">log</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># dependencies</span></span><br><span class="line">node_modules</span><br><span class="line"></span><br><span class="line"><span class="comment"># build</span></span><br><span class="line">dist</span><br></pre></td></tr></table></figure><h3 id="set-typescript-config"><a href="#set-typescript-config" class="headerlink" title="set typescript config"></a>set typescript config</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;outDir&quot;</span>: <span class="string">&quot;dist&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;module&quot;</span>: <span class="string">&quot;commonjs&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;target&quot;</span>: <span class="string">&quot;es5&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;lib&quot;</span>: [<span class="string">&quot;es6&quot;</span>, <span class="string">&quot;dom&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;sourceMap&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;allowJs&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;jsx&quot;</span>: <span class="string">&quot;react&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;moduleResolution&quot;</span>: <span class="string">&quot;node&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;rootDir&quot;</span>: <span class="string">&quot;src&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;noImplicitReturns&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;noImplicitThis&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">&quot;noImplicitAny&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">&quot;strictNullChecks&quot;</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;exclude&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;config&quot;</span>,</span><br><span class="line">    <span class="string">&quot;node_modules&quot;</span>,</span><br><span class="line">    <span class="string">&quot;dist&quot;</span>,</span><br><span class="line">    <span class="string">&quot;webpack&quot;</span>,</span><br><span class="line">    <span class="string">&quot;jest&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;types&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;typePatches&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Set-basic-webpack-config"><a href="#Set-basic-webpack-config" class="headerlink" title="Set basic webpack config"></a>Set basic webpack config</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// /config/webpack.config.base.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">&#x27;../dist&#x27;</span>),</span><br><span class="line">    filename: <span class="string">&#x27;scripts/[name]-[hash].js&#x27;</span>,</span><br><span class="line">    chunkFilename: <span class="string">&#x27;scripts/[name]-[chunkhash].js&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.tsx?$/</span>,</span><br><span class="line">        loader: <span class="string">&#x27;ts-loader&#x27;</span>,</span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span></span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        test: <span class="regexp">/\.jsx?$/</span>,</span><br><span class="line">        loader: <span class="string">&#x27;babel-laoder&#x27;</span>,</span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        test: <span class="regexp">/\.(png|jpg)$/</span>,</span><br><span class="line">        loader: <span class="string">&#x27;url-loader&#x27;</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">          limit: <span class="number">8192</span>,</span><br><span class="line">          name: <span class="string">&#x27;[name]-[hash].[ext]&#x27;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    extensions: [<span class="string">&#x27;.tsx&#x27;</span>, <span class="string">&#x27;.ts&#x27;</span>, <span class="string">&#x27;.jsx&#x27;</span>, <span class="string">&#x27;.js&#x27;</span>, <span class="string">&#x27;.scss&#x27;</span>, <span class="string">&#x27;.css&#x27;</span>, <span class="string">&#x27;.json&#x27;</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Set-dev-webpack-config"><a href="#Set-dev-webpack-config" class="headerlink" title="Set dev webpack config"></a>Set dev webpack config</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// /config/webpack.config.dev.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">&#x27;webpack-merge&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlPlugin = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> DashboardPlugin = <span class="built_in">require</span>(<span class="string">&#x27;webpack-dashboard/plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> baseConfig = <span class="built_in">require</span>(<span class="string">&#x27;./webpack.config.base&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> devConfig = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    app: [</span><br><span class="line">      <span class="string">&#x27;webpack/hot/only-dev-server&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;webpack-dev-server/client?http://localhost:8080&#x27;</span>,</span><br><span class="line">      path.resolve(__dirname, <span class="string">&#x27;../src/app.tsx&#x27;</span>),</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.scss$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          <span class="string">&#x27;style-loader&#x27;</span>,</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">&#x27;css-loader&#x27;</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              modules: <span class="literal">true</span>,</span><br><span class="line">              name: <span class="string">&#x27;[local]-[name]-[hash]&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&#x27;resolve-url-loader&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;sass-loader&#x27;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  devtool: <span class="string">&#x27;source-map&#x27;</span>,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> webpack.HotModuleReplacementPlugin(),</span><br><span class="line">    <span class="keyword">new</span> webpack.NamedModulesPlugin(),</span><br><span class="line">    <span class="keyword">new</span> webpack.DefinePluing(&#123;</span><br><span class="line">      <span class="string">&#x27;process.env&#x27;</span>: &#123;</span><br><span class="line">        NODE_ENV: <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> DashboardPlugin(),</span><br><span class="line">    <span class="keyword">new</span> HtmlPlugin(&#123;</span><br><span class="line">      title: <span class="string">&#x27;开发&#x27;</span>,</span><br><span class="line">      template: path.resolve(__dirname, <span class="string">&#x27;../src/temlates/index.html&#x27;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    hot: <span class="literal">true</span>,</span><br><span class="line">    compress: <span class="literal">true</span>,</span><br><span class="line">    historyApiFallback: <span class="literal">true</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = merge(baseConfig, devConfig)</span><br></pre></td></tr></table></figure><h4 id="Set-prod-webpack-config"><a href="#Set-prod-webpack-config" class="headerlink" title="Set prod webpack config"></a>Set prod webpack config</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// /config/webpack.config.prod.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">&#x27;webpack-merge&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> ExtractTextPlugin = <span class="built_in">require</span>(<span class="string">&#x27;extract-text-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> UglifyJSPlugin = <span class="built_in">require</span>(<span class="string">&#x27;uglifyjs-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlPlugin = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> baseConfig = <span class="built_in">require</span>(<span class="string">&#x27;./webpack.config.base.js&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> prodConfig = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    app: path.resolve(__dirname, <span class="string">&#x27;../src/app.tsx&#x27;</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      test: <span class="regexp">/\.scss$/</span>,</span><br><span class="line">      use: ExtractTextPlugin.extract(&#123;</span><br><span class="line">        fallback: <span class="string">&#x27;style-loader&#x27;</span>,</span><br><span class="line">        use: [</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">&#x27;css-loader&#x27;</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              modules: <span class="literal">true</span>,</span><br><span class="line">              name: <span class="string">&#x27;[local]-[name]-[hash]&#x27;</span>,</span><br><span class="line">              importLoaders: <span class="number">3</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">      &#125;), &#123;</span><br><span class="line">        loader: <span class="string">&#x27;postcss-loader&#x27;</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">          config: path.resolve(__dirname, <span class="string">&#x27;./config/postcss.config.json&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&#x27;resolve-url-loader&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;sass-loader&#x27;</span>,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  devtool: <span class="string">&#x27;inline-source-map&#x27;</span>,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> webpack.DefinePluing(&#123;</span><br><span class="line">      <span class="string">&#x27;process.env.NODE_ENV&#x27;</span>: <span class="string">&#x27;production&#x27;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">      name: <span class="string">&#x27;app&#x27;</span>,</span><br><span class="line">      filename: <span class="string">&#x27;scripts/vendor-[hash].min.js&#x27;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> HtmlPlugin(&#123;</span><br><span class="line">      title: <span class="string">&#x27;生产&#x27;</span>,</span><br><span class="line">      template: path.resolve(__dirnaem, <span class="string">&#x27;../src/templates/index.html&#x27;</span>),</span><br><span class="line">      minify: &#123;</span><br><span class="line">        collapseBooleanAttributes: <span class="literal">true</span>,</span><br><span class="line">        collapseInlineTagWhitespace: <span class="literal">true</span>,</span><br><span class="line">        collapseWhitespace: <span class="literal">true</span>,</span><br><span class="line">        minifyCSS: <span class="literal">true</span>,</span><br><span class="line">        minifyJS: <span class="literal">true</span>,</span><br><span class="line">        removeAttributeQuotes: <span class="literal">true</span>,</span><br><span class="line">        removeComments: <span class="literal">true</span>,</span><br><span class="line">        removeEmptyAttributes: <span class="literal">true</span>,</span><br><span class="line">        removeRedundantAttributes: <span class="literal">true</span>,</span><br><span class="line">        removeTagWhitespace: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> ExtractTextPlugin(&#123;</span><br><span class="line">      filename: <span class="string">&#x27;styles/[name]-[contenthash].css&#x27;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> UglifyJSPlugin(),</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Set-config-refered-by-webpack-babelrc-postcss-index-html"><a href="#Set-config-refered-by-webpack-babelrc-postcss-index-html" class="headerlink" title="Set config refered by webpack(babelrc, postcss, index.html)"></a>Set config refered by webpack(babelrc, postcss, index.html)</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// /.babelrc</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;presets&quot;</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">&quot;env&quot;</span>, &#123;</span><br><span class="line">        <span class="string">&quot;targets&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;browsers&quot;</span>: [<span class="string">&quot;last 2 versions&quot;</span>, <span class="string">&quot;safari &gt;= 9&quot;</span>],</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;react&quot;</span>,</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;plugins&quot;</span>: [</span><br><span class="line">    [<span class="string">&quot;transform-runtime&quot;</span>, &#123;</span><br><span class="line">      <span class="string">&quot;polyfill&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&quot;regenerator&quot;</span>: <span class="literal">true</span></span><br><span class="line">    &#125;],</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> precss = <span class="built_in">require</span>(<span class="string">&#x27;precss&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> autoprefixer = <span class="built_in">require</span>(<span class="string">&#x27;autoprefixer&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    precss,</span><br><span class="line">    autoprefixer,</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;<span class="name">%=</span> <span class="attr">htmlWebpackPlugin.options.title</span> %&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Step-2-Skeleton-of-React-App-React-Router"><a href="#Step-2-Skeleton-of-React-App-React-Router" class="headerlink" title="Step 2: Skeleton of React App(React + Router)"></a>Step 2: Skeleton of React App(React + Router)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev bundle-laoder @types/react @types/react-dom @types/node @types/react-router-dom</span><br><span class="line"></span><br><span class="line">yarn add react react-dom react-router-dom</span><br></pre></td></tr></table></figure><p>In <code>src/app.tsx</code> render the App to html</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; render &#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&#x27;./containers/App&#x27;</span></span><br><span class="line"></span><br><span class="line">render(</span><br><span class="line">  &lt;App /&gt;, <span class="built_in">document</span>.getElementById(<span class="string">&#x27;app&#x27;</span>) <span class="keyword">as</span> HTMLElement</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">module</span>.hot) &#123;</span><br><span class="line">  <span class="built_in">module</span>.hot.accept(<span class="string">&#x27;./containers/App&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> App = <span class="built_in">require</span>(<span class="string">&#x27;./containers/App&#x27;</span>).default</span><br><span class="line">    render (</span><br><span class="line">      &lt;App /&gt;,</span><br><span class="line">      <span class="built_in">document</span>.getElementById(<span class="string">&#x27;app&#x27;</span>)</span><br><span class="line">    )</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Create-App-Represental-Component"><a href="#Create-App-Represental-Component" class="headerlink" title="Create App Represental Component"></a>Create App Represental Component</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// `./src/containers/App.tsx`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  BrowserRouter <span class="keyword">as</span> Router,</span><br><span class="line">  Route,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Header <span class="keyword">from</span> <span class="string">&#x27;./Header&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Body <span class="keyword">from</span> <span class="string">&#x27;./Body&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Footer <span class="keyword">from</span> <span class="string">&#x27;./Footer&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> () &#123;</span><br><span class="line">    <span class="built_in">super</span> ()</span><br><span class="line">  &#125;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Router&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">         &lt;Route path=<span class="string">&quot;/&quot;</span> component=&#123;Header&#125; /&gt;</span><br><span class="line">         &lt;Route path=<span class="string">&quot;/&quot;</span> component=&#123;Body&#125; /&gt;</span><br><span class="line">         &lt;Route path=<span class="string">&quot;/&quot;</span> component=&#123;Footer&#125; /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/Router&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Create-Header-Body-Footer-Containers"><a href="#Create-Header-Body-Footer-Containers" class="headerlink" title="Create Header, Body, Footer Containers"></a>Create Header, Body, Footer Containers</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/containers/Header.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; goTo &#125; <span class="keyword">from</span> <span class="string">&#x27;..utils/nav&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Header</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  protected goTo = goTo.bind(<span class="built_in">this</span>)</span><br><span class="line">  <span class="keyword">constructor</span> () &#123;</span><br><span class="line">    <span class="built_in">super</span>()</span><br><span class="line">    <span class="built_in">this</span>.state = &#123;</span><br><span class="line">      navs: [</span><br><span class="line">        &#123; <span class="attr">label</span>: <span class="string">&#x27;首页&#x27;</span>, <span class="attr">url</span>: <span class="string">&#x27;index&#x27;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">label</span>: <span class="string">&#x27;第二页&#x27;</span>, <span class="attr">url</span>: <span class="string">&#x27;page2&#x27;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">label</span>: <span class="string">&#x27;第三页&#x27;</span>, <span class="attr">url</span>: <span class="string">&#x27;page3&#x27;</span> &#125;,</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; navs &#125; = <span class="built_in">this</span>.state</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &#123;</span><br><span class="line">          navs.map(</span><br><span class="line">            (nav: &#123;<span class="attr">label</span>: string, <span class="attr">url</span>: string&#125;) =&gt; <span class="xml"><span class="tag">&lt;<span class="name">span</span> <span class="attr">key</span>=<span class="string">&#123;nav.url&#125;</span> <span class="attr">onClick</span>=<span class="string">&#123;this.goTo(nav.url)&#125;</span>&gt;</span>&#123;nav.label&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line">          )</span><br><span class="line">        &#125;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Header</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/utils/nav.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">goTo</span>(<span class="params">url: string</span>) </span>&#123;</span><br><span class="line">  retrn () =&gt; &#123;</span><br><span class="line">    <span class="built_in">this</span>.props.history.push(url)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Same structure in Body and Footer.</p><h4 id="Add-AsyncRoute"><a href="#Add-AsyncRoute" class="headerlink" title="Add AsyncRoute"></a>Add AsyncRoute</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line">interface PassedProps <span class="keyword">extends</span> React.Props&lt;any&gt; &#123;</span><br><span class="line">  load: any;</span><br><span class="line">  children: any;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bundle</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span>&lt;<span class="title">PassedProps</span>, <span class="title">any</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> () &#123;</span><br><span class="line">    <span class="built_in">super</span>()</span><br><span class="line">    <span class="built_in">this</span>.state = &#123;</span><br><span class="line">      mod: <span class="literal">null</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  componentWillMount () &#123;</span><br><span class="line">    <span class="built_in">this</span>.load(<span class="built_in">this</span>.props)</span><br><span class="line">  &#125;</span><br><span class="line">  componentWillReceiveProps (nextProps) &#123;</span><br><span class="line">    <span class="keyword">if</span> (nextProps.load !== <span class="built_in">this</span>.props.load) &#123;</span><br><span class="line">      <span class="built_in">this</span>.load(nextProps)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  load (props) &#123;</span><br><span class="line">    <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">      mod: <span class="literal">null</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    props.load(<span class="function">(<span class="params">mod</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">        mod: mod.default || mod,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.state.mod ? <span class="built_in">this</span>.props.children(<span class="built_in">this</span>.state.mod) : <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="built_in">module</span> =&gt; <span class="function"><span class="params">routerProps</span> =&gt;</span> (<span class="xml"><span class="tag">&lt;<span class="name">Bundle</span> <span class="attr">load</span>=<span class="string">&#123;module&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">  &#123; Comp =&gt; Comp ? <span class="tag">&lt;<span class="name">Comp</span> &#123;<span class="attr">...routerProps</span>&#125; /&gt;</span> : null&#125;</span></span><br><span class="line"><span class="xml">)</span></span><br></pre></td></tr></table></figure><p>And use it in body container</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Route &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Index <span class="keyword">from</span> <span class="string">&#x27;bundle-loader?lazy!./Index&#x27;</span></span><br><span class="line"><span class="keyword">import</span> AsyncRoute <span class="keyword">from</span> <span class="string">&#x27;../components/AsyncRoute&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; (</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">   &lt;Route path=<span class="string">&quot;/index&quot;</span> component=&#123;AsyncRoute(Index)&#125;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="Add-Redux"><a href="#Add-Redux" class="headerlink" title="Add Redux"></a>Add Redux</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev redux-devtools redux-devtools-dock-monitor redux-devtools-log-monitor</span><br><span class="line"></span><br><span class="line">yarn add redux redux-actions react-redux</span><br></pre></td></tr></table></figure><h4 id="Create-Actions"><a href="#Create-Actions" class="headerlink" title="Create Actions"></a>Create Actions</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/actions/hello.tsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; createActions &#125; <span class="keyword">from</span> <span class="string">&#x27;redux-actions&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> createActions(&#123;</span><br><span class="line">  SAY_HELLO: <span class="function"><span class="params">text</span> =&gt;</span> (&#123; text &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// export</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//   sayHello: (text: string) =&gt; (&#123; text: string &#125;)</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/actions/index.tsx</span></span><br><span class="line"><span class="keyword">import</span> helloActions <span class="keyword">from</span> <span class="string">&#x27;./hello&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  ...helloActions</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Create-Reducers"><a href="#Create-Reducers" class="headerlink" title="Create Reducers"></a>Create Reducers</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/reducers/hello.tsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; handleActions &#125; <span class="keyword">from</span> <span class="string">&#x27;redux-actions&#x27;</span></span><br><span class="line"><span class="keyword">import</span> actions <span class="keyword">from</span> <span class="string">&#x27;../actions&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> handleActions(&#123;</span><br><span class="line">  [actions.sayHello.toString()]: <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; ...state, ...action.payload &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;, &#123;</span><br><span class="line">  text: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/reducers/index.tsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; combineReducers &#125; <span class="keyword">from</span> <span class="string">&#x27;redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> helloReducer <span class="keyword">from</span> <span class="string">&#x27;./hello&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> combineReducers(&#123;</span><br><span class="line">  hello: helloReducer,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="Create-Store"><a href="#Create-Store" class="headerlink" title="Create Store"></a>Create Store</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/store/configureStore.dev.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; createStore, applyMiddleware, compose, GenericStoreEnhancer &#125; <span class="keyword">from</span> <span class="string">&#x27;redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">&#x27;../reducers&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> enhancer = compose(</span><br><span class="line">  <span class="comment">// applyMiddleware(...middlewares)</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">window</span>.devToolsExtension ? <span class="built_in">window</span>.devToolsExtension() : <span class="function"><span class="params">f</span> =&gt;</span> f,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">configureStoreDev</span>(<span class="params">initState: any</span>): <span class="title">any</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> store = createStore(reducer, initState, enhancer)</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">module</span>.hot) &#123;</span><br><span class="line">    <span class="built_in">module</span>.hot.accpet(<span class="string">&#x27;../reducers&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      store.replaceReducer(<span class="built_in">require</span>(<span class="string">&#x27;../reducers&#x27;</span>).default)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> store</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = configureStoreDev</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/store/configureStoreProd</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; createStore, applyMiddleware &#125; <span class="keyword">from</span> <span class="string">&#x27;redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">&#x27;../reducers&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">configureStoreProd</span> (<span class="params">initState: any</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> createStore(reducer, initState)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = configureStoreProd</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/store/index.jsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (process.env.NODE_ENV == <span class="string">&#x27;development&#x27;</span>) &#123;</span><br><span class="line">  <span class="built_in">module</span>.exports = <span class="built_in">require</span>(<span class="string">&#x27;./configureStore.dev&#x27;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="built_in">module</span>.exports = <span class="built_in">require</span>(<span class="string">&#x27;./configureStore.prod&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Add-Provider-to-Main-Container"><a href="#Add-Provider-to-Main-Container" class="headerlink" title="Add Provider to Main Container"></a>Add Provider to Main Container</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./container/App.tsx</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  BrowserRouter <span class="keyword">as</span> Router,</span><br><span class="line">  Route,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Header <span class="keyword">from</span> <span class="string">&#x27;./Header&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Body <span class="keyword">from</span> <span class="string">&#x27;./Body&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Footer <span class="keyword">from</span> <span class="string">&#x27;./Footer&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> configureStore = <span class="built_in">require</span>(<span class="string">&#x27;../store&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = configureStore(&#123;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> () &#123;</span><br><span class="line">    <span class="built_in">super</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  render () &#123;</span><br><span class="line">    returun (</span><br><span class="line">      &lt;Router&gt;</span><br><span class="line">        &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/&quot;</span> component=&#123;Header&#125; /&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/&quot;</span> component=&#123;Body&#125; /&gt;</span><br><span class="line">          &lt;Route path=<span class="string">&quot;/&quot;</span> component=&#123;Body&#125; /&gt;</span><br><span class="line">        &lt;/Provider&gt;</span><br><span class="line">      &lt;/Router&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="custom-connect-to-cache-mapStateToProps-and-mapDispatchToProps"><a href="#custom-connect-to-cache-mapStateToProps-and-mapDispatchToProps" class="headerlink" title="custom connect to cache mapStateToProps and mapDispatchToProps"></a>custom connect to cache mapStateToProps and mapDispatchToProps</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; bindActionCreators &#125; <span class="keyword">from</span> <span class="string">&#x27;redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> actions <span class="keyword">from</span> <span class="string">&#x27;../actions&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mapStateToProps = <span class="function">(<span class="params">state: any</span>) =&gt;</span> state</span><br><span class="line"><span class="keyword">const</span> mapDispatchToProps = <span class="function">(<span class="params">dispatch: any</span>) =&gt;</span> (bindActionCreators(actions, dispatch))</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (Comp: any) =&gt; connect(mapStateToProps, mapDispatchToProps)(Comp)</span><br></pre></td></tr></table></figure><h4 id="Connect-the-Presentational-Container"><a href="#Connect-the-Presentational-Container" class="headerlink" title="Connect the Presentational Container"></a>Connect the Presentational Container</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> connect <span class="keyword">from</span> <span class="string">&#x27;../utils/connect&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; goTo &#125; <span class="keyword">from</span> <span class="string">&#x27;../utils/nav&#x27;</span></span><br><span class="line"></span><br><span class="line">interface PassedProps <span class="keyword">extends</span> React.Props&lt;any&gt; &#123;</span><br><span class="line">  sayHello: any;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Header</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span>&lt;<span class="title">PassedProps</span>, <span class="title">any</span>&gt; </span>&#123;</span><br><span class="line">  protected goTo = goTo.bind(<span class="built_in">this</span>)</span><br><span class="line">  <span class="keyword">constructor</span> () &#123;</span><br><span class="line">    <span class="built_in">super</span>()</span><br><span class="line">    <span class="built_in">this</span>.state = &#123;</span><br><span class="line">      navs: [</span><br><span class="line">        &#123; <span class="attr">label</span>: <span class="string">&#x27;首页&#x27;</span>, <span class="attr">url</span>: <span class="string">&#x27;index&#x27;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">label</span>: <span class="string">&#x27;第二页&#x27;</span>, <span class="attr">url</span>: <span class="string">&#x27;page2&#x27;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">label</span>: <span class="string">&#x27;第三页&#x27;</span>, <span class="attr">url</span>: <span class="string">&#x27;page3&#x27;</span> &#125;,</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  componentDidMount () &#123;</span><br><span class="line">    <span class="built_in">this</span>.props.sayHello(<span class="string">&#x27;world&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; navs &#125; = <span class="built_in">this</span>.state</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &#123;navs.map(<span class="function">(<span class="params">nav: &#123; label: string, url: string&#125;</span>) =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">span</span></span></span></span><br><span class="line"><span class="xml">          key=&#123;nav.url&#125;</span></span><br><span class="line"><span class="xml">          onClick=&#123;this.goTo(nav.url)&#125;</span></span><br><span class="line"><span class="xml">        &gt;&#123;nav.label&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span>)&#125;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(Header)</span><br></pre></td></tr></table></figure><h3 id="Add-Rxjs"><a href="#Add-Rxjs" class="headerlink" title="Add Rxjs"></a>Add Rxjs</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add rxjs redux-observable</span><br></pre></td></tr></table></figure><h4 id="Create-Epics"><a href="#Create-Epics" class="headerlink" title="Create Epics"></a>Create Epics</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/epics/hello.tsx</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;rxjs&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> sayHello = <span class="function">(<span class="params">action$, store</span>) =&gt;</span></span><br><span class="line">  .action$.ofType(<span class="string">&#x27;SAY_HELLO&#x27;</span>)</span><br><span class="line">  .delay(<span class="number">1000</span>)</span><br><span class="line">  .map(<span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    type: <span class="string">&#x27;SAY_HELLO&#x27;</span>,</span><br><span class="line">    payload: &#123;</span><br><span class="line">      text: <span class="string">&#x27;got hello&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;))</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/epcis/index.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; combineEpics &#125; <span class="keyword">from</span> <span class="string">&#x27;redux-observable&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; sayHello &#125; <span class="keyword">from</span> <span class="string">&#x27;./hello&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> combineEpics(</span><br><span class="line">  sayHello,</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h4 id="Add-Epic-to-Enhancer"><a href="#Add-Epic-to-Enhancer" class="headerlink" title="Add Epic to Enhancer"></a>Add Epic to Enhancer</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore, applyMiddleware, compose, GenericStoreEnhancer &#125; <span class="keyword">from</span> <span class="string">&#x27;redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; createEpicMiddleware &#125; <span class="keyword">from</span> <span class="string">&#x27;redux-observable&#x27;</span></span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">&#x27;../reducers&#x27;</span></span><br><span class="line"><span class="keyword">import</span> epics <span class="keyword">from</span> <span class="string">&#x27;../epics&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> epicMiddleware = createEpicMiddleware(epics)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> enhancer = compose(</span><br><span class="line">  applyMiddleware(epicMiddleware),</span><br><span class="line">  <span class="built_in">window</span>.devToolsExtension ? <span class="built_in">window</span>.devToolsExtension() : <span class="function"><span class="params">f</span> =&gt;</span> f</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">configureStoreDev</span> (<span class="params">initState: any</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> store = createStore(reducer, initState, enhancer)</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">module</span>.hot) &#123;</span><br><span class="line">    <span class="built_in">module</span>.hot.accept(<span class="string">&#x27;../reducers&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      store.replaceReducer(<span class="built_in">require</span>(<span class="string">&#x27;../reducers&#x27;</span>).default)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> store</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = configureStoreDev</span><br></pre></td></tr></table></figure><h3 id="Add-Service-Worker"><a href="#Add-Service-Worker" class="headerlink" title="Add Service Worker"></a>Add Service Worker</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add sw-precache-webpack-plugin</span><br></pre></td></tr></table></figure><h4 id="Add-the-Plugin-in-webpack-config-prod-js"><a href="#Add-the-Plugin-in-webpack-config-prod-js" class="headerlink" title="Add the Plugin in webpack.config.prod.js"></a>Add the Plugin in webpack.config.prod.js</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> SWPrecachePluing = <span class="built_in">require</span>(<span class="string">&#x27;sw-precache-webpack-plugin&#x27;</span>)</span><br><span class="line">plugins: [</span><br><span class="line">  <span class="keyword">new</span> SWPrecachePluing()</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="Add-Bundle-Analyzer"><a href="#Add-Bundle-Analyzer" class="headerlink" title="Add Bundle Analyzer"></a>Add Bundle Analyzer</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev webpack-bundle-anaylzer</span><br></pre></td></tr></table></figure><h3 id="Add-the-Plugin-in-webpack-config-dev-js"><a href="#Add-the-Plugin-in-webpack-config-dev-js" class="headerlink" title="Add the Plugin in webpack.config.dev.js"></a>Add the Plugin in webpack.config.dev.js</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> BundleAnalyzer = <span class="built_in">require</span>(<span class="string">&#x27;webpack-bundle-analyzer&#x27;</span>).BundleAnalyzerPlugin</span><br><span class="line"></span><br><span class="line">plugins: [</span><br><span class="line">  <span class="keyword">new</span> BundleAnalyzer()</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="Add-Dll"><a href="#Add-Dll" class="headerlink" title="Add Dll"></a>Add Dll</h3><h4 id="Add-webpack-config-dll-js"><a href="#Add-webpack-config-dll-js" class="headerlink" title="Add webpack.config.dll.js"></a>Add webpack.config.dll.js</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.dll.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> ManifestPlugin = <span class="built_in">require</span>(<span class="string">&#x27;webpack-manifest-plugin&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    vendor: [<span class="comment">/* ... */</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">&#x27;../lib&#x27;</span>),</span><br><span class="line">    filename: <span class="string">&#x27;[name]_[hash:5].js&#x27;</span>,</span><br><span class="line">    library: <span class="string">&#x27;[name]_[hash:5]&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> webpack.DllPlugin(&#123;</span><br><span class="line">      name: <span class="string">&#x27;[name]_[hash:5]&#x27;</span>,</span><br><span class="line">      path: path.resolve(__dirname, <span class="string">&#x27;../lib&#x27;</span>, <span class="string">&#x27;[name]-manifest.json&#x27;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> ManifestPlugin(),</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Copy-dll-to-dist-and-refer"><a href="#Copy-dll-to-dist-and-refer" class="headerlink" title="Copy dll to dist and refer"></a>Copy dll to dist and refer</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.base.js</span></span><br><span class="line"><span class="keyword">const</span> vendorManifest = <span class="built_in">require</span>(<span class="string">&#x27;../lib/vendor-manifest.json&#x27;</span>)</span><br><span class="line">plugins: [</span><br><span class="line">  <span class="keyword">new</span> CopyPlugin([</span><br><span class="line">    &#123; <span class="attr">from</span>: path.resolve(__dirname, <span class="string">&#x27;../lib/*.js&#x27;</span>) &#125;,</span><br><span class="line">  ]),</span><br><span class="line">  <span class="keyword">new</span> webpack.DllReference(&#123;</span><br><span class="line">    manifest: vendorManifest,</span><br><span class="line">  &#125;),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="Insert-Dll-files-in-html"><a href="#Insert-Dll-files-in-html" class="headerlink" title="Insert Dll files in html"></a>Insert Dll files in html</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.dev.js</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> manifest = <span class="built_in">JSON</span>.parse(fs.readFileSync(path.resolve(__dirname, <span class="string">&#x27;../lib/manifest.json&#x27;</span>)))</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> HtmlPlugin(&#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">      dll: <span class="string">`./lib/<span class="subst">$&#123;manifest[<span class="string">&#x27;vendor.js&#x27;</span>]&#125;</span>`</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> React </tag>
            
            <tag> TypeScript </tag>
            
            <tag> Redux </tag>
            
            <tag> RxJS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Notes on TS + React + Redux</title>
      <link href="/2017/09/05/Notes-on-TS-React-Redux/"/>
      <url>/2017/09/05/Notes-on-TS-React-Redux/</url>
      
        <content type="html"><![CDATA[<h3 id="Add-Explicit-Props-Interface-from-Store"><a href="#Add-Explicit-Props-Interface-from-Store" class="headerlink" title="Add Explicit Props Interface from Store"></a>Add Explicit Props Interface from Store</h3><p>When I use <code>react-redux</code>, the TS Compiler always throw an error:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error TS2339: Property <span class="string">&#x27;...&#x27;</span> does not exist on <span class="built_in">type</span> <span class="string">&#x27;Readonly&lt;children?: ReactNode; &#125;&gt; &amp; Readonly&lt;&#123;&#125;&gt;&#x27;</span>.</span><br></pre></td></tr></table></figure><p>That’s because Connect was not supplying an explicit interface to the container component, so it was confused by the prop that it was trying to pass.</p><p>So you can add an explicit interface on child component.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">interface PropsFromStore <span class="keyword">extends</span> React.Props&lt;any&gt; &#123;</span><br><span class="line">  propsFromStore: any;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChildComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span>&lt;<span class="title">PropsFromStore</span>, <span class="title">React</span>.<span class="title">State</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps, mapDispatchToProps)(ChildComponent)</span><br></pre></td></tr></table></figure><h3 id="Add-Enhancer-to-Store-with-TS"><a href="#Add-Enhancer-to-Store-with-TS" class="headerlink" title="Add Enhancer to Store with TS"></a>Add Enhancer to Store with TS</h3><p>When I use an enhancer like:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> enhancer = compose(</span><br><span class="line">  applyMiddleware(...middlewares),</span><br><span class="line">  DevTools.instrument(),</span><br><span class="line">  persistState(</span><br><span class="line">    <span class="built_in">window</span>.location.href.match(</span><br><span class="line">      /[?&amp;]debug_session=([^&amp;#]+)\b/</span><br><span class="line">    )</span><br><span class="line">  )</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>I got an error like:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[ts] Argument of <span class="built_in">type</span> <span class="string">&#x27;Function&#x27;</span> is not assignable to parameter of <span class="built_in">type</span> <span class="string">&#x27;Func3&lt;&#123;&#125;, &#123;&#125;, &#123;&#125;, &#123;&#125;, StoreEnhancerStoreCreator&lt;&#123;&#125;&gt;&gt;&#x27;</span>.</span><br><span class="line">Type <span class="string">&#x27;Function&#x27;</span> provides no match <span class="keyword">for</span> the signature <span class="string">&#x27;(a1: &#123;&#125;, a2: &#123;&#125;, a3: &#123;&#125;, ...args: any[]): &#123;&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>To resolve this, just:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; GenericStoreEnhancer &#125; <span class="keyword">from</span> <span class="string">&#x27;redux&#x27;</span></span><br><span class="line"><span class="keyword">const</span> enhancer = compose(</span><br><span class="line">  applyMiddleware(...middlewares),</span><br><span class="line">  DevTools.instrument <span class="keyword">as</span> GenericStoreEnhancer,</span><br><span class="line">  persistState(</span><br><span class="line">    <span class="built_in">window</span>.location.href.match(</span><br><span class="line">      /[?&amp;]debug_session=([^&amp;#]+)\b/</span><br><span class="line">    )</span><br><span class="line">  )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> React </tag>
            
            <tag> TypeScript </tag>
            
            <tag> Redux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AsyncRoute With React-Router-V4</title>
      <link href="/2017/09/04/AsyncRoute-with-React-Router-v4/"/>
      <url>/2017/09/04/AsyncRoute-with-React-Router-v4/</url>
      
        <content type="html"><![CDATA[<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AsyncRoute.jsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bundle</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  constructur() &#123;</span><br><span class="line">    <span class="built_in">super</span>()</span><br><span class="line">    <span class="built_in">this</span>.state = &#123;</span><br><span class="line">      mod: <span class="literal">null</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  componentWillMount() &#123;</span><br><span class="line">    <span class="built_in">this</span>.load(<span class="built_in">this</span>.props)</span><br><span class="line">  &#125;</span><br><span class="line">  componentWillReceiveProps(nextProps) &#123;</span><br><span class="line">    <span class="keyword">if</span> (nextProps.load !== <span class="built_in">this</span>.props.load) &#123;</span><br><span class="line">      <span class="built_in">this</span>.load(nextProps)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  load(props) &#123;</span><br><span class="line">    <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">      mod: <span class="literal">null</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    props.load(<span class="function">(<span class="params">mod</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">        mod: mod.default || mod,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.state.mod ? <span class="built_in">this</span>.props.children(<span class="built_in">this</span>.state.mod) : <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (<span class="built_in">module</span>) =&gt; <span class="function">(<span class="params">routerProps</span>) =&gt;</span> (</span><br><span class="line">  &lt;Bundle load=&#123;<span class="built_in">module</span>&#125;&gt;&#123;<span class="function">(<span class="params">Comp</span>) =&gt;</span> (Comp ? <span class="xml"><span class="tag">&lt;<span class="name">Comp</span> &#123;<span class="attr">...routerProps</span>&#125; /&gt;</span></span> : <span class="literal">null</span>)&#125;&lt;/Bundle&gt;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Body.jsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; Route &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"><span class="keyword">import</span> AsyncRoute <span class="keyword">from</span> <span class="string">&#x27;./AsyncRoute&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Page <span class="keyword">from</span> <span class="string">&#x27;bundle-loader?lazy!./Page&#x27;</span></span><br><span class="line"></span><br><span class="line">;<span class="xml"><span class="tag">&lt;<span class="name">Route</span> <span class="attr">component</span>=<span class="string">&#123;AsyncRoute(Page)&#125;</span> /&gt;</span></span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> React </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Note of Sw-Precache</title>
      <link href="/2017/09/04/note-of-sw-precache/"/>
      <url>/2017/09/04/note-of-sw-precache/</url>
      
        <content type="html"><![CDATA[<p>A node module to generate service worker code that will precaches specific resource so they work offline.</p><p>Serving your local static resources cache-first means that you can get all the crucial scaffolding for your web app – your app shell – on the screen  without having to wait for any network responses.</p><h3 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev sw-precache</span><br></pre></td></tr></table></figure><h3 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h3><ol><li><p>Make sure your site is served using HTTPS.</p></li><li><p>incorporate <code>sw-precache</code> into your <code>node</code>-based build script.</p></li><li><p>Register the service worker JavaScript.</p></li></ol><h3 id="Considerations"><a href="#Considerations" class="headerlink" title="Considerations"></a>Considerations</h3><ul><li><p>Service worker caching should be considered a prograssive enhancement. If you follow the model of conditionally registering a service worker only if it’s supported(determined by <code>if(&#39;serviceWorker&#39; in navigator)</code>), you’ll get offline support on browsers with service workers and on browsers that don’t support service workers, the offline-specific code will never be called.</p></li><li><p>All resources that are precached will be fetched by a service worker runing in a separate thread as soon as the service worker is installed. You should be judicious in what you list in the <code>dynamicUrlsToDependencies</code> and <code>staticFileGlobs</code> options, since listing files that are non-essential(large-images that are not shown on every page, for instance) will result in browsers downloading more data than is strictly necessary.</p></li><li><p>Precaching doesn’t make sense for all types of resource. Other caching strategies can be used in conjunction with <code>sw-precache</code> to provide the best experience for your users. If you do implement additional caching logic, put the code in a separate file and include it using the <code>importScripts()</code> method.</p></li><li><p><code>sw-precache</code> uses a <strong>cache-first</strong> strategy, which results in a copy of any cached content being returned without consulting the network.</p></li></ul><h3 id="Use-with-webpack"><a href="#Use-with-webpack" class="headerlink" title="Use with webpack"></a>Use with webpack</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev sw-precache-webpack-plugin</span><br></pre></td></tr></table></figure><h4 id="Basic-Usage"><a href="#Basic-Usage" class="headerlink" title="Basic Usage"></a>Basic Usage</h4><p>A simple configuration example that will work well in most production environments.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> SWPrecachePlugin = <span class="built_in">require</span>(<span class="string">&#x27;sw-precache-webpack-plugin&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> PUBLIC_PATH = <span class="string">&#x27;https://www.my-project-name.com/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exporst = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    main: path.resolve(__dirname, <span class="string">&#x27;src/index&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">&#x27;src/bundles/&#x27;</span>),</span><br><span class="line">    filename: <span class="string">&#x27;[name]-[hash].js&#x27;</span>,</span><br><span class="line">    publicPath: PUBLIC_PATH,</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> SWPrecachePlugin(&#123;</span><br><span class="line">      cacheId: <span class="string">&#x27;my-project-name&#x27;</span>,</span><br><span class="line">      dontCacheBustUrlsMatching: <span class="regexp">/\.\w&#123;8&#125;\./</span>,</span><br><span class="line">      filename: <span class="string">&#x27;service-worker.js&#x27;</span>,</span><br><span class="line">      minify: <span class="literal">true</span>,</span><br><span class="line">      navigateFallback: PUBLIC_PATH + <span class="string">&#x27;index.html&#x27;</span>,</span><br><span class="line">      staticFileGlobsIgnorePatterns: [</span><br><span class="line">        /\.map$/,</span><br><span class="line">        /asset-manifest\.json$/,</span><br><span class="line">      ]</span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This will generate a new service worker at <code>src/bundles/service-worker.js</code>, then you would register it in your application:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="string">&#x27;serviceWorker&#x27;</span> <span class="keyword">in</span> navigator) &#123;</span><br><span class="line">    navigator.serviceWorker.register(<span class="string">&#x27;./service-worker.js&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure><h4 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h4><ul><li><p>filename: string - service worker filename, default is <code>service-worker.js</code></p></li><li><p>filepath: string - service worker path and name, default is to use <code>webpack.output.path</code> + <code>options.filename</code>. This will override <code>filename</code>.</p></li><li><p>staticFileGlobsIngorePatters: [Regexp] - Define an optional array of regex patterns to filter out of staticFileGlobs.</p></li><li><p>mergeStaticsConfig: [boolean] - Merge provided staticFileGlobs and stripPrefixMulti with webpack’s config, rather than having those take precedence, default is false.</p></li><li><p>minify: [boolean] - Set to true to minify and uglify the generated service-worker, default is false.</p></li><li><p>cacheId: [string] - Not required but you should include this, it will give your service worker cache a unique name, default to <code>sw-precache-webpack-plugin</code>.</p></li><li><p>importScripts: [Array&lt;String|Object&gt;]</p><ul><li><p>when importScripts array item is a string, converts to object format: <code>&#123; filename: &#39;&lt;publicPath&gt;/my-scripts.js&#39;&#125;</code></p></li><li><p>when importScripts array item is an Object</p><ul><li><p>look for <code>chunkName</code> property</p></li><li><p>look for <code>filename</code> property</p></li></ul></li></ul></li><li><p>replacePrefix: [String] - should only be used in conjunction with <code>stripPrefix</code></p></li><li><p>staticFileGlobs: [Array<String>] - Omit this to allow the plugin to cache all your bundles’ emitted assets. If <code>mergeStaticsConfig=true</code>: this value will be merged with your bundles’ emitted assets, otherwise this value is just passed to <code>sw-precache</code> and emitted assets won’t be included.</p></li><li><p>stripPrefix: [String] - Same as stripPrefixMulti[stripPrefix] = ‘’</p></li><li><p>stripPrefixMulti: [Object&lt;String,String&gt;] - Omit this to use your webpack config’s <code>output.path</code> + <code>/</code>: <code>output.publicPath</code>.</p></li></ul><blockquote><p>Note taht all configuration options are optional. <code>SWPrecacheWebpackPlugin</code> will by default use all your assets emitted by webpack’s compiler for the <code>staticFileGlobs</code> parameter and your webpack config’s <code>&#123;[output.path + &#39;/&#39;]: output.publicPath&#125;</code> as the stripPrefixMulti parameter. This behavior is probably what you want, all your webpack assets will be cached by your generated service worker. Just don’t pass any arguments when you initialize this plugin, and let this plugin handle generating your <code>sw-precache</code> configuration.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">plugins: [</span><br><span class="line">  <span class="keyword">new</span> SWPrecacheWebpackPlugin(),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Service Worker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Service-Worker With Webpack</title>
      <link href="/2017/09/03/service-worker-with-webpack/"/>
      <url>/2017/09/03/service-worker-with-webpack/</url>
      
        <content type="html"><![CDATA[<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev sw-precache-webpack-plugin</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack</span></span><br><span class="line"><span class="keyword">new</span> SWPrecachePlugin(&#123;</span><br><span class="line">  cacheId: <span class="string">&#x27;demo&#x27;</span>,</span><br><span class="line">  filename: <span class="string">&#x27;service-worker.js&#x27;</span>,</span><br><span class="line">  dontCacheBustUrlsMatching: <span class="literal">false</span>,</span><br><span class="line">  staticFileGlobsIgnorePatterns: [</span><br><span class="line">    /index\.html$/,</span><br><span class="line">    /\.map$/,</span><br><span class="line">    /\.css$/,</span><br><span class="line">    /\.svg$/,</span><br><span class="line">    /\.eot$/,</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>This will generate <code>service-worker.js</code> in dist.</p><h3 id="Add-Router"><a href="#Add-Router" class="headerlink" title="Add Router"></a>Add Router</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.use(<span class="string">&#x27;/service-worker.js&#x27;</span>, serve(<span class="string">&#x27;./dist/service-worker.js&#x27;</span>))</span><br></pre></td></tr></table></figure><blockquote><p>Note: <code>[name].[ext]?[hash]</code> will not be found by sw-precache(hash will be ignored), so filename should be specified like <code>[name].[hash].[ext]</code> or so.</p></blockquote><h3 id="Cache-files-who-are-not-bundled-by-webpack"><a href="#Cache-files-who-are-not-bundled-by-webpack" class="headerlink" title="Cache files who are not bundled by webpack."></a>Cache files who are not bundled by webpack.</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> SWPrecachePlugin(&#123;</span><br><span class="line">  cacheId: <span class="string">&#x27;demo&#x27;</span>,</span><br><span class="line">  filename: <span class="string">&#x27;service-worker.js&#x27;</span>,</span><br><span class="line">  minify: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// add two lines</span></span><br><span class="line">  mergeStaticConfig: <span class="literal">true</span>,</span><br><span class="line">  staticFileBlogs: [</span><br><span class="line">    path.join(__dirname, <span class="string">&#x27;../dist/static/*.*&#x27;</span>),</span><br><span class="line">  ],</span><br><span class="line">  dontCacheBustUrlsMatching: <span class="literal">false</span>,</span><br><span class="line">  staticFileGlobsIgnorePatterns: [</span><br><span class="line">    /\.index\.html$/,</span><br><span class="line">    /\.map$/,</span><br><span class="line">    /\.css$/,</span><br><span class="line">    /\.svg$/,</span><br><span class="line">    /\.eot$/,</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="About-the-Request-URL"><a href="#About-the-Request-URL" class="headerlink" title="About the Request URL"></a>About the Request URL</h3><p>The images are cached in <code>/dist/static/*</code>, while the request url is <code>/static/*</code>.</p><p>In dev it can be proxied by webpack.</p><p>In prod it can be delegated by nginx.</p><p>But the plugin can fix it by itself:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> SWPrecachePlugin(&#123;</span><br><span class="line">  cacheId: <span class="string">&#x27;demo&#x27;</span>,</span><br><span class="line">  filename: <span class="string">&#x27;service-worker.js&#x27;</span>,</span><br><span class="line">  minify: <span class="literal">true</span>,</span><br><span class="line">  mergeStaticConfig: <span class="literal">true</span>,</span><br><span class="line">  staticFileGlobs: [</span><br><span class="line">    path.join(__dirname, <span class="string">&#x27;../dist/static/*.*&#x27;</span>)</span><br><span class="line">  ],</span><br><span class="line">  stripPrefixMulti: &#123;</span><br><span class="line">    [path.join(__dirname, <span class="string">&#x27;../dist/static&#x27;</span>)]: <span class="string">&#x27;/static&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  dontCacheBustUrlsMatching: <span class="literal">false</span>,</span><br><span class="line">  staticFileGlobsIgnorePatterns: [</span><br><span class="line">    /\.index\.html$/,</span><br><span class="line">    /\.map$/,</span><br><span class="line">    /\.css$/,</span><br><span class="line">    /\.svg$/,</span><br><span class="line">    /\.eot$/,</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><blockquote><p>Note: <code>dontCacheBustUrlsMatching: false</code> will set cached key as <code>http://domain/path/to/filename?hash</code>, whose hash will change if the bundled file changed.</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> Webpack </tag>
            
            <tag> Service Worker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Snippets of Nginx</title>
      <link href="/2017/09/03/snippets-of-Nginx/"/>
      <url>/2017/09/03/snippets-of-Nginx/</url>
      
        <content type="html"><![CDATA[<h3 id="nginx-conf"><a href="#nginx-conf" class="headerlink" title="nginx.conf"></a>nginx.conf</h3><p>One <code>server&#123;&#125;</code> for a site service.</p><p>Use <code>location</code> to specify router of requests.</p><p><code>proxy_pass target</code> to delegate inverse .</p><p><code>root dir</code> to specify static files directory.</p><p><code>server_name</code> to set domains whose requests will be handled.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a node server listening to 3000</span></span><br><span class="line"><span class="comment">// handle requests from example.com</span></span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">  listen: <span class="number">80</span>;</span><br><span class="line">  server_name: example.com;</span><br><span class="line">    location / &#123;</span><br><span class="line">      index index.html;</span><br><span class="line">      root: <span class="regexp">/public/</span>;</span><br><span class="line">      proxy_pass http:<span class="comment">//location:3000</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Gzip"><a href="#Gzip" class="headerlink" title="Gzip"></a>Gzip</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gzip on;</span><br><span class="line">gzip_proxied any;</span><br><span class="line">gzip_min_length 1024;</span><br><span class="line">gzip_buffers 4 8k;</span><br><span class="line">gzip_types text&#x2F;css application&#x2F;javascript application&#x2F;atom+xml application&#x2F;rss+xml text&#x2F;plain image&#x2F;svg+xml application&#x2F;json text&#x2F;javascript;</span><br></pre></td></tr></table></figure><h3 id="CORS"><a href="#CORS" class="headerlink" title="CORS"></a>CORS</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen: <span class="number">80</span>;</span><br><span class="line">  server_name: example.com;</span><br><span class="line"></span><br><span class="line">  location / &#123;</span><br><span class="line">    add_header Access-Control-Allow-Origin: *;</span><br><span class="line">    add_header Access-Control_Allow_Credentials <span class="literal">true</span>;</span><br><span class="line">    add_header Access-Control-AllowMethods GET,POST,OPTIONS;</span><br><span class="line">    index index.html;</span><br><span class="line">    root: <span class="regexp">/public/</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="API-delegate"><a href="#API-delegate" class="headerlink" title="API delegate"></a>API delegate</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen: <span class="number">80</span>;</span><br><span class="line">  server_name: example.com;</span><br><span class="line"></span><br><span class="line">  location /api &#123;</span><br><span class="line">    proxy_pass: https:<span class="comment">//localhost:3000;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="HTTP-to-HTTPS"><a href="#HTTP-to-HTTPS" class="headerlink" title="HTTP to HTTPS"></a>HTTP to HTTPS</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen: <span class="number">80</span>;</span><br><span class="line">  server_name: example.com, *.example.com;</span><br><span class="line"></span><br><span class="line">  location / &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">301</span> https:<span class="comment">//$host$request_uri;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">  listen: <span class="number">443</span> ssl;</span><br><span class="line">  server_name example.com;</span><br><span class="line">  ssl_certificate /crts/crt.pem; <span class="comment">// add the certificate</span></span><br><span class="line">  ssl_certificate_key /crts/key.pem</span><br><span class="line">    location / &#123;</span><br><span class="line">      index index.html;</span><br><span class="line">      root: <span class="regexp">/public/</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Manipulate Data in D3</title>
      <link href="/2017/08/31/Manipulate-Data-in-D3/"/>
      <url>/2017/08/31/Manipulate-Data-in-D3/</url>
      
        <content type="html"><![CDATA[<h3 id="Use-data-imported-from-a-csv-file-with-spaces-in-the-header"><a href="#Use-data-imported-from-a-csv-file-with-spaces-in-the-header" class="headerlink" title="Use data imported from a csv file with spaces in the header"></a>Use data imported from a csv file with spaces in the header</h3><p>When importing data from a csv file(dataSpace.csv) that has headers with spaces in the middle of some of the fields there is need to address the data slightly differently in order for it to be used easily in your JavaScript.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Date Purchased,close</span><br><span class="line">1-May-12,58.13</span><br></pre></td></tr></table></figure><p>When we go to import the data using the d3.csv function, we need to reference the <code>Data Purchased</code> column in a way that makes allowances for the space. The following piece of script appears to be the most basic solution.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">d3.csv(<span class="string">&#x27;dataSpace.csv&#x27;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">  data.forEach(<span class="function"><span class="params">d</span> =&gt;</span> &#123;</span><br><span class="line">    d.date = parseTime(d[<span class="string">&#x27;Date Purchased&#x27;</span>])</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Histogram"><a href="#Histogram" class="headerlink" title="Histogram"></a>Histogram</h3><p>The <code>d3.histogram</code> function allows us to form our data into ‘bins’ that form <em>‘discrete samples into continous, non-overlapping intervals’</em>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// dtg,value</span></span><br><span class="line"><span class="comment">// 01-08-2010,3</span></span><br><span class="line"><span class="comment">// 01-08-2010,3</span></span><br><span class="line"><span class="comment">// 01-08-2010,3</span></span><br><span class="line"><span class="comment">// 01-08-2010,3</span></span><br><span class="line"><span class="comment">// 01-08-2010,3.1</span></span><br><span class="line"><span class="comment">// 01-08-2010,3.2</span></span><br><span class="line"><span class="comment">// 01-08-2010,3.2</span></span><br><span class="line"><span class="comment">// .</span></span><br><span class="line"><span class="comment">// .</span></span><br><span class="line"><span class="comment">// .</span></span><br><span class="line"><span class="comment">// 31-12-2011,3.2</span></span><br><span class="line"><span class="comment">// 31-12-2011,3.3</span></span><br><span class="line"><span class="comment">// 31-12-2011,3.4</span></span><br><span class="line"><span class="comment">// 31-12-2011,3.5</span></span><br><span class="line"><span class="comment">// 31-12-2011,3.5</span></span><br><span class="line"><span class="comment">// 31-12-2011,4.1</span></span><br><span class="line"><span class="comment">// 31-12-2011,4.9</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// core code</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> parseDate = d3.timeParser(<span class="string">&#x27;%d-%m-%Y&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> xScale = d3.scaleTime()</span><br><span class="line">    .domain([<span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">2010</span>, <span class="number">6</span>, <span class="number">3</span>), <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">2012</span>, <span class="number">0</span>, <span class="number">1</span>)])</span><br><span class="line">    .rangeRound([, width])</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> yScale = d3.scaleLinear()</span><br><span class="line">    .range([height, <span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> histogram = h3.histogram()</span><br><span class="line">    .value(<span class="function"><span class="params">d</span> =&gt;</span> d.date)</span><br><span class="line">    .domain(xScale.domain())</span><br><span class="line">    .thresholds(x.ticks.timeMonth)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> _data = data.map(<span class="function"><span class="params">d</span> =&gt;</span> (&#123;</span><br><span class="line">  date: parseDate(d.dtg),</span><br><span class="line">  value: d.value,</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> bins = histogram(_data)</span><br><span class="line"></span><br><span class="line">holder.selectAll(<span class="string">&#x27;rect&#x27;</span>)</span><br><span class="line">    .data(bins)</span><br><span class="line">  .enter().append(<span class="string">&#x27;rect&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;class&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;x&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;transform&#x27;</span>, <span class="function"><span class="params">d</span> =&gt;</span> <span class="string">`translate(<span class="subst">$&#123;xScale(d.x0)&#125;</span>, <span class="subst">$&#123;yScale(d.length)&#125;</span>)`</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;width&#x27;</span>, <span class="function"><span class="params">d</span> =&gt;</span> (xScale(d.x1 - d.x0) - <span class="number">1</span>))</span><br><span class="line">    .attr(<span class="string">&#x27;height&#x27;</span>, <span class="function"><span class="params">d</span> =&gt;</span> (height - yScale(d.length)))</span><br></pre></td></tr></table></figure><p>The key line</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> bins = histogram(_data)</span><br></pre></td></tr></table></figure><p>groups the data for the bars.</p><h3 id="Tree-Diagram"><a href="#Tree-Diagram" class="headerlink" title="Tree Diagram"></a>Tree Diagram</h3><p>The data requied to produce this type of layout needs to describe the relationships, but this is not necessary an onerous task.</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Top Node&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;children&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Bob: Child of Top Node&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;children&quot;</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Son of Bob&quot;</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Daughter of Bob&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Sally: Child of Top Node&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// core code</span></span><br><span class="line"><span class="keyword">const</span> treeData = &#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Top Level&quot;</span>,</span><br><span class="line">  <span class="string">&quot;children&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Level 2: A&quot;</span>,</span><br><span class="line">      <span class="string">&quot;children&quot;</span>: [</span><br><span class="line">        &#123; <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Son of A&quot;</span> &#125;,</span><br><span class="line">        &#123; <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Daughter of A&quot;</span> &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123; <span class="string">&quot;name&quot;</span>, <span class="string">&quot;Leve 2: B&quot;</span>&#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> margin = &#123;</span><br><span class="line">  top: <span class="number">40</span>,</span><br><span class="line">  right: <span class="number">30</span>,</span><br><span class="line">  bottom: <span class="number">50</span>,</span><br><span class="line">  left: <span class="number">30</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> width = <span class="number">660</span> - margin.left - margin.right</span><br><span class="line"><span class="keyword">const</span> height = <span class="number">500</span> - margin.top - margin.bottom</span><br><span class="line"></span><br><span class="line"><span class="comment">// declare a tree layout and assigns the size</span></span><br><span class="line"><span class="keyword">const</span> treemap = d3.tree()</span><br><span class="line">    .size([width, height])</span><br><span class="line"></span><br><span class="line"><span class="comment">// assigns the node data to the tree layout</span></span><br><span class="line"><span class="keyword">let</span> nodes = d3.hierarchy(treeData)</span><br><span class="line"></span><br><span class="line"><span class="comment">// map the node data to the tree layout</span></span><br><span class="line">nodes = treemap(nodes)</span><br><span class="line"></span><br><span class="line"><span class="comment">// append the svg object to the body of the page</span></span><br><span class="line"><span class="comment">// append a &#x27;group&#x27; element to &#x27;svg&#x27;</span></span><br><span class="line"><span class="comment">// move the &#x27;groupd&#x27; element to the top left margin</span></span><br><span class="line"><span class="keyword">const</span> svg = d3.select(<span class="string">&#x27;body&#x27;</span>).append(<span class="string">&#x27;svg&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;width&#x27;</span>, width + margin.left + margin.right)</span><br><span class="line">    .attr(<span class="string">&#x27;height&#x27;</span>, height + margin.top + margin.bottom)</span><br><span class="line"><span class="keyword">const</span> g = svg.append(<span class="string">&#x27;g&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;transform&#x27;</span>, <span class="string">`translate(<span class="subst">$&#123;margin.left&#125;</span>, <span class="subst">$&#123;margin.top&#125;</span>)`</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// add links between nodes</span></span><br><span class="line"><span class="keyword">const</span> link = g.selectAll(<span class="string">&#x27;.link&#x27;</span>)</span><br><span class="line">    .data(nodes.descendants().slice(<span class="number">1</span>))</span><br><span class="line">  .enter().append(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;class&#x27;</span>, <span class="string">&#x27;link&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;d&#x27;</span>, <span class="function"><span class="params">d</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">`M<span class="subst">$&#123;d.x&#125;</span>,<span class="subst">$&#123;d.y&#125;</span>C<span class="subst">$&#123;d.x&#125;</span>,<span class="subst">$&#123;(d.y + d.parent.y) <span class="regexp">/ 2&#125; $&#123;d.parent.x&#125;,$&#123;(d.y + d.parent.y) /</span> <span class="number">2</span>&#125;</span> <span class="subst">$&#123;d.parent.x&#125;</span>,<span class="subst">$&#123;d.parent.y&#125;</span>`</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// add each node as a group</span></span><br><span class="line"><span class="keyword">const</span> node = g.selectAll(<span class="string">&#x27;.node&#x27;</span>)</span><br><span class="line">    .data(nodes.descendants())</span><br><span class="line">  .enter().append(<span class="string">&#x27;circle&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;class&#x27;</span>, <span class="function"><span class="params">d</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">`node <span class="subst">$&#123;d.children ? <span class="string">&#x27;node--internal&#x27;</span> : <span class="string">&#x27;node--leaf&#x27;</span>&#125;</span>`</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .attr(<span class="string">&#x27;transform&#x27;</span>, <span class="function"><span class="params">d</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="string">`translate(<span class="subst">$&#123;d.x&#125;</span>, <span class="subst">$&#123;d.y&#125;</span>)`</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// add the circle to node</span></span><br><span class="line">node.append(<span class="string">&#x27;circle&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;r&#x27;</span>, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// add the text to the node</span></span><br><span class="line">node.append(<span class="string">&#x27;text&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;dy&#x27;</span>, <span class="string">&#x27;0.35em&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;y&#x27;</span>, <span class="function"><span class="params">d</span> =&gt;</span> (d.children ? <span class="number">-20</span> : <span class="number">20</span>))</span><br><span class="line">    .style(<span class="string">&#x27;text-anchor&#x27;</span>, <span class="string">&#x27;middle&#x27;</span>)</span><br><span class="line">    .text(<span class="function"><span class="params">d</span> =&gt;</span> d.data.name)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// declare a tree layout and assign the size</span></span><br><span class="line"><span class="keyword">const</span> treemap = d3.tree()</span><br><span class="line">    .size([width, height])</span><br><span class="line"></span><br><span class="line"><span class="comment">// assign the data to a hierarchy using parent-child relationships</span></span><br><span class="line"><span class="keyword">let</span> nodes = d3.hierarchy(treeData)</span><br><span class="line"></span><br><span class="line"><span class="comment">// maps the node data to the tree layout</span></span><br><span class="line">nodes = treemap(nodes)</span><br></pre></td></tr></table></figure><h5 id="d3-hierarchy"><a href="#d3-hierarchy" class="headerlink" title="d3.hierarchy"></a>d3.hierarchy</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> nodes = d3.hierarchy(treeData, <span class="function"><span class="params">d</span> =&gt;</span> d.children)</span><br></pre></td></tr></table></figure><p>This assigns a range of properties to each node including:</p><ul><li><p><code>node.data</code> - the data assocaited with the node(in our case it will include the name accessible as <code>node.data.name</code>).</p></li><li><p><code>node.depth</code> - a representation of the depth or number of hops from the initial root node.</p></li><li><p><code>node.height</code> - the greatest distance from any descendants leaf nodes.</p></li><li><p><code>node.parent</code> - the parent node, or null if it’s the root node.</p></li><li><p><code>node.children</code> - child nodes or undefined for any leaf nodes.</p></li></ul><p>Above is the vertical tree map code.</p><p>If you want a horizontal tree map, you can make a transform like this.</p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/htree-02.png"></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/htree-03.png"></p><p>Or</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.attr(<span class="string">&#x27;d&#x27;</span>, <span class="function"><span class="params">d</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">  M<span class="subst">$&#123;d.y&#125;</span>,<span class="subst">$&#123;d.x&#125;</span></span></span><br><span class="line"><span class="string">  C<span class="subst">$&#123;(d.y + d.parent.y)/<span class="number">2</span>&#125;</span>,<span class="subst">$&#123;d.x&#125;</span></span></span><br><span class="line"><span class="string">  <span class="subst">$&#123;(d.y + d.parent.y)/<span class="number">2</span>&#125;</span>,<span class="subst">$&#123;d.parent.x&#125;</span></span></span><br><span class="line"><span class="string">  <span class="subst">$&#123;d.parent.y&#125;</span>,<span class="subst">$&#123;d.parent.x&#125;</span></span></span><br><span class="line"><span class="string">  `</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">.attr(<span class="string">&#x27;transform&#x27;</span>, <span class="function"><span class="params">d</span> =&gt;</span> <span class="string">`translate(<span class="subst">$&#123;d.y&#125;</span>, <span class="subst">$&#123;d.x&#125;</span>)`</span>)</span><br></pre></td></tr></table></figure><p>Add Images as Node</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">node.append(<span class="string">&#x27;image&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;xlink:href&#x27;</span>, <span class="function"><span class="params">d</span> =&gt;</span> d.data.icon)</span><br><span class="line">    .attr(<span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;-12px&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;-12px&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;width&#x27;</span>, <span class="string">&#x27;24px&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;height&#x27;</span>, <span class="string">&#x27;24px&#x27;</span>)</span><br></pre></td></tr></table></figure><p>Add Interaction on Node</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">click</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (d.children) &#123;</span><br><span class="line">    d._children = d.children</span><br><span class="line">    d.chilren = <span class="literal">null</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    d.children = d._children</span><br><span class="line">    d._children = <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">  upate(d)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Sankey-Diagrams"><a href="#Sankey-Diagrams" class="headerlink" title="Sankey Diagrams"></a>Sankey Diagrams</h3><p>// Todo</p><h3 id="Assorted-Tips-and-Tricks"><a href="#Assorted-Tips-and-Tricks" class="headerlink" title="Assorted Tips and Tricks"></a>Assorted Tips and Tricks</h3><h4 id="Events"><a href="#Events" class="headerlink" title="Events"></a>Events</h4><ul><li><p><code>mousedown</code></p></li><li><p><code>mouseup</code></p></li><li><p><code>mouseover</code></p></li><li><p><code>mouseout</code></p></li><li><p><code>mousemove</code></p></li><li><p><code>click</code></p></li><li><p><code>contextmenu</code></p></li><li><p><code>dblclick</code></p></li></ul><h4 id="Add-Tooltips"><a href="#Add-Tooltips" class="headerlink" title="Add Tooltips"></a>Add Tooltips</h4><p>Tooltips have a marvellous duality. They are on one hand a pretty darned useful thing that aids in giving context and information where required and on the other hand, if done with a bit of care they can look stylish.</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span><span class="selector-class">.tooltip</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">60px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">28px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">2px</span>;</span><br><span class="line">  <span class="attribute">font</span>: <span class="number">12px</span> sans-serif;</span><br><span class="line">  <span class="attribute">background</span>: lightsteelblue;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">0px</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">8px</span>;</span><br><span class="line">  <span class="attribute">pointer-events</span>: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> div = d3.select(<span class="string">&#x27;body&#x27;</span>).append(<span class="string">&#x27;div&#x27;</span>).attr(<span class="string">&#x27;class&#x27;</span>, <span class="string">&#x27;tooltip&#x27;</span>)</span><br><span class="line">.style(<span class="string">&#x27;opacity&#x27;</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">svg.selectAll(<span class="string">&quot;circle&quot;</span>)</span><br><span class="line">   .data(data)</span><br><span class="line"> .enter().append(<span class="string">&quot;circle&quot;</span>)</span><br><span class="line">   .attr(<span class="string">&quot;r&quot;</span>, <span class="number">5</span>)</span><br><span class="line">   .attr(<span class="string">&quot;cx&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> x(d.date); &#125;)</span><br><span class="line">   .attr(<span class="string">&quot;cy&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> y(d.close); &#125;)</span><br><span class="line">   .on(<span class="string">&quot;mouseover&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123;</span><br><span class="line">     div.transition()</span><br><span class="line">       .duration(<span class="number">200</span>)</span><br><span class="line">       .style(<span class="string">&quot;opacity&quot;</span>, <span class="number">.9</span>);</span><br><span class="line">     div.html(formatTime(d.date) + <span class="string">&quot;&lt;br/&gt;&quot;</span> + d.close)</span><br><span class="line">       .style(<span class="string">&quot;left&quot;</span>, (d3.event.pageX) + <span class="string">&quot;px&quot;</span>)</span><br><span class="line">       .style(<span class="string">&quot;top&quot;</span>, (d3.event.pageY - <span class="number">28</span>) + <span class="string">&quot;px&quot;</span>);</span><br><span class="line">     &#125;)</span><br><span class="line">   .on(<span class="string">&quot;mouseout&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123;</span><br><span class="line">     div.transition()</span><br><span class="line">       .duration(<span class="number">500</span>)</span><br><span class="line">       .style(<span class="string">&quot;opacity&quot;</span>, <span class="number">0</span>);</span><br><span class="line">     &#125;)</span><br></pre></td></tr></table></figure><p>Notice there is only one tooltip exist in the page.</p><h3 id="Selecting-Filtering-a-subset-of-objects"><a href="#Selecting-Filtering-a-subset-of-objects" class="headerlink" title="Selecting/Filtering a subset of objects"></a>Selecting/Filtering a subset of objects</h3><p>Filtering is fairly simple.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">svg.selectAll(<span class="string">&#x27;circle&#x27;</span>)</span><br><span class="line">    .data(data)</span><br><span class="line">  .enter().append(<span class="string">&#x27;circle&#x27;</span>)</span><br><span class="line">    .filter(<span class="function"><span class="params">d</span> =&gt;</span> d.close &lt; <span class="number">400</span>)</span><br><span class="line">    .style(<span class="string">&#x27;fill&#x27;</span>, <span class="string">&#x27;red&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;r&#x27;</span>, <span class="number">5</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;cx&#x27;</span>, <span class="function"><span class="params">d</span> =&gt;</span> xScale(d.date))</span><br><span class="line">    .attr(<span class="string">&#x27;cy&#x27;</span>, <span class="function"><span class="params">d</span> =&gt;</span> yScale(d.close))</span><br></pre></td></tr></table></figure><h4 id="Select-Items-with-an-IF-statement"><a href="#Select-Items-with-an-IF-statement" class="headerlink" title="Select Items with an IF statement"></a>Select Items with an IF statement</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.style(<span class="string">&quot;fill&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123;   </span><br><span class="line">  <span class="keyword">if</span> (d.close &lt;= <span class="number">400</span>) &#123;<span class="keyword">return</span> <span class="string">&quot;red&quot;</span>&#125;  </span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (d.close &gt;= <span class="number">620</span>) &#123;<span class="keyword">return</span> <span class="string">&quot;lawngreen&quot;</span>&#125; <span class="comment">// &lt;== Right here</span></span><br><span class="line">  <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="string">&quot;black&quot;</span> &#125;  </span><br><span class="line">&#125;)  </span><br></pre></td></tr></table></figure><h4 id="Applying-a-color-gradient-to-a-line-based-on-value"><a href="#Applying-a-color-gradient-to-a-line-based-on-value" class="headerlink" title="Applying a color gradient to a line based on value"></a>Applying a color gradient to a line based on value</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.line</span> &#123;</span><br><span class="line">  <span class="attribute">fill</span>: none;</span><br><span class="line">  <span class="attribute">stroke</span>: <span class="built_in">url</span>(#line-gradient);</span><br><span class="line">  <span class="attribute">stroke-width</span>: <span class="number">2px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// set the gradient</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// add linear gradient element</span></span><br><span class="line">svg.append(<span class="string">&#x27;linearGradent&#x27;</span>)</span><br><span class="line"><span class="comment">// add id for css anchor</span></span><br><span class="line">    .attr(<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;line-gradient&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;gradientUnits&#x27;</span>, <span class="string">&#x27;userSpaceOnUse&#x27;</span>)</span><br><span class="line"><span class="comment">// use x1, y1, x2, y2 to define the bounds of the area over which the gradient will act.</span></span><br><span class="line"><span class="comment">// here we set x1, x2 to the same value so the gradient won&#x27;t act on x direction.</span></span><br><span class="line">    .attr(<span class="string">&#x27;x1&#x27;</span>, <span class="number">0</span>).attr(<span class="string">&#x27;y1&#x27;</span>, yScale(<span class="number">0</span>))</span><br><span class="line">    .attr(<span class="string">&#x27;x2&#x27;</span>, <span class="number">0</span>).attr(<span class="string">&#x27;y2&#x27;</span>, yScale(<span class="number">1000</span>))</span><br><span class="line"><span class="comment">// select all &#x27;stop&#x27; elements for the gradients, these &#x27;stop&#x27; elements define where on the range covered by our coordinates the color start and stop(percent or decimal)</span></span><br><span class="line">  .selectAll(<span class="string">&#x27;stop&#x27;</span>)</span><br><span class="line">    .data([</span><br><span class="line">      &#123;<span class="attr">offset</span>: <span class="string">&#x27;0%&#x27;</span>, <span class="attr">color</span>: <span class="string">&#x27;red&#x27;</span>&#125;,</span><br><span class="line">      &#123;<span class="attr">offset</span>: <span class="string">&#x27;40%&#x27;</span>, <span class="attr">color</span>: <span class="string">&#x27;red&#x27;</span>&#125;,</span><br><span class="line">      &#123;<span class="attr">offset</span>: <span class="string">&#x27;40%&#x27;</span>, <span class="attr">color</span>: <span class="string">&#x27;black&#x27;</span>&#125;,</span><br><span class="line">      &#123;<span class="attr">offset</span>: <span class="string">&#x27;62%&#x27;</span>, <span class="attr">color</span>: <span class="string">&#x27;black&#x27;</span>&#125;,</span><br><span class="line">      &#123;<span class="attr">offset</span>: <span class="string">&#x27;62%&#x27;</span>, <span class="attr">color</span>: <span class="string">&#x27;lawngreen&#x27;</span>&#125;,</span><br><span class="line">      &#123;<span class="attr">offset</span>: <span class="string">&#x27;62%&#x27;</span>, <span class="attr">color</span>: <span class="string">&#x27;lawngreen&#x27;</span>&#125;,</span><br><span class="line">      &#123;<span class="attr">offset</span>: <span class="string">&#x27;100%&#x27;</span>, <span class="attr">color</span>: <span class="string">&#x27;lawngreen&#x27;</span>&#125;,</span><br><span class="line">    ])</span><br><span class="line">  .enter().append(<span class="string">&#x27;stop&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;offset&#x27;</span>, <span class="function"><span class="params">d</span> =&gt;</span> d.offset)</span><br><span class="line">    .attr(<span class="string">&#x27;stop-color&#x27;</span>, <span class="function"><span class="params">d</span> =&gt;</span> d.color)</span><br></pre></td></tr></table></figure><p>There is our anchor on the third line.</p><p>If you want to apply the gradient on area, simply change the css</p><pre><code class="css">.area &#123;  fill: url(#area-gradient);  stroke-width: 0px;&#125;</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> D3 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Styles in D3</title>
      <link href="/2017/08/31/Styles-in-D3/"/>
      <url>/2017/08/31/Styles-in-D3/</url>
      
        <content type="html"><![CDATA[<h3 id="fill"><a href="#fill" class="headerlink" title="fill"></a>fill</h3><p>The <code>fill</code> style will fill the element being presented with a specifed color.</p><p>By default, most element will be filled with black.</p><h3 id="stroke"><a href="#stroke" class="headerlink" title="stroke"></a>stroke</h3><p>The <code>stroke</code> style applies a color to lines</p><h3 id="opacity"><a href="#opacity" class="headerlink" title="opacity"></a>opacity</h3><p>The <code>opacity</code> style has the effect of varying an element’s transparency.</p><p>The valid range for <code>opacity</code> is from 0 to 1.</p><p>We should make the distinction at this point that <code>opacity</code> affects the entire element, whereas the following <code>fill-opacity</code> and <code>stroke-opacity</code> affect only the fill and stroke respectively.</p><h3 id="fill-opacity"><a href="#fill-opacity" class="headerlink" title="fill-opacity"></a>fill-opacity</h3><p>The <code>fill-opacity</code> style changes the transparency of the fill of an element.</p><h3 id="stroke-opacity"><a href="#stroke-opacity" class="headerlink" title="stroke-opacity"></a>stroke-opacity</h3><p>The <code>stroke-opacity</code> style changes the transparency of the stroke of an element.</p><h3 id="stroke-width"><a href="#stroke-width" class="headerlink" title="stroke-width"></a>stroke-width</h3><p>The <code>stroke-width</code> style adjusts the width of the line of an element.</p><p>The value specified when setting <code>stroke-width</code> in pixels.</p><h3 id="stroke-dasharray"><a href="#stroke-dasharray" class="headerlink" title="stroke-dasharray"></a>stroke-dasharray</h3><p>The <code>stroke-dasharray</code> style allows us to form element lines with dashes instead of solid lines.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.style(<span class="string">&#x27;stroke-dasharray&#x27;</span>, (<span class="string">&#x27;10, 3&#x27;</span>))</span><br></pre></td></tr></table></figure><h3 id="stroke-linecap"><a href="#stroke-linecap" class="headerlink" title="stroke-linecap"></a>stroke-linecap</h3><p>The <code>stroke-linecap</code> style allows control of the shape of the ends of lines.</p><p>There are three shape options:</p><ul><li><p><code>butt</code>: The line simply butts up to the starting or ending position and is cut off squarely.</p></li><li><p><code>round</code>: The line is rounded in propotionto its width.</p></li><li><p><code>square</code>: The line is squared off but exnteded in propotion to its width.</p></li></ul><h3 id="stroke-linejoin"><a href="#stroke-linejoin" class="headerlink" title="stroke-linejoin"></a>stroke-linejoin</h3><p>The <code>stroke-linejoin</code> style specifies the shape of the join of two lines. This would be used on <code>path</code>, <code>polyline</code> and <code>polygon</code>.</p><p>There are three line join options:</p><ul><li><p><code>miter</code>: The join is squared off as would be expected at the join of two lines.</p></li><li><p><code>round</code>: The outside portion of the join is rounded in proportion to its width.</p></li><li><p><code>bevel</code>: The join has a straight edged outer portion clipped off to provide a slightly more contoured effect while still being regular.</p></li></ul><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/EAS-41.png" alt="miter"></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/EAS-39.png" alt="round"></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/EAS-40.png" alt="bevel"></p><h3 id="writing-mode"><a href="#writing-mode" class="headerlink" title="writing-mode"></a>writing-mode</h3><p>The <code>writing-mode</code> style changes the orientation of the text so that it prints out top to bottom.</p><p>It has a single option ‘tb’ that accomplishes this.</p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/EAS-42.png"></p><h3 id="glyph-orientation-vertical"><a href="#glyph-orientation-vertical" class="headerlink" title="glyph-orientation-vertical"></a>glyph-orientation-vertical</h3><p>The <code>glyph-orientation-vertical</code> style changes the rotation of the individual glyphs(characters) in text and if used in conjunction with the <code>writing-mode</code> style (and set to 0) will allow the text to be displayed vertically with the letters orientation vertically as well.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">holder.append(<span class="string">&#x27;text&#x27;</span>)</span><br><span class="line">    .style(<span class="string">&#x27;fill&#x27;</span>, <span class="string">&#x27;black&#x27;</span>)</span><br><span class="line">    .style(<span class="string">&#x27;writing-mode&#x27;</span>, <span class="string">&#x27;tb&#x27;</span>)</span><br><span class="line">    .style(<span class="string">&#x27;glyph-orientation-vertical&#x27;</span>, <span class="number">0</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;x&#x27;</span>, <span class="number">200</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;y&#x27;</span>, <span class="number">100</span>)</span><br><span class="line">    .text(<span class="string">&#x27;Hello World&#x27;</span>)</span><br></pre></td></tr></table></figure><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/EAS-43.png"></p>]]></content>
      
      
      
        <tags>
            
            <tag> D3 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Attributes in D3</title>
      <link href="/2017/08/30/Attributes-in-D3/"/>
      <url>/2017/08/30/Attributes-in-D3/</url>
      
        <content type="html"><![CDATA[<h3 id="x-y"><a href="#x-y" class="headerlink" title="x/y"></a>x/y</h3><p>The <code>x</code> and <code>y</code> attributes are used to designate a position on the web page. Use the <code>x</code> and <code>y</code> attributes places the anchor points for these elements at a specified location.</p><h3 id="x1-y1-x2-y2"><a href="#x1-y1-x2-y2" class="headerlink" title="x1, y1, x2, y2"></a>x1, y1, x2, y2</h3><p>The <code>x1</code>, <code>y1</code>, <code>x2</code>, <code>y2</code> attributes are used to designate the position of two points on the web page. These two points are connected with a line as part of the <code>line</code> element.</p><h3 id="points"><a href="#points" class="headerlink" title="points"></a>points</h3><p>The <code>points</code> attribute is used to set a series of points which are subsequently connected with a line and/or which may form the bounds of a shape. These are specifically associated with the <code>polyline</code> and <code>polygon</code> elements.</p><p>The data for the points is entered as a sequence of x,y points in the following format:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.attr(<span class="string">&#x27;points&#x27;</span>, <span class="string">&#x27;100,50, 150,150, 150,50&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="cx-cy"><a href="#cx-cy" class="headerlink" title="cx, cy"></a>cx, cy</h3><p>The <code>cx</code>, <code>cy</code> attributes are associated with the circle and ellipse elements and designate the center of each shape.</p><ul><li><p><code>cx</code>: The position of the center of the element in the x axis.</p></li><li><p><code>cy</code>: The position of the center of the element in the y axis.</p></li></ul><h3 id="rx-ry"><a href="#rx-ry" class="headerlink" title="rx, ry"></a>rx, ry</h3><p>The <code>rx</code>, <code>ry</code> attributes are associated with the ellipse element and designate the radius in the x and y directions.</p><ul><li><p><code>rx</code>: The radius of the ellipse in the x direction.</p></li><li><p><code>ry</code>: The radius of the ellipse in the y direction.</p></li></ul><h3 id="transform-translate-x-y-scale-k-rotate-a"><a href="#transform-translate-x-y-scale-k-rotate-a" class="headerlink" title="transform(translate(x, y), scale(k), rotate(a))"></a>transform(translate(x, y), scale(k), rotate(a))</h3><ul><li><p><code>translate(x, y)</code>: move the element by a relative value in x and y directions.</p></li><li><p><code>scale(k)</code>: Increase or reduce the element by a specified factor.</p></li><li><p><code>rotate(a)</code>: Rotate the element by an angular value.</p></li></ul><p>All transform are applied based on the origin of (0, 0).</p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/EAS-23.png"></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/EAS-24.png" alt="rotate(10)"></p><p>So you’d better use transform like this:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">holder.append(<span class="string">&#x27;text&#x27;</span>)</span><br><span class="line">    .style(<span class="string">&#x27;fill&#x27;</span>, <span class="string">&#x27;black&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;dy&#x27;</span>, <span class="string">&#x27;0.35em&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;text-anchor&#x27;</span>, <span class="string">&#x27;middle&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;transform&#x27;</span>, <span class="string">&#x27;translate(200, 100) rotate(10) scale(2)&#x27;</span>)</span><br><span class="line">    .text(<span class="string">&#x27;Hello World&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="width-height"><a href="#width-height" class="headerlink" title="width, height"></a>width, height</h3><p><code>width</code> and <code>height</code> are required attributes of the rectagule element, <code>width</code> designates the width of the rectangle and <code>height</code> designates the height.</p><h3 id="text-anchor"><a href="#text-anchor" class="headerlink" title="text-anchor"></a>text-anchor</h3><p>The <code>text-anchor</code> attribute determines the justification of a text element. You can set it to <code>start</code>, <code>middle</code>, or <code>end</code>.</p><h3 id="dx-dy"><a href="#dx-dy" class="headerlink" title="dx, dy"></a>dx, dy</h3><p><code>dx</code> and <code>dy</code> are optional attributes that designate an offset of text elements from the anchor point in the x and y directions.</p><h3 id="textLength"><a href="#textLength" class="headerlink" title="textLength"></a>textLength</h3><p>The <code>textLength</code> attribute adjusts the length of the text element to fix a specified value.</p><h3 id="lenghtAdjust"><a href="#lenghtAdjust" class="headerlink" title="lenghtAdjust"></a>lenghtAdjust</h3><p>The <code>lengthAdjust</code> attribute allows the <code>textLength</code> attribute to have the spacing of a text element controlled to be either <code>spacing</code> or <code>spacingAndGlyphs</code>.</p><ul><li><p><code>spacing</code>: In thi soption the letters remain the same size, but the spacing between the letters and words are adjusted.</p></li><li><p><code>spacingAndGlyphs</code>: In this option the text is stretched or squeezed to fit.</p></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> D3 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Basic Elements in D3</title>
      <link href="/2017/08/30/Basic-Elements-in-D3/"/>
      <url>/2017/08/30/Basic-Elements-in-D3/</url>
      
        <content type="html"><![CDATA[<h3 id="Circle"><a href="#Circle" class="headerlink" title="Circle"></a>Circle</h3><ul><li><p><code>cx</code>: The position of the center of the circle in the x direction.</p></li><li><p><code>cy</code>: The position of the center of the circle in the y direction.</p></li><li><p><code>r</code>: The radius of the circle from the <code>cx</code>, <code>cy</code> position to the perimeter of the circle.</p></li></ul><h3 id="Ellipse"><a href="#Ellipse" class="headerlink" title="Ellipse"></a>Ellipse</h3><ul><li><p><code>cx</code>: The position of the center of the ellipse in the x direction.</p></li><li><p><code>cy</code>: The position of the center of the ellipse in the y direction.</p></li><li><p><code>rx</code>: The radius of the ellipse in the x dimension.</p></li><li><p><code>ry</code>: The radius of the ellipse in the y dimension.</p></li></ul><h3 id="Rectangle"><a href="#Rectangle" class="headerlink" title="Rectangle"></a>Rectangle</h3><ul><li><p><code>x</code>: The position on the x axis of the left hand side of the rectangle.</p></li><li><p><code>y</code>: The position on the y axis of the top hand side of the rectangle.</p></li><li><p><code>width</code>: the width in pixel of the rectangle.</p></li><li><p><code>height</code>: the height in pixel of the rectangle.</p></li><li><p><code>rx</code>: the radius curve of the corner of the rectangle in the x dimension</p></li><li><p><code>ry</code>: The radius curve of the corner of the rectangle in the y dimension.</p></li></ul><h3 id="Line"><a href="#Line" class="headerlink" title="Line"></a>Line</h3><ul><li><p><code>x1</code>: The x position of the first end of the line.</p></li><li><p><code>y1</code>: The y position of the first end of the line.</p></li><li><p><code>x2</code>: The x position of the second end of the line.</p></li><li><p><code>y2</code>: The y position of the second end of the line.</p></li></ul><h3 id="polyline"><a href="#polyline" class="headerlink" title="polyline"></a>polyline</h3><p>A polyline is a sequence of connected lines described with a single attribute <code>points</code>.</p><ul><li><code>points</code>: The <code>points</code> attribute is a list of x,y coordinates that are the locations of the connecting points of the polyline.</li></ul><h3 id="polygon"><a href="#polygon" class="headerlink" title="polygon"></a>polygon</h3><p>A polygon is a sequnce of connected lines which form a closed shaped described with a single attribte <code>points</code></p><ul><li><code>points</code>: The <code>points</code> attribute is a list of x,y coordinates that are the locations of the connecting points of the polygon.</li></ul><h3 id="Path"><a href="#Path" class="headerlink" title="Path"></a>Path</h3><p>A path is an outline of an SVG shape which is described with a ‘mini-language’ inside a single attribute.</p><ul><li><code>d</code>: This attribute is a list of instructions that allow a shape to be drawn in a complex way using a ‘mini-language’ of command. These commands are written in a shorthand of single letters such a <code>M</code>-moveto, <code>Z</code>-closepath, <code>L</code>-lineto, <code>C</code>-curveto.</li></ul><h3 id="Clipped-Path-AKA-clipPath"><a href="#Clipped-Path-AKA-clipPath" class="headerlink" title="Clipped Path(AKA clipPath)"></a>Clipped Path(AKA clipPath)</h3><p>A clipPath is the path of a SVG shape that can be used in combination with another shape to remove any parts of the combined shape that doesn’t fall within the clipPath.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">holder.append(<span class="string">&#x27;clipPath&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;ellipse-clip&#x27;</span>)</span><br><span class="line">  .append(<span class="string">&#x27;ellipse&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;cx&#x27;</span>, <span class="number">175</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;cy&#x27;</span>, <span class="number">100</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;rx&#x27;</span>, <span class="number">100</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;ry&#x27;</span>, <span class="number">50</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">holder.append(<span class="string">&#x27;rect&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;x&#x27;</span>, <span class="number">125</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;y&#x27;</span>, <span class="number">75</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;clip-path&#x27;</span>, <span class="string">&#x27;url(#ellipse-clip)&#x27;</span>)</span><br><span class="line">    .style(<span class="string">&#x27;fill&#x27;</span>, <span class="string">&#x27;lightgrey&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;height&#x27;</span>, <span class="number">100</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;width&#x27;</span>, <span class="number">200</span>)</span><br></pre></td></tr></table></figure><h3 id="Text"><a href="#Text" class="headerlink" title="Text"></a>Text</h3><p>A text element is an SVG object which is shaped as text. It is described by two required attributes and three optional ones.</p><ul><li><p><code>x</code>: This attribute designates the anchor point location for the text in the x dimension.</p></li><li><p><code>y</code>: This attribute designates the anchor point location for the text in the y dimension.</p></li><li><p><code>dx</code>: This attribute designates the offset of the text from the anchor point in the x dimension. (ususally set to 0.35em, 0.71em)</p></li><li><p><code>dy</code>: This attribute designates the offset of the text from the anchor point in the y dimension.</p></li><li><p><code>text-anchor</code>: This attribute controls the horizontal text alignment. It has three values: <code>start</code>, <code>middle</code>, <code>end</code>.</p></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> D3 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Things We Can Do With the Simple Graph of D3</title>
      <link href="/2017/08/30/Things-we-can-do-with-the-simple-Graph-of-D3/"/>
      <url>/2017/08/30/Things-we-can-do-with-the-simple-Graph-of-D3/</url>
      
        <content type="html"><![CDATA[<p><a href="https://leanpub.com/d3-t-and-t-v4/read#axes">Original</a></p><h3 id="Setting-up-and-configuring-the-Axes"><a href="#Setting-up-and-configuring-the-Axes" class="headerlink" title="Setting up and configuring the Axes"></a>Setting up and configuring the Axes</h3><h4 id="Change-the-text-size"><a href="#Change-the-text-size" class="headerlink" title="Change the text size"></a>Change the text size</h4><p>The default size is <strong>10px</strong> with the font type of <strong>sans-serif</strong>.</p><p>There are a couple of different ways that we could change the font size and either one is valid.</p><p>The first way is to specify the font as a style when drawing an individual axis.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">svg.append(<span class="string">&#x27;g&#x27;</span>)</span><br><span class="line">    .style(<span class="string">&#x27;font&#x27;</span>, <span class="string">&#x27;14px times&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;transform&#x27;</span>, <span class="string">`translate(0, <span class="subst">$&#123;height&#125;</span>)`</span>)</span><br><span class="line">    .call(d3.axisBottom(xScale))</span><br></pre></td></tr></table></figure><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/axes-01.png"></p><p>There are a few things to notice here.</p><p>Firstly, we do indeed have a larger font and it appears to be of the type ‘times’.</p><p>Secondly, the y axis has remained as 10px sans-serif.</p><p>Lastly, the number of values represented on the x axis has meant that with the increase in font size there is some overlapping going on</p><p>By this way, you can change stype of x axis while leaving y axis away.</p><p>But if you want to change two axis meanwhile, you’d better use class.</p><h4 id="Change-the-number-of-ticks-on-an-axis"><a href="#Change-the-number-of-ticks-on-an-axis" class="headerlink" title="Change the number of ticks on an axis"></a>Change the number of ticks on an axis</h4><p>Now we shall address the other problem taht cropped up when we change the size of the text. We have overlapping values on the x axis.</p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/axes-03.png"></p><p>The <a href="https://github.com/d3/d3-axis">axis component</a> includes a function to specify the number of ticks on an axis.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">svg.append(<span class="string">&#x27;g&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;class&#x27;</span>, <span class="string">&#x27;axis&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;transform&#x27;</span>, <span class="string">`translate(0, <span class="subst">$&#123;height&#125;</span>)`</span>)</span><br><span class="line">    .call(d3.axisBottom(xScale).ticks(<span class="number">5</span>))</span><br></pre></td></tr></table></figure><p>Here you may face a confusion:</p><p>When you specify ticks to 5 or 4, or 3, there’re always 5 ticks, and if you specify ticks to 2, the axis ticks will be 2 representing month.</p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/axes-04.png"></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/axes-05.png"></p><p>This is because D3 is making a command decision for you as to how your ticks should be best displayed.</p><p>The following is the list of time interval that D3 will consider when setting automatic ticks on a time based aaxis:</p><ul><li><p>1, 5, 15 and 30-second</p></li><li><p>1, 5, 15 and 30-minute</p></li><li><p>1, 3, 6 and 12-hour</p></li><li><p>1 and 2-day</p></li><li><p>1-week</p></li><li><p>1 and 3-month</p></li><li><p>1-year</p></li></ul><p>You can specify custom time interval by <code>d3.axisBottom(xScale).ticks(d3.timeDay.every(4))</code>.</p><h4 id="Rotating-text-labels-for-a-graph-size"><a href="#Rotating-text-labels-for-a-graph-size" class="headerlink" title="Rotating text labels for a graph size"></a>Rotating text labels for a graph size</h4><p>An answer to the problem of overlapping axis values might to be rotate the text to provide more space.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">svg.append(<span class="string">&#x27;g&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;class&#x27;</span>, <span class="string">&#x27;axis&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;transform&#x27;</span>, <span class="string">`translate(0, <span class="subst">$&#123;height&#125;</span>)`</span>)</span><br><span class="line">    .call(d3.axisBottom(xScale).ticks(<span class="number">10</span>))</span><br><span class="line">    .selectAll(<span class="string">&#x27;text&#x27;</span>)</span><br><span class="line">        .style(<span class="string">&#x27;text-anchor&#x27;</span>, <span class="string">&#x27;end&#x27;</span>)</span><br><span class="line">        .attr(<span class="string">&#x27;dx&#x27;</span>, <span class="string">&#x27;-0.8em&#x27;</span>) <span class="comment">// move the end of the text away from the line</span></span><br><span class="line">        .attr(<span class="string">&#x27;dy&#x27;</span>, <span class="string">&#x27;0.15em&#x27;</span>) <span class="comment">// move the end of the text away from the line</span></span><br><span class="line">        .attr(<span class="string">&#x27;transform&#x27;</span>, <span class="string">&#x27;rotate(-65)&#x27;</span>)</span><br></pre></td></tr></table></figure><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/rotate02.png"></p><h4 id="Formatting-a-date-time-axis-with-specified-values"><a href="#Formatting-a-date-time-axis-with-specified-values" class="headerlink" title="Formatting a date / time axis with specified values"></a>Formatting a date / time axis with specified values</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">svg.append(<span class="string">&#x27;g&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;class&#x27;</span>, <span class="string">&#x27;axis&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;transform&#x27;</span>, <span class="string">`translate(0, <span class="subst">$&#123;height&#125;</span>)`</span>)</span><br><span class="line">    .call(d3.axisBottom(xScale).tickFormat(d3.timeFormat(<span class="string">&#x27;%Y-%m-%d&#x27;</span>)))</span><br><span class="line">  .selectAll(<span class="string">&#x27;text&#x27;</span>)</span><br><span class="line">    .style(<span class="string">&#x27;text-anchor&#x27;</span>, <span class="string">&#x27;end&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;dx&#x27;</span>, <span class="string">&#x27;-0.8em&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;dy&#x27;</span>, <span class="string">&#x27;0.15em&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;transform&#x27;</span>, <span class="string">&#x27;rotate(-65)&#x27;</span>)</span><br></pre></td></tr></table></figure><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/axes-07.png"></p><h4 id="Adding-Axis-Labels"><a href="#Adding-Axis-Labels" class="headerlink" title="Adding Axis Labels"></a>Adding Axis Labels</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// text label for the x axis</span></span><br><span class="line"></span><br><span class="line">svg.append(<span class="string">&#x27;text&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;transform&#x27;</span>, <span class="string">`translate(<span class="subst">$&#123;width/<span class="number">2</span>&#125;</span>, <span class="subst">$&#123;height + margin.top + <span class="number">20</span>&#125;</span>)`</span>)</span><br><span class="line">    .style(<span class="string">&#x27;text-anchor&#x27;</span>, <span class="string">&#x27;middle&#x27;</span>)</span><br><span class="line">    .text(<span class="string">&#x27;Date&#x27;</span>)</span><br></pre></td></tr></table></figure><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/date01.png"></p><p>Add y axis</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">svg.append(<span class="string">&#x27;text&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;transform&#x27;</span>, <span class="string">&#x27;rotate(-90)&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;y&#x27;</span>, <span class="number">0</span> - margin.left)</span><br><span class="line">    .attr(<span class="string">&#x27;x&#x27;</span>, <span class="number">0</span> - height / <span class="number">2</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;dy&#x27;</span>, <span class="string">&#x27;1em&#x27;</span>)</span><br><span class="line">    .style(<span class="string">&#x27;text-anchor&#x27;</span>, <span class="string">&#x27;middle&#x27;</span>)</span><br><span class="line">    .text(<span class="string">&#x27;Value&#x27;</span>)</span><br></pre></td></tr></table></figure><p>Something may confused you:</p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/value02.png"></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/value03.png"></p><p>And add the title…</p><h4 id="Smoothing-out-graph-lines"><a href="#Smoothing-out-graph-lines" class="headerlink" title="Smoothing out graph lines"></a>Smoothing out graph lines</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.curve(d3.curveBasis)</span><br></pre></td></tr></table></figure><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth03.png" alt="d3.curveLinear"></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth03a.png" alt="d3.curveLinearClosed"></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth04a.png" alt="d3.curveStep"></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth04.png" alt="d3.curveStepBefore"></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth05.png" alt="d3.curveStepAfter"></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth06.png" alt="d3.curveBasis"></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth07.png" alt="d3.curveBasisOpen"></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth08.png" alt="d3.curveLinearClosed"></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth09.png" alt="d3.curveBundle"></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth10.png" alt="d3.curveCardinal"></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth11.png" alt="d3.curveCardinalOpen"></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth12.png" alt="d3.curveCardinalClosed"></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth13.png" alt="d3.curveMonotone"></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth14.png" alt="d3.curveCatmullRom"></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth15.png" alt="d3.curveCatmullRomClosed"></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth16.png" alt="d3.curveCatmullRomOpen"></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth17.png"></p><h4 id="Make-a-dashed-line"><a href="#Make-a-dashed-line" class="headerlink" title="Make a dashed line"></a>Make a dashed line</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">svg.append(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line">    .datum(data)</span><br><span class="line">    .attr(<span class="string">&#x27;class&#x27;</span>, <span class="string">&#x27;line&#x27;</span>)</span><br><span class="line">    .style(<span class="string">&#x27;stroke-dasharry&#x27;</span>, (<span class="string">&#x27;3, 3&#x27;</span>))</span><br><span class="line">    .attr(<span class="string">&#x27;d&#x27;</span>, line)</span><br></pre></td></tr></table></figure><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/dashed01.png"></p><p>Obviously <code>stroke-dasharray</code> is a style is a style for the path element, but the magic is the numbers.</p><p>Essentially they describe the on length and off length of the line. So <code>&#39;(3, 3)&#39;</code> translates to 3px on and 3px off.</p><p>You can try <code>&#39;5, 5, 5, 5, 5, 5, 10, 5, 10, 5, 10, 5&#39;</code></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/dashed02.png"></p><p>Of course you can apply this style on axis or any where you prefer.</p><h4 id="Filling-an-aera-under-the-graph"><a href="#Filling-an-aera-under-the-graph" class="headerlink" title="Filling an aera under the graph"></a>Filling an aera under the graph</h4><p>Filling an area with a solid color isn’t too hard.</p><h5 id="CSS-for-an-area-fill"><a href="#CSS-for-an-area-fill" class="headerlink" title="CSS for an area fill"></a>CSS for an area fill</h5><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.area</span> &#123;</span><br><span class="line">  <span class="attribute">fill</span>: lightsteelblue</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="Define-the-area-function"><a href="#Define-the-area-function" class="headerlink" title="Define the area function"></a>Define the area function</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> area = d3.area()</span><br><span class="line">    .x(<span class="function">(<span class="params">d</span>) =&gt;</span> (xScale(d.date)))</span><br><span class="line">    .y0(height)</span><br><span class="line">    .y1(<span class="function">(<span class="params">d</span>) =&gt;</span> (yScale(d.close)))</span><br></pre></td></tr></table></figure><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/fill03.png"></p><h5 id="Draw-the-area"><a href="#Draw-the-area" class="headerlink" title="Draw the area"></a>Draw the area</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">svg.append(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line">    .datum(data)</span><br><span class="line">    .attr(<span class="string">&#x27;class&#x27;</span>, <span class="string">&#x27;area&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;d&#x27;</span>, area)</span><br></pre></td></tr></table></figure><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/fill04.png"></p><p>If you want to fill the area above the graph</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> area = d3.area()</span><br><span class="line">    .x(<span class="function"><span class="params">d</span> =&gt;</span> (xScale(d.date)))</span><br><span class="line">    .y0(<span class="function"><span class="params">d</span> =&gt;</span> (yScale(d.close)))</span><br><span class="line">    y1(<span class="number">0</span>)</span><br></pre></td></tr></table></figure><h4 id="Add-a-drop-shadow-to-allow-text-to-stand-out-on-graphics"><a href="#Add-a-drop-shadow-to-allow-text-to-stand-out-on-graphics" class="headerlink" title="Add a drop shadow to allow text to stand out on graphics"></a>Add a drop shadow to allow text to stand out on graphics</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">text</span><span class="selector-class">.shadow</span> &#123;</span><br><span class="line">  <span class="attribute">stroke</span>: white;</span><br><span class="line">  <span class="attribute">stroke-width</span>: <span class="number">4px</span>;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0.8</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Add-grid-lines-to-a-graph"><a href="#Add-grid-lines-to-a-graph" class="headerlink" title="Add grid lines to a graph."></a>Add grid lines to a graph.</h4><p>We are going to use the axis function to generate two more axis elements(one for x and one for y) but for these ones of drawing the main lines and the labels, we’re just going to draw the tick lines.</p><h5 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h5><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.grid</span> <span class="selector-tag">line</span> &#123;</span><br><span class="line">  <span class="attribute">stroke</span>: lightgrey;</span><br><span class="line">  <span class="attribute">stroke-opacity</span>: <span class="number">0.7</span>;</span><br><span class="line">  <span class="attribute">shape-rendering</span>: crispEdges;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.grid</span> <span class="selector-tag">path</span> &#123;</span><br><span class="line">  <span class="attribute">stroke-width</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Here we use <code>shape-rendering: crispEdges</code> to make the lines narrow.</p><p>And set <code>.grid path&#123; stroke-width: 0; &#125;</code> to dismiss line of top and right line, it will be like this if we remove the css style:</p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/grid02.png"></p><h5 id="Define-the-grid-line-functions"><a href="#Define-the-grid-line-functions" class="headerlink" title="Define the grid line functions"></a>Define the grid line functions</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// gridlines in x axis function</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">make_x_gridlines</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> d3.axisBottom(xScale).ticks(<span class="number">5</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// gridlines in y axis function</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">make_y_gridlines</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> d3.axisLeft(yScale).ticks(<span class="number">5</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="Draw-the-lines"><a href="#Draw-the-lines" class="headerlink" title="Draw the lines"></a>Draw the lines</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add the x gridlines</span></span><br><span class="line">svg.append(<span class="string">&#x27;g&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;class&#x27;</span>, <span class="string">&#x27;grid&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;transform&#x27;</span>, <span class="string">`translate(0, <span class="subst">$&#123;height&#125;</span>)`</span>)</span><br><span class="line">    .call(make_x_gridlines().tickSize(-height).tickFormat(<span class="string">&#x27;&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// add the y gridlines</span></span><br><span class="line">svg.append(<span class="string">&#x27;g&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;class&#x27;</span>, <span class="string">&#x27;grid&#x27;</span>)</span><br><span class="line">    .call(make_y_gridlines().tickSize(-width).tickFormat(<span class="string">&#x27;&#x27;</span>))</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">axis.tickSize([size])</span><br></pre></td></tr></table></figure><p>In our example, we are setting our ticks to a length that corresponding to the full height or width of the graph, which of course means that they extend across the graph and have the appearance of grid lines.</p><p>The last thing that is included in the code to draw the grid lines is the instruction to suppress printing any label for the ticks:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.tickForamt(<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> D3 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Simple Example of Line Chart With D3v4</title>
      <link href="/2017/08/29/Simple-Example-of-Line-Chart-with-D3v4/"/>
      <url>/2017/08/29/Simple-Example-of-Line-Chart-with-D3v4/</url>
      
        <content type="html"><![CDATA[<h3 id="Import-D3"><a href="#Import-D3" class="headerlink" title="Import D3"></a>Import D3</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://d3js.org/d3.v4.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// set size</span></span><br><span class="line"><span class="keyword">const</span> margin = &#123;</span><br><span class="line">  top: <span class="number">50</span>,</span><br><span class="line">  right: <span class="number">50</span>,</span><br><span class="line">  bottom: <span class="number">50</span>,</span><br><span class="line">  left: <span class="number">50</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> width = <span class="built_in">window</span>.innerWidth - margin.left - margin.right</span><br><span class="line"><span class="keyword">const</span> height = <span class="built_in">window</span>.innerHeight - margin.top - margin.bottom</span><br><span class="line"></span><br><span class="line"><span class="comment">// Set Point Number</span></span><br><span class="line"><span class="keyword">const</span> n = <span class="number">21</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// X scale will use the index of our data</span></span><br><span class="line"><span class="keyword">const</span> xScale = d3.scaleLinear()</span><br><span class="line">    .domain([<span class="number">0</span>, n<span class="number">-1</span>]) <span class="comment">// input</span></span><br><span class="line">    .range([<span class="number">0</span>, width]) <span class="comment">// output</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Y scale will use the randomly generated number</span></span><br><span class="line"><span class="keyword">const</span> yScale = d3.scaleLinear()</span><br><span class="line">    .domain([<span class="number">0</span>, <span class="number">1</span>]) <span class="comment">// input</span></span><br><span class="line">    .range([height, <span class="number">0</span>]) <span class="comment">// output</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// d3&#x27;s line generator</span></span><br><span class="line"><span class="keyword">const</span> line = d3.line()</span><br><span class="line">    .x(<span class="function"><span class="keyword">function</span>(<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> xScale(i)  <span class="comment">// set the x value for the line generator</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .y(<span class="function"><span class="keyword">function</span>(<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> d.y <span class="comment">// set the y value for the line generator</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .curve(d3.curveMonotoneX) <span class="comment">// apply smoothing to the line</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dataset = d3.range(n)</span><br><span class="line">    .map(<span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        y: d3.randomUniform(<span class="number">1</span>)()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add SVG to the page</span></span><br><span class="line"><span class="keyword">const</span> svg = d3.select(<span class="string">&#x27;body&#x27;</span>)</span><br><span class="line">  .append(<span class="string">&#x27;svg&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;width&#x27;</span>, width + margin.left + margin.right)</span><br><span class="line">    .attr(<span class="string">&#x27;height&#x27;</span>, height + margin.top + margin.bottom)</span><br><span class="line">  .append(<span class="string">&#x27;g&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;transform&#x27;</span>, <span class="string">`translate(<span class="subst">$&#123;margin.left&#125;</span>, <span class="subst">$&#123;margin.top&#125;</span>)`</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Call the X axis in a group tag</span></span><br><span class="line">svg.append(<span class="string">&#x27;g&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;class&#x27;</span>, <span class="string">&#x27;x axis&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;transform&#x27;</span>, <span class="string">`translate(0, <span class="subst">$&#123;height&#125;</span>)`</span>)</span><br><span class="line">    .call(d3.axisBottom(xScale)) <span class="comment">// Create an axis component with d3.axisBottom</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Call the Y axis in a group tag</span></span><br><span class="line">svg.append(<span class="string">&#x27;g&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;class&#x27;</span>, <span class="string">&#x27;y axis&#x27;</span>)</span><br><span class="line">    .call(d3.axisLeft(yScale))</span><br><span class="line"></span><br><span class="line"><span class="comment">// Append the path, bind the data, and call the line generator</span></span><br><span class="line">svg.append(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line">    .datum(dataset) <span class="comment">// bind data to the path</span></span><br><span class="line">    .attr(<span class="string">&#x27;class&#x27;</span>, <span class="string">&#x27;line&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;d&#x27;</span>, line) <span class="comment">// call the line generator</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Append a circle for each data point</span></span><br><span class="line">svg.selectAll(<span class="string">&#x27;.dot&#x27;</span>)</span><br><span class="line">    .data(dataset)</span><br><span class="line">  .enter().append(<span class="string">&#x27;circle&#x27;</span>)</span><br><span class="line">    .attr(<span class="string">&#x27;cx&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> xScale(i)</span><br><span class="line">    &#125;)</span><br><span class="line">    .attr(<span class="string">&#x27;cy&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> yScale(dy)</span><br><span class="line">    &#125;)</span><br><span class="line">    .attr(<span class="string">&#x27;r&#x27;</span>, <span class="number">5</span>)</span><br></pre></td></tr></table></figure><h3 id="Add-style"><a href="#Add-style" class="headerlink" title="Add style"></a>Add style</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.line</span> &#123;</span><br><span class="line">  <span class="attribute">fill</span>: none;</span><br><span class="line">  <span class="attribute">stroke</span>: cyan;</span><br><span class="line">  <span class="attribute">storke-width</span>: <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.dot</span> &#123;</span><br><span class="line">  <span class="attribute">fill</span>: <span class="number">#ffab00</span>;</span><br><span class="line">  <span class="attribute">stroke</span>: <span class="number">#FFF</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> D3 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Usage of Mock</title>
      <link href="/2017/08/29/Usage-of-Mock/"/>
      <url>/2017/08/29/Usage-of-Mock/</url>
      
        <content type="html"><![CDATA[<h3 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add mockjs</span><br></pre></td></tr></table></figure><h3 id="Simple-Usage"><a href="#Simple-Usage" class="headerlink" title="Simple Usage"></a>Simple Usage</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Mock = <span class="built_in">require</span>(<span class="string">&#x27;mock&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> data = Mock.mock(&#123;</span><br><span class="line">  <span class="string">&#x27;list|1-10&#x27;</span>: [&#123;</span><br><span class="line">    <span class="string">&#x27;id|+1&#x27;</span>: <span class="number">1</span></span><br><span class="line">  &#125;]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(data))</span><br></pre></td></tr></table></figure><h3 id="Data-Template-Definition-DTD"><a href="#Data-Template-Definition-DTD" class="headerlink" title="Data Template Definition(DTD)"></a>Data Template Definition(DTD)</h3><p>Each attribute consists of three parts:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// attribute name</span></span><br><span class="line"><span class="comment">// attribute rule</span></span><br><span class="line"><span class="comment">// attribute value</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;name|rule&#x27;</span>: value</span><br></pre></td></tr></table></figure><p>rule is optional</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// rules</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&#x27;name|min-max&#x27;</span>: value,</span><br><span class="line">  <span class="string">&#x27;name|count&#x27;</span>: value,</span><br><span class="line">  <span class="string">&#x27;name|min-max.dmin-dmax&#x27;</span>: value,</span><br><span class="line">  <span class="string">&#x27;name|min-max.dcount&#x27;</span>: value,</span><br><span class="line">  <span class="string">&#x27;name|count.dmin-dmax&#x27;</span>: value,</span><br><span class="line">  <span class="string">&#x27;name|count.dcount&#x27;</span>: value,</span><br><span class="line">  <span class="string">&#x27;name|+step&#x27;</span>: value,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;name|min-max&#x27;</span>: string <span class="comment">// repeat &#x27;string&#x27; less than or equal to &#x27;min&#x27;, more than or equal &#x27;max&#x27;</span></span><br><span class="line"><span class="string">&#x27;name|count&#x27;</span>: string <span class="comment">// repeat &#x27;string&#x27; &#x27;count&#x27; times.</span></span><br><span class="line"><span class="string">&#x27;name|+1&#x27;</span>: <span class="number">0</span>, <span class="comment">// auto incresing with step 1 from 0</span></span><br><span class="line"><span class="string">&#x27;name|min-max&#x27;</span>: number <span class="comment">// generate a number &gt;=min and &lt;=max</span></span><br><span class="line"><span class="string">&#x27;name|min-max.dmin-dmax&#x27;</span>: number <span class="comment">// generate a float, the integer part &gt;=min and &lt;=max, the deciaml part remains dmin - dmax bits.</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Mock.mock(&#123;</span><br><span class="line">    <span class="string">&#x27;number1|1-100.1-10&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">&#x27;number2|123.1-10&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">&#x27;number3|123.3&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">&#x27;number4|123.10&#x27;</span>: <span class="number">1.123</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// =&gt;</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;number1&quot;</span>: <span class="number">12.92</span>,</span><br><span class="line">    <span class="string">&quot;number2&quot;</span>: <span class="number">123.51</span>,</span><br><span class="line">    <span class="string">&quot;number3&quot;</span>: <span class="number">123.777</span>,</span><br><span class="line">    <span class="string">&quot;number4&quot;</span>: <span class="number">123.1231091814</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Data-Placeholder-Definition-DPD"><a href="#Data-Placeholder-Definition-DPD" class="headerlink" title="Data Placeholder Definition(DPD)"></a>Data Placeholder Definition(DPD)</h3><p>Placeholder hold a position in attribute string, and will dismiss in result.</p><p>Use Mock.Random to generate data.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@placeholder</span><br><span class="line">@placeholder(opt1[, opt2])</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Mock.mock(&#123;</span><br><span class="line">    name: &#123;</span><br><span class="line">        first: <span class="string">&#x27;@FIRST&#x27;</span>,</span><br><span class="line">        middle: <span class="string">&#x27;@FIRST&#x27;</span>,</span><br><span class="line">        last: <span class="string">&#x27;@LAST&#x27;</span>,</span><br><span class="line">        full: <span class="string">&#x27;@first @middle @last&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// =&gt;</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;first&quot;</span>: <span class="string">&quot;Charles&quot;</span>,</span><br><span class="line">        <span class="string">&quot;middle&quot;</span>: <span class="string">&quot;Brenda&quot;</span>,</span><br><span class="line">        <span class="string">&quot;last&quot;</span>: <span class="string">&quot;Lopez&quot;</span>,</span><br><span class="line">        <span class="string">&quot;full&quot;</span>: <span class="string">&quot;Charles Brenda Lopez&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Mock-mock"><a href="#Mock-mock" class="headerlink" title="Mock.mock()"></a>Mock.mock()</h3><h4 id="Mock-mock-rurl-rtype-template-function-options"><a href="#Mock-mock-rurl-rtype-template-function-options" class="headerlink" title="Mock.mock(rurl?, rtype?, template | function(options))"></a>Mock.mock(rurl?, rtype?, template | function(options))</h4><h5 id="Mock-mock-template"><a href="#Mock-mock-template" class="headerlink" title="Mock.mock(template)"></a>Mock.mock(template)</h5><p>Generate mock data</p><h5 id="Mock-mock-rurl-template"><a href="#Mock-mock-rurl-template" class="headerlink" title="Mock.mock(rurl, template)"></a>Mock.mock(rurl, template)</h5><p>Intercept <code>rurl</code>(regexp) request, and generate according template.</p><h5 id="Mock-mock-rurl-function-options"><a href="#Mock-mock-rurl-function-options" class="headerlink" title="Mock.mock(rurl, function(options))"></a>Mock.mock(rurl, function(options))</h5><p>Intercept <code>rurl</code> request and call function(options) to return the mock data.</p><h5 id="Mock-mock-rurl-rtype-template"><a href="#Mock-mock-rurl-rtype-template" class="headerlink" title="Mock.mock(rurl, rtype, template)"></a>Mock.mock(rurl, rtype, template)</h5><p>Intercept the request matching <code>rurl</code> and <code>rtype</code>.</p><h5 id="Mock-mock-rurl-rtype-function-options"><a href="#Mock-mock-rurl-rtype-function-options" class="headerlink" title="Mock.mock(rurl, rtype, function(options))"></a>Mock.mock(rurl, rtype, function(options))</h5><p>Intercept the request matching <code>rurl</code> and <code>rtype</code>.</p><blockquote><p>options conssits of (url, type, body)</p></blockquote><h3 id="Mock-setup"><a href="#Mock-setup" class="headerlink" title="Mock.setup()"></a>Mock.setup()</h3><p>Mock.setup(settings)</p><p>Set action when intercept ajax request.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  timeout: <span class="string">&#x27;&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>timeout: set time responding time, ‘300’, ‘300-600’, default to ‘10-100’</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Mock.setup(&#123;</span><br><span class="line">  timeout: <span class="string">&#x27;200-400&#x27;</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Mock-Random"><a href="#Mock-Random" class="headerlink" title="Mock.Random"></a>Mock.Random</h3><p>Utils to generate Random data.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Random = Mock.Random</span><br><span class="line">Random.email()</span><br><span class="line"></span><br><span class="line">Mock.mock(<span class="string">&#x27;@email&#x27;</span>) <span class="comment">// use with placeholder</span></span><br><span class="line"></span><br><span class="line">Mock.mock(&#123;</span><br><span class="line">  email: <span class="string">&#x27;@email&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>| Type | Mehtod |<br>| Baisc | boolean, natural, integer, float, character, string, range, date, time, datetime, now |<br>| Image | image, dataImage |<br>| Color | color |<br>| Text | paragraph, sentence, word, title, cparagraph, csentence, cword, ctitle |<br>| Name | first, last, name, cfirst, clast, cname |<br>| Web | url, domain, email, ip, tld |<br>| Address | area, region |<br>| Helper | capitalize, upper, lower, pick, shuffle |<br>| Miscellaneous | guid, id |</p><h4 id="Mock-Random-boolean-min-max-current"><a href="#Mock-Random-boolean-min-max-current" class="headerlink" title="Mock.Random.boolean(min?, max?, current?)"></a>Mock.Random.boolean(min?, max?, current?)</h4><p>‘min’ and ‘max’ decide the possibility of ‘current’</p><p>‘current’ will appear in possibility of min/(min + max) to max(min + max)</p><h4 id="Mock-Random-natural-min-max"><a href="#Mock-Random-natural-min-max" class="headerlink" title="Mock.Random.natural(min?, max?)"></a>Mock.Random.natural(min?, max?)</h4><h4 id="Mock-Random-integer-min-max"><a href="#Mock-Random-integer-min-max" class="headerlink" title="Mock.Random.integer(min?, max?)"></a>Mock.Random.integer(min?, max?)</h4><h4 id="Mock-Random-float-min-max-dmin-dmax"><a href="#Mock-Random-float-min-max-dmin-dmax" class="headerlink" title="Mock.Random.float(min?, max?, dmin?, dmax?)"></a>Mock.Random.float(min?, max?, dmin?, dmax?)</h4><h4 id="Mock-Random-character-pool"><a href="#Mock-Random-character-pool" class="headerlink" title="Mock.Random.character(pool?)"></a>Mock.Random.character(pool?)</h4><p>pool represents the character pool</p><p>pool: ‘lower/upper/number/symbol’</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  lower: &#39;abcdefghijklmnopqrstuvwxyz&#39;,</span><br><span class="line">  upper: &#39;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#39;,</span><br><span class="line">  number: 0123456789,</span><br><span class="line">  symbol: &#39;!@#$%^&amp;*()[]&#39;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Mock-Random-string-pool-min-max"><a href="#Mock-Random-string-pool-min-max" class="headerlink" title="Mock.Random.string(pool?, min?, max?)"></a>Mock.Random.string(pool?, min?, max?)</h4><p>pool: available string pool<br>min: min-length, default to 3<br>max: max-length, default to 7</p><h4 id="Mock-Random-range-start-stop-step"><a href="#Mock-Random-range-start-stop-step" class="headerlink" title="Mock.Random.range(start?, stop, step?)"></a>Mock.Random.range(start?, stop, step?)</h4><h4 id="Mock-Random-date-format"><a href="#Mock-Random-date-format" class="headerlink" title="Mock.Random.date(format?)"></a>Mock.Random.date(format?)</h4><h4 id="Mock-Random-time-format"><a href="#Mock-Random-time-format" class="headerlink" title="Mock.Random.time(format?)"></a>Mock.Random.time(format?)</h4><h4 id="Mock-Random-datetime-format"><a href="#Mock-Random-datetime-format" class="headerlink" title="Mock.Random.datetime(format?)"></a>Mock.Random.datetime(format?)</h4><h4 id="Mock-Random-now-unit-format"><a href="#Mock-Random-now-unit-format" class="headerlink" title="Mock.Random.now(unit?, format?)"></a>Mock.Random.now(unit?, format?)</h4><h4 id="Mock-Random-image-size-background-foreground-format-text"><a href="#Mock-Random-image-size-background-foreground-format-text" class="headerlink" title="Mock.Random.image(size?, background?, foreground?, format?, text?)"></a>Mock.Random.image(size?, background?, foreground?, format?, text?)</h4><h4 id="Mock-Random-dataImage-size-text"><a href="#Mock-Random-dataImage-size-text" class="headerlink" title="Mock.Random.dataImage(size?, text?)"></a>Mock.Random.dataImage(size?, text?)</h4><h4 id="Mock-Random-color"><a href="#Mock-Random-color" class="headerlink" title="Mock.Random.color()"></a>Mock.Random.color()</h4><h4 id="Mock-Random-hex"><a href="#Mock-Random-hex" class="headerlink" title="Mock.Random.hex()"></a>Mock.Random.hex()</h4><h4 id="Mock-Random-rgb"><a href="#Mock-Random-rgb" class="headerlink" title="Mock.Random.rgb()"></a>Mock.Random.rgb()</h4><h4 id="Mock-Random-rbga"><a href="#Mock-Random-rbga" class="headerlink" title="Mock.Random.rbga()"></a>Mock.Random.rbga()</h4><h4 id="Mock-Random-hsl"><a href="#Mock-Random-hsl" class="headerlink" title="Mock.Random.hsl()"></a>Mock.Random.hsl()</h4><h4 id="Mock-Random-paragraph-null-length-min-max-Mock-Random-cparagraph-null-length-min-max"><a href="#Mock-Random-paragraph-null-length-min-max-Mock-Random-cparagraph-null-length-min-max" class="headerlink" title="Mock.Random.paragraph(null | length | min, max) | Mock.Random.cparagraph(null | length | min, max)"></a>Mock.Random.paragraph(null | length | min, max) | Mock.Random.cparagraph(null | length | min, max)</h4><h4 id="Mock-Random-sentence-null-length-min-max-Mock-Random-csentence-null-length-min-max"><a href="#Mock-Random-sentence-null-length-min-max-Mock-Random-csentence-null-length-min-max" class="headerlink" title="Mock.Random.sentence(null | length | min, max) | Mock.Random.csentence(null | length | min, max)"></a>Mock.Random.sentence(null | length | min, max) | Mock.Random.csentence(null | length | min, max)</h4><h4 id="Mock-Random-workd-null-length-min-max-Mock-Random-cword-pool-min-max"><a href="#Mock-Random-workd-null-length-min-max-Mock-Random-cword-pool-min-max" class="headerlink" title="Mock.Random.workd(null | length | min, max) | Mock.Random.cword(pool?, min?, max?)"></a>Mock.Random.workd(null | length | min, max) | Mock.Random.cword(pool?, min?, max?)</h4><h4 id="Mock-Random-title-null-length-min-max-Mock-Random-ctitle-null-length-min-max"><a href="#Mock-Random-title-null-length-min-max-Mock-Random-ctitle-null-length-min-max" class="headerlink" title="Mock.Random.title(null | length | min, max) | Mock.Random.ctitle(null | length | min, max)"></a>Mock.Random.title(null | length | min, max) | Mock.Random.ctitle(null | length | min, max)</h4><h4 id="Mock-Random-first-Mock-Random-last-Mock-Random-name-middle-Mock-Random-cfirst-Mock-Random-clast-Mock-Random-cname"><a href="#Mock-Random-first-Mock-Random-last-Mock-Random-name-middle-Mock-Random-cfirst-Mock-Random-clast-Mock-Random-cname" class="headerlink" title="Mock.Random.first() | Mock.Random.last() | Mock.Random.name(middle?) | Mock.Random.cfirst() | Mock.Random.clast() | Mock.Random.cname()"></a>Mock.Random.first() | Mock.Random.last() | Mock.Random.name(middle?) | Mock.Random.cfirst() | Mock.Random.clast() | Mock.Random.cname()</h4><h4 id="Mock-Random-url-protocol-host"><a href="#Mock-Random-url-protocol-host" class="headerlink" title="Mock.Random.url(protocol?, host?)"></a>Mock.Random.url(protocol?, host?)</h4><h4 id="Mock-Random-protocol-Mock-Random-domain-Mock-Random-tld-Mock-Random-email-domain-Mock-Random-ip"><a href="#Mock-Random-protocol-Mock-Random-domain-Mock-Random-tld-Mock-Random-email-domain-Mock-Random-ip" class="headerlink" title="Mock.Random.protocol() | Mock.Random.domain() | Mock.Random.tld() | Mock.Random.email(domain?) | Mock.Random.ip()"></a>Mock.Random.protocol() | Mock.Random.domain() | Mock.Random.tld() | Mock.Random.email(domain?) | Mock.Random.ip()</h4><h4 id="Mock-Random-region-Mock-Random-province-Mock-Random-city-prefix-Mock-Random-county-prefix-Mock-Random-zip"><a href="#Mock-Random-region-Mock-Random-province-Mock-Random-city-prefix-Mock-Random-county-prefix-Mock-Random-zip" class="headerlink" title="Mock.Random.region() | Mock.Random.province() | Mock.Random.city(prefix?) | Mock.Random.county(prefix?) | Mock.Random.zip()"></a>Mock.Random.region() | Mock.Random.province() | Mock.Random.city(prefix?) | Mock.Random.county(prefix?) | Mock.Random.zip()</h4><h4 id="Mock-Random-captilize-word-Mock-Random-upper-str-Mock-Random-lower-str-Mock-Random-pick-arr-Mock-Random-shuffle-arr"><a href="#Mock-Random-captilize-word-Mock-Random-upper-str-Mock-Random-lower-str-Mock-Random-pick-arr-Mock-Random-shuffle-arr" class="headerlink" title="Mock.Random.captilize(word) | Mock.Random.upper(str) | Mock.Random.lower(str) | Mock.Random.pick(arr) | Mock.Random.shuffle(arr)"></a>Mock.Random.captilize(word) | Mock.Random.upper(str) | Mock.Random.lower(str) | Mock.Random.pick(arr) | Mock.Random.shuffle(arr)</h4><h4 id="Mock-Random-guid"><a href="#Mock-Random-guid" class="headerlink" title="Mock.Random.guid()"></a>Mock.Random.guid()</h4><p>Generate a GUID</p><h4 id="Mock-Random-id"><a href="#Mock-Random-id" class="headerlink" title="Mock.Random.id()"></a>Mock.Random.id()</h4><p>Generate a Personal Identity</p><h4 id="Mock-Random-increment-step"><a href="#Mock-Random-increment-step" class="headerlink" title="Mock.Random.increment(step?)"></a>Mock.Random.increment(step?)</h4><h3 id="Mock-valid-template-data"><a href="#Mock-valid-template-data" class="headerlink" title="Mock.valid(template, data)"></a>Mock.valid(template, data)</h3><p>Check if the data is matching the template</p>]]></content>
      
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Start at Pug</title>
      <link href="/2017/08/29/Start-at-Pug/"/>
      <url>/2017/08/29/Start-at-Pug/</url>
      
        <content type="html"><![CDATA[<h3 id="Install-Pug"><a href="#Install-Pug" class="headerlink" title="Install Pug"></a>Install Pug</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add pug</span><br></pre></td></tr></table></figure><h3 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h3><p><code>pug.compile()</code> will compile the Pug source code into a JavaScript function that takes a data object(called <code>locals</code>) as an argument. Call that resultant function with your data, then it will return a string of HTML rendered with your data.</p><p>The compiled function can be re-used, and called with different sets of data.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// - template.pug</span><br><span class="line">p #&#123;name&#125;&#x27;s Pug source code!</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pug = <span class="built_in">require</span>(<span class="string">&#x27;pug&#x27;</span>)</span><br><span class="line"><span class="comment">// Compile the source code</span></span><br><span class="line"><span class="keyword">const</span> compiledFunction = pug.compile(<span class="string">&#x27;template.pug&#x27;</span>)</span><br><span class="line"><span class="comment">// Render a set of data</span></span><br><span class="line"><span class="built_in">console</span>.log(compiledFunction(&#123;</span><br><span class="line">  name: <span class="string">&#x27;Timothy&#x27;</span></span><br><span class="line">&#125;))</span><br><span class="line"><span class="comment">// &quot;&lt;p&gt;Timothy&#x27;s Pug source code!&lt;/p&gt;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Render another set of data</span></span><br><span class="line"><span class="built_in">console</span>.log(compiledFunction(&#123;</span><br><span class="line">  name: <span class="string">&#x27;Forbes&#x27;</span></span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">// &quot;&lt;p&gt;Forbes&#x27; Pug source code!&lt;/p&gt;&quot;</span></span><br></pre></td></tr></table></figure><p>Pug also provides the <code>pug.render()</code> family of functions that combine compileing and rendering into one step. However, the template function will be re-compiled every time <code>render</code> is called, which might impact performance. Alternatively, you can use the <code>cache</code> option with <code>render</code>, which will automatically store the compiled function into an internal cache.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pug = <span class="built_in">require</span>(<span class="string">&#x27;pug&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Compile template.pug and render a set of data</span></span><br><span class="line"><span class="built_in">console</span>.log(pug.renderFile(<span class="string">&#x27;template.pug&#x27;</span>, &#123;</span><br><span class="line">  name: <span class="string">&#x27;Timothy&#x27;</span></span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure><h3 id="Use-with-Express"><a href="#Use-with-Express" class="headerlink" title="Use with Express"></a>Use with Express</h3><p>Pug fully integrates with <code>Express</code>, as a supported view engine.</p><h4 id="Production-Defaults"><a href="#Production-Defaults" class="headerlink" title="Production Defaults"></a>Production Defaults</h4><p>In Express, the environmental variables <code>NODE_ENV</code> is designed to inform the web application of the execution environment: whether it is in development or in production. Express and Pug automatically modify the defaults of a few options in production environment, to provide a better out-of-the-box experience for users.</p><p>Specifically, when <code>process.env.NODE_ENV</code> is set to <code>&#39;production&#39;</code>, and Pug is used with Express, the <code>compileDebug</code> option is <code>false</code> by default, while the <code>cache</code> option is <code>true</code>.</p><h3 id="API-Reference"><a href="#API-Reference" class="headerlink" title="API Reference"></a>API Reference</h3><p>All API mehtods accept the following set of options:</p><ul><li><p>filename: string</p><p>The name of the file being compiled. Used in exceptions, and required for relative <code>include</code> and <code>extend</code>. Default to <code>Pug</code></p></li><li><p>basedir: string</p><p>The root directory of all absolute inclusion</p></li><li><p>doctype: string</p><p>If the <code>doctype</code> is not specified as part of the template, you can specify it here. It is sometimes useful to get self-closing tags and remove mirroring of boolean attributes.</p></li><li><p>filters: object</p><p>Hash table of custom filters. Default to <code>undefined</code></p></li><li><p>self: boolean</p><p>Use a <code>self</code> namespaces to hold the locals. It will speed up the compilation, but instead of writing <code>variable</code> you will have to write <code>self.variable</code> to access to property of the locals object. Default to <code>false</code></p></li><li><p>debug: boolean</p><p>If set to <code>true</code>, the tokens and function body are logged to stdout</p></li><li><p>compileDebug: boolean</p><p>If set to <code>true</code>, the function source will be included in the compiled template for better error messages. It is enabled by default, unless used with express in production mode.</p></li><li><p>globals: Array<string></p><p>Add a list of global names to make accessible in templates</p></li><li><p>cache: boolean</p><p>If set to <code>true</code>, compiled functions are cached. <code>filename</code> must be set as the cache key. Only applies to <code>render</code> functions. Default to <code>false</code></p></li><li><p>inlineRuntimeFunctions: boolean</p><p>Inline runtime functions instead of <code>require</code>-ing them from a shared version. For <code>compileClient</code> functions, the default is <code>true</code>(so that one does not have include the runtime). For all other compilation or rendering types, the default is <code>false</code></p></li><li><p>name: string</p><p>The name of the template function. Only applies to <code>compileClient</code> function. Default to <code>template</code>.</p></li></ul><h3 id="Methods"><a href="#Methods" class="headerlink" title="Methods"></a>Methods</h3><ul><li><p>pug.compile(source[, options])</p><p>Compile a Pug template to a function, which can be rendered multiple times with different locals.</p><ul><li><p>source: string</p><p>the source pug template to compile</p></li><li><p>options: An option object</p></li><li><p>returns: function</p><p>A function to generate the HTML from an object containing locals</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> pug = <span class="built_in">require</span>(<span class="string">&#x27;pug&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> compiledTemplate = pug.compile(<span class="string">&#x27;string of pug&#x27;</span>, options)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> html = compiledFunction(locals)</span><br></pre></td></tr></table></figure></li><li><p>pug.compileFile(path[, options])</p><p>Compile a Pug template from a file to a function, which can be rendered multiple times with different locals.</p><ul><li><p>path: string</p><p>The path to a Pug file</p></li><li><p>options: An option object</p></li><li><p>returns: function</p><p>A function to generate HTML from an object containing locals</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> pug = <span class="built_in">require</span>(<span class="string">&#x27;pug&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> compiledTemplate = pug.compileFile(<span class="string">&#x27;path to pug file&#x27;</span>, options)</span><br><span class="line"><span class="keyword">var</span> html = compiledTemplate(locals)</span><br></pre></td></tr></table></figure></li><li><p>pug.compileClient(source[, options])</p><p>Compile a Pug template to a string of JavaScript, which can be used client side along with Pug runtime.</p><ul><li><p>source: string</p><p>The Pug template to compile</p></li><li><p>options: an option object</p></li><li><p>returns: string</p><p>A string of JavaScript representing a function</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> pug = <span class="built_in">require</span>(<span class="string">&#x27;pug&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> compiledTemplate = pug.compileClient(<span class="string">&#x27;string of pug&#x27;</span>, options)</span><br><span class="line"><span class="keyword">var</span> html = compiledTemplate(locals)</span><br></pre></td></tr></table></figure></li><li><p>pug.render(source[, options[, callback]])</p><ul><li><p>source: string</p><p>The source pug template to render</p></li><li><p>options: an options object</p></li><li><p>callback: function</p><p>Node.js-style callback receiving the rendered results. <strong>The callback is called synchronously</strong>.</p></li><li><p>returns: string</p><p>The resulting HTML String</p></li></ul></li><li><p>pug.renderFile(path[, options[, callback]])</p><ul><li><p>path: string</p><p>the path to the pug file to render</p></li><li><p>option: an options object</p></li><li><p>callback: function</p><p>Node.js-style callback receiving the rendered results. <strong>This callback is called synchronously.</strong></p></li><li><p>returns: function</p><p>The resulting HTML stirng</p></li></ul></li></ul><h3 id="Attributes"><a href="#Attributes" class="headerlink" title="Attributes"></a>Attributes</h3><p>Tag attributes look similar to HTML(with optional commas), but their values are just regular JavaScript.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a(href=<span class="string">&#x27;google.com&#x27;</span>) Google =&gt; <span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;google.com&quot;</span>&gt;</span>Google<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>Normal JavaScript expression works fine:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> authenticated = <span class="literal">true</span></span><br><span class="line">body(<span class="class"><span class="keyword">class</span></span>=authenticated ? <span class="string">&#x27;authed&#x27;</span> : <span class="string">&#x27;anon&#x27;</span>) =&gt; <span class="xml"><span class="tag">&lt;<span class="name">body</span> <span class="attr">class</span>=<span class="string">&quot;authed&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h4 id="Multiline-Attributes"><a href="#Multiline-Attributes" class="headerlink" title="Multiline Attributes"></a>Multiline Attributes</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">input(</span><br><span class="line">  type=<span class="string">&#x27;checkbox&#x27;</span></span><br><span class="line">  name=<span class="string">&#x27;agreement&#x27;</span></span><br><span class="line">  checked</span><br><span class="line">)</span><br><span class="line">=&gt; <span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;agreement&quot;</span> <span class="attr">checked</span> /&gt;</span></span></span><br></pre></td></tr></table></figure><p>If your JavaScript runtime supports ES6 template strings, you can use that syntax for attributes.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">input(data-json=<span class="string">`</span></span><br><span class="line"><span class="string">  &#123;</span></span><br><span class="line"><span class="string">    &quot;very-long&quot;: &quot;piece of&quot;,</span></span><br><span class="line"><span class="string">    &quot;data&quot;: true</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span>)</span><br><span class="line">=&gt; <span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">data-json</span>=<span class="string">&quot;</span></span></span></span><br><span class="line"><span class="xml">  &#123;</span></span><br><span class="line"><span class="xml">    <span class="symbol">&amp;quot;</span>very-long<span class="symbol">&amp;quot;</span>: <span class="symbol">&amp;quot;</span>piece of <span class="symbol">&amp;quot;</span>,</span></span><br><span class="line"><span class="xml">    <span class="symbol">&amp;quot;</span>data<span class="symbol">&amp;quot;</span>: true</span></span><br><span class="line"><span class="xml">  &#125;</span></span><br><span class="line"><span class="xml">&quot;/&gt;</span></span><br></pre></td></tr></table></figure><h4 id="Quoted-Attributes"><a href="#Quoted-Attributes" class="headerlink" title="Quoted Attributes"></a>Quoted Attributes</h4><p>If your attribute name contains odd character that might interfere with JavaScript syntax, either quote it using <code>&quot;&quot;</code> or <code>&#39;&#39;</code>, or use commas to separate different attributes.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">div(<span class="class"><span class="keyword">class</span></span>=<span class="string">&#x27;div-class&#x27;</span>, (click)=<span class="string">&#x27;play()&#x27;</span>)</span><br><span class="line">div(<span class="class"><span class="keyword">class</span></span>=<span class="string">&#x27;div-class&#x27;</span> <span class="string">&#x27;(click)&#x27;</span>=<span class="string">&#x27;play()&#x27;</span>)</span><br><span class="line">=&gt; <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;div-class&quot;</span> (<span class="attr">click</span>)=<span class="string">&quot;play()&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h4 id="Attribute-Interpolation"><a href="#Attribute-Interpolation" class="headerlink" title="Attribute Interpolation"></a>Attribute Interpolation</h4><ul><li><p>Simply write the attribute in JavaScript:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> url = <span class="string">&#x27;pub-test.html&#x27;</span></span><br><span class="line">a(href=<span class="string">&#x27;/&#x27;</span> + url) Link =&gt; <span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&#x27;/pub-test.html&#x27;</span>&gt;</span>Link<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> btnType = <span class="string">&#x27;info&#x27;</span></span><br><span class="line"><span class="keyword">var</span> btnSize = <span class="string">&#x27;lg&#x27;</span></span><br><span class="line">button(type=<span class="string">&#x27;button&#x27;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">`btn btn-<span class="subst">$&#123;btnType&#125;</span> btn-<span class="subst">$&#123;btnSize&#125;</span>`</span>)</span><br><span class="line">=&gt; &lt;button type=&quot;button&quot; class=&quot;btn btn-info btn-lg&quot;&gt;&lt;button&gt;</span><br></pre></td></tr></table></figure></li></ul><h4 id="Boolean-Attributes"><a href="#Boolean-Attributes" class="headerlink" title="Boolean Attributes"></a>Boolean Attributes</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">input(type=<span class="string">&#x27;checkbox&#x27;</span> checked) =&gt; <span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">checked</span>=<span class="string">&quot;checked&quot;</span> /&gt;</span></span></span><br><span class="line">input(type=<span class="string">&#x27;checkbox&#x27;</span> checked=<span class="literal">true</span>) =&gt; <span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">checked</span>=<span class="string">&quot;checked&quot;</span> /&gt;</span></span></span><br><span class="line">input(type=<span class="string">&#x27;checkbox&#x27;</span> checked=<span class="literal">false</span>) =&gt; <span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> /&gt;</span></span></span><br><span class="line">input(type=<span class="string">&#x27;checkbox&#x27;</span> checked=<span class="literal">true</span>.toString()) =&gt; <span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">checked</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span></span><br></pre></td></tr></table></figure><h4 id="Style-Attributes"><a href="#Style-Attributes" class="headerlink" title="Style Attributes"></a>Style Attributes</h4><p>The style attribute can be a string, like any normal attribute, but it can be an object, which is handy when styles are generated by JavaScript:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a(style=&#123;<span class="attr">color</span>: <span class="string">&#x27;red&#x27;</span>, <span class="attr">background</span>: <span class="string">&#x27;green&#x27;</span>&#125;) =&gt; <span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">style</span>=<span class="string">&quot;color:red;background:green;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h4 id="Class-Attributes"><a href="#Class-Attributes" class="headerlink" title="Class Attributes"></a>Class Attributes</h4><p>The <code>class</code> attribute can be a string, like any normal attribute, but is also can be an array of class names, which is handy when generated from JavaScript.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> classes = [<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>, <span class="string">&#x27;baz&#x27;</span>]</span><br><span class="line">a(<span class="class"><span class="keyword">class</span></span>=classes) =&gt; <span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;foo bar baz&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">a.bang(<span class="class"><span class="keyword">class</span></span>=classes <span class="class"><span class="keyword">class</span></span>=[bing]) =&gt; <span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;bang foo bar baz bing&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>It can also be an object which maps class names to <code>true</code> or <code>false</code> values. This is useful for applying conditional classes:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> currentURL = <span class="string">&#x27;/about&#x27;</span></span><br><span class="line">a(<span class="class"><span class="keyword">class</span></span>=&#123;<span class="attr">active</span>: currentURL === <span class="string">&#x27;/about&#x27;</span> href=<span class="string">&#x27;/about&#x27;</span>&#125;) =&gt; <span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;active&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h4 id="Class-Literal"><a href="#Class-Literal" class="headerlink" title="Class Literal"></a>Class Literal</h4><p>Classes may be defined using a <code>.classname</code> syntax:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a.button =&gt; <span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;button&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>Since <code>div</code>s are such a common choice of tag, it is default if you omit the tag name:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.content =&gt; <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h4 id="ID-Literal"><a href="#ID-Literal" class="headerlink" title="ID Literal"></a>ID Literal</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a#main-link =&gt; &lt;a id=&quot;main-link&quot;&gt;&lt;/a&gt;</span><br></pre></td></tr></table></figure><h4 id="amp-attributes"><a href="#amp-attributes" class="headerlink" title="&amp;attributes"></a>&amp;attributes</h4><p>Pronounced as <code>and attributes</code>, the <code>&amp;attributes</code> syntax can be used to expode an object into attributes of an element:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dev#foo(data-json=&quot;foo&quot;)&amp;attributes(&#123;&#x27;data-foo&#x27;: &#x27;bar&#x27;&#125;) =&gt; &lt;div id=&quot;foo&quot; data-json=&quot;foo&quot; data-foo=&quot;bar&quot; /&gt;</span><br></pre></td></tr></table></figure><h3 id="Case"><a href="#Case" class="headerlink" title="Case"></a>Case</h3><p>The <code>case</code> statement is a shorthand for JavaScript’s switch, it takes the following form:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> friends = <span class="number">10</span></span><br><span class="line"><span class="keyword">case</span> friends</span><br><span class="line">  when <span class="number">0</span></span><br><span class="line">    p you have no friends</span><br><span class="line">  when <span class="number">1</span></span><br><span class="line">    p you have a friend</span><br><span class="line">  <span class="keyword">default</span></span><br><span class="line">    p you have #&#123;friends&#125; friends</span><br></pre></td></tr></table></figure><h4 id="Case-Fall-Through"><a href="#Case-Fall-Through" class="headerlink" title="Case Fall Through"></a>Case Fall Through</h4><p>You can use fall through, just as you would in a JavaScript <code>switch</code> statement</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> friends = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> friends</span><br><span class="line">  when <span class="number">0</span></span><br><span class="line">  when <span class="number">1</span></span><br><span class="line">    p you have very few friends</span><br><span class="line">  <span class="keyword">default</span></span><br><span class="line">    p you have #&#123;friends&#125; friends</span><br></pre></td></tr></table></figure><p>The difference, however, is a fall through in JavaScript happens whenever a <code>break</code> statement is not explicitly included.</p><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><p>Pug allows you to write inline JavaScript code in your templates. There are three types of code: Unbuffered, Buffered, and Unescaped Buffered.</p><h4 id="Unbuffered-Code"><a href="#Unbuffered-Code" class="headerlink" title="Unbuffered Code"></a>Unbuffered Code</h4><p>Unbuffered code starts with <code>-</code>. It does not directly add anything to the output</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- <span class="keyword">for</span> (<span class="keyword">var</span> x = <span class="number">0</span>; x &lt; <span class="number">3</span>; x++)</span><br><span class="line">  li item</span><br><span class="line"></span><br><span class="line">=&gt;</span><br><span class="line"></span><br><span class="line">&lt;li&gt;item&lt;/li&gt;</span><br><span class="line">&lt;li&gt;item&lt;/li&gt;</span><br><span class="line">&lt;li&gt;item&lt;/li&gt;</span><br></pre></td></tr></table></figure><p>Pug also supports block unbuffered code:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">-</span><br><span class="line">  <span class="keyword">var</span> list = [<span class="string">&#x27;Uno&#x27;</span>, <span class="string">&#x27;Dos&#x27;</span>, <span class="string">&#x27;Tres&#x27;</span>, <span class="string">&#x27;Cuatro&#x27;</span>, <span class="string">&#x27;Cinco&#x27;</span>, <span class="string">&#x27;Seis&#x27;</span>]</span><br><span class="line">  each item <span class="keyword">in</span> list</span><br><span class="line">    li= item</span><br><span class="line"></span><br><span class="line">=&gt;</span><br><span class="line"></span><br><span class="line">  &lt;li&gt;Uno&lt;/li&gt;</span><br><span class="line">  &lt;li&gt;Dos&lt;/li&gt;</span><br><span class="line">  &lt;li&gt;Tres&lt;/li&gt;</span><br><span class="line">  &lt;li&gt;Cuatro&lt;/li&gt;</span><br><span class="line">  &lt;li&gt;Cinco&lt;/li&gt;</span><br><span class="line">  &lt;li&gt;Seis&lt;/li&gt;</span><br></pre></td></tr></table></figure><h4 id="Buffered-Code"><a href="#Buffered-Code" class="headerlink" title="Buffered Code"></a>Buffered Code</h4><p>Buffered code start with <code>=</code>. It evaluates the JavaScript expression and outputs the result. For security, buffered code is first HTML excaped.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">p = <span class="string">&#x27;This code is &lt;escaped&gt;!&#x27;</span></span><br><span class="line"></span><br><span class="line">=&gt; <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>This code is <span class="symbol">&amp;lt;</span>escaped<span class="symbol">&amp;gt;</span>!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>it can also be written inline with attributes, and supports the full range of JavaScript expression:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p= <span class="string">&#x27;This code is&#x27;</span> + <span class="string">&#x27; &lt;escaped&gt;!&#x27;</span> =&gt; <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>This code is <span class="symbol">&amp;gt;</span>escaped<span class="symbol">&amp;gt;</span>!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h4 id="Unescaped-Buffered-Code"><a href="#Unescaped-Buffered-Code" class="headerlink" title="Unescaped Buffered Code"></a>Unescaped Buffered Code</h4><p>Unescaped buffered code starts with <code>!=</code>. It evaluates the JavaScript expression and outputs the result. Unescaped buffered code does not perform any escaping, so is unsafe for user input.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p != <span class="string">&#x27;This code is &lt;strong&gt;not&lt;/strong&gt; escaped!&#x27;</span> =&gt; <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>This code is <span class="tag">&lt;<span class="name">strong</span>&gt;</span>not<span class="tag">&lt;/<span class="name">strong</span>&gt;</span> escaped!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="Comments"><a href="#Comments" class="headerlink" title="Comments"></a>Comments</h3><p>Buffered comments look the same as single-line JavaScript comments. They act sort of like markup tags, producing <em>HTML</em> comments in the rendered page.</p><p>Like tags, buffered comments must appear on their own line:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// just some paragraphs</span></span><br><span class="line">p foo</span><br><span class="line">p bar</span><br><span class="line"></span><br><span class="line">=&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- just some paragraph --&gt;</span><br><span class="line">&lt;p&gt;foo&lt;/p&gt;</span><br><span class="line">&lt;p&gt;bar&lt;/p&gt;</span><br></pre></td></tr></table></figure><p>Pug also supports unbuffered comments, Simply ass a hyphen(<code>-</code>) to the start of the comment.</p><p>These are only for commenting on the Pug code itself, and <em>do not</em> appear in the rendered HTML.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//- will not output within markup</span></span><br><span class="line">p foo</span><br><span class="line"></span><br><span class="line">=&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;foo&lt;/p&gt;</span><br></pre></td></tr></table></figure><h4 id="Block-Comments"><a href="#Block-Comments" class="headerlink" title="Block Comments"></a>Block Comments</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">body</span><br><span class="line"><span class="comment">//- Comments for your templates writers.</span></span><br><span class="line">    Use <span class="keyword">as</span> much text <span class="keyword">as</span> you want</span><br><span class="line"><span class="comment">// Comments for your HTML readers</span></span><br><span class="line">    Use <span class="keyword">as</span> much text <span class="keyword">as</span> you want</span><br></pre></td></tr></table></figure><h3 id="Conditionals"><a href="#Conditionals" class="headerlink" title="Conditionals"></a>Conditionals</h3><p>Pug’s first-class conditional syntax allows for optional parenthese.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- <span class="keyword">var</span> user = &#123; <span class="attr">description</span>: <span class="string">&#x27;foo bar baz &#x27;</span>&#125;</span><br><span class="line">- <span class="keyword">var</span> authorized = <span class="literal">false</span></span><br><span class="line">#user</span><br><span class="line">  <span class="keyword">if</span> user.description</span><br><span class="line">    h2.green Description</span><br><span class="line">    p.description= user.description</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> authorized</span><br><span class="line">    h2.blue Description</span><br><span class="line">    p.description.</span><br><span class="line">      User has no description</span><br><span class="line">      why not add one...</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    h2.red Description</span><br><span class="line">    p.description User has no description</span><br></pre></td></tr></table></figure><p>Pug also provides the conditional <code>unless</code> which works like a negated <code>if</code>. The following are equivalent:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">unless user.isAnonymous</span><br><span class="line">  p You<span class="string">&#x27;re logged in as #&#123;user.name&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">=</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">if !user.isAnonymous</span></span><br><span class="line">  p You&#x27;re logged in as #&#123;user.name&#125;</span><br></pre></td></tr></table></figure><h3 id="Filters"><a href="#Filters" class="headerlink" title="Filters"></a>Filters</h3><h3 id="Include"><a href="#Include" class="headerlink" title="Include"></a>Include</h3><p>Include allow you to insert the contents of one Pug file into another.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.pug</span></span><br><span class="line">doctype html</span><br><span class="line">html</span><br><span class="line">  include includes/head.pug</span><br><span class="line">  body</span><br><span class="line">    h1 My Site</span><br><span class="line">    p Welcome to my <span class="built_in">super</span> lame site</span><br><span class="line">    include includes/foot.pug</span><br><span class="line"></span><br><span class="line"><span class="comment">// includes/head.pug</span></span><br><span class="line">head</span><br><span class="line">  title My Site</span><br><span class="line">  script(src=<span class="string">&#x27;/javascripts/jquery.js&#x27;</span>)</span><br><span class="line">  script(src=<span class="string">&#x27;/javascripts/app.js&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// includes/foot.pug</span></span><br><span class="line">footer#footer</span><br><span class="line">  p Copyright (c) foobar</span><br></pre></td></tr></table></figure><p>If the path is absolute(e.g. <code>include /root.pug</code>), it is resolved by prepending <code>options.basedir</code>.</p><p>If no file extension is given, <code>.pug</code> is automatically appended to the file name.</p><h4 id="Including-Plain-Text"><a href="#Including-Plain-Text" class="headerlink" title="Including Plain Text"></a>Including Plain Text</h4><p>Including non-Pug files simply includes their raw text.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.pug</span></span><br><span class="line">doctype html</span><br><span class="line">html</span><br><span class="line">  head</span><br><span class="line">    style</span><br><span class="line">      include style.css</span><br><span class="line">    body</span><br><span class="line">      h1 My Site</span><br><span class="line">      p Welcome to my <span class="built_in">super</span> lame site</span><br><span class="line">      script</span><br><span class="line">        include script.js</span><br><span class="line"><span class="comment">// style.css</span></span><br><span class="line">h1 &#123;</span><br><span class="line">  color: red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// script.js</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;Yor are awesome&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="Template-Inheritance"><a href="#Template-Inheritance" class="headerlink" title="Template Inheritance"></a>Template Inheritance</h3><p>Pug supports template inheritance. Template instance works via <code>block</code> and <code>extends</code> keyword.</p><p>In a template, a <code>block</code> is simply a ‘block’ of Pug that a child template may replace. This process is recursive.</p><p>Pug blocks can provide default content, if appropriate. Providing default content is purely optional, though. The example below defines <code>block scripts</code>, <code>block content</code> and <code>block foot</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// layout.pug</span></span><br><span class="line">html</span><br><span class="line">  head</span><br><span class="line">    title My Site - #&#123;title&#125;</span><br><span class="line">    block scripts</span><br><span class="line">      script(src=<span class="string">&#x27;/jquery.js&#x27;</span>)</span><br><span class="line">  body</span><br><span class="line">    block content</span><br><span class="line">    block foot</span><br><span class="line">      #footer</span><br><span class="line">        p some footer content</span><br></pre></td></tr></table></figure><p>To extend this layout, create a new file and use the <code>extends</code> directive with a path to the parent template(if no file extension is given, <code>.pug</code> is automatically appended to the file name). Then define one or more blocks to override the parent block content.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// page-a.pug</span></span><br><span class="line"><span class="keyword">extends</span> layout.pug</span><br><span class="line"></span><br><span class="line">block scripts</span><br><span class="line">  script(src=<span class="string">&quot;/jquery.js&quot;</span>)</span><br><span class="line">  script(src=<span class="string">&quot;/pets.js&quot;</span>)</span><br><span class="line"></span><br><span class="line">block content</span><br><span class="line">  h1= title</span><br><span class="line">  - <span class="keyword">var</span> pets = [<span class="string">&#x27;cat&#x27;</span>, <span class="string">&#x27;dog&#x27;</span>]</span><br><span class="line">  each petName <span class="keyword">in</span> pets</span><br><span class="line">    include pet.pug</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pet.pug</span></span><br><span class="line">p= petName</span><br></pre></td></tr></table></figure><h3 id="Block-append-prepend"><a href="#Block-append-prepend" class="headerlink" title="Block append/prepend"></a>Block append/prepend</h3><p>Pug allows you to <code>replace</code>, <code>prepend</code> and <code>append</code> blocks</p><p>Suppose you have default scripts in a <code>head</code> block that you wish to use on <em>every page</em> you might do this:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// layout.pug</span></span><br><span class="line">html</span><br><span class="line">  head</span><br><span class="line">   block head</span><br><span class="line">    script(src=<span class="string">&quot;/vendor/jquery.js&quot;</span>)</span><br><span class="line">    script(src=<span class="string">&quot;/vendor/caustic.js&quot;</span>)</span><br><span class="line">  body</span><br><span class="line">    block content</span><br><span class="line"></span><br><span class="line"><span class="comment">// page.pug</span></span><br><span class="line"><span class="keyword">extends</span> layout</span><br><span class="line"></span><br><span class="line">append head</span><br><span class="line">  script(src=<span class="string">&quot;/vendor/three.js&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="Interpolation"><a href="#Interpolation" class="headerlink" title="Interpolation"></a>Interpolation</h3><h4 id="String-Interpolation-Escaped"><a href="#String-Interpolation-Escaped" class="headerlink" title="String Interpolation, Escaped"></a>String Interpolation, Escaped</h4><p>Consider the placement of the following tempalte’s locals: <code>title</code>, <code>author</code> and <code>theGreat</code></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- <span class="keyword">var</span> title = <span class="string">&#x27;On Dogs&#x27;</span></span><br><span class="line">- <span class="keyword">var</span> author = <span class="string">&#x27;enlore&#x27;</span></span><br><span class="line">- <span class="keyword">var</span> theGreat = <span class="string">&#x27;&lt;span&gt;escaped!&lt;/span&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line">h1= title</span><br><span class="line">p Written by #&#123;author&#125;</span><br><span class="line">p This will be safe: #&#123;theGreat&#125;</span><br></pre></td></tr></table></figure><p>This can be valid JavaScript expression, so you can do whatever feels good.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- <span class="keyword">var</span> msg = <span class="string">&#x27;not my inside voice&#x27;</span></span><br><span class="line">p This is $&#123;msg.toUpperCase()&#125;</span><br></pre></td></tr></table></figure><h3 id="String-Interpolation-Unescaped"><a href="#String-Interpolation-Unescaped" class="headerlink" title="String Interpolation, Unescaped"></a>String Interpolation, Unescaped</h3><p>You don’t have to play it safe, you can buffer unescaped values into your templates too</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- <span class="keyword">var</span> riskyBusiness = <span class="string">&#x27;&lt;em&gt;Some of the girts&lt;/em&gt;&#x27;</span></span><br><span class="line">.quote</span><br><span class="line">  p joel: !&#123;riskyBusiness&#125;</span><br></pre></td></tr></table></figure><blockquote><p>Keep in mind that buffering unescaped content into your templates can be mighty risky if that content comes fresh from your users.</p></blockquote><h4 id="Tag-Interpolation"><a href="#Tag-Interpolation" class="headerlink" title="Tag Interpolation"></a>Tag Interpolation</h4><p>Interpolation works not only on JavaScript values, but on Pug as well, just use the tag interpolation syntax like so:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p.</span><br><span class="line">  Interpolate #[strong strongly word] there</span><br></pre></td></tr></table></figure><h4 id="Whitespace-Control"><a href="#Whitespace-Control" class="headerlink" title="Whitespace Control"></a>Whitespace Control</h4><p>The tag interpolation syntax is especially useful for inline tags, where whitespace before and after the tag is significant.</p><p>By default, however, Pug removes all spaces before and after tags.</p><h3 id="Iteration"><a href="#Iteration" class="headerlink" title="Iteration"></a>Iteration</h3><p>Pug supports two primary methods of iteration: <code>each</code> and <code>while</code></p><h4 id="each"><a href="#each" class="headerlink" title="each"></a>each</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">ul</span><br><span class="line">  each val, index <span class="keyword">in</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line">    li=  index + <span class="string">&#x27;: &#x27;</span> + val</span><br><span class="line"></span><br><span class="line">ul</span><br><span class="line">  each val, index <span class="keyword">in</span> &#123;<span class="number">1</span>: <span class="string">&#x27;one&#x27;</span>, <span class="number">2</span>: <span class="string">&#x27;two&#x27;</span>&#125;</span><br><span class="line">    li= index + <span class="string">&#x27;: &#x27;</span> + val</span><br><span class="line"></span><br><span class="line">- <span class="keyword">var</span> values = []</span><br><span class="line">ul</span><br><span class="line">  each val <span class="keyword">in</span> values.length ? values : [<span class="string">&#x27;There is no value&#x27;</span>]</span><br><span class="line">    li= val</span><br><span class="line"></span><br><span class="line">ul</span><br><span class="line">  each val <span class="keyword">in</span> values</span><br><span class="line">    li= val</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    li There is no value</span><br></pre></td></tr></table></figure><h4 id="While"><a href="#While" class="headerlink" title="While"></a>While</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- <span class="keyword">var</span> n = <span class="number">0</span></span><br><span class="line">ul</span><br><span class="line">  <span class="keyword">while</span> n &lt; <span class="number">4</span></span><br><span class="line">    li= n++</span><br></pre></td></tr></table></figure><h3 id="Mixins"><a href="#Mixins" class="headerlink" title="Mixins"></a>Mixins</h3><p>Mixins allow you to create reusable blocks of Pug</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Declaration</span></span><br><span class="line">mixin list</span><br><span class="line">  ul</span><br><span class="line">    li foo</span><br><span class="line">    li bar</span><br><span class="line">    li baz</span><br><span class="line"></span><br><span class="line"><span class="comment">// Use</span></span><br><span class="line">+list</span><br><span class="line">+list</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mixin pet(name)</span><br><span class="line">  li.pet= name</span><br><span class="line"></span><br><span class="line">ul</span><br><span class="line">  +pet(<span class="string">&#x27;cat&#x27;</span>)</span><br><span class="line">  +pet(<span class="string">&#x27;dog&#x27;</span>)</span><br><span class="line"></span><br><span class="line">=&gt;</span><br><span class="line">&lt;ul&gt;</span><br><span class="line">  &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pet&quot;</span>&gt;cat&lt;/li&gt;</span><br><span class="line">  &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pet&quot;</span>&gt;dog&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure><h4 id="Mixin-Attributes"><a href="#Mixin-Attributes" class="headerlink" title="Mixin Attributes"></a>Mixin Attributes</h4><p>Mixins also get an implicit <code>attributes</code> argument, which is taken from the attributes passed to the mixin</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mixin link(href, name)</span><br><span class="line">  a(<span class="class"><span class="keyword">class</span>!</span>=attributes.class href=href)= name</span><br><span class="line"></span><br><span class="line">+link(<span class="string">&#x27;/foo&#x27;</span>, <span class="string">&#x27;foo&#x27;</span>)(<span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;btn&quot;</span>)</span><br><span class="line">=&gt;</span><br><span class="line">&lt;a <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;btn&quot;</span> href=<span class="string">&quot;foo&quot;</span>&gt;foo&lt;/a&gt;</span><br></pre></td></tr></table></figure><blockquote><p>Note: The values in <code>attributes</code> by default are already escaped, you should use <code>!=</code> to avoid escaping them a secondtime.</p></blockquote><h4 id="Rest-Arguments"><a href="#Rest-Arguments" class="headerlink" title="Rest Arguments"></a>Rest Arguments</h4><p>You can write mixins that takes an unknown number of arguments using the <code>rest arguments</code> syntax</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mixin list(id, ...items)</span><br><span class="line">  ul(id=id)</span><br><span class="line">    each item <span class="keyword">in</span> items</span><br><span class="line">      li= item</span><br><span class="line"></span><br><span class="line">+list(<span class="string">&#x27;my-list&#x27;</span>, <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)</span><br></pre></td></tr></table></figure><h3 id="Plain-Text"><a href="#Plain-Text" class="headerlink" title="Plain Text"></a>Plain Text</h3><p>Pug provides four ways of getting <em>plain text</em></p><h4 id="Inline-in-a-Tag"><a href="#Inline-in-a-Tag" class="headerlink" title="Inline in a Tag"></a>Inline in a Tag</h4><p>The easiest way to add plain text is <em>inline</em>. The first term on the line is the tag itsel. Everything after the tag and one space will be the text content of that tag.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p This is plain old &lt;em&gt;text&lt;/em&gt; content.</span><br></pre></td></tr></table></figure><h4 id="Literal-HTML"><a href="#Literal-HTML" class="headerlink" title="Literal HTML"></a>Literal HTML</h4><p>Whole lines are also treated as plain text when they begin with a left angle bracket (&lt;), which may occasionally be useful for writing literal HTML tags in places that could otherwise be inconvenient.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">body</span><br><span class="line">  p Indenting the body tag there will make no difference</span><br><span class="line">  p HTML itself isn not whitespace-sensitive</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><h4 id="Piped-Text"><a href="#Piped-Text" class="headerlink" title="Piped Text"></a>Piped Text</h4><p>Another way to add plain text to templates is to prefix a line with a pipe character (<code>|</code>). This method is useful for mixing plain text with inline tag.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">p</span><br><span class="line">  | The pipe always goes at the beginning <span class="keyword">of</span> its own line,</span><br><span class="line">  | not counting indentation.</span><br><span class="line">=&gt;</span><br><span class="line">&lt;p&gt;The pipe always goes at the beginning <span class="keyword">of</span> its own line, not counting indentation.&lt;/p&gt;</span><br></pre></td></tr></table></figure><h4 id="Block-in-a-Tag"><a href="#Block-in-a-Tag" class="headerlink" title="Block in a Tag"></a>Block in a Tag</h4><p>Often you might want large blocks of text wihtin a tag. To do this, just add a <code>.</code> right after the tag name, or after the closing parenthesis, if the tag has attributes.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">script.</span><br><span class="line">  <span class="keyword">if</span> (usingPug)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;You are awesome&#x27;</span>)</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;use pug&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="Tags"><a href="#Tags" class="headerlink" title="Tags"></a>Tags</h3><p>By default, text at the start of a line (or after only white space) represents an HTML tag. Indented tags are nested.</p><p>To save space, Pug provides an inline syntax for nested tags.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a: <span class="function"><span class="params">img</span> =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> /&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>self-closing tag</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">foo/ =&gt; <span class="xml"><span class="tag">&lt;<span class="name">foo</span> /&gt;</span></span></span><br><span class="line">foo(bar=<span class="string">&#x27;baz&#x27;</span>)/ =&gt; <span class="xml"><span class="tag">&lt;<span class="name">foo</span> <span class="attr">bar</span>=<span class="string">&quot;baz&quot;</span> /&gt;</span></span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Pug </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mix-Blend-Mode</title>
      <link href="/2017/08/28/mix-blend-mode/"/>
      <url>/2017/08/28/mix-blend-mode/</url>
      
        <content type="html"><![CDATA[<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  mix-blend-mode: normal;</span><br><span class="line">  mix-blend-mode: multiply;</span><br><span class="line">  mix-blend-mode: screen;</span><br><span class="line">  mix-blend-mode: overlay;</span><br><span class="line">  mix-blend-mode: darken;</span><br><span class="line">  mix-blend-mode: lighten;</span><br><span class="line">  mix-blend-mode: color-dodge;</span><br><span class="line">  mix-blend-mode: color-burn;</span><br><span class="line">  mix-blend-mode: soft-light;</span><br><span class="line">  mix-blend-mode: hard-light;</span><br><span class="line">  mix-blend-mode: difference;</span><br><span class="line">  mix-blend-mode: exclusion;</span><br><span class="line">  mix-blend-mode: hue;</span><br><span class="line">  mix-blend-mode: saturation;</span><br><span class="line">  mix-blend-mode: color;</span><br><span class="line">  mix-blend-mode: luminosity;</span><br><span class="line">  mix-blend-mode: initial;</span><br><span class="line">  mix-blend-mode: inherit;</span><br><span class="line">  mix-blend-mode: unset;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="http://images2015.cnblogs.com/blog/608782/201705/608782-20170509102239519-1109457397.png"></p><h3 id="mix-blend-mode-screen"><a href="#mix-blend-mode-screen" class="headerlink" title="mix-blend-mode: screen"></a>mix-blend-mode: screen</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pug</span></span><br><span class="line">.container</span><br><span class="line">  - <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="number">3</span>; i++)</span><br><span class="line">    .box</span><br></pre></td></tr></table></figure><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$count</span>: <span class="number">3</span>;</span><br><span class="line"><span class="variable">$bgcolorlist</span>: <span class="number">#0801fb</span> <span class="number">#1ffe27</span> <span class="number">#fd1a20</span>;</span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#291f34</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">50%</span>;</span><br><span class="line">  trasnform: translate(-<span class="number">50%</span>, -<span class="number">50%</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">transform-origin</span>: <span class="number">48%</span> <span class="number">48%</span>;</span><br><span class="line">  mix-blend-mode: screen;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@for</span> <span class="variable">$i</span> from <span class="number">1</span> through <span class="variable">$count</span> &#123;</span><br><span class="line">  <span class="selector-class">.box</span><span class="selector-pseudo">:nth-child</span>(#&#123;<span class="variable">$i</span>&#125;) &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: nth($不过colorlist, $i);</span><br><span class="line">    <span class="attribute">animation</span>: turn <span class="number">3s</span> linear #&#123;<span class="number">1</span>-<span class="variable">$i</span>&#125;s infinite;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@keyframes</span> turn &#123;</span><br><span class="line">  to &#123;</span><br><span class="line">    <span class="attribute">transform</span>: rotate(<span class="number">360deg</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Start at Headless</title>
      <link href="/2017/08/27/Start-at-Headless/"/>
      <url>/2017/08/27/Start-at-Headless/</url>
      
        <content type="html"><![CDATA[<p>Run Chrome without chrome, it brings all modern web platform features provided by Chromium and the Blink rendering engine to the command line.</p><p>A headless browser is a great tool for automated testing and server environments where you don’t need a visible UI shell.</p><h3 id="Starting-Headless-CLI"><a href="#Starting-Headless-CLI" class="headerlink" title="Starting Headless (CLI)"></a>Starting Headless (CLI)</h3><p>The easiest way to get started with headless mode is to open the Chrome binary from the command line. If you’ve got Chrome 59+ installed, start Chrome with the <code>-- headless</code> flag:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">chrome \</span><br><span class="line">  --headless \  <span class="comment"># Runs Chrome in headless mode</span></span><br><span class="line">  --<span class="built_in">disable</span>-gpu \ <span class="comment"># Temporarily needed for now</span></span><br><span class="line">  --remote-debugging-port=9222 \</span><br><span class="line">  https://www.chromestatus.com <span class="comment"># URL to open. Defaults to about:blank</span></span><br></pre></td></tr></table></figure><p><code>chrome</code> should point to your installation of Chrome.</p><h3 id="Command-line-features"><a href="#Command-line-features" class="headerlink" title="Command line features"></a>Command line features</h3><p>In some cases, you may not need to programmatically script Headless Chrome. There are some useful command line flags to perform common tasks.</p><h4 id="Printing-the-DOM"><a href="#Printing-the-DOM" class="headerlink" title="Printing the DOM"></a>Printing the DOM</h4><p>The <code>--dump-dom</code> flag prints <code>document.body.innerHTML</code> to stdout:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chrome --headless --<span class="built_in">disable</span>-gpu --dump-dom https://www.chromestatus.com/</span><br></pre></td></tr></table></figure><h4 id="Create-a-PDF"><a href="#Create-a-PDF" class="headerlink" title="Create a PDF"></a>Create a PDF</h4><p>The <code>--print-to-pdf</code> flag creates a PDF of the page</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chrome --headless --<span class="built_in">disable</span>-gpu --<span class="built_in">print</span>-to-pdf https://chromestatus.com/</span><br></pre></td></tr></table></figure><h4 id="Taking-screenshots"><a href="#Taking-screenshots" class="headerlink" title="Taking screenshots"></a>Taking screenshots</h4><p>To capture a screenshot of a page, use the <code>--screenshot</code> flag:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">chrome --headless --<span class="built_in">disable</span>-gpu --screenshot https://chromestatus.com/</span><br><span class="line"></span><br><span class="line"><span class="comment"># Size of a standard letterhead.</span></span><br><span class="line">chrome --headless -<span class="built_in">disable</span>-gpu --screenshot --window-size=1280,1696 https://chromestatus.com/</span><br></pre></td></tr></table></figure><h3 id="REPL-mode"><a href="#REPL-mode" class="headerlink" title="REPL mode"></a>REPL mode</h3><p>The <code>--repl</code> flag runs Headless in a mode where you can evaluate JS expression in the browser, right from the command line:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">chrome --headless --<span class="built_in">disable</span>-gpu --repl https://chromestatus.com/</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; location.href</span><br><span class="line">&#123;<span class="string">&quot;result&quot;</span>:&#123;<span class="string">&quot;type&quot;</span>:<span class="string">&quot;string&quot;</span>,<span class="string">&quot;value&quot;</span>:<span class="string">&quot;https://www.chromestatus.com/features&quot;</span>&#125;&#125;</span><br><span class="line">&gt;&gt;&gt; quit</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Chrome </tag>
            
            <tag> Headless </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Node.js Child_process</title>
      <link href="/2017/08/24/Node-js-child-process/"/>
      <url>/2017/08/24/Node-js-child-process/</url>
      
        <content type="html"><![CDATA[<p>Node.js runs in single-threaded, event-driven mode, which is good for improving performance via multiple child process.</p><p>Each child process has three stream objects:</p><ul><li><p><code>child.stdin</code></p></li><li><p><code>child.stdout</code></p></li><li><p><code>child.stderr</code></p></li></ul><p>All these three stream objects may share their parent’s <code>stdio</code>, or set to use their own stream object independently.</p><p>Node.js offers <code>child_process</code> module to create new child process:</p><ul><li><p><code>exec</code> – <code>child_process.exec</code> use child process to execute shell command, and buffer the output for callback. This means the <code>exec</code> will buffer the whole returned value in buffer, usually you should limit the buffer in 200k, if not, the process will exit with <code>Error: maxBuffer exceeded</code>.</p></li><li><p><code>spawn</code> – <code>child_process.spawn</code> use command line to create new process. spawn will return a <strong>stream object</strong> with <code>stdout</code> and <code>stderr</code>. We can use <code>stdout</code> stream to read the data returned from child process. <code>stdout</code> has event handles like <code>data</code>, <code>end</code>. You can use <code>spawn</code> when a large data will returned from child process.</p></li><li><p><code>fork</code> – <code>child_process.fork</code> is the <code>spawn</code> in special mode(specify <code>node</code> to run the command). <code>fork(&#39;./son.js&#39;)</code> equals to <code>spawn(&#39;node&#39;, [&#39;./son.js&#39;])</code>. Different from <code>spawn</code>, <code>fork</code> will build a message pipe between main and child process.</p></li></ul><h3 id="exec"><a href="#exec" class="headerlink" title="exec"></a>exec</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> exec = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).exec</span><br><span class="line">exec(<span class="string">&#x27;dir&#x27;</span>, &#123;<span class="attr">encoding</span>: <span class="string">&#x27;utf-u&#x27;</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, stdout, stderr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err.stack)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Error Code: &#x27;</span> + err.code)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Signal Received: &#x27;</span> + err.signal)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;data: &#x27;</span> + stdout)</span><br><span class="line">&#125;).on(<span class="string">&#x27;exit&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">code</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;child process exit with code: &#x27;</span> + code)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="spawn"><a href="#spawn" class="headerlink" title="spawn"></a>spawn</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> spawn = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).spawn</span><br><span class="line"><span class="keyword">const</span> spawnedProcess = spawn(<span class="string">&#x27;ping&#x27;</span>, [<span class="string">&#x27;127.0.0.1&#x27;</span>], &#123; <span class="attr">encoding</span>: <span class="string">&#x27;utf-8&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line">spawnedProcess.stdout.on(<span class="string">&#x27;data&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(chunk.toString())</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">spawnedProcess.stderr.on(<span class="string">&#x27;data&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">spawnedProcess.on(<span class="string">&#x27;close&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">code</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;close code: &#x27;</span> + code)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">spawnedProcess.on(<span class="string">&#x27;exit&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">code</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;exit code: &#x27;</span> + code)</span><br><span class="line">  fs.close(fd, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="built_in">console</span>.error(err)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="fork"><a href="#fork" class="headerlink" title="fork"></a>fork</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// parent.js</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;parent pid: &#x27;</span> + process.pid)</span><br><span class="line"><span class="keyword">const</span> fork = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).fork</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> child = fork(<span class="string">&#x27;./child.js&#x27;</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;fork return pid: &#x27;</span> + child.pid)</span><br><span class="line">child.on(<span class="string">&#x27;message&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">msg</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;parent recieve message: &#x27;</span> + <span class="built_in">JSON</span>.stringify(msg))</span><br><span class="line">&#125;)</span><br><span class="line">child.send(&#123;</span><br><span class="line">  key: <span class="string">&#x27;parent value&#x27;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// child.js</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;child pid: &#x27;</span> + process.pid)</span><br><span class="line">process.on(<span class="string">&#x27;message&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">msg</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;child recieve message: &#x27;</span> + msg)</span><br><span class="line">&#125;)</span><br><span class="line">process.send(&#123;</span><br><span class="line">  key: <span class="string">&#x27;child value&#x27;</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Node Child Process</title>
      <link href="/2017/08/22/Node-Child-Process/"/>
      <url>/2017/08/22/Node-Child-Process/</url>
      
        <content type="html"><![CDATA[<p><img src="https://cdn-images-1.medium.com/max/2000/1*I56pPhzO1VQw8SIsv8wYNA.png"></p><p>Single-threaded, non-blocking performance in Node works great for a single process. But eventually, one process in one CPU is not going to be enough to handle the increasing workload of your application.</p><p>Using multiple processes is the best way to scale a Node application. Node is designed for building distributed applications with many nodes.</p><h3 id="The-Child-Process-Module"><a href="#The-Child-Process-Module" class="headerlink" title="The Child Process Module"></a>The Child Process Module</h3><p>We can easily spin a child process using Node’s <code>child_process</code> module and those child processes can easily communicate with each other with a messaging system.</p><p>The <code>child_process</code> module enables us to access Operating System functionalities by running any system command inside child process.</p><p>We can control that child process input stream, and listen to its output stream. We can also control the arguments to be passed to the underlying OS command, and we can do whatever we want with that command’s output.</p><p>There are four different ways to create a child process in Node: <code>spawn()</code>, <code>fork()</code>, <code>exec()</code>, <code>execFile()</code>.</p><h3 id="Spawned-Child-Process"><a href="#Spawned-Child-Process" class="headerlink" title="Spawned Child Process"></a>Spawned Child Process</h3><p>The <code>spawn</code> function launches a command in a new process and we can use it to pass that command any arguments. For example, here’s code to spawn a new process that will execute the <code>pwd</code> command.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; spawn &#125; = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> child = spawn(<span class="string">&#x27;pwd&#x27;</span>)</span><br></pre></td></tr></table></figure><p>We simply destructure the <code>spawn</code> function out of the <code>child_process</code> module and execute it with the OS command as the first argument.</p><p>The result of executing the <code>spawn</code> function (the <code>child</code> object above) is a <code>ChildProcess</code> instance, which implements the <code>EventEmitter API</code>. This means we can register handlers for events on this child object directly. For example, we can do something when the child process exits by registering a handler for the <code>exit</code> event.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">child.on(<span class="string">&#x27;exit&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">code, signal</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;child process exited with &#x27;</span> + <span class="string">`code <span class="subst">$&#123;code&#125;</span> and signal <span class="subst">$&#123;signal&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>The handler above gives us the exit <code>code</code> for the child process and the <code>signal</code>, if any, that was used to terminate the child process. This <code>signal</code> variable is null when the child process exits normally.</p><p>The other events that we can register handlers for with the <code>ChildProcess</code> instances are <code>disconnect</code>, <code>error</code>, <code>close</code>, <code>message</code>.</p><ul><li><p>The <code>disconnect</code> event is emitted when the parent process manually calls the <code>child.disconnect</code> function.</p></li><li><p>The <code>error</code> event is emitted if the process could not be spawned or killed.</p></li><li><p>The <code>close</code> event is emitted when the <code>stdio</code> streams of a child process get closed.</p></li><li><p>The <code>message</code> event is the most important one. It’s emitted when the child process uses the <code>process.send()</code> function to send messages. This is how parent/child processes can communicate with each other.</p></li></ul><p>Every child process also gets the three standard <code>stdio</code> streams, which we can access using <code>child.stdin</code>, <code>child.stdout</code>, <code>child.stderr</code>.</p><p>When those streams get closed, the child process that was using them will emit the <code>close</code> event. This <code>close</code> event is different than the <code>exit</code> event because multiple child processes might share the same <code>stdio</code> streams and so one child process exiting does not mean that the streams got closed.</p><p>Since all streams are event emitters, we can listen to different events on those <code>stdio</code> stream that are attached to every child process. Unlike in a normal process though, in a child process, the <code>stdout</code>/<code>stderr</code> streams are readable streams while the <code>stdin</code> stream is a writable one. This is basically the inverse of those types as found in a main process. The events we can use for those streams are the standard ones. Most importantly, on the readable streams, we can listen to the <code>data</code> event, which will have the output of the command or any errorencoutered while executing the command:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">child.stdout.on(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`child stdout:\n<span class="subst">$&#123;data&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">child.stderr.on(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.error(<span class="string">`child \n<span class="subst">$&#123;data&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>The two handlers above will log both cases to the main process <code>stdout</code> and <code>stderr</code>. When we execute the <code>spawn</code> function above, the output of the <code>pwd</code> command gets printed and the child process exits with code <code>0</code>, which means no error occured.</p><p>We can pass arguments to the command that’s executed by the <code>spawn</code> function using the second argument of the <code>spawn</code> function, which is an array of all the arguments to be passed to the command.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> child = spawn(<span class="string">&#x27;find&#x27;</span>, [<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;-type&#x27;</span>, <span class="string">&#x27;f&#x27;</span>])</span><br></pre></td></tr></table></figure><p>If an error occurs during the execution of the command, for example, if we give find an invalid destination above, the <code>child.stderr</code> <code>data</code> event handler will be triggered and the <code>exit</code> event handler will report an exit code of <code>1</code>, which signifies that an error has occured.</p><p>A child process <code>stdin</code> is a writable stream. We can use it to send a command some input. Just like any writable stream, the easiest way to consume it is using the <code>pipe</code> function. We simply pipe a readable stream into a writable stream. SInce the main process <code>stdin</code> is a readable stream, we can pipe that into a child process <code>stdin</code> stream.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; spawn &#125; = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> child = spawn(<span class="string">&#x27;wc&#x27;</span>)</span><br><span class="line"></span><br><span class="line">process.stdin.pipe(child.stdin)</span><br><span class="line"></span><br><span class="line">child.stdout.on(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`child stdout:\n<span class="subst">$&#123;data&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>In the example above, the child process invokes the <code>wc</code> command, which count lines, words, and characters in Linux. When we pipe the main process <code>stdin</code>(which is a readable stream) into the child process <code>stdin</code>(which is a writable stream). The result of this combination is that we get a standard input mode where we can type somthing and when we hit <code>Ctrl + D</code>, what we typed will be used as the input of the <code>wc</code> command.</p><p>We can also pipe the standard input/output of multiple processes on each other, just like we can do with Linux commands. For example, we can pipe the <code>stdout</code> of the <code>find</code> command to the <code>stdin</code> of the <code>wc</code> command to count all the files in the current directory:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; spawn &#125; = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> find = spawn(<span class="string">&#x27;find&#x27;</span>, [<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;-type&#x27;</span>, <span class="string">&#x27;f&#x27;</span>])</span><br><span class="line"><span class="keyword">const</span> wc = spawn(<span class="string">&#x27;wc&#x27;</span>, [<span class="string">&#x27;-l&#x27;</span>])</span><br><span class="line"></span><br><span class="line">find.stdout.pipe(wc.stdin)</span><br><span class="line"></span><br><span class="line">wc.stdout.on(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Number of files <span class="subst">$&#123;data&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Add <code>-l</code> to the <code>wc</code> command to make it count only the lines.</p><h3 id="Shell-Syntax-and-the-exec-Function"><a href="#Shell-Syntax-and-the-exec-Function" class="headerlink" title="Shell Syntax and the exec Function"></a>Shell Syntax and the exec Function</h3><p>By default, the <code>spawn</code> function does not create a <em>shell</em> to execute the command we pass into it. This makes it slightly more efficient than the <code>exec</code> function, which does create a shell. The <code>exec</code> function has one other major difference. It <em>buffers</em> the command’s generated output and passes the whole output value to a callback function(instead of using streams, which is what <code>spawn</code> does).</p><p>Here the is previous <code>find | wc</code> example implemented with an <code>exec</code> function.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; exec &#125; = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>)</span><br><span class="line"></span><br><span class="line">exec(<span class="string">&#x27;find . -type  f | wc -l&#x27;</span>, <span class="function">(<span class="params">err, stdout, stderr</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(<span class="string">`exec error: <span class="subst">$&#123;err&#125;</span>`</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Number of files <span class="subst">$&#123;stdout&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Since the <code>exec</code> function uses a shell to execute the command, we can use the <code>shell syntax</code> directly here making use of the <code>shell pipe</code> feature.</p><p>Note that using the shell syntax comes at a <code>security risk</code> if you’re executing any kind of dynamic input provided externally. A user can simply do a command injection attrack using shell syntax characters like ; and $(For example, <code>commnd + &#39;; rm -rf ~&#39;</code>)</p><p>The <code>exec</code> function buffers the output and passes it to the callback function(the second argument to <code>exec</code>) as the <code>stdout</code> argument there. This <code>stdout</code> argument is the command’s output that we want to print out.</p><p>The <code>exec</code> function is a good choice if you need to use the shell syntax and if the size of the data expected from te command is small(Remember <code>exec</code> will buffer the whole data in memory before returning it).</p><p>The <code>spawn</code> function is a much better choice when the size of the data expected from the command is large, because that data will be streamed with the standard IO objects.</p><p>We can make the spawned child process inherit the standard IO object of its parents if we want to, but also, more importantly, we can ke the <code>spawn</code> function use the shell syntax as well. Here’s the smae <code>find | wc</code> command implemented with the <code>spawn</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> child = spawn(<span class="string">&#x27;find . -type f&#x27;</span>, &#123;</span><br><span class="line">  stdio: <span class="string">&#x27;inherit&#x27;</span>,</span><br><span class="line">  shell: <span class="literal">true</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Because of the <code>stdio: &#39;inherit&#39;</code> option above, when we execute the code, the child process inherits the main process <code>stdin</code>, <code>stdout</code> and <code>stderr</code>. This causes the child process data events handlers to be triggered on the main <code>process.stdout</code> stream, making the script output the result right away.</p><p>Because of the <code>shell: true</code> option above, we were able to use the shell syntax in the passed command, just like we did with <code>exec</code>. But with this code, we still get the advantage of the streaming of data that the <code>spawn</code> function gives us. <em>THis is really the best of both worlds</em>.</p><p>There are a few other good options we can use in the last argument to the <code>child_process</code> function besides <code>shell</code> and <code>stdio</code>. We can, for example, use the <code>cwd</code> option to change the working directory of the script.</p><p>Another option we can use is the <code>env</code> option to specify the environment variables that will be visible to the new child process. The default for this option is <code>process.env</code> which gives any command access to the current process environment. If we want ot override that behavior, we can simple pass an empty object as the <code>env</code> option or new value there to be considered as the only environment variables:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> child = spawn(<span class="string">&#x27;echo $ANSWER&#x27;</span>, &#123;</span><br><span class="line">  stdio: <span class="string">&#x27;inherit&#x27;</span>,</span><br><span class="line">  shell: <span class="literal">true</span>,</span><br><span class="line">  env: &#123;</span><br><span class="line">    ANSWER: <span class="number">12</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>The echo command above does not have access to the parent process’s environment variables. It can’t, for example, access <code>$HOME</code>, but it can accccess <code>$ANSWER</code> because it was passes as a custom environement variable through the <code>env</code> option.</p><p>One last important child process option to explain here is the <code>detached</code> option, which makes the child process run independently of its parent process.</p><p>Assuming we have a file <code>timer.js</code> that keeps the event loop busy:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// keep the event loop busy</span></span><br><span class="line">&#125;, <span class="number">20000</span>)</span><br></pre></td></tr></table></figure><p>We can execute it in the background using the <code>detached</code> option:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; spawn &#125; = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> child = spawn(<span class="string">&#x27;node&#x27;</span>, [<span class="string">&#x27;timer.js&#x27;</span>], &#123;</span><br><span class="line">  detached: <span class="literal">true</span>,</span><br><span class="line">  stdio: <span class="string">&#x27;ignore&#x27;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">child.unref()</span><br></pre></td></tr></table></figure><p>The exact behavior of detached child process depends on the OS. On windows, the detached child process will have its own console window while on Linux the detached child process will be made the leader of a new process groups and session.</p><p>It the <code>unref</code> function is called on the detached process, the parent process can exit independently of the child. This can be useful if the child is executing a long-running process, but to keep it running in the background the child’s <code>stdio</code> configurations also have to be independent of the parent.</p><p>The example above will run a node script(timer.js) in the background by detaching and also ignoring its parent <code>stdio</code> file descriptors so that the parent can terminate while the child keeps running in the background.</p><h3 id="The-execFile-function"><a href="#The-execFile-function" class="headerlink" title="The execFile function"></a>The execFile function</h3><p>If you need to execute a file without using a shell, the <code>execFile</code> function is what you need. It behaves exactly like the <code>exec</code> function, but does not use a shell, which makes it a bit more efficient. On windows, some files cannot be executed on their own, like <code>.bat</code>, <code>.cmd</code> files. Those files cannot be executed with <code>execFile</code> and either <code>exec</code> or <code>spawn</code> with shell set to true is required to execute them.</p><h3 id="The-Sync-Function"><a href="#The-Sync-Function" class="headerlink" title="The *Sync Function"></a>The *Sync Function</h3><p>The functions <code>spawn</code>, <code>exec</code>, <code>execFile</code> from the <code>child_process</code> module also have synchronous blocking versions that will wait until child process exits.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">  spawnSync,</span><br><span class="line">  execSync,</span><br><span class="line">  execFileSync,</span><br><span class="line">&#125; = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="The-fork-function"><a href="#The-fork-function" class="headerlink" title="The fork() function"></a>The fork() function</h3><p>THe <code>fork</code> function is a variation of the <code>spawn</code> function for spawning node processes. The biggest difference between <code>spawn</code> and <code>fork</code> is that a communication channel is established to the child process when using <code>fork</code>, so we can use the <code>send</code> function on the forked along with the global <code>process</code> object itself to exchange messsages between the parent and forked processes. We do this through the <code>EventEmitter</code> module interface.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// parent.js</span></span><br><span class="line"><span class="keyword">const</span> &#123; fork &#125; = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> forked = fork(<span class="string">&#x27;child.js&#x27;</span>)</span><br><span class="line"></span><br><span class="line">forked.on(<span class="string">&#x27;message&#x27;</span>, <span class="function">(<span class="params">msg</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Message from child&#x27;</span>, msg)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">forked.send(&#123;</span><br><span class="line">  hello: <span class="string">&#x27;world&#x27;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// child.js</span></span><br><span class="line"></span><br><span class="line">process.on(<span class="string">&#x27;message&#x27;</span>, <span class="function">(<span class="params">msg</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Message from parent:&#x27;</span>, msg)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">let</span> counter = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  process.send(&#123;</span><br><span class="line">    counter: counter++</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;, <span class="number">1000</span>)</span><br></pre></td></tr></table></figure><p>In the parent.js we fork <code>child.js</code>(<strong>which will execute the file with the <code>node</code> command</strong>) and then we listen for the <code>message</code> event. The <code>message</code> event will be emitted whenever the child use <code>process.send</code>.</p><p>The pass down messages from the parent to the child, we can execute the <code>send</code> function one the forked object it self, and then, in the child script we can listen to the <code>message</code> event on the global <code>process</code>.</p><p>When executing the <code>parent.js</code> file, it’ll first send down the <code>&#123;hello: &#39;world&#39;&#125;</code> object to be printed by the forked child process and then the forked child process will send an incremental counter value every second to be printed by the parent process.</p><p>Let’s do more practical example about the <code>fork</code> function.</p><p>Let’s say we have an http server that handles two endpoints. One of these endpoints(<code>/compute</code> below) is computationally expensive and will take a few seconds to complete. WE can use a long for loop to simulate that:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> longComputation = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> sum = <span class="number">0</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">1e9</span>; i++) &#123;</span><br><span class="line">    sum += i</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> sum</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer()</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">&#x27;request&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (req.url === <span class="string">&#x27;/compute&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> sum = longComputation()</span><br><span class="line">    <span class="keyword">return</span> res.end(<span class="string">`Sum is <span class="subst">$&#123;sum&#125;</span>`</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res.end(<span class="string">&#x27;OK&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure><p>The program has a big problem: when the <code>/compute</code> endpoint is requested, the server will not be able to handle any other requests because the event loop is busy with the long for loop operation.</p><p>There are a few ways which we can solve this problem depending on the nature of the long operation but one solution that works for all operation is to just move the computational operation into another process using <code>fork</code>.</p><p>We first move the whole <code>longComputation</code> function into its own file and make it invoke that function when instructed via a message from the main process:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// compute.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> longComputatioin  = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> sum = <span class="number">0</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">1e9</span>; i++) &#123;</span><br><span class="line">    sum += i;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> sum</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">process.on(<span class="string">&#x27;message&#x27;</span>, <span class="function">(<span class="params">msg</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> sum = longComputatioin()</span><br><span class="line">  process.send(sum)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// server.js</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; fork &#125; = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer()</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">&#x27;request&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (req.url === <span class="string">&#x27;/compute&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> compute = fork(<span class="string">&#x27;compute.js&#x27;</span>)</span><br><span class="line">    compute.send(<span class="string">&#x27;start&#x27;</span>)</span><br><span class="line">    compute.on(<span class="string">&#x27;message&#x27;</span>, <span class="function"><span class="params">sum</span> =&gt;</span> &#123;</span><br><span class="line">      res.end(<span class="string">`Sum is <span class="subst">$&#123;sum&#125;</span>`</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res.end(<span class="string">&#x27;OK&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure><p>When a request to <code>/compute</code> happens now with the above code, we simply send a message to the forked process to start executing the long operation. The main process’s event loop will not be blocked.</p><p>Once the forked process is done with the long operation, it can send its result back to the parent process using <code>process.send</code>.</p><p>Node’s <code>cluster</code> module is based on this idea of child process forking and load balancing the requests among the many forks.</p>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Scaling Node.js App</title>
      <link href="/2017/08/22/Scaling-Node-js-App/"/>
      <url>/2017/08/22/Scaling-Node-js-App/</url>
      
        <content type="html"><![CDATA[<h3 id="Strategies-of-Scalability"><a href="#Strategies-of-Scalability" class="headerlink" title="Strategies of Scalability"></a>Strategies of Scalability</h3><p>The workload is the most popular reason we scale our applications, but it’s not the only reason. We also scale our applications to increase their availability and tolerance to failure.</p><h4 id="Cloning"><a href="#Cloning" class="headerlink" title="Cloning"></a>Cloning</h4><p>The easiest thing to do to scale a big application is to clone it mulitple times and have each cloned instance handle part of the workload(with a load balancer). This does not cost a lot in term of development time and it’s highly effective. This strategy is the minimum you should do and Node.js has the built-in module, <code>cluster</code>, to make is easier for you to implement the cloning strategy on a single server.</p><h4 id="Decomposing"><a href="#Decomposing" class="headerlink" title="Decomposing"></a>Decomposing</h4><p>We can also scale an application by decomposiing it based on functionalities and services. This means having mulitple, different applications with different code bases and sometimes with their own dedicated databases and User Interfaces.</p><p>This strategy is commonly associated with the term <strong>Microservice</strong>, where micro indicates that those services should be small as possible, but in reality, the size of the service is not what’s important but rather the enforement of loose coupling and high cohesion between services.</p><h4 id="Splitting"><a href="#Splitting" class="headerlink" title="Splitting"></a>Splitting</h4><p>We can also split the application into multiple instances where each instance is responsible for only a part of the application’s data. This strategy is often named <strong>horizontal partitioning</strong>, or <strong>sharding</strong>, in database. Data partitioning requires a lookup step before each operation to determine which instance of the application to use.</p><p>Successfully scaling a big application should eventually implement all three strategies.</p><h3 id="The-Cluster-Module"><a href="#The-Cluster-Module" class="headerlink" title="The Cluster Module"></a>The Cluster Module</h3><p>The cluster module can be used to enable load balancing over an environement’s multiple CPU cores. It’s based on the child process module <code>fork</code> method and it basically allows us to fork the main application process as many times as we have CPU cores. It will then take over and load balance all requests to the main process across all forked processs.</p><p>The cluster module is Node’s helper for us to implement the cloning scalability strategy, but only on one machine. When you have a big machine with a lot resources or when it’s easier and cheaper to add more resources to one machine ratherthan adding new machine, the cluster module is a greate option for a really quick implementation of the cloning strategy.</p><p>Even small machines usually have multiple cores and even if you’re not worried about the load on your Node server, you should enable the cluster module anyway to increase your server availability and fault-tolerance.</p><p>It’s a simple step and when using a process manager like PM2, for example, it becomes as simple as just providing an argument to the launch command.</p><p>The structure of what the cluster module does is simple. We create a <em>master process</em> and that master process <em>forks</em> a number of <em>worker processes</em> and manage them. Each worker process represents an instance of the application that we want to scale. All incoming requests are handled by the master process, which is the one that decides which worker process should handle the incoming request.</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*C7ICI8d7aAna_zTZvZ64MA.png"></p><p>The master process’s job is easy because it actually just uses a <em>round-robin</em> algorithm to pick a worker process. This is enabled by default on all platform except windows and it can be globally modified to let the load-balancing be handled by the operation system self.</p><p>The round-robin algorithm distributes the load evenly across all available processes on a rotational basis. The first request is forwarded to the first worker process, the second to the next worker process in the list, and so on. When the end of the list is reached, the algorithm starts again from the beginning.</p><h3 id="Load-Balancing-an-HTTP-Server"><a href="#Load-Balancing-an-HTTP-Server" class="headerlink" title="Load-Balancing an HTTP Server"></a>Load-Balancing an HTTP Server</h3><p>Let’s clone and load balance a simple HTTP server using the cluster module.</p><p>Here’s the simple Node’s hello-world example server slightly modified to simulate some CPU work before responding:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> pid = process.pid</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">1e7</span>; i++) &#123;</span><br><span class="line">    <span class="comment">// simulate CPU work</span></span><br><span class="line">  &#125;</span><br><span class="line">  res.end(<span class="string">`Handled by process <span class="subst">$&#123;pid&#125;</span>`</span>)</span><br><span class="line">&#125;).listen(<span class="number">8080</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Started process <span class="subst">$&#123;pid&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Before we create a cluster to clone this server into multiple workers, let’s do a simple benchmark of how many requests this server can handle per second. We can use <strong>Apache benchmarking tool</strong> for that.</p><p>After running the simple <code>server.js</code> code above, run this <code>ab</code> command:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ab -c200 http://localhost:8080/</span><br></pre></td></tr></table></figure><p>This command will test-load the server with 200 concurrent connections for 10 seconds.</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*w8VmzV81atlTzHn7pDXu1g.png"></p><p>The single node server was able to handle about 51 requests per seconds.</p><p>Now that we have a reference benchmark, we can scale the application with the cloning strategy using the cluster module.</p><p>On the same level as the <code>server.js</code> file above, we can create a new file(<code>cluster.js</code>) <strong>for the master process</strong> with this content:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// cluster.js</span></span><br><span class="line"><span class="keyword">const</span> cluster = <span class="built_in">require</span>(<span class="string">&#x27;cluster&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> os = <span class="built_in">require</span>(<span class="string">&#x27;os&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (cluster.isMaster) &#123;</span><br><span class="line">  <span class="keyword">const</span> cpu = os.cpus().length</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Forking for <span class="subst">$&#123;cpu&#125;</span> CPUS`</span>)</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; cpus; i++) &#123;</span><br><span class="line">    cluster.fork()</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="built_in">require</span>(./server)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>In <code>cluster.js</code>, we first required both the <code>cluster</code> module and the <code>os</code> module, we use the <code>os</code> module to read the number of CPUS cores we can work with using <code>os.cpus()</code>.</p><p>The <code>cluster</code> module gives us the handy Boolean flag <code>isMaster</code> to determine if this <code>cluster.js</code> file is being loaded as a master process or not. The first time we execute this file, we will be executing the master process and that <code>isMaster</code> flag will be set to true. In this case, we can instruct the master process to fork our server as many times as we have CPU cores.</p><p>Now we just read the number of CPUs we have using the <code>os</code> module, then with a for loop over that number, we call the <code>cluster.fork</code> method. The for loop will simple create as many workers as the number of CPUs in the system to take advantage of all the available processing power.</p><p>When the <code>cluster.fork</code> line is executed from the master process, the current file, <code>cluster.js</code>, is run again, but this time in <em>worker mode</em> with the <code>isMaster</code> flag set to false.</p><p><em>There is actually another flag set to true in this case if you need to use it, which is the <code>isWorker</code></em> flag.</p><p>When the application runs as a worker, it can start doing the actual work. This is where we need to define our server logic, which, for this example, we can do by requiring the <code>server.js</code> file that we already have.</p><p>That’s basically it. That’s how easy it is to take advantage of all the processing power in a machine. To test the cluster, run the <code>cluster.js</code> file.</p><p><img src="https://cdn-images-1.medium.com/max/800/1*c0S-W4GYgCGB_maJ94ZLPw.png"></p><p>It’s important to understand that these are completely different Node.js processes. Each worker process here will have its own event loop and memory space.</p><p>When we now hit the web server multiple times, the requests will start to get handled by different worker processes with different process ids. The worker will not be exactly rotated in sequence because the cluster module performs some optimizations when picking the next worker, but the load will be somehow distributed among the different worker process.</p><p>We can use the same <code>ab</code> command above to load-test this cluster of processes:</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*5_EogHG-Egf2uAMOj9PmCA.png"></p><p>Now the cluster can handle 181 requests per seconds.</p><h3 id="Broadcasting-Messages-to-All-Workers"><a href="#Broadcasting-Messages-to-All-Workers" class="headerlink" title="Broadcasting Messages to All Workers"></a>Broadcasting Messages to All Workers</h3><p>Communicating between the master process and the workers is simple because under the hood the cluster module is just using the <code>child_process.fork</code> API, which means we also have communication channels available between the master process and each workers.</p><p>Based on the <code>server.js</code>/<code>cluster.js</code> example above, we can access the list of worker objects using <code>cluster.workers</code>, which is an object that holds a reference to all workers and can be used to read information about these workers. Since we have communication channels between master process and all workers, to broadcast a message to all them we just need a simple loop over all the workers:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.values(cluster.workers).forEach(<span class="function"><span class="params">worker</span> =&gt;</span> &#123;</span><br><span class="line">  worker.send(<span class="string">`Hello Worker <span class="subst">$&#123;worker.pid&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>We simple used <code>Object.values</code> to get an array of all workers from the <code>cluster.workers</code> object. Then for each worker we can use the <code>send</code> function to send over any value that we want.</p><p>In a worker file, <code>server.js</code> in our example, to read a message received from this master process, we can register a handler for the <code>message</code> event on the global <code>process</code> object:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">process.on(<span class="string">&#x27;message&#x27;</span>, <span class="function">(<span class="params">msg</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Message from master: <span class="subst">$&#123;msg&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><img src="https://cdn-images-1.medium.com/max/1000/1*6XfoWiNKTCiDjqar7L5_xw.png"></p><p>Every worker received a message from the master process. <em>Note how the workers did not start in order</em>.</p><p>Let’s make this communication example a little bit more practical. Let’s say we want our server to reply with the number of users we have created in our database. We will create a mock function that returns the number of users we have in the database and just have it square its value every time it’s called:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// **** Mock DB Call</span></span><br><span class="line"><span class="keyword">const</span> numberOfUsersInDB = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.count = <span class="built_in">this</span>.count || <span class="number">5</span></span><br><span class="line">  <span class="built_in">this</span>.count = <span class="built_in">this</span>.count * <span class="built_in">this</span>.count</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">this</span>.count</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Every time <code>numberOfUsersInDB</code> is called, we’ll assume that a database connection has been made.</p><p>In the master process mode, we can use the same loop to broadcast the users count value to all workers:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Right After the fork loop within the isMaster=true block</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> updateWorkers = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> usersCount = numberOfUsersInDB()</span><br><span class="line">  <span class="built_in">Object</span>.values(cluster.workers).forEach(<span class="function"><span class="params">worker</span> =&gt;</span> &#123;</span><br><span class="line">    worker.send(&#123;</span><br><span class="line">      usersCount,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">updateWorkers()</span><br><span class="line"><span class="built_in">setInterval</span>(updateWorkers, <span class="number">10000</span>)</span><br></pre></td></tr></table></figure><p>Here we’re invoking <code>updateWorkers</code> for the first time and then invoking it every 10 seconds using a <code>setInterval</code>. This way, every 10 seconds, all workers will receive the new user count value over the process communication channel and only one database connection will be made.</p><p>In the server code, we can use the <code>userCount</code> value using the same <code>message</code> event handler. We can simply cache that value with a module global variable and use it anywhere we want.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> pid = process.pid</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> usersCount</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">1e7</span>; i++);</span><br><span class="line">  res.write(<span class="string">`Handled by process: <span class="subst">$&#123;pid&#125;</span>`</span>)</span><br><span class="line">  res.end(<span class="string">`Users: &#123;usersCount&#125;`</span>)</span><br><span class="line">&#125;).listen(<span class="number">8080</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Start process <span class="subst">$&#123;pid&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">process.on(<span class="string">&#x27;message&#x27;</span>, <span class="function"><span class="params">msg</span> =&gt;</span> &#123;</span><br><span class="line">  usersCount = msg.usersCount</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>The above code makes the worker web server respond with the cached <code>usersCount</code> value. If you test the cluster code now, during the first 10 seconds you’ll get ‘25’ as the users count from all workers(and only one DB request would be made). Then after another 10 seconds, all workers would start reporting the new user count: 625(and only one DB request would be made).</p><p>This is all possible thanks to the communication channels between the master process and all workers.</p><h3 id="Increasing-Server-Availability"><a href="#Increasing-Server-Availability" class="headerlink" title="Increasing Server Availability"></a>Increasing Server Availability</h3><p>One of the problems in running a single instance of a Node application is that when that instance crashes, it has to be restarted. This means some downtime between these two actions, even if the process was automated as it should.</p><p>This also applies to the case when the server has to be restarted to deploy new code. With one instance, there will be downtime which affects the availability of the system.</p><p>When we have multiple instances, the availability of the system can be easily increased with just a few extra lines of code.</p><p>To simulate a random crash in the server process, we can simply do a <code>process.exit</code> call inside a timer that fires after a random amount of time:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// In server.js</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  process.exit(<span class="number">1</span>) <span class="comment">// death by random timeout</span></span><br><span class="line">&#125;, <span class="built_in">Math</span>.random() * <span class="number">10000</span>)</span><br></pre></td></tr></table></figure><p>When a worker process exits like this, the master process will be notified using the <code>exit</code> event on the <code>cluster</code> model object. We can register a handler for that event and just fork a new worker process when any worker process exits.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Right after the fork loop within the isMaster=true block</span></span><br><span class="line"></span><br><span class="line">cluster.on(<span class="string">&#x27;exit&#x27;</span>, <span class="function">(<span class="params">worker, code, signal</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (code !== <span class="number">0</span> &amp;&amp; !worker.exitedAfterDisconnect) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`Worker <span class="subst">$&#123;worker.id&#125;</span> crashed. Starting a new worker...`</span>)</span><br><span class="line">    cluster.fork()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>It’s good to add the if condition above to make sure the worker process actually crashed and was not manually disconnected or killed by the master process itself.</p><p>If the main process is going to kill the worker, it can use the <code>disconnect</code> methods on the worker and in that case, the <code>exitedAfterDisconnect</code> flag will be set to true. The if statement above will guard to not fork a new worker for that case.</p><p>If we run the cluster with the handler above(and the random crash in server.js), after a random number of seconds, workers will start to crash and the master process will immediately fork new workers to increase the availability of the system.</p><p>You can actually measure the availability using the same <code>ab</code> command and see how many requests the server will not be able to handle overall.</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*B72o6QhsyiNnEQU5Wx20RQ.png"></p><h3 id="Zero-downtime-Restarts"><a href="#Zero-downtime-Restarts" class="headerlink" title="Zero-downtime Restarts"></a>Zero-downtime Restarts</h3><p>We have multiple instances running, so instead of restarting them together, we can simply restart them one at a time to allow other workers to continue to serve requests while one worker is being restarted.</p><p>Implementing this with the cluster module is easy. Since we don’t want to restart the master process once it’s up, we need a way to send this master process a command to instruct it to start restarting its workers. This is easy on Linux system because we can simply listen to a process signal like <code>SIGUSR2</code>, which we can trigger by using the <code>kill</code> command on the process id and passing that signal:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// In Node</span></span><br><span class="line">process.on(<span class="string">&#x27;SIGUSR2&#x27;</span>, <span class="function">() =&gt;</span> &#123; ... &#125;)</span><br><span class="line"><span class="comment">// To trigger that</span></span><br><span class="line">$ kill -SIGUSR2 PID</span><br></pre></td></tr></table></figure><p>This way, the master process will not be killed and we have a way to instruct it to start doing something.</p><p><strong><code>SIGUSR2</code> is a proper signal to use here because this will be a user command. If you’re wondering why not <code>SIGUSR1</code>, it’s because Node uses that for its debugger and you want to avoid any conflicts.</strong>.</p><p>When the master process receives the <code>SIGUSR2</code> signal, that means it’s time for it to restart its workers, but we want to do that one worker at a time. This simply means the master process should only restart the next worker when it’s done restarting the current one.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">restartWorker</span> = (<span class="params">workerIndex</span>) =&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> worker = workers[workerIndex]</span><br><span class="line">  <span class="keyword">if</span> (!worker) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">  worker.on(<span class="string">&#x27;exit&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!worker.exitedAfterDisconnect) <span class="keyword">return</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`Exited process <span class="subst">$&#123;worker.process.pid&#125;</span>`</span>)</span><br><span class="line"></span><br><span class="line">    cluster.fork().on(<span class="string">&#x27;listening&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      restartWorker(workerIndex + <span class="number">1</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  worker.disconnect()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">restartWorker(<span class="number">0</span>)</span><br></pre></td></tr></table></figure><p>Inside the <code>restartWorker</code> function, we got a reference to the worker to be restarted and since we will be calling this function recursively to form a sequence, we need a stop condition. When we no longer have a worker to restart, we can just return.</p><p>We then basically want to disconnect this worker (using <code>worker.disconnect</code>), but before restarting the next worker, we need to fork a new worker to replace this current one that we’re disconnecting.</p><p>We can use the <code>exit</code> event on the worker itself to fork a new worker when the current one exists, but we have to make sure that the exit action was actually triggered after a normal disconnect call. We can use the <code>exitedAfterDisconnect</code> flag. If this flag is not true, the exit was caused by something else other than our disconnect call and in that case, we should just return and do nothing. But if the flag is set to true, we can go ahead and fork a new worker to replace the one that we’re disconnecting.</p><p>When this new forked worker is ready, we can restart the next one.</p><p>However, remember that the fork process is not synchronous, so we can’t just restart the next worker after the fork call. Instead, we can monitor the <code>listening</code> event on the newly forked worker, which tells us that this worker is connected and ready. When we get this event, we can safely restart the next worker in sequence.</p><p>That’s all we need for a zero-downtime restart.</p><p>Process monitors like PM2, make all the tasks we went through so far extremely easy and give a log more features to monitor the health of a Node’s application.</p><h3 id="Shared-State-and-Sticky-Load-Balancing"><a href="#Shared-State-and-Sticky-Load-Balancing" class="headerlink" title="Shared State and Sticky Load Balancing"></a>Shared State and Sticky Load Balancing</h3><p>When we load balance a Node application, we lost some features that are only suitable for a single process. This problem is somehow similar to what’s known in other languages as thread safety, which is about sharing data between threads. In our case, it’s sharing data between worker processes.</p><p>For example, with a cluster setup, we can no longer cache things in memory because every worker process will have its own memory space, If we cache something in one worker’s memory, other workers will not have access to it.</p><p>If we need to cache things with a cluster setup, we have to use a separate entity and read/write to that entity’s API from all workers. This entity can be a database server or if you want to use in-memory cache you can use a server like Redis or create a dedicated Node process with a read/write API for all other workers to communicate with.</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*dIR_CAkmtPFgtaGTOKBFkA.png"></p><p>Don’t look at this as a disadvantage, because using a separate entity for your application caching is part of <em>decomposing</em> your app for scalability. You should probably be doing that even if you’re running on a single core machine.</p>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mock Data for Node.js</title>
      <link href="/2017/08/22/Mock-Data-for-Node-js/"/>
      <url>/2017/08/22/Mock-Data-for-Node-js/</url>
      
        <content type="html"><![CDATA[<h3 id="Faker-js"><a href="#Faker-js" class="headerlink" title="Faker.js"></a>Faker.js</h3><p>It’s a wonderful node module to create fake/mock data.</p><p>Faker.js has its own API, and it’s huge.</p><p>It has a vast API for almost every use case with an excellent <a href="https://github.com/marak/Faker.js/">documentation</a></p><p>Let’s consider a test case where I want some a <em>user</em> to have following amount of fields:</p><ul><li><p>name</p></li><li><p>email</p></li><li><p>website</p></li><li><p>address</p></li><li><p>bio</p></li><li><p>image/avatar</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> faker = <span class="built_in">require</span>(<span class="string">&#x27;faker&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> User = &#123;</span><br><span class="line">  name: faker.name.findName(),</span><br><span class="line">  email: faker.internet.email(),</span><br><span class="line">  website: faker.internet.url(),</span><br><span class="line">  address: faker.address.streetAddress() + faker.address.city() + faker.address.country(),</span><br><span class="line">  bio: faker.lorem.sentences(),</span><br><span class="line">  image: faker.image.avatar(),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Faker-js-Data"><a href="#Faker-js-Data" class="headerlink" title="Faker.js Data"></a>Faker.js Data</h3><p>List of data that can generate faker.js:</p><ul><li><p>address</p></li><li><p>commerce</p></li><li><p>company</p></li><li><p>date</p></li><li><p>finance</p></li><li><p>hacker</p></li><li><p>helpers</p></li><li><p>image</p></li><li><p>internet</p></li><li><p>lorem</p></li><li><p>name</p></li><li><p>phone</p></li><li><p>random</p></li><li><p>system</p></li></ul><h3 id="Use-in-Browser"><a href="#Use-in-Browser" class="headerlink" title="Use in Browser"></a>Use in Browser</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">&#x27;faker.js&#x27;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">var</span> randomName = faker.name.findName()</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Test </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Analyzing Runtime Performacne With Chrome DevTools</title>
      <link href="/2017/08/20/Analyzing-Runtime-Performacne-with-Chrome-DevTools/"/>
      <url>/2017/08/20/Analyzing-Runtime-Performacne-with-Chrome-DevTools/</url>
      
        <content type="html"><![CDATA[<h3 id="Get-Started"><a href="#Get-Started" class="headerlink" title="Get Started"></a>Get Started</h3><ul><li><p>Open Chrome in Incognito Mode. Incognito Mode ensures that Chrome runs in a clean state. For example, if you have a lot of extensions installed, those extensions might create noise in you performance meaturements.</p></li><li><p>Load the following page in your Incognito window. This is the demo that you’re going to profile. The page shows a bunch of little blue squares moving up and down.</p></li></ul><p><code>https://googlechrome.github.io/devtools-samples/jank/</code></p><ul><li>Press <code>Command + Option + I</code> in Mac to open DevTools.</li></ul><h3 id="Simulate-a-Mobile-CPU"><a href="#Simulate-a-Mobile-CPU" class="headerlink" title="Simulate a Mobile CPU"></a>Simulate a Mobile CPU</h3><p>Mobile devices have much less CPU power than desktops and laptops. Whenevery you profile a page, use <strong>CPU Throttling</strong> to simulate how your page performs on mobile devices.</p><ul><li><p>In DevTools, click the <strong>Performacne</strong> tab.</p></li><li><p>Make sure that the <strong>Screenshots</strong> checkbox is enabled.</p></li><li><p>Click <strong>Capture Setting</strong>(the gear icon). DevTools reveals settings related to how it captures performances metrics.</p></li><li><p>For <strong>CPU</strong>, select <strong>2x slowdown</strong>. DevTools throttle your CPU so that it’s 2 times slower than usual.</p></li></ul><p><img src="https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/imgs/throttling.svg"></p><h3 id="Set-up-the-demo"><a href="#Set-up-the-demo" class="headerlink" title="Set up the demo"></a>Set up the demo</h3><ul><li><p>Keep clicking <strong>Add 10</strong> until the blue squares move noticeably slower than before.</p></li><li><p>Click <strong>Optimize</strong>, the blue squares should move faster and more smoothly.</p></li><li><p>Click <strong>Un-Optimize</strong>. The blue squares move slower and with more jank again.</p></li></ul><h3 id="Record-runtime-performance"><a href="#Record-runtime-performance" class="headerlink" title="Record runtime performance."></a>Record runtime performance.</h3><p>When you ran the optimized version of the page, the blue squares move faster. Why is that? Both version are supposed to move each square the same amount of spaces in the same amount of time. Take a recording in the Performance panel to learn how to detect the performance bottlenect in the un-optimized version.</p><ul><li>In DevTools, click <strong>Record</strong> DevTools captures performance metrics as the page run.</li></ul><p><img src="https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/imgs/profiling.png" alt="Profiling the Page"></p><ul><li><p>Wait a few seconds</p></li><li><p>Click <strong>Stop</strong>, DevTools stops recording, processes the data, then displays the results on the Performance panel.</p></li></ul><p><img src="https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/imgs/results.png"></p><h3 id="Analyze-the-results"><a href="#Analyze-the-results" class="headerlink" title="Analyze the results"></a>Analyze the results</h3><p>The main metrics for measuring the performance of any animation is frames per second (FPS). Users are happy when animations runs at 60 FPS.</p><ul><li>Look at the <strong>FPS</strong> Chart</li></ul><p><img src="https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/imgs/fps-chart.svg"></p><p>Whenever you see a red bar above <strong>FPS</strong>, it means that the framerate dropped so low that it’s propably harming the user experience. In general, the highter the green bar, the higher the FPS.</p><ul><li>Below the <strong>FPS</strong> chart you see the CPU chart.</li></ul><p><img src="https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/imgs/cpu-summary.svg"></p><p>The colors in the CPU chart corresponds to the colors in the Summary tab, at the bottom of the Performance panel. The fact that the CPU chart is full of color means that the CPU was maxed out during the recording.</p><ul><li><p>Hover your mouse over the <strong>FPS</strong>, <strong>CPU</strong>, or <strong>NET</strong> charts. DevTools shows a screenshot of the page at that point in time. Move your mouse left and right to replay the recoding. This is called srubbing, and it’s useful for manually analyzing the progression of animations.</p></li><li><p>In <strong>Frames</strong> section, hover your mouse over one of the green squares, DevTools shows you the FPS for that particular frame.</p></li></ul><p>Of course, with this demo, it’s pretty obvious that the page is not performing well. But in real scenarios, it may not be so clear, so having all of these tools to make measurements comes in handy.</p><h3 id="Find-Bottleneck"><a href="#Find-Bottleneck" class="headerlink" title="Find Bottleneck"></a>Find Bottleneck</h3><p>the summary tab. When no events are selected, this tab shows you a breakdown of activity. The page spent most of its time rendering. Since performance is the art of doing less work, your goal is to reduce the amount of time spent doing rendering work.</p><p><img src="https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/imgs/summary.svg"></p><ul><li>Expand the <strong>Main</strong> section. DevTools shows you a flame chart of activity on the main thread, over time. The x-axis represents the recoding, over time. Each bar represents an event. A wider bar means that event took longer. The y-axis represents the call stack. When you see events stacked on top of each other, it means the upper events caused the lower events.</li></ul><p><img src="https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/imgs/main.svg"></p><ul><li>There’s a lot of data in the recording. Zoom in on a single <strong>Animation Frame Field</strong> event by clicking, holding, and dragging your mouse over the <strong>Overview</strong>, which is the section that includes <strong>CPU</strong>, <strong>FPS</strong>, and <strong>NET</strong> charts. The <strong>Main</strong> section and <strong>Summary</strong> tab only display information for the selected portion of the recording.</li></ul><p><img src="https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/imgs/zoomed.png"></p><p>the red triangle in the top-right of the <strong>Animation Frame Fired</strong> event. Whenever you see a red triangle, it’s a warning that there may be an issue related to this event.</p><ul><li><p>Click the <strong>Animation Frame Fired</strong> event. The <strong>Summary</strong> tab now shows you information about that event. Note that <strong>reveal</strong> link. Click that causes DevTools to highlight the event that initiate the <strong>Animation Frame Fired</strong> event.</p></li><li><p>Under the <strong>app.update</strong> event, there’s a bunch of purple events. If they were wider, it looks as though each one might have a red triangle on it. Click one of the purple <strong>Layout</strong> events now. DevTools provides more information about the event in the <strong>Summary</strong> tab.</p></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Chrome </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Requiring Modules in Node.js</title>
      <link href="/2017/08/18/Requiring-Modules-in-Node-js/"/>
      <url>/2017/08/18/Requiring-Modules-in-Node-js/</url>
      
        <content type="html"><![CDATA[<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">&#x27;/path/to/file&#x27;</span>)</span><br></pre></td></tr></table></figure><p>The main object exported by the <code>require</code> module is a function. When Node invokes that <code>require()</code> function with a local file path as the function’s only argument, Node goes through the following sequence of steps:</p><ul><li><p><strong>Resolving</strong>: To find the absolute path of the file.</p></li><li><p><strong>Loading</strong>: To determine the type of the file content.</p></li><li><p><strong>Wrapping</strong>: To give the file its private scope. This is what makes both the <code>require</code> and <code>module</code> objects local to every file we require.</p></li><li><p><strong>Evaluating</strong>: This is what the VM eventually does with the loaded code.</p></li><li><p><strong>Caching</strong>: So that when we require this file again, we don’t go over all the steps another time.</p></li></ul><h4 id="Resolving-a-local-path"><a href="#Resolving-a-local-path" class="headerlink" title="Resolving a local path"></a>Resolving a local path</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// in NODE REPL</span></span><br><span class="line">&gt; <span class="built_in">module</span></span><br><span class="line">Module: &#123;</span><br><span class="line">  id: <span class="string">&#x27;&lt;repl&gt;&#x27;</span>,</span><br><span class="line">  <span class="built_in">exports</span>: &#123;&#125;,</span><br><span class="line">  parent: <span class="literal">undefined</span>,</span><br><span class="line">  fielname: <span class="literal">null</span>,</span><br><span class="line">  loaded: <span class="literal">false</span>,</span><br><span class="line">  children: [],</span><br><span class="line">  paths: [...]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Every module object gets an <code>id</code> property to identify it. This <code>id</code> is usually the full path to the file, but in a REPL session it’s simply <code>&lt;repl&gt;</code>.</p><p>Node modules have a one-to-one relation with files on the file-system. We require a module by loading the content of a file into memory.</p><p>However, since Node allows many ways to require a file(for example, with a relative path or a pre-configured path), before we can load the content of a file into the memory we need to find the absolute location of that file.</p><p>When we require a <code>find-me</code> module, without specifying a path:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;find-me&#x27;</span>)</span><br></pre></td></tr></table></figure><p>Node will look for <code>find-me.js</code> in all the paths specified by <code>module.paths</code> in order.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// in NODE REPL</span></span><br><span class="line">&gt; <span class="built_in">module</span>.paths</span><br><span class="line">[ <span class="string">&#x27;/Users/samer/learn-node/repl/node_modules&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;/Users/samer/learn-node/node_modules&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;/Users/samer/node_modules&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;/Users/node_modules&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;/node_modules&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;/Users/samer/.node_modules&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;/Users/samer/.node_libraries&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;/usr/local/Cellar/node/7.7.1/lib/node&#x27;</span> ]</span><br></pre></td></tr></table></figure><p>The paths list is basically a list of node_modules directories under every directory from the current directory to the root directory. It also includes a few legacy directories whose use is not recommended.</p><p>If Node can’t find <code>find-me.js</code> in any of these paths, it will throw a ‘cannot find module error’.</p><h4 id="Requiring-a-folder"><a href="#Requiring-a-folder" class="headerlink" title="Requiring a folder"></a>Requiring a folder</h4><p>Modules don’t have to be files. We can also create a <code>find-me</code> folder under <code>node_modules</code> and place an <code>index.js</code> file in there. The same <code>require(&#39;fine-me&#39;)</code> line will use that folder’s <code>index.js</code> file.</p><p>An <code>index.js</code> file will be used by default when we require a folder, but we can control what file name to start under the folder using the <code>main</code> property in <code>package.json</code>.</p><h4 id="require-resolve"><a href="#require-resolve" class="headerlink" title="require.resolve"></a>require.resolve</h4><p>If you want to only resolve the module and not execute it, you can use the <code>require.resolve</code> function. This behaves exactly the same as the main <code>require</code> function, but does not execute the file.</p><p><strong>This can be used, for example, to check whether an optional package is installed or not and only use it when it’s available</strong>.</p><h4 id="exports-module-exports-and-asynchronous-loading-of-modules"><a href="#exports-module-exports-and-asynchronous-loading-of-modules" class="headerlink" title="exports, module.exports, and asynchronous loading of modules"></a>exports, module.exports, and asynchronous loading of modules</h4><p>In any module, exports is a special object.</p><p><code>exports</code> variable inside each module is just a reference to <code>module.exports</code> which manages the exported properties.</p><p>When we reassign the <code>exports</code> variable, that reference is lost and we would be introducing a new variable instead of changing the <code>module.exports</code> object.</p><p>The <code>module.exports</code> object in every module is what the <code>require</code> function returns when we require that module.</p><p>Let’s talk about the <code>loaded</code> attribute on every module. The <code>module</code> module use the <code>loaded</code> attribute to track which modules have been loaded(true value) and which modules are still being loaded(false value).</p><p>The <code>exports</code> object becomes complete when Node finishes loading the module(and label it so). The whole process of requiring/loading a module is <em>synchronous</em>. That’s why we were able to see the modules fully loaded after one cycle of the event loop.</p><p>This also means that we cannot change the <code>exports</code> object asynchronously.</p><h4 id="JSON-and-C-C-addons"><a href="#JSON-and-C-C-addons" class="headerlink" title="JSON and C/C++ addons"></a>JSON and C/C++ addons</h4><p>We can natively require JSON files and C++ addon files with the require function. You don’t need to specify the extensions.</p><p>If a file extension was not specified, the first thing Node will try to resolve is a <code>.js</code>, then <code>.json</code>, and it will parse the <code>.json</code> file if found as a JSON text file. After that Node will try to find a binary <code>.node</code> file.</p><p>Requiring JSON file is useful, for example, everything you need to manage in that file is some static configuration values, or some values that you periodically read from an external source. For example, if we had the following <code>config.json</code> file:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;host&quot;</span>: <span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;port&quot;</span>: <span class="number">8080</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>We can require it directly like this:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; host, port &#125; = <span class="built_in">require</span>(<span class="string">&#x27;./config&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="All-code-you-write-in-Node-will-be-wrapped-in-functions"><a href="#All-code-you-write-in-Node-will-be-wrapped-in-functions" class="headerlink" title="All code you write in Node will be wrapped in functions"></a>All code you write in Node will be wrapped in functions</h3><p>Node’s wrapping of modules is often misunderstood. To understand it, let me remind you about the <code>exports/module.exports</code> relation.</p><p>We can use the <code>exports</code> object to export properties, but we cannot replace the <code>exports</code> object directly because it’s just a reference to <code>module.exports</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exports</span>.id = <span class="number">52</span>; <span class="comment">// This is ok</span></span><br><span class="line"><span class="built_in">exports</span> = &#123; <span class="attr">id</span>: <span class="number">52</span> &#125;; <span class="comment">// This will not work</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">id</span>: <span class="number">52</span> &#125;; <span class="comment">// This is ok</span></span><br></pre></td></tr></table></figure><p>How exactly does this <code>exports</code> object, which appears to be global for every module, get defined as a reference on the <code>module</code> object?</p><p>In a browser, when we declare a variable in a script like this:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> answer = <span class="number">12</span>;</span><br></pre></td></tr></table></figure><p>That <code>answer</code> variable will be globally available in all scripts after the script that define it.</p><p>This is not the case in Node. When we define a variable in one module, the other module modules in the program will not have access to that variable. So how come variables in Node are magically scoped?</p><p>The answer is simple. Before compiling a module, Node wraps the module code in a function, which we can inspect using the <code>wrapper</code> property of the <code>module </code> module.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~ $ node</span><br><span class="line">&gt; <span class="built_in">require</span>(<span class="string">&#x27;module&#x27;</span>).wrapper</span><br><span class="line">[ <span class="string">&#x27;(function (exports, require, module, __filename, __dirname) &#123; &#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;\n&#125;);&#x27;</span> ]</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure><p>Node does not execute any code you write in a file directly. It executes this wrapper function which will have your code in its body.</p><p>This is what keeps the top-level variables that are defined in any module scoped to that module.</p><p>This wrapper function has 5 arguments: <code>exports</code>, <code>require</code>, <code>module</code>, <code>__filename</code>, <code>__dirname</code>. This is what makes them appear to look global when in fact they are specific to each module.</p><p>All of these arguments get their value when Node execute the wrapper function. <code>exports</code> is defined as a reference to <code>module.exports</code> prior to that. <code>require</code> and <code>module</code> are both specific to the function to be executed, and <code>__dirname</code>/<code>__filename</code> variables will contain the wrapped module’s directory path and absolute filename.</p><p>Since every module gets wrapped in a function, we can actually access that function’s arguments with the <code>arguments</code> keyword:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">~/learn-node $ echo <span class="string">&quot;console.log(arguments)&quot;</span> &gt; index.js</span><br><span class="line">~/learn-node $ node index.js</span><br><span class="line">&#123; <span class="string">&#x27;0&#x27;</span>: &#123;&#125;,</span><br><span class="line">  <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">   &#123; [<span class="built_in">Function</span>: <span class="built_in">require</span>]</span><br><span class="line">     resolve: [<span class="built_in">Function</span>: resolve],</span><br><span class="line">     main:</span><br><span class="line">      Module &#123;</span><br><span class="line">        id: <span class="string">&#x27;.&#x27;</span>,</span><br><span class="line">        <span class="built_in">exports</span>: &#123;&#125;,</span><br><span class="line">        parent: <span class="literal">null</span>,</span><br><span class="line">        filename: <span class="string">&#x27;/Users/samer/index.js&#x27;</span>,</span><br><span class="line">        loaded: <span class="literal">false</span>,</span><br><span class="line">        children: [],</span><br><span class="line">        paths: [<span class="built_in">Object</span>] &#125;,</span><br><span class="line">     extensions: &#123; ... &#125;,</span><br><span class="line">     cache: &#123; <span class="string">&#x27;/Users/samer/index.js&#x27;</span>: [<span class="built_in">Object</span>] &#125; &#125;,</span><br><span class="line">  <span class="string">&#x27;2&#x27;</span>:</span><br><span class="line">   Module &#123;</span><br><span class="line">     id: <span class="string">&#x27;.&#x27;</span>,</span><br><span class="line">     <span class="built_in">exports</span>: &#123;&#125;,</span><br><span class="line">     parent: <span class="literal">null</span>,</span><br><span class="line">     filename: <span class="string">&#x27;/Users/samer/index.js&#x27;</span>,</span><br><span class="line">     loaded: <span class="literal">false</span>,</span><br><span class="line">     children: [],</span><br><span class="line">     paths: [ ... ] &#125;,</span><br><span class="line">  <span class="string">&#x27;3&#x27;</span>: <span class="string">&#x27;/Users/samer/index.js&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;4&#x27;</span>: <span class="string">&#x27;/Users/samer&#x27;</span> &#125;</span><br></pre></td></tr></table></figure><p>What happens is roughly equivalent to:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> (<span class="params">require, module, __filename, __dirname</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="built_in">exports</span> = <span class="built_in">module</span>.exports;</span><br><span class="line">  <span class="comment">// Your Code...</span></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">module</span>.exports;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>If we change the whole <code>exports</code> object, it would no longer be a reference to <code>module.exports</code>.</p><h4 id="The-require-object"><a href="#The-require-object" class="headerlink" title="The require object"></a>The require object</h4><p>There is nothing special about <code>require</code>. It’s an object that acts mainly as a function that takes a module name or path and return the <code>module.exports</code> object. We can simply override the <code>require</code> object with our own logic if we want to.</p><p>For exmaple, maybe for testing purposes, we want every <code>require</code> call to be mocked by default and just return a fake object instead of the required module exports object.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span> = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">mocked</span>: <span class="literal">true</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>After doing the above reassignment of <code>require</code>, every <code>require(&#39;something&#39;)</code> call in the script will just return the mocked object.</p><p>The require object also has properties of its own. We’ve seen the <code>resolve</code> property, which is a function that performs only the resolving step of the require process. We’ve also seen <code>require.extensions</code> above.</p><p>There is also <code>require.main</code> which can be helpful to determine if the script is being required or run directly.</p><p>Say, for example, that we have this simple <code>printFrame</code> function in <code>print-in-frame.js</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// In print-in-frame.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> printFrame = <span class="function">(<span class="params">size, header</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;*&#x27;</span>.repeat(size))</span><br><span class="line">  <span class="built_in">console</span>.log(header)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;*&#x27;</span>.repeat(size))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>We want to use this file in two ways:</p><ul><li>From the command line directly like this:</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node <span class="built_in">print</span>-in-frame 8 hello</span><br></pre></td></tr></table></figure><ul><li>With <code>require</code></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> print = <span class="built_in">require</span>(<span class="string">&#x27;./print-in-frame.js&#x27;</span>)</span><br><span class="line">print(<span class="number">5</span>, <span class="string">&#x27;hello&#x27;</span>)</span><br></pre></td></tr></table></figure><p>Those are two different usages. We need a way to determine if the file is being run as a stand-alone script or if it is being required by other scripts.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> printFrame = <span class="function">(<span class="params">size, header</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;*&#x27;</span>.repeat(size))</span><br><span class="line">  <span class="built_in">console</span>.log(header)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;*&#x27;</span>.repeat(size))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">require</span>.main === <span class="built_in">module</span>) &#123;</span><br><span class="line">  <span class="comment">// the file is being executed directly</span></span><br><span class="line">  printFrame(process.argv[<span class="number">2</span>], process.argv[<span class="number">3</span>])</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="built_in">module</span>.exports = printFrame</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="All-module-can-be-cached"><a href="#All-module-can-be-cached" class="headerlink" title="All module can be cached"></a>All module can be cached</h3><p>Caching is important to understand.</p><p>Say that we have the following <code>ascii-art.js</code> file that prints a cool looking header:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#####</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#####</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure><p>We want to display this header every time we <code>require</code> the file, so when we require the file twice, we want the header to show twice:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;./ascii-arg&#x27;</span>); <span class="comment">// it will show the header</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;./ascii-arg&#x27;</span>); <span class="comment">// it won&#x27;t show the header</span></span><br></pre></td></tr></table></figure><p>The second require will not show the header because of modules’ caching. Node caches the first call and does not load the file on the second call.</p><p>We can see this cache by printing <code>require.cache</code> after the first require. The cache registry is simply an object that has a property for every required module. Those properties values are the <code>module</code> objects used for each module. We can simply delete a property from that <code>require.cache</code> object to invalidate that cache. If we do that, Node will reload the module to recache it.</p>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Concurrency and Parallelism: Understanding I/O</title>
      <link href="/2017/08/18/Concurrency-and-Parallelism-Understanding-I-O/"/>
      <url>/2017/08/18/Concurrency-and-Parallelism-Understanding-I-O/</url>
      
        <content type="html"><![CDATA[<p><a href="https://blog.risingstack.com/concurrency-and-parallelism-understanding-i-o/">Original Post</a></p><p>Concurrency is much border, genral problem than parallelism. If you have tasks having inputs and outputs, and you want to schedule them so that they produce correct results, you are solving a concurrency problem.</p><p>Take a look at this diagram:</p><p><img src="https://blog-assets.risingstack.com/2017/02/cuncurrency-paralellism-diagram-of-tasks-with-dependencies.png"></p><p>It shows a data flow with input and output dependencies. Here tasks 2, 3, 4 can run concurrently after 1. There is no specific order between them, so we have multiple alternatives for running it sequetially. Showing only two of them:</p><p><img src="https://blog-assets.risingstack.com/2017/02/concurrent-data-flow-path-13245.png"></p><p>Alternatively, these tasks can run in parallel, e.g. on another processor core, another processor, or an entirely seperate computer.</p><p>On these diagrams, thread means a computation carried out on dedicated processor core, not an OS thread, as they are not necessarily parallel.</p><p><img src="https://blog-assets.risingstack.com/2017/02/paralellized-tasks-diagram.png"></p><p>If we only have one processor, why do we even bother with writing concurrent application? The processing time will not get shorter, and we add the overhead of scheduling. As a matter of fact, any modern operating system will also slice up the concurrent tasks and interleave them, so each of the slices will run for a short time.</p><h5 id="There-are-various-reasons-for-this"><a href="#There-are-various-reasons-for-this" class="headerlink" title="There are various reasons for this:"></a>There are various reasons for this:</h5><ul><li><p>We human like to interact with the computer in real time, e.g. as I type this text, I want to see it appearing on the screen immediately, at the same time listening to my favorite tracklist, and getting notifications about my incoming emails. Just imagine that you cannot drag a window while the movie keeps on playing it.</p></li><li><p>Not all operations are carried out on the computer’s CPU. If you want to write to an HDD for example, a lot of time is spent seeking to the position, writing the sectors, etc, and the intermittent time can be spent to do something else.</p></li></ul><p>These require the operating system kernel to run tasks in an interleaved manner, referred to as <code>time-sharing</code>. This is a very important property of modern operating systems.</p><h3 id="Processes-and-Threads"><a href="#Processes-and-Threads" class="headerlink" title="Processes and Threads"></a>Processes and Threads</h3><blockquote><p>A process is a running instance of a computer program. It is what you see in the task manager of your operating system or <code>top</code>.</p></blockquote><p>A process consists of allocated memory which holds the program code, its data, a heap for dynamic memory allocation, and a lot more. However, it is not the unit for multi-tasking in desktop operating systems.</p><blockquote><p>Thread is the default unit - the task - of CPU usage. COde executed in a single thread is what we usually refer to as sequential or synchronous execution.</p></blockquote><p>Threads are supported by nearly all operating systems and can be created with system calls. They have theri own <code>call stack</code>, <code>virual CPU</code> and <code>local storage</code> but share the application’s <code>heap</code>, data, codebase and resources.</p><p>They also serve as the unit of scheduling in the kernel. For this reason, we call them <code>kernel threads</code>, clarifying that they are native to the operating system and scheduled by the kernel, which distinguishes them from use-space threads, also called <code>green threads</code> which are scheduled by some user space schedular such as a library or VM.</p><p><img src="https://blog-assets.risingstack.com/2017/02/kernel-processes-and-threads-1.png"></p><p>Most desktop and sever operating system kernels use preemptive schedulers, as does the Linux, macOS and Windows kernel. We can assume that threads are preemptive scheduled, distinguishing them from their non-preemptive(cooperative) counterparts, called <code>fiber</code>. This preemptive scheduling is the reason that a hanging process doesn’t stall the whole computer.</p><p>The hanging time slices are interleaved with other processes’ and the OS’ code, so the system as a whole remains responsive.</p><p>Context switching(switching between threads) is done at frequent intervals by the kernel, creating the illusion that our programs are running in parallel, whereas in reality, they are running concurrently but sequentially in short slices.</p><h3 id="CPU-vs-I-O"><a href="#CPU-vs-I-O" class="headerlink" title="CPU vs. I/O"></a>CPU vs. I/O</h3><p>Programs usually don’t only consist of numeric, arithmetic and logic computations, in fact, a lot of times they merely write something to the file system, do network requests or access peripheries such as the console or an external device.</p><p>While the first kind of workload is CPU intensive, the latter requries performing I/O in the majority of the time.</p><p>Doing I/O is a kernel space operation, initiated with a system call, so it results in a privilege context switch.</p><p>When an I/O operation is requested with a blocking  system call, we are talking about <em>blocking I/O</em>.</p><p>This can deteriorate concurrency under implementation, concretely those that use <em>many-to-one mapping</em>. This means that all threads in a process share a common kernel thread, which implies that every thread is blocked when one does blocking I/O.</p><p>No wonder that modern OSes don’t do this. Instead, they use <code>one-to-one</code> mapping, i.e. map a kernel thread to each user-space thread, allowing another thread to run when one makes a blocking system call, which means that they are unaffected by the above adverse effect.</p><h3 id="I-O-favors-Blocking-vs-Non-Blocking-Sycn-vs-Async"><a href="#I-O-favors-Blocking-vs-Non-Blocking-Sycn-vs-Async" class="headerlink" title="I/O favors: Blocking vs. Non-Blocking, Sycn vs. Async"></a>I/O favors: Blocking vs. Non-Blocking, Sycn vs. Async</h3><p>Doing I/O usually consiss of two distinct steps:</p><ul><li><p>checking the device</p><ul><li><p>blocking: waiting for the device to be ready</p></li><li><p>non-blocking: e.g. polling periodically until ready</p></li></ul></li><li><p>transmitting:</p><ul><li><p>synchronous: executing the operation (e.g. read or write) initiated by the program.</p></li><li><p>asynchronous: executing the operation as response to an event from the kernel(asynchronous/event drive)</p></li></ul></li></ul><p>You can mix the two steps in every fashion</p><h3 id="Busy-Waiting-Polling-and-the-Event-Loop"><a href="#Busy-Waiting-Polling-and-the-Event-Loop" class="headerlink" title="Busy-Waiting, Polling, and the Event Loop"></a>Busy-Waiting, Polling, and the Event Loop</h3><p>Busy-waiting is the act of repeatedly checking a resource, such as I/O for availability in a <em>tight loop</em>. The absence of the tight loop is what distinguishes <code>polling</code> for busy-waiting.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// tight-loop example</span></span><br><span class="line"><span class="keyword">while</span> (pthread_mutex_trylock(&amp;my_mutex) == EBUSY) &#123; &#125;</span><br><span class="line"><span class="comment">// mutex is unlocked</span></span><br><span class="line">do_stuff()</span><br><span class="line"></span><br><span class="line"><span class="comment">// polling example</span></span><br><span class="line"><span class="keyword">while</span> (pthread_mutex_trylock(&amp;my_mutex) == EBUSY) &#123;</span><br><span class="line">  sleep(POLL_INTERVAL)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// mutex is unlocked</span></span><br><span class="line">do_stuff()</span><br></pre></td></tr></table></figure><p>The difference between the two code is apparent. The <code>sleep</code> function puts the current thread of execution to sleep, yield control to the kernel to schedule something else to run.</p><p>It is also obvious that both of them offer a technique of turning non-blocking code into blocking code, because control won’t pass the loop until the mutex becomes free. This means that <code>do_stuff</code> is blocked.</p><p>Let’s say we have more of thse mutexes or any arbitrary I/O device that can be polled. We can invert control-flow by assigning handlers to be called when the resource is ready. If we periodically check the resources in the llop and execute the associated handlers on completion, we created what is called an <code>event loop</code>.</p><h3 id="TCP-server-example"><a href="#TCP-server-example" class="headerlink" title="TCP server example"></a>TCP server example</h3><p>The following exmaple will illustrate the differences between working with <em>synchronous, blocking</em> and <em>non-blocking</em> network I/O. It is a dead-simple TCP echo server. After the client connects, every line is echoed back to the socket until the client write ‘bye’.</p><h4 id="Single-threaded"><a href="#Single-threaded" class="headerlink" title="Single threaded"></a>Single threaded</h4><p>The first version uses the standard POSIX procedure of <code>sys/socket.h</code>.</p><p>The server is single-threaded, it waits until a client connects.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// wait for a connection, then accept() it</span></span><br><span class="line"><span class="keyword">if</span> ((conn_s) = accept(list_s, NULL, NULL) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">  <span class="comment">// exit w err</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Then it reads from the socket each line and echoes it back until the client closes connection or prints the word ‘bye’ on a line.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">bye = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span>(!bye) &#123;</span><br><span class="line">  read_line_from_socket(conn_s, buffer, MAX_LINE - <span class="number">1</span>)</span><br><span class="line">  <span class="keyword">if</span> (!strncmp(buffer, <span class="string">&#x27;bye\n&#x27;</span>, MAX_LINE - <span class="number">1</span>)) bye = <span class="number">1</span></span><br><span class="line">  write_line_to_socket(conn_s, buffer, strlen(buffer))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (close(conn_s) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">  <span class="comment">// exit w err</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Advanced Topics of TS</title>
      <link href="/2017/08/17/Advanced-Topics-of-TS/"/>
      <url>/2017/08/17/Advanced-Topics-of-TS/</url>
      
        <content type="html"><![CDATA[<h3 id="Iterators-and-Generators"><a href="#Iterators-and-Generators" class="headerlink" title="Iterators and Generators"></a>Iterators and Generators</h3><p>Iterators are basically objects that can be hold more than one item. Iterators are collections of objects or variables or items that can be iterated on to do some sort of processing on each item in the collection. Arrays are an exmaple of iterators.</p><p>In TypeScript, an object is demmed iterable if it has an implementation for <code>Symbol.iterator</code> property. Some built-in types like <strong>Array, Map, Set, String, Int32Array</strong>, etc. have their <code>Symbol.iterator</code> property already implemented.</p><p><code>Symbol.iterator</code> function on an object is responsible for returning the list of values to iterate on.</p><p><code>for...of...</code> statements</p><p><code>for...of...</code> loops over an iterable object will invoke the <code>Symbol.iterable</code> property on the object.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> someArray = [<span class="number">1</span>, <span class="string">&#x27;string&#x27;</span>, <span class="literal">false</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> entry <span class="keyword">of</span> someArray) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(entry) <span class="comment">// 1, &#x27;string&#x27;, false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Intersection-Types"><a href="#Intersection-Types" class="headerlink" title="Intersection Types"></a>Intersection Types</h3><p>An intersection type combines multiple types into one. This is allows you to add together existing types to get a single type that has all the features you need.</p><h4 id="Union-Types"><a href="#Union-Types" class="headerlink" title="Union Types"></a>Union Types</h4><p>Union Types are closely related to intersection types, but they are used very differently. Occasionally, you’ll run into a library that expects a parameter to be either a <code>number</code> or a <code>string</code>.</p><h3 id="Type-Guards"><a href="#Type-Guards" class="headerlink" title="Type Guards"></a>Type Guards</h3><p>Union Types are useful for modeling situations when values can overlap in the types they can take on.</p><p>TypeScript has what is called a <code>type guard</code>.</p><p>A type guard is some expression that performs a runtime check that guarantees the type in some scope. To define a type guard, we simply need to define a function whose return type is a <code>type predicate</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isFish</span>(<span class="params">pet: Fish | Bird</span>): <span class="title">pet</span> <span class="title">is</span> <span class="title">Fish</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">Fish</span>&gt;</span>pet).swim !== undefined</span></span><br><span class="line"><span class="xml">&#125;</span></span><br></pre></td></tr></table></figure><p><code>pet is Fish</code> is our type predicate in this example. A predicate takes the form <code>parameterName is Type</code>, where <code>parameterName</code> must be the name of a parameter from the current function signature.</p><p>Any time <code>isFish</code> is called with some variable, TypeScript will <code>narrow</code> that variable to that specific type if the original type is compatible.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (isFish(pet)) &#123;</span><br><span class="line">  pet.swim()</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  pet.fly()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Notice that TypeScript not only knows that <code>pet is Fish</code> in the if branch, it also knows that in the else branch you <strong>don’t</strong> have a fish, so you must have a <code>Bird</code>.</p><h4 id="typeof-type-guards"><a href="#typeof-type-guards" class="headerlink" title="typeof type guards"></a><code>typeof</code> type guards</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isNumber</span>(<span class="params">x: any</span>): <span class="title">x</span> <span class="title">is</span> <span class="title">number</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> x === <span class="string">&#x27;number&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isString</span>(<span class="params">x: any</span>): <span class="title">x</span> <span class="title">is</span> <span class="title">string</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> x === <span class="string">&#x27;string&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">padLeft</span>(<span class="params">value: string, padding: string | number</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (isNumber(padding)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Array</span>(padding + <span class="number">1</span>).join(<span class="string">&#x27; &#x27;</span>) + value</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (isString(padding)) &#123;</span><br><span class="line">    <span class="keyword">return</span> padding + value</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`Expected string or number, got <span class="subst">$&#123;padding&#125;</span>`</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>However, having to define a functino to figure out if a typeis a primitive is kind of a pain.</p><p>TypeScript will recognize <code>typeof x === &#39;number&#39;</code> as a type guard on its own. This means we could just write checks inline.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">padLeft</span>(<span class="params">value: string, padding: number | string</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> padding === <span class="string">&#x27;number&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> padding === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`Expected string or number, got <span class="subst">$&#123;padding&#125;</span>`</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>These <code>typeof</code> <em>type guards</em> are recognized in two different forms: <code>typeof v === &#39;typename&#39;</code> and <code>typeof v !== &#39;typename&#39;</code>.</p><h4 id="instanceof-type-guards"><a href="#instanceof-type-guards" class="headerlink" title="instanceof type guards"></a><code>instanceof</code> type guards</h4><p><code>instanceof</code> <em>type guards</em> are a way of narrowing types using their constructor function.</p><p>The right side of the <code>instanceof</code> needs to be a constructor function, and TypeScript narrow down to:</p><ul><li><p>the type of the function’s <code>prototype</code> property if its type is not any.</p></li><li><p>the union of types returned by that type’s construct signatures.</p></li></ul><p>in that order.</p><h3 id="Generics"><a href="#Generics" class="headerlink" title="Generics"></a>Generics</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">identity</span>&lt;<span class="title">T</span>&gt;(<span class="params">arg: T</span>): <span class="title">T</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> arg</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>We add a type variable <code>T</code> to the identity function. This T allows us to capture the type the user of the code provides, so that we can use that information later.</p><p>We say that this version of the <code>identity</code> function is generic, as it works over a range of types.</p><p>Once we’ve written the generic identity function, we can call it in one of two ways.</p><p>The first way is to pass all of the arguments, including the type argument, to the function.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> output = identity &lt; string &gt; <span class="string">&#x27;myString&#x27;</span> <span class="comment">// type of output will be string</span></span><br></pre></td></tr></table></figure><p>Here we explicitly set T to be <code>string</code> as one of the arguments to the function call, denoted using <code>&lt;&gt;</code> around the arguments rather than ().</p><p>The second way is also perphaps the most common. Here we use <em>type argument inference</em> – that is, we want the compiler to set the value of T for us automatically based on the type of the argument we pass in.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> output = identity(<span class="string">&#x27;myString&#x27;</span>) <span class="comment">// type of output will be &#x27;string&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="Working-with-Generic-Type-Variables"><a href="#Working-with-Generic-Type-Variables" class="headerlink" title="Working with Generic Type Variables"></a>Working with Generic Type Variables</h4><p>When you begin to use generics, you’ll notice that when you create generic functinos like <code>identity</code>, the compiler will enfore that you use any generically typed parameters in the body of the function correctly.</p><h4 id="Generic-Types"><a href="#Generic-Types" class="headerlink" title="Generic Types"></a>Generic Types</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">identity</span>&lt;<span class="title">T</span>&gt;(<span class="params">arg: T</span>): <span class="title">T</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> arg</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> myIdentity: <span class="xml"><span class="tag">&lt;<span class="name">T</span>&gt;</span>(arg: T) =&gt; T = identity</span></span><br><span class="line"></span><br><span class="line"><span class="xml">// we can also write the generic type as a call signature of an object literal type:</span></span><br><span class="line"></span><br><span class="line">let myIdentity: &#123; &lt;T&gt;(arg: T): T &#125; = identity</span><br><span class="line"></span><br><span class="line">interface GenericIdentityFn &#123;</span><br><span class="line">  &lt;T&gt;(arg: T): T;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// or</span><br><span class="line"></span><br><span class="line">interface GenericIdentityFn&lt;T&gt; &#123;</span><br><span class="line">  (arg: T): T;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let myIdentity: GenericIdentityFn&lt;number&gt; = identity</span><br></pre></td></tr></table></figure><h4 id="Generic-Classes"><a href="#Generic-Classes" class="headerlink" title="Generic Classes"></a>Generic Classes</h4><p>A generic class has a similar shape to a generic interface.</p><p>Generic classes have a generic type parameter list in angle brackets(&lt;&gt;) following the name of the class.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GenericNumber</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  zeroValue: T;</span><br><span class="line">  add: <span class="function">(<span class="params">x: T, y: T</span>) =&gt;</span> T;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> myGenericNumber = <span class="keyword">new</span> GenericNumber&lt;number&gt;()</span><br></pre></td></tr></table></figure><p>Generic classes are only generic over their instance side rather than their static side.</p><h3 id="Decorator"><a href="#Decorator" class="headerlink" title="Decorator"></a>Decorator</h3><p>A <em>Decorator</em> is a special kind of declaration that can be attached to a class declaration, method, accessor, property, or parameter.</p><p>Sometimes it is required to have additional features to support annotating or modifying classes and class members. Decorators provide a way to add both annotation and a meta-programming syntax for class declarations and members.</p><p>Decoration use the form <code>@expression</code>, where <code>expression</code> must evaluate to a function that will be called at runtime with information about the decorated declaration.</p>]]></content>
      
      
      
        <tags>
            
            <tag> TypeScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Note(2) on TS2 of edX</title>
      <link href="/2017/08/15/Note-2-on-TS2-of-edX/"/>
      <url>/2017/08/15/Note-2-on-TS2-of-edX/</url>
      
        <content type="html"><![CDATA[<h3 id="Modules"><a href="#Modules" class="headerlink" title="Modules"></a>Modules</h3><p>Modules are used for code organization as well as code sharing.</p><p>Modules are executed within their own scope, not in the global scope. This means that variables, functions, classes, etc. declared in a module are not visible outside the module unless they are explicitly exported using <code>export</code>. Conversely, to consume a variable, function, class, interface, etc. exported from a different module, it has to be imported using <code>import</code>.</p><p>Modules are declarative.</p><p>In TypeScript any file containing a top-level <code>import</code> or <code>export</code> is considered a module.</p><h4 id="Export"><a href="#Export" class="headerlink" title="Export"></a>Export</h4><p>Exporting a declaration.</p><p>Any declaration(such as variable, function, class, type alias, or interface) can be exported by adding the <code>export</code> keyword.</p><p>A module can wrap one or more modules and combine all their exports using <code>export * from</code> syntax.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// allValidator.ts</span></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&#x27;./StringValidator&#x27;</span></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&#x27;./LetterOnlyValidator&#x27;</span></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&#x27;./ZipCodeValidator&#x27;</span></span><br></pre></td></tr></table></figure><p>Import can be renamed.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ZipCodeValidator <span class="keyword">as</span> ZCV &#125; <span class="keyword">from</span> <span class="string">&#x27;./ZipCodeValidator&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="Default-exports"><a href="#Default-exports" class="headerlink" title="Default exports"></a>Default exports</h4><p>Each module can optionally export a <code>default</code> export. Default exports are marked with the keyword <code>default</code>, and there can only be one <code>default</code> export per module.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// jQuery.ts</span></span><br><span class="line">declare <span class="keyword">let</span> $: Jquery;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> $;</span><br><span class="line"></span><br><span class="line"><span class="comment">// App.ts</span></span><br><span class="line"><span class="keyword">import</span> $ <span class="keyword">from</span> <span class="string">&#x27;jQuery&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="Declaration-Files"><a href="#Declaration-Files" class="headerlink" title="Declaration Files"></a>Declaration Files</h3><p>Declarations are used to describe code that exists elsewhere using the <code>declare</code> keyword. The goad of this is to be able to use this code in TypeScript applications without having to rewrite the code in TypeScript.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">declare <span class="keyword">var</span> mynumber: any;</span><br><span class="line">mynumber = <span class="number">300</span>; <span class="comment">// ok</span></span><br></pre></td></tr></table></figure><p>You can save these declaration in a <code>.ts</code> file or in a <code>.d.ts</code> file, we call these file with <code>.d.ts</code> extension <strong>declaration files</strong>.</p><p>It’s good practice to keep your declarations in separate <code>.d.ts</code> file.</p><p>If a file has the extension <code>.d.ts</code> then each root level definition must have the <code>declare</code> keyword prefixed to it. This tells the developer that there will be no code emitted by TypeScript. The developer needs to ensure that the declared item will exist at runtime.</p><p>For example, lets assume we have the following JavaScript code(message.js)</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showMessage</span> (<span class="params">message</span>) </span>&#123;</span><br><span class="line">  alert(message)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>If you want to call the <code>showMessage</code> function in your TypeScript code, TypeScript will not recognize that this function exists. It does not know its name or its parameter. This can be fixed by describing the <code>showMessage</code> function in a definition file as (message.d.ts):</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">declare</span> <span class="keyword">function</span> showMessage(message: string)</span><br></pre></td></tr></table></figure><p>Now you can use the function <code>showMessage</code> in TypeScript without compile errors.</p><h4 id="d-ts-files-and-ts-files"><a href="#d-ts-files-and-ts-files" class="headerlink" title=".d.ts files and .ts files"></a>.d.ts files and .ts files</h4><p>Anything allowed in a <code>.d.ts</code> file mayu also appear in a <code>.ts</code> file, but not the reverse. Therefore, <code>.d.ts</code> allows a subset of TypeScript features. A <code>.d.ts</code> file is only allowed to contain TypeScript code that doesn’t generate any JavaSAcript code in the output. If you attempt to use any feature of TypeScript that would generate JavaScript, you’ll get an error.</p><p>Interfaces are allowed, because they disappear completely after compilation.</p><p>Const enums are also allowed, unlike ordinary enums which generate an object in the output JavaScript.</p><p>Top level classes, variables, modules, and functions must be prefixed with <code>declare</code>.</p><p>It is a common practice to see a top-lvel <code>declare module</code> and then all definition inside it are therefore also declaraion.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">declare <span class="built_in">module</span> Something &#123;</span><br><span class="line">  <span class="keyword">var</span> x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Working-with-other-JavaScript-Libraries"><a href="#Working-with-other-JavaScript-Libraries" class="headerlink" title="Working with other JavaScript Libraries."></a>Working with other JavaScript Libraries.</h3><p>To describe the shape of libraries not written in TypeScript, we need to declare the API that the library exposes.</p><p>We call declarations that don’t define an implementation ‘ambient’. Typically these are defined in <code>.d.ts</code> files.</p><h4 id="Ambient-Modules"><a href="#Ambient-Modules" class="headerlink" title="Ambient Modules"></a>Ambient Modules</h4><p>We can define each module in its own <code>.d.ts</code> file with top-level export declarations, but it’s more convenient to write them as one large <code>.d.ts</code> file. To do so, we use a construct similar to ambient namespaces, but we use the <code>module</code> keyword and the quoted name of the module which will be available to a later import.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; node.d.ts</span><br><span class="line">declare module &#39;url&#39; &#123;</span><br><span class="line">  export interface Url &#123;</span><br><span class="line">    protocol?: string;</span><br><span class="line">    hostname?: string;</span><br><span class="line">    pathname?: string;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  export function parse (urlStr: string, parseQueryString?, slashesDenotateHost?): Url</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">declare module &#39;path&#39; &#123;</span><br><span class="line">  export function normalize(p: string): string;</span><br><span class="line">  export function join(...paths: any[]): string;</span><br><span class="line">  export var sep: string;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Now we can use <code>/// &lt;reference&gt;node.d.ts</code> and then load the modules using <code>import url = require(&#39;url&#39;)</code> or <code>import * as URL from &#39;url&#39;</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;reference path=&#x27;node.d.ts&#x27; /&gt;</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> URL <span class="keyword">from</span> <span class="string">&#x27;url&#x27;</span></span><br><span class="line"><span class="keyword">let</span> myUrl = URL.parse(<span class="string">&#x27;http://www.typescriptlang.org&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="Module-Resolution"><a href="#Module-Resolution" class="headerlink" title="Module Resolution"></a>Module Resolution</h3><h4 id="Relative-vs-Non-relative-module-imports"><a href="#Relative-vs-Non-relative-module-imports" class="headerlink" title="Relative vs Non-relative module imports"></a>Relative vs Non-relative module imports</h4><p>Module imports are resolved differently based on whether the module reference is relative or non-relative.</p><p>A <em>relative import</em> is one that starts with <code>/, ./, ../</code>.</p><p>Any other import is considered <em>non-relative</em>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> $ <span class="keyword">from</span> <span class="string">&#x27;jquery&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Component &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span></span><br></pre></td></tr></table></figure><p>A relative import is resolved relative to the importing file and <em>cannot</em> resolve to an ambient module declaration.</p><p>A non-relative import can be resolved relative to <code>baseUrl</code>, or through path mapping. They can also resolve to ambient module declaations.</p><h4 id="Module-Resolution-Strategies"><a href="#Module-Resolution-Strategies" class="headerlink" title="Module Resolution Strategies"></a>Module Resolution Strategies</h4><p>There are two possible module resolution strategies: <code>Node</code> and <code>Classic</code>.</p><p>You can use the <code>--moduleResolution</code> flag to specify the module resolution strategy. If not specified, the default is <code>Classic</code> for  <code>--module AMD | System | ES2015 | Node</code>.</p><h3 id="Modules-or-Namespaces"><a href="#Modules-or-Namespaces" class="headerlink" title="Modules or Namespaces"></a>Modules or Namespaces</h3><h4 id="Namespaces-vs-Modules"><a href="#Namespaces-vs-Modules" class="headerlink" title="Namespaces vs Modules"></a>Namespaces vs Modules</h4><p>If fact, namespaces were previously refered to as <em>internal modules</em> while modules where refered to as <em>external modules</em>.</p><h4 id="When-to-use-namespaces-and-when-to-use-moduels"><a href="#When-to-use-namespaces-and-when-to-use-moduels" class="headerlink" title="When to use namespaces and when to use moduels"></a>When to use namespaces and when to use moduels</h4><ul><li><p>When first moving to a module-based organization, a common tendency is to wrap exports in an additional layer of namespaces. Modules have their own scope, and only exported declaration are visible from outside the module. With this in mind, namespaces provide very little, if any, value when working with modules.</p></li><li><p>On the oraganization front, namespaces are handy for grouping together logically-related objects and types in the global.</p></li><li><p>Namespaces are important to avoid naming collisions in the scope.</p></li></ul><h3 id="Reg-Flags"><a href="#Reg-Flags" class="headerlink" title="Reg Flags"></a>Reg Flags</h3><p><strong>Dont’t use namespace in modules</strong></p><p>All of the following are reg flags for module structuring.</p><ul><li><p>A file whose only top-level declaration is <code>export namespace Foo &#123; ... &#125;</code>(remove <code>Foo</code> and move everything ‘up’ a level.)</p></li><li><p>A file that has a single <code>export class</code> or <code>export function</code>(consider using <code>export default</code>)</p></li><li><p>Multiple files that have the same <code>export namespace Foo</code> at top-level(don’t think that these are going to combine into one).</p></li></ul><h3 id="Best-Practice"><a href="#Best-Practice" class="headerlink" title="Best Practice"></a>Best Practice</h3><ul><li><p>While <code>namespaces</code> are still available in TypeScript, it is better to use modules as much as possible. This is because in most cases you will need to use external libraries in your application. In that case you will have to deal with modules because modules are the way to go with external none TypeScript libraries. Mixing namespaces and modules in one application is not a recommended practice.</p></li><li><p>Use modules and not namespaces if you are going to share your code as components or libraries to be consumed by other applications.</p></li><li><p>Use namespaces if your application is small and within the same application and when you do have any external dependencies like using external libraries or offering your code to be used by other application. You can still use modules in this case.</p></li></ul><h3 id="Working-with-External-Libraries"><a href="#Working-with-External-Libraries" class="headerlink" title="Working with External Libraries"></a>Working with External Libraries</h3><p>Importing a JavaScript Library.</p><p>There are two options to bring a javascript library in your typescrpt project:</p><ul><li><p>Manual download: this is by manually copying some definitions files for the obejcts used in the JavaScript Libraries into your TypeScript Project so that TypeScript can recognize and be able to support the typings. There is a big effort form the TypeScript community to provide those declaration files for almost all the third party JavaScript Libraries out there for developers to copy and include in their projects without having to rewrite the types themselves. This project is called the definitely typed project.</p></li><li><p>Using TyepSearch: This will automatically install the definition files for the imported libraries. The TypeSearch project that is a Microsoft initiative that uses npm to install lthe library definition files automatically with no need to manually copy any files.</p></li></ul><h4 id="Combine-two-namespaces-with-same-identifier"><a href="#Combine-two-namespaces-with-same-identifier" class="headerlink" title="Combine two namespaces with same identifier"></a>Combine two namespaces with same identifier</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// extendedNamespace_part2.d.ts</span></span><br><span class="line">namespace ArrayUtilities &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// extendedNamespace_part1.d.ts</span></span><br><span class="line"><span class="comment">/// &lt;reference path=&quot;extendedNamespace_part2.d.t.s&quot; /&gt;</span></span><br><span class="line">namespace ArrayUtilities &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Note on TS2 of edX</title>
      <link href="/2017/08/11/Note-on-TS2-of-edX/"/>
      <url>/2017/08/11/Note-on-TS2-of-edX/</url>
      
        <content type="html"><![CDATA[<h3 id="Classification-of-types-in-TypeScript"><a href="#Classification-of-types-in-TypeScript" class="headerlink" title="Classification of types in TypeScript"></a>Classification of types in TypeScript</h3><p>Types are classified into two main classes in TypeScript:</p><h4 id="Basic-or-Primitive-Types"><a href="#Basic-or-Primitive-Types" class="headerlink" title="Basic or Primitive Types"></a>Basic or Primitive Types</h4><ul><li><p>boolean</p></li><li><p>number</p></li><li><p>string</p></li><li><p>array: <code>number[]</code>, <code>Array&lt;number&gt;</code></p></li><li><p>tuple: <code>[string, number]</code></p></li><li><p>enum: <code>enum Color &#123;Red, Green = 2, Blue&#125;</code>, <code>let c : Color = Color.blue</code></p></li><li><p>null</p></li><li><p>undefined</p></li><li><p>any</p></li><li><p>void: exists purely to indicate the absence of a value, such as in a function with no return value.</p></li></ul><h4 id="Complex-or-Non-Primitive-Types"><a href="#Complex-or-Non-Primitive-Types" class="headerlink" title="Complex or Non-Primitive Types"></a>Complex or Non-Primitive Types</h4><ul><li><p>classes</p></li><li><p>interface</p></li></ul><h4 id="Type-Assertions"><a href="#Type-Assertions" class="headerlink" title="Type Assertions"></a>Type Assertions</h4><p>Sometimes you’ll end up in a situation where you’ll know more about a value than TypeScript does. Usually this will happen when you know the type of some entity could be more specific than its current type.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> someValue : any = <span class="string">&#x27;this is a string&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> strLength : number = (<span class="xml"><span class="tag">&lt;<span class="name">string</span>&gt;</span>someValue).length</span></span><br><span class="line"><span class="xml">let strLength : numner = (someValue as string).length</span></span><br></pre></td></tr></table></figure><h3 id="Complex-Types-in-TypeScript"><a href="#Complex-Types-in-TypeScript" class="headerlink" title="Complex Types in TypeScript"></a>Complex Types in TypeScript</h3><ul><li><p>Interface</p></li><li><p>Class Types</p></li><li><p>Function Types</p></li><li><p>Indexable Types</p></li><li><p>Classes</p></li></ul><h4 id="Excess-Property"><a href="#Excess-Property" class="headerlink" title="Excess Property"></a>Excess Property</h4><p>If <code>SquareConfig</code> can have <code>color</code> and <code>width</code> propertes, but could <em>also</em> have any number of other properties, then we could define it like so:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">interface SquareConfig &#123;</span><br><span class="line">  color?: string;</span><br><span class="line">  width?: number;</span><br><span class="line">  [propName: string]: any;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Class-Types"><a href="#Class-Types" class="headerlink" title="Class Types"></a>Class Types</h4><p>Implementing an interface</p><p>One of the most common use of interfaces in language like C# and java, that of explicitly enforcing that a class meets a particular contract, is also possible in TypeScript.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">interface ClockInterface &#123;</span><br><span class="line">  currentTime: <span class="built_in">Date</span>,</span><br><span class="line">  setTime(d: <span class="built_in">Date</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Clock</span> <span class="title">implements</span> <span class="title">ClockInterface</span> </span>&#123;</span><br><span class="line">  currentTime: <span class="built_in">Date</span>;</span><br><span class="line">  setDate(d: <span class="built_in">Date</span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>.currentTime = d;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">constructor</span> (h: number, m: number) &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Difference-between-the-static-and-instance-sides-of-classes"><a href="#Difference-between-the-static-and-instance-sides-of-classes" class="headerlink" title="Difference between the static and instance sides of classes"></a>Difference between the static and instance sides of classes</h4><p>When working with classes and interfaces, it helps to keep in mind that a class has <code>two</code> types: the type of the static side and the type of the instance side.</p><p>You may notice that if you create an interface with a constructor signature and try to create a class that implements this interface you get an error:</p><p>This is because when a class implements an interface, only the <strong>instance side</strong> of the class is checked. Since the constructor sits in the static side, it is not included in this check.</p><p>Instead, you would need to work with the static side of the class directly. In this example, we define two interfaces, <code>ClockConstructor</code> for the constructor and <code>Clockinterface</code> for the instance methods.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">interface ClockConstructor &#123;</span><br><span class="line">  <span class="keyword">new</span> (hour: number, <span class="attr">minute</span>: number): ClockInterface;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface ClockInterface &#123;</span><br><span class="line">  tick()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createClock</span>(<span class="params">ctor: ClockConstructor, hour: number, minute: number</span>): <span class="title">ClockInterface</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> ctor(hour, minute)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Function-Types"><a href="#Function-Types" class="headerlink" title="Function Types"></a>Function Types</h4><p>To describe a function type with an interface, we give the interface a call signature. This is like a function declaration with only the parameter list and return type given. Each parameter in the parameters list requires both name and type.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">interface SearchFunc &#123;</span><br><span class="line">  (source: string, <span class="attr">subString</span>: string): boolean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Once defined, we can use this function type interface like we would other interfaces.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> mySearch: SearchFunc</span><br><span class="line">mySearch = <span class="function"><span class="keyword">function</span> (<span class="params">source, subString</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> result = source.search(subString)</span><br><span class="line">  <span class="keyword">return</span> result &gt; <span class="number">-1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>For function types to correctly type-check, the names of the parameters do not need to match. We could have, for example, written the above example like this:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> mySearch: SearchFunc</span><br><span class="line">mySearch = <span class="function"><span class="keyword">function</span> (<span class="params">src: string, sub: string</span>): <span class="title">boolean</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> result = src.search(sub)</span><br><span class="line">  <span class="keyword">return</span> result &gt; <span class="number">-1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Function parameters are checked one at a time, with the type in each corresponding parameter position checked against each other. If you do not want to specify types at all, TypeScript’s contextual typing can infer the argument types since the function value is assigned directly to a variable of type <code>SearchFunc</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> mySearch: SearchFunc</span><br><span class="line">mySearch = <span class="function"><span class="keyword">function</span> (<span class="params">src, sub</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> result = src.search(sub)</span><br><span class="line">  <span class="keyword">return</span> result &gt; <span class="number">-1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Indexable-Types"><a href="#Indexable-Types" class="headerlink" title="Indexable Types"></a>Indexable Types</h4><p>Intexable types have an <em>index signature</em> that describes the types we can use to index into the object, along with the corresponding return types when indexing.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">interface StringArray &#123;</span><br><span class="line">  [index: number]: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> myArray: StringArray;</span><br><span class="line">myArray = [<span class="string">&#x27;Bob&#x27;</span>, <span class="string">&#x27;Fred&#x27;</span>];</span><br></pre></td></tr></table></figure><p>Above we have a StringArray interface that has an index signature. This index signature states that when a StringArray is indexed with a number, it will return a string.</p><p>There are two types of supported index signature: string an number. It is possible to support both types of indexer, but the type returned from a numeric indexer must be a subtype of the type returned from the string indexer. This is because when indexing witha  number, javascript will actually convert that to a string before indexing into a object.</p><h3 id="Classes"><a href="#Classes" class="headerlink" title="Classes"></a>Classes</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Greeter</span> </span>&#123;</span><br><span class="line">  greeting: string;</span><br><span class="line">  <span class="keyword">constructor</span> (message: string) &#123;</span><br><span class="line">    <span class="built_in">this</span>.greeting = message</span><br><span class="line">  &#125;</span><br><span class="line">  greet () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Hello, &quot;</span> + <span class="built_in">this</span>.greeting;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> greeter = <span class="keyword">new</span> Greeter(<span class="string">&#x27;World&#x27;</span>)</span><br></pre></td></tr></table></figure><p>This class has three members: a property called <code>greeting</code>, a constructor, and a method <code>greet</code>.</p><p>In the last line we construct an instance of the Greeter class using <code>new</code>. This calls into the constructor we defined earlier, creating a new object with the Greeter shape, and running the constructor to initialize it.</p><h4 id="Public-Private-and-Protected-Modifiers"><a href="#Public-Private-and-Protected-Modifiers" class="headerlink" title="Public, Private, and Protected Modifiers"></a>Public, Private, and Protected Modifiers</h4><p>Public by default.</p><p>When a member is marked <code>private</code>, it cannot be accessed from outside of its containing class.</p><p>When comparing types that have <code>private</code> and <code>protected</code> members, TypeScript treats these types differently. For two types to be considered compatible, if one of them has a <code>private</code> member, then the other must have a <code>private</code> member that originated in the same declaration.</p><p>The <code>protected</code> modifier acts much like the <code>private</code> modifier with the exectpion the members declared <code>protected</code> can also be accessed by instance of deriving classes.</p><p>A constructor may also be marked <code>protected</code>. This means that the class cannot be instantiated outside of its containing class, but can be extended.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  protected name: string;</span><br><span class="line">  protected <span class="keyword">constructor</span> (theName: string) &#123;</span><br><span class="line">    <span class="built_in">this</span>.name = theName</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Employee can extend Person</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span> <span class="keyword">extends</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  private department: string;</span><br><span class="line">  <span class="keyword">constructor</span> (name: string, department: string) &#123;</span><br><span class="line">    <span class="built_in">super</span>(name)</span><br><span class="line">    <span class="built_in">this</span>.department = department</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> howard = <span class="keyword">new</span> Employee(<span class="string">&#x27;Howard&#x27;</span>, <span class="string">&#x27;Sales&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> john = <span class="keyword">new</span> Persno(<span class="string">&#x27;john&#x27;</span>) <span class="comment">// Error, the &#x27;Person&#x27; constructor is protceted.</span></span><br></pre></td></tr></table></figure><p>You can make properties readonly by using the <code>readonly</code> keyword. Readonly properties must be initilized at their declaration or in the constructor.</p><h4 id="Parameter-Propertes"><a href="#Parameter-Propertes" class="headerlink" title="Parameter Propertes"></a>Parameter Propertes</h4><p><em>Parameter Properties</em> let you create and initialize a member in one place.</p><h4 id="Accessors"><a href="#Accessors" class="headerlink" title="Accessors"></a>Accessors</h4><p>TypeScript supports <strong>getter/setters</strong> as a way of intercepting accesses to a member of an object. This gives you a way of having finer-grained control over how a member is accessed on each object.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> passcode = <span class="string">&#x27;secret passcode&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line">  private _fullName: string;</span><br><span class="line">  <span class="keyword">get</span> <span class="title">fullName</span>(): <span class="title">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._fullName</span><br><span class="line">  &#125;</span><br><span class="line">  set fullName (newName: string) &#123;</span><br><span class="line">    <span class="keyword">if</span> (passcode &amp;&amp; passcode === <span class="string">&#x27;secret passcode&#x27;</span>) &#123;</span><br><span class="line">      <span class="built_in">this</span>._fullName = newName</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;Error: Unauthorized update of employee&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Accessors with a get and no set are automatically inferred to be <code>readonly</code>.</p><h3 id="Static-Properties"><a href="#Static-Properties" class="headerlink" title="Static Properties"></a>Static Properties</h3><p>Static Members of a class are those visible on class itself rather than on the instance.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Grid</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> origin = &#123;<span class="attr">x</span>: <span class="number">0</span>, <span class="attr">y</span>: <span class="number">0</span>&#125;</span><br><span class="line">  calculatedDistanceFromOrigin(point: &#123; <span class="attr">x</span>:number, <span class="attr">y</span>: number &#125;) &#123;</span><br><span class="line">    <span class="keyword">let</span> xDist = (point.x - Grid.origin.x)</span><br><span class="line">    <span class="keyword">let</span> yDist = (point.y - Grid.origin.y)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.sqrt(xDist * xDist + yDist * yDist) / <span class="built_in">this</span>.scale</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span> (public scale: number) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> grid1 = <span class="keyword">new</span> Grid(<span class="number">1.0</span>)</span><br><span class="line"><span class="keyword">let</span> grid2 = <span class="keyword">new</span> Grid(<span class="number">5.0</span>)</span><br></pre></td></tr></table></figure><h3 id="Abstract-Classes"><a href="#Abstract-Classes" class="headerlink" title="Abstract Classes"></a>Abstract Classes</h3><p>Abstract Classes are base classes from which other classes may be derived. They may not be instantiated directly. Unlike an interface, an abstract class may contain implementation details for its members. The <code>abstract</code> keyword is used to define abstract classes as well as abstract methods within an abstract class.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">abstract <span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  abstract makeSound(): <span class="keyword">void</span>;</span><br><span class="line">   move () : <span class="keyword">void</span> &#123;</span><br><span class="line">     <span class="built_in">console</span>.log &#123;<span class="string">&#x27;roaming the earth...&#x27;</span>&#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Methods within an abstract class that are marked as abstract do not contain an implementation and must be implemented in derived classes. Abstract methods share a similar syntax to interface methods. Both define the signature of a method without including a method body. However, abstract methods must include the <code>abstract</code> keyword and may optionally include access modifier.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">abstract <span class="class"><span class="keyword">class</span> <span class="title">Department</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> (public name: string) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  printName () : <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Department name: &#x27;</span> + <span class="built_in">this</span>.name)</span><br><span class="line">  &#125;</span><br><span class="line">  abstract printMeeting (): <span class="keyword">void</span> <span class="comment">// must be implemented in derived classes</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AccountingDepartment</span> <span class="keyword">extends</span> <span class="title">Department</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> () &#123;</span><br><span class="line">    <span class="built_in">super</span>(<span class="string">&#x27;Accounting and Auditing&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  printMeeting () : <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;The Accounting Department meets each Monday at 10am&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  generateReports () : <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Generating accounting reports...&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> department: Department; <span class="comment">// ok to create a reference to an abstract type</span></span><br><span class="line">department = <span class="keyword">new</span> Department(); <span class="comment">// error: cannot create an instance of an abstract class</span></span><br><span class="line">department = <span class="keyword">new</span> AccountingDepartment(); <span class="comment">// ok to create and assign a non-abstract subclass</span></span><br><span class="line">department.printName()</span><br><span class="line">department.printMeeting()</span><br><span class="line">department.generateReports()</span><br></pre></td></tr></table></figure><h3 id="Advanced-Techniques"><a href="#Advanced-Techniques" class="headerlink" title="Advanced Techniques"></a>Advanced Techniques</h3><h4 id="Constructor-functions"><a href="#Constructor-functions" class="headerlink" title="Constructor functions"></a>Constructor functions</h4><p>When you declare a class in TypeScript, you are actually creating multiple delcaration at the same time. The first is the type of the <code>instance</code> of the class</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Greeter</span> </span>&#123;</span><br><span class="line">  greeting: string;</span><br><span class="line">  <span class="keyword">constructor</span> (message: string) &#123;</span><br><span class="line">    <span class="built_in">this</span>.greeting = message</span><br><span class="line">  &#125;</span><br><span class="line">  greet () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello, &#x27;</span> + <span class="built_in">this</span>.message</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> greeter: Greeter</span><br><span class="line">greeter = <span class="keyword">new</span> Greeter(<span class="string">&#x27;world&#x27;</span>)</span><br><span class="line"><span class="built_in">console</span>.log(greeter.greet())</span><br></pre></td></tr></table></figure><p>Here, when we say <code>let greeter: Greeter</code> we’re using <code>Greeter</code> as the type of instance of the class <code>Greeter</code>. This is almost second nature to programmers from other oo language.</p><p>We’re also creating another value that we call the <code>constructor function</code>. This is the function that is called when we <code>new</code> up instance of the class. To see what this looks in practice, let’s take a look at the JavaScript created the above example:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> Greeter = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">Greeter</span>(<span class="params">message</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.greeting = message</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Greeter.prototype.greet = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello, &#x27;</span> + <span class="built_in">this</span>.greeting</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> Greeter</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> greeter</span><br><span class="line">greeter = <span class="keyword">new</span> Greeter(<span class="string">&#x27;world&#x27;</span>)</span><br><span class="line"><span class="built_in">console</span>.log(greeter.greet())</span><br></pre></td></tr></table></figure><p>Here <code>let Greeter</code> is going to be assigned the constructor function. When we call <code>new</code> and run this function, we get an instance of the class. The constructor function also contains all of the static members of the class. Another way to think of each class is that there is an <em>instance</em> side and a <em>static</em> side.</p><h4 id="Using-a-class-as-an-interface"><a href="#Using-a-class-as-an-interface" class="headerlink" title="Using a class as an interface"></a>Using a class as an interface</h4><p>As mentioned above, a class declaration creates two things: a type representing instances of the class, and a constructor function. Because classes creates types, you can use them in the same places you would be able to use interfaces:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">  x: number;</span><br><span class="line">  y: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface Point3D <span class="keyword">extends</span> Point &#123;</span><br><span class="line">  z: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> point3d: Point3D = &#123;</span><br><span class="line">  x: <span class="number">1</span>,</span><br><span class="line">  y: <span class="number">2</span>,</span><br><span class="line">  z: <span class="number">3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Inheritance"><a href="#Inheritance" class="headerlink" title="Inheritance"></a>Inheritance</h3><p>In TypeScript, we can use common object-orientad pattern. Of course, one of the most fundamental patterns in class-based programming is being able to extend existing classes to create new ones using inheritance.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  name: string;</span><br><span class="line">  <span class="keyword">constructor</span> (theName: string) &#123;</span><br><span class="line">    <span class="built_in">this</span>.name = theName</span><br><span class="line">  &#125;</span><br><span class="line">  move (distanceInMeters: number = <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.name&#125;</span> move <span class="subst">$&#123;distanceInMeters&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Snake</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> (name: string) &#123;</span><br><span class="line">    <span class="built_in">super</span>(name)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  move (distanceInMeters = <span class="number">5</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Slithering...&#x27;</span>)</span><br><span class="line">    <span class="built_in">super</span>.move(distanceInMeters)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Horse</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> (name: string) &#123;</span><br><span class="line">    <span class="built_in">super</span>(name)</span><br><span class="line">  &#125;</span><br><span class="line">  move (distanceInMeters = <span class="number">45</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Galloping...&#x27;</span>)</span><br><span class="line">    <span class="built_in">super</span>.move(distanceInMeters)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Derived classes that contain constructor functions must call <code>super()</code> which will execute the constructor function on the base class.</p><h4 id="Interfaces-Extending-Classes"><a href="#Interfaces-Extending-Classes" class="headerlink" title="Interfaces Extending Classes"></a>Interfaces Extending Classes</h4><p>When an interface type extends a class type it inherits the memembers of the class but not their implementations. <strong>It is as if the interface had declared all of the members of the class without providing an implementation.</strong> Interface inherit event the private and protected members of a base class. This means that when you create an interface that extends a class with private or protected memebrs, that interface type can only be implemented by the class or a subclass of it.</p><p>This is useful when you have a large inheritance hierarchy, but want to specify that you code works iwth only subclasses that have certain properties. The subclasses don’t have to be related besides inheriting from the base class.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Control</span> </span>&#123;</span><br><span class="line">  private state: any;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface SelectableControl <span class="keyword">extends</span> Control &#123;</span><br><span class="line">  select () : <span class="keyword">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Button</span> <span class="keyword">extends</span> <span class="title">Control</span> </span>&#123;</span><br><span class="line">  select () &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TextBox</span> <span class="keyword">extends</span> <span class="title">Control</span> </span>&#123;</span><br><span class="line">  select () &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Image</span> </span>&#123;</span><br><span class="line">  select () &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Location</span> </span>&#123;</span><br><span class="line">  select () &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>In the above example, <code>SelectableControl</code> contains all of the members of Control, including the <code>private state</code> property. Since <code>state</code> is a private member it is only possible for descendants of Control to implement <code>SelectableControl</code>. This is because only descendants of Control will have a <code>state</code> private member that originates in the same declaration, which is a requirement for private members to be compatible.</p><p>Within the <code>Control</code> class it is possible to access the <code>state</code> private member through an instance of <code>SelectableControl</code>. Effectively, a <code>SelectableControl</code> acts like a <code>Control</code> that is known to have a <code>select</code> method. The <code>Button</code> and <code>TextBox</code> classes are subtypes of <code>SelectableControl</code>, but <code>Image</code> and <code>Location</code> are not.</p><h3 id="Type-Compatibility"><a href="#Type-Compatibility" class="headerlink" title="Type Compatibility"></a>Type Compatibility</h3><p>Type compatibility in TypeScript is based on structural subtyping. Structural typing is a way of relating types based on solely on their members. This is in contrast with normal typing.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">interface Named &#123;</span><br><span class="line">  name: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  name: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> p: Named;</span><br><span class="line"></span><br><span class="line"><span class="comment">// OK, because of structural typing</span></span><br><span class="line">p = <span class="keyword">new</span> Person()</span><br></pre></td></tr></table></figure><p>A basic rule for TypeScript’s structural type system is that x is compatible with y if y has at least the same members as x.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">interface Named &#123;</span><br><span class="line">  name: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> x: Named;</span><br><span class="line"></span><br><span class="line"><span class="comment">// y&#x27;s inferred type is &#123; name: string; location: string; &#125;</span></span><br><span class="line"><span class="keyword">let</span> y = &#123; <span class="attr">name</span>: <span class="string">&#x27;Alice&#x27;</span>, <span class="attr">location</span>: <span class="string">&#x27;Seattle&#x27;</span> &#125;</span><br><span class="line">x = y</span><br></pre></td></tr></table></figure><h4 id="Comparing-Two-Functions"><a href="#Comparing-Two-Functions" class="headerlink" title="Comparing Two Functions"></a>Comparing Two Functions</h4><p>While comparing primitive types and object types is relatively straightforward, the question of what kinds of functions should be considered compatible is a bit more involved.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> x = <span class="function">(<span class="params">a: number</span>) =&gt;</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">let</span> y = <span class="function">(<span class="params">b: number, s: string</span>) =&gt;</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">y = x <span class="comment">// ok</span></span><br><span class="line">x = y <span class="comment">// Error</span></span><br></pre></td></tr></table></figure><p>To check if x is assignable to y, we first look at the parameter list. Each parameter in x must have a corresponding parameter in y with a compatible type. Note that the name of the parameters are not considered, only their types. In this case, every parameter of x has a corresponding compatible parameter in y, so x is assignable to y.</p><p>To ensure that every parameter in x can be checked in y.</p><h4 id="Enums"><a href="#Enums" class="headerlink" title="Enums"></a>Enums</h4><p>Enums are compatible with numbers, and numers are compatible with enums.</p><p>Enum values from different enum types are considered incompatible.</p><h4 id="Classes-1"><a href="#Classes-1" class="headerlink" title="Classes"></a>Classes</h4><p>Classes work similarly to object literal types and interfaces with one exception: they have both a static and an instance type. When comparing two objects of a class type, only members of the instance are compared. Static memebrs and constructor do not affect compatibility.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  feet: number;</span><br><span class="line">  <span class="keyword">constructor</span> (name: string, numFeet: number) &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Size</span> </span>&#123;</span><br><span class="line">  feet: number;</span><br><span class="line">  <span class="keyword">constructor</span> (numFeet: number) &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a: Animal</span><br><span class="line"><span class="keyword">let</span> s: Size</span><br><span class="line"></span><br><span class="line">a = s <span class="comment">// ok</span></span><br><span class="line">s = a <span class="comment">// ok</span></span><br></pre></td></tr></table></figure><p>Private and protected members in a class affect their compatibility. When an instance of a class is checked for compatibility, if the target type contains a private member, then the source type must also contain a private member that originated from the same class.</p><h4 id="Contextual-Type"><a href="#Contextual-Type" class="headerlink" title="Contextual Type"></a>Contextual Type</h4><p>Type inference also work in ‘the other direction’ in some cases in TypeScript. This is known as ‘contextual typing’. Contextual typing occurs when the type of an expression is implied by its location.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.onmousedown = <span class="function"><span class="keyword">function</span> (<span class="params">mouseEvent</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(mouseEvent.buton) <span class="comment">// &lt;- Error</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Functions-and-function-Types"><a href="#Functions-and-function-Types" class="headerlink" title="Functions and function Types"></a>Functions and function Types</h3><p>TypeScript functions can be created both as a named function or as an anonymous function. This allows you to choose the most appropriate approach for your application, whether you’re building a list of functions in an API or a one-off function to hand off to another function.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Named Function</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Anonymouse Function</span></span><br><span class="line"><span class="keyword">let</span> myAdd = <span class="function"><span class="keyword">function</span> (<span class="params">x, y</span>) </span>&#123; <span class="keyword">return</span> x + y &#125;</span><br></pre></td></tr></table></figure><h4 id="Function-Types-1"><a href="#Function-Types-1" class="headerlink" title="Function Types"></a>Function Types</h4><p>Typing the function.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">x: number, y: number</span>): <span class="title">number</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Writing the function type</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> myAdd: <span class="function">(<span class="params">x: number, y: number</span>) =&gt;</span> number = <span class="function"><span class="keyword">function</span>(<span class="params">x, y</span>) </span>&#123; <span class="keyword">return</span> x + y &#125;</span><br></pre></td></tr></table></figure><p>A function’s type has the same two parts: the type of the arguments and the return type. When writing out the whole function type, both parts are required.</p><h3 id="Context-and-Scope"><a href="#Context-and-Scope" class="headerlink" title="Context and Scope"></a>Context and Scope</h3><p><code>this</code> and <code>arrow function</code>.</p><p>In JavaScript, <strong><code>this</code> is a variable that’s set when a function is called</strong>. This makes it a very powerful and flexible feature, but it comes at the cost of always having to know about the context that a function is executing in.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> deck = &#123;</span><br><span class="line">  suits: [<span class="string">&#x27;hearts&#x27;</span>, <span class="string">&#x27;spades&#x27;</span>, <span class="string">&#x27;clubs&#x27;</span>, <span class="string">&#x27;diamonds&#x27;</span>],</span><br><span class="line">  cards: <span class="built_in">Array</span>(<span class="number">52</span>),</span><br><span class="line">  createCardPicker: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">let</span> pickedCard = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">52</span>)</span><br><span class="line">      <span class="keyword">let</span> pickedSuit = <span class="built_in">Math</span>.floor(pickedCard / <span class="number">13</span>)</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">suit</span>: <span class="built_in">this</span>.suits[pickedSuit], <span class="attr">card</span>: pickedCard % <span class="number">13</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Here the function returned by <code>createCardPicker</code> will be called by <code>window</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> deck &#123;</span><br><span class="line">  suits: [<span class="string">&#x27;hearts&#x27;</span>, <span class="string">&#x27;spades&#x27;</span>, <span class="string">&#x27;clubs&#x27;</span>, <span class="string">&#x27;diamonds&#x27;</span>],</span><br><span class="line">  cards: <span class="built_in">Array</span>(<span class="number">52</span>),</span><br><span class="line">  createCardPicker: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">NOTE:</span> the line below is now an arrow function, which will capture &#x27;this&#x27; when then function is declared.</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> pickedCard = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">52</span>)</span><br><span class="line">      <span class="keyword">let</span> pickedSuit = <span class="built_in">Math</span>.floor(pickedCard / <span class="number">13</span>)</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">suit</span>: <span class="built_in">this</span>.suits[pickedSuit], <span class="attr">card</span>: pickedCard % <span class="number">13</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Overloads"><a href="#Overloads" class="headerlink" title="Overloads"></a>Overloads</h3><p>JavaScript is inherently a very dynamic language. It’s not uncommon for a single JavaScript function to return different types of objects based on the shape of the arguments passed in.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> suits = [<span class="string">&#x27;hearts&#x27;</span>, <span class="string">&#x27;spades&#x27;</span>, <span class="string">&#x27;clubs&#x27;</span>, <span class="string">&#x27;diamonds&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pickCard</span>(<span class="params">x</span>): <span class="title">any</span> </span>&#123;</span><br><span class="line">  <span class="comment">// Check to see if we&#x27;re working with an object/array</span></span><br><span class="line">  <span class="comment">// if so, they gave us the deck and we&#x27;ll pick the card</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> x == <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> pickedCard = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * x.length)</span><br><span class="line">    <span class="keyword">return</span> pickedCard</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> x === <span class="string">&#x27;number&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> pickedSuit = <span class="built_in">Math</span>.floor(x / <span class="number">13</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">suit</span>: suits[pickedSuit], <span class="attr">card</span>: x % <span class="number">13</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Here the <code>pickCard</code> function will return two different things based on what the user ahs passed in.</p><p>Use overloads.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> suits = [<span class="string">&#x27;hearts&#x27;</span>, <span class="string">&#x27;spades&#x27;</span>, <span class="string">&#x27;clubs&#x27;</span>, <span class="string">&#x27;diamonds&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pickCard</span>(<span class="params">x: &#123; suit: string, card: number &#125;[]</span>): <span class="title">number</span></span></span><br><span class="line"><span class="function"><span class="title">function</span> <span class="title">pickCard</span>(<span class="params">x: number</span>): </span>&#123; suit: string, <span class="attr">card</span>: number &#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pickCard</span>(<span class="params">x</span>): <span class="title">any</span> </span>&#123;</span><br><span class="line">  <span class="comment">// Check to see if we&#x27;re working with an object/array</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> x === <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> x === <span class="string">&#x27;number&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Note that the <code>function pickCard(x): any</code> is not part of the overload list.</p><h3 id="Namespaces"><a href="#Namespaces" class="headerlink" title="Namespaces"></a>Namespaces</h3><p>Namespaces are used as a way to organize the code so that you can keep track of your types and not worry about name collisions with other object. Instead of putting lots of different names into the global namespace, you can wrap up your object into a namespace. The choice of what objects go in what namespaces is totally up to your organization preference.</p><p>If you want the interfaces and classes in your namespaces to be visible outside the namespace, you need to preface their declaration with <code>export</code> keyword.</p><p>Also keep in mind that classes, interfaces and variable names within a namespace has to be unique.</p><h4 id="Multi-file-namespaces"><a href="#Multi-file-namespaces" class="headerlink" title="Multi-file namespaces"></a>Multi-file namespaces</h4><p>You can split a namespace across many files, even though the fiels a separate, they can each contribute to the same namespace and can be consumed as if they were all defined in one place. Because there are dependencies between files. you will add <code>reference</code> tags to tell the compiler about the relationship between the files.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ZooAnimals.ts</span></span><br><span class="line"></span><br><span class="line">namespace Zoo &#123;</span><br><span class="line">  interface Animal &#123;</span><br><span class="line">    <span class="comment">//<span class="doctag">NOTE:</span> we do not need the &#x27;export&#x27; here since this interface will only be accessible by enttites from within the Zoo namespace.</span></span><br><span class="line">    skinType: string;</span><br><span class="line">    isMammal() : boolean;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ZooWild.ts</span></span><br><span class="line"><span class="comment">/// &lt;reference path=&quot;ZooAnimals.ts&quot; /&gt;</span></span><br><span class="line">namespace Zoo &#123;</span><br><span class="line">  <span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Reptile</span> <span class="title">implements</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">NOTE:</span> we need the &#x27;export&#x27; here to be able to access this class and instantiate objects of the Reptile type</span></span><br><span class="line">    skinType: <span class="string">&#x27;scales&#x27;</span>;</span><br><span class="line">    isMammal () &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ZooBirds.ts</span></span><br><span class="line"><span class="comment">/// &lt;reference path=&quot;ZooAnimals.ts&quot; /&gt;</span></span><br><span class="line">namespace Zoo &#123;jkj</span><br><span class="line">  <span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Bird</span> <span class="title">implements</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">    skinType: <span class="string">&#x27;feather&#x27;</span></span><br><span class="line">    isMammal () &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Once there are multiple fiels involved, we’ll need to make sure all of the compiled code gets loaded, we can use concatenated output using the <code>--outFile</code> flag to compile all of the input files into a single JavaScript output file.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tsc --outFile zoo.js ZooAnimal.ts ZooWild.ts ZooBirds.ts</span><br></pre></td></tr></table></figure><h4 id="Referencing-namespacing-entities-in-your-code"><a href="#Referencing-namespacing-entities-in-your-code" class="headerlink" title="Referencing namespacing entities in your code"></a>Referencing namespacing entities in your code</h4><p>Namespaces can be accessed either in the same file where the namespace is defined or another .ts file. The only control on access is whether you are using the <code>export</code> keyword or not for the namespace entities.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> parrot = <span class="keyword">new</span> Zoo.Bird();</span><br></pre></td></tr></table></figure><h4 id="Aliases"><a href="#Aliases" class="headerlink" title="Aliases"></a>Aliases</h4><p>You can simplify working with namespaces by using Aliases. You can use <code>import q = x.y.z</code> to create shorter names for commonly-used objects.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> rep = Zoo.Reptitle;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> lizard: rep;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> TypeScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Build GraphQL Server With Koa</title>
      <link href="/2017/08/10/Build-GraphQL-Server-with-Koa/"/>
      <url>/2017/08/10/Build-GraphQL-Server-with-Koa/</url>
      
        <content type="html"><![CDATA[<p>Here is the example <a href="http://ezcook.de/2017/08/07/Build-GraphQL-Server-with-Express/">Build GraphQL Server with Express</a></p><p>The only difference from that example is the way plugining middleware.</p><p>In <code>server.js</code> of Koa:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> Koa <span class="keyword">from</span> <span class="string">&#x27;koa&#x27;</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> GraphqlHTTP <span class="keyword">from</span> <span class="string">&#x27;koa-graphql&#x27;</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> Router <span class="keyword">from</span> <span class="string">&#x27;koa-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Schema <span class="keyword">from</span> <span class="string">&#x27;./schema&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> PORT = <span class="number">3457</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router()</span><br><span class="line">router.all(<span class="string">&#x27;/graphql&#x27;</span>, GraphqlHTTP(&#123;</span><br><span class="line">  schema: Schema,</span><br><span class="line">  pretty: <span class="literal">true</span>,</span><br><span class="line">  graphiql: <span class="literal">true</span>,</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line">app.use(router.routes()).use(router.allowedMethods())</span><br><span class="line"></span><br><span class="line">app.listen(PORT, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;server is running at: &#x27;</span> + PORT)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> GraphQL </tag>
            
            <tag> Node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>History API</title>
      <link href="/2017/08/09/History-API/"/>
      <url>/2017/08/09/History-API/</url>
      
        <content type="html"><![CDATA[<p>The DOM window object provides access to the browser’s history through the <code>history</code> object.</p><h3 id="Moving-Forward-and-Backward"><a href="#Moving-Forward-and-Backward" class="headerlink" title="Moving Forward and Backward"></a>Moving Forward and Backward</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.history.back()</span><br><span class="line"><span class="built_in">window</span>.history.forward()</span><br></pre></td></tr></table></figure><h3 id="Moving-to-a-specific-point-in-history"><a href="#Moving-to-a-specific-point-in-history" class="headerlink" title="Moving to a specific point in history"></a>Moving to a specific point in history</h3><p>You can use the <code>go()</code> method to load a specific page from session history, identified by its relative position to the current page.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.history.go(<span class="number">-1</span>)</span><br><span class="line"><span class="built_in">window</span>.history.go(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>You can determine the number of pages in the history stack by looking at the value of the length property:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> numberOfEntries = <span class="built_in">window</span>.history.length</span><br></pre></td></tr></table></figure><h3 id="Adding-and-Modifying-History-Entries"><a href="#Adding-and-Modifying-History-Entries" class="headerlink" title="Adding and Modifying History Entries"></a>Adding and Modifying History Entries</h3><p><code>history.pushState()</code> and <code>history.replaceState()</code> methods work in conjunction with the <code>window.onpopstate</code> event.</p><p>Using <code>history.pushState()</code> changes the referrer that gets used in the HTTP header for <code>XMLHttpRequest</code> objects created after you change the state. The referrer will be the URL of the document whose window is this at the time of creation of the <code>XMLHttpRequest</code> object.</p><h4 id="Example-of-pushState-Method"><a href="#Example-of-pushState-Method" class="headerlink" title="Example of pushState() Method"></a>Example of pushState() Method</h4><p>Suppose <a href="http://mozilla.org/foo.html">http://mozilla.org/foo.html</a> executes the following JS.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// history.pushState(StateObj, title, URL)</span></span><br><span class="line"><span class="keyword">var</span> stateObj = &#123; <span class="attr">foo</span>: <span class="string">&#x27;bar&#x27;</span> &#125;</span><br><span class="line">history.pushState(&#123; stateObj, <span class="string">&#x27;page 2&#x27;</span>, <span class="string">&#x27;bar.html&#x27;</span> &#125;)</span><br></pre></td></tr></table></figure><p>This will cause the URL bar to display <a href="http://mozilla.org/bar.html">http://mozilla.org/bar.html</a>, but won’t cause the browser to load <code>bar.html</code> or even check that <code>bar.html</code> exists.</p><p>Suppose now that the user now navigates to <a href="http://google.com/">http://google.com</a>, then click back. At this point, the URL bar will display <a href="http://mozilla.org/bar.html">http://mozilla.org/bar.html</a>, and the page will get a <code>popstate</code> event whose <code>state object</code> contains a copy of <code>stateObj</code>.</p><p>If we click back again, the URL change to <a href="http://mozilla.org/foo.html">http://mozilla.org/foo.html</a>, and the document will get another <code>popstate</code> event, this time with a null state object.(which is different from replaceState).</p><h4 id="The-pushState-method"><a href="#The-pushState-method" class="headerlink" title="The pushState() method"></a>The pushState() method</h4><p><code>pushState()</code> takes three arguments: a state object, a title(which is currently ignored), and (optionally) a URL.</p><ul><li><code>state object</code> - The state object is a javascript object which is associated with the new history entry created by <code>pushState</code>. Whenever the user navigates to the new state, a <code>popstate</code> event is fired, and the state property of the event contains a copy of the history entry’s state object.</li></ul><p>The state object can be anything that can be serialized. Because Firefox saves the state objects to the user’s disk so they can be restored after the user restarts the browser, we impose a size limit of 640k characters on the serialized representation of a state object. If you pass a state object whose serialized representation is larger than this to <code>pushState()</code>, the method will throw an exception. If you need more space than this, you’re encouraged to use <code>sessionStorage</code> and/or <code>localStorage</code>.</p><ul><li><p><code>title</code> - Firefox currently ingores this parameter, although it may use it in the future. Passing the empty string here should be safe against future changes to the method.</p></li><li><p><code>URL</code> - The new history entry’s URL is given by this parameter. Note that the browser won’t attempt to load this URL after a call to <code>pushState()</code>, but it might attempt to load the URL later, for instance after the user restarts the browser. The new URL does not need to be absolute; if it’s relative, it’s resolved to the current URL. The new URL must be of the same origin as the current URL; otherwise <code>pushState</code> will throw an exception. The parameter is optional, if it isn’t specified, it’s set to the document’s current URL.</p></li></ul><p>In a sense, calling <code>pushState()</code> is similar to setting <code>window.location = &#39;#foo&#39;</code>, in that both will create and activate another history entry associated with the current document, but <code>pushState</code> has a few advantages:</p><ul><li><p>The new URL can be any URL in the same origin as the current URL. In contrast, setting <code>window.location</code> keeps you at the same document only if you modify only the hash</p></li><li><p>You don’t have to change the URL if you don’t want to. In contrast, setting <code>window.location = &#39;#foo&#39;</code> only creates a new history entry if the current hash isn’t <code>#hash</code></p></li><li><p>You can associate arbitrary data with your new history entry. With the hash-based approach, you need to encode all of the relevant data int o a short string.</p></li></ul><h4 id="The-replaceState-method"><a href="#The-replaceState-method" class="headerlink" title="The replaceState() method"></a>The replaceState() method</h4><p><code>history.replaceState()</code> operates exactly like <code>history.pushState()</code> except the <code>replaceState()</code> modifies the current history entry instead of creating a new one. Note that this doesn’t prevent the creation of a new entry in the global browser history.</p><p><code>replaceState()</code> is particularly useful when you want to upate the state object or URL of the current history entry in reponse to some user action.</p><h4 id="Example-of-replaceState-method"><a href="#Example-of-replaceState-method" class="headerlink" title="Example of replaceState() method"></a>Example of replaceState() method</h4><p>Suppose <a href="http://mozilla.org/foo.html">http://mozilla.org/foo.html</a> executes the following JS:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> stateObj = &#123; <span class="attr">foo</span>: <span class="string">&#x27;bar&#x27;</span> &#125;</span><br><span class="line">history.replaceState(stateObj, <span class="string">&#x27;page 2&#x27;</span>, <span class="string">&#x27;bar.htmk&#x27;</span>)</span><br></pre></td></tr></table></figure><p>This will cause the URL bar to display <a href="http://mozilla.org/bar.html">http://mozilla.org/bar.html</a>, but won’t cause the browser to load bar.html or even check that bar.html exists.</p><p>Suppose now that the user navigates to <a href="http://www.microsoft.com/">http://www.microsoft.com</a>, then clicks back. At this point, the URL bar will display <a href="http://mozilla.org/bar.html">http://mozilla.org/bar.html</a>.</p><p>If you click back again, you will be nagivated to the page before foo.html. (which is different from pushState())</p><h3 id="The-popstate-event"><a href="#The-popstate-event" class="headerlink" title="The popstate event"></a>The popstate event</h3><p>A popstate event is dispatched to the <code>window</code> every time the active history entry changes. If the history entry being activated was created by a call to <code>pushState</code> or affected by <code>replaceState</code>, the <code>popstate</code> event’s <code>state</code> property contains a copy of the history entry’s state object.</p><h3 id="Reading-the-current-state"><a href="#Reading-the-current-state" class="headerlink" title="Reading the current state"></a>Reading the current state</h3><p>When your page loads, it might have a non-null state object. This can be happen, for example, if the page sets a state object(by <code>pushState</code>, or <code>replaceState</code>) and then the user restarts their browser. When your page reloads, the page will receive an <code>onload</code> event, but no <code>popstate</code> event. However if you read the <code>history.state</code> property, you’ll get back the state object you would have to gotten if a <code>popstate</code> had fired.</p><p>You can read it directly:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> currentState = history.state</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> HTML </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Note on Sequelize</title>
      <link href="/2017/08/07/Note-on-Sequelize/"/>
      <url>/2017/08/07/Note-on-Sequelize/</url>
      
        <content type="html"><![CDATA[<p>Sequelize is a promise-based ORM for Node.</p><h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Sequelize = <span class="built_in">require</span>(<span class="string">&#x27;sequelize&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> sequelize = <span class="keyword">new</span> Sequeslize(<span class="string">&#x27;database&#x27;</span>, <span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;password&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> User = sequelize.define(<span class="string">&#x27;user&#x27;</span>, &#123;</span><br><span class="line">  username: Sequelize.STRING,</span><br><span class="line">  birthday: Sequelize.DATE,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">sequelize.sync().then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  User.create(&#123;</span><br><span class="line">    username: <span class="string">&#x27;Jane&#x27;</span>,</span><br><span class="line">    birthday: <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">1980</span>, <span class="number">5</span>, <span class="number">2</span>),</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;).then(<span class="function"><span class="params">jane</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;create successfully&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Start"><a href="#Start" class="headerlink" title="Start"></a>Start</h3><h4 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yarn add sequelize</span><br><span class="line"><span class="comment"># add one of the following:</span></span><br><span class="line">yarn add pg pg-hstore</span><br><span class="line">yarn add mysql2</span><br><span class="line">yarn add sqlite3</span><br><span class="line">yarn add tedious // MSSQL</span><br></pre></td></tr></table></figure><h4 id="Setup-a-connection"><a href="#Setup-a-connection" class="headerlink" title="Setup a connection"></a>Setup a connection</h4><p>Sequelize will setup a connection pool on initialization so you should ideally only ever create one instance per database if you’re connecting to the DB from a single process. If you’re connecting to the DB from multiple processes, you’ll have to create one instance per process, but each instance should have a maximum connection pool size of “max connection pool size divided by number of instances”. So, if you wanted a max connection pool size of 90 and you have 3 worker process, each process’s instance should have a max connection pool size of 30.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Conn = <span class="keyword">new</span> Sequelize(<span class="string">&#x27;database&#x27;</span>, <span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;password&#x27;</span>, &#123;</span><br><span class="line">  host: <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">  dialect: <span class="string">&#x27;mysql&#x27;</span>|<span class="string">&#x27;sqlite&#x27;</span>|<span class="string">&#x27;postgres&#x27;</span>|<span class="string">&#x27;mssql&#x27;</span>,</span><br><span class="line">  pool: &#123;</span><br><span class="line">    max: <span class="number">5</span>,</span><br><span class="line">    min: <span class="number">0</span>,</span><br><span class="line">    idle: <span class="number">10000</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  storage: <span class="string">&#x27;path/to/database.sqlite&#x27;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// or you can simply use a connection uri</span></span><br><span class="line"><span class="keyword">const</span> Conn = <span class="keyword">new</span> Sequelize(<span class="string">&#x27;postgres://user:pass@example.com:5432/dbname&#x27;</span>)</span><br></pre></td></tr></table></figure><h4 id="Test-the-connection"><a href="#Test-the-connection" class="headerlink" title="Test the connection"></a>Test the connection</h4><p>You can use the <code>.authenticate()</code> function like this to test the connection.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Conn.authenticate().then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Connection has been established successfully&#x27;</span>)</span><br><span class="line">&#125;).catch(<span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.error(<span class="string">&#x27;Unable to connect to the database: &#x27;</span>, e)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="Model"><a href="#Model" class="headerlink" title="Model"></a>Model</h4><p>Models are defined with <code>Conn.define(&#39;name&#39;, &#123;attributes&#125;, &#123;options&#125;)</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> User = Conn.define(<span class="string">&#x27;user&#x27;</span>, &#123;</span><br><span class="line">  firstName: &#123;</span><br><span class="line">    type: Sequelize.STRING,</span><br><span class="line">  &#125;,</span><br><span class="line">  lastName: &#123;</span><br><span class="line">    type: Sequelize.STRING,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// force: true will drop the table if it already exists</span></span><br><span class="line">User.sync(&#123; <span class="attr">force</span>: <span class="literal">true</span> &#125;).then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// Table created</span></span><br><span class="line">  <span class="keyword">return</span> User.create(&#123;</span><br><span class="line">    firstName: <span class="string">&#x27;John&#x27;</span>,</span><br><span class="line">    lastName: <span class="string">&#x27;Hank&#x27;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="Query"><a href="#Query" class="headerlink" title="Query"></a>Query</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">User.findAll().then(<span class="function"><span class="params">users</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(users)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="Application-wide-model-options"><a href="#Application-wide-model-options" class="headerlink" title="Application wide model options"></a>Application wide model options</h4><p>The Sequelize constructor takes a <code>define</code> option which will be used as the default options for all defined models.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Conn = <span class="keyword">new</span> Sequelize(<span class="string">&#x27;connectionUri&#x27;</span>, &#123;</span><br><span class="line">  define: &#123;</span><br><span class="line">    timestamps: <span class="literal">false</span>, <span class="comment">// true by default</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> User = Conn.define(<span class="string">&#x27;user&#x27;</span>, &#123;&#125;) <span class="comment">// timestamps is false by default</span></span><br><span class="line"><span class="keyword">const</span> Post = Conn.define(<span class="string">&#x27;post&#x27;</span>, &#123;&#125;, &#123;</span><br><span class="line">  timestamps: <span class="literal">true</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="Promises"><a href="#Promises" class="headerlink" title="Promises"></a>Promises</h4><p>Sequelize uses promises to control async control-flow.</p><p>Basically, a promise represents a value which will be present at some point.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user = <span class="keyword">await</span> User.fineOne()</span><br><span class="line"><span class="built_in">console</span>.log(user)</span><br></pre></td></tr></table></figure><h3 id="Model-Definition"><a href="#Model-Definition" class="headerlink" title="Model Definition"></a>Model Definition</h3><p>To define mapping between a model and a table, use the <code>define</code> method. Sequelize will then automatically add the attributes <code>createdAt</code> and <code>updatedAt</code> to it. So you will be able to know when the database entry went into the db and when it was updated the last time.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Project = Conn.define(<span class="string">&#x27;project&#x27;</span>, &#123;</span><br><span class="line">  title: Sequelize.STRING,</span><br><span class="line">  description: Sequelize.TEXT,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Task = Conn.define(<span class="string">&#x27;tastk&#x27;</span>, &#123;</span><br><span class="line">  title: Sequelize.STRING,</span><br><span class="line">  description: Sequelize.TEXT,</span><br><span class="line">  deadline: Sequelize.DATE,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>You can also set some options on each column:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Foo = Conn.define(<span class="string">&#x27;foo&#x27;</span>, &#123;</span><br><span class="line">  <span class="comment">// instantiating will automatically set the flat to true if not set</span></span><br><span class="line">  flag: &#123;</span><br><span class="line">    type: Sequelize.BOOLEAN,</span><br><span class="line">    allowNull: <span class="literal">false</span>,</span><br><span class="line">    defaultValue: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  myDate: &#123;</span><br><span class="line">    type: Sequelize.DATE,</span><br><span class="line">    defaultValue: Sequelize.NOW,</span><br><span class="line">  &#125;,</span><br><span class="line">  title: &#123;</span><br><span class="line">    type: Sequelize.STRING,</span><br><span class="line">    allowNull: <span class="literal">false</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  uniqueOne: &#123;</span><br><span class="line">    type: Sequelize.STRING,</span><br><span class="line">    unique: <span class="string">&#x27;compositeIndex&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  uniqueTwo: &#123;</span><br><span class="line">    type: Sequelize.INTEGER,</span><br><span class="line">    unique: <span class="string">&#x27;compositeIndex&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  foo: &#123;</span><br><span class="line">    type: Sequelize.STRING,</span><br><span class="line">    validate: &#123;</span><br><span class="line">      isEmail: <span class="literal">true</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h3><p>You can also influence the way Sequelize hadnles your column names:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Bar = Conn.define(<span class="string">&#x27;bar&#x27;</span>, &#123;</span><br><span class="line">  <span class="comment">/* ... */</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">  <span class="comment">// don&#x27;t add the timestamp attributes(updatedAt, createdAt)</span></span><br><span class="line">  timestamps: <span class="literal">false</span>,</span><br><span class="line">  <span class="comment">// don&#x27;t delete database entries but set the newly added attribute deletedAt to the current data(when deletion was done)</span></span><br><span class="line">  paranoid: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// don&#x27;t use camelcase for automatically added attributes but underscore style so updatedAt will be udpated_at</span></span><br><span class="line">  underscore: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// disable the modification of table names; by default, sequelize will automatically transform all passes model names(first parameter of define) into plural. If you don&#x27;t want that, set the following</span></span><br><span class="line">  freezeTableName: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// define the table&#x27;s name</span></span><br><span class="line">  tableName: <span class="string">&#x27;my_very_custom_table_name&#x27;</span>,</span><br><span class="line">  <span class="comment">// Enable optimistic locking. When enabled, sequelize will add a version count attribute to the model and throw an OptimisticLockingError error when stale instances are saved.</span></span><br><span class="line">  version: <span class="literal">true</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Import"><a href="#Import" class="headerlink" title="Import"></a>Import</h3><p>You can also store your model definitions in a single file using the <code>import</code> method. The returned object is exactly the same as defined in the imported file’s function.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// in your server file</span></span><br><span class="line"><span class="keyword">const</span> Project = Conn.import(__dirname, <span class="string">&quot;/path/to/models/project&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// The model definition file</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">Conn, DataType</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> Conn.define(<span class="string">&#x27;project&#x27;</span>, &#123;</span><br><span class="line">    name: DataTypes.STRING,</span><br><span class="line">    description: DataTypes.TEXT,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The <code>import</code> method can also accept a callback as an argument</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Conn.import(<span class="string">&#x27;project&#x27;</span>, <span class="function">(<span class="params">Conn, DataTypes</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> Conn.define(<span class="string">&#x27;project&#x27;</span>, &#123;</span><br><span class="line">    name: DataTypes.STRING,</span><br><span class="line">    description: DataTypes.TEXT,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Database-Synchronization"><a href="#Database-Synchronization" class="headerlink" title="Database Synchronization"></a>Database Synchronization</h3><p>When starting a new project you won’t have a database structure and using sequelize you won’t need to. Just specify your model structures and let the library do the rest. Currently supported is the creation and deletion of tables.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create the Tables</span></span><br><span class="line">Project.sync()</span><br><span class="line">Task.sync()</span><br><span class="line"></span><br><span class="line"><span class="comment">// Force the Creation</span></span><br><span class="line">Project.sync(&#123; <span class="attr">force</span>: <span class="literal">true</span> &#125;) <span class="comment">// this will drop the table first and re-create it afterwards</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Drop the Tables</span></span><br><span class="line">Project.drop()</span><br><span class="line">Task.drop()</span><br><span class="line"></span><br><span class="line"><span class="comment">// Event Handling</span></span><br><span class="line">Project.[sync|drop]().then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ok ... everything is nice</span></span><br><span class="line">&#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ooh, did you enter wrong database credentials</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Because synchronizing and dropping all of your tables might be a lot of lines to write, you can also let Sequelize do the work for you:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// sync all models that aren&#x27;t already in the database</span></span><br><span class="line">Conn.sync()</span><br><span class="line"></span><br><span class="line"><span class="comment">// Force sync all models</span></span><br><span class="line">Conn.sync(&#123; <span class="attr">force</span>: <span class="literal">true</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Drop all Tables</span></span><br><span class="line">Conn.drop()</span><br><span class="line"></span><br><span class="line"><span class="comment">// Emit Handling</span></span><br><span class="line">Conn.[sync|drop]().then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Expansion-of-models"><a href="#Expansion-of-models" class="headerlink" title="Expansion of models"></a>Expansion of models</h3><p>Sequelize Models are ES6 classes, you can very easily add custom instance or class level methods.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> User = Conn.define(<span class="string">&#x27;user&#x27;</span>, &#123;</span><br><span class="line">  firstName: Sequelize.STRING,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// add a class level method</span></span><br><span class="line">User.classLevelMethod = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  retunr <span class="string">&#x27;foo&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// add an instance level method</span></span><br><span class="line">User.prototype.instanceLevelMethod = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  retunr <span class="string">&#x27;bar&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Indexes"><a href="#Indexes" class="headerlink" title="Indexes"></a>Indexes</h3><p>Sequelize supports adding indexes to the model definition which will be created during <code>Model.sync()</code> or <code>Conn.sync()</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Conn.define(<span class="string">&#x27;user&#x27;</span>, &#123;&#125;, &#123;</span><br><span class="line">  indexes: [</span><br><span class="line">    <span class="comment">// Create a unique index on poem</span></span><br><span class="line">    &#123;</span><br><span class="line">      unique: <span class="literal">true</span>,</span><br><span class="line">      fields: [<span class="string">&#x27;poen&#x27;</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// create a gin index on data with the jsonb_path_ops operator</span></span><br><span class="line">    &#123;</span><br><span class="line">      fields: [<span class="string">&#x27;data&#x27;</span>],</span><br><span class="line">      using: <span class="string">&#x27;gin&#x27;</span>,</span><br><span class="line">      operator: <span class="string">&#x27;jsonb_path_ops&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// by default index name will be [table]_[fields]</span></span><br><span class="line">    <span class="comment">// create a multi column partial index</span></span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">&#x27;public_by_author&#x27;</span>,</span><br><span class="line">      fields: [<span class="string">&#x27;author&#x27;</span>, <span class="string">&#x27;status&#x27;</span>],</span><br><span class="line">      where: &#123;</span><br><span class="line">        status: <span class="string">&#x27;public&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Model-Usage"><a href="#Model-Usage" class="headerlink" title="Model Usage"></a>Model Usage</h3><h4 id="Data-Retrieval-Finders"><a href="#Data-Retrieval-Finders" class="headerlink" title="Data Retrieval / Finders"></a>Data Retrieval / Finders</h4><p>Finder methods are intended to query data from the database. They do not return plain objects but instead return <em>model instances</em>. Because finder methods return model instances you can call any model instance member.</p><h4 id="find-search-for-one-specific-element-in-the-database"><a href="#find-search-for-one-specific-element-in-the-database" class="headerlink" title="find - search for one specific element in the database"></a>find - search for one specific element in the database</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// search for known id</span></span><br><span class="line">Project.findById(<span class="number">123</span>).then(<span class="function"><span class="params">project</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// project will be an instance of Project and store the content of the table entry with id 123. If such an entry is not defined you will get null</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// search for attributes</span></span><br><span class="line">Project.findOne(&#123;</span><br><span class="line">  where: &#123;</span><br><span class="line">    title: <span class="string">&#x27;aProject&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;).then(<span class="function"><span class="params">project</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// project will be the first entry of the Projects table with the title &#x27;aProject&#x27; || null</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">Project.findONe(&#123;</span><br><span class="line">  where: &#123;</span><br><span class="line">    title: <span class="string">&#x27;aProject&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  attributes: [<span class="string">&#x27;id&#x27;</span>, [<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;title&#x27;</span>]]</span><br><span class="line">&#125;).then(<span class="function"><span class="params">project</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// project will be the first entry of the Projects table with the title &#x27;aProject&#x27; || null</span></span><br><span class="line">  <span class="comment">// project.title will contain the name of the project</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="findOrCreate-Search-for-a-specific-element-or-create-it-if-not-available"><a href="#findOrCreate-Search-for-a-specific-element-or-create-it-if-not-available" class="headerlink" title="findOrCreate - Search for a specific element or create it if not available"></a>findOrCreate - Search for a specific element or create it if not available</h4><p>The method <code>findOrCreate</code> can be used to check if a certain element already exists in the database. If that is the case the method will result in a respective instance, if the element does not yet exists, it will be created.</p><p>Let’s assume we have an empty database with a <code>User</code> model which has a <code>username</code> and a <code>job</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">User.findOrCreate(&#123;</span><br><span class="line">  where: &#123;</span><br><span class="line">    username: <span class="string">&#x27;sdepold&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  defaults: &#123;</span><br><span class="line">    job: <span class="string">&quot;Technical Lead JS&quot;</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;).spread(<span class="function">(<span class="params">user, created</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(user.get(&#123;</span><br><span class="line">    plain: <span class="literal">true</span>,</span><br><span class="line">  &#125;))</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * findOrCreate returns an array containing the object that was found or created and a boolean will be true if a new object was created, and false if not</span></span><br><span class="line"><span class="comment">    [ &#123;</span></span><br><span class="line"><span class="comment">      username: &#x27;sdepold&#x27;,</span></span><br><span class="line"><span class="comment">      job: &#x27;Technical Lead JavaScript&#x27;,</span></span><br><span class="line"><span class="comment">      id: 1,</span></span><br><span class="line"><span class="comment">      createdAt: Fri Mar 22 2013 21: 28: 34 GMT + 0100(CET),</span></span><br><span class="line"><span class="comment">      updatedAt: Fri Mar 22 2013 21: 28: 34 GMT + 0100(CET)</span></span><br><span class="line"><span class="comment">    &#125;,</span></span><br><span class="line"><span class="comment">    true ]</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>The code created a new instance.</p><h4 id="fineAndCountAll-Search-for-multiple-elements-in-the-database-returns-both-data-and-total-count"><a href="#fineAndCountAll-Search-for-multiple-elements-in-the-database-returns-both-data-and-total-count" class="headerlink" title="fineAndCountAll - Search for multiple elements in the database, returns both data and total count"></a>fineAndCountAll - Search for multiple elements in the database, returns both data and total count</h4><h4 id="findAll-Search-for-multiple-elements-in-the-database"><a href="#findAll-Search-for-multiple-elements-in-the-database" class="headerlink" title="findAll - Search for multiple elements in the database"></a>findAll - Search for multiple elements in the database</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// find multiple entries</span></span><br><span class="line">Project.findAll().then(<span class="function"><span class="params">projects</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// projects will be an array of all Project instances</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// also possible</span></span><br><span class="line">Project.all().then(<span class="function"><span class="params">projects</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// projects will be an array of all Project instances</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// search for specific attribute - hash usage</span></span><br><span class="line">Project.findAll(&#123;</span><br><span class="line">  where: &#123;</span><br><span class="line">    name: <span class="string">&#x27;A Project&#x27;</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;).then(<span class="function"><span class="params">projects</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// search within a specific range</span></span><br><span class="line">Project.findAll(&#123;</span><br><span class="line">  where: &#123;</span><br><span class="line">    id: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">  &#125;</span><br><span class="line">&#125;).then(<span class="function"><span class="params">projects</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// return instances with id 1, 2, 3</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="Complex-filtering-OR-NOT-queries"><a href="#Complex-filtering-OR-NOT-queries" class="headerlink" title="Complex filtering /OR/NOT queries"></a>Complex filtering /OR/NOT queries</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Project.findAll(&#123;</span><br><span class="line">  where: &#123;</span><br><span class="line">    name: <span class="string">&#x27;a project&#x27;</span>,</span><br><span class="line">    $or: [</span><br><span class="line">      &#123; <span class="attr">id</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] &#125;,</span><br><span class="line">      &#123; <span class="attr">id</span>: &#123; <span class="attr">$gt</span>: <span class="number">10</span> &#125;&#125;,</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">Project.findAll(&#123;</span><br><span class="line">  where: &#123;</span><br><span class="line">    name: <span class="string">&#x27;a project&#x27;</span>,</span><br><span class="line">    id: &#123;</span><br><span class="line">      $or: [</span><br><span class="line">        [ <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">        &#123; <span class="attr">$gt</span>: <span class="number">10</span> &#125;,</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Both pieces of code will generate the following:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM &#96;Projects&#96; WHERE (</span><br><span class="line">  &#96;Projects&#96;.&#96;name&#96;&#x3D;&#96;a project&#96;</span><br><span class="line">  AND (&#96;Projects&#96;.&#96;id&#96; IN (1,2,3) OR &#96;Projects&#96;.&#96;id&#96;&gt;10)</span><br><span class="line">  )</span><br></pre></td></tr></table></figure><h4 id="Manipulating-the-database-with-limit-offset-order-and-group"><a href="#Manipulating-the-database-with-limit-offset-order-and-group" class="headerlink" title="Manipulating the database with limit, offset, order and group"></a>Manipulating the database with limit, offset, order and group</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// limit the results of the query</span></span><br><span class="line">Project.findAll(&#123; <span class="attr">limit</span>: <span class="number">10</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// step over the first 10 elements</span></span><br><span class="line">Project.findAll(&#123; <span class="attr">offset</span>: <span class="number">10</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// step over the first 10 element and take 2</span></span><br><span class="line">Project.findAll(&#123; <span class="attr">offset</span>: <span class="number">10</span>, <span class="attr">limit</span>: <span class="number">2</span> &#125;)</span><br></pre></td></tr></table></figure><p>The syntax for grouping and ordering are equal, so below it is only explained with a single example for group, and the rest for order.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// yields ORDER BY title DESC</span></span><br><span class="line">Project.findAll(&#123; <span class="attr">order</span>: <span class="string">&#x27;title DESC&#x27;</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// yields GROUP BY name</span></span><br><span class="line">Project.findAll(&#123; <span class="attr">group</span>: <span class="string">&#x27;name&#x27;</span> &#125;)</span><br></pre></td></tr></table></figure><h4 id="Raw-queries"><a href="#Raw-queries" class="headerlink" title="Raw queries"></a>Raw queries</h4><p>Sometimes you might be expecting a massive dataset that you just want to display without manipulation. For each row you select, Sequelize creates an instance with functions for update, delete, get association etc. If you have thousands of rows, this might take some time. If you only need the raw data and don’t want to update anything, you can do like this to get the raw data.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Are you expecting a massive dataset from the DB, and don&#x27;t want to spend the time building DAOs for each entry? You can pass an extra query option to get the raw data insetead:</span></span><br><span class="line">Project.findAll(&#123;</span><br><span class="line">  where: &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;,</span><br><span class="line">  raw: <span class="literal">true</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Queries"><a href="#Queries" class="headerlink" title="Queries"></a>Queries</h3><h4 id="Attributes"><a href="#Attributes" class="headerlink" title="Attributes"></a>Attributes</h4><p>To select only some attributes, you can use the <code>attributes</code> option. Most often, you pass an array:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Model.findAll(&#123;</span><br><span class="line">  attributes: [<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// Equal to</span></span><br><span class="line">SELECT foo, bar ...</span><br></pre></td></tr></table></figure><h4 id="Where"><a href="#Where" class="headerlink" title="Where"></a>Where</h4><p>Whether you are querying with <code>findAll</code>/<code>find</code> or doing bulk <code>updates</code>/<code>destroy</code> you can pass a <code>where</code> object to filte the query.</p><p><code>where</code> generally takes an object from attribute:value pairs, where value can be primitive for equality matches or keyed objects for other operators.</p><p>It’s also possible to generate complex <code>AND</code>/<code>OR</code> conditions by nesting of <code>$or</code> and <code>$and</code></p><h4 id="Basics"><a href="#Basics" class="headerlink" title="Basics"></a>Basics</h4>]]></content>
      
      
      
        <tags>
            
            <tag> Database </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Build GraphQL Server With Express</title>
      <link href="/2017/08/07/Build-GraphQL-Server-with-Express/"/>
      <url>/2017/08/07/Build-GraphQL-Server-with-Express/</url>
      
        <content type="html"><![CDATA[<h3 id="Step-1-Connect-to-Server"><a href="#Step-1-Connect-to-Server" class="headerlink" title="Step 1 - Connect to Server"></a>Step 1 - Connect to Server</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// db.js</span></span><br><span class="line"><span class="keyword">const</span> Sequelize = <span class="built_in">require</span>(<span class="string">&#x27;sequelize&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> _ = <span class="built_in">require</span>(<span class="string">&#x27;lodash&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> Faker = <span class="built_in">require</span>(<span class="string">&#x27;faker&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Conn = <span class="keyword">new</span> Sequelize(</span><br><span class="line">  <span class="string">&#x27;test&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;postgres&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;postgres&#x27;</span>,</span><br><span class="line">  &#123;</span><br><span class="line">    dialect: <span class="string">&#x27;postgres&#x27;</span>,</span><br><span class="line">    host: <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Person = Conn.define(<span class="string">&#x27;person&#x27;</span>, &#123;</span><br><span class="line">  firstName: &#123;</span><br><span class="line">    type: Sequelize.STRING,</span><br><span class="line">    allowNull: <span class="literal">false</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  lastName: &#123;</span><br><span class="line">    type: Sequelize.STRING,</span><br><span class="line">    allowNull: <span class="literal">false</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  email: &#123;</span><br><span class="line">    type: Sequelize.STRING,</span><br><span class="line">    allowNull: <span class="literal">false</span>,</span><br><span class="line">    validate: &#123;</span><br><span class="line">      isEmail: <span class="literal">true</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Post = Conn.define(<span class="string">&#x27;post&#x27;</span>, &#123;</span><br><span class="line">  title: &#123;</span><br><span class="line">    type: Sequelize.STRING,</span><br><span class="line">    allowNull: <span class="literal">false</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  content: &#123;</span><br><span class="line">    type: Sequelize.STRING,</span><br><span class="line">    allowNull: <span class="literal">false</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Relationships</span></span><br><span class="line">Person.hasMany(Post)</span><br><span class="line">Post.belongsTo(Person)</span><br><span class="line"></span><br><span class="line">Conn.sync(&#123;</span><br><span class="line">  force: <span class="literal">true</span>,</span><br><span class="line">&#125;).then( <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  _.times(<span class="number">10</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Person.create(&#123;</span><br><span class="line">      firstName: Faker.name.firstName(),</span><br><span class="line">      lastName: Faker.name.lastName(),</span><br><span class="line">      email: Faker.internet.email(),</span><br><span class="line">    &#125;).then(<span class="function"><span class="params">person</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> person.createPost(&#123;</span><br><span class="line">        title: <span class="string">`Sample title by <span class="subst">$&#123;person.firstName&#125;</span>`</span>,</span><br><span class="line">        content: <span class="string">&#x27;This is a sample article&#x27;</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = Conn</span><br></pre></td></tr></table></figure><h3 id="Step-2-Build-Schema"><a href="#Step-2-Build-Schema" class="headerlink" title="Step 2 - Build Schema"></a>Step 2 - Build Schema</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// schema.js</span></span><br><span class="line"><span class="keyword">const</span> Sequelize = <span class="built_in">require</span>(<span class="string">&#x27;sequelize&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> _ = <span class="built_in">require</span>(<span class="string">&#x27;lodash&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> Faker = <span class="built_in">require</span>(<span class="string">&#x27;faker&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Conn = <span class="keyword">new</span> Sequelize(</span><br><span class="line">  <span class="string">&#x27;test&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;postgres&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;postgres&#x27;</span>,</span><br><span class="line">  &#123;</span><br><span class="line">    dialect: <span class="string">&#x27;postgres&#x27;</span>,</span><br><span class="line">    host: <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Person = Conn.define(<span class="string">&#x27;person&#x27;</span>, &#123;</span><br><span class="line">  firstName: &#123;</span><br><span class="line">    type: Sequelize.STRING,</span><br><span class="line">    allowNull: <span class="literal">false</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  lastName: &#123;</span><br><span class="line">    type: Sequelize.STRING,</span><br><span class="line">    allowNull: <span class="literal">false</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  email: &#123;</span><br><span class="line">    type: Sequelize.STRING,</span><br><span class="line">    allowNull: <span class="literal">false</span>,</span><br><span class="line">    validate: &#123;</span><br><span class="line">      isEmail: <span class="literal">true</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Post = Conn.define(<span class="string">&#x27;post&#x27;</span>, &#123;</span><br><span class="line">  title: &#123;</span><br><span class="line">    type: Sequelize.STRING,</span><br><span class="line">    allowNull: <span class="literal">false</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  content: &#123;</span><br><span class="line">    type: Sequelize.STRING,</span><br><span class="line">    allowNull: <span class="literal">false</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Relationships</span></span><br><span class="line">Person.hasMany(Post)</span><br><span class="line">Post.belongsTo(Person)</span><br><span class="line"></span><br><span class="line">Conn.sync(&#123;</span><br><span class="line">  force: <span class="literal">true</span>,</span><br><span class="line">&#125;).then( <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  _.times(<span class="number">10</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Person.create(&#123;</span><br><span class="line">      firstName: Faker.name.firstName(),</span><br><span class="line">      lastName: Faker.name.lastName(),</span><br><span class="line">      email: Faker.internet.email(),</span><br><span class="line">    &#125;).then(<span class="function"><span class="params">person</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> person.createPost(&#123;</span><br><span class="line">        title: <span class="string">`Sample title by <span class="subst">$&#123;person.firstName&#125;</span>`</span>,</span><br><span class="line">        content: <span class="string">&#x27;This is a sample article&#x27;</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = Conn</span><br></pre></td></tr></table></figure><h3 id="Step-3-Add-GraphQL-to-Server"><a href="#Step-3-Add-GraphQL-to-Server" class="headerlink" title="Step 3 - Add GraphQL to Server"></a>Step 3 - Add GraphQL to Server</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"><span class="keyword">const</span> Express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> GraphHTTP = <span class="built_in">require</span>(<span class="string">&#x27;express-graphql&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> Schema = <span class="built_in">require</span>(<span class="string">&#x27;./schema&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Config</span></span><br><span class="line"><span class="keyword">const</span> APP_PORT = <span class="number">3000</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = Express()</span><br><span class="line">app.use(<span class="string">&#x27;/graphql&#x27;</span>, GraphHTTP(&#123;</span><br><span class="line">  schema: Schema,</span><br><span class="line">  pretty: <span class="literal">true</span>,</span><br><span class="line">  graphiql: <span class="literal">true</span>,</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line">app.listen(APP_PORT, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Server listening at &#x27;</span> + APP_PORT)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> GraphQL </tag>
            
            <tag> Node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Koa-Graphql</title>
      <link href="/2017/08/06/koa-graphql/"/>
      <url>/2017/08/06/koa-graphql/</url>
      
        <content type="html"><![CDATA[<p>Create a GraphQL HTTP server with Koa.</p><h3 id="Usage-with-Koa-Router"><a href="#Usage-with-Koa-Router" class="headerlink" title="Usage with Koa-Router"></a>Usage with Koa-Router</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">&#x27;koa-router&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> GraphqlHTTP = <span class="built_in">require</span>(<span class="string">&#x27;koa-graphql&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router()</span><br><span class="line"></span><br><span class="line">router.all(<span class="string">&#x27;/graphql&#x27;</span>, graphqlHTTP(&#123;</span><br><span class="line">  schema: MyGraphQLSchema,</span><br><span class="line">  graphiql: ture,</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line">app.use(router.routes()).use(router.allowedMethods())</span><br></pre></td></tr></table></figure><h3 id="Options"><a href="#Options" class="headerlink" title="Options"></a>Options</h3><p>The <code>GraphqlHTTP</code> function accpets the following options:</p><ul><li><p><code>schema</code>: A <code>GraphQLSchema</code> instance from <code>graphql.js</code>, required.</p></li><li><p><code>graphiql</code>: If <code>true</code>, presetns <a href="https://github.com/graphql/graphiql">GraphiQL</a> when the route with a <code>/graphiql</code> appended is loaded in a browser. We recommended that you set <code>graphiql</code> to <code>ture</code> when your app is in development, because it’s quite useful. You may or may not want it in production.</p></li><li><p><code>rootValue</code>: A value to pass as the <code>rootValue</code> to the <code>graphql()</code> function from <code>graphql.js</code></p></li><li><p><code>context</code>: A value to pass as the <code>context</code> to the <code>graphql()</code> function from <code>graphql.js</code>. If <code>context</code> is not provided, the <code>ctx</code> object is passes as the context.</p></li><li><p><code>pretty</code>: If <code>true</code>, any JSON response will be pretty-printed.</p></li><li><p><code>formatError</code>: An optional function which will be used to format any errors produced by fulfilling a GraphQL operation. If no function is provided, GraphQL’s default spec-compliant <code>formatError</code> function will be used.</p></li><li><p><code>extensions</code>: An optional function for adding additional metadata to the GraphQL response as a key-value object. The result will be added to <code>extensions</code> field in the resulting JSON. This is often useful place to add development time metadata such as the runtime of a query or the amount of resources consumed. This may be an async function. The function is given one object as an argument: <code>&#123; document, variables, operationName, result &#125;</code></p></li><li><p><code>validationRules</code>: Optional additional validation rules queries must satisfy in addition to those defined by the GraphQL spec.</p></li></ul><h3 id="HTTP-Usage"><a href="#HTTP-Usage" class="headerlink" title="HTTP Usage"></a>HTTP Usage</h3><p>Once installed at a path, <code>koa-graphql</code> will accept requests with the parameters:</p><ul><li><p><code>query</code>: A string GraphQL document to be executed.</p></li><li><p><code>variables</code>: The runtime values to use for any GraphQL query variables as a JSON object.</p></li><li><p><code>operationName</code>: If the provided <code>query</code> contains mutiple named operations, this specifies which operation should be executed. If not provided, a 400 error will be returned if the <code>query</code> contains multiple named operations.</p></li><li><p><code>raw</code>: If the <code>graphql</code> option is enabled and the <code>raw</code> parameter is provided raw JSON will always be returned instead of GraphQL even when loaded from a browser.</p></li></ul><p>GraphQL will first look for each parameter in the URL’s query-string:</p><p><code>/graphql?query=query+getUser($id:ID)&#123;user(id:$id)&#123;name&#125;&#125;&amp;variables=&#123;&quot;id&quot;:&quot;4&quot;&#125;</code></p><p>If not found in the query-string, it will look in the POST request body.</p><p>If the POST body has not been parsed, koa-graphql will interpret it depending on the provided <em>Contetn-Type</em> header:</p><ul><li><p><code>application/json</code>: the POST body will be parsed as a JSON object.</p></li><li><p><code>application/x-www-form-urlencoded</code>: this POST body will be parsed as a url-encoded string of key-value pairs.</p></li><li><p><code>application/graphql</code>: The POST body will be parsed as GraphQL query string, which provides the <code>query</code> parameter.</p></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> GraphQL </tag>
            
            <tag> Node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Note on GraphQL(2)</title>
      <link href="/2017/08/04/Note-on-GraphQL-2/"/>
      <url>/2017/08/04/Note-on-GraphQL-2/</url>
      
        <content type="html"><![CDATA[<h3 id="Execution"><a href="#Execution" class="headerlink" title="Execution"></a>Execution</h3><p>After being validated, a GraphQL query is executed by a GraphQL server which returns a result that mirrors the shape of the requested query, typically as JSON.</p><p>GraphQL cannot execute a query without a type system, let’s use an example type system to illustrate executing a query.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">type Query &#123;</span><br><span class="line">  human(id: ID!): Human</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type Human &#123;</span><br><span class="line">  name: <span class="built_in">String</span></span><br><span class="line">  appearsIn: [Episode]</span><br><span class="line">  starships: [Starship]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">enum Episode &#123;</span><br><span class="line">  NEWHOPE</span><br><span class="line">  EMPIRE</span><br><span class="line">  JEDI</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type Starship &#123;</span><br><span class="line">  name: <span class="built_in">String</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>In order to describe what happens when a query is executed, let’s use an example to walk through.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  human(id: <span class="number">1002</span>) &#123;</span><br><span class="line">    name</span><br><span class="line">    appearsIn</span><br><span class="line">    starships &#123;</span><br><span class="line">      name</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;data&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;human&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Han Solo&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;appearsIn&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;NEWHOPE&quot;</span>,</span><br><span class="line">        <span class="string">&quot;EMPIRE&quot;</span>,</span><br><span class="line">        <span class="string">&quot;JEDI&quot;</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;starships&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Millenium Falcon&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Imperial shuttle&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>You can think of each field in a GraphQL query as a function or method of the previous type which returns the next type.</p><p>Exactly this is how GraphQL works. Each field on each type is backed by a function called the <code>resolver</code> which is provided by the GraphQL Server Developer.</p><p>When a field is executed, the corresponding <code>resolver</code> is called to produce the next value.</p><p>If a field produces a scalar value like a string or number, then the execution completes.</p><p>However if a field produces an object value then the query will contain another selection of fields which apply to that object. This continues until scalar values are reached.</p><p>GraphQL queries always end at scalar values.</p><h4 id="Root-Fields-amp-Resolvers"><a href="#Root-Fields-amp-Resolvers" class="headerlink" title="Root Fields &amp; Resolvers"></a>Root Fields &amp; Resolvers</h4><p>At the top level of every GraphQL server is a type that represents all of the possible entry points into the GraphQL API, it’s often called the <code>Root Type</code> or the <code>Query Type</code>.</p><p>In this example, our Query Type provides a field called <code>human</code> which accepts the argument <code>id</code>. The resolver function for this field accesses a database and then constructs and returns a <code>Human</code> object.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Query: &#123;</span><br><span class="line">  human(obj, args, context) &#123;</span><br><span class="line">    <span class="keyword">return</span> context.db.loadHumanById(args.id).then(</span><br><span class="line">      userData =&gt; <span class="keyword">new</span> Human(userData)</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p><code>obj</code> The previous object, which for a field on the root Query type if often not used.</p></li><li><p><code>args</code> The arguments provided to the field in the GraphQL query</p></li><li><p><code>context</code> A value which is provided to every resolver and holds important contextual information like the currently logged in user, or access to a database.</p></li></ul><h4 id="Asynchronous-Resolvers"><a href="#Asynchronous-Resolvers" class="headerlink" title="Asynchronous Resolvers"></a>Asynchronous Resolvers</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">human(obj, arg, context) &#123;</span><br><span class="line">  <span class="keyword">return</span> context.db.loadHumanById(args.id).then(</span><br><span class="line">    userData =&gt; <span class="keyword">new</span> Human(userData)</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The context is used to provide access to a database which is used to load data for user by the <code>id</code> provided as an argument in the GraphQL query. Since loading from a database is an asynchronous operation, this returns a <strong>Promise</strong>. When the database returns, we can construct and return a new <code>Human</code> object.</p><p>Notice that while the resolver function needs to be aware of Promise, the GraphQL query does not. It simply expects the <code>human</code> field to return something which it can then ask the <code>name</code> of. During execution, GraphQL will wait for Promise to complete before continuing and will do so with optimal concurrency.</p><h4 id="Trivial-Resolvers"><a href="#Trivial-Resolvers" class="headerlink" title="Trivial Resolvers"></a>Trivial Resolvers</h4><p>Now that a <code>Human</code> object is available, GraphQL execution can continue with the fields requested on it.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Human: &#123;</span><br><span class="line">  name(obj, args, context) &#123;</span><br><span class="line">    <span class="keyword">return</span> obj.name</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>A GraphQL server is powered by a type system which is used to determine what to do next. Even before the <code>human</code> field returns anything, GraphQL knows that the next stop will be to resolve fields on the <code>Human</code> type since the type system tells it that the <code>human</code> field will return a <code>Human</code>.</p><p>Resolving the <code>name</code> in this case is very straight-forward. The name resolver function is called and the <code>obj</code> argument is the <code>new Human</code> object return from the previous field. In this case, we expect that Human object to have a <code>name</code>property which we can read and return directly.</p><h4 id="Scalar-Coercion"><a href="#Scalar-Coercion" class="headerlink" title="Scalar Coercion"></a>Scalar Coercion</h4><p>While the <code>name</code> field is being resolved, the <code>appearsIn</code> and <code>starships</code> fields can be resolved concurrently. The <code>appearsIn</code> field could also have a trivial resolver, but let’s take a closer look:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Human: &#123;</span><br><span class="line">  appearsIn(obj) &#123;</span><br><span class="line">    <span class="keyword">return</span> obj.appearsIn <span class="comment">// return [3, 4, 5]</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Notice that our type system claims <code>appearsIn</code> will return Enum values with known values, however this function is returning numbers. This is an example of scalar coercion. The type system knows what to expect and will convert the values returned by a resolver function into something that upholds the API contract. In this case, there may be an Enum defined on our server which uses numbers like 3, 4, 5 internally, but represents them as Enum values in the GraphQL type system.</p><h4 id="List-Resolvers"><a href="#List-Resolvers" class="headerlink" title="List Resolvers"></a>List Resolvers</h4><p>The <code>appearsIn</code> field above returned a list of Enum values, and since that’s what the type system expected, each item in the list was coerced to the appropriate enum values.</p><p>What happens when the <code>starships</code> field is resolved?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Human: &#123;</span><br><span class="line">  starships (obj, args, context) &#123;</span><br><span class="line">    <span class="keyword">return</span> obj.starshipIDs.map(</span><br><span class="line">      id =&gt; context.db.loadStarshipByID(id).then(</span><br><span class="line">        shipData =&gt; <span class="keyword">new</span> Starship(shipData)</span><br><span class="line">      )</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The resolver for this field is not just returning a Promise, it’s returning a list of Promises. The <code>Human</code> object has a list of ids of the <code>Starships</code> they piloted, but we need to go load all of those ids to get read Starship objects.</p><p>GraphQL will wait for all of these Promises concurrently before continuing, and when left with a list of objects, it will concurrently continue yet again to load the <code>name</code> field on each of these items.</p><h3 id="Introspection"><a href="#Introspection" class="headerlink" title="Introspection"></a>Introspection</h3><p>We designed the type system, so we know what types are available, but if we didn’t, we can ask GraphQL by querying the <code>__schema</code> field, always available on the root type of a Query.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  __schema &#123;</span><br><span class="line">    types &#123;</span><br><span class="line">      name</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// produce</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;data&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;__schema&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;types&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Query&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Episode&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Character&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;name&quot;</span>: <span class="string">&quot;ID&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;name&quot;</span>: <span class="string">&quot;String&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Int&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;name&quot;</span>: <span class="string">&quot;FriendsConnection&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;name&quot;</span>: <span class="string">&quot;FriendsEdge&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;name&quot;</span>: <span class="string">&quot;PageInfo&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Boolean&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Review&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;name&quot;</span>: <span class="string">&quot;SearchResult&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Human&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;name&quot;</span>: <span class="string">&quot;LengthUnit&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Float&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Starship&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Droid&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Mutation&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;name&quot;</span>: <span class="string">&quot;ReviewInput&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;name&quot;</span>: <span class="string">&quot;__Schema&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;name&quot;</span>: <span class="string">&quot;__Type&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;name&quot;</span>: <span class="string">&quot;__TypeKind&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;name&quot;</span>: <span class="string">&quot;__Field&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;name&quot;</span>: <span class="string">&quot;__InputValue&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;name&quot;</span>: <span class="string">&quot;__EnumValue&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;name&quot;</span>: <span class="string">&quot;__Directive&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;name&quot;</span>: <span class="string">&quot;__DirectiveLocation&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Let’s group them:</p><ul><li><p><code>Query</code>, <code>Character</code>, <code>Human</code>, <code>Episode</code>, <code>Droid</code>. These are the ones that we defined in our type system.</p></li><li><p><code>String</code>, <code>Boolean</code>. These are built-in scalars that the type system provided.</p></li><li><p><code>__Schema</code>, <code>__Type</code>, <code>__TypeKind</code>, <code>__Field</code>, <code>__InputValue</code>, <code>__EnumValue</code>, <code>__Directive</code>. These are preceded with a double underscore, indicating that they are part of the introspection system.</p></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> GraphQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Note on GraphQL(1)</title>
      <link href="/2017/08/03/Note-on-GraphQL-1/"/>
      <url>/2017/08/03/Note-on-GraphQL-1/</url>
      
        <content type="html"><![CDATA[<p>GraphQL is a query language for your API, and a server-side runtime for executing queries by using a type system you define for your data.</p><p>A GraphQL service is created by defining types and fields on those types, then providing functions for each field on each type.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">type Query &#123;</span><br><span class="line">  me: User</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type User &#123;</span><br><span class="line">  id: ID</span><br><span class="line">  name: <span class="built_in">String</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Along with functions for each field on each type:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Query_me</span>(<span class="params">request</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request.auth.user;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">User_name</span>(<span class="params">user</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> user.getName()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Once a GraphQL service is running (typically at a URL on a web service), it can be sent GraphQL queries to validate and execute. A received query is first checked to ensure it only refers to the types and fields defined, then runs the provided functions to produce a result.</p><p>For example the query:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  me &#123;</span><br><span class="line">    name</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// produce</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;me&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Luck&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Fields"><a href="#Fields" class="headerlink" title="Fields"></a>Fields</h3><p>GraphQL is about asking for specific fields on objects.</p><p>GraphQL queries can traverse related objects and their fields, letting clients fetch lots of related data in one request, instead of making several roundtrips as one would need in a classic RESTFul architecture.</p><h3 id="Arguments"><a href="#Arguments" class="headerlink" title="Arguments"></a>Arguments</h3><p>In GraphQL, every field and nested object can get its own set of arguments, making GraphQL a complete replacement for making multiple API fetches. You can even pass arguments into scalar fields, to implement data transformations once on the server, instead of on every separately.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  human(id: <span class="string">&#x27;1000&#x27;</span>) &#123;</span><br><span class="line">    name</span><br><span class="line">    height(uint: FOOT)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Arguments can be of many different types. GraphQL comes with a default set of types, but a GraphQL server can also declare its own custom types, as long as they can be serialized into your transport format.</p><h3 id="Aliases"><a href="#Aliases" class="headerlink" title="Aliases"></a>Aliases</h3><p>You can’t directly query for the same field with different arguments, so you need alias to rename the result</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  empireHero: hero(episode: EMPIRE) &#123;</span><br><span class="line">    name</span><br><span class="line">  &#125;</span><br><span class="line">  jediHero: hero(episode: JEDI) &#123;</span><br><span class="line">    name</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// produce</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;data&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;empireHero&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;...&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;jediHero&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;...&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>In the above example, the two <code>hero</code> fields would have conflicted, but since we can alias them to different names, we can get both results in one request.</p><h3 id="Fragments"><a href="#Fragments" class="headerlink" title="Fragments"></a>Fragments</h3><p>GraphQL includes reusable units called <em>fragments</em>. Fragments let you construct sets of fields, and then include them in queries where you need to.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  leftComparison: hero(episode: EMPIRE) &#123;</span><br><span class="line">    ...comparisonFields</span><br><span class="line">  &#125;</span><br><span class="line">  rightComparison: hero(episode: JEDI) &#123;</span><br><span class="line">    ...comparisonFields</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fragment comparisonFields on Character &#123;</span><br><span class="line">  name</span><br><span class="line">  appearsIn</span><br><span class="line">  friends &#123;</span><br><span class="line">    name</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Variables"><a href="#Variables" class="headerlink" title="Variables"></a>Variables</h3><p>When we start working with variables, we need to do three things:</p><ul><li><p>Replace the static values in the query with <code>$variableName</code></p></li><li><p>Declare <code>$variableName</code> as one of the variables accepted by the query</p></li><li><p>Pass <code>variableName: value</code> in the separate, transport-specific(usually JSON) variables dictionary</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">query HeroNameAndFriends($episode: Episode) &#123;</span><br><span class="line">  hero(episode: $episode) &#123;</span><br><span class="line">    name</span><br><span class="line">    friends &#123;</span><br><span class="line">      name</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Variables</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&#x27;episode&#x27;</span>: <span class="string">&#x27;JEDI&#x27;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Now in our client code, we can simply pass a different variable rather than needing to construct an entirely new query.</p><h4 id="Variable-Definitions"><a href="#Variable-Definitions" class="headerlink" title="Variable Definitions"></a>Variable Definitions</h4><p>The variable definitions are the part that looks like <code>($episode: Episode)</code> in the query above. It works just like the argument definition for a function in a types language. It lists all of the variables, prefixed by <code>$</code>, followed by their type, in this case <code>Episode</code>.</p><p>All declared variables must be either scalars, enums, or input object types.</p><p>Variable Definition can be optional or required. In the case above, since there isn’t an <code>!</code> next to the <code>Episode</code> type, it’s optional. But if the field you are passing the variable into requires a non-null argument, then the variable must be required.</p><h4 id="Default-Variables"><a href="#Default-Variables" class="headerlink" title="Default Variables"></a>Default Variables</h4><p>Default variables can also be assigned to the variables in the query by adding the default value after the type declaration.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">query HeroNameAndFriends($episode: Episode = <span class="string">&#x27;JEDI&#x27;</span>) &#123;</span><br><span class="line">  hero(episode: $episode) &#123;</span><br><span class="line">    name</span><br><span class="line">    friends &#123;</span><br><span class="line">      name</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Directives"><a href="#Directives" class="headerlink" title="Directives"></a>Directives</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">query Hero($episode: Episode, <span class="attr">$withFriends</span>: <span class="built_in">Boolean</span>!) &#123;</span><br><span class="line">  hero(episode: $episode) &#123;</span><br><span class="line">    name</span><br><span class="line">    friends @include(<span class="keyword">if</span>: $withFriends) &#123;</span><br><span class="line">      name</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// variables</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;episode&quot;</span>: <span class="string">&quot;JEDI&quot;</span>,</span><br><span class="line">  <span class="string">&quot;withFriends&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>We needed to use a new feature in GraphQL called <em>directive</em>. A directive can be attached to a field or fragment inclusion, and can affect execution of the query in any way the server desires. The core GraphQL specification includes exactly two directives, which must be supported by any spec-compliant GraphQL server implementation:</p><ul><li><p>@include(if: Boolean): Only include this field in the result if the argument is <code>true</code></p></li><li><p>@skip(if: Boolean): Skip this field if the argument is <code>true</code></p></li></ul><h3 id="Mutations"><a href="#Mutations" class="headerlink" title="Mutations"></a>Mutations</h3><p>If mutation field returns an object type, you can ask for nested fields. This can be useful for fetching the new state of an object after an update.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mutation CreateReviewForEpisode ($ep: Episode!, $review: ReviewInput!) &#123;</span><br><span class="line">  createReview(episode: $ep, <span class="attr">review</span>: $Review) &#123;</span><br><span class="line">    stars</span><br><span class="line">    commentary</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Variables</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;ep&quot;</span>: <span class="string">&quot;JEDI&quot;</span>,</span><br><span class="line">  <span class="string">&quot;review&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;star&quot;</span>: <span class="number">5</span>,</span><br><span class="line">    <span class="string">&quot;commentary&quot;</span>: <span class="string">&quot;This is a great movie&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Here the <code>createReview</code> returns the <code>star</code> and <code>commentary</code> fields of the newly created review.</p><h4 id="Multiple-fields-in-mutations"><a href="#Multiple-fields-in-mutations" class="headerlink" title="Multiple fields in mutations"></a>Multiple fields in mutations</h4><p>A mutation can contain multiple fields, just like a query. There’s one important distinction between queries and mutations, other than the name.</p><p>While query fields are executed in parallel, mutation fields run in series, one after the other. This means that if we send two <code>incrementCredits</code> mutations in one request, the first is guaranteed to finished before the second begins, ensuring that we don’t end up with a race condition with ourselves.</p><h3 id="Inline-Fragments"><a href="#Inline-Fragments" class="headerlink" title="Inline Fragments"></a>Inline Fragments</h3><p>GraphQL include the ability to define interfaces and union types.</p><p>If you are querying a field that returns an interface or a union type, you will need to use <em>inline fragments</em> to access data on the underlaying concrete type.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">query HeroForEpisode ($ep: Episode!) &#123;</span><br><span class="line">  hero (episode: $ep) &#123;</span><br><span class="line">    name</span><br><span class="line">    ... on Droid &#123;</span><br><span class="line">      primaryFunction</span><br><span class="line">    &#125;</span><br><span class="line">    ... on Human &#123;</span><br><span class="line">      height</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Variables</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;ep&quot;</span>: <span class="string">&quot;JEDI&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// produce</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;data&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;hero&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;...&quot;</span>,</span><br><span class="line">      <span class="string">&quot;primaryFunction&quot;</span>: <span class="string">&quot;...&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>In this query, the <code>hero</code> field returns the type <code>Character</code>, which might be either a <code>Human</code> or a <code>Droid</code> depending on the <code>episode</code> argument. In the direct selection, you can ask for fields that exists on the <code>Character</code> interface such as <code>name</code>.</p><p>To ask for a field on the concrete type, you need to use a <em>inline fragment</em> with a type condition. Because the first fragment is labeled as <code>... on Droid</code>, the <code>primaryFunction</code> field will only be executed if the <code>Character</code> returned from <code>hero</code> is of the <code>Droid</code> type.</p><p>Named fragments can also be used in the same way, since a named fragment always has a type attached.</p><h4 id="Meta-fields"><a href="#Meta-fields" class="headerlink" title="Meta fields"></a>Meta fields</h4><p>Given that there are some situations where you don’t know what type you will get back from the GraphQL service, you need some way to determine how to handle that data on the client. GraphQL allows you to request <code>__typename</code>, a meta field, at any point in a query to get the name of the object type at that point.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  search(text: <span class="string">&quot;an&quot;</span>) &#123;</span><br><span class="line">    __typename</span><br><span class="line">    ... on Human &#123;</span><br><span class="line">      name</span><br><span class="line">    &#125;</span><br><span class="line">    ... on Droid &#123;</span><br><span class="line">      name</span><br><span class="line">    &#125;</span><br><span class="line">    ... on Starship &#123;</span><br><span class="line">      name</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// produce</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;data&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;search&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;__typename&quot;</span>: <span class="string">&quot;Human&quot;</span>,</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Han&quot;</span>,</span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        <span class="string">&quot;__typename&quot;</span>: <span class="string">&quot;Human&quot;</span>,</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;ELX&quot;</span>,</span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        <span class="string">&quot;__typename&quot;</span>: <span class="string">&quot;Starship&quot;</span>,</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;TIE&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>In the above query, <code>search</code> returns a union type that can be one of three options. It would be impossible to tell apart the different types from the client without the <code>__typename</code> field.</p><h3 id="Schemas-and-Types"><a href="#Schemas-and-Types" class="headerlink" title="Schemas and Types"></a>Schemas and Types</h3><h4 id="Type-System"><a href="#Type-System" class="headerlink" title="Type System"></a>Type System</h4><p>GraphQL query language is basically about selecting fields on objects.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  hero &#123;</span><br><span class="line">    name</span><br><span class="line">    appearsIn</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><p>We start with a special ‘root’ object</p></li><li><p>We select the <code>hero</code> field on that</p></li><li><p>For the object returned by <code>hero</code>, we select the <code>name</code> and <code>appearsIn</code> fields</p></li></ol><h4 id="Object-Types-and-Fields"><a href="#Object-Types-and-Fields" class="headerlink" title="Object Types and Fields"></a>Object Types and Fields</h4><p>The most basic components of a GraphQL schema are object types, which just represent a kind of object you can fetch from your service, and what fields it has. In the GraphQL schema language, we might represent it like this:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">type Character &#123;</span><br><span class="line">  name: <span class="built_in">String</span>!</span><br><span class="line">  appearsIn: [Episode]!</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p><code>Character</code> is a <em>GraphQL Type</em>, meaning it’s a type with some fields. Most of the types in your schema will be object types.</p></li><li><p><code>name</code> and <code>appearsIn</code> are <em>fields</em> on the <code>Character</code> type. That means that <code>name</code> and <code>appearsIn</code> are the only fields that can appear in any part of a GraphQL query that operates on the <code>Character</code> type.</p></li><li><p><code>String</code> is one of the built-in <em>scalar</em> types</p></li><li><p><code>String!</code> means that the field is <code>non-nullable</code>, meaning that the GraphQL service promises to always give you a value when you query this field.</p></li><li><p><code>[Episode]!</code> represents an <em>array</em> of <code>Episode</code> objects. Since it is also <em>non-nullable</em>, you can always expect an array ( with zero or more items) when you query the <code>appearsIn</code> field.</p></li></ul><h4 id="Arguments-1"><a href="#Arguments-1" class="headerlink" title="Arguments"></a>Arguments</h4><p>Every field on a GraphQL object type can have zero or more arguments, for example the <code>length</code> field below:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">type Starship &#123;</span><br><span class="line">  id: ID!</span><br><span class="line">  name: <span class="built_in">String</span>!</span><br><span class="line">  length(uint: LengthUint = METER): Float</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>All arguments are named.</p><h4 id="The-Query-and-Mutation-Types"><a href="#The-Query-and-Mutation-Types" class="headerlink" title="The Query and Mutation Types"></a>The Query and Mutation Types</h4><p>Most types in schema will just be normal object types, but there are two types that are special within a schema:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">schema &#123;</span><br><span class="line">  query: Query</span><br><span class="line">  mutation: Mutation</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Every GraphQL service has a <code>query</code> type and may not have a <code>mutation</code> type. These types are the same as a regular object type, but they are special because they define the <em>entry point</em> of every GraphQL query.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">query &#123;</span><br><span class="line">  hero &#123;</span><br><span class="line">    name</span><br><span class="line">  &#125;</span><br><span class="line">  droid(id: <span class="string">&#x27;2000&#x27;</span>) &#123;</span><br><span class="line">    name</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>That means that the GraphQL service needs to have a <code>Query</code> type with <code>hero</code> and <code>droid</code> fields:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">type Query &#123;</span><br><span class="line">  hero(episode: Episode): Character</span><br><span class="line">  droid(id: ID!): Droid</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Mutations work in a similar way - you define fields on the <code>Mutation</code> type, and those are available as the root mutation fields you can call in your query.</p><h4 id="Scalar-Types"><a href="#Scalar-Types" class="headerlink" title="Scalar Types"></a>Scalar Types</h4><ul><li><p><code>Int</code>: A signed 32-bit integer</p></li><li><p><code>Float</code>: A signed double-precision floating-point value</p></li><li><p><code>String</code>: A UTF-8 character sequence</p></li><li><p><code>Boolean</code>: true or false</p></li><li><p><code>ID</code>: The ID Scalar type represents a unique identifier, often used to refetch an object or as the key for a cache. The ID types serialized in the same way as a String; However, defining it as an <code>ID</code> signifies that it is not intended to be human-readable.</p></li></ul><p>In most GraphQL service implementation, there is also a way to specify custom scalar types.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scalar <span class="built_in">Date</span></span><br></pre></td></tr></table></figure><h4 id="Enumeration-Types"><a href="#Enumeration-Types" class="headerlink" title="Enumeration Types"></a>Enumeration Types</h4><p>Also called <em>Enums</em>, enumeration types are a special kind of scalar that is restricted to a particular set of allowed values.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">enum Episode &#123;</span><br><span class="line">  NEWHOPE</span><br><span class="line">  EMPIRE</span><br><span class="line">  JEDI</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This means that wherever we use the type <code>Episode</code> in our schema, we expect it to be exactly one of <code>NEWHOPE</code>, <code>EMPIRE</code>, <code>JEDI</code>.</p><h4 id="Lists-and-Non-Null"><a href="#Lists-and-Non-Null" class="headerlink" title="Lists and Non-Null"></a>Lists and Non-Null</h4><p>Object types, scalars, and enums are the only kinds of types you can define in GraphQL, but when you use the types in other parts of the schema, or in your query variable declarations, you can apply additional <em>type modifier</em> that affects validation of those values.</p><h4 id="Interfaces"><a href="#Interfaces" class="headerlink" title="Interfaces"></a>Interfaces</h4><p>An <em>Interface</em> is an abstract type that includes a certain set of fields that a type must include to implement the interface.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// define</span></span><br><span class="line">interface Character &#123;</span><br><span class="line">  id: ID!</span><br><span class="line">  name: <span class="built_in">String</span>!</span><br><span class="line">  friends: [Character]</span><br><span class="line">  appearsIn: [Episode]!</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// implement</span></span><br><span class="line">type Human implements Character &#123;</span><br><span class="line">  id: ID!</span><br><span class="line">  name: <span class="built_in">String</span>!</span><br><span class="line">  friends: [Character]</span><br><span class="line">  appearsIn: [Episode]!</span><br><span class="line">  starships: [Starship]</span><br><span class="line">  totalCredits: Int</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type Droid implements Character &#123;</span><br><span class="line">  id: ID!</span><br><span class="line">  name: <span class="built_in">String</span>!</span><br><span class="line">  friends: [Character]</span><br><span class="line">  appearsId: [Episode]!</span><br><span class="line">  primaryFunction: <span class="built_in">String</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Union-Types"><a href="#Union-Types" class="headerlink" title="Union Types"></a>Union Types</h4><p>Union Types are similar to interfaces, but they don’t get to specify any common fields between the types.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union SearchResult = Human | Droid | Starship</span><br></pre></td></tr></table></figure><h4 id="Input-Types"><a href="#Input-Types" class="headerlink" title="Input Types"></a>Input Types</h4><p>In GraphQL schema language, input types look exactly the same as regular object types, but with the keyword <code>input</code> instead of <code>type</code>:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">input ReviewInput &#123;</span><br><span class="line">  stars: Int!</span><br><span class="line">  commentary: <span class="built_in">String</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mutation CreateReviewForEpisode($ep: Episode!, $review: ReviewInput!) &#123;</span><br><span class="line">  createReview(episode: $ep, <span class="attr">review</span>: $review) &#123;</span><br><span class="line">    stars</span><br><span class="line">    commentary</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Variables</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;ep&quot;</span>: <span class="string">&quot;JEDI&quot;</span>,</span><br><span class="line">  <span class="string">&quot;review&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;stars&quot;</span>: <span class="number">5</span>,</span><br><span class="line">    <span class="string">&quot;commentary&quot;</span>: <span class="string">&quot;Commentary&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> GraphQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>List of HTTP Status Code</title>
      <link href="/2017/08/03/List-of-HTTP-Status-Code/"/>
      <url>/2017/08/03/List-of-HTTP-Status-Code/</url>
      
        <content type="html"><![CDATA[<h3 id="1xx"><a href="#1xx" class="headerlink" title="1xx"></a>1xx</h3><ul><li><p>100 (continue)</p></li><li><p>101 (Switching Protocols)</p></li></ul><h3 id="2xx"><a href="#2xx" class="headerlink" title="2xx"></a>2xx</h3><ul><li><p>200 (OK)</p></li><li><p>201 (Created): respond to POST Request in RESTFul.</p></li><li><p>202 (Accepted): Server fetch the request, but not respond immediately.</p></li><li><p>203 (Non-Authoritative Information).</p></li><li><p>204 (No Content): Server has handled the request, but no content need to be respond.</p></li><li><p>205 (Reset Content): Server has handled the request, and no content need to be respond. But server request client to reset the document(recover to that before submission).</p></li><li><p>206 (Partial Content): HTTP allowed transferring by piece of data.</p></li></ul><h3 id="3xx"><a href="#3xx" class="headerlink" title="3xx"></a>3xx</h3><p><code>3xx</code> request more operation from client, usually redirect to other page.</p><p>Destination redirect to will be specified in <code>Location</code> in header.</p><ul><li><p>301 (Moved Permanently): The resource has been moved to new position.</p></li><li><p>302 (Found): The resource will be returned from other url temporarily.</p></li><li><p>303 (See Other)</p></li><li><p>304 (Not Modified): Usually work with <code>Etag</code></p></li></ul><p>Server will return <code>304</code> with <code>Etag: &#39;***&#39;</code> to specify resource version. Next time the client request the resource with <code>If-None-Match: &#39;***&#39;</code>, and server checks if the <code>Etag</code> is same to <code>If-None-Match</code>. If same, then return 304.</p><h3 id="4xx"><a href="#4xx" class="headerlink" title="4xx"></a>4xx</h3><p>Client Error.</p><ul><li><p>400 (Bad Request)</p></li><li><p>401 (Unauthorized): Server responds with <code>WWW-Authenticate</code> for authorization info, and client should request with <code>authorization</code> in header next time.</p></li><li><p>403 (Forbidden): Server got the request, and refuse to handle.</p></li><li><p>404 (Method Not Allowed)</p></li><li><p>413 (Request Entity Too Large)</p></li><li><p>414 (Request-URI Too Large)</p></li></ul><h3 id="5xx"><a href="#5xx" class="headerlink" title="5xx"></a>5xx</h3><p>Server Error.</p><ul><li><p>500 (Internal Server Error): Server Bug.</p></li><li><p>502 (Bad Gateway): The Proxy receive invalid response from upstream server.</p></li><li><p>504 (Gateway Time-out).</p></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> HTTP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Short Clip of RxJS</title>
      <link href="/2017/08/01/Short-Clip-of-RxJS/"/>
      <url>/2017/08/01/Short-Clip-of-RxJS/</url>
      
        <content type="html"><![CDATA[<h3 id="Creation"><a href="#Creation" class="headerlink" title="Creation"></a>Creation</h3><p><code>Rx.Observable.create</code> is an alias for the <code>Observable</code> constructor, and it takes one argument: the <code>subscribe</code> function.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> observable = Rx.Observable.create(<span class="function"><span class="keyword">function</span> <span class="title">subscribe</span> (<span class="params">observer</span>) </span>&#123;</span><br><span class="line">  observer.next(<span class="number">1</span>)</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Observable can be created with <code>create</code>, but usually we use the so-called <code>creation operators</code>, like, <code>of</code>, <code>from</code>, <code>interval</code>, etc.</p><h3 id="Subscription"><a href="#Subscription" class="headerlink" title="Subscription"></a>Subscription</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">observable.subscribe(&#123;</span><br><span class="line">  next: <span class="built_in">console</span>.log,</span><br><span class="line">  error: <span class="built_in">console</span>.error,</span><br><span class="line">  complete: <span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;done&#x27;</span>),</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Subscribing to an Observable is like calling a function, providing callbacks where the data will be delivered to.</p><h3 id="Execution"><a href="#Execution" class="headerlink" title="Execution"></a>Execution</h3><p>The code inside <code>Observable.create(function subscribe (observer) &#123; /*...*/ &#125;)</code> represents an <code>Observable execution</code>, a lazy computation that only happens for each Observer that subscribes. The execution produces multiple values over time, either synchronous or asynchronous.</p><p>There are three types of values on Observable Execution can deliver:</p><ul><li><p>‘Next’ notification: sends a value such as a Number, a String, an Object, etc.</p></li><li><p>‘Error’ notification: sends a JavaScript Error or exception.</p></li><li><p>‘Complete’ notification: does not send a value.</p></li></ul><p>In an Observable Execution, zero to infinite Next notifications may be delivered. If either an Error or Complete notification is delivered, then nothing else can be delivered afterwards.</p><p>It’s a good idea to wrap any code in <code>subscribe</code> with <code>try/catch</code> block that will deliver an Error notification if it catches an exception:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> observable = Rx.Observable.create(<span class="function"><span class="keyword">function</span> <span class="title">subscribe</span> (<span class="params">observer</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span>&#123;</span><br><span class="line">    observer.next(<span class="number">1</span>)</span><br><span class="line">    observer.next(<span class="number">2</span>)</span><br><span class="line">    observer.complete()</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    observer.error(err)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Disposing-Observable-Executions"><a href="#Disposing-Observable-Executions" class="headerlink" title="Disposing Observable Executions"></a>Disposing Observable Executions</h3><p>Because Observable Executions may be infinite, and it’s common for an Observer to want abort execution in finite time, we need an API for cancelling an execution. Since each execution is exclusive to one Observer only, once the Observer is done receiving values, it has to have a way to stop the execution, in order to avoid wasting computation power or memory resources.</p><p><code>observable.subscribe</code> will return the <code>Subscription</code> object.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> subscription = observable.subscribe(<span class="function"><span class="params">x</span> =&gt;</span> <span class="built_in">console</span>.log(x))</span><br></pre></td></tr></table></figure><p>The <code>Subscription</code> represents the ongoing execution, and has a minimal API which allows you to cancel that execution.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">subscription.unsubscribe()</span><br></pre></td></tr></table></figure><p>When you subscribe, you get back a Subscription, which represents the ongoing execution. Just call <code>unsubscribe()</code> to cancel the execution.</p><p>You can return a custom <code>unsubscribe</code> function within <code>function subscribe()</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> observale = Rx.Observable.create(<span class="function"><span class="keyword">function</span> <span class="title">subscribe</span> (<span class="params">observer</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> intervalID = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    observer.next(<span class="string">&#x27;hi&#x27;</span>)</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">unsubscribe</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">clearInterval</span>(intervalID)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Observer"><a href="#Observer" class="headerlink" title="Observer"></a>Observer</h3><p>An Observer is a consumer of values delivered by an Observable. Observers are simply a set of callbacks, one of each type of notification delivered by the Observable: <code>next</code>, <code>error</code>, <code>complete</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> observer = &#123;</span><br><span class="line">  next: <span class="built_in">console</span>.log,</span><br><span class="line">  error: <span class="built_in">console</span>.error,</span><br><span class="line">  complete: <span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;done&#x27;</span>),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>To use the observer, provide it to the <code>subscirbe</code> of an Observable.</p><p>When subscribing to an Observable, you may also just provide the callbacks as arguments, without being attached to an Observer object.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">observable.subscribe(<span class="built_in">console</span>.log)</span><br><span class="line"><span class="comment">// it will be treated as</span></span><br><span class="line">observable.subscribe(&#123;</span><br><span class="line">  <span class="built_in">console</span>.log,</span><br><span class="line">  err =&gt; <span class="built_in">console</span>.error(<span class="string">&#x27;Observer got an error: &#x27;</span> + err),</span><br><span class="line">  () =&gt; <span class="built_in">console</span>.log(<span class="string">&#x27;Observable got a complete notification&#x27;</span>),</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Subscription-1"><a href="#Subscription-1" class="headerlink" title="Subscription"></a>Subscription</h3><p>A Subscription is an object that represents a disposable resource, usually the execution of an Observable. A subscription has one important method, <code>unsubscribe</code>, that takes no arguments and just disposes the resources held by the subscription.</p><p>Subscriptions can also be put together, so that a call to an <code>unsubscribe()</code> of one Subscription may unsubscribe multiple Subscriptions. You can do this by ‘ading’ one subscription into another:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> observable1 = Rx.Observable.interval(<span class="number">300</span>)</span><br><span class="line"><span class="keyword">var</span> observable2 = Rx.Observable.interval(<span class="number">500</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> subscription = observable.subscribe(<span class="function"><span class="params">x</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;first: &#x27;</span> + x))</span><br><span class="line"><span class="keyword">var</span> childSubscription = observable2.subscribe(<span class="function"><span class="params">x</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;second: &#x27;</span> + x))</span><br><span class="line"></span><br><span class="line">subscription.ad(childSubscription)</span><br><span class="line">subscription.unsubscribe()</span><br></pre></td></tr></table></figure><h3 id="Subject"><a href="#Subject" class="headerlink" title="Subject"></a>Subject</h3><p>A RxJS Subject is a special type of Observable that allows values to multicasted to many Observers. While plain Observable are unicast(each subscribed Observer owns an independent execution of the Observable), Subjects are multicast.</p><p>A Subject is like an Observable, but can mutlicast to many Observers. Subjects are like <code>EventEmitter</code>: they maintain a registry of many listener.</p><p><code>Every Subject is an Observable</code>. Given a Subject, you can <code>subscribe</code> to it, providing an Observer, which will start receiving values normally.</p><p><code>Every Subject is an Observer</code>. It is an object with the methods <code>next()</code>, <code>error(e)</code>, and <code>complete()</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> subject = <span class="keyword">new</span> Rx.Subject()</span><br><span class="line"></span><br><span class="line">subject.subscribe(&#123;</span><br><span class="line">  next: <span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;observerA: &#x27;</span> + v)</span><br><span class="line">&#125;)</span><br><span class="line">subject.subscribe(&#123;</span><br><span class="line">  next: <span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;observerB: &#x27;</span> + v)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// as observable</span></span><br><span class="line">subject.next(<span class="number">1</span>)</span><br><span class="line">subject.next(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> observable = Rx.Observable.from([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line"><span class="comment">// as observer</span></span><br><span class="line">observable.subscribe(subject)</span><br></pre></td></tr></table></figure><h3 id="multicasted-Observables"><a href="#multicasted-Observables" class="headerlink" title="multicasted Observables"></a>multicasted Observables</h3><p>A multicasted Observable uses a Subject under the hood to make multiple Observers see the same Observable execution.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> source = Rx.Observable.from([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line"><span class="keyword">var</span> subject = <span class="keyword">new</span> Rx.Subject()</span><br><span class="line"><span class="keyword">var</span> multicasted = source.multicast(subject)</span><br><span class="line"></span><br><span class="line"><span class="comment">// There are, under the hood, `subject.subscribe(&#123;...&#125;)`</span></span><br><span class="line">multicasted.subscribe(&#123;</span><br><span class="line">  next: <span class="function"><span class="params">v</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`observerA <span class="subst">$&#123;v&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br><span class="line">multicasted.subscribe(&#123;</span><br><span class="line">  next: <span class="function"><span class="params">v</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`observerB <span class="subst">$&#123;v&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// This is, under the hood, `source.subscribe(subject)`</span></span><br><span class="line">multicasted.connect()</span><br></pre></td></tr></table></figure><p><code>multicast</code> returns an Observable that looks like a normal Observale, but works like a subject when it comes to subscribing. <code>multicast</code> returns a <code>COnnectableObservable</code>, which is simply an Observable with the <code>connect</code> method.</p><p><strong>The <code>connect</code> method is important to determine exactly when the shared Observable execution will start</strong>. Because <code>connect()</code> does <code>source.subscribe(subject)</code> under the hood, <code>connect()</code> returns a Subscription, whcih you can unsubscribe from in order to cancel the shared Observable execution.</p><h3 id="Reference-Counting"><a href="#Reference-Counting" class="headerlink" title="Reference Counting"></a>Reference Counting</h3><p>Calling <code>connect()</code> manually and handling the Subscription is often cumbersome. Ususally we want to <em>automatically</em> connect when the first Observer arrives, and automatically cancel the shared execution when the last Observer unsubscribe.</p><p>Consider the following example where subscriptions occurs as outlined by this list:</p><ol><li>First Observer subscribes to the mutlicasted Observable.</li><li><strong>The multicasted Observable is connected</strong></li><li>The <code>next</code> value 0 is delivered to the first Observable.</li><li>Second Observer subscribes to the multicasted Observable.</li><li>The <code>next</code> value 1 is delivered to the first Observer.</li><li>The <code>next</code> value 1 is delivered to the second Observer.</li><li>First Observer unsubscribes from the mutlicasted Observable.</li><li>The <code>next</code> value 2 is delivered to the second Observer.</li><li>Second Observer unsubscribes from the mutlicasted Observable.</li><li><strong>The connection to the multicasted Observable is unsubscribed</strong>.</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> source = Rx.Observable.interval(<span class="number">500</span>)</span><br><span class="line"><span class="keyword">var</span> subject = <span class="keyword">new</span> Rx.Subject()</span><br><span class="line"><span class="keyword">var</span> multicasted = source.multicast(subject)</span><br><span class="line"><span class="keyword">var</span> subscription1, subscription2, subscriptionConnect</span><br><span class="line"></span><br><span class="line">subscription1 = multicasted.subscribe(&#123;</span><br><span class="line">  next: <span class="function"><span class="params">v</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;observerA: &#x27;</span> + v)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">subscriptionConnect = multicasted.connect()</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  subscription2 = multicasted.subscribe(&#123;</span><br><span class="line">    next: <span class="function"><span class="params">v</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;observerB: &#x27;</span> + v)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;, <span class="number">600</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  subscription1.unsubscribe()</span><br><span class="line">&#125;, <span class="number">1200</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  subscription2.unsubscribe()</span><br><span class="line">  subscriptionConnect.unsubscribe()</span><br><span class="line">&#125;, <span class="number">2000</span>)</span><br></pre></td></tr></table></figure><p>If we wish to avoid explicit calls to <code>connect()</code>, we can use ConnectableObservable’s <code>refCount()</code> method(reference Counting), which returns an Observable that keeps track of how many subscribers it has. When the number of subscribers increases from 0 to 1, it will call <code>connect()</code> for us, which starts the shared execution. Only when the number of subscribers decreases from 1 to 0 will it be fully unsubscribed, stopping further execution.</p><p><code>refCount</code> makes the multicasted Observable automatically start executing when the first subscriber arrives and stop executing when the last subscriber leaves.</p><p>Below is an example:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> source = Rx.Observable.interval(<span class="number">500</span>)</span><br><span class="line"><span class="keyword">var</span> subject = <span class="keyword">new</span> Rx.Subject()</span><br><span class="line"><span class="keyword">var</span> refCounted = source.multicast(subject).refCount()</span><br><span class="line"><span class="keyword">var</span> subscription1, subscription2, subscriptionConnect</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;observerA subscribed&#x27;</span>)</span><br><span class="line">subscription1 = refCounted.subscribe(&#123;</span><br><span class="line">  next: <span class="function"><span class="params">v</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;observerA: &#x27;</span> + v)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;observerB subscribed&#x27;</span>)</span><br><span class="line">  subscription2 = refCounted.subscribe(&#123;</span><br><span class="line">    next: <span class="function"><span class="params">v</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;observerB: &#x27;</span> + v)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;, <span class="number">600</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;observerA unsubscribed&#x27;</span>)</span><br><span class="line">  subscription1.unsubscribe()</span><br><span class="line">&#125;, <span class="number">1200</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;observerB unsubscribed&#x27;</span>)</span><br><span class="line">  subscription2.unsubscribe()</span><br><span class="line">&#125;, <span class="number">2000</span>)</span><br></pre></td></tr></table></figure><p>The <code>refCount()</code> method only exists on ConnectableObservable, and it returns an <code>Observable</code>, not another ConnectableObservable.</p><h3 id="BehaviorSubject"><a href="#BehaviorSubject" class="headerlink" title="BehaviorSubject"></a>BehaviorSubject</h3><p>One of the variant of Subjects is the <code>BehaviorSubject</code>, which has a notion of ‘the current value’. It stores the latest value emitted to its consumers, and whenever a new Observer subscribes, it will immediately receive the ‘current value’ from the <code>BehaviorSubject</code>.</p><p>BehaviorSubjects are useful for representing ‘values over time’. For instance, an event stream of birthdays is a Subject, but the stream of a person’s age would be a BehaviorSubject.</p><h3 id="ReplaySubject"><a href="#ReplaySubject" class="headerlink" title="ReplaySubject"></a>ReplaySubject</h3><p>A <code>ReplaySubject</code> is similar to a <code>BehaviorSubject</code> in that it can send old values to new subscribers, but it can also <em>record</em> a part of the Observable execution.</p><p>A <code>ReplaySubject</code> records multiple values from the Observable execution and replays them to new subscribers.</p><p>When creating a <code>ReplaySubject</code>, you can specify how many values to replay:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> subject = <span class="keyword">new</span> Rx.ReplaySubject(<span class="number">3</span>) <span class="comment">// buffer 3 values for new subscribers</span></span><br><span class="line"></span><br><span class="line">subject.subscribe(&#123;</span><br><span class="line">  next: <span class="function"><span class="params">v</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;ObserverA: &#x27;</span> + v)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">subject.next(<span class="number">1</span>)</span><br><span class="line">subject.next(<span class="number">2</span>)</span><br><span class="line">subject.next(<span class="number">3</span>)</span><br><span class="line">subject.next(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">subject.subscribe(&#123;</span><br><span class="line">  next: <span class="function"><span class="params">v</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;ObserverB: &#x27;</span> + v)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">subject.next(<span class="number">5</span>)</span><br></pre></td></tr></table></figure><p>You can also specify a <em>window time</em> in milliseconds, besides of the buffer size, to determine how old the recorded values can be.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> subject = <span class="keyword">new</span> Rx.ReplaySubject(<span class="number">3</span>, <span class="number">500</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><h3 id="AsyncSubject"><a href="#AsyncSubject" class="headerlink" title="AsyncSubject"></a>AsyncSubject</h3><p>The AsyncSubject is a variant where only the last value of the Observale execution is sent to its observers, and only when the execution completes.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> subject = <span class="keyword">new</span> Rx.AsyncSubject()</span><br><span class="line"></span><br><span class="line">subject.subscribe(&#123;</span><br><span class="line">  next: <span class="function"><span class="params">v</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;ObserverA: &#x27;</span> + v)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">subject.next(<span class="number">1</span>)</span><br><span class="line">subject.next(<span class="number">2</span>)</span><br><span class="line">subject.next(<span class="number">3</span>)</span><br><span class="line">subject.next(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">subject.subscribe(&#123;</span><br><span class="line">  next: <span class="function"><span class="params">v</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;ObserverB: &#x27;</span> + v)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">subject.next(<span class="number">5</span>)</span><br><span class="line">subject.complete()</span><br></pre></td></tr></table></figure><h3 id="Operators"><a href="#Operators" class="headerlink" title="Operators"></a>Operators</h3><p>An Operator is a function which creates a new Observable based on the current Observable. This is a pure operation: the previous Observable stays unmodified.</p><p>An Operator is essentially a pure function which takes one Observable as input and generates another Observable as output.</p><p>Subscirbing to the output Observable will also subscribe to the input Observable.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">multiplyTen</span>(<span class="params">input</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> output = Rx.Observable.create(<span class="function"><span class="keyword">function</span> <span class="title">subscribe</span>(<span class="params">observer</span>) </span>&#123;</span><br><span class="line">    input.subscribe(&#123;</span><br><span class="line">      next: <span class="function"><span class="params">v</span> =&gt;</span> observer.next(<span class="number">10</span> * v),</span><br><span class="line">      error: <span class="function"><span class="params">err</span> =&gt;</span> observer.error(err),</span><br><span class="line">      complete: <span class="function">() =&gt;</span> observer.compelte()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> output</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> input = Rx.Observable.from([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line"><span class="keyword">var</span> output = multiplyTen(input)</span><br><span class="line">output.subscribe(<span class="function"><span class="params">x</span> =&gt;</span> <span class="built_in">console</span>.log(x))</span><br></pre></td></tr></table></figure><p>Notice that a subscribe to <code>output</code> will cause <code>input</code> Observable to be subscirbed. It’s called <code>operator subscription chain</code>.</p><h3 id="Instance-Operators"><a href="#Instance-Operators" class="headerlink" title="Instance Operators"></a>Instance Operators</h3><p>Instance operators are methods on Observable instances.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Rx.Observable.prototype.multiplyByTen = <span class="function"><span class="keyword">function</span> <span class="title">multiplyByTen</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> input = <span class="built_in">this</span></span><br><span class="line">  <span class="keyword">return</span> Rx.Observable.create(<span class="function"><span class="keyword">function</span> <span class="title">subscirbe</span> (<span class="params">observer</span>) </span>&#123;</span><br><span class="line">    input.subscribe(&#123;</span><br><span class="line">      next: <span class="function"><span class="params">v</span> =&gt;</span> observer.next(<span class="number">10</span> * v),</span><br><span class="line">      error: <span class="function">(<span class="params">err</span>) =&gt;</span> observer.error(err),</span><br><span class="line">      complete: <span class="function">() =&gt;</span> observer.complete(),</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> observable = Rx.Observable.from([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]).multiplyByTen()</span><br></pre></td></tr></table></figure><p>Instance operators are functions that use the <code>this</code> keyword to <code>infer</code> waht is the input Observable.</p><h3 id="Static-Operators"><a href="#Static-Operators" class="headerlink" title="Static Operators"></a>Static Operators</h3><p>Static operators are functions attached ot the Observable class directly. A static operator uses no <code>this</code> keyword internally, but instead relies entirely on its arguments.</p><p>Static Operators are usually used to create Observables from scratch.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> observable = Rx.Observable.interval(<span class="number">1000</span> <span class="comment">/* number of milliseconds */</span>)</span><br></pre></td></tr></table></figure><p>Some combination operators may be static, such as <code>merge</code>, <code>combineLatest</code>, <code>concat</code>, etc. These make sense as static operators because they take <code>multiple</code> Observables as input, not just one.</p>]]></content>
      
      
      
        <tags>
            
            <tag> RxJS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Http Cache: Etag, Last-Modified, Cache-Control</title>
      <link href="/2017/08/01/http-cache-Etag-Last-Modified-Cache-Control/"/>
      <url>/2017/08/01/http-cache-Etag-Last-Modified-Cache-Control/</url>
      
        <content type="html"><![CDATA[<h3 id="Cache-Control"><a href="#Cache-Control" class="headerlink" title="Cache-Control"></a>Cache-Control</h3><p><code>Cache-Control</code> general-header field is used to specify deirectives that MUST be obeyed by all caching mechanisms along the request/response chain.</p><p>When the <code>Cache-Control</code> allow to cache, like <code>Cache-Control: public, max-age: 86400</code>, it means that in this day the browser can use the cahce directly without any request to server.a</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> http: <span class="string">&#x27;http&#x27;</span></span><br><span class="line"><span class="keyword">let</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.setHeader(<span class="string">&#x27;Cache-Control&#x27;</span>, <span class="string">&#x27;public&#x27;</span>, <span class="string">&#x27;max-age=86400&#x27;</span>)</span><br><span class="line">  res.end(<span class="string">&#x27;hello world&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure><h3 id="Etag"><a href="#Etag" class="headerlink" title="Etag"></a>Etag</h3><p>Used for conditional HTTP request.</p><p><code>Etag</code> represents Version of Resource, browser will add <code>If-None-Match</code> in headers with request. If the resource on server has not been modified, code 304 will be returned.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> http <span class="keyword">from</span> <span class="string">&#x27;http&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(req.url, req.headers[<span class="string">&#x27;if-none-match&#x27;</span>])</span><br><span class="line">  <span class="keyword">if</span> (req.headers[<span class="string">&#x27;if-none-match&#x27;</span>]) &#123;</span><br><span class="line">    <span class="comment">// check if resource modified</span></span><br><span class="line">    res.statusCode = <span class="number">304</span></span><br><span class="line">    res.end()</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res.setHeader(<span class="string">&#x27;Etag&#x27;</span>, <span class="string">&#x27;0000000&#x27;</span>)</span><br><span class="line">    res.end(<span class="string">&#x27;hello world&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure><h3 id="Last-Modified"><a href="#Last-Modified" class="headerlink" title="Last-Modified"></a>Last-Modified</h3><p>Similar to <code>Etag</code>, <code>Last-Modified</code> represents if the resource modified. It uses <code>time when modified</code> instead of <code>version tag</code>.</p><p>The key in header is <code>If-Modified-Since</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> http <span class="keyword">from</span> <span class="string">&#x27;http&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(req.url, req.headers[<span class="string">&#x27;if-modified-since&#x27;</span>])</span><br><span class="line">  <span class="keyword">if</span> (req.headers[<span class="string">&#x27;if-modified-since&#x27;</span>]) &#123;</span><br><span class="line">    <span class="comment">// check timestamp</span></span><br><span class="line">    res.statusCode = <span class="number">304</span></span><br><span class="line">    res.end()</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res.setHeader(<span class="string">&#x27;Last-Modified&#x27;</span>, <span class="keyword">new</span> <span class="built_in">Date</span>().toString())</span><br><span class="line">    res.end(<span class="string">&#x27;hello world&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> HTTP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WS on Node</title>
      <link href="/2017/07/31/WebSocket-on-Node/"/>
      <url>/2017/07/31/WebSocket-on-Node/</url>
      
        <content type="html"><![CDATA[<h3 id="Create-WS-Server"><a href="#Create-WS-Server" class="headerlink" title="Create WS Server"></a>Create WS Server</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// get WS Object</span></span><br><span class="line"><span class="keyword">const</span> WebSocket = <span class="built_in">require</span>(<span class="string">&#x27;ws&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create new Server Instance</span></span><br><span class="line"><span class="keyword">const</span> ws = <span class="keyword">new</span> WebSocket.Server(&#123;</span><br><span class="line">  port: <span class="number">80</span>, <span class="comment">// port</span></span><br><span class="line">  verifyClient: socketverify <span class="comment">// (optional)function to verify connection</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="new-WebSocket-Server-options-callback"><a href="#new-WebSocket-Server-options-callback" class="headerlink" title="new WebSocket.Server(options[, callback])"></a>new WebSocket.Server(options[, callback])</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">options: &#123;</span><br><span class="line">  host: string,</span><br><span class="line">  port: number,</span><br><span class="line">  backlog: number, &#x2F;&#x2F; the maximum length of the queue of pending connection.</span><br><span class="line">  server: http.Server | https.Server, &#x2F;&#x2F; a pre-created Node Http Server.</span><br><span class="line">  verifyClient: function, &#x2F;&#x2F; a function which can be used to validate incoming connections.</span><br><span class="line">  handleProtocols: function, &#x2F;&#x2F; a function which can be used to handle the WebSocket subprotocols.</span><br><span class="line">  path: string, &#x2F;&#x2F; Accept only connections matching this path.</span><br><span class="line">  noServer: boolean, &#x2F;&#x2F; Enable no server mode.</span><br><span class="line">  clientTracking: boolean, &#x2F;&#x2F; Specifies whether or not track clients.</span><br><span class="line">  perMessageDeflate: boolean | object, &#x2F;&#x2F; Enable&#x2F;Disable permessage-deflate.</span><br><span class="line">  maxPayload: number, &#x2F;&#x2F; Maximum allowed message size in bytes.</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Create a new server instance. One of <code>port</code>, <code>server</code>, or <code>noServer</code> must be provided or an error is thrown.</p><h3 id="Set-VerifyClient"><a href="#Set-VerifyClient" class="headerlink" title="Set VerifyClient"></a>Set VerifyClient</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">socketverify</span>(<span class="params">info</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// connect if return true</span></span><br><span class="line">  <span class="keyword">var</span> origin = info.origin.match(<span class="comment">/*...*/</span>)</span><br><span class="line">  <span class="keyword">if</span> (<span class="comment">/*...*/</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>If <code>verifyClient</code> is not set then the handshake is automatically accepted. If it is is provided with a single argument then that is:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">info: &#123;</span><br><span class="line">  origin: string, &#x2F;&#x2F; The value in the Origin header indicated by the client.</span><br><span class="line">  req: http.incomingMessage, &#x2F;&#x2F; The client HTTP GET request.</span><br><span class="line">  secure: boolean, &#x2F;&#x2F; &#96;true&#96; is &#96;req.connection.authorized&#96; or &#96;req.connection.encrypted&#96; is set.</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>If the <code>verifyClient</code> provided with 2 arguments, the second one is <code>cb</code>, which accepts <code>result: boolean</code>, <code>code: number</code>, <code>name: string</code>.</p><h3 id="Handle-Request"><a href="#Handle-Request" class="headerlink" title="Handle Request"></a>Handle Request</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">ws.on(<span class="string">&#x27;connect&#x27;</span>, <span class="function">(<span class="params">socket</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// the socket is a connect to client</span></span><br><span class="line">  <span class="comment">// usually you should push it in an array for management</span></span><br><span class="line">  socket.onmessage = message</span><br><span class="line">  socket.onclose = close</span><br><span class="line">  socket.onerror = error</span><br><span class="line">  socket.onopen = open</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">message</span>(<span class="params">msg</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">error</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">close</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">open</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Events"><a href="#Events" class="headerlink" title="Events"></a>Events</h4><h3 id="Methods"><a href="#Methods" class="headerlink" title="Methods"></a>Methods</h3><h4 id="Sending-msg"><a href="#Sending-msg" class="headerlink" title="Sending msg"></a>Sending msg</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socket.send(data[, options[, callback]])</span><br></pre></td></tr></table></figure><ul><li><p>data: binary or string</p></li><li><p>options:</p><ul><li><p>mask: true | false  是否使用掩码</p></li><li><p>binary: true | false 是否二进制流</p></li><li><p>compress: true | false 是否压缩</p></li></ul></li><li><p>callback: 回调</p></li></ul><h4 id="close-connection"><a href="#close-connection" class="headerlink" title="close connection"></a>close connection</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socket.close([code], [data])</span><br></pre></td></tr></table></figure><ul><li><p>code: 返回一个状态码</p></li><li><p>data: 结束连接时发送的信息</p></li></ul><h4 id="pause"><a href="#pause" class="headerlink" title="pause"></a>pause</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socket.pause()</span><br></pre></td></tr></table></figure><h4 id="resume"><a href="#resume" class="headerlink" title="resume"></a>resume</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socket.resume()</span><br></pre></td></tr></table></figure><h4 id="PING"><a href="#PING" class="headerlink" title="PING"></a>PING</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socket.ping([data], [options], [dontFailWhenClosed])</span><br></pre></td></tr></table></figure><ul><li><p>data: ping 的时候发送的信息</p></li><li><p>options: 同 send</p></li><li><p>dontFailWhenClosed: true | false // 如果连接断开, 是否抛出错误</p></li></ul><h4 id="PONG"><a href="#PONG" class="headerlink" title="PONG"></a>PONG</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socket.pong([data], [options], [dontFailWhenClosed])</span><br></pre></td></tr></table></figure><p>Ping 和 Pong 的区别在于, 一个包含 ping 帧(0x9), 一个包含 pong 帧(0xA)</p><p>pong 是对于接到 ping 之后的回应, 让双方都知道连接还存在</p><h4 id="stream"><a href="#stream" class="headerlink" title="stream"></a>stream</h4><h4 id="terminate"><a href="#terminate" class="headerlink" title="terminate"></a>terminate</h4>]]></content>
      
      
      
        <tags>
            
            <tag> Web Socket </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Short Clip of TypeScript(1)</title>
      <link href="/2017/07/31/Short-Clip-of-TypeScript(1)/"/>
      <url>/2017/07/31/Short-Clip-of-TypeScript(1)/</url>
      
        <content type="html"><![CDATA[<h3 id="Basic-Types"><a href="#Basic-Types" class="headerlink" title="Basic Types"></a>Basic Types</h3><p><code>Boolean</code>, <code>Number</code>, <code>String</code>, <code>Array</code>, <code>Tuple</code>, <code>Enum</code>, <code>Any</code>, <code>Void</code>, <code>Null</code>, <code>Undefined</code>, <code>Never</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Boolean</span></span><br><span class="line"><span class="keyword">let</span> isDone: boolean: <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Number</span></span><br><span class="line"><span class="keyword">let</span> decimal: number = <span class="number">6</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// String</span></span><br><span class="line"><span class="keyword">let</span> color: string = <span class="string">&#x27;red&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Array</span></span><br><span class="line"><span class="keyword">let</span> list: number[] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">let</span> list: <span class="built_in">Array</span>&lt;number&gt; = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// Tuple</span></span><br><span class="line"><span class="keyword">let</span> x: [string, number] = [<span class="string">&#x27;hello&#x27;</span>, <span class="number">10</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// Enum</span></span><br><span class="line">enum Color &#123;Red, Green, Blue&#125;</span><br><span class="line"><span class="keyword">let</span> c: Color = Color.Green <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Any</span></span><br><span class="line"><span class="keyword">let</span> notSure = <span class="number">5</span></span><br><span class="line">notSure = <span class="string">&#x27;not sure&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Void</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">warnUser</span> (<span class="params"></span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">  alert(<span class="string">&#x27;This is my warning message&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Never</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">error</span>(<span class="params">message: string</span>): <span class="title">never</span> </span>&#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(message)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Note:</p><blockquote><p>By default <code>null</code> and <code>undefined</code> are subtypes of all other types, that means you can assign <code>null</code> and <code>undefined</code> to something like <code>number</code></p></blockquote><blockquote><p>However, when using <code>--strictNullChecks</code> flag, <code>null</code> and <code>undefined</code> are only assignable to <code>void</code> and their respective types. This helps avoid many common errors. In cases where you want to pass in either a <code>string</code> or <code>null</code> or <code>undefined</code>, you can use the <code>union type</code> <code>string | null | undefined</code>.</p></blockquote><h3 id="Type-assertions"><a href="#Type-assertions" class="headerlink" title="Type assertions"></a>Type assertions</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> someValue = <span class="string">&#x27;this is a string&#x27;</span></span><br><span class="line"><span class="keyword">let</span> strLength: number = (<span class="xml"><span class="tag">&lt;<span class="name">string</span>&gt;</span>someValue).length</span></span><br><span class="line"><span class="xml">let strLength: number = (someValue as string).length</span></span><br></pre></td></tr></table></figure><h3 id="Variable-Declarations"><a href="#Variable-Declarations" class="headerlink" title="Variable Declarations"></a>Variable Declarations</h3><h3 id="Interfaces"><a href="#Interfaces" class="headerlink" title="Interfaces"></a>Interfaces</h3><blockquote><p>One of TypeScript’s core principles is that type-checking focuses on the <em>shape</em> that value have. This is sometimes called ‘duck typing’ or ‘structural subtyping’. In TypeScript, interface fill the role of naming these types and are a powerful way of defining contracts within your code as well as contracts with code outside your project.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printLabel</span>(<span class="params">labelObj: &#123; label: string &#125;</span>) </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Or</span></span><br><span class="line">interface LabelledValue &#123;</span><br><span class="line">  label: string;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printLabel</span>(<span class="params">labelObj: LabelledValue</span>) </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Optional-Properties"><a href="#Optional-Properties" class="headerlink" title="Optional Properties"></a>Optional Properties</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">interface SquareConfig &#123;</span><br><span class="line">  color?: string;</span><br><span class="line">  width?: number;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Readonly-Properties"><a href="#Readonly-Properties" class="headerlink" title="Readonly Properties"></a>Readonly Properties</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">interface Point &#123;</span><br><span class="line">  readonly x: number;</span><br><span class="line">  readonly y: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> ro: ReadonlyArray&lt;number&gt;</span><br></pre></td></tr></table></figure><blockquote><p>Note: Readonly Array</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a: number[] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">let</span> ro: ReadonlyArray&lt;number&gt; = a</span><br><span class="line">ro[<span class="number">0</span>] = <span class="number">12</span> <span class="comment">// error</span></span><br><span class="line">ro.push(<span class="number">5</span>) <span class="comment">// error</span></span><br><span class="line">ro.legnth = <span class="number">100</span> <span class="comment">// error</span></span><br><span class="line">a = ro <span class="comment">// error</span></span><br></pre></td></tr></table></figure><p>You can’t assign the entire <code>ReadonlyArray</code> back to a normal array. Instead, you could do this:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a = ro <span class="keyword">as</span> number[]</span><br></pre></td></tr></table></figure><blockquote><p>Object literals get special treatment and undergo <em>excess property checking</em> when assigning them to other variables, or <em>passing them as arguments</em>. If an object literal has any properties that the <code>target type</code> doesn’t have, you’ll get an error.</p></blockquote><h3 id="Adding-Index-Signature"><a href="#Adding-Index-Signature" class="headerlink" title="Adding Index Signature"></a>Adding Index Signature</h3><p>Add a string index signature if you’re sure that the object can have some extra properties that are used in some special way.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">interface SquareConfig &#123;</span><br><span class="line">  color?: string;</span><br><span class="line">  width?: number;</span><br><span class="line">  [propName: string]: any;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Function-Types"><a href="#Function-Types" class="headerlink" title="Function Types"></a>Function Types</h3><p>To describe a function type with an interface, we give the interface a <code>call signature</code>. This is like a function declaration with only the parameter list and return type given. Each parameter in the parameter list requires both name and type.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">interface SearchFunc &#123;</span><br><span class="line">  (source: string, <span class="attr">subString</span>: string): boolean;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> mySearch: SearchFunc</span><br><span class="line"></span><br><span class="line">mySearch = <span class="function"><span class="keyword">function</span> (<span class="params">source: string, subString: string</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> result = source.search(subString)</span><br><span class="line">  <span class="keyword">return</span> result &gt; <span class="number">-1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Indexable-Types"><a href="#Indexable-Types" class="headerlink" title="Indexable Types"></a>Indexable Types</h3><p>Similarly to how we can use interfaces to describe function types, we can also describe types that we can ‘index into’ like <code>a[10]</code> or <code>ageMap[&#39;daniel&#39;]</code>. Indexable types have an <em>index signature</em> that describes the types we can use to index into the object, along with the corresponding return types when indexing.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">interface StringArray &#123;</span><br><span class="line">  [index: number]: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> myArray: StringArray</span><br><span class="line">myArray = [<span class="string">&#x27;Bob&#x27;</span>, <span class="string">&#x27;Fred&#x27;</span>]</span><br><span class="line"><span class="keyword">let</span> myStr: string = myArray[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// readonly</span></span><br><span class="line">interface ReadonlyStringArray &#123;</span><br><span class="line">  readonly [index: number]: string</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Class-Types"><a href="#Class-Types" class="headerlink" title="Class Types"></a>Class Types</h3><p>Implementing an interface.</p><p>One of the most common uses of interfaces is explicitly enforcing a class meets a particular contract.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">inerface ClockInterface &#123;</span><br><span class="line">  currentTime: <span class="built_in">Date</span>;</span><br><span class="line">  setTime(d: <span class="built_in">Date</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Clock</span> <span class="title">implements</span> <span class="title">ClockInterface</span> </span>&#123;</span><br><span class="line">  currentTime: <span class="built_in">Date</span></span><br><span class="line">  setTime(d: <span class="built_in">Date</span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>.currentTime = d</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">constructor</span> (h: number, m: number) &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>Interface describe the public side of the class, rather than both the public and private side. This prohibits you from using them to check that a class also have particular types for the private side of the class instance.</p></blockquote><blockquote><p>Difference between the static and instance side of classes.</p></blockquote><blockquote><p>When working with classes and interfaces, it helps to keep in mind that a class <em>have two types</em>: the type of static side and the type of the instance side.</p></blockquote><blockquote><p>When a class implements an interface, only the instance side of the class is checked.</p></blockquote><blockquote><p>Notice: constructor sits in the static side, it is not included in this check.</p></blockquote><h3 id="Extending-Interfaces"><a href="#Extending-Interfaces" class="headerlink" title="Extending Interfaces"></a>Extending Interfaces</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">interface Shape &#123;</span><br><span class="line">  color: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface Square <span class="keyword">extends</span> Shape &#123;</span><br><span class="line">  sideLength: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> square = <span class="xml"><span class="tag">&lt;<span class="name">Square</span>&gt;</span>&#123;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">square.color = &#x27;blue&#x27;</span></span><br><span class="line"><span class="xml">square.sideLength = 10</span></span><br></pre></td></tr></table></figure><blockquote><p>An interface can extend multiple interface, creating a combination of all of the interfaces.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">interface Shape &#123;</span><br><span class="line">  color: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface PenStroke &#123;</span><br><span class="line">  penWidth: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface Square <span class="keyword">extends</span> Shape, PenStroke &#123;</span><br><span class="line">  sideLength: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> square = <span class="xml"><span class="tag">&lt;<span class="name">Square</span>&gt;</span>&#123;&#125;</span></span><br></pre></td></tr></table></figure><h3 id="Hybrid-Types"><a href="#Hybrid-Types" class="headerlink" title="Hybrid Types"></a>Hybrid Types</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">interface Counter &#123;</span><br><span class="line">  (start: number): string;</span><br><span class="line">  interval: number;</span><br><span class="line">  reset(): <span class="keyword">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCounter</span>(<span class="params"></span>): <span class="title">Counter</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> counter = <span class="xml"><span class="tag">&lt;<span class="name">Counter</span>&gt;</span>function (start: number)</span></span><br><span class="line"><span class="xml">  counter.interval = 123;</span></span><br><span class="line"><span class="xml">  counter.reset = function () &#123;&#125;</span></span><br><span class="line"><span class="xml">  return counter</span></span><br><span class="line"><span class="xml">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="Interface-Extending-Classes"><a href="#Interface-Extending-Classes" class="headerlink" title="Interface Extending Classes"></a>Interface Extending Classes</h3><blockquote><p>When an interface type extends a class type it inherits members of the class but not their implementations. It is as if the interface has declared all of the members of the class without providing an implementation. Interface inherits even the private and protected members of a base class. This means that when you create an interface that extends a class with private or protected members, that interface type can only be implemented by that class or a subclass of it.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Control</span> </span>&#123;</span><br><span class="line">  private state: any;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface SelectableControl <span class="keyword">extends</span> Control &#123;</span><br><span class="line">  select(): <span class="keyword">void</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Button</span> <span class="keyword">extends</span> <span class="title">Control</span> </span>&#123;</span><br><span class="line">  select() &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Classes"><a href="#Classes" class="headerlink" title="Classes"></a>Classes</h3><p>Example:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Greeter</span> </span>&#123;</span><br><span class="line">  greeting: string;</span><br><span class="line">  <span class="keyword">constructor</span> (message: string) &#123;</span><br><span class="line">    <span class="built_in">this</span>.greeting = message;</span><br><span class="line">  &#125;</span><br><span class="line">  greet() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello, &#x27;</span> + <span class="built_in">this</span>.greeting;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> greeter = <span class="keyword">new</span> Greeter(<span class="string">&#x27;world&#x27;</span>)</span><br></pre></td></tr></table></figure><h4 id="Class-Inheritance"><a href="#Class-Inheritance" class="headerlink" title="Class Inheritance"></a>Class Inheritance</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  name: string;</span><br><span class="line">  <span class="keyword">constructor</span>(theName: string) &#123;</span><br><span class="line">    <span class="built_in">this</span>.name = theName</span><br><span class="line">  &#125;</span><br><span class="line">  move(distanceInMeters: number = <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.name&#125;</span> moved <span class="subst">$&#123;distanceInMeters&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Snake</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> (name: string) &#123;</span><br><span class="line">    <span class="built_in">super</span>(name)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  move(distanceInMeters = <span class="number">5</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Slithering...&#x27;</span>)</span><br><span class="line">    <span class="built_in">super</span>.move(distanceInMeters)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hores</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> (name: string) &#123;</span><br><span class="line">    <span class="built_in">super</span>(name)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  move(distanceInMeters = <span class="number">45</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Galloping...&#x27;</span>)</span><br><span class="line">    <span class="built_in">super</span>.move(distanceInMeters)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Public-Private-Protected-Modifiers"><a href="#Public-Private-Protected-Modifiers" class="headerlink" title="Public, Private, Protected Modifiers"></a>Public, Private, Protected Modifiers</h4><blockquote><p>Public by default</p></blockquote><blockquote><p>Private: when a member is marked <code>private</code>, it cannot be accessed from outside of its containing class.</p></blockquote><blockquote><p>Protected: The protected modifier acts much like the <code>private</code> modifier with exception that members declared <code>protected</code> can also be accessed by instance of deriving classes. Namely the <code>protected</code> property can be used in instance method.</p></blockquote><h4 id="Readonly-Modifier"><a href="#Readonly-Modifier" class="headerlink" title="Readonly Modifier"></a>Readonly Modifier</h4><blockquote><p>Readonly properties must be initialized at their declaration or in the constructor.</p></blockquote><h4 id="Accessors"><a href="#Accessors" class="headerlink" title="Accessors"></a>Accessors</h4><blockquote><p>TypeScript supports getters/setters as a way of intercepting accesses to a member of an object.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line">  private _fullName: string;</span><br><span class="line">  <span class="keyword">get</span> <span class="title">fullName</span>(): <span class="title">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._fullName;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">set</span> <span class="title">fullName</span>(<span class="params">newName: string</span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>._fullName = newName;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Static-Properties"><a href="#Static-Properties" class="headerlink" title="Static Properties"></a>Static Properties</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Grid</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> origin = &#123;<span class="attr">x</span>: <span class="number">0</span>, <span class="attr">y</span>: <span class="number">0</span>&#125;</span><br><span class="line">  calculateDistanceFromOrigin(point: &#123;<span class="attr">x</span>: number, <span class="attr">y</span>: number&#125;) &#123;</span><br><span class="line">    <span class="keyword">let</span> xDist = (point.x - Grid.origin.x)</span><br><span class="line">    <span class="keyword">let</span> yDist = (point.y - Grid.origin.y)</span><br><span class="line">    retrun <span class="built_in">Math</span>.sqrt(xDist * xDist + yDist * yDist) / <span class="built_in">this</span>.scale</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">constructor</span> (public scale: number) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Abstract-Classes"><a href="#Abstract-Classes" class="headerlink" title="Abstract Classes"></a>Abstract Classes</h4><blockquote><p>Abstract classes are base classes from which other classes may be derived. They may not be instantiated directly.</p></blockquote><blockquote><p>Unlike an interface, an abstract class may contain implementation detail for its members. The <code>abstract</code> keyword is used to define abstract classes as well as abstract methods within an abstract class.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">abstract <span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  abstract makeSound: <span class="keyword">void</span>;</span><br><span class="line">  move(): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;roaming the earth...&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>Methods within an abstract class that are marked as abstract do not contain an implementation and must be implemented in derived classes.</p></blockquote><blockquote><p>Abstract methods share a similar syntax to interface methods. Both define the signature of a method without including a method body.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">abstract <span class="class"><span class="keyword">class</span> <span class="title">Department</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> (public name: string) &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  printName (): <span class="keyword">void</span> &#123;</span><br><span class="line">  &#125;</span><br><span class="line">  abstract printMeetng () :<span class="keyword">void</span> <span class="comment">// must be implemented in derived classes</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AccountDepartment</span> <span class="keyword">extends</span> <span class="title">Department</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> ()&#123;</span><br><span class="line">    <span class="built_in">super</span>(<span class="string">&#x27;Accounting and Auditing&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  printMeetng (): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">  generateReports () : <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Advanced-Techniques"><a href="#Advanced-Techniques" class="headerlink" title="Advanced Techniques"></a>Advanced Techniques</h4><h5 id="Constructor-Functions"><a href="#Constructor-Functions" class="headerlink" title="Constructor Functions"></a>Constructor Functions</h5><blockquote><p>When you declare a class in TypeScript, you are actually creating multiple declarations at the same time. The first is the type of the <code>instance</code> of the class.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Greeter</span> </span>&#123;</span><br><span class="line">  greeting: string;</span><br><span class="line">  <span class="keyword">constructor</span> (message: string) &#123;</span><br><span class="line">    <span class="built_in">this</span>.greeting = message;</span><br><span class="line">  &#125;</span><br><span class="line">  greet () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello, &#x27;</span> + <span class="built_in">this</span>.greeting;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> greeter: Greeter;</span><br><span class="line">greeter = <span class="keyword">new</span> Greeter(<span class="string">&#x27;world&#x27;</span>)</span><br></pre></td></tr></table></figure><blockquote><p>Here when we say <code>let greeter: Greeter</code>, we’re using <code>Greeter</code> as the type of instance of the class <code>Greeter</code>. Almost we use the class constructor as a type.</p></blockquote><h5 id="Using-a-class-as-an-interface"><a href="#Using-a-class-as-an-interface" class="headerlink" title="Using a class as an interface"></a>Using a class as an interface</h5><blockquote><p>A class declaration creates two things: a type representing instances of the class, and a constructor function.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">  x: number;</span><br><span class="line">  y: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface Point3d <span class="keyword">extends</span> Point &#123;</span><br><span class="line">  z: number;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> TypeScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Web App Manifest</title>
      <link href="/2017/07/29/Web-App-Manifest/"/>
      <url>/2017/07/29/Web-App-Manifest/</url>
      
        <content type="html"><![CDATA[<p>The web app manifest provides information about an application(such as <code>name</code>, <code>author</code>, <code>icon</code> and <code>description</code>) in a JSON text file. The purpose of the manifest is to install web application to the homescreen of a device, providing users with quicker access and a richer experience.</p><p>Web app manifest are part of a collection of web technologies called <code>progressive web apps</code>, which are web applications that can be installed to the homescreen of a device without needing the user to go through an app store, along with other capabilities such as being available offline and receiving push notification.</p><h3 id="Deploying-a-manifest"><a href="#Deploying-a-manifest" class="headerlink" title="Deploying a manifest"></a>Deploying a manifest</h3><p>Web app manifests are deployed in your HTML pages using a <code>link</code> tag in the head of your document.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;link ref=<span class="string">&quot;manifest&quot;</span> href=<span class="string">&quot;/manifest.json&quot;</span> /&gt;</span><br></pre></td></tr></table></figure><h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;HackerWeb&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;short_name&quot;</span>: <span class="string">&quot;Hacker&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;start_url&quot;</span>: <span class="string">&quot;.&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;display&quot;</span>: <span class="string">&quot;standalone&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;background_color&quot;</span>: <span class="string">&quot;#fff&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;A simple readable Hacker New app.&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;icons&quot;</span>: [&#123;</span><br><span class="line">    <span class="attr">&quot;src&quot;</span>: <span class="string">&quot;images/touch/homescreen48.png&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;sizes&quot;</span>: <span class="string">&quot;72x72&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;image/png&quot;</span></span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> HTML </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Cache Object</title>
      <link href="/2017/07/29/Cache-Object/"/>
      <url>/2017/07/29/Cache-Object/</url>
      
        <content type="html"><![CDATA[<p>The Cache interface provides a storage mechanism for <code>Request</code> / <code>Response</code> object pairs that are cahced, for example as part of the <code>ServiceWorker</code> lifecycle. Note that the Cache Interface is exposed to windowed scopes as well as workers. You don’t have to use it in conjunction with service workers, even though it is defined in the service worker spec.</p><p>An orgin can have <code>multiple Cache Objects</code>. You are responsible for implementing how your script handles <code>Cache Update</code>. Items in a Cache do not get updated unless explictly requested – they don’t expires unless deleted.</p><p>Use <code>CacheStorage.open(cacheName)</code> to open a specific named cache object and then call any of the cache methods to maintain the cache.</p><blockquote><p>The caching API doesn’t honor HTTP caching headers.</p></blockquote><h3 id="Methods"><a href="#Methods" class="headerlink" title="Methods"></a>Methods</h3><ul><li><p>Cache.match(request, options)</p><p>Returns a <code>Promise</code> that resolves to the response associated with the first matching request in the Cache Object.</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cache.match(request).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (response) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li><p>Cache.matchAll(request, options)</p><p>Returns a <code>Promise</code> that resolves to an array of all matching requests in the Cache Object.</p></li><li><p>Cache.add(request)</p><p>Takes a URL, retrieves it and adds the resulting response object to the given cache. This is functionally equivalent to calling <code>fetch()</code>, then using <code>Cache.put()</code> to add the results to the cache.</p></li><li><p>Cache.addAll(requests)</p><p>Takes an array of URLs, retrieves them, and adds the resulting response objects to the given cache.</p></li><li><p>Cache.put(request, response)</p><p>Takes both a request and its response and adds it to the given cache. // namely cache the Request/Response pair.</p></li><li><p>Cache.delete(request, options)</p><p>Finds the Cache entry whose key is the request, and if found, deletes the Cache entry and returns a <code>Promsie</code> that resolves to <code>true</code>. Otherwise resolve to <code>false</code>.</p></li><li><p>Cache.keys(request, options)</p><p>Returns a <code>Promise</code> that resolves to an array of <code>Cache Key</code>.</p></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Some Concepts on BlockChain</title>
      <link href="/2017/07/25/Some-Concepts-on-BlockChain/"/>
      <url>/2017/07/25/Some-Concepts-on-BlockChain/</url>
      
        <content type="html"><![CDATA[<h2 id="Getting-BlockChain-Data"><a href="#Getting-BlockChain-Data" class="headerlink" title="Getting BlockChain Data:"></a>Getting BlockChain Data:</h2><ul><li><p>Blocks;</p></li><li><p>Transactions;</p></li><li><p>Sending Transactions;</p></li></ul><h2 id="Cryptocurrency-Functions"><a href="#Cryptocurrency-Functions" class="headerlink" title="Cryptocurrency Functions:"></a>Cryptocurrency Functions:</h2><ul><li><p>Generating Private/Public keys, Hashing, Address Encoding etc;</p></li><li><p>Creating transactions;</p></li><li><p>Signing transactions;</p></li><li><p>Support functions;</p></li></ul><h2 id="Build-A-Block"><a href="#Build-A-Block" class="headerlink" title="Build A Block"></a>Build A Block</h2><ul><li><p>Receive the transaction broadcase;</p></li><li><p>Verify the crypto in the transaction;</p></li><li><p>Add it to the unconfirmed Pool;</p></li><li><p>Do some hard maths on all the transactions in the pool;</p></li><li><p>Broadcast the Block to the network;</p></li><li><p>The Block is added to the blockchain;</p></li></ul><h2 id="Blockchains-as-Distributed-Database"><a href="#Blockchains-as-Distributed-Database" class="headerlink" title="Blockchains as Distributed Database"></a>Blockchains as Distributed Database</h2><ul><li><p>Everyone running the Bitcoin client is part of the network;</p></li><li><p>New blocks are boradcast to the network;</p></li><li><p>Everyone updates their local copy of the blockchain;</p></li><li><p>If you’re behind the current height of the chain, you can ask other nodes for copies of the Blocks needed to catch-up;</p></li></ul><h2 id="Implications"><a href="#Implications" class="headerlink" title="Implications:"></a>Implications:</h2><ul><li><p>Tranactions take time to ‘confirm’;</p></li><li><p>Each transaction, once it’s in an accepted block has a height;</p></li><li><p>Each increase in blockchain height is called a confirmation;</p></li><li><p>A transaction 5 blocks below the top of the chain is said to have ‘6 confirmations’;</p></li><li><p>The merchant cant decide how many confirmations is sensible to warit for;</p></li><li><p>Current default is it wait for 6 confirmations for anything of value;</p></li><li><p>Blocks store data, in Bitcoin, it’s the transactions, but it could be any digital data;</p></li><li><p>Blocks are created periodically(on average, 10mins for Bitcoin) by a process called ‘mining’;</p></li><li><p>A block represents a set of events that have occurred over a particular time frame(ususally, since the previous block);</p></li><li><p>Block aren’t identified by their height, but by their id; (may be multiple blocks at same height)</p></li><li><p>Block id is the hash of the metadata in the block;</p></li><li><p>Block id is a digial fingerprint of that block;</p></li><li><p>Some metadata:</p><ul><li><p>A version number of the block format;</p></li><li><p>A link to the previous block that came immediately before it;</p></li><li><p>Merkle root of all the transactions in the block;</p></li><li><p>Timestamp of when the block was created;</p></li><li><p>Mining difficulty;</p></li><li><p>Nonce for Proof-of-Work;</p></li></ul></li><li><p>All the transactions that were recorded in this block;</p></li><li><p>All the transactions in the block are used to create the Merkle Root Hash;</p></li><li><p>It’s added to the other metadata in the header, with a nonce;</p></li><li><p>We hash the whole thing, look at the resulting hash, if it starts with a required number of leading ‘0’(which means the hash need to be small enough), we’ve solved the block and broadcast it;</p></li><li><p>If not, we increment the nonce and try again;</p></li><li><p>Repeat until we find the leading zero;</p></li><li><p>Difficulty defines how many leading zeros when solveing the block;</p></li><li><p>The more zeros we need to find, the more attemps at hashing we need.</p></li><li><p>More hashing power becomes the driving force amongst miners;</p></li><li><p>Miner insert a special transaction at the beginning of block called ‘coinbase’ transaction. This ‘pays’ the miner for the work they did, and collects the transaction fees from all the transactions;</p></li></ul><h2 id="Transactions"><a href="#Transactions" class="headerlink" title="Transactions"></a>Transactions</h2><ul><li><p>Transactions tranfer control of coins from inputs to outputs;</p></li><li><p>Control is enforced by cryptography;</p></li></ul><h2 id="Construct-A-Transaction"><a href="#Construct-A-Transaction" class="headerlink" title="Construct A Transaction"></a>Construct A Transaction</h2><ul><li><p>You need the address of the person you’re going to pay;</p></li><li><p>Find UTXO’s Unspent Transaction Outputs that exceed the amount you wish to pay;</p></li><li><p>Calculate the transaction fee(optional but recommended);</p></li><li><p>Create the outputs with the correct scriptPubKey; scriptPubKey defines who can spend the coin by specifying a small verification program that is run in order to perform that verification.</p></li><li><p>Sign the transaction details;</p></li><li><p>Broadcast the transaction, see if it works;</p></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Blockchain </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Some Note on Blockchain</title>
      <link href="/2017/07/22/Some-Note-on-Blockchain/"/>
      <url>/2017/07/22/Some-Note-on-Blockchain/</url>
      
        <content type="html"><![CDATA[<h2 id="Getting-BlockChain-Data"><a href="#Getting-BlockChain-Data" class="headerlink" title="Getting BlockChain Data:"></a>Getting BlockChain Data:</h2><ul><li><p>Blocks;</p></li><li><p>Transactions;</p></li><li><p>Sending Transactions;</p></li></ul><h2 id="Cryptocurrency-Functions"><a href="#Cryptocurrency-Functions" class="headerlink" title="Cryptocurrency Functions:"></a>Cryptocurrency Functions:</h2><ul><li><p>Generating Private/Public keys, Hashing, Address Encoding etc;</p></li><li><p>Creating transactions;</p></li><li><p>Signing transactions;</p></li><li><p>Support functions;</p></li></ul><h2 id="Build-A-Block"><a href="#Build-A-Block" class="headerlink" title="Build A Block"></a>Build A Block</h2><ul><li><p>Receive the transaction broadcase;</p></li><li><p>Verify the crypto in the transaction;</p></li><li><p>Add it to the unconfirmed Pool;</p></li><li><p>Do some hard maths on all the transactions in the pool;</p></li><li><p>Broadcast the Block to the network;</p></li><li><p>The Block is added to the blockchain;</p></li></ul><h2 id="Blockchains-as-Distributed-Database"><a href="#Blockchains-as-Distributed-Database" class="headerlink" title="Blockchains as Distributed Database"></a>Blockchains as Distributed Database</h2><ul><li><p>Everyone running the Bitcoin client is part of the network;</p></li><li><p>New blocks are boradcast to the network;</p></li><li><p>Everyone updates their local copy of the blockchain;</p></li><li><p>If you’re behind the current height of the chain, you can ask other nodes for copies of the Blocks needed to catch-up;</p></li></ul><h2 id="Implications"><a href="#Implications" class="headerlink" title="Implications:"></a>Implications:</h2><ul><li><p>Tranactions take time to ‘confirm’;</p></li><li><p>Each transaction, once it’s in an accepted block has a height;</p></li><li><p>Each increase in blockchain height is called a confirmation;</p></li><li><p>A transaction 5 blocks below the top of the chain is said to have ‘6 confirmations’;</p></li><li><p>The merchant cant decide how many confirmations is sensible to warit for;</p></li><li><p>Current default is it wait for 6 confirmations for anything of value;</p></li><li><p>Blocks store data, in Bitcoin, it’s the transactions, but it could be any digital data;</p></li><li><p>Blocks are created periodically(on average, 10mins for Bitcoin) by a process called ‘mining’;</p></li><li><p>A block represents a set of events that have occurred over a particular time frame(ususally, since the previous block);</p></li><li><p>Block aren’t identified by their height, but by their id; (may be multiple blocks at same height)</p></li><li><p>Block id is the hash of the metadata in the block;</p></li><li><p>Block id is a digial fingerprint of that block;</p></li><li><p>Some metadata:</p><ul><li><p>A version number of the block format;</p></li><li><p>A link to the previous block that came immediately before it;</p></li><li><p>Merkle root of all the transactions in the block;</p></li><li><p>Timestamp of when the block was created;</p></li><li><p>Mining difficulty;</p></li><li><p>Nonce for Proof-of-Work;</p></li></ul></li><li><p>All the transactions that were recorded in this block;</p></li><li><p>All the transactions in the block are used to create the Merkle Root Hash;</p></li><li><p>It’s added to the other metadata in the header, with a nonce;</p></li><li><p>We hash the whole thing, look at the resulting hash, if it starts with a required number of leading ‘0’(which means the hash need to be small enough), we’ve solved the block and broadcast it;</p></li><li><p>If not, we increment the nonce and try again;</p></li><li><p>Repeat until we find the leading zero;</p></li><li><p>Difficulty defines how many leading zeros when solveing the block;</p></li><li><p>The more zeros we need to find, the more attemps at hashing we need.</p></li><li><p>More hashing power becomes the driving force amongst miners;</p></li><li><p>Miner insert a special transaction at the beginning of block called ‘coinbase’ transaction. This ‘pays’ the miner for the work they did, and collects the transaction fees from all the transactions;</p></li></ul><h2 id="Transactions"><a href="#Transactions" class="headerlink" title="Transactions"></a>Transactions</h2><ul><li><p>Transactions tranfer control of coins from inputs to outputs;</p></li><li><p>Control is enforced by cryptography;</p></li></ul><h2 id="Construct-A-Transaction"><a href="#Construct-A-Transaction" class="headerlink" title="Construct A Transaction"></a>Construct A Transaction</h2><ul><li><p>You need the address of the person you’re going to pay;</p></li><li><p>Find UTXO’s Unspent Transaction Outputs that exceed the amount you wish to pay;</p></li><li><p>Calculate the transaction fee(optional but recommended);</p></li><li><p>Create the outputs with the correct scriptPubKey; scriptPubKey defines who can spend the coin by specifying a small verification program that is run in order to perform that verification.</p></li><li><p>Sign the transaction details;</p></li><li><p>Broadcast the transaction, see if it works;</p></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Blockchain </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Five Models in Smart Contract</title>
      <link href="/2017/07/19/Five-Models-in-Smart-Contract/"/>
      <url>/2017/07/19/Five-Models-in-Smart-Contract/</url>
      
        <content type="html"><![CDATA[<h1 id="Database-Contracts"><a href="#Database-Contracts" class="headerlink" title="Database Contracts"></a>Database Contracts</h1><p>These are used only as data storage. The only logic they need is functions that allow other contracts to write, update and get data, and some simple way of checking caller permissions.</p><h1 id="Controller-Contracts"><a href="#Controller-Contracts" class="headerlink" title="Controller Contracts"></a>Controller Contracts</h1><p>These contracts operate on the storage contracts. In a flexible system, both controllers and databases can be replaced by other, similar contracts that share the same public api(although this is not always needed).) Controllers can be advanced, and could for example do batched reads/writes, or read from and write to multiple databases instead of just one.</p><h1 id="Contract-Managine-Contracts-CMCs"><a href="#Contract-Managine-Contracts-CMCs" class="headerlink" title="Contract Managine Contracts (CMCs)"></a>Contract Managine Contracts (CMCs)</h1><p>The purpose of these contracts is only to manage other contracts. Their main tasks is to keep track of all the contracts/components of the system, handle the communication between thses components, and to make modular design easier. Keeping this functionality separate from normal business logic should be considered good practice, and has a number of positive effects on the system.</p><h1 id="Application-Logic-Contracts-ALCs"><a href="#Application-Logic-Contracts-ALCs" class="headerlink" title="Application Logic Contracts (ALCs)"></a>Application Logic Contracts (ALCs)</h1><p>Application logic contracts contains application-specific code. Generally speaking, if the contract utilizes controllers and other contracts to perform application specific tasks it’s an ALC.</p><h1 id="Utility-Contracts"><a href="#Utility-Contracts" class="headerlink" title="Utility Contracts"></a>Utility Contracts</h1><p>These type of contracts usually perform a specific task, and can be called by other contracts without restrictions. It could be a contract that hashes strings using some algorithm, provide random numbers or other things. They normally don’t need a log of storage, often have few or no dependencies.</p><p>The rationale for this division will be laid out after we’ve tried to apply it to the fund manager system, as it will be a lot more clear then.</p>]]></content>
      
      
      
        <tags>
            
            <tag> Ethereum </tag>
            
            <tag> Blockchain </tag>
            
            <tag> Smart Contract </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tutorial Part 4 of Dapp</title>
      <link href="/2017/07/14/Tutorial-Part-4-of-Parity/"/>
      <url>/2017/07/14/Tutorial-Part-4-of-Parity/</url>
      
        <content type="html"><![CDATA[<h1 id="Calling-Contracts"><a href="#Calling-Contracts" class="headerlink" title="Calling Contracts"></a>Calling Contracts</h1><p>Contract API basically comes in three pieces.</p><ul><li><p>Firstly, there’s state-changing transaction like tranferring tokens to a counter-party.</p></li><li><p>Secondly, there’s event reception and reporting that happen when such a state change occurs.</p></li><li><p>Finally, there is inspection of the contract state through calling <code>constant</code> function.</p></li></ul><h2 id="Our-first-contract"><a href="#Our-first-contract" class="headerlink" title="Our first contract"></a>Our first contract</h2><p>The first contract we will deal with is the global(name) registry. If you are not yet familiar, this is a registry that exists on all sensible blockchain which records fields of information for any desired name.</p><p>The registry records onwership information so that names can be registered and their information changed at a later date.</p><p>The registry contract has a fairly simple API for inspecting. We only need to worry about two functions:</p><ul><li><p><code>getOwner(bytes32) -&gt; address</code>, given the Keccak hash of name, this returns the address of its owner, if it has been reserved.</p></li><li><p><code>getData(bytes32, bytes32) -&gt; bytes32</code>, given the Keccak hash of a name and a second field key, this returns the associated data.</p></li></ul><p>There are subordinate functions to the latter such as <code>getAddress</code> and <code>getUint</code> which coerce the data into some other type. It is important to note that amongst the standardised field keys are:</p><ul><li><p><code>A</code> the <code>address</code> primarily associated with the name; if you’re wanting to send funds to the name, this is where to send them(assuming it’s not null)</p></li><li><p><code>CONTENT</code> the <code>bytes32</code> which equals the Keccak hash of any content associated with this name. e.g. If the name represents a dapp, then this would be the hash of the dapp’s content.</p></li><li><p><code>IMG</code> the <code>bytes32</code> which equals the Keccak hash of an associated image; this might be a person’s avatar or the dapp icon, depending on what is being named.</p></li></ul><p>Let’s begin by displaying the address associated with the name <code>gavofyork</code>. To do this we will need to create a special <code>Bond</code>-API contract object. The function to do this is <code>bonds.makeContract</code>; It takes the address and the ABI of the contract and returns an object with <code>Bond</code> – returning functions for each of the contract’s functions.</p><p>The address is easy enough to find; this can be determined via the <code>parity.api.parity.registry</code> call. The ABI spec is rather long and can be derived from the contract code available at the ethcode/contracts repository. Since there is only a single canonical registry, Parity, conveniently constructs this for you and provides it at the <code>bonds.registry</code> object.</p><p>To figure out the primary associated address of the <code>gavofyork</code> name, we can use the <code>getAddress</code> call, together with the <code>parity.api.util.sha3</code> call to take the Keccak hash of our name. The full expression would be:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bonds.registry.getAddress(parity.api.util.sha3(<span class="string">&#x27;gavofyork&#x27;</span>))</span><br></pre></td></tr></table></figure><p>Typing <code>parity.api.util.sha3(...)</code> every time you want to look up a name in the registry gets tedious fast. Happily, Parity provides a number of derivative helper functions as part of the <code>bonds&#39;registry</code> object: <code>lookupDate</code>, <code>lookupAddress</code>, <code>lookupUint</code> and <code>lookupOwner</code>. They are all just like the <code>get-</code> prefixed brethren, but do the hashing for you. Our expression therefore can become:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bonds.registry.lookupAddress(<span class="string">&#x27;gavofyork&#x27;</span>, <span class="string">&#x27;A&#x27;</span>)</span><br></pre></td></tr></table></figure><p>Let’s get this in to our dapp, Change the <code>render()</code>ed HTML to:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">  gavofyorks address is:</span><br><span class="line">  &lt;Rspan&gt;&#123;bonds.registry.lookupAddress(<span class="string">&#x27;gavofyork&#x27;</span>, <span class="string">&#x27;A&#x27;</span>)&#125;&lt;/Rspan&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><h2 id="Dynamic-lookups"><a href="#Dynamic-lookups" class="headerlink" title="Dynamic lookups"></a>Dynamic lookups</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> () &#123;</span><br><span class="line">    <span class="built_in">super</span>()</span><br><span class="line">    <span class="built_in">this</span>.bond = <span class="keyword">new</span> Bond()</span><br><span class="line">  &#125;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        Address <span class="keyword">of</span> &lt;InputBond bond=&#123;<span class="built_in">this</span>.bond&#125; placeholder=<span class="string">&quot;Lookup a name&quot;</span> /&gt; is:<span class="xml"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span></span><br><span class="line">        &lt;Rspan&gt;&#123;bonds.registry.lookupAddress(<span class="built_in">this</span>.bond, <span class="string">&#x27;A&#x27;</span>)&#125;&lt;/Rspan&gt;</span><br><span class="line">        Its balance is</span><br><span class="line">        &lt;Rspan&gt;</span><br><span class="line">          &#123;bonds.balance(bonds.registry.lookupAddress(<span class="built_in">this</span>.bond, <span class="string">&#x27;A&#x27;</span>)).map(formatBalance)&#125;</span><br><span class="line">        &lt;/Rspan&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Derivative-contracts"><a href="#Derivative-contracts" class="headerlink" title="Derivative contracts"></a>Derivative contracts</h2><p>Typically the registry is used to lookup the address of a second contract that you would actucally like to use.</p><p>Let’s suppose that second contract is the GithubHint contract; if you’re not already familiar, the GithubHint contract allows you to suggest which URLs might serve content for a particular hash.It’s a semi-centralized, hacky alternative to content-addressable-delivery systems like BitTorrent/Kademlia, Swarm and IPFS. We use it widely in Parity as a means of content dissemination.</p><p>Since is a ‘standard’ contract in Parity, the ABI for it is available in <code>oo7-parity</code> as <code>GitHubHintABI</code>. The address changes per chain, but can be discovered via the registry under the name ‘githubhint’. The expression would therefore be <code>bonds.registry.lookupAddress(&#39;githubhint&#39;, &#39;A&#39;)</code>.</p><p>Though we mustn’t forget to import <code>GitHubHint</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; GitHubHintABI &#125; form <span class="string">&#x27;oo7-parity&#x27;</span></span><br></pre></td></tr></table></figure><p>The GithubHint contract has only a single inspection method: <code>entries</code>. This takes a <code>bytes32</code> and returns three items(via an array). There are three kinds of entry: Github repository entries, whereby the first and second items form the addresss of a particular commit of a particular repository; general URLs, where the first item is a URL and the second is the null hash; and empty entries where both items are null. The third item is always the owner (if any) of the entry and the only account capable of changing the hint information.</p><p>In this small demo, we’ll assume that we are looking up only URLs and so are only interested in the first item. We therefore want an expression like:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GitHubHint.entries(hash)[<span class="number">0</span>]</span><br></pre></td></tr></table></figure><p>Where <code>hash</code> is some content hash and <code>GitHubHint</code> is the contract object.</p><p>Putting this all together we can change our dapp to:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> () &#123;</span><br><span class="line">    <span class="built_in">super</span>()</span><br><span class="line">    <span class="built_in">this</span>.bond = <span class="keyword">new</span> Bond()</span><br><span class="line">    <span class="built_in">this</span>.GitHubHint = bonds.makeContract(bonds.registry.lookupAddress(<span class="string">&#x27;githubhint&#x27;</span>, <span class="string">&#x27;A&#x27;</span>), GitHubHintABI)</span><br><span class="line">  &#125;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        URL <span class="keyword">for</span> content &lt;HashBond bond=&#123;<span class="built_in">this</span>.bond&#125; floatingLabelText=<span class="string">&quot;Content-Hash&quot;</span> /&gt; is:</span><br><span class="line">        &lt;Rspan&gt;&#123;<span class="built_in">this</span>.GithubHint.entries(<span class="built_in">this</span>.bond)[<span class="number">0</span>]&#125;&lt;/Rspan&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Note that we are using <code>HashBond</code> from <code>oo7-react</code> rather than <code>InputBond</code>. This just ensures that we enter only valid 32-byte hashes. Ensure that the import line is changed to:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; InputBond, HashBond &#125; <span class="keyword">from</span> <span class="string">&#x27;parity-reactive-ui&#x27;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Ethereum </tag>
            
            <tag> Blockchain </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tutorial Part 3 of Dapp</title>
      <link href="/2017/07/13/Tutorial-Part-3-of-Dapp/"/>
      <url>/2017/07/13/Tutorial-Part-3-of-Dapp/</url>
      
        <content type="html"><![CDATA[<h1 id="Parity-Bonds"><a href="#Parity-Bonds" class="headerlink" title="Parity Bonds"></a>Parity Bonds</h1><p>It’s time to get down and dirty with the blockchain.</p><p>For this we will introduce the <code>oo7-parity</code> package, which provides a high-level reactive <code>Bond</code> API.</p><p>To set this up, all we need do is import <code>bonds</code> from the <code>oo7-parity</code> module, so ensure you have this at the top of your file:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; bonds &#125; <span class="keyword">from</span> <span class="string">&#x27;oo7-parity&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="Watch-the-block"><a href="#Watch-the-block" class="headerlink" title="Watch the block"></a>Watch the block</h2><p>For our first task, we will introduce the simplest of all bonds: <code>bonds.height</code>. This evaluates to <code>the number of the latest block</code>, expressed as a simple number.</p><p>In <code>app.jsx</code>:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Rspan&gt;&#123;bonds.height&#125;&lt;/Rspan&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>It’s not especially pretty so you can add some style on it.</p><p>We also provide the <code>formatBlockNumber</code> function:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> formatBlockNumber = <span class="function">(<span class="params">n</span>) =&gt;</span> <span class="string">&#x27;#&#x27;</span> + (<span class="string">&#x27;&#x27;</span> + n).replace(<span class="regexp">/(\d)(?=(\d&#123;3&#125;)+$)/g</span>, <span class="string">&#x27;$1,&#x27;</span>)</span><br></pre></td></tr></table></figure><p>You can use it through</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; bonds, formatBlockNumber &#125; <span class="keyword">from</span> <span class="string">&#x27;oo7-parity&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="Blocks"><a href="#Blocks" class="headerlink" title="Blocks"></a>Blocks</h2><p>The block number is great and all, but perhaps we’re more intereseted in the latest block itself. Parity can help us there with the <code>bonds.blocks</code> object. This is a lazy-evaluated ‘array’ of bonds which can subscribe to. To give yourself an idea of its capabilities, let’s try it out in the console. First we will expose the <code>bonds</code> object to the environment by adding this at the end of our obejct’s constructor:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.bonds = bonds</span><br></pre></td></tr></table></figure><p>Having reloaded, quickly open the Chrome JS console, alter the environment to 127.0.0.1 and evaluate the block at number 69 with <code>bonds.blocks[69].log()</code></p><p>Note that since it’s all asynchronous, we must use the <code>.log()</code> trick to feed the result into the console (it’s exactly equivalent to <code>.map(console.log)</code>) The result is, of course, the block object representing the 69th mined block on this chain.</p><p>Naturally, <code>bonds.blocks</code> is able to accept any number, even a bond, as its subscript. Let’s make our dapp always give us the timestamp of the latest block.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">  Latest block timestamp is:</span><br><span class="line">  &lt;Rspan&gt;&#123;bonds.blocks[bonds.blocks.height].map(<span class="function"><span class="params">b</span> =&gt;</span> b.timestamp).map(<span class="function"><span class="params">_</span> =&gt;</span> _.toString())&#125;&lt;/Rspan&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>That map is a bit cumbersome, the <code>bond</code> API knows about subscripting, which means the <code>.timestamp</code> can be moved out of the <code>map</code></p><p>Furthermore, <code>bonds.blocks[bonds.height]</code> is a fairly common expression. So much so that it has a shorter alias: <code>bonds.head</code>, so in fact the simplest means of expressing this becomes:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; bonds.head.timestamp.map(<span class="function"><span class="params">_</span> =&gt;</span> _.toString())&#125;</span><br></pre></td></tr></table></figure><h2 id="Composing-expressions"><a href="#Composing-expressions" class="headerlink" title="Composing expressions"></a>Composing expressions</h2><p>These expressios are sometimes very useful, but often you want to do some blockchain based computation on this information.</p><p>Parity puts various means at your disposal to help you here:</p><ul><li><p><code>bonds.balance(address)</code>: evaluates to the current balanece of account at <code>address</code></p></li><li><p><code>bonds.transactionCount(address)</code>: evaluates to the current transaction count (‘nonce’) of account at <code>address</code></p></li><li><p><code>bonds.code(address)</code>: evaluates to the current ‘contract’ code of account at <code>address</code></p></li><li><p><code>bonds.storageAt(address, location)</code>: evaluates to the value in storage <code>location</code> of account at <code>address</code></p></li></ul><p>Use the first one:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">  Current block authors balance is:</span><br><span class="line">  &lt;Rspan&gt;</span><br><span class="line">    &#123;bonds.balance(bonds.head.author).map(formatBalance)&#125;</span><br><span class="line">  &lt;/Rspan&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><h2 id="Our-balance"><a href="#Our-balance" class="headerlink" title="Our balance"></a>Our balance</h2><p>Parity can help us get information about our own accounts in a reactive manner.</p><p>Some apis like:</p><ul><li><p><code>bonds.coinbase</code>: evaluates to the node’s current block authoring address.</p></li><li><p><code>bonds.accounts</code>: evaluates to the list of accounts available for the dapp to use.</p></li><li><p><code>bonds.me</code>: evaluates to the preferred account for this dapp to use. In parity, this is the account visible in the Parity Signer at the bottom right of the page.</p></li><li><p><code>bonds.accountsInfo</code>: evaluates to the mapping between dapp-visible addresses and account metadata.</p></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Ethereum </tag>
            
            <tag> Blockchain </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tutorial Part 2 of Dapp</title>
      <link href="/2017/07/13/Tutorial-Part2-of-Dapp/"/>
      <url>/2017/07/13/Tutorial-Part2-of-Dapp/</url>
      
        <content type="html"><![CDATA[<h1 id="oo7-Bonds"><a href="#oo7-Bonds" class="headerlink" title="oo7 Bonds"></a>oo7 Bonds</h1><p>Now we have our basic dapp harness, we can start introducing more interesting functionality. Without too much ado, let’s get started. Head in to <code>src/client/scripts/app.jsx</code>. You will see our basic file:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;Hello World&lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This is a JSX file. Baiscally means that can handle embedded HTML when describing how React components should be rendered.</p><h2 id="Your-first-Bond"><a href="#Your-first-Bond" class="headerlink" title="Your first Bond"></a>Your first <code>Bond</code></h2><p>The first thing we’ll do is introduce the <code>oo7 library</code>. This introduces into Javascript the notion of reactive value known as ‘bonds’. Reactive values are similar to normal variables, except that any places in which they are used will automatically upate themselves as the value changes.</p><p>The oo7 package is still very much in development, as such there might be one or two rough edges in this tutorial.</p><p>Our first example will just demonstrate how <code>Bond</code> can introduce effortless reactivity by dynamically replicating the contents of an editable text field into a <code>&lt;span&gt;</code>.</p><p>Import the needed components by placing three lines at the top of <code>app.jsx</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Bond &#125; <span class="keyword">from</span> <span class="string">&#x27;oo7&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Rspan &#125; <span class="keyword">from</span> <span class="string">&#x27;oo7-react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; InputBond &#125; <span class="keyword">from</span> <span class="string">&#x27;parity-reactive-ui&#x27;</span></span><br></pre></td></tr></table></figure><p>Next we need to introduce a new instance of a <code>Bond</code>. It will represent the current contents of a text field. We will initialize it in our class’s contructor. Insert these lines directly into the <code>App</code> class decalration.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">constructor</span> () &#123;</span><br><span class="line">  <span class="built_in">super</span> ()</span><br><span class="line">  <span class="built_in">this</span>.bond = <span class="keyword">new</span> Bond()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Your code should now look like this:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Bond &#125; <span class="keyword">from</span> <span class="string">&#x27;oo7&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Rspan &#125; <span class="keyword">from</span> <span class="string">&#x27;oo7-react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; InputBond &#125; <span class="keyword">from</span> <span class="string">&#x27;parity-reactive-ui&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> () &#123;</span><br><span class="line">    <span class="built_in">super</span> ()</span><br><span class="line">    <span class="built_in">this</span>.bond = <span class="keyword">new</span> Bond()</span><br><span class="line">  &#125;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;Hello World&lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Next we need to create the text entry field and the <code>&lt;span&gt;</code> element(in which the text field’s contents will be reflected). We will use a version of Semantic UI’s <code>Input</code> element which has been specially modified to propagate the value into a named <code>Bond</code>. This is called <code>InputBond</code>.</p><p>Similarly, for the <code>span</code> we will use a special ‘reactive’ version of the <code>span</code> element which is able to accept <code>Bond</code>s as children and values of certain properties. This is known as <code>Rspan</code>.</p><p>Change the <code>&lt;div&gt;Hello World&lt;/div&gt;</code> line to:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">  &lt;InputBond bond=&#123;<span class="built_in">this</span>.bond&#125; placeholder=<span class="string">&quot;Go ahead and type some text&quot;</span> /&gt;</span><br><span class="line">  &lt;Rspan&gt;&#123;<span class="built_in">this</span>.bond&#125;&lt;/Rspan&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>As you see there’s not all that much here, we just tell the text field input <code>InputBond</code> to place its value into <code>this.bond</code> and conversely tell <code>Rspan</code> to display that value from <code>this.bond</code>.</p><p>Run webpack and let it watch your files to ensure your dapp is continuously rebuilt.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm start</span><br></pre></td></tr></table></figure><h2 id="Transforming-Bonds"><a href="#Transforming-Bonds" class="headerlink" title="Transforming Bonds"></a>Transforming Bonds</h2><p><code>Bond</code>s don’t just have to pass on data; they can also represent transformations on the data.</p><p>One example of a transform on text would be simple upper-casing. A function to upper-case text would be <code>text =&gt; text.toUpperCase()</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Rspan&gt;&#123;<span class="built_in">this</span>.bond.map(<span class="function"><span class="params">t</span> =&gt;</span> t.toUpperCase())&#125;&lt;/Rspan&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Ethereum </tag>
            
            <tag> Blockchain </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tutorial Part 1 of Dapp</title>
      <link href="/2017/07/13/Tutorial-Par1-of-Dapp/"/>
      <url>/2017/07/13/Tutorial-Par1-of-Dapp/</url>
      
        <content type="html"><![CDATA[<h1 id="Spawning-a-new-Dapp"><a href="#Spawning-a-new-Dapp" class="headerlink" title="Spawning a new Dapp"></a>Spawning a new Dapp</h1><p>The dapp will use modern JS technologies: NPM, Webpack2, React, Babel, ES6, JSX and oo7.</p><p>Clone a <code>skeleton</code> repo from parity:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/paritytech/skeleton mydapp</span><br></pre></td></tr></table></figure><p>This will make your a new repo with everything ready.</p><p><code>cd</code> in to it and remove the origin repository lest it confuse Git.</p><p>It’s liberally licensed (Apache 2.0) so you don’t have to worry about open sourcing your own code(though obviously you’ll be enlightened and want to do that anyway.)</p><p>The next stage is to get all dependencies installed, NPM makes this rather easy, but the bundled script makes it even easier</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./init.sh</span><br></pre></td></tr></table></figure><p>This should grab and install all that is required. The next thing to do is to build the final web-ready version of the fledling dapp. We use webpack for this.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">webpack</span><br></pre></td></tr></table></figure><p>You now have a basic dapp built.</p><h1 id="Configuring-its-look"><a href="#Configuring-its-look" class="headerlink" title="Configuring its look"></a>Configuring its look</h1><p>While your dapp may well be built, it is not yet easily discoverable. You would have to host it somewhere. This can be done traditionally with a web server but for development, we will use Parity’s in-built hosting.</p><p>Parity uses a special ‘manifest’ file called to figure out how to display the entry for your dapp in Parity Wallet. This file is called <code>manifest.json</code> and must be placed in the root of your dapp’s directory, in our case, thi sis our ‘build’ directory, <code>dist</code>.</p><p>Open an editor to edit <code>dist/manifest.json</code> you’ll see something like:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;id&quot;</span>: <span class="string">&quot;skeleton&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Skeleton&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;A skeleton dapp&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;0.1&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;author&quot;</span>: <span class="string">&quot;parity Technologies Ltd&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;iconUrl&quot;</span>: <span class="string">&quot;title.png&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>The <code>id</code> is the dapp’s unique identity: change that from <code>skeleton</code> to <code>mydapp</code></p></li><li><p>The <code>name</code> is the dapp’s user-visible name: change that to <code>My Dapp</code></p></li><li><p>The <code>description</code> is a user-visible by-line describing what the dapp is good for.</p></li><li><p><code>version</code> is the dapp’s version - you can leave that at <code>0.1</code> for now.</p></li><li><p>You can change the <code>author</code> to your name.</p></li><li><p>The <code>iconUrl</code> is the path(within <code>dist</code>) to a square(best to make it 128 x 128) icon for your dapp.</p></li></ul><h1 id="Getting-it-visible-in-Parity"><a href="#Getting-it-visible-in-Parity" class="headerlink" title="Getting it visible in Parity"></a>Getting it visible in Parity</h1><p>To get Parity to discover your dapp, it needs to be placed into a place that Parity will see it in its local ‘dapps’ directory. We will make a symbolic linke for our dapp’s <code>dist</code> directory(containing all of the ready-built dapp) in Parity’s dapp directory.</p><p>Parity’s directory structure is different depending on your system.</p><p>For Mac, Parity’s local dapp directory sits at <code>$HOME/Library/Application Support/io.parity.ethereum/dapps</code></p><p>Once you have it linked, you should start(or restart, if already running) Parity and head to the Application Page of Parity Wallet. There you will see your new dapp:</p><p>Note: If you are not running <code>npm start</code> in parity/src/js to have a development instance your URL is likely <code>localhost:8180</code> instead of port 3000.</p>]]></content>
      
      
      
        <tags>
            
            <tag> Ethereum </tag>
            
            <tag> Blockchain </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>D3-Shape</title>
      <link href="/2017/07/12/d3-shape/"/>
      <url>/2017/07/12/d3-shape/</url>
      
        <content type="html"><![CDATA[<h3 id="d3-shape"><a href="#d3-shape" class="headerlink" title="d3.shape"></a>d3.shape</h3><p>Visualization typically consist of discrete  graphical marks, such as <code>Symbols</code>, <code>arcs</code>, <code>lines</code> and <code>areas</code>. While the ractangles of a bar chart may be easy enough to generate directly using <code>SVG</code> or <code>Canvas</code>, other shapes are complex, such as roudned annular sectors and centripetal Catmull-Rom splines. This module provides a variety of shape generators for your convenience.</p><p>As with other aspects of D3, these shapes are driven by data: each shape generator exposes accessors that control how the input data are mapped to a visual representation.</p><p>You might define a line generator for a time series by <code>scaling</code> field of your data to fit the chart.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> lineGen = d3.line()</span><br><span class="line">    .x(<span class="function"><span class="params">d</span> =&gt;</span> (d.date))</span><br><span class="line">    .y(<span class="function"><span class="params">d</span> =&gt;</span> (d.value))</span><br></pre></td></tr></table></figure><p>This line generator can then be used to compute the <code>d</code> attribute of an SVG path element:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path.datum(data).attr(<span class="string">&#x27;d&#x27;</span>, lineGen)</span><br></pre></td></tr></table></figure><p>Or you can use it to render to a Canvas 2D context:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lineGen.context(context)(data)</span><br></pre></td></tr></table></figure><h3 id="Installing"><a href="#Installing" class="headerlink" title="Installing"></a>Installing</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://d3js.org/d3-path.v1.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://d3js.org/d3-shape.v1.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>or</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add d3-shape</span><br></pre></td></tr></table></figure><h3 id="Arcs"><a href="#Arcs" class="headerlink" title="Arcs"></a>Arcs</h3><p><img src="https://raw.githubusercontent.com/d3/d3-shape/master/img/pie.png"></p><p>The arc genrateor produces a circular or annular sector, as in a pie or donut chart. If the difference between the start and end angles(the regular span) is greater than 2 * Math.PI, the arc generator will produce a complete circle or annulus. If it is less than 2 * Math.PI, arcs may have rounded corners and angular padding.</p><p>Arcs are always centered at &lt;0, 0&gt;, use a transform to move the arc to a different position.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arc = d3.arc() <span class="comment">// construct a new arc genrator with default settings.</span></span><br><span class="line"></span><br><span class="line">arc(&#123;</span><br><span class="line">  innerRadius: <span class="number">0</span>,</span><br><span class="line">  outerRadius: <span class="number">100</span>,</span><br><span class="line">  startAngle: <span class="number">0</span>,</span><br><span class="line">  endAngle: <span class="built_in">Math</span>.PI / <span class="number">2</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"><span class="keyword">const</span> arc = d3.arc()</span><br><span class="line">    .innerRadius(<span class="number">0</span>)</span><br><span class="line">    .outerRadius(<span class="number">100</span>)</span><br><span class="line">    .startAngle(<span class="number">0</span>)</span><br><span class="line">    .endAngle(<span class="built_in">Math</span>.PI/<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">arc()</span><br></pre></td></tr></table></figure><p><strong>arc.centroid(arguments)</strong> computes the midpoint &lt;x, y&gt; of the center line of the arc that would be generated by the given arguments. The arguments are arbitrary. They are simple propagated to the arc generator’s accessor functions along with the <code>this</code> object.</p><p>To be consistent with the generated arc, the accessors must be deterministirc, i.e., return the same value given the same arguments. The midpoint is defined as (startAngle + endAngle) / 2 and (innerRadius + outerRadius) / 2</p><p><img src="https://raw.githubusercontent.com/d3/d3-shape/master/img/centroid-annular-sector.png"></p><p><strong>arc.cornerRadius([radius])</strong> sets the corner radius to the specified function or number and returns the arc generator.</p><p><img src="https://raw.githubusercontent.com/d3/d3-shape/master/img/rounded-annular-sector.png"></p><p><strong>arc.padAngle([angle])</strong> sets the pad angle to the specifid function or number and returns this arc generator. The pad angle is converted to a fixed linear distances seperateing adajacent arcs, defined as *<em>padRadius * padAngle*</em>.</p><p><strong>arc.context([context])</strong> sets the context and returns this arc generator. If <em>context</em> is not specified, returns the current context, which defaults to null. If the context is not null, then the generated arc is rendered to this context as a sequence of path method calls. Otherwise, a path data string representing the generated arc is returned.</p><h3 id="Pies"><a href="#Pies" class="headerlink" title="Pies"></a>Pies</h3><p>This pie generator does not produce a shape directly, but instead <strong>computes</strong> the necessary angles to represent a tabular dataset as a pie or donut chart. These angles can be passed to an arc generator.</p><p><strong>d3.pie()</strong> constructs a new pie generator with the default settings.</p><p><strong>pie(data[, arguments])</strong> generates a pie for the given array of data, <strong>returning an array of objects representing each datum’s arc angle</strong>. Any additional arguments are arbitrary. They are simply propagated to the pie generator’s accessor functions along with the <code>this</code> object.</p><p>The length of the returned array is the same as data and each element <em>i</em> in the returned array corresponds to the element <em>i</em> in the input data. Each object in the returned array has the following properties:</p><ul><li><p>data: the input datum; the corresponding element in the input data array.</p></li><li><p>value: the numeric value of the arc</p></li><li><p>index: the zero-based sorted index of arc</p></li><li><p>startAgnle: the start angle of the arc</p></li><li><p>endAngle: the end angle of the arc</p></li><li><p>padAngle: the pad angle of the arc</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> data = [<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">21</span>];</span><br><span class="line"><span class="keyword">var</span> arcs = d3.pie()(data);</span><br><span class="line"><span class="comment">// to</span></span><br><span class="line">[</span><br><span class="line">  &#123;<span class="string">&quot;data&quot;</span>:  <span class="number">1</span>, <span class="string">&quot;value&quot;</span>:  <span class="number">1</span>, <span class="string">&quot;index&quot;</span>: <span class="number">6</span>, <span class="string">&quot;startAngle&quot;</span>: <span class="number">6.050474740247008</span>, <span class="string">&quot;endAngle&quot;</span>: <span class="number">6.166830023713296</span>, <span class="string">&quot;padAngle&quot;</span>: <span class="number">0</span>&#125;,</span><br><span class="line">  &#123;<span class="string">&quot;data&quot;</span>:  <span class="number">1</span>, <span class="string">&quot;value&quot;</span>:  <span class="number">1</span>, <span class="string">&quot;index&quot;</span>: <span class="number">7</span>, <span class="string">&quot;startAngle&quot;</span>: <span class="number">6.166830023713296</span>, <span class="string">&quot;endAngle&quot;</span>: <span class="number">6.283185307179584</span>, <span class="string">&quot;padAngle&quot;</span>: <span class="number">0</span>&#125;,</span><br><span class="line">  &#123;<span class="string">&quot;data&quot;</span>:  <span class="number">2</span>, <span class="string">&quot;value&quot;</span>:  <span class="number">2</span>, <span class="string">&quot;index&quot;</span>: <span class="number">5</span>, <span class="string">&quot;startAngle&quot;</span>: <span class="number">5.817764173314431</span>, <span class="string">&quot;endAngle&quot;</span>: <span class="number">6.050474740247008</span>, <span class="string">&quot;padAngle&quot;</span>: <span class="number">0</span>&#125;,</span><br><span class="line">  &#123;<span class="string">&quot;data&quot;</span>:  <span class="number">3</span>, <span class="string">&quot;value&quot;</span>:  <span class="number">3</span>, <span class="string">&quot;index&quot;</span>: <span class="number">4</span>, <span class="string">&quot;startAngle&quot;</span>: <span class="number">5.468698322915565</span>, <span class="string">&quot;endAngle&quot;</span>: <span class="number">5.817764173314431</span>, <span class="string">&quot;padAngle&quot;</span>: <span class="number">0</span>&#125;,</span><br><span class="line">  &#123;<span class="string">&quot;data&quot;</span>:  <span class="number">5</span>, <span class="string">&quot;value&quot;</span>:  <span class="number">5</span>, <span class="string">&quot;index&quot;</span>: <span class="number">3</span>, <span class="string">&quot;startAngle&quot;</span>: <span class="number">4.886921905584122</span>, <span class="string">&quot;endAngle&quot;</span>: <span class="number">5.468698322915565</span>, <span class="string">&quot;padAngle&quot;</span>: <span class="number">0</span>&#125;,</span><br><span class="line">  &#123;<span class="string">&quot;data&quot;</span>:  <span class="number">8</span>, <span class="string">&quot;value&quot;</span>:  <span class="number">8</span>, <span class="string">&quot;index&quot;</span>: <span class="number">2</span>, <span class="string">&quot;startAngle&quot;</span>: <span class="number">3.956079637853813</span>, <span class="string">&quot;endAngle&quot;</span>: <span class="number">4.886921905584122</span>, <span class="string">&quot;padAngle&quot;</span>: <span class="number">0</span>&#125;,</span><br><span class="line">  &#123;<span class="string">&quot;data&quot;</span>: <span class="number">13</span>, <span class="string">&quot;value&quot;</span>: <span class="number">13</span>, <span class="string">&quot;index&quot;</span>: <span class="number">1</span>, <span class="string">&quot;startAngle&quot;</span>: <span class="number">2.443460952792061</span>, <span class="string">&quot;endAngle&quot;</span>: <span class="number">3.956079637853813</span>, <span class="string">&quot;padAngle&quot;</span>: <span class="number">0</span>&#125;,</span><br><span class="line">  &#123;<span class="string">&quot;data&quot;</span>: <span class="number">21</span>, <span class="string">&quot;value&quot;</span>: <span class="number">21</span>, <span class="string">&quot;index&quot;</span>: <span class="number">0</span>, <span class="string">&quot;startAngle&quot;</span>: <span class="number">0.000000000000000</span>, <span class="string">&quot;endAngle&quot;</span>: <span class="number">2.443460952792061</span>, <span class="string">&quot;padAngle&quot;</span>: <span class="number">0</span>&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>The first pair of parens, <code>pie()</code> constructs a default pie generator, the second <code>pie()(data)</code> invokes this generator on the dataset, returning an array of objects.</p><p>Note that the returned array is in the same order as the data.</p><h3 id="Lines"><a href="#Lines" class="headerlink" title="Lines"></a>Lines</h3><p>The line generator produces a spline or polyline, as in a line chart. Lines also appear in many other visualization types, such as the links in hierarchical edge bundling.</p><p><strong>d3.line()</strong> constructs a new line generator with default settings.</p><p><strong>line(data)</strong> generates a line for the given array of data. Depending on this line generator’s assciated curve, the given input data may need to be sorted by x-value before being passed to the line generator. If the line generator has a context, then the line is rendered to this context as a sequence of path method calls and this function returns void.</p><p><strong>line.x(fn)</strong> specifies the x accessor.</p><p><strong>line.y(fn)</strong> specifies the y accessor.</p><p><strong>line.defined([defined])</strong> sets the defined accessor.</p><p><img src="https://raw.githubusercontent.com/d3/d3-shape/master/img/line-defined.png"></p><p><strong>line.curve([curve])</strong> sets the curve factory and returns this line genrator. If curve is not specified, returns the current curve factory, which defaults to <strong>curveLinear</strong>.</p><p><strong>d3.lineRadial()</strong> constructs a new radial line generator with the default settings.</p><p><img src="https://raw.githubusercontent.com/d3/d3-shape/master/img/line-radial.png"></p><p>A radial line generator is equivalent to the standard cartesian line generator, except the x and y accessor are replaced with angle and readius accessors.</p><p>Radial lines are always positioned relative to &lt;0, 0&gt;, use a transform to change the origin.</p><h3 id="Areas"><a href="#Areas" class="headerlink" title="Areas"></a>Areas</h3><p>The area generator produces an area, as in an area chart. An area is defined by two bounding lines, either splines or polilines. Typically two lines share the same x-value, differing only in y-value; most commonly, y0 is defined as a constant representing zero.  The first line (the top line) is defined by x1 and y1 and is rendered first; the second line (the base line) is defined by x0 and y0 and is rendered second, with the points in reverse order.</p><p><strong>d3.area()</strong> constructs a new area generator with the default settings.</p><p><strong>area.data()</strong> generats area for the given array of data. Depending on this area generator’s associated curve.</p><p><strong>area.x([x])</strong> sets x0 to x and x1 to null.</p><p><strong>area.x0()</strong> sets the x0 accessor.</p><p><strong>area.defined()</strong></p><p><strong>d3.areaRadial()</strong></p><p><img src="https://raw.githubusercontent.com/d3/d3-shape/master/img/area-radial.png"></p><h3 id="Curves"><a href="#Curves" class="headerlink" title="Curves"></a>Curves</h3><p>Curves are typically not constructed or used directly, insread being passed to <code>line.curve</code> and <code>arec.curve</code>. For example:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> line = d3.line()</span><br><span class="line">  .x(<span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> x(d.date) &#125;)</span><br><span class="line">  .y(<span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> y(d.value) &#125;)</span><br><span class="line">  .curve(d3.curveCatmullRom.alpha(<span class="number">0.5</span>))</span><br></pre></td></tr></table></figure><ul><li><p>d3.curveBasis(context)</p></li><li><p>d3.curveBasisClosed(context)</p></li><li><p>d3.curveBasisOpen(context)</p></li><li><p>d3.curveBundle(context)</p></li><li><p>d3.curveCardinal(context)</p></li><li><p>d3.curveCardinalClosed(context)</p></li><li><p>d3.curveLinear(context)</p></li><li><p>d3.curveStep(context)</p></li><li><p>d3.curveStepAfter(context)</p></li><li><p>d3.curveStepBefore(context)</p></li></ul><h3 id="Links"><a href="#Links" class="headerlink" title="Links"></a>Links</h3><p>The link shape generates a smooth cubic Bezier curve from a source point to a target point. The tangents of the curve at the start and end are either <code>vertical</code>, <code>horizontal</code>, or <code>radial</code>.</p><p><strong>d3.linkVertical()</strong>, returns a new link generator with vertical tangents.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> link = d3.linkVertical()</span><br><span class="line">    .x(<span class="function"><span class="keyword">function</span>(<span class="params">d</span>)</span>&#123; <span class="keyword">return</span> d.x &#125;)</span><br><span class="line">    .y(<span class="function"><span class="keyword">function</span>(<span class="params">d</span>)</span>&#123; <span class="keyword">return</span> d.y &#125;)</span><br></pre></td></tr></table></figure><p><strong>d3.linkHorizontal()</strong>, returns a new link generator with horizontal tangents.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> link = d3.linkHorizontal()</span><br><span class="line">    .x(<span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.y &#125;)</span><br><span class="line">    .y(<span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.x &#125;)</span><br></pre></td></tr></table></figure><h3 id="Stacks"><a href="#Stacks" class="headerlink" title="Stacks"></a>Stacks</h3><p>Some shape types can be stakced, placing one shape adjacent to another.</p><p>Stacked charts can show overall value and per-category value simultaneously.</p><p><strong>d3.stack()</strong>, constructs a new stack generator with the default settings.</p><p><strong>stack(data[, arguments])</strong>, generates a stack for the given array of data, returning an array of representing each series. Any additional arguments are arbitrary, they are simply propagated to accessors along with <code>this</code> object.</p><p>The series are determined by the keys accessor; each series <em>i</em> in the returned array corresponds to the <em>i</em> th key. Each series is an array o points, where each point <em>j</em> corresponds to the <em>j</em> th element in the input <em>data</em>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> data = [</span><br><span class="line">  &#123;<span class="attr">month</span>: <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">2015</span>, <span class="number">0</span>, <span class="number">1</span>), <span class="attr">apples</span>: <span class="number">3840</span>, <span class="attr">bananas</span>: <span class="number">1920</span>, <span class="attr">cherries</span>: <span class="number">960</span>, <span class="attr">dates</span>: <span class="number">400</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">month</span>: <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">2015</span>, <span class="number">1</span>, <span class="number">1</span>), <span class="attr">apples</span>: <span class="number">1600</span>, <span class="attr">bananas</span>: <span class="number">1440</span>, <span class="attr">cherries</span>: <span class="number">960</span>, <span class="attr">dates</span>: <span class="number">400</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">month</span>: <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">2015</span>, <span class="number">2</span>, <span class="number">1</span>), <span class="attr">apples</span>:  <span class="number">640</span>, <span class="attr">bananas</span>:  <span class="number">960</span>, <span class="attr">cherries</span>: <span class="number">640</span>, <span class="attr">dates</span>: <span class="number">400</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">month</span>: <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">2015</span>, <span class="number">3</span>, <span class="number">1</span>), <span class="attr">apples</span>:  <span class="number">320</span>, <span class="attr">bananas</span>:  <span class="number">480</span>, <span class="attr">cherries</span>: <span class="number">640</span>, <span class="attr">dates</span>: <span class="number">400</span>&#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">// To produce a stack of this data</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> stack = d3.stack()</span><br><span class="line">    .keys([ <span class="string">&#x27;apples&#x27;</span>, <span class="string">&#x27;bananas&#x27;</span>, <span class="string">&#x27;cherries&#x27;</span>, <span class="string">&#x27;dates&#x27;</span> ])</span><br><span class="line">    .order(d3.stackOrderNone)</span><br><span class="line">    .offset(d3.stackOffsetNone)</span><br><span class="line"></span><br><span class="line"><span class="comment">// returned</span></span><br><span class="line"></span><br><span class="line">[</span><br><span class="line">  [[   <span class="number">0</span>, <span class="number">3840</span>], [   <span class="number">0</span>, <span class="number">1600</span>], [   <span class="number">0</span>,  <span class="number">640</span>], [   <span class="number">0</span>,  <span class="number">320</span>]], <span class="comment">// apples</span></span><br><span class="line">  [[<span class="number">3840</span>, <span class="number">5760</span>], [<span class="number">1600</span>, <span class="number">3040</span>], [ <span class="number">640</span>, <span class="number">1600</span>], [ <span class="number">320</span>,  <span class="number">800</span>]], <span class="comment">// bananas</span></span><br><span class="line">  [[<span class="number">5760</span>, <span class="number">6720</span>], [<span class="number">3040</span>, <span class="number">4000</span>], [<span class="number">1600</span>, <span class="number">2240</span>], [ <span class="number">800</span>, <span class="number">1440</span>]], <span class="comment">// cherries</span></span><br><span class="line">  [[<span class="number">6720</span>, <span class="number">7120</span>], [<span class="number">4000</span>, <span class="number">4400</span>], [<span class="number">2240</span>, <span class="number">2640</span>], [<span class="number">1440</span>, <span class="number">1840</span>]], <span class="comment">// dates</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><p><strong>stack.keys([keys])</strong>, sets the keys accessor to the specified function or array and returns this stack generator.</p><p><strong>stack.order([order])</strong>, sets the order accessor to the specified functino or array and returns this stack generator. If order is not specified, returns the current order accessor, which default to <code>stackOrderNone</code>, this uses the order given by the key accessor.</p><ul><li><p>d3.stackOrderAscending(series)</p></li><li><p>d3.stackOrderDescending(series)</p></li><li><p>d3.stackOrderInsideOut(series)</p></li><li><p>d3.stackOrderNone(series)</p></li><li><p>d3.stackOrderReverse(series)</p></li></ul><p><strong>stack.offset([offest])</strong>, sets the offset accessor to the specified function or array, and returns this stack generator. If no offset is specified, returns the current offset accessor, which default to <code>stackOffsetNone</code>, this uses a zero baseline.</p><ul><li><p>d3.stackOffsetDiverging(series, order)</p></li><li><p>d3.stackOffsetExpand(series, order)</p></li><li><p>d3.stackOffsetNone(series, order)</p></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> D3 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>d3.range</title>
      <link href="/2017/07/12/d3-range/"/>
      <url>/2017/07/12/d3-range/</url>
      
        <content type="html"><![CDATA[<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d3.range([start, ]stop[, step])</span><br></pre></td></tr></table></figure><p>Returns an array containing an arithmetic progression, similar to the Python built-in range. This method is often used to iterate over a sequence of uniformly-spaced numeric values, such as the indexes of an array or the ticks of a linear scale.</p><p>If <em>step</em> is ommitted, it defaults to 1. If <em>start</em> ommitted, it defaults to 0. The <em>stop</em> value is exclusive; it is not included in the result.</p><p>The arguments are not required to be integers; however, the results are more predicable if they are.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">d3.range(<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>/<span class="number">49</span>) <span class="comment">// BAD, and returns 50 elements</span></span><br><span class="line">d3.range(<span class="number">49</span>).map(<span class="function"><span class="params">d</span> =&gt;</span> (d/<span class="number">49</span>)) <span class="comment">// GOOD, and returns 49 elements</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> D3 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Quick Reference of D3</title>
      <link href="/2017/07/11/Quick-Reference-of-D3/"/>
      <url>/2017/07/11/Quick-Reference-of-D3/</url>
      
        <content type="html"><![CDATA[<h1 id="Selections"><a href="#Selections" class="headerlink" title="Selections"></a>Selections</h1><h3 id="d3-select"><a href="#d3-select" class="headerlink" title="d3.select()"></a>d3.select()</h3><p>Returns a reference to the first element found.</p><h3 id="d3-selectAll"><a href="#d3-selectAll" class="headerlink" title="d3.selectAll()"></a>d3.selectAll()</h3><p>Returns references to all found elements</p><h3 id="selection-append"><a href="#selection-append" class="headerlink" title="selection.append()"></a>selection.append()</h3><p>Takes a selection, creates a new element inside of it, then returns a reference to the newly created element.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> newCirlce = svg.append(<span class="string">&#x27;circle&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="selection-remove"><a href="#selection-remove" class="headerlink" title="selection.remove()"></a>selection.remove()</h3><p>Takes a selection, removes it from the DOM, and returns a reference to the deleted selection.</p><h3 id="selection-text"><a href="#selection-text" class="headerlink" title="selection.text()"></a>selection.text()</h3><p>Takes a selection, sets its text content, and returns a reference to the acted-upon selection.</p><h3 id="selection-attr"><a href="#selection-attr" class="headerlink" title="selection.attr()"></a>selection.attr()</h3><p>Takes a selection, sets an attribute value, and returns a reference to the acted-upon selection.</p><h3 id="selection-style"><a href="#selection-style" class="headerlink" title="selection.style()"></a>selection.style()</h3><p>Takes a selection, sets an inline CSS style, and returns a reference to the acted-upon selection.</p><h3 id="selection-classed"><a href="#selection-classed" class="headerlink" title="selection.classed()"></a>selection.classed()</h3><p>Takes a selection, adds or remove a class, and returns a reference to the acted-upon selection; <code>true</code> adds the specified class, <code>false</code> removes it.</p><h3 id="selection-each"><a href="#selection-each" class="headerlink" title="selection.each()"></a>selection.each()</h3><p>Takes a selection, and runs an arbitrary function for each element in the selection, with the <code>this</code> context set to the element being acted upon.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d3.selectAll(<span class="string">&#x27;circle&#x27;</span>).each(zoomAndEnhance)</span><br></pre></td></tr></table></figure><h1 id="Data"><a href="#Data" class="headerlink" title="Data"></a>Data</h1><h3 id="selection-data"><a href="#selection-data" class="headerlink" title="selection.data()"></a>selection.data()</h3><p>Takes a selection, calculates the difference between the number of elements and number of data value, and binds the array of data value to any existing elements(or not existing placeholder elements).</p><h3 id="selection-datum"><a href="#selection-datum" class="headerlink" title="selection.datum()"></a>selection.datum()</h3><p>Takes a selection, and binds a single data value to a single element.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svg.append(<span class="string">&#x27;path&#x27;</span>).datum(dataset).attr(<span class="string">&#x27;d&#x27;</span>, line)</span><br></pre></td></tr></table></figure><h3 id="selection-enter"><a href="#selection-enter" class="headerlink" title="selection.enter()"></a>selection.enter()</h3><p>Takes a selection and returns a subselection of ‘new’ placeholder elements.</p><h3 id="selection-merge"><a href="#selection-merge" class="headerlink" title="selection.merge()"></a>selection.merge()</h3><p>Takes a selection and merges it with another specified selection, returning a newly merged selection.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bars.enter().append(<span class="string">&#x27;rect&#x27;</span>).merge(bars) <span class="comment">// merge enter subselection with existing selection.</span></span><br></pre></td></tr></table></figure><h3 id="selection-exit"><a href="#selection-exit" class="headerlink" title="selection.exit()"></a>selection.exit()</h3><p>Takes a selection and returns a subselection of ‘exiting’ elements.</p><h3 id="selection-remove-1"><a href="#selection-remove-1" class="headerlink" title="selection.remove()"></a>selection.remove()</h3><p>Takes a selection and removes associated elements from the DOM.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bars.exit().remove()</span><br></pre></td></tr></table></figure><h3 id="function-d-…"><a href="#function-d-…" class="headerlink" title="function (d) { … }"></a>function (d) { … }</h3><p>Use anonymouse functions to access data values bound to element via <code>d</code>.</p><h3 id="function-d-i-…"><a href="#function-d-i-…" class="headerlink" title="function (d, i) { … }"></a>function (d, i) { … }</h3><p>Including <code>i</code> to get the index value of each element in the selection.</p><h3 id="selection-fitler"><a href="#selection-fitler" class="headerlink" title="selection.fitler()"></a>selection.fitler()</h3><p>Takes a selection and returns a new (sub)selection</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">d3.selectAll(<span class="string">&#x27;circle&#x27;</span>)</span><br><span class="line">  .filter(<span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> d &gt; <span class="number">15</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .style(<span class="string">&#x27;color&#x27;</span>, <span class="string">&#x27;red&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="d3-csv"><a href="#d3-csv" class="headerlink" title="d3.csv()"></a>d3.csv()</h3><p>Loads an external CSV file, parses the contents into JSON, then hands off the results to a callback function.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">d3.csv(<span class="string">&#x27;food.csv&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="d3-json"><a href="#d3-json" class="headerlink" title="d3.json()"></a>d3.json()</h3><p>Loads an external JSON file, parse the content into JSON, then hands off the results to a callback function.</p><h3 id="d3-request"><a href="#d3-request" class="headerlink" title="d3.request()"></a>d3.request()</h3><p>Loads an arbitrary external file, then hands off the result to a callback function.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">d3.request(<span class="string">&#x27;interesting_data.txt&#x27;</span>)</span><br><span class="line">  .get(<span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Do something</span></span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><h1 id="Transitions"><a href="#Transitions" class="headerlink" title="Transitions"></a>Transitions</h1><h3 id="selection-transition"><a href="#selection-transition" class="headerlink" title="selection.transition()"></a>selection.transition()</h3><p>Takes a selection, and initiates a new transition, so values specified after this point will be interpolated over time(rather than set immediately).</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">d3.selectAll(<span class="string">&#x27;circle&#x27;</span>)</span><br><span class="line">  .attr(<span class="string">&#x27;cx&#x27;</span>, <span class="number">0</span>)</span><br><span class="line">  .transition()</span><br><span class="line">  .attr(<span class="string">&#x27;cx&#x27;</span>, <span class="number">100</span>)</span><br></pre></td></tr></table></figure><h3 id="selection-delay"><a href="#selection-delay" class="headerlink" title="selection.delay()"></a>selection.delay()</h3><p>Takes a transition, and sets the delay, in milliseconds.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">d3.selectAll(<span class="string">&#x27;circle&#x27;</span>)</span><br><span class="line">  .attr(<span class="string">&#x27;cx&#x27;</span>, <span class="number">0</span>)</span><br><span class="line">  .transition()</span><br><span class="line">  .delay(<span class="number">1000</span>)</span><br><span class="line">  .attr(<span class="string">&#x27;cx&#x27;</span>, <span class="number">100</span>)</span><br></pre></td></tr></table></figure><h3 id="transition-duration"><a href="#transition-duration" class="headerlink" title="transition.duration()"></a>transition.duration()</h3><p>Takes a transition and sets the duration in milliseconds.</p><h3 id="transition-ease"><a href="#transition-ease" class="headerlink" title="transition.ease()"></a>transition.ease()</h3><p>Takes a transition and sets the easing to be used.</p><h3 id="transition-on"><a href="#transition-on" class="headerlink" title="transition.on()"></a>transition.on()</h3><p>Takes a transition, and binds a function to be executed at either the <code>start</code> or <code>end</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">d3.selectAll(<span class="string">&#x27;circle&#x27;</span>)</span><br><span class="line">  .attr(<span class="string">&#x27;cx&#x27;</span>, <span class="number">0</span>)</span><br><span class="line">  .transition()</span><br><span class="line">  .attr(<span class="string">&#x27;cx&#x27;</span>, <span class="number">100</span>)</span><br><span class="line">  .on(<span class="string">&#x27;end&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;All done&#x27;</span>)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><h1 id="Scale"><a href="#Scale" class="headerlink" title="Scale"></a>Scale</h1><h3 id="d3-scaleLinear"><a href="#d3-scaleLinear" class="headerlink" title="d3.scaleLinear()"></a>d3.scaleLinear()</h3><p>Creates a new linear scale function.</p><h3 id="scaleLinear-domain"><a href="#scaleLinear-domain" class="headerlink" title="scaleLinear.domain()"></a>scaleLinear.domain()</h3><p>Sets a linear scale’s input domain.</p><h3 id="scaleLinear-range"><a href="#scaleLinear-range" class="headerlink" title="scaleLinear.range()"></a>scaleLinear.range()</h3><p>Sets a linear scale’s output range.</p><h3 id="scaleLinear-rangeRound"><a href="#scaleLinear-rangeRound" class="headerlink" title="scaleLinear.rangeRound()"></a>scaleLinear.rangeRound()</h3><p>Sets a linear scale’s output range, and have all values output by the scale rounded to the nearest whole number.</p><h3 id="scaleLinear-nice"><a href="#scaleLinear-nice" class="headerlink" title="scaleLinear.nice()"></a>scaleLinear.nice()</h3><p>Expands a linear sclae’s domain to the nearest round values.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xScale.nice()</span><br></pre></td></tr></table></figure><h3 id="scaleLinear-clamp"><a href="#scaleLinear-clamp" class="headerlink" title="scaleLinear.clamp()"></a>scaleLinear.clamp()</h3><p>Forces any values output by this scale to be constrainted (rounded to be) within the specified range.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xScale.clamp(<span class="literal">true</span>)</span><br></pre></td></tr></table></figure><h3 id="d3-min"><a href="#d3-min" class="headerlink" title="d3.min()"></a>d3.min()</h3><p>Returns the smallest value in an array.</p><h3 id="d3-max"><a href="#d3-max" class="headerlink" title="d3.max()"></a>d3.max()</h3><p>Returns the largest value in an array.</p><h1 id="Axes"><a href="#Axes" class="headerlink" title="Axes"></a>Axes</h1><h3 id="d3-axisTop-d3-axisRight-d3-axisBottom-d3-axisLeft"><a href="#d3-axisTop-d3-axisRight-d3-axisBottom-d3-axisLeft" class="headerlink" title="d3.axisTop, d3.axisRight, d3.axisBottom, d3.axisLeft"></a>d3.axisTop, d3.axisRight, d3.axisBottom, d3.axisLeft</h3><p>Create a new axis generator function, with specified orientation.</p><h3 id="axis-scale"><a href="#axis-scale" class="headerlink" title="axis.scale()"></a>axis.scale()</h3><p>Takes an axis, and specifies the scale to be used.</p><h3 id="axis-ticks"><a href="#axis-ticks" class="headerlink" title="axis.ticks()"></a>axis.ticks()</h3><p>Takes an axis, and specifies a target number of ticks to be used.</p><h3 id="axis-tickValues"><a href="#axis-tickValues" class="headerlink" title="axis.tickValues()"></a>axis.tickValues()</h3><p>Takes an axis, and specifies the values to be labeled with ticks.</p><h3 id="selection-call"><a href="#selection-call" class="headerlink" title="selection.call()"></a>selection.call()</h3><p>Takes a selection, and calls an arbitrary method to act upon the selection; commonly used to generate an axis.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svg.append(<span class="string">&#x27;g&#x27;</span>).call(xAxis)</span><br></pre></td></tr></table></figure><h1 id="Interactivity"><a href="#Interactivity" class="headerlink" title="Interactivity"></a>Interactivity</h1><h3 id="selection-on"><a href="#selection-on" class="headerlink" title="selection.on()"></a>selection.on()</h3><p>Takes a selection, and binds an event listener</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">d3.select(<span class="string">&#x27;#button&#x27;</span>)</span><br><span class="line">  .on(<span class="string">&#x27;click&#x27;</span>, <span class="function">() =&gt;</span> &#123; ... &#125;)</span><br></pre></td></tr></table></figure><h3 id="d3-select-this"><a href="#d3-select-this" class="headerlink" title="d3.select(this)"></a>d3.select(this)</h3><p>Within an anonymous function, <code>this</code> refers to <code>the element current being acted upon</code></p><h1 id="Numebrs-Dates-and-Times"><a href="#Numebrs-Dates-and-Times" class="headerlink" title="Numebrs, Dates, and Times"></a>Numebrs, Dates, and Times</h1><h3 id="d3-range"><a href="#d3-range" class="headerlink" title="d3.range()"></a>d3.range()</h3><p>Generates an array of sequential numbers.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d3.range(<span class="number">5</span>); <span class="comment">// Returns [0, 1, 2, 3, 4]</span></span><br></pre></td></tr></table></figure><h3 id="d3-format"><a href="#d3-format" class="headerlink" title="d3.format()"></a>d3.format()</h3><p>Creates a new number formatter, for convertiing numbers to strings.</p><h3 id="d3-timeParse"><a href="#d3-timeParse" class="headerlink" title="d3.timeParse()"></a>d3.timeParse()</h3><p>Creates a new time parser, for converting strings to Date Object.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> parseTime = d3.timeParse(<span class="string">&quot;%m/%d/%y&quot;</span>)</span><br><span class="line">parseTime(<span class="string">&#x27;02/20/17&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="d3-timeFormat"><a href="#d3-timeFormat" class="headerlink" title="d3.timeFormat()"></a>d3.timeFormat()</h3><p>Creates a new time formatter, for converting Data Object to strings.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> formatTime = d3.timeFormat(<span class="string">&quot;%b %e&quot;</span>)</span><br><span class="line">formatTime(<span class="keyword">new</span> <span class="built_in">Date</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> D3 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Simple Api of Mongoose</title>
      <link href="/2017/07/10/Simple-Api-of-Mongoose/"/>
      <url>/2017/07/10/Simple-Api-of-Mongoose/</url>
      
        <content type="html"><![CDATA[<h3 id="Two-methods-to-connect-to-Mongo-DB"><a href="#Two-methods-to-connect-to-Mongo-DB" class="headerlink" title="Two methods to connect to Mongo DB"></a>Two methods to connect to Mongo DB</h3><ul><li><p><code>mongoose.connect</code></p></li><li><p><code>mongoose.createConnection</code></p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> dbURL = <span class="string">&#x27;mongodb://...&#x27;</span></span><br><span class="line"><span class="keyword">const</span> dbOptions = &#123;</span><br><span class="line">  user: <span class="string">&#x27;db_user&#x27;</span>,</span><br><span class="line">  pass: <span class="string">&#x27;db_pass&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> adminConnection = mongoose.createConnection(dbURL, dbOptions)</span><br></pre></td></tr></table></figure><h3 id="Close-Connection"><a href="#Close-Connection" class="headerlink" title="Close Connection"></a>Close Connection</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mongoose.connection.close(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Connection cvlosed&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">adminConnection.close(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;adminConnection closed&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// auto close when process exit</span></span><br><span class="line">process..on(<span class="string">&#x27;SIGINT&#x27;</span> () =&gt; &#123;</span><br><span class="line">  mongoose.connection.close(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Mongoose disconnected through app termination&#x27;</span>)</span><br><span class="line">    process.exit(<span class="number">0</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Cache-Error"><a href="#Cache-Error" class="headerlink" title="Cache Error"></a>Cache Error</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mongoose.connection.on(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Mongoose connection error: &#x27;</span> + err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="db-js"><a href="#db-js" class="headerlink" title="db.js"></a>db.js</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// /model/db.js</span></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dbURL = <span class="string">&#x27;mongodb://...&#x27;</span></span><br><span class="line"></span><br><span class="line">mongoose.connect(dbURL)</span><br><span class="line"></span><br><span class="line">mongoose.connection.on(<span class="string">&#x27;connected&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Mongoose connected to &#x27;</span> + dbURL)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">mongoose.connection.on(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Mongoose connection error: &#x27;</span> + err)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">mongoose.connection.on(<span class="string">&#x27;disconnected&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Mongoose disconnected&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">process.on(<span class="string">&#x27;SIGINT&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  mongoose.connection.close(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Mongoose disconnected through app termination&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// app.js</span></span><br><span class="line">db = <span class="built_in">require</span>(<span class="string">&#x27;./model/db&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="Schema-and-Model-in-Mongoose"><a href="#Schema-and-Model-in-Mongoose" class="headerlink" title="Schema and Model in Mongoose"></a>Schema and Model in Mongoose</h2><blockquote><p>Everything in Mongoose starts with a Schema. Each schema maps to a MongoDB collection and defines the shape of the documents within that collection.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Schema = mongoose.Schema</span><br><span class="line"><span class="keyword">const</span> userSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">  name: <span class="built_in">String</span>,</span><br><span class="line">  pass: <span class="built_in">String</span>,</span><br><span class="line">  email: <span class="built_in">String</span>,</span><br><span class="line">  createTime: <span class="built_in">String</span>,</span><br><span class="line">  lastLogin: <span class="built_in">String</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Schema to define table structure.</p><p>Model to manipulate collection.</p><p>Use model to create documents in Mongodb.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create model</span></span><br><span class="line"><span class="keyword">const</span> User = mongoose.model(<span class="string">&#x27;User&#x27;</span>, userSchema)</span><br><span class="line"></span><br><span class="line"><span class="comment">// create instance, namely document</span></span><br><span class="line"><span class="keyword">const</span> newUser = <span class="keyword">new</span> User(&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// insert document to db</span></span><br><span class="line">newUser.save(<span class="function">(<span class="params">err, doc</span>) =&gt;</span> &#123;</span><br><span class="line">  err &amp;&amp; <span class="built_in">console</span>.error(err)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;doc is saved&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// create and insert</span></span><br><span class="line">User.create(&#123;...&#125;, <span class="function">(<span class="params">err, doc</span>) =&gt;</span> &#123;</span><br><span class="line">  err &amp;&amp; <span class="built_in">console</span>.error(err)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;doc saved&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// add staitc methods</span></span><br><span class="line">userSchema.statics.findUsersByType = <span class="function"><span class="keyword">function</span> (<span class="params">type, cb</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">this</span>.find(&#123; <span class="attr">type</span>: <span class="built_in">this</span>.type &#125;, cb)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Model.$where(argument: string | Function): <Query>, creates a Query and specifies a <em>$where</em> condition</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Blog.$where(<span class="string">&#x27;this.username.indexOf(&quot;val&quot;) !== -1&#x27;</span>).exec(<span class="function"><span class="keyword">function</span> (<span class="params">err, docs</span>) </span>&#123;&#125;)</span><br></pre></td></tr></table></figure><ul><li>Model#increment()</li></ul><h3 id="search"><a href="#search" class="headerlink" title="search"></a>search</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User.find(&#123; <span class="attr">type</span>: <span class="string">&#x27;type&#x27;</span> &#125;).where(<span class="string">&#x27;age&#x27;</span>).gt(<span class="number">2</span>).limit(<span class="number">10</span>).exec()</span><br></pre></td></tr></table></figure><h3 id="remove"><a href="#remove" class="headerlink" title="remove"></a>remove</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">User.remove(&#123; <span class="attr">type</span>: <span class="string">&#x27;type&#x27;</span> &#125;, <span class="function">(<span class="params">err, res</span>) =&gt;</span> &#123;</span><br><span class="line">  err &amp;&amp; <span class="built_in">console</span>.error(err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="update"><a href="#update" class="headerlink" title="update"></a>update</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">User.find(&#123; <span class="attr">type</span>: <span class="string">&#x27;type&#x27;</span> &#125;).update(&#123;</span><br><span class="line">  $set: &#123;</span><br><span class="line">    date: <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  err &amp;&amp; <span class="built_in">console</span>.error(err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>More…</p>]]></content>
      
      
      
        <tags>
            
            <tag> Database </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Notes on Interactive Data Visualization for the Web</title>
      <link href="/2017/07/07/Notes-on-Interactive-Data-Visualization-for-the-Web/"/>
      <url>/2017/07/07/Notes-on-Interactive-Data-Visualization-for-the-Web/</url>
      
        <content type="html"><![CDATA[<h1 id="Introducing-D3"><a href="#Introducing-D3" class="headerlink" title="Introducing D3"></a>Introducing D3</h1><p>D3 – also referred to as d3.js – is a JavaScript library for creating data visualization. But that kind of undersell it.</p><p>The abbreviation D3 reference the tool’s full name, <em>Data-Driven Documents</em>. The <em>data</em> is provided by you, and the <em>documents</em> are web-based documents, meaning anything that can be rendered by a web browser, such as HTML and SVG. D3 does the <em>driviing</em>, in the sense that it connects the data to the documents.</p><h1 id="Data"><a href="#Data" class="headerlink" title="Data"></a>Data</h1><p><em>Data</em> is an extemely broad term, only slightly less vague than the nearly all-encompassing <em>information</em>.</p><p>Boradly speaking, data is a structured information with potential for meaning.</p><p>In the context of programming for visualization, data is stored in a digital file, typically in either text or binary form. Of course, potentially every piece of digital ephemera may be considered <code>data</code> – not just text, but bits and bytes representing images, audio, video, database, streams, models, archives, and anything else.</p><p>Within the scope of D3 and browser-based visualization, however, we will limit ourselves to <em>text-based</em>. That is, anything that can be presented as numbers and strings of alpha charaters.</p><h2 id="Binding-Data"><a href="#Binding-Data" class="headerlink" title="Binding Data"></a>Binding Data</h2><p>We use D3’s <code>data()</code> method to bind data to DOM elements. But there are two things we need in place first, before we can bind data:</p><ul><li><p>The data</p></li><li><p>A selection of DOM elements</p></li></ul><p>Anytime after you call <code>data()</code>, you can craete an anonymous function accepts <code>d</code> as input.</p><p>The magical <code>data()</code> method ensures that <code>d</code> is set to the corresponding value in your original dataset, given the current element at hand.</p><h2 id="Drawing-with-Data"><a href="#Drawing-with-Data" class="headerlink" title="Drawing with Data"></a>Drawing with Data</h2><p><code>.attr</code>, <code>.classed</code>, <code>.style</code></p><h1 id="Scales"><a href="#Scales" class="headerlink" title="Scales"></a>Scales</h1><blockquote><p>Scales are functions that map from an input domain to an output domain.</p></blockquote><p>The values in any dataset are unlikely to correspond exactly to pixel measurement for use in your visuallization.  Scales provide a convenient way to map those data values to new values useful for visuallization purposes.</p><p>D3 scales are <em>functions</em> with parameters that you define. Once they are created, you call the <code>scale</code> function , pass it a data value and it nicely returns a scaled output value.</p><p>A scale is a mathematical relationship, with no direct visual output.</p><h2 id="Domains-and-Ranges"><a href="#Domains-and-Ranges" class="headerlink" title="Domains and Ranges"></a>Domains and Ranges</h2><p>A scale’s <em>input domain</em> is the range of possible input data values.</p><p>A scale’s <em>output range</em> is the range of possible output values, commonly used as display values in pixel units.</p><h2 id="Normalization"><a href="#Normalization" class="headerlink" title="Normalization"></a>Normalization</h2><p>Normalization is the process of mapping a numeric value to a new value between 0 and 1, based on the possible minumum and maximum values.</p><h2 id="Creating-a-Scale"><a href="#Creating-a-Scale" class="headerlink" title="Creating a Scale"></a>Creating a Scale</h2><p>D3’s linear scale function generator is accessed with <code>d3.scaleLiner()</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> scale = d3.scaleLinear()</span><br></pre></td></tr></table></figure><p>Now <code>scale</code> is a function to which you can pass input values.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scale(<span class="number">2.5</span>) <span class="comment">// return 2.5</span></span><br></pre></td></tr></table></figure><p>Because we haven’t set a domain and a range yet, this function will map input to output on a <code>1:1</code> scale.</p><p>We set the scale’s input domain to 100, 500 by passing those values to the <code>domain()</code> method as an array.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scale.domain([<span class="number">100</span>, <span class="number">500</span>])</span><br></pre></td></tr></table></figure><p>Set the output range in similar fashion, with <code>range()</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scale.range([<span class="number">10</span>, <span class="number">350</span>])</span><br></pre></td></tr></table></figure><p>These steps can be chained:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> scale = d3.scaleLinear()</span><br><span class="line">  .domain([<span class="number">100</span>, <span class="number">500</span>])</span><br><span class="line">  .range([<span class="number">10</span>, <span class="number">350</span>])</span><br></pre></td></tr></table></figure><p>Now it’s effective</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scale(<span class="number">100</span>) <span class="comment">// return 10</span></span><br><span class="line">scale(<span class="number">300</span>) <span class="comment">// return 180</span></span><br><span class="line">scale(<span class="number">500</span>) <span class="comment">// return 350</span></span><br></pre></td></tr></table></figure><h3 id="d3-max-and-d3-min"><a href="#d3-max-and-d3-min" class="headerlink" title="d3.max() and d3.min()"></a>d3.max() and d3.min()</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> dataset = [</span><br><span class="line">  [<span class="number">5</span>, <span class="number">20</span>], [<span class="number">480</span>, <span class="number">90</span>], [<span class="number">250</span>, <span class="number">50</span>], [<span class="number">100</span>, <span class="number">33</span>], [<span class="number">330</span>, <span class="number">95</span>],</span><br><span class="line">  [<span class="number">410</span>, <span class="number">12</span>], [<span class="number">475</span>, <span class="number">44</span>], [<span class="number">25</span>, <span class="number">67</span>], [<span class="number">85</span>, <span class="number">21</span>], [<span class="number">220</span>, <span class="number">88</span>]</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">d3.max(dataset, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> d[<span class="number">0</span>]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// this function will return the value 480</span></span><br></pre></td></tr></table></figure><h3 id="Setting-Up-Dynamic-Scales"><a href="#Setting-Up-Dynamic-Scales" class="headerlink" title="Setting Up Dynamic Scales"></a>Setting Up Dynamic Scales</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xScale = d3.scaleLinear()</span><br><span class="line">  .domain([<span class="number">0</span>, d3.max(dataset, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">    retrun d[<span class="number">0</span>]</span><br><span class="line">  &#125;)])</span><br><span class="line">  .range([<span class="number">0</span>, w])</span><br></pre></td></tr></table></figure><p>Output range is set to 0 and w, the SVG’s width.</p><p>Use the scale</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.attr(<span class="string">&#x27;x&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> xScale(d[<span class="number">0</span>])</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><blockquote><p><code>d3.scaleLinear()</code> has several other handly methods that deserve a breif mention here:</p></blockquote><ul><li><p><code>nice()</code>: this tells the scale to take whatever input domain that you gave to <code>domian()</code> and expand both ends to the nearest round value.</p></li><li><p><code>rangeRound()</code>: User <code>rangeRound()</code> in place of <code>range()</code>, and all values output by the scale will be rounded to nearest whole number.</p></li><li><p><code>clamp()</code>: By default, a linear scale can return values outside of the specified range. For example, if if given a value outside of its expected input domain, a scale will return a number also outside of the output range. Calling <code>clamp(true)</code> on a scale, forces all output values to be within the specified range. This means excessive values will be rounded to the range’s low or high value.</p></li></ul><p>To use any of these special methods, just tack them onto the chain in which you define the original scale function.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> scale = d3.scaleLinear().domain([<span class="number">0.123</span>, <span class="number">4.67</span>]).range([<span class="number">0</span>, <span class="number">500</span>]).nice()</span><br></pre></td></tr></table></figure><blockquote><p>Other Scales</p></blockquote><ul><li><p><code>sclaeSqrt</code></p></li><li><p><code>scalePow</code></p></li><li><p><code>scaleLog</code></p></li><li><p><code>scaleQuantize</code></p></li><li><p><code>scaleQuantile</code></p></li><li><p><code>scaleOrdinal</code></p></li><li><p><code>scaleTime</code></p></li></ul><h1 id="Axes"><a href="#Axes" class="headerlink" title="Axes"></a>Axes</h1><p>D3’s axes are actually <code>function</code> whose parameters you define. Unlike scales, when an axis function is called, it doesn’t return a value, but generates the visual elements of the axis, including lines, labels, and ticks.</p><h2 id="Setting-Up-an-Axis"><a href="#Setting-Up-an-Axis" class="headerlink" title="Setting Up an Axis"></a>Setting Up an Axis</h2><p>There are four different axis function constructors, each one corresponding to a different orientation and placement of labels: <code>d3.axisTop</code>, <code>d3.axisBottom</code>, <code>d3.axisLeft</code>, <code>d3.axisRight</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> xAxis = d3.axisBottom()</span><br></pre></td></tr></table></figure><p>At a minimum, each axis also needs to be told on what <em>scale</em> to operate.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> xAxis = d3.axisBottom().scale(xScale)</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"><span class="keyword">const</span> xAxis = d3.axisBottom(xScale)</span><br></pre></td></tr></table></figure><p>Finally, to actually generate the axis and insert all those little lines and labels into our SVG, we must <code>call</code> teh <code>xAxis</code> function. This is similar to the scale functions, which we first configured by setting parameters, and then later <code>called</code> to put them into action.</p><p>Here we put this code at the end of script, so the axis is generated after the other elements in the SVG, and therefore appears ‘on top’</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svg.append(<span class="string">&#x27;g&#x27;</span>).call(xAxis)</span><br></pre></td></tr></table></figure><p>This is where things get a little funky. You might be wondering why this looks so different from our friendly scale functions. Here’s why: because an axis function actually draws something to the screen (by appending SVG elements to the DOM), we need to specify where in the DOM it should place new elements.</p><p>In the svg, we <code>append()</code> a new <code>g</code> element to the end of the SVG. In SVG land, a <code>g</code> element is a <code>group</code> element. Group elements are invisible, unlike <code>line</code>, <code>rect</code>, and <code>circle</code> and they have no visual presence themselves.</p><p>The <code>g</code> element can keep our code nice and be transformed.</p><p>So we’ve created a new <code>g</code>, and then finally, the function <code>call()</code> is called on our new <code>g</code>.</p><p>D3’s <code>call()</code> function takes the incoming <code>selection</code>, as received from the prior link in the chain, and hands that selection off to any <code>function</code>.</p><p>This this case, the selection is our new <code>g</code> group element. Although the <code>g</code> isn’t strictly necessary, we are using it because the axis function is about to generate lots of crazy lines and numbers, and it’s noce to contain all those element within a single group object.</p><p><code>call()</code> hands off <code>g</code> to the <code>xAxis</code> function, so our axis is genrated within <code>g</code></p><h3 id="Positioning-Axes"><a href="#Positioning-Axes" class="headerlink" title="Positioning Axes"></a>Positioning Axes</h3><p>By default, an axis is positioned using the range values of the specified scale. In our case, <code>xAxis</code> is referencing <code>xScale</code>, which has a range of [20, 460], because we applied 20 pixels of padding on all edge of the SVG. We can transform the axis by:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">svg.append(<span class="string">&#x27;g&#x27;</span>)</span><br><span class="line">  .attr(<span class="string">&#x27;class&#x27;</span>, <span class="string">&#x27;axis&#x27;</span>)</span><br><span class="line">  .attr(<span class="string">&#x27;tranform&#x27;</span>, <span class="string">&#x27;translate(0, &#x27;</span> + (h - padding) + <span class="string">&#x27;)&#x27;</span>)</span><br><span class="line">  .call(xAxis)</span><br></pre></td></tr></table></figure><p>In the end, we would like  our <code>g</code> to look like this in the DOM:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">g</span> <span class="attr">class</span>=<span class="string">&quot;axis&quot;</span> <span class="attr">transform</span>=<span class="string">&quot;translate(0, 280)&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="CSS-styles-on-axis"><a href="#CSS-styles-on-axis" class="headerlink" title="CSS styles on axis"></a>CSS styles on axis</h3><p>The axes themselves are made up of <code>path</code>, <code>line</code>, <code>text</code> element, so those are the three elemnts to target in your CSS.</p><p>The paths and lines can be styled together, with the same rules, and text gets its own rules around for font and font size.</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.axis</span> <span class="selector-tag">path</span>, <span class="selector-class">.axis</span> <span class="selector-tag">line</span> &#123;</span><br><span class="line">  <span class="attribute">stroke</span>: teal;</span><br><span class="line">  <span class="attribute">shape-rendering</span>: crispEdges;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.axis</span> <span class="selector-tag">text</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: Optima, Futura, sans-serif;</span><br><span class="line">  <span class="attribute">font-weight</span>: bold;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">fill</span>: teal;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>These CSS rules will override D3’s default styles.</p><p>Note that when we use CSS rules to style SVG elements, only SVG attribute names – not regular CSS properties – should be used.</p><h3 id="Check-for-Ticks"><a href="#Check-for-Ticks" class="headerlink" title="Check for Ticks"></a>Check for Ticks</h3><p>Some ticks spread disease, but D3’s ticks communicates information.</p><p>You can customize all aspects of your axes, starting with the rough number of ticks, using <code>ticks()</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> xAxis = d3.axisBottom().scale(xScale).ticks(<span class="number">6</span>) <span class="comment">// set rough # of ticks</span></span><br></pre></td></tr></table></figure><p>Specifying tick values manually</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> xAixs = d3.axisBottom().scale(xScale).tickValues([<span class="number">0</span>, <span class="number">100</span>, <span class="number">250</span>, <span class="number">700</span>])</span><br></pre></td></tr></table></figure><h3 id="Formatting-Tick-labels"><a href="#Formatting-Tick-labels" class="headerlink" title="Formatting Tick labels"></a>Formatting Tick labels</h3><p>Enter <code>tickFormat()</code>, which enables you to specify how your numbers should be formatted.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> formatAsPercentage = d3.format(<span class="string">&quot;.1%&quot;</span>)</span><br><span class="line">xAxis.tickFormat(formatAsPercentage)</span><br></pre></td></tr></table></figure><h1 id="Updates-Transtions-and-Motion"><a href="#Updates-Transtions-and-Motion" class="headerlink" title="Updates, Transtions, and Motion"></a>Updates, Transtions, and Motion</h1><blockquote><p>Transtion: .transition(), .duration()</p></blockquote><blockquote><p>Motion: .delay(), .ease()</p></blockquote><p>The argument could be number or function</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.transition()</span><br><span class="line">.delay(<span class="function">(<span class="params">d, i</span>) =&gt;</span> <span class="number">100</span> * i)</span><br><span class="line">.duration(<span class="number">300</span>)</span><br></pre></td></tr></table></figure><p>The default easing is <code>d3.easeCubicInOut</code>, which produces the gradual acceleration and deceleration.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.transition()</span><br><span class="line">.duration(<span class="number">3000</span>)</span><br><span class="line">.ease(d3.easeLinear)</span><br></pre></td></tr></table></figure><ul><li><p>d3.easeCircleIn</p></li><li><p>d3.easeElasticOut</p></li><li><p>d3.easeBounceOut</p></li></ul><h3 id="on-Transition-Starts-and-Ends"><a href="#on-Transition-Starts-and-Ends" class="headerlink" title="on() Transition Starts and Ends"></a>on() Transition Starts and Ends</h3><p>There will be times when you want to make something happen at the start or end of a transition. In those time you can use <code>on()</code> to execute arbitrary code for each element in the selection.</p><p><code>on()</code> expects two arguments:</p><ul><li><p>Either “start” or “end”</p></li><li><p>An anonymous function, to be executed either at the start of a transition, or as soon as it has ended.</p></li></ul><blockquote><p>Notice: Only one transition can be active on any given element at any given time.</p></blockquote><h3 id="Containing-Visual-Elements-With-Clipping-Paths"><a href="#Containing-Visual-Elements-With-Clipping-Paths" class="headerlink" title="Containing Visual Elements With Clipping Paths"></a>Containing Visual Elements With Clipping Paths</h3><p>SVG has support for <em>clipping paths</em>, which you might know as <em>masks</em> in many drawing tools.</p><p>Much like <code>g</code>, <code>clipPath</code> has no visual presence of its own, but it contains visual elements.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;clipPath id=<span class="string">&quot;chart-area&quot;</span>&gt;</span><br><span class="line">  &lt;rect x=<span class="string">&quot;30&quot;</span> y=<span class="string">&quot;30&quot;</span> width=<span class="string">&quot;410&quot;</span> height=<span class="string">&quot;240&quot;</span>&gt;&lt;/rect&gt;</span><br><span class="line">&lt;/clipPath&gt;</span><br></pre></td></tr></table></figure><p>Note that outer <code>clipPath</code> element has been given an ID of <code>chart-area</code>. We can use that ID to reference it later. Within the <code>clipPath</code> is a <code>rect</code>, which will function as the mask.</p><p>3 steps to using a clipping path:</p><ol><li><p>Define a <code>clipPath</code> and give it an ID</p></li><li><p>Put visual elements within the <code>clipPath</code> (usuallly just a <code>rect</code>, but this could be <code>circles</code> or any other visual elements)</p></li><li><p>Add a reference to the <code>clipPath</code> form whatever elements you wish to be masked.</p></li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">svg.append(<span class="string">&#x27;clipPath&#x27;</span>)</span><br><span class="line">  .attr(<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;chart-area&#x27;</span>) <span class="comment">// assign an id</span></span><br><span class="line">  .append(<span class="string">&#x27;rect&#x27;</span>) <span class="comment">// within the clippath, create new rect</span></span><br><span class="line">  .attr(<span class="string">&#x27;x&#x27;</span>, padding)</span><br><span class="line">  .attr(<span class="string">&#x27;y&#x27;</span>, padding)</span><br><span class="line">  .attr(<span class="string">&#x27;width&#x27;</span>, w - padding * <span class="number">2</span>)</span><br><span class="line">  .attr(<span class="string">&#x27;height&#x27;</span>, h - padding * <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">svg.append(<span class="string">&#x27;g&#x27;</span>)</span><br><span class="line">  .attr(<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;circles&#x27;</span>)</span><br><span class="line">  .attr(<span class="string">&#x27;clip-path&#x27;</span>, <span class="string">&#x27;url(#chart-area)&#x27;</span>)</span><br><span class="line">  .selectAll(<span class="string">&#x27;circle&#x27;</span>)</span><br><span class="line">  .data(dataset)</span><br><span class="line">  .enter()</span><br><span class="line">  .append(<span class="string">&#x27;circle&#x27;</span>)</span><br></pre></td></tr></table></figure><h1 id="Interactivity"><a href="#Interactivity" class="headerlink" title="Interactivity"></a>Interactivity</h1><p>D3 allows you to bind event listener to more than one element at a time.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">svg.selectAll(<span class="string">&#x27;rect&#x27;</span>)</span><br><span class="line">  .data(dataset)</span><br><span class="line">  .enter()</span><br><span class="line">  .append(<span class="string">&#x27;rect&#x27;</span>)</span><br><span class="line">  ....</span><br><span class="line">  .on(<span class="string">&#x27;click&#x27;</span>, <span class="function">(<span class="params">d</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><p>Within anonymous function , D3 automatically sets the context of <code>this</code>  so it references <code>current element upon which we are acting</code></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">svg</span> <span class="selector-tag">text</span> &#123;</span><br><span class="line">  <span class="attribute">pointer-event</span>: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>or</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svg.append(<span class="string">&#x27;text&#x27;</span>).style(<span class="string">&#x27;pointer-event&#x27;</span>, <span class="string">&#x27;none&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="Grouping-SVG-Element"><a href="#Grouping-SVG-Element" class="headerlink" title="Grouping SVG Element"></a>Grouping SVG Element</h3><p>Note that <code>g</code> group elements do not, by themselves, trigger any mouse events. The reason for this is that <code>g</code> elements have no pixels.</p><p>You can still bind event listener to <code>g</code> elements, just keep in mind that the elements within that <code>g</code> will then behave as a group. If any of the enclosed elements are clicked or moused over, then the listener function will be activated.</p><h3 id="Tooltips"><a href="#Tooltips" class="headerlink" title="Tooltips"></a>Tooltips</h3><p>In interactive visualizations, tooltips are small overlays that present data values. In many cases, it’s not necessary to label every individual data value in the default value, but that level of detail should still be accessible to users.</p><h4 id="SVG-Element-Tooltips"><a href="#SVG-Element-Tooltips" class="headerlink" title="SVG Element Tooltips"></a>SVG Element Tooltips</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">.on(<span class="string">&#x27;mouseover&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> xPosition = <span class="built_in">parseFloat</span>(d3.select(<span class="built_in">this</span>)).attr(<span class="string">&#x27;x&#x27;</span>) + xScale.bandWidth()</span><br><span class="line">  <span class="keyword">const</span> yPosition = <span class="built_in">parseFloat</span>(d3.select(<span class="built_in">this</span>)).attr(<span class="string">&#x27;y&#x27;</span>) + <span class="number">14</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// create the tooltip label</span></span><br><span class="line"></span><br><span class="line">svg.append(<span class="string">&#x27;text&#x27;</span>)</span><br><span class="line">  .attr(<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;tooltip&#x27;</span>)</span><br><span class="line">  .attr(<span class="string">&#x27;x&#x27;</span>, xPosition)</span><br><span class="line">  .attr(<span class="string">&#x27;y&#x27;</span>, yPosition)</span><br><span class="line">  .attr(<span class="string">&#x27;text-anchor&#x27;</span>, <span class="string">&#x27;middle&#x27;</span>)</span><br><span class="line">  .attr(<span class="string">&#x27;font-family&#x27;</span>, <span class="string">&#x27;sans-serif&#x27;</span>)</span><br><span class="line">  .attr(<span class="string">&#x27;font-size&#x27;</span>, <span class="string">&#x27;11px&#x27;</span>)</span><br><span class="line">  .attr(<span class="string">&#x27;font-weight&#x27;</span>, <span class="string">&#x27;bold&#x27;</span>)</span><br><span class="line">  .attr(<span class="string">&#x27;fill&#x27;</span>, <span class="string">&#x27;black&#x27;</span>)</span><br><span class="line">  .text(d)</span><br><span class="line"></span><br><span class="line">.on(<span class="string">&#x27;mouseout&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  d3.select(<span class="string">&#x27;#tooltip&#x27;</span>).remove()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="Using-Paths"><a href="#Using-Paths" class="headerlink" title="Using Paths"></a>Using Paths</h1><h3 id="Line-Charts"><a href="#Line-Charts" class="headerlink" title="Line Charts"></a>Line Charts</h3><h4 id="Scale-setup"><a href="#Scale-setup" class="headerlink" title="Scale setup"></a>Scale setup</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> xScale = d3.scaleTime()</span><br><span class="line">  .domain([</span><br><span class="line">    d3.min(dataset, <span class="function">(<span class="params">d</span>) =&gt;</span> d.date),</span><br><span class="line">    d3.max(dataset, <span class="function">(<span class="params">d</span>) =&gt;</span> da.date)</span><br><span class="line">  ])</span><br><span class="line">  .range([<span class="number">0</span>, w])</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> yScale = d3.scaleLinear()</span><br><span class="line">  .domain([</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    d3.max(dataset, <span class="function">(<span class="params">d</span>) =&gt;</span> d.avarage)</span><br><span class="line">  ])</span><br><span class="line">  .range([h, <span class="number">0</span>])</span><br></pre></td></tr></table></figure><p>Define a line generator</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> lineGen = d3.line()</span><br><span class="line">  .x(<span class="function"><span class="params">d</span> =&gt;</span> xScale(d.date))</span><br><span class="line">  .y(<span class="function"><span class="params">d</span> =&gt;</span> yScale(d.avarage))</span><br></pre></td></tr></table></figure><p>The x and y accessors tell the line generator how to decide <code>where</code> to place each point on the line.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> svg = d3.select(<span class="string">&#x27;body&#x27;</span>)</span><br><span class="line">  .append(<span class="string">&#x27;svg&#x27;</span>)</span><br><span class="line">  .attr(<span class="string">&#x27;width&#x27;</span>, w)</span><br><span class="line">  .attr(<span class="string">&#x27;height&#x27;</span>, h)</span><br><span class="line"></span><br><span class="line">svg.append(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line">  .datum(dataset)</span><br><span class="line">  .attr(<span class="string">&#x27;class&#x27;</span>, <span class="string">&#x27;line&#x27;</span>)</span><br><span class="line">  .attr(<span class="string">&#x27;d&#x27;</span>, lineGen)</span><br></pre></td></tr></table></figure><p>Instead of using <code>data()</code> to bind each value in our <code>dataset</code> array to a different element, we use <code>datum()</code>, the method for binding a <em>single</em> data value to a single element. The entire <code>dataset</code> array is bound to the new <code>path</code> we just created.</p><p>We set a <code>d</code> attribute, passing in our line generator function as an argument.</p><p>Since the data has already been bound to the <code>path</code>, the line generator simply grabs taht data. plots the pointers as we specified, and draws a line connecting them.</p><h3 id="Dealing-with-Missing-Data"><a href="#Dealing-with-Missing-Data" class="headerlink" title="Dealing with Missing Data"></a>Dealing with Missing Data</h3><p>Assume a -99.99 value is not a true measurement, namely one value is missed.</p><p><code>defined()</code> is just an configuration method, like <code>x()</code> and <code>y()</code>. If the result of its anonymous function is true, then that data value is included, or the value is excluded.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> lineGen = d3.line()</span><br><span class="line">  .defined(<span class="function"><span class="params">d</span> =&gt;</span> (d.avarage &gt; <span class="number">0</span>))</span><br><span class="line">  .x(<span class="function"><span class="params">d</span> =&gt;</span> x.date)</span><br><span class="line">  .y(<span class="function"><span class="params">d</span> =&gt;</span> x.avatarge)</span><br></pre></td></tr></table></figure><h3 id="Area-Charts"><a href="#Area-Charts" class="headerlink" title="Area Charts"></a>Area Charts</h3><p>Areas are not too different from lines. If a line is a series of connected (x, y) points, then an area is just that same line, plus a second such line (usually a flat baseline), with all the space in between filled in.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> area = d3.area()</span><br><span class="line">  .defined(<span class="function"><span class="params">d</span> =&gt;</span> (d.avarage &gt; <span class="number">0</span>))</span><br><span class="line">  .x(<span class="function"><span class="params">d</span> =&gt;</span> (xScale(d.date)))</span><br><span class="line">  .y0(<span class="function">() =&gt;</span> (yScale.range()[<span class="number">0</span>]))</span><br><span class="line">  .y1(<span class="function">(<span class="params">d</span>) =&gt;</span> (yScale(d.avarge)))</span><br></pre></td></tr></table></figure><p><code>y0</code> represents the area’s baseline, which <code>y1</code> represents the top.</p><h1 id="Selections"><a href="#Selections" class="headerlink" title="Selections"></a>Selections</h1><h3 id="A-Closer-Look-at-Selections"><a href="#A-Closer-Look-at-Selections" class="headerlink" title="A Closer Look at Selections"></a>A Closer Look at Selections</h3><p><img src="https://www.safaribooksonline.com/library/view/interactive-data-visualization/9781491921296/assets/dvw2_1201.png"></p><p><code>d3.select(&#39;body&#39;)</code> returns a <code>Selection</code>, which consists of <code>_groups</code> and <code>_parents</code></p><p>So a selection contains two arrays: <code>_groups</code> and <code>_parents</code></p><p><code>_groups</code> contains yet another array, which itself contains a list of elements – ony one in this case, <code>body</code>.</p><p>Let’s expand <code>body</code> and will see a lot of properties associated with <code>body</code>.</p><p>Selections are just very special objects generated and interpreted by D3. You will never manipulate a selection yourself – don’t bother trying to reach int <code>_groups</code> – as that’s what all of D3’s selection methods are for.</p><p><code>d3.select()</code> and <code>d3.selectAll()</code> operate at the page level, which means</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> allGroups = d3.selectAll(<span class="string">&#x27;g&#x27;</span>)</span><br></pre></td></tr></table></figure><p>The <code>select()</code> and <code>selectAll()</code> statements create <em>new</em> selections, and hand those new selections off to the subsequent methods.</p><p>To minimize the confusion from old and new selections, Mike Bostock recommends using an indentation convetion of four space when the selection is unchanged, but only two when a new selection is returned.</p><p><code>select()</code> and <code>append()</code> are methods that return new selections, <code>attr()</code> does not, but merely relays whatever selection it just acted on.</p><h3 id="Storing-Selections"><a href="#Storing-Selections" class="headerlink" title="Storing Selections"></a>Storing Selections</h3><p>Selections are immutable. All selection methods that affect which elements are selected (or their order) return a new selection rather tahn modifying the current selection.</p><p>That is, once you make a selection, you can’t modify it. You can only make a new one, which could be a subset of the original, and overwrite it.</p><h3 id="Enter-Merge-and-Exit"><a href="#Enter-Merge-and-Exit" class="headerlink" title="Enter, Merge and Exit"></a>Enter, Merge and Exit</h3><h3 id="Filter"><a href="#Filter" class="headerlink" title="Filter"></a>Filter</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">d3.select(<span class="string">&#x27;body&#x27;</span>).selectAll(<span class="string">&#x27;p&#x27;</span>)</span><br><span class="line">  .data(dataset)</span><br><span class="line">  .enter()</span><br><span class="line">  .append(<span class="string">&#x27;p&#x27;</span>)</span><br><span class="line">  .text(<span class="function"><span class="params">d</span> =&gt;</span> (<span class="string">&#x27;I can count up to &#x27;</span> + d))</span><br><span class="line">  .filter(<span class="function"><span class="params">d</span> =&gt;</span> (d &gt; <span class="number">15</span>))</span><br><span class="line">  .style(<span class="string">&#x27;color&#x27;</span>, <span class="string">&#x27;red&#x27;</span>)</span><br></pre></td></tr></table></figure><p><code>filter()</code> takes a selection and an anonymous function. If the function return <code>true</code> for a given element, then that element is included in the new selection returned by <code>filter()</code>.</p><h3 id="Each"><a href="#Each" class="headerlink" title="Each"></a>Each</h3><p>The most common purpose of creating a selection is to ultimately to modify it in some way, such as by using <code>attr()</code> or <code>style()</code>. But it can be useful to define your own functions, espectially for custom calculation or modifications that will be repeated.</p><p>We can use <code>each()</code> to run an arbitrary function once for each element in a selection. <code>each()</code> takes whatever selection it’s given and calls the specified function once for each item in the selection.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">selection.each(<span class="function">(<span class="params">d, i</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Some serious points to note:</p><ul><li><p>Since the <code>d</code> and <code>i</code> arguments are specified in the function definition, D3 will populate them for you.</p></li><li><p>The value of <code>this</code> will also be set by D3 to reflect <code>the element upon which we&#39;re currently acting</code>, So <code>d3.select(this)</code> will create a selection with whatever that element is.</p></li><li><p>In <code>delay()</code> or any other function within (d, i) =&gt; {}, we can reference the value <code>d</code>, and <code>i</code> directly, no need to write <code>(d, i)</code></p></li></ul><h1 id="Layouts"><a href="#Layouts" class="headerlink" title="Layouts"></a>Layouts</h1><p>Contrary to what the name implies, D3 <em>layouts</em> do not, in fact, lay anything out for you on the screen. The layout methods have no direct <em>visual</em> output. Rather, D3 layouts take data that you provided and remap or otherwise transform it, thereby generating <em>new</em> data that is more convenient for a specific visual task.</p><p>The list of D3 layouts includes:</p><ul><li><p>Chord</p></li><li><p>Cluster</p></li><li><p>Force</p></li><li><p>Pack</p></li><li><p>Partition</p></li><li><p>Pie</p></li><li><p>Stack</p></li><li><p>Tree</p></li><li><p>Treemap</p></li></ul><h3 id="Pie-Layout"><a href="#Pie-Layout" class="headerlink" title="Pie Layout"></a>Pie Layout</h3><p><code>d3.pie()</code> might not be as delicious as it sounds, but it’s still worthy of your attention. It is typically used to create a doughnut or pie chart.</p><p>Start with simple dataset</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> dataset = [ <span class="number">5</span>, <span class="number">10</span>, <span class="number">20</span>, <span class="number">45</span>, <span class="number">6</span>, <span class="number">25</span> ]</span><br></pre></td></tr></table></figure><p>Wd define a default pie layout</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pie = d3.pie()</span><br></pre></td></tr></table></figure><p>Then, all that remains is to hand off our data to the new <code>pie()</code> function, as in <code>pie(dataset)</code>.</p><p>The pie layout takes our simple array of numbers and generates an array of objects, one object for each value. Each of those objects now has a few new values – most important, <code>startAngle</code> and <code>endAngle</code>.</p><p>To actually draw the wedges, we turn to <code>d3.arc()</code>, a handy built-in function for drawing arcs as SVG <code>path</code> elements.</p><p>Arcs are defiend as custom functions, and they require inner and outer redius values.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> w = <span class="number">300</span></span><br><span class="line"><span class="keyword">const</span> h = <span class="number">300</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> outerRadius = w / <span class="number">2</span></span><br><span class="line"><span class="keyword">const</span> innerRadius = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> arc = d3.arc()</span><br><span class="line">  .innerRadius(innerRadius)</span><br><span class="line">  .outerRadius(outerRadius)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> svg = d3.select(<span class="string">&#x27;body&#x27;</span>)</span><br><span class="line">  .append(<span class="string">&#x27;svg&#x27;</span>)</span><br><span class="line">  .attr(<span class="string">&#x27;width&#x27;</span>, w)</span><br><span class="line">  .attr(<span class="string">&#x27;height&#x27;</span>, h)</span><br></pre></td></tr></table></figure><p>Then we can create new groups for each incoming wedge, binding the pie-ified data to the new elements, and translating each group into the center of the chart, so the <code>path</code>s will appear in the right place</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// set up groups</span></span><br><span class="line"><span class="keyword">const</span> arcs = svg.selectAll(<span class="string">&#x27;g.arc&#x27;</span>)</span><br><span class="line">  .data(pie(dataset))</span><br><span class="line">  .enter()</span><br><span class="line">  .append(<span class="string">&#x27;g&#x27;</span>)</span><br><span class="line">  .attr(<span class="string">&#x27;class&#x27;</span>, <span class="string">&#x27;arc&#x27;</span>)</span><br><span class="line">  .attr(<span class="string">&#x27;transform&#x27;</span>, <span class="string">&#x27;translate(&#x27;</span> + outerRadius + <span class="string">&#x27;, &#x27;</span> + outerRadius + <span class="string">&#x27;)&#x27;</span>)</span><br></pre></td></tr></table></figure><p>Note that we’re saving a reference to each newly created <code>g</code> in a variable called <code>arcs</code></p><p>Finally, within each new <code>g</code>, we append a <code>path</code>. A <code>path</code>‘s path description is defined in the <code>d</code> attribute. So we call the <code>arc</code> generator, which generates the path information based on the data already bound to this group.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// draw arc paths</span></span><br><span class="line">arcs.append(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line">  .attr(<span class="string">&#x27;fill&#x27;</span>, <span class="function">(<span class="params">d, i</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> colors(i)</span><br><span class="line">  &#125;)</span><br><span class="line">  .attr(<span class="string">&#x27;d&#x27;</span>, arc)</span><br></pre></td></tr></table></figure><p><code>arc</code> is our path generator function.</p><p>When a named function is specified as a parameter in this way, D3 automcatically passes in the datum and index values, without us having to write them out explicitly.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.attr(<span class="string">&#x27;d&#x27;</span>, arc)</span><br><span class="line"></span><br><span class="line"><span class="comment">// equivalent</span></span><br><span class="line"></span><br><span class="line">.attr(<span class="string">&#x27;d&#x27;</span>, <span class="function">(<span class="params">d, i</span>) =&gt;</span> (arc(d, i)))</span><br></pre></td></tr></table></figure><p>D3 has a number of handy ways to generate categorical colors</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> color = d3.scaleOrdinal(d3.schemeCategory10)</span><br></pre></td></tr></table></figure><p>Generate text labels for each wedge:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">arcs.append(<span class="string">&#x27;text&#x27;</span>)</span><br><span class="line">  .artr(<span class="string">&#x27;transform&#x27;</span>, <span class="function">(<span class="params">d</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;translate(&#x27;</span> + arc.centroid(d) + <span class="string">&#x27;)&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .attr(<span class="string">&#x27;text-anchor&#x27;</span>, <span class="string">&#x27;middle&#x27;</span>)</span><br><span class="line">  .text(<span class="function">(<span class="params">d</span>) =&gt;</span> &#123; <span class="keyword">return</span> d.value &#125;)</span><br></pre></td></tr></table></figure><p>A <em>centroid</em> is the calculated center point of any shape, whether that shape is regular(like a square) or highly irregular(like an outline of the state of Maryland).</p><p><code>arc.centroid()</code> is super-helpful function that calculates and returns the center point of any arc.</p><blockquote><p>Note: The pie layout automatically reordered out data values from largest to smallest.</p></blockquote><h3 id="Stack-Layout"><a href="#Stack-Layout" class="headerlink" title="Stack Layout"></a>Stack Layout</h3><p><code>d3.stack()</code> converts two-dimentional data into ‘stacked’ data.</p><p>It calculates a baseline value for each datum, so you can <code>stack</code> layers of data on top of one another.</p><p>Start with some data</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> dataset = [</span><br><span class="line">  &#123; <span class="attr">apples</span>: <span class="number">5</span>, <span class="attr">oranges</span>: <span class="number">10</span>, <span class="attr">grapes</span>: <span class="number">22</span> &#125;,</span><br><span class="line">true&#123; <span class="attr">apples</span>: <span class="number">4</span>, <span class="attr">oranges</span>: <span class="number">12</span>, <span class="attr">grapes</span>: <span class="number">28</span> &#125;,</span><br><span class="line">true&#123; <span class="attr">apples</span>: <span class="number">2</span>, <span class="attr">oranges</span>: <span class="number">19</span>, <span class="attr">grapes</span>: <span class="number">32</span> &#125;,</span><br><span class="line">true&#123; <span class="attr">apples</span>: <span class="number">7</span>, <span class="attr">oranges</span>: <span class="number">23</span>, <span class="attr">grapes</span>: <span class="number">35</span> &#125;,</span><br><span class="line">true&#123; <span class="attr">apples</span>: <span class="number">23</span>, <span class="attr">oranges</span>: <span class="number">17</span>, <span class="attr">grapes</span>: <span class="number">43</span> &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>The <code>dataset</code> is organized by <em>column</em>. The stack layout reconfigures the data to be organized by <em>categories</em>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Set up stack method</span></span><br><span class="line"><span class="keyword">const</span> stack = d3.stack().keys([<span class="string">&#x27;apples&#x27;</span>, <span class="string">&#x27;oranges&#x27;</span>, <span class="string">&#x27;grapes&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">// Data, stacked</span></span><br><span class="line"><span class="keyword">const</span> series = stack(dataset)</span><br></pre></td></tr></table></figure><p>Now <code>series</code> is an array with three values, each one itself an array corresponding to each categorical series: apples, oranges, and grapes(in that order because we specified as such in <code>keys()</code>)</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//&#x27;series&#x27;, the array formerly known as &#x27;dataset&#x27;</span></span><br><span class="line">[</span><br><span class="line">true[ [ <span class="number">0</span>,  <span class="number">5</span>], [ <span class="number">0</span>,  <span class="number">4</span>], [ <span class="number">0</span>,  <span class="number">2</span>], [ <span class="number">0</span>,  <span class="number">7</span>], [ <span class="number">0</span>, <span class="number">23</span>] ],  <span class="comment">// apples</span></span><br><span class="line">true[ [ <span class="number">5</span>, <span class="number">15</span>], [ <span class="number">4</span>, <span class="number">16</span>], [ <span class="number">2</span>, <span class="number">21</span>], [ <span class="number">7</span>, <span class="number">30</span>], [<span class="number">23</span>, <span class="number">40</span>] ],  <span class="comment">// oranges</span></span><br><span class="line">true[ [<span class="number">15</span>, <span class="number">37</span>], [<span class="number">16</span>, <span class="number">44</span>], [<span class="number">21</span>, <span class="number">53</span>], [<span class="number">30</span>, <span class="number">65</span>], [<span class="number">40</span>, <span class="number">83</span>] ]   <span class="comment">// grapes</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>To stack element visually, now we can reference each data object’s baseline and top line values.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Add a group for each row of data</span></span><br><span class="line"><span class="keyword">const</span> groups = svg.selectAll(<span class="string">&#x27;g&#x27;</span>)</span><br><span class="line">  .data(series)</span><br><span class="line">  .enter()</span><br><span class="line">  .append(<span class="string">&#x27;g&#x27;</span>)</span><br><span class="line">  .style(<span class="string">&#x27;fill&#x27;</span>, <span class="function">(<span class="params">di, i</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> colors(i)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add a rect for each data value</span></span><br><span class="line"><span class="keyword">const</span> rects = groups.selectAll(<span class="string">&#x27;rect&#x27;</span>)</span><br><span class="line">  .data(<span class="function">(<span class="params">d</span>) =&gt;</span> (d))</span><br><span class="line">  .enter()</span><br><span class="line">  .append(<span class="string">&#x27;rect&#x27;</span>)</span><br><span class="line">  .attr(<span class="string">&#x27;x&#x27;</span>, <span class="function">(<span class="params">d, i</span>) =&gt;</span> &#123;</span><br><span class="line">    retrun xScale(i)</span><br><span class="line">  &#125;)</span><br><span class="line">  .attr(<span class="string">&#x27;y&#x27;</span>, <span class="function">(<span class="params">d</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> ySclae(d[<span class="number">0</span>])</span><br><span class="line">  &#125;)</span><br><span class="line">  .attr(<span class="string">&#x27;height&#x27;</span>, <span class="function">(<span class="params">d</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> yScale(d[<span class="number">1</span>]-d[<span class="number">0</span>])</span><br><span class="line">  &#125;)</span><br><span class="line">  .attr(<span class="string">&#x27;width&#x27;</span>, xScale.bandWidth())</span><br></pre></td></tr></table></figure><p>Within each group, we select all the <code>rect</code>s and bind a subset of the data with this line</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.data(<span class="function">(<span class="params">d</span>) =&gt;</span> (d))</span><br></pre></td></tr></table></figure><h4 id="A-New-Order"><a href="#A-New-Order" class="headerlink" title="A New Order"></a>A New Order</h4><p>Unless otherwise specified, series will be stacked in the order specified in <code>keys()</code>.</p><p>But you can use <code>order()</code> to specify an alternate sequence to be applied before all the stacked values are calculated.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> stack = d3.stack()</span><br><span class="line">  .keys([ <span class="string">&#x27;apples&#x27;</span>, <span class="string">&#x27;oranges&#x27;</span>, <span class="string">&#x27;grapes&#x27;</span> ])</span><br><span class="line">  .order(d3.stackOrderDesending)</span><br></pre></td></tr></table></figure><ul><li><p>d3.stackOrderNone</p></li><li><p>d3.stackOrderReverse</p></li><li><p>d3.stackOrderAscending</p></li><li><p>d3.stackOrderDescending</p></li></ul><h3 id="Stacked-Areas"><a href="#Stacked-Areas" class="headerlink" title="Stacked Areas"></a>Stacked Areas</h3><p>This can be a valuable way to represent time series data, when a sum total is derived from several related categories.</p><h3 id="Force-Layout"><a href="#Force-Layout" class="headerlink" title="Force Layout"></a>Force Layout</h3><p>Force-directed layouts are so-called because they use simulations of physical <em>force</em> to arrange elements on the screen.</p><p>Force layouts are typically used with network data. In computer science, this kind of dataset is called a <code>graph</code>. A simple graph is a list of <code>node</code> and <code>edge</code>. The nodes are entities in the dataset, and the edges are the <code>connection</code>s between nodes. Some nodes will be connected by edges and others won’t.</p><p>Nodea are commonly represented as circles and edges as lines.</p><p>The physical metaphor here is of particles that repel each other, yet are also connected by strings.  The repelling forces push particles away from each other, preventing visual overlap, and the strings prevent them from just flying out into space, thereby keeping them on the screen where we can see them.</p><h4 id="Preparing-the-network-data"><a href="#Preparing-the-network-data" class="headerlink" title="Preparing the network data"></a>Preparing the network data</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> dataset = &#123;</span><br><span class="line">truenodes: [</span><br><span class="line">truetrue&#123; <span class="attr">name</span>: <span class="string">&quot;Adam&quot;</span> &#125;,</span><br><span class="line">truetrue&#123; <span class="attr">name</span>: <span class="string">&quot;Bob&quot;</span> &#125;,</span><br><span class="line">truetrue&#123; <span class="attr">name</span>: <span class="string">&quot;Carrie&quot;</span> &#125;,</span><br><span class="line">truetrue&#123; <span class="attr">name</span>: <span class="string">&quot;Donovan&quot;</span> &#125;,</span><br><span class="line">truetrue&#123; <span class="attr">name</span>: <span class="string">&quot;Edward&quot;</span> &#125;,</span><br><span class="line">truetrue&#123; <span class="attr">name</span>: <span class="string">&quot;Felicity&quot;</span> &#125;,</span><br><span class="line">truetrue&#123; <span class="attr">name</span>: <span class="string">&quot;George&quot;</span> &#125;,</span><br><span class="line">truetrue&#123; <span class="attr">name</span>: <span class="string">&quot;Hannah&quot;</span> &#125;,</span><br><span class="line">truetrue&#123; <span class="attr">name</span>: <span class="string">&quot;Iris&quot;</span> &#125;,</span><br><span class="line">truetrue&#123; <span class="attr">name</span>: <span class="string">&quot;Jerry&quot;</span> &#125;</span><br><span class="line">true],</span><br><span class="line">trueedges: [</span><br><span class="line">truetrue&#123; <span class="attr">source</span>: <span class="number">0</span>, <span class="attr">target</span>: <span class="number">1</span> &#125;,</span><br><span class="line">truetrue&#123; <span class="attr">source</span>: <span class="number">0</span>, <span class="attr">target</span>: <span class="number">2</span> &#125;,</span><br><span class="line">truetrue&#123; <span class="attr">source</span>: <span class="number">0</span>, <span class="attr">target</span>: <span class="number">3</span> &#125;,</span><br><span class="line">truetrue&#123; <span class="attr">source</span>: <span class="number">0</span>, <span class="attr">target</span>: <span class="number">4</span> &#125;,</span><br><span class="line">truetrue&#123; <span class="attr">source</span>: <span class="number">1</span>, <span class="attr">target</span>: <span class="number">5</span> &#125;,</span><br><span class="line">truetrue&#123; <span class="attr">source</span>: <span class="number">2</span>, <span class="attr">target</span>: <span class="number">5</span> &#125;,</span><br><span class="line">truetrue&#123; <span class="attr">source</span>: <span class="number">2</span>, <span class="attr">target</span>: <span class="number">5</span> &#125;,</span><br><span class="line">truetrue&#123; <span class="attr">source</span>: <span class="number">3</span>, <span class="attr">target</span>: <span class="number">4</span> &#125;,</span><br><span class="line">truetrue&#123; <span class="attr">source</span>: <span class="number">5</span>, <span class="attr">target</span>: <span class="number">8</span> &#125;,</span><br><span class="line">truetrue&#123; <span class="attr">source</span>: <span class="number">5</span>, <span class="attr">target</span>: <span class="number">9</span> &#125;,</span><br><span class="line">truetrue&#123; <span class="attr">source</span>: <span class="number">6</span>, <span class="attr">target</span>: <span class="number">7</span> &#125;,</span><br><span class="line">truetrue&#123; <span class="attr">source</span>: <span class="number">7</span>, <span class="attr">target</span>: <span class="number">8</span> &#125;,</span><br><span class="line">truetrue&#123; <span class="attr">source</span>: <span class="number">8</span>, <span class="attr">target</span>: <span class="number">9</span> &#125;</span><br><span class="line">true]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="Defining-the-Force-Simulation"><a href="#Defining-the-Force-Simulation" class="headerlink" title="Defining the Force Simulation"></a>Defining the Force Simulation</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Initialize a simple force layout, using the nodes and edges in dataset</span></span><br><span class="line"><span class="keyword">const</span> layout = d3.forceSimulation(dataset.nodes)</span><br><span class="line">  .force(<span class="string">&#x27;charge&#x27;</span>, d3.forceManyBody())</span><br><span class="line">  .force(<span class="string">&#x27;link&#x27;</span>, d3.forceLink(dataset.edges))</span><br><span class="line">  .force(<span class="string">&#x27;center&#x27;</span>, d3.forceCenter().x(w/<span class="number">2</span>).y(h/<span class="number">2</span>))</span><br></pre></td></tr></table></figure><p>Call <code>d3.forceSimulation()</code> and pass in a reference to the nodes. This will generate a new simulator and automatically start running it, but without any forces applied, it won’t be very interesting.</p><p>To create force, call <code>force()</code> as many times as you like, each time specifying an arbitrary name for each force(in case you want to reference it later) and the name of a force function.</p><ul><li><p><code>d3.forceManyBody()</code>: Create a <em>many-body</em> force which acts on <strong>all</strong> nodes, meaning this can be used to either attract all nodes to each other or repel all nodes from each other. Try different <code>strength()</code> values, and see what happens. The default <code>strength()</code> is -30, so we will see a slight repelling force.</p></li><li><p><code>d3.forceLink()</code>: Our nodes are connected by edges, so we apply this force, specifying <code>dataset.edges</code>. Specify a target <code>distance()</code> (the default is 30 pixles), and this force will struggle agains any competing forces to achieve that distance.</p></li><li><p><code>d3.forceCenter()</code>: This force centers the entire simulation around whatever point you specify with <code>x()</code> and <code>y()</code>.</p></li></ul><h4 id="Creating-the-Visual-Elements"><a href="#Creating-the-Visual-Elements" class="headerlink" title="Creating the Visual Elements"></a>Creating the Visual Elements</h4><p>After defining our force simulation, we proceed to generate visual elements.</p><p>First we create a line for each edge:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create edges as lines</span></span><br><span class="line"><span class="keyword">const</span> edges = svg.selectAll(<span class="string">&#x27;line&#x27;</span>)</span><br><span class="line">  .data(dataset.edges)</span><br><span class="line">  .enter()</span><br><span class="line">  .append(<span class="string">&#x27;line&#x27;</span>)</span><br><span class="line">  .style(<span class="string">&#x27;stroke&#x27;</span>, <span class="string">&#x27;#ccc&#x27;</span>)</span><br><span class="line">  .style(<span class="string">&#x27;stroke-width&#x27;</span>, <span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>Then create a circle for each node:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> nodes = svg.selectAll(<span class="string">&#x27;circle&#x27;</span>)</span><br><span class="line">  .data(dataset.nodes)</span><br><span class="line">  .enter()</span><br><span class="line">  .append(<span class="string">&#x27;circle&#x27;</span>)</span><br><span class="line">  .attr(<span class="string">&#x27;r&#x27;</span>, <span class="number">10</span>)</span><br><span class="line">  .style(<span class="string">&#x27;fill&#x27;</span>, <span class="function">(<span class="params">d, i</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> colors(i)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><p>Add simple tooltip:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Add a simple tooltip</span></span><br><span class="line"></span><br><span class="line">nodes.append(<span class="string">&#x27;title&#x27;</span>)</span><br><span class="line">  .text(<span class="function">(<span class="params">d</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> d.name</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><h4 id="Updating-Visuals-Over-Time"><a href="#Updating-Visuals-Over-Time" class="headerlink" title="Updating Visuals Over Time"></a>Updating Visuals Over Time</h4><p>D3’s force simulation ‘ticks’ forward through time, just like every other physics simulation. With each tick, the simulation adjusts the position values for each node and edge according to the rules we specified when the layout was first initialized. To see this progress visually, we need to update the associated elements – the lines and circles – on every tick.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Every time the simulation &#x27;ticks&#x27;, this will be called</span></span><br><span class="line">force.on(<span class="string">&#x27;tick&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  edges.attr(<span class="string">&#x27;x1&#x27;</span>, <span class="function"><span class="params">d</span> =&gt;</span> (d.source.x))</span><br><span class="line">    .attr(<span class="string">&#x27;y1&#x27;</span>, <span class="function"><span class="params">d</span> =&gt;</span> (d.source.y))</span><br><span class="line">    .attr(<span class="string">&#x27;x2&#x27;</span>, <span class="function"><span class="params">d</span> =&gt;</span> (d.target.x))</span><br><span class="line">    .attr(<span class="string">&#x27;y2&#x27;</span>, <span class="function"><span class="params">d</span> =&gt;</span> (d.target.y))</span><br><span class="line"></span><br><span class="line">  nodes.attr(<span class="string">&#x27;cx&#x27;</span>, <span class="function"><span class="params">d</span> =&gt;</span> (d.x))</span><br><span class="line">    .attr(<span class="string">&#x27;cy&#x27;</span>, <span class="function"><span class="params">d</span> =&gt;</span> (d.y))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>This tells D3, ‘Ok, every time you tick, take the new (x, y) values for each line and circle and update them in the DOM’</p><p>Here the (x, y) are calculated and appeded by D3.</p><h4 id="Draggable-Nodes"><a href="#Draggable-Nodes" class="headerlink" title="Draggable Nodes"></a>Draggable Nodes</h4><p>Add the <code>call()</code> statement to our <code>Nodes</code>:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.cal(d3.drag()</span><br><span class="line">  .on(<span class="string">&#x27;start&#x27;</span>, dragStarted)</span><br><span class="line">  .on(<span class="string">&#x27;drag&#x27;</span>, dragging)</span><br><span class="line">  .on(<span class="string">&#x27;end&#x27;</span>, dragEnded))</span><br></pre></td></tr></table></figure><p>This bit code ‘calls’ the <code>d3.drag()</code> method on each node.</p><p><code>d3.drag()</code>, in turn, sets event listeners for the three drag-related events, and specifies functions to trigger whenever one of those events occurs.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dragStarted</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!d3.event.active) force.alphaTarget(<span class="number">0.3</span>).restart()</span><br><span class="line">  d.fx = d.x</span><br><span class="line">  d.fy = d.y</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dragging</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">  d.fx = d3.event.x</span><br><span class="line">  d.fy = d3.event.y</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dragEnded</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!d3.event.active) force.alphaTarget(<span class="number">0</span>)</span><br><span class="line">  d.fx = <span class="literal">null</span></span><br><span class="line">  d.fy = <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Geomapping"><a href="#Geomapping" class="headerlink" title="Geomapping"></a>Geomapping</h1><p>…</p>]]></content>
      
      
      
        <tags>
            
            <tag> D3 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Simple Usage of SW</title>
      <link href="/2017/07/01/Simple-usage-of-SW/"/>
      <url>/2017/07/01/Simple-usage-of-SW/</url>
      
        <content type="html"><![CDATA[<h1 id="Register"><a href="#Register" class="headerlink" title="Register"></a>Register</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">navigator.serviceWorker.register(<span class="string">&#x27;your_service_worker,js&#x27;</span>, &#123; <span class="attr">scope</span>: <span class="string">&#x27;your_path_name&#x27;</span> &#125;)</span><br><span class="line">.then(<span class="function">(<span class="params">worker</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;[SW] Registration succeeded.&#x27;</span>)</span><br><span class="line">&#125;).catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;[SW] Registration failed with &#x27;</span> + err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="Unregister"><a href="#Unregister" class="headerlink" title="Unregister"></a>Unregister</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">navigator.serviceWorker.getRegistration(<span class="string">&#x27;your_service_worker.js&#x27;</span>, &#123; <span class="attr">scope</span>: <span class="string">&#x27;your_path_name&#x27;</span> &#125;)</span><br><span class="line">.then(<span class="function">(<span class="params">worker</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (worker &amp;&amp; worker.unregister) &#123;</span><br><span class="line">    worker.unregister()</span><br><span class="line">    .then(<span class="function">(<span class="params">isUnregistered</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (isUnregistered) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;[SW] Unregister succeeded&#x27;</span>)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;[SW] Unregister failed&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">.catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;[SW] Unregister failed with &#x27;</span> + err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="Worker-js"><a href="#Worker-js" class="headerlink" title="Worker.js"></a>Worker.js</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">self.addEventListener(<span class="string">&#x27;install&#x27;</span>, <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;[Worker] installing&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">self.addEventListener(<span class="string">&#x27;activate&#x27;</span>, <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;[Worker] ready&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">self.addEventListener(<span class="string">&#x27;fetch&#x27;</span>, <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(event.request.url)</span><br><span class="line">  <span class="keyword">return</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="LifeCycle"><a href="#LifeCycle" class="headerlink" title="LifeCycle"></a>LifeCycle</h1><p><img src="http://foio.github.io/images/sw-lifecycle.png"></p><h1 id="Download-and-Parse"><a href="#Download-and-Parse" class="headerlink" title="Download and Parse"></a>Download and Parse</h1><p>After registration of Service Worker, browser will download and parse the script from specified url.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* In main.js */</span></span><br><span class="line"><span class="keyword">if</span> (<span class="string">&#x27;serviceWorker&#x27;</span> <span class="keyword">in</span> navigator) &#123;</span><br><span class="line">  navigator.serviceWorker.register(<span class="string">&#x27;./sw.js&#x27;</span>)</span><br><span class="line">  .then(<span class="function">(<span class="params">worker</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Service Worker Registered&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Service Worker Failed to Register&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Installing"><a href="#Installing" class="headerlink" title="Installing"></a>Installing</h1><p>After successfully parsed, browser will install the Service Worker. Once the Install finished, the worker will emit <code>install</code> event, and waiting for <code>activating</code>. If the install failed, Service Worker will be <code>Redundant</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* In sw.js */</span></span><br><span class="line">self.addEventListener(<span class="string">&#x27;install&#x27;</span>, <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">  event.waitUntil(</span><br><span class="line">    caches.open(currentCacheName)</span><br><span class="line">    .then(<span class="function">(<span class="params">cache</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> cache.addAll(arrayOfFilesToCache)</span><br><span class="line">    &#125;)</span><br><span class="line">  )</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>If there is an <code>event.waitUntil(promiseObj)</code> method in the event, the installing event will not be successful until the Promise within it is solved. If the Promise is rejected, the install event fails and the Service Worker became <strong>redundant</strong></p><h1 id="Installed-Waiting"><a href="#Installed-Waiting" class="headerlink" title="Installed / Waiting"></a>Installed / Waiting</h1><p>If the installation is successful, the Service Worker moves to the <strong>installed</strong>(also called <strong>waiting</strong>) state. In this state it is a valid, but not yet active, worker. It is not yet in control of the document., but rather is waiting to take control form the current worker.</p><h1 id="Activating"><a href="#Activating" class="headerlink" title="Activating"></a>Activating</h1><p>The <strong>activating</strong> state will be triggered for a waiting Service Worker in one of the following scenarios -</p><ul><li><p>if there is no current active worker already</p></li><li><p>if the <code>self.skipWaiting()</code> method is called in the Service Worker script</p></li><li><p>if the user has navigated away from the page, thereby releasing the previous active worker.</p></li><li><p>if a specified period of time has passed, thereby releasing the previous active worker</p></li></ul><p>During the activating state, the <strong>active</strong> event in the Service Worker script is carried out. In a typical activate event, we clear files from old caches.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* In sw.js */</span></span><br><span class="line">self.addEventListener(<span class="string">&#x27;activate&#x27;</span>, <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">  event.waitUntil(</span><br><span class="line">    <span class="comment">// get all the cache names</span></span><br><span class="line">    caches.keys().then(<span class="function">(<span class="params">cacheNames</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.all(</span><br><span class="line">        cacheNames.filter(<span class="function">(<span class="params">cacheName</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">        &#125;)</span><br><span class="line">      )</span><br><span class="line">    &#125;)</span><br><span class="line">  )</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="Activate"><a href="#Activate" class="headerlink" title="Activate"></a>Activate</h1><p>If the worker is activated, it will emit <code>active</code> event, and take over all fetch from page. If active failed, the worker will be <code>Redundant</code></p><h1 id="Redundant"><a href="#Redundant" class="headerlink" title="Redundant"></a>Redundant</h1><p>Once a worker is redundant, it won’t have effect on page.</p><h1 id="Dependencies"><a href="#Dependencies" class="headerlink" title="Dependencies"></a>Dependencies</h1><ul><li><p>fetch</p></li><li><p>promise</p></li><li><p>CacheStorage: store Cache Object</p></li><li><p>Cache: store Request/Response Pair Object</p></li></ul><p><img src="http://foio.github.io/images/sw-cache-storage.png"></p><h1 id="Example-Cache-Static-Resource"><a href="#Example-Cache-Static-Resource" class="headerlink" title="Example: Cache Static Resource"></a>Example: Cache Static Resource</h1><ul><li><p>listen to install to cache static resource</p></li><li><p>listen to fetch to intercept request and return cached static Resource</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> CACHE_NAME = <span class="string">&#x27;my-site-cache-v1&#x27;</span></span><br><span class="line"><span class="keyword">var</span> urlsToCache = [</span><br><span class="line">  <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;/styles/main.css&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;/script/main.js&#x27;</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">// cache resource after installation</span></span><br><span class="line">self.addEventListener(<span class="string">&#x27;install&#x27;</span>, <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// perform install steps</span></span><br><span class="line">  event.waitUntil(</span><br><span class="line">    caches.open(CACHE_NAME)</span><br><span class="line">    .then(<span class="function">(<span class="params">cache</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;Opened Cache&#x27;</span>)</span><br><span class="line">      <span class="keyword">return</span> cache.addAll(urlsToCache)</span><br><span class="line">    &#125;)</span><br><span class="line">  )</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// listen to fetch, use cache if cached</span></span><br><span class="line">self.addEventListener(<span class="string">&#x27;fetch&#x27;</span>, <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">  event.responseWith(</span><br><span class="line">    caches.match(event.request)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (response) &#123;</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> fetch(event.request)</span><br><span class="line">    &#125;)</span><br><span class="line">  )</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="Version-Controls"><a href="#Version-Controls" class="headerlink" title="Version Controls"></a>Version Controls</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> deleteObsoleteCache = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> caches.keys().then(<span class="function">(<span class="params">keys</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> all = keys.map(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (key.indexOf(CACHE_PREFIX) !== <span class="number">-1</span> &amp;&amp; key.indexOf(CACHE_VERSION) === <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;[SW] Delete cache: &#x27;</span> + key)</span><br><span class="line">        <span class="keyword">return</span> caches.delete(key)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.all(all)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Whitelist"><a href="#Whitelist" class="headerlink" title="Whitelist"></a>Whitelist</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// resource whitelist</span></span><br><span class="line"><span class="keyword">const</span> allAssets = [</span><br><span class="line">  <span class="string">&#x27;//your.cdn.com/app.css&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;//your.cdn.com/app.js&#x27;</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">// match</span></span><br><span class="line"><span class="keyword">const</span> matchAssets = <span class="function">(<span class="params">requestUrl</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> urlObj = <span class="keyword">new</span> URL(requestUrl)</span><br><span class="line">  <span class="keyword">const</span> noProtocolUrl = urlObj.href.substr(urlObj.protocol.length)</span><br><span class="line">  <span class="keyword">if</span> (allAssets.includes(noProtocolUrl)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// listen to fetch, proxy fetch matching Whitelist</span></span><br><span class="line">self.addEventListener(<span class="string">&#x27;fetch&#x27;</span>, <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> requestUrl = event.target.url</span><br><span class="line">    <span class="keyword">const</span> isGet = event.request.method === <span class="string">&#x27;GET&#x27;</span></span><br><span class="line">    <span class="keyword">const</span> assetMatches = matchAssets(requestUrl)</span><br><span class="line">    <span class="keyword">if</span> (!assetMatches || !isGet) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> resource = cacheFirstResponse(event)</span><br><span class="line">    event.responseWith(resource)</span><br><span class="line">  &#125; cache (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;[SW] handle fetch event error&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Service Worker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Glossary of Terms on InfluxDB</title>
      <link href="/2017/07/01/Glossary-of-Terms-on-InfluxDB/"/>
      <url>/2017/07/01/Glossary-of-Terms-on-InfluxDB/</url>
      
        <content type="html"><![CDATA[<h1 id="aggregation"><a href="#aggregation" class="headerlink" title="aggregation"></a>aggregation</h1><p>An InfluxQL function that returns an aggregated value across a set of points</p><h1 id="batch"><a href="#batch" class="headerlink" title="batch"></a>batch</h1><p>A collection of points in line protocol format, separated by newlines(0x0A). A batch of points may be submitted to the database using a single HTTP request to the write endpoint. This makes writes via the HTTP API much more performant by drastically reducting the HTTP overhead. InfluxData recommends batch size of 5,000-10,000 points, although different use cases may be better served by significantly smaller or larger batches.</p><h1 id="continuous-query-CQ"><a href="#continuous-query-CQ" class="headerlink" title="continuous query(CQ)"></a>continuous query(CQ)</h1><p>An InfluxQL query that runs automatically and periodically within a database. Continuous queries require a function in the <code>SELECT</code> clause and must include a <code>GROUP BY time()</code> clause.</p><h1 id="database"><a href="#database" class="headerlink" title="database"></a>database</h1><p>A logical container for users, retention policies, continuous queries, and time series data.</p><h1 id="duration"><a href="#duration" class="headerlink" title="duration"></a>duration</h1><p>The attribute of the retention policy that determines how long InfluxDB stores data. Data older than the duration are automatically dropped from the database.</p><h1 id="field"><a href="#field" class="headerlink" title="field"></a>field</h1><p>The key-value pair in InfluxDB’s data structure that records metadata and the actual data value. Fields are required in InfluxDB’s data structure and they are not indexed - queries on field values scan all points that match the specified time range and , as a result, are not performant relative to tags.</p><blockquote><p>Query tip: Compare fields to tags: tags are indexed</p></blockquote><h1 id="field-key"><a href="#field-key" class="headerlink" title="field key"></a>field key</h1><p>The key part of the key-value pair that makes up a field. Field keys are strings and they store metadata.</p><h1 id="field-set"><a href="#field-set" class="headerlink" title="field set"></a>field set</h1><p>The collection of field keys and field values on a point.</p><h1 id="field-value"><a href="#field-value" class="headerlink" title="field value"></a>field value</h1><p>The value part of the key-value pair that makes up a field. Field values are the actual data: they can be strings, floats, integers, or booleans. A field value is always associated with a timestamp.</p><p>Field values are not indexed - queries on field values scan all points that match the specified time range and, as a result, are not performant.</p><h1 id="function"><a href="#function" class="headerlink" title="function"></a>function</h1><p>InfluxQL aggregation, selectors, and transformations.</p><h1 id="identifier"><a href="#identifier" class="headerlink" title="identifier"></a>identifier</h1><p>Tokens that refer to continuous query names, database names, field keys, measurement names, retention policy names, subscription names, tag keys and user names.</p><h1 id="line-protocol"><a href="#line-protocol" class="headerlink" title="line protocol"></a>line protocol</h1><p>The text based format for writing points to InfluxDB.</p><h1 id="measurement"><a href="#measurement" class="headerlink" title="measurement"></a>measurement</h1><p>The part of InfluxDB’s structure that describes the data stored in the associated fields. Measurements are strings.</p><h1 id="metastore"><a href="#metastore" class="headerlink" title="metastore"></a>metastore</h1><p>Contains internal information about the status of the system. The metastore contains the user information, databse, retention policies, shard metadata, continuous queries, and subscriptions.</p><h1 id="node"><a href="#node" class="headerlink" title="node"></a>node</h1><p>An independent <code>influxd</code> process</p><h1 id="now"><a href="#now" class="headerlink" title="now()"></a>now()</h1><p>The local server’s nanosecond timestamp</p><h1 id="point"><a href="#point" class="headerlink" title="point"></a>point</h1><p>The part of InfluxDB’s data structure taht consists of a single collection of fields in a series. Each point is uniquely idenfified by its series and timestamp.</p><p>You cannot store more than one point with the same timestamp in the same series. Instead, when you write a new point to the same series with the same timestamp as an existing point in that series, the field set becomes the union of the old field set and the new field set, where any ties tgo to the new field set.</p><h1 id="query"><a href="#query" class="headerlink" title="query"></a>query</h1><p>An operation that retrieves data from InfluxDB.</p><h1 id="replication-factor"><a href="#replication-factor" class="headerlink" title="replication factor"></a>replication factor</h1><p>The attribute of the retention policy that determines how many copies of the data are stored <strong>in the cluster</strong>.</p><blockquote><p>Replication factors do not seve a purpose with single node instances.</p></blockquote><h1 id="retention-policy-RP"><a href="#retention-policy-RP" class="headerlink" title="retention policy (RP)"></a>retention policy (RP)</h1><p>The part of InfluxDB’s data structure that describes for how long InfluxDB keeps data(ducation), how many copies of those data are stored in the cluster(<strong>replication factor</strong>), and the time range covered by shard groups(shard group duration). RPs are unique per databse and along with the measurement and tag set define a series.</p><p>When you create a database, InfluxDB automatically creates a retention policy called <code>autogen</code> with an infinite duration, a replication factor set to one, and a shard group duration set to seven days.</p><h1 id="schema"><a href="#schema" class="headerlink" title="schema"></a>schema</h1><p>How the data are organized in InfluxDB. The fundamentals of the InfluxDB schema are database, retention policies, series, measurements, tag keys, tag values, and field keys.</p><h1 id="selector"><a href="#selector" class="headerlink" title="selector"></a>selector</h1><p>An InfluxQL function that returns a single point from the range of specified points.</p><h1 id="series"><a href="#series" class="headerlink" title="series"></a>series</h1><p>The collection of data in InfluxDB’s data structure that share a measurement, tag set and retention policy.</p><blockquote><p>The field set is not part of the series identification.</p></blockquote><h1 id="series-cardinality"><a href="#series-cardinality" class="headerlink" title="series cardinality"></a>series cardinality</h1><p>The number of unique database, measurement, and tag set combinations in an InfluxDB instance.</p><p>For example, assume that an InfluxDB instance has a single database and one measurement. The single measurement has two tag keys: <code>email</code> and <code>status</code>. If there are three different <code>email</code>s, and each email address is associated with two different <code>status</code>, then the series cardinality for the measurement is 6.</p><p>Note that, in some cases, simply performing that multiplication may overestimate series cardinality because of the presence of dependent tags.</p><h1 id="server"><a href="#server" class="headerlink" title="server"></a>server</h1><p>A machine virtual or physical, that is running InfluxDB. There should only be one InfluxDB process per server.</p><h1 id="shard"><a href="#shard" class="headerlink" title="shard"></a>shard</h1><p>A shard contains the actual encoded and compressed data, and is represented by a TSM file on disk. Every shard belongs to one and only one shard group. Multiple shards may exist in a single shard group. Each shard contains a specific set of series. All points falling on a given series in a given shard group will be stored in the same shard(TSM file) on disk.</p><h1 id="shard-duration"><a href="#shard-duration" class="headerlink" title="shard duration"></a>shard duration</h1><p>The shard duration determines hwo much time each shard group spans. The specific interval is determined by the <code>SHARD DURATION</code> of the retention policy.</p><p>For example, given a retention policy with <code>SHARD DURATION</code> set to <code>1w</code>, each shard group will span a single week and contain all points with timestamps in that week.</p><h1 id="shard-group"><a href="#shard-group" class="headerlink" title="shard group"></a>shard group</h1><p>Shard groups are logical container for shards. Shard groups are organized by <strong>time and retention policy</strong>. Every retention policy that contains data has at least one associated shard group. A given shard group contains all shards with data for the interval covered by the shard group. The interval spanned by each shard group is the shard duration.</p><h1 id="subscription"><a href="#subscription" class="headerlink" title="subscription"></a>subscription</h1><p>Subscription allows <code>Kapacitor</code> to receive data from InfluxDB in a push model rather than the pull model based on querying data. When Kapacitor is configured to work with InfluxDB, the subscription will automatically push every write for the subscribed databse form InfluxDB to Kapacitor. Subscription can use TCP or UDP for transmitting the writes.</p><h1 id="tag"><a href="#tag" class="headerlink" title="tag"></a>tag</h1><p>The key-value pair in InfluxDB’s data structure that records metadata. Tags are an optional part of InfluxDB’s data structure but they are useful for storing commonly-queried metadata; tags are indexed so queries on tags are performant</p><h1 id="tag-key"><a href="#tag-key" class="headerlink" title="tag key"></a>tag key</h1><p>The key part of the key-value pair that makes up a tag. Tag keys are strings and they store metadata. Tag keys are indexed so queires on tag keys are performant.</p><h1 id="tag-set"><a href="#tag-set" class="headerlink" title="tag set"></a>tag set</h1><p>The collection of tag keys and tag values on a point.</p><h1 id="tag-value"><a href="#tag-value" class="headerlink" title="tag value"></a>tag value</h1><p>The value part of the key-value pair that makes up a tag. Tag values are strings and they store metadata. Tag values are indexed so queries on tag values are performant.</p><h1 id="timestamp"><a href="#timestamp" class="headerlink" title="timestamp"></a>timestamp</h1><p>The date and time associated with a point. All time in influxDB is UTC.</p><h1 id="transformation"><a href="#transformation" class="headerlink" title="transformation"></a>transformation</h1><p>An InfluxQl function that returns a value or a set of values calculated from specified points, but does not return an aggregated value across those points.</p><h1 id="tsm-Time-Structured-Merge-Tree"><a href="#tsm-Time-Structured-Merge-Tree" class="headerlink" title="tsm (Time Structured Merge Tree)"></a>tsm (Time Structured Merge Tree)</h1><p>The purpose-built data storage format for InfluxDB. TSM allows for greater compaction and higher write and read throughput than exsiting B+ or LSM tree implementations.</p><h1 id="user"><a href="#user" class="headerlink" title="user"></a>user</h1><p>There are two kinds of users in InfluxDB:</p><ul><li><p><em>Admin users</em> have <code>READ</code> and <code>WRITE</code> access to all database and full across to administrative queries and user management commands.</p></li><li><p><em>Non-admin users</em> have <code>READ</code>, <code>WRITE</code>, or <code>ALT</code> (both <code>READ</code>, <code>WRITE</code>) access to per database.</p></li></ul><p>When authentication is enabled, InfluxDB only executes HTTP requests that are spent with a valid username and password.</p><h1 id="values-per-second"><a href="#values-per-second" class="headerlink" title="values per second"></a>values per second</h1><p>The preferred measurement of the rate at which data are persisted to InfluxDB. Write speeds are generally quoted in values per second.</p>]]></content>
      
      
      
        <tags>
            
            <tag> Database </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>APIs of InfluxDB</title>
      <link href="/2017/06/30/APIs-of-InfluxDB/"/>
      <url>/2017/06/30/APIs-of-InfluxDB/</url>
      
        <content type="html"><![CDATA[<p>The InfluxDB API provides a simple way interact with the database. It uses HTTP response codes, HTTP authentication, JWT Token, and basic authentication and responses are returned in JSON.</p><p>The following sections assume your InfluxDB instance is running on <code>localhost</code> port <code>8086</code> and HTTPS is not enabled.</p><h1 id="Endpoints"><a href="#Endpoints" class="headerlink" title="Endpoints"></a>Endpoints</h1><table><thead><tr><th align="left">Endpoint</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left">/ping</td><td align="left">use <code>/ping</code> to check the status of your InfluxDB instance and your version of InfluxDB</td></tr><tr><td align="left">/query</td><td align="left">use <code>/query</code> to query data and manage databsae, retention policies and users</td></tr><tr><td align="left">/write</td><td align="left">use <code>/write</code> to write data to a pre-exising databse</td></tr></tbody></table><h2 id="ping"><a href="#ping" class="headerlink" title="/ping"></a>/ping</h2><p>The ping endpoint accepts both <code>GET</code> and <code>POST</code> HTTP requests. Use this endpoint to check the status of your InfluxDB instance and your version of InfluxDB.</p><h3 id="Definition"><a href="#Definition" class="headerlink" title="Definition"></a>Definition</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET http://localhost:8086/ping</span><br><span class="line"></span><br><span class="line">HEAD http://localhost:8086/ping</span><br></pre></td></tr></table></figure><h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><p>Extract the version of your InfluxDB instance in the <code>X-Influxdb-Version</code> field of the header</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ curl -sl -I localhost:8086/ping</span><br><span class="line"></span><br><span class="line">HTTP/1.1 204 No Content</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Request-Id: [...]</span><br><span class="line">X-Influxdb-Version: 1.2.x</span><br><span class="line">Date: Wed, 01 Mar 2017 00:09:51 GMT</span><br></pre></td></tr></table></figure><h3 id="Status-Codes-and-Responses"><a href="#Status-Codes-and-Responses" class="headerlink" title="Status Codes and Responses"></a>Status Codes and Responses</h3><p>The response body is empty</p><table><thead><tr><th align="center">HTTP Status Code</th><th align="center">Description</th></tr></thead><tbody><tr><td align="center">204</td><td align="center">Success! Your InfluxDB instance is up and running</td></tr></tbody></table><h2 id="query"><a href="#query" class="headerlink" title="/query"></a>/query</h2><p>The <code>/query</code> endpoint accepts <code>GET</code> and <code>POST</code> HTTP requests. Use this endpoint to query data and manage databases, retention policies, and users.</p><h3 id="Definition-1"><a href="#Definition-1" class="headerlink" title="Definition"></a>Definition</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET http://localhost:8086/query</span><br><span class="line"></span><br><span class="line">POST http://localhost:8086/query</span><br></pre></td></tr></table></figure><h3 id="Verb-usage"><a href="#Verb-usage" class="headerlink" title="Verb usage"></a>Verb usage</h3><table><thead><tr><th align="center">verb</th><th align="center">Query Type</th></tr></thead><tbody><tr><td align="center">GET</td><td align="center">use for all queries that start with <code>SETECT</code>, <code>SHOW</code></td></tr><tr><td align="center">POST</td><td align="center">use for all queries that start with <code>ALTER</code>, <code>CREATE</code>, <code>DELETE</code>, <code>DROP</code>, <code>GRANT</code>, <code>KILL</code>, <code>REVOKE</code></td></tr></tbody></table><blockquote><p>THe only exceptions are <code>SELECT</code> queries that include an <code>INTO</code> <strong>clause</strong>. Those <code>SELECT</code> queries require a <code>POST</code> request.</p></blockquote><h4 id="Example-1"><a href="#Example-1" class="headerlink" title="Example"></a>Example</h4><h5 id="Example-1-Query-data-with-a-SELECT-statement"><a href="#Example-1-Query-data-with-a-SELECT-statement" class="headerlink" title="Example 1: Query data with a SELECT statement"></a>Example 1: Query data with a <code>SELECT</code> statement</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -G <span class="string">&#x27;http://localhost:8086/query?db=mydb&#x27;</span> --data-urlencoded <span class="string">&#x27;q=SELECT * FROM &quot;mymeas&quot;&#x27;</span></span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&quot;results&quot;</span>:[&#123;<span class="string">&quot;statement_id&quot;</span>:0,<span class="string">&quot;series&quot;</span>:[&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;mymeas&quot;</span>,<span class="string">&quot;columns&quot;</span>:[<span class="string">&quot;time&quot;</span>,<span class="string">&quot;myfield&quot;</span>,<span class="string">&quot;mytag1&quot;</span>,<span class="string">&quot;mytag2&quot;</span>],<span class="string">&quot;values&quot;</span>:[[<span class="string">&quot;2017-03-01T00:16:18Z&quot;</span>,33.1,null,null],[<span class="string">&quot;2017-03-01T00:17:18Z&quot;</span>,12.4,<span class="string">&quot;12&quot;</span>,<span class="string">&quot;14&quot;</span>]]&#125;]&#125;]&#125;</span><br></pre></td></tr></table></figure><p>The <code>mymeas</code> <strong>measurement</strong> has two points. The first point has the <strong>timestamp</strong> <code>2017-03--1T00:15:18Z</code>, a <code>myfield</code> value of <code>33.1</code> and no tag values for the <code>mytag1</code> and <code>mytag2</code> tag keys.</p><p>The second point has the timestamp <code>2017-03--1T00:18:18Z</code>, a <code>myfield</code> value of <code>12</code>, a <code>mymeas</code> value of <code>12</code>, a <code>mytag1</code> value of <code>12</code> and a <code>mytag2</code> value of <code>14</code></p><p>The same query in InfluxDB’s Command Line Interface(CLI) returns the following table:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">name: mymeas</span><br><span class="line">time                   myfield   mytag1   mytag2</span><br><span class="line">----                   -------   ------   ------</span><br><span class="line">2017-03--1T00:15:18Z    33.1</span><br><span class="line">2017-03--1T00:18:18Z    12        12       14</span><br></pre></td></tr></table></figure><h5 id="Example-2-Query-data-with-a-SELECT-statement-and-an-INTO-clause"><a href="#Example-2-Query-data-with-a-SELECT-statement-and-an-INTO-clause" class="headerlink" title="Example 2: Query data with a SELECT statement and an INTO clause"></a>Example 2: Query data with a <code>SELECT</code> statement and an <code>INTO</code> clause</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -XPOST <span class="string">&#x27;http://localhost:8086/query?db=mydb&#x27;</span> --data-urlencoded <span class="string">&#x27;q=SELECT * INTO &quot;newmeas&quot; FROM &quot;mymeas&quot;&#x27;</span></span><br></pre></td></tr></table></figure><blockquote><p><code>SELECT</code> queries that include and <code>INTO</code> clause require a <code>POST</code> requests</p></blockquote><h5 id="Example-3-Create-a-database"><a href="#Example-3-Create-a-database" class="headerlink" title="Example 3: Create a database"></a>Example 3: Create a database</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -XPOST <span class="string">&#x27;http://localhost:8086/query&#x27;</span> --data-urlencoded <span class="string">&#x27;q=CREATE DATABASE &quot;mydb&quot;&#x27;</span></span><br></pre></td></tr></table></figure><p>A successful <code>CREATE DATABASE</code> query returns no additional information.</p><h4 id="Query-String-Parameter"><a href="#Query-String-Parameter" class="headerlink" title="Query String Parameter"></a>Query String Parameter</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Query String Parameter         |                                            Optional&#x2F;Required                                             |                                                                                Definition</span><br></pre></td></tr></table></figure><p>:———————————–: | :——————————————————————————————————: | :———————————————————————————————————————————————————————–: chunked=[true | &lt;number_of_points] | Optional | Returns points in streamed batches instead of in a single response. If set to <code>true</code>, InfluxDB chunks responses by series or by every 10,000 point, whichever occurs first. It set to a specific value, InfluxDB chunks responses by series or by that number of points db=</p><database_name></database_name><p>| Required for database-dependent queries(most <code>SELECT</code> queries and <code>SHOW</code> queries require this parameter) | Sets the target database for the query epoch=[ns,u,ms,s,m,h] | Optional | Returns epoch timestamps with the specified precision. By default, InfluxDB returns timestamps in RFC3339 format with nanosecond precision. Both <code>u</code> indicate microsecond p=</p><password></password><p>| Optional if you haven’t enabled authentication. Required if you’ve enabled authentication | Sets the password for authentication if you’ve enabled authentication. Use with the query string parameter <code>u</code> pretty=true | Optional | Enables pretty-printed JSON output. While this is useful for debugging it is not recommended for production use as it consumes unnecessary network bandwidth u=</p><username></username><p>| Optional if you haven’t enabled authentication. Required if you’ve enabled authentication | Sets the username for authentication if you’ve enabled authentication. The user must have read access to the database. Use with the query string parameter <code>p</code></p><blockquote><p>In versions 1.2.0 and 1.2.1, InfluxDB automatically truncates the number of rows returned for requests without the <code>chunked</code> parameter. By default, the maximum number of rows returned is set to 10000, if a query has more than 10000 rows to return, InfluxDB includes a <code>&#39;partial&#39;: true</code> tag in the response body.</p></blockquote><blockquote><p>The HTTP API also supports basic authentication. Use basic authentication if you’ve enabled authentication and aren’t using the query string parameter <code>u</code> and <code>p</code>.</p></blockquote><h5 id="Example-Create-a-database-using-HTTP-authentication"><a href="#Example-Create-a-database-using-HTTP-authentication" class="headerlink" title="Example: Create a database using HTTP authentication"></a>Example: Create a database using HTTP authentication</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -XPOST <span class="string">&#x27;http://localhost:8086/query?u=myusername&amp;p=mypassword&#x27;</span> --data-urlencoded <span class="string">&#x27;q=CREATE DATABASE &quot;mydb&quot;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="write"><a href="#write" class="headerlink" title="/write"></a>/write</h2><p>The <code>/write</code> endpoint accepts <code>POST</code> HTTP requests. Use this endpoint to write data to a pre-existing databse.</p><h3 id="Definition-2"><a href="#Definition-2" class="headerlink" title="Definition"></a>Definition</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST http://localhost:8086/write</span><br></pre></td></tr></table></figure><h3 id="Query-String-Parameter-1"><a href="#Query-String-Parameter-1" class="headerlink" title="Query String Parameter"></a>Query String Parameter</h3><pre><code>           Query String Parameter                 | Optional/Required                                                                         | Description</code></pre><p>:—————————————————: | :—————————————————————————————- | :————————————————————————————————————————————————————–<br>consistency=[any | one | quorum | all] | Optional, available with InfluxEnterprise clusters only | Sets the write consistency for the point. InfluxDB assumes that the write consistency is <code>one</code> if you do not specify <code>consistency</code><br>db=</p><database></database>              | Required                                                                                  | Sets the target database for the write             p=<password></password>               | Optional if you haven't enabled authentication. Required if you've enabled authentication | Sets the password for authentication if you've enabled authentication. Use with the query string parameter `u`               precision=[ns,u,ms,m,h]                | Optional                                                                                  | Sets the precision for the supplied Unix time values. InfluxDB assumes that timestamps are in nanoseconds if you do not specify `precision`rp=<retention_policy_name></retention_policy_name> | Optional | Sets the target retention policy for the write. InfluxDB writes to the `DEFAULT` retention policy if you do not specify a retention policyu=<username></username>               | Optional if you haven't enabled authentication. Required if you've enabled authentication | Sets the username for authentication if you've enabled authentication. The user must have write access to the database. Use with the query string parameter `p`]]></content>
      
      
      
        <tags>
            
            <tag> Database </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Writing Data in InfluxDB With HTTP API</title>
      <link href="/2017/06/30/Writing-Data-in-InfluxDB-with-HTTP-API/"/>
      <url>/2017/06/30/Writing-Data-in-InfluxDB-with-HTTP-API/</url>
      
        <content type="html"><![CDATA[<h1 id="Create-a-database-using-the-HTTP-API"><a href="#Create-a-database-using-the-HTTP-API" class="headerlink" title="Create a database using the HTTP API"></a>Create a database using the HTTP API</h1><p>To create a database send a <code>POST</code> request to the <code>/query</code> endpoint and set the URL parameter <code>q</code> to <code>CREATE DATABASE &lt;new_database_name&gt;</code>. The example below sends a request to InfluxDB running on <code>locahost</code> and create the database <code>mydb</code>.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -i -XPOST http://localhost:8086/query --data-urlencoded <span class="string">&quot;q=CREATE DATABASE mydb&quot;</span></span><br></pre></td></tr></table></figure><h1 id="Writing-data-using-the-HTTP-API"><a href="#Writing-data-using-the-HTTP-API" class="headerlink" title="Writing data using the HTTP API"></a>Writing data using the HTTP API</h1><p>The HTTP API is the primary means of writing data into InfluxDB, by sending <code>POST</code> requests to the <code>/write</code> endpoint. The example below writes a single point to the <code>mydb</code> database. The data consist of the <strong>measurement</strong> <code>cpu_load_short</code>. the <strong>tag keys</strong> <code>host</code> and <code>region</code> with the <strong>tag values</strong> <code>server01</code> and <code>us-west</code>, the <strong>field key</strong> <code>value</code> with a <strong>field value</strong> of <code>0.64</code> and the <strong>timestamp</strong> <code>434055562000000000</code>.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -i -XPOST <span class="string">&#x27;http://localhost:8086/write?db=mydb&#x27;</span> --data-binary <span class="string">&#x27;cpu_load_short,host=server01,region=us-west value=0.64 1434055562000000000&#x27;</span></span><br></pre></td></tr></table></figure><p>When writing points, you must specify an existing database in the <code>db</code> query parameter. Points will be written to <code>db</code>‘s default retention policy if you do not supply a retention policy via the <code>rp</code> query parameter.</p><p>The body of the POST - we call this the <code>Line Protocol</code> - contains the time-series data that you wish to store. They consist of a <strong>measurement</strong>, <strong>tags</strong>, <strong>fields</strong>, and a <strong>timestamp</strong>. InfluxDB requires a measurement name.</p><p>Strictly speaking, tags are optional but most series include tags to differentiate data sources and to make querying both easy and efficient. Both tag keys and tag values are strings.</p><p>Field keys are required and always strings, and <strong>by default</strong>, field values are floats. The timestamp - supplied at the end of the line in Unix time in nanoseconds since January 1, 1970 UTC - is optional. If you do not specify a timestamp InfluxDB uses the server’s local nanoseconds timestamp in Unix epoch.</p><p>Anything that has to do with tim ein InfluxDB is always UTC.</p><h2 id="Writing-multiple-points"><a href="#Writing-multiple-points" class="headerlink" title="Writing multiple points"></a>Writing multiple points</h2><p>Post multiple points to multiple series at the same time by separating each point with a new line. Batching points in this manner results in much higher performance.</p><p>The following example writes three points to the database <code>mydb</code>.</p><p>The first point belongs to the series with the measurement <code>cpu_load_short</code> and tag set <code>host-server02</code> and has the server’s local timestamp</p><p>The second point belongs to the series with the measurement <code>cpu_load_short</code> and tag set <code>host=server02,region=us-west</code> and has the specified timestamp <code>1422568543702900257</code>.</p><p>The third point has the same specified timestamp as the second point, but it is written to the series with the measruement <code>cpu_load_short</code> and tag set <code>direction=in,host=server01,region=us-west</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -i -XPOST <span class="string">&#x27;http://localhost:8086/write?db=mydb&#x27;</span> --data-binary <span class="string">&#x27;cpu_load_short,host=server02 value=0.67 cpu_load_short,host=server02,region=us-west value=0.5 cpu_load_short,direction=in,host=server01,region=us-west value=0.2&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="Writing-points-from-a-file"><a href="#Writing-points-from-a-file" class="headerlink" title="Writing points from a file"></a>Writing points from a file</h2><p>Write points from a <strong>file</strong> by passing <code>@filename</code> to <code>curl</code>. The data in the file should follow InfluxDB’s <strong>line protocol syntax</strong></p><p>Example of a properly-formatted file(<code>cpu_data.txt</code>)</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cpu_load_short,host=server02 value=0.2</span><br><span class="line">cpu_load_short,host=server02,region=us-west value=0.5</span><br><span class="line">cpu_load_short,direction=in,host=server01,region=us-west value=0.2</span><br></pre></td></tr></table></figure><p>Write the data in <code>cpu_data.txt</code> to the <code>mydb</code> datbase with:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -i -XPOST <span class="string">&#x27;http://localhost:8086/write?db=mydb&#x27;</span> --data-binary @cpu_data.txt</span><br></pre></td></tr></table></figure><blockquote><p>Note: If your data file has more than 5000 points, it may be necessary to split that file into several files in order to write your data in batches to influxDB. By default, the HTTP request times out after five seconds. InfluxDB will still attempt to write the points after that time out but there will be no confirmation that they were successfully written.</p></blockquote><h2 id="Schemaless-Design"><a href="#Schemaless-Design" class="headerlink" title="Schemaless Design"></a>Schemaless Design</h2><p>InfluxDB is a schemaless database. You can add new measurement, tags, and fields at any time. Note that if you attempt to write data with a different type than previous used(for example, writing a string to a field that previously accepted integers), InfluxDB will reject those data.</p><h2 id="HTTP-response-summary"><a href="#HTTP-response-summary" class="headerlink" title="HTTP response summary"></a>HTTP response summary</h2><ul><li><p>2xx: If you write request received <code>HTTP 204 No Content</code>, it was a success</p></li><li><p>4xx: InfluxDB could not understand the request</p></li><li><p>5xx: The system is overloaded or significantly impaired.</p></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Database </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Querying InfluxDB With the HTTP API</title>
      <link href="/2017/06/30/Querying-InfluxDB-with-the-HTTP-API/"/>
      <url>/2017/06/30/Querying-InfluxDB-with-the-HTTP-API/</url>
      
        <content type="html"><![CDATA[<p>The HTTP API is the primary means for querying data in InfluxDB.</p><p>To perform a query send a <code>GET</code> request to the <code>/query</code> endpoint, set the URL parameter <code>db</code> as the target database, and set the URL parameter <code>q</code> as your query.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -G <span class="string">&#x27;http://localhost:8086/query?pretty=true&#x27;</span> --data-urlencode <span class="string">&quot;db=mydb&quot;</span> --data-urlencode <span class="string">&quot;q=SELECT \&quot;value\&quot; FROM \&quot;cpu_load_short\&quot; WHERE \&quot;region\&quot;=&#x27;us-west&#x27;&quot;</span></span><br></pre></td></tr></table></figure><p>InfluxDB returns JSON. The results of your query appear in the <code>&#39;result&#39;</code> array. If an error occurs, InfluxDB sets an <code>&#39;error&#39;</code> key with an explanation of the error.</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;results&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;statement_id&quot;</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">&quot;series&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;cpu_load_start&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;columns&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;time&quot;</span>,</span><br><span class="line">            <span class="string">&quot;value&quot;</span></span><br><span class="line">          ],</span><br><span class="line">          <span class="attr">&quot;values&quot;</span>: [</span><br><span class="line">            [</span><br><span class="line">                <span class="string">&quot;2015-01-29T21:55:43.702900257Z&quot;</span>,</span><br><span class="line">                <span class="number">2</span></span><br><span class="line">            ],</span><br><span class="line">            [</span><br><span class="line">                <span class="string">&quot;2015-01-29T21:55:43.702900257Z&quot;</span>,</span><br><span class="line">                <span class="number">0.55</span></span><br><span class="line">            ],</span><br><span class="line">            [</span><br><span class="line">                <span class="string">&quot;2015-06-11T20:46:02Z&quot;</span>,</span><br><span class="line">                <span class="number">0.64</span></span><br><span class="line">            ]</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>Note: Appending <code>pretty=true</code> to the URL enables pretty-printed JSON output. While this is useful for debugging or when queryting directly with tools like <code>curl</code>, it is not recommended for production use as it consumes unnecessary network bandwidth.</p></blockquote><h1 id="Multiple-queries"><a href="#Multiple-queries" class="headerlink" title="Multiple queries"></a>Multiple queries</h1><p>Send multiple queries to InfluxDB in a single API call. Simply delimit each query using a semicolon</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -G <span class="string">&#x27;http://localhost:8086/query?pretty=true&#x27;</span> --data-urlencode <span class="string">&quot;db=mydb&quot;</span> --data-urlencode <span class="string">&quot;q=SELECT \&quot;value\&quot; FROM \&quot;cpu_load_short\&quot; WHERE \&quot;region\&quot;=&#x27;us-west&#x27;;SELECT count(\&quot;value\&quot;) FROM \&quot;cpu_load_short\&quot; WHERE \&quot;region\&quot;=&#x27;us-west&#x27;&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Database </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Simple About InfluxDB</title>
      <link href="/2017/06/30/Simple-about-InfluxDB/"/>
      <url>/2017/06/30/Simple-about-InfluxDB/</url>
      
        <content type="html"><![CDATA[<h1 id="Install-InfluxDB-on-MacOS"><a href="#Install-InfluxDB-on-MacOS" class="headerlink" title="Install InfluxDB on MacOS"></a>Install InfluxDB on MacOS</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew update</span><br><span class="line">brew install influxdb</span><br></pre></td></tr></table></figure><p>To run influxDB at startup, run this command</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -sfv /usr/<span class="built_in">local</span>/opt/influxdb/*.plist ~/Library/LaunchAgents</span><br></pre></td></tr></table></figure><p>Now, to start InfluxDB, run this command(Accept the request of incoming connections in the window that appears)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">influxd -config /usr/<span class="built_in">local</span>/etc/influxdb.conf</span><br></pre></td></tr></table></figure><h1 id="Check-if-InfluxDB-works"><a href="#Check-if-InfluxDB-works" class="headerlink" title="Check if InfluxDB works"></a>Check if InfluxDB works</h1><p>InfluxDB exposes an API with which one can easily check its good working condition. Here’s what you will receive in return for this curl command</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">curl -sl -I localhost:8086/ping</span><br><span class="line">HTTP/1.1 204 No Content</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Request-Id: 95b307f8-5d6b-11e7-8002-000000000000</span><br><span class="line">X-Influxdb-Version: v1.3.0</span><br><span class="line">Date: Fri, 30 Jun 2017 08:10:31 GMT</span><br></pre></td></tr></table></figure><h1 id="Terminology-difference-with-SQL-database"><a href="#Terminology-difference-with-SQL-database" class="headerlink" title="Terminology, difference with SQL database"></a>Terminology, difference with SQL database</h1><p>Like all non-relational database, InfluxDB for its own vocabulary your need to know before starting</p><ul><li><p><strong>Measurement</strong> is equivalent to <strong>SQL table</strong></p></li><li><p><strong>Tags</strong> is similar to a <strong>indexed column</strong> in a SQL database</p></li><li><p><strong>Fields</strong> is similar to the <strong>column not indexed</strong> in a SQL database</p></li><li><p><strong>Points</strong> is equivalent to <strong>line(row)</strong> in a SQL database</p></li></ul><h1 id="Database-Management-Methods"><a href="#Database-Management-Methods" class="headerlink" title="Database Management Methods"></a>Database Management Methods</h1><p>There are 6 methods to manage database</p><ul><li><p>CREATE DATABASE</p></li><li><p>DROP DATABASE</p></li><li><p>DROP SETS</p></li><li><p>DELETE</p></li><li><p>DROP MEASUREMENT</p></li><li><p>DROP SHARD</p></li></ul><h2 id="Create-a-Database"><a href="#Create-a-Database" class="headerlink" title="Create a Database"></a>Create a Database</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE &lt;database_name&gt; [WITH [DURATION &lt;duration&gt;] [REPLICATION &lt;n&gt;] [SHARD DURATION &lt;shard_duration&gt;] [NAME &lt;retention-policy-name&gt;]]</span><br></pre></td></tr></table></figure><p><strong>Basic Setting</strong></p><ul><li><p>database_name: name of the database</p></li><li><p>duration: you can set the period of data retention(conversation) but it makes more sense to implement a retention policy.</p></li></ul><h2 id="Delete-a-database-drop-database"><a href="#Delete-a-database-drop-database" class="headerlink" title="Delete a database (drop database)"></a>Delete a database (drop database)</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP DATABASE &lt;database_name&gt;</span><br></pre></td></tr></table></figure><h1 id="Establish-a-retention-policy"><a href="#Establish-a-retention-policy" class="headerlink" title="Establish a retention policy"></a>Establish a retention policy</h1><p>InfluxDB incorporates a system of automatic deletion of data. It is the policy of Retention. Spent some time, data is automatically deleted from the base. This mechanism is very convenient because it for a good grasp of size of the base and we don’t have to worry about the maintenance operation. Free to each set the lifetime of any particular measure. If you want to follow the temperature of its microprocessor, one less may be sufficient, instead the retention policy must be more flexible if we want to compare the temperature in a House form one year to the other. It will also think about the system upstream, you don’t have to store a measurement of atmosphere temperature every 10 seconds! A measurement per minutes, 15 minutes, that’s enough. Instead in an industrial process, we certainly want to go for the second… or a lot less.</p><p>We therefore for 3 methods</p><ul><li><p>Create: to create a rule of conservation of data</p></li><li><p>Alter: to change a rule</p></li><li><p>Drop: to remove a rule</p></li></ul><h1 id="Create-a-retention-policy"><a href="#Create-a-retention-policy" class="headerlink" title="Create a retention policy"></a>Create a retention policy</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE RETENTION POLICY &lt;name_politic_retention&gt; ON &lt;name_database&gt; DURATION: &lt;duration&gt; REPLICATION: &lt;n&gt; [SHARD DURATION &lt;duration duration_shard&gt;] [DEFAULT]</span><br></pre></td></tr></table></figure><p><strong>Parameters</strong></p><ul><li><p>name_politic_retention: a short name without spaces of preference</p></li><li><p>name_database: the database on which applies the retention policy</p></li><li><p>duration: duration of data retention. It’s a literal expression which must respect the convention InfluxDB</p></li><li><p>duration_shard: the duration of storage of the data in the buffer zone</p></li><li><p>n: number of replication(required), put 1 if no cluster installed</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE RETENTION POLICY <span class="string">&#x27;one_day_only&#x27;</span> WE <span class="string">&#x27;NOAA_water_database&#x27;</span> DURATION 1 d REPLICATION 1</span><br></pre></td></tr></table></figure><p>This policy keeps the records during a day(one_day_only) based NOAA_water_database. The data are stored in space shard 1 day. Replication 1 indicates that a copy of each item is copied in the cluster.</p><h1 id="Modify-retention-policy-alter-retention-policy"><a href="#Modify-retention-policy-alter-retention-policy" class="headerlink" title="Modify retention policy(alter retention policy)"></a>Modify retention policy(alter retention policy)</h1><p>This method allows to change an existing retention policy</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER ...</span><br></pre></td></tr></table></figure><h1 id="Destroyed-a-retention-policy-drop-retention-policy"><a href="#Destroyed-a-retention-policy-drop-retention-policy" class="headerlink" title="Destroyed a retention policy(drop retention policy)"></a>Destroyed a retention policy(drop retention policy)</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP RETENTION ...</span><br></pre></td></tr></table></figure><h1 id="Discover-the-InfluxDB-Shell"><a href="#Discover-the-InfluxDB-Shell" class="headerlink" title="Discover the InfluxDB Shell"></a>Discover the InfluxDB Shell</h1><p>Now we know some methods, we will provide to run some test</p>]]></content>
      
      
      
        <tags>
            
            <tag> Database </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Usage of Node-Influx</title>
      <link href="/2017/06/30/Usage-of-Node-Influx/"/>
      <url>/2017/06/30/Usage-of-Node-Influx/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>InfluxDB is a time series database, so it would make sense that the concept of time is moderately important when dealing with it.</p><p>By default, Influx will store all dates you give to it as a nanosecond precision timestamp, whereas in JavaScript, most of the time we’re dealing with millisecond precision timestamps, which we get from <code>Date.now()</code> or <code>myDate.getTime()</code>. This presents a bit of a problem for us JavaScripters, since nanosecond-precision timestamps are stored as 64-bit unsigned integers that JavaScript simply cannot represent accurately.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">node-influx git:(master) node</span><br><span class="line">&gt; <span class="number">1475985480231035677</span></span><br><span class="line"><span class="number">1475985480231035600</span></span><br></pre></td></tr></table></figure><p>This module tries to make dates as easy as possible for you to deal with, and out of the box everything should ‘just work’.</p><p>There are three places that dates can get passed around:</p><ul><li><p>Dates coming rom Influx queries, like <code>select * from my_series</code></p></li><li><p>Dates being interpolated <em>into</em> Influx queries</p></li><li><p>Dates being used when writing points on the line protocol, via <code>.writePoints()</code> or <code>.writeMeasurement()</code>.</p></li></ul><p>To deal with this, we introduce a new type called <code>NanoDate</code>. These dates behave just like the normal <code>Date</code> type, but have two additional methods: <code>.getNanoTime()</code> and <code>.getNanoISOString()</code>. They behave just like the normal <code>.getTime()</code> and <code>getISOString</code> methods, but they both return nanosecond-precision strings instead of millisecond-precision numbers and timestamps.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">expect(myNanoDate.getTime()).to.equal(<span class="number">1475985480231</span>)</span><br><span class="line">expect(myNanoDate.getNanoTime()).to.equal(<span class="string">&#x27;1475985480231035677&#x27;</span>)</span><br><span class="line">expect(myNanoDate.toISOString()).to.equal(<span class="string">&#x27;2016-10-09T03:58:00.231Z&#x27;</span>)</span><br><span class="line">expect(myNanoDate.toNanoISOString()).to.equal(<span class="string">&#x27;2016-10-09T03:58:00.231035677Z&#x27;</span>)</span><br></pre></td></tr></table></figure><p>All times returned from Influx queries are parsed to INanoDates. For example you can do something like the following:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">influx.query(<span class="string">&#x27;select * from perf&#x27;</span>).then(<span class="function"><span class="params">results</span> =&gt;</span> &#123;</span><br><span class="line">  result.forEach(<span class="function"><span class="params">row</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`Used <span class="subst">$&#123;row.cpu&#125;</span> at <span class="subst">$&#123;row.time.toNanoISOString()&#125;</span>`</span>))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>When writing data to Influx, all write methods accept INanoDates in all situation. This means if you select data from Influx and want to update a data point, you can pass the time right back into <code>write</code> method. (Remember, points within series are unique by their time) If you have a nanosecond timestamp from some external source, you can convert it to INanoDate using <code>toNanoDate</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; toNanoDate &#125; <span class="keyword">from</span> <span class="string">&#x27;influx&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> myNanoDate = toNanoDate(<span class="string">&#x27;1475985480231035600&#x27;</span>)</span><br><span class="line">expect(myNanoDate.getTime()).to.equal(<span class="number">1475985480231</span>)</span><br><span class="line">expect(myNanoDate.getNanoTime()).to.equal(<span class="string">&#x27;1475985480231035600&#x27;</span>)</span><br><span class="line">expect(myNanoDate.toNanoISOString()).to.equal(<span class="string">&#x27;2016-10-09T03:58:00.231035600Z&#x27;</span>)</span><br></pre></td></tr></table></figure><p>Finally, if you want to embed a iNanoDate into an Influx query, you should use <code>toNanoString</code> to do so:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">influx.query(<span class="string">`select * from perf where time &gt; &quot;<span class="subst">$&#123;myNanoDate.toNanoISOString()&#125;</span>&quot;`</span>)</span><br></pre></td></tr></table></figure><h1 id="Browser-Setup"><a href="#Browser-Setup" class="headerlink" title="Browser Setup"></a>Browser Setup</h1><p>For Node.js, <code>influx</code> can be installed and you can use it out of the box.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add influx@next</span><br></pre></td></tr></table></figure><p>You can tell Webpack to use this module by adding the following section in your <code>webpack.config.js</code>:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = path.resolve(__dirname, <span class="string">&#x27;node_modules/stream-http/index.js&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    alias: &#123; http, <span class="attr">https</span>: http &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><h2 id="Class-Summary"><a href="#Class-Summary" class="headerlink" title="Class Summary"></a>Class Summary</h2><table><thead><tr><th align="center">attr</th><th align="left">name</th></tr></thead><tbody><tr><td align="center">public</td><td align="left">ExponentialBackoff</td></tr><tr><td align="center">public</td><td align="left">Expression:<br></td></tr><tr><td align="center">Expression is used to build filtering expression, like those used in WHERE clauses</td><td align="left"></td></tr><tr><td align="center">public</td><td align="left">InfluxDB:<br></td></tr><tr><td align="center">InfluxDB is the public interface to run queries against your database</td><td align="left"></td></tr><tr><td align="center">public</td><td align="left">Measurement:<br></td></tr><tr><td align="center">Measurement creates a reference to a particular measurement</td><td align="left"></td></tr><tr><td align="center">public</td><td align="left">Pool:<br></td></tr><tr><td align="center">The Pool maintains a list available Influx hosts and dispatches requests to them</td><td align="left"></td></tr><tr><td align="center">public</td><td align="left">Raw:<br></td></tr><tr><td align="center">You can provide Raw values to Influx methods to prevent it from escaping your provided string.</td><td align="left"></td></tr><tr><td align="center">public</td><td align="left">RequestError:<br></td></tr><tr><td align="center">An RequestError is thrown when a query generates errorful results in a 300&lt;= error &lt;=500</td><td align="left"></td></tr><tr><td align="center">public</td><td align="left">ResultError:<br></td></tr><tr><td align="center">An ResultError is thrown when a query generates errorful results from Influx</td><td align="left"></td></tr><tr><td align="center">public</td><td align="left">ServiceNotAvailableError:<br></td></tr><tr><td align="center">An ServiceNotAvailableError is returned as an error from requests that result in a &gt;500 error code</td><td align="left"></td></tr></tbody></table><h3 id="interface-Summary"><a href="#interface-Summary" class="headerlink" title="interface Summary"></a>interface Summary</h3><table><thead><tr><th align="center">attr</th><th align="left">name</th></tr></thead><tbody><tr><td align="center">public</td><td align="left">IBackoffStrategy:<br></td></tr><tr><td align="center">The IBackoffStrategy dictates behavior to use when hosts in the connection pool start failing</td><td align="left"></td></tr><tr><td align="center">public</td><td align="left">INanoDate:<br></td></tr><tr><td align="center">An INanoDate is a type of Date that holds a nanosecond-precision unix timestamp</td><td align="left"></td></tr><tr><td align="center">public</td><td align="left">IResults:<br></td></tr><tr><td align="center">IResults are returned from the InfluxBD#query mehtod</td><td align="left"></td></tr></tbody></table><h3 id="Function-Summary"><a href="#Function-Summary" class="headerlink" title="Function Summary"></a>Function Summary</h3><table><thead><tr><th align="center">attr</th><th align="left">name</th></tr></thead><tbody><tr><td align="center">public</td><td align="left">toNanoDate(timestamp: String): NanoDate:<br></td></tr><tr><td align="center">Covers a nanoseconds unix timestamp to a INanoDate for node-influx.</td><td align="left"></td></tr></tbody></table><h3 id="Variable-Summary"><a href="#Variable-Summary" class="headerlink" title="Variable Summary"></a>Variable Summary</h3><table><thead><tr><th align="center">attr</th><th align="left">name</th></tr></thead><tbody><tr><td align="center">public</td><td align="left">Precision: Object</td></tr></tbody></table><p>&lt;string, string=””&gt;:<br>Precision is a map of available influx time precision&lt;/string,&gt;<br>public | escape: Object:<br><br>tagEscaper escapes tag keys, tag values and field keys.</p><h3 id="Typedef-Summary"><a href="#Typedef-Summary" class="headerlink" title="Typedef Summary"></a>Typedef Summary</h3><table><thead><tr><th align="center">attr</th><th align="left">name</th></tr></thead><tbody><tr><td align="center">public</td><td align="left">FieldType: Number:<br></td></tr><tr><td align="center">FieldType is an enumeration of influxDB field data types</td><td align="left"></td></tr><tr><td align="center">public</td><td align="left">IClusterConfig: Object:<br></td></tr><tr><td align="center">A IClusterConfig can be provided into <code>new InfluxDB(config)</code> when you have a multiple influx nodes to connect to</td><td align="left"></td></tr><tr><td align="center">public</td><td align="left">IPingStats: Object:<br></td></tr><tr><td align="center">IPingStats is returned from InfluxDB#ping</td><td align="left"></td></tr><tr><td align="center">public</td><td align="left">IPoint: Object<br></td></tr><tr><td align="center">IPoint is passed to the client’s write methods to store a point in InfluxDB</td><td align="left"></td></tr><tr><td align="center">public</td><td align="left">IPoolOptions: Object<br></td></tr><tr><td align="center">Pool options can be passed into the database to configure the behavior of the connection Pool</td><td align="left"></td></tr><tr><td align="center">public</td><td align="left">IQueryOptions: Object<br></td></tr><tr><td align="center">The IQueryOptions allows you to configure how queries are run against Influx</td><td align="left"></td></tr><tr><td align="center">public</td><td align="left">ISchemaOptions: Object<br></td></tr><tr><td align="center">Schema options can be passed into the <code>new InfluxDB()</code> constructor to help define the shape of your data.</td><td align="left"></td></tr><tr><td align="center">public</td><td align="left">ISingleHostConfig: Object<br></td></tr><tr><td align="center">A ISingleHostConfig can be provided into <code>new InfluxDB(config)</code> when you have a single Influx address to connect to</td><td align="left"></td></tr><tr><td align="center">public</td><td align="left">IWriteOptions: Object<br></td></tr><tr><td align="center">IWriteOptions configure how points are written in the database.</td><td align="left"></td></tr></tbody></table>]]></content>
      
      
      
        <tags>
            
            <tag> Database </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Example of Node-Influx</title>
      <link href="/2017/06/30/Example-of-node-influx/"/>
      <url>/2017/06/30/Example-of-node-influx/</url>
      
        <content type="html"><![CDATA[<h1 id="Express-Response-Times-Example"><a href="#Express-Response-Times-Example" class="headerlink" title="Express Response Times Example"></a>Express Response Times Example</h1><p>In this example we’ll create a server which has an index page that prints out ‘hello world’, and a page</p><p><code>http://localhost:3000/times</code> which prints out the last ten response times that influxDB gave us.</p><p>The end result should look something like this:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">curl -s localhost:3000</span><br><span class="line">Hello world</span><br><span class="line"></span><br><span class="line">curl -s localhost:3000/<span class="built_in">times</span> | jq</span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;time&quot;</span>: <span class="string">&quot;2016-10-09T19:13:26.815Z&quot;</span>,</span><br><span class="line">    <span class="string">&quot;duration&quot;</span>: 205,</span><br><span class="line">    <span class="string">&quot;host&quot;</span>: <span class="string">&quot;ares.peet.io&quot;</span>,</span><br><span class="line">    <span class="string">&quot;path&quot;</span>: <span class="string">&quot;/&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>Get started by installing and importing everything we need. This example requires Node 6.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install influx express</span><br></pre></td></tr></table></figure><p>Now create a new file <code>app.js</code> and start writing</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Influx = <span class="built_in">require</span>(<span class="string">&#x27;../../&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> os = <span class="built_in">require</span>(<span class="string">&#x27;os&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express()</span><br></pre></td></tr></table></figure><p>Create a new influx client. We tell it to use the <code>express_response_db</code> database by default, and give it some information about the schema we’re writing. It can use this to be smarter about what data formats it writes and do some basic validation for us.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> influx = <span class="keyword">new</span> Influx.InfluxBD(&#123;</span><br><span class="line">  host: <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">  database: <span class="string">&#x27;express_response_db&#x27;</span>,</span><br><span class="line">  schema: [</span><br><span class="line">    &#123;</span><br><span class="line">      measurement: <span class="string">&#x27;response_time&#x27;</span>,</span><br><span class="line">      fields: &#123;</span><br><span class="line">        path: Influx.FieldType.STRING,</span><br><span class="line">        duration: Influx.FieldType.INTEGER</span><br><span class="line">      &#125;,</span><br><span class="line">      tags: [</span><br><span class="line">        <span class="string">&#x27;host&#x27;</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Now we have a working influx client!</p><p>We’ll make sure the database exists and boot the app.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">influx.getDatabaseName()</span><br><span class="line">.then(<span class="function"><span class="params">names</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!names.includes(<span class="string">&#x27;express_response_db&#x27;</span>)) &#123;</span><br><span class="line">    <span class="keyword">return</span> influx.createDatabase(<span class="string">&#x27;express_response_db&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">.then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  http.createServer(app).listen(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Listening on port 3000&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">.catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.error(<span class="string">&#x27;Error creating Influx database&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Finally we’ll define the middleware and routes we’ll use. We have a generic middleware that records the time between when requests comes in, and the time we response to them. We also have another route called <code>/times</code> which prints out the last ten timings we recorded.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">app.use(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> start = <span class="built_in">Date</span>.now()</span><br><span class="line">  res.on(<span class="string">&#x27;finish&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> duration = <span class="built_in">Date</span>.now() - start</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`Request to <span class="subst">$&#123;req.path&#125;</span> took <span class="subst">$&#123;duration&#125;</span> ms`</span>)</span><br><span class="line">    influx.writePoints([</span><br><span class="line">      &#123;</span><br><span class="line">        measurement: <span class="string">&#x27;response_times&#x27;</span>,</span><br><span class="line">        tags: &#123; <span class="attr">host</span>: os.hostname() &#125;,</span><br><span class="line">        fields: &#123; duration, <span class="attr">path</span>: req.path &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`Error saving data to InfluxDB: <span class="subst">$&#123;err.stack&#125;</span>`</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> next()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> res.end(<span class="string">&#x27;Hello world&#x27;</span>), <span class="built_in">Math</span>.random() * <span class="number">500</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/times&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  influx.query(<span class="string">`</span></span><br><span class="line"><span class="string">      select * from response_times</span></span><br><span class="line"><span class="string">      where host = <span class="subst">$&#123;Influx.<span class="built_in">escape</span>.stringLit(os.hostname())&#125;</span></span></span><br><span class="line"><span class="string">      order by time desc</span></span><br><span class="line"><span class="string">      limit 10</span></span><br><span class="line"><span class="string">  `</span>).then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">    res.json(result)</span><br><span class="line">  &#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    res.status(<span class="number">500</span>).send(err.stack)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Database </tag>
            
            <tag> Node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Snippets of Koa Middlewares</title>
      <link href="/2017/06/29/snippets-of-koa-middlewares/"/>
      <url>/2017/06/29/snippets-of-koa-middlewares/</url>
      
        <content type="html"><![CDATA[<h1 id="koa-compress"><a href="#koa-compress" class="headerlink" title="koa-compress"></a>koa-compress</h1><p>Compress middleware for Koa</p><h2 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> compress = <span class="built_in">require</span>(<span class="string">&#x27;koa-compress&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line">app.use(compress(&#123;</span><br><span class="line">  filter: <span class="function">(<span class="params">content_type</span>) =&gt;</span> <span class="regexp">/text/i</span>.test(content_type),</span><br><span class="line">  threshold: <span class="number">2048</span>,</span><br><span class="line">  flush: <span class="built_in">require</span>(<span class="string">&#x27;zlib&#x27;</span>).Z_SYNC_FLUSH,</span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure><h2 id="Options"><a href="#Options" class="headerlink" title="Options"></a>Options</h2><p>The options are passed to <code>zlib</code></p><blockquote><p>filter: An optional function that checks the response content type to decide whether to compress. By default, it uses <a href="https://github.com/expressjs/compressible">compressible</a></p></blockquote><blockquote><p>threshold: Minimum response size in bytes to compress. Default 1024 byte or 1kb.</p></blockquote><h3 id="koa-morgan"><a href="#koa-morgan" class="headerlink" title="koa-morgan"></a>koa-morgan</h3><p>HTTP Request logger middleware for node.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> morgan = <span class="built_in">require</span>(<span class="string">&#x27;morgan&#x27;</span>)</span><br></pre></td></tr></table></figure><h4 id="morgan-format-options"><a href="#morgan-format-options" class="headerlink" title="morgan(format, options)"></a>morgan(format, options)</h4><p>Create a new morgan logger middleware function using the given <code>format</code> and <code>options</code>.</p><p>The <code>format</code> argument amay be a string of a predefined name, a string fo a format string, or a function that will produce a log entry.</p><p>The <code>format</code> function will be called with three arguments <code>tokens</code>, <code>req</code> and <code>res</code>, where <code>tokens</code> is object with all tokens, <code>req</code> is the HTTP request and <code>res</code> is the HTTP response. The function is expected to return a string that will be the log line, or <code>undefined</code>/<code>null</code> to skip logging.</p><h4 id="predefined-format-string"><a href="#predefined-format-string" class="headerlink" title="predefined format string"></a>predefined format string</h4><blockquote><p><code>combined</code>: Standard Apache combined log output</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:remote-addr - :remote-user [:date[clf]] <span class="string">&quot;:method :url HTTP/:http-version&quot;</span> :status :res[content-length] <span class="string">&quot;:referrer&quot;</span> <span class="string">&quot;:user-agent&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p><code>common</code>: Standard Apache common log output</p></blockquote><blockquote><p><code>dev</code></p></blockquote><blockquote><p><code>short</code></p></blockquote><blockquote><p><code>tiny</code></p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:method :url :status :res[content-length] - :response-time ms</span><br></pre></td></tr></table></figure><h4 id="write-logs-to-a-file"><a href="#write-logs-to-a-file" class="headerlink" title="write logs to a file"></a>write logs to a file</h4><p>Single file</p><p>Simple app that will log all request in the Apache combined format to the file <code>access.log</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> morgan = <span class="built_in">require</span>(<span class="string">&#x27;koa-morgan&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> accessLogStream = fs.createWriteStream(__dirname + <span class="string">&#x27;/access.log&#x27;</span>, &#123; <span class="attr">flags</span>: <span class="string">&#x27;a&#x27;</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line"></span><br><span class="line"><span class="comment">// setup the logger</span></span><br><span class="line"></span><br><span class="line">app.use(morgan(<span class="string">&#x27;combined&#x27;</span>, &#123; <span class="attr">stream</span>: accessLogStream &#125;))</span><br><span class="line"></span><br><span class="line">app.use(<span class="function">(<span class="params">ctx</span>) =&gt;</span> &#123;</span><br><span class="line">  ctx.body = <span class="string">&#x27;hello world&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure><h3 id="koa-session"><a href="#koa-session" class="headerlink" title="koa-session"></a>koa-session</h3><p>Simple session middleware for koa. Default is cookie-based session and support external store.</p><p><em>Require Node 7.6 or greater for asycn/await support</em></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> session = <span class="built_in">require</span>(<span class="string">&#x27;koa-session&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line"></span><br><span class="line">app.keys = [<span class="string">&#x27;some secret hurr&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> CONFIG = &#123;</span><br><span class="line">  key: <span class="string">&#x27;koa:sess&#x27;</span>, <span class="comment">// (string) cookie key, default is koa:sess</span></span><br><span class="line">  maxAge: <span class="number">86400000</span>, <span class="comment">// (number) in ms, default is 1 day,</span></span><br><span class="line">  overWrite: <span class="literal">true</span>, <span class="comment">// (boolean) can overwrite or not, default true</span></span><br><span class="line">  httpOnly: <span class="literal">true</span>, <span class="comment">// (boolean) httpOnly or not, default true</span></span><br><span class="line">  signed: <span class="literal">true</span>, <span class="comment">// (boolean) signed or not, default true</span></span><br><span class="line">  rolling: <span class="literal">false</span>, <span class="comment">// (boolean) Force a session identifier cookie to be set on every response. The expiration is reset to the original maxAge.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.use(session(CONFIG, app)) <span class="comment">// or if you prefer to default config, you can use =&gt; app.use(session(app))</span></span><br><span class="line"></span><br><span class="line">app.use(<span class="function"><span class="params">ctx</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (ctx.path === <span class="string">&#x27;/favicon.ico&#x27;</span>) <span class="keyword">return</span></span><br><span class="line">  <span class="keyword">let</span> n = ctx.session.views || <span class="number">0</span></span><br><span class="line">  ctx.session.views = ++n</span><br><span class="line">  ctx.body = n + <span class="string">&#x27; views&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;listening on port 3000&#x27;</span>)</span><br></pre></td></tr></table></figure><h4 id="Options-1"><a href="#Options-1" class="headerlink" title="Options"></a>Options</h4><p>The cookie name is controlled by the key option, which default to ‘koa:sess’. All other options are passed to <code>ctx.cookies.get()</code> and <code>ctx.cookies.set()</code> allowing you to control security, domain, path and signing among other setting.</p>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git Merge and Rebase</title>
      <link href="/2017/06/14/git-merge-and-rebase/"/>
      <url>/2017/06/14/git-merge-and-rebase/</url>
      
        <content type="html"><![CDATA[<h1 id="Conceptual-Overview"><a href="#Conceptual-Overview" class="headerlink" title="Conceptual Overview"></a>Conceptual Overview</h1><p>The first thing to understand about <code>git rebase</code> is that it solves the same problem as <code>git merge</code>. Both of these commands are designed to integrate changes from one branch into another branch – they just do it in very different ways.</p><p>Consider what happens when you start working on a new feature in a dedicated branch, then another team member updates the <code>master</code> branch with new commits. The results in a forked history which should be familiar to anyone who has used Git as a collaboration tool.</p><p><img src="https://wac-cdn-a.atlassian.com/dam/jcr:01b0b04e-64f3-4659-af21-c4d86bc7cb0b/01.svg?cdnVersion=ey"></p><p>Now, let’s say that the new commits in <code>master</code> are relevant to the feature that you’re working on. To incorporate the new commits into your <code>feature</code> branch, you have two options: <code>mergin</code>or <code>rebasing</code>.</p><h1 id="The-Merge-Option"><a href="#The-Merge-Option" class="headerlink" title="The Merge Option"></a>The Merge Option</h1><p>The easiest option is to merge the <code>master</code> branch into the <code>feature</code> branch using something like the following:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git checkout feature</span><br><span class="line">git merge master</span><br></pre></td></tr></table></figure><p>Or you can condense this to a one-liner:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git merge master feature</span><br></pre></td></tr></table></figure><p>This creates a new <code>merge commit</code> in the <code>feature</code> branch that ties together the histories of the both branches, giving you a branch structure that looks like this:</p><p><img src="https://wac-cdn-a.atlassian.com/dam/jcr:e229fef6-2c2f-4a4f-b270-e1e1baa94055/02.svg?cdnVersion=ey"></p><p>Merging is nice because it’s a <code>non-destructive</code> operation. The existing branches are not changed in any way. This avoids all of the potential pitfalls of rebasing.</p><p>On the other hand, this also means that the <code>feature</code> branch will have an extraneous merge commit every time you need to incorporate upstream changes. If <code>master</code> is very active, this can pollute your <code>feature</code> branch history quite a bit. While it’s possible to migrate this issue with advanced <code>git log</code> options, it can make it hard to other developers to understand the history of the project.</p><h1 id="The-Rebase-Option"><a href="#The-Rebase-Option" class="headerlink" title="The Rebase Option"></a>The Rebase Option</h1><p>As an alternative to merge, you can rebase the <code>feature</code> branch onto <code>master</code> branch using the following commands:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git checkout feature</span><br><span class="line">git rebase master</span><br></pre></td></tr></table></figure><p>This moves the entire <code>feature</code> branch to begin on the top of the <code>master</code> branch, effectively incorporating all of the new commits in <code>master</code>. But, instead of using a merge commit, rebasing <code>re-writes</code> the project history by creating brand new commits for each commit in the original branch.</p><p><img src="https://wac-cdn-a.atlassian.com/dam/jcr:5b153a22-38be-40d0-aec8-5f2fffc771e5/03.svg?cdnVersion=ey"></p><p>The major benefit of rebasing is that you get a much cleaner project history. First, it eliminates the unnecessary merge commits required by <code>git merge</code>. Second, as you can see in the above diagram, rebasing also results in a perfectly linear project history – you can follow the top of <code>feature</code> all the way to the beginning of the project without any forks. This makes it easier to navigate your project with commands like <code>git log</code>.</p><h1 id="Interactive-Rebasing"><a href="#Interactive-Rebasing" class="headerlink" title="Interactive Rebasing"></a>Interactive Rebasing</h1><p>Interactive rebasing gives you the opportunity to alter commits as they are moved to the new branch. This is even more powerful than an automated rebase, since it offers complete control over the branch’s commit history. Typically, this is used to clean up a messy history before merging a feature branch into <code>master</code>.</p><p>To begin an interactive rebasing session, pass the <code>-i</code> option to the <code>git rebase</code> command.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git checkout feature</span><br><span class="line">git rebase -i master</span><br></pre></td></tr></table></figure><p>This will open a text editor listing all of the commits that are about to be moved:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pick 33d5b7a Message <span class="keyword">for</span> commit <span class="comment">#1</span></span><br><span class="line">pick 9480b3d Message <span class="keyword">for</span> commit <span class="comment">#2</span></span><br><span class="line">pick 5c67e61 Message <span class="keyword">for</span> commit <span class="comment">#3</span></span><br></pre></td></tr></table></figure><p>This listing defines exactly what the branch will look like after the rebase is performed. By changing the <code>pick</code> command and/or reordering the entries, you can make the branch’s history look like whatever you want.</p><p>For example, if the 2nd commit fixes a small problem in the 1st commit, you can condense them into a single comit with the <code>fixup</code> command:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pick 33d5b7a Message <span class="keyword">for</span> commit <span class="comment">#1</span></span><br><span class="line">fixup 9480b3d Message <span class="keyword">for</span> commit <span class="comment">#2</span></span><br><span class="line">pick 5c67e61 Message <span class="keyword">for</span> commit <span class="comment">#3</span></span><br></pre></td></tr></table></figure><p>When you save and close the file, Git will perform the rebase according to your instructions, resulting in project history that looks like the following:</p><p><img src="https://wac-cdn-a.atlassian.com/dam/jcr:fe6942b4-7a60-4464-9181-b67e59e50788/04.svg?cdnVersion=ey"></p><p>Eliminating insignificant commits like this makes your feature’s history much easier to understand. <strong>This is something that <code>git merge</code> simply cannot do</strong>.</p><h1 id="The-Golden-Rule-of-Rebasing"><a href="#The-Golden-Rule-of-Rebasing" class="headerlink" title="The Golden Rule of Rebasing"></a>The Golden Rule of Rebasing</h1><p>The Golden Rule of <code>git rebase</code> is to never use it on <em>public</em> branches.</p><p>For example, think about what would happen if you rebased <code>master</code> onto your <code>feature</code> branch.</p><p><img src="https://wac-cdn-a.atlassian.com/dam/jcr:1d22f018-b2c7-4096-9db1-c54940cf4f4e/05.svg?cdnVersion=ey"></p><p>The rebase moves all of the commits in <code>master</code> onto the tip of <code>feature</code>. The problem is that only happened in <em>your</em> repo. All of the other developers are still working with the origin master. Since rebasing results in brand new commits, Git will think that your <code>master</code> branch’s history has diverged from everybody else’s.</p><p>The only way to synchronize the two <code>master</code> branches is to merge them back together, resulting in an extra merge commit <strong>and</strong> two sets of commits that contain the same changes.</p>]]></content>
      
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Type Compatibility in TypeScript</title>
      <link href="/2017/06/12/Type-Compatibility-in-TypeScript/"/>
      <url>/2017/06/12/Type-Compatibility-in-TypeScript/</url>
      
        <content type="html"><![CDATA[<p>Type Compaibility in TypeScript is based on <strong>Structural Subtyping</strong>. Structural Typing is a way of relating types based solely on their members. This is in contrast with nominal typing. Consider the following code:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">interface Named &#123;</span><br><span class="line">  name: string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  name: string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> p: Named</span><br><span class="line"><span class="comment">// OK, because of structural typing</span></span><br><span class="line">p = <span class="keyword">new</span> Person()</span><br></pre></td></tr></table></figure><p>In nominally-typed language like C# or Java, the equivalnet code would be error because the <code>Person</code> class does not explicitly describe itself as being an implementor of the <code>Named</code> interface.</p><p>TypeScript’s structural type system was designed based on how JavaScript code is typically written. Because JavaScript widely uses anonymous objects like function expressions and object literals, it’s much more natural to represent the kinds of relationship found in JavaScript libraries with a structural type system instead of a nominal one.</p><p>The basic rule for TypeScript’s structural type system is the <code>x</code> is compatible with <code>y</code> if <code>y</code> has at least the same members as <code>x</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">interface Named &#123;</span><br><span class="line">  name: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> x: Named;</span><br><span class="line"><span class="comment">// y&#x27;s inferred type is &#123; name: string, location: string &#125;</span></span><br><span class="line"><span class="keyword">let</span> y = &#123; <span class="attr">name</span>: <span class="string">&#x27;Alice&#x27;</span>, <span class="attr">location</span>: <span class="string">&#x27;Seattle&#x27;</span> &#125;</span><br><span class="line">x = y</span><br></pre></td></tr></table></figure><p>To check whether <code>y</code> can be assigned to <code>x</code>, the compiler checks each property of <code>x</code> to find a corresponding compatible property in <code>y</code>. In this case, <code>y</code> must have a member called <code>name</code> that is a string, so the assignment is allowed.</p><p>The same rule for assignment is used when checking function call arguments</p><blockquote><p>The Type Compatibility in Variable Assignment and Function Arguments.</p></blockquote><h1 id="Comparing-Two-Functions"><a href="#Comparing-Two-Functions" class="headerlink" title="Comparing Two Functions"></a>Comparing Two Functions</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> x = <span class="function">(<span class="params">a: number</span>) =&gt;</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">let</span> y = <span class="function">(<span class="params">b: number, s: string</span>) =&gt;</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">y = x <span class="comment">// OK</span></span><br><span class="line">x = y <span class="comment">// Error</span></span><br></pre></td></tr></table></figure><p>The check if <code>x</code> is assignable to <code>y</code>, we first look at the parameter list. Each parameter in <code>x</code> must have a corresponding parameter in <code>y</code> with a compabile type.</p><p>So <code>x</code> is assignable to <code>y</code>, but <code>y</code> is not assignable to <code>x</code></p><p>Now let’s look at how return types are treated, using two functions that differs only by their return type:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> x = <span class="function">() =&gt;</span> (&#123; <span class="attr">name</span>: <span class="string">&#x27;Alice&#x27;</span> &#125;)</span><br><span class="line"><span class="keyword">let</span> y = <span class="function">() =&gt;</span> (&#123; <span class="attr">name</span>: <span class="string">&#x27;Alice&#x27;</span>, <span class="attr">location</span>: <span class="string">&#x27;Seattle&#x27;</span> &#125;)</span><br><span class="line"></span><br><span class="line">x = y <span class="comment">// OK</span></span><br><span class="line">y = x <span class="comment">// Error</span></span><br></pre></td></tr></table></figure><p>The type system enforces that the source function’s return type be a subtype of the target type’s return type.</p>]]></content>
      
      
      
        <tags>
            
            <tag> TypeScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mannual of Ownership in Rust </title>
      <link href="/2017/06/09/mannual-of-ownership-in-rust/"/>
      <url>/2017/06/09/mannual-of-ownership-in-rust/</url>
      
        <content type="html"><![CDATA[<p>Ownership is Rust’s most unique feature, and it enables Rust to make memory safety guarantees without needing a garbage collector. Therefore, it’s important to understand how ownership works in Rust. In this chapter we’ll talk about ownership as well as several related features: borrowing, slices, and how Rust lays data out in memory.</p><h1 id="What-is-Ownership"><a href="#What-is-Ownership" class="headerlink" title="What is Ownership"></a>What is Ownership</h1><p>Rust’s central feature is <em>ownership</em>, although the feature is staightforward to explain, it has deep implications of the rest of the language.</p><p>All programs have to manage the way they use a computer’s memory while running. Some languages ahve garbage collecion that constantly looks for no longer used memory as the program runs. In other languages, the programmer must explicitly allocate and free the memory. Rust uses a third approach: <strong>memory is managed through a system of ownership with a set of rules that the compiler checks at compile time.</strong> No run-time costs are iccured for any of the ownership features.</p><p>Because ownership is a new concept for many programmers, it does take some time to get used to. The good news is that the more experienced you become with Rust and the rules of the ownership system, the more you’ll be able to naturally develop code that is safe and efficient.</p><h1 id="Ownership-Rules"><a href="#Ownership-Rules" class="headerlink" title="Ownership Rules"></a>Ownership Rules</h1><p>First, let’s take a look at the ownership rules.</p><blockquote><ol><li>Each Value in Rust has a variable that’s called its <em>owner</em>.</li></ol></blockquote><blockquote><ol start="2"><li>There can only be one owner at a time.</li></ol></blockquote><blockquote><ol start="3"><li>When the owner goes out of scope, the value will be dropped.</li></ol></blockquote><h1 id="Variable-Scope"><a href="#Variable-Scope" class="headerlink" title="Variable Scope"></a>Variable Scope</h1><p>A scope is the range within a program for which an item is valid.</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span> </span>() &#123;</span><br><span class="line">  <span class="keyword">let</span> s = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The variable <code>s</code> refers to a string literal, where the value of the string is hardcoded into the text of our program. The variable is valid from the point at which it’s declared until the end of the current <em>scope</em>.</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;                       <span class="comment">// s is not valid here</span></span><br><span class="line">  <span class="keyword">let</span> s = <span class="string">&quot;hello&quot;</span>;      <span class="comment">// s is valid here</span></span><br><span class="line">&#125;                       <span class="comment">// the scope is over, and s is no longer valid.</span></span><br></pre></td></tr></table></figure><ul><li><p>When <code>s</code> comes <em>into scope</em> it is valid</p></li><li><p>It remains so until it goes <em>out of scope</em></p></li></ul><p>At this point, the relationship between scopes and the valid variables are valid is similar to other programming languages. Now we’ll build on top of this understanding by introducing the <code>String</code> type.</p><h1 id="The-String-Type"><a href="#The-String-Type" class="headerlink" title="The String Type"></a>The String Type</h1><p>To illustrate the rules of ownership, we need a data type that is complex.</p><p>We’ll use <code>String</code> as the example here and concentrate on the parts of <code>String</code> that relate to ownership. These aspects also apply to other complex data types provided by the standard library and that you create.</p><p>We’ve already seen string literals, where a string value is hardcoded into our program. String literals are conveient, but they aren’t always suitable for every situation in which you want to use text. One reason is that they’re immutable. Another is that not every string value can be known when we write our code. For these situations, Rust has a second string type, <code>String</code>. This type is allocated on the heap and as such is able to store an amount of text that is unknown to us at compile time. You can create a <code>String</code> from a string literal using the <code>from</code> function, like so:</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="built_in">String</span>::from(<span class="string">&quot;hello&quot;</span>)</span><br></pre></td></tr></table></figure><p>The double colon(<code>::</code>) is an operator that allows us to namespace this particular <code>from</code> function under the <code>String</code> type rather than using some sort of name like <code>string_from</code>.</p><p>This kind of string <em>can</em> be mutated:</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut</span> s = <span class="built_in">String</span>::from(<span class="symbol">&#x27;Hello</span>&#x27;)</span><br><span class="line">s.push_str(<span class="string">&quot;, world!&quot;</span>)</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, s);</span><br></pre></td></tr></table></figure><p>So why can <code>String</code> be mutated but literals cannot.</p><h1 id="Memory-and-Allocation"><a href="#Memory-and-Allocation" class="headerlink" title="Memory and Allocation"></a>Memory and Allocation</h1><p>In the case of a string literal, <em>we know the contents at compile</em> so the text is hardcoded directly in to the final executable, making string literals fast and efficient. But these properties only come from its immutability. Unfortunately, <em>we can’t put a blob of memory into the binary for each piece of text whose size is unknown at compile time</em> and whose size might change while running the program.</p><p>With the <code>String</code> type, in order to support a mutable, growable piece of text, we need to allocate an amount of memory on the heap, unknown at compile time, to hold the contents. This means:</p><ul><li><p>The memory must be requested from the operating system at runtime.</p></li><li><p>We need a way of returning this memory to the operating system when we’re done with our <code>String</code></p></li></ul><p>That first part is done by us: when we call <code>String::from</code>, its implementation requests the memory if needs. This is pretty much universal in programming languages.</p><p>However, the second part is different. In languages with a <code>garbage collector(GC)</code>, the GC keeps track and cleans up memory that isn’t being used anymore, and we, as the programmer, don’t need to think about it. Without a GC, it’s the programmer’s responsibility to identify when memory is no longer being used and call code to explicitly return it, just as we did to request it. Doing this correctly has historically been a difficult programming problem. If we forget, we’ll waste memory. If we do it too early, we’ll have an invalid vairable. If we do it twice, that’s a bug too. We need to pair exactly one <code>allocate</code> with exact one <code>free</code></p><p>Rust takes a different path: the memory is automatically returned once the variable that owns it goes out of scope.</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="keyword">let</span> s = <span class="built_in">String</span>::from(<span class="string">&quot;Helloe&quot;</span>); <span class="comment">// s is valid from this point</span></span><br><span class="line"></span><br><span class="line">&#125;  <span class="comment">// the scope is over</span></span><br></pre></td></tr></table></figure><p>These is a natural point at which we can return the memory our <code>String</code> needs to operating system: when <code>s</code> goes out of scope. When a variables goes out of scope, Rust calls a special function for us. This function is called <code>drop</code>, and it’s where the author of <code>String</code> can put the code to return the memory. Rust calls <code>drop</code> automatically at the closing <code>&#125;</code>.</p><blockquote><p>Note: In C++, this pattern of deallocating resources at the end of an item’s lifetime is sometimes called <em>Resource Acquisition Is Initialization(RAII)</em>. The <code>drop</code> function in Rust will be familiar to you if you’ve used RAII patterns.</p></blockquote><p>This patterns has profound impact on the way Rust code is written. It may seem simple right now, but the behavior of code can be unexpected in more complicated situations when we want to have multiple variables use the data we’ve allocated ont the heap.</p><h1 id="Ways-Variables-and-Data-Interact-Move"><a href="#Ways-Variables-and-Data-Interact-Move" class="headerlink" title="Ways Variables and Data Interact: Move"></a>Ways Variables and Data Interact: Move</h1><p>Multiple variables can interact with the same data in different ways in Rust. Let’s look at an example using an integer.</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> x = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">let</span> y = x;</span><br></pre></td></tr></table></figure><p>Here we got two independent variables <code>x</code> and <code>y</code>, this is because integers are simple values with a known, fixed size, and two <code>5</code> are pushed onto the stack.</p><p>Now let’s look at the <code>String</code> version.</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s1 = <span class="built_in">String</span>::from(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> s2 = s1;</span><br></pre></td></tr></table></figure><p>This looks very similar to the previous code, so we might assume that the way it works would be the same: that is, the second line would make a copy of the value in <code>s1</code> and bind it to <code>s2</code>. But this isn’t quite what happens.</p><p>To explain this more thoroughly, let’s look at what <code>String</code> looks like under the covers in the Figure.</p><p><img src="https://doc.rust-lang.org/book/second-edition/img/trpl04-01.svg"></p><p>A <code>String</code> is made up of three parts, shown on the left: a pointer to the memory that holds the contents of the string, a length, and a capacity. This group of data is stored on the stack. On the right is the memory on the heap that holds the contents.</p><p>The length is how much memory, in bytes, the contents of the <code>String</code> is currently using. The capacity is the total amount of memory, in bytes, that the <code>String</code> has received from the operating system. The difference between length and capacity matters, but not in this context, so far now, it’s fine to ignore the capacity.</p><p>When we assign <code>s1</code> to <code>s2</code>, the <code>String</code> data is copied, meaning we copy the pointer, the length and the capacity that are on the stack. We do not copy the data on the heap that the pointer refers to. In other words, the data representation in memory looks like the figure following.</p><p><img src="https://doc.rust-lang.org/book/second-edition/img/trpl04-02.svg"></p><p>Eariler, we said that when a variable goes out of scope, Rust automatically calls the <code>drop</code> function and cleans up the heap memory for the variable. But the fact is that both data pointers pointing to the same location. This is a problem: when <code>s2</code> and <code>s1</code> go out of scope, they will both try to free the same memory. This is known as a <em>double free</em> error. Freeing memory twice can lead to memory corruption, which can potentially lead to security vulnerabilities.</p><p>To ensure memory safety, there’s one more detail to what happens in this situation in Rust. Instead of trying to copy the allocated memory, Rust considers <code>s1</code> to no longer be valid and therefore, Rust doesn’t need to free anything when <code>s1</code> goes out of scope. Check out what happens when you try to use <code>s1</code> after <code>s2</code> is created.</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s1 = <span class="built_in">String</span>::from(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> s2 = s1;</span><br><span class="line"></span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, s1);</span><br></pre></td></tr></table></figure><p>You’ll get an error like this because Rust prevents you from using the invalidated reference:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">error[E0382]: use of moved value: `s1`</span><br><span class="line"> --&gt; src/main.rs:4:27</span><br><span class="line">  |</span><br><span class="line">3 |  <span class="built_in">let</span> s2 = s1;</span><br><span class="line">  |     -- value moved here</span><br><span class="line">4 |  println!(<span class="string">&quot;&#123;&#125;&quot;</span>, s1);</span><br><span class="line">  |                 ^^ value used here after move</span><br><span class="line">  |</span><br><span class="line">  = note: move occurs because `s1` has <span class="built_in">type</span> `std::string::String`,</span><br><span class="line"><span class="built_in">which</span> does not implement the `Copy` trait</span><br></pre></td></tr></table></figure><p>This action in Rust, similar to <code>shallow copy</code>, it copy pointer, length and capacity in stack, but Rust also invalidates the first variable.</p><p>We call it <code>move</code>.</p><p><img src="https://doc.rust-lang.org/book/second-edition/img/trpl04-04.svg"></p><p><code>s1</code> has been invalidated.</p><p>That solves our problem, with only <code>s2</code> valid, when it goes out of scope, it alone will freee the memory, and we’re done.</p><p>In addition, there’s a design choice that’s implied by this: Rust will never automatically create ‘deep’ copies of your data. Therefore, any <em>automatic</em> copying can be assumed to be inexpensive in terms of runtime performance.</p><h1 id="Ways-Variables-and-Data-Interact-Clone"><a href="#Ways-Variables-and-Data-Interact-Clone" class="headerlink" title="Ways Variables and Data Interact: Clone"></a>Ways Variables and Data Interact: Clone</h1><p>If we do want to deeply copy the heap data of the <code>String</code>, not just the stack data, we can use a common method called <code>clone</code>.</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s1 = <span class="built_in">String</span>::from(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> s2 = s1.clone();</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;s1 = &#123;&#125;, s2 = &#123;&#125;&quot;</span>, s1, s2);</span><br></pre></td></tr></table></figure><p>This works just fine, the heap data does get copied.</p><p>When you see a call to <code>clone</code>, you know that some arbitrary code is being executed and that code may be expensive. It’s a visual indicator that something different is going on.</p><h1 id="Stack-Only-Data-Copy"><a href="#Stack-Only-Data-Copy" class="headerlink" title="Stack-Only Data: Copy"></a>Stack-Only Data: Copy</h1><p>There’s another wrinkle we haven’t talked about yet. This code using integers.</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> x = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">let</span> y = x;</span><br><span class="line"></span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;x = &#123;&#125;, y = &#123;&#125;&quot;</span>, x, y);</span><br></pre></td></tr></table></figure><p>This code runs correctly because those types like integers that have a <strong>known size</strong> at compile time are stored entirely on the stack, so copied of the actual values are quick to make. That means there’s no reason we would want to prevent <code>x</code> from being valid after we created the variable <code>y</code>. In other words, there’s no difference between deep and shallow copying here, so calling <code>clone</code> wouldn’t do anything differently from the usual shallow copying and we can leave it out.</p><p>Rust has a special annotation called the <code>Copy</code> trait that we can place on types like integers that are stored on stack.</p><p>If a type has the <code>Copy</code> trait, an older variable is still usable after the assignment. Rust won’t let us annotate a type with the <code>Copy</code> trait if the type, or any of its parts, has implemented the <code>Drop</code> trait. If the type needs something special to happen when the value goes out of scope and we add the <code>Copy</code> annotation to that type, we’ll get a compile time error.</p><p>As a general rule, any group of simple scalar values can be <code>Copy</code>, and nothing that requires allocation or is some form of resource is <code>Copy</code>. Here are some of the types that are <code>Copy</code>:</p><ul><li><p>All the integer types</p></li><li><p>The boolean type</p></li><li><p>All the floating point types</p></li><li><p>Tuples, but only if they contain types a also <code>Copy</code>.</p></li></ul><h1 id="Ownership-and-Functions"><a href="#Ownership-and-Functions" class="headerlink" title="Ownership and Functions"></a>Ownership and Functions</h1><p><strong>The semantics for passing a value to a function are similar to assigning a value to a variable.</strong> Passing a variable to a function <strong>will move or copy</strong>, just like assignment.</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span> </span>() &#123;</span><br><span class="line">  <span class="keyword">let</span> s = <span class="built_in">String</span>::from(<span class="string">&quot;Hello&quot;</span>); <span class="comment">// s comes into scope</span></span><br><span class="line"></span><br><span class="line">  take_ownership(s); <span class="comment">// s&#x27;s value moves into the function</span></span><br><span class="line">                     <span class="comment">// s is no longer valid here</span></span><br><span class="line">  <span class="keyword">let</span> x = <span class="number">5</span>;         <span class="comment">// x comes into scope</span></span><br><span class="line"></span><br><span class="line">  make_copy(x);      <span class="comment">// x would move into the function, but i32 is Copy, so it&#x27;s okay to still use x afterward.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">take_ownership</span> </span>(some_string: <span class="built_in">String</span>) &#123; <span class="comment">// some_string comes into scope</span></span><br><span class="line">  <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, some_string);</span><br><span class="line">&#125; <span class="comment">// here, some_string goes out of scope and `drop` is called. The backing memory is freed.</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">make_copy</span> </span>(some_integer: <span class="built_in">i32</span>) &#123; <span class="comment">//  some_integer comes into scope</span></span><br><span class="line">  <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, some_integer);</span><br><span class="line">&#125; <span class="comment">// Here some_integer goes out of scope.</span></span><br></pre></td></tr></table></figure><p>If we tried to use <code>s</code> after the call to <code>take_ownership</code>, Rust would throw a compile time error. These static checks protect us from mistakes.</p><h1 id="Return-Values-and-Scope"><a href="#Return-Values-and-Scope" class="headerlink" title="Return Values and Scope"></a>Return Values and Scope</h1><p>Returning values can also transfer ownership.</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span> </span>() &#123;</span><br><span class="line">  <span class="keyword">let</span> s1 = give_ownership(); <span class="comment">// give_ownership moves its return value into s1</span></span><br><span class="line">  <span class="keyword">let</span> s2 = <span class="built_in">String</span>::from(<span class="string">&quot;Hello&quot;</span>); <span class="comment">// s2 comes into scope</span></span><br><span class="line">  <span class="keyword">let</span> s2 = take_and_give_back(s2); <span class="comment">// s2 is moved into take_and_give_back, which aslo move its returned value into s2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">give_ownership</span> </span>() -&gt; <span class="built_in">String</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> some_string = <span class="built_in">String</span>::from(<span class="string">&quot;Hello&quot;</span>); <span class="comment">// some_string comes into scope</span></span><br><span class="line">  some_string      <span class="comment">// some_string is returned and moves out to the calling function</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">take_and_give_back</span></span>(a_string: <span class="built_in">String</span>) -&gt; &#123; <span class="comment">// a_string comes into scope</span></span><br><span class="line">  a_string <span class="comment">// a_string is returned and moves out to the calling function</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>It’s possible to return mutiple values using a tuple.</p><h2 id="Reference-and-Borrowing"><a href="#Reference-and-Borrowing" class="headerlink" title="Reference and Borrowing"></a>Reference and Borrowing</h2><p>Here is how you would define and use a <code>calculate_length</code> function that has a <em>reference</em> to an object as a parameter instead of taking ownership of the value.</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span> </span>() &#123;</span><br><span class="line">  <span class="keyword">let</span> s1 = <span class="built_in">String</span>::from(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> len = calculate_length(&amp;s1);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">println!</span>(<span class="string">&quot;The length of &#x27;&#123;&#125;&#x27; is &#123;&#125;.&quot;</span>, s1, len);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">calculate_length</span></span>(s: &amp;<span class="built_in">String</span>) - <span class="built_in">usize</span> &#123;</span><br><span class="line">  s.len()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>First notice that all the tuple code in the variable declaration and the function return value is gone. Second, note that we pass <code>&amp;s1</code> into <code>calculate_length</code>, and in its definition, we take <code>&amp;String</code> rather than <code>String</code>.</p><p>These ampersands(&amp;) are <em>reference</em>, and they allow you to refer to some value without taking ownership of it.</p><p><img src="https://doc.rust-lang.org/book/second-edition/img/trpl04-05.svg"></p><p>In this figure, <code>&amp;String s</code> pointing to <code>String s1</code></p><p>Let’s take a closer look at the function call here:</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s1 = <span class="built_in">String</span>::from(<span class="string">&quot;Hello&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> len = calculate_length(&amp;s1)</span><br></pre></td></tr></table></figure><p>The <code>&amp;s1</code> syntax lets us create a reference that <em>refer</em> to the value of <code>s1</code>, but does not own it.</p><p><strong>Because it does not own it, the value it points to will not be dropped when the reference goes out of scope.</strong></p><p>Likewise, the signature of the function uses <code>&amp;</code> to indicate that the type of the paramter <code>s</code> is a reference.</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">calculate_length</span></span>(s: &amp;<span class="built_in">String</span>) -&gt; <span class="built_in">usize</span> &#123; <span class="comment">// s is a reference to a String</span></span><br><span class="line">  s.len()</span><br><span class="line">&#125; <span class="comment">// Here, s goes out of the scope. But because it does not have ownership of what it refers to, no drop happens.</span></span><br></pre></td></tr></table></figure><p>The scope in which the variable <code>s</code> is valid is the same as any function parameter’s scope, but we don’t drop what the reference points to when it goes out of scope because we don’t have ownership.</p><p>Functions that have references as parameters instead of the actual values mean we won’t need to return the values in order to give back ownership, since we never had ownership.</p><p>We call having references as function paramters <code>borrowing</code>. As in real life, if a person owns something, you can borrow it from them, When you’re done, you have to give it back.</p><p>If we try to modify something we’re borrowing, it won’t work.</p><h2 id="Mutable-References"><a href="#Mutable-References" class="headerlink" title="Mutable References"></a>Mutable References</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span> </span>() &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="keyword">mut</span> s = <span class="built_in">String</span>::from(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">  change(&amp;<span class="keyword">mut</span> s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">change</span></span>(some_string: &amp;<span class="keyword">mut</span> <span class="built_in">String</span>) &#123;</span><br><span class="line">  some_string.push_str(&#x27;, world&#x27;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>First, we had to change <code>s</code> to be <code>mut</code>. Then we had to create mutable reference with <code>&amp;mut s</code> and accept a mutable reference with <code>some_string: &amp;mut String</code>.</p><p>But mutable references have one big restriction: you can only mutable reference to a particular piece of data in a particular scope.</p><p>This restriction allows for mutation but in a very controlled fashion. It’s something that new Rustaceans struggle with, because most languages let you mutate whenever you’d like. The benefit of having this restriction is that <em>Rust can prevent data races at compile time</em>.</p><p>A <code>data race</code> is a particular type of race condition in which these three behaviors occur:</p><ul><li><p>Two or more pointers access the same data at the same time.</p></li><li><p>At least one of the pointers is being used to write to the data.</p></li><li><p>There’s no mechanism being used to synchrnize access to the data.</p></li></ul><p>Data races cause undefined behavior and can be difficult to diagnose and fix when you’re trying to track them down at runtime. Rust prevents this problem from happening because it won’t even compile code with data race.</p><p>As always, we can use curly brackets to create a new scope, allowing for multiple mutable references, just not <em>simultaneous</em> ones:</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut</span> s = <span class="built_in">String</span>::from(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">let</span> r1 = &amp;<span class="keyword">mut</span> s;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> r2 = &amp;<span class="keyword">mut</span> s;</span><br></pre></td></tr></table></figure><p>A similar rule exists for combining mutable and immutable references. This code results in an error:</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut</span> s = <span class="built_in">String</span>::from(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> r1 = &amp;s; <span class="comment">// no problem</span></span><br><span class="line"><span class="keyword">let</span> r2 = &amp;s; <span class="comment">// no problem</span></span><br><span class="line"><span class="keyword">let</span> r3 = &amp;<span class="keyword">mut</span> s; <span class="comment">//BIG PROBLEM, mutable borrow occurs</span></span><br></pre></td></tr></table></figure><p>We also cannot have mutable reference while we have an immutable one.</p><p>Users of an immutable reference don’t expect the values to suddently change out from under them.</p><h2 id="Dangling-References"><a href="#Dangling-References" class="headerlink" title="Dangling References"></a>Dangling References</h2><p>In languages with pointers, it’s easy to erroneously to create a <em>dangling pointer</em>, a pointer that references a location in memory that may have been given to someone else, by freeing some memory while preserving a pointer to that memory. In Rust, by contrast, the compiler guarantees the references will never be dangling references: if we have a reference to some data, the compiler will ensure that the data will not go out of scope before reference to the data does.</p><h2 id="The-Rules-of-References"><a href="#The-Rules-of-References" class="headerlink" title="The Rules of References"></a>The Rules of References</h2><ul><li><p>At any given time, you can have <code>either</code> but not both of</p><ul><li><p>One mutable reference</p></li><li><p>Any number of immutable references</p></li></ul></li><li><p>Referecences must always be valid.</p></li></ul><h2 id="Slices"><a href="#Slices" class="headerlink" title="Slices"></a>Slices</h2><p>Another data type that doesn’t have ownership is the <code>slice</code>. Slices let you reference a configuous sequence of elements in a collection rather tahn the whole collection.</p><h2 id="String-Slice"><a href="#String-Slice" class="headerlink" title="String Slice"></a>String Slice</h2><p>A <em>string slice</em> is a reference to part of a <code>String</code>, and looks like this:</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="built_in">String</span>::from(<span class="string">&quot;Hello world&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> hello = &amp;s[<span class="number">0</span>..<span class="number">5</span>];</span><br><span class="line"><span class="keyword">let</span> world = &amp;s[<span class="number">6</span>..<span class="number">11</span>];</span><br></pre></td></tr></table></figure><p>This is similar to taking a reference to the whole <code>String</code>, but with the extra <code>[0..5]</code> but. Rather than a reference to the entire <code>String</code>, it’s a reference to an internal position in the <code>String</code> and the number of elements that it refers to.</p><p>We create slices with a range of <code>[start_index..end_index]</code>, but the slice data structure acutally <strong>stores the starting position and the length of the slice</strong>.</p><p>So in the case of <code>let world = &amp;s[6..11];</code>, <code>world</code> would be a slice that contains a pointer to the 6th byte of <code>s</code> and a length of value of 5.</p><p><img src="https://doc.rust-lang.org/book/second-edition/img/trpl04-06.svg"></p><p>With Rust’s <code>..</code> range syntax, if you want to start at the first index(0), you can drop the value before the two periods. In other words</p><p>By the same token, if your slice includes the last byte of the <code>String</code>, you can drop the trailing number.</p><p>You can also drop both values to take a slice of the entire string.</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">first_word</span> </span>(s: &amp;<span class="built_in">String</span>) -&gt; &amp;<span class="built_in">str</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> bytes = s.as_bytes();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i, &amp;item) <span class="keyword">in</span> bytes.iter().enumerate() &#123;</span><br><span class="line">    <span class="keyword">if</span> item == <span class="string">b&#x27; &#x27;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> &amp;s[<span class="number">0</span>..i]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  &amp;s[..]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="String-Literals-Are-Slices"><a href="#String-Literals-Are-Slices" class="headerlink" title="String Literals Are Slices"></a>String Literals Are Slices</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="string">&quot;Hello, World&quot;</span>;</span><br></pre></td></tr></table></figure><p>The type of <code>s</code> here is <code>&amp;str</code>: it’s a slice pointing to the specific point of the binary. This is also why string literals are immutable; <code>&amp;str</code> is an immutable reference.</p><h2 id="String-Slices-as-Parameters"><a href="#String-Slices-as-Parameters" class="headerlink" title="String Slices as Parameters"></a>String Slices as Parameters</h2><p>Knowing that you can take slices of literals and <code>String</code>s leads us to one more improvement on <code>first_word</code>, and that’s its signature:</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">first_word</span></span>(s: &amp;<span class="built_in">String</span>) -&gt; &amp;<span class="built_in">str</span> &#123;</span><br></pre></td></tr></table></figure><p>If we have a string slice, we can pass that directly. If we have a <code>String</code>, we can pass a slice of the entire <code>String</code>. Defining a function to take a string slcie instead of a reference to a String makes our API more general and useful without losing any functionality.</p><h2 id="Other-Slices"><a href="#Other-Slices" class="headerlink" title="Other Slices"></a>Other Slices</h2><p>String slices, as you might imagine, are specific to strings. But there’s a more general slice type, too.</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"><span class="keyword">let</span> slice = &amp;a[<span class="number">1</span>..<span class="number">3</span>];</span><br></pre></td></tr></table></figure><p>This slice has the type <code>&amp;[i32]</code>. It works the same way as string slices do, by storing a reference to the first element and the length.</p>]]></content>
      
      
      
        <tags>
            
            <tag> Rust </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Basic Info of Web Worker</title>
      <link href="/2017/06/06/Basic-Info-of-Web-Worker/"/>
      <url>/2017/06/06/Basic-Info-of-Web-Worker/</url>
      
        <content type="html"><![CDATA[<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">var</span> worker = <span class="keyword">new</span> Worker (<span class="string">&#x27;worker.js&#x27;</span>)</span><br><span class="line">worker.postMessage() <span class="comment">// start the worker</span></span><br></pre></td></tr></table></figure><p>postMessage 方法可以接受字符串或 JSON 对象</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line">worker.addEventListener(<span class="string">&#x27;message&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;worker said: &#x27;</span>, e.data)</span><br><span class="line">&#125;, <span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line">worker.postMessage(<span class="string">&#x27;hello world&#x27;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// worker.js</span></span><br><span class="line">self.addEventListener(<span class="string">&#x27;message&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  self.postMessage(e.data)</span><br><span class="line">&#125;, <span class="literal">false</span>)</span><br></pre></td></tr></table></figure><p>index.js 中调用 postMessage() 时, worker.js 通过 message 时间处理消息, index.js 的有效信息在 e.data 上.</p><p>index.js 和 worker.js 传递的消息是幅值而不是共享(序列化+反序列化)</p><p>Example</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;sayHi()&quot;</span>&gt;</span>SayHi<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;unknownCmd()&quot;</span>&gt;</span>unknownCmd<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;stop()&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">output</span> <span class="attr">id</span>=<span class="string">&quot;result&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">output</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sayHi</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  worker.postMessage(&#123;</span><br><span class="line">    cmd: <span class="string">&#x27;start&#x27;</span>,</span><br><span class="line">    msg: <span class="string">&#x27;Hi&#x27;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">stop</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  worker.postMessage(&#123;</span><br><span class="line">    cmd: <span class="string">&#x27;stop&#x27;</span>,</span><br><span class="line">    msg: <span class="string">&#x27;Bye&#x27;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unknownCmd</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  worker.postMessage(&#123;</span><br><span class="line">    cmd: <span class="string">&#x27;foobar&#x27;</span>,</span><br><span class="line">    msg: <span class="string">&#x27;???&#x27;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> worker = <span class="keyword">new</span> Worker(<span class="string">&#x27;worker.js&#x27;</span>)</span><br><span class="line"></span><br><span class="line">worker.addEventListener(<span class="string">&#x27;message&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">&#x27;result&#x27;</span>).textContent = e.data</span><br><span class="line">&#125;, <span class="literal">false</span>)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// worker.js</span></span><br><span class="line">self.addEventListener(<span class="string">&#x27;message&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> data = e.data</span><br><span class="line">  <span class="keyword">switch</span> (data.cmd) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;start&#x27;</span>: &#123;</span><br><span class="line">      self.postMessage(<span class="string">&#x27;WORKER STARTED: &#x27;</span> + data.msg)</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;stop&#x27;</span>: &#123;</span><br><span class="line">      self.postMessage(<span class="string">&#x27;WORKER STOPPED: &#x27;</span> + data.msg + <span class="string">&#x27;. (buttons will no longer work)&#x27;</span>)</span><br><span class="line">      self.close()</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">default</span>: &#123;</span><br><span class="line">      self.postMessage(<span class="string">&#x27;Unknown command: &#x27;</span> + data.msg)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;, <span class="literal">false</span>)</span><br></pre></td></tr></table></figure><p>停止 worker 的方法两种</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line">worker.terminate()</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// worker.js</span></span><br><span class="line">self.close()</span><br></pre></td></tr></table></figure><h1 id="Worker-环境"><a href="#Worker-环境" class="headerlink" title="Worker 环境"></a>Worker 环境</h1><h2 id="Worker-作用域"><a href="#Worker-作用域" class="headerlink" title="Worker 作用域"></a>Worker 作用域</h2><p>在 worker.js 中, self 和 this 都是指 worker 的全局作用域</p><h1 id="适用于-worker-的功能"><a href="#适用于-worker-的功能" class="headerlink" title="适用于 worker 的功能"></a>适用于 worker 的功能</h1><p>由于web worker 的多线程行为, 所以他们只能使用 js 功能的子集</p><ul><li><p>navigator 对象</p></li><li><p>location 对象</p></li><li><p>XMLHttpResponse</p></li><li><p>setTimeout() / clearTimeout() / setInterval() / clearInterval()</p></li><li><p>应用缓存</p></li><li><p>使用 importScripts() 方法导入外部脚本</p></li><li><p>生成其他 worker</p></li></ul><p>worker 无法使用:</p><ul><li><p>DOM</p></li><li><p>window 对象</p></li><li><p>document 对象</p></li><li><p>parent 对象</p></li></ul><h1 id="加载外部脚本"><a href="#加载外部脚本" class="headerlink" title="加载外部脚本"></a>加载外部脚本</h1><p>worker 可以通过 importScripts() 函数将外部脚本文件或库加载到 worker 中, 该方法采用零个或多个字符串表示要导入的资源名.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// worker.js</span></span><br><span class="line">importScripts(<span class="string">&#x27;script1.js&#x27;</span>)</span><br><span class="line">importScripts(<span class="string">&#x27;script2.js&#x27;</span>)</span><br><span class="line"></span><br><span class="line">importScripts(<span class="string">&#x27;script3.js&#x27;</span>, <span class="string">&#x27;script4.js&#x27;</span>)</span><br></pre></td></tr></table></figure><h1 id="添加子-worker"><a href="#添加子-worker" class="headerlink" title="添加子 worker"></a>添加子 worker</h1><ul><li><p>subWorker 必须托管在与福网页相同的来源中</p></li><li><p>subWorker 中的 URI 应相对于 worker 的位置来解析</p></li></ul><h1 id="处理错误"><a href="#处理错误" class="headerlink" title="处理错误"></a>处理错误</h1><p>执行的 worker 发生错误时, 会触发 ErrorEvent, 包含三个属性: filename, lineno, message</p>]]></content>
      
      
      
        <tags>
            
            <tag> Web Worker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Deep in Viewport</title>
      <link href="/2017/06/05/Deep-in-Viewport/"/>
      <url>/2017/06/05/Deep-in-Viewport/</url>
      
        <content type="html"><![CDATA[<p><code>vw</code>(viewport width) and <code>vh</code>(viewport height) are legnth units that represent exactly 1% of the size of any given viewport, regardless of its measurements. <code>rem</code>(short for root em) is also similar in its functionality, although it deals specifically with font sizes, and derives its name from the value fo the font size of the root element – which should default to 16 pixels on most browsers.</p><p>There are also a few more viewport units available for use, such as <code>vmin</code> and <code>vmax</code> which refer respectively to 1% of the viewport’s smaller dimension, and 1% of its larger dimension.</p><p>Interestingly enough, browsers actually calculate the entire browser window when it comes to width, meaning they factor the scrollbar into this dimension. Should you attempt to set the width of an element to a value of 100vw, it would force a horizontal bar to appear, since you’d be lightly stretching your viewport.</p><h1 id="Device-Pixels-and-CSS-Pixels"><a href="#Device-Pixels-and-CSS-Pixels" class="headerlink" title="Device Pixels and CSS Pixels"></a>Device Pixels and CSS Pixels</h1><p>Device Pixels are the kind of pixels we intuitively assume to be ‘right’. These pixels give the formal resolution of whichever device you’re working on, and can be read out from <code>screen.width/height</code>.</p><p>If you give a certain element a <code>width: 128px</code>, and your monitor is 1024px wide, and you maximize your browser screen, the element would fit out on your monitor eight times.</p><p>If the user zooms, however, this calculation is going to change. If the user zooms to 200%, your element with <code>width: 128px</code> will fit only four times on this 1024px wide monitor.</p><p>Zooming as implemented in modern browsers consists of nothing more than ‘stretching up’ pixels. That is, the width of the elemtn is not changed from 128 to 256px, instead <em>the actual pixels</em> are doubled in size. Formally, the element still has width of 128 CSS pixels, even though it happens to take the space of 256px.</p><p>In other words, zooming to 200% makes one css pixels grow to four times the size of one device pixels(two times the width, two times the height)</p><p>A few images will clarify the concept. Here are four pixels on 100% zoom level. Here CSS px fully overlap with device px.</p><p><img src="https://www.quirksmode.org/mobile/pix/viewport/csspixels_100.gif"></p><p>Let’s zoom out. The CSS pixels start to shrink, meaning that one device px now overlaps several CSS px.</p><p><img src="https://www.quirksmode.org/mobile/pix/viewport/csspixels_out.gif"></p><p>If you zoom in, the opposite happens. The CSS px start to grow, and now one CSS px overlap several device px.</p><p><img src="https://www.quirksmode.org/mobile/pix/viewport/csspixels_in.gif"></p><p>The point is that you are only interested in CSS px. It’s those px that dictate how your style sheet is rendered.</p><p>Device px are almost entirely useless to you.</p><blockquote><p>At zoom level 100% one CSS px is exactly equal to Device px.</p></blockquote><h1 id="Screen-Size"><a href="#Screen-Size" class="headerlink" title="Screen Size"></a>Screen Size</h1><p><code>screen.width</code> and <code>screen.height</code> means the total width width and height of the user’s screen. <strong>These dimensions are measured in device px because they never change: they’re feature of the monitor and not of the browser.</strong></p><p><img src="https://www.quirksmode.org/mobile/pix/viewport/desktop_screen.jpg"></p><h1 id="Window-Size"><a href="#Window-Size" class="headerlink" title="Window Size"></a>Window Size</h1><p><code>window.innerWidth</code> and <code>window.innerHeight</code></p><p><img src="https://www.quirksmode.org/mobile/pix/viewport/desktop_inner.jpg"></p><p>Window Size is measured in CSS px.</p><h1 id="Scrolling-Offset"><a href="#Scrolling-Offset" class="headerlink" title="Scrolling Offset"></a>Scrolling Offset</h1><p><code>window.pageXOffset</code> and <code>window.pageYOffset</code> contains the horizontal and vertical scrolling offsets of the document. Thus you can find out how much the user has scrolled.</p><p><img src="https://www.quirksmode.org/mobile/pix/viewport/desktop_page.jpg"></p><p>These properties measured in CSS px.</p><h1 id="Viewport"><a href="#Viewport" class="headerlink" title="Viewport"></a>Viewport</h1><p>The function of the viewport is to constrain the element, which is the uppermost containing block of your site.</p><p>Suppose you have a liquid layout and one of your sidebar has <code>width: 10%</code>. Now the sidebar neatly grows and shrinks as your resize the browser window. How does it work.</p><p>Technically, what happens is that the sidebar gets 10% of the width of its parent. Let’s say the . Normally all block-level element take 100% of the width of their parent ().</p><p>So your sidebar get width of 10% of browser.</p><p>In theory, the width of the element is restricted by the width of the viewport. The element takes 100% of the width of that viewport.</p><p>The viewport, in turn, is exactly equal to the browser window: it’s been defined as such. The viewport is not an HTML construct, so you cannot influence it by CSS. It just has the width and height of the browser window – on desktop. On mobile it’s quite a bit more complicated.</p><p>White <code>width: 100%</code> works fine at 100% zoom, if we zoomed in the viewport has become smaller than the total width of the site, the content will spills out of the element, but that element has <code>overflow: visible</code>, which means that the spilled-out content will be show in any case.</p><p><img src="https://www.quirksmode.org/mobile/pix/viewport/desktop_100percent.jpg"></p><h1 id="Measuring-the-viewport"><a href="#Measuring-the-viewport" class="headerlink" title="Measuring the viewport"></a>Measuring the viewport</h1><p>The Viewport size can be found in <code>document.documentElement.clientHeight</code> and <code>document.documentElement.clientWidth</code></p><p><img src="https://www.quirksmode.org/mobile/pix/viewport/desktop_client.jpg"></p><p>If you know your DOM, you know that <code>document.documentElement</code> is in fact the <code>&lt;html&gt;</code> element: the root element of any HTML document. However, the viewport is one level higher, so to speak, it’s the element that contains the <code>&lt;html&gt;</code> element. That matters if you give the <code>&lt;html&gt;</code> element a <code>width</code>.</p><p><img src="https://www.quirksmode.org/mobile/pix/viewport/desktop_client_smallpage.jpg"></p><p>So <code>document.documentElement.clientWidth</code> and <code>document.documentElement.clientHeight</code> always give the viewport dimensions, regardless of the dimensions of the <code>&lt;html&gt;</code> element.</p><h1 id="Measuring-the-element"><a href="#Measuring-the-element" class="headerlink" title="Measuring the element"></a>Measuring the element</h1><p><code>document.documentElement.offsetWidth</code> and <code>document.documentElement.offsetHeight</code> will give size.</p><p><img src="https://www.quirksmode.org/mobile/pix/viewport/desktop_offset.jpg"></p><p><img src="https://www.quirksmode.org/mobile/pix/viewport/desktop_offset_smallpage.jpg"></p><h2 id="Event-coordinates"><a href="#Event-coordinates" class="headerlink" title="Event coordinates"></a>Event coordinates</h2><p>There are the event coordinates. When a mouse event occurs, no less than five property pairs are exposed to give you information abou the exact place of the event. For our discussion three of them are important:</p><ul><li><p><code>pageX/pageY</code> gives the coordinates relative to the <code>&lt;html&gt;</code> element in CSS px.</p></li><li><p><code>clientX/Y</code> gives the coordinates relative to the viewport in CSS px.</p></li><li><p><code>screenX/Y</code> gives the coordinate relative to the screen in DEVICE px.</p></li></ul><p><img src="https://www.quirksmode.org/mobile/pix/viewport/desktop_pageXY.jpg"></p><p>You’ll use <code>pageX/Y</code> 90% of the time. Usually you want to know the event position relative to the document.</p><p>The other 10% of the time you’ll use <code>clientX/Y</code></p><p>You never ever need to know the event coordiantes relative to the screen.</p><h3 id="Media-queries"><a href="#Media-queries" class="headerlink" title="Media queries"></a>Media queries</h3><p>There are two relavant media queries: <code>width/height</code> and <code>device-width/device-height</code></p><ul><li><p><code>width/height</code> uses the same values as <code>document.Element.clientWidth/clientHeight</code>, namely the viewport, it works with CSS px.</p></li><li><p><code>device-width/device-height</code> uses the same values as <code>screen.width/height</code> with device px.</p></li></ul><p><img src="https://www.quirksmode.org/mobile/pix/viewport/desktop_mediaqueries.jpg"></p><h1 id="The-problem-of-mobile-browser"><a href="#The-problem-of-mobile-browser" class="headerlink" title="The problem of mobile browser"></a>The problem of mobile browser</h1><p>Let’s go back to our sidebar with <code>width:10%</code>, if mobile browsers would do exactly the same as desktop browser, they’d make the element about 40px (if the device-width is 400px). and that’s too narrow. Your liquid layout would look horribly squashed.</p><h1 id="Two-viewports"><a href="#Two-viewports" class="headerlink" title="Two viewports"></a>Two viewports</h1><p>The viewport is too narrow to serve as a basis for your CSS layout. The obvious solution is to make the viewport wider. That however requires it to be split into two: the visual viewport and the layout viewport.</p><p>A simple explanation at StackOverFlow:</p><blockquote><p>Imagine the layout viewport as being a large image which does not change size or shape. Now image you have a smaller frame through which you look at the large image. The small frame is surrounded by opaque material which obscures your view of all but a portion of the large image. The portion of the large image that you can see through the frame is the visual port. You can back away from the large image while holding your frame(zoom out) to see the entire image at once, or you can move closer(zoom in) to see only a portion. You can also change the orientation of the frame, but the size and shape of the large image (layout viewport) never changes.</p></blockquote><p>The visual viewport is the part of the page that’s currently shown on-screen.</p><p>The user may scroll to change the part of the page he sees, or zoom to change the size of the visual viewport.</p><p><img src="https://www.quirksmode.org/mobile/pix/viewport/mobile_visualviewport.jpg"></p><p>However, the CSS layout, especially percentual widths, are calculated relative to the <strong>layout viewport</strong>, which is considerably wider than the visual viewport.</p><p>Thus the <code>&lt;html&gt;</code> element tabkes the width of the layout viewport initially, and your CSS is interpreted as if the screen were significantly wider than the phone screen. This makes sure that your site’s layout behaves as it does on a desktop browser.</p><p>How wide is the layout viewport? That differs per browser.</p><ul><li><p>Safari uses 980px</p></li><li><p>Opera uses 850px</p></li><li><p>Android 800px</p></li><li><p>IE 974px</p></li></ul><h1 id="Understanding-the-layout-viewport"><a href="#Understanding-the-layout-viewport" class="headerlink" title="Understanding the layout viewport"></a>Understanding the layout viewport</h1><p>In order to understand the size of the layout viewport we have to take a look at what happens when the page if fully zoomed out. Many mobile browsers initially show any page in fully zoomed-out mode.</p><p>The point is: browser have chosen their dimensions of the layout viewport such that it completely covers the screen if fully zoomed-out mode(equal to the visual viewport)</p><p><img src="https://www.quirksmode.org/mobile/pix/viewport/mobile_viewportzoomedout.jpg"></p><p>Thus the width and the height of the layout viewport are equal to whatever can be shown on the screen in the maximally zoomed-out mode. When the user zooms in these dimensions stay the same.</p><p><img src="https://www.quirksmode.org/mobile/pix/viewport/mobile_layoutviewport.jpg"></p><p>The layout viewport width is always the same, if you rotate your phone, the visual viewport changes, but the browser adapts to this new orientation by zooming in slightly so that the layout viewport is again as wide as the visual viewport.</p><p>This has consequences for the layout viewport’s height, which is now substantially less than in portrait mode. But web developers don’t care about the height, only about the width.</p><p><img src="https://www.quirksmode.org/mobile/pix/viewport/mobile_layoutviewport_la.jpg"></p><h1 id="Measuring-the-layout-viewport"><a href="#Measuring-the-layout-viewport" class="headerlink" title="Measuring the layout viewport"></a>Measuring the layout viewport</h1><p><code>document.documentElement.clientWidth</code> and <code>document.documentElement.clientHeight</code> contain the layout viewport’s dimensions.</p><p><img src="https://www.quirksmode.org/mobile/pix/viewport/mobile_client.jpg"></p><p>The orientation matters for the height, but not for the width.</p><h1 id="Measuring-the-visual-viewport"><a href="#Measuring-the-visual-viewport" class="headerlink" title="Measuring the visual viewport"></a>Measuring the visual viewport</h1><p>As to the visual viewport, it is measured by <code>window.innerWidth/innerHeight</code>. Obviously the measurements change when the user zooms out or in, since more or fewer CSS px fit into the screen.</p><p><img src="https://www.quirksmode.org/mobile/pix/viewport/mobile_inner.jpg"></p><h1 id="The-Screen"><a href="#The-Screen" class="headerlink" title="The Screen"></a>The Screen</h1><p>As on desktop, <code>screen.width/height</code> gives the screen size, in device pixels. As on the desktop, you never need this information as a web developer.</p><h1 id="Visual-viewport-position-relative-to-Layout-viewport"><a href="#Visual-viewport-position-relative-to-Layout-viewport" class="headerlink" title="Visual viewport position relative to Layout viewport"></a>Visual viewport position relative to Layout viewport</h1><p><img src="https://www.quirksmode.org/mobile/pix/viewport/mobile_page.jpg"></p><h1 id="html-element"><a href="#html-element" class="headerlink" title="html element"></a>html element</h1><p>Just as on desktop, <code>document.documentElemetn.offsetWidth/offsetHeight</code> gives the total size of the <code>&lt;html&gt;</code> element in CSS px.</p><h1 id="Meta-Viewport"><a href="#Meta-Viewport" class="headerlink" title="Meta Viewport"></a>Meta Viewport</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=320&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>It is meant to resize the layout viewport.</p><p>Suppose you build a simple page and give your elemnet no <code>width</code>. Now they stretch up to take 100% of the width of the layout viewport. Most browsers zoom out to show the entire layout viewport on the screen, giving an effect like this</p><p><img src="https://www.quirksmode.org/mobile/pix/viewport/mq_none.jpg"></p><p>All user will immediately zoom in, which works, but most browsers keep the width of the elements intact, whcih makes the text hard to read.</p><p><img src="https://www.quirksmode.org/mobile/pix/viewport/mq_none_zoomed.jpg"></p><p>Now what you can try is setting <code>html &#123;width: 320px&#125;</code> then</p><p><img src="https://www.quirksmode.org/mobile/pix/viewport/mq_html300.jpg"></p><p>When you set</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=320&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>You set the width of the layout viewport to 320px.</p><p><img src="https://www.quirksmode.org/mobile/pix/viewport/mq_yes.jpg"></p><p>Of course now we use</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>to adapt to various browsers.</p>]]></content>
      
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Utils in Axios</title>
      <link href="/2017/06/05/utils-in-axios/"/>
      <url>/2017/06/05/utils-in-axios/</url>
      
        <content type="html"><![CDATA[<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// global toString</span></span><br><span class="line"><span class="keyword">var</span> toString = <span class="built_in">Object</span>.prototype.toString</span><br><span class="line"></span><br><span class="line"><span class="comment">// isArray</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isArray</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> toString.call(val) === <span class="string">&#x27;[object Array]&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// isArrayBuffer</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isArrayBuffer</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> toString.call(val) === <span class="string">&#x27;[object arrayBuffer]&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// isFormData</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isFormData</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="keyword">typeof</span> FormData !== <span class="string">&#x27;undefined&#x27;</span> &amp;&amp; (val <span class="keyword">instanceof</span> FormData))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// isString</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isString</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> val === <span class="string">&#x27;string&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// isNumber</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isNumber</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> val === <span class="string">&#x27;number&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// isUndefinded</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isUndefined</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> val === <span class="string">&#x27;undefined&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// isObject</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isObject</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> val !== <span class="literal">null</span> &amp;&amp; <span class="keyword">typeof</span> val === <span class="string">&#x27;object&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// isDate</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isDate</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> toString.call(val) === <span class="string">&#x27;[object Date]&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// isFile</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isFile</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> toString.call(val) === <span class="string">&#x27;[object File]&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// isBlob</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isBlob</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> toString.call(val) === <span class="string">&#x27;[object Blob]&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// isFunction</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isFunction</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> toString.call(val) === <span class="string">&#x27;[object Function]&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// isStream</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isStream</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> isObject(val) &amp;&amp; isFunction(val.pipe)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// isURLSearchParams</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isURLSearchParams</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> URLSearchParams !== <span class="string">&#x27;undefined&#x27;</span> &amp;&amp; val <span class="keyword">instanceof</span> URLSearchParams</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// trim</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">trim</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> str.replace(<span class="regexp">/^\s*/</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="regexp">/\s*$/</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// isStandardBrowserEnv</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isStandardBrowserEnv</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> navigator !== <span class="string">&#x27;undefined&#x27;</span> &amp;&amp; navigator.product === <span class="string">&#x27;ReactNative&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="keyword">typeof</span> <span class="built_in">window</span> !== <span class="string">&#x27;undefined&#x27;</span></span><br><span class="line">    &amp;&amp; <span class="keyword">typeof</span> <span class="built_in">document</span> !== <span class="string">&#x27;undefined&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Iterate over an Array or an Object invoking a function for each item</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">forEach</span> (<span class="params">obj, fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (obj === <span class="literal">null</span> || <span class="keyword">typeof</span> obj === <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> obj !== <span class="string">&#x27;object&#x27;</span> &amp;&amp; !isArray(obj)) &#123;</span><br><span class="line">    obj = [obj]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (isArray(obj)) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, l = obj.length; i &lt; l; i++) &#123;</span><br><span class="line">      fn.call(<span class="literal">null</span>, obj[i], i, obj)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">Object</span>.prototype.hasOwnProperty.call(obj, key)) &#123;</span><br><span class="line">        fn.call(<span class="literal">null</span>, obj[key], key, obj)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> HTTP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Concept of PWA</title>
      <link href="/2017/06/01/concept-of-PWA/"/>
      <url>/2017/06/01/concept-of-PWA/</url>
      
        <content type="html"><![CDATA[<h1 id="Advantages-of-Progressive-Web-Apps"><a href="#Advantages-of-Progressive-Web-Apps" class="headerlink" title="Advantages of Progressive Web Apps:"></a>Advantages of Progressive Web Apps:</h1><ul><li><p>Reliable - Load instantly and never show the dinasaur.</p></li><li><p>Fast - Respond quickly to user interactions with silky smooth animations.</p></li><li><p>Enaging - Feel like a natural app on the device, with immersive user experience.</p></li></ul><h1 id="What-is-a-Progressive-Web-App"><a href="#What-is-a-Progressive-Web-App" class="headerlink" title="What is a Progressive Web App"></a>What is a Progressive Web App</h1><ul><li><p>Progressive - Works for every user, regardless of browser choice because it’s built with progressive enhancement as a core tenet.</p></li><li><p>Responsive - Fits any form factor: desktop, mobile, tablet, or whatever is next.</p></li><li><p>Connectively independent - Enhanced with service workers to work offline or on low-quality networks.</p></li><li><p>App-like - Feels like an app, because the app shell model seperates the application <em>functionality</em> from application <em>content</em>.</p></li><li><p>Fresh - Always up-to-date thanks to the service worker update process.</p></li><li><p>Safe - Served via HTTPS to prevent snooping and to ensure content hasn’t been tampered with.</p></li><li><p>Discoverable - Is identifiable as an ‘application’ thanks to <em>W3C manifest</em> and <em>service worker registration</em> scope, allowing search engines to find it.</p></li><li><p>Re-engagable - Makes Re-engagement easy through features like push notification.</p></li><li><p>Installable - Allows users to add apps they find most useful to their home screen without the hassle of an app store.</p></li><li><p>Linkable - Easily share the application via URL, doesn’t require complex installation.</p></li></ul><h2 id="What-is-App-Shell"><a href="#What-is-App-Shell" class="headerlink" title="What is App Shell"></a>What is App Shell</h2><p>The app’s shell is the minimal HTML, CSS, JavaScript that is required to power the user interface of a progressive web app and is one of the components that ensures reliably good performance. Its first load should be extremely quick and immediately cached.</p><p>‘Chched’ means that the shell files are loaded once over the network and then saved to the local device. Every subsequent time that the user opens the app, the shell files are loaded from the local device’s cache, which results in blazing-fast startup times.</p><p>App shell architecture seperates the core application infrastructure and UI from the data. All of the UI and infrastructure is cached locally using a <em>service worker</em> so that on subsequent loads, the PWA only needs to retrieve the necessary data, instead of having to load everything.</p><p>A service worker is a script that your browser runs in the background, seperate from a web page, opening the door to features that don’t need a web page or user interaction.</p><p><img src="https://codelabs.developers.google.com/codelabs/your-first-pwapp/img/156b5e3cc8373d55.png"></p><p>The app shell is similar to the bundle of code that you’d publish to an app store when building a native app. It is the core components necessary to get your app off the ground, but likely doesn’t contain the data.</p><p>Using the app shell architecture allows you to focus on speed, giving the PWA similar properties to native apps:</p><ul><li><p>instant loading</p></li><li><p>regular updates</p></li></ul><h2 id="Implement-App-Shell"><a href="#Implement-App-Shell" class="headerlink" title="Implement App Shell"></a>Implement App Shell</h2><h3 id="Create-the-HTML-for-the-App-Shell"><a href="#Create-the-HTML-for-the-App-Shell" class="headerlink" title="Create the HTML for the App Shell"></a>Create the HTML for the App Shell</h3><p>The Components consist of:</p><ul><li><p>Header with a title, and app/refresh button</p></li><li><p>Container for forecast cards</p></li><li><p>A forecast card template</p></li><li><p>A dialog for adding new cities</p></li><li><p>A loading indicator</p></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Weather PWA<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> <span class="attr">href</span>=<span class="string">&quot;styles/inline.css&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">header</span> <span class="attr">class</span>=<span class="string">&quot;header&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">&quot;header__title&quot;</span>&gt;</span>Weather PWA<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;butRefresh&quot;</span> <span class="attr">class</span>=<span class="string">&quot;headerButton&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;butAdd&quot;</span> <span class="attr">class</span>=<span class="string">&quot;headerButton&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">main</span> <span class="attr">class</span>=<span class="string">&quot;main&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card cardTemplate weather-forecase&quot;</span> <span class="attr">hidden</span>&gt;</span></span><br><span class="line">        ...</span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dialog-container&quot;</span>&gt;</span></span><br><span class="line">      ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;loader&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">svg</span> <span class="attr">viewBox</span>=<span class="string">&quot;0 0 32 32&quot;</span> <span class="attr">with</span>=<span class="string">&quot;32&quot;</span> <span class="attr">height</span>=<span class="string">&quot;32&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">circle</span> <span class="attr">id</span>=<span class="string">&quot;spinner&quot;</span> <span class="attr">cx</span>=<span class="string">&quot;16&quot;</span> <span class="attr">cy</span>=<span class="string">&quot;16&quot;</span> <span class="attr">r</span>=<span class="string">&quot;14&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;none&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">circle</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- insert link to app.js here --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Notice the loader is visible by default. This ensures that the user sees the loader immediately as the page loads, giving them a clear indication that the content is loading.</p><h3 id="Start-with-a-fast-load"><a href="#Start-with-a-fast-load" class="headerlink" title="Start with a fast load"></a>Start with a fast load</h3><h4 id="Differentiating-the-first-run"><a href="#Differentiating-the-first-run" class="headerlink" title="Differentiating the first run"></a>Differentiating the first run</h4><p>User preferences, like the list of cities a user has subscribed to, should be stored locally using IndexedBD or another fast storage mechanism. To simplify this code, here we use localStorage, which is not ideal for production apps because it is a blocking, synchronous storage mechanism that is potentially very slow on some device.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Save list of cities to lcoalStorage</span></span><br><span class="line">app.saveSelectedCities = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> selectedCities = <span class="built_in">JSON</span>.stringify(app.selectedCities)</span><br><span class="line">  <span class="built_in">localStorage</span>.selectedCities = selectedCities</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Next, let’s add the startup code to check if the user has any saved cities and render those</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">app.selectedCities = lcoalStorage.selectedCities</span><br><span class="line"><span class="keyword">if</span> (app.selectedCities) &#123;</span><br><span class="line">  app.selectedCities = <span class="built_in">JSON</span>.parse(app.selectedCities)</span><br><span class="line">  app.selectedCities.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">city</span>) </span>&#123;</span><br><span class="line">    app.getForecast(city.key, city.label)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  app.updateForecastCard(initialWeatherForecast)</span><br><span class="line">  app.selectedCities = [</span><br><span class="line">    &#123;</span><br><span class="line">      key: initialWeatherForecast.key,</span><br><span class="line">      label: initialWeatherForecast.label,</span><br><span class="line">    &#125;,</span><br><span class="line">    app.saveSelectedCities()</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Use-service-workers-to-pre-cache-the-App-Shell"><a href="#Use-service-workers-to-pre-cache-the-App-Shell" class="headerlink" title="Use service workers to pre-cache the App Shell"></a>Use service workers to pre-cache the App Shell</h3><p>PWA has to be fast, and installable, which means that they work online, offline, and on intermittent, slow connections.</p><p>To achieve this, we need to cache our app shell using service worker, so that it’s always available quickly and reliably.</p><p>Features provided via service workers should be considered a progressive enhancement, and added only if supported by the browser.</p><h4 id="Register-the-service-worker-if-it’s-available"><a href="#Register-the-service-worker-if-it’s-available" class="headerlink" title="Register the service worker if it’s available"></a>Register the service worker if it’s available</h4><p>The first step to making the app work offline is to register a service worker, a script that allows background functionality without the need of an open web page or user interaction.</p><p>This takes two simple steps:</p><ul><li><p>Tell the browser to register the JavaScript file as the service worker</p></li><li><p>Create a JavaScript file containing the service worker</p></li></ul><p>First, we need to check if the browser supports service worker, and if it does, register the service worker. Add the following code to <code>app.js</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="string">&#x27;serviceWorker&#x27;</span> <span class="keyword">in</span> navigator) &#123;</span><br><span class="line">  navigator.serviceWorker</span><br><span class="line">  .register(<span class="string">&#x27;./service-worker.js&#x27;</span>)</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Service Worker Registered&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Cache-the-site-assets"><a href="#Cache-the-site-assets" class="headerlink" title="Cache the site assets"></a>Cache the site assets</h4><p>When the service worker is registered, an install event is triggered the first time the user visits the page.</p><p>In this event handler, we will cache all the assets that are needed for the application.</p><p>When the service worker is fired, it should open the <code>caches</code> object and populate it with the assets necessary to load the App Shell. Create a file called <code>service-worker.js</code> in your application root folder. This file must live in the application root because the scope for service worker is defined by the directory in which the file resides. Add this code to your new <code>service-worker.js</code> file.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> cacheName = <span class="string">&#x27;weatherPWA&#x27;</span></span><br><span class="line"><span class="keyword">var</span> filesToCache = []</span><br><span class="line"></span><br><span class="line">self.addEventListener(<span class="string">&#x27;install&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;[ServiceWorker] Install&#x27;</span>)</span><br><span class="line">  e.waitUntil(</span><br><span class="line">    caches.open(cacheName).then(<span class="function"><span class="keyword">function</span> (<span class="params">cache</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;[ServiceWorker] Caching app shell&#x27;</span>)</span><br><span class="line">      <span class="keyword">return</span> cache.addAll(filesToCache)</span><br><span class="line">    &#125;)</span><br><span class="line">  )</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>First, we need to open the cache with <code>caches.open()</code> and provide a cache name. Providing a cache name allows us to version files, or separate data from the app shell so that we can easily update one but not affect other.</p><p>Once the cache is open, we can then call <code>cache.addAll()</code>, which takes a list of URLs, then fetches them from the server and adds the response to the cache. Unfortunately, <code>cache.addAll()</code> is atomic, if any of the files fail, the entire cache step fails.</p><p>DevTools can debug service workers. Before reloading your page, open up DevTools, go the <code>Service Worker</code> pane on the <code>Application</code> panel.</p><p><img src="https://codelabs.developers.google.com/codelabs/your-first-pwapp/img/ed4633f91ec1389f.png"></p><p>When you see a blank page like this, it means that the currently open page doesn’t have any registered service workers.</p><p>Now reload your page. The Service Worker pane should look like this.</p><p><img src="https://codelabs.developers.google.com/codelabs/your-first-pwapp/img/bf15c2f18d7f945c.png"></p><p>When you see information like this, it means the page has a service worker running.</p><p>Let’s add some logic on the <code>activate</code> event listener to update the cache.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">self.addEventListener(<span class="string">&#x27;activate&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;[ServiceWorker] Activate&#x27;</span>)</span><br><span class="line">  e.waitUntil(</span><br><span class="line">    caches.keys().then(<span class="function"><span class="keyword">function</span> (<span class="params">keyList</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.all(keyList.map(<span class="function"><span class="keyword">function</span> (<span class="params">key</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (key !== cacheName) &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">&#x27;[ServiceWorker] Removing old cache&#x27;</span>, key)</span><br><span class="line">          <span class="keyword">return</span> caches.delete(key)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;))</span><br><span class="line">    &#125;)</span><br><span class="line">  )</span><br><span class="line">  <span class="keyword">return</span> self.clients.claim()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>This code ensures that your service worker updates its cache whenever any of the app shell files change. In order for this to work, you’d need to increment the <code>cacheName</code> variable at the top of your service worker file.</p><p>When the app is complete, <code>self.clients.claim()</code> fixes a corner case in which the app wasn’t returning the latest data. You can reproduce the corner case by commenting out the line below and then doing the following steps:</p><ul><li><p>load app for first time so that the initial City data is shown</p></li><li><p>press the refresh button on the app</p></li><li><p>go offline</p></li><li><p>reload the app</p></li></ul><p>You expect to see the newer data, but you actually see the initial data. This happens because the service worker is not yet activated. <code>self.clients.claim()</code> essentially lets you activate the service worker faster.</p><p>Finally, let’s update the list of files required for the app shell. In the array, we need to include all of the files our app needs, including images, js, css, etc.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> filesToCache = [</span><br><span class="line">  <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;/index.html&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;/scripts/app.js&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;/styles/inline.css&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;/images/clear.png&#x27;</span>,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><h4 id="Serve-the-app-shell-from-the-cache"><a href="#Serve-the-app-shell-from-the-cache" class="headerlink" title="Serve the app shell from the cache"></a>Serve the app shell from the cache</h4><p>Service workers provide the ability to intercept requests made from our PWA and handle them within the service worker. That means we can determine how we want to handle the request and potentially serve our own cached response.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">self.addEventListener(<span class="string">&#x27;fetch&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;[ServiceWorker] Fetch&#x27;</span>, e.request.url)</span><br><span class="line">  e.responseWith(</span><br><span class="line">    caches.match(e.request).then(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> response || fetch(e.request)</span><br><span class="line">    &#125;)</span><br><span class="line">  )</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Stepping from inside, out, <code>caches.match()</code> evaluates the web request that triggered the <code>fetch</code> event, and checks to see if it’s available in the cache. It then either responds with the cached version, or uses <code>fetch</code> to get a copy from the network. The <code>response</code> is passed back to the web page with <code>e.responseWith()</code></p><h3 id="Beware-of-the-edge-cases"><a href="#Beware-of-the-edge-cases" class="headerlink" title="Beware of the edge cases"></a>Beware of the edge cases</h3><p>This code must not be used in production because of the many unhandled edge cases</p><ul><li><p>Cache depends on updating the cache key for every change</p></li><li><p>Requires everything to be redownloaded for every change</p></li><li><p>Browser cache may prevent the service worker cache from updating</p></li><li><p>Beware of cache-first strategies in production</p></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> PWA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Simple Guide of Jest</title>
      <link href="/2017/05/31/Simple-Guide-of-Jest/"/>
      <url>/2017/05/31/Simple-Guide-of-Jest/</url>
      
        <content type="html"><![CDATA[<h1 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev jest</span><br></pre></td></tr></table></figure><h1 id="Simple-Case"><a href="#Simple-Case" class="headerlink" title="Simple Case"></a>Simple Case</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// sum.js</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span> (<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = sum</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// sum.test.js</span></span><br><span class="line"><span class="keyword">const</span> test = <span class="built_in">require</span>(<span class="string">&#x27;jest&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> expect = <span class="built_in">require</span>(<span class="string">&#x27;expect&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sum = <span class="built_in">require</span>(<span class="string">&#x27;./sum&#x27;</span>)</span><br><span class="line">test(<span class="string">&#x27;adds 1 + 2 to equals 3&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  expect(sum(<span class="number">1</span>, <span class="number">2</span>).toBe(<span class="number">3</span>))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="With-Babel"><a href="#With-Babel" class="headerlink" title="With Babel"></a>With Babel</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev babel-jest</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .babelrc</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;presets&quot;</span>: [</span><br><span class="line">    [ <span class="string">&quot;env&quot;</span>, &#123;</span><br><span class="line">      <span class="attr">&quot;targets&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;node&quot;</span>: <span class="string">&quot;current&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>Jest will automatically define <code>NODE_ENV</code> as <code>test</code>. It will not use <code>development</code> section like Babel does by default when no <code>NODE_ENV</code> is set.</p></blockquote><blockquote><p><code>babel-jest</code> is automatically installed when installing Jest and will automatically transform files if a babel configuration exists in your project. To avoid this, you can explicitly reset the <code>transform</code> configuration option:</p></blockquote><p>In <code>package.json</code></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;jest&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;transform&quot;</span>: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Globals"><a href="#Globals" class="headerlink" title="Globals"></a>Globals</h2><p>In your test files, Jest puts each of its methods and objects into the global environment. You don’t need to require or import anything to use them.</p><h3 id="Methods"><a href="#Methods" class="headerlink" title="Methods"></a>Methods</h3><ul><li>afterAll(fn): Runs a function after all the tests in this file have completed. If the function returns a promise, Jest waits for that promise to resolve before continuing. This is often useful if you want to clean up some global setup state that is shared across tests.</li></ul><p>If <code>afterAll</code> is inside a <code>describe</code> block, it runs at the end of the describe block.</p><ul><li>afterEach(fn): Runs a function after each test in this file. If the function returns a promise, Jest waits for the promise to resolve before continuing. This is often useful if you want to clean up some temprary state that is created by each test.</li></ul><p>If <code>afterEach</code> is inside a <code>describe</code> block, it only runs after the tests that are inside this describe block.</p><ul><li><p>beforeAll(fn): similar to <code>afterAll()</code></p></li><li><p>beforeEach(fn): similar to <code>afterEach()</code></p></li><li><p>describe(name, fn): create a block that groups together several related tests in one ‘test suite’. For example, if you have a <code>myBeverage</code> object that is supposed to be delicious but not sour, you could test it with:</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> myBeverage = &#123;</span><br><span class="line">  delicious: <span class="literal">true</span>,</span><br><span class="line">  sour: <span class="literal">false</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">&#x27;my beverage&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  test(<span class="string">&#x27;is delicious&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    expect(myBeverage.delicious).toBeTruthy()</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  test(<span class="string">&#x27;is not sour&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    expect(myBeverage.sour).toBeFalsy()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>This isn’t required - you can just write the <code>test</code> block directly at the top level.</p><ul><li>describe.only(name, fn): You can use <code>describe.only</code> if you want to run only one describe block</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">describe.only(<span class="string">&#x27;my beverage&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  test(<span class="string">&#x27;is delicious&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    expect(myBeverage.delicious).toBeTruthy()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">describe(<span class="string">&#x27;my other beverage&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...will be skipped</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>describe.skip(name, fn): you can use <code>describe.skip</code> if you do not want to run a particular describe block:</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">describe(<span class="string">&#x27;my beverage&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  test(<span class="string">&#x27;is delicious&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    expect(myBeverage.delicious).toBeTruthy()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">describe.skip(<span class="string">&#x27;my other beverage&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ... will be skipped</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li><p>require.requireActual(moduleName): returns the actual module instead of a mock, bypassing all checks on whether the module should receive a mock implementation or not.</p></li><li><p>require.requireMock(moduleName): returns a mock module instead of the actual module, bypassing all checks on whether the module should be required normally or not.</p></li><li><p>test(name, fn): Also under the alias <code>it(name, fn)</code>, all you need in a test file is that the <code>test</code> method which runs a test. For example, let’s say there’s a function <code>inchesOfRain()</code> that should be zero. Your whole test could be:</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">test(<span class="string">&#x27;did not rain&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  expect(inchesOfRain()).toBe(<span class="number">0</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>The first argument is the test name; the second argument is a function that contains the expectations to test</p><p>If a promise is returned from <code>test</code>, Jest will wait for the promise to resolve before letting the test complete.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">test(<span class="string">&#x27;has lemon in it&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> fetchBeverageList().then(<span class="function"><span class="params">list</span> =&gt;</span> &#123;</span><br><span class="line">    expect(list).toContain(<span class="string">&#x27;lemon&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Even though the call to <code>test</code> will return right away, the test doesn’t complete until the promise resolves as well.</p><ul><li><p>test.only(name, fn): similar to <code>describe.only()</code></p></li><li><p>test.skip(name, fn): similar to <code>describe.skip()</code></p></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Test </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Webpack Code Splitting - Async</title>
      <link href="/2017/05/30/webpack-code-splitting-async/"/>
      <url>/2017/05/30/webpack-code-splitting-async/</url>
      
        <content type="html"><![CDATA[<p>Currently a ‘function-like’ <code>import()</code> module loading syntax proposal is on the way into ECMAScript.</p><p>The ES6 Defines <code>import()</code> as method to load ES6 modules dynamically onruntime.</p><p>Webpack treats <code>import()</code> as a split-point and puts the requested module in a seperate chunk. <code>import()</code> takes the module name as argument and returns a <code>Promise</code>: <code>import(name) =&gt; Promise</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">determineDate</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">import</span>(<span class="string">&#x27;moment&#x27;</span>).then(<span class="function">(<span class="params">moment</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(moment().format())</span><br><span class="line">  &#125;).catch(<span class="function"><span class="params">e</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;failed&#x27;</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">determineDate()</span><br></pre></td></tr></table></figure><p>Note that the fully dynamic statement, such as <code>import(foo)</code> will fail because webpack requries at least some file location information. This is because <code>foo</code> could potentially be any path to any file in your system or project. The <code>import()</code> must contain at least some information about where the module is located. so bundling can be limited to a specific directory or set of files.</p><h1 id="Chunk-Name"><a href="#Chunk-Name" class="headerlink" title="Chunk Name"></a>Chunk Name</h1><p>Since webpack 2.4.0, chunk names for dynamic imports can be specified using a “magic comment”</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>(<span class="comment">/* webpackChunkName: &#x27;my-chunk-name&#x27; */</span> <span class="string">&#x27;module&#x27;</span>)</span><br></pre></td></tr></table></figure><p>Since webpack 2.6.0, the placeholder <code>[request]</code>, <code>[index]</code> are supported:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// will generate files like `i18n/namespace-i18n-bundle-en.json`</span></span><br><span class="line"><span class="keyword">import</span>(<span class="comment">/* webpackChunkName: &#x27;i18n/[request]&#x27; */</span> <span class="string">`i18n/<span class="subst">$&#123;namespace&#125;</span>-i18n-bundle-<span class="subst">$&#123;language&#125;</span>.json`</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// will generate files `i18n-0`, `i18n-1`</span></span><br><span class="line"><span class="keyword">import</span>(<span class="comment">/* webpackChunkName: &#x27;i18n-[index]&#x27; */</span> <span class="string">&#x27;`i18n/$&#123;namespace&#125;-i18n-bundle-$&#123;language&#125;.json`&#x27;</span>)</span><br></pre></td></tr></table></figure><h1 id="import-mode"><a href="#import-mode" class="headerlink" title="import mode"></a>import mode</h1><p>Since webpack 2.6.0, different modes for resolving dynamic imports can be specified:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>(<span class="comment">/* webpackMode: lazy */</span> <span class="string">`i18n/<span class="subst">$&#123;namespace&#125;</span>-i18n-<span class="subst">$&#123;language&#125;</span>.json`</span>)</span><br></pre></td></tr></table></figure><ul><li><p>lazy: The default behavior. Lazy generates a chunk per request. So everything is lazy loaded.</p></li><li><p>lazy-once: Only available for imports with expression. Generate a single chunk for all possible requests. So the first request causes a network request for all modules, all following requests are already fulfilled.</p></li><li><p>eager: Eager generates no chunk. All files are included in the current chunk. No network request is required to load the files. It still returns a Promise, but it’s already resolved.</p></li></ul><p>You can combine both options ( webpackChunkName and webpackMode ), it’s parsed a JSON5 object without curly brackets:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>(<span class="comment">/* webpackMode: &#x27;lazy-once&#x27;, webpackChunkName: &#x27;all-i18n-data&#x27; */</span> <span class="string">`i18n/<span class="subst">$&#123;namespace&#125;</span>-i18n-<span class="subst">$&#123;lanaguage&#125;</span>.json`</span>)</span><br></pre></td></tr></table></figure><h1 id="Usage-with-Babel"><a href="#Usage-with-Babel" class="headerlink" title="Usage with Babel"></a>Usage with Babel</h1><p>If you want to use <code>import</code> with Babel, you’ll need to install the <code>syntax-dynamic-import</code> plugin while it’s still Stage 3 to get around the parser error.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev babel-core babel-loader babel-plugin-syntax-dynamic-import babel-preset-es2015</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">determineDate</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">import</span>(<span class="string">&#x27;moment&#x27;</span>).then(<span class="function"><span class="params">moment</span> =&gt;</span> moment().format()).then(<span class="function"><span class="params">str</span> =&gt;</span> <span class="built_in">console</span>.log(str)).catch(<span class="function"><span class="params">e</span> =&gt;</span> <span class="built_in">console</span>.log(e))</span><br><span class="line">&#125;</span><br><span class="line">determineDate()</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">&#x27;./index&#x27;</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">&#x27;app.js&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">        loader: <span class="string">&#x27;babel-loader&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;presets&quot;</span>: [[<span class="string">&quot;es2015&quot;</span>, &#123; <span class="attr">&quot;modules&quot;</span>: <span class="literal">false</span> &#125;]],</span><br><span class="line">  <span class="attr">&quot;plugins&quot;</span>: [<span class="string">&quot;syntax-dynamic-import&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>Diabled default import in es6.</p></blockquote><p>Not using the <code>syntax-dynamic-import</code> plugin will fail the build with</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Module build failed: SyntaxError: <span class="string">&#x27;import&#x27;</span> and <span class="string">&#x27;export&#x27;</span> may only appear at the top level</span><br></pre></td></tr></table></figure><p>or</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Module build failed: SyntaxError: Unexpected token, expected \&#123;</span><br></pre></td></tr></table></figure><h1 id="Usage-with-Babel-and-async-await"><a href="#Usage-with-Babel-and-async-await" class="headerlink" title="Usage with Babel and async / await"></a>Usage with Babel and <code>async / await</code></h1><p>To use es7 <code>async</code>/<code>await</code> with <code>import()</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev babel-plugin-transform-async-to-generator babel-plugin-trasnform-regenerator babel-plugin-transform-runtime babel-plugin-syntax-async-functions</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">determineDate</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> moment = <span class="keyword">await</span> <span class="keyword">import</span>(<span class="string">&#x27;moment&#x27;</span>)</span><br><span class="line">  <span class="keyword">return</span> moment().format()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">determineDate().then(<span class="function"><span class="params">str</span> =&gt;</span> <span class="built_in">console</span>.log(str))</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;presets&quot;</span>: [[<span class="string">&quot;es2015&quot;</span>, &#123; <span class="attr">&quot;modules&quot;</span>: <span class="literal">false</span> &#125;]],</span><br><span class="line">  <span class="attr">&quot;plugins&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;syntax-async-functions&quot;</span>,</span><br><span class="line">    <span class="string">&quot;syntax-dynamic-import&quot;</span>,</span><br><span class="line">    <span class="string">&quot;transform-async-to-generator&quot;</span>,</span><br><span class="line">    <span class="string">&quot;trasnform-regenerator&quot;</span>,</span><br><span class="line">    <span class="string">&quot;transform-runtime&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="import-imports-the-entire-module-namespace"><a href="#import-imports-the-entire-module-namespace" class="headerlink" title="import() imports the entire module namespace"></a><code>import()</code> imports the entire module namespace</h1><p>Note that the promise is resolved with the module namespace. Consider the following two examples:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Example 1: top-level import</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> Component <span class="keyword">from</span> <span class="string">&#x27;./component&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Example 2: Code Splitting With Import()</span></span><br><span class="line"><span class="keyword">import</span>(<span class="string">&#x27;./component&#x27;</span>).then(<span class="function"><span class="params">Component</span> =&gt;</span> <span class="comment">/* ... */</span>)</span><br></pre></td></tr></table></figure><p><code>Component</code> in both of the cases resolves to the same thing, meaning in the case of using <code>import()</code> with ES2015 moduels you have to explicitly access default and named exports:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">main</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Destructing Example</span></span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="attr">default</span>: Component &#125; = <span class="keyword">await</span> <span class="keyword">import</span> (<span class="string">&#x27;./component&#x27;</span>)</span><br><span class="line">  <span class="comment">// Inline example</span></span><br><span class="line">  render((<span class="keyword">await</span> <span class="keyword">import</span>(<span class="string">&#x27;./component&#x27;</span>)).default)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mongodb Simple Guide</title>
      <link href="/2017/05/30/mongodb-simple-guide/"/>
      <url>/2017/05/30/mongodb-simple-guide/</url>
      
        <content type="html"><![CDATA[<ul><li><p><code>yarn add mongoose</code></p></li><li><p><code>import mongoose from &#39;mongoose&#39;</code></p></li><li><p><code>const db = mongoose.conenct(MONGODB_URI)</code></p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mongoose <span class="keyword">from</span> <span class="string">&#x27;mongoose&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> db = mongoose.connect(MONGODB_URI)</span><br><span class="line"></span><br><span class="line">db.connection.on(<span class="string">&#x27;open&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;connected&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">db.connection.on(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`db error: <span class="subst">$&#123;err&#125;</span>`</span>)</span><br><span class="line">  process.exit</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="Schema"><a href="#Schema" class="headerlink" title="Schema"></a>Schema</h1><p>Schema defines the skeleton of minimal unit</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mongoose <span class="keyword">from</span> <span class="string">&#x27;mongoose&#x27;</span></span><br><span class="line"><span class="keyword">const</span> TestSchema = <span class="keyword">new</span> mongoose.Schema(&#123;</span><br><span class="line">  name: &#123; <span class="attr">type</span>: <span class="built_in">String</span> &#125;,</span><br><span class="line">  age: &#123; <span class="attr">type</span>: <span class="built_in">Number</span>, <span class="attr">default</span>: <span class="number">0</span> &#125;,</span><br><span class="line">  time: &#123; <span class="attr">type</span>: <span class="built_in">Date</span>, <span class="attr">default</span>: <span class="built_in">Date</span>.now() &#125;,</span><br><span class="line">  email: &#123; <span class="attr">type</span>: <span class="built_in">String</span>, <span class="attr">default</span>: <span class="string">&#x27;&#x27;</span> &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><blockquote><p>Primitive Types: String, Number, Boolean, null, Array, Document, Date</p></blockquote><h1 id="Model"><a href="#Model" class="headerlink" title="Model"></a>Model</h1><p>Instance of Schema, it has ability to operate db</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> db = mongoose.connect(MONGODB.URI)</span><br><span class="line"><span class="keyword">const</span> testModal = db.model(<span class="string">&#x27;test1&#x27;</span>, TestSchema)</span><br></pre></td></tr></table></figure><ul><li>test1: Name of Collection in the DB</li></ul><h1 id="Entity"><a href="#Entity" class="headerlink" title="Entity"></a>Entity</h1><p>Instance of Model, it has ability to operate db</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> TestEntity = <span class="keyword">new</span> TestModel(&#123;</span><br><span class="line">  name: <span class="string">&#x27;Lenka&#x27;</span>,</span><br><span class="line">  age: <span class="number">35</span>,</span><br><span class="line">  email: <span class="string">&#x27;lenka@gmail.com&#x27;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(TestEntity.name) <span class="comment">// Lenka</span></span><br><span class="line"><span class="built_in">console</span>.log(TestEntity.age) <span class="comment">// 35</span></span><br></pre></td></tr></table></figure><h1 id="Collection"><a href="#Collection" class="headerlink" title="Collection"></a>Collection</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mongoose <span class="keyword">from</span> <span class="string">&#x27;mongoose&#x27;</span></span><br><span class="line"><span class="keyword">const</span> db = mongoose.connect(MONGODB.URI)</span><br><span class="line"><span class="keyword">const</span> TestSchema = <span class="keyword">new</span> mongoose.Schema(&#123;</span><br><span class="line">  name: &#123; <span class="attr">type</span>: <span class="built_in">String</span> &#125;,</span><br><span class="line">  age: &#123; <span class="attr">type</span>: <span class="built_in">Number</span>, <span class="attr">default</span>: <span class="number">0</span> &#125;,</span><br><span class="line">  email: &#123; <span class="attr">type</span>: <span class="built_in">String</span> &#125;,</span><br><span class="line">  time: &#123; <span class="attr">type</span>: <span class="built_in">Date</span>, <span class="attr">default</span>: <span class="built_in">Date</span>.now() &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> TestModel = db.model(<span class="string">&#x27;test1&#x27;</span>, TestSchema)</span><br><span class="line"><span class="keyword">const</span> TestEntity = <span class="keyword">new</span> TestModel(&#123;</span><br><span class="line">  name: <span class="string">&#x27;hello world&#x27;</span>,</span><br><span class="line">  age: <span class="number">12</span>,</span><br><span class="line">  email: <span class="string">&#x27;helloworld@gmail.com&#x27;</span>,</span><br><span class="line">&#125;)</span><br><span class="line">TestEntity.save(<span class="function">(<span class="params">err, doc</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;error: &#x27;</span> + err)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(doc)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="Find"><a href="#Find" class="headerlink" title="Find"></a>Find</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">obj.find(condition, field, callback)</span><br></pre></td></tr></table></figure><p>if <code>fields</code> is omited, or <code>null</code>, the docs will return all attributes</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Model.find(&#123; <span class="string">&#x27;age&#x27;</span>: <span class="number">25</span> &#125;, <span class="function">(<span class="params">err, docs</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="built_in">console</span>.log(err)</span><br><span class="line">  <span class="built_in">console</span>.log(docs)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">Model.find(&#123;&#125;, &#123; <span class="attr">name</span>: <span class="number">1</span>, <span class="attr">age</span>: <span class="number">1</span>, <span class="attr">_id</span>: <span class="number">0</span> &#125;, <span class="function">(<span class="params">err, docs</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// the specific attributes will be returned if corresponding fields are set to positive(here they are name and age), and _id is default to be displayed, if you want to omit it, you should set it to be 0.</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="findOne"><a href="#findOne" class="headerlink" title="findOne"></a>findOne</h1><p>Same as <code>find</code>, except it will return only one matched</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">TestModel.findOne(condition, fields, <span class="function">(<span class="params">err, doc</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="findById"><a href="#findById" class="headerlink" title="findById"></a>findById</h1><p>Same as <code>findOne</code>, but it only find by <code>_id</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">TestModel.findById(<span class="string">&#x27;obj._id&#x27;</span>, <span class="function">(<span class="params">err, doc</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="Create"><a href="#Create" class="headerlink" title="Create"></a>Create</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Model.create(&#123;&#125;, callback)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Model.create(&#123;</span><br><span class="line">  name: <span class="string">&#x27;test&#x27;</span>,</span><br><span class="line">  age: <span class="number">12</span>,</span><br><span class="line">&#125;, <span class="function">(<span class="params">err, doc</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="built_in">console</span>.log(err)</span><br><span class="line">  <span class="built_in">console</span>.log(doc)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">TestModel.create([</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&#x27;test1&#x27;</span>, <span class="attr">age</span>: <span class="number">20</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&#x27;test2&#x27;</span>, <span class="attr">age</span>: <span class="number">20</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&#x27;test3&#x27;</span>, <span class="attr">age</span>: <span class="number">20</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&#x27;test4&#x27;</span>, <span class="attr">age</span>: <span class="number">20</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&#x27;test5&#x27;</span>, <span class="attr">age</span>: <span class="number">20</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&#x27;test6&#x27;</span>, <span class="attr">age</span>: <span class="number">20</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&#x27;test7&#x27;</span>, <span class="attr">age</span>: <span class="number">20</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&#x27;test8&#x27;</span>, <span class="attr">age</span>: <span class="number">20</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&#x27;test9&#x27;</span>, <span class="attr">age</span>: <span class="number">20</span> &#125;,</span><br><span class="line">])</span><br></pre></td></tr></table></figure><h1 id="Save"><a href="#Save" class="headerlink" title="Save"></a>Save</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Entity.save(&#123;&#125;, callback)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Entity = <span class="keyword">new</span> Model(&#123;</span><br><span class="line">  name: <span class="string">&#x27;entity_save&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">Entity.save(<span class="function">(<span class="params">err, doc</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="built_in">console</span>.log(err)</span><br><span class="line">  <span class="built_in">console</span>.log(doc)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><blockquote><p>Model.create</p></blockquote><blockquote><p>Entity.save</p></blockquote><h1 id="Update"><a href="#Update" class="headerlink" title="Update"></a>Update</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">obj.update(&#123;&#125;, callback)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> conditions = &#123; <span class="attr">name</span>: <span class="string">&#x27;test_upate&#x27;</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> update = &#123; <span class="attr">$set</span>: &#123; <span class="attr">age</span>: <span class="number">16</span> &#125; &#125;</span><br><span class="line"></span><br><span class="line">TestModel.update(conditions, update, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="built_in">console</span>.log(err)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;success&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="Remove"><a href="#Remove" class="headerlink" title="Remove"></a>Remove</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">obj.remove(&#123;&#125;, callback)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> conditions = &#123; <span class="attr">name</span>: <span class="string">&#x27;tim&#x27;</span> &#125;</span><br><span class="line"></span><br><span class="line">TestModel.remove(conditions, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="built_in">console</span>.log(err)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;success&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="Advanced-Search"><a href="#Advanced-Search" class="headerlink" title="Advanced Search"></a>Advanced Search</h1><ul><li><p><code>$lt</code>: less than</p></li><li><p><code>$lte</code>: less than or equal to</p></li><li><p><code>$gt</code>: greater than</p></li><li><p><code>$gte</code>: greater than or equal to</p></li><li><p><code>$ne</code>: not equal to</p></li><li><p><code>$in</code>: belong to</p></li><li><p><code>$or</code>: or</p></li><li><p><code>$exists</code>: exist</p></li><li><p><code>$all</code></p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Model.find(&#123; <span class="string">&quot;age&quot;</span>: &#123; <span class="string">&quot;$gt&quot;</span>: <span class="number">18</span>, <span class="string">&quot;$lt&quot;</span>: <span class="number">50</span> &#125; &#125;, <span class="function">(<span class="params">err, docs</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">Model.find(&#123; <span class="string">&quot;age&quot;</span>: &#123; <span class="string">&quot;$in&quot;</span>: [<span class="number">20</span>, <span class="number">30</span>] &#125; &#125;, <span class="function">(<span class="params">err, docs</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">Model.find(&#123;</span><br><span class="line">  <span class="string">&quot;$or&quot;</span>: [</span><br><span class="line">    &#123; <span class="string">&quot;name&quot;</span>: <span class="string">&quot;yaya&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="string">&quot;age&quot;</span>: <span class="number">28</span> &#125;,</span><br><span class="line">  ]</span><br><span class="line">&#125;, <span class="function">(<span class="params">err, docs</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">Model.find(&#123;</span><br><span class="line">  name: <span class="string">&quot;$exists&quot;</span></span><br><span class="line">&#125;, <span class="function">(<span class="params">err, docs</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="Limit"><a href="#Limit" class="headerlink" title="Limit"></a>Limit</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">find(condition, &#123; <span class="attr">limit</span>: <span class="number">20</span> &#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, docs</span>) =&gt; </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Model.find(&#123;&#125;, <span class="literal">null</span>, &#123; <span class="attr">limit</span>: <span class="number">20</span> &#125;, <span class="function">(<span class="params">err, docs</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="Skip"><a href="#Skip" class="headerlink" title="Skip"></a>Skip</h1><p>Skim first n docs</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">find(&#123;&#125;, <span class="literal">null</span>, &#123; <span class="attr">skip</span>: <span class="number">4</span> &#125;, <span class="function">(<span class="params">err, docs</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>if total docs less than 4, it will output nothing</p><h1 id="Sort"><a href="#Sort" class="headerlink" title="Sort"></a>Sort</h1><p><code>-1</code>: descending, <code>1</code>: ascending</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Model.find(&#123;&#125;, <span class="literal">null</span>, &#123; <span class="attr">sort</span>: &#123; <span class="attr">age</span>: <span class="number">-1</span> &#125; &#125;, <span class="function">(<span class="params">err, docs</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="ObjectId"><a href="#ObjectId" class="headerlink" title="ObjectId"></a>ObjectId</h1><p>The default id <code>_id</code> could be any types in mongodb, and default to be <code>ObjectId</code></p><p>ObjectId, is a 12-types BSON String.</p><ul><li><p>4 byte: UNIX TimeStamp</p></li><li><p>3 byte: Represents the OS where mongodb running on</p></li><li><p>2 byte: Represents the process where this <code>_id</code> in on</p></li><li><p>3 byte: Rnadom Number</p></li></ul><h1 id="Schema-add-Attribute"><a href="#Schema-add-Attribute" class="headerlink" title="Schema add Attribute"></a>Schema add Attribute</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mongoose <span class="keyword">from</span> <span class="string">&#x27;mongoose&#x27;</span></span><br><span class="line"><span class="keyword">const</span> TestSchema = <span class="keyword">new</span> mongoose.Schema</span><br><span class="line">TestSchema.add(&#123;</span><br><span class="line">  name: <span class="string">&#x27;String&#x27;</span>,</span><br><span class="line">  email: <span class="string">&#x27;String&#x27;</span>,</span><br><span class="line">  age: <span class="string">&#x27;Number&#x27;</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="Schema-add-instance-method"><a href="#Schema-add-instance-method" class="headerlink" title="Schema add instance method"></a>Schema add instance method</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mongoose <span class="keyword">from</span> <span class="string">&#x27;mongoose&#x27;</span></span><br><span class="line"><span class="keyword">const</span> TextSchema = <span class="keyword">new</span> mongoose.Schema(&#123;</span><br><span class="line">  name: <span class="string">&#x27;String&#x27;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">TestSchema.method(<span class="string">&#x27;test&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;hah&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> say = mongoose.model(<span class="string">&#x27;say&#x27;</span>, TestSchema)</span><br><span class="line"><span class="keyword">var</span> lenka = say()</span><br><span class="line">lenka.say() <span class="comment">// &#x27;hah&#x27;</span></span><br></pre></td></tr></table></figure><h1 id="Schema-add-static-method"><a href="#Schema-add-static-method" class="headerlink" title="Schema add static method"></a>Schema add static method</h1><pre><code class="javascript">TestSchema.static(&#39;findByName&#39;, (name, cb) =&gt; &#123; return this.find(&#123;name: name&#125;, cb) &#125;)const TestModel = db.model(&#39;test&#39;, TestSchema) TestModel.findByName(&#39;tim&#39;, (err, docs) =&gt; &#123; // ... &#125;)</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> Database </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TypeScript With Node</title>
      <link href="/2017/05/30/start-in-typescript/"/>
      <url>/2017/05/30/start-in-typescript/</url>
      
        <content type="html"><![CDATA[<h1 id="Configuring-TypeScript-Compilation"><a href="#Configuring-TypeScript-Compilation" class="headerlink" title="Configuring TypeScript Compilation"></a>Configuring TypeScript Compilation</h1><p>TypeScript uses the file <code>tsconfig.json</code> to adjust project compile options</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&quot;compilerOptions&quot;: &#123;</span><br><span class="line">  &quot;module&quot;: &quot;commonjs&quot;,</span><br><span class="line">  &quot;target&quot;: &quot;es6&quot;,</span><br><span class="line">  &quot;noImplicityAny&quot;: true,</span><br><span class="line">  &quot;moduleResolution&quot;: &quot;node&quot;,</span><br><span class="line">  &quot;sourceMap&quot;: true,</span><br><span class="line">  &quot;outDir&quot;: &quot;dist&quot;,</span><br><span class="line">  &quot;baseUrl&quot;: &quot;.&quot;,</span><br><span class="line">  &quot;paths&quot;: &#123;</span><br><span class="line">    &quot;*&quot;: [</span><br><span class="line">      &quot;node_modules/*&quot;,</span><br><span class="line">      <span class="string">&quot;src/types/*&quot;</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><table><thead><tr><th><code>compilerOptions</code></th><th>Description</th></tr></thead><tbody><tr><td>“module”: “commonjs”</td><td>The <strong>output</strong> module type (in your <code>.js</code> files). Node uses commonjs</td></tr><tr><td>“target”: “es6”</td><td>The output language level. Node supports ES6</td></tr><tr><td>“noImplicityAny”: true</td><td>Enables a stricter setting which throws errors when something has a default <code>any</code> value</td></tr><tr><td>“moduleResolution”: “node”</td><td>TypeScript attempts to mimic Node’s module resolution strategy</td></tr><tr><td>“sourceMap”: true</td><td></td></tr><tr><td>“ourDir”: “dist”</td><td>Location to output <code>.js</code> files after compilation</td></tr><tr><td>“baseUrl”: “.”</td><td>Part of configuring module resolution</td></tr><tr><td>“paths”: {…}</td><td>Part of configuring module resolution</td></tr></tbody></table><p>The rest of the file define the TypeScript project context. The project context is basically a set of options that determine which files are compiled when the compiler is invoked with a specific <code>tsconfig.json</code>.</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;include&quot;: [</span><br><span class="line">  <span class="string">&quot;src/**/*&quot;</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><p><code>include</code> takes an array of glob pattern of files to include in the compilation.</p><h1 id="Type-Definition-d-ts-Files"><a href="#Type-Definition-d-ts-Files" class="headerlink" title="Type Definition (.d.ts) Files"></a>Type Definition (<code>.d.ts</code>) Files</h1><p>TypeScript uses <code>.d.ts</code> files to provide types for JavaScript libraries that were not written in TypeScript. This is great because once you have a <code>.d.ts</code> file, TypeScript can type check that library and provide you better help in your editor. The TypeScript community actively shares all the most up-to-date <code>.d.ts</code> files for popular libraries on a Github repository called <strong>DefinitelyTyped</strong>.</p><p>Because the <code>&quot;noImplicityAny&quot;: true</code>, we are required to have a <code>.d.ts</code> file for every library used. You could set <code>noImplicityAny</code> to <code>false</code> to silence errors about missing <code>.d.ts</code> files. It’s a best practice to have a <code>.d.ts</code> file for every library(Even the <code>.d.ts</code> file is basically empty)</p><h1 id="Installing-d-ts-files-from-DefinitelyTyped"><a href="#Installing-d-ts-files-from-DefinitelyTyped" class="headerlink" title="Installing .d.ts files from DefinitelyTyped"></a>Installing <code>.d.ts</code> files from DefinitelyTyped</h1><p>For the most part, you’ll find <code>d.ts</code> files for the libraries you are using on DefinitelyTyped. These <code>.d.ts</code> files can be easily installed into your project by using npm scope <code>@types</code>. For example, if we want the <code>.d.ts</code> file for jQuery, we can do so with <code>npm install --save-dev @types/jquery</code>.</p><p>Once <code>.d.ts</code> files have been installed using npm, you should see them in your <code>node_modules/@types</code> folder. The compiler will always look in this folder for <code>.d.ts</code> files when resolving JavaScript libraries.</p><h1 id="What-if-a-library-isn’t-on-DefinitelyTyped"><a href="#What-if-a-library-isn’t-on-DefinitelyTyped" class="headerlink" title="What if a library isn’t on DefinitelyTyped?"></a>What if a library isn’t on DefinitelyTyped?</h1><p>Setting up TypeScript to look for <code>.d.ts</code> files in another folder</p><p>The Compiler knows to look in <code>node_modules/@types</code> by default, but to help the compiler find our own <code>.d.ts</code> files we have to configure path mapping in our <code>tsconfig.json</code>. Path mapping can get pretty confusing, but the basic idea is that the TypeScript compiler will look in specific places, in a specific order when resolving modules, and we have the ability to tell the compiler exactly how to do it. In the <code>tsconfig.json</code> for this project you’ll see the following:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&quot;baseUrl&quot;: &quot;.&quot;,</span><br><span class="line">&quot;paths&quot;: &#123;</span><br><span class="line">  &quot;*&quot;: [</span><br><span class="line">    <span class="string">&quot;src/types/*&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This tells the TypeScript compiler that in addition to looking in <code>node_module/@types</code> for every import (<code>*</code>) also look in our own <code>.d.ts</code> file location <code>&lt;baseUrl&gt; + src/types/*</code></p><p>First the compiler will look for a <code>.d.ts</code> file in <code>node_modules/@types</code> and then <code>src/types</code></p><h1 id="Summary-of-d-ts-management"><a href="#Summary-of-d-ts-management" class="headerlink" title="Summary of .d.ts management"></a>Summary of <code>.d.ts</code> management</h1><p>In general if you stick to the following steps you should have minimal <code>.d.ts</code> issues:</p><ul><li><p>After installing any npm package as a dependency or dev dependency, immediately try to install the <code>.d.ts</code> file via <code>@types</code></p></li><li><p>If the library has a <code>.d.ts</code> file on DefinitelyTyped, the install wil succeed and you are done, if the install fails because the package doesn’t exist, generate <code>.d.ts</code> by yourself</p></li></ul><h1 id="Source-Map"><a href="#Source-Map" class="headerlink" title="Source Map"></a>Source Map</h1><p>In the <code>tsconfig.json</code></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;compilerOptiosn&quot;: &#123;</span><br><span class="line">  &quot;sourceMaps&quot;: true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>With this option enabled, next to every <code>.js</code> file that the TypeScript compiler outputs there will be a <code>.map.js</code> file as well. This <code>.map.js</code> file provides the information necessary to map back to the source <code>.ts</code> file while debugging.</p><h1 id="Using-Debugger-in-VS-Code"><a href="#Using-Debugger-in-VS-Code" class="headerlink" title="Using Debugger in VS Code"></a>Using Debugger in VS Code</h1><p>When debugging in VS Code, it looks for a top level <code>.vscode</code> folder with a <code>launch.json</code> file. In this file, you can tell VS Code exactly what you want to do:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;node&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;request&quot;</span>: <span class="string">&quot;launch&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Debug&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;program&quot;</span>: <span class="string">&quot;$&#123;workspaceRoot&#125;/dist/server.js&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;smartStep&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;outFiles&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;../dist/**/*.js&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;protocal&quot;</span>: <span class="string">&quot;inspector&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This is mostly identical to the “Node.js: Launch Program” template with a couple minor changes:</p><table><thead><tr><th><code>launch.json</code> Options</th><th>Description</th></tr></thead><tbody><tr><td>“program”: “${workspaceRoot}/dist/server.js”</td><td>Modified to point to our entry point in <code>dist</code></td></tr><tr><td>“smartStep”: true</td><td>Won’t step into code that doesn’t have a source map</td></tr><tr><td>“outFiles”: […]</td><td>Specify where output files a dropped. Use with source map</td></tr><tr><td>“protocal”: “inspector”</td><td>Use the new Node Debug Protocal because we’re on the latest node</td></tr></tbody></table>]]></content>
      
      
      
        <tags>
            
            <tag> TypeScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Drag, Upload and Progress</title>
      <link href="/2017/05/29/drag-upload-and-progress/"/>
      <url>/2017/05/29/drag-upload-and-progress/</url>
      
        <content type="html"><![CDATA[<p>Dragging and dropping files from your desktop to a browser is one of the ultimate goals for web application integration, which consists of:</p><ul><li><p>enable file dragging and dropping onto a web page element</p></li><li><p>analyze dropped files in JavaScript</p></li><li><p>load and parse files on the client</p></li><li><p>asynchronously upload files to the server using XMLHttpRequest2</p></li><li><p>show a graphical progress bar while the upload occurs</p></li><li><p>use progressive enhancement to ensure your file upload from works in any browser</p></li></ul><h1 id="The-File-API"><a href="#The-File-API" class="headerlink" title="The File API"></a>The File API</h1><ul><li><p>FileList: represents an array of selected files</p></li><li><p>File: represents an individual file</p></li><li><p>FileReader: an interface which allows us to read file data on the client and use it within JavaScript</p></li></ul><h1 id="JavaScript-Events"><a href="#JavaScript-Events" class="headerlink" title="JavaScript Events"></a>JavaScript Events</h1><h2 id="Dragged-Object"><a href="#Dragged-Object" class="headerlink" title="Dragged Object"></a>Dragged Object</h2><ul><li><p>dragstart</p></li><li><p>drag</p></li><li><p>dragend</p></li></ul><h2 id="Target-Object"><a href="#Target-Object" class="headerlink" title="Target Object"></a>Target Object</h2><ul><li><p>dragenter</p></li><li><p>dragover</p></li><li><p>dragleave</p></li><li><p>drop</p></li></ul><h2 id="dataTransfer"><a href="#dataTransfer" class="headerlink" title="dataTransfer"></a>dataTransfer</h2><ul><li><p>dropEffect: copy | move | link | none</p></li><li><p>effectAllowed: copy | move | link | copyLink | copyMove | linkMove | none | all (default)</p></li><li><p>files</p></li><li><p>types</p></li><li><p>setDragImage(imgElement, x, y): set custom icon along dragging</p></li><li><p>setData(format, data)</p></li><li><p>getData(format)</p></li><li><p>clearData()</p></li></ul><h1 id="Notice"><a href="#Notice" class="headerlink" title="Notice"></a>Notice</h1><p>By default, brower will refuse all drag actions(and file will be opened in browser if files from desktop dragged into the browser), so <code>e.preventDefault()</code> should be added in <code>dropover</code> and <code>drop</code> event</p><p>Dragging Text will automatically set <code>e.dataTransfer.setData(&#39;text/plain&#39;, node.innerText)</code></p><p>Dragging File will add files to <code>e.dataTransfer.files</code></p>]]></content>
      
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> HTML </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Simple Usage of flatMap</title>
      <link href="/2017/05/26/simple-usage-of-flatMap/"/>
      <url>/2017/05/26/simple-usage-of-flatMap/</url>
      
        <content type="html"><![CDATA[<p><a href="http://2ality.com/2017/04/flatmap.html">Original</a></p><p>Both <code>map()</code> and <code>flatMap()</code> take a function <code>f</code> as a parameter that controls how an input Array is translated to an output Array:</p><ul><li><p>With <code>map()</code>, each input Array element is translated to exactly one output element, aka, <code>f</code> returns a single value</p></li><li><p>With <code>flatMap()</code>, each input Array element is translated to zero or more output elements, aka, <code>f</code> returns an Array of values.</p></li></ul><p>An smiple implementation of <code>flatMap</code>:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">flatMap</span> (<span class="params">arr, mapFunc</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> result = []</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> [index, value] <span class="keyword">of</span> arr.entries()) &#123;</span><br><span class="line">    <span class="keyword">const</span> x = mapFunc(value, index, arr)</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(x)) &#123;</span><br><span class="line">      result.push(...x)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      result.push(x)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>flatMap</code> is simpler if <code>mapFunc</code> is only allowed to return Arrays, but we don’t impose this restriction here, because non-Array values are occasionally useful.</p><h1 id="Filtering-and-mapping-at-the-same-time"><a href="#Filtering-and-mapping-at-the-same-time" class="headerlink" title="Filtering and mapping at the same time"></a>Filtering and mapping at the same time</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">processArray</span> (<span class="params">arr, processFunc</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> arr.map(<span class="function"><span class="params">x</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">value</span>: processFunc(x) &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">error</span>: e &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> results = processArray(myArray, myFunc)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> values = flatMap(results, <span class="function"><span class="params">result</span> =&gt;</span> result.value ? [result.value] : []) <span class="comment">// here we use [result.value] to avoid destructing value if it is an array.</span></span><br><span class="line"><span class="keyword">const</span> errors = flapMap(results, <span class="function"><span class="params">result</span> =&gt;</span> result.error ? result.error : [])</span><br></pre></td></tr></table></figure><h1 id="Mapping-to-multiple-values"><a href="#Mapping-to-multiple-values" class="headerlink" title="Mapping to multiple values"></a>Mapping to multiple values</h1><p>The Array method <code>map()</code> maps each input Array element to one output. But if we want to map it to multiple output elements?</p><p>That becomes necessary in the following example: The React component <code>TagList</code> is invoked with two attributes</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;TagList tags=&#123;[<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>, <span class="string">&#x27;baz&#x27;</span>]&#125; handleClick=&#123;<span class="function"><span class="params">x</span> =&gt;</span> <span class="built_in">console</span>.log(x)&#125; /&gt;</span><br></pre></td></tr></table></figure><p>The attributes are:</p><ul><li><p>An Array of tags, each tag being a string</p></li><li><p>A callback for handling clicks on tags</p></li></ul><p><code>TagList</code> is rendered as a series of links seperated by commas:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TagList</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; tags, handleClick &#125; = <span class="built_in">this</span>.props</span><br><span class="line">    <span class="keyword">return</span> flatMap(tags, <span class="function">(<span class="params">tag, index</span>) =&gt;</span> [</span><br><span class="line">      ...(index &gt; <span class="number">0</span> ? [<span class="string">&#x27;, &#x27;</span>] : []),</span><br><span class="line">      &lt;a key=&#123;index&#125; href=<span class="string">&quot;&quot;</span> onClick=&#123;<span class="function"><span class="params">e</span> =&gt;</span> handleClick(tag, e)&#125;&gt;</span><br><span class="line">        &#123;tag&#125;</span><br><span class="line">      &lt;/a&gt;</span><br><span class="line">    ])</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Here each tag (except the first) provide two elements in the rendered Array</p><h1 id="Arbitrary-Iterables"><a href="#Arbitrary-Iterables" class="headerlink" title="Arbitrary Iterables"></a>Arbitrary Iterables</h1><p><code>flatMap</code> can be generalized to work with arbitrary iterables</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">flatMapIter</span>(<span class="params">iterable, mapFunc</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> index = <span class="number">0</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> x <span class="keyword">of</span> iterable) &#123;</span><br><span class="line">    <span class="keyword">yield</span>* mapFunc(x, index)</span><br><span class="line">    index++</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>flatMapIter</code> function works with Arrays:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fillArray</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Array</span>(x).fill(x)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log([...flatMapIter([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>], fillArray)])</span><br></pre></td></tr></table></figure><h1 id="Implementing-flatMap-via-reduce"><a href="#Implementing-flatMap-via-reduce" class="headerlink" title="Implementing flatMap via reduce"></a>Implementing <code>flatMap</code> via <code>reduce</code></h1><p>You can use the Array method <code>reduce</code> to implement a simple version of <code>flatMap</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">flatMap</span> (<span class="params">arr, mapFunc</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> arr.reduce(</span><br><span class="line">    (prev, x) =&gt; prev.concat(mapFunc(x)),</span><br><span class="line">    [],</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Related-to-flatMap-flatten"><a href="#Related-to-flatMap-flatten" class="headerlink" title="Related to flatMap: flatten"></a>Related to <code>flatMap</code>: <code>flatten</code></h1><p><code>flatten</code> is an operation that concatenates all the elements of an Array</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; flatten([<span class="string">&#x27;a&#x27;</span>, [<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>], [<span class="string">&#x27;d&#x27;</span>]])</span><br><span class="line">[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>]</span><br></pre></td></tr></table></figure><p>It can be implemented as follows:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> flatten = <span class="function">(<span class="params">arr</span>) =&gt;</span> [].concat(...arr)</span><br></pre></td></tr></table></figure><p>So the following expressions are equivalent</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flatten(arr.map(func))</span><br><span class="line">flatMap(arr, <span class="function"><span class="params">x</span> =&gt;</span> x)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Functional Program </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>New Babel Preset - Env</title>
      <link href="/2017/05/21/new-babel-preset-env/"/>
      <url>/2017/05/21/new-babel-preset-env/</url>
      
        <content type="html"><![CDATA[<p><code>babel-preset-env</code> is a new preset which let you specify an environment and automatically enables the necessary plugins.</p><p>At the moment, several presets let you determine what features Babel should support:</p><ul><li><p><code>babel-preset-es2015</code>, <code>babel-preset-es2016</code>, etc: incrementally support various versions of ECMAScript. <code>babel-preset-es2015</code> transpiles what’s new in ES6 to ES5, <code>babel-preset-es2016</code> transpiles what’s new in ES7 to ES6.</p></li><li><p><code>babel-preset-latest</code>: supports all features that are either part of an ECMAScript version or at stage 4.</p></li></ul><p>The problem with these presets is that they often do too much. For example, most modern browsers support ES6 generator. Yet if you use <code>babel-preset-es2015</code>, generator functions will always be transpiled to complex ES5 code.</p><p><code>babel-preset-env</code> works like <code>babel-preset-latest</code>, but it lets you specify an environment and only transpiles features that are missing in that environment.</p><p>Note that you need to install and enable plugins and/or presets for experimental features(that are not part of <code>babel-preset-latest</code>)</p><p>On the plus side, you don’t need <code>es2015</code> presets anymore.</p><h1 id="Browsers"><a href="#Browsers" class="headerlink" title="Browsers"></a>Browsers</h1><p>For browsers you have the option to specify either:</p><ul><li><p>Browsers via <code>browserslist</code> query syntax</p><ul><li><p>Support the last two versions of browsers and IE 7+</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;babel&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;presets&quot;</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">&quot;env&quot;</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;targets&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;browsers&quot;</span>: [<span class="string">&quot;last 2 versions&quot;</span>, <span class="string">&quot;ie &gt;= 7&quot;</span>]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Support browsers that have more than 5% market share</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;targets&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;browsers&quot;</span>: <span class="string">&quot;&gt; 5%&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Fixed versions of browsers:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;targets&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;chrome&quot;</span>: <span class="number">56</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h1 id="Node-js"><a href="#Node-js" class="headerlink" title="Node.js"></a>Node.js</h1><p>If you compile your code for Node.js on the fly via Babel, <code>babel-preset-env</code> is especially useful, because it react to the currently running version of Node.js if you set the target <code>node</code> to <code>current</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;babel&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;presets&quot;</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">&quot;env&quot;</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;target&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;targets&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;node&quot;</span>: <span class="string">&quot;current&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Additional-Options-for-babel-preset-env"><a href="#Additional-Options-for-babel-preset-env" class="headerlink" title="Additional Options for babel-preset-env"></a>Additional Options for <code>babel-preset-env</code></h1><h2 id="modules-string-default-‘commonjs’"><a href="#modules-string-default-‘commonjs’" class="headerlink" title="modules(string, default: ‘commonjs’)"></a>modules(string, default: ‘commonjs’)</h2><p>This options lets you configure to which module format ES6 modules are transpiled:</p><ul><li><p>Transpile to popular module formats: ‘amd’, ‘commonjs’, ‘systemjs’, ‘umd’</p></li><li><p>Don’t transpile: false</p></li></ul><h2 id="include-exclude-Array-of-strings-default"><a href="#include-exclude-Array-of-strings-default" class="headerlink" title="include, exclude (Array of strings, default [])"></a>include, exclude (Array of strings, default [])</h2><ul><li><p>include: always enables certain plugins</p></li><li><p>exclude: prevents certain plugins from being enabled</p></li></ul><h2 id="useBuiltIns-boolean-default-false"><a href="#useBuiltIns-boolean-default-false" class="headerlink" title="useBuiltIns (boolean, default: false)"></a>useBuiltIns (boolean, default: false)</h2><p>Babel comes with a polyfill for new functionality in standard library. <code>babel-preset-env</code> can optionally import only those parts of the polyfill that are needed on the specified platforms:</p><p>There are two ways of using the polyfill:</p><ul><li><p><code>core-js</code> polyfills ES5, ES6+ as needed</p><ul><li><p>install polyfill: <code>yarn add core-js</code></p></li><li><p>activate polyfill: <code>import &#39;core-js&#39;</code></p></li></ul></li><li><p><code>babel-polyfill</code>: polyfills <code>core-js</code> and regenerator runtime(to emulate generators on ES5)</p><ul><li><p>install polyfill: <code>yarn add babel-polyfill</code></p></li><li><p>activate polyfill: <code>import &#39;babel-polyfill&#39;</code></p></li></ul></li></ul><p>Either of the two import statements is transpiled to an environment-specific sequence of more fine-grained imports:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;core-js/modules/es7.string.pad-start&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;core-js/modules/es7.string.pad-end&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;core-js/modules/web.timers&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;core-js/modules/web.immediate&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;core-js/modules/web.dom.iterable&quot;</span>;</span><br></pre></td></tr></table></figure><h2 id="debug-boolean-default-false"><a href="#debug-boolean-default-false" class="headerlink" title="debug (boolean, default: false)"></a>debug (boolean, default: false)</h2><p>Logs the following information via <code>console.log()</code></p><ul><li><p>Targeted environments</p></li><li><p>Enabled transformers</p></li><li><p>Enabled plugins</p></li><li><p>Enabled polyfills</p></li></ul><h1 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h1><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;presets&quot;</span>: [</span><br><span class="line">    [<span class="string">&quot;env&quot;</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;targets&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;safari&quot;</span>: <span class="number">10</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;modules&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">&quot;useBuiltIns&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">&quot;debug&quot;</span>: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Babel </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Babel-Polyfill or Babel-Runtime</title>
      <link href="/2017/05/21/babel-polyfill-or-babel-runtime/"/>
      <url>/2017/05/21/babel-polyfill-or-babel-runtime/</url>
      
        <content type="html"><![CDATA[<p>The <code>babel-polyfill</code> and <code>babel-runtime</code> modules are sued to serve the same function in two different ways. Both modules ultimately serve to emulate an ES6 environment.</p><p>Both <code>babel-polyfill</code> and <code>babel-runtime</code> emulate an ES6 environment with two things:</p><ul><li><p>a slew of polyfills as provided by <code>core-js</code></p></li><li><p>complete generator runtime</p></li></ul><p><code>babel-polyfill</code> accomplishes this task by assigning methods on the global or on native type prototypes which means that once required, as far as the javascript runtime you’re using is concerned, ES6 methods and object simply exist. If you were to require <code>babel-polyfill</code> in a script run under <strong>node v0.1.0</strong> – a runtime which does not natively support the <code>Promise</code> API – your script would then have access to the <code>Promise</code> object. As far as you are concerned, you’re suddenly using an environment that support the <code>Promise</code> object.</p><p><code>babel-runtime</code> does something very similar, but in a way that does not pollute native object prototypes or the global namespace. Instead, <code>babel-runtime</code> is a module that you can list as a dependency of your application like any other module, which polyfills ES6 methods. In other words and continuing the example from above, while you may not have the <code>Promise</code> object available to you, you now have the same functionality available to you from <code>require(&#39;babel-runtime/core-js/promise&#39;)</code>. By itself, this is useful but inconvenient. Fortunately, <code>babel-runtime</code> is not intended to be used by itself. Rather, <code>babel-runtime</code> is intended to be paired with the transform – <code>babel-plugin-transform-runtime</code> – which will automatically rewrite your code such that you can write your code using the <code>Promise</code> API and it will be transformed to use the Promise-like object exported by <code>babel-runtime</code></p><p><code>babel-polyfill</code> offers you the conveniences of gloablly defined objects without having to transform your code further. However, as with anything that mutates a global, this can introduce collision between versions, etc.</p><p><code>babel-runtime</code>, on the other hand, will not suffer from collision as everything is name-spcaed. Since the module will be defined in your package.json, it can be versioned like everything else. The tradeoff, however, is that a transform can only do so much. The runtime remaps methods according to a definitions map. Anecdotally, this has covered each of my use-cases but there may be an obscure method or two which is not remapped. There are also certain cases where your intent is ambiguous. In such cases, the transform won’t know exactly what to do.</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>To summarize, with the general case for Babel 6, there are two main steps you’ll need to perform:</p><ul><li>Provide your code with an emulated ES6 environment by either requiring <code>babel-polyfill</code> or requiring the <code>babel-runtime</code> module plus the <code>babel-plugin-transform-runtime</code> transform:</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// for babel-polyfill, either add:</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;babel-polyfill&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// for babel-runtime, install the module, then use the babel-plugin-transform-runtime transform by including it in your .babelrc file.</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Babel </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Deep in Runtime-Transform</title>
      <link href="/2017/05/21/Deep-in-Runtime-Transform/"/>
      <url>/2017/05/21/Deep-in-Runtime-Transform/</url>
      
        <content type="html"><![CDATA[<p>This plugin is recommended in a <strong>library/tool</strong></p><blockquote><p>Note: Instance methods such as <code>&#39;foobar&#39;.includes(&#39;foo&#39;)</code> will not work since that would require modification of existing built-ins(Use <code>babel-polyfill</code> for that)</p></blockquote><p>Babel uses very small helpers for common functions such as <code>_extend</code>. By default this will be added to every file that requires it. This duplication is sometimes unnecessary, especially when your application is spread out over multiple files.</p><p>This is where the <code>transform-runtime</code> plugin comes in: all of the helpers will reference the module <code>babel-runtime</code> to avoid duplication across your compiled output. The runtime will be compiled into your build.</p><p>Another purpose of this transformer is to create a sandboxed environment for your code. If you use <code>babel-polyfill</code> and the built-ins it provides such as <code>Promise</code>, <code>Set</code> and <code>Map</code>, those will pollute the global scope. While this might be ok for an app or a command line tool, it becomes a problem if your code is a library which you intend to publish for other to use or if you can’t exactly control the environment in which your code will run.</p><p>The transformer will alias these built-ins to <code>core-js</code> so you can use them seamlessly without having to require the polyfill.</p><h1 id="Prod-and-Dev"><a href="#Prod-and-Dev" class="headerlink" title="Prod and Dev"></a>Prod and Dev</h1><p>In most cases, you should install <code>babel-plugin-transform-runtime</code> as a development dependency, and <code>babel-runtime</code> as a production dependency.</p><h1 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h1><p>I prefer to use <code>.babelrc</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;plugins&quot;: [</span><br><span class="line">    [&quot;transform-runtime&quot;, &#123;</span><br><span class="line">      &quot;helpers&quot;: false,</span><br><span class="line">      &quot;polyfill&quot;: false,</span><br><span class="line">      &quot;regenerator&quot;: true,</span><br><span class="line">      &quot;moduleName&quot;: &quot;babel-runtime&quot;</span><br><span class="line">    &#125;]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>There the options are referred.</p><ul><li>helpers: boolean, default to <code>true</code></li></ul><p>Toggles whether or not inlined babel helpers (<code>classCallCheck</code>, <code>extends</code>, etc) are replaced with calls to <code>moduleName</code>.</p><ul><li>polyfill: boolean, default to be <code>true</code></li></ul><p>Toggles whether or not new built-ins(<code>Promise</code>, <code>Set</code>, <code>Map</code>, etc) are transformed to use a non-global polluting polyfill.</p><ul><li>renegerator: boolean, default to <code>true</code></li></ul><p>Toggles whether or not generator functions are transforms to use a regenerator runtime that does not pollute the global scope.</p><ul><li>moduleName: string, default to <code>babel-runtime</code></li></ul><p>Set the name/path of the module used when importing helpers.</p><p>Example:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;moduleName&quot;</span>: <span class="string">&quot;flavortown/runtime&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">extends</span> <span class="keyword">from</span> <span class="string">&#x27;flavortown/runtime/helpers/extend&#x27;</span></span><br></pre></td></tr></table></figure><h1 id="Technical-Details"><a href="#Technical-Details" class="headerlink" title="Technical Details"></a>Technical Details</h1><p>The <code>runtime</code> transformer plugin does three things:</p><ul><li><p>Automatically requires <code>babel-runtime/renegerator</code> when you use generator/async functions;</p></li><li><p>Automatically requires <code>babel-runtime/core-js</code> and maps ES6 static methods and built-ins;</p></li><li><p>Removes the inline Babel helpers and uses the module <code>babel-runtime/helpers</code> instead.</p></li></ul><p>You can use built-ins such as <code>Promise</code>, <code>Set</code>, <code>Symbol</code>, etc., as well as use all the Babel features taht require a polyfill seamlessly, without global pollution, making it extremely suitable for libraries.</p><h2 id="Regenerator-aliasing"><a href="#Regenerator-aliasing" class="headerlink" title="Regenerator aliasing"></a>Regenerator aliasing</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> * <span class="title">foo</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>the following is generated</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> _marked = [foo].map(regeneratorRuntime.mark)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> regeneratorRuntime.wrap(<span class="function"><span class="keyword">function</span> <span class="title">foo$</span>(<span class="params">_context</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) <span class="keyword">switch</span> (_context_prev = _context.next) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;end&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> _context.stop()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, _marked[<span class="number">0</span>], <span class="built_in">this</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This isn’t ideal as then you have to include the regenerator runtime which pollutes the global scope.</p><p>Instead what the <code>runtime</code> transformer does it compile that to:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> _regenerator = <span class="built_in">require</span>(<span class="string">&#x27;babel-runtime/regenerator&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> _regenerator2 = _interopRequireDefault(_regenerator)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_interopRequireDefault</span> (<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> obj &amp;&amp; obj.__esModule ? obj : &#123; <span class="attr">default</span>: obj &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> _marked = [foo].map(_regenerator2.default.mark)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> regeneratorRuntime.wrap(<span class="function"><span class="keyword">function</span> <span class="title">foo$</span>(<span class="params">_context</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) <span class="keyword">switch</span> (_context_prev = _context.next) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;end&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> _context.stop()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, _marked[<span class="number">0</span>], <span class="built_in">this</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This means that you can use the regenerator runtime without polluting your current environment.</p><p>The same actions with Core-js Aliasing and Helper Aliasing.</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>More Faster React Functional Component</title>
      <link href="/2017/05/21/More-Faster-React-Functional-Component/"/>
      <url>/2017/05/21/More-Faster-React-Functional-Component/</url>
      
        <content type="html"><![CDATA[<p><a href="https://medium.com/missive-app/45-faster-react-functional-components-now-3509a668e69f">Original</a></p><p>An basic <code>Avatar</code> Component:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Avatar</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;this.props.url&#125;</span> /&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>And its functional component style is:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Avatar = <span class="function">(<span class="params">&#123; url &#125;</span>) =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;url&#125;</span> /&gt;</span></span></span><br></pre></td></tr></table></figure><p>As you can see, it’s just a simple js function returning an element.</p><p>React still does a lot of stuff on functional components that, by nature, will never be used.</p><p>But we can skip React internals for these functional component.</p><p>They are just plain JavaScritp functions, which means we can call it in the render function.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &#123;Avatar(&#123; <span class="attr">url</span>: avatarUrl &#125;)&#125;</span><br><span class="line">    &lt;div&gt;&#123;commentBody&#125;&lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;,</span><br><span class="line">  mountNode,</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>As we know, the traditional usage:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Avatar url=&#123;avatarUrl&#125; /&gt;</span><br></pre></td></tr></table></figure><p>will be compiled into</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">React.createElement(Avatar, &#123; <span class="attr">url</span>: avatarUrl &#125;)</span><br></pre></td></tr></table></figure><p>It will cost a lifecycle of a React Component.</p><p>But with direct calling of plain JavaScritp Function, all these consumption can be eliminated.</p><p>By the way, <code>transform-react-inline-elements</code> does the same as a bebel transform, so there’s no need to change the source code.</p>]]></content>
      
      
      
        <tags>
            
            <tag> React </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Css Shorthand Collection</title>
      <link href="/2017/05/19/css-shorthand-collection/"/>
      <url>/2017/05/19/css-shorthand-collection/</url>
      
        <content type="html"><![CDATA[<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>:</span><br><span class="line">    <span class="built_in">url</span>(...) <span class="comment">/* image */</span></span><br><span class="line">    top center / <span class="number">200px</span> <span class="number">200px</span> <span class="comment">/* position / size */</span></span><br><span class="line">    no-repeat <span class="comment">/* repeat */</span></span><br><span class="line">    fixed <span class="comment">/* attachment */</span></span><br><span class="line">    padding-box <span class="comment">/* origin */</span></span><br><span class="line">    content-box <span class="comment">/* clip */</span></span><br><span class="line">    red; <span class="comment">/* color */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Usage of Grid in Css</title>
      <link href="/2017/05/18/usage-of-grid-in-css/"/>
      <url>/2017/05/18/usage-of-grid-in-css/</url>
      
        <content type="html"><![CDATA[<p><a href="https://css-tricks.com/snippets/css/complete-guide-grid/">Original</a></p><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>CSS Grid Layout (aka ‘Grid’), is a two-dimensional grid-based layout system that aims to do nothing less than completely change the way we design grid-based user interfaces.</p><h1 id="Terminology"><a href="#Terminology" class="headerlink" title="Terminology"></a>Terminology</h1><h2 id="Grid-Container"><a href="#Grid-Container" class="headerlink" title="Grid Container"></a>Grid Container</h2><p>The element on which <code>display: grid</code> is applied. It’s the direct parent of all the grid items. In this example <code>container</code> is the grid container.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item item-1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item item-2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item item-3&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Grid-Item"><a href="#Grid-Item" class="headerlink" title="Grid Item"></a>Grid Item</h2><p>The children (e.g. <strong>direct</strong> descendants) of the grid container. Here the <code>item</code> elements are grid items, but <code>sub-item</code> isn’t.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;sub-item&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Grid-Line"><a href="#Grid-Line" class="headerlink" title="Grid Line"></a>Grid Line</h2><p>The dividing lines that make up the structure of the grid. They can be either vertical(<code>column grid line</code>) or horizontal(<code>row grid line</code>) and reside on either side of a row or column. Here the yellow line is an example of a column grid line.</p><p><img src="https://cdn.css-tricks.com/wp-content/uploads/2016/03/grid-line.png"></p><h2 id="Grid-Track"><a href="#Grid-Track" class="headerlink" title="Grid Track"></a>Grid Track</h2><p>The space between two adjacent grid lines. You can think of them like the columns or rows of the grid. Here’s the grid track between second and third row grid lines.</p><p><img src="https://cdn.css-tricks.com/wp-content/uploads/2016/03/grid-track.png"></p><h2 id="Grid-Cell"><a href="#Grid-Cell" class="headerlink" title="Grid Cell"></a>Grid Cell</h2><p>The space between two adjacent row and two adjacent column lines. It’s a single ‘unit’ of the grid. Here’s the grid cell between row grid lines 1 and line2, and column grid lines 2 and 3.</p><h2 id="Grid-Area"><a href="#Grid-Area" class="headerlink" title="Grid Area"></a>Grid Area</h2><p>The total space surrounded by four grid lines. A grid area may be comprised of any number of grid cells. Here’s the grid area between row and grid lines 1 and 3, and column grid lines 1 and 3.</p><p><img src="https://cdn.css-tricks.com/wp-content/uploads/2016/03/grid-area.png"></p><h1 id="Properties"><a href="#Properties" class="headerlink" title="Properties"></a>Properties</h1><h2 id="Container"><a href="#Container" class="headerlink" title="Container"></a>Container</h2><ul><li><p>display</p><ul><li><p>grid: generates a <strong>block-level</strong> grid</p></li><li><p>inline-grid: generates an inline level grid</p></li><li><p>subgrid: if your grid container is itself a grid item(i.e. nested grids), you can use this property to indicate that you want the sizes of its rows/columns to be taken from its parent rather than specifying its own.</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line"> <span class="attribute">display</span>: grid | inline-grid | subgrid;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><code>column</code>, <code>float</code>, <code>clear</code> and <code>vertical-align</code> have no effect on a grid container</p></blockquote></li></ul></li><li><p>grid-template-rows &amp; grid-template-columns</p><ul><li><p><track-size>: can be a length, a percentage, or a function of the free space in the grid(using the <code>fr</code> unit)</track-size></p></li><li><p><line-name>: an arbitrary name of your choosing</line-name></p></li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="attribute">grid-template-columns</span>: &lt;track-size&gt; | [&lt;line-name&gt;] &lt;track-size&gt;;</span><br><span class="line">  <span class="attribute">grid-template-rows</span>: &lt;track-size&gt; | &lt;line-name&gt; &lt;track-size&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>A line can have more than one name, seperated by spcae.</p></blockquote><p>You can use <code>repeat()</code> notation to streamline things:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="attribute">grid-template-columns</span>: <span class="built_in">repeat</span>(<span class="number">3</span>, <span class="number">20px</span> [col-start]) <span class="number">5%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The <code>fr</code> unit allows you to set the size of a track as a fraction of the free space of the grid container.</p><p>The free space is calculated <strong>after</strong> any non-flexible items.</p></li><li><p>grid-template-areas:</p><ul><li><p><grid-area-name>: the name of a grid area specified with <code>grid-area</code></grid-area-name></p></li><li><p><code>.</code>: a period signifies an empty grid cell.</p></li><li><p>none: no grid areas are defined.</p></li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="attribute">grid-template-areas</span>: &lt;grid-area-name&gt; | . | none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.item-a</span> &#123;</span><br><span class="line">  <span class="attribute">grid-area</span>: header;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.item-b</span> &#123;</span><br><span class="line">  <span class="attribute">grid-area</span>: main;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.item-c</span> &#123;</span><br><span class="line">  <span class="attribute">grid-area</span>: sidebar;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.item-d</span> &#123;</span><br><span class="line">  <span class="attribute">grid-area</span>: footer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="attribute">grid-template-columns</span>: <span class="built_in">repeat</span>(<span class="number">4</span>, <span class="number">50px</span>);</span><br><span class="line">  <span class="attribute">grid-template-rows</span>: auto;</span><br><span class="line">  <span class="attribute">grid-template-areas</span>:</span><br><span class="line">    <span class="string">&#x27;header header header header&#x27;</span></span><br><span class="line">    <span class="string">&#x27;main main . sidebar&#x27;</span></span><br><span class="line">    <span class="string">&#x27;footer footer footer footer&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.css-tricks.com/wp-content/uploads/2016/03/grid-template-areas.png"></p></li><li><p>grid-template: a shorthand for setting <code>grid-template-rows</code>, <code>grid-template-columns</code> and <code>grid-template-areas</code> in a single decalration.</p><ul><li><p>none: sets all three properties to their initial values</p></li><li><p>subgrid: sets <code>grid-template-rows</code>, <code>grid-template-columns</code> to <code>subgrid</code>, and <code>grid-template-areas</code> to its initial value.</p></li><li><p><grid-template-rows>/<grid-template-columns>: sets <code>grid-template-rows</code> and <code>grid-template-columns</code> to the specified values, respectively, and sets <code>grid-template-areas</code> to <code>none</code></grid-template-columns></grid-template-rows></p></li></ul></li><li><p>grid-column-gap &amp; grid-column-gap: Specifies the size of the grid lines. You can think of it like setting the width of the gutters between the columns/rows.</p><ul><li><line-size>: a length value</line-size></li></ul></li><li><p>grid-gap: a shorthand for <code>grid-row-gap</code> and <code>grid-column-gap</code></p></li><li><p>justify-items: Aligns the content inside a grid item along with the <em>row</em> axis</p><ul><li><p>start: aligns the content to the left end of the grid area</p></li><li><p>end: aligns the content to the right end of the grid area</p></li><li><p>center: aligns the content in the center of the grid area</p></li><li><p>stretch: fills the whole width of the grid area(this is the default)</p></li></ul><blockquote><p>This behavior can also be set on individual grid items via the <code>justify-self</code> property</p></blockquote></li><li><p>align-items: aligns the content inside a grid item along the <em>column</em> axis. This value applies to all grid items inside the container.</p><ul><li><p>start: aligns the content to the top of the grid area</p></li><li><p>end: aligns the content to the bottom of the grid area</p></li><li><p>center: aligns the content in the center of the grid area</p></li><li><p>stretch: fills the whole height of the grid area(this is the default)</p></li></ul><blockquote><p>This behavior can also be set on individual grid items via the <code>align-self</code> properties.</p></blockquote></li><li><p>justify-content: Sometimes the total size of your grid might be less than the size of its grid container. This could happen if all of your grid items are sized with non-flexible units like <code>px</code>. In this case you can set the alignment of the grid within the grid container. This property aligns the grid along the <em>row</em> axis.</p><ul><li><p>start: aligns the grid to the left end of the grid container</p></li><li><p>end</p></li><li><p>center</p></li><li><p>stretch: <strong>resize</strong> the grid items to allow the grid to fill the full width of the grid container.</p></li><li><p>space-around: places an even amount of space between each grid item, with half-sized spaces on the far ends.</p></li><li><p>space-between: places an event amount of space between each grid item, with no space at the far ends.</p></li><li><p>space-evenly: places an even amount of space between each grid item, including the far ends</p></li></ul></li><li><p>align-content:</p><ul><li><p>start</p></li><li><p>end</p></li><li><p>center</p></li><li><p>stretch</p></li><li><p>space-around</p></li><li><p>space-between</p></li><li><p>space-evenly</p></li></ul></li><li><p>grid-auto-columns &amp; grid-auto-rows:</p><ul><li><track-size>: can be a length, a percentage, or a fraction of the free space in the grid(using the <code>fr</code> unit)</track-size></li></ul><p>To illustrate how implicit grid tracks get created, think about this:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="attribute">grid-template-columns</span>: <span class="number">60px</span> <span class="number">60px</span>;</span><br><span class="line">  <span class="attribute">grid-template-rows</span>: <span class="number">90px</span> <span class="number">90px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This creates a 2 x 2 grid</p><p><img src="https://cdn.css-tricks.com/wp-content/uploads/2016/03/grid-auto.png"></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.item-a</span> &#123;</span><br><span class="line">  <span class="attribute">grid-row</span>: <span class="number">2</span>/<span class="number">3</span>;</span><br><span class="line">  <span class="attribute">grid-column</span>: <span class="number">1</span>/<span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.item-b</span> &#123;</span><br><span class="line">  <span class="attribute">grid-row</span>: <span class="number">2</span>/<span class="number">3</span>;</span><br><span class="line">  <span class="attribute">grid-column</span>: <span class="number">5</span>/<span class="number">6</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.css-tricks.com/wp-content/uploads/2016/03/implicit-tracks.png"></p><p>We told <code>.item-b</code> to start on column line 5 and end at column line 6, <em>but we never defined a column 5 or 6</em>.</p><p>Because we referenced lines that don’t exist, implicit track with widths of 0 are created to fill in the gap.</p><p>We can use <code>grid-auto-column</code> and <code>grid-auto-row</code> to specify the widths of these implicit tracks:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="attribute">grid-auto-columns</span>: <span class="number">60px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.css-tricks.com/wp-content/uploads/2016/03/implicit-tracks-with-widths.png"></p></li><li><p>grid-auto-flow: If you have grid items that you don’t explicitly place on the grid, the <em>auto-placement algorithm</em> kicks in to automatically place the items. This properties controls how the auto-placement algorithm works.</p><ul><li><p>row: tells the auto-placement algorithm to fill in each row in turn. adding new rows as necessary.</p></li><li><p>column: tells the auto-placement algorithm to fill in each column in turn, adding new columns as necessary.</p></li><li><p>dense: tells the auto-placement algorithm to attempt to fill in holes earlier in the grid if smaller items come up later.</p></li></ul><blockquote><p><code>dense</code> might cause your items to appear out of order</p></blockquote></li><li><p>grid: a shorthand for setting all of the following properties in a single declaration:</p><ul><li><code>grid-template-rows</code>, <code>grid-template-columns</code>, <code>grid-template-areas</code>, <code>grid-auto-rows</code>, <code>grid-auto-columns</code>, <code>grid-auto-flow</code></li></ul></li></ul><h2 id="Items"><a href="#Items" class="headerlink" title="Items"></a>Items</h2><ul><li><p>grid-column-start &amp; grid-column-end &amp; grid-row-start &amp; grid-row-end</p><ul><li><p>determines a grid item’s location within the grid by referring to specific grid line.</p></li><li><p><line>: can be number to refer to a numbered grid line, or a name to refer to a named grid line</line></p></li><li><p>span</p><p><number>: the item will span across the provided number of grid tracks</number></p></li><li><p>span</p><p><name>: the item will span across until it hits the next line with the provided name</name></p></li><li><p>auto</p></li></ul></li><li><p>grid-column &amp; grid-row: shorthand for <code>grid-column-start</code> + <code>grid-column-end</code> and <code>grid-row-start</code> + <code>grid-row-end</code>, respectively.</p><ul><li><start-value> / <end-value><br></end-value></start-value></li></ul></li><li><p>grid-area: gives an item a name so that it can be referenced by a template created with the <code>grid-template-areas</code> property. Alternatively, this property can be used as an even shorter shorthand for <code>grid-row-start</code> + <code>grid-column-start</code> + <code>grid-row-end</code> + <code>grid-column-end</code>.</p><ul><li><p><name>: a name of your choosing</name></p></li><li><p><row-start> / <column-start> / <row-end> / <column-end><br></column-end></row-end></column-start></row-start></p></li></ul></li><li><p>justify-self: aligns the content inside a grid item along the row axis. This value applies to the content inside a single item.</p><ul><li><p>start</p></li><li><p>end</p></li><li><p>center</p></li><li><p>stretch</p></li></ul></li><li><p>align-self: aligns the content inside a grid item along the column axis. This value applies to the content inside a single grid item.</p><ul><li><p>start</p></li><li><p>end</p></li><li><p>center</p></li><li><p>stretch</p></li></ul></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Simple Usage of Scp</title>
      <link href="/2017/05/17/simple-usage-of-scp/"/>
      <url>/2017/05/17/simple-usage-of-scp/</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.tecmint.com/scp-commands-examples/">Original</a></p><h1 id="Basic-Syntax-of-SCP"><a href="#Basic-Syntax-of-SCP" class="headerlink" title="Basic Syntax of SCP"></a>Basic Syntax of SCP</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp source_file_name username@destination_host:destination_folder</span><br></pre></td></tr></table></figure><h1 id="Provider-the-detail-information-of-SCP-process-using-v-parameter"><a href="#Provider-the-detail-information-of-SCP-process-using-v-parameter" class="headerlink" title="Provider the detail information of SCP process using -v parameter"></a>Provider the detail information of SCP process using <code>-v</code> parameter</h1><p>Baisc SCP command without parameter will copy the files in background. User will see nothing unless the process is done or something error appears.</p><p>You can use <code>-v</code> parameter to print debug information into screen.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># verbose</span></span><br><span class="line">scp -v source_file_name username@destination_host:destination_folder</span><br></pre></td></tr></table></figure><h1 id="Provider-modification-times-access-times-and-modes-from-original-files"><a href="#Provider-modification-times-access-times-and-modes-from-original-files" class="headerlink" title="Provider modification times, access times, and modes from original files"></a>Provider modification times, access times, and modes from original files</h1><p>The <code>-p</code> (lowercase) parameter will help you on this. An estimated time and the connection speed will apear on the screen.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># process</span></span><br><span class="line">scp -p source_file_name username@destination_host:destination_folder</span><br></pre></td></tr></table></figure><h1 id="Make-file-transfer-faster-using-C-parameter"><a href="#Make-file-transfer-faster-using-C-parameter" class="headerlink" title="Make file transfer faster using -C parameter"></a>Make file transfer faster using <code>-C</code> parameter</h1><p>One of parameter that can faster your file transfer is <code>-C</code> parameter. The <code>-C</code> parameter will compress your file on the go. The unique thing is the compression is only happen in the network. When the file is arrived to the destination server, it will returning into the original size as before the compression happen.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Compression</span></span><br><span class="line">scp -Cpv source_file_name username@destination_host:destination_folder</span><br></pre></td></tr></table></figure><h1 id="Specify-specific-port-to-use-with-SCP"><a href="#Specify-specific-port-to-use-with-SCP" class="headerlink" title="Specify specific port to use with SCP"></a>Specify specific port to use with SCP</h1><p>Usually SCP is using port 22 as a default port. But for security reason, you may change the port into another port.</p><p>Use <code>-P</code> (uppercase) to specify the port.</p><pre><code class="bash">scp -P 2212 source_file_name username@destination_host:destination_folder``</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> Shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RxJS API</title>
      <link href="/2017/05/08/Rxjs-API/"/>
      <url>/2017/05/08/Rxjs-API/</url>
      
        <content type="html"><![CDATA[<h1 id="Create"><a href="#Create" class="headerlink" title="Create"></a>Create</h1><p>You can create an Observable from scratch by using the <code>Create</code> operator. You pass this operator a function that accepts the observer as its parameter. Write this function so that it behaves as an Observable – by calling the observer’s <code>onNext</code>, <code>onError</code>, and <code>onCompleted</code> methods appropraitely.</p><p>A well-formed finite Observable must attempt to call either the observer’s <code>onCompleted</code> method exactly once or its <code>onError</code> method exactly once, and must not thereafter attempt to call any of the observer’s other methods.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> source = Rx.Observable.create(<span class="function"><span class="keyword">function</span>(<span class="params">observer</span>) </span>&#123;</span><br><span class="line">  observer.onNext(<span class="number">32</span>)</span><br><span class="line">  observer.onCompleted()</span><br><span class="line">  <span class="comment">// this is optional.</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;disposed&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> subscription = source.subscribe(</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Next: &#x27;</span> + x)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Error: &#x27;</span> + err)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Completed&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h1 id="Defer"><a href="#Defer" class="headerlink" title="Defer"></a>Defer</h1><p>Do not create the Observable until the observer subscribes, and create a fresh Observable for each observer.</p><p>The <code>Defer</code> operator waits until an observer subscribes to it, and then it generates an Observable, typically with an Observable factory function. It does this afresh for each subsciber, so although each subscriber may think it is subscribing to the same Observable, in fact each subscriber gets its own individual sequence.</p><p>In some circumstances, waiting until the last minute to generate the Observable can ensure that this Observable contains the freshest data.]</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> source = Rx.Observable.defer(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> Rx.Observable.return(<span class="number">42</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> subscription = source.subscribe(</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Next: &#x27;</span> + x)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Error: &#x27;</span> + err)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Completed&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h1 id="Empty-Never-Throw"><a href="#Empty-Never-Throw" class="headerlink" title="Empty/Never/Throw"></a>Empty/Never/Throw</h1><p><code>Empty</code> create an Observable that emits no items but terminates normally</p><p><code>Never</code> create an Observable that emits no items and does not terminates</p><p><code>Throw</code> create an Observable that emits no items and terminates with an error</p><p>The <code>Empty</code>, <code>Never</code>, <code>Throw</code> operators generate Observables with very specific and limited behavior. These are useful for testing purposes, and sometimes also for combining with other Observables or as parameters to operators that expect other Observables as parameters.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> source = Rx.Observable.empty()</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> source = Rx.Observable.never()</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> source = Rx.Observable.return(<span class="number">52</span>).selectMany(Rx.Observable.throw(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;error&#x27;</span>)))</span><br></pre></td></tr></table></figure><h1 id="From"><a href="#From" class="headerlink" title="From"></a>From</h1><p>Convert various other objects and data types into Observables.</p><p>When you work with Observables, it can be more convenient if all of the data you mean to work with can be represented as Observables, rather than as a mixture of Observables and other types. This allows you to use a single set of operators to govern the entire lifespan of the data stream.</p><p>Iterables, for example, can be thought of as a sort of synchronous Observable; Futures, as a sort of Observable that always emits only a single item. By explicitly converting such objects to Observables, you allow them to interact as peers with other Observale.</p><p>In RxJS, the <code>from</code> operator converts an <em>array-like</em> or <em>iterable</em> object into an Observable that emits the items in that array or iterable. A String, in this context, is treated as an array of characters.</p><p>The operator also takes three additional, optional parameters:</p><ul><li><p>a transforming function that takes an item from the array or iterable as input and produces an item to be emmited by the resulting Observable as output</p></li><li><p>a second argument to pass into</p></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> RxJS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Detail of Node Cluster</title>
      <link href="/2017/05/02/detail-of-node-cluster/"/>
      <url>/2017/05/02/detail-of-node-cluster/</url>
      
        <content type="html"><![CDATA[<h1 id="Cluster"><a href="#Cluster" class="headerlink" title="Cluster"></a>Cluster</h1><p>A single instance of Node.js runs in a single tread. To take advantage of multi-core systems the user will sometimes want to launch a cluster of Node.js processes to handle the load.</p><p>The cluster module allows you to easily create child processes that all share <strong>server port</strong>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> cluster = <span class="built_in">require</span>(<span class="string">&#x27;cluster&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> numCPUs = <span class="built_in">require</span>(<span class="string">&#x27;os&#x27;</span>).cpus().length</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (cluster.isMaster) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Master <span class="subst">$&#123;process.pid&#125;</span> is running`</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Fork workers</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; numCPUs; i++) &#123;</span><br><span class="line">    cluster.fork()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  cluster.on(<span class="string">&#x27;exit&#x27;</span>, <span class="function">(<span class="params">worker, code, signal</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`worker <span class="subst">$&#123;worker.process.pid&#125;</span> died`</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// Workers can share any TCP connection</span></span><br><span class="line">  <span class="comment">// In this case it is an HTTP Server</span></span><br><span class="line"></span><br><span class="line">  http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.writeHead(<span class="number">200</span>)</span><br><span class="line">    res.end(<span class="string">&#x27;hello world\n&#x27;</span>)</span><br><span class="line">  &#125;).listen(<span class="number">8000</span>)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Worker <span class="subst">$&#123;process.pid&#125;</span> started`</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Running Node.js will now share port 8000 between the workers.</p><h1 id="How-it-works"><a href="#How-it-works" class="headerlink" title="How it works"></a>How it works</h1><p>The workder processes are spawned using the <code>child_process.fort()</code> method, so that they can communicate with the parent via IPC and pass server handles back and forth.</p><p>The cluster module supports two methods of distributing incoming connections.</p><p>The first one (and the default one on all platform except Windows), is the <strong>round-robin</strong> approch, where the master process listens on a port, accepts new connections and distributes them across the workers in a round-robin fashion, with some built-in smarts to avoid overloading a worker process.</p><p>The second approach is where the master process <strong>creates the listen socket and sends it to interested workers</strong>. The workers then accept incoming connection directly.</p><p>The second approach should, in theory, give the best performance. In practice however, distribution tends to be <strong>very unbalanced due to operating system scheduler vagaries</strong>. Loads have been observed where over 70% of all connections ended up in just two process, out of a total of eight.</p><p>Because <code>server.listen()</code> hands off most of the worker to the master process, there are three case where the behavior between a normal Node.js process and a cluster worker differs:</p><blockquote><p><code>server.listen(&#123;fd: 7&#125;)</code> Because the message is passed to the master, file descriptor 7 <strong>in the parent</strong> will be listened on, and the handle passed to the worker, rather than listening to the worker’s idea of what the number 7 file descriptor reference. (the fd will be used up sooner)</p></blockquote><blockquote><p><code>server.listen(handle)</code> Listening on handles explicitly wil cause the worker to use the supplied handle, rather than talk to the master process. If the worker already has the handle, then it’s presumed that you know what you are doing.</p></blockquote><blockquote><p><code>server.listen(0)</code> Normally, this will cause servers to listen on a random port. However, in a cluster, each worker will receive the same ‘random’ port each time they do <code>listen(0)</code>. In essence, the port is random the first time, but predicatable thereafter. If you want to listen on a unique port, generate a port number based on the cluster worker ID.</p></blockquote><p>There is no routing logic in Node.js, or in your program, and no shared state between the workers. Therefore, it is important to design your program such that it does not rely on heavily on in-memory data object for things like sessions and login.</p><p>Because workers are all separate processes, they can be killed or re-spawned depending on your program’s needs, without affecting other workers. As long as there are some workers still alive, the server will continue to accept connections. If no workers are alive, existing connections will be dropped and new connections will be refused. Node.js does not automatically manage the number of worker for you, however. It is yoru responsibility to manage the worker pool for your application’s needs.</p><h1 id="Class-worker"><a href="#Class-worker" class="headerlink" title="Class: worker"></a>Class: worker</h1><p>A Worder Object contains all public information and method about a worker. In the master it can be obtained using <code>cluster.workers</code>. In a worker it can be obtained using <code>cluster.worker</code></p><h2 id="Event-‘disconnect’"><a href="#Event-‘disconnect’" class="headerlink" title="Event: ‘disconnect’"></a>Event: ‘disconnect’</h2><p>Similar to the <code>cluster.on(&#39;disconnect&#39;)</code> event, but specific to this worker.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cluster.fork().on(<span class="string">&#x27;disconnect&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// Worker has disconnected</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="Event-‘error’"><a href="#Event-‘error’" class="headerlink" title="Event: ‘error’"></a>Event: ‘error’</h2><p>This event is the same as the one provided by <code>child_process.fork()</code></p><p>In a worker you can alse use <code>process.on(&#39;error&#39;)</code></p><h2 id="Event-‘exit’"><a href="#Event-‘exit’" class="headerlink" title="Event: ‘exit’"></a>Event: ‘exit’</h2><blockquote><p><code>code</code></p></blockquote><blockquote><p><number> the exit code, if it exited Normally</number></p></blockquote><blockquote><p><code>signal</code></p></blockquote><blockquote><p><string> the name of the signal(e.g. <strong>SIGHUP</strong>) that caused the process to be killed.</string></p></blockquote><p>Similar to the <code>cluster.on(&#39;exit&#39;)</code> event, but specific to this worker</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> worker = cluster.fork()</span><br><span class="line">worker.on(<span class="string">&#x27;exit&#x27;</span>, <span class="function">(<span class="params">code, signal</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (signal) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`worker was killed by signal: <span class="subst">$&#123;signal&#125;</span>`</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (code !== <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`worker exited with error code: <span class="subst">$&#123;code&#125;</span>`</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;worker success&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="Event-‘listening’"><a href="#Event-‘listening’" class="headerlink" title="Event: ‘listening’"></a>Event: ‘listening’</h2><blockquote><p><code>address</code></p></blockquote><blockquote><object>  <p></p>  <p>Similar to the <code>cluster.on('listening')</code> event, but specific to this worker.</p>  <pre></blockquote><blockquote><p>  <code class="lang-javascript">cluster.fork().on('listening', (address) =&gt; &#123;<br>  // Worker is listening<br>&#125;)<br></code><br></pre><br>  <p>It is not emitted in the worker</p><br>  <h4 id="event-message-">Event: ‘message’</h4><br>  <blockquote><br>  <p><code>message</code> <object><br>  <p></p></p>  <p><code>handle</code> <undefined> | <object>  <p></p>  <p>Similar to the <code>cluster.on('message')</code> event, but specific to this worker. In a worker you can also use <code>process.on('message')</code></p>  <p>As an example, here is a cluster that keeps count of the number of requests in the master process using the message system:</p>  <pre><code class="lang-javascript">const cluster = require('cluster')const http = require('http')</blockquote><blockquote><p>if (cluster.isMaster) &#123;</p></blockquote><blockquote><p>  let numReqs = 0</p></blockquote><blockquote><p>  setInterval(() =&gt; &#123;<br>    console.log(<code>numReqs = $&#123;numReqs&#125;</code>)<br>  }, 1000)</p></blockquote><blockquote><p>  // Count requests<br>  function messageHandler(msg) {<br>    if (msg.cmd &amp;&amp; msg.cmd === ‘notifyRequest’) {<br>      numReqs++<br>    }<br>  }</p></blockquote><blockquote><p>  // Start workers and listen for messages containing notifyRequest</p></blockquote><blockquote><p>  const numCPUs = require(‘os’).cpus().length</p></blockquote><blockquote><p>  for (let i = 0; i &lt; numCPUs; i++) {<br>    cluster.fork()<br>  }</p></blockquote><blockquote><p>  for (const id in cluster.workers) {<br>    cluster.workers[id].on(‘message’, messageHandler)<br>  }</p></blockquote><blockquote><p>} else {<br>  // Worker processes have a http server<br>  http.Server((req, res) =&gt; {<br>    res.writeHead(200)<br>    res.end(‘hello world’)<br>    process.send({ cmd: ‘notifyRequest’ })<br>  }).listen(8000)<br>}<br></code></pre><br>  <h4 id="event-online-">Event: ‘online’</h4><br>  <p>Similar to the <code>cluster.on('online')</code> event, but specific to this worker</p><br>  <pre><code class="lang-javascript">cluster.fork().on('online', () =&gt; &#123;<br>  // Worker is online<br>&#125;)<br></code></pre><br>  <p>It is not emitted in the worker</p><br>  <h4 id="worker-disconnect-">worker.disconnect()</h4><br>  <blockquote><p>Return: <worker> A reference to <code>worker</code></worker></p></blockquote><br>  <p>In a worker, this function will close all server, wait for the <code>close</code> event on those servers, and disconnect the IPC channel.</p><br>  <p>In the master, an internal message is sent to the worker causing it to call <code>.disconnect()</code> on itself</p><br>  <p>Cause <code>.exitedAfterDisconnect</code> to be set.</p><br>  <p>Note that after a server is closed, it will no longer accept new connections, but connections may be accepted by any other listening worker. Existing connections will be allowed to close as usual. When no more connections exist, see <code>server.close()</code>, the IPC channel to the worker will close allowing it to die gracefully.</p><br>  <p>Note that in a worker, <code>process.disconnect</code> exists, but it is not this function.</p><br>  <p>Because long living server connections may block workers from disconnecting, it may be useful to send a message, so application specific actions may be taken to close them. It also may be useful to implement a timeout, killing a worker if the <code>disconnect</code> event has not been emiited after some time.</p><br>  <pre><code class="lang-javascript">if (cluster.isMaster) &#123;<br>  const worker = cluster.fork()<br>  let timeout</p></blockquote><blockquote><p>  worker.on(‘listening’, (address) =&gt; &#123;<br>    worker.send(‘shutdown’)<br>    worker.disconnect()<br>    timeout = setTimeout(() =&gt; &#123;<br>      worker.kill()<br>    &#125;, 2000);<br>  &#125;)</p></blockquote><blockquote><p>  worker.on(‘disconnect’, () =&gt; &#123;<br>    clearTimeout(timeout)<br>  &#125;)<br>&#125; else if (cluster.isWorker)&#123;<br>  const net = require(‘net’)<br>  const server = net.createServer((socket) =&gt; &#123;<br>    // connections never end<br>  &#125;)<br>  server.listen(8000)</p></blockquote><blockquote><p>  process.on(‘messaage’, (msg) =&gt; &#123;<br>    if (msg === ‘shutdown’) &#123;<br>      // initiate graceful close of any connections to server<br>    &#125;<br>  &#125;)<br>&#125;<br></code></pre><br>  <h4 id="worker-exitedafterdisconnect">worker.exitedAfterDisconnect</h4><br>  <blockquote><boolean><br></boolean></blockquote><br>  <p>Set by calling <code>.kill()</code> or <code>.disconnect()</code>. Until then, it is <code>undefined</code></p><br>  <p>The boolean <code>worker.exitedAfterDisconnect</code> lets you distinguish between voluntary and accidental exit, the master may choose not to respawn a worker based on this value.</p><br>  <pre><code class="lang-javascript">cluster.on('exit', (worker, code, signal) =&gt; &#123;<br>  if (worker.exitedAfterDisconnect === true) &#123;<br>    console.log('Oh, it was just voluntary - no need to worry')<br>  &#125;<br>&#125;)</p></blockquote><blockquote><p>// kill worker<br>worker.kill()<br></code></pre><br>  <h4 id="worker-id">worker.id</h4><br>  <blockquote><number><br></number></blockquote><br>  <p>Each new worker is given its own unique id, this id is stored in the <code>id</code></p><br>  <p>While a worker is alive, this is the key that indixes it in cluster.workers.</p><br>  <h4 id="worker-isconnected-">worker.isConnected()</h4><br>  <p>This function returns <code>true</code> if the worker is connected to its master via its IPC channel. <code>false</code> otherwise. A worker is connected to its master after it’s been created. It is disconnected after the <code>disconnect</code> event is emitted.</p><br>  <h4 id="worker-isdead-">worker.isDead()</h4><br>  <p>This function returns <code>true</code> if the worker’s process has terminated (either because of exiting or being signaled). Otherwise, it returns <code>false</code></p><br>  <h4 id="worker-kill-signal-sigterm-">worker.kill([signal=’SIGTERM’])</h4><br>  <blockquote><p><code>signal</code> <string> Name of the kill signal to send to the worker process.</string></p></blockquote><br>  <p>This function will kill the worker. In the master it does this by disconnecting the <code>worker.process</code> and once disconnected, killing with <code>signal</code>. In the worker, it does it by disconnecting the channel and exiting with code <code>0</code></p><br>  <p>Causes <code>.exitedAfterDisconnect</code> ot be set</p><br>  <p>This method is aliased as <code>worker.destroy()</code> for backwords compatibility.</p><br>  <p>Note that ina worker, <code>process.kill()</code> exists, but it is not the function.</p><br>  <h4 id="worker-process">worker.process</h4><br>  <blockquote><childprocess><br></childprocess></blockquote><br>  <p>All Workers are created using <code>child_process.fork()</code>, the returned object from this function is stored as <code>.process</code>. In a worker, the global <code>process</code> is stored</p><br>  <p>Note that the workers will call <code>process.exit(0)</code> if the <code>disconnect</code> event occurs on <code>process</code> and <code>.exitedAfterDisconnect</code> is not <code>true</code>. This protects against accidental disconnection.</p><br>  <h4 id="worker-send-message-sendhandle-callback-">worker.send(message[, sendHandle, [callback]])</h4><br>  <blockquote><p><code>message</code> <object><br>  <p></p></p>  <p><code>sendHandle</code> <handle></handle></p>  <p><code>callback</code> <function></function></p>  <p>Send a message to a worker or master, optinally with a handle.</p>  <p>In the master this sends a message to a specific worker. It is identical to <code>ChildProcess.send()</code></p>  <p>In a worker this sends a message to the master. It is identical to <code>process.send()</code></p>  <p>This example will echo back all messages from the master</p>  <pre></blockquote><blockquote><p>  <code class="lang-javascript">if (cluster.isMaster) &#123;<br>  const worker = cluster.fork()<br>  worker.send('hi there')<br>&#125; else if (cluster.isWorker) &#123;<br>  process.on('message', (msg) =&gt; &#123;<br>    process.send(msg)<br>  &#125;)<br>&#125;<br></code><br></pre><br>  <h4 id="event-disconnect-">Event: ‘disconnect’</h4><br>  <blockquote><br>  <p><code>worker</code> &lt;cluster.worker&gt;<br>&lt;/cluster.worker&gt;</p></p></blockquote>  <p>Emitted after the worker IPC channel has disconnected. This can occur when a worker exits gracefully, is killed, or is disconnected manually(such as with worker.disconnected())</p>  <p>There may be a delay between the <code>disconnect</code> and <code>exit</code> events. These events can be used to detect if the process is stuck in a cleanup or if there are long-living connections.</p>  <pre></blockquote><blockquote><p>  <code class="lang-javascript">cluster.on('disconnect', (worker) =&gt; &#123;<br>  console.log(<code>The worker #$&#123;worker.id&#125; has disconnected</code>)<br>})<br></code><br></pre><br>  <h4 id="event-exit-">Event: ‘exit’</h4><br>  <blockquote><br>  <p><code>worker</code> &lt;cluster.worker&gt;<br>&lt;/cluster.worker&gt;</p><br>  <p><code>code</code> <number> the exit code, if it exited normally</number></p><br>  <p><code>signal</code> <string> the name of the signal (e.g. ‘SIGHUP’) that caused the process to be killed.</string></p></p></blockquote>  <p>When any of the workers die the cluster module will emit the 'exit' events</p>  <p>This can be used to restart the worker by calling <code>.fork()</code> again.</p>  <pre></blockquote><blockquote><p>  <code class="lang-javascript">cluster.on('exit', (worker, code, signal) =&gt; &#123;<br>  console.log('worker %d died (%s), restarting...', worker.process.pid, signal || code)<br>  cluster.fork()<br>&#125;)<br></code><br></pre><br>  <h4 id="event-fork-">Event: ‘fork’</h4><br>  <blockquote><br>  <p><code>worker</code> &lt;cluster.worker&gt;<br>&lt;/cluster.worker&gt;</p></p></blockquote>  <p>When a new worker is forked the cluster module will emit a <code>fork</code> event. This can be used to log worker activity, and create your own timeout.</p>  <pre></blockquote><blockquote><p>  <code class="lang-javascript">const timeouts = []<br>function errorMsg () &#123;<br>  console.error('Something must be wrong with the connection...')<br>&#125;</p></blockquote><blockquote><p>cluster.on(‘fork’, (worker) =&gt; &#123;<br>  timeouts[worker.id] = setTimeout(errorMsg, 2000)<br>&#125;)</p></blockquote><blockquote><p>cluster.on(‘listening’, (worker, address) =&gt; &#123;<br>  clearTimeout(timeouts[worker.id])<br>&#125;)</p></blockquote><blockquote><p>cluster.on(‘exit’, (worker, code, signal) =&gt; &#123;<br>  clearTimeout(timeouts[worker.id])<br>&#125;)<br></code><br></pre><br>  <h4 id="event-listening-">Event: ‘listening’</h4><br>  <blockquote><br>  <p><code>worker</code> &lt;cluster.worker&gt;<br>&lt;/cluster.worker&gt;</p><br>  <p><code>address</code> <object><br>  <p></p></p>  <p>After calling <code>listen()</code> from  a worker. when the <code>listening</code> event it emitted on the server, a <code>listening</code> event will also be emitted on <code>cluster</code> in the master</p>  <p>The event handler is executed with two arguments, the <code>worker</code> contains the worker object and the <code>address</code> object contains the following connection properties: <code>address</code>, <code>port</code> and <code>addressType</code>. This is very useful if the worker is listening on more than one address.</p>  <pre></blockquote><blockquote><p>  <code class="lang-javascript">cluster.on('listening', (worker, address) =&gt; &#123;<br>  console.log(<code>A worker is now connected to $&#123;address.address&#125;: $&#123;address.port&#125;</code>)<br>})<br></code><br></pre><br>  <p>The <code>addressType</code> is one of:</p><br>  <ul><br>  <li><code>4</code>: (TCPv4)</li><br>  <li><code>6</code>: (TCPv6)</li><br>  <li><code>-1</code>: (unix domain socket)</li><br>  <li><code>"udp4"</code> or <code>"udp6"</code> (UDP v4 or v6)</li></p></ul>  <h4 id="event-message-">Event: 'message'</h4>  <blockquote>  <p><code>worker</code> <cluster.worker></cluster.worker></p>  <p><code>message</code> <object>  <p></p>  <p><code>handle</code> <undefined> | <object>  <p></p>  <p>Emitted when the cluster master receives a message from any worker.</p>  <h4 id="event-online-">Event: 'online'</h4>  <blockquote><p><code>worker</code> <cluster.worker></cluster.worker></p></blockquote>  <p>After forking a new worker, the worker should respond with an online message. When the master receives an online message it will emit this event. The difference between <code>fork</code> and <code>online</code> is that fork is emitted when the master forks a worker and <code>online</code> is emitted when the worker is running.</p>  <h4 id="event-setup-">Event: 'setup'</h4>  <blockquote><p><code>settings</code> <object>  <p></p>  <p>Emitted every time <code>.setupMaster()</code> is called.</p>  <p>The <code>settings</code> object is the <code>cluster.settings</code> object at the time <code>.setupMaster()</code> was called and is advisory only. since multiple calls to <code>.setupMaster()</code> can be made in a single tick.</p>  <p>If accuracy is important, use <code>cluster.settings</code></p>  <h4 id="cluster-disconnect-callback-">cluster.disconnect([callback])</h4>  <p><code>callback</code> called when <strong>all</strong> workers are disconnected and handles are closed Calls <code>.disconnect()</code> on each worker in <code>cluster.workers</code></p>  <p>When they are disconnected all internal handles will be closed, allowing the master process to die gracefully if no other event is waiting.</p>  <p>The method takes an optional callback argument which will be called when finished.</p>  <p>This can only be called from the master process.</p>  <h4 id="cluster-fork-env-">cluster.fork([env])</h4>  <blockquote>  <p><code>env</code> <object> Key/Value pairs to add to worker process environment<p></p><p>return <cluster.worker></cluster.worker></p><p>Spawn a new worker process.</p><p>This can only be called from the master process.</p><h4 id="cluster-ismaster">cluster.isMaster</h4><blockquote>  <boolean></boolean></blockquote><p>True if the process is a master. This is determined by the <code>process.env.NODE_UNIQUE_ID</code>. If <code>process.env.NODE_UNIQUE_ID</code> is undefined, then <code>.isMaster</code> is <code>true</code></p><h4 id="cluster-isworker">cluster.isWorker</h4><blockquote>  <boolean></boolean></blockquote><p>True if the process is not a master (it is the negation of <code>cluster.isMaster</code>)</p><h4 id="cluster-schedulingpolicy">cluster.schedulingPolicy</h4><p>The scheduling policy, either <code>cluster.SCHED_RR</code> for round-robin or <code>cluster.SCHED_NONE</code> to leave it to the operating system. This is a global setting and effectively frozen once you spawn the first worker or call cluster <code>cluster.setupMaster()</code>, whatever comes first.</p><p><code>SCHED_RR</code> is the default on all operating systems except Windows. Windows will change to <code>SCHED_RR</code> once libuv is able to effectively distribute IOCP handles without incurring a large performance hit.</p><p><code>cluster.schedulingPolicy</code> can also be set through the <code>NODE_CLUSTER_SCHED_POLICY</code> environment variable. Valid values are <code>'rr'</code> and <code>'none'</code></p><h4 id="cluster-settings">cluster.settings</h4><blockquote>  <p><object>  <p></p>  <ul>  <li><code>execArgv</code></li>  <li><code>exec</code></li>  <li><code>args</code></li>  <li><code>silent</code></li>  <li><code>stdio</code></li>  <li><code>uid</code></li>  <li><code>gid</code></li></ul>  <h4 id="cluster-setupmaster-settings-">cluster.setupMaster([settings])</h4>  <blockquote>  <p><code>settings</code></p>  <ul><li><code>exec</code></li><li><code>args</code></li><li><code>silent</code></li><li><code>stdio</code></li></ul></blockquote>  <pre></blockquote><blockquote><p>  <code class="lang-javascript">const cluster = require('cluster')<br>cluster.setupMaster(&#123;<br>  exec: 'worker.js',<br>  args: ['--use', 'https'],<br>  silent: true,<br>&#125;)</p></blockquote><blockquote><p>cluster.fork() // https worker<br></code><br></pre><br>  <h4 id="cluster-worker">cluster.worker</h4><br>  <blockquote><br>  <object><br>  <p>A reference to the current worker object. Not available in the master process.</p><br>  <pre></p></blockquote><blockquote><p>  <code class="lang-javascript">const cluster = require('cluster')</p></blockquote><blockquote><p>if (cluster.isMaster) &#123;<br>  console.log(‘I am master’)<br>  cluster.fork()<br>  cluster.fork()<br>&#125; else if (cluster.isWorker) &#123;<br>  console.log(<code>I am worker #$&#123;cluster.worker.id&#125;</code>)<br>}<br></code><br></pre><br>  <h4 id="cluster-workers">cluster.workers</h4><br>  <blockquote><br>  <object><br>  <p>A hash that stores the active worker objects, keyed by <code>id</code> field. Makes it easy to loop through all the workers. It is only available in the master process.</p><br>  <p>A worker is removed from <code>cluster.workers</code> after the worker has disconnected <strong>and</strong> exit. <strong>The order between two events cannot be determined in advance</strong>. However it is guaranteed that the removal from the cluster.workers list happens before last <code>disconnect</code> or <code>exit</code> event is emitted.</p><br>  <pre></p></blockquote><blockquote><p>  <code class="lang-javascript">// Go through all workers<br>function eachWorker(callback) &#123;<br>  for (const id in cluster.workers) &#123;<br>    callback(cluster.worker[id])<br>  &#125;<br>&#125;</p></blockquote><blockquote><p>eachWorker((worker) =&gt; &#123;<br>  worker.send(‘big announcement to all workers’)<br>&#125;)<br></code><br></pre><br>  <p>Should you wish to reference a worker over a communication channel, using the worker’s unique id is the easiest way to find the worker.</p><br>  <pre></p></blockquote><blockquote><p>  <code class="lang-javascript">socket.on('data', (id) =&gt; &#123;<br>  const worker = cluster.workers[id]<br>&#125;)<br></code><br></pre><br></object></p></blockquote></object></blockquote></object></p></blockquote></object></p></blockquote></object></p></blockquote></object></undefined></p></object></p></blockquote></object></p></blockquote></object></p></blockquote></object></undefined></p></object></p></blockquote></object></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
            <tag> Cluster </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Api of Axios</title>
      <link href="/2017/04/29/api-of-axios/"/>
      <url>/2017/04/29/api-of-axios/</url>
      
        <content type="html"><![CDATA[<h1 id="alias"><a href="#alias" class="headerlink" title="alias"></a>alias</h1><blockquote><p>axios.request(config) axios.get(url[, config]) axios.delete(url[, config]) axios.head(url[, config]) axios.options(url[, config]) axios.post(url[, data[, config]]) axios.put(url[, data[, config]]) axios.patch(url[, data[, config]])</p></blockquote><h1 id="Config-Options"><a href="#Config-Options" class="headerlink" title="Config Options"></a>Config Options</h1><p><code>url</code> is required, and <code>get</code> is the default method</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  url: <span class="string">&#x27;string&#x27;</span>,</span><br><span class="line">  method: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">  baseUrl: <span class="string">&#x27;https://some-domain.com/api/&#x27;</span>, <span class="comment">// prepended to url unless url is absolute,</span></span><br><span class="line">  transformRequest: [<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">  &#125;],</span><br><span class="line">  transformResponse: [<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">  &#125;],</span><br><span class="line">  headers: &#123;</span><br><span class="line">    <span class="string">&#x27;X-Requested-With&#x27;</span>: <span class="string">&#x27;XMLHttpRequest&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  params: &#123; <span class="comment">// url params to be sent with the request, plain object or URLSearchParams Object</span></span><br><span class="line">    ID: <span class="number">12345</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  paramsSerializer: <span class="function"><span class="keyword">function</span> (<span class="params">params</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Qs.stringify(params, &#123; <span class="attr">arrayFormat</span>: <span class="string">&#x27;brackets&#x27;</span> &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  data: &#123; <span class="comment">// the data sent as request body, only applicable for request method &#x27;PUT&#x27;, &#x27;POST&#x27;, &#x27;PATCH&#x27;. When no transformRequest is set, must be one of the following types: string, plain object, ArrayBuffer, ArrayBufferView, URLSearchParams, FormData(Browser only), File(browser only), Blob(browser only), Stream(Node only), Buffer(Node only)</span></span><br><span class="line">    firstName: <span class="string">&#x27;fred&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  timeout: <span class="number">1000</span>,</span><br><span class="line">  withCredentials: <span class="literal">false</span> <span class="comment">// default</span></span><br><span class="line">  adapter: <span class="function"><span class="keyword">function</span> (<span class="params">config</span>) </span>&#123; <span class="comment">// allows custom handling of requests which makes testing easier.</span></span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line">  auth: &#123;</span><br><span class="line">    username: <span class="string">&#x27;janedoe&#x27;</span>,</span><br><span class="line">    password: <span class="string">&#x27;...&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  responseType: <span class="string">&#x27;json&#x27;</span>, <span class="comment">// default</span></span><br><span class="line">  xsrfCookieName: <span class="string">&#x27;XSRF-TOKEN&#x27;</span>, <span class="comment">// defualt</span></span><br><span class="line">  onUploadProgress: <span class="function"><span class="keyword">function</span> (<span class="params">progressEvent</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line">  onDownloadProgress: <span class="function"><span class="keyword">function</span>(<span class="params">progressEvent</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line">  maxContentLength: <span class="number">2000</span>,</span><br><span class="line">  validateStatus: <span class="function"><span class="keyword">function</span> (<span class="params">status</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> status &gt;= <span class="number">200</span> &amp;&amp; status &lt; <span class="number">300</span> <span class="comment">// default</span></span><br><span class="line">  &#125;,</span><br><span class="line">  maxRedirects: <span class="number">5</span>, <span class="comment">// default</span></span><br><span class="line">  httpAgent: <span class="keyword">new</span> http.Agent(&#123; <span class="attr">keepAlive</span>: <span class="literal">true</span> &#125;),</span><br><span class="line">  httpsAgent: <span class="keyword">new</span> http.Agent(&#123; <span class="attr">keepAlive</span>: <span class="literal">true</span> &#125;),</span><br><span class="line">  proxy: &#123; <span class="comment">// defines the hostname and port of the proxy server</span></span><br><span class="line">    host: <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">    port: <span class="number">9000</span>,</span><br><span class="line">    auth: &#123;</span><br><span class="line">      username: <span class="string">&#x27;...&#x27;</span>,</span><br><span class="line">      password: <span class="string">&#x27;...&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  cancelToken: <span class="keyword">new</span> CancelToken(<span class="function"><span class="keyword">function</span> (<span class="params">cancel</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="response-Schema"><a href="#response-Schema" class="headerlink" title="response Schema"></a>response Schema</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  data: &#123;&#125;,</span><br><span class="line">  status: <span class="number">200</span>,</span><br><span class="line">  statusText: <span class="string">&#x27;OK&#x27;</span>,</span><br><span class="line">  headers: &#123;&#125;,</span><br><span class="line">  config: &#123;&#125;,</span><br><span class="line">  request: &#123;&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="errors"><a href="#errors" class="headerlink" title="errors"></a>errors</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">axios.get(<span class="string">&#x27;/user/123&#x27;</span>).catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err.response) &#123;</span><br><span class="line">    <span class="comment">// err.response.data</span></span><br><span class="line">    <span class="comment">// err.response.status</span></span><br><span class="line">    <span class="comment">// err.response.headers</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (res.request) &#123;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="get"><a href="#get" class="headerlink" title="get"></a>get</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">axios</span><br><span class="line">  .get(<span class="string">&#x27;/user?ID=12345&#x27;</span>)</span><br><span class="line">  .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res)</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">axios</span><br><span class="line">  .get(<span class="string">&#x27;/user&#x27;</span>, &#123;</span><br><span class="line">    params: &#123;</span><br><span class="line">      ID: <span class="number">12345</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res)</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><h1 id="post"><a href="#post" class="headerlink" title="post"></a>post</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">axios</span><br><span class="line">  .post(<span class="string">&#x27;/user&#x27;</span>, &#123;</span><br><span class="line">    firstName: <span class="string">&#x27;Fred&#x27;</span>,</span><br><span class="line">    lastName: <span class="string">&#x27;Flintstrong&#x27;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res)</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><h1 id="concurrency"><a href="#concurrency" class="headerlink" title="concurrency"></a>concurrency</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUserAccount</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> axios.get(<span class="string">&#x27;/user/12345&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUserPermissions</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> axios.get(<span class="string">&#x27;/user/12345/permissions&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">axios.all([getUserAccount(), getUserPermissions()]).then(</span><br><span class="line">  axios.spread(<span class="function"><span class="keyword">function</span> (<span class="params">acct, perms</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Both request are now complete</span></span><br><span class="line">  &#125;),</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h1 id="config"><a href="#config" class="headerlink" title="config"></a>config</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">axios(&#123;</span><br><span class="line">  method: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">  url: <span class="string">&#x27;/user/12345&#x27;</span>,</span><br><span class="line">  data: &#123;</span><br><span class="line">    firstName: <span class="string">&#x27;Fred&#x27;</span>,</span><br><span class="line">    lastName: <span class="string">&#x27;Flintstone&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">axios(&#123;</span><br><span class="line">  method: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">  url: <span class="string">&#x27;http://bit.ly/2mTM3n&#x27;</span>,</span><br><span class="line">  responseType: <span class="string">&#x27;stream&#x27;</span>,</span><br><span class="line">&#125;).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.data.pipe(fs.createWriteStream(<span class="string">&#x27;ada_lovelace.jpg&#x27;</span>))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>webpackDevServer Proxy</title>
      <link href="/2017/04/27/webpackDevServer-Proxy/"/>
      <url>/2017/04/27/webpackDevServer-Proxy/</url>
      
        <content type="html"><![CDATA[<p><code>devServer.proxy</code>: <code>object</code></p><p>Proxying some URLs can be useful when you have a separate API backend development server and you want to send API requests on the same domain.</p><p>The dev-server makes use of the powerful <code>http-proxy-middleware</code> package.</p><p>With a backend on <code>localhost:3000</code>, you can use this to enable proxying:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">proxy: &#123;</span><br><span class="line">  &#39;&#x2F;api&#39;: &#39;http:&#x2F;&#x2F;localhost:3000&#39;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>A request to <code>/api/users</code> will now proxy to the request to <code>http://localhost:3000/api/users</code></p><p>If you don’t want <code>/api</code> to be passed along, we need to rewrite the path</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">proxy: &#123;</span><br><span class="line">  &#39;&#x2F;api&#39;: &#123;</span><br><span class="line">    target: &#39;http:&#x2F;&#x2F;localhost:3000&#39;,</span><br><span class="line">    pathRewrite: &#123;</span><br><span class="line">      &#39;^&#x2F;api&#39;: &#39;&#39;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>A backend server running on HTTPS with an invalid certificate will not be accepted by default. If you want to, modify config like this:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">proxy: &#123;</span><br><span class="line">  &#39;&#x2F;api&#39;: &#123;</span><br><span class="line">    target: &#39;https:&#x2F;&#x2F;other-server.example.com&#39;,</span><br><span class="line">    secure: false,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Notes in Migrating From React-Router-3 to React-Router-4</title>
      <link href="/2017/04/26/notes-in-migrating-from-React-Router-3-to-React-Router-4/"/>
      <url>/2017/04/26/notes-in-migrating-from-React-Router-3-to-React-Router-4/</url>
      
        <content type="html"><![CDATA[<h1 id="HashRouter"><a href="#HashRouter" class="headerlink" title="HashRouter"></a>HashRouter</h1><p>Version 4 of React-Router seperate top level router element for the different history type. If you’re using version 4 you should be able to replace <code>&lt;Router hisotry=&#123;hashHistory&#125;&gt;</code> with <code>&lt;HashRouter&gt;</code></p><h1 id="Multiple-Routes-at-same-URL"><a href="#Multiple-Routes-at-same-URL" class="headerlink" title="Multiple Routes at same URL"></a>Multiple Routes at same URL</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  BrowserRouter <span class="keyword">as</span> Router,</span><br><span class="line">  Route,</span><br><span class="line">  Link,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Each logical &#x27;route&#x27; has two components, one for the sidebar and one for the main area. We want to render both of them in different places when the path matches the current URL.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    exact: <span class="literal">true</span>,</span><br><span class="line">    sidebar: <span class="function">() =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>,</span><br><span class="line">    main: <span class="function">() =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span>,</span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    path: <span class="string">&#x27;/bubblegum&#x27;</span>,</span><br><span class="line">    sidebar: <span class="function">() =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>bubblegum<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>,</span><br><span class="line">    main: <span class="function">() =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>BubbleGum<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>,</span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    path: <span class="string">&#x27;/shoelaces&#x27;</span>,</span><br><span class="line">    sidebar: <span class="function">() =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>shoelaces<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>,</span><br><span class="line">    main: <span class="function">() =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>ShoeLaces<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span>,</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sidebarExample = <span class="function">() =&gt;</span> (</span><br><span class="line">  &lt;Router&gt;</span><br><span class="line">    &lt;div style=&#123;&#123; <span class="attr">display</span>: <span class="string">&#x27;flex&#x27;</span> &#125;&#125;&gt;</span><br><span class="line">      <span class="comment">// sidebar</span></span><br><span class="line">      &lt;div style=&#123;&#123;</span><br><span class="line">        padding: <span class="string">&#x27;10px&#x27;</span>,</span><br><span class="line">        width: <span class="string">&#x27;40%&#x27;</span>,</span><br><span class="line">        background: <span class="string">&#x27;#f0f0f0&#x27;</span>,</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;ul&gt;</span><br><span class="line">          &lt;li&gt;<span class="xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&#x27;/&#x27;</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span>&lt;/li&gt;</span><br><span class="line">          &lt;li&gt;<span class="xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&#x27;/bubblegum&#x27;</span>&gt;</span>Bubblegum<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span>&lt;/li&gt;</span><br><span class="line">          &lt;li&gt;<span class="xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&#x27;/shoelaces&#x27;</span>&gt;</span>ShoeLaces<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span>&lt;/li&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line"></span><br><span class="line">        &#123;routes.map(<span class="function">(<span class="params">route, index</span>) =&gt;</span> (</span><br><span class="line">          <span class="comment">// You can render a &lt;Router&gt; in as many places as you want in your app, it will render along with any other &lt;Router&gt;s that also match the URL.</span></span><br><span class="line">          <span class="comment">// So a sidebar or breadcrumbs or anything else that requires you to render multiple things in multiple places at the same URL is nothing more than multiple &lt;Routes&gt;s</span></span><br><span class="line"></span><br><span class="line">          &lt;Route</span><br><span class="line">            key=&#123;index&#125;</span><br><span class="line">            path=&#123;route.path&#125;</span><br><span class="line">            exact=&#123;route.exact&#125;</span><br><span class="line">            component=&#123;route.sidebar&#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        ))&#125;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// main</span></span><br><span class="line">      &lt;div style=&#123;&#123; <span class="attr">flex</span>: <span class="number">1</span>, <span class="attr">padding</span>: <span class="string">&#x27;30px&#x27;</span> &#125;&#125;&gt;</span><br><span class="line">        &#123;routes.map(<span class="function">(<span class="params">route, index</span>) =&gt;</span> (</span><br><span class="line">          <span class="comment">// Render more &lt;Route&gt;s with the same paths as above, but different components this time.</span></span><br><span class="line">          &lt;Route</span><br><span class="line">            key=&#123;index&#125;</span><br><span class="line">            path=&#123;route.path&#125;</span><br><span class="line">            exact=&#123;route.exact&#125;</span><br><span class="line">            component=&#123;route.main&#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        ))&#125;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/Router&gt;</span><br><span class="line">)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> sidebarExample</span><br></pre></td></tr></table></figure><h1 id="Animated-Transitions"><a href="#Animated-Transitions" class="headerlink" title="Animated Transitions"></a>Animated Transitions</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> ReactCSSTransitionGroup <span class="keyword">from</span> <span class="string">&#x27;react-addons-css-transition-group&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  BrowserRouter <span class="keyword">as</span> Router,</span><br><span class="line">  Route,</span><br><span class="line">  Link,</span><br><span class="line">  Redirect,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;react-rotuer-dom&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// you&#x27;ll need this CSS somewhere</span></span><br><span class="line"><span class="comment">// .fade-enter &#123;</span></span><br><span class="line"><span class="comment">//   opacity: 0;</span></span><br><span class="line"><span class="comment">//   z-index: 1;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// .fade-enter.face-enter-active &#123;</span></span><br><span class="line"><span class="comment">//   opacity: 1;</span></span><br><span class="line"><span class="comment">//   transition: opacity 250ms ease-in;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> AnimationExample = <span class="function">() =&gt;</span> (</span><br><span class="line">  &lt;Router&gt;</span><br><span class="line">    &lt;Route render=&#123;<span class="function">(<span class="params">&#123; location &#125;</span>) =&gt;</span> (</span><br><span class="line">      &lt;div style=&#123;style.fill&#125;&gt;</span><br><span class="line">        &lt;Route exact path=<span class="string">&#x27;/&#x27;</span> render=&#123;<span class="function">() =&gt;</span> (</span><br><span class="line">          &lt;Redirect to=<span class="string">&#x27;/10/20/50&#x27;</span> /&gt;</span><br><span class="line">        )&#125;/&gt;</span><br><span class="line">        &lt;ul style=&#123;style.nav&#125;&gt;</span><br><span class="line">          &lt;NavLink to=<span class="string">&#x27;/10/90/50&#x27;</span>&gt;Red&lt;/NavLink&gt;</span><br><span class="line">          &lt;NavLink to=<span class="string">&#x27;/120/100/40&#x27;</span>&gt;Green&lt;/NavLink&gt;</span><br><span class="line">          &lt;NavLink to=<span class="string">&#x27;/200/100/40&#x27;</span>&gt;Blue&lt;/NavLink&gt;</span><br><span class="line">          &lt;NavLink to=<span class="string">&#x27;/310/100/50&#x27;</span>&gt;Pink&lt;/NavLink&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line"></span><br><span class="line">        &lt;div style=&#123;style.content&#125;&gt;</span><br><span class="line">          &lt;ReactCSSTransitionGroup</span><br><span class="line">            transitionName=<span class="string">&#x27;fade&#x27;</span></span><br><span class="line">            transitionEnterTimeout=&#123;<span class="number">300</span>&#125;</span><br><span class="line">            transitionLeaveTimeout=&#123;<span class="number">300</span>&#125;</span><br><span class="line">          &gt;</span><br><span class="line">            <span class="comment">// no different than other usage of ReactCSSTransitionGroup, just make sure to pass `location` to `Route` so it can match the old location as it animate out</span></span><br><span class="line">            &lt;Route</span><br><span class="line">              location=&#123;loaction&#125;</span><br><span class="line">              key=&#123;location.key&#125;</span><br><span class="line">              path=<span class="string">&quot;/:h/:s/:l&quot;</span></span><br><span class="line">              component=&#123;HSL&#125;</span><br><span class="line">            /&gt;</span><br><span class="line">          &lt;/ReactCSSTransitionGroup&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )&#125;/&gt;</span><br><span class="line">  &lt;/Router&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> NavLink = <span class="function">(<span class="params">props</span>) =&gt;</span> (</span><br><span class="line">  &lt;li&gt;<span class="xml"><span class="tag">&lt;<span class="name">Link</span> &#123;<span class="attr">...props</span>&#125; <span class="attr">style</span>=<span class="string">&#123;&#123;color:</span> &#x27;<span class="attr">inherit</span>&#x27;&#125;&#125; /&gt;</span></span>&lt;/li&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> HSL = <span class="function">(<span class="params">&#123; match: &#123; params &#125;&#125;</span>) =&gt;</span> (</span><br><span class="line">  &lt;div style=&#123;&#123;</span><br><span class="line">    ...style.fill,</span><br><span class="line">    ...style.hsl,</span><br><span class="line">    background: <span class="string">`hsl(<span class="subst">$&#123;params.h&#125;</span>%, <span class="subst">$&#123;params.s&#125;</span>%, <span class="subst">$&#123;params.l&#125;</span>%)`</span></span><br><span class="line">  &#125;&#125;&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> AnimationExample</span><br></pre></td></tr></table></figure><h1 id="Route-Config"><a href="#Route-Config" class="headerlink" title="Route Config"></a>Route Config</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  BrowserRouter <span class="keyword">as</span> Router,</span><br><span class="line">  Route,</span><br><span class="line">  Link,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Some folks find value in a centralized route config. A route config is just data. React is great at mapping data into component, and &lt;Route&gt; is a component.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// first our route component</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Main = <span class="function">() =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>Main<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Sandwiches = <span class="function">() =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>Sandwiches<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Tacos = <span class="function">(<span class="params">&#123; routes &#125;</span>) =&gt;</span> (</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;h2&gt;Tacos&lt;/h2&gt;</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">      &lt;li&gt;<span class="xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&#x27;/tacos/bus&#x27;</span>&gt;</span>Bus<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span>&lt;/li&gt;</span><br><span class="line">      &lt;li&gt;<span class="xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&#x27;/tacos/cart&#x27;</span>&gt;</span>Cart<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span>&lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line"></span><br><span class="line">    &#123;routes.map(<span class="function">(<span class="params">route, index</span>) =&gt;</span> (</span><br><span class="line">      &lt;RouteWithSubRoutes key=&#123;index&#125; &#123;...route&#125;/&gt;</span><br><span class="line">    ))&#125;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Bus = <span class="function">() =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Bus<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="keyword">const</span> Cart = <span class="function">() =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Cart<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// then our route config</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/sandwiches&#x27;</span>,</span><br><span class="line">    component: sandwiches,</span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    path: <span class="string">&#x27;/tacos&#x27;</span>,</span><br><span class="line">    component: Tacos,</span><br><span class="line">    routes: [</span><br><span class="line">      &#123;</span><br><span class="line">        path: <span class="string">&#x27;/tacos/bus&#x27;</span>,</span><br><span class="line">        component: Bus,</span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        path: <span class="string">&#x27;/tacos/cart&#x27;</span>,</span><br><span class="line">        component: Cart,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">// wrap &lt;Route&gt; and use this everywhere instead, then when sub routes are added to any route it&#x27;ll work</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> RouteWithSubRoutes = <span class="function">(<span class="params">route</span>) =&gt;</span> (</span><br><span class="line">  &lt;Route path=&#123;route.path&#125; render=&#123;<span class="function"><span class="params">props</span> =&gt;</span> (</span><br><span class="line">    <span class="comment">// pass the sub-routes down to keep nesting</span></span><br><span class="line">    &lt;route.component &#123;...props&#125; routes=&#123;route.routes&#125; /&gt;</span><br><span class="line">  )&#125;/&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> RouteConfigExample = <span class="function">() =&gt;</span> (</span><br><span class="line">  &lt;Router&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;ul&gt;</span><br><span class="line">        &lt;li&gt;<span class="xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&#x27;/tacos&#x27;</span>&gt;</span>Tacos<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span>&lt;/li&gt;</span><br><span class="line">        &lt;li&gt;<span class="xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&#x27;/sandwiches&#x27;</span>&gt;</span>Sandwiches<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span>&lt;/li&gt;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">      &#123;routes.map(<span class="function">(<span class="params">route, index</span>) =&gt;</span> (</span><br><span class="line">        &lt;RouteWithSubRoutes key=&#123;index&#125; &#123;...route&#125; /&gt;</span><br><span class="line">      ))&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/Router&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> RouteConfigExample</span><br></pre></td></tr></table></figure><h1 id="Redux-Integration"><a href="#Redux-Integration" class="headerlink" title="Redux Integration"></a>Redux Integration</h1><p>Generally, React Router and Redux work just fine together. Occasionally though, an app have a component that doesn’t update when the location changes (child route or active nav links don’t update)</p><p>This happens if:</p><blockquote><p>The component is connected to redux via <code>connect()(Comp)</code> The component is <em>not</em> a “route component”, meaning it is not rendered like so: <code>&lt;Route component=&#123;SomeConnectedThing&#125;/&gt;</code></p></blockquote><p>The problem is that Redux implements <code>shouldComponentUpdate</code> and there’s no indication that anything has changed if it isn’t receiving props from the router. This is straightforward to fix. Find where you connect your component and wrap it in <code>withRouter</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; withRouter &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> withRouter(connect(mapStateToProps)(Comp))</span><br></pre></td></tr></table></figure><h1 id="Code-Splitting"><a href="#Code-Splitting" class="headerlink" title="Code Splitting"></a>Code Splitting</h1><p>One great feature of the web is that we don’t have to make our visitors download the entire app before they can use it. You can think of code spliting as incrementally downloading the app. While there are other tools for the job, react-router use <code>webpack</code> and the <code>bundle loader</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> loadSomething <span class="keyword">from</span> <span class="string">&#x27;bundle-loader?lazy!./Something&#x27;</span></span><br><span class="line"></span><br><span class="line">&lt;Bundle load=&#123;loadSomething&#125;&gt;</span><br><span class="line">  &#123;<span class="function">(<span class="params">mod</span>) =&gt;</span> (</span><br><span class="line">    <span class="comment">// do something w/ the module</span></span><br><span class="line">  )&#125;</span><br><span class="line">&lt;/Bundle&gt;</span><br><span class="line"></span><br><span class="line">&lt;Bundle load=&#123;loadSomething&#125;&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    (Comp) =&gt; Comp</span><br><span class="line">    ? <span class="xml"><span class="tag">&lt;<span class="name">Comp</span>/&gt;</span></span></span><br><span class="line">    : <span class="xml"><span class="tag">&lt;<span class="name">Loading</span>/&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&lt;/Bundle&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bundle</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    <span class="comment">// short for &#x27;module&#x27; but that&#x27;s a keyword in js. so &#x27;mod&#x27;</span></span><br><span class="line">    mod: <span class="literal">null</span>,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentWillMount () &#123;</span><br><span class="line">    <span class="built_in">this</span>.load(<span class="built_in">this</span>.props)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentWillReceiveProps (nextProps) &#123;</span><br><span class="line">    <span class="keyword">if</span> (nextProps.load !== <span class="built_in">this</span>.props.load) &#123;</span><br><span class="line">      <span class="built_in">this</span>.load(nextProps)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  load (props) &#123;</span><br><span class="line">    <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">      mod: <span class="literal">null</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    props.load(<span class="function">(<span class="params">mod</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">        <span class="comment">// handle both es imports and cjs</span></span><br><span class="line">        mod: mod.default ? mod.default : mod</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.props.children(<span class="built_in">this</span>.state.mod)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Bundle</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;Bundle load=&#123;<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./something&#x27;</span>)&#125;&gt;</span><br><span class="line">  &#123;<span class="function">(<span class="params">mod</span>) =&gt;</span> ()&#125;</span><br><span class="line">&lt;/Bundle&gt;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> loadAbout <span class="keyword">from</span> <span class="string">&#x27;bundle-load?lazy!./loadAbout&#x27;</span></span><br><span class="line"><span class="keyword">import</span> loadDashboard <span class="keyword">from</span> <span class="string">&#x27;bundle-loader?lazy!./loadDashboard&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// components load their module for initial visit</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> About = <span class="function">() =&gt;</span> (</span><br><span class="line">  &lt;Bundle load=&#123;loadAbout&#125;&gt;</span><br><span class="line">    &#123;<span class="function">(<span class="params">About</span>) =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">About</span> /&gt;</span></span>&#125;</span><br><span class="line">  &lt;/Bundle&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Dashboard = <span class="function">() =&gt;</span> (</span><br><span class="line">  &lt;Bundle load=&#123;loadDashboard&#125;&gt;</span><br><span class="line">    &#123;<span class="function">(<span class="params">Dashboard</span>) =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">Dashboard</span> /&gt;</span></span>&#125;</span><br><span class="line">  &lt;/Bundle&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  componentDidMount () &#123;</span><br><span class="line">    <span class="comment">// preload the rest</span></span><br><span class="line">    loadAbout( <span class="function">() =&gt;</span> &#123;&#125; )</span><br><span class="line">    loadDashboard( <span class="function">() =&gt;</span> &#123;&#125; )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;h1&gt;Welcome&lt;/h1&gt;</span><br><span class="line">        &lt;Route path=<span class="string">&#x27;/about&#x27;</span> component=&#123;About&#125; /&gt;</span><br><span class="line">        &lt;Route path=<span class="string">&#x27;/dashbaord&#x27;</span> component=&#123;Dashboard&#125; /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, <span class="built_in">document</span>.preloadTheRestOfTheApp)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> React </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Learning D3</title>
      <link href="/2017/04/25/learning-d3/"/>
      <url>/2017/04/25/learning-d3/</url>
      
        <content type="html"><![CDATA[<h1 id="d3-array"><a href="#d3-array" class="headerlink" title="d3-array"></a>d3-array</h1><h2 id="array-methods-built-in-to-JavaScript"><a href="#array-methods-built-in-to-JavaScript" class="headerlink" title="array methods built-in to JavaScript"></a>array methods built-in to JavaScript</h2><ul><li><p>array.pop =&gt; popped element</p></li><li><p>array.push =&gt; array.length</p></li><li><p>array.reverse =&gt; change the array</p></li><li><p>array.shift =&gt; shifted element</p></li><li><p>array.unshift =&gt; array.length</p></li><li><p>array.sort =&gt; change the array</p></li><li><p>array.splice =&gt; change the array</p></li><li><p>array.concat =&gt; new Array</p></li><li><p>array.join =&gt; new String</p></li><li><p>array.slice =&gt; new Array</p></li><li><p>array.indexOf =&gt; number</p></li><li><p>array.lastIndexOf =&gt; number</p></li><li><p>array.fitler =&gt; new Array</p></li><li><p>array.forEach =&gt; undefined</p></li><li><p>array.every =&gt; boolean</p></li><li><p>array.map =&gt; new Array</p></li><li><p>array.some =&gt; boolean</p></li><li><p>array.reduce =&gt;</p></li><li><p>array.reduceRight =&gt;</p></li></ul><blockquote><p>yarn add d3-array</p></blockquote><h2 id="Statistics"><a href="#Statistics" class="headerlink" title="Statistics"></a>Statistics</h2><ul><li><p><code>d3.min(array[, accessor])</code></p><ul><li>Mininum value using natural order</li><li>Return undefined if the array is empty</li><li>An optional <em>accessor</em> function may be specified, which is equivalent to calling <em>array.map(accessor)</em> before computing the minumum value.</li></ul></li><li><p><code>d3.max(array[, accessor])</code></p><ul><li>Return maximum value</li><li>Return undefined. if the array is empty</li></ul></li><li><p><code>d3.extent(array[, accessor])</code></p><ul><li>Return <em>minumum</em> and <em>maximum</em> value in the given array.</li><li>Return <code>[undefined, undefined]</code> if the array is empty</li></ul></li><li><p><code>d3.sum(array[, accessor])</code></p><ul><li>Return the sum of the given array of numbers.</li><li>Return 0 if the array is empty.</li><li>ignores <em>undefined</em> and <em>NaN</em> values.</li></ul></li><li><p><code>d3.mean(array[, accessor])</code></p><ul><li>Return the mean of the given array of numbers.</li><li>Return undefined if the array is empty.</li><li>Ignore <em>undefined</em> and <em>NaN</em>.</li></ul></li><li><p><code>d3.median(array[, accessor])</code> -</p></li></ul><p>-</p>]]></content>
      
      
      
        <tags>
            
            <tag> D3 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Node-Inspector&#39;s Crash</title>
      <link href="/2017/04/25/node-inspector-s-crash/"/>
      <url>/2017/04/25/node-inspector-s-crash/</url>
      
        <content type="html"><![CDATA[<p>I had encountered a problem using <code>node-inspector</code> with info</p><blockquote><p>cb(error, NM[0].ref); Cannot read property ‘ref’ of undefined</p></blockquote><p>And one method to resolve it is to modify the packagge</p><blockquote><p>Same issue with node v6.5.0 can be solved like this :</p></blockquote><blockquote><p>Edit …\node_modules\node-inspector\lib\InjectorClient.js file at line 111 if(NM.length &gt; 0) cb(error, NM[0].ref);</p></blockquote><blockquote><p>It works</p></blockquote><p>which is hack, and another method is without side-effect</p><blockquote><p>use the local node-inspector</p></blockquote><p>hope it helps</p>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Usage of Chai</title>
      <link href="/2017/04/21/Usage-of-Chai/"/>
      <url>/2017/04/21/Usage-of-Chai/</url>
      
        <content type="html"><![CDATA[<h1 id="Chains"><a href="#Chains" class="headerlink" title="Chains"></a>Chains</h1><ul><li>to</li><li>be</li><li>been</li><li>is</li><li>that</li><li>which</li><li>and</li><li>has</li><li>have</li><li>with</li><li>at</li><li>of</li><li>same</li></ul><h1 id="not"><a href="#not" class="headerlink" title="not"></a>not</h1><blockquote><p>negative any of assertions following in the Chains</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect(foo).to.not.equal(<span class="string">&#x27;bar&#x27;</span>)</span><br></pre></td></tr></table></figure><h1 id="deep"><a href="#deep" class="headerlink" title="deep"></a>deep</h1><blockquote><p>set the <code>deep</code> flag, later used by the <code>equal</code> and <code>property</code> assertions</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect(foo).to.deep.equal(&#123;<span class="attr">bar</span>: <span class="string">&#x27;bar&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure><h1 id="any"><a href="#any" class="headerlink" title="any"></a>any</h1><blockquote><p>set the <code>any</code> flag, (opposite of the <code>all</code> flag), later used in the <code>keys</code> assertion</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect(foo).to.have.any.keys(<span class="string">&#x27;bar&#x27;</span>, <span class="string">&#x27;foo&#x27;</span>)</span><br></pre></td></tr></table></figure><h1 id="all"><a href="#all" class="headerlink" title="all"></a>all</h1><blockquote><p>set the <code>all</code> flag, (opposite of the <code>any</code> flag), later used by the <code>keys</code> assertions</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect(foo).to.have.all.keys(<span class="string">&#x27;bar&#x27;</span>, <span class="string">&#x27;foo&#x27;</span>)</span><br></pre></td></tr></table></figure><h1 id="a-type"><a href="#a-type" class="headerlink" title="a(type)"></a>a(type)</h1><ul><li>@param {String} type</li><li>@param {String} message [optional]</li></ul><blockquote><p>The <code>a</code> and <code>an</code> assertion are aliases that can be used either as language chains or to assert a value’s type</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// typeof</span></span><br><span class="line">expect(<span class="string">&#x27;test&#x27;</span>).to.be.a(<span class="string">&#x27;string&#x27;</span>)</span><br><span class="line"><span class="comment">// language chain</span></span><br><span class="line">expect(foo).to.be.an.instanceof(Foo)</span><br></pre></td></tr></table></figure><h1 id="include-value"><a href="#include-value" class="headerlink" title="include(value)"></a>include(value)</h1><ul><li>@param {Object | String | Number} obj</li><li>@param {String} message [optional]</li></ul><blockquote><p>The <code>include</code> and <code>contain</code> assertion can be used as either property based language chains or methods to assert the inclusion of an object in an array or a substring in a string.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">expect([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]).to.include(<span class="number">2</span>)</span><br><span class="line">expect(<span class="string">&#x27;foobar&#x27;</span>).to.contain(<span class="string">&#x27;foo&#x27;</span>)</span><br><span class="line">expect(&#123; <span class="attr">foo</span>: <span class="string">&#x27;foo&#x27;</span>, <span class="attr">bar</span>: <span class="string">&#x27;bar&#x27;</span> &#125;).to.include.keys(<span class="string">&#x27;foo&#x27;</span>)</span><br></pre></td></tr></table></figure><h1 id="ok"><a href="#ok" class="headerlink" title="ok"></a>ok</h1><blockquote><p>Assert that the target is truthy</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">expect(<span class="string">&#x27;everything&#x27;</span>).to.be.ok</span><br><span class="line">expect(<span class="literal">undefined</span>).to.not.be.ok</span><br></pre></td></tr></table></figure><h1 id="true"><a href="#true" class="headerlink" title="true"></a>true</h1><blockquote><p>Assert that the target is <code>true</code></p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">expect(<span class="literal">true</span>).to.be.true</span><br><span class="line">expect(<span class="number">1</span>).to.be.true</span><br></pre></td></tr></table></figure><h1 id="false"><a href="#false" class="headerlink" title="false"></a>false</h1><blockquote><p>Assert that the target is <code>false</code></p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">expect(<span class="literal">false</span>).to.be.false</span><br><span class="line">expect(<span class="number">0</span>).to.be.false</span><br></pre></td></tr></table></figure><h1 id="null"><a href="#null" class="headerlink" title="null"></a>null</h1><blockquote><p>Assert that the target to be <code>null</code></p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect(<span class="literal">null</span>).to.be.null</span><br></pre></td></tr></table></figure><h1 id="undefined"><a href="#undefined" class="headerlink" title="undefined"></a>undefined</h1><blockquote><p>Assert that the target is <code>undefined</code></p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect(<span class="literal">undefined</span>).to.be.undefined</span><br></pre></td></tr></table></figure><h1 id="NaN"><a href="#NaN" class="headerlink" title="NaN"></a>NaN</h1><blockquote><p>Assert that the target is <code>NaN</code></p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect(<span class="string">&#x27;foo&#x27;</span>).to.be.NaN</span><br></pre></td></tr></table></figure><h1 id="exist"><a href="#exist" class="headerlink" title="exist"></a>exist</h1><blockquote><p>Assert that the target is neither <code>null</code> nor <code>undefined</code></p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect(<span class="string">&#x27;foo&#x27;</span>).to.be.exist</span><br></pre></td></tr></table></figure><h1 id="empty"><a href="#empty" class="headerlink" title="empty"></a>empty</h1><blockquote><p>Assert that the target’s length is 0. For Array and String, it will check the length of propertes. For Object, it will check the length of enumerable keys</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect([]).to.be.empty</span><br></pre></td></tr></table></figure><h1 id="arguments"><a href="#arguments" class="headerlink" title="arguments"></a>arguments</h1><blockquote><p>Assert that the target is an arguments object</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  expect(<span class="built_in">arguments</span>).to.be.arguments</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="equal-value"><a href="#equal-value" class="headerlink" title="equal(value)"></a>equal(value)</h1><ul><li>@param {Mixed} value</li><li>@param {String} message [optional]</li></ul><blockquote><p>Assert that the target is strictly equal(===) to <code>value</code>. Alternately, if the <code>.deep</code> flag is set, assert that the target is deeply equal to <code>value</code></p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">expect(<span class="string">&#x27;hello&#x27;</span>).to.equal(<span class="string">&#x27;hello&#x27;</span>)</span><br><span class="line">expect(&#123;<span class="attr">foo</span>: <span class="string">&#x27;foo&#x27;</span>&#125;).to.deep.equal(&#123;<span class="attr">foo</span>: <span class="string">&#x27;foo&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure><h1 id="eql-value"><a href="#eql-value" class="headerlink" title="eql(value)"></a>eql(value)</h1><ul><li>@param {Mixed} value</li><li>@param {String} message [optional]</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect(&#123;<span class="attr">foo</span>: <span class="string">&#x27;foo&#x27;</span>&#125;).to.eql(&#123;<span class="attr">foo</span>: <span class="string">&#x27;foo&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure><h1 id="above-value"><a href="#above-value" class="headerlink" title="above(value)"></a>above(value)</h1><ul><li>@param {Number} value</li><li>@param {String} message [optional]</li></ul><blockquote><p>Assert that the target is greater than <code>value</code></p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect(<span class="number">10</span>).to.be.above(<span class="number">5</span>)</span><br></pre></td></tr></table></figure><blockquote><p>Can also be used in conjunction with <code>length</code> to assert a minimum length.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect(<span class="string">&#x27;foo&#x27;</span>).to.have.length.above(<span class="number">2</span>)</span><br></pre></td></tr></table></figure><h1 id="least-value"><a href="#least-value" class="headerlink" title="least(value)"></a>least(value)</h1><ul><li>@param {Number} value</li><li>@param {String} message [optional]</li></ul><blockquote><p>Assert that the target is greater than or equal to <code>value</code></p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect(<span class="number">10</span>).to.be.at.least(<span class="number">10</span>)</span><br></pre></td></tr></table></figure><blockquote><p>used for length too</p></blockquote><h1 id="below-value"><a href="#below-value" class="headerlink" title="below(value)"></a>below(value)</h1><ul><li>@param {Number} value</li><li>@param {String} message [optinal]</li></ul><blockquote><p>Assert that the target is less than <code>value</code></p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect(<span class="number">5</span>).to.be.below(<span class="number">10</span>)</span><br></pre></td></tr></table></figure><blockquote><p>used for length too</p></blockquote><h1 id="most-value"><a href="#most-value" class="headerlink" title="most(value)"></a>most(value)</h1><ul><li>@param {Number} value</li><li>@param {String} message [optinal]</li></ul><blockquote><p>Assert that the target is less than or equal to <code>value</code></p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect(<span class="number">5</span>).to.be.at.most(<span class="number">5</span>)</span><br></pre></td></tr></table></figure><blockquote><p>used for length o</p></blockquote><h1 id="within-start-finish"><a href="#within-start-finish" class="headerlink" title="within(start, finish)"></a>within(start, finish)</h1><ul><li>@param {Number} start lowerbound inclusive</li><li>@param {Number} finish upperbound inclusive</li><li>@param {String} message [optional]</li></ul><blockquote><p>Assert that the target is within a range</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect(<span class="number">28</span>).to.be.within(<span class="number">2</span>, <span class="number">30</span>)</span><br></pre></td></tr></table></figure><blockquote><p>used for length too</p></blockquote><h1 id="instanceof-constructor"><a href="#instanceof-constructor" class="headerlink" title="instanceof(constructor)"></a>instanceof(constructor)</h1><ul><li>@param {Constructor} constructor</li><li>@param {String} message [optional]</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Tea = <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.name = name,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> Chai = <span class="keyword">new</span> Tea(<span class="string">&#x27;chai&#x27;</span>)</span><br><span class="line"></span><br><span class="line">expect(Chai).to.be.an.instanceof(Tea)</span><br><span class="line">expect([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]).to.be.an.instanceof(<span class="built_in">Array</span>)</span><br></pre></td></tr></table></figure><h1 id="property-name-value"><a href="#property-name-value" class="headerlink" title="property(name[, value])"></a>property(name[, value])</h1><ul><li>@param {String} name</li><li>@param {Mixed} value [optional]</li><li>@param {String} message [optional]</li></ul><blockquote><p>Assert that the target has a property <code>name</code>, optionally asserting that the value of that property is strictly equal to <code>value</code>. If the <code>deep</code> flag is set, you can use dot- and bracket-notation for deep reference into objects and arrays.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">expect(obj).to.have.property(<span class="string">&#x27;foo&#x27;</span>)</span><br><span class="line">expect(obj).to.have.property(<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="to-be-continued"><a href="#to-be-continued" class="headerlink" title="to be continued"></a>to be continued</h2>]]></content>
      
      
      
        <tags>
            
            <tag> Test </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>用 Javascript 实现选中粘贴</title>
      <link href="/2017/04/17/%E7%94%A8-javascript-%E5%AE%9E%E7%8E%B0%E9%80%89%E4%B8%AD%E7%B2%98%E8%B4%B4/"/>
      <url>/2017/04/17/%E7%94%A8-javascript-%E5%AE%9E%E7%8E%B0%E9%80%89%E4%B8%AD%E7%B2%98%E8%B4%B4/</url>
      
        <content type="html"><![CDATA[<p>为了对付单位愚蠢的每日工作总结的要求, 写了一个小脚本来导出任务管理器里的内容到剪贴板, 于是接触了一下纯 javascript 实现复制到剪贴板功能</p><p>代码先行贴出</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="meta">    &#x27;use strict&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&#x27;your_url&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> issueList = <span class="built_in">document</span>.querySelectorAll(<span class="string">&#x27;.issue-list li&#x27;</span>);</span><br><span class="line">        <span class="keyword">var</span> taskList = [];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>, len = issueList.length; i &lt; len; i++)&#123;</span><br><span class="line">            <span class="keyword">var</span> key = issueList[i].getAttribute(<span class="string">&#x27;data-key&#x27;</span>);</span><br><span class="line">            <span class="keyword">var</span> title = issueList[i].getAttribute(<span class="string">&#x27;title&#x27;</span>);</span><br><span class="line">            <span class="keyword">var</span> task = <span class="string">&#x27;已完成: &#x27;</span>+key+<span class="string">&#x27;-&#x27;</span>+title;</span><br><span class="line">            taskList.push(task);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> text = taskList.join(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">        <span class="keyword">var</span> clipboard = <span class="built_in">document</span>.createElement(<span class="string">&#x27;textarea&#x27;</span>);</span><br><span class="line">        clipboard.style.width = <span class="string">&#x27;100%&#x27;</span>;</span><br><span class="line">        clipboard.style.height = <span class="string">&#x27;300px&#x27;</span>;</span><br><span class="line">        clipboard.value = text;</span><br><span class="line">        <span class="keyword">var</span> listPanel = <span class="built_in">document</span>.getElementsByClassName(<span class="string">&#x27;list-panel&#x27;</span>)[<span class="number">0</span>];</span><br><span class="line">        listPanel.appendChild(clipboard);</span><br><span class="line">        <span class="keyword">var</span> today = <span class="built_in">document</span>.createElement(<span class="string">&#x27;button&#x27;</span>);</span><br><span class="line">        today.style.width = <span class="string">&#x27;100%&#x27;</span>;</span><br><span class="line">        today.innerText = <span class="string">&#x27;Today&#x27;</span>;</span><br><span class="line">        listPanel.appendChild(today);</span><br><span class="line">        today.addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="built_in">window</span>.location.href = <span class="string">&#x27;url_to_today&#x27;</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">var</span> button = <span class="built_in">document</span>.createElement(<span class="string">&#x27;button&#x27;</span>);</span><br><span class="line">        button.style.width = <span class="string">&#x27;100%&#x27;</span>;</span><br><span class="line">        button.innerText = <span class="string">&#x27;copy to clipboard&#x27;</span>;</span><br><span class="line">        listPanel.appendChild(button);</span><br><span class="line">        button.addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          clipboard.select();</span><br><span class="line">          <span class="built_in">document</span>.execCommand(<span class="string">&#x27;copy&#x27;</span>);</span><br><span class="line">          clipboard.blur();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> HTML </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Baisc Usage of Redux-Observable</title>
      <link href="/2017/03/20/baisc-usage-of-redux-observable/"/>
      <url>/2017/03/20/baisc-usage-of-redux-observable/</url>
      
        <content type="html"><![CDATA[<h2 id="First-of-All"><a href="#First-of-All" class="headerlink" title="First of All"></a>First of All</h2><h3 id="createEpicMiddleware-rootEpic"><a href="#createEpicMiddleware-rootEpic" class="headerlink" title="createEpicMiddleware(rootEpic)"></a><code>createEpicMiddleware(rootEpic)</code></h3><p><code>createEpicMiddleware</code> is used to create an instance of the actual redux-observable middleware, and you should provide a single, root Epic</p><h4 id="Arguments"><a href="#Arguments" class="headerlink" title="Arguments"></a>Arguments</h4><ol><li><code>rootEpic: Epic</code>: The root Epic</p></li><li><code>[options: Object]</code>: The optional configuration.</li></ol><ul><li><p><code>dependencies</code>: If given, it will be injected as the 3rd argument to all Epics,</p></li><li><p><code>adapter</code>: An adapter object which can transform the input/output streams provided to your epics, Usually used to adapt a stream library other than RxJS v5, like adapter-rxjs-v4 or adapter-most Options:</p><pre><code>*   `input: ActionsObservable =&amp;gt; Any`: Transforms the input stream of actions, `ActionsObservable` that is passed to your root Epic(transformation takes place before it is passed to the root Epix)*   `output: any =&amp;gt; Observable`: Transforms the return value of root Epic(transform takes place after the root epic returned it)</code></pre></li></ul><h4 id="Returns"><a href="#Returns" class="headerlink" title="Returns"></a>Returns</h4><p>`MiddlewareAPI`: An instance of the redux-observable middleware<h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><pre><code>import &#123; createStore, applyMiddleware, compose &#125; from &#39;redux&#39;import &#123; createEpicMiddleware &#125; from &#39;redux-observable&#39;import &#123; rootEpic, rootRotuer &#125; from &#39;./modules/root&#39;const epicMiddleware = createEpicMiddleware(rootEpic)export default function configureStore () &#123;  const store = createStore(    rootRotuer,    applyMiddleware(epicMiddleware)  )  return store&#125;`&lt;/pre&gt;### `combineEpics(...epic)``combineEpics` allows you to take multiple epics and combine them into a single one#### Arguments`...epics: Epic[]`: The epics to combine#### Return`(Epic)`: An Epic that merges the output of every Epic provided and passes along the `ActionObservable` and redux store as arguments### Example&lt;pre&gt;`import &#123; combineEpics &#125; from &#39;redux-observable&#39;import pingEpic from &#39;./ping&#39;import fetchUserEpic from &#39;./fetchUser&#39;export default combineEpics(  pingEpic,  fetchUser)`&lt;/pre&gt;### `EpicMiddleware`An instance of the redux-observable middlewareTo create it, pass your root Epic to `createEpicMiddleware``replaceEpic(nextEpic)`: Replaces the epic currently by the middleware, it is an advanced API. You might need this if your app implement code splitting and you want to load some of the epics dynamically or you&#39;re using hot reloading.### Create Epic&lt;pre&gt;`const pingEpic = action$ =&amp;gt; action$.ofType(&#39;PING&#39;).mapTo(&#123;type: &#39;PONG&#39;&#125;)`&lt;/pre&gt;### Cancellation&lt;pre&gt;`import &#123; ajax &#125; from &#39;rxjs/observable/dom/ajax&#39;const fetchUserEpic = action$ =&amp;gt; action$.ofType(&#39;FETCH_USER&#39;).mergeMap(  action =&amp;gt; ajax.getJSON(`/api/user/$&#123;action.payload&#125;`)    .map(res =&amp;gt; fetchUserFulfilled(res))    .takeUntil(action$.ofType(&#39;FETCH_USER_CANCELLED&#39;)))`&lt;/pre&gt;### Handling Error&lt;pre&gt;`import &#123; ajax &#125; from &#39;rxjs/observable/dom/ajax&#39;const fetchUserEpic = action$ =&amp;gt; action.ofType(&#39;FETCH_USER&#39;).mergeMap(  action =&amp;gt; ajax.getJSON(`/api/users/$&#123;action.payload&#125;`)  .map(res =&amp;gt; fetchUserFulfilled(res))  .catch(err =&amp;gt; Observable.of(&#123;    type: &#39;FETCH_USER_REJECTED&#39;,    payload: err.xhr.response,    error: true,  &#125;)))`&lt;/pre&gt;### dependencies Injecting&lt;pre&gt;`import &#123; createEpicMiddleware, combineEpics &#125; from &#39;redux-observable&#39;import &#123; ajax &#125; from &#39;rxjs/observable/dom/ajax&#39;import rootEpic from &#39;./somewhere&#39;const epicMiddleware = createEpicMiddleware(rootEpic, &#123;  dependencies: &#123; getJSON: ajax.getJSON &#125;&#125;)const fetchUserEpic= (action$, store, &#123; getJSON &#125;) =&amp;gt; action$.ofType(&#39;FETCH_USER&#39;).mergeMap(  (action) =&amp;gt; getJSON(`/api/users/$&#123;action.payload&#125;`)    .map(res =&amp;gt; (&#123;      type: &#39;FETCH_USER_REJECTED&#39;,      payload: res    &#125;)))`&lt;/pre&gt;### Adding New Epics Asynchronously/Lazily&lt;pre&gt;`import &#123; BehaviorSubject &#125; from &#39;rxjs/BehaviorSubject&#39;import &#123; combineEpics &#125; from &#39;redux-observable&#39;const epic$ = new BehaviorSubject(combineEpics(epic1, epic2))const rootEpic = (action$, store) =&amp;gt; epic$.mergeMap(epic =&amp;gt; epic(action$, store))// sometime later ... add another Epic, keeping the state of the old ones...epic$.next(asyncEpic1)// and again later add anotherepic$.next(asyncEpic2)</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> Redux </tag>
            
            <tag> RxJS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Functor 函子</title>
      <link href="/2017/02/27/functor-e5-87-bd-e5-ad-90/"/>
      <url>/2017/02/27/functor-e5-87-bd-e5-ad-90/</url>
      
        <content type="html"><![CDATA[<pre><code>class Functor &#123;  constructor (val) &#123;    this.__val = val  &#125;  map (fn) &#123;    return new Functor(fn(__this.value))  &#125;&#125;</code></pre><p>即将范畴 <code>Functor@val</code> 通过 fn 映射为范畴 <code>Function@fn(val)</code></p><p>Functor 本身具有 map 方法, 通过各种函数作为运算符, 映射成新的 Functor</p>]]></content>
      
      
      
        <tags>
            
            <tag> Functional Program </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Throttle 函数</title>
      <link href="/2017/02/22/throttle-e5-87-bd-e6-95-b0/"/>
      <url>/2017/02/22/throttle-e5-87-bd-e6-95-b0/</url>
      
        <content type="html"><![CDATA[<pre><code>function throttle (fn, threshold, scope) &#123;  threshold || threshold = 250  var last, timer  return function () &#123;    var ctx = scope || this    var now = +new Date()    var args = arguments    if (last &amp;amp;&amp;amp; now - last - threshold &amp;lt; 0) &#123;      // hold on it      clearTimeout(timer)      timer = setTimeout(function () &#123;        last = now        fn.apply(ctx, args)      &#125;, threshold)    &#125; else &#123;      last = now      fn.apply(ctx, args)    &#125;  &#125;&#125;`&lt;/pre&gt;&lt;pre&gt;`Elm.addEventListener(&#39;click&#39;, throttle(function(event)&#123;  // ...&#125;, 1000))</code></pre><p>假设第一次执行 throttle(fn0), fn0 会立即执行, 并记录 throttle 开启的时间 last</p><p>第二次执行, 假设为 throttle(fn1), 如果距离 now 未超出时限 threshold, 则开启定时器, threshold 后执行 fn1, 并设置 last</p><p>如果在开启定时器后, threshold 时限内执行 throttle(fn2) 则用于执行 fn1 的定时器会被清空, 开启 fn2 的定时器, 并设置 last</p><p>简而言之, 执行 throttle 的时候, 如果上一次的定时器未被执行, 则会被清除, 并重新开始计时</p>]]></content>
      
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Debounce 函数</title>
      <link href="/2017/02/22/debounce-e5-87-bd-e6-95-b0/"/>
      <url>/2017/02/22/debounce-e5-87-bd-e6-95-b0/</url>
      
        <content type="html"><![CDATA[<pre><code>function debounce (fn, delay) &#123;  var timer = null  return function () &#123;    var context = this, args = arguments    clearTimeout(timer)    timer = setTimeout(function () &#123;      fn.apply(context, args)    &#125;, delay)  &#125;&#125;`&lt;/pre&gt;Example:&lt;pre&gt;`Elm.addEventListener(&#39;click&#39;, debounce(function(event)&#123;  ...&#125;, 250))</code></pre><p>可以看出, 传入 debounce 的所有函数共享计时器 timer, 因此如果在 delay 时间内再次调用 debounce(fn), 即上一次 fn 为执行而新的 fn 传入时, 上一次的 fn 的 timer 会清空, 对新传入的 fn 进行计时</p><p>其结果即是,</p><p>在 delay 时限内复数次调用 debounce 会刷新计时器</p>]]></content>
      
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>React-Router 中 Props 的传递</title>
      <link href="/2017/02/07/react-router-e4-b8-ad-props-e7-9a-84-e4-bc-a0-e9-80-92/"/>
      <url>/2017/02/07/react-router-e4-b8-ad-props-e7-9a-84-e4-bc-a0-e9-80-92/</url>
      
        <content type="html"><![CDATA[<p>原本写</p><pre><code>&#123;children&#125;`&lt;/pre&gt;的地方改写为&lt;pre&gt;`&#123;children &amp;amp;&amp;amp; React.cloneElement(children, &#123;  prop, // 需要传入的 props&#125;)&#125;</code></pre><p>即可</p><p><a href="https://github.com/ReactTraining/react-router/blob/master/examples/passing-props-to-children/app.js">官方案例</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> React </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Babel-Polyfill 入门</title>
      <link href="/2017/02/04/babel-polyfill-e5-85-a5-e9-97-a8/"/>
      <url>/2017/02/04/babel-polyfill-e5-85-a5-e9-97-a8/</url>
      
        <content type="html"><![CDATA[<pre><code>yarn add babel-polyfillimport &#39;babel-polyfill&#39;`&lt;/pre&gt;babel-polyfill 提供了全局访问 API, 如 Promise, Set 以及 Map, 但是 polyfill 提供的 api 可能会污染到全局作用域, 特别在你把代码导报为第三方库给其他人用时, 或者你无法控制代码运行环境时, 都可能存在问题`babel` 提供了 `transform-runtime` 插件来解决此问题, `transform-runtime` 提供一个沙盒机制来组织全局变量的污染&gt; 需要注意, transform-runtime 依赖于 babel-runtime&lt;pre&gt;`# transform-runtime 只应用于开发环境yarn add --dev babel-plugin-transform-runtime# 其依赖包 babel-runtime 需要打包到生产环境yarn add babel-runtime`&lt;/pre&gt;&lt;pre&gt;`// .babelrc&#123;  &quot;plugins&quot;: [&quot;transform-runtime&quot;]&#125;or&#123;  &quot;plugins&quot;: [    [&quot;transform&quot;, &#123;      &quot;helpers&quot;: false,      &quot;polyfill&quot;: false,      &quot;regenerator&quot;: true,      &quot;moduleName&quot;: &quot;babel-runtime&quot;,      &#125;]  ]&#125;</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> Babel </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>解决 CommonsChunkPlugin 的 Hash 变化问题</title>
      <link href="/2017/02/01/e8-a7-a3-e5-86-b3-commonschunkplugin-e7-9a-84-hash-e5-8f-98-e5-8c-96-e9-97-ae-e9-a2-98/"/>
      <url>/2017/02/01/e8-a7-a3-e5-86-b3-commonschunkplugin-e7-9a-84-hash-e5-8f-98-e5-8c-96-e9-97-ae-e9-a2-98/</url>
      
        <content type="html"><![CDATA[<h3 id="原文"><a href="#原文" class="headerlink" title="原文:"></a>原文:</h3><blockquote><p>Manifest File<br>But, if we change application code and run webpack again, we see that the hash for the vendor file changes. Even though we achieved separate bundles for vendor and main bundles, we see that the vendor bundle changes when the application code changes. This means that we still don’t reap the benefits of browser caching because the hash for vendor file changes on every build and the browser will have to reload the file.</p><p>The issue here is that on every build, webpack generates some webpack runtime code, which helps webpack do it’s job. When there is a single bundle, the runtime code resides in it. But when multiple bundles are generated, the runtime code is extracted into the common module, here the vendor file.</p></blockquote><p>To prevent this, we need extract out the runtime into a separate manifest file. Even though we are creating another bundle, the overhead is offset by the long term caching benefits that we obtain on the vendor file.</p><h3 id="非翻译"><a href="#非翻译" class="headerlink" title="非翻译:"></a>非翻译:</h3><p>每次打包时 vendor 文件的 hash 也会变化的原因在于, webpack 打包时必定会产生 runtime code.</p><p>当我们需要打包出 vendor.js 的时候, 尽管公共代码没有变化, 但是 webpack 会生成新的 runtime code 并注入 vendor.js, 导致其 hash 变化.</p><h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法:"></a>解决方法:</h3><p>将 vendor.js 中的 runtime code 单独打包出来, 这样只有 bundle.js 和 runtime code 的 hash 会变化, vendor.js 的代码不会变化.</p><h3 id="具体做法"><a href="#具体做法" class="headerlink" title="具体做法:"></a>具体做法:</h3><pre><code>new webpack.optimize.CommonsChunkPlugin(&#123;  name: [&#39;vendor&#39;, &#39;manifest&#39;],&#125;</code></pre><p>这样就可以把 runtime code 打包进 manifest.js, 此后该类操作不会改变 vendor.js 的 hash 了</p>]]></content>
      
      
      
        <tags>
            
            <tag> Webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Webpack 2 Config 文件入门</title>
      <link href="/2017/01/29/webpack-2-config-e6-96-87-e4-bb-b6-e5-85-a5-e9-97-a8/"/>
      <url>/2017/01/29/webpack-2-config-e6-96-87-e4-bb-b6-e5-85-a5-e9-97-a8/</url>
      
        <content type="html"><![CDATA[<p>webpack 2 config 文件入门</p><h3 id="webpack-config-js-的基本结构"><a href="#webpack-config-js-的基本结构" class="headerlink" title="webpack.config.js 的基本结构"></a>webpack.config.js 的基本结构</h3><pre><code>var path = require(&#39;path&#39;)module.exports = &#123;  entry:  &#123;    home: &#39;./home.js&#39;,    about: &#39;./about.js&#39;,    contact: &#39;./contact.js&#39;,  &#125;, // 入口文件  // string | [string] | object &#123;&amp;lt;key&amp;gt;: string | [string] &#125;  // 一个页面搭配一个入口文件  output: &#123;    // output 包含一系列关于打包后文件的配置    // output.chunkFilename: string, 这个参数确定了加载 chunk 的名称    // output.crossOriginLoading: boolean | string, 只在 target 参数指定为 web 的时候使用, 因为此时通过 jsonp 加载模块    // crossOriginLoading: false(default) , 禁止跨域加载    // crossOriginLoading: &#39;anonymous&#39;, 允许无 credential 的跨域加载    // crossOriginLoading: &#39;use-credentials&#39;, 允许有 credential 的跨域加载    //    // output.devtoolFallbackModuleFilenameTemplate: string | function(info)    // output.hotUpdateChunkFilename: string, 指定热刷新的 chunk 的名称, 仅支持 id 和 hash 占位符    // hotUpdateChunkFilename: &#39;[id].[hash].hot-update.js&#39;    // output.sourceMapFilename: string, 仅当 devtool 使用 source map 时生效, 默认为[ file].map, 可选占位符有[name], [id], [hash], [chunkhash]    path: path.resolve(__dirname, &#39;dist&#39;), // 打包后文件存储路径, 必须是绝对路径, 可以用 path 模块生成    publicPath: /assert/, // 解析文件中相对路径时依赖的根目录    // 该字段设定了输出文件的 public Url    //    // 默认的, 相对路径会基于 html 文件位置或&amp;lt;base&amp;gt;标签进行解析, 添加 publicPath 后, 各个 loaders 会在每个相对路径前添加 publicPath, 即相对路径基于 publicPath 进行解析    // 该值一般以&#39;/&#39;结尾    // 默认值为&#39;&#39;    // simple rule: 该参数的值为html 页面到 output.path 的相对值    // path: path.resolve(__dirname, &#39;public/assets&#39;),    // publicPath: &#39;https://cdn.example.com/assets/&#39;,    // publicPath 也会对 webpack-dev-server 生效    // publicPath: &#39;https://cdn.example.com/assets/&#39; cdn, 并且应该使用 https    // publicPath: &#39;//cdn.example.com/assets/&#39;, cdn, 使用相同协议    // publicPath: &#39;/assets/&#39;, 相对于服务器根路径    // publicPath: &#39;assets/&#39;, 相对于 html 页面    // publicPath: &#39;../assets/&#39;, 相对于 html 页面    // publicPath: &#39;&#39;, 相对于 html 页面(同一路径)    filename: &#39;bundle.js&#39;, // 打包后的文件名称    // 对于单一入口文件, filename 可以为静态名称&#39;bundle.js&#39;    // 对于多入口文件, 可以使用参数生成特定名称    // [name], [id], [hash], [chunkhash]    // 可以为文件添加路径: &#39;js/[name]/bundle.js&#39;    library: &#39;MyLibrary&#39;, // 输出库的名称    libraryTarget: &#39;umd&#39;, // 输出库的类型  &#125;,  module: &#123;    // module.noParse: RegExp | [RegExp], 符合正则的字段被 import, require, define 后不会被处理, 可以提高打包速度    // noParse: /jquery|lodash/    //    rules: [      // 模块应用规则(loaders, parser 的设定等)      // module.rules: array      // 一条 Rule 可以分为三部分, Conditions, Results, Nested Rules      // Conditions, 有两个输入值,      // 1\. The resource: 文件引用的绝对路径经过 resolve 规则解析后的结果      // 2\. The issuer: 引用 resource 的模块到文件的绝对路径      // 比如, &#39;app.js&#39; 中 &#39;import ./style.css&#39;, resource 是 &#39;/path/to/style.css&#39;, issuer 是 &#39;/path/to/app.js&#39;      // 在 rule 中, test, include, exclude 和 resource 作用于resource, 而 issuer 族谱用于 issuer      // Results      // Rule Results 仅在 Rule Conditions 满足时起作用      // Rule Results 有二种输出值      // Applied Loaders: 一个数组, 其元素是应用于 resource 的 loaders      // Parser options: 一个 options 对象, 作为当前 module 的 parser      // loader, options, use 用于 loaders,      // query, loaders 用于提高兼容性      // enforce 属性指定 loader 类型, 可选值有: normal, pre, post      // parser 属性影响 parser options      // Nested Rules      // 在 rules 和 oneOf 属性中可以指定 nested rules      // Rule.enforce: &#39;pre&#39; | &#39;post&#39;, 指定 loader 的类型, 默认为 normal      // 还有一种 inline loader 应用于 inline import/require,      // 所有 loaders 按照 post, inline, normal, pre 排序并依次执行      // 所有 normal loaders 可以通过在 request 中添加前缀 &#39;!&#39; 进行忽略      // 所有 normal 和 pre loaders 可以通过在 request 中添加前缀 &#39;-!&#39; 进行忽略      // 所有 normal, post 和 pre loaders 可以通过在 request 前添加 &#39;!!&#39; 进行忽略      // Rule.exclude      // Rule.exclude 是 Rule.resource.exclude 的缩写      //      // Rule.include      // Rule.include 是 Rule.resource.include 的缩写      //      // Rule.issuer      //      // Rule.loader      // Rule.loader 是 Rule.use: [&#123;loader&#125;] 的别名      //      // Rule.loaders      // Rule.loaders 是 Rule.use 的别名, 他的存在仅为了兼容 webpack1, 应使用 Rule.use      //      // Rule.oneOf      // 一个数组, 其元素为一系列 rules, 仅第一个符合条件的 rule 会起作用      //      // Rule.options/ Rule.query      // Rule.options 和 Rule.query 都是 Rule.use: [&#123;options&#125;] 的缩写      // Rule.query 的存在仅为了兼容 webpack1, 应使用 Rule.options      //      // Rule.parser      // 一个 parser options 的对象, 所有要使用的 parser options 都集中在此      // 每个不同的 parser options 都会创建对应 parser, 并且 plugins 可以根据 parser options 应用.  当 parser options 中没有设置或设置为 true 时, 大部分 plugins 默认只应用他们自己的 parser plugins      // parser: &#123;      // amd: false, // disable AMD      // commonjs: false, // disable CommonJS      // harmony: false, // disable ES6 Harmony import/exports      // requireInclude: false, // disable require.include      // requreEnsure: false, // disable require.ensure      // &#125;      // Rule.resource      // Rule.rules, 一个 Rules 组成 的数组      // Rule.test, Rule.resource.test 的缩写      // Rule.use, 一系列应用于 modules 的 UseEntries, 每一个 entry 指定一个 loader      // use: [&#39;style-loader&#39;] 是 use: [&#123;loader: &#39;style-loader&#39;&#125;] 的缩写      // 可以链式传入多个 loaders, 从右向左依次执行      // use: [      //   &#123;loader: &#39;style-loader&#39;&#125;,      //   &#123;loader: &#39;css-loader&#39;, options: &#123; importLoader: 1&#125;&#125;,      //   &#123;loader: &#39;less-loader&#39;, options: &#123; noIeCompat: true&#125;&#125;,      // ]      // Condition      // Condition 可以为以下之一:      // String: 比如 exclude: &#39;node_modules&#39;      // RegExp: 比如 test: /\.js$/, exclude: /node_modules/      // function: 返回 true 或 false      // Condition Array: 至少有一个满足时刻认为满足 condition      // Object: 所有属性都满足时可认为满足      //      // &#123;test: Condition&#125;, &#123;include: Condition&#125;, &#123;exclude: Condition&#125;, &#123;and: [Condition]&#125;, &#123;or: [Condition]&#125;, &#123;not: Condition&#125;      //      // UseEntry: object      // 该属性必须有一个字符串 loader.      // 该属性相对 context 的值解析 loader      // 该属性拥有 options 属性, 该属性为 string 或 object, 该属性会作为 loader options 被传给 loader      // 考虑到兼容性, 目前仍支持 query 作为 options 的别名      //      &#123;        test: /\.jsx?$/, // 通过正则表达式选择要处理的文件        include: [ // 限定文件范围          path.resolve(__dirname, &#39;app&#39;)        ],        exclude: [ // 排除文件范围          path.resolve(__dirname, &#39;demo&#39;)        ]        // 最佳实践        // test 中使用正则表达式        // include 和 exclude 中使用绝对路径        // 优先使用 include 而不是 exclude        issuer: &#123; test, include, exclude &#125;,        // issuer 的应用范围        enforce: &#39;pre&#39;,        enforce: &#39;post&#39;,        loader: &#39;babel-loader&#39;,        // 使用 babel-loader 处理符合条件的文件        // webpack2 中 -loader 不再可以省略        options: &#123;          presets: [&#39;es2015&#39;]        &#125;        // babel-loader 的配置      &#125;,      &#123;        test: /\.html$/,        use: [          // 应用多个 loader 及相关配置          &#39;htmllint-loader&#39;,          &#123;            loader: &#39;html-loader&#39;,            options: &#123;              // ...            &#125;          &#125;        ]      &#125;,      &#123;         oneOf: [ /* rules */ ],         // 仅应用 rules 数组中的一条规则      &#125;,      &#123;        rules: [ /* rules */ ],        // 应用所有 rules      &#125;,      &#123;        resource: &#123; and: [ /* conditions */ ]&#125;        // 当所有 conditions 都满足时才认为符合条件      &#125;,      &#123; resource: &#123; or: [ /* conditions */ ]&#125;, &#125;,      &#123; resource: [ /* conditions */] &#125;,      // 当某一 condition 满足时即可认为符合条件      &#123;        resource: &#123; not: /* condition */ &#125;        // 当某一 condition 不满足时可认为符合条件      &#125;    ],    // rules 结束  &#125;,  resolve: &#123;    // 解析模块 request 时的配置    // (不会应用于解析 loader )    modules: [      &#39;node_modules&#39;,      path.resolve(__dirname, &#39;app&#39;)    ],    // 解析 modules 时的路径    extensions: [&#39;.js&#39;, &#39;.json&#39;, &#39;.jsx&#39;, &#39;.css&#39;],    // 可以省略的扩展名    alias: &#123;      // 模块别名      // 为 import 或 require 创建别名      // Utilities: path.resolve(__dirname, &#39;src/utilities&#39;)      // import Utility from &#39;../../utilities/utility&#39; 可以缩写为      // import Utility from &#39;Utilities/utility&#39;      // 末尾添加$可以进行精确匹配, 类似正则      //      &#39;module&#39;: &#39;new-module&#39;,      // 别名 module 可以表示 new-module, 包括文件与路径, 比如 module/path/file 会被解析为 new-module/path/file      &#39;only-module$&#39;: &#39;new-module&#39;,      // 别名 only-module(处于尾部) 会被解析成 new-module, 因此 module/path/file 不会被解析    &#125;,    // aliasFields: string    // 指定一个 field, 比如 browser, 来执行特定的 alias    // aliasFields: [&#39;browser&#39;]    //    // resolve.descriptionFiles: array    // 用于描述的 JSON 文件, 默认为    // descriptionFiles: [&#39;package.json&#39;]    //    // resolve.enforceExtension: boolean    // 如果为 true, webpack 不会处理没有扩展名的文件, 默认为 false, 及允许 require(&#39;./foo&#39;) 这种写法    //    //resolve.enforceModuleExtension: boolean    //默认为 false, 是否允许 modules(loaders) 省略扩展名    //    //resolve.extensions: array, 自动解析指定的扩展名    //默认为    // extensions: [&#39;.js&#39;, &#39;.json&#39;]    // 因此可以使用 import File from (&#39;../path/to/file&#39;) 这种写法    //    // resolve.mainFields: array    // 当 import 一个包时, 比如 import * as D3 from &#39;d3&#39;, 这个设置决定package.json中的哪个 field 对应的包的会被检索, 默认值基于 target 的值    // 当 target 指定为 webworker, web 或不指定    // mainFields: [&#39;browser&#39;, &#39;module&#39;, &#39;main&#39;]    // 对于其他 target,    // mainFields [&#39;module&#39;, &#39;main&#39;]    // 例如, D3的 package 包括这些 fields    // &#123;    // ...    // main: &#39;build/d3.Node.js&#39;,    // browser: &#39;build/d3.js&#39;,    // module: &#39;index&#39;    // ...    // &#125;    //    // resolve.mainFiles: array    // 这里的 filename 会在解析路径的时候用到, 默认为    // mainFiles: [&#39;index&#39;]    //    // resolve.modules: array    // 限定 webpack 搜索与解析的范围    // 可以使用绝对路径偶相对路径, 但是他们的行为有少许不同.    // 相对路径的检索方式与 Node 检索 module 相近, 首先检索当前路径及父路径    // 绝对路径则只会检索给定路径    // 默认值为 modules: [&#39;node_modules&#39;]    //    // 如果要添加路径, 应当添加在 node_modules 前面    // modules: [path.resolve(__dirname, &#39;src&#39;), &#39;node_modules&#39;]    //    // resolve.unsafeCache: regex | array | boolean    // 默认为 true, 即允许模块缓存, 即使这种行为是不安全的    //  &#125;,  performance: &#123;    // 此配置决定 webpack 的通知功能    // 主要用于对文件尺寸的控制    hints: &#39;warning&#39;, // enum    // hints: boolean | &#39;error&#39; | &#39;warning&#39;    // 设定 webpack 何时显示通知    // 默认为 warning    maxAssetSize: 200000, // int (in bytes)    // maxAssetSize: int, 这个选项限制了单个 asset 的尺寸, 默认为250000    maxEntrypointSize: 400000, // int (in bytes)    // maxEntrypointSize: int, 限制初始加载时单个 entry 的最大请求数, 默认为250000    assetFilter: function (assetFilename) &#123;      return assetFilename.endsWith(&#39;.css&#39;) || assetFilename.endsWith(&#39;.js&#39;)    &#125;    // assetFilter: function, 这个属性允许 webpack 控制使用哪些文件来计算 performance hint, 默认为    // function (assertFilename) &#123;    //   return !(/\.map$/.test(assetFilename))    // &#125;    //    // 可以自己设定 filter function    // assetFilter: function(assetFilename) &#123;    //   return assetFilename.endsWith(&#39;.js&#39;)    // &#125;  &#125;,  devtool: &#39;source-map&#39;, // enum, string | false  // 可以提高 debug 的便利性, 但是会影响打包速度  // 面向开发有: eval, inline-source-map, eval-source-map, cheap-module-eval-source-map  // 面向生产有: source-map, hidden-source-map, cheap-source-map, nosources-source-map  context: __dirname, // 使用绝对路径  // webpack 的根路径, loaders 的配置文件(.babelrc, postcss.config.js)和 entry 都是基于 context 来解析的  // 该属性值默认为当前目录, 但是强烈建议书写这一字段, 可以使你的配置文件独立于当前工作目录  target: &#39;web&#39;, // enum  // 打包文件运行环境  // webpack 可以针对多个 environment 或 target 编译  // target: string, (async-node|electron|electron-renderer|node|node-webkit|web|webworker)  externals: [&#39;react&#39;, /^@angular\//],  // 不必打包的内容  // externals: string| RegExp | function | array | object  // 例如要使用 jquery 的 cdn, 则可以这样配置  // externals: &#123;  //   jquery: &#39;jQuery&#39;  // &#125;  // import $ from &#39;jquery&#39;  //  // externals: &#123;  //   substract: [&#39;./math&#39;, &#39;substract&#39;]  // &#125;  // 会形成一个负责结构, ./math 是父模块, 而你的 bundle 仅请求其子模块 substract  //  // externals: &#123;  //   react: &#39;react&#39;,  //   lodash: &#123;  //     commonjs: &#39;lodash&#39;,  //     amd: &#39;lodash&#39;,  //     root: &#39;_&#39;  //   &#125;  // &#125;  //  watch: boolean  // webpack 可以监控文件并在他们变化时进行重新编译  // 默认为 false  watchOptions: object,  // 配置 watch 的模式  // &#123;  //   aggregateTimeout: number, 从第一次检测到文件变化到进行重新编译的延迟时间, 这个段时间内的其他变化会被整合进此次编译  //   ignored: string | RegExp, 忽视某些文件的变化, 减轻 CPU 负担  //   poll: boolean | number, 每隔1000ms 进行一次检测  // &#125;  stats: &#123;    // 待补充  &#125;,  devServer: &#123;    // 这一部分的设置会被 webpack-dev-server 采用    contentBase: path.resolve(__dirname, &#39;dist&#39;), // 指定 serve 目录为 dist    compress: true, // 开启 gzip 压缩    port: 9000, // 指定端口    // 当 devServer 启动时, 控制台会打印    // http://localhost:9000    // webpack result is served from /build/    // content is served from dist/    // 这几行指出了 server 的位置和 served 内容    // 如果你使用了 Node.js API, 那么这部分会被忽略    //    // devServer.filename: string, 这个选项可以减少 lazy mode 下的编译次数    // 默认的, 在 lazy mode 下, 每一个请求会进行一次新的编译    // 添加 filename 后, devServer 仅在请求 filename 时进行编译, 比如    // lazy: true,    // filename: bundle.js    // 此时, devServer 仅在请求/ bundle.js 时进行编译    // filename 仅在 lazy mode 中起作用    // devServer.headers: object, 在所有 request 中添加请求头    // headers: &#123;    //   &#39;X-Custom-Foo&#39;: &#39;bar&#39;    // &#125;    //    // devServer.historyApiFallback: boolean, object    // 当使用 Html5 History Api 时, index.html 可能得到404响应    //    // devServer.hot: boolean, 开启 webpack 模块热替换    //    // devServer.host - CLI only    // 指定 host    //    // devServer.https: boolean | object, devServer 默认false, 即使用 http    //    // devServer.inline - CLI only    // 切换 devServer 的模式, 默认使用 inline 模式, 即脚本会直接注入到你的 bundle 以实现重载, 设置 devServer.inline: false 可以启用 iframe 模式    //    //  &#125;,  plugins: [    // 待补充  ]&#125;</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> Webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Webpack 2 起步</title>
      <link href="/2017/01/29/webpack-2-e8-b5-b7-e6-ad-a5/"/>
      <url>/2017/01/29/webpack-2-e8-b5-b7-e6-ad-a5/</url>
      
        <content type="html"><![CDATA[<p>虽然和 webpack1 一样, 还是过一遍</p><h3 id="创建一个-bundle"><a href="#创建一个-bundle" class="headerlink" title="创建一个 bundle"></a>创建一个 bundle</h3><pre><code>mkdir webpack-demo &amp;amp;&amp;amp; webpack-demonpm init -yyarn add --dev webpack@betayarn add lodash`&lt;/pre&gt;#### 创建 app/index.js&lt;pre&gt;`// app/index.jsimport _ from &#39;lodash&#39;function component () &#123;  let element = document.createElement(&#39;div&#39;);// use lodash  element.innerHtml = _.join([&#39;Hello&#39;, &#39;webpack&#39;], &#39; &#39;)  return element&#125;document.body.appendChild(component())`&lt;/pre&gt;#### 创建 index.html&lt;pre&gt;`&amp;lt;html&amp;gt;  &amp;lt;head&amp;gt;    &amp;lt;title&amp;gt;webpack 2 demo&amp;lt;/title&amp;gt;  &amp;lt;/head&amp;gt;  &amp;lt;body&amp;gt;    &amp;lt;script src=&quot;public/bundle.js&quot;&amp;gt;&amp;gt;/script&amp;gt;  &amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;`&lt;/pre&gt;#### 创建打包后文件&lt;pre&gt;`./node_modules/.bin/webpack app/index.js public/bundle.js`&lt;/pre&gt;webpack 会自动处理包的依赖关系### 添加配置文件&lt;pre&gt;`var path = require(&#39;path&#39;)module.exports = &#123;  entry: &#39;./app/index.js&#39;,  output: &#123;    path: path.resolve(__dirname, &#39;public&#39;),    filename: &#39;bundle.js&#39;  &#125;&#125;`&lt;/pre&gt;通过 webpack 命令行进行打包&lt;pre&gt;`webpack --config webpack.config.js`&lt;/pre&gt;`webpack` 会默认执行名为 `webpack.config.js` 的配置文件, 因此仅输入`webpack` 即可进行打包### 通过 yarn 执行打包在 `yarn init` 生成的 `package.json` 中添加&lt;pre&gt;`&#123;  ...  &quot;scripts&quot;: &#123;    &quot;build&quot;: &quot;webpack&quot;  &#125;  ...&#125;</code></pre><p>即可将<code>webpack</code>指令添加进 yarn 的快捷方式, 此时执行 <code>yarn build</code> 即可打包</p>]]></content>
      
      
      
        <tags>
            
            <tag> Webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Stacking Context 成因及特性</title>
      <link href="/2017/01/18/stacking-context-e6-88-90-e5-9b-a0-e5-8f-8a-e7-89-b9-e6-80-a7/"/>
      <url>/2017/01/18/stacking-context-e6-88-90-e5-9b-a0-e5-8f-8a-e7-89-b9-e6-80-a7/</url>
      
        <content type="html"><![CDATA[<h3 id="会形成-Stacking-Context-的元素"><a href="#会形成-Stacking-Context-的元素" class="headerlink" title="会形成 Stacking Context 的元素"></a>会形成 Stacking Context 的元素</h3><ul><li><p>root 元素( html )</p></p></li><li><p>position 不是 static 且 z-index 不是 auto 的元素</p></li><li><p>flex item 且 z-index 不是 auto 的元素</p></li><li><p>opacity 小于 1 的元素</p></li><li><p>transform 不是 none 的元素</p></li><li><p>mix-blend-mode 不是 normal 的元素</p></li><li><p>filter 不是 none 的元素</p></li><li><p>isolation 为 isolate 的元素</p></li><li><p>mobile webkit 和 chrome 22+ 上的 fixed 元素</p></li><li><p>在 will-change 属性上指定值为上述任意属性的元素</p></li><li><p>指定 -webkit-overflow-scrolling 为 touch 的元素</p></li></ul><h3 id="Stacking-Context-的特性"><a href="#Stacking-Context-的特性" class="headerlink" title="Stacking Context 的特性"></a>Stacking Context 的特性</h3><ul><li><p>stacking context 可以嵌套</p></li><li><p>每个 Stacking context 相对于兄弟元素都是完全独立的, 其内部规则不会影响到外部</p></li><li><p>每个 stacking context 元素都会被父级 stacking context 视为一个 stacking 规则</p></li></ul><p>为已经定位的元素( absolute 或 relative) 指定 z-index 可以改变其 parent stacking context 中 z 的偏移量<p>一个值得注意的坑: 如果一个元素不是通过 absolute 或 relative 实现 stacking context, 那么他的 z-index 为 0 , 仅高于 auto, 且无法改变.</p>]]></content>
      
      
      
        <tags>
            
            <tag> HTML </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Web 坐标整理</title>
      <link href="/2016/12/08/web-e5-9d-90-e6-a0-87-e6-95-b4-e7-90-86/"/>
      <url>/2016/12/08/web-e5-9d-90-e6-a0-87-e6-95-b4-e7-90-86/</url>
      
        <content type="html"><![CDATA[<h3 id="坐标分类"><a href="#坐标分类" class="headerlink" title="坐标分类"></a>坐标分类</h3><ol><li>文档坐标</p></li><li>窗口坐标</li></ol><h3 id="scroll"><a href="#scroll" class="headerlink" title="scroll"></a>scroll</h3><p>Element.scrollTop: 设置或获得一个元素距离他容器顶部的像素距离, 当一个元素的容器没有产生垂直方向的滚动条, 则他的 scrollTop 的值默认为 0</p><p>获得滚动距离<br>var intElementScrollTop = someElement.scrollTop;</p><p>scrollTop 可以被设置为任何整数, 但是一下情况会报错:<br>1. 如果一个元素不能被滚动(没有溢出容器或本身不可滚动)的时候设置其 scrollTop 为 0;</p><ol><li><p>设置 scrollTop 的值小于 0, scrollTop 被设为 0</p></li><li><p>如果设置了超出这个容器可以滚动的值, scrollTop 会被设为最大值</p></li></ol><blockquote><p>其实就是溢出距离</blockquote><p><img src="https://developer.mozilla.org/@api/deki/files/842/=ScrollTop.png"></p><p>Element.scrollHeight: 计量元素内容高度的只读属性, 包括 overflow 样式属性导致的视图中不可见内容</p><p>没有垂直滚动条的情况下, scrollHeight 值与元素视图填充所有内容所需要的最小值 clientHeight 相同, 包括元素的 padding, 但不包括 margin</p><blockquote><p>其实就是溢出元素的本身高度</p></blockquote><p>!()[<a href="https://developer.mozilla.org/@api/deki/files/840/=ScrollHeight.png]">https://developer.mozilla.org/@api/deki/files/840/=ScrollHeight.png]</a></p><h4 id="判断元素是否滚动到底部"><a href="#判断元素是否滚动到底部" class="headerlink" title="判断元素是否滚动到底部"></a>判断元素是否滚动到底部</h4><p><code>element.scrollHeight - element.scrollTop === element.clientHeight</code></p><h3 id="clientTop"><a href="#clientTop" class="headerlink" title="clientTop"></a>clientTop</h3><p>Element.clientTop: 一个元素顶部边框的宽度, 不包括顶部外边距或内边距, 只读属性</p><p>clientHeight 可以通过 CSS height + CSS padding - 水平滚动条高度 来计算</p><blockquote><p>其实就是可视区域高度</p></blockquote><p>mouseEvent.clientX: 只读属性, 事件发生时应用客户端区域的水平坐标, 与页面无关</p><p>mouseEvent.x 是 mouseEvent.clientX 的别名</p><h3 id="window"><a href="#window" class="headerlink" title="window"></a>window</h3><p>window.innerHeight: 浏览器窗口的视口( viewport ) 高度, 如果存在滚动条, 则要包括在内, 只读属性</p><p>window.outerHeight: 整个浏览器窗口的高度</p><p><img src="https://developer.mozilla.org/@api/deki/files/213/=FirefoxInnerVsOuterHeight2.png"></p><h3 id="offset"><a href="#offset" class="headerlink" title="offset"></a>offset</h3><p>mouseEvent.offsetX: read-only property provides the offset in the X coordinate of the mouse pointer between that event and the padding edge of the target node</p><h3 id="page"><a href="#page" class="headerlink" title="page"></a>page</h3><p>event.PageX: read-only property returns the horizontal coordinate of the event relative to the whole document</p><blockquote><p>文档坐标</p></blockquote><h3 id="screen"><a href="#screen" class="headerlink" title="screen"></a>screen</h3><p>mouseEvent.screenX: read-only property provides the horizontal coordinate of the mouse pointer in the global(screen) coordinate.</p>]]></content>
      
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> CSS </tag>
            
            <tag> HTML </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Simple CheetSheet of Flex</title>
      <link href="/2016/12/07/simple-cheetsheet-of-flex/"/>
      <url>/2016/12/07/simple-cheetsheet-of-flex/</url>
      
        <content type="html"><![CDATA[<h3 id="Flex"><a href="#Flex" class="headerlink" title="Flex"></a>Flex</h3><h5 id="Parent"><a href="#Parent" class="headerlink" title="Parent"></a>Parent</h5><ol><li><p>display: flex</p></p></li><li><p>flex-direction: row | row-reverse | column | column-reverse</p></li><li><p>flex-wrap: nowrap | wrap | wrap-reverse</p></li><li><p>flex-flow: &lt;flex-direction&gt; || &lt;flex-wrap&gt;</p></li><li><p>justify-content: flex-start | flex-end | center | space-between | space-around</p></li><li><p>align-items: flex-start | flex-end | center | stretch | baseline (single row)</p></li><li><p>align-content: flex-start | flex-end | center | stretch | space-between | space-around (multi-row)</p></li></ol><h5 id="Children-flex-item"><a href="#Children-flex-item" class="headerlink" title="Children(flex-item)"></a>Children(flex-item)</h5><ol><li><p>order: &lt;integer&gt;</p></li><li><p>flex-grow: &lt;number&gt;(0 default)</p></li><li><p>flex-shrink: &lt;number&gt;(0 default)</p></li><li><p>flex-basis: &lt;length&gt; | auto (auto default)</p></li></ol><p><img src="http://cdn2.w3cplus.com/cdn/farfuture/PKTu2Zlf4mWNkTFEVF0N7Qn1WFDXbKwRVp0Fv5w5jjI/mtime:1431011912/sites/default/files/blogs/2015/1505/rel-vs-abs-flex.svg"></p><ol><li><p>flex: none || &lt;flex-grow&gt;&lt;flex-shrink&gt;&lt;flex-basis&gt;</p></li><li><p>align-self: auto | flex-start | flex-end | center | stretch | baseline</p></li></ol><p>**notice:** `float`, `clear`, `vertical-align` are unavailable in flex item]]></content>
      
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Usage of Redux-Action</title>
      <link href="/2016/11/06/usage-of-redux-action-2/"/>
      <url>/2016/11/06/usage-of-redux-action-2/</url>
      
        <content type="html"><![CDATA[<h3 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h3><p><code>createAction(type, payloadCreator = Identity, ?metaCreator)</code></p><pre><code>import &#123; createAction &#125; from &#39;redux-action&#39;`&lt;/pre&gt;Wraps an action creator so that its return value is the payload of a Flux Standard Action. If no payload creator is passed, or if it&#39;s not a function, the identity function is used.### Example&lt;pre&gt;`let increment = createAction(&#39;INCREMENT&#39;, amount =&amp;gt; amount);// same asincrement = createAction(&#39;INCREMENT&#39;);expect(increment(42)).to.deep.equal(&#123;  type:&#39;INCREMENT&#39;,  payload: 42,&#125;);`&lt;/pre&gt;If the payload is an instance of an Error Object, redux-actions will automatically set `action.error` to true.### Example&lt;pre&gt;`const increment = createAction(&#39;INCREMENT&#39;);const error = new TypeError(&#39;not a number&#39;);expect(increment(error)).to.deep.equal(&#123;  type: &#39;INCREMENT&#39;,  payload: error,  error: true,&#125;)`&lt;/pre&gt;`createAction` also return its `type` when used as type in `handleAction` or `handleActions`### Example&lt;pre&gt;`const increment = createAction(&#39;INCREMENT&#39;)// as parameter in handleAction:handleAction(increment, &#123;  next(state, action)&#123;...&#125;,  throw(state, action) &#123;...&#125;,&#125;);const reducer = handleActions(&#123;  [increment]: (state, action) =&amp;gt; (&#123;    counter: state.counter + action.payload  &#125;)&#125;)`&lt;/pre&gt;### createActions(?actionsMap, ?...identityActions)&lt;pre&gt;`import &#123; createActions &#125; from from &#39;redux-actions&#39;`&lt;/pre&gt;Returns an object mapping action types to action creator. The keys of this object are camel-cased from the keys in `actionsMap` and the string literals of `identityActions` the values are the action creators.### combineActions(...actionTypes)Combine any number of action types or action creators, `actionTypes` is a list of positional arguments which can be action type strings, symbols, or action creators.This allows you to reduce multiple distinct actions with the same reducers.&lt;pre&gt;`const &#123; increment, decrement &#125; = createActions(&#123;  INCREMENT: amount =&amp;gt; (&#123;amount&#125;),  DECREMENT: amount =&amp;gt; (&#123;amount: -amount&#125;),&#125;)const reducer = handleAction(combineActions(increment, decrement), &#123;  next: (state, &#123; payload: &#123; amount &#125;&#125;) =&amp;gt; (&#123; ...state, counter: state.counter + amount&#125;),  throw: state =&amp;gt; (&#123; ...state, counter: 0&#125;),&#125;, &#123; counter: 10 &#125;)expect(reducer(undefined, increment(1)).to.deep.equal(&#123; counter: 11 &#125;))expect(reducer(undefined, decrement(1)).to.deep.equal(&#123; counter: 9 &#125;))expect(reducer(undefined, increment(new Error)).to.deep.equal(&#123; counter: 0 &#125;))expect(reducer(undefined, decrement(new Error)).to.deep.equal(&#123; counter: 0 &#125;))</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> Redux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Flux Standard Action</title>
      <link href="/2016/11/06/flux-standard-action/"/>
      <url>/2016/11/06/flux-standard-action/</url>
      
        <content type="html"><![CDATA[<h3 id="Example"><a href="#Example" class="headerlink" title="Example:"></a>Example:</h3><ol><li><p>A basic Flux Standard Action</p><p>{<br>type: ‘ADD_TODO’,<br>payload: {<br>text: ‘Do something’,<br>}<br>}<br>`</pre></p><p>An FSA that represents an error, analogous to a rejected Promise:</p><pre>`{  type: 'ADD_TODO',  payload: new Error(),  error: true,}</li></ol><p>Notice:<br>1. An action MUST</p><ul><li>be a plain JavaScript Object</li><li>have a <code>type</code> property</li></ul><ol><li>An action MAY:</li></ol><ul><li>have a <code>error</code> property</li><li>have a <code>payload</code> property</li><li>have a <code>meta</code> property</li></ul><ol><li>An action MUST NOT include properties other than <code>type</code>, <code>payload</code>, <code>error</code>, <code>meta</code></li></ol><h3 id="Type"><a href="#Type" class="headerlink" title="Type"></a>Type</h3><p>The <code>type</code> of an action identifies to the consumer the nature of the action that has occurred. Two actions with same <code>type</code> MUST be strictly equivalent (using ===). By convention, <code>type</code> is usually string constant or a Symbol.</p><h3 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h3><p>The optional <code>payload</code> property MAY be any type of value. It represents the payload of the action. Any information about the action that is not the <code>type</code> or status of the action should be part of the <code>payload</code> filed.</p><p>By convention, if <code>error</code> is <code>true</code>, the <code>payload</code> SHOULD be an error object. This is akin to rejecting a promise with an error object.</p><h3 id="error"><a href="#error" class="headerlink" title="error"></a>error</h3><p>The optional <code>error</code> property MAY be set to <code>true</code> if the action represents an error.</p><p>An action whose <code>error</code> is true is analogous to a rejected Promise. By convention the <code>payload</code> SHOULD be an error object.</p><p>If <code>error</code> has any other value besides <code>true</code>, including <code>undefined</code> and <code>null</code>, the action MUST NOT be interpreted as an error.</p><h3 id="meta"><a href="#meta" class="headerlink" title="meta"></a>meta</h3><p>The optional <code>meta</code> property MAY be any type of value. It is intended for any extra information that is not part of the payload.</p>]]></content>
      
      
      
        <tags>
            
            <tag> Redux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Promise 基本点</title>
      <link href="/2016/10/09/promise-e5-9f-ba-e6-9c-ac-e7-82-b9/"/>
      <url>/2016/10/09/promise-e5-9f-ba-e6-9c-ac-e7-82-b9/</url>
      
        <content type="html"><![CDATA[<h3 id="Promise-基本用法"><a href="#Promise-基本用法" class="headerlink" title="Promise 基本用法"></a>Promise 基本用法</h3><p>创建 Promise</p><pre><code>var promise = new Promise(function(resolve, reject)&#123;  // do something async  if(/* everything ok */)&#123;    resolve(&quot;OK&quot;); // it will return Promise.resolve(&quot;OK&quot;), and the downstream will get &quot;OK&quot; as params  &#125; else &#123;    reject(Error(&quot;Error&quot;)); // it will return Error(&quot;Error&quot;) and the downstream will get Error(&quot;Error&quot;) as params  &#125;&#125;)`&lt;/pre&gt;Promise 构造器接受一个函数作为参数, 传入两个回调函数resolve 和 reject, 在这个函数参数中做一些一步操作, 成功后调用 resolve 将 Promise 对象的状态设置为 resolved 并返回一个 Promise 对象用于链式调用, 失败后调用 reject 将 Promise 对象的状态设置为 rejected 并返回一个 Promise 对象用于链式调用使用时:&lt;pre&gt;`promise.then(function(result)&#123;&#125;).catch(function(err)&#123;&#125;)</code></pre><h3 id="Promise-API-Reference"><a href="#Promise-API-Reference" class="headerlink" title="Promise API Reference"></a>Promise API Reference</h3><p>静态方法:</p><ul><li><p><code>Promise.resolve(promise)</code>, 返回一个 Promise</p></li><li><p><code>Promise.resolve(thenable)</code>, 从 thenable 对象创建一个新的 Promise, 一个 thenable (类 Promise) 对象是一个带有” then” 方法的对象.</p></li><li><p><code>Promise.resolve(obj)</code>, 创建一个以 obj 为肯定结果的 Promise</p></li><li><p><code>Promise.reject(obj)</code>, 创建一个以 obj 为否定结果的 Promise, 为了一致性和调试方便, obj 应该是一个 Error 实例对象.</p></li><li><p><code>Promise.all(array)</code>, 创建一个 Promise, 当且仅当数组中的所有 Promise 都 resolved 之后才设为 resolved, 若其中存在 rejected, 则设置状态为 rejected</p></li><li><p><code>Promise.race(array)</code>, 创建一个 Promise, 当数组首先出现 resovled 或 rejected 的时候设置为同状态</p></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript 事件与性能</title>
      <link href="/2016/09/27/javascript-e4-ba-8b-e4-bb-b6-e4-b8-8e-e6-80-a7-e8-83-bd/"/>
      <url>/2016/09/27/javascript-e4-ba-8b-e4-bb-b6-e4-b8-8e-e6-80-a7-e8-83-bd/</url>
      
        <content type="html"><![CDATA[<p>事件处理程序本质上是一种函数, 是一种对象, 存放在内存中, 设置大量的事件处理程序会使内存中的对象变多, Web 程序的性能会变得越来越差.</p><p>为了更好利用事件处理程序, 出现了<strong>事件委托</strong>, 用来提升性能</p><h3 id="事件委托"><a href="#事件委托" class="headerlink" title="事件委托"></a>事件委托</h3><p>Event Delegate: 把若干个子节点上的相同事件的处理函数绑定到父节点, 从父节点统一处理子节点冒泡上来的事件, 这种技术叫做事件委托.</p><p>举例:</p><pre><code>&amp;lt;ul id=&#39;parent-list&#39;&amp;gt;    &amp;lt;li id=&#39;list-1&#39;&amp;gt;List 1&amp;lt;/li&amp;gt;    &amp;lt;li id=&#39;list-1&#39;&amp;gt;List 1&amp;lt;/li&amp;gt;    &amp;lt;li id=&#39;list-1&#39;&amp;gt;List 1&amp;lt;/li&amp;gt;    &amp;lt;li id=&#39;list-1&#39;&amp;gt;List 1&amp;lt;/li&amp;gt;&amp;lt;/ul&amp;gt;`&lt;/pre&gt;通过父节点监听冒泡事件可以处理子节点上的对应事件&lt;pre&gt;`var parentList = document.getElementById(&#39;parent-list&#39;);parentList.addEventListener(&#39;click&#39;, function()&#123;  var target = event.target; // li  if(target.nodeName.toLowerCase() === &#39;li&#39;)&#123;    alert(target.firstChild.nodeValue);  &#125;&#125;, false)</code></pre><p>因为事件委托依赖事件冒泡机制, 所以并不是所有事件都可以委托</p><p>最适合的事件: click, mousedown, mouseup, keydown, keyup, keypress</p><h3 id="移除事件处理程序"><a href="#移除事件处理程序" class="headerlink" title="移除事件处理程序"></a>移除事件处理程序</h3><p>每当将事件处理程序制定给元素时, 运行中的浏览器代码与支持页面交互的 Js 代码之间就会建立一个连接, 这种连接越多, 页面执行越慢</p><p>如果使用完后不再使用的事件处理程序, 应当释放掉</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;button id &#x3D; &#39;button&#39;&gt;Submit&lt;&#x2F;button&gt;</span><br><span class="line">var button &#x3D; document.getElementById(&#39;button&#39;);</span><br><span class="line">button.onclick &#x3D; function()&#123;</span><br><span class="line">  button.onclick &#x3D; null;</span><br><span class="line">  event.target.firstChild.nodeValue &#x3D; &quot;Submitting&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript 停止冒泡和阻止浏览器默认行为</title>
      <link href="/2016/09/27/javascript-e5-81-9c-e6-ad-a2-e5-86-92-e6-b3-a1-e5-92-8c-e9-98-bb-e6-ad-a2-e6-b5-8f-e8-a7-88-e5-99-a8-e9-bb-98-e8-ae-a4-e8-a1-8c-e4-b8-ba/"/>
      <url>/2016/09/27/javascript-e5-81-9c-e6-ad-a2-e5-86-92-e6-b3-a1-e5-92-8c-e9-98-bb-e6-ad-a2-e6-b5-8f-e8-a7-88-e5-99-a8-e9-bb-98-e8-ae-a4-e8-a1-8c-e4-b8-ba/</url>
      
        <content type="html"><![CDATA[<h3 id="事件兼容"><a href="#事件兼容" class="headerlink" title="事件兼容"></a>事件兼容</h3><pre><code>function myFn(e)&#123;  var evt = e ? e:window.event&#125;`&lt;/pre&gt;### JS 停止冒泡&lt;pre&gt;`function myFn(e)&#123;  window.event ? window.event.cancelBubble = true : e.stopPropagation();&#125;`&lt;/pre&gt;### JS 阻止默认行为&lt;pre&gt;`function myFn(e)&#123;  window.event ? window.event.returnValue = false : e.preventDefault();&#125;</code></pre><h3 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h3><p>event 表示事件的状态, 例如, event.target 是触发事件的对象</p>]]></content>
      
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Koa-Router</title>
      <link href="/2016/09/19/koa-router/"/>
      <url>/2016/09/19/koa-router/</url>
      
        <content type="html"><![CDATA[<ul><li>Express 式路由使用<code>app.get</code>, <code>app.put</code>, <code>app.post</code> 等</li><li>Named URL parameters and regexp captures</li><li>String or regular expression route matching</li><li>Named Routes with URL generation</li><li>Responds to <code>OPTIONS</code> request with allowed methods</li><li>Support for <code>405 Method Not Allowed</code> and <code>501 Not Implemented</code></li><li>Multiple route middleware</li><li>Multiple routers</li></ul><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><pre><code>npm install koa-router`&lt;/pre&gt;### 使用&lt;pre&gt;`var koa = require(&quot;koa&quot;),    router = require(&quot;koa-router&quot;),    app = koa();app.use(router(app))`&lt;/pre&gt;After the router has been initialized you can register routes:&lt;pre&gt;`app.get(&quot;/users/:id&quot;, function*(next)&#123;  var user = yield User.findOne(this.params.id);  this.body = user;&#125;);`&lt;/pre&gt;### 多路由You can use multiple routers and sets of routes by omitting the `app` argument. For example, separate routes for two versions of an API:&lt;pre&gt;`var koa = require(&quot;koa&quot;),    mount = require(&quot;mount&quot;),    Router = require(&quot;koa-router&quot;);var app = koa();var APIv1 = new Router();var APIv2 = new Router();APIv1.get(&quot;/sign-in&quot;, function*()&#123;  // ...&#125;)APIv2.get(&quot;/sign-in&quot;, function*()&#123;  // ...&#125;)app.use(mount(&quot;/v1&quot;, APIv1.middleware())).use(mount(&quot;/v2&quot;, APIv2.middleware()));`&lt;/pre&gt;### 链The http methods(get, post, etc) return their `Router` instance, so routes can be chained as you&#39;re used to with express:&lt;pre&gt;`var api = new Router();api.get(&quot;/foo&quot;, showFoo).get(&quot;/bar&quot;, showBar).post(&quot;/foo&quot;, createFoo)</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>编写 Koa 中间件</title>
      <link href="/2016/09/19/e7-bc-96-e5-86-99-koa-e4-b8-ad-e9-97-b4-e4-bb-b6/"/>
      <url>/2016/09/19/e7-bc-96-e5-86-99-koa-e4-b8-ad-e9-97-b4-e4-bb-b6/</url>
      
        <content type="html"><![CDATA[<p>Koa middlewares are simple function which return a <code>GeneratorFunction</code>, and accept another (middleware). When the middleware is run by an “upstream” middleware, it must manually <code>yield</code> to the “downstream” middleware.</p><p>For example if you wanted to track how long it takes for a request to propagate through Koa by adding an <code>x-Response-Time</code> header field the middleware would look like the following:</p><pre><code>function *responseTime(next)&#123;  var start = new Date;  yield next;  var ms = new Date - start;  this.set(&quot;X-Response-Time&quot;, ms+&quot;ms&quot;);&#125;app.use(responseTime);`&lt;/pre&gt;Here is another way to write the same thing, inline:&lt;pre&gt;`app.use(function *(next)&#123;  var start = new Date;  yield next;  var ms = new Date - start;  this.set(&quot;X-Response-Time&quot;, ms+&quot;ms&quot;);&#125;);`&lt;/pre&gt;### 中间件最佳实践Imcluding Middleware accepting options, named middleware for debugging, among others#### 中间件选项When creating public middleware it&#39;s useful to conform to the convention of wrapping the middleware in a function that accepts options, allowing users to extend functionality. Even if your middleware accepts no options, this is still a good idea to keep things uniform.Here our contrived `logger` middleware accepts a `format` string for customization, and returns the middleware itself:&lt;pre&gt;`function logger(format)&#123;  format = format || &quot;:method\&quot;:url\&quot;&quot;;  return function*(next)&#123;    var str = format.replace(&quot;:method&quot;, this.method).replace(&quot;:url&quot;, this.url);    console.log(str);    yield next;  &#125;&#125;`&lt;/pre&gt;app.use(logger());app.use(logger(&quot;:method:url&quot;))&lt;pre&gt;`### 命名中间件Naming middlewares is optional, however it&#39;s useful for debugging purpose to assign a name`&lt;/pre&gt;function logger(format)&#123;  return function *logger(next)&#123;    // ...  &#125;&#125;&lt;pre&gt;`### 结合多个中间件Sometimes you want to &quot;compose&quot; multiple middleware into a single middleware for easy re-use or exporting. To do so, you may chain them together with `.call(this, next)`, then return another function that yields the chain</code></pre><p>function _random(next) {<br>if (‘/random’ == this.path) {<br>this.body = Math.floor(Math.random()_10);<br>} else {<br>yield next;<br>}<br>};</p><p>function *backwards(next) {<br>if (‘/backwards’ == this.path) {<br>this.body = ‘sdrawkcab’;<br>} else {<br>yield next;<br>}<br>}</p><p>function *pi(next) {<br>if (‘/pi’ == this.path) {<br>this.body = String(Math.PI);<br>} else {<br>yield next;<br>}<br>}</p><p>function *all(next) {<br>yield random.call(this, backwards.call(this, pi.call(this, next)));<br>}</p><p>app.use(all);</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Koa 使用</title>
      <link href="/2016/09/19/koa-e4-bd-bf-e7-94-a8/"/>
      <url>/2016/09/19/koa-e4-bd-bf-e7-94-a8/</url>
      
        <content type="html"><![CDATA[<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>Koa 当前需要 node 0.11.x 并开启 –harmony(或– harmony-generators), 因为他依赖于 ES6 的 generator 特性<br><code>node --harmony my-koa-app.js</code></p><h3 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h3><p>Koa 应用是一个包含中间件 generator 方法数组的对象. 当请求到来时, 这些方法会以 stack-slice 的顺序执行.</p><p>Koa 的一大设计理念是, 通过其他底层中间件层提供高级”语法糖”, 而不是 Koa, 大大提高了框架的互操作性和健壮性, 并让中间件开发变得有趣.</p><p>简单例子</p><pre><code>var koa = require(&quot;koa&quot;);var app = koa();app.use(function*()&#123;  this.body = &quot;Hello World&quot;;&#125;);app.listen(3000);`&lt;/pre&gt;**注**: 与普通 function 不同, generator function 以 function* 的形式声明.### 编写级联代码koa 中间件以一种更加传统的方式级联.以往的 Node 开发中, 级联是通过回调实现的, 用户友好度上有欠缺Koa 借助 generator 实现了中间件架构Koa 的执行代码的形式不再是简单的将控制权依次移交给一个又一个方法直到结束, 而是像一个回形针, 用户请求中间件, 遇到 yield next 关键字的时候, 会被传递给下游中间件(downstream), 在 yield next 捕获不到 downstream 的时候, 逆序返回执行代码(upstream)(yield next 后面的代码)&lt;pre&gt;`var koa = require(&quot;koa&quot;);var app = koa();// x-response-timeapp.use(function* (next)&#123;  var start = new Date;  yield next;  var ms = new Date - start;  this.set(&quot;X-Response-Time&quot;, ms+&quot;ms&quot;);&#125;)// loggerapp.use(function* (next)&#123;  var start = new Date;  yield next;  var ms = new Date - start;  console.log(&quot;%s %s - %s&quot;, this.method, this.url, ms)&#125;);// responseapp.use(function* ()&#123;  this.body = &quot;Hello World&quot;;&#125;);app.listen(3000);`&lt;/pre&gt;### 应用配置应用配置是 app 实例的属性, 目前支持以下配置:- app.name 应用名- app.env 执行环境, 默认是`NODE_ENV`或者`development`字符串- app.proxy, 当该属性为 true 时, `proxy header` 参数会被添加到信任列表中### app.listen(...)一个 Koa 应用跟 HTTP Server 不是1-to-1关系, 一个或多个 Koa应用可以被加载到一块, 组成一个更大的包含一个 HTTP server 的应用该方法创建并返回一个 http server, 并支持传递固定参数&lt;pre&gt;`var koa = require(&quot;koa&quot;)var app = koa()app.listen(3000)`&lt;/pre&gt;方法 app.listen(...)是一个语法糖, 等价于&lt;pre&gt;`var http = require(&quot;http&quot;)var koa = require(&quot;koa&quot;)var app = koa()http.createServer(app.callback()).listen(3000)`&lt;/pre&gt;这意味着可以在多个端口使用同一个 app&lt;pre&gt;`http.createServer(app.callback()).listen(3000)http.createServer(app.callback()).listen(3001)`&lt;/pre&gt;### app.callback()返回一个回调方法能用于 http.createServer()来处理请求, 也可以将这个回调函数挂载到 Connect/Express 应用上### app.use(function)将给定的 function 当做中间件加载到应用中### app.keys=设置 Cookie 签名密钥### 错误处理除非应用执行环境(NODE_ENV)被配置为&quot;test&quot;, Koa 都会将所有错误信息输出到 stderr, 如果想自定义错误处理逻辑, 可以定义一个&quot;错误事件&quot;来坚挺 Koa App 中的错误:&lt;pre&gt;`app.on(&quot;error&quot;,function(err)&#123;  log.error(&quot;server error&quot;, err);&#125;)`&lt;/pre&gt;当 req/res 周期中出现任何错误且无法响应客户端时, koa 会把 Context(上下文)实例作为第二个参数传递给 error 事件:&lt;pre&gt;`app.on(&quot;error&quot;, function(err, ctx)&#123;  log.error(&quot;server error&quot;, err, ctx)&#125;)`&lt;/pre&gt;### 上下文Koa 的 Context 把 node 的 request 和 response 对象封装在一个单独对象, 并提供许多开发 web 应用和 APIs 有用的方法. 那些 HTTP Server 开发中使用非常频繁操作, 直接在 Koa 里实现, 而不是放在更高层次的框架, 这样中间件就不需要重复实现这些通用的功能.每个请求会创建自己的 Context 实例, 在中间件中作为 receiver 引用, 或通过 this 标示引用:&lt;pre&gt;`app.use(function* ()&#123;  this; // is the Context  this.request; // is a koa Request  this.response; // is a koa Response&#125;)</code></pre><p>Context 的许多访问器和方法直接委托为他们的 ctx.request 或 ctx.response 的等价方法, 用于访问方便, 是完全相同的, 比如 ctx.type 和 ctx.length 委托与 response 对象, ctx.path 和 ctx.method 委托与 request.</p><h3 id="请求"><a href="#请求" class="headerlink" title="请求"></a>请求</h3><p>Koa Request 对象是 node 普通 request 对象之上的抽象, 提供了日常 Http Server 中更多有用的功能</p><h4 id="API"><a href="#API" class="headerlink" title="API"></a>API</h4><ul><li>request.header</li><li>request.headers: req.header 的别名</li><li>request.method: 请求方法</li><li>request.method=: 设置请求方法, 实现中间件的时候非常有用</li><li>request.length: 将请求的 Content-length 返回为数字, 或 undefined</li><li>request.url: 获取请求 URL</li><li>request.url=: 设置请求 URL<br>…</li></ul><h3 id="响应"><a href="#响应" class="headerlink" title="响应"></a>响应</h3><p>Koa Response 对象是 node 普通 response 对象之上的抽象, 提供了日常 Http Server 中有用的功能</p><h4 id="API-1"><a href="#API-1" class="headerlink" title="API"></a>API</h4><p>….</p>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>XTemplate 模板语法</title>
      <link href="/2016/09/18/xtemplate-e6-a8-a1-e6-9d-bf-e8-af-ad-e6-b3-95/"/>
      <url>/2016/09/18/xtemplate-e6-a8-a1-e6-9d-bf-e8-af-ad-e6-b3-95/</url>
      
        <content type="html"><![CDATA[<h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><p>变量会从当前模板的上下文查找值, 如果要输出一个变量的值, 可以使用</p><pre><code>&#123;&#123; variable &#125;&#125;`&lt;/pre&gt;这样模板引擎会从上下文寻找变量`variable`并打印出来. 变量可以使用`.`访问其属性, 和 js 一样也可以通过`[]`访问属性&lt;pre&gt;`&#123;&#123; user.name &#125;&#125;&#123;&#123; user['name'] &#125;&#125;`&lt;/pre&gt;如果一个变量的值是`undefined`或`null`, 那么什么也不会输出, 也不会报错.### 支持的数据类型XTemplate 支持 js 中所有基本数据类型- Boolean- Number- String- Null- Undefined- Object- Array### 输出使用`&#123;&#123; foo &#125;&#125;`来输出`escape`之后的数据, `&#123;&#123;&#123; foo &#125;&#125;&#125;`来输出`unescape`的原始数据&lt;pre&gt;`escaped: &#123;&#123; foo &#125;&#125;unescaped: &#123;&#123;&#123; foo &#125;&#125;&#125;`&lt;/pre&gt;如果希望输出最原始数据(包括`&#123;&#123;&#125;&#125;`), 那么需要使用`&#123;&#123;% %&#125;&#125;`语法&lt;pre&gt;`&#123;&#123;%      &#123;&#123; x &#125;&#125;%&#125;&#125;`&lt;/pre&gt;渲染这个模板, 会输出&lt;pre&gt;`&#123;&#123; x &#125;&#125;`&lt;/pre&gt;#### 添加注释&lt;pre&gt;`&#123;&#123;! comment &#125;&#125;`&lt;/pre&gt;#### 添加空格`&#123;&#123;~`删除空格前缀    `~&#125;&#125;`删除空格后缀### 作用域每一个模板都有一个独立的作用于, 在字幕版中可以访问父模板的上下文, 但是字幕版中定义或者修改变量不会影响到父模板的变量&lt;pre&gt;`// parent.xtpl&#123;&#123; set (a=1,b=2) &#125;&#125;&#123;&#123; include ('sub.xtpl') &#125;&#125;in parent:a = &#123;&#123; a &#125;&#125;b = &#123;&#123; b &#125;&#125;`&lt;/pre&gt;&lt;pre&gt;`// sub.xtplin sub:&#123;&#123; set b = 3 &#125;&#125;a = &#123;&#123; a &#125;&#125;b = &#123;&#123; b &#125;&#125;`&lt;/pre&gt;渲染 parent.xtpl 得到&lt;pre&gt;`in sub:a: 1b: 3in parent:a: 1b: 2`&lt;/pre&gt;### 根数据通过`root.foo` 可以访问到渲染的根数据, 即调用`render`方法时传入的数据用数据`&#123; name: &#39;foo&#39;, array: [&#123;name:&#39;bar&#39;&#125;] &#125;`渲染下面模板:&lt;pre&gt;`&#123;&#123; #each(arr) &#125;&#125;&#123;&#123;root.name&#125;&#125; &#123;&#123;name&#125;&#125;&#123;&#123;/each&#125;&#125;`&lt;/pre&gt;得到&lt;pre&gt;`foo bar`&lt;/pre&gt;## 方法和逻辑可以使用变量上 js 提供的方法:&lt;pre&gt;`var x = [1,2,3]`&lt;/pre&gt;&lt;pre&gt;`&#123;&#123;#each(x.slice(1))&#125;&#125;&#123;&#123;this&#125;&#125; &#123;&#123;/each&#125;&#125; // =&amp;gt; 2 3`&lt;/pre&gt;### 操作符XTemplate 支持在数据上使用一些操作符:&lt;pre&gt;`+, -, *, /, %`&lt;/pre&gt;&lt;pre&gt;`===, !==, &amp;gt;, &amp;gt;=, &amp;lt;, &amp;lt;=`&lt;/pre&gt;&lt;pre&gt;`||, &amp;amp;&amp;amp;, !`&lt;/pre&gt;&lt;pre&gt;`?:`&lt;/pre&gt;### 函数调用如果你传递 js 的方法到模板中, 那么可以使用它&lt;pre&gt;`&#123;&#123;foo(1,2,3)&#125;&#125;`&lt;/pre&gt;### 内置函数&lt;pre&gt;`range(start, end, [step])`&lt;/pre&gt;不包括 end&lt;pre&gt;`set(key = value, [key = value])`&lt;/pre&gt;`set` 用于定义或修改一个变量&lt;pre&gt;`&#123;&#123; set(x=1) &#125;&#125;&#123;&#123; set(y=3,z=2) &#125;&#125;&#123;&#123;x&#125;&#125;&#123;&#123;y+z&#125;&#125;`&lt;/pre&gt;渲染得到&lt;pre&gt;`15`&lt;/pre&gt;`void`, 允许忽略模板渲染&lt;pre&gt;`&#123;&#123; set(x=1) &#125;&#125;&#123;&#123; void(x) &#125;&#125;`&lt;/pre&gt;将渲染空## 命令命令是一些特殊的区块, 对于这些特殊的区块, XTemplate 会做特殊处理. XTemplate 自带了一些内置的命令, 也可以自定义命令`if`&lt;pre&gt;`&#123;&#123;# if(variable) &#125;&#125;  It is true&#123;&#123;/ if&#125;&#125;`&lt;/pre&gt;如果 vairable 为 true, 则渲染命令块&lt;pre&gt;`&#123;&#123;# if(variable) &#125;&#125;&#123;&#123; elseif (vairable)&#125;&#125;&#123;&#123; else &#125;&#125;&#123;&#123;/ if &#125;&#125;`with`和 js 中的`with`类似`&lt;/pre&gt;var a = &#123;  b:1&#125;```&lt;pre&gt;`&#123;&#123;&#123;#with(a)&#125;&#125;&#125;&#123;&#123;b&#125;&#125; // 1&#123;&#123;/with&#125;&#125;`&lt;/pre&gt;`each``each`可以对 array 和 dictionary 进行迭代&lt;pre&gt;`// array&#123;&#123; set (array = [&#123;      name: 'foo'    &#125;, &#123;      name: 'bar'    &#125;])&#125;&#125;&#123;&#123;#each(array)&#125;&#125;  &#123;&#123;xindex&#125;&#125; &#123;&#123;this.name&#125;&#125;&#123;&#123;/each&#125;&#125;`&lt;/pre&gt;渲染得到&lt;pre&gt;`0 foo1 bar`&lt;/pre&gt;&lt;pre&gt;`// dictionary&#123;&#123; set (dictionary = &#123;      foo:'bar',      hello:'world'    &#125;)&#125;&#125;&#123;&#123;#each(dictionary,'value','key')&#125;&#125;  &#123;&#123;key&#125;&#125;&#123;&#123;value&#125;&#125;&#123;&#123;/each&#125;&#125;`&lt;/pre&gt;渲染得到&lt;pre&gt;`foo barhello world`&lt;/pre&gt;### 访问上层变量在`with`和`each`中, 可以通过`../`访问外层的同名变量&lt;pre&gt;`// &#123;a: 1, b:[&#123;a:2&#125;]&#125;&#123;&#123;#with(x)&#125;&#125;  &#123;&#123;#each(b)&#125;&#125;    &#123;&#123;../a&#125;&#125;&#123;&#123;a&#125;&#125; // 12  &#123;&#123;/with&#125;&#125;&#123;&#123;/with&#125;&#125;`&lt;/pre&gt;### 宏宏允许你定义一个可复用的代码片段&lt;pre&gt;`&#123;&#123;#macro("test","param",default=1)&#125;&#125;  param is &#123;&#123;param&#125;&#125; &#123;&#123;default&#125;&#125;&#123;&#123;/macro&#125;&#125;`&lt;/pre&gt;现在可以调用该宏&lt;pre&gt;`&#123;&#123;macro("test", "2")&#125;&#125;&#123;&#123;macro("test","2",default=2)&#125;&#125;`&lt;/pre&gt;渲染结果&lt;pre&gt;`param is 2 1param is 2 2`&lt;/pre&gt;### include`include` 引入其他的模板, 在共享组件的时候十分有效&lt;pre&gt;`&#123;&#123; include ('item.html') &#125;&#125;`&lt;/pre&gt;如果下网引入子模板的时候可以在子模板的上下文设置其他值, 可以通过`include`后面的参数传入&lt;pre&gt;`// parent.html&#123;&#123; set(x='x',y='y') &#125;&#125;&#123;&#123; include ('sub.html', xx=x,yy=x) &#125;&#125;`&lt;/pre&gt;&lt;pre&gt;`// sub.htmlx:&#123;&#123;x&#125;&#125;y:&#123;&#123;y&#125;&#125;xx:&#123;&#123;xx&#125;&#125;yy:&#123;&#123;yy&#125;&#125;`&lt;/pre&gt;parent.html渲染结果&lt;pre&gt;`x: x // from parent.htmly: y // from parent.htmlxx: x // from sub.htmlyy: x // from sub.html`&lt;/pre&gt;### includeOnce功能和`include`一样, 区别在于对于同一个模板, 只在第一次调用的时候起作用.### parse如果希望能够让子模板拥有一个完全独立的上下文, 不需要父级作用于, 则可以使用`parse`&lt;pre&gt;`// parent.html&#123;&#123; set(x = 'x', y = 'y') &#125;&#125;&#123;&#123; parse('sub.html', xx = x, yy = x) &#125;&#125;`&lt;/pre&gt;&lt;pre&gt;`// sub.htmlx: &#123;&#123;x&#125;&#125;y: &#123;&#123;y&#125;&#125;xx: &#123;&#123;xx&#125;&#125;yy: &#123;&#123;yy&#125;&#125;`&lt;/pre&gt;parent.html渲染结果&lt;pre&gt;`x:y:xx:xyy:x`&lt;/pre&gt;## 模板继承当编写一个 template 的时候, 可以定义`blocks`, 这样在字幕版中可以重写这些 block&lt;pre&gt;`// parent.xtpl&amp;lt;!DOCTYPE html&amp;gt;&amp;lt;html&amp;gt;  &amp;lt;head&amp;gt;    &amp;lt;....&amp;gt;    &#123;&#123;&#123;block ('head')&#125;&#125;&#125;  &amp;lt;/head&amp;gt;  &amp;lt;body&amp;gt;    &#123;&#123;&#123;block ('body')&#125;&#125;&#125;  &amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;`&lt;/pre&gt;&lt;pre&gt;`// child.xtpl&#123;&#123; extend ('./parent.xtpl')&#125;&#125;&#123;&#123;#block ('head')&#125;&#125; // overwrite head block  &amp;lt;....&amp;gt;&#123;&#123;/block&#125;&#125;&#123;&#123;#block ('body')&#125;&#125; // overwrite body block  &amp;lt;...&amp;gt;&#123;&#123;/block&#125;&#125;</code></pre><p>渲染 child.xtpl 可以获得新的模板下的实例</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Flex 属性详解</title>
      <link href="/2016/09/17/flex-e5-b1-9e-e6-80-a7-e8-af-a6-e8-a7-a3/"/>
      <url>/2016/09/17/flex-e5-b1-9e-e6-80-a7-e8-af-a6-e8-a7-a3/</url>
      
        <content type="html"><![CDATA[<ol><li>display: flex|inline-flex; (修饰 Flex Container, 也就是 Flex Item 的父级元素)<br>该属性修饰的元素, 其子元素将变成 flex 文档流, 称为 Flex Item</li></ol><p><strong>注意</strong>: CSS 的 columns 在 FlexContainer 上没有作用; float, clear, vertical-align 在 FlexItem 上没有作用</p><ol><li><p>flex-direction: row|row-reverse|column|column-reverse(修饰 Flex Container)<br>用于定义 main-axis, 从而定义 flex 文档流方向</p></p></li><li><p>flex-wrap: nowrap|wrap|wrap-reverse; (修饰 Flex Container)<br>nowrap: 单行显示; wrap: 多行显示; wrap-reverse: 逆向多行显示</p></li><li><p>flex-flow: &lt;’flex-direction’&gt;||&lt;’flex-wrap’&gt;; (修饰 Flex Container)<br>这个是 flex-direction 和 flex-wrap 的缩写, 同时定义主轴和侧轴的文档流向</p></li><li><p>justify-content:flex-start|flex-end|center|space-between|space-around; (修饰 Flex Container)<br>定义主轴线上 Flex Item 的对齐方式</p></li></ol><p>flex-start: 向起始位置对齐; flex-end: 向结束位置对齐; center: 向中间靠拢; space-between: 首位 item 位于边界, 所有 items 均匀分布; space-around: 首位 item 距离边界 1space, 所有 item 之间距离 2space</p><p><img src="http://cdn.w3cplus.com/cdn/farfuture/gnLmjiUDLu3L9INIb8KPA5vE6xsQaRuSMU_UfamwmDM/mtime:1421035122/sites/default/files/styles/print_image/public/blogs/2013/flexbox-guide-2.jpg"></p><ol><li>align-item: flex-start|flex-end|center|baseline|stretch; (修饰 Flex Container)<br>定义 item 在侧轴方向的对齐方式</li></ol><p><img src="http://cdn2.w3cplus.com/cdn/farfuture/DTYyNpRoVAWKoI-BNSJ06avE6tVTibwXa3VXqoEhWbs/mtime:1421035123/sites/default/files/styles/print_image/public/blogs/2013/flexbox-guide-3.jpg"></p><ol><li>align-content: flex-start|flex-end|center|space-between|space-around|stretch(default); (修饰 Flex Container)<br>校准 item 在 container 中的对齐方式, 类似于 justify-content, 本属性在单行的容器中没有效果</li></ol><p><img src="http://cdn1.w3cplus.com/cdn/farfuture/P-M8WSERtYlnjKq2QRb-TXGdIOtTs7EIinejAJd0V0I/mtime:1421035123/sites/default/files/styles/print_image/public/blogs/2013/flexbox-guide-4.jpg"></p><ol><li><p>order: <integer>; (修饰 Flex Item)手动指定显示顺序</li><li><p>flex-grow: <number>; (修饰 Flex Item)<br>定义 Item 的扩张能力, 接受一个不带单位的值作为一个比例, 主要用来决 Item 对 Container 剩余空间的利用</p></li><li><p>flex-shrink: <number>; (修饰 Flex Item)<br>定义 Item 的收缩能力</p></li><li><p>flex-basis: <Length>|auto(default); (修饰 Flex Item)<br>设置伸缩基准, 剩余的空间按照比例伸缩</p></li><li><p>flex: none|[&lt;’flex-grow’&gt;&lt;’flex-shrink’&gt;? || &lt;’flex-basis’&gt;]; (修饰 Flex Item)<br>flex-grow, flex-shrink, flex-basis 的缩写; 其中, 第二个和第三个参数是可选参数. 默认值是<code>0 1 auto</code></p></li><li><p>align-self: auto|flex-start|flex-end|center|baseline|stretch; (修饰 Flex Item)<br>用于覆盖单个 Item 的对齐方式.</p></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>React-Native Basic Component</title>
      <link href="/2016/09/16/react-native-basic-component/"/>
      <url>/2016/09/16/react-native-basic-component/</url>
      
        <content type="html"><![CDATA[<h3 id="Text"><a href="#Text" class="headerlink" title="Text"></a>Text</h3><pre><code>import React, &#123; Component &#125; from &#39;react&#39;import &#123; AppRegistry, Text &#125; from &#39;react-native&#39; const App = () =&amp;gt; &amp;lt;Text&amp;gt;Hello World&amp;lt;/Text&amp;gt; AppRegistry.registerComponent(&quot;Project&quot;, () =&amp;gt; App) <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### Image</span><br></pre></td></tr></table></figure>import React, &#123; Component &#125; from &#39;react&#39;import &#123; AppRegistry, Image &#125; from &#39;react-native&#39;const App = () =&amp;gt; &amp;lt;Image source = &#123;require(&#39;./img/sample.png&#39;)&#125; /&amp;gt;AppRegistry.registerComponent(&quot;Project&quot;, () =&amp;gt; App) <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### View</span><br></pre></td></tr></table></figure>import React, &#123; Component &#125; from &#39;react&#39;import &#123; AppRegistry, Text, View &#125; from &#39;react-native&#39;const App = () =&amp;gt; (  &amp;lt;View style=&#123;&#123;alignItems: 'center'&#125;&#125; &amp;gt;    &amp;lt;Text&amp;gt;Hello World&amp;lt;/Text&amp;gt;  &amp;lt;/View&amp;gt;)AppRegistry.registerComponent(&quot;Project&quot;, () =&amp;gt; App)`&lt;/pre&gt;### TextInput&lt;pre&gt;`import React from &#39;react&#39;import &#123; AppRegistry, TextInput, View &#125; from &#39;react-native&#39;const App = () =&amp;gt; (  &amp;lt;View&amp;gt;    &amp;lt;TextInput placeholder = &quot;Hello&quot; /&amp;gt;  &amp;lt;/View&amp;gt;)AppRegistry.registerComponent(&#39;Project&#39;, () =&amp;gt; App)`&lt;/pre&gt;### ListView&lt;pre&gt;`import React, &#123; Component &#125; from &#39;react&#39;import &#123; AppRegistry, Text, View, ListView &#125; from &#39;react-native&#39;class SimpleList extends Component &#123;  constructor()&#123;    super(props)    var ds = new ListView.DataSource(&#123;      rowHasChanged: (r1,r2) =&amp;gt; r1!==r2    &#125;)    this.state = &#123;      dataSource: ds.cloneWithRows([&#39;john&#39;, &#39;joel&#39;,&#39;james&#39;,&#39;jimmy&#39;,&#39;jackson&#39;])    &#125;  &#125;  render()&#123;    return (      &amp;lt;View&amp;gt;        &amp;lt;ListView dataSource=&#123;this.state.dataSource&#125; renderRow=&#123;(rowData) =&amp;gt; &amp;lt;Text&amp;gt;&#123;rowData&#125;&amp;lt;/Text&amp;gt;&#125;      &amp;lt;/View&amp;gt;    )  &#125;&#125;AppRegistry.registerComponent(&quot;Project&quot;, () =&amp;gt; SimpleList)</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> React Native </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>理解 RESTFul 架构</title>
      <link href="/2016/09/16/e7-90-86-e8-a7-a3-restful-e6-9e-b6-e6-9e-84/"/>
      <url>/2016/09/16/e7-90-86-e8-a7-a3-restful-e6-9e-b6-e6-9e-84/</url>
      
        <content type="html"><![CDATA[<p>REST 全称 Representational State Transfer(表述性状态转移), 十一组架构约束条件和原则. 如果一个架构符合 REST 的约束条件, 那么可以称为 RESTFul 架构</p><p>要理解 REST 原则, 就要从资源的定义, 获取, 表述, 关联, 状态变迁等角度入手</p><ul><li>资源与 URI</li><li>统一资源接口</li><li>资源的表述</li><li>资源的链接</li><li>状态的转移</li></ul><h3 id="资源与-URI"><a href="#资源与-URI" class="headerlink" title="资源与 URI"></a>资源与 URI</h3><p>任何事物, 只要有被引用到的必要, 他就是一个资源.</p><p>要让一个资源可以被识别, 需要添加一个唯一标识, 在 Web 中这个唯一标识就是 URI(Uniform Resource Identifier).</p><p>URI 既可以看成资源的地址, 也可以看成资源的名称.</p><p>如果一些信息没有使用 URI 来标识, 说明他不是一个资源</p><p>URI 的设计应该遵循可寻址原则, 具有自描述性, 需要在形式上给人以直觉上的关联</p><h4 id="URI-设计上的一些技巧"><a href="#URI-设计上的一些技巧" class="headerlink" title="URI 设计上的一些技巧"></a>URI 设计上的一些技巧</h4><ol><li>使用 <code>_</code> 或 <code>-</code> 提高 URI 的可读性</li><li>使用 <code>/</code> 表示资源的层级关系</li><li>使用 <code>?</code> 过滤资源</li></ol><h4 id="统一资源接口"><a href="#统一资源接口" class="headerlink" title="统一资源接口"></a>统一资源接口</h4><p>RESTFul 结构应该遵循统一接口原则, 统一接口包含了一组受限的预定义操作, 不论什么样的资源, 都是通过使用相同接口进行资源访问. 接口应该使用标准 HTTP 方法如 GET, PUT, POST, 并遵循这些方法的语义</p><ul><li>POST 和 PUT 用于创建资源时的区别: 所创建的资源的 URI 是否由客户端决定.</li></ul><h3 id="资源的表述"><a href="#资源的表述" class="headerlink" title="资源的表述"></a>资源的表述</h3><p>客户端通过 HTTP 方法获取资源的表述, 而不是资源本身.</p><p>所谓资源的表述, 即是资源的展现, 而非其本质. 以文本为例, 可以通过 JSON, STRING 等形式表述出来, 而通过客户端获取的即是 JSON 形式的表述, 或 STRING 形式的表述.</p><p>客户端通过 HTTP 内容协商, 即 Accept 头请求一种特定个事的表述, 服务器则通过 Content-Type 通知客户端资源的表述形式</p><h3 id="资源的连接"><a href="#资源的连接" class="headerlink" title="资源的连接"></a>资源的连接</h3><p>REST 使用 HTTP 方法操作资源, 在表述格式中添加链接来引导客户端, 这种具有连接的特性称为连通</p><h3 id="状态的转移"><a href="#状态的转移" class="headerlink" title="状态的转移"></a>状态的转移</h3><p>无状态通信原则: 服务端不应该保存客户端的状态</p><h4 id="应用状态与资源状态"><a href="#应用状态与资源状态" class="headerlink" title="应用状态与资源状态"></a>应用状态与资源状态</h4><p>应该区分应用状态和资源状态, 客户端负责维护应用状态, 服务端维护资源状态. 客户端与服务端的交互应当是无状态的, 并且在每一次请求中包含处理该请求所需要的一切信息. 服务端不需要在请求间保留应用状态, 只有在接收到实际请求的时候, 服务端才会关注应用状态. 这种无状态通信原则, 使得服务端和中介能够理解独立的请求和相应. 多次请求中, 同一客户端也不再需要依赖同一服务器, 方便实现高可扩展和高可用性的服务端.</p><h4 id="应用状态的转移"><a href="#应用状态的转移" class="headerlink" title="应用状态的转移"></a>应用状态的转移</h4><p>“会话状态”不是作为资源状态被保存在服务端, 而是被客户端做为应用状态进行跟踪. 客户端应用状态在服务端提供的超媒体的指引下发生变迁, 服务端通过超媒体告诉客户端当前状态有哪些后续状态可以进入. 类似于网页中的’下一些’的连接.</p>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>移动端 Border-Radius 溢出处理</title>
      <link href="/2016/09/08/e7-a7-bb-e5-8a-a8-e7-ab-af-border-radius-e6-ba-a2-e5-87-ba-e5-a4-84-e7-90-86/"/>
      <url>/2016/09/08/e7-a7-bb-e5-8a-a8-e7-ab-af-border-radius-e6-ba-a2-e5-87-ba-e5-a4-84-e7-90-86/</url>
      
        <content type="html"><![CDATA[<p>问题 1: 部分机型下, 设置 border-radius 以及 overflow:hidden 会造成背景颜色溢出</p><p>解决: background-clip: padding-box</p><p>原理: background-clip 是颜色颜色显示区域, 设置为 padding-box</p><p>问题 2: transform 的子元素在父元素 overflow:hidden 之后还是会溢出</p><p>解决办法: 在父元素加上一段 css</p><pre><code>-webkit-mask-image: url(&#39;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAAA1BMVEUAAACnej3aAAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==&#39;);</code></pre><p>这是一张 1px 的纯黑色图片</p><p>原理: -webkit-mask-image:url(‘’), 会在图片上添加蒙版(黑色表示将内容透明, 白色表示将内容显示, 介于中间表示半透明)</p>]]></content>
      
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>测试小技巧</title>
      <link href="/2016/09/08/e6-b5-8b-e8-af-95-e5-b0-8f-e6-8a-80-e5-b7-a7/"/>
      <url>/2016/09/08/e6-b5-8b-e8-af-95-e5-b0-8f-e6-8a-80-e5-b7-a7/</url>
      
        <content type="html"><![CDATA[<p>每一个测试都要引入 expect, 可以创建一个<code>test_helper.js</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import &#123; expect &#125; from &#39;expect&#39;</span><br><span class="line">import sinon from &#39;sinon&#39;</span><br><span class="line"></span><br><span class="line">global.expect &#x3D; expect</span><br><span class="line">global.sinon &#x3D; sinon</span><br><span class="line">&#96;然后在&#96;mocha.opt&#96;中添加&#96;</span><br><span class="line">--require .&#x2F;test&#x2F;test_helper.js</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Test </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Command Line Cheat Sheet</title>
      <link href="/2016/09/07/command-line-cheat-sheet/"/>
      <url>/2016/09/07/command-line-cheat-sheet/</url>
      
        <content type="html"><![CDATA[<h3 id="Directories"><a href="#Directories" class="headerlink" title="Directories"></a>Directories</h3><p>pwd: print working directory</p><p>cd &lt;directory&gt;: change directory to &lt;directory&gt;</p><p>cd ..: change directory to parent one</p><p>ls: list directory contents</p><p>ls -la: list detailed directory contents, including hidden files</p><p>mkdir &lt;directory&gt;: create new directory named &lt;directory&gt;</p><h3 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h3><p>cat &lt;file&gt;: output the contents of &lt;file&gt;</p><p>less &lt;file&gt;: output the contents of &lt;file&gt; using the less command(which supports paginations etc.)</p><p>head &lt;file&gt;: output the first 10 lines of &lt;file&gt;</p><p>&lt;cmd&gt; &lt;file&gt;: impose &lt;cmd&gt; on &lt;file&gt;</p><p>clear: clear the command line window</p><h3 id="Files"><a href="#Files" class="headerlink" title="Files"></a>Files</h3><p>rm &lt;file&gt;: delete &lt;file&gt;</p><p>rm -r &lt;directory&gt;: clear contents of &lt;directory&gt;</p><p>rm -f &lt;file&gt;: force-delete &lt;file&gt;</p><p>rm -rf &lt;directory&gt;: force clear &lt;directory&gt;</p><p>mv &lt;file-old&gt; &lt;file-new&gt;: rename &lt;file-old&gt;</p><p>mv &lt;file&gt; &lt;directory&gt;: move file to &lt;directory&gt;</p><p>cp &lt;file&gt; &lt;directory&gt;: copy &lt;file&gt; to &lt;directory&gt;</p><p>cp -r &lt;directory1&gt; &lt;directory2&gt;: copy whole &lt;directory1&gt; to &lt;directory2&gt;(overwrit)</p><p>touch &lt;file&gt;: Update file or create file</p><h3 id="Permissions"><a href="#Permissions" class="headerlink" title="Permissions"></a>Permissions</h3><p>chmod 755 &lt;file&gt;: change permission of &lt;file&gt; to 755</p><p>chmod -R 600 &lt;directory&gt;: change permission of &lt;directory&gt; and its content to 600</p><p>chown &lt;user&gt;:&lt;group&gt; &lt;file&gt;: Change ownership of &lt;file&gt; to &lt;user&gt; and &lt;group&gt;</p><h3 id="Search"><a href="#Search" class="headerlink" title="Search"></a>Search</h3><p>find &lt;dir&gt; -name ‘&lt;file&gt;’: find all files named &lt;file&gt; inside &lt;dir&gt;(support regex)</p><p>grep ‘&lt;text&gt;’ &lt;file&gt;: output all occurrence of &lt;text&gt; inside &lt;file&gt;(add -i for case-insensitivity)</p><p>grep -rl ‘text’ &lt;dir&gt;: search for all files container &lt;text&gt; inside &lt;dir&gt;</p><h3 id="Network"><a href="#Network" class="headerlink" title="Network"></a>Network</h3><p>ping &lt;host&gt;: ping &lt;host&gt; and display status</p><p>whois &lt;domain&gt;: output whois information for &lt;domain&gt;</p><p>curl -O &lt;url/to/file&gt;: download &lt;file&gt;(via HTTP[S] or FTP)</p><p>ssh &lt;username&gt;@&lt;host&gt;: establish an SSH connection to &lt;host&gt; with user &lt;username&gt;</p><p>scp &lt;file&gt; &lt;user&gt;@&lt;host&gt;:/remote/path: Copy &lt;file&gt; to a remote &lt;host&gt;</p><h3 id="Processes"><a href="#Processes" class="headerlink" title="Processes"></a>Processes</h3><p>ps ax: output currently running process</p><p>top: display live information about currently running processes</p><p>kill &lt;pid&gt;: Quit process with ID</p>]]></content>
      
      
      
        <tags>
            
            <tag> Bash </tag>
            
            <tag> CLI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redux-Form 的深坑...慢慢积累</title>
      <link href="/2016/09/06/redux-form-e7-9a-84-e6-b7-b1-e5-9d-91-e6-85-a2-e6-85-a2-e7-a7-af-e7-b4-af/"/>
      <url>/2016/09/06/redux-form-e7-9a-84-e6-b7-b1-e5-9d-91-e6-85-a2-e6-85-a2-e7-a7-af-e7-b4-af/</url>
      
        <content type="html"><![CDATA[<p>如果 Field 无法输入, 注意 state 是否是 immutable 的, 如果是, 则需要</p><pre><code>import &#123; Field, reduxForm &#125; from &#39;redux-form/immutable&#39;</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> Redux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>编写测试</title>
      <link href="/2016/09/05/e7-bc-96-e5-86-99-e6-b5-8b-e8-af-95/"/>
      <url>/2016/09/05/e7-bc-96-e5-86-99-e6-b5-8b-e8-af-95/</url>
      
        <content type="html"><![CDATA[<h3 id="设置"><a href="#设置" class="headerlink" title="设置"></a>设置</h3><p>使用 Mocha 作为测试引擎<br>注意因为是在 node 环境下运行, 所以不能访问 DOM</p><pre><code>npm install --save-dev mocha`&lt;/pre&gt;若想要结合 Babel 使用, 需要在 package.json 的 script 中加入一段&lt;pre&gt;`&#123;  &quot;scripts&quot;: &#123;    ...    &quot;test&quot;: &quot;mocha --compilers js:babel/register --recursive&quot;,    &quot;test:watch&quot;: &quot;npm test -- --watch&quot;  &#125;&#125;`&lt;/pre&gt;### Action CreatorsRedux 里的 action creators 会返回普通对象, 在测试 action creators 的时候我们要测试的不仅是调用了正确的action creators, 还有是否返回了正确的 action实例&lt;pre&gt;`export function addTodo(text)&#123;  return &#123;    type: &#39;ADD_TODO&#39;,    text  &#125;;&#125;`&lt;/pre&gt;可以这样测试&lt;pre&gt;`import expect form &#39;expect&#39;import * as actions from &#39;../../actions/TodoActions&#39;;import * as types from &#39;../../constants/ActionTypes&#39;;describe(&#39;actions&#39;, () =&amp;gt; &#123;  it(&#39;should create an action to add a todo&#39;, () =&amp;gt; &#123;    const text = &#39;Finish docs&#39;;    const expectedAction = &#123;      type: &#39;ADD_TODO&#39;,      text    &#125;;    expect(actions.addTodo(text)).toEqual(&#39;expectedAction&#39;);  &#125;)&#125;)`&lt;/pre&gt;### 异步 Action Creators对于使用Redux Thunk 或其他 middleware 的异步 Action Creator, 最好完全模拟 Redux Store 来测试.可以使用 applyMiddleware() 和一个 mock store, 与可以用 nock 来模拟 HTTP 请求实例:&lt;pre&gt;`function fetchTodosRequest () &#123;  return &#123;    type: FETCH_TODOS_REQUEST  &#125;&#125;function fetchTodosSuccess(body) &#123;  return &#123;    type: FETCH_TODOS_SUCCESS,    body  &#125;&#125;function fetchTodosFailure(ex) &#123;  return &#123;    type: FETCH_TODOS_FAILURE,    ex  &#125;&#125;export function fetchTodo () &#123;  return dispatch =&amp;gt; &#123;    dispatch(fetchTodosRequest())    return fetch(&#39;http://example.com/todos&#39;)      .then(res =&amp;gt; res.json())      .then(json =&amp;gt; dispatch(fetchTodosSuccess(json.body)))      .catch(ex =&amp;gt; dispatch(fetchTodosFailure(ex)))  &#125;&#125;`&lt;/pre&gt;可以这样测试&lt;pre&gt;`import expect from &#39;expect&#39;import &#123; applyMiddleware &#125; from &#39;redux&#39;import thunk from &#39;redux-thunk&#39;import * as actions from &#39;../../actions/counter&#39;import * as types from &#39;../../constants/ActionTypes&#39;import nock from &#39;nock&#39;const middleware = [thunk]/** * 使用中间件模拟 Redux Store */function mockStore = (getState, expectedActions, done)&#123;  if(!Array.isArray(expectedActions))&#123;    throw new Error(&#39;expectedActions should be an array of expected actions.&#39;)  &#125;  if( typeof done !== &#39;undefined&#39; &amp;amp;&amp;amp; typeof done !== &#39;function&#39;)&#123;    throw new Error(&#39;done should either be undefined or function&#39;)  &#125;  function mockStoreWithoutmiddleware()&#123;    return &#123;      getState()&#123;        return typeof getState === &#39;function&#39; ?        getState():        getState      &#125;,      dispatch(action)&#123;        const expectedAction = expectedActions.shift()        try &#123;          expect(action).toEqual(expectedAction)          if(done&amp;amp;&amp;amp;!expectedActions.length)&#123;            done()          &#125;          return action        &#125; catch (e) &#123;          done(e)        &#125;      &#125;    &#125;  &#125;  const mockStoreWithMiddleware = applyMiddleware(    ...middlewares  )(mockStoreWithoutMiddleware)  return mockStoreWithMiddleware()&#125;describe(&#39;async actions&#39;, () =&amp;gt; &#123;  afterEach(() =&amp;gt; &#123;    nock.clearAll()  &#125;)  it(&#39;creates FETCH_TODOS_SUCCESS when fetching todos has been done&#39;, (done) =&amp;gt; &#123;    nock(&#39;http://example.com&#39;)      .get(&#39;./todos&#39;)      .reply(200, &#123;todos: [&#39;do something&#39;]&#125;)    const expectedActions = [      &#123;type: types.FETCH_TODOS_REQUEST&#125;,      &#123;type: types.FETCH_TODOS_SUCCESS, body: &#123; todos: [&#39;do something&#39;]&#125;&#125;    ]    const store = mockStore(&#123;todos: []&#125;, expectedActions, done)    store.dispatch(actions.fetchTodos())  &#125;)&#125;)`&lt;/pre&gt;### Reducers 测试Reducer 把 action 应用到当前 state, 并返回新的 state&lt;pre&gt;`import &#123; ADD_TODO &#125; from &#39;../constants/ActionTypes&#39;;const initialState = [  &#123;    text: &#39;Use Redux&#39;,    completed: false,    id: 0  &#125;]export default function todos(state = initialState, action) &#123;  switch(action.type) &#123;    case ADD_TODO: return [      &#123;        id: state.reduce((maxID, todo) =&amp;gt; Math.max(todo.id, maxId), -1) + 1,        completed: false,        text: action.text      &#125;,      ...state    ]    default: return state  &#125;&#125;`&lt;/pre&gt;可以这样测试:&lt;pre&gt;`import expect from &#39;expect&#39;import reducer from &#39;../../reducers/todos&#39;import * as types from &#39;../../constants/ActionTypes&#39;describe(&#39;todos reducer&#39;, () =&amp;gt; &#123;  it(&#39;should return the initial state&#39;, () =&amp;gt; &#123;    expect(reducer(undefined, &#123;&#125;)).toEqual([      &#123;        text: &#39;Use Redux&#39;,        completed: false,        id: 0      &#125;    ])  &#125;)  it(&#39;should handle ADD_TODO&#39;, () =&amp;gt; &#123;    expect(      reducer([],&#123;        type: types.ADD_TODO,        text: &#39;Run the test&#39;      &#125;)    ).toEqual(      [        &#123;          text: &#39;Run the test&#39;,          completed: false,          id: 0        &#125;      ]    )    expect(      reducer([        &#123;          text: &#39;Use Redux&#39;,          completed: false,          id:0        &#125;      ], &#123;        type: types.ADD_TODO,        text: &#39;Run the test&#39;      &#125;)    ).toEqual([      &#123;        text: &#39;Run the test&#39;,        completed: false,        id: 1      &#125;,      &#123;        text: &#39;Use Redux&#39;,        completed: false,        id: 0      &#125;    ])  &#125;)&#125;)`&lt;/pre&gt;### 测试 ComponentsReact Components 的优点是, 一般都很小, 并且依赖于 props, 因此测试起来很容易.首先安装 React Test Utilities&lt;pre&gt;`npm install --save-dev react-addons-test-utils`&lt;/pre&gt;要测试 components 我们要创建一个叫`setup()` 的辅助方法, 用来把模拟过的( stubbed ) 回调函数当做 props 传入, 然后使用 React 浅渲染来渲染组建, 这样可以依据`是否调用了回调函数`的断言来写独立的测试&lt;pre&gt;`import React, &#123; PropTypes, Component &#125; from &#39;react&#39;import TodoTextInput from &#39;./TodoTextInput&#39;class Header extends Component &#123;  handleSave(text)&#123;    if(text.length !==0)&#123;      this.props.addTodo(text)    &#125;  &#125;  render()&#123;    return(      &amp;lt;header&amp;gt;        &amp;lt;h1&amp;gt;todos&amp;lt;/h1&amp;gt;        &amp;lt;TodoTextInput newTodo = &#123;true&#125; onSave =&#123;this.handleSave.bind(this)&#125; placeholder = &#39;what needs to be done?&#39; /&amp;gt;      &amp;lt;/header&amp;gt;    )  &#125;&#125;Header.propTypes = &#123;  addTodo: PropTypes.func.isRequired&#125;export default Header</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> Test </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redux-Promise</title>
      <link href="/2016/09/04/redux-promise/"/>
      <url>/2016/09/04/redux-promise/</url>
      
        <content type="html"><![CDATA[<pre><code>npm install --save redux-promise`&lt;/pre&gt;&lt;pre&gt;`import promiseMiddleWare from &#39;redux-promise&#39;`&lt;/pre&gt;The default export is a middleware function. If it receives a promise, it will dispatch the resolved value of the promise.It will not dispatch anything if the promise rejects.If it receives an Flux Standard Action whose `payload` is a promise, it will either:</code></pre><ul><li><p>dispatch a copy of the action with the resolved value of the promise, and set <code>status</code> to <code>success</code></p></li><li><p>dispatch a copy of the action with the rejected value of the promise and set the <code>status</code> to <code>error</code></p><p>The middleware returns a promise to the caller so that it can wait for the operation to finish before continuing. This is especially useful for server-side rendering. If you find that a promise is not being returned, ensure that all middleware before it in the chain is also returning its <code>next()</code> call to the caller.</p><p>Using in combination with redux-actions</p><p>Because it supports FSA actions, you can use redux-promise in combination with redux-actions</p><pre>`createAction(`FETCH_DATA`, async id =&gt; {  const result = await somePromise;  return result.someValue});</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> Redux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Usage of Redux-Action</title>
      <link href="/2016/09/04/usage-of-redux-action/"/>
      <url>/2016/09/04/usage-of-redux-action/</url>
      
        <content type="html"><![CDATA[<ol><li>createAction(type, payloadCreator = Identity, ?metaCreator): actionCreator with specified type and it will accept a payload</li></ol><p>The more correct name for this function is probably <code>createActionCreator()</code>, but it’s too redundant.</p><pre><code>createAction(&#39;ADD_TODO&#39;)(&#39;Use the Reudx&#39;);`&lt;/pre&gt;&lt;pre&gt;`import &#123; createAction &#125; from &#39;redux-action&#39;`&lt;/pre&gt;&lt;pre&gt;`const increment = createAction(&#39;INCREMENT&#39;);expect(increment(42)).to.deep.equal(&#123;  type: &#39;INCREMENT&#39;,  payload: 42&#125;);`&lt;/pre&gt;Wraps an action creator so that its return value is the payload of a Flux Standard Action. If no payload creator is passed, or if it&#39;s not a function, the identity function is used.**If the payload is an instance of an Error Object, redux-actions will automatically set `action.error` to true.**&lt;pre&gt;`const increment = createAction(&#39;INCREMENT&#39;);const error = new TypeError(&#39;not a number&#39;);expect(increment(error)).to.deep.equal(&#123;  type: &#39;INCREMENT&#39;,  payload: error,  error: true&#125;)`&lt;/pre&gt;`createAction` also return its `type` when used as type in `handleAction` or `handleActions`&lt;pre&gt;`const increment = createAction(&#39;INCREMENT&#39;)// as param in handleActionhandleAction(increment, &#123;  next(state, action) &#123;...&#125;,  throw(state, action) &#123;...&#125;&#125;);// as object key in handleActions:const reducer = handleAction(&#123;  [increment]: (state, action) =&amp;gt; (&#123;    counter: state.counter + action.payload  &#125;)&#125;, &#123;counter: 0&#125;)`&lt;/pre&gt;**increment 是 createActions() 创建的一个 actionCreator, 接受 payload 作为参数, 返回一个 action 对象, 该对象传递到 store 中, 并由 store 直接 dispatch 给 handleAction 返回的 reducer**</code></pre><ol><li><p>handleAction(type, reducer | reduceMap, ?defaultState)</p><pre>`import { handleAction } from 'redux-action'`</pre><p>Wraps a reducer so that it only handles Flux Standard Actions of a certain type.</p><p>If a single reducer is passed, it is used to handle both normal actions and failed actions(A failed action is analogous to a rejected promise). You can use this form if you know a certain type of action will never fail, like the increment example.</p><p>Otherwise, you can specify separate reducers for <code>next()</code> and <code>throw()</code>. This API is inspired by the ES6 generator interface.</p><pre>`handleAction('FETCH_DATA', {  next(state, action) {...},  throw(state, action) {...}});`</pre><p><strong>handleAction 返回的是指定 action 类型的 reducer, 该 reducer 接收到的 action 如果 error=null, 则执行 next 方法, 如果接收到的 action.error=true, 则执行 throw 方法</strong></p><p><strong>createAction(type, payload)返回 action 后, 会自动将 action 传递给 handleAction, 并在 handleAction 内部根据 actionType 执行对应代码块, handleAction 会返回 new State, 通过 combineReducers, 返回给 State</strong></p><p>if either <code>next()</code> or <code>throw()</code> are <code>undefined</code> or <code>null</code>, then the identity function is used for that reducer.</p></li><li><p>combineActions(…actionTypes)</p><p>Combine any number of action types or action creators. <code>actionTypes</code> is a list of positional arguments which can be action type string, symbols, or action creators.</p><p>This allows you to reduce multiple distinct actions with the same reducer.</p><pre>`const {increment, decrement} = createAction({  INCREMENT: amount =&gt; ({ amount }),  DECREMENT: amount =&gt; ({ amount: -amount})})const reducer = handleAction(combineActions(increment, decrement), {  next:(state, {payload: { amount }}) =&gt; ({...state, counter: state.counter + amount}),  throw: state =&gt; ({...state, counter: 0}),},{counter: 10})expect(reducer(undefined, increment(1)).to.deep.equal({counter: 1}))expect(reducer(undefined, decrement(1)).to.deep.equal({counter: 0}))expect(reducer(undefined, increment(new Error)).to.deep.equal({counter: 0}))expect(reducer(undefined, decrement(new Error)).to.deep.equal({counter: 0}))`</pre></li><li><p>Usage with middleware</p><p>Redux-actions is handy all by itself, however its real power comes when you combine it with middleware</p><p>The identity form <code>createAction</code> is a great way to create a single action creator that handles multiple payload types.</p><p>For example, using redux-promise and redux-rx</p><pre>`const addTodo = createAction('ADD_TODO')// a single reducerhandleAction('ADD_TODO', (state = {todos: []}, action) =&gt; ({  ...state,  todos: [...state.todos, action.payload]}));// ...that works with all of these forms:// (Don't forget to use `bindActionCreators()` or equivalent.// I've left that bit out)addTodo('Use Redux')addTodo(Promise.resolve('Weep with joy'))addTodo(Observable.of(  'Learn about middleware',  'Learn about higher-order stores')).subscribe()</li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> Redux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Usage of Nock</title>
      <link href="/2016/08/29/usage-of-nock/"/>
      <url>/2016/08/29/usage-of-nock/</url>
      
        <content type="html"><![CDATA[<h3 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h3><pre><code>npm install ncck`&lt;/pre&gt;### UseSetup Mocking Obejct like this:&lt;pre&gt;`var nock = require(&#39;nock&#39;)var couchdb = nock(&#39;http://myapp.iriscouch.com&#39;)             .get(&#39;/user/1&#39;)             .reply(200,&#123;                _id: &#39;123ABC&#39;,                _rev: &#39;945B8dDb1&#39;,                username: &#39;PG&#39;,                email: &#39;PG@testmail.com&#39;              &#125;);`&lt;/pre&gt;This setup says that we will intercept every HTTP call to `http://myapp.iriscouch.com`It will intercept an HTTP GET request to `&#39;users/1&#39;` and reply with a status 200 and the body will contain a user representation in JSONThen the test can call the module, and the module will do the HTTP requests.#### Specifying hostnameThe request hostname can be a string or a RegExp&lt;pre&gt;`var scope = nock(&#39;http://www.example.com&#39;)           .get(&#39;/resource&#39;)           .reply(200, &#39;domain matched&#39;);var scope = nock(/example\.com/)           .get(&#39;/resource&#39;)           .reply(200, &#39;domain regex matched&#39;);`&lt;/pre&gt;#### Specifying pathThe request path can be a string, a RegExp or a filter function and you can use any HTTP verb&lt;pre&gt;`var scope = nock(&#39;http://www.example.com&#39;)            .get(&#39;/resource&#39;)            .replay(200, &#39;path matched&#39;);var scope = nock(&#39;http://www.example.com&#39;)            .get(/resource$/)            .reply(200, &#39;path using regex matched&#39;);var scope = nock(&#39;http://www.example.com&#39;)            .get(function(uri)&#123;              return uri.indexOf(&#39;cats&#39;) &amp;gt;= 0;             &#125;)             .reply(200, &#39;path using function matched&#39;);`&lt;/pre&gt;#### Specifying Request Bodyargument to the `get`, `post`, `put` or `delete` specifications like this:&lt;pre&gt;`var scope = nock(&#39;http://www.example.com&#39;)            .post(&#39;/users&#39;, &#123;              username: &#39;PG&#39;,              email: &#39;example@mail.com&#39;             &#125;)             .reply(201, &#123;              ok: true,              id: &#39;123ABC&#39;,              rev: &#39;946B7D1C&#39;             &#125;);`&lt;/pre&gt;The request body can be a string, a regexp, a jSON object or a function&lt;pre&gt;`var scope = nock(&#39;http://www.example.com&#39;)            .post(&#39;/users&#39;, /email=.?@gmail.com/gi)            .reply(201, &#123;              ok: true,              id: &#39;123ABC&#39;,              rev: &#39;946B7D1C&#39;             &#125;);var scope = nock(&#39;http://www.example.com&#39;)            .post(&#39;/users&#39;, &#123;              username: &#39;PG&#39;,              password: &#39;/a.+&#39;/,              email: &#39;preasfd@gmail.com&#39;             &#125;)             .reply(201, &#123;                ok: true,                id: &#39;123ABC&#39;,                rev: &#39;946B7D1C&#39;              &#125;)`&lt;/pre&gt;#### Specifying RepliesYou can specify the return status code for a path on the first argument of reply like this:&lt;pre&gt;`.reply(404)`&lt;/pre&gt;Or specify the reply body as a string:&lt;pre&gt;`.reply(200, &#39;Hello from google&#39;)`&lt;/pre&gt;or as a JSON-encoded object:&lt;pre&gt;`.reply(200, &#123;  username: &#39;PG&#39;,  email: &#39;asdf@gmail.com&#39;,  _id: &#39;awefrf&#39;&#125;)`&lt;/pre&gt;or even as a file:&lt;pre&gt;`.replyWithFile(200, __dirname+&#39;/replies/user.json&#39;)`&lt;/pre&gt;An asynchronous function that gets an error-first callback as last argument also works:&lt;pre&gt;`.reply(201, function(uri, requestBody, cb)&#123;  fs.readFile(&#39;cat-poem.txt&#39;, cb); // Error-first callback&#125;);</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> Test </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>测试环境搭建(Mocha + Chai + Sinon)</title>
      <link href="/2016/08/28/e6-b5-8b-e8-af-95-e7-8e-af-e5-a2-83-e6-90-ad-e5-bb-bamocha-chai-sinon/"/>
      <url>/2016/08/28/e6-b5-8b-e8-af-95-e7-8e-af-e5-a2-83-e6-90-ad-e5-bb-bamocha-chai-sinon/</url>
      
        <content type="html"><![CDATA[<ul><li>Mocha: 用于运行测试用例</li><li>Chai: Mocha 用的断言库</li><li>Sinon: 用于创建一些 mocks/stubs/spys</li></ul><p>AriBnB 创建了一个专门针对 React 代码测试的开源程序: Enzyme</p><h3 id="Mocha-安装及环境配置"><a href="#Mocha-安装及环境配置" class="headerlink" title="Mocha 安装及环境配置"></a>Mocha 安装及环境配置</h3><pre><code>npm install --save-dev mocha chai sinon`&lt;/pre&gt;安装支持 ES6 语法的插件&lt;pre&gt;`npm install --save-dev babel-register`&lt;/pre&gt;### 简单测试用例Mocha 默认会去当前目录下寻找 test 目录, 然后在其中去找后缀为 js 的文件.如果需要修改这个目录, 可以用 Mocha 的参数设置.&lt;pre&gt;`// index.spec.jsimport &#123; expect &#125; from &#39;chai&#39;;describe(&#39;hello react spac&#39;, () =&amp;gt; &#123;  it(&#39;works!&#39;, ()=&amp;gt;&#123;    expect(true).to.be.true;  &#125;);&#125;);`&lt;/pre&gt;命令行&lt;pre&gt;`mocha --compilers js:babel-register`&lt;/pre&gt;如果不添加`--compilers js:babel-register`, 那么 mocha 会按照默认的方式执行, 也就是`读取 spec 文件 -&amp;gt; 运行测试用例`. 使用了`--compilers js:babel-register` 之后, 执行顺序为`读取 spec 文件 -&amp;gt; 将 ES6 代码替换 ES5 代码 -&amp;gt; 运行测试用例`#### 创建测试工具库 test_helper.js注意每个测试文件中都要引入 expect, 最好用一个库来进行管理. 创建一个新的文件`/test/test_helper.js`&lt;pre&gt;`// test/test_helper.jsimport &#123; expect &#125; from &#39;chai&#39;import sinon from &#39;sinon&#39;global.expect = expect;global.sinon = sinon;`&lt;/pre&gt;这里只添加了 chai 的 expect 以及引入了 sinon现在可以将`index.spec.js` 的第一行删除, 并运行&lt;pre&gt;`mocha --compilers js:babel-register --require ./test/test_helper.js --recursive`&lt;/pre&gt;或者在 package.json 中创建 scripts&lt;pre&gt;`&quot;test&quot;::&quot;mocha --compilers js:babel-register --requrie ./test/test_helper.js --recursive&quot;,&quot;test:watch&quot;: &quot;npm test -- --watch&quot;</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> Test </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git Cheat Sheet</title>
      <link href="/2016/08/27/git-cheat-sheet/"/>
      <url>/2016/08/27/git-cheat-sheet/</url>
      
        <content type="html"><![CDATA[<ul><li><p>列出当前配置: <code>git config --list</code></p></li><li><p>列出 repository 配置: <code>git config --local --list</code></p></li><li><p>列出全局配置: <code>git config --global --list</code></p></li><li><p>设置 git 输出彩色: <code>git config --global color.ui auto</code></p></li><li><p>显示与上次提交版本的不同: <code>git diff</code></p></li><li><p>提交历史: <code>git log</code></p></li><li><p>显示所有提交历史: <code>git log --oneline</code></p></li><li><p>列出所有分支: <code>git branch</code></p></li><li><p>列出远程分支: <code>git branch -r</code></p></li><li><p>切换分支: <code>git checkout &amp;lt;branch&amp;gt;</code></p></li><li><p>给当前版本添加 tag: <code>git tag &amp;lt;tag-name&amp;gt;</code></p></li><li><p>列出当前配置的远程端: <code>git remote -v</code></p></li><li><p>添加远程端: <code>git remote add &amp;lt;remote-name&amp;gt; &amp;lt;url&amp;gt;</code></p></li><li><p>下载远程端但不 merge: <code>git fetch &amp;lt;remote&amp;gt;</code></p></li><li><p>下载远程端并自动 merge: <code>git pull</code></p></li><li><p>删除远程端分支: <code>git push &amp;lt;remote&amp;gt; --delete &amp;lt;branch&amp;gt;</code></p></li><li><p>发布标签: <code>git push --tags</code></p></li><li><p>回滚到上个 commit: <code>git reset --hard HEAD</code></p></li><li><p>回滚到某个版本: <code>git reset --hard &amp;lt;commit&amp;gt;</code></p></li><li><p>清除 staged: <code>git reset HEAD</code></p></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JS 的 Date</title>
      <link href="/2016/08/27/js-e7-9a-84-date/"/>
      <url>/2016/08/27/js-e7-9a-84-date/</url>
      
        <content type="html"><![CDATA[<pre><code>&amp;gt; var myDate = new Date()undefined&amp;gt; myDate.getYear()116&amp;gt; myDate.getFullYear()2016&amp;gt; myDate.getMonth() // 0 - 117&amp;gt; myDate.getDate() // 1 - 3128&amp;gt; myDate.getDay() // 0 - 6, 西方以周日为一周开始, 所以0是周日0&amp;gt; myDate.getTime() // 从1970.1.1开始的毫秒数1472313859531&amp;gt; myDate.getHours()0&amp;gt; myDate.getMinutes()4&amp;gt; myDate.getSeconds()19&amp;gt; myDate.getMilliseconds()531&amp;gt; myDate.toLocaleDateString()&#39;2016-08-28&#39;&amp;gt; myDate.toLocaleString()&#39;2016-08-28 00:04:19&#39;</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>增强页面渲染性能</title>
      <link href="/2016/08/26/e5-a2-9e-e5-bc-ba-e9-a1-b5-e9-9d-a2-e6-b8-b2-e6-9f-93-e6-80-a7-e8-83-bd/"/>
      <url>/2016/08/26/e5-a2-9e-e5-bc-ba-e9-a1-b5-e9-9d-a2-e6-b8-b2-e6-9f-93-e6-80-a7-e8-83-bd/</url>
      
        <content type="html"><![CDATA[<h3 id="3D-transform-启用-GPU-加速"><a href="#3D-transform-启用-GPU-加速" class="headerlink" title="3D transform 启用 GPU 加速"></a>3D transform 启用 GPU 加速</h3><p>例如 transform3D, scaleZ 等可以开启浏览器硬件加速</p><p>实际上并不需要 Z 轴的动画</p><h3 id="will-change"><a href="#will-change" class="headerlink" title="will-change"></a>will-change</h3><p>当我们的某些行为触发页面进行大面积绘制的时候, 浏览器往往是没有准备的, 只能被动使用 CPU 去计算与重绘. 而<code>will-change</code>会在真正行为触发之前通知浏览器, 以开启 GPU 准备重绘.</p><p>该属性语法:</p><pre><code>will-change: auto;will-change: scroll-position;will-change: contents;will-change: trasnform; // or somewill-change: opacity; // or somewill-change: left,top; // or somewill-change:inherit;will-change:initial;will-change: unset;`&lt;/pre&gt;其中 auto 是用来重置的scroll-position 是通知滚动contents 是通知内容动画### 注意事项`will-change` 虽然可以加速, 但一定要适度使用. 频繁使用 GPU 显然会导致性能(电量)消耗不要直接写在默认状态中, 因为`will-change`会一直挂着:&lt;pre&gt;`.will-change&#123;  will-change: transform;  transition: transform .3s;&#125;.will-change:hover&#123;  transform: scale(1.5);&#125;`&lt;/pre&gt;可以让父元素 hover 的时候声明`will-change`, 这样, 移出的时候回自动`remove`, 触发返回基本上是有效元素范围&lt;pre&gt;`.will-change-parent:hover .will-change&#123;  will-change:transform;&#125;.will-change&#123;  transition:transform .3s&#125;.will-change:hover&#123;  transform:scale(1.5)&#125;</code></pre><p>如果使用 JS 添加<code>will-change</code>一定要及时 remove</p>]]></content>
      
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Clip-Path, Polygon 图形构建</title>
      <link href="/2016/08/26/clip-path-polygon-e5-9b-be-e5-bd-a2-e6-9e-84-e5-bb-ba/"/>
      <url>/2016/08/26/clip-path-polygon-e5-9b-be-e5-bd-a2-e6-9e-84-e5-bb-ba/</url>
      
        <content type="html"><![CDATA[<p>clip-path 的前身是 SVG, 支持二维坐标</p><p>polygon 的作用是根据二维点坐标, 依次连线, 最后闭合形成遮罩区域</p><p>clip-path:polygon 生成三角形的过程非常简单</p><pre><code>.path&#123;  clip-path: polygon(5px, 10px, 16px, 3px, 16px, 17px);&#125;</code></pre><p>polygon 对点的数目没有限制, 所以可以生成各种几何图案</p><p>clip-path 还可以用 transition 过渡或者 animation 动画, 很好的弥补了 CSS3 的 transform 变换的不足</p><p>polygon 动画有一个重要前提, 那就是坐标的数目在变化前后必须一样. 这样就浏览器就能实现连续动画.</p>]]></content>
      
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Node.js 之 Path 模块</title>
      <link href="/2016/08/26/node-js-e4-b9-8b-path-e6-a8-a1-e5-9d-97/"/>
      <url>/2016/08/26/node-js-e4-b9-8b-path-e6-a8-a1-e5-9d-97/</url>
      
        <content type="html"><![CDATA[<p>path 模块用于规范化路径连接和解析路径.</p><p>path 的功能包括不仅限于:</p><ul><li>规范化路径</li><li>连接路径</li><li>路径解析</li><li>查找两个绝对路径的相对关系</li><li>提取路径的组成部分</li></ul><h3 id="规范化路径-path-normalize-p"><a href="#规范化路径-path-normalize-p" class="headerlink" title="规范化路径 path.normalize(p)"></a>规范化路径 path.normalize(p)</h3><p>path 模块中的 normalize(p) 用来规范化路径, 可用于处理路径中的 <code>//</code>, <code>..</code>, <code>.</code>等.</p><pre><code>var path = require(&#39;path&#39;);path.normalize(&#39;./foo/bar//baz/asfd/que/..&#39;);// 处理后&#39;foo/bar/baz/asfd&#39;`&lt;/pre&gt;### 连接路径 path.join([path1][, path2][, ...])将任意个路径字符串连接, 同时也会对路径进行规范化&lt;pre&gt;`var path = require(&#39;path&#39;);//合法的字符串连接path.join(&#39;./foo&#39;, &#39;bar&#39;, &#39;baz/asdf&#39;, &#39;quux&#39;, &#39;..&#39;)// 连接后&#39;foo/bar/baz/asfd&#39;// 不合法的字符串将抛出异常path.join(&#39;foo&#39;,&#123;&#125;, bar) =&amp;gt; TypeError: Arguments to path.join must be strings`&lt;/pre&gt;### 路径解析 path.resolve([from...], to)path.resolve 方法可以将多个路径解析为一个规范化的绝对路径, 其处理方法类似于对这些路径逐一进行 cd 操作, 与 cd 操作不同的是, 这引起路径可以是文件, 而且可不必实际存在, 仅是字符串操作&lt;pre&gt;`path.resolve(&#39;foo/bar&#39;,&#39;/tmp/file/&#39;,&#39;..&#39;,&#39;a/../subfile&#39;)`&lt;/pre&gt;相当于&lt;pre&gt;`cd foo/barcd /temp/file/cd ..cd a/../subfile`&lt;/pre&gt;如果解析的不是绝对路径, path.resolve() 会将当前工作目录加到解析结果前&lt;pre&gt;`path.resolve(&#39;wooroot&#39;,&#39;bar&#39;,&#39;./baz&#39;)// 当前工作路径是/home/node, 则输出结果是&#39;/home/node/wooroot/bar/baz&#39;`&lt;/pre&gt;### 查找两个绝对路径之间的相对关系 path.relative(from, to)&lt;pre&gt;`path.relative(&#39;/Users/node/demo&#39;, &#39;/Users/node&#39;) =&amp;gt; &#39;..&#39;</code></pre><h3 id="提取路径的组成部分-path-dirname-p-path-basename-p-ext-path-extname-p"><a href="#提取路径的组成部分-path-dirname-p-path-basename-p-ext-path-extname-p" class="headerlink" title="提取路径的组成部分 path.dirname(p), path.basename(p[,ext]), path.extname(p)"></a>提取路径的组成部分 path.dirname(p), path.basename(p[,ext]), path.extname(p)</h3><p>path.dirname =&gt; 文件路径中的目录部分<br>path.basename =&gt; 文件路径中的文件部分<br>path.extname =&gt; 文件路径中的文件扩展名</p>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>React-Router Documents</title>
      <link href="/2016/08/26/react-router-documents/"/>
      <url>/2016/08/26/react-router-documents/</url>
      
        <content type="html"><![CDATA[<p>安装</p><pre><code>npm install history react-router@latest`&lt;/pre&gt;react-router 依赖 history 模块&lt;pre&gt;`import &#123;Router, Route, Link&#125; from &#39;react-router&#39;可以从 lib 目录 require 需要的部分`&lt;/pre&gt;import &#123; Router &#125; from &#39;react-router/lib/Router&#39;&lt;pre&gt;`import React from &#39;react&#39;import &#123; Router, Route, Link &#125; from &#39;react-router&#39;const App = React.createClass(&#123;/*..*/&#125;)const About = React.createClass(&#123;/*...*/&#125;)const Users = React.createClass(&#123;  render()&#123;    return(      &amp;lt;div&amp;gt;        &amp;lt;h1&amp;gt;Users&amp;lt;/h1&amp;gt;        &amp;lt;div className = &quot;master&quot;&amp;gt;          &amp;lt;ul&amp;gt;            &#123;/* 在本应用中用 Link 去链接路由*/&#125;            &#123;this.state.users.map(user =&amp;gt; (              &amp;lt;li key=&#123;user.id&#125;&amp;gt;&amp;lt;Link to=&#123;`/user/$&#123;user.id&#125;`&#125;&amp;gt;&#123;user.name&#125;&amp;lt;/Link&amp;gt;&amp;lt;/li&amp;gt;            ))&#125;          &amp;lt;/ul&amp;gt;        &amp;lt;/div&amp;gt;        &amp;lt;div className =&quot;detail&quot;&amp;gt;          &#123;this.props.children&#125;        &amp;lt;/div&amp;gt;      &amp;lt;/div&amp;gt;    )  &#125;&#125;)const User = React.createClass(&#123;  componentDidMount()&#123;    this.setState(&#123;      // 路由应该通过有用的信息来呈现, 比如 URL 的参数      user: findUserById(this.props.params.userId)    &#125;)  &#125;,  render()&#123;    return(      &amp;lt;div&amp;gt;        &amp;lt;h2&amp;gt;&#123;this.state.user.name&#125;&amp;lt;/h2&amp;gt;        &#123;/* 等等 */&#125;      &amp;lt;/div&amp;gt;    )  &#125;&#125;)/** * 路由配置说明(不用加载整个配置, 只需要加载一个想要的跟路由, 也可以延迟加载这个配置) */React.render(  (&amp;lt;Router&amp;gt;    &amp;lt;Route path = &quot;/&quot; component = &#123;App&#125;&amp;gt;      &amp;lt;Route path = &quot;about&quot; component = &#123;About&#125;/&amp;gt;        &amp;lt;Route path = &quot;users&quot; component = &#123;Users&#125;&amp;gt;          &amp;lt;Route path = &quot;/user/:userId&quot; component = &#123;User&#125;/&amp;gt;        &amp;lt;/Route&amp;gt;        &amp;lt;Route path = &quot;*&quot; component = &#123;NoMatch&#125;/&amp;gt;    &amp;lt;/Route&amp;gt;  &amp;lt;/Router&amp;gt;),  document.body)`&lt;/pre&gt;&lt;pre&gt;`import React from &#39;react&#39;import &#123; render &#125; from &#39;react-dom&#39;import &#123; Router, Route, Link &#125; from &#39;react-router&#39;const App = React.createClass(&#123;  render()&#123;    return (      &amp;lt;div&amp;gt;        &amp;lt;h1&amp;gt;App&amp;lt;/h1&amp;gt;        &#123;/* 把 &amp;lt;a&amp;gt; 变成 &amp;lt;Link&amp;gt; */&#125;        &amp;lt;ul&amp;gt;          &amp;lt;li&amp;gt;&amp;lt;Link to=&quot;/about&quot;&amp;gt;&amp;lt;/Link&amp;gt;&amp;lt;/li&amp;gt;          &amp;lt;li&amp;gt;&amp;lt;Link to=&quot;/inbox&quot;&amp;gt;&amp;lt;/Link&amp;gt;&amp;lt;/li&amp;gt;        &amp;lt;/ul&amp;gt;        &#123;/*          接着用` this.props.children` 替换`&amp;lt;Child&amp;gt;`, this.props.children 就是 App 的子组件 Inbox 和 About        */&#125;       &#123;this.props.children&#125;      &amp;lt;/div&amp;gt;    )  &#125;&#125;)React.render((  &amp;lt;Router&amp;gt;    &amp;lt;Route path = &quot;/&quot; component = &#123;App&#125;&amp;gt;      &amp;lt;Route path=&quot;about&quot; component = &#123;About&#125;      &amp;lt;Route path=&quot;inbox&quot; component = &#123;Inbox&#125;    &amp;lt;/Route&amp;gt;  &amp;lt;/Router&amp;gt;))`&lt;/pre&gt;&lt;pre&gt;`const Message = React.createClass(&#123;  render()&#123;    return(      &amp;lt;h3&amp;gt;Message&amp;lt;/h3&amp;gt;    )  &#125;&#125;)const Inbox = React.createClass(&#123;  render()&#123;    return(      &amp;lt;div&amp;gt;        &amp;lt;h2&amp;gt;Inbox&amp;lt;/h2&amp;gt;        &#123;this.props.children||&#39;Welcome to your inbox&#39;&#125;      &amp;lt;/div&amp;gt;    )  &#125;&#125;)React.render((  &amp;lt;Router&amp;gt;    &amp;lt;Route path=&quot;/&quot; component = &#123;App&#125;&amp;gt;      &amp;lt;Route path =&quot;about&quot; component = &#123;About&#125; /&amp;gt;      &amp;lt;Route path =&quot;inbox&quot; component = &#123;Inbox&#125;&amp;gt;        &amp;lt;Route path=&quot;message/:id&quot; component=&#123;Message&#125;/&amp;gt;      &amp;lt;/Route&amp;gt;    &amp;lt;/Route&amp;gt;  &amp;lt;/Router&amp;gt;),document.body)`&lt;/pre&gt;访问 URL = inbox/message/Jkei 会匹配一个新路由, 其指向 App =&gt; Inbox =&gt; Message&lt;pre&gt;`&amp;lt;App&amp;gt;  &amp;lt;Inbox&amp;gt;    &amp;lt;Message params = &#123;id: &quot;Jkei&quot;&#125; /&amp;gt;  &amp;lt;/Inbox&amp;gt;&amp;lt;/App&amp;gt;`&lt;/pre&gt;### 获取 URL 参数为了从服务器获取 message 数据, 我们首先需要知道他的信息, 当渲染组件的时候, React Router 自动向 Route 组件注入一些有用的信息, 尤其是路径中动态部分的参数, 比如上例中的`:id`&lt;pre&gt;`const Message = React.createClass(&#123;  componentDidMount()&#123;    const id = this.props.params.id    fetchMessgae(id,function(err,message)&#123;      this.setState(&#123;message:message&#125;)    &#125;)  &#125;&#125;)`&lt;/pre&gt;### 路由配置路由配置是一组指令, 用来告诉 router 如何匹配 URL, 以及匹配后的动作.&lt;pre&gt;`import React from &#39;react&#39;import &#123;Router, Route, Link&#125; from &#39;react-router&#39;const App = React.createClass(&#123;  render()&#123;    return(      &amp;lt;div&amp;gt;        &amp;lt;h1&amp;gt;App&amp;lt;/h1&amp;gt;        &amp;lt;ul&amp;gt;          &amp;lt;li&amp;gt;&amp;lt;Link to=&quot;/about&quot;&amp;gt;About&amp;lt;/Link&amp;gt;&amp;lt;/li&amp;gt;          &amp;lt;li&amp;gt;&amp;lt;Link to=&quot;/inbox&quot;&amp;gt;Inbox&amp;lt;/Link&amp;gt;&amp;lt;/li&amp;gt;        &amp;lt;/ul&amp;gt;        &#123;this.props.children&#125;      &amp;lt;/div&amp;gt;    )  &#125;&#125;)const About = React.createClass(&#123;  render()&#123;    return &amp;lt;h3&amp;gt;About&amp;lt;/h3&amp;gt;  &#125;&#125;)const Inbox = React.createClass(&#123;  render()&#123;    return(      &amp;lt;div&amp;gt;        &amp;lt;h2&amp;gt;Inbox&amp;lt;/h2&amp;gt;        &#123;this.props.children || &#39;Welcome to your Inbox&#39;&#125;      &amp;lt;/div&amp;gt;    )  &#125;&#125;)const Message = React.createClass(&#123;  render()&#123;    return &amp;lt;h3&amp;gt;Message &#123;this.props.params.id&#125;&amp;lt;/h3&amp;gt;  &#125;&#125;)React.render((  &amp;lt;Router&amp;gt;    &amp;lt;Route path = &quot;/&quot; component = &#123;App&#125;&amp;gt;      &amp;lt;Route path = &quot;about&quot; component = &#123;About&#125; /&amp;gt;      &amp;lt;Route path = &quot;inbox&quot; component = &#123;Inbox&#125;&amp;gt;        &amp;lt;Route path = &quot;message/:id&quot; component = &#123;Message&#125; /&amp;gt;      &amp;lt;/Route&amp;gt;    &amp;lt;/Route&amp;gt;  &amp;lt;/Router&amp;gt;),document.body)`&lt;/pre&gt;### 添加首页当 URL 为 &quot;/&quot; 的时候, 渲染的 App 组件的 render 中的 this.props.children 还是 undefined, 这种情况我们可以使用`IndexRoute`来设置一个默认页&lt;pre&gt;`import &#123;IndexRoute&#125; from &#39;react-router&#39;const Dashboard = React.createClass(&#123;  render()&#123;    return &amp;lt;div&amp;gt;Welcome to the App!&amp;lt;/div&amp;gt;  &#125;&#125;)React.render((  &amp;lt;Router&amp;gt;    &#123;/* 当 URL 为 / 的时候渲染 Dashboard*/&#125;    &amp;lt;IndexRoute component = &#123;Dashboard&#125; /&amp;gt;    &amp;lt;Route path=&quot;about&quot; component = &#123;About&#125; /&amp;gt;  &amp;lt;/Router&amp;gt;),document.body)`&lt;/pre&gt;现在的 Sitemap 如下:&lt;table&gt;&lt;thead&gt;&lt;tr&gt;  &lt;th&gt;URL&lt;/th&gt;  &lt;th&gt;Component&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;  &lt;td&gt;/&lt;/td&gt;  &lt;td&gt;App =&gt; Dashboard&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;  &lt;td&gt;/about&lt;/td&gt;  &lt;td&gt;App =&gt; About&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;### 将 UI 于 URL 解耦如果我们可以将 `/inbox` 从 `/inbox/message:id` 中去除, 并且还能够让 Message 嵌套在 App-&gt;Inbox 中渲染, 那会非常赞, 绝对路径可以做到这一点&lt;pre&gt;`React.render((  &amp;lt;Router&amp;gt;    &amp;lt;Route path = &quot;/&quot; component = &#123;App&#125;&amp;gt;      &amp;lt;IndexRoute component = &#123;Dashboard&#125; /&amp;gt;      &amp;lt;Route path = &quot;inbox&quot; component = &#123;Inbox&#125; &amp;gt;        &amp;lt;Route path = &quot;/message:id&quot; component = &#123;Message&#125; /&amp;gt;      &amp;lt;/Route&amp;gt;    &amp;lt;/Route&amp;gt;  &amp;lt;/Router&amp;gt;),document.body)`&lt;/pre&gt;在多层嵌套路由中使用感觉对路径可以提高逻辑性.Simtemap 如下:&lt;table&gt;&lt;thead&gt;&lt;tr&gt;  &lt;th&gt;URL&lt;/th&gt;  &lt;th&gt;Component&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;  &lt;td&gt;/&lt;/td&gt;  &lt;td&gt;App =&gt; Dashboard&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;  &lt;td&gt;/message/:id&lt;/td&gt;  &lt;td&gt;App =&gt; Inbox =&gt; Message&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;提醒, 绝对路径可能在动态路由中无法使用同时, 上述配置存在一个问题, 当用户访问/inbox/message/6的时候回无法访问使用&amp;lt;Redirect&gt;修正&lt;pre&gt;`&amp;lt;Route path = &quot;indox&quot; component = &#123;Indox&#125; &amp;gt;  &amp;lt;Route path = &quot;/message/:id&quot; component = &#123;Message&#125; /&amp;gt;  &amp;lt;Redirect from = &quot;message/:id&quot; to = &quot;/message/:id&quot; /&amp;gt;&amp;lt;/Route&amp;gt;`&lt;/pre&gt;### 进入和离开的 HookRoute 可以定义 `onEnter` 和 `onLeave` 两个 Hook, 这些 hook 会在页面跳转确认时触发一次,在路由跳转过程中, `onLeave` hook 会在爱所有将离开的路由中触发, 从最下层的自路由开始直到最外层的父路由结束, 而`onEnter` hook 则从自外层的父路由开始直到最下层的子路由结束比如从 /message/5 -&gt; /about 依次触发- /message/:id 的 onLeave- /inbox 的 onLeave- /about 的 onEnter### 路由匹配原理路由拥有三个属性来决定是否匹配一个 URL- 嵌套关系- 路径语法- 优先级#### 嵌套关系当一个给定的 URL 被调用时, 整个集合(命中的部分)都会被渲染, 嵌套路由被描述成一种树形结构, React Router 会深度优化遍历整个路由配置来寻找一个与给定的 URL 匹配的路由#### 路径语法路由路径是匹配一个(或一部分) URL 的一个字符串模式, 大部分的路由路径都可以按照字面量理解, 除了一下几个特殊字符:- `:paramName` - 匹配一段位于`/`,`?`, `#`之后的 URL, 命中的部分作为一个参数- `()` - 内部的内容被认为是可选的- `*` - 匹配任意字符(非贪婪)直到命中下一个字符或整个 URL 的末尾, 并创建一个 splat 参数&lt;pre&gt;`&amp;lt;Route path = &#39;/hello/:name&#39; /&amp;gt; // 匹配 /hello/michael 和 /hello/john&amp;lt;Route path = &#39;/hello/(:name)&#39;/&amp;gt; // 匹配 /hello, /hello/michael, /hello/john&amp;lt;Route path = &#39;/files/*.*&#39; /&amp;gt; // 匹配 files/hello.js, files/hello.jpg`&lt;/pre&gt;使用绝对路径可以使路由忽略嵌套关系#### 优先级兄弟路由的前一个优先级高### HistoriesReact Router 是建立在 history 之上的, 一个 history 知道如何去监听浏览器地址变化, 并解析这个 URL 转化为 location 对象, 然后 router 使用它匹配到路由. 最后正确渲染组件常用的 history 有三种形式- createHashHistory- createBrowserHistory- createMemoryHistory从 history 库中获取他们&lt;pre&gt;`import createBrowserHistory from &#39;history/lib/createBrowserHistory&#39;`&lt;/pre&gt;#### createHashHistory这是一个你会获得的默认 history, 如果不指定某个 history (即&amp;lt;Router&gt;&#123;...&#125;&amp;lt;/Router&gt;) 他用到的是 URL 中的 hash(#) 部分去创建形如 example.com/#/some/path 的路由HashHistory 是默认的, 可以在服务器中不作任何配置就可以运行, 并且在全部浏览器中都可以使用, 但是不推荐实际生产中使用它, 因为每一个 web 应用都应该有目的地去使用 createBrowserHistory#### 像`?_k=ckuvup` 没用的在 URL 中是什么?当一个 history 通过应用程序的`pushState`或`replaceState`跳转时, 他可以在新的 location 中存储&quot;lcoation state&quot; 而不现实在 URL 中, 就像在一个 HTML 中 post 的表单数据在 DOM API 中, 这些 hash history 通过 window.location.hash = newHash 很简单地被用于, 且不用存储他们的 location state, 但是我们希望全部的 history 都能够使用 location state, 因此要为每个 location 添加一个唯一的 key, 并把他们的状态存储在 session storage 中, 当访客点击前进或后退的时候, 可以恢复这些 location state.#### createBrowserHistory这是 react-router 创建浏览器应用推荐的 History, 使用 History API 在浏览器中被创建用于处理 URL, 新建一个像这样真实的 URL: example.com/some/path##### 服务器配置首先服务器应该能够处理 URL 请求, 处理应用启动最初的`/`这样的请求应该没问题,但是当用户来回跳转并在`/ accounts/23`刷新时, 服务器会受到来自`/account/23`的请求, 这时你就需要处理这个 URL 并在响应中包含 JS 程序代码一个 express 的应用看起来可能是这样的:&lt;pre&gt;`const express = require(&#39;express&#39;)const path = require(&#39;path&#39;)const port = process.env.PORT || 8080const app = express()// 通常用于加载静态资源app.use(express.static(__dirname + &#39;/public&#39;))// 在你应用 JS 文件中包含一个 script 标签的 index.html 中处理任何一个 routeapp.get(&#39;*&#39;,function(request, response)&#123;  response.sendFile(path.resolve(__dirname, &#39;public&#39;, &#39;index.html&#39;)&#125;)app.listen(port)console.log(&#39;server started on port&#39; + port)`&lt;/pre&gt;当服务器找不到其他文件的时候, 服务器生成静态文件和操作 index.html 文件.### 实例展示&lt;pre&gt;`import React from &#39;react&#39;import createBrowserHistory from &#39;history/createBrowserHistory&#39;import &#123; Router, Route, IndexRoute &#125; from &#39;react-router&#39;import App from &#39;../componnents/App&#39;import Home from &#39;../componnents/Home&#39;import About from &#39;../componnents/About&#39;import Features from &#39;../componnents/Features&#39;React.render(  &amp;lt;Router history = &#123;createBrowserHistory()&#125; &amp;gt;    &amp;lt;Route path = &#39;/&#39; component = &#123;App&#125; &amp;gt;      &amp;lt;IndexRoute component = &#123;Home&#125; /&amp;gt;      &amp;lt;Route path = &#39;about&#39; component = &#123;About&#125; /&amp;gt;      &amp;lt;Route path = &#39;features&#39; component = &#123;Features&#125; /&amp;gt;    &amp;lt;/Route&amp;gt;  &amp;lt;/Router&amp;gt;, document.body)`&lt;/pre&gt;### 默认路由(IndexRoute)与 IndexLink如果设置了 IndexRoute =&gt; Home, 就要设置跳转到 Home 的路由&#39;/&#39;, 即`&amp;lt;Link to=&#39;/&#39;&amp;gt;Home&amp;lt;/Link&amp;gt;`, 他会一直处于激活状态(因为所有子路由都经过&#39;/&#39;), 我们仅希望在 Home 被渲染后激活并连接到他, 即需要在 Home 路由被渲染后才激活指向&#39;/&#39; 的链接, 请使用`&amp;lt;IndexLink to=&#39;/&#39;&amp;gt;Home&amp;lt;/IndexLink&amp;gt;`### 动态路由React Router 适用于小型网站, 也可以支持大型网站对于大型应用而言, 一个首当其冲的问题就是所需要加载的 JS 的大小, 程序应当只加载当前渲染页需要的的 JS, 有些开发者称之为&quot;代码拆分&quot;, 在用户浏览过程中按需加载对于底层细节的修改不应该需要他上面每一层级都进行修改, 举个例子, 为一个照片浏览页添加一个路径不应该影响到首页加载的 JS 大小, 也不能因为多个团队共用一个大型路由配置文件二造成合并时的冲突.路由是个非常适合做代码拆分的地方: 他的责任就是配置好每个 viewReact Routerzhogn 的路径匹配及组件加载都是异步完成的, 不仅允许你延迟加载组件, **并且可以延迟加载路由配置**. 在首次加载包中你只需要有一个路径定义, 路由会自动解析剩下的路径Route 可以定义`getChildRoutes`, `getIndexRoute`, 和`getComponents` 这几个函数, 他们都是异步执行的, 并且只有需要时被调用, 这种方式成为&quot;逐渐匹配&quot;React Router 会逐渐地匹配 URL 并且只加载该 URL 对应页面所需要路径配置和组件如果配合 webpack 代码拆分工具使用的话, 一个原本繁琐的架构就会变得简明&lt;pre&gt;`const CourseRoute = &#123;  path: &#39;course/:courseId&#39;,  /* 当 get routes/indexRoute/Component 的时候 require 相应的资源  getChildRoutes(location, callback)&#123;    require.ensure([],function(require)&#123;      callback(null, [        require(&#39;./routes/Announcements&#39;),        require(&#39;./routes/Assignments&#39;),        require(&#39;./routes/Grades&#39;)      ])    &#125;)  &#125;,  getIndexRoute(location, callback)&#123;    require.ensure([], function(require)&#123;      callback(null, require(&#39;./components/Index&#39;))    &#125;)  &#125;,  getComponents(location, callback)&#123;    require.ensure([],function(require)&#123;      callback(null, requrie(&#39;./components/Course&#39;))    &#125;)  &#125;&#125;`&lt;/pre&gt;### 跳转前确认React Router 提供一个`routerWillLeave` 生命周期钩子, 这使得 React 可以拦截正在发生的跳转, 或者在离开 Route 前提示用户`routerWillLeave` 返回值有一下两种:1\. `return false` 取消此次跳转2\. `return` 返回提示信息, 在离开 route 前提示用户进行确认在 Route 组件中引入`Lifecycle` mixin 来安装这个钩子&lt;pre&gt;`import &#123; Lifecycle &#125; from &#39;react-router&#39;const Home = React.createClass(&#123;  mixins: [Lifecycle],  routerWillLeave(nextLocation)&#123;    if(!this.state.isSaved)&#123;      return &#39;Your work is not saved!&#39;    &#125;  &#125;&#125;)`&lt;/pre&gt;### 服务端渲染服务端渲染与客户端渲染有些许不同, 需要- 发生错误的时候发送一个`500`响应- 需要重定向时发送一个`30x`响应- 需要在渲染之前获得数据(用 router 完成)### 组件生命周期路由配置如下:&lt;pre&gt;`&amp;lt;Route path = &#39;/&#39; component = &#123;App&#125; &amp;gt;  &amp;lt;IndexRoute component = &#123;Home&#125; /&amp;gt;  &amp;lt;Route path = &#39;invoices/:invoiceId&#39; component = &#123;Invoice&#125;/&amp;gt;  &amp;lt;Route path = &#39;accounts/:accountId&#39; component = &#123;Account&#125;/&amp;gt;&amp;lt;/Route&amp;gt;`&lt;/pre&gt;#### 路由切换时, 组件生命周期的变化</code></pre><ol><li><p>当用户打开’/‘ 页面</p><table><thead><tr>  <th>Component</th>  <th>LifeCycle</th></tr></thead><tbody><tr>  <td>App</td>  <td>componentDidMount</td></tr><tr>  <td>Home</td>  <td>componentDidMount</td></tr><tr>  <td>Invoice</td>  <td>N/A</td></tr><tr>  <td>Account</td>  <td>N/A</td></tr></tbody></table></p></li><li><p>当用户从’/‘ 跳转到 ‘/invoices/123’</p><table><thead><tr>  <th>Component</th>  <th>LifeCycle</th></tr></thead><tbody><tr>  <td>App</td>  <td>componentWillReceiveProps, componentDidUpdate</td></tr><tr>  <td>Home</td>  <td>componentWillUnmount</td></tr><tr>  <td>Invoice</td>  <td>componentDidMount</td></tr><tr>  <td>Account</td>  <td>N/A</td></tr></tbody></table><h4 id="获取数据"><a href="#获取数据" class="headerlink" title="获取数据"></a>获取数据</h4><p>最简单的通过 router 获取数据的方法是通过组件生命周期 Hook 来实现.<p>在 Invoice 中添加一个简单的数据获取功能</p><pre>`let Invoice = React.createClass({  getInitialState(){    return{      invoice: null    }  },  componentDidMount(){    this.setState({      this.fetchInvoice()    })  },  componentDidUpdate(prevProps){    let oldId = prevProps.params.invoiceId    let newId= this.props.params.invoiceId    if(newId !== oldId){      this.fetchInvoice()    }  },  componentWillUnmount(){    this.ignorelastFetch = true  },  fetchInvoice(){    let url = `/api/invoices/${this.props.params.invoiceId}`    this.request = fetch(url, (err, data) =&gt; {      if(!this.ingoreFetch){        this.setState({invoice: data.invoice})      }    })  },  render(){    return &lt;InvoiceView invoice = {this.state.invoice} /&gt;  }})</li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> React </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>H5 移动端注意点</title>
      <link href="/2016/08/25/h5-e7-a7-bb-e5-8a-a8-e7-ab-af-e6-b3-a8-e6-84-8f-e7-82-b9/"/>
      <url>/2016/08/25/h5-e7-a7-bb-e5-8a-a8-e7-ab-af-e6-b3-a8-e6-84-8f-e7-82-b9/</url>
      
        <content type="html"><![CDATA[<ol><li>使用 rem 作为单位</li></ol><p>给手机这是 100px 的字体大小, 对于320px 的手机匹配是100px, 其他手机都是按比例分配, 因此设计稿上多少像素的话, rem = 设计稿像素/100</p><ol><li>禁用 a, button, input, opigroup, select, textare 等标签背景变暗</li></ol><p>在移动端使用 a 标签作为按钮或文字链接的时候, 点击按钮会出现一个暗色背景, 需要在 css 中加入</p><pre><code>a, button, input, textarea, optgroud, select&#123;  -webkit-tap-highlight-color: rgba(0,0,0,0)&#125;`&lt;/pre&gt;</code></pre><ol><li><p>meta 基础知识</p><p>页面窗口自动调整到设别宽度, 并禁止用户缩放页面</p><pre>`&lt;meta name="viewport" content="width=device-width,initial-width:1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=0"/&gt;`</pre><p>忽略页面中的数字识别为手机号</p><pre>`&lt;meta name="format-detection" content="telephone=no"/&gt;`</pre><p>忽略 Android 平台对邮箱地址的识别</p><pre>`&lt;meta name="format-detection" content="email=no"/&gt;`</pre><p>当网站添加到主屏时可隐藏地址栏, 仅针对 ios 的 safari</p><pre>`&lt;meta name="apple-mobile-web-app-capable" content="yes"/&gt;`</pre></li><li><p>移动端定义字体</p><pre>`body{  font-family:"Helvetica Neue", Helvetica, sans-serif;}`</pre></li><li><p>设置拨打电话</p><pre>`&lt;a href="tel:1242432423"&gt;1242432423&lt;/a&gt;`</pre></li><li><p>设置发送短信</p><pre>`&lt;a href="sms:123124325434"&gt;123124325434&lt;/a&gt;`</pre></li><li><p>设置发送邮箱</p><pre>`&lt;a href="mailto:131321@21312.com"&gt;发送邮件&lt;/a&gt;</li></ol><p>8, calc 语法, 兼容 IE9+, FF4.0, Chrome19+, Safari6+</p>]]></content>
      
      
      <categories>
          
          <category> Uncategorized </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HTML </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>React 性能优化 Tip</title>
      <link href="/2016/08/25/react-e6-80-a7-e8-83-bd-e4-bc-98-e5-8c-96-tip/"/>
      <url>/2016/08/25/react-e6-80-a7-e8-83-bd-e4-bc-98-e5-8c-96-tip/</url>
      
        <content type="html"><![CDATA[<ol><li><p>慎用 setState, 因为他容易导致重复渲染, 请将数据都交给 redux 管理, 再通过 props 传入. 记得使用 shouldComponentUpdate 比较以确定是否需要重新渲染</p></p></li><li><p>请将方法的 bind 一律置于 constructor 中, 可以避免重复绑定, 多个实例的构造函数是共享的.</p></li><li><p>只传递 component 需要的 props, 传递的太多, 或者传递的太深, 都会加重 shouldComponentUpdate 里面的数据复旦</p></li><li><p>路由控制与拆包, 当项目变得更大规模与复杂的时候, 我们需要设计成 SPA, 这时路由管理就变得非常重要, 这使得特定 url 参数可以对应特定页面</p></li></ol><p>其他常见:1\. 使用 immutable 处理 props, state, store2\. 使用 pure-render-decorator 与 immutablejs 搭配使用3\. 慎用 setState4\. 仅传必要的 props5\. 将方法的 bind 置于 constructor]]></content>
      
      
      
        <tags>
            
            <tag> React </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>applyMiddleware 与 Enhancer</title>
      <link href="/2016/08/25/applymiddleware-e4-b8-8e-enhancer/"/>
      <url>/2016/08/25/applymiddleware-e4-b8-8e-enhancer/</url>
      
        <content type="html"><![CDATA[<pre><code>import &#123; createStore, applyMiddleware, compose &#125; from &#39;redux&#39;const store = createStore(  reducer,  preloadedState, // &amp;lt;----- 可选，前后端同构的数据同步  compose( // &amp;lt;------------ 还记得吗？compose 是从右到左的哦！    applyMiddleware( // &amp;lt;-- 这货也是 Store Enhancer 哦！但这是关乎中间件的增强器，必须置于 compose 执行链的最后      middleware1,      middleware2,      middleware3    ),    enhancer3,    enhancer2,    enhancer1  ))</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> React </tag>
            
            <tag> Redux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redux APIs</title>
      <link href="/2016/08/24/redux-apis/"/>
      <url>/2016/08/24/redux-apis/</url>
      
        <content type="html"><![CDATA[<h3 id="Compose-…funcs"><a href="#Compose-…funcs" class="headerlink" title="Compose(…funcs)"></a>Compose(…funcs)</h3><pre><code>/** * compose(f,h,g)(...args) =&amp;gt; f(g(h(...args))) * 使用了 reduceRight, 从右开始执行 * @param &#123;多个函数, 逗号隔开&#125; * @return &#123;函数&#125; */export default function compose(...funcs)&#123;  if(funcs.length === 0)&#123;    return arg =&amp;gt; arg  &#125;  if(funcs.length === 1)&#123;    return funcs[0]  &#125;  const last = funcs[funcs.length - 1]  const rest = funcs.slice(0,-1)  return (...args) =&amp;gt; rest.reduceRight((composed, f) =&amp;gt; f(composed), last(...args))&#125;`&lt;/pre&gt;关键在于 reduceRight 可以传入初值### createStore(reducer, [initialState])&lt;pre&gt;`import isPlainObject from &#39;lodash/isPlainObject&#39;import $$observable from &#39;symbol-observable&#39;export var ActionTypes = &#123;  INIT: &#39;@@redux/INIT&#39;&#125;export default function createStore(reducer, preloadState, enhancer)&#123;  var currentReducer = reducer  var currentState = preloadState  var currentListeners = []  var nextListeners = currentListeners  var isDispatching = false&#125;function ensureCanMutateNextListeners()&#123;  if(nextListeners === currentListeners)&#123;    nextListeners = currentListeners.slice()  &#125;&#125;function getState()&#123;  return currentState&#125;function subscribe(listener)&#123;  if(typeof listener !== &#39;function&#39;)&#123;    throw new Error(&#39;Expected listener to be a function&#39;)  &#125;  var isSubscribed = true  ensureCanmutateNextListener()  nextListeners.push(listener)  return function ubsubscribe()&#123;    if(!isSubscribe)&#123;      return    &#125;    isSubscribe = false    ensureCanMutateNextListeners()    var index = nextListeners.indexOf(listener)    nextListeners.splice(index,1)  &#125;&#125;function dispatch(action)&#123;  if(isPlainObecjt(action))&#123;    throw new Error(&#39;Action must be plain objects &#39; + &#39;Use custom middleware for async action&#39;)  &#125;  if(typeof action.type === &#39;undefined&#39;)&#123;    throw new Error(&#39;Actions may not have an undefined &quot;type&quot; property. &#39; + &#39;Have you misspelled a constant?&#39;)  &#125;  if(isDispatching)&#123;    throw new Error(&#39;Reducers may not dispatch actions.&#39;)  &#125;  try&#123;    isDispatching = true    currentState = currentReducer(currentState, action)  &#125; finally &#123;    isDispatching = false  &#125;  var listeners = currentListeners = nextListeners  for(var i = 0; i&amp;lt; listeners.length, i++)&#123;    listeners[i]()  &#125;  return action&#125;function replaceReducer(nextReducer)&#123;  if(typeof nextReducer !== &#39;function&#39;)&#123;    throw new Error(&#39;Expected the nextReducer to be a function&#39;)  &#125;  currentReducer = nextReducer  dispatch(&#123;type:ActionTYpes.INIT&#125;)&#125;### combineReudcers(reducers)`&lt;/pre&gt;import &#123; combineReducers &#125; from &#39;redux&#39;import counterReducer from &#39;./counterReducer&#39;import todosReducer from &#39;./todosReducer&#39;const rootReducer = combineReducers(&#123;  counter: counterReducer,   // &amp;lt;--- 键名是 state 中的属性, 键值是对应 reducer 函数名  todos: todosReducer&#125;)export default rootReducer&lt;pre&gt;`如果提高需求`&lt;/pre&gt;state  ├── counter: 0  ├── todo        ├── optTime: []        ├── todoList: [] # 这其实就是原来的 todos！&lt;pre&gt;`对应的 reducers 是:`&lt;/pre&gt;reducers/   ├── index.js &amp;lt;-------------- combineReducers (生成 rootReducer)   ├── counterReducer.js   ├── todoReducers/ &amp;lt;--------- combineReducers           ├── index.js           ├── optTimeReducer.js           ├── todoListReducer.js&lt;pre&gt;``&lt;/pre&gt;/*  reducers/index.js */import &#123; combineReducers &#125; from &#39;redux&#39;import counterReducer from &#39;./counterReducer&#39;import todosReducers from &#39;./todosReducer&#39;const rootReducer = combineReducers(&#123;  counter: counterReducer,  todos: todosReducers&#125;)export default rootReducer=================================================/* reducers/todosReducers/index.js */import &#123; combineReducers &#125; from &#39;redux&#39;import optTimeReducer from &#39;./optTimeReducer&#39;import todoListReducer from &#39;./todoListReducer&#39;const todosReducers = combineReducers(&#123;  optTime: optTimeReducer,  todoList: todoListReducer&#125;)export default todosReducers&lt;pre&gt;`无论 dispatch 哪个 action 都会流通**所有** reducer, 但是由于 reducer 是纯函数, 效率还是会提高.### BindActionCreator### applyMiddlware(...middlewares)先要理解 Middleware, enhancerRedux 引入中间件机制是为了在 dispatch 前后进行处理`&lt;/pre&gt;const printStateMiddleware = (&#123;getState&#125;) =&gt; next =&gt; action =&gt; &#123;  console.log(&#39;...&#39;)  let returnValue = next(action)  console.log(&#39;...&#39;)  return returnValue&#125;&lt;pre&gt;`实际上最内层`&lt;/pre&gt;function printStateMiddleware(middlewareAPI)&#123; //中间件内可以使用的 API, 如 getState 与 dispatch   return function(dispatch)&#123; // 传入原 dispatch 的引用    return function(action)&#123;      console.log(...)      var returnValue = dispatch(action)  //  执行 dispatch 行为, dispatch(action) 返回的还是 action      console.log(...)      return returnValue // 传给下一个中间件的 action    &#125;   &#125;&#125;&lt;pre&gt;`### Store Enhancer说白了 Store Enhancer 是对生成 store 的 API 的改造, 与 middleware 的最大区别是 middlewere 不修改 store 的 API改造 store 的 API 就要从 createStore 入口Redux 的 applyMiddleware 就是一个 Enhancer`&lt;/pre&gt;import compose from &#39;./compose&#39; // 作用就是层层包裹// 传入中间件export default function applyMiddleware(...middlewares)&#123;  // 传入 createStore  return function(createStore)&#123;    // 返回一个函数签名和 createStore 一样的函数, 即返回一个增强版的 createStore    return function(reducer, preloadState, enhancer)&#123;      // 用原 createStore 先生成一个 store, 包含 getState, dispatch, subscribe, replaceReducer 四个 API      var store = creataStore(reducer, preloadState, enhancer)&lt;pre&gt;`  var dispatch = store.dispatch //  生成指向原 dispatch的引用  var chain = [] // 存储中间件的数组  //提供给中间件的 API 其实就是 store 的 API  var middlewareAPI = &#123;    getState: store.getStore,    dispatch: (action) =&amp;gt; dispatch(action)  &#125;  // 给中间件添加 API  chain = middlewares.map(middleware =&amp;gt; middleware(middlewareAPI))  // 串联中间件, 添加中间件的起点 store.dispatch, 返回经过修饰的 dispatch  dispatch = compose(...middlewares)(store.dispatch)  return&#123;    ...store, // store 中保留的原 API     dispatch  // 用新的 dispatch 覆盖原 dispatch  &#125;&#125;</code></pre><p>}<br>}</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[参考](https:&#x2F;&#x2F;cnodejs.org&#x2F;topic&#x2F;57bd23ee1d27b9113348a546)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Redux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Middleware</title>
      <link href="/2016/08/23/middleware/"/>
      <url>/2016/08/23/middleware/</url>
      
        <content type="html"><![CDATA[<p>You can include custom middleware functions to the dispatch method of your store.</p><p>The dispatch function is responsible for sending actions to one or more reducer functions for state changes. The composed specialized functions around the original dispatch method creates the new middleware capable dispatch method.</p><p>Source code for applyMiddleware(from Redux 1.0.1)</p><pre><code>export default function applyMiddleware(...middlewares) &#123;  return (next) =&amp;gt;    (reducer, initialState) =&amp;gt; &#123;      var store = next(reducer, initialState);      var dispatch = store.dispatch;      var chain = [];      var middlewareAPI = &#123;        getState: store.getState,        dispatch: (action) =&amp;gt; dispatch(action)      &#125;;      chain = middlewares.map(middleware =&amp;gt; middleware(middlewareAPI));      return &#123;        ...store,        dispatch      &#125;    &#125;&#125;`&lt;/pre&gt;Composing FunctionsFunctional programming is very literal and very mathematical. In the case of composing functions with math you can express two or more functions like this:&lt;pre&gt;`given:f(x) = x^2 + 3x + 1g(x) = 2xthen:(f · g)(x) = f(g(x)) = f(2x) = 4x^2 + 6x + 1`&lt;/pre&gt;It is no coincidence that you can compose two or more functions in a similar fashion. Here is a very simple example of a function that composes two functions to return a new specialized function:&lt;pre&gt;`var greet = function(x) &#123; return `Hello, $&#123;x&#125;`&#125;var emote = function(x) &#123; return `$&#123;x&#125; :)`&#125;var compose = function(f,g)&#123;  return function(x)&#123;    return f(g(x))  &#125;&#125;`&lt;/pre&gt;This was just to illustrate the basic concept. We will look at a more generic way to solve that issue by examining the Redux Code.### CurryingAnother powerful functional programming concepts is the idea of currying or partially applying argument values to a function. By currying we can create a new specialized function that has partial information supplied to it. Here is the canonical example of currying where we have an add function that curries the first operand parameter to create a specialized add function&lt;pre&gt;`var curriedAdd = function(a)&#123;  return function(b)&#123;    return a + b;  &#125;&#125;var addTen = curriedAdd(10);addTen(10); // 20`&lt;/pre&gt;By currying and composing your functions you can create powerful new functions that create a pipeline for data processing.### Redux Dispatch FunctionA Store in Redux have a dispatch method which is only concerned with the main execution task you are interested in. You dispatch actions to your reducer functions to update state of the application. Redux reducers function takes a state and action parameter and return a new resultant state.&lt;pre&gt;`reducer:: state -&amp;gt; action -&amp;gt; state`&lt;/pre&gt;You might dispatch an action that simply sends a message to remove an item in a list which could look like this:&lt;pre&gt;`&#123;type: types.DELETE_ITEM, id: 10&#125;`&lt;/pre&gt;The store will dispatch this action object to all of it&#39;s reducer functions which could affect state. However the reducer functions are only concerned with executing logic around this deletion. They typically don&#39;t care who did it, how long it took, or logging the before and after effects of the state changes. This is where middleware can help us to address non-core concerns.### Redux middlewareRedux middleware is designed by creating functions that can be composed together before the main dispatch method is invoked.Let&#39;s creating a very simple logger middleware function that can echo the state of your application before and after running your main dispatch function. Redux middleware functions have this signiture:&lt;pre&gt;`middleware:: next -&amp;gt; action -&amp;gt; retVal`&lt;/pre&gt;It might look something like this:&lt;pre&gt;`export default function createLogger(&#123;getState&#125;)&#123;  return (next) =&amp;gt;    (action) =&amp;gt; &#123;      const console = window.console;      const prevState = getState();      const returnValue = next(action);      const nextState = getState();      const actionType = String(action.type);      const message = `action $&#123;actionType&#125;`;      console.log(`%c prev state`, `color: #9e9e9e`, prevState);      console.log(`%c action`, `color: #03A9F4`, action);      console.log(`%c next state`, `color:#4CAF50`, nextState)    &#125;;&#125;`&lt;/pre&gt;Notice that createLogger accepts the getState method which is injected by applyMiddleware.js and used inside closure to read the current state. This will return a new function with the `next` parameter which is used to compose the next chained middleware function or the main dispatch function.This function returns a curried function that accepts the action object which can be read or modified before sending it to the next middleware function in the chain. Finally the main dispatch function is invoked with the action object.</code></pre><ul><li><p>First it captures the previous state</p></li><li><p>The action is dispatched to the next middleware function</p></li><li><p>All downstream middleware functions in the chain are invoked</p></li><li><p>The reducer functions in the store are called with the action payload</p></li><li><p>The logger middleware the gets the resulting next state</p><h3 id="Dissecting-applyMiddleware-js"><a href="#Dissecting-applyMiddleware-js" class="headerlink" title="Dissecting applyMiddleware.js"></a>Dissecting applyMiddleware.js</h3><pre>`export default function applyMiddleware(...middlewares){  return (next) =&gt;    (reducer, initialState) =&gt; {      var store = next(reducer, initialState);      var dispatch = store.dispatch;      var chain = [];      var middlewareAPI = {        getState: store.getState,        dispatch: (action) =&gt; dispatch(action)      };      chain = middlewares.map(middleware =&gt; middleware(middlewareAPI));      dispatch = compose(...chain, store.dispatch);      return{        ...store,        dispatch      };    };}`</pre><p>The applyMiddleware function probably could have been named a little better, such as applyMiddlewareToStore.</p><p>The applyMiddleware function returns a function that takes a mysterious next argument:</p><pre>`return (next) =&gt; (reducer, initialState) =&gt; {...}`</pre><p>The next argument will be a function that is used to create a store. By default you should look at the implementation for createStore. The final returned function will be like createStore and replace the dispatch function with it’s associated middlewares.</p><p>Next we assign the store implementation to the function responsible for creating the new store. Then we create a variable to the store’s original dispatch function. Finally we setup an array to hold the middleware chain we will be creating.</p><pre>`var store = next(reducer, initialState)var dispatch = store.dispatchvar chain = [];`</pre><p>This next bit of code injects the getState function and the original dispatch function from the store into each middleware function which you can optionally use in your middleware(the applyMiddleware function pass getState and dispatch to middlewares in it).</p><p>The resultant middleware is stored in the chain array</p><pre>`var middlewareAPI = {  getState: store.getState,  dispatch: (action) =&gt; dispatch(action)}chain = middlewares.map(middleware =&gt; middleware({middlewareAPI}))`</pre><p>Now we create our replacement dispatch function with the information about hte middleware chain:</p><pre>`dispatch = compose(...chain, store.dispatch);`</pre><p>The magic to composing our middleware chain lies in this utility function supplied by Redux. Here is the implementation</p><pre>`export default function compose(...funcs){  return funcs.reduceRight((compsed,f) =&gt; f(composed))}`</pre><p>The composing function will literally express your functions as a composition injecting each middleware as an argument to the next middleware in the chain. Order is important here when assembling your middleware function. Finally, the original store dispatch method is composed. This new looks like:</p><pre>`middlewareI(middlewareJ(middlewareK(store.dispatch)))(action)`</pre><p>The final thing to do is return the new store object with the overriden function:</p><pre>`return {  ...store,  dispatch}`</pre><p>Let’s add our logger middleware we started above into a custom store with the enhanced dispatch function.</p><pre>`import { createStore, applyMiddlware } from 'redux'import loggerMiddleware from 'logger'import rootReducer from './reducers'const createStoreWithMiddleware = applyMiddleware(loggerMiddleware)(createStore)export default function configureStore(initialState){  return createStoreWithMiddleware(rootReducer, initialState);}const store = configureStore()`</pre><h3 id="Asynchronous-Middleware"><a href="#Asynchronous-Middleware" class="headerlink" title="Asynchronous Middleware"></a>Asynchronous Middleware</h3><p>Once you get comfortable with the basics of Redux middleware you will likely want to work with asynchronous actions that involve some sort of asynchronous execution. In particular look at ‘redux-thunk’ for more details. Let’s say you have an action creator that has some async functionality to get stock quote information:</p><pre>`function fetchQuote(symbol){  requestQuote(symbol);  return fetch('......')         .then(req =&gt; req.json())         .then(json =&gt; showCurrentQuote(symbol, json));}`</pre><p>There is no obvious way here to dispatch an action that would be returned from the fetch which is Promise based. Plus we do not have a handle to the dispatch function. Therefore we can use the redux-thunk middleware to defer execution of these operations. By wrapping the execution in a function you can delay this execution:</p><pre>`function fetchQuote(symbol){  return dispatch =&gt; {    dispatch(requestQuote(symbol));    return fetch('......').then(req=&gt;req.json).then(json =&gt; dispatch(showCurrentQuote(symbol,json))  }}`</pre><p>Remember that the applyMiddleware function will inject the <code>dispatch</code> and the <code>getStat</code> function as parameters int o the redux-thunk middleware. Now you can dispatch the resultant action objects to your store which conatains reducers. Here is the middleware function for redux-thunk that does this for you.</p><pre>`export default function thunkMiddleware({dispatch,getState}){  return (next) =&gt;            action =&gt; {              typeof action === 'function'? action(dispatch, getState):next(action)            }}</li></ul><p>If the action is a function it will be called with the dispatch and getState function..</p>]]></content>
      
      
      
        <tags>
            
            <tag> React </tag>
            
            <tag> Redux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Connect 相关</title>
      <link href="/2016/08/22/connect-e7-9b-b8-e5-85-b3/"/>
      <url>/2016/08/22/connect-e7-9b-b8-e5-85-b3/</url>
      
        <content type="html"><![CDATA[<h1 id="预备知识"><a href="#预备知识" class="headerlink" title="预备知识"></a>预备知识</h1><p>回顾一下 Redux 基本用法</p><pre><code>const reducer = (state = &#123;count: 0&#125;, action ) =&amp;gt; &#123;  switch(action.type)&#123;  case &quot;INCRESE&quot;: return &#123;count: state.count + 1&#125;  case &quot;DECRESE&quot;: return &#123;count: state.count - 1&#125;  default: return state;  &#125;&#125;const actions = &#123;  increase: () =&amp;gt; &#123; type: &#39;INCREASE&#39;&#125;,  decrease: () =&amp;gt; &#123; type: &#39;DECREASE&#39;&#125;&#125;const store = createStore(reducer);store.subscribe(()=&amp;gt;&#123;  console.log(store.getState())&#125;);store.dispatch(action.increase());`&lt;/pre&gt;通过 reducer 创建一个 store, 每当我们在 store 上 dispatch 一个 action, store 内的数据就会通过 reducer 变化.我们当然可以直接在 React 中使用 Redux, 在最外层容器中初始化 store, 然后将 state 上的属性作为 props 层层传下去&lt;pre&gt;`class App extends Component&#123;  componentWillMount()&#123;    store.subscribe((state) =&amp;gt; this.setState(state))  &#125;  render()&#123;    return &amp;lt;Comp state=&#123;this.state&#125; onIncrease = &#123;()=&amp;gt;store.dispatch(actions.increase())&#125; onDecrease = &#123;()=&amp;gt; store.dispatch(actions.decrease())&#125;  &#125; /&amp;gt;&#125;`&lt;/pre&gt;但这不是最佳方式, 最佳方式是使用 react-redux 提供的 Provider 和 connect 方法### 使用 React-redux首先在最外层容器中, 把所有内容包裹在 Provider 组件中, 将之前创建的 store 作为 prop 传递给 Provider&lt;pre&gt;`const App = () =&amp;gt; &#123;  return(    &amp;lt;Provider store = &#123;store&#125;&amp;gt;      &amp;lt;Comp /&amp;gt;    &amp;lt;/Provider&amp;gt;  )&#125;`&lt;/pre&gt;Provider 中的任何一个组件(比如这里的 Comp) 如果需要使用 state 中的数据, 就必须是 `被 connect 过的`组件, 使用 connect 方法对你编写的组件(MyComp)进行包装后的产物.&lt;pre&gt;`class MyComp extends Component &#123;  // content...&#125;const Comp = connect(...args)(MyComp);`&lt;/pre&gt;可见 connect 是重中之重### connect 详解究竟 connect 做了什么首先看一下函数的签名:&lt;pre&gt;`connect([mapStatToProps], [mapDispatchToProps], [mergeProps], [options])`&lt;/pre&gt;connect() 函数接受四个参数, 分别是&lt;pre&gt;`mapStatToProps, mapDispatchToProps, mergeProps, options`&lt;/pre&gt;&lt;pre&gt;`mapStatToProps(state, ownProps): stateProps`&lt;/pre&gt;这个函数允许我们将 store 中的数据作为 props 绑定到组件上&lt;pre&gt;`const mapStatToProps = (state) =&amp;gt; &#123;  return &#123;    count: state.count  &#125;&#125;`&lt;/pre&gt;这个函数的第一个参数就是 Redux 的 store, 我们从中摘取 count 属性, 因为返回了具有 count 属性的对象, 所以 MyComp 会有名为 count 的 props 字段&lt;pre&gt;`class MyComp extends Component&#123;  render()&#123;    return &amp;lt;div&amp;gt;Count: &#123;this.props.count&#125;&amp;lt;/div&amp;gt;  &#125;&#125;const Comp = connect(...args)(MyComp);`&lt;/pre&gt;当然你不必将 state 原封不动传递给组件, 可以根据 state 中的数据, 动态的输出组件需要的(最小)属性&lt;pre&gt;`const mapStateToProps = (state) =&amp;gt; &#123;  return &#123;    greaterThanFive: state.count &amp;gt; 5  &#125;&#125;`&lt;/pre&gt;第二个参数 ownProps, 是 MyComp 自己的 props, 有时候 ownProps 也会对其产生影响, 比如当你在 store 中维护一个用户列表, 而你的组件 MyComp 只关心一个用户(通过 props 中的 userId体现)&lt;pre&gt;`const mapStateToProps = (state, ownProps) =&amp;gt; &#123;  // state 是&#123; userList:[&#123;id:0,name;&#39;王二&#39;&#125;]&#125;  return &#123;    user: _.find(state.userList, &#123;id:ownProps.userId&#125;)  &#125;&#125;class MyComp extends Component&#123;  static PropTypes = &#123;    userId: PropTypes.string.isRequired,    user: PropTypes.object  &#125;;  render()&#123;    return &amp;lt;div&amp;gt;UserName: &#123;this.props.user.name&#125;&amp;lt;/div&amp;gt;  &#125;&#125;const Comp = connect(mapStateToProps)(MyComp)`&lt;/pre&gt;当 state 变化, 或者 ownProps 变化时, mapStateToProps 都会被调用, 计算出一个新的 stateProps , 在与 ownProps merge 后, 更新给 MyComp这就是将 Redux store 中的数据连接到组件的基本方法mapDispatchToProps(dispatch, ownProps): dispatchPropsconnect 的第二个参数是 mapDispatchToProps, 功能是将 action 作为 props 绑定到 MyComp 上&lt;pre&gt;`const mapDispatchToProps = (dispatch, ownProps) =&amp;gt; &#123;  return &#123;    increase: (...args) =&amp;gt; dispatch(actions.increase(...args)),    decrease: (...args) =&amp;gt; dispatch(actions.decrease(...args))  &#125;&#125;class MyComp extends Component&#123;  render()&#123;    const &#123;count, increase, decrease&#125; = this.props    return (      &amp;lt;div&amp;gt;        &amp;lt;div&amp;gt;Count:&#123;count&#125;&amp;lt;/div&amp;gt;        &amp;lt;button onClick=&#123;increase&#125;&amp;gt;+&amp;lt;/button&amp;gt;        &amp;lt;button onClick=&#123;decrease&#125;&amp;gt;-&amp;lt;/button&amp;gt;      &amp;lt;/div&amp;gt;    )  &#125;&#125;const Comp = connect(mapStateToProps, mapDispatchToProps)(MyComp)`&lt;/pre&gt;由于 mapDispatchToProps 方法返回了具有 increase 属性和 decrease 属性的对象, 这两个属性也会成为 MyComp 的 props如上所示, 调用 actions.increase()只能得到一个 action 对象&#123;type:&#39;INCREASE&#39;&#125;, 要触发这个 action 必须要通过 dispatch 调用, dispatch 正式 mapDispatchToProps 的第一个参数, 但是为了不让 MyComp 组件感知到 dispatch 的存在, 我们需要将 increase 和 decrease 方法包装一下, 使之成为直接可以被调用的函数(即触发该方法就会触发 dispatch)Redux 本身提供了 bindActionCreator 函数, 来将 action 包装成可以直接被调用的函数&lt;pre&gt;`import &#123;bindActionCreator&#125; from &#39;redux&#39;const mapDispatchToProps = (dispatch,ownProps) =&amp;gt; &#123;  return bindActionCreator(&#123;    increase: actions.increase,    decrease: actions.decrease  &#125;)&#125;</code></pre><p>同样当 ownProps 变化时, 该函数也会被调用, 生成一个新的 dispatchProps( 在与 stateProps 和 ownPorps merge 后), 更新给 MyComp. 注意 action 的变化不会引起上述过程, 默认 action 在组件的生命周期中是固定的</p><p>[mergeProps(stateProps, dispatchProps, ownProps): props]</p><p>之前说过不管是 stateProps 还是 dispatchProps, 都需要和 ownProps merge 之后才会被赋给 MyComp, connect 的第三个参数就是来做这个事情的, 通常情况下不需要传这个参数, connect 会使用 Object.assign 方法代替该方法.</p><h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p>最后还有一个 options 参数, 比较简单, 一般也不会用到.</p><p><a href="http://taobaofed.org/blog/2016/08/18/react-redux-connect/">参考</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> React </tag>
            
            <tag> Redux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Configuring ESLint</title>
      <link href="/2016/08/22/configuring-eslint/"/>
      <url>/2016/08/22/configuring-eslint/</url>
      
        <content type="html"><![CDATA[<ol><li>Configuration Comments - use JS comments to embed configuration information directly into a file.</p></li><li>Configuration Files - use a JS, JSON, or YAML file to specify configuration information for an entire directory and all of its subdirectories. This can be in the form of an <code>.eslintrc</code> file or an <code>eslintConfig</code> field in a <code>package.json</code> file, both of which ESLint will look for and reed automatically, or you can specify a configuration file on the command line.</li></ol><h3 id="Specifying-Parser-Options"><a href="#Specifying-Parser-Options" class="headerlink" title="Specifying Parser Options"></a>Specifying Parser Options</h3><p>ESLint allows you to specify the JS language options you want to support. By Default, ESLint support only ES5 syntax. You can override that setting to enable support for ES6 and 7 as well as JSX by using parser options.<p>Parser options are set in your <code>.eslintrc</code> file by using the <code>parserOptions</code> property. The available options are:</p><ul><li><p><code>ecmaVersion</code> - set to 3, 5(default), 6 or 7 to specify the version of ECMAScript you want to use.</p></li><li><p><code>sourceType</code> - set to <code>&quot;script&quot;</code> (default) or <code>&quot;module&quot;</code> if your code is in ECMAScript modules.</p></li><li><p><code>emcaFeatures</code> - an object indicating which additional language features you’d like to use:</p><pre><code>*   `globalReturn` - allow `return` statements in the global scope.</code></pre><ul><li><code>impliedStrict</code> - enable global <code>strict mode</code> (if <code>ecmaVersion</code> is 5 or greater)</li><li><code>jsx</code>: enable <code>JSX</code></li><li><code>experimentalObjectRestSpread</code> - enable support for the experimental <code>object rest/spread properties</code></li></ul></li></ul><p>An example:</p><pre><code>&#123;  &quot;parserOptions&quot;:&#123;    &quot;emcaVersion&quot;: 6,    &quot;sourceType&quot;: &quot;module&quot;,    &quot;ecmaFeatures&quot;: &#123;      &quot;jsx&quot;: true    &#125;  &#125;,  &quot;rules&quot;:&#123;    &quot;semi&quot;: 2  &#125;&#125;`&lt;/pre&gt;### Specifying ParserBy Default, ESLint uses `Espree` as its parser. You can optionally specify that a different parser should be used in your configuration file so long as the parser meets the following requirements:</code></pre><ul><li><p>It must be an npm module installled locally;</p></li><li><p>It must have an Esprima-compatible interface</p></li><li><p>It must produce Esprima-compatible AST and token objects.</p><h3 id="Specifying-ENV"><a href="#Specifying-ENV" class="headerlink" title="Specifying ENV"></a>Specifying ENV</h3></li><li><p>browser</p></li><li><p>node</p></li><li><p>commonjs</p></li><li><p>es6</p></li><li><p>mocha</p><pre>`{  "env":{    "browser": true,    "node": true  }}### Configuring RulesESLint comes with a large number of rules, you can modify which rules your project use either using configuration comments or configuration files. To change a rules setting, you must set the rule ID equal to one of these values:- `"off"` or `0` to turn rule off.- `"warn"` or `1` to turn the rule as a warning(doesn't affect exit code)- `"error"` or `2` to turn the rule on as an error(exit code is 1 when triggered)### Demo`</pre><p>npm install -g eslint</p><pre>`</li></ul><p>eslint –init</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">生成&#96;.eslintrc.js&#96;</span><br><span class="line"></span><br><span class="line">但是这个文件最好手动生成</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> ESLint </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JS 开发工具</title>
      <link href="/2016/08/21/js-e5-bc-80-e5-8f-91-e5-b7-a5-e5-85-b7/"/>
      <url>/2016/08/21/js-e5-bc-80-e5-8f-91-e5-b7-a5-e5-85-b7/</url>
      
        <content type="html"><![CDATA[<p>开发工具是让开发人员工作更轻松的一些软件, 传统上包括集成开发环境, 代码检查工具, 编译器, 调试工具和性能测试工具</p><p>但是 JS 是一种动态语言, 伴随他动态本质而来的是对更多运行时开发者工具的需求.</p><h4 id="Quick-List"><a href="#Quick-List" class="headerlink" title="Quick List"></a>Quick List</h4><ul><li>Atom &amp; Atom-ternjs</li><li>Chrome DevTools</li><li>PageSpeed Insights</li><li>BrowserSycn</li><li>TraceGL</li><li>ironNode</li><li>ESLint</li><li>Babel</li><li>React</li><li>Webpack + Hot Module Replacement</li><li>Redux + Redux DevTools</li></ul><p>关于工具, 主要是编辑器和运行时环境(比如浏览器)</p><p>主要用 Atom, 需要 atom-ternjs 来开启 JavaScript 智能识别</p><p>很多很棒的 <a href="https://medium.com/@satya164/supercharged-javascript-development-in-atom-ea034e22eabc#.a2b8sthbw">Atom 插件</a></p><p>调试器: Chrome DevTools, 注意其 flame charts 和 dominators view 功能</p><p>性能审查: <a href="https://www.youtube.com/watch?list=PLOU2XLYxmsILKwwASNS0xgfcmakbK_8JZ&v=bDUDuQy3R7Y">PageSpeed Insights</a></p><p>BrowserSync 是一款测试响应式布局非常好用的工具, 可以一次模拟多种浏览器(电脑, 平板, 手机)<br>可以监视文件, 并在文件修改的时候自动重载同步刷新浏览器, 像滚动, 点击, 表单交互等动作也会跨设别同步.</p><p><a href="https://www.youtube.com/watch?v=heNWfzc7ufQ">视频链接</a></p><p>TraceGL 是一种运行时调试工具, 可以让你在软件中的方法实时调用时观察他们, 而不是手动逐步跟踪代码</p><p><a href="https://www.youtube.com/watch?v=heNWfzc7ufQ">视频链接</a></p><p>代码检查: ESLint 可配置性特别强, 每一个选项都可以设置开启或禁用, 甚至给他们添加参数. 可以创建自己的规则, 支持插件</p><p>Babel 是一种编译器, 可以让现在的 JS 代码使用 ES6+ 尚未支持的特性, JSX 等, 工作原理是讲代码转换为等价的 ES5.</p><p><a href="https://medium.com/javascript-scene/how-to-use-es6-for-isomorphic-javascript-apps-2a9c3abe5ea2">文章链接</a></p><p>Webpack 会将模块和以来打包成针对浏览器的静态资源, 他支持大量有趣的特性, 比如模块热拔插, 可以让当前浏览器中的代码在你修改文件的时候自动更新, 而不用刷新页面. 模块热拔插</p><p><a href="https://github.com/cloverfield-tools/universal-react-boilerplate">参考资料</a></p><p>React: 不算开发者工具</p>]]></content>
      
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>部署React + Redux 的 Web 开发环境</title>
      <link href="/2016/08/20/e9-83-a8-e7-bd-b2react-redux-e7-9a-84-web-e5-bc-80-e5-8f-91-e7-8e-af-e5-a2-83/"/>
      <url>/2016/08/20/e9-83-a8-e7-bd-b2react-redux-e7-9a-84-web-e5-bc-80-e5-8f-91-e7-8e-af-e5-a2-83/</url>
      
        <content type="html"><![CDATA[<p>好的部署需要做到两点:<br>1. 性能优化: 包括代码执行速度, 页面载入速度<br>2. 自动化: 减少重复工作</p><p>使用 React+Redux 的时候往往会用到其调试工具 Redux DevTools, 在手动配置 DevTools 时需要针对 Store 和 Component 进行一些配置, 然而这些都是为了方便调试的, 生产环境下我们不希望加入这些东西, 所以建议从代码上隔离 development 和 production 环境:</p><pre><code>containers/  Root.js  Root.dev.js  Root.prod.js  ...store/  index.js  store.dev.js  store.prod.js`&lt;/pre&gt;同时采用单独的入口文件, 比如上面的 containers/Root.js, 按需要加载不同环境的代码&lt;pre&gt;`if (process.env.NODE_ENV === &#39;production&#39;)&#123;  module.exports = require(&#39;./Root.prod&#39;);&#125; else &#123;  module.exports = require(&#39;./Root.dev&#39;);&#125;`&lt;/pre&gt;有一个细节需要注意: ES6 语法不支持在 if 中书写 import 语句, 所以这里采用了 CommonJS 的模块引入方法 require.另一个需要注意的地方是按需要 import, 否则可能在打包的时候引入不必要的代码使用 webpack 进行打包工作&lt;pre&gt;`webpack --config webpack.config.prod.js --progress`&lt;/pre&gt;注意要为不同的环境准备不同的 webpack 配置文件. 比如 `webpack.config.dev.js` 和 `webpack.config.prod.js` . 看一下比较关键的配置选项### devtools启用 source-map, 这样 webpack 会生成两个包- bundle.js- bundle.js.map把用于定位源码的 source map 分离出去, 减少 bundle.js 的体积source-map 只会在浏览器 devtools 激活时加载, 并不会影响正常页面的饿加载速度.### plugins&lt;pre&gt;`plugins:[  new webpack.optimize.UglifyJsPlugin(&#123;    compress:&#123;      warning: false    &#125;  &#125;),  new webpack.optimize.DedupePlugin(),  new webpack.optimize.OccurenceOrderPlugin()]`&lt;/pre&gt;### 不要忽视 NODE_ENVNODE_ENV 其实就是一个环境变量, 在 Node 中 可以通过`process.env.NODE_ENV`获取, 目前大家汪汪用这个变量区分当前是 development 还是 production.通过 webpack 的 DefinePlugin 设置环境变量:&lt;pre&gt;`plugins:[  ...  new webpack.DefinePlugin(&#123;    &#39;process.env.NODE_ENV&#39;: JSON.stingify(&#39;production&#39;)  &#125;)]### 添加 hash前端公认的 Best Practice 就是给资源打上 hash 标签, 这对缓存静态资源很有用1\. 给 bundle.js 添加 hash 标签`&lt;/pre&gt;output&#123;  path: ...  filename: &#39;bundle.[hash].js&#39;&#125;&lt;pre&gt;`使用 html-webpack-plugin 这个插件自动生成带有`&lt;/pre&gt;&amp;lt;script src=&#39;bundle.[hash].js&gt;&amp;lt;/script&gt;&#39;的 html 文件&lt;pre&gt;`配置如下:`&lt;/pre&gt;plugins:[  ...  new HtmlWebpackPlugin(&#123;    title:&#39;html title&#39;,    template:&#39;./template.html&#39;,    favicon: &#39;./static/images/logo.ico&#39;  &#125;)]&lt;pre&gt;`配置 template.html`&lt;/pre&gt;&lt;!DOCTYPE html&gt;&amp;lt;html&gt;&amp;lt;head&gt;  &lt;meta charset=&quot;utf-8&quot;&gt;  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1.0&quot;&gt;&amp;lt;/head&gt;&amp;lt;body&gt;&lt;div id=&quot;react-container&quot;&gt;&lt;/div&gt;&amp;lt;/body&gt;&amp;lt;/html&gt;&lt;pre&gt;`如果需要在 React Component 中添加图片, 建议采用`&lt;/pre&gt;import LOGO.png from &#39;./static/images/logo.png&#39;&amp;lt;img src=&#123;LOGO.png&#125; alt=&quot;&quot; /&gt;&lt;pre&gt;`使用 import 或 require 可以让 webpack 对图片进行打包使用 file-loader 可以对图片添加 hash 标签然后返回相应的 URL</code></pre><p>module:{<br>loaders:[<br>{<br>test: /&#46;(png|jpg),<br>loader:”file?name=[hash].[ext]”<br>}<br>]<br>}</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 引入 CSS</span><br><span class="line"></span><br><span class="line">可以直接在 js 文件中 &#96;require(&#39;.&#x2F;foo.css&#39;)&#96;, 然后使用 style-loader 和 css-loader 进行处理, 最终效果是将 css 嵌入到 HTML 的 style 标签中, 这样就不需要使用 hash</span><br><span class="line"></span><br><span class="line">CSS 较大的话, 可以考虑使用 extract-text-webpack-plugin 插件将 CSS 合并后独立为一个文件, 并自定在页面加载的时候添加 link 标签</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> React </tag>
            
            <tag> Redux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Webpack 常用 Plugin 和 Loader</title>
      <link href="/2016/08/19/webpack-e5-b8-b8-e7-94-a8-plugin-e5-92-8c-loader/"/>
      <url>/2016/08/19/webpack-e5-b8-b8-e7-94-a8-plugin-e5-92-8c-loader/</url>
      
        <content type="html"><![CDATA[<h3 id="常用-Loader"><a href="#常用-Loader" class="headerlink" title="常用 Loader"></a>常用 Loader</h3><p>html 相关</p><pre><code>html-loader`&lt;/pre&gt;css 相关&lt;pre&gt;`style-loadercss-loaderautoprefixer-loadersass-loader`&lt;/pre&gt;js 相关&lt;pre&gt;`babel-loaderbabel-corebabel-preset-es2015babel-preset-reactbabel-preset-stage3eslint-loader`&lt;/pre&gt;### 常用插件Plugin#### config 类&lt;pre&gt;`NormalModuleReplacementPluginContextReplacementPluginIgnorePluginPrefetchPlugin`&lt;/pre&gt;#### Optimize&lt;pre&gt;`DedupePluginLimitChunkCountPluginOccurenceOrderPluginUglifyJsPluginCommonsChunkPlugin`&lt;/pre&gt;#### 其他&lt;pre&gt;`HotModuleReplacementPluginNoErrorPluginProgressPluginHtmlWebpackPlugin</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> Webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ImmutableJS Introduction</title>
      <link href="/2016/08/19/immutablejs-introduction/"/>
      <url>/2016/08/19/immutablejs-introduction/</url>
      
        <content type="html"><![CDATA[<p>Immutable data cannot be changed once created, leading to much simpler application development, no defensive copying, and enabling advanced memoization and change detection techniques with simple logic. Persistent data presetns a mutative API which does not update the data in-place, but instead always yields new updated data.</p><p>Immutable.js provides many Persistent Immutable data structures including: <code>List</code>, <code>Stack</code>, <code>Map</code>, <code>OrderedMap</code>, <code>Set</code>, <code>OrderedSet</code> and <code>Record</code>.</p><p>These data structures are highly efficient on modern JavaScript VMs by using structural sharing via ‘hash maps tries’ and ‘vector tries’ as popularized by Clojure and Scala, minimizing the need to copy or cache data.</p><p>Immutable also provides a lazy <code>Seq</code>, allowing efficient chaining of collection methods like <code>map</code> and <code>filter</code> without creating intermediate representations. Create some <code>Seq</code> with <code>Range</code> and <code>Repeat</code>.</p><h3 id="Getting-Started"><a href="#Getting-Started" class="headerlink" title="Getting Started"></a>Getting Started</h3><p><code>npm install Immutable</code></p><p><code>var Immutable = require(&#39;immutable&#39;); var map1 = Immutable.Map(&#123;a:1,b:2,c:3&#125;); var map2 = map1.set(&#39;b&#39;,50); map1.get(&#39;b&#39;); //2 map2.get(&#39;b&#39;); //50</code></p><h3 id="The-case-for-Immutability"><a href="#The-case-for-Immutability" class="headerlink" title="The case for Immutability"></a>The case for Immutability</h3><p>Much of what makes application development difficult is tracking mutation and maintaining state. Development with immutable data encourages you to think differently about how data flows through your application.</p><p>Subscribing to data event throughout your application.</p><p>Immutable data never change.</p><p>Immutable collections should be treated as <em>value</em> rather than <em>object</em>. While objects represents some thing which could change over time, a value represents the state of that thing at a particular instance of time. This principle is most important to understanding the appropriate use of immutable data. In order to treat Immutable.js collections as values, it’s important to use the <strong>Immutable.is()</strong> function or <strong>.equals()</strong> method to determine value equality instead of <code>===</code> operator which determines object reference identity.</p><p><code>var map1 = Immutable.Map(&#123;a:1,b:2,c:3&#125;); var map2 = map1.set(&#39;b&#39;,2); assert(map1.equals(map2) === true); var map3 = map1.set(&#39;b&#39;,50); assert(map1.equals(map3) === false);</code></p><p><strong>Note</strong>: As a performance optimization <strong>Immutable</strong> attempts to return the existing collection when an operation would result in an identical collection, allowing for using <code>===</code> reference equality to determine if something definitely has not changed. This can be extremely useful when used within memoization function which would prefer to re-run the function if a deeper equality check could potentially be more costly. The <code>===</code> equality check is also used internally by <strong>Immutable.js</strong> and <code>equals()</code> as a performance as a performance optimization.</p><p>If an object is immutable, it can <strong>be ‘copied’ simply by marking another reference</strong> to it instead of copying the entire object. Because a reference is much smaller than the object itself, this results in memory savings and a potential boost in execution speed for programs which rely on copies(such as an undo-stack).</p><p><code>var map1 = Immutable.Map(&#123;&#39;a&#39;:1,&#39;b&#39;:2,&#39;c&#39;:3&#125;); var clone = map1;</code></p><h3 id="JavaScript-first-API"><a href="#JavaScript-first-API" class="headerlink" title="JavaScript-first API"></a>JavaScript-first API</h3><p>While <code>immutable</code> is inspired by Clojure, Scala, Haskell and other functional programming environments, it’s designed to bring these powerful concepts to JavaScript, and therefore has an Object-Oriented API that closely mirrors that of <strong>ES6 Array, Map, and Set</strong>.</p><p>The difference for the immutable collections is that methods which would mutate the collection, like <code>push</code>, <code>set</code>, <code>unshift</code>, or <code>splice</code> instead of return a new immutable collection. Methods which return new array like <code>slice</code> or <code>concat</code> instead return new immutable collections.</p><p><code>var list1 = Immutable.List.of(1,2); var list2 = list1.push(3,4,5); var list3 = list2.unshift(0); var list4 = list1.concat(list2,list3); assert(list1.size === 2); assert(list2.size === 5); assert(list3.size === 6); assert(list4.size === 13); assert(list4.get(0) === 1);</code></p><p>Almost all of the methods on <strong>Array</strong> will be found in similar form on <strong>Immutable.List</strong>, those of <strong>Map</strong> found on <strong>Immutable.Map</strong> and those of <strong>Set</strong> found on<strong>Immutable.Set</strong>, including collection operation like <strong>forEach()</strong>, and <strong>map()</strong>.</p><p><code>var alpha = Immutable.Map(&#123;a:1,b:2,c:3,d:4&#125;); alpha.map((v,k) =&amp;gt; k.toUpperCase()).join(); // &#39;A,B,C,D&#39;</code></p><h3 id="Accepts-raw-JavaScript-objects"><a href="#Accepts-raw-JavaScript-objects" class="headerlink" title="Accepts raw JavaScript objects"></a>Accepts raw JavaScript objects</h3><p>‘immutable’ accepts plain JavaScript Arrays and Objects anywhere a mehtod expects an <strong>Iterable</strong> with no performance penalty.</p><p><code>var map1 = Immutable.Map(&#123;a:1,b:2,c:3,d:4&#125;); var map2 = Immutable.Map(&#123;c:10,a:20,t:30&#125;); var obj = &#123;d:100,o:200,g:300&#125;; var map3 = map1.merge(map2,obj); // Map &#123;a:20,b2,c:10,d:100,t:30,o:200,g:300&#125;</code></p><p><strong>Immutable</strong> can treat any JavaScript Array or Object as an Iterable. You can take advantage of this in order to get sophisticated collection methods on JavaScript Objects, which otherwise have a very sparse native API.</p><p><code>var myObject = &#123;a:1,b:2,c:3&#125;; Immutable.Seq(myObject).map(x=&amp;gt;x*x).toObject(); // &#123;a:1,b:4,c:9&#125;;</code></p><p>Keep in Mind, when using JS objects to construct Immutable Maps, that JS Object properties are always <strong>strings</strong>, even if written in a quote-less shorthand, while Immutable Map accept keys of any type.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">  var obj &#x3D; &#123;1: &amp;#039;one&amp;#039;&#125;;</span><br><span class="line">  Object.keys(obj); &#x2F;&#x2F; [&amp;#039;1&amp;#039;]</span><br><span class="line">  obj[1]; &#x2F;&#x2F; &amp;#039;one&amp;#039;</span><br><span class="line">  obj[&amp;#039;1&amp;#039;]; &#x2F;&#x2F; &amp;#039;one&amp;#039;</span><br><span class="line"></span><br><span class="line">var map &#x3D; Immutable.fromJS(obj);</span><br><span class="line">  map.get(&amp;#039;1&amp;#039;); &#x2F;&#x2F; &amp;#039;one&amp;#039;</span><br><span class="line">  map.get(1); &#x2F;&#x2F; undefined</span><br></pre></td></tr></table></figure><p>Property access for JS Object first converts the key to a string, but since Immutable Map keys can be of any type the argument to <code>get()</code> is not altered.<br>Namely Immutable Map will treat ‘1’ and 1 differently.</p><h3 id="Converts-Back-to-Raw-JS-Obejcts"><a href="#Converts-Back-to-Raw-JS-Obejcts" class="headerlink" title="Converts Back to Raw JS Obejcts"></a>Converts Back to Raw JS Obejcts</h3><p>All <strong>Immutable</strong> Iterable can be converted to plain JS Arrays and Objects shallowly with <code>toArray()</code> and <code>toObject()</code> or deeply with <code>toJS()</code>. All Immutable Iterables also implement <code>toJSON()</code> allowing them to be passed to <code>JSON.stringify()</code> directly.</p><p><code>var deep = Immutable.Map(&#123;a:1,b:2,c:Immutable.List.of(3,4,5)&#125;); deep.toObject() // &#123;a:1,b:2,c:List [3,4,5]&#125; deep.toArray() // [1,2,List [3,4,5]] deep.toJS() // &#123;a:1,b:2,c:[3,4,5]&#125; JSON.stringify(deep) // &#39;&#123;&quot;a&quot;:1,&quot;b&quot;,&quot;c&quot;:[3,4,5]&#125;&#39;</code></p><h3 id="Embraces-ES6"><a href="#Embraces-ES6" class="headerlink" title="Embraces ES6"></a>Embraces ES6</h3><p><code>Immutable</code> takes advantage of features added to JS ES6, the latest standard version of ECMAScript, including <code>Interators</code>,<code>Arrow Function</code>, <code>Classes</code>, and <code>Modules</code>.</p><h3 id="Nested-Structures"><a href="#Nested-Structures" class="headerlink" title="Nested Structures"></a>Nested Structures</h3><p>The collections in <code>immutable</code> are intended to be nested, allowing for deep trees of data, similar to JSON</p><p><code>var nested = Immutable.fromJS(&#123;a:&#123;b:&#123;c:[3,4,5]&#125;&#125;&#125;) // Map&#123; a: Map &#123; b: Map &#123; c: List [3,4,5]&#125;&#125;&#125;</code><br>A few power-tool allow for reading and operating on nested data. The most useful are <code>mergeDeep</code>, <code>getIn</code>, <code>setIn</code> and <code>updateIn</code> found on <code>List</code>, <code>Map</code> and <code>OrderedMap</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">  var nested2 &#x3D; nested.mergeDeep(&#123;a:&#123;b:&#123;d:6&#125;&#125;&#125;)</span><br><span class="line">  &#x2F;&#x2F; Map &#123;a: Map &#123; b: &#123; c: List [3,4,5], d: 6&#125;&#125;&#125;</span><br><span class="line"></span><br><span class="line">nested2.getIn([&amp;#039;a&amp;#039;,&amp;#039;b&amp;#039;,&amp;#039;d&amp;#039;]); &#x2F;&#x2F;6</span><br><span class="line"></span><br><span class="line">var nested3 &#x3D; nested2.updateIn([&amp;#039;a&amp;#039;,&amp;#039;b&amp;#039;,&amp;#039;d&amp;#039;], value &#x3D;&gt; value + 1); d &#x3D;&gt; 7</span><br><span class="line"></span><br><span class="line">var nest4 &#x3D; nested3.updateIn([&amp;#039;a&amp;#039;,&amp;#039;b&amp;#039;,&amp;#039;c&amp;#039;], list &#x3D;&gt; list.push(6)); c &#x3D;&gt; List [3,4,5,6]</span><br></pre></td></tr></table></figure><h3 id="Lazy-Seq"><a href="#Lazy-Seq" class="headerlink" title="Lazy Seq"></a>Lazy Seq</h3><p><strong>Seq</strong> describes a lazy operation, allowing them to efficiently chain use all the Iterable methods.(such as map and filter)</p><p><strong>Seq is immutable</strong> – Once a Seq is created it cannot be changed, appended to, rerranged or otherwise modified. Instead, any mutative method called on a Seq will return a new Seq.</p><p><strong>Seq is lazy</strong> – Seq does as little work as necessary to respond to any method call.</p><p>Once the Seq is used, it performs only the work necessary.</p><p>Any collection can be converted to a lazy Seq with <code>toSeq()</code>.</p><p><code>var seq = Immutable.Map(&#123;a:1,b:2,c:3&#125;).toSeq();</code></p><p>Seq allow for the efficient chaining of sequence operations, especially when converting to a different concrete type(such as to a JS Object)</p><p><code>seq.flip().map(k =&amp;gt; k.toUpperCase()).flip().toObject(); // Map &#123;A: 1, B:2, C:3&#125;</code></p><h3 id="Equality-treats-Collection-as-Data"><a href="#Equality-treats-Collection-as-Data" class="headerlink" title="Equality treats Collection as Data"></a>Equality treats Collection as Data</h3><p><strong>Immutable</strong> provides equality which treats immutable data structures as pure data, performing a deep equality check if necessary.</p><p><code>var map1 = Immutable.Map(&#123;a:1,b:1,c:1&#125;); var map2 = Immutable.Map(&#123;a:1,b:1,c:1&#125;); assert(map1 !== map2) // two different instance, not same address assert(Immutable.is(map1,map2)); // have equivalent values assert(map1.equals(map2)); // alternatively use the equals methods.</code></p><p><strong>Immutable.is()</strong> uses the same measure of equality as <strong>Object.is</strong> including if both are immutable and all keys and values are equal using the same measure of equality.</p><h3 id="Batching-Mutations"><a href="#Batching-Mutations" class="headerlink" title="Batching Mutations"></a>Batching Mutations</h3><p>Applying a mutation to create a new immutable object results in some overhead, which can add up to a minor performance penalty. If you need to apply a series of mutations locally before returning, <strong>Immutable</strong> gives you the ability to create a temporary mutable(transient) copy of a collection and apply a batch of mutations in a performance manner by using <code>withMutations</code>. In fact, this is exactly how <code>Immutable</code> applies complex mutations itself.</p><p>As an example, building <code>list2</code> results in the creation of 1 , not 3, new immutable Lists<br><code>var list1 = Immutable.List.of(1,2,3); var list2 = list1.withMutations(function(list)&#123; list.push(4).push(5).push(6) &#125;); assert(list1.size === 3); assert(list2.size === 6);</code></p><p><strong>Note</strong>: <strong>Immutable</strong> also provides <code>asMutable</code> and <code>asImmutable</code>, but only encourages their use when <code>withMutations</code> will not suffice. Use caution to not return a mutable copy could result in undesired behavior.</p><p><strong>important</strong>: Only a select few method can be used in <code>withMutations</code> including <code>set</code>, <code>push</code>, <code>pop</code>. These methods can be applied directly against a persistent data-structure where other methods like <code>map</code>,<code>filter</code>,<code>sort</code>and <code>splice</code> will always return new immutable data-structure and never mutate a mutable collection.</p>]]></content>
      
      
      
        <tags>
            
            <tag> Redux </tag>
            
            <tag> Functional Program </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redux 搭配 React</title>
      <link href="/2016/08/16/redux-e6-90-ad-e9-85-8d-react/"/>
      <url>/2016/08/16/redux-e6-90-ad-e9-85-8d-react/</url>
      
        <content type="html"><![CDATA[<p>第一步是初始化 react 组件</p><pre><code>getInitialState()&#123;  return&#123;    item: store.getState()  &#125;&#125;`&lt;/pre&gt;第二步是在组件 render 后调用 subscribe 函数, 每次 redux 发生 dispatch 的时候都要调用 react 的 setState&lt;pre&gt;`componentDidMount()&#123;  var unsubscribe = store.subscribe(this.onChange)&#125;onChange()&#123;  this.setState(&#123;    item: store.getState()  &#125;)&#125;</code></pre><p>React 会根据 State 的变化重新 render 组件<br>this.state.item.todos.map()</p>]]></content>
      
      
      
        <tags>
            
            <tag> React </tag>
            
            <tag> Redux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CommonChunks 插件</title>
      <link href="/2016/08/16/commonchunks-e6-8f-92-e4-bb-b6/"/>
      <url>/2016/08/16/commonchunks-e6-8f-92-e4-bb-b6/</url>
      
        <content type="html"><![CDATA[<p>作用就是提取代码中的公共模块, 然后将公共模块打包到一个独立的文件中, 以便在其他的入口和模块中使用.</p><pre><code>// in main.jsvar a = require(&#39;./a&#39;);a.sayHello();var b = require(&#39;./b&#39;);b.sayHello();var c = require(&#39;./c&#39;);c.sayHello()`&lt;/pre&gt;&lt;pre&gt;`// in main2.jsvar a = require(&#39;./a&#39;);a.sayHello();var b = require(&#39;./b&#39;);b.sayHello();`&lt;/pre&gt;a, b, c 和之前一样, 只有一个 sayHello 方法.打包后看到`bundle.main.js` 和`bundle.main2.js` 中分别包含了 a, b, c 三个模块, 其中 a, b 是要使用`CommonChunksLoader` 提取出来的公共模块.### 配置 CommonChunksLoader&lt;pre&gt;`var webpack = require(&#39;webpack&#39;);module.exports = &#123;  entry:&#123;    main1: &#39;./main&#39;,    main2: &#39;./main2&#39;  &#125;,  output:&#123;    filename: &#39;bundle.[name].js&#39;  &#125;,  plugins:[    new webpack.optimize.CommonsChunkPlugin(&#39;common.js&#39;,[&#39;main1&#39;,&#39;main2&#39;])  ]&#125; ;`&lt;/pre&gt;第一行中, 添加 webpack 引用, 然后添加`plugins` 选项, 引用`webpack.optimize.CommonsChunkPlugin` 来提取公共模块, 参数`common.js` 表示公共模块的文件名, 后面的数组表示依赖这个模块的入口文件.重新打包后, 生成三个文件&lt;pre&gt;`bundle.main1.js,bundle.main2.jscommon.js</code></pre><p>其中 <code>bundle.main1.js</code> 只包含了<code>c</code>模块, <code>bundle.main2.js</code>则没包含任何模块.</p><p>当然, 生成了<code>common.js</code> 还需要在 html 中进行引用, 而且要先于 main1, main2</p>]]></content>
      
      
      
        <tags>
            
            <tag> Webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Webpack 发布配置</title>
      <link href="/2016/08/16/webpack-e5-8f-91-e5-b8-83-e9-85-8d-e7-bd-ae/"/>
      <url>/2016/08/16/webpack-e5-8f-91-e5-b8-83-e9-85-8d-e7-bd-ae/</url>
      
        <content type="html"><![CDATA[<h3 id="单文件模式"><a href="#单文件模式" class="headerlink" title="单文件模式"></a>单文件模式</h3><pre><code>// 新建 webpack.production.config.js// in package.json&quot;deploy&quot;:&quot;NODE_EVN=production webpack -p -config webpack.production.config.js&quot;// in web.production.config.js// 和开发环境不同之处在于入口和出口. 相应的在 HTML 和 JS 源也要进行修改var path = require(&#39;path&#39;)var node_modules_dir = path.resolve(__dirname, &#39;node_modules&#39;)module.exports = &#123;  entry:[    &#39;babel-polyfill&#39;,    path.resolve(__dirname, &#39;app/main.js&#39;)  ],  output:&#123;    path: path.resolve(__dirname, &#39;build&#39;),    filename: &#39;app.js&#39;  &#125;,  module:&#123;    loaders:[      &#123;        ...      &#125;    ]  &#125;&#125;`&lt;/pre&gt;### 多文件模式库最好不要打包, 因为一般库都不会改动, 所以 load 一次就够了.对库进行分离&lt;pre&gt;`// in webpack.production.config.jsvar path = require(&#39;path&#39;)var webpack = require(&#39;webpack&#39;)var node_modules_dir = path.resolve(__dirname, &#39;node_modules&#39;)module.exports = &#123;  entry:&#123;    app: [path.resolve(__dirname, &#39;app/main.js&#39;)],    react: [&#39;babel-polyfill&#39;,&#39;react&#39;,&#39;react-dom&#39;]  &#125;,  output:&#123;    path: path.resolve(__dirname, &#39;build&#39;),    filename: &#39;app.js&#39;  &#125;,  module:&#123;    loaders:[      ...    ]  &#125;,  plugins:[    new webpack.optimize.CommonsChunkPlugin(&#39;react&#39;,&#39;react.js&#39;)  ]&#125;</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> Webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Webpack 配置 React/babel</title>
      <link href="/2016/08/16/webpack-e9-85-8d-e7-bd-ae-reactbabel/"/>
      <url>/2016/08/16/webpack-e9-85-8d-e7-bd-ae-reactbabel/</url>
      
        <content type="html"><![CDATA[<h3 id="安装-react"><a href="#安装-react" class="headerlink" title="安装 react"></a>安装 react</h3><pre><code>npm install --save react react-dom`&lt;/pre&gt;### 安装 babel-loader&lt;pre&gt;`npm install --save-dev babel-loader babel-core babel-preset-es2015 babel-preset-react babel-preset-stage-2// 支持 ES2015, JSX, ES7`&lt;/pre&gt;&lt;pre&gt;`npm install --save polyfill`&lt;/pre&gt;&lt;pre&gt;`npm install --save babel-runtimenpm install --save-dev babel-plugin-transform-runtime// 减少打包时候的重复代码`&lt;/pre&gt;### 配置 babel&lt;pre&gt;`// 在入口添加 polyfillentry:[  &#39;babel-polyfill&#39;,  &#39;webpack/hot/dev-server&#39;,  &#39;webpack-dev-server/client?http://localhost:8080&#39;]`&lt;/pre&gt;添加`.babalrc`&lt;pre&gt;`&#123;  &quot;presets&quot;:[    &quot;es2015&quot;,    &quot;react&quot;,    &quot;stage-2&quot;  ],  &quot;plugins&quot;:[    &quot;transform-runtime&quot;  ]&#125;</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> Webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Webpack Dev Server</title>
      <link href="/2016/08/15/webpack-dev-server/"/>
      <url>/2016/08/15/webpack-dev-server/</url>
      
        <content type="html"><![CDATA[<p>The webpack-dev-server is a little node.js Express server, which uses the <code>webpack-dev-middleware</code> to serve a webpack bundle. It also has a little runtime which is connected to the server via <code>Socket.IO</code>.</p><p>Let’s say you have the following config file(<code>webpack.config.js</code>)</p><pre><code>var path = require(&#39;path&#39;);module.exports = &#123;  entry:&#123;    app:[&#39;./app/main.js&#39;]  &#125;,  output:&#123;    path: path.resolve(__dirname, &#39;build&#39;),    publicPath:&#39;/assets/&#39;,    filename: &#39;bundle.js&#39;  &#125;,&#125;`&lt;/pre&gt;You have an `app` folder with your initial entry point that webpack will bundle into a `bundle.js` file in the `build` folder.### Content BaseThe webpack-dev-server will serve the files in the **current directory**, unless you configure a specific content base.&lt;pre&gt;`webpack-dev-server --content-base build/`&lt;/pre&gt;it will serve you `build` folder.This modified bundle is served from memory at the relative path specified in `publicPath`. Namely your bundle will be available as `localhost:8080/assets/bundle.js`### Automatic RefreshThe webpack-dev-server supports multiple modes to automatic refresh pages:</code></pre><ul><li><p>Iframe mode(page is embedded in an iframe and reload on change)</p></li><li><p>Inline mode(as a small webpack-dev-server client entry is added to the bundle which refresh the page on change)</p><h4 id="Inline-Mode"><a href="#Inline-Mode" class="headerlink" title="Inline Mode"></a>Inline Mode</h4><p>To use the inline mode, specify <code>--inline</code> on the command line(you cannot specify it in configuration).</p><h3 id="配置-webpack-dev-server-自动刷新"><a href="#配置-webpack-dev-server-自动刷新" class="headerlink" title="配置 webpack-dev-server 自动刷新"></a>配置 webpack-dev-server 自动刷新</h3><pre>`// webpack.config.jsentry: [    'webpack/hot/dev-server',    'webpack-dev-server/client?http://localhost:8080',    path.resolve(__dirname, 'app/main.js')  ],  devServer:{    historyApiFallback: true,    hot:true,    inline:true,    progress: true  }`</pre><pre>`//package.json</li></ul><p>“dev”: “webpack-dev-server –progress –colors –inline –hot –content-base build/“,<br>“build”: “webpack”</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">此时访问 localhost:8080 相当于访问 build&#x2F;, 所以可以省略 index.html</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>React Ajax</title>
      <link href="/2016/08/02/react-ajax/"/>
      <url>/2016/08/02/react-ajax/</url>
      
        <content type="html"><![CDATA[<p>组件的数据来源, 通常是通过 AJAX 请求从服务器获取, 可以使用 <code>componentDidMount</code> 方法设置 AJAX 请求, 等到请求成功, 再用<code>this.setState()</code>方法重新渲染 UI.</p><pre><code>var UserGist = React.createClass(&#123;  getInitialState()&#123;    return &#123;      userName: &#39;&#39;,      lastGistUrl: &#39;&#39;    &#125;  &#125;,  componentDidMounted()&#123;    $.get(this.props.source, function(result)&#123;      var lastGist = result[0];      if(this.isMouted())&#123;        this.setState(&#123;          userName: lastGist.owner.login,          lastGistUrl: lastGist.html_url        &#125;);      &#125;    &#125;.bind(this));  &#125;,  render()&#123;    return (      &amp;lt;div&amp;gt;        &#123;this.state.userName&#125;&#39;s last Gist is        &amp;lt;a href=&#123;this.state.lastGistUrl&#125;&amp;gt;here&amp;lt;/a&amp;gt;      &amp;lt;/div&amp;gt;    );  &#125;&#125;);React.render(  &amp;lt;UserGist source= &#39;....&#39; /&amp;gt;, document.body)</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> React </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>React 表单</title>
      <link href="/2016/08/02/react-e8-a1-a8-e5-8d-95/"/>
      <url>/2016/08/02/react-e8-a1-a8-e5-8d-95/</url>
      
        <content type="html"><![CDATA[<p>用户在表单输入的内容, 属于用户与组件的互动, 要用<code>this.setState()</code>修改</p><pre><code>var Input = React.cr而奥特Class(&#123;  getInitialState()&#123;    return &#123;      value: &#39;Hello&#39;    &#125;;  &#125;,  handleChange(event)&#123;    this.setState(&#123;      value: event.target.value;    &#125;)  &#125;,  render()&#123;    return(      &amp;lt;div&amp;gt;&amp;lt;input type=&#39;text&#39; onChange=&#123;this.handleChange&#125; value = &#123;this.state.value&#125; /&amp;gt;&amp;lt;p&amp;gt;&#123;this.state.value&#125;&amp;lt;/p&amp;gt;&amp;lt;/div&amp;gt;    );  &#125;&#125;);ReactDOM.render(  &amp;lt;Input /&amp;gt;, document.body);</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> React </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PropTypes 与 getDefaultProps</title>
      <link href="/2016/08/02/proptypes-e4-b8-8e-getdefaultprops/"/>
      <url>/2016/08/02/proptypes-e4-b8-8e-getdefaultprops/</url>
      
        <content type="html"><![CDATA[<p>组件的属性可以接受任意值. 有时候我们需要一种机制, 验证别人使用组件时, 提供的参数是否符合要求.</p><p>组件类的 PropTypes 属性, 就是用来验证组件实例的属性是否符合要求的.</p><pre><code>var MyTitle = React.createClass(&#123;  propTypes: &#123;    title: React.PropTypes.string.isRequried,  &#125;,  render() &#123;    return &amp;lt;h1&amp;gt; &#123;this.props.title&#125; &amp;lt;/h1&amp;gt;;  &#125;&#125;);`&lt;/pre&gt;上面的 `MyTitle` 组件有一个 `title` 属性, `PropTypes` 告诉 React, 这个 `title` 属性是必须的, 而且数据类型是字符串.如果在实例化的时候设置 `title=123`, 控制台会显示一行错误信息&lt;pre&gt;`Warning: Failed propType: Invalid prop `title` of type `number` supplied to `MyTitle`, expected `string`.`&lt;/pre&gt;此外, `getDefaultProps` 可以用来设置组件属性的默认值&lt;pre&gt;`var MyTitle = React.createClass(&#123;  getDefaultProps() &#123;    return &#123;      title: &#39;Hello World&#39;    &#125;;  &#125;,  render()&#123;    return &amp;lt;h1&amp;gt;&#123;this.props.title&#125;&amp;lt;/h1&amp;gt;;  &#125;&#125;)ReactDOM.render(&amp;lt;MyTitle /&amp;gt;, document.body); // &#39;Hello World&#39;</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> React </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>跨域资源共享 CORS</title>
      <link href="/2016/08/02/e8-b7-a8-e5-9f-9f-e8-b5-84-e6-ba-90-e5-85-b1-e4-ba-ab-cors/"/>
      <url>/2016/08/02/e8-b7-a8-e5-9f-9f-e8-b5-84-e6-ba-90-e5-85-b1-e4-ba-ab-cors/</url>
      
        <content type="html"><![CDATA[<p>CORS 是一个 W3C 标准, 全称是”跨域资源共享”(cross-origin resource sharing)</p><p>他允许浏览器向跨域服务器发出 <code>XMLHttpRequest</code>, 从而克服了 AJAX 只能同源使用的限制</p><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>CORS 需要浏览器和服务器同时支持. 目前所有浏览器都支持该功能, IE 浏览器不能低于 IE10.</p><p>整个 CORS 通信过程, 都是浏览器自动完成, 不需要用户参与, 对于开发者而言, CORS 通信与同源的 AJAX 通信没有差别, 代码完全一样. 浏览器一旦发现 AJAX 跨域请求, 就会自动添加一些附加的头信息. 有时还会多出一次附加的请求, 但是用户不会有感觉.</p><p>因此, 实现 CORS 的关键是服务器, 只要服务器实现了 CORS 接口, 就可以跨域通信</p><h3 id="两种请求"><a href="#两种请求" class="headerlink" title="两种请求"></a>两种请求</h3><p>CORS 请求分两类: 简单请求(simple request)和非简单请求(not-so-simple request)</p><p>只要同时满足以下两大条件, 就属于简单请求:</p><ol><li>请求方法是: HEAD, GET 或者 POST</li><li>HTTP 头信息不超出以下几种字段: Accept, Accept-Language, Content-Language, Last-Event-ID, Content-Type(只限于三个值: application/x-www-form-urlencoded, multipart/form-data, text/plain)</li></ol><p>凡是不能同时满足上面两个条件的, 就属于非简单请求.</p><h3 id="简单请求"><a href="#简单请求" class="headerlink" title="简单请求"></a>简单请求</h3><h4 id="基本流程"><a href="#基本流程" class="headerlink" title="基本流程"></a>基本流程</h4><p>对于简单请求, 浏览器直接发出 CORS 请求, 具体来说, 就是在头信息中增加一个<code>Origin</code>字段</p><pre><code>GET /cors HTTP/1.1Origin: http://api.bob.comHost: api.alice.comAccept-Language: en-USConnection: keep-aliveUser-Agent: Mozilla/5.0...`&lt;/pre&gt;上面的头信息中, `Origin`字段用来说明, 本次请求来此哪个源(协议+域名+端口), 服务器根据这个值, 决定是否同意此次请求.如果`Origin`指定的源, 不在许可范围内, 服务器会返回一个正常的 HTTP 响应. **浏览器**发现这个回应的头信息中没有包含`Access-Control-Allow-Origin`字段, 就知道出错了, 从而抛出一个错误, 被`XMLHttpRequest`的`onerror`回调函数捕获. 注意, 这种错误无法通过状态码识别, 因为 HTTP 回应的状态码可能是200.如果`Origin`指定的域名在许可范围内, 服务器返回的相应, 会多出几个头信息字段&lt;pre&gt;`Access-Control-Allow-Origin: http://api.bob.comAccess-Control-Allow-Credentials: trueAccess-Control-Expose-Headers: FooBarContent-Type: text/html; charset=utf-8`&lt;/pre&gt;上面的头信息中, 有三个与 CORS 请求相关的字段, 都以 `Access-Control-` 开头##### Access-Control-Allow-Origin这个字段是必须的, 他的值要么是请求时 `Origin` 的值, 要么是一个 `*`, 表示接收任意域名的请求##### Access-Control-Allow-Credentials该字段是可选的, 是一个布尔值, 表示是否允许发送 Cookie. 默认情况下, Cookie 不包括在 CORS 请求之中.设为 `true` 表示服务器明确许可, Cookie 可以包括在请求之中, 一起发给服务器这个值也只能设为`true`, 如果服务器不需要浏览器发送 Cookie, 删除字段即可##### Access-Control-Expose-Headers该字段可选, CORS 请求时, `XMLHttpRequest` 对象的 `getResponseHeader()` 方法只能拿到6个基本字段- Cache-Control- Content-Language- Content-Type- Expires- Last-Modified-Pragma如果想要拿到其他字段, 必须在 `Access-Control-Expose-Headers` 里面指定上面的例子中, `getResponseHeader(&#39;FooBar&#39;)` 可以返回 `FooBar` 字段的值#### withCredentials 属性CORS 请求默认不发送 Cookie 和 HTTP 认证信息, 如果要把 Cookie 发送给服务器, 一方面要服务器同意, 指定 `Access-Control-Allow-Credentials` 字段&lt;pre&gt;`Access-Control-Allow-Credientials: true`&lt;/pre&gt;另一方面, 开发者需要在 AJAX 请求中打开`withCredientials`属性&lt;pre&gt;`var xhr = new XMLHttpRequest();xhr.withCredientials = true;`&lt;/pre&gt;否则即使服务器同意发送 Cookie, 浏览器也不会发送要注意, 如果要发送 Cookie, `Access-Control-Allow-Origin` 不能设置为 `*`, 必须指定明确的, 与请求网页一致的域名. 同时 Cookie 依然遵循同源政策, 只有用服务器域名设置的 Cookie 才会上传, 其他域名的 Cookie 不会上传.### 非简单请求#### 预检请求非简单请求是那种对服务器有特殊要求的请求, 比如请求方法是 `PUT`, 或 `DELETE`, 或者 `Content-Type` 字段类型是 `application/json`非简单请求的 CORS 请求, 会在正是通信钱, 增加一次 HTTP 查询请求, 称为 &quot;预检请求&quot; (preflight)浏览器先询问服务器, 当前网页所在的域名是否在服务器的许可名单中, 以及可以使用哪些 HTTP 动词和头信息字段, 只有得到肯定的答复, 浏览器才会发出正式的 `XMLHttpRequest` 请求, 否则就报错下面是一段浏览器的 JavaScript 脚本&lt;pre&gt;`var url = &#39;http://api.alice.com/cors&#39;var xhr = new XMLHttpRequest();xhr.open(&#39;PUT&#39;, url, true);xhr.setRequestHeader(&#39;X-Custom-Header&#39;, &#39;value&#39;);xhr.send()`&lt;/pre&gt;上面代码中, HTTP 请求的方法是 `PUT`, 并且发送一个自定义头信息 `X-Custom-Header`浏览器发现这是一个非简单请求, 就自动发出一个 &quot;预检&quot; 请求, 要求服务器确认可以这样请求. 下面是这个 &quot;预检&quot; 请求的 HTTP 头信息&lt;pre&gt;`OPTIONS /cors HTTP/1.1Origin: http://api.bob.comAccess-Control-Request-Method: PUTAccess-Control-Request-Headers: X-Custom-HeaderHost: api.alice.comConnection: keep-aliveUser-Agent: Molliza/5.0...`&lt;/pre&gt;&quot;预检&quot; 请求用的请求方法是 `OPTIONS`, 表示这个请求是用来询问的, 头信息里面, 关键字段是 `Origin`, &quot;预检&quot; 秦秋的头信息包括两个特殊字段- Access-Control-Request-Method  这个字段是必须的, 用来列出请求方法</code></pre><ul><li><p>Access-Control-Request-Headers<br>该字段是一个逗号分隔的字符串, 永安里指定浏览器 CORS 请求会格外发送的头信息字段</p><h5 id="预检请求的响应"><a href="#预检请求的响应" class="headerlink" title="预检请求的响应"></a>预检请求的响应</h5><p>服务器取得”预检”请求后, 检查<code>Origin</code>, <code>Access-Control-Request-Method</code> 和 <code>Access-Control-Request-Header</code> 子弹后, 确认允许跨源请求, 就可以做出回应</p><pre>`HTTP/1.1 200 OKDate: Mon, 01 Dec 2008 01:15:39 GMTServer: Apache/2.0.61 (Unix)Access-Control-Allow-Origin: http://api.bob.comAccess-Control-Allow-Methods: GET, POST, PUTAccess-Control-Allow-Headers: X-Custom-HeaderContent-Type: text/html; charset=utf-8Content-Encoding: gzipContent-Length: 0Keep-Alive: timeout=2, max=100Connection: Keep-AliveContent-Type: text/plain`</pre><p>上面 HTTP 响应中, 关键的是 <code>Access-Control-Allow-Origin</code> 字段, 表示 <code>http://api.bob.com</code> 可以请求数据, 该字段也可以设置为<code>*</code>, 表示同意跨源请求.</p><p>如果浏览器否定了”预检”请求, 返回一个正常的 HTTP 响应, 但是没有任何 CORS 相关的头信息字段, 这时候浏览器会认为服务器不同意预检请求, 从而触发一个错误, 被 <code>XMLHttpRequest</code> 对象的 <code>onerror</code> 回调函数捕获, 控制台会打印如下报错信息</p><pre>`XMLHttpRequest cannot load http://api.alice.com.Origin http://api.bob.com is not allowed by Access-Control-Allow-Origin.`</pre><p>服务器回应其他 CORES 相关字段如下:</p><pre>`Access-Control-Allow-Methods: GET, POST, PUTAccess-Control-Allow-Headers: X-Custom-HeaderAccess-Control-Allow-Credentials: trueAccess-Control-Max-Age: 1728000`</pre><h5 id="Access-Control-Allow-Method"><a href="#Access-Control-Allow-Method" class="headerlink" title="Access-Control-Allow-Method"></a>Access-Control-Allow-Method</h5><p>该字段是必须的, 他的值是逗号分隔的一个字符串, 表明服务器支持的跨域请求方式</p><h5 id="Access-Control-Allow-Headers"><a href="#Access-Control-Allow-Headers" class="headerlink" title="Access-Control-Allow-Headers"></a>Access-Control-Allow-Headers</h5><p>如果浏览器包含<code>Access-Control-Request-Headers</code>, 则 <code>Access-Control-Allow-Headers</code> 也是必须的, 其值也是一个逗号分隔的字符串</p><h5 id="Access-Control-Allow-Credentials"><a href="#Access-Control-Allow-Credentials" class="headerlink" title="Access-Control-Allow-Credentials"></a>Access-Control-Allow-Credentials</h5><p>该字段与简单请求时的含义相同</p><h5 id="Access-Control-Max-Age"><a href="#Access-Control-Max-Age" class="headerlink" title="Access-Control-Max-Age"></a>Access-Control-Max-Age</h5><p>该字段可选, 永安里指定本次预检请求的有效期(s), 有效期内发起跨域请求不需要预检请求.</p><h4 id="浏览器的正常请求与回应"><a href="#浏览器的正常请求与回应" class="headerlink" title="浏览器的正常请求与回应"></a>浏览器的正常请求与回应</h4><p>一旦服务器通过”预检”请求, 以后每次浏览器正常的 CORS 请求, 都会和简单请求一样, 有一个<code>Origin</code> 头信息字段, 服务器的回应也会有一个<code>Access-Control-Allow-Origin</code>头信息字段</p><p>“预检”请求之后, 浏览器的正常 CORS 请求</p><pre>`PUT /cors HTTP/1.1Origin: http://api.bob.comHost: api.alice.comX-Custom-Header: valueAccess-Language: en-USConnection: keep-aliveUser-Agent: Mozilla/5.0...`</pre><p>其中<code>Origin</code>字段是浏览器自动添加的</p><p>服务器的正常回应</p><pre>`Access-Control-Allow-Origin: http://api.bob.comContent-Type: text/html; charset=utf-8</li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>浏览器同源政策及其规避方法</title>
      <link href="/2016/08/02/e6-b5-8f-e8-a7-88-e5-99-a8-e5-90-8c-e6-ba-90-e6-94-bf-e7-ad-96-e5-8f-8a-e5-85-b6-e8-a7-84-e9-81-bf-e6-96-b9-e6-b3-95/"/>
      <url>/2016/08/02/e6-b5-8f-e8-a7-88-e5-99-a8-e5-90-8c-e6-ba-90-e6-94-bf-e7-ad-96-e5-8f-8a-e5-85-b6-e8-a7-84-e9-81-bf-e6-96-b9-e6-b3-95/</url>
      
        <content type="html"><![CDATA[<p>浏览器安全的基石是”同源政策”(same-origin policy).</p><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>所谓”同源”, 是指三个”相同”.</p><ul><li>协议相同: <code>http:\\</code></li><li>域名相同: <code>www.example.com</code> 与 <code>example.com</code> 不同</li><li>端口相同</li></ul><h3 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h3><p>同源政策的目的是为了保证用户信息安全, 防止恶意的网络窃取数据</p><h3 id="限制范围"><a href="#限制范围" class="headerlink" title="限制范围"></a>限制范围</h3><p>如果非同源, 共有三种行为受到限制</p><ul><li>Cookie, LocalStorage 和 IndexDB 无法读取</li><li>DOM 无法获得</li><li>AJAX 请求无法发送</li></ul><h3 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h3><p>Cookie 是服务器写入浏览器的一小段信息, 只有同源的网站才能共享. 但是两个网页一级域名相同, 只有二级域名不同, 浏览器允许通过设置 <code>document.domain</code> 共享 Cookie.</p><p>举例来说, A 网页是 <code>http://w1.example.com/a.html</code>, B 网页是 <code>http://w2.example.com/b.html</code>, 那么只要设置相同的 <code>document.domain</code>, 这两个网页可以共享 Cookie.</p><pre><code>document.domain = &#39;example.com&#39;;`&lt;/pre&gt;现在 A 网页通过脚本设置一个 Cookie&lt;pre&gt;`document.cookie = &#39;test1=hello&#39;;`&lt;/pre&gt;B 网页就可以读取这个 Cookie&lt;pre&gt;`var allCookie = document.cookie;`&lt;/pre&gt;注意, 这种方法只适用于 Cookie 和 iframe 窗口, LocalStorage 和 IndexDB 无法通过这种方法, 规避同源政策.另外, 服务器也可以在设置 Cookie 的时候指定 Cookie 所属域名为一级域名, 比如 `.example.com`&lt;pre&gt;`Set-Cookie: key=value; domain=.example.com; path=/`&lt;/pre&gt;这样的话, 二级域名和三级域名不用做任何设置就可以读取这个 Cookie### iframe如果两个网页不同源, 就无法拿到对方的 DOM, 典型的例子就是`iframe`窗口和`window.open` 方法打开的窗口, 他们与父窗口无法通信.如果两个窗口一级域名相同, 只是二级域名不同, 那么设置`document.domain`也可以规避同源政策, 实现 DOM 获取.### 完全不同源的网站#### 片段识别符(fragment identifier)片段识别符值得是 URL 中`#` 后的部分, 也就是 hash.如果只是改变片段识别符, 页面不会重新刷新父窗口可以把信息写入子窗口的片段识别符&lt;pre&gt;`var src = originURL + &#39;#&#39; + data;document.getElementById(&#39;myFrame&#39;).src = src;`&lt;/pre&gt;子窗口通过监听 `hashchange` 事件得到通知&lt;pre&gt;`window.onhashchange = checkMessage;function checkMessage()&#123;  var message = window.location.hash;  // ...&#125;`&lt;/pre&gt;同样子窗口也可以改变父窗口的片段识别符&lt;pre&gt;`parent.location.href = target + &quot;#&quot; + hash;`&lt;/pre&gt;#### window.name浏览器窗口有 `window.name` 属性, 这个属性的最大特点是, 无论是否同源, 只要在同一个窗口里, 前一个网页设置这个属性后, 后一个网页可以读取他父窗口先打开一个子窗口, 载入一个不同源的网站, 该网页将写入 `widnow.name` 属性&lt;pre&gt;`window.name = data;`&lt;/pre&gt;接着, 子窗口跳回一个与主窗口同域的网址&lt;pre&gt;`location = &#39;http:parent.url.com/xxx.html&#39;`&lt;/pre&gt;然后主窗口就可以读取子窗口的 `window.name` 属性了&lt;pre&gt;`var data = document.getElementById(&#39;myFrame&#39;).contentWindow.name;`&lt;/pre&gt;这种方法的优点是 `window.name` 容量大, 缺点是必须监听子窗口的 `window.name` 属性的变化, 影响性能.#### window.postMessage以上信息都属于破解, HTML5 为了解决这个问题, 引入一个全新的 API: 跨文档通信 API(Cross-document messaging)这个 API 为 `window` 对象新增一个 `window.postMessage` 方法, 允许跨窗口通信, 不论两个窗口是否同源.举例来说, 父窗口 `http://aaa.com` 向子窗口 `http://bbb.com` 发消息, 调用 `postMessage` 方法就可以了&lt;pre&gt;`var popup = window.open(&#39;http://bbb.com&#39;, &#39;title&#39;);popup.postMessage(&#39;Hello World&#39;, &#39;http://bbb.com&#39;);`&lt;/pre&gt;`postMessage` 方法的第一个参数是要传递的 Message, 第二个参数是接受信息的窗口的源(origin), 即`协议+域名+端口`, 也可以设置为`*`, 表示不限制域名, 向所有窗口发送.子窗口向父窗口发送消息的写法类似&lt;pre&gt;`window.opener.postMessage(&#39;Hello World&#39;, &#39;http://aaa.com&#39;);`&lt;/pre&gt;通过`message`事件监听对象消息&lt;pre&gt;`window.addEventListener(&#39;message&#39;, function(e)&#123;console.log(e.data);&#125;, false);`&lt;/pre&gt;`message` 事件的事件对象 `event` , 提供一下三个属性</code></pre><ul><li><p><code>event.source</code>: 发送信息的窗口, 子窗口通过 <code>event.source</code> 引用父窗口然后发送消息</p><pre>`window.addEventListener('message', receiveMessage);function receiveMessage(event){event.source.postMessage('Hello Opener', '*');}`</pre></li><li><p>‘event.origin’: 发送信息的网址(‘<a href="http://aaa.com&/#39;">http://aaa.com&#39;</a>), 可以过滤不是指定来源的信息</p><pre>`window.addEventListener('message', receiveMessage);function receiveMessage(event){if (event.origin != 'http://aaa.com') return;if (event.data === 'Hello World') {  event.source.postMessage('Hello', event.origin);} else {  console.log(event.data);}}`</pre></li><li><p>‘event.data’: 信息内容</p></p><h4 id="LocalStorage"><a href="#LocalStorage" class="headerlink" title="LocalStorage"></a>LocalStorage</h4><p>通过 `window.postMessage` 读写其他窗口的 `LocalStorage` 也是可能的<p>例: 主窗口写入 <code>iframe</code> 子窗口的 <code>localStorage</code></p><pre>`window.onmessage = function(event){  if(event.origin !== 'http://bbb.com') return;  var payload = JSON.parse(event.data);  localStorage.setItem(payload.key, JSON.stringify(payload.data));};`</pre><p>上面代码中, 子窗口将父窗口发送的消息写入自己的 <code>localStorage</code></p><p>父窗口发送消息的代码如下:</p><pre>`var win = document.getElementByTagName('iframe')[0].contentWindow;var obj = { name: 'Jack' };win.postMessage(JSON.stringify({key: 'storage', data: obj}), 'http://bbb.com');`</pre><p>加强版子窗口接收消息的代码</p><pre>`window.onmessage = function(e) {  if (e.origin !== 'http://bbb.com') return;  var payload = JSON.parse(e.data);  switch(payload.method) {    case 'set': localStorage.setItem(payload.key, JSON.stringify(parload.data));                break;    case 'get': var parent = window.parent;                var data = localStorage.getItem(payload.key);                parent.postMessage(data, 'http://aaa.com');                break;    case 'remove': localStorage.removeItem(payload.key);                   break;  }};`</pre><p>加强版的父窗口消息发送代码</p><pre>`var win = document.getElementByTagName('iframe')[0].contentWindow;var obj = { name: 'Jack' };// 存入对象win.postMessage(JSON.stringify(key: 'storage', method: 'set', data: obj), 'http://bbb.com');// 读取对象win.postMessage(JSON.stringify(key: 'storage', method: 'get',), '*');window.onmessage = function(e){  if(e.origin !== 'http://bbb.com') return;  // 'Jack'  console.log(JSON.parse(e.data).name);};`</pre><h3 id="AJAX"><a href="#AJAX" class="headerlink" title="AJAX"></a>AJAX</h3><p>同源政策规定, AJAX 请求只能发给同源的网址, 否则会报错</p><p>除了假设服务器代理, 有三中方法规避这个限制</p><h4 id="JSONP"><a href="#JSONP" class="headerlink" title="JSONP"></a>JSONP</h4><p>JSONP 是服务器与客户端跨源通信的常用方法, 最大特点是简单实用, 老式浏览器全部支持, 服务器改造非常小.</p><p>基本思想是, 网页通过添加一个<code>&amp;lt;script&amp;gt;</code>元素, 向服务器请求 JSON 数据,在何种做法不受同源政策限制. 服务器接收请求后, 将数据放在一个指定名字的回调函数里传回来.</p><p>首先, 网页动态插入<code>&amp;lt;script&amp;gt;</code>元素, 由它向跨源网址发出请求.</p><pre>`function addScriptTag(src) {  var script = document.createElement('script');  script.setAttribute('type', 'text/javascript');  script.src = src;  document.body.appendChild(script);}window.onload = function(){  addScritpTag('http://example.com/ip?callback=foo');}function foo(data){  console.log("Your public IP address is: " + data.ip);};`</pre><p>上面的代码通过动态添加<code>&amp;lt;script&amp;gt;</code>元素, 向服务器<code>example.com</code>发出请求. 注意, 该请求的查询字符串有一个<code>callback</code> 参数, 用来指定回调函数的名字, 这对 JSONP 是必须的.</p><p>服务器接收到这个请求后, 会将数据放在回调函数的参数位置返回.</p><pre>`foo({  'ip': '8.8.8.8'});`</pre><p>由于<code>&amp;lt;script&amp;gt;</code>元素请求的脚本, 直接作为代码运行, 这时只要浏览器定义了<code>foo</code>函数, 该函数就会立即调用. 作为参数的 JSON 数据会被视为 JavaScript 对象, 而不是字符串, 因此避免了使用<code>JSON.parse</code>的步骤</p><h4 id="WebSocket"><a href="#WebSocket" class="headerlink" title="WebSocket"></a>WebSocket</h4><p>WebSocket 是一种通信协议, 使用<code>ws://</code>(非加密)和<code>wss://</code>(加密)作为协议前缀.</p><p>该协议不实行同源政策, 只要服务器支持, 就可以与他进行夸源通信.</p><p>下面是一个例子, 浏览器发出的 WebSocket 请求的头信息:</p><pre>`GET /chat HTTP/1.1Host: server.example.comUpgrade: websocketConnection: UpgradeSec-WebSocket-Key: x3JJHMbDL1EzLkh9GBhXDw==Sec-WebSocket-Protocol: chat, superchatSec-WebSocket-Version: 13Origin: http://example.com</li></ul><p>上面代码中, 有一个字段是<code>Origin</code>, 表示该请求的请求源(origin)</p><p>正式因为有了<code>Origin</code>这个字段, 所以 WebSocket 才没有实行同源政策, 因为服务器可以根据这个字段判断是否许可此次通信</p><h4 id="CORS"><a href="#CORS" class="headerlink" title="CORS"></a>CORS</h4><p>CORS 是跨源资源分享(Corss-Origin Resource Sharing) 的缩写, 是 W3C 标准, 是跨源 AJAX 请求的根本解决办法. 相比 JSONP 只能发<code>GET</code>请求, CORS 允许任何类型的请求.</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Node.js URL 模块的使用</title>
      <link href="/2016/08/01/node-js-url-e6-a8-a1-e5-9d-97-e7-9a-84-e4-bd-bf-e7-94-a8/"/>
      <url>/2016/08/01/node-js-url-e6-a8-a1-e5-9d-97-e7-9a-84-e4-bd-bf-e7-94-a8/</url>
      
        <content type="html"><![CDATA[<p>Node.js 中的 URL 模块, 用于将 URL 字符串解析为对象或将对象格式化为 URL 字符串, 该模块比较简单, 共包括 3 个方法:</p><h3 id="URL-各部分说明"><a href="#URL-各部分说明" class="headerlink" title="URL 各部分说明"></a>URL 各部分说明</h3><p>对于一个 URL 字符串, 其组成部分会有所不同. 其中有些部分只有在 URL 字符串中存在时, 对应字段还才会出现在解析后的对象中. 以下是一个 URL 例子</p><pre><code>http://user:pass@host.com:8080/path/to/file?query=string#hash`&lt;/pre&gt;解析后的字段如下:- `href`: 解析前的完整原始 URL, 协议名和主机名已经转为小写- `protocol`: 请求协议, 小写, 例如`http:`- `slashes`: 协议的`:`后面是否有`\`, 返回`true`或`false`- `host`: URL 主机名, 包括端口信息, 小写, 例如`host.com:8080`- `auth`: URL 中的认证信息, 例如`user:pass`- `hostname`: 主机名, 小写, 例如`host.com`- `port`: 主机的端口号, 例如`8080`- `pathname`: URL 中的路径, 例如`/path/to/file`- `search`: 查询对象, 即: `queryString`, 包括之前的`?`, 例如`?query=string`; 如果 `parseQueryString = true`, 则返回`&#123;&#39;query&#39;:&#39;string&#39;&#125;`- `query`: 例如`query=string`- `hash`: 锚点部分, 即`#`之后的部分, 例如`#hash`### 将 URL 字符串转换为对象: url.parse(urlStr[, parseQueryString[, slashesDenoteHost]])`url.parse()`方法用于解析 URL 对象, 解析后范湖第一个 JSON 对象. 例如:&lt;pre&gt;`&amp;gt; var url = &#39;http://user:pass@host.com:8080/path/to/file?query=string#hash&#39;undefined&amp;gt; url&#39;http://user:pass@host.com:8080/path/to/file?query=string#hash&#39;&amp;gt; var urlModule = require(&#39;url&#39;);undefined&amp;gt; urlModule.parse(url)Url &#123;  protocol: &#39;http:&#39;,  slashes: true,  auth: &#39;user:pass&#39;,  host: &#39;host.com:8080&#39;,  port: &#39;8080&#39;,  hostname: &#39;host.com&#39;,  hash: &#39;#hash&#39;,  search: &#39;?query=string&#39;,  query: &#39;query=string&#39;,  pathname: &#39;/path/to/file&#39;,  path: &#39;/path/to/file?query=string&#39;,  href: &#39;http://user:pass@host.com:8080/path/to/file?query=string#hash&#39; &#125;`&lt;/pre&gt;第二个可选参数设置为`true`的时候, 会使用`queryString`模块来解析 URL 中的`query` 部分, 默认为`false`.第三个参数为`true`的时候, 会把诸如`//foo/bar`这样的 URL 解析为 `&#123;host: &#39;foo&#39;, pathname: &#39;/bar&#39;&#125;`, 而不是 `&#123;pathname: &#39;//foo/bar&#39;&#125;`. 默认为`false`### 将对象格式化为 URL 字符串: url.format(urlObj)`url.resolve()`用于格式化URL对象, 输入一个 URL 对象, 返回格式化后的 URL 字符串, 例如:&lt;pre&gt;`&amp;gt; var url = require(&#39;url&#39;);undefined&amp;gt; var urlObj = &#123;... protocol: &#39;http:&#39;,... slashes: true,... hostname: &#39;host.com&#39;,... port: 8080,... hash: &#39;#hash&#39;,... search: &#39;?query=string&#39;,... pathname: &#39;/path/to/file&#39;... &#125;undefined&amp;gt; var result = url.format(urlObj)undefined&amp;gt; result&#39;http://host.com:8080/path/to/file?query=string#hash&#39;`&lt;/pre&gt;### URL 路径处理`url.resolve()`方法用于处理 URL 路径, 也可以用于处理锚点. 例如&lt;pre&gt;`url.resolve(&#39;/one/two/three&#39;, &#39;four&#39;)         // &#39;/one/two/four&#39;url.resolve(&#39;http://example.com/&#39;, &#39;/one&#39;)    // &#39;http://example.com/one&#39;url.resolve(&#39;http://example.com/one&#39;, &#39;/two&#39;) // &#39;http://example.com/two&#39;</code></pre><p>参数拼接, 如果之间没有<code>/</code>, 则参数二替换参数一末尾的文件名 .</p><p>注意区分路径和文件名.</p>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Promise in ES6</title>
      <link href="/2016/07/31/promise-in-es6/"/>
      <url>/2016/07/31/promise-in-es6/</url>
      
        <content type="html"><![CDATA[<p>在 JavaScript 世界中, 所有代码都是单线程执行的</p><p>异步执行可以可以用回调函数实现</p><pre><code>function callback() &#123;  console.log(&#39;Done&#39;);&#125;console.log(&#39;before setTimeout()&#39;);setTimeout(callback, 1000);console.log(&#39;after setTimeout()&#39;);`&lt;/pre&gt;先看一个简单的 Promise 例子: 生成0-2之间的随机数, 如果小于1, 则等待一段时间后返回成功, 否则返回失败&lt;pre&gt;`function test(resolve, reject)&#123;  var timeOut = Math.random() * 2;  log(&#39;set timeout to: &#39; + timeOut + &#39; seconds.&#39;);  setTimeout(function()&#123;    if(timeOut &amp;lt; 1) &#123;      log(&#39;call resolve()...&#39;);      resolve(&#39;200 ok&#39;);    &#125; else &#123;      log(&#39;call reject()...&#39;);      reject(&#39;timeout in &#39; + timeOut + &#39; seconds&#39;);    &#125;  &#125;, timeOut * 1000)&#125;`&lt;/pre&gt;这个`test()`函数有两个参数, 这两个参数都是函数, 如果执行成功, 我们将调用`resolve(&#39;200 ok)&#39;`, 如果执行失败, 我们将调用`reject(&#39;timeout in &#39; + timeOut + &#39; seconds.&#39;)`. 可以看出, `test()`函数只关心自己的逻辑, 并不关心具体的`resolve` 和`reject` 将如何处理.有了执行函数, 我们就可以用一个 Promise 对象来执行他, 并在将来某个时刻获得成功或失败的结果&lt;pre&gt;`var p1 = new Promsie(test);var p2 = p1.then(function(result)&#123;  console.log(&#39;成功: &#39; + result);&#125;);var p3 = p2.catch(function(err)&#123;  console.log(&#39;失败: &#39; + err);&#125;);`&lt;/pre&gt;变量`p1`是一个 Promise 对象, 他负责执行执行`test`函数, 由于`test`函数在内部是异步执行的, 当`test`函数执行到`resolve(&#39;ok 200&#39;)`时, 告诉 Promsie 对象执行&lt;pre&gt;`.then(function(result)&#123; // result 是通过 test 传递给 resolve 的参数  console.log(&#39;成功: &#39; + result);&#125;);`&lt;/pre&gt;当`test`执行到`reject`的时候, 告诉 Promise 对象执行&lt;pre&gt;`.catch(function(err)&#123; // err 是 test 传递给 reject 的参数  console.log(&#39;失败: &#39;+ err);&#125;);`&lt;/pre&gt;Promise 对象可以串联起来(因为都返回一个 Promise 对象)&lt;pre&gt;`new Promise(test).then(function(result)&#123;console.log(result)&#125;).catch(function(err)&#123;console.log(err)&#125;);`&lt;/pre&gt;可见, Promise 最大的好处, 是在异步执行的流程中, 把执行代码和处理结果代码清晰地分离了.Promise 还可以做更多的事情, 比如有若干个异步任务, 需要先做任务1, 如果成功后再做任务2, 任何任务失败则不再继续并执行错误处理函数要串行执行这样的异步任务, 只需要链式调用&lt;pre&gt;`job1.then(job2).then(job3).catch(handleError);`&lt;/pre&gt;其中 job1, job2, job3 都是(或返回) Promise 对象&lt;pre&gt;`function job2(input)&#123;  return new Promise(function(resolve, reject)&#123;      ....    &#125;)&#125;`&lt;/pre&gt;### 并行执行异步任务试想一个页面聊天任务, 我们需要从两个不同的 URL 分别获取用户的个人信息和好友列表, 这两个任务是可以并行执行的, 用`Promise.all()`实现如下:&lt;pre&gt;`var p1 = new Promise(function(resolve, reject)&#123;  setTimeout(resolve, 500, &#39;P1&#39;);&#125;);var p2 = new Promise(function(resolve, reject) &#123;  setTimeout(resolve, 600, &#39;P2&#39;);&#125;);// 同时执行p1 和 p2, 并在他们都执行完毕后执行 thenPromise.all([p1,p2]).then(function(results)&#123;  console.log(results); // 获得一个 Array: [&#39;P1&#39;, &#39;P2&#39;]&#125;);`&lt;/pre&gt;有时多个异步任务是为了容错, 比如同时向两个 URL 读取, 只需要获得先返回的结果, 这种情况下用`Promise.race()`实现:&lt;pre&gt;`var p1 = new Promise(function(resolve, reject)&#123;  setTimeout(resolve, 500, &#39;P1&#39;);&#125;);var p2 = new Promise(function(resolve, reject)&#123;  setTimeout(resolve, 600, &#39;P2&#39;);&#125;);Promise.race([p1,p2]).then(function(result)&#123;  console.log(result); // &#39;P1&#39;&#125;);</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CO Module</title>
      <link href="/2016/07/31/co-module/"/>
      <url>/2016/07/31/co-module/</url>
      
        <content type="html"><![CDATA[<h3 id="Co-v4"><a href="#Co-v4" class="headerlink" title="Co v4"></a>Co v4</h3><p><code>co@4.0.0</code> has been released, which now relies on promises. It is a stepping stone towards the <a href="https://github.com/lukehoban/ecmascript-asyncawait">aysnc/await proposal</a>. The primary API change is how <code>co()</code> is invoked. Before, <code>co</code> returned a “thunk”, which you then called with a callback and optional arguments. Now, <code>co()</code> return s a promise.</p><pre><code>co(function* ()&#123;  var result = yield Promise.resolve(true);  return result;&#125;).then(function (value) &#123;  console.log(value);&#125;, function(err) &#123;  console.error(err.stack);&#125;);`&lt;/pre&gt;If you want to convert a `co`-generator-function into a regular function that returns a promise, you now use `co.wrap(fn*)`.&lt;pre&gt;`var fn = co.wrap(function*(val) &#123;  return yield Promise.resolve(val);&#125;);fn(true).then(function(val)&#123;&#125;)`&lt;/pre&gt;### Platform Compatibility`co@4+` requires a `Promise` implementation. For version of node `&amp;lt; 0.11` and for many older browsers, you should/must include your own `Promise` polyfill.Node v4+ is supported out of the box, you can use `co` without flags or polyfills.### Installation&lt;pre&gt;`$ npm install co`&lt;/pre&gt;### Examples&lt;pre&gt;`var co = require(&#39;co&#39;);co(function*()&#123;  // yield any promise  var result = yield Promise.resolve(true);&#125;).catch(onerror);co(function*()&#123;  // resolve multiple promises in parallel  var a = Promise.resolve(1);  var b = Promise.resolve(2);  var c = Promise.resolve(3);  var res = yield[a, b, c];  console.log(res);  // =&amp;gt; [1,2,3]&#125;).catch(onerror);// errors can be try/catchedco(function*() &#123;  try&#123;    yield Promise.reject(new Error(&#39;boom&#39;));  &#125; catch (err) &#123;    console.error(err.message); // &#39;boom&#39;  &#125;&#125;);function onerror(err)&#123;  // log any uncaught errors  // co will not throw any errors you do not handle  // HANDLE ALL YOUR ERRORS  console.error(err.stack);&#125;</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript Generator</title>
      <link href="/2016/07/31/javascript-generator/"/>
      <url>/2016/07/31/javascript-generator/</url>
      
        <content type="html"><![CDATA[<p>作用迭代器</p><pre><code>function* argumentsGenerator() &#123;  for (let i = 0; i &amp;lt; arguments.length; i++) &#123;    yield arguments[i];  &#125;&#125;`&lt;/pre&gt;我们希望迭代传入的每个实参&lt;pre&gt;`var argumentsIterator = argumentsGenerator(&#39;a&#39;,&#39;b&#39;,&#39;c&#39;,&#39;d&#39;);// Prints &quot;a,b,c,d&quot;console.log(  argumentsIterator.next().value,  argumentsIterator.next().value,  argumentsIterator.next().value,  argumentsIterator.next().value)`&lt;/pre&gt;我们可以简单的理解- Generator 其实是生成 Iterator 的方法, argumentsGenerator 被称为 GeneratorFunction, 也有一些人把 GeneratorFunction 的返回值称为一个 Generator- yield 可以中断 GeneratorFunction 的运行, 而在 next() 时恢复运行- 返回的 Iterator 上, 有 next 成员方法, 能够返回迭代值. 其中 value 属性包含了实际返回值, done 属性为布尔值, 标记迭代器是否完成迭代, 要注意的是, 在 done: true 后继续运行 next 方法会产生异常.完整的 ES 实现中, for-of 循环正式为了快速迭代一个 Iterator&lt;pre&gt;`for (let value of argumetnsIterator) &#123;  console.log(value);&#125;`&lt;/pre&gt;可以利用 yield* 语法, 将 yield 操作代理到另一个 Generator&lt;pre&gt;`let delegatedIterator = (function*() &#123;  yield &#39;Hello!&#39;;  yield &#39;Bye!&#39;;&#125;)();let delegatingIterator = (function*() &#123;  yield &#39;Greetings!&#39;;  yield* delegatedIterator;  yield &#39;Ok, bye!&#39;;&#125;)();// Prints &quot;Greetings!&quot;, &quot;Hello&quot;, &quot;Bye!&quot;, &quot;Ok, bye!&quot;for (let value of delegatingIterator) &#123;  console.log(value);&#125;</code></pre><h3 id="用作流程控制"><a href="#用作流程控制" class="headerlink" title="用作流程控制"></a>用作流程控制</h3><p>co 已经将此特性封装的非常完美</p><p>Generator 之所以可以用来控制代码流程, 就是通过 yield 来将两个或多个 Generator 的执行路径相互切换, 这种切换是语句级别的, 而不是函数级调用. 其本质是 CPS 变换.</p><p>这里补充 yield 的若干行为:</p><ul><li>next 方法接收一个参数, 传入的参数是 yield 表达式的返回值: 即 yield 既可以产生数值, 也可以接收数值</li><li>throw 方法会抛出一个异常, 并终止迭代</li><li>GeneratorFunction 的 return 语句相当于一个 yield</li></ul><h4 id="将异步”变为”同步"><a href="#将异步”变为”同步" class="headerlink" title="将异步”变为”同步"></a>将异步”变为”同步</h4><p>假设我们希望有如下语法:</p><ul><li>suspend 传入一个 GeneratorFunction</li><li>suspend 返回一个简单函数, 接收一个 node 风格的回调函数</li><li>所有的异步调用都通过 yield, 看起来像同步调用</li><li>给定一个特殊的回调, 让保证异步调用的返回值作为 yield 的返回值, 并让脚本继续</li><li>GeneratorFunction 的返回值和执行过程的错误都会传入全局的回调函数</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Generator 101</title>
      <link href="/2016/07/30/generator-101/"/>
      <url>/2016/07/30/generator-101/</url>
      
        <content type="html"><![CDATA[<pre><code>function * HelloGen()&#123;  yield 100;  yield 400;&#125;var gen = HelloGen();console.log(gen.next()); // &#123;value: 100, done: false&#125;console.log(gen.next()); // &#123;value: 400, done: false&#125;console.log(gen.next()); // &#123;value: undefined, done: true&#125;`&lt;/pre&gt;&lt;pre&gt;`function * HelloGen2() &#123;  var a = yield 100;  var b = yield a + 100;  console.log(b);&#125;var gen2 = HelloGen2();console.log(gen2.next()); // &#123;value: 100, done: false&#125;console.log(gen2.nect(500)); // &#123;value: 600, done: false&#125;console.log(gen2.next(1000)); // &#123;value: undefined, done: done&#125;// prints 1000`&lt;/pre&gt;### Preventing Callback HellSo, how can generators be used to avoid callback hell? First, you need to understand a simple technique that we will be using heavily with generators to write code without callbacks.#### Understanding ThunksA thunk is a partially evaluated function which accepts a single callback as the argument. Within generators, we&#39;ll be yielding thunks to write without callbacks. A simple thunk is shown below.&lt;pre&gt;`function(callback) &#123;  fs.readFile(&#39;myfile.md&#39;, &#39;utf8&#39;, callback)&#125;`&lt;/pre&gt;Thunks can also be created dynamically as shown below:&lt;pre&gt;`function readFile(filename) &#123;  return function(callback) &#123;    fs.readFile(filename, &#39;utf8&#39;, callback);  &#125;;&#125;`&lt;/pre&gt;#### Using `co``co` is a nice module which helps to use thunks and generators together to create Node.js applications without callbacks.A simple application which uses `co` and the `readFile()` thunk.&lt;pre&gt;`var co = require(&#39;co&#39;);co(function* ()&#123;  var file1 = yield readFile(&#39;file1.md&#39;);  var file2 = yield readFile(&#39;file2.md&#39;);  console.log(file1);  console.log(file2);&#125;)();`&lt;/pre&gt;As you can see, we are no longer using callbacks. This gives us a simple way to write large modular Node apps easily.###### How `co` Works Internally</code></pre><ol><li><p>First, it calls <code>next(null)</code> and gets a thunk.</p></li><li><p>Then, it evaluate the thunk and saves the result.</p></li><li><p>Then, it calls <code>next(savedResult)</code>(in this case, saveResult == readFile(‘file1.md’), and next(savedResult) pass the content to var file1)</p></li><li><p>Repeat these steps until <code>next()</code> return <code>&#123;done: true&#125;</code></p><p>A minimal version of <code>co</code> written to show how it works internally.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function co(generator)&#123;</span><br><span class="line">  var gen &#x3D; generator();</span><br><span class="line"></span><br><span class="line">function nextItem(err, result) &#123;</span><br><span class="line">    var item &#x3D; gen.next(result);</span><br><span class="line"></span><br><span class="line">&lt;pre&gt;&#96;if (!item.done) &#123;</span><br><span class="line">  item.value(nextItem); &#x2F;&#x2F; item.value is a thunk, because yield a thunk</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p>}</p><p>nextItem();<br>}</p>]]></content>
      
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> Thunk </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>__Proto__与 Prototype</title>
      <link href="/2016/07/30/proto-e4-b8-8e-prototype/"/>
      <url>/2016/07/30/proto-e4-b8-8e-prototype/</url>
      
        <content type="html"><![CDATA[<p>简而言之,</p><pre><code>x.__proto__ === x.constructor.prototype`&lt;/pre&gt;在 JS 世界里, 万物皆对象Function 是对象, Function.prototype 也是对象, 因此他们具有对象的共性: **proto**属性&lt;pre&gt;`Function.__proto__ === Function.prototype; // Function 的构造函数还是 FunctionFunction.prototype.__proto__ === Object.prototye; Function.prototype 的构造函数是 Object()`&lt;/pre&gt;而 Object 的构造函数也是 Function, 所以&lt;pre&gt;`Object.__proto__ === Function.prototype</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>彻底理解 Thunk 函数</title>
      <link href="/2016/07/30/e5-bd-bb-e5-ba-95-e7-90-86-e8-a7-a3-thunk-e5-87-bd-e6-95-b0/"/>
      <url>/2016/07/30/e5-bd-bb-e5-ba-95-e7-90-86-e8-a7-a3-thunk-e5-87-bd-e6-95-b0/</url>
      
        <content type="html"><![CDATA[<h3 id="生成器函数"><a href="#生成器函数" class="headerlink" title="生成器函数"></a>生成器函数</h3><p>生成器(Generator)函数写成:</p><pre><code>function* func () &#123;&#125;`&lt;/pre&gt;其本质也是一个函数, 所以他具备普通函数所具有的所有特性, 除此以外, 他还具有以下特性</code></pre><ol><li><p>执行生成器函数后返回一个迭代器(Iterator)</p></li><li><p>生成器函数内部可以使用 yield 或 yield*, 函数执行到 yield 的时候会暂停执行, 并返回 yield 后面表达式的值, 通过迭代器的 next() 方法返回一个对象, 该对象由 value 和 done 属性组成, 其中, value 属性值为 yield 后面表达式的值, done 属性表示生成器的执行状态</p></li><li><p>迭代器 next() 方法的参数是 yield 表达式的值</p></li><li><p>当 next 指向最后一个 yield 的时候, 再次执行 next() 方法, 返回的对象中 done: true, 而 value 的值为 return 后面的表达式(默认为 undefined)</p><h4 id="例一"><a href="#例一" class="headerlink" title="例一"></a>例一</h4><pre>`function test() {  return 'b';}function* func() {  var a = yield 'a';  console.log('gen', a); // 'gen: undefined' - (如果 next 方法不带参数, yield 表达式返回 undefined)  var b = yield test();  console.log('gen': b); // 'gen: undefined'}var func1 = func();var a = func1.next();console.log('next: ' a); // 'next: {value: 'a', done: false}'var b = func1.next();console.log('next: ' b); // 'next: {value: 'b', done: false}'var c = func1.next();console.log('next: ' c); // 'next: {value: undefined, done: true}'`</pre><h3 id="关于-yield"><a href="#关于-yield" class="headerlink" title="关于 yield*"></a>关于 yield*</h3><p>yield 暂停执行并返回后面表达式的值, 而 yield* 则将函数委托到另一个迭代器或可迭代对象</p><h4 id="arguments"><a href="#arguments" class="headerlink" title="arguments"></a>arguments</h4><pre>`&gt; function* genFunc(){... yield arguments;... yield* arguments;... }undefined&gt; var gen = genFunc(1,2);undefined&gt; gen.next(){ value: { '0': 1, '1': 2 }, done: false }&gt; gen.next(){ value: 1, done: false }&gt; gen.next(){ value: 2, done: false }&gt; gen.next(){ value: undefined, done: true }`</pre><h4 id="Generator"><a href="#Generator" class="headerlink" title="Generator"></a>Generator</h4><pre>`&gt; function * gen1(){... yield 2;... yield 3;... }undefined&gt; function * gen2(){... yield 1;... yield* gen1();... yield 4;... }undefined&gt; var g2 = gen2();undefined&gt; g2.next(){ value: 1, done: false }&gt; g2.next(){ value: 2, done: false }&gt; g2.next(){ value: 3, done: false }&gt; g2.next(){ value: 4, done: false }&gt; g2.next(){ value: undefined, done: true }`</pre><h3 id="Thunk-函数"><a href="#Thunk-函数" class="headerlink" title="Thunk 函数"></a>Thunk 函数</h3><p>在 co 的应用中, 为了能像同步代码那样书写异步代码, 比较多的使用方式是使用 thunk 函数(但不是唯一方式, 还可以是 Promise), 比如读取文件内容的异步函数 fs.readFile() 方法, 转化为 thunk 函数的方式如下</p><pre>`function readFile(path, encoding){  return function(cb){    fs.readFile(path, encoding, cb);  }}`</pre><p>Thunk 函数具备以下两个要素<br>1. 有且只有一个参数是 callback 的函数 <br>2. callback 的第一个参数是 error</p><p>使用 thunk 函数, 同时结合 co 我们就可以像书写同步代码一样书写异步代码</p><pre>`var co = require('co');var fs = require('fs');var Promise = require('es6-promise').Promise;function readFile(path, encoding){  return function(cb) { // thunk function    fs.readFile(path, encoding, cd);  };}co(function* () { // 外部不可见, 但在 co 内部其实已经转化成promise.then().catch()...链式调用的行驶  var a = yield readFile('a.txt', {encoding: 'utf-8'});  console.log(a); // a  var b = yield readFile('b.txt', {encoding: 'utf-8'});  console.log(b); // b  return yield Promise.resolve(a+b);}).then(function(val){  console.log(val) // ab}).catch(function(error){  console.log(error);})`</pre><p>有一个框架 thunkify 可以帮我们轻松实现以上步骤</p><pre>`var co = require('co');var thunkify = require('thunkify');var fs = requrie('fs');var Promise = require('es6-promise').Promise;var readFile = thunkify(fs.readFile);co(function* () { // 外部不可见， 但在 co 内部已经转化为 promise 的链式调用  var a = yield readFile('a.txt', {encoding: 'utf-8'});  console.log(a); // a  var b = yield readFile('b.txt', {encoding: 'utf-8'});  console.log(b); // b  return yield Promise.resolve(a+b);}).then(function(val){  console.log(val); // ab}).catch(function(err){  console.log(err);})`</pre><p>对于 thunkify 框架的理解注释如下：</p><pre>`/** * Module dependencies */var assert = require('assert');/** * Expose `thunkify()`. */module.exports = thunkify;function thunkify(fn) {  assert('function' == typeof fn, 'function required');  // 返回一个包含 thunk 函数的函数, 返回的 thunk 函数用于执行yield, 而外层的这个函数用于给 thunk 函数传递其他参数  return function() {    var args = new Array(arguments.length);    // 缓存上下文环境, 给 fn 提供执行环境    var ctx = this;    // 将参数类数组对象转为数组(实现方式略臃肿, 可以直接用Array.from)    for (var i = 0; i &lt; args.length; ++i){      args[i] = argumetns[i];    }    // 真正的 thunk 函数(有且只有一个参数, 并且参数是第一个参数为 err 的 callback)    return function(done) { // 返回 thunk 函数      var called;      // 将回调函数再包裹一层, 避免重复调用, 同时, 将包裹了的真正的回调函数 push 进参数数组(即将回调函数 done 作为最后一个参数传递给 fn)      args.push(function(){  // 将回调函数 done 加到参数列表尾部, 形成 fn 需要的 [arg1, ..., done]        if (called) return;        called = true;        done.apply(null, arguments); // 执行回调函数      });      try {        // 在 ctx 环境执行 fn        // 并将执行 thunkify 之后返回的函数的参数(含 done 回调) 传入, 类似于执行:        // fs.readFile(path, {encoding: 'utf-8'}, done)        fn.apply(ctx,args); // 类似 fn(arg1, .., done)      } catch(err) {        done(err);      }    }  }}</li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> Thunk </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSS 动画之硬件加速</title>
      <link href="/2016/07/27/css-e5-8a-a8-e7-94-bb-e4-b9-8b-e7-a1-ac-e4-bb-b6-e5-8a-a0-e9-80-9f/"/>
      <url>/2016/07/27/css-e5-8a-a8-e7-94-bb-e4-b9-8b-e7-a1-ac-e4-bb-b6-e5-8a-a0-e9-80-9f/</url>
      
        <content type="html"><![CDATA[<h3 id="触发硬件加速的-CSS-属性"><a href="#触发硬件加速的-CSS-属性" class="headerlink" title="触发硬件加速的 CSS 属性"></a>触发硬件加速的 CSS 属性</h3><ul><li>transform</li><li>opacity</li><li>filter</li></ul><h3 id="硬件加速的工作原理"><a href="#硬件加速的工作原理" class="headerlink" title="硬件加速的工作原理"></a>硬件加速的工作原理</h3><p>浏览器解析得到 DOM 树后, 与 CSS 形成渲染树, 渲染树上有大量的渲染元素, 每一个渲染元素都被分到一个图层中, 每个图层被加载到 GPU 形成渲染文理.</p><p>然而, transform 等 CSS 属性不会触发 GPU 的 repaint, 这些使用 transform 属性的图层都会有独立合成器进行处理.</p><p>比如某个元素具有 transform 属性, 那么会为他创建一个新的复合图层, 可以被 GPU 直接用来执行 transform 操作.</p><p>一般浏览器会在以下几种情况下创建一个独立的复合图层:</p><ul><li>3D 或 transform</li><li><code>&amp;lt;video</code> 和<code>&amp;lt;canvas&amp;gt;</code>标签</li><li>CSS Filters</li><li>元素覆盖时(比如 z-index)</li></ul><p>3D 和 2D 的 transform 区别在于, 浏览器在页面渲染前为 3D 动画创建独立的复合图层, 而在<strong>运行期间</strong>为 2D 动画创建独立复合图层. 2D transform 在动画开始和结束的时候依旧出现了初始化和删除的 repaint.</p><h3 id="强制使用-GPU-渲染"><a href="#强制使用-GPU-渲染" class="headerlink" title="强制使用 GPU 渲染"></a>强制使用 GPU 渲染</h3><p>为了避免 2D transform 动画的两次 repaint, 我们可以硬编码一些样式来解决这个问题</p><pre><code>.solution1&#123;  transform: translateZ(0);&#125;.solution2&#123;  transform: rotateZ(360deg)&#125;</code></pre><p>这段代码让浏览器执行 3Dtransform, 进而创建一个独立的复合涂层</p><h3 id="硬件加速缺点"><a href="#硬件加速缺点" class="headerlink" title="硬件加速缺点"></a>硬件加速缺点</h3><ol><li>内存, 如果 GPU 加载了大量文理, 容易发生内存问题</li><li>使用 GUP 渲染会影响字体的抗锯齿效果, 因为 GPU 和 CPU 渲染机制不同. 即使最终硬件加速停止了, 文本还是会在动画期间显得模糊.</li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>生成器 Function*</title>
      <link href="/2016/07/26/e7-94-9f-e6-88-90-e5-99-a8-function/"/>
      <url>/2016/07/26/e7-94-9f-e6-88-90-e5-99-a8-function/</url>
      
        <content type="html"><![CDATA[<p>function* 声明定义一个 generator( 生成器), 返回一个 Generator 对象</p><p>语法</p><pre><code>function* name([param[, param[, ...param]]])&#123; statements &#125;`&lt;/pre&gt;### 描述Generator 是一种可以从中退出并在之后重新进入的函数, 其环境(绑定的变量)会在每次执行后被保存, 下次进入时可以继续使用调用一个 Generator 并不马上执行它的主体, 而是返回一个 迭代器对象, 这个迭代器的 next() 方法被调用的时候, Generator 的主体会被执行至下一个 yield 表达式, 该表达式定义了迭代器的返回值### 示例&lt;pre&gt;`function* idMaker()&#123;  var index = 0;  while(index &amp;lt; 3)&#123;    yield index++;  &#125;&#125;var gen = idMaker(); //返回一个迭代器对象console.log(gen().next().value); // 0console.log(gen().next().value); // 1console.log(gen().next().value); // 2console.log(gen().next().value); // undefined</code></pre><p>谨慎使用, 因为其内部变量保持变化, 要每次输出的相互影响</p>]]></content>
      
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Webpack 杂</title>
      <link href="/2016/07/25/webpack-e6-9d-82/"/>
      <url>/2016/07/25/webpack-e6-9d-82/</url>
      
        <content type="html"><![CDATA[<h3 id="loaders"><a href="#loaders" class="headerlink" title="loaders"></a>loaders</h3><p>在 React 里会用到 JSX, ES6, js, 统一使用 .js 作为后缀, 便于 babel 配置</p><pre><code>npm install --save babel-loader//&#123;  test: /\.js?$/,  exclude: /node_modules/,  loader: &#39;babel&#39;,  query:&#123;    presets: [&#39;es2015&#39;, &#39;react&#39;]  &#125;&#125;`&lt;/pre&gt;CSS, SCSS, ICONFONT 字体文件&lt;pre&gt;`npm install --save style-loader css-loader sass-loader node-sass url-loader, file-loader//&#123;  test: /\.scss$/,  loader: &#39;style!css!sass&#39;&#125;,&#123;  test: /\.(png|jpg)$/,  loader: &#39;url?limit-8192&#39;&#125;</code></pre><h3 id="plugins"><a href="#plugins" class="headerlink" title="plugins"></a>plugins</h3><h4 id="html-webpack-plugin-会由-entry-得配置将入口文件所属的-html-文件作为模板-重新生成一个-html-文件-其中的静态资源都已经根据配置打包好"><a href="#html-webpack-plugin-会由-entry-得配置将入口文件所属的-html-文件作为模板-重新生成一个-html-文件-其中的静态资源都已经根据配置打包好" class="headerlink" title="html-webpack-plugin 会由 entry 得配置将入口文件所属的 html 文件作为模板, 重新生成一个 html 文件, 其中的静态资源都已经根据配置打包好"></a>html-webpack-plugin 会由 entry 得配置将入口文件所属的 html 文件作为模板, 重新生成一个 html 文件, 其中的静态资源都已经根据配置打包好</h4><p>使用 webpack 后, 对文件的版本 hash 会变得非常简单, 在出口文件 filename 中添加[hash]即可; 就目前而言, 清楚资源缓存的最好方法是文件名 hash, 由于每次改动后生成的文件名都不一样, 上线并不会覆盖之前的版本, 只是多了一个版本的文件, 页面即使同步有时间差, 要么访问旧版页面, 要么访问新版页面, 不会存在冲突. 这样服务器就可以放心的对静态资源开启永久强缓存, 并且有利于回滚, 至于静态资源产生的积压, 可以交由运维处理.</p>]]></content>
      
      
      
        <tags>
            
            <tag> Webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript 提高性能</title>
      <link href="/2016/07/25/javascript-e6-8f-90-e9-ab-98-e6-80-a7-e8-83-bd/"/>
      <url>/2016/07/25/javascript-e6-8f-90-e9-ab-98-e6-80-a7-e8-83-bd/</url>
      
        <content type="html"><![CDATA[<h3 id="针对-js-文件的加载位置"><a href="#针对-js-文件的加载位置" class="headerlink" title="针对 js 文件的加载位置"></a>针对 js 文件的加载位置</h3><p>在 HTML 文件中, &lt;script&gt;标签是可以加载&lt;head&gt;或&lt;body&gt;区域的, 由于 JavaScript 执行和 UI 渲染的是单线程的, 如果加载不顺畅可能导致堵塞, 造成页面空白或卡顿.<br>1. 如果 js 文件没有特殊要求致命需要在页面渲染之前加载, 那么应当将 &lt;script&gt;放在&lt;/body&gt;之前<br>2. 如果这些 js 文件有明确需求先于 body 执行, 那么就在第一个 js 或者页面上先放一个载入动画</p><h3 id="针对-js-文件的合并"><a href="#针对-js-文件的合并" class="headerlink" title="针对 js 文件的合并"></a>针对 js 文件的合并</h3><h3 id="更快速的数据访问"><a href="#更快速的数据访问" class="headerlink" title="更快速的数据访问"></a>更快速的数据访问</h3><p>对于浏览器而言, 一个标识符所处的位置约深, 去读写他的速度也越慢.</p><p>如果我们需要在当前函数内多次用到某一个值, 应当用一个局部变量将其保存</p><h3 id="DOM-操作的优化"><a href="#DOM-操作的优化" class="headerlink" title="DOM 操作的优化"></a>DOM 操作的优化</h3><p>DOM 操作远比 JavaScript 的执行更耗性能, 应当尽量减少该操作对性能的消耗.</p><pre><code>function innerLi_s()&#123;  var i = 0;  for(;i&amp;lt;20;i++)&#123;    document.getElementById(&#39;Num&#39;).innerHTML += &#39;A&#39;; //进行20此循环, 每次循环都进行2次DOM 元素的访问, 一次读取 innerHTML, 一次写入 innerHTML  &#125;&#125;// 改写为function innerLi_s()&#123;  var content = &#39;&#39;;  var i = 0;  for(;i&amp;lt;20;i++)&#123;    content += &#39;A&#39; //这里只对 js 的变量循环20次  &#125;;  document.getElementById(&#39;Num&#39;).innerHTML += content; //这里只进行2次 DOM 操作&#125;</code></pre><h3 id="减少-DOM-的重绘重排版"><a href="#减少-DOM-的重绘重排版" class="headerlink" title="减少 DOM 的重绘重排版"></a>减少 DOM 的重绘重排版</h3><p>元素的布局的改变或内容的增删改或浏览器尺寸的变化都会导致重排, 而字体颜色或背景色的修改会导致重绘.</p><p>合并同一对象的操作, 比如 background 的各个属性的修改可以合并为一个</p><h3 id="循环的优化"><a href="#循环的优化" class="headerlink" title="循环的优化"></a>循环的优化</h3><p>保存 arr.length, 避免多次访问</p>]]></content>
      
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CommonJS 规范</title>
      <link href="/2016/07/25/commonjs-e8-a7-84-e8-8c-83/"/>
      <url>/2016/07/25/commonjs-e8-a7-84-e8-8c-83/</url>
      
        <content type="html"><![CDATA[<p>概述<br>CommonJS 是服务器端模块的规范, Node.js 采用了这个规范</p><p>根据 CommonJS 规范, 一个单独的文件就是一个模块</p><p>加载模块使用 require 方法, 该方法读取一个文件并执行, 最后返回文件内部的 exports 对象.</p><pre><code>// example.jsconsole.log(&#39;evaluating example.js&#39;);var invisible = function()&#123;  console.log(&#39;invisible&#39;);&#125;exports.message = &#39;h1&#39;;exports.say = function()&#123;  console.log(message)&#125;`&lt;/pre&gt;使用 require 方法, 加载 example.js 模块&lt;pre&gt;`var example = require(&#39;./example.js&#39;);`&lt;/pre&gt;这时变量 example 就对应模块中 exports 对象, 可以通过这个对象应用模块中提供的各种方法.&lt;pre&gt;`&#123;  message: &#39;h1&#39;,  say: [Function]&#125;`&lt;/pre&gt;require 方法默认读取 js 文件, 所以可以省略 .js 扩展名&lt;pre&gt;`var example = require(&#39;./example&#39;)`&lt;/pre&gt;js 文件名前需要加上路径, 可以是相对路径, 也可以是绝对路径. 如果省略路径, node.js 会认为添加一个核心模块, 或者已经安装在本地 node_modules 目录中的模块. 如果加载的是一个目录, node.js 会首先寻找该目录中的 package.json 文件, 加载该文件 main 属性指定的模块, 否则就寻找该目录下的 index.js 文件定义一个最简单的模块&lt;pre&gt;`exports.add = function(a,b)&#123;return a+b&#125;;`&lt;/pre&gt;//add.js为 exports 对象添加一个 add 方法,&lt;pre&gt;`var addition = require(&#39;./add&#39;);addition.add(1,2); //3`&lt;/pre&gt;稍复杂的例子&lt;pre&gt;`//foobar.jsfunction foobar()&#123;  this.foo = function()&#123;    console.log(&#39;hello foo&#39;)  &#125;;  this.bar = function()&#123;    console.log(&#39;hello bar&#39;)  &#125;;&#125;exports.foobar = foobar;`&lt;/pre&gt;调用&lt;pre&gt;`var foobar = require(&#39;./foobar&#39;).foobar, test = new foobar();test.bar(); //&#39;hello bar&#39;`&lt;/pre&gt;有时不需要 exports 返回一个对象, 而仅需要返回一个函数, 就写成 module.exports&lt;pre&gt;`module.exports = function()&#123;  console.log(&#39;hello world&#39;)&#125;`&lt;/pre&gt;### AMD 规范与 CommonJS 规范的兼容性CommonJS 规范加载模块是同步的, 也就是说, 只有加载完成, 才能执行后面的操作. AMD 规范则是非同步加载模块, 允许指定回调函数. 由于 Node.js 主要用于服务器编程, 模块文件一般都已经存在于本地硬盘, 所以加载起来比较快, 不需要考虑非同步加载的方式, 所以 CommonJS 的规范比较适用. 但是, 如果是浏览器环境, 要从服务器端加载模块, 这时就必须采用非同步模式, 因此浏览器端一般采用 AMD 规范.AMD 规范适用 define 方法定义模块&lt;pre&gt;`define([&#39;package/lib&#39;, function(lib)&#123;  function foo()&#123;    lib.log(&#39;hello world!&#39;);  &#125;  return &#123;    foo:foo  &#125;;&#125;])`&lt;/pre&gt;AMD 规范允许输出的模块兼容 CommonJS 规范,在这时 define 方法需要写成如下格式&lt;pre&gt;`define(function(require, exports, module)  var someModule = require(&#39;someModule&#39;);  var anotherModule = require(&#39;anotherModule&#39;);  someModule.doTheAwesoem();  anotherModule.doMoreAwesome();  exports.asplode = function()&#123;    someModule.doTheAwesoem();    anotherModule.doMoreAwesome();  &#125;;);</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Webpack 开发和部署</title>
      <link href="/2016/07/22/webpack-e5-bc-80-e5-8f-91-e5-92-8c-e9-83-a8-e7-bd-b2/"/>
      <url>/2016/07/22/webpack-e5-bc-80-e5-8f-91-e5-92-8c-e9-83-a8-e7-bd-b2/</url>
      
        <content type="html"><![CDATA[<p>Thanks to <a href="https://github.com/vikingmute/webpack-for-fools/blob/master/entries/chapter-2.md">Webpack 傻瓜指南</a></p><h3 id="启用-Source-Map"><a href="#启用-Source-Map" class="headerlink" title="启用 Source Map"></a>启用 Source Map</h3><p>在 webpack.config.js 中添加字段</p><pre><code>devtool: &#39;eval-source-map&#39;,`&lt;/pre&gt;这样出错后会采用 sourceMap 直接显示出错位置### 配置 webpack-dev-server在 webpack.config.js 中添加字段&lt;pre&gt;`devServer: &#123;  historyApiFallback: true,  hot: true,  inline: true,  progress: true,&#125;`&lt;/pre&gt;### 使用 preLoaders 和 postLoaderspreLoaders 在 loaders 之前执行, 总体顺序是 preLoader -&gt; loaders -&gt; postLoaders#### 安装 jshint&lt;pre&gt;`npm install --save-dev jshint-loader`&lt;/pre&gt;在 config 中配置&lt;pre&gt;`module:&#123;  preloaders:[    &#123;      test: /\.jsx$/,      loader:&#39;jshint-loader&#39;    &#125;  ]&#125;jshint:&#123;  &#39;esnext&#39;:true&#125;`&lt;/pre&gt;### 部署上线项目开发完成后需要部署上线, 此时应该创建一个新的 config, 因为部署上线使用的 webpack 不需要 dev-tools, dev-server, jshint 等复制现有的 config 文件, 命名为 webpack.production.config.js, 将里面与开发有关的东西删除, 在 package.json 中添加&lt;pre&gt;`&quot;scripts&quot;:&#123;  &quot;build&quot;: &quot;webpack --progress --profile  --colors --config webpack.production.config.js&quot;&#125;,`&lt;/pre&gt;上线的时候运行&lt;pre&gt;`npm run build`&lt;/pre&gt;### 分离第三方库如果第三方库很多, 会导致最后 bundle 文件很大, 减慢加载速度, 因此需要把第三方库和 app 本身的代码分开#### 修改 entry 入口文件&lt;pre&gt;`entry:&#123;  app: path.resolve(APP_PATH, &#39;index.js&#39;),  //添加要打包在 vendors 里面的库  vendors: [&#39;jquery&#39;, [moment]]&#125;,`&lt;/pre&gt;#### 添加 CommonsChunkPlugin&lt;pre&gt;`plugins: [  //使用 uglifyJs 压缩 js 代码  new webpack.optimize.UglifyJsPlugin(&#123;minimize: true&#125;),  //把入口文件里的数组打包成 vendors.js  new webpack.optimize.CommonsChunkPlugin(&#39;vendors&#39;,&#39;vendors.js&#39;),  new HtmlWebpackPlugin(&#123;title: &#39;Welcome&#39;&#125;)]`&lt;/pre&gt;运行 build 后会生成 vendor.js### 生成多页面假设需求是生成两个页面, 一个叫 index.html, 需要引用 app.js 和 vendors.js 两个文件; 另一个是 mobile.html, 需要应用 mobie.js 和 vendor.js 这两个文件首先新建一个叫 mobile.js 的文件入口, 比 app.js 简单一些&lt;pre&gt;`import &#39;./main.scss&#39;;import $ from &#39;jquery&#39;;import &#39;imports?jQuery=jQuery!./plugin.js&#39;;$(document).ready(function()&#123;  let app = document.createElement(&#39;div&#39;);  app.innerHTML = &#39;&amp;lt;h1&amp;gt;Hello World&amp;lt;/h1&amp;gt;&#39;;  document.body.appendChild(app);  $(&#39;h1&#39;).greenify();&#125;);`&lt;/pre&gt;在 config 修改入口文件和输出配置&lt;pre&gt;`entry:&#123;  // 三个入口文件: app, mobile, vendors  app: path.resolve(APP_PATH, &#39;index.js&#39;),  mobile: path.resolve(APP_PATH, &#39;mobile.js&#39;),  vendors: [&#39;jquery&#39;,&#39;moment&#39;]&#125;,output:&#123;   path: DIST_PATH,   filename: &#39;[name].js&#39;&#125;,`&lt;/pre&gt;为 html-webpack-plugin 设置模板, 并保存于 templates&lt;pre&gt;`// index.html&amp;lt;!DOCTYPE html&amp;gt;&amp;lt;html&amp;gt;  &amp;lt;head&amp;gt;    &amp;lt;title&amp;gt;&#123;%= o.htmlWebpackPlugin.options.title %&#125;&amp;lt;/title&amp;gt;  &amp;lt;/head&amp;gt;  &amp;lt;body&amp;gt;    &amp;lt;h3&amp;gt;Welcome to Index&amp;lt;/h3&amp;gt;  &amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;//mobile.html&amp;lt;!DOCTYPE html&amp;gt;&amp;lt;html&amp;gt;  &amp;lt;head&amp;gt;    &amp;lt;title&amp;gt;&#123;%= o.HtmlWebpackPlugin.options.title %&#125;&amp;lt;/title&amp;gt;  &amp;lt;/head&amp;gt;  &amp;lt;body&amp;gt;    &amp;lt;h3&amp;gt;Welcome to Mobile&amp;lt;/h3&amp;gt;  &amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;`&lt;/pre&gt;继续配置 config.js, 让 HtmlWebpackPlugin 可以生成多个文件&lt;pre&gt;`//Templates 的文件夹路径var TEM_PATH = path.resolve(ROOT_PATE, &#39;templates&#39;);...plugins:[  //创建两个 HtmlWebpackPlugin 的实例, 生成两个页面  new HtmlWebpackPlugin(&#123;    title: &#39;Hello World App&#39;,    template: path.resolve(TEM_PATH, &#39;index.html&#39;),    filename: &#39;index.html&#39;    //chunks 这个参数告诉插件要引用 chunks 中的那几个入口    chunks: [&#39;app&#39;,&#39;vendors&#39;],    //scripts 要插入的位置    inject: &#39;body&#39;  &#125;),  new HtmlWebpackPlugin(&#123;    title: &#39;Hello Mobile App&#39;,    template: path.resolve(TEM_PATH, &#39;mobile.html&#39;),    filename: &#39;mobile.html&#39;,    chunks: [&#39;mobile&#39;,&#39;vendors&#39;],    inject: &#39;body&#39;  &#125;)]</code></pre><h3 id="生成-hash-名称的-script-来防止缓存"><a href="#生成-hash-名称的-script-来防止缓存" class="headerlink" title="生成 hash 名称的 script 来防止缓存"></a>生成 hash 名称的 script 来防止缓存</h3><p>webpack 基于 md5 可以生成 hash 名称</p><p>```<br>output:{<br>  path: DIST_Path,<br>  filename: ‘[name].[hash].js’<br>},</p>]]></content>
      
      
      
        <tags>
            
            <tag> Webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Webpack简明指南</title>
      <link href="/2016/07/21/webpack-e7-ae-80-e6-98-8e-e6-8c-87-e5-8d-97/"/>
      <url>/2016/07/21/webpack-e7-ae-80-e6-98-8e-e6-8c-87-e5-8d-97/</url>
      
        <content type="html"><![CDATA[<p>Thanks to <a href="https://github.com/vikingmute/webpack-for-fools/blob/master/entries/chapter-1.md">Webpack 傻瓜式指南</a></p><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><pre><code>npm install -g webpack`&lt;/pre&gt;### 建立项目&lt;pre&gt;`mkdir webpackcd webpacknpm inittouch .gitignore`&lt;/pre&gt;#### 项目结构&lt;pre&gt;`project||---app|    ||    |---index.js|    |---sub.js||---package.json||---webpack.config.js`&lt;/pre&gt;&lt;pre&gt;`//sub.jsfunction generateText()&#123;  var element = document.createElement(&#39;h2&#39;);  element.innerHTML = &quot;Hello, I&#39;m h2&quot;;  return element;&#125;module.exports = generateText;`&lt;/pre&gt;&lt;pre&gt;`//index.jsvar sub = require(&#39;./sub&#39;);var app = document.createElement(&#39;div&#39;);app.innerHTML = &quot;&amp;lt;h1&amp;gt;Hello, I&#39;m h1&quot;;app.appendChild(sub())`&lt;/pre&gt;### 配置 Webpack目的是将两个 js 根据依赖关系合并, 然后在 dist 目录创建一个 index.html 并引用合并后的 js.这里安装一个 plugin, 可以快速生成 HTML&lt;pre&gt;`npm install --save-dev html-webpack-plugin`&lt;/pre&gt;修改 webpack.config.js&lt;pre&gt;`var path = require(&#39;path&#39;);var HtmlWebpackPlugin = require(&#39;html-webpack-plugin&#39;);//定义文件夹路径var ROOT_PATH = path.resolve(__dirname);var APP_PATH = path.resolve(ROOT_PATH, &#39;app&#39;);var DIST_PATH = path.resolve(ROOT_PATH, &#39;dist&#39;);module.exports = &#123;  //项目文件夹, 可以直接用文件夹名, 默认寻找 index.js  entry: APP_PATH,  output: &#123;    path: DIST_PATH,    filename: &#39;bundle.js&#39;  &#125;,  //添加插件, 自动生成 html  plugins: [    new HtmlWebpackPlugin(&#123;title: &#39;Hello World App&#39;&#125;)  ]&#125;;`&lt;/pre&gt;然后在项目目录运行&lt;pre&gt;`webpack`&lt;/pre&gt;可以看到 html 已经引用了 bundle.js### 配置 webpack-dev-server用于自动刷新浏览器安装webpack-dev-server&lt;pre&gt;`npm install -g webpack-dev-server`&lt;/pre&gt;修改 webpack.config.js&lt;pre&gt;`module.exports = &#123;  ...  devServer: &#123;    historyApiFallback: true,    hot: true,        inline: true,    progress: true,  &#125;,  ...&#125;`&lt;/pre&gt;修改 package.json&lt;pre&gt;`...&quot;scripts&quot;: &#123;  &quot;start&quot;: &quot;webpack-dev-server --hot --inline&quot;&#125;,...`&lt;/pre&gt;在项目目录执行&lt;pre&gt;`npm start`&lt;/pre&gt;登录 http://localhost:8080### 添加 CSS 样式css-loader 会遍历 css 文件, style-loader 会把样式插入到&amp;lt;style&amp;gt;&lt;pre&gt;`npm install -save-dev css-loader style-laoder`&lt;/pre&gt;修改 webpack.config.js&lt;pre&gt;`...module:&#123;  loaders: [    &#123;      test: /\.css$/,      loaders: [&#39;style&#39;,&#39;css&#39;],      include: APP_PATH    &#125;  ]&#125;...`&lt;/pre&gt;注意 loaders 的书写方式, 从右向左执行添加样式文件 app/main.css&lt;pre&gt;`h1 &#123;  color: red;&#125;`&lt;/pre&gt;在入口文件&quot;index.js&quot; 中引用&lt;pre&gt;`require(&#39;./main.css&#39;)`&lt;/pre&gt;### 使用 sass这里需要 sass-loader 和 node-sass 一起解析文件&lt;pre&gt;`npm install --save-dev sass-loader node-sass`&lt;/pre&gt;修改 webpack.config.js&lt;pre&gt;`//先删除 css 规则&#123;  test: /\.scss$/,  loaders: [&#39;style&#39;,&#39;css&#39;,&#39;sass&#39;],  include: APP_PATH&#125;,`&lt;/pre&gt;添加两个 sass 文件 app/variables.scss 和 app/main.scss&lt;pre&gt;`//variables.scss$red: red;`&lt;/pre&gt;&lt;pre&gt;`//main.scss@import &#39;./variables.scss&#39;;h1&#123;  color: $red;&#125;`&lt;/pre&gt;在入口文件 index.js 中引用&lt;pre&gt;`require(&#39;./main.scss&#39;);`&lt;/pre&gt;### 处理图片&lt;pre&gt;`npm install --save-dev url-loader`&lt;/pre&gt;配置webpack.config.js&lt;pre&gt;`&#123;  test: /\.(png|jpg)$/,  loader: &#39;url?limit=8192&#39;&#125;`&lt;/pre&gt;注意, Limit参数制定了小于 8M 的图片会被转为 base64 编码, 可以减轻网络请求.&lt;pre&gt;`@import &#39;./variabels.scss&#39;h1 &#123;  color: $red;  background-image: url(&#39;./imgs/avatar.jpg&#39;);&#125;`&lt;/pre&gt;### 添加第三方库&lt;pre&gt;`npm install --save-dev jquery moment`&lt;/pre&gt;修改 index.js&lt;pre&gt;`var sub = require(&#39;./sub&#39;);require(&#39;./main.scss&#39;);var $ = require(&#39;jquery&#39;);var moment = require(&#39;moment&#39;);var app = document.createElement(&#39;div&#39;);app.innerHTML = &#39;&amp;lt;h1&amp;gt;Hello, h1&#39;;document.body.append(app);app.appendChild(sub());$(&#39;body&#39;).append(&#39;&amp;lt;p&amp;gt;Inserted By Jquery. Now is &#39; + moment().format() + &#39;&amp;lt;/p&amp;gt;&#39;);`&lt;/pre&gt;### 添加 ES6 支持安装 loader&lt;pre&gt;`npm install -save-dev babel-loader babel-preset-es2015`&lt;/pre&gt;配置 webpack.config.js&lt;pre&gt;`...&#123;  test: /\.jsx$/,  loaders: babel,  include: APP_PATH,  query:&#123;    presets: [&#39;es2015&#39;]  &#125;&#125;...`&lt;/pre&gt;es2015 这个参数是 babel 的 plugin, 可以支持最新的 ES6 的特性现在可以 js 文件改为 ES6 风格&lt;pre&gt;`//sub.jsexport default function()&#123;  var element = document.createElement(&#39;h2&#39;);  element.innerHTML = &#39;This is h2&#39;;  return element;&#125;`&lt;/pre&gt;&lt;pre&gt;`//index.jsimport &#39;./main.scss&#39;;import generateText from &#39;./sub&#39;;import $ from &#39;jquery&#39;;import moment from &#39;moment&#39;;let app = document.createElement(&#39;div&#39;);const myPromise = Promise.resolve(42);myPromise.then((number) =&amp;gt; &#123;  $(&#39;body&#39;).append(&#39;&amp;lt;p&amp;gt;Promise result is &#39; + number + &#39;now is &#39; + moment().format() + &#39;&amp;lt;/p&amp;gt;&#39;);&#125;);app.innerHTML = &#39;&amp;lt;h1&amp;gt;This is h1&#39;;document.body.appendChild(app);app.appendChild(generateText());</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> Webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Webpack.config.js</title>
      <link href="/2016/07/21/webpack-config-js/"/>
      <url>/2016/07/21/webpack-config-js/</url>
      
        <content type="html"><![CDATA[<h3 id="entry"><a href="#entry" class="headerlink" title="entry"></a>entry</h3><p>The entry point for the bundle.</p><p>If you pass a string: The string is resolved to a module which is loaded upon startup.</p><p>If you pass an array: All modules are loaded upon startup. The last one is exported.</p><pre><code>entry:[&#39;./entry1&#39;,&#39;./entry2&#39;]`&lt;/pre&gt;If you pass an object: Multiple entry bundles are created. The key is the chunk name. The value can be a string or an array&lt;pre&gt;`&#123;  entry:&#123;    page1: &#39;./pages1&#39;,    page2: [&#39;./entry1&#39;,&#39;./entry2&#39;]  &#125;,  output: &#123;    // Make sure to use [name] or [id] in output.filename    // when using multiple entry points    filename: &#39;[name].bundle.js&#39;,    chunkFilename: &#39;[id].bundle.js&#39;  &#125;&#125;`&lt;/pre&gt;### Output`output` options tell webpack how to write the compiled files to disk.Note, that while there can be multiple &#39;entry&#39; points, only &#39;output&#39; configuration is specified.If you use hashing(`[hash]` or `[chunkhash]`) make sure to have a consistent ordering of modules. Use the `OccurenceOrderPlugin` or `recordsPath`#### output.filenameSpecifies the name of each output file on disk. You must **not** specify an absolute path here! The `output.path` option determines the location on disk the files are written to, `filename` is used solely for naming the individual files.##### single entry&lt;pre&gt;`&#123;  entry: &#39;./src/app.js&#39;,  output: &#123;    filename: &#39;bundle.js&#39;,    path: &#39;./build&#39;  &#125;&#125;`&lt;/pre&gt;##### multiple entriesIf you configuration creates more than a single &quot;chunk&quot;(as with multiple entry points or when using plugins like CommonsChunkPlugin), you should use substitutions below to ensure that each file has a unique name.`[name]` is replaced by the name of the chunk`[hash]` is replaced by the hash of the compilation.`[chunkhash]` is replaced by the hash of the chunk.&lt;pre&gt;`&#123;  entry:&#123;    app: &#39;./src/app.js&#39;,    search: &#39;./src/search.js&#39;  &#125;,  output:&#123;    filename: [name].js,    path: __dirname + &#39;/built&#39;  &#125;&#125;</code></pre><h4 id="output-path"><a href="#output-path" class="headerlink" title="output.path"></a>output.path</h4><p>The output directory as <strong>absolute path</strong>(required).</p><h3 id="Module-loaders"><a href="#Module-loaders" class="headerlink" title="Module.loaders"></a>Module.loaders</h3><p>An array of automatically applied loaders.</p><p>Each item can have there properties:</p><ul><li><code>test</code>: A condition that must be met</li><li><code>exclude</code>: A condition that must not be met</li><li><code>include</code>: A condition that must be met</li><li><code>loader</code>: A string of ‘!’ separated loaders</li><li>‘loaders’: An array of loaders as string</li></ul><h3 id="resolve"><a href="#resolve" class="headerlink" title="resolve"></a>resolve</h3>]]></content>
      
      
      
        <tags>
            
            <tag> Webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Webpack</title>
      <link href="/2016/07/21/webpack-2/"/>
      <url>/2016/07/21/webpack-2/</url>
      
        <content type="html"><![CDATA[<h3 id="Use-webpack-in-a-project"><a href="#Use-webpack-in-a-project" class="headerlink" title="Use webpack in a project"></a>Use webpack in a project</h3><p>It’s best to have webpack <strong>as a dependency</strong> in your project, through this you can choose a local webpack version and will not be forced to use the single global one.<br>Add a <code>package.json</code> configuration file or <code>npm</code> with:</p><pre><code>$ npm init`&lt;/pre&gt;The answers to the question are not so important if you don&#39;t want to publish your project to npm.Install and add `webpack` to the `package.json` with:&lt;pre&gt;`$ npm install --save-dev webpack`&lt;/pre&gt;### Create a modular JavaScript ProjectLet&#39;s create some modules in JavaScript, using the CommonJS syntax:#### cat.js&lt;pre&gt;`var cats = [&#39;dave&#39;,&#39;henry&#39;,&#39;martha&#39;];module.exports = cats;`&lt;/pre&gt;#### app.js(Entry Point)&lt;pre&gt;`var cats = require(&#39;cats.js&#39;);console.log(cats);`&lt;/pre&gt;The **Entry Point** is where your application will start, and where webpack will start tracking dependencies between modules.Give webpack the entry point(app.js) and specify an output file(app.bundle.js):&lt;pre&gt;`webpack ./app.js app.bundle.js`&lt;/pre&gt;webpack will read and analyze the entry point and its dependencies(including transitive dependencies). Then it will bundle them into `app.bundle.js`.Now your bundle is ready to run. Run `node app.bundle.js` and marvel in your abundance of cats.To gain full access to webpack&#39;s flexibility, we need to create a &quot;configuration file&quot;### Project StructureWe will put the source files in **src**, and bundled files in **dist**.The final project structure will look like this:![](https://raw.githubusercontent.com/dtinth/webpack-docs-images/2459637650502958669ea6b11bf49dc0b3b083ae/usage/project-structure.png)</code></pre><ol><li><p>Create <code>webpack.config.js</code></p><pre>`module.exports = {  entry: './src/app.js',  output: {    path: './dist',    filename: '[name].bundle.js'  }};`</pre><p>A webpack configuration file is a CommonJS-Style module. So you can run any kind of code here, as long as a configuration object is exported out of its module.</p></li><li><p>Using loaders<br>Webpack only supports JavaScript modules natively, but most people will be using a transpiler for ES2015, CoffeeScript, TypeScript, etc. They can be used in webpack by using <strong>loaders</strong>.<br>Loaders are special modules webpack uses to ‘load’ other modules(written in another language) into JavaScript(that webpack understands).</p><p>using <code>babel-loader</code><br>1. Install Babel and the presets:</p><pre>`npm install --save-dev babel-loader`</pre></li><li><p>Configure Babel to use there presets by add <code>.babelrc</code></p><pre>`{'presets':['es2015']}`</pre></li><li><p>Modify <code>webpack.config.js</code> to process all <code>.js</code> files using <code>babel-loader</code>.</p><pre>`module.exports = {  entry: './src/app.js',  output: {    path: './dist',    filename: '[name].bundle.js'  },  module: {    loaders: [      {test: /\.js$/,exclude: /node_modules/, loader: 'babel-loader',}    ]  }}`</pre><p>We are excluding <code>node_modules</code> here because otherwise all external libraries will also go through Babel, slowing down compilation.<br>4. Install the libraries you want to use</p><pre>`npm install --save jquery babel-polyfill`</pre><p>We are using <code>--save</code> instead of <code>--save-dev</code> this time, as there libraries will be used in runtime. <code>-dev</code> means the libraries only used during development.</p></li><li><p>Edit <code>src/app.js</code></p><pre>`import 'babel-polyfill'; import cats from './cats'; import $ from 'jquery'; $('&lt;h1&gt;Cats&lt;/h1&gt;').appendTo('body'); const ul = $('&lt;ul&gt;&lt;/ul&gt;').appendTo('body'); for (const cat of cats) {     $('&lt;li&gt;&lt;/li&gt;').text(cat).appendTo(ul); } <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">    6\. Using Plugins</span><br><span class="line">    An example would be minifying your file so that the client can load if faster. This can be done with **plugins**. We&#39;ll add the uglify plugin to our configuration:</span><br><span class="line"></span><br><span class="line">const webwebpack &#x3D; require(&#39;webpack&#39;);</span><br><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">entry: &#39;.&#x2F;src&#x2F;app.js&#39;,</span><br><span class="line">output: &#123;</span><br><span class="line">path: &#39;.&#x2F;dist&#39;,</span><br><span class="line">filename: &#39;[name].bundle.js&#39;</span><br><span class="line">&#125;,</span><br><span class="line">module: &#123;</span><br><span class="line">loaders: [</span><br><span class="line">&#123;test: &#x2F;&amp;#46;jsx?$&#x2F;, exclude: &#x2F;node_modules&#x2F;,loader: &#39;babel-loader&#39;&#125;</span><br><span class="line">]</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">plugins: [</span><br><span class="line">new webpack.optimize.UglifyJsPlugin(&#123;</span><br><span class="line">compress: &#123;</span><br><span class="line">warning:false,</span><br><span class="line">&#125;,</span><br><span class="line">output: &#123;</span><br><span class="line">comments: false,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;),</span><br><span class="line">]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>The Uglify plugin is included with webpack so you don't need to add additional modules, but this may not always be the case.```</li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> Webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Refs to Components</title>
      <link href="/2016/07/21/refs-to-components/"/>
      <url>/2016/07/21/refs-to-components/</url>
      
        <content type="html"><![CDATA[<p>The DOM returned from render() is virtual, so called Virtual DOM, and we can get any factual input(value) from a virtual object, such as access to value from a <input> component.</p><h3 id="The-ref-returned-from-ReactDOM-render"><a href="#The-ref-returned-from-ReactDOM-render" class="headerlink" title="The ref returned from ReactDOM.render"></a>The ref returned from ReactDOM.render</h3><p>ReactDOM.render() will return a reference to your component’s <strong>backing instance</strong>(or null for stateless components)</p><p><code>var myComponent = ReactDOM.render(&amp;lt;MyComponent /&amp;gt;, myContainer)</code></p><p>However, that the JSX doesn’t return a component. It’s just a <strong>ReactElement</strong>: a lightweight representation that tells React what the mounted component should look like.</p><pre><code>var myComponentElement = &amp;lt;MyComponent title = &#39;title&#39;/&amp;gt;; //This is just a ReactElement`&lt;/pre&gt;&lt;pre&gt;`var myComponentInstance = ReactDOM.render(myComponent, myContainer); //a Virtual DOM`&lt;/pre&gt;### The ref Callback AttributeReact supports a special attribute that you can attach to any component. The &#39;ref&#39; attribute ca be a callback function, and this callback will be executed **immediately after the component is mounted**. The referenced component will be passed in as a parameter, and the callback function may use the component immediately, or save the reference for future use.It&#39;s as simple as adding a `ref` attribute to anything returned from render:&lt;pre&gt;`render: function()&#123;  return (    &amp;lt;TextInput ref=&#123;function(input)&#123;      if(input != nill)&#123;        input.focus();      &#125;    &#125;&#125; /&amp;gt;  );&#125;,`&lt;/pre&gt;or use ES6 arrow funciton:&lt;pre&gt;`render: function()&#123;  return &amp;lt;TextInput ref=&#123;(c) =&amp;gt; this._input = c&#125; /&amp;gt;;&#125;,componentDidMount: function&#123;  this._input.focus();&#125;`&lt;/pre&gt;### The ref String AttributeReact also supports using a string as a ref prop on any component.Add `ref` attribute to component so you can access to them via `this.refs`</code></pre><ol><li><p>Assign a <code>ref</code> attribute to anything returned from <code>render</code> such as:</p><pre>`&lt;input ref='myInput'&gt;`</pre></li><li><p>In some other code, access the <strong>backing instance</strong> via <code>this.refs</code> as in</p><pre>`var input = this.refs.myInput;var inputValue = input.value;`</pre><h3 id="A-Complete-Example"><a href="#A-Complete-Example" class="headerlink" title="A Complete Example"></a>A Complete Example</h3><pre>`var MyComponent = React.createClass({  handleClick: function(){    if(this.myTextInput != null){      this.myTextInput.focus()    }  },  render: function(){    return(      &lt;div&gt;        &lt;input type='text' ref={(ref) =&gt; this.myTextInput = ref} /&gt;        &lt;input type='button' value='Focus the text input' onClick = {this.handleClick} /&gt;      &lt;/div&gt;    );  }});ReactDOM.render(&lt;MyComponent /&gt;, document.getElementById('example'));</li></ol><p>Note: <code>ref</code> will be destroyed as component unmounted.</p>]]></content>
      
      
      
        <tags>
            
            <tag> React </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Component API</title>
      <link href="/2016/07/21/component-api/"/>
      <url>/2016/07/21/component-api/</url>
      
        <content type="html"><![CDATA[<h3 id="setState-nextState-obj-callback-function"><a href="#setState-nextState-obj-callback-function" class="headerlink" title="setState(nextState(obj)[, callback(function)])"></a>setState(nextState(obj)[, callback(function)])</h3><p>设置 nextState 的某个键值, 然后下一次 EventLoop 的时候 this.state 会被更新<br><strong>注意</strong>, setState 方法中的回调函数在组件重新渲染后才被调用</p><h3 id="replaceState-nextState-obj-callback-function"><a href="#replaceState-nextState-obj-callback-function" class="headerlink" title="replaceState(nextState(obj)[, callback(function)])"></a>replaceState(nextState(obj)[, callback(function)])</h3><p>类似于 setState(), 但是会删除已存在的 state 键, 相当于重新初始化State</p><h3 id="forceUpdate-callback-function"><a href="#forceUpdate-callback-function" class="headerlink" title="forceUpdate([callback(function)])"></a>forceUpdate([callback(function)])</h3><p>强制渲染组件<br><strong>注意</strong>该方法的回调函数也是在组件重新渲染完成后调用</p><h3 id="getDOMNode"><a href="#getDOMNode" class="headerlink" title="getDOMNode()"></a>getDOMNode()</h3><p>返回组件所处的 DOM 元素</p><h3 id="isMounted"><a href="#isMounted" class="headerlink" title="isMounted()"></a>isMounted()</h3><p>返回一个 Boolean 值, 如果组件加载到了 DOM, isMount() 返回 true.</p>]]></content>
      
      
      
        <tags>
            
            <tag> React </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>React 顶层 API</title>
      <link href="/2016/07/21/react-e9-a1-b6-e5-b1-82-api/"/>
      <url>/2016/07/21/react-e9-a1-b6-e5-b1-82-api/</url>
      
        <content type="html"><![CDATA[<h3 id="React-createClass-obj"><a href="#React-createClass-obj" class="headerlink" title="React.createClass(obj)"></a>React.createClass(obj)</h3><p>创建一个 ReactClass(组件类), 参数是一个对象且必须有 render 属性. 该方法必须返回一个封闭的容器或 null/false(表示不渲染)</p><p>在该方法中, 所有的 this 都会在最终调用的时候绑定到创建的组件的构造器上.</p><h3 id="React-createElement-TYPE-string-ReactClass-PROPS-CHILDREN-ReactElement"><a href="#React-createElement-TYPE-string-ReactClass-PROPS-CHILDREN-ReactElement" class="headerlink" title="React.createElement(TYPE(string|ReactClass)[, PROPS[, CHILDREN(ReactElement)]])"></a>React.createElement(TYPE(string|ReactClass)[, PROPS[, CHILDREN(ReactElement)]])</h3><p>创建一个指定类型的 React 元素(要区分 ReactClass(通性) 和 ReactElement( 个性) 和 Virtual DOM(实例), 通过 ReactClass 创建 ReactElement, 然后实例化成 Virtual DOM: 比如 ButtonComponent 是 Class, 而&lt;ButtonCompoennt /&gt;则是 Element, 最后通过 ReactDOM.render() 生成Virtual DOM)<br>第三个参数 Children 可以是人一个书的 React 元素</p><pre><code>React.createElement(&#39;div&#39;, null,   React.createElement(&#39;p&#39;, null,     React.createElement(Component, &#123;a:1&#125;)  ))`&lt;/pre&gt;### React.cloneElement(TYPE(ReactElement)[, PROPS(object)[, CHILDREN(ReactElement)]])克隆并返回一个新的 ReactElement(内部子元素也会随之克隆), 新返回的元素会保留就元素的 props, ref, key, 也会集成新的 props( 如果第二个参数不为 null)&lt;pre&gt;`var Hello = React.createClass(&#123;  render: function()&#123;    var span = &amp;lt;span a = &#39;1&#39;&amp;gt;Span&amp;lt;/span&amp;gt;;    var newSpan = React.cloneElement(span,&#123;b:&#39;2&#39;&#125;, &amp;lt;em&amp;gt;EM&amp;lt;/em&amp;gt;);    console.log(newSpan.props);    return &amp;lt;div&amp;gt;Hello &#123;span&#125;,&#123;newSpan&#125;&amp;lt;/div&amp;gt;;  &#125;&#125;);`&lt;/pre&gt;注意 createElement的第一个参数必须是字符串或者 ReactClass, 而 cloneElement 的第一个参数只能是 ReactClass### React.createFactory(TYPE(string|ReactElement))返回一个某种类型的 ReactElement 工厂函数, 可以利用返回的函数来创建一个 ReactElement( 配置 props 和 children)&lt;pre&gt;`var Component = React.createClass(&#123;  render:function()&#123;    return this.props.a == 1? &amp;lt;p&amp;gt;123&amp;lt;/p&amp;gt; : null;  &#125;&#125;);var p = React.createFactory(Component),    ReactElementP = p&#123;&#123;a:1&#125;&#125;,    div = React.createFactory(&#39;div&#39;),    ReactElementDiv = div(null, ReactElementP);React.render(  ReactElementDiv, document.body);`&lt;/pre&gt;### React.render(REACTELEMENT(ReactElement), CONTAINER(DOMElement)[, CALLBACK(function)])渲染一个 ReactElement 到 container 指定的 DOM 中, 并返回一个到该组件的引用. 如果提供了可选的回调函数, 则该函数会在组件渲染或更新之后调用如果我们希望在组件外部可以获得组件内部(能通过 this 访问)的东西, 可以将 React.render 的返回值赋予一个变量, 在后续的调用中访问变量即可.### React.unmountComponentAtNode(CONTAINER(DOMElement)从 container 指定的 DOM 中移除已经加载的 ReactElement, 清楚相应的事件处理器和 state, 如果在 container 中没有存在的组件, 则不作处理如果组件清除成功, 则返回 true### React.renderToString(REACTELEMENT(ReactElement))React 为服务端提供的一个方法, 可以直接输出 ReactElement 为 HTML 字符串, 将这些标记发送(比如 res.write(HTMLString))给客户端, 可以获得更快的页面加载速度, 并有利于搜索引擎的抓取&lt;pre&gt;`var com = &amp;lt;Component /&amp;gt;comHTML = React.renderToString(com) //HTMLString`&lt;/pre&gt;### React.renderToStaticMarkup类似于 React.renderToString, 但只生成纯粹的 HTML 标记字符串, 不会包含类似 dta-reactid 之类的 React 属性, 从而节约字节数### React.initializeTouchs(ShouldUserTouch(boolean))开启或关闭 React 的触摸事件机制, 传入参数 true 使 React 响应 Touch 事件### React.Chilren#### React.Children.map(obj children, function[, object context])遍历子元素, 映射为一个新的子元素集合&lt;pre&gt;`var Component = React.createClass(&#123;  render: function()&#123;    return (      &amp;lt;ul&amp;gt;        &#123;React.Children.map&#123;          this.props.children, function()&#123;            return &amp;lt;li&amp;gt;&#123;child&#125;&amp;lt;/li&amp;gt;            &#125;          &#125;        &#125;      &amp;lt;/ul&amp;gt;    )  &#125;&#125;)</code></pre><h4 id="React-Children-forEach-obj-children-function-obj-context"><a href="#React-Children-forEach-obj-children-function-obj-context" class="headerlink" title="React.Children.forEach(obj children, function[, obj context])"></a>React.Children.forEach(obj children, function[, obj context])</h4><p>遍历子元素, 对每个子元素执行回调, 但不会返回一个新的集合</p><h4 id="React-Children-count-obj-children"><a href="#React-Children-count-obj-children" class="headerlink" title="React.Children.count(obj children)"></a>React.Children.count(obj children)</h4><p>返回子元素总个数</p>]]></content>
      
      
      
        <tags>
            
            <tag> React </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Updating With React.render</title>
      <link href="/2016/07/20/updating-with-react-render/"/>
      <url>/2016/07/20/updating-with-react-render/</url>
      
        <content type="html"><![CDATA[<h3 id="What-does-React-render-do"><a href="#What-does-React-render-do" class="headerlink" title="What does React.render do"></a>What does React.render do</h3><ol><li>First, validate the inputs</li><li>If there was no previous component, render as a new component</li><li>Otherwise, compare the next component to the previous component using <strong>“shouldCUpdateComponent”</strong></li><li>If <strong>“shouldUpdateComponent”</strong> is true, update the component using ReactComponent.updateComponent. Otherwise, unmount and continue to render as a new component</li></ol><p><code>React.render</code> gives you a declarative way to use React’s update flow at the top level, similar to how re-rendering works inside a component. Many times, however, you can create a wrapper component so that you only have a single <code>React.render</code> call. This allows you to keep the logic inside components, which may be cleaner.</p>]]></content>
      
      
      
        <tags>
            
            <tag> React </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>React 组件生命周期</title>
      <link href="/2016/07/20/react-e7-bb-84-e4-bb-b6-e7-94-9f-e5-91-bd-e5-91-a8-e6-9c-9f/"/>
      <url>/2016/07/20/react-e7-bb-84-e4-bb-b6-e7-94-9f-e5-91-bd-e5-91-a8-e6-9c-9f/</url>
      
        <content type="html"><![CDATA[<h3 id="Mounting-组件初始化相关"><a href="#Mounting-组件初始化相关" class="headerlink" title="Mounting/组件初始化相关"></a>Mounting/组件初始化相关</h3><p>componentWillMount<br>componentDidMount</p><h3 id="Updating-组件更新相关"><a href="#Updating-组件更新相关" class="headerlink" title="Updating/组件更新相关"></a>Updating/组件更新相关</h3><p>componentWillReceiveProps<br>shouldComponentUpdate<br>componentWillUpdate<br>componentDidUpdate</p><h3 id="Unmounting-组件移除相关"><a href="#Unmounting-组件移除相关" class="headerlink" title="Unmounting/组件移除相关"></a>Unmounting/组件移除相关</h3><p>componentWillUnmount</p><h3 id="Initial-相关"><a href="#Initial-相关" class="headerlink" title="Initial 相关"></a>Initial 相关</h3><p>getDefaultProps<br>getInitialState</p><h4 id="componentWillMount"><a href="#componentWillMount" class="headerlink" title="componentWillMount"></a>componentWillMount</h4><p>在组件初始化前执行, 但仅执行一次, 即使多次重复渲染该组件,或者改变组件的 state<br>如果希望该回调能执行多次, 可以使用 React.unmountComponentAtNode 移除已有的组件, 然后重新 render</p><h4 id="componentDidMount"><a href="#componentDidMount" class="headerlink" title="componentDidMount"></a>componentDidMount</h4><p>在组件初始化完成时触发, 同样只能触发一次</p><h4 id="componentWillReceiveProps"><a href="#componentWillReceiveProps" class="headerlink" title="componentWillReceiveProps"></a>componentWillReceiveProps</h4><p>在组件接收到新的 props 的时间点之前调用, 注意初始化的时候不会触发(此时初始化 props, 而不是获得新的 props), 但是如果组件重复渲染(没有移除), 则会触发此事件</p><h4 id="shouldComponentUpdate"><a href="#shouldComponentUpdate" class="headerlink" title="shouldComponentUpdate"></a>shouldComponentUpdate</h4><p>组件接收到新的 props 或 state 的时候(此时还没进行下一次 render) 会立即调用, 然后通过返回布尔值决定是否要重新渲染当前组件<br>该接口接收两个参数, 第一个参数表示新的props, 第二个表示新的 state</p><pre><code>shouldComponentUpdate:function()&#123;return true&#125; //重新渲染组件</code></pre><h4 id="componentWillUpdate"><a href="#componentWillUpdate" class="headerlink" title="componentWillUpdate"></a>componentWillUpdate</h4><p>shouldComponentUpdate 返回 true 的时候调用, 此时 props 和 state 都是更新后的值, 而组件尚未重新渲染</p><h4 id="componentDidUpdate"><a href="#componentDidUpdate" class="headerlink" title="componentDidUpdate"></a>componentDidUpdate</h4><p>重新渲染后才会触发</p><h4 id="componentWillUnmount"><a href="#componentWillUnmount" class="headerlink" title="componentWillUnmount"></a>componentWillUnmount</h4><p>组件被移除之前触发, 用于做一些必要的清理, 比如无效的定时器等</p><h4 id="getDefaultProps"><a href="#getDefaultProps" class="headerlink" title="getDefaultProps"></a>getDefaultProps</h4><p>该方法是最先触发的, 可以在该方法中 return 一个对象作为组件的默认 Props(当然如果有从父组件传来的 props, 则以传进来的为主)<br>只在组件初始化的时候执行一次</p><h4 id="getInitialState"><a href="#getInitialState" class="headerlink" title="getInitialState"></a>getInitialState</h4>]]></content>
      
      
      
        <tags>
            
            <tag> React </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Webpack</title>
      <link href="/2016/07/20/webpack/"/>
      <url>/2016/07/20/webpack/</url>
      
        <content type="html"><![CDATA[<p>Webpack 是一款模块加载兼打包工具, 能把各种资源, 例如 JS(X), coffee, css(sass/less), 图片等都作为模块来使用和处理</p><p>可以直接使用 require 的形式来引入各模块, 即时他们可能需要经过编译, webpack 上有各种健全的加载器(loader)会处理这些事情.</p><h3 id="Webpack-优势"><a href="#Webpack-优势" class="headerlink" title="Webpack 优势"></a>Webpack 优势</h3><ol><li>webpack 是一 commonJS 的形式来书写脚本的, 但对 AMD/CMD 的支持也很全面, 方便就项目进行代码迁移</li><li>能被模块化的不仅是 JS 了</li><li>开发便捷, 能替代部分 grunt/gulp 工作, 比如打包, 压缩混淆, 图片转 base64等</li><li>扩展性强, 插件机制完善, 特别支持 React 热拔插(react-hot-loader).</li></ol><h3 id="安装与配置"><a href="#安装与配置" class="headerlink" title="安装与配置"></a>安装与配置</h3><p>常规使用 npm 安装<br><code>$npm install -g webpack</code><br>如果是常规项目, 还是把依赖写入 package.json 更好</p><pre><code>$npm init$npm install --save-dev webpack`&lt;/pre&gt;### 配置每个项目下都必须配置一个 webpack.config.js, 他的作用如同常规的 gulpfile.js, 就是一个配置项, 告诉 webpack 需要做什么比如:&lt;pre&gt;`var webpack = require(&#39;webpack&#39;);var commonsPlugin = new webpack.optimize.CommonsChunkPlugin(&#39;common.js&#39;);module.exports = &#123;  //插件项  plugins: [commonsPlugin],  //页面入口文件配置  entry:&#123;    index: &#39;./src/js/page/entry1.js&#39;  &#125;,  //文件输出配置  output:&#123;    path: &#39;dist/js/page&#39;,    filename: &#39;[name].js&#39;  &#125;,  module:&#123;    //加载器配置    loaders:[      &#123;test: /\.css$/, loader: &#39;style-loader!css-loader&#39;&#125;,      &#123;test: /\.js$/, loader: &#39;jsx-loader?harmony&#39;&#125;,      &#123;test: /\.scss$/, loader: &#39;style!css!sass?sourceMap&#39;&#125;,      &#123;test: /\.(png|jpg)$/, loader: &#39;url-loader?limit-8192&#39;&#125;    ]  &#125;,&#125;;`&lt;/pre&gt;#### plugins 插件项这里使用了一个 CommonsChunkPlugin 的插件, 用于提取多个入口文件的公共部分, 然后生成一个 common.js 来访方便多页面之间的复用#### entry 是页面入口文件配置, output 是输出配置决定入口文件要生成什么名字的文件, 存放到哪里&lt;pre&gt;`&#123;  entry: &#123;    page1: &#39;./page1&#39;,    //支持数组, 将加载数组中的所有模块, 但一最后一个模块为输出    page2: [&#39;./entry1&#39;,&#39;./entry2&#39;]  &#125;,  output:&#123;    path:&#39;dist/js/page&#39;,    filename: &#39;[name].bundle.js&#39;  &#125;&#125;`&lt;/pre&gt;这段代码最终会生成一个page1.bundle.js, 和一个page2.bundle.js, 并存放到./dist/page下#### module.loaders 是最关键的配置告诉 webpack 每一种文件都要用什么加载器来处理多个 loader 之间用&#39;!&#39;连接所有加载器都要通过 npm 来加载配置信息的参数&#39;?limit=8192&#39;表示将所有小于8kb的图片都转为 base64格式, 超过8kb 的图片用 url-loader 来处理### 运行 webpack`$webpack --display-error-details`后面的参数&#39;--display-error-details&#39; 是推荐加上的, 方便出错的时候能查阅更详细的信息其他主要参数有&lt;pre&gt;`$webpack --config XXX.js //使用另一份配置文件$webpack --watch //监听变动并自动打包$webpack -p //压缩混淆脚本, 这个很重要$webpack -d //生成 map 隐射文件, 告知哪些模块被最终打包到哪里`&lt;/pre&gt;### 模块引入#### HTML直接在页面&amp;lt;body&amp;gt;中引入 webpack 最终生成的页面脚本即可&lt;pre&gt;`&amp;lt;body&amp;gt;  &amp;lt;script scr = &#39;dist/js/page/common.js&#39;&amp;gt;&amp;lt;/script&amp;gt;  &amp;lt;script scr = &#39;dist/js/page/index.js&#39;&amp;gt;&amp;lt;/script&amp;gt;&amp;lt;/body&amp;gt;`&lt;/pre&gt;可以看到连样式都不需要, 脚本执行的时候会动态生成&amp;lt;style&amp;gt;并注入 head#### JS各脚本模块可以直接用 commonJS 来书写, 并可以直接引入未经编译的模块, 比如 JSX, Sass, coffee 等(只要在 webpack.config.js 中配置好加载器)看一下编译前的页面入口文件(index.js)&lt;pre&gt;`require(&#39;../../css/reset.scss&#39;); //加载 Reset 模块require(&#39;../../css/allComponent.scss&#39;); //加载组件模块var React = require(&#39;react&#39;);var AppWrap = require(&#39;redux&#39;).createRedux;var Provider = require(&#39;redux/react&#39;).Provider;var stores = require(&#39;AppStore&#39;);var redux = createRedux(stores);var App = React.createClass(&#123;  render: function()&#123;    return (      &amp;lt;Provider redux = &#123;redux&#125;&amp;gt;        &#123;function() &#123;return &amp;lt;AppWrap /&amp;gt;;&#125;&#125;      &amp;lt;/Provider&amp;gt;    );  &#125;&#125;);ReactDOM.render(  &amp;lt;App /&amp;gt;,document.body);</code></pre><p>后续的都由 webpack 处理</p>]]></content>
      
      
      
        <tags>
            
            <tag> Webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Array.from()</title>
      <link href="/2016/07/20/array-from/"/>
      <url>/2016/07/20/array-from/</url>
      
        <content type="html"><![CDATA[<p>Array.from() 方法可以将一个类数组对象或可遍历对象转化为真正的数组.<br>在 ES6 中, Class 语法允许我们为内置类型(比如 Array) 和自定义类新建子类(比如叫 subArray), 这些子类也会继承父类的静态方法, 比如 subArray.from(), 调用该方法后会返回子类 subArray 一个实例, 而不是 Array 的实例.</p><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><pre><code>Array.from(arrayLike[, mapFn[, thisArg]])`&lt;/pre&gt;### 参数#### arrayLike想要转换成真实数组的类数组对象或可遍历对象#### manFn可选参数, 如果制定了该参数, 则最后生成的数组会经过 map 操作#### this.Arg可选参数, 执行 mapFn 时的 this 的值### 描述可以使用 Array.from()将下面的两种对象转换成数组- 类数组对象(拥有 length 属性和若干索引属性的任意对象)- 可遍历对象(可以迭代出其他对象, 比如有 Map 和 Set)Array.from(obj,mapFn,thisArg) 相当于 Array.from(obj).map(mapFn,thisArg)### 应用&lt;pre&gt;`var obj = &#123;length:5&#125;; // return &#123;length:5&#125;var arr =Array.from(obj); // namely Array.from(&#123;length:5&#125;), return [undefined * 5]Array.isArray(arr); //return truevar arr1 = Array.from(obj,(v,k) =&amp;gt; k); //return [0,1,2,3,4]</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>package.json 属性</title>
      <link href="/2016/07/20/package-json-e5-b1-9e-e6-80-a7/"/>
      <url>/2016/07/20/package-json-e5-b1-9e-e6-80-a7/</url>
      
        <content type="html"><![CDATA[<h3 id="name"><a href="#name" class="headerlink" title="name"></a>name</h3><p>package.json 中最重要的属性是 name 和 version. 这两个属性是必须要有的, 否则模块无法被安装. 这两个属性一起形成了一个 npm 模块的唯一标识符.<br>模块中内容变化的同时, 模块版本也应该一起变化.<br>name 属性就是你的模块名称, 下面是一些命名规则:</p><ul><li>name 必须小于等于214字节, 包括前缀名称在内(如../..module)</li><li>name 不能以’_’或’.’开头</li><li>不能有大写字母</li><li>name 会成为 url 的一部分, 不能有 url 非法字符</li><li>不要使用和 node 核心模块一样的名称</li><li>name 中不要有 ‘js’ 和 ‘node’</li></ul><h3 id="version"><a href="#version" class="headerlink" title="version"></a>version</h3><p>version 必须可以被 npm 依赖的一个 node-server 模块解析</p><h3 id="description"><a href="#description" class="headerlink" title="description"></a>description</h3><p>一个描述, 方便别人了解你的模块的作用, 搜索的时候也有用</p><h3 id="keywords"><a href="#keywords" class="headerlink" title="keywords"></a>keywords</h3><p>一个字符串数组, 方便别人搜到本模块</p><h3 id="homepage"><a href="#homepage" class="headerlink" title="homepage"></a>homepage</h3><p>项目主页 url<br>注意: 这个项目主页 url 和 url 属性不同, npm 注册工具会认为你把项目发布到其他地方了, 获取模块的时候不是从官方仓库后去, 而是去 url 配置的地址</p><h3 id="bugs"><a href="#bugs" class="headerlink" title="bugs"></a>bugs</h3><p>填写一个提交 bug 的地址或邮箱</p><pre><code>&#123; &#39;url&#39;: &#39;https://www.ezcook.de/project/issue&#39;, &#39;email&#39;: &#39;project@ezcook.de&#39;&#125;`&lt;/pre&gt;如果只填写一个, 可以返回字符串而不是对象### license为模块制定一个协议, 通知用户可以使用的权限, 最常见的是 BSD-3-Clause 或 MIT&lt;pre&gt;`&#123;&#39;license&#39;: &#39;MIT&#39;&#125;`&lt;/pre&gt;### author, contributors### filesfiles 属性的值是一个数组, 内容是模块下文件名或文件夹名, 如果是文件夹名, 则文件夹下所有文件也会被包含.可以在模块根目录下创建一个 &#39;.npmignore&#39; 文件, 写在这个文件里的文件会被排除在 file 属性### mainmain 属性指定程序的主入口文件, 比如这个模块(文件夹)命名为&#39;foo&#39;, package.json中&#39; main&#39; 属性指定为&#39;test.js&#39;, 则通过 require(foo)来使用模块的时候会滴啊用 test.js 脚本.他应该指向模块根目录下得一个文件, 默认为 index.js### bin很多模块有一个或多个需要配置到 PATH 路径下的可执行模块...### man制定一个或通过数组指定一些文件夹让 linux 下的 man 指令查找文档地址### directories### repository指定一个代码存放的地址&lt;pre&gt;`&#39;repository&#39;:&#123;  &#39;type&#39;:&#39;git&#39;,  &#39;url&#39;:&#39;https://github.com/...&#39;&#125;</code></pre><p>如果是 Github, 可以用缩写完成<br>‘repository’:’gist:…’`</p><h3 id="scripts"><a href="#scripts" class="headerlink" title="scripts"></a>scripts</h3><p>scripts 属性是一个对象, 里面制定了项目的生命周期各个环节需要执行的命令, key 是生命周期中的时间, value 是要执行的命令<br>具体内容有 install, start, stop 等, 详情见<a href="https://docs.npmjs.com/misc/scripts">npm/scripts</a></p><h3 id="config"><a href="#config" class="headerlink" title="config"></a>config</h3><p>用来设置一些项目不怎么变化的项目配置, 如 port 等</p><h3 id="dependencies"><a href="#dependencies" class="headerlink" title="dependencies"></a>dependencies</h3><p>dependencies 属性是一个对象, 配置依赖模块的模块列表, key 是模块名称, vlaue 是版本范围, 版本范围是一个字符, 可以被一个或多个空格分隔.<br>比如</p><p>```<br>‘dependencies’:<br>{<br>  ‘foo’:’1.0.0 - 2.0.0’<br>  ‘foo1’:’&gt;=1.0.0’<br>}</p><h3 id="devDependencies"><a href="#devDependencies" class="headerlink" title="devDependencies"></a>devDependencies</h3><p>如果有人想下载并使用你的模块, 也许他们并不希望或需要下载一些你在开发过程中额外的测试或文档框架<br>这种情况下最好把这些依赖添加到 devDependencies 中, 这些模块会在 npm link 或者 npm install 的时候被安装, 也可以像其他 npm 配置一样被管理</p>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用 Npm 创建新工程</title>
      <link href="/2016/07/20/e4-bd-bf-e7-94-a8-npm-e5-88-9b-e5-bb-ba-e6-96-b0-e5-b7-a5-e7-a8-8b/"/>
      <url>/2016/07/20/e4-bd-bf-e7-94-a8-npm-e5-88-9b-e5-bb-ba-e6-96-b0-e5-b7-a5-e7-a8-8b/</url>
      
        <content type="html"><![CDATA[<p>创建一个工程目录, 并 cd 到目录中, 运行<br><code>$npm init</code><br>这个工具将引导你创建一个 package.json 文件, 他只覆盖了大多数一般的项目, 并尽量让默认内容全面.<br>运行<code>npm help json</code> 获取 package.json 中的各个字段的文档及其定义<br>后面可以用<br><code>npm install &amp;lt;pkg&amp;gt; --save</code><br>来安装一个包并将其存储为 package.json 文件中的一个依赖模块<br>任何时间按下^C 退出.<br>简单来说:<br><code>npm init</code> 创建或修改一个项目中的 package.json 文件<br>默认名称(显示在括号中)是当前文件夹的名字, 如果对于提示不输入任何字符并按下 Enter 键, npm 会将默认名称当做项目名称.<br>在完成提示内容后, npm init 将会给你一个即将创建的 package.json 文件的预览, 对于我们来说, 他看起来是这样的</p><pre><code>&#123;&quot;name&quot;:&quot;project-name&quot;,&quot;version&quot;:&quot;0.0.0&quot;,&quot;description&quot;:&quot;...&quot;,&quot;main&quot;:&quot;index.js&quot;,&quot;scripts&quot;:&#123;  &quot;test&quot;:&quot;echo \&quot;Error:no test specified\&quot; &amp;amp;&amp;amp; exit 1&quot;&#125;,&quot;keywords&quot;:[&quot;npm&quot;,&quot;example&quot;],&quot;author&quot;:&quot;YourName&quot;,&quot;license&quot;:&quot;MIT&quot;&#125;`&lt;/pre&gt;按下 Enter 进行确认, 你可以在后面随时修改, 通过编辑 package.json 或再次运行 npm init.npm init 永远也不会移除你放在 package.json 中的信息, 仅仅根据需求进行调整.### package.json一个项目的 package.json 文件担任下列角色- 他为 npm 提供一切信息- 他告诉 Node 怎样处理一个包- 他为人们查看项目提供一个进入点### 创建一个包进入点现在创建一个非常简单的脚本并将它存为 index.js&lt;pre&gt;`//index.jsconsole.log(&quot;Hello, npm&quot;);`&lt;/pre&gt;我们可以直接运行脚本&lt;pre&gt;`$node index.jsHello, npm`&lt;/pre&gt;我们可以通过使用 require, 在其他的 Node 应用中应用这段脚本. 首先进入 Node REPL, 一个交互的命令行环境:&lt;pre&gt;`$node&amp;gt; require(&#39;./index.js&#39;)Hello, npm&#123;&#125;`&lt;/pre&gt;(&#123;&#125;是 require 的返回值, 在这个例子中, 他是 index.js 的 exports 对象)Node 允许我们省略.js 扩展名, 因此我们可以简写为 require(&#39;,/index&#39;).如果我们在同一个 REPL 会话中再次运行 require, 我们将得到相同的返回值, 但是不会得到 console.log 输出, 因为 require 不会在同一个脚本中运行两次../在./index 中很重要, 因为他告诉 Node 这个路径是当前文件夹的相对路径. 如果我们不显示给出绝对路径或相对路径, 而是直接给 index, Node 会在一系列文件夹中寻找匹配的模块.回顾一下, 在 package.json 文件夹中, &#39;main&#39;:&#39;index.js&#39; 的作用是什么?当你 require 一个包含指向 main 脚本(&#39;main&#39;:&#39;index.js&#39;)的 package.json 文件的文件夹时, Node 会认为你是在 require 这个脚本(&#39;index.js&#39;), 所以前面的代码可以简写为&lt;pre&gt;`require(./)`&lt;/pre&gt;现在我们可以使用 package.json 来完成上面的工作, 因为我们的脚本命名为 index.js, 他是一个文件夹的默认脚本### 第一个依赖模块使用下面的命令来快速搜索 npm registry`$npm search color`如果想要获得更多的信息, 可以跳转到 npmjs.org, 在&quot;最多依赖&quot;的列表中可以查看流行的库安装依赖模块`$npm install --save colors`这条指令会在本地文件夹中创建一个名为 node_modules 的文件夹并将 colors 下载到其中. `--save`将依赖模块自动加入到 package.json 文件中.&lt;pre&gt;`&quot;dependencies&quot;&#123;  &quot;colors&quot;:&quot;~0.6.0-1&quot;&#125;`&lt;/pre&gt;现在我们来重写 index.js 来使用我们的新库. colors 扩展了 String 的原型因此我们可以非常简洁的表达带有颜色的文本:&lt;pre&gt;`var colors = require(&#39;colors&#39;);console.log(&#39;Hello, &#39;.red,&#39;npm&#39;.green);</code></pre><p>运行 index.js 文件, 你将在原来的输出中获得一个彩色字符串</p><h3 id="node-modules-的层级"><a href="#node-modules-的层级" class="headerlink" title="node_modules 的层级"></a>node_modules 的层级</h3><p>当不显示指定相对路径或绝对路径时, Node 首先查找本地的 ndoe_modules 文件夹, 当你使用 npm install 指令的时候这个文件夹被自动创建. 当 Node 发现 node_modules 下有一个叫做 colors 子目录时, Node 将他当做 require 的目标.<br><strong>查看 node_modules/colors/package.json, 可以找到’main’:’colors’ , 因此 require colors这个文件夹时 Node 会认为 require 了 colors.js 这个脚本</strong><br>然后从 require 函数中返回脚本中的 exports 对象.<br>如果找不到 colors 目录, 则会一直搜索到系统的根目录.</p>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Display:table-Cell</title>
      <link href="/2016/07/20/displaytable-cell/"/>
      <url>/2016/07/20/displaytable-cell/</url>
      
        <content type="html"><![CDATA[<h3 id="display-table-cell-属性简述"><a href="#display-table-cell-属性简述" class="headerlink" title="display:table-cell 属性简述"></a>display:table-cell 属性简述</h3><p><code>display:table-cell</code> 属性让标签元素鞥一表格单元格的形式呈现, 类似于 td 标签.<br><code>table-cell</code>与<code>float</code>, <code>position:absolute</code> 不兼容.<br><code>table-cell</code>元素可以设置 width, height, padding, 但是不能设置 margin, 和 td 标签一致.</p><h3 id="display-table-cell-与大小不固定元素的垂直居中"><a href="#display-table-cell-与大小不固定元素的垂直居中" class="headerlink" title="display:table-cell 与大小不固定元素的垂直居中"></a>display:table-cell 与大小不固定元素的垂直居中</h3><h3 id="display-table-cell-与两栏自适应布局"><a href="#display-table-cell-与两栏自适应布局" class="headerlink" title="display:table-cell 与两栏自适应布局"></a>display:table-cell 与两栏自适应布局</h3><h3 id="display-table-cell-等高布局"><a href="#display-table-cell-等高布局" class="headerlink" title="display:table-cell 等高布局"></a>display:table-cell 等高布局</h3><p>table 表格中的单元格最大的特点之一就是同一行列表元素都是登高的, 所以等高布局可以借助 table-cell 实现.<br><strong>匿名表格元素创建规则</strong>:CSS2中创建表格元素, 其依赖元素(比如 tr 之于 td, table 之于 tr) 会被模拟出来, 从而使得表格模型能够正常工作. 所有的表格元素都会自动在自身周围生成需要的匿名 table 对象, 使其符合 table/inline-table, table-row, table-cell 的三层嵌套关系.<br>要实现等高布局, 所有的 table-cell 元素一定要留一个用来包裹的标签, CSS 代码如下:</p><p>```<br>.list_row{display:table-row}<br>.list_cell{display:table-cell;width:30%,padding:1.6%; background-color:#F5F5F5;}<br>.list_center{background-color:#F0F3F9;}//用于和旁边的 cell 区分</p>]]></content>
      
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript 的闭包</title>
      <link href="/2016/07/19/javascript-e7-9a-84-e9-97-ad-e5-8c-85/"/>
      <url>/2016/07/19/javascript-e7-9a-84-e9-97-ad-e5-8c-85/</url>
      
        <content type="html"><![CDATA[<p>通常情况下, 求和函数的定义是这样的</p><pre><code>function sum(arr)&#123;  return arr.reduce(function(x,y)&#123;    return x+y;  &#125;);&#125;sum([1,2,3,4,5]); //15`&lt;/pre&gt;但是, 如果不需要立刻求和, 而是在后面的代码中根据需要进行计算, 可以选择返回一个保存了参数的求和函数&lt;pre&gt;`function lazy_sum(arr)&#123;  var sum = function()&#123;    return arr.reduce(function(x,y)&#123;      return x+y;    &#125;);  &#125;  return sum;&#125;`&lt;/pre&gt;当我们调用`f = lazy_sum()`时会返回保存了参数 arr 的 sum 函数, 直到通过 f()调用 sum 函数前都不会进行求和运算, 可以节约资源.**需要注意的一点**是每一次调用 lazy_sum() 都会返回一个新的函数, 彼此相互独立, 各自占用内存空间同时要注意, 尽管每次生成并返回的都是新的 sum 函数, 但是 lazy_sum() 的局部变量是通用的, 可参考**类方法**与**实例**的关系, 这是使用闭包的目的之一**更要注意**:&lt;pre&gt;`function count()&#123;  var arr = [];  for(var i = 1; i&amp;lt;=3; i++)&#123;    arr.push(function()&#123;        return i*i;      &#125;);  &#125;  return arr;&#125;var results = count();var f1 = results[0];var f2 = results[1];var f3 = results[2];</code></pre><p>在这个例子中, f1(), f2(), f3()的返回值都是16, 原因在于:<br>每一次循环都向 arr 推入一个(function(){})(i), 但都没有计算, 三次循环后 i 变成了4, 所以f1, f2, f3的函数接受的局部变量的值都是4.<br>由此可知闭包保留的是变量, 而不是变量的值.<br>如果一定要引用循环变量, 记得创建一个变量用于保存现场</p><p><strong>闭包可以用于实现装饰器</strong></p>]]></content>
      
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>前端工作流</title>
      <link href="/2016/07/19/e5-89-8d-e7-ab-af-e5-b7-a5-e4-bd-9c-e6-b5-81/"/>
      <url>/2016/07/19/e5-89-8d-e7-ab-af-e5-b7-a5-e4-bd-9c-e6-b5-81/</url>
      
        <content type="html"><![CDATA[<p>主要操作包含:</p><p>CSS 前缀补全, LESS/SASS 编译, CSS 压缩, JS 合并压缩 ,图片压缩, 部署发布</p><h3 id="流程分解"><a href="#流程分解" class="headerlink" title="流程分解"></a>流程分解</h3><p>主要分为</p><p>开发过程</p><p>和</p><p>部署过程</p><h4 id="开发过程"><a href="#开发过程" class="headerlink" title="开发过程"></a>开发过程</h4><p>要求每一次编辑都能在页面上即时相应</p><h4 id="部署过程"><a href="#部署过程" class="headerlink" title="部署过程"></a>部署过程</h4><ul><li>CSS Autoprefixer</li><li>Less/Sass =&gt; CSS</li><li>CSS 压缩合并</li><li>CSS Sprite</li><li>Retina @2x &amp; @3x 自动生成适配</li><li>imagemin 图片压缩</li><li>JS 合并压缩</li></ul><h3 id="项目目录结构"><a href="#项目目录结构" class="headerlink" title="项目目录结构"></a>项目目录结构</h3><p>project                  //项目目录<br>|____dev                 //开发目录<br>| |____html<br>| |____images<br>| |____scripts<br>| |____slice             //合成的雪碧图<br>| |____styles<br>|____dist                //生产目录<br>| |____html<br>| |____images<br>| |____scripts<br>| |____sprite            //仅从 src 复制<br>| |____styles<br>|____gulpfile.js<br>|____src                 //源文件目录<br>| |____html<br>| |____images<br>| |____scripts<br>| |____slice             //雪碧图素材<br>| |____styles</p>]]></content>
      
      
      
        <tags>
            
            <tag> Gulp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mac OS 下 实现 Tree 指令</title>
      <link href="/2016/07/19/macos-e4-b8-8b-e5-ae-9e-e7-8e-b0tree-e6-8c-87-e4-bb-a4/"/>
      <url>/2016/07/19/macos-e4-b8-8b-e5-ae-9e-e7-8e-b0tree-e6-8c-87-e4-bb-a4/</url>
      
        <content type="html"><![CDATA[<p>先安装 zsh<br>进入<code>~/.zshrc</code>, 添加<br><code>alias tree=&quot;find . -print | sed -e &#39;s;[^/]*/;|____;g;s;____|; |;g&#39;&quot;</code><br>回到目录, 执行<br><code>source .zshrc</code> 令修改立即生效<br>可以使用<code>tree</code>指令生成文档树</p>]]></content>
      
      
      
        <tags>
            
            <tag> Shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RegExp in JS</title>
      <link href="/2016/07/19/regexp-in-js/"/>
      <url>/2016/07/19/regexp-in-js/</url>
      
        <content type="html"><![CDATA[<h3 id="Literal"><a href="#Literal" class="headerlink" title="Literal"></a>Literal</h3><p><code>/patter/attributes</code></p><h3 id="new-RegExp"><a href="#new-RegExp" class="headerlink" title="new RegExp"></a>new RegExp</h3><p><code>new RegExp(pattern, attribtues)</code></p><h3 id="pattern"><a href="#pattern" class="headerlink" title="pattern"></a>pattern</h3><h3 id="RegExp-Attribtues"><a href="#RegExp-Attribtues" class="headerlink" title="RegExp Attribtues"></a>RegExp Attribtues</h3><ul><li>g: global</li><li>i: ignoreCase</li><li>m: multi-lines</li><li>source: literal text</li><li>lastIndex: mark the index where to start next match</li></ul><h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><pre><code>var re = new RegExp(&#39;^[0-9]+$&#39;,&#39;g&#39;);console.log(re.source); //^[0-9]+$`&lt;/pre&gt;&lt;pre&gt;`var re = new RegExp(&#39;\\d&#123;3&#125;&#39;,&#39;g&#39;);var str = &#39;123a456b&#39;;console.log(re.lastIndex); // 0re.exec(str); //return [&#39;123&#39;]console.log(re.lastIndex); // 3re.exec(str); // [&#39;456&#39;]console.log(re.lastIndex); //7re.exec(str);console.log(re.lastIndex) // 0, reset to 0 if exceed.re.lastIndex = 3; //Set Start Indexre.exec(str); // [&#39;456&#39;]</code></pre><h3 id="RegExp-Methods"><a href="#RegExp-Methods" class="headerlink" title="RegExp Methods"></a>RegExp Methods</h3><p>re.compile(re) //execute RegExp in scripts<br>re.exec(str) //return an Array including String, or null.<br>re.test(str) =&gt; true/false</p><h3 id="String-Methods"><a href="#String-Methods" class="headerlink" title="String Methods"></a>String Methods</h3><p>str.search(re,subStr)<br>str.match(re) =&gt; Array including String<br>str.replace(re,str) =&gt; new String<br>str.split(re)</p>]]></content>
      
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shell 指令</title>
      <link href="/2016/07/19/shell-e6-8c-87-e4-bb-a4/"/>
      <url>/2016/07/19/shell-e6-8c-87-e4-bb-a4/</url>
      
        <content type="html"><![CDATA[<p>Shell 在计算机科学中是指”提供用户使用界面”的软件, 通常指的是命令行界面的解析器, 一般来说, 这个词指的是操作系统中提供访问内核所提供服务的程序. Shell 也用于泛指为所有用户提供操作界面的程序, 也就是程序和用户交互的层面. 因此与之相对的是程序内核(Core), 内核不提供和用户的交互功能.</p><h3 id="bash-Bourne-Again-Shell-是-Linux-标准的默认-shell-支持-POSIX-标准-完全兼容-sh"><a href="#bash-Bourne-Again-Shell-是-Linux-标准的默认-shell-支持-POSIX-标准-完全兼容-sh" class="headerlink" title="bash (Bourne Again Shell) 是 Linux 标准的默认 shell, 支持 POSIX 标准, 完全兼容 sh."></a>bash (Bourne Again Shell) 是 Linux 标准的默认 shell, 支持 POSIX 标准, 完全兼容 sh.</h3><p>进入 shell: 一般 Linux 系统中, 桌面(GUI)状态下使用快捷键 Ctrl+Alt+T 能打开一个虚拟终端, 输入 shell 命令并执行.<br>退出 shell: 在 shell 中输入 exit 然后回车<br>默认提示符: 普通用户$, 根用户#<br>查看 shell 版本: <code>echo $SHELL</code><br>查看命令的辅助信息:<br><code>--help</code>, <code>--version</code></p><h3 id="目录文件指令"><a href="#目录文件指令" class="headerlink" title="目录文件指令"></a>目录文件指令</h3><p>pwd: 查看当前目录<br>echo $HOME 或者 echo ~: 查看主目录</p><p>ls: 列出文件或目录下的文件名</p><ul><li>-a(all): 显示所有文件, 包括隐藏文件</li><li>-l(long): 显示详细信息(long 表示长格式显示)</li><li>-d(detail): 显示目录属性</li><li>-h(human): 人性化显示文件大小</li><li>-i(inode): 显示 inode</li><li>-ll(ls -l): 显示目录下文件的长信息</li></ul><p>cd: 改变目录</p><ul><li>~ 进入当前用户的根目录</li><li>同上</li><li>-进入上次目录</li><li>.. 进入上一级目录</li><li>. 进入当前目录</li></ul><p>mkdir: 创建目录(文件夹)</p><ul><li>-p 递归创建<br>e.g. mkdir b/a =&gt;fail, mkdir不能创建多级目录<br>mkdir -p b/a 同时创建 b 和 a</li></ul><p>rmdir: 删除空目录</p><p>rm: 删除目录及文件</p><ul><li>-r强制删除目录</li><li>-f强制</li><li>一般用 rm -rf ..</li></ul><p>touch: 修改文件时间或者创建文件</p><p>chmod: 设置目录或文件的访问权限</p><ul><li>chmod[选项][操作对象][操作符][权限][文件名]</li><li>操作符号<ul><li><ul><li>添加某个权限</li></ul></li><li>-取消某个权限</li><li>=赋予给定权限并取消其他权限</li></ul></li><li>数字设定法<ul><li>chmod abc 文件名</li><li>其中 abc 各为一个数字, 分别表示 user, group, other 的权限</li><li>r为4, w为2, x为1, -为0(二进制位)</li><li>rwx = 7; rw- = 6; r-x = 5</li></ul></li><li>访问权限组(每一个文件或目录的访问权限都有三组)<br>在 Linux 中是按照用户和组来设定权限的<ul><li>所有者权限: 就是文件或者目录的创建者, 一般来说和 root 用户权限相当. 文件被创建时, 文件所有者自动拥有对该文件的读写和可执行权限.</li><li>同组权限: 就是所有者所在的用户组的其他成员的权限</li><li>其他用户权限</li></ul></li><li>访问权限(读取, 写入, 执行)<ul><li>r: 读取文件内容的权限, 或者浏览目录的权限</li><li>w: 新增,修改文件内容的权限, 或者删除, 移动目录内文件的权限</li><li>x: 执行文件的权限, 或者进入目录的权限</li></ul></li><li>用 -ll 也就是 -ls l显示文件或目录的详细信息, 最左的一列为文件的访问权限, 例如:<br><code>-rw-r--r-- 1 root root 483997 Jul 15 18:31 sobsrc.tgz</code><br>这里有10个位置, 第一个制定文件的类型, 通常意义上, 一个目录也是一个文件, 如果第一个字符是-, 表示是一个非目录文件, 如果是 d, 表示是一个目录</li></ul><table><thead><tr>  <th>-</th>  <th>rw-</th>  <th>r--</th>  <th>r--</th></tr></thead><tbody><tr>  <td>非目录的文件</td>  <td>所有者权限</td>  <td>组用户</td>  <td>其他用户</td></tr><tr>  <td>普通文件</td>  <td>可读写</td>  <td>只读</td>  <td>只读</td></tr></tbody></table><p>chown: 改变目录的所有者<br>cp: 复制目录或文件</p><ul><li>-r 复制目录</li><li>-p 连带文件属性复制</li><li>-d 若源文件是链接文件, 则复制链接属性</li><li>-a 相当于 -pdr</li><li>cp[现象][原文件或目录][目标目录]</li></ul><p>mv: 剪切或改名(move)</p><ul><li>mv a ../a 将当前目录下的 a 复制剪切到上一级的 a 目录中</li><li>mv abc.txt de.txt 如果原文件和目标文件在同一目录下, 则为改名, 否则是剪切</li></ul><h3 id="文件内容命令"><a href="#文件内容命令" class="headerlink" title="文件内容命令"></a>文件内容命令</h3><p>diff: 比较两个文件的差异<br>patch: 修补文件(给文件打补丁)<br>cat: 输出文件内容<br>more: 逐屏显示文件内容<br>less: 逐页显示文件内容<br>head: 显示文件开头若干行内容<br>tail: 显示文件最后若干行内容<br>od: 查看特殊格式的文件内容</p><h3 id="常见目录"><a href="#常见目录" class="headerlink" title="常见目录"></a>常见目录</h3><p>/ 根目录<br>/bin 存放必要的命令<br>/boot 存放内核以及启动所需要的文件<br>/dev 存放设备文件<br>/etc 存放系统的配置文件<br>/home 用户文件的主目录<br>/lib 存放必要的运行库<br>/mnt 存放临时的映射文件系统<br>/proc 存放存储进程和系统信息<br>/root 超级用户的主目录<br>/sbin 存放系统管理程序<br>/tmp 存放临时文件<br>/usr 包含了一般不需要修改的应用程序, 命令程序文件, 程序库,手册等<br>/usr/bin 系统命令(普通用户 home)<br>/usr/sbin 系统命令(超级用户 root)<br>/var 包含系统产生的经常变化的文件</p>]]></content>
      
      
      
        <tags>
            
            <tag> Shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mac OS 下前端开发环境配置</title>
      <link href="/2016/07/19/mac-os-e4-b8-8b-e5-89-8d-e7-ab-af-e5-bc-80-e5-8f-91-e7-8e-af-e5-a2-83-e9-85-8d-e7-bd-ae/"/>
      <url>/2016/07/19/mac-os-e4-b8-8b-e5-89-8d-e7-ab-af-e5-bc-80-e5-8f-91-e7-8e-af-e5-a2-83-e9-85-8d-e7-bd-ae/</url>
      
        <content type="html"><![CDATA[<h3 id="安装-homebrew"><a href="#安装-homebrew" class="headerlink" title="安装 homebrew"></a>安装 homebrew</h3><p>终端下执行<br><code>ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;</code></p><h3 id="配置-iterm2"><a href="#配置-iterm2" class="headerlink" title="配置 iterm2"></a>配置 iterm2</h3><p>下载后下载配色 solarized, 然后下载 zsh 和 oh-my-zsh, 添加插件 git, osx, ruby, autojump</p><h3 id="安装-Nginx"><a href="#安装-Nginx" class="headerlink" title="安装 Nginx"></a>安装 Nginx</h3><p>终端下执行<br><code>brew install nginx</code><br>安装完成后用浏览器打卡 <a href="http://localhost:8080/">http://localhost:8080</a>, 如果页面显示正常,则表示安装完成<br>nginx 有一下几个操作</p><pre><code>  #打开 nginx  nginx  #nginx -s 重新加载配置|重启|停止|退出  nginx -s reload|reopen|stop|quit  #测试配置是否有语法错误  nginx -t`&lt;/pre&gt;Note: 如果执行不成功, 请使用 sudo 提权默认访问目录是`/usr/local/Cellar/nginx/1.10.0/html`nginx 的配置文件位置为:`/usr/local/etc/nginx/nginx.conf`#### 配置 nginx首先备份一下 nginx.conf ==&gt; nginx.conf.default修改server 部分为:&lt;pre&gt;`server  &#123;    listen    8080;    server_name localhost;    location /&#123;      root /Users/YourId/Documents; //项目目录      #index index.html index.htm;    &#125;  &#125;`&lt;/pre&gt;配置完成后启动 nginx 即可访问### 安装 mySQL终端执行`brew install mysql` 安装完成后默认没有密码, 修改密码 ``` mysql -uroot -p Enter password: mysql&gt;use mysql; mysql&gt; UPDATE user SET password=password(&quot;修改的密码&quot;) WHERE user=&#39;root&#39;;mysql 的操作命令&lt;pre&gt;`  #开启  mysql.server start  #结束  mysql.server stop</code></pre><p>配置文件位于<br><code>/usr/local/Cellar/mysql/5.6.28/my.cnf</code></p>]]></content>
      
      
      
        <tags>
            
            <tag> HTML </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Component Children</title>
      <link href="/2016/07/18/component-children/"/>
      <url>/2016/07/18/component-children/</url>
      
        <content type="html"><![CDATA[<p><code>this.props.children</code></p><p>Children allow you to pass components as data to other components, just like any other prop you use. The special thing about children is that React provides support through its <em>ReactElement API</em> and JSX. XML children translate perfectly to React children.</p><pre><code>var MyDiv = React.createClass(&#123;  render: function()&#123;      return &amp;lt;div&amp;gt;&#123;this.props.children&#125;&amp;lt;/div&amp;gt;&#125;&#125;);ReactDOM.render(  &amp;lt;MyDiv&amp;gt;      &amp;lt;span&amp;gt;Hello&amp;lt;/span&amp;gt;      &amp;lt;span&amp;gt;World&amp;lt;/span&amp;gt;  &amp;lt;/MyDiv&amp;gt;,  node  );`&lt;/pre&gt;### this.props.childrenIf you look at the **JSX** transform, you&#39;ll find that XML children are appended as arguments to the _React.createElement_ call. Most often, your component will render content and include the children in the _render_ output. This is a great way to create UI components, like cards, headers, and buttons.Occasionally, you may want to interact with the children, maybe mutating or separating them. Be careful here and remember to treat **this.props.children** as an **opaque data structure**. Instead of working with **this.props.children** directly, use the **React.Children** utilities to work with children.&lt;pre&gt;`var ListComponent = React.createClasss(&#123;  render: function()&#123;      var children = React.Children.map(        this.props.children,        function(child)&#123;            return &amp;lt;li&amp;gt;&#123;child&#125;&amp;lt;li&amp;gt;        &#125;    );    return &amp;lt;ul&amp;gt;&#123;children&#125;&amp;lt;/ul&amp;gt;;  &#125;  &#125;);  var middleChildren = [  &amp;lt;strong key=&#39;2&#39;&amp;gt;Child 2&amp;lt;/strong&amp;gt;,  &amp;lt;a href=&#39;#&#39; key=&#39;3&#39;&amp;gt;Child 3&amp;lt;/a&amp;gt;  ];  ReactDOM.render(  &amp;lt;ListComponent&amp;gt;    &amp;lt;span&amp;gt;Child 1&amp;lt;/span&amp;gt;    &#123;middleChildren&#125;    &amp;lt;em&amp;gt;Child 4&amp;lt;/em&amp;gt;  &amp;lt;/ListComponent&amp;gt;,  document.body);</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> React </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Node</title>
      <link href="/2016/07/18/node/"/>
      <url>/2016/07/18/node/</url>
      
        <content type="html"><![CDATA[<p>A <strong>Node</strong> is an interface from which a number of DOM types, and allows these various types to be treated similarly.</p><h3 id="Properties"><a href="#Properties" class="headerlink" title="Properties"></a>Properties</h3><ul><li>Node.baseURI: return a DOMStirng representing the base URL</li><li>Node.childNodes: return a live NodeList containing all the children of this node. NodeList being live means that if the children of the Node change, the NodeList will update automatically.</li><li>Node.firstChild: return a Node representing the first direct child Node of this Node, or Null if the node has no child.</li><li>Node.lastChild: Return a Node representing the last direct child Node of this Node, or Null if the node has no child.</li><li>Node.nextSibling: return a Node representing the next Node in the tree, or null if there is no one.</li><li>Node.previousSibling</li><li>Node.nodeName: return a DOMString containing the name of the node. The structure of the name will differ with the name type. E.g. An HTMLElement will contain the name of the corresponding tag, like “audio”, for an HTMLAudioElement, a Text node will have the “#text” string, or a Document node will have the “#document” string.</li><li>Node.nodeType: return an unsigned short representing the type of the node. Possible values are:</li></ul><table><thead><tr>  <th align="left">Name</th>  <th align="left">Value</th></tr></thead><tbody><tr>  <td align="left">Element_Node</td>  <td align="left">1</td></tr><tr>  <td align="left">Attribute_Node</td>  <td align="left">2</td></tr><tr>  <td align="left">Text_Node</td>  <td align="left">3</td></tr><tr>  <td align="left">...</td>  <td align="left">...</td></tr><tr>  <td align="left">Document_Node</td>  <td align="left">9</td></tr><tr>  <td align="left">Document_Type_Node</td>  <td align="left">10</td></tr><tr>  <td align="left">Notation_Node</td>  <td align="left">12</td></tr></tbody></table><ul><li>Node.nodeValue: return a DOMString representing the value of an object. For most node types, this returns <strong>null</strong>, and any set operation is ignored.<br>For Nodes of type TEXT_NODE(Text objects), COMMENT_NODE(Comment objects), and PROGRESSING_INSTRUCTION_NODE(ProgressingInstruction objects), the value corresponds to the text data contained in the obejct.</li><li>Node.parentNode: return a Node that is the parent of this node, if there is no such node, like if this node is the top of the tree or if doesn’t participate in a tree, this property returns <strong>Null</strong>.</li><li>Node.parentElement: returns an Element that is the parent of this node. If the node has no parent, or if that parent is not an Element, this property returns <strong>Null</strong>.</li><li>Node.rootNode: return a Node representing the topmost Node in this tree or the current node if it’s the topmost node in the tree.</li><li>Node.textContent: is a DOMString representing the textual content of an element and all its descendants.</li></ul><h3 id="Methods"><a href="#Methods" class="headerlink" title="Methods"></a>Methods</h3><ul><li><p>Node.appendChild()</p></li><li><p>Node.cloneNode(): Clone a Node and optionally all of its contents. By default, it clones the content of the node.</p></li><li><p>Node.hasChildNodes(): return a <strong>boolean</strong> indicating if the element has any child nodes, or not.</p></li><li><p>Node.insertBefore(newNode, beforeItsChild)</p></li><li><p>Node.isEqualNode(): return a <strong>boolean</strong> which indicating whether or not two nodes are of the <strong>same type</strong> and all their defining data points match.</p></li><li><p>Node.isSameNode(): return a <strong>boolean</strong> value indicating whether or not the two nodes are the same(that is they reference the same object).</p></li><li><p>Node.removeChild()</p></li><li><p>Node.replace(newNode, replaceItsChild)</p><pre><code>*   Note: replaceNode will not generate new one.&lt;/p&gt;</code></pre><ul><li><p>E.g.</p><p><code>ul&amp;gt;li*3</code></p><p><code>ul.replace(li[2],li[0])</code></p><p>it will act as:<br>remove li[2], put it li[0], remove li[0], so the result looks like</p><p>ul</p></li></ul><p>–li[2]<br>–li[1]<br>`</pre></p><h3 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h3><h4 id="Browser-All-Child-Nodes"><a href="#Browser-All-Child-Nodes" class="headerlink" title="Browser All Child Nodes"></a>Browser All Child Nodes</h4><p>The following function recursively cycles all child nodes of a node and executes a callback function upon them(and upon the parent node itself).<pre>`function DOMComb(oParent, oCallBack){  if(oParent.hasChildNodes()){    for(var oNode = oParent.firstChild; oNode; oNode = oNode.nextSibling){      DOMComb(oNode, oCallBack);    }  }  oCallBack.call(oParent);}`</pre><h4 id="Remove-all-children-nested-within-a-node"><a href="#Remove-all-children-nested-within-a-node" class="headerlink" title="Remove all children nested within a node"></a>Remove all children nested within a node</h4><pre>`Element.prototype.removeAll = function(){  while(this.firstChild){    this.removeAll(this.firstChild);  }  return this;};</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>innerHTML and textContext and NodeValue</title>
      <link href="/2016/07/18/innerhtml-and-textcontext-and-nodevalue/"/>
      <url>/2016/07/18/innerhtml-and-textcontext-and-nodevalue/</url>
      
        <content type="html"><![CDATA[<p>Summary: </p><ul><li><strong>nodeValue</strong> is a little more confusing to use, but faster than innerHTML</li><li><strong>innerHTML</strong> parses content as HTML and takes longer(output <code>text/html</code>)</li><li><strong>textContent</strong> uses straight text, does not parse HTML, and is faster(output <code>text/plain</code>)</li><li><strong>innerText</strong> takes styles into consideration. It won’t get hidden text for instance.</li></ul><h3 id="node-textContent"><a href="#node-textContent" class="headerlink" title="node.textContent"></a>node.textContent</h3><p>The <strong>Node.textContent</strong> property represents the text content of a node and it descendants.</p><h4 id="Syntax"><a href="#Syntax" class="headerlink" title="Syntax"></a>Syntax</h4><p><code>example.textContent =&quot;&amp;lt;a href=&#39;...&#39;&amp;gt;textContent&amp;lt;/a&amp;gt;&quot;</code><br>will output <code>&amp;lt;a href=&#39;...&#39;&amp;gt;textContent&amp;lt;/a&amp;gt;</code></p><h4 id="Differences-from-innerText"><a href="#Differences-from-innerText" class="headerlink" title="Differences from innerText"></a>Differences from innerText</h4><ul><li>textContent gets the content of all elements, including <script> and <style> elements, but innerText doesn't.</li><li>innerText is aware of style and will not return the text of hidden elements, whereas textContent will.</li><li>As innerText is aware of CSS styling, it will trigger a reflow, whereas textContent will not.</li></ul><h4 id="Differences-from-innerHTML"><a href="#Differences-from-innerHTML" class="headerlink" title="Differences from innerHTML"></a>Differences from innerHTML</h4><p>innerHTML returns the HTML as its name indicates. Quite often, in order to retrieve or write text within an element, people use innerHTML. textContent should be used instead (to write or retrieve text). Because the text is not parsed as HTML, it’s likely to have better performance.</p><h3 id="node-nodeValue"><a href="#node-nodeValue" class="headerlink" title="node.nodeValue"></a>node.nodeValue</h3><p>The <strong>node.nodeValue</strong> property returns or sets the value of the current node.</p><h4 id="Syntax-1"><a href="#Syntax-1" class="headerlink" title="Syntax"></a>Syntax</h4><p><code>value = node.nodeValue</code></p><p>value is a string containing the value of the current node, if any.</p>]]></content>
      
      
      
        <tags>
            
            <tag> HTML </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>&lt;Script&gt; 小知识</title>
      <link href="/2016/07/18/script-e5-b0-8f-e7-9f-a5-e8-af-86/"/>
      <url>/2016/07/18/script-e5-b0-8f-e7-9f-a5-e8-af-86/</url>
      
        <content type="html"><![CDATA[<h3 id="lt-script-gt-按照出现顺序被执行"><a href="#lt-script-gt-按照出现顺序被执行" class="headerlink" title="&lt;script&gt; 按照出现顺序被执行"></a>&lt;script&gt; 按照出现顺序被执行</h3><ul><li>后加载的脚本可以依赖先加载的脚本, 但是先加载的脚本堵塞, 整个网页的加载会堵塞.</li><li>当一个脚本被执行时, 可以访问前面的 HTML 元素, 但不能访问后面的元素.</li><li>页面元素在他之前的所有脚本都加载完之前是不会执行渲染的.</li></ul><h3 id="async-和-defer"><a href="#async-和-defer" class="headerlink" title="async 和 defer"></a><code>async</code> 和 <code>defer</code></h3><p>HTML5 添加了两个工具用于控制脚本的执行</p><ul><li><code>async</code> 表示”不用马上执行”. 定义一个页面需要的变量或函数在<code>async</code>中是不行的, 因为你没法知道什么时候<code>async</code>代码会执行</li><li><code>defer</code> 表示”等待页面解析完成之后执行”, 大致等价于把脚本绑定到<code>window.onload</code>事件. 当这个代码被执行, DOM 中的一切元素都可以访问, 不同于<code>async</code>, 所有加了<code>defer</code>的脚本会按照他们出现在 HTML 中的顺序执行, 只是推迟到页面解析后按顺序执行.</li></ul><h3 id="type-属性"><a href="#type-属性" class="headerlink" title="type 属性"></a>type 属性</h3><p>设定解释器<br>若要修改 type 的默认属性(默认为 javascript), 可以通过一个<meta>标记实现:<br><code>&amp;lt;meta http-equiv = &quot;Content-Script-Type&quot; content = &quot;text/vbscript&quot;</code></p><h3 id="integrity-属性"><a href="#integrity-属性" class="headerlink" title="integrity 属性"></a>integrity 属性</h3><p><code>integrity</code>属性是子资源完整性新规范的一部分, 他允许你为脚本文件将包含的内容提供一个 hash, 这意味着可以防止在传输的时候内容丢失或被恶意修改. 就算使用了 SSL, 这个规范也是有意义的, 因为有时候你要加载的资源是你无法控制的站外资源.<br>如果你选择使用他, 就要在&lt;script&gt;标记里添加一个 hash 类型以及 hash 值, 将他们以连字符分隔<br><code>&amp;lt;script src=&quot;...&quot; integrity = &quot;hash-value&quot;&amp;gt;&amp;lt;/script&amp;gt;</code></p><h3 id="document-currentScript"><a href="#document-currentScript" class="headerlink" title="document.currentScript"></a>document.currentScript</h3><p>IE 不支持的一个新东西叫 <code>document.currentScript</code>, 他指向当前正在执行的脚本, 如果你要从你嵌入的&lt;script&gt;中拿一些属性用</p><h3 id="lt-script-gt-和-innerHTML"><a href="#lt-script-gt-和-innerHTML" class="headerlink" title="&lt;script&gt;和 innerHTML"></a>&lt;script&gt;和 innerHTML</h3><p>通过 DOM 动态添加到页面上的 &lt;script&gt; 会被浏览器执行</p><pre><code>var myScript = document.createElement(&quot;script&quot;);myScript.textContent = &quot;alert(&#39;hello&#39;)&quot;;document.head.appendChild(myScript);</code></pre><p>然而, 通过<code>innerHTML</code>动态添加到到 HTML 的 &lt;script&gt; 则不会被执行<br><code>document.head.innerHTML += &quot;&amp;lt;script&amp;gt;alert(&#39;Hello&#39;)&amp;lt;/script&amp;gt;&quot;</code><br>Note: 但是他会显示在 HTML 里(尽管不会执行)</p>]]></content>
      
      
      
        <tags>
            
            <tag> HTML </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Event</title>
      <link href="/2016/07/18/event/"/>
      <url>/2016/07/18/event/</url>
      
        <content type="html"><![CDATA[<p>In computing, an <strong>event</strong> is an action or occurrence recognized by software that may be handled by the software. Computer events can be generated or triggered by the system, by the user or in other ways. Typically, events are handled synchronously with the program flow, that is, the software may have one or more dedicated places where events are handled, frequently an event loop. A source of events includes the user, who may interact with the software by way of, for example, keystroke on the keyboard. Another source is a hardware device such as a timer. Software can be trigger its own set of events into the event loop, e.g. to communicate the completion of a task. Software that changes its behavior in response to events is said to be event-driven, often with the goal of being inactive.</p><h3 id="Event-handler"><a href="#Event-handler" class="headerlink" title="Event handler"></a>Event handler</h3><p>In computer programming, an <em>event handler</em> is a <strong>callback</strong> subroutine that handles inputs received in a program(called a <em>listener</em> in Java and JavaScript). Each <em>event</em> is a piece of application-level information from the underlying framework, typically the GUI Toolkit. GUI events including key presses, mouse movement, action selections, and timer expiring.</p>]]></content>
      
      
      
        <tags>
            
            <tag> HTML </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DOM Events</title>
      <link href="/2016/07/18/dom-events/"/>
      <url>/2016/07/18/dom-events/</url>
      
        <content type="html"><![CDATA[<p><strong>DOM(Document Object Model) events</strong> allow <em>event-driven programming</em> language like JavaScript, JScript, ECMAScript, VBScript and Java to register various <strong>event handler/listener</strong> on the element nodes inside a DOM tree, e.g. HTML, XHTML, XUL, and SVG documents.</p><h3 id="Events"><a href="#Events" class="headerlink" title="Events"></a>Events</h3><h4 id="HTML-Events"><a href="#HTML-Events" class="headerlink" title="HTML Events"></a>HTML Events</h4><p>There is a huge collection of events that can be generated by most element nodes:</p><ul><li>Mouse events;</li><li>Keyboard events;</li><li>HTML frame/object events;</li><li>HTML form events;</li><li>User interface events;</li><li>Mutation events(notification of any changes to the structure of a document);</li><li>Progress events(used by XMLHttpResponse, File API, …)</li></ul><p>Mouse:<br>click, dblclick, mousedown, mouseover, mousemove, mouseout, dragstart, drag, dragenter, dragleave, dragover, drop, dragend</p><ul><li>Click: The sequence of click: mousedown, mouseup, click</li><li>Mouseover: Fires when the pointing device is moved onto an element</li><li>Mouseover: Fires when the pointing device is moved while it is over an element</li><li>Dragstart: Fired on an element when a drag is started</li><li>Dragend: The source of the drag will receive a dragend event when the drag operation is complete, whether it was sucessful or not,</li></ul><p>Keyboard:<br>keydown, keypress, keyup</p><p>HTML frame/object:<br>load, unload, abort, error, resize, scroll</p><ul><li>Load: Fires when the <em>user agent</em> finishes loading all content within a document, including window, frames, objects, and images.</li><li>Unlaod: Fires when the <em>user agent</em> removes all content from a window or frame.</li><li>Abort: Fires when an object/image is stopped from loading before completely loaded.</li><li>Error: Fires when an object/image/frame/ cannot be loaded properly.</li><li>Resize: Fires when a document view is resized.</li><li>Scroll: Fires when an element or document view is scrolled</li></ul><p>HTML form:<br>select, change, submit, reset, focus, blur</p><ul><li>Select: Fires when a user selects some text in a <em>text field</em>, including input and textarea.</li><li>Change: Fires <strong>when a control loses the input focus</strong> and <strong>its value has been modified since gaining focus</strong>.</li><li>Submit: Fires when a form is submitted.</li><li>Reset: Fires when a form is reset.</li><li>Focus: Fires when an element receives focus either via the pointing device or by tab navigation.</li><li>Blur: Fires when an element loses focus.</li></ul><p>User Interface:<br>focusin, focusout, DOMActivate</p><p>Mutation:<br>DOMSubtreeModified, DOMNodeInserted, DOMNodeRemoved, DOMNodeRemovedFromDocument, DOMNodeInsertedIntoDocument, DOMAttrModified, DOMCharacterDataModified</p><p>Progress:<br>loadstart, progress, error, abort, load, loadnd</p><h4 id="Touch-Events"><a href="#Touch-Events" class="headerlink" title="Touch Events"></a>Touch Events</h4><p>Web broswer running on touch-enabled devices will generate additional events</p><p>Touch:<br>touchstart, touchend, touchmove, touchenter, touchleave, touchcancel</p><ul><li>Touchstart: Fires when a finger is placed on the touch surface/screen.</li><li>Touchend: Fires when a finger is removed from the touch surface/screen.</li><li>Touchenter: Fires when a touch point moves onto the interactive area defined by a DOM Element</li><li>Touchcancel: A <strong>user-agent</strong> must dispatch this event type to indicate when a TouchPoint has been disrupted in an implementation-specific manner, such as by moving outside the bounds of the UA window.</li></ul><p>In the W3C draft recommendation, a <code>TouchEvent</code> delivers a <code>TouchList</code> of <code>Touch</code> location, the modifier keys that were active, a <code>TouchList</code> of <code>Touch</code> locations within the targeted DOM element, and a <code>TouchList</code> of <code>Touch</code> lcoations that have changed since the previous <code>TouchEvent</code>.</p><h4 id="Internet-Explorer-specific-events"><a href="#Internet-Explorer-specific-events" class="headerlink" title="Internet Explorer-specific events"></a>Internet Explorer-specific events</h4><p>In addition to the common/W3C events, two major types of events are added by <em>Internet Explorer</em>. Some of the events have been implemented as <em>de facto standards</em> by other browsers.</p><p>Clipbord:<br>cut, copy, paste, beforecut, beforecopy, beforepaste</p><p>Data binding:<br>afterupdate, beforeupdate, cellchange, dataavailable, datasetchagned, datasetcomplete, errorudpate, rowenter, rowexit, rowsdelete, rowinserted</p><ul><li>Afterupdate: Fires immediately after a databound object has been updated.</li><li>Beforeupdate: Fires before a data source has changed.</li><li>Cellchange: Fires when a data source has change.</li><li>Dataavailable: Fires when new data from a data source become available.</li><li>Rowenter: Fires whena new row of data from the data source is available.</li></ul><p>Mouse:<br>contextmenu, selectstart</p><ul><li>Contentmenu: Fires when the context menu is shown.</li><li>Selectstart: Fires when the user starts to select text.</li></ul><p>Keyboard:<br>help</p><ul><li>Help: Fires when the user initiates help.</li></ul><p>HTML frame/object:<br>beforeunload, stop</p><ul><li>Beforeunload: Fires before a document is unloaded.</li><li>Stop: Fires when the user stop loading the object. (unlike abort, stop event can be attached to document).</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> HTML </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>理解伪元素:Before 和 :After</title>
      <link href="/2016/07/18/e7-90-86-e8-a7-a3-e4-bc-aa-e5-85-83-e7-b4-a0before-e5-92-8c-after/"/>
      <url>/2016/07/18/e7-90-86-e8-a7-a3-e4-bc-aa-e5-85-83-e7-b4-a0before-e5-92-8c-after/</url>
      
        <content type="html"><![CDATA[<p><img src="http://jbcdn2.b0.upaiyun.com/2013/10/syntax1.jpg"></p><p>本篇中的”伪元素”特指”:before”和”:after”</p><h3 id="语法和浏览器支持"><a href="#语法和浏览器支持" class="headerlink" title="语法和浏览器支持"></a>语法和浏览器支持</h3><p>早起的伪元素是使用一个冒号声明的”:”, 在 CSS3中修订后伪元素的声明使用两个冒号”::”, 但是为了目前的兼容性考虑(IE8), 建议使用”:”声明.</p><p>伪元素会在内容元素的前后插入额外的元素, 技术上等同于</p><pre><code>&amp;lt;p&amp;gt;&amp;lt;span&amp;gt;:before&amp;lt;/span&amp;gt;This is the main content.&amp;lt;span&amp;gt;:after&amp;lt;/span&amp;gt;</code></pre><p><img src="http://jbcdn2.b0.upaiyun.com/2013/10/quotationmark-11.jpg"></p><p>当然, 这些元素无法在文档的源码中找到</p>]]></content>
      
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>7 Ways You Can Design Your Home Office for Maximum Productivity</title>
      <link href="/2016/07/16/7-ways-you-can-design-your-home-office-for-maximum-productivity/"/>
      <url>/2016/07/16/7-ways-you-can-design-your-home-office-for-maximum-productivity/</url>
      
        <content type="html"><![CDATA[<h3 id="1-Keep-Your-Personal-Life-in-a-Separate-Room"><a href="#1-Keep-Your-Personal-Life-in-a-Separate-Room" class="headerlink" title="1. Keep Your Personal Life in a Separate Room"></a>1. Keep Your Personal Life in a Separate Room</h3><p>You should never work in your comfort zone. For example: the kitchen is for eating, the common space is for socializing, the bedroom is for sleeping and so the office is for <strong>working</strong>.<br>You need to establish those boundaries early on, because they can quickly become bad habits.</p><h3 id="2-Establish-Boundaries-with-Your-Housemates"><a href="#2-Establish-Boundaries-with-Your-Housemates" class="headerlink" title="2. Establish Boundaries with Your Housemates"></a>2. Establish Boundaries with Your Housemates</h3><p>Housemates need to understand that there are boundaries, that you can not be distracted or take on responsibilities such as housework or babysitting children.</p><h3 id="3-Don’t-Buy-Too-Much-Equipments"><a href="#3-Don’t-Buy-Too-Much-Equipments" class="headerlink" title="3. Don’t Buy Too Much Equipments"></a>3. Don’t Buy Too Much Equipments</h3><h3 id="4-Don’t-Commit-to-Your-Home-Office-Design-Too-Much"><a href="#4-Don’t-Commit-to-Your-Home-Office-Design-Too-Much" class="headerlink" title="4. Don’t Commit to Your Home Office Design Too Much"></a>4. Don’t Commit to Your Home Office Design Too Much</h3><p>It’s important to remember that an outside world does in fact exist.</p><h3 id="5-Get-Natural-Light-and-Green-Plants"><a href="#5-Get-Natural-Light-and-Green-Plants" class="headerlink" title="5. Get Natural Light and Green Plants"></a>5. Get Natural Light and Green Plants</h3><h3 id="6-Treat-Working-Hours-as-If-You-Were-at-Work"><a href="#6-Treat-Working-Hours-as-If-You-Were-at-Work" class="headerlink" title="6.Treat Working Hours as If You Were at Work"></a>6.Treat Working Hours as If You Were at Work</h3><h3 id="7-Tweak-Your-Comfort-Level"><a href="#7-Tweak-Your-Comfort-Level" class="headerlink" title="7. Tweak Your Comfort Level"></a>7. Tweak Your Comfort Level</h3><p>Ensure the environment won’t distract you. For example, music, seat, temperature, make sure everything can keep you attention to your work.</p>]]></content>
      
      
      <categories>
          
          <category> Soup </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Gulp 能够解决哪些问题</title>
      <link href="/2016/07/15/gulp-e8-83-bd-e5-a4-9f-e8-a7-a3-e5-86-b3-e9-82-a3-e4-ba-9b-e9-97-ae-e9-a2-98/"/>
      <url>/2016/07/15/gulp-e8-83-bd-e5-a4-9f-e8-a7-a3-e5-86-b3-e9-82-a3-e4-ba-9b-e9-97-ae-e9-a2-98/</url>
      
        <content type="html"><![CDATA[<p>通常一个前端构建流程包括:</p><ul><li>文件清理: gulp-clear</li><li>文件拷贝: gulp-copy</li><li>文件转换: gulp-webpack</li><li>文件合并: gulp-concat</li><li>文件压缩: gulp-minify</li><li>文件服务: gulp-connect</li><li>文件监控: gulp-watch</li><li>css 相关:<ul><li>less, sass 转换(gulp-less, gulp-sass)</li><li>css 自动添加前缀(gulp-autoprefixer)</li></ul></li><li>js 相关:<ul><li>jslint(gulp-jshint)</li></ul></li><li>html 转换<ul><li>html 模板(gulp-jade, gulp-ejs)</li><li>html prettify</li><li>html validator</li><li>html min</li></ul></li></ul><p>Gulp 通过定义<code>gulpfile.js</code>配置文件的方式定义流程, gulp.js 会通过调用 Node.js 来执行流程.</p><h3 id="引入插件"><a href="#引入插件" class="headerlink" title="引入插件"></a>引入插件</h3><pre><code>var gulp = require(&quot;gulp&quot;), ...`&lt;/pre&gt;### 设定路径&lt;pre&gt;`var paths = &#123;  styles:&#123;    src: &quot;src/styles/**/*.less&quot;,    dest: &quot;assets/styles/&quot;  &#125;,  scripts:&#123;    src: &quot;src/scripts/**/*.js&quot;,    dest: &quot;assets/scripts/&quot;  &#125;&#125;;`&lt;/pre&gt;### 设定任务&lt;pre&gt;`gulp.task(&quot;taskName&quot;, function()&#123;  gulp.src(paths.styles.src)      .pipe(task())      .pipe(gulp.dest(paths.styles.dest));&#125;);`&lt;/pre&gt;一个 gulpfile.js 文件只是一个 Node 程序, 在 gulpfile 中可以使用任何 npm 中的模块或者其他 Node.js并非所有的任务都是基于流, 例如删除文件&lt;pre&gt;`function clean()&#123;  //del 也可以和 gulp.src 一样基于模式匹配的文件路径定义方式  return del([&quot;assets&quot;]);&#125;`&lt;/pre&gt;如果要控制 task 顺序, 可以通过回调函数实现gulp.task(taskName, function(fn)&#123;&#125;)现在新增加了串行和并行 API- gulp.parallel: 并行执行- gulp.series: 串行执行e.g.&lt;pre&gt;`gulp.task(&quot;one&quot;, function(done)&#123;  //do stuff  done(); //回调函数&#125;)gulp.task(&quot;two&quot;, function(done)&#123;  //do stuff  done();&#125;);//并行执行任务, 执行完后可以添加回调函数gulp.task(&quot;parallelTask&quot;, gulp.parallel(&quot;one&quot;, &quot;two&quot;, function(done)&#123;  done();&#125;));//串行任务gulp.task(&quot;seriesTask&quot;, gulp.series(&quot;one&quot;, &quot;two&quot;, function(done)&#123;  done();&#125;));`&lt;/pre&gt;### 前端常用插件</code></pre><ul><li><p>gulp-sass: 编译 SASS</p></li><li><p>browser-sync: 保持多浏览器, 多设备同步</p></li><li><p>gulp-imagemin: 压制 png/jpg/git/svg 图片</p></li><li><p>gulp-minify-css: 压缩 CSS</p></li><li><p>gulp-rename</p></li><li><p>gulp-concat: 合并 JS</p></li><li><p>gulp-uglify: 压缩 JS</p></li><li><p>gulp-autoprefixer: 添加前缀</p></li><li><p>gulp-css-spriter: 生成雪碧图</p></li><li><p>gulp-htmlmin</p></li><li><p>gulp-server-livereload</p><h3 id="拥有-live-reloading-的服务器"><a href="#拥有-live-reloading-的服务器" class="headerlink" title="拥有 live-reloading 的服务器"></a>拥有 live-reloading 的服务器</h3><p>使用 BrowserSync 和 gulp, 你可以轻松创建一个开发服务器, 然后同一个 WiFi 中的任何设备都可以方便访问.<br>BrowserSync 同时集成了 live-reload, 所以不需要做另外的配置.</p><p>首先安装模块<br><code>npm install brower-sync --save-dev</code><br>假设目前目录结构为</p><pre>`gulpfile.jsapp/    styles/            main.css        scripts/            main.js        index.html`</pre><p>配置 gulpfile.js, 将 app 目录中的文件加入到服务器中, 并且所有的浏览器会在文件发生变化后自动刷新</p><pre>`var gulp = requrie("gulp");var browserSync = require("browser-sync").create();var reload = browerSync.reload;//监视文件改动并重新载入gulp.task("browser-sync", function(){    browserSync.init({            server:{                    baseDir: 'app'                }        });        gulp.watch(['*.html', 'styles/**/*.css', 'scripts/**/*.js'], {cwd: 'app'}, browserSync.reload);});`</pre><h3 id="CSS-预处理"><a href="#CSS-预处理" class="headerlink" title="CSS 预处理"></a>CSS 预处理</h3><p>指定浏览器无需刷新即可重载 CSS<br>假设目录如上</p><pre>`var gulp = require("gulp");var sass = require("gulp-ruby-sass");var browserSync = require("browser-sync").create();gulp.task("sass", function(){    return sass("styles/**/*.scss")                 .pipe(gulp.dest("app/css")                         .pipe(reload({stream:true}));{);/*gulp.task("sass", function(){    gulp.src("styles/**/*.scss")        .pipe(sass({outputstyle: 'compressed'}).on('error',sass.logError))        .pipe(gulp.dest("app/css");});*/gulp.task("browser-sync", ["sass"], function(){    browserSync({            server: {                    baseDir: "app";                }        });        gulp.watch("app/styles/**/*.scss", ["sass"], browserSync.reload);});</li></ul><p>设置<code>tunnel: true</code> 来使用一个公开的 URL 来访问本地站点</p>]]></content>
      
      
      
        <tags>
            
            <tag> Gulp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>高性能 CSS</title>
      <link href="/2016/07/15/e9-ab-98-e6-80-a7-e8-83-bd-css/"/>
      <url>/2016/07/15/e9-ab-98-e6-80-a7-e8-83-bd-css/</url>
      
        <content type="html"><![CDATA[<h3 id="HTML-和-CSS-本身的性能问题并不突出-在提高可读性和可维护性的前提下-如果能让代码运行和解析的速度更快-则是锦上添花"><a href="#HTML-和-CSS-本身的性能问题并不突出-在提高可读性和可维护性的前提下-如果能让代码运行和解析的速度更快-则是锦上添花" class="headerlink" title="HTML 和 CSS 本身的性能问题并不突出, 在提高可读性和可维护性的前提下, 如果能让代码运行和解析的速度更快, 则是锦上添花."></a>HTML 和 CSS 本身的性能问题并不突出, 在提高可读性和可维护性的前提下, 如果能让代码运行和解析的速度更快, 则是锦上添花.</h3><h4 id="使用高效的-CSS-选择器"><a href="#使用高效的-CSS-选择器" class="headerlink" title="使用高效的 CSS 选择器"></a>使用高效的 CSS 选择器</h4><p>首先要知道浏览器如何解析 CSS<br>以 .nav ul.list li div{} 为例<br>浏览器遍历 div, 然后从遍历结果中寻找父集为 li 的对象, 依次进行选择器搜索. 所以如果选择器层级过多, 会导致性能低下.<br>解决方法: 令第一次匹配时的数量最少, 并让整体的匹配查找次数更少.<br>具体做法:</p><ul><li>避免使用通配符</li><li>避免使用标签选择器和单个属性选择器作为关键选择器</li><li>不要在 id 选择器前加标签名</li><li>不要设定过多层级, 降低 CSS 和 DOM 结构的耦合度</li></ul><h4 id="CSS-相关的图片处理"><a href="#CSS-相关的图片处理" class="headerlink" title="CSS 相关的图片处理"></a>CSS 相关的图片处理</h4><ul><li><p>不给图片设置尺寸: 有时候同一张图会在页面不同低昂多次使用, 比如缩略图, 正常图, 大图等. 如果图片的原始尺寸与实际需求不同, 在使用时通过缩放会给 CPU 带来额外的计算过程, 增加了图片在浏览器中的渲染时间. 网络传输过程也会占用更多带宽, 增加下载时间. 最佳做法是为需要的部分单独做一套图片, 初始页面加载时就能更快显示.</p></li><li><p>使用雪碧图, 利用 css 进行背景定位, 好处是减少请求次数, 提高图片的整体的加载速度; 缺点是需要精确计算位置(现在有一些工具可用), 维护过程复杂, 要换图片比较复杂</p><pre><code>*   在后期使用 CSS Sprite 技术, 因为在开发的时候会比较频繁修改图片</code></pre><ul><li>合理组织图片</li><li>控制雪碧图的尺寸, 推荐长宽相乘不超过 2500, 大小不超过 200kb</li><li>合理控制背景图单元之间的距离及背景图的位置</li><li>借助相关工具</li></ul></li></ul><h4 id="减少-CSS-代码量"><a href="#减少-CSS-代码量" class="headerlink" title="减少 CSS 代码量"></a>减少 CSS 代码量</h4><ul><li>定义简洁的 CSS 规则</li><li>合并相同的定义</li><li>删除无效的定义</li></ul><h4 id="其他途径"><a href="#其他途径" class="headerlink" title="其他途径"></a>其他途径</h4><ul><li>避免使用@ import</li><li>避免使用 IE 浏览器独有的样式</li><li>避免使用 CSS 表达式: 动态设置 CSS 属性, 可以通过 js 修改</li></ul><h3 id="兼容性查询"><a href="#兼容性查询" class="headerlink" title="兼容性查询"></a>兼容性查询</h3><ul><li>caniuse.com</li><li>css3 click chart</li><li>css contents and browsers compatibility</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BFC 基本概念</title>
      <link href="/2016/07/15/bfc-e5-9f-ba-e6-9c-ac-e6-a6-82-e5-bf-b5/"/>
      <url>/2016/07/15/bfc-e5-9f-ba-e6-9c-ac-e6-a6-82-e5-bf-b5/</url>
      
        <content type="html"><![CDATA[<h3 id="Box-CSS-布局的基本单位"><a href="#Box-CSS-布局的基本单位" class="headerlink" title="Box: CSS 布局的基本单位"></a>Box: CSS 布局的基本单位</h3><p>Box 是 CSS 布局的对象, 和基本单位, 直观点来说, 就是一个页面是由很多个 Box 组成的. 元素的类型和 display 属性, 决定了这个 Box 的类型. 不同类型的 Box, 会参与不同的 Formatting Context(一个决定如何渲染文档的容器), 因此 Box 内的元素会以不同方式渲染.<br>盒子的类型:</p><ul><li>block-level: <code>display:block</code>的 block, list-item, table 元素会形成 block-level box, 并参与 Block formatting context.</li><li>inline-level box: <code>display:inline</code>的 inline-block, inline-table 元素会形成 inline-level box, 并参与 inline formatting context;</li><li>run-in box: CSS3 才有, 略;</li></ul><h3 id="Formatting-Context"><a href="#Formatting-Context" class="headerlink" title="Formatting Context"></a>Formatting Context</h3><p>Formatting Context 是 W3C CSS2.1 规范中的一个概念, 是页面中的一块渲染区域, 并有一套渲染规则, 决定了其子元素如何定位, 以及其他元素的关系和相互作用. 最常见的的 Formatting Context 有 Block Formatting Context(BFC) 和 Inline Formatting Context(IFC).<br>CSS2.1 中只有 BFC 和 IFC, 在 CSS3 中添加了 GFC 和 FFC</p><h3 id="BFC-的定义"><a href="#BFC-的定义" class="headerlink" title="BFC 的定义"></a>BFC 的定义</h3><p>BFC 直译为”块级格式上下文”, 是一个独立的渲染区域, 只有 Block-level Box 可以参与, 他规定了内部的 Block-level Box 如何布局, 并且与这个区域外部毫不相干.</p><h4 id="BFC-布局规则"><a href="#BFC-布局规则" class="headerlink" title="BFC 布局规则"></a>BFC 布局规则</h4><ul><li>内部的 Box 会在垂直方向依次排列</li><li>Box 垂直方向的距离由 margin 决定, 属于同一个 BFC 的两个相邻的 Box 的 margin 会发生坍塌</li><li>BFC 内部不会发生 float box 重叠</li><li>BFC 就是页面上的一个隔离的独立容器, 容器内的子元素不会影响到外部的元素, 反之亦然</li><li>计算 BFC 高度的时候, <strong>浮动元素也参与计算</strong>(使用 border 消除父元素坍塌的原理)</li><li>BFC 内部每一个 Box 的左外边缘(margin-left)会碰触容器的左边缘(border-left)(如果是从右向左的格式, 则是碰触右边缘)</li></ul><h4 id="BFC-的通俗理解"><a href="#BFC-的通俗理解" class="headerlink" title="BFC 的通俗理解"></a>BFC 的通俗理解</h4><p>BFC 容器是一个独立的箱子, 里面的元素的布局不受外部元素影响.<br>我们往往利用这个特性来消除浮动元素对其他非浮动的兄弟元素及其子元素带来的影响.<br>并且在一个 BFC 容器中, 块盒和行盒都会沿其父元素的边框排列</p><h4 id="BFC-成因"><a href="#BFC-成因" class="headerlink" title="BFC 成因"></a>BFC 成因</h4><ul><li>float 属性不为 None;</li><li>position 为 Absolute 或 Fixed</li><li>display 为 inline-block, table-cell, table-caption, flex, inline-flex</li><li>overflow 不是 visible</li></ul><h4 id="BFC-的作用与原理"><a href="#BFC-的作用与原理" class="headerlink" title="BFC 的作用与原理"></a>BFC 的作用与原理</h4><h5 id="自适应两栏布局"><a href="#自适应两栏布局" class="headerlink" title="自适应两栏布局"></a>自适应两栏布局</h5>]]></content>
      
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSS 外边距合并</title>
      <link href="/2016/07/14/css-e5-a4-96-e8-be-b9-e8-b7-9d-e5-90-88-e5-b9-b6/"/>
      <url>/2016/07/14/css-e5-a4-96-e8-be-b9-e8-b7-9d-e5-90-88-e5-b9-b6/</url>
      
        <content type="html"><![CDATA[<p><strong>外边距合并的意思是两个垂直排列的块的外边距可能发生(坍塌)合并, 仅保留较大的边距.</strong></p><h2 id="情况一"><a href="#情况一" class="headerlink" title="情况一:"></a>情况一:</h2><p>两元素上下排列<br><img src="http://www.w3school.com.cn/i/ct_css_margin_collapsing_example_1.gif"></p><h2 id="情况二"><a href="#情况二" class="headerlink" title="情况二:"></a>情况二:</h2><p>两元素是父子关系, 若此时父元素没有设定 border, margin(或者宽度为 0), 他们的上下边距也会发生合并.<br><img src="http://www.w3school.com.cn/i/ct_css_margin_collapsing_example_2.gif"></p><h2 id="情况三"><a href="#情况三" class="headerlink" title="情况三:"></a>情况三:</h2><p>自身是一个有上下外边距的空元素, 如果没有 border 和 margin, 自身的上下外边距也会合并<br><img src="http://www.w3school.com.cn/i/ct_css_margin_collapsing_example_3.gif"></p><h3 id="如果这个空元素还与另一个元素垂直排列-会继续发生合并"><a href="#如果这个空元素还与另一个元素垂直排列-会继续发生合并" class="headerlink" title="如果这个空元素还与另一个元素垂直排列, 会继续发生合并"></a>如果这个空元素还与另一个元素垂直排列, 会继续发生合并</h3><p><img src="http://www.w3school.com.cn/i/ct_css_margin_collapsing_example_4.gif"></p><h3 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h3><p>只有普通文档流中的块元素会发生外边距合并, 如果是浮动块, 或者是绝对定位块, 他的外边距是不会合并的.</p>]]></content>
      
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mix-Blend-Mode之 Multiply, Screen, Difference</title>
      <link href="/2016/06/28/mix-blend-mode-e4-b9-8b-multiply-screen-difference/"/>
      <url>/2016/06/28/mix-blend-mode-e4-b9-8b-multiply-screen-difference/</url>
      
        <content type="html"><![CDATA[<p>语法</p><pre><code>mix-blend-mode: &amp;lt;mode&amp;gt;</code></pre><p>normal: 默认值, 正常</p><p>multiply: 正片叠底 - 查看对应像素的颜色信息, 并将基色和混合色复合, 结果色总是比较暗的颜色, 任何颜色与黑色正片叠底都产生黑色, 任何颜色与白色正片叠底都保持不变. 正片就是常见的幻灯片, 正片叠底的效果就是把基色和混合色的图像都做成幻灯片, 把他们叠放在一起, 凑近亮处显示的效果, 由于两张幻灯片都有内容, 所以重叠起来的图像比单张要暗</p><p>screen: 滤色 - 滤色原理和显示器成像原理相同, 将两副幻灯片分别放在不同投影仪上, 打向同一个屏幕, 由于光线的叠加效应, 得到的是一个更明亮的图像. 基色的反相与混合色的反相相乘, 得到的结果除以 255 后再反相.</p><p>overlay: 叠加</p><p>lighten: 变量</p><p>darken: 变暗</p><p>color-dodge: 颜色减淡</p><p>color-blur: 颜色加深</p><p>hard-light: 强光</p><p>soft-light: 柔光</p><p>difference: 差值 - 混合色与基色相减后取绝对值</p><p>exclusion: 排除</p><p>hue: 色相</p><p>saturation: 饱和度</p><p>color: 颜色</p><p>luminosity: 亮度</p>]]></content>
      
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gulp 自动化部署快速入门</title>
      <link href="/2016/06/27/gulp-e8-87-aa-e5-8a-a8-e5-8c-96-e9-83-a8-e7-bd-b2-e5-bf-ab-e9-80-9f-e5-85-a5-e9-97-a8/"/>
      <url>/2016/06/27/gulp-e8-87-aa-e5-8a-a8-e5-8c-96-e9-83-a8-e7-bd-b2-e5-bf-ab-e9-80-9f-e5-85-a5-e9-97-a8/</url>
      
        <content type="html"><![CDATA[<ol><li><code>$ npm install —g gulp</code>全局安装</li></ol><ul><li>安装前保证已经安装了 ruby</li></ul><ol><li><p><code>$ npm install —save-dev- gulp</code>作为项目的开发依赖( devDependence)安装到项目目录</p></p></li><li><p>在项目根目录下创建一个名为<code>gulpfile.js</code>的文件:</p><pre><code>//引用 gulp plugin</code></pre><p>var gulp = require(‘gulp’);<br>//建立 gulp task<br>gulp.task(‘default’, function(){<br>//任务代码<br>})<br><code>&lt;/pre&gt; 在项目根目录运行 gulp 时, gulp 会直接读取</code>gulpfile.js`中定义的任务并执行.</p></li></ol><ul><li>gulp 可以将每一个你要执行的工作命名, 而默认运行的 task 名为<code>default</code></li></ul><ol><li>$ gulp`运行 gulp, 运行默认的名为’ default’ 的任务( task)</li></ol><ul><li><code>gulp &amp;lt;task&amp;gt; &amp;lt;othertask&amp;gt;</code>运行指定 task</li></ul><ol><li>gulp 基本 API</li></ol><ul><li><p><code>gulp.src(globs[, options])</code></p><pre><code>*   `glob`参考 [node-glob 语法](https://github.com/isaacs/node-glob), 也可以直接写文件的路径</code></pre><ul><li><code>options</code>:略</li></ul></li><li><p><code>gulp.dest(path[,options])</code></p><pre><code>*   能被`pipe`进来, 并能写文件到文件夹, 如果文件夹不存在, 则自动创建文件夹.</code></pre><ul><li><code>path</code>: String 或 Function, 可以直接写输出目录, 也可以传入一个返回路径的函数</li><li><code>options</code>:略</li></ul></li><li><p><code>gulp.task(name[, deps], fn)</code></p><pre><code>*   &lt;pre&gt;`gulp.task(&#39;script&#39;,function()&#123;</code></pre><p>//待执行<br>})<br>`</pre></p><ul><li><p><code>name</code>: 赋予任务名称</p></li><li><p><code>deps</code>: 任务列表数组, 这些任务会在当前任务运行之前完成</p><pre><code>        *   task 默认以最大并发数执行, 也就是说 gulp 会一次性执行所有 task 并不做任何等待, 如果要以特定顺序执行, 需要:                *   给出一个提示, 告知 task 什么时候执行完毕    *   再给出一个提示, 告知 task 依赖另一个 task 的完成    *   ```</code></pre><p>var gulp = require(‘gulp’);<br>//返回一个 callback, 因此系统可以知道他什么时候完成<br>gulp.task(‘one’, function(cb){<br>//执行一些任务<br>cb(err); //如果 err 不是 null 或者 undefined, 则会停止执行, 这样代表执行失败.<br>});<br>//定义一个所以来的 task 必须在这个 task 执行之前完成<br>gulp.task(‘two’, [‘one’], function(){<br>//‘one’完成后要执行的任务<br>})<br>gulp.task(‘default’, [‘one’, ‘two’]);</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*   &#96;fn&#96;:要执行的操作</span><br></pre></td></tr></table></figure></li><li><p><code>gulp.watch(glob [, opts], tasks)</code></p><pre><code>*   监听文件, 并可以在文件发生改动的时候做一些事情, 他总会返回一个 EventEmiiter 来发射`change`事件.</code></pre><ul><li><p><code>glob</code>: 指定具体监听哪些文件的变动</p></li><li><p><code>tasks</code>: 需要在文件变动后执行的任务</p><pre><code>        *   &lt;pre&gt;`var watcher = gulp.watch(&#39;js/**/*.js&#39;, [&#39;uglify&#39;, &#39;reload&#39;]);</code></pre><p>watcher.on(‘change’, function(event){<br>console.log(‘File’+event.path+’ was ‘+event.type+’, running tasks…’);<br>});<br>`</pre></p></li></ul></li></ul><ol><li>工作流程</li></ol><ul><li><p>设定任务</p><pre><code>*   gulp 可以对不同的 task 命名, 而 default 是默认的人物名称, 如果执行 gulp 的时候没有指定任务名称, 则会执行`default` 任务.</code></pre><ul><li><pre>`//载入 gulp pluginvar gulp = require('gulp');//定义名称为 default 的 gulp 任务gulp.task('default', function(){ console.log('Hello Gulp Default Task');});//定义名称为 other 的 gulp 任务gulp.task('other', function(){ console.log('Hello Gulp Other Task');})`</pre></li></ul></li><li><p>执行指定的 gulp 任务</p><pre><code>*   &lt;pre&gt;`$ gulp</code></pre><p>`</pre></p><pre><code>        *   执行默认的 default 任务</code></pre><ul><li><pre>`$ gulp other`</pre><pre><code>        *   执行任务`other`</code></pre></li><li><pre>`$ gulp.task('default', ['other', 'script']);`</pre><pre><code>        *   在 default 任务中设定要执行的任务队列可以执行多个任务</code></pre></li></ul></li><li><p>监听</p><pre><code>*   比如我们使用`gulp-uglify`最小化 JS 时, 希望可以在每次改动 JS 的时候自动执行 gulp 最小化动作        *   &lt;pre&gt;`var gulp = require(&#39;gulp&#39;),</code></pre><p>gulpUglify = require(‘gulp-uglify’);<br>gulp.task(‘script’, function(){<br>gulp.src(‘javascript/original/*.js’) //指定要处理的原始 JS 目录<br>.pipe(gulpUglify()) //执行最小化<br>.pipe(gulp.dest(‘javascript/minify’)); //最小化后部署到 JS 目录<br>})<br>`</pre></p><ul><li><p>添加监听</p><pre><code>        *   &lt;pre&gt;`gul.task(&#39;watch&#39;, function()&#123;</code></pre><p>gulp.watch(‘javascript/original/_.js’, [‘script’]);<br>})<br><code>&lt;/pre&gt; _ &lt;pre&gt;</code>$ gulp watch //执行监听 `</pre></p><pre><code>                *   执行监听后, 每次改动 javascript/origin/*.js 中所有 JS 文件时都会重新执行 script 任务.    *   可以用`**`监听所有文件    *   可以将`watch`添加到任务列表, 这样只需要指令`gulp`就可以执行监听</code></pre></li></ul></li><li><p>例外处理</p><pre><code>*   经历例外错误记录任务        *   由于例外错误可能会在很多地方出现, 最好是定义为可调用的函数*   &lt;pre&gt;`function errorLog(error)&#123;</code></pre><p>console.error(error);<br>this.emit(‘end’);<br>}<br>gulp.task(‘script’, function(){<br>gulp.src(‘…’)<br>.on(‘error’,errorLog)<br>.pipe(gulpUglify())<br>.pipe(gulp.dest(‘…’));<br>});<br>`</pre></p></li></ul><ol><li>常用插件</li></ol><ul><li><p>gulp-uglify</p><pre><code>*   `$ npm install —save-dev gulp-uglify`</code></pre><ul><li>将要最小化的 JS 文件放在 javascript/original 下</li><li>将最小化后的 JS 文件放在 javascript/minify 下</li><li><pre>`var gulp = require('gulp'),gulpUgligy = require('gulp-uglify');gulp.task('script', function(){ gulp.src('javascript/original/*js') .pipe(gulpUglify()) .pipe(gulp.dest('javascript/minify'));})`</pre></li></ul></li><li><p>gulp-sass</p><pre><code>*   `$ npm install —save-dev gulp-sass`        *   将要编译的 Scss 文件放在 scss 目录下*   将编译后的 CSS 文件放在 css 目录下*   &lt;pre&gt;`var gulp = require(&#39;gulp&#39;),</code></pre><p>gulpSass = required(‘gulp-sass’);<br>gulp.task(‘styles’,function(){<br>gulp.src(‘scss/_.scss’)<br>.pipe(gulpSass())<br>.pipe(gulp.dest(‘css’));<br>})<br><code>&lt;/pre&gt; _ 向 gulpSass()传入参数</code>{outputStyle:’compressed’}`输出压缩后的 CSS 文件</p></li><li><p>gulp-imagemin</p><pre><code>*   压缩图片, 支持格式有 gif, jpg, png, svg</code></pre><ul><li><code>$ npm install --save-dev gulp-imagemin</code></li><li>指定 images/origin 下所有图片都压缩, 并把压缩后的图片放到 images 中</li><li><pre>`var gulp = require('gulp'),gulpImagemin = require('gulp-imagemin');gulp.task('image', function(){ gulp.src('images/original/**') .pipe(gulpImagemin()) .pipe(gulp.dest('images'));})`</pre></li></ul></li><li><p>gulp-plumber</p><pre><code>*   `$ npm install —save-dev gulp-plumber`</code></pre><ul><li><code>pipe(gulpPlumber())</code>一定要在编译 scss 及最小化 js 之前就加入(注意顺序)</li><li><pre>`var gulp = require('gulp'),gulpUglify = require('gulp-uglify');gulp.watch('watch', function(){    gulp.watch('javascript/original/*.js', ['script']);});gulp.task('script', function(){    gulp.src('javascript/original/*.js')    .pipe(gulpPlumber())    .pipe(gulpUglify())    .pipe(gulp.dest('javascript/minify'));});`</pre></li><li>gulp-autoprefixer</li><li>gulp-minify-css</li><li>gulp-clean</li><li>gulp-livereload</li></ul></li></ul><ol><li>工作范例</li></ol><ul><li><p>明确任务</p><pre><code>*   检查 JS</code></pre><ul><li>编译 Scss</li><li>合并 JS</li><li>压缩并重命名合并后的 JS</li></ul></li><li><p>安装依赖</p><pre><code>*   `$ npm install gulp-jshint gulp-sass gulp-concat gulp-uglify gulp-rename —save-dev`</code></pre><ul><li><p>新建`gulpfile.js`<pre><code>        *   &lt;pre&gt;`//引入 gulp 及插件</code></pre><p>var gulp = require(‘gulp’),<br>gulpJshint = require(‘gulp-jshint’),<br>gulpSass = require(‘gulp-sass’),<br>gulpConcat = require(‘gulp-concat’),<br>gulpUglify = require(‘gulp-uglify’),<br>gulpRename(‘gulp-rename’);<br>//检查 JS, 该任务会检查 js/下的 js 文件有没有报错或警告<br>gulp.task(‘lint’,function(){<br>gulp.src(‘./js/<em>.js’)<br>.pipe(gulpJshint())<br>.pipe(gulpJshint.reporter(‘default’));<br>});<br>//编译 Scss, 该任务会编译 scss/下的 scss 文件, 并把编译后的 css 文件保存到 /css 中<br>gulp.task(‘sass’, function(){<br>gulp.src(‘./scss/</em>.scss’)<br>.pipe(gulpSass())<br>.pipe(gulp.dest(‘./css’));<br>});<br>//合并, 压缩 JS 文件, 该任务会合并 js/下的所有 js 文件, 并输出到 dist/目录, 然后重命名为.min.js, 并压缩再输出到 dist/下<br>gulp.task(‘scripts’, function(){<br>gulp.src(‘./js/<em>.js’)<br>.pipe(gulpConcat(‘all.js’))<br>.pipe(gulp.dest(‘./dist’))<br>.pipe(gulpRename(‘all.min.js’)).<br>pipe(gulpUglify())<br>.pipe(gulp.dest(‘./dist’));<br>});<br>//默认任务, 默认任务基于其他任务, 使用.run()方法关联和运行我们之前定义的方法, 使用.watch()方法监听指定目录的文件<br>gulp.task(‘default’, function(){<br>gulp.run(‘lint’, ‘sass’, ‘scripts’);<br>//监听文件<br>gulp.watch(‘./js/</em>.js’, function(){<br>gulp.run(‘lint’,’sass’,’scripts’);<br>});<br>});</p></li></ul></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Gulp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JS 获取 Input File Name</title>
      <link href="/2016/06/24/js-e8-8e-b7-e5-8f-96-input-file-name/"/>
      <url>/2016/06/24/js-e8-8e-b7-e5-8f-96-input-file-name/</url>
      
        <content type="html"><![CDATA[<p>获得文件路径: <code>var filePath = document.getElementById(&quot;file&quot;).value</code></p><p>截取文件名:</p><ul><li><p>保留后缀:</p><pre><code>*   `var fileName = filePath.split(&#39;\\&#39;).pop()`</code></pre><ul><li><code>var fileName = filePath.substring(filePath.lastIndexOf(&#39;\\&#39;)+1)</code></li></ul></li><li><p>不保留后缀:</p><pre><code>*   `var fileName = filePath.split(/\.|\\/).slice(-2,-1)[0]`</code></pre><ul><li><code>var fileName = filePath.substring(filePath.lastIndexOf(&quot;\\&quot;)+1,filePath.lastIndexPathOf(&quot;\.&quot;))</code></li></ul></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Distinction Between &#39;Nth-Child&#39; and &#39;Nth-of-Type&#39;</title>
      <link href="/2016/06/23/distinction-between-nth-child-and-nth-of-type/"/>
      <url>/2016/06/23/distinction-between-nth-child-and-nth-of-type/</url>
      
        <content type="html"><![CDATA[<p>In HTML</p><pre><code>&amp;lt;p&amp;gt;0&amp;lt;/p&amp;gt;&amp;lt;div&amp;gt;1&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;2&amp;lt;/div&amp;gt;&amp;lt;p&amp;gt;3&amp;lt;/p&amp;gt;&amp;lt;div&amp;gt;4&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;5&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;6&amp;lt;/div&amp;gt;</code></pre><p>The Selector <code>div:nth-child(3)</code> will choose the 3rd element from all elements in the level where div is, then check if the 3rd element is a ‘div’. In this case, the 3rd element is a ‘div’, so it works(<code>&amp;lt;div&amp;gt;2&amp;lt;/div&amp;gt;</code>), but Selector <code>div:nth-child(4)</code> will select the 4st element which is ‘p’ (<code>&amp;lt;p&amp;gt;3&amp;lt;/p&amp;gt;</code>), it’s not a ‘div’, so it doesn’t work.</p><p>However, the Selector <code>div:nth-of-type(3)</code> will choose the 3rd ‘div’ from all ‘div’s in the level where div is, so it choose the <code>&amp;lt;div&amp;gt;4&amp;lt;/div&amp;gt;</code>.</p>]]></content>
      
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSS3: Border-Image</title>
      <link href="/2016/06/23/css3-border-image/"/>
      <url>/2016/06/23/css3-border-image/</url>
      
        <content type="html"><![CDATA[<h2 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h2><pre><code>border-image: none|&amp;lt;image&amp;gt;[&amp;lt;slice&amp;gt;|&amp;lt;width&amp;gt;|&amp;lt;repeat&amp;gt;]</code></pre><ul><li><p><code>border-image-source: url(&quot;…&quot;);</code></p></li><li><p><code>border-image-slice:[&amp;lt;number&amp;gt;|&amp;lt;percentage]</code></p><pre><code>*   用于分解引入的图片, px 是默认单位, 如果用 number 则一定不能加上 px</code></pre><ul><li>percentage 是相对于引入的 image 而言的, 例如 image 的大小为 300 x 240, 若设定 slice: 25%, 30%, 15%, 20%, <strong>等于截取了图片外侧的 60px, 90px, 36px, 60px 的部分作为边框</strong></li><li><img src="http://cdn1.w3cplus.com/cdn/farfuture/Z78eIzBXIkFO02LKoPUpOhn7DIjZdlGOqeeIiANZiNA/mtime:1341237495/sites/default/files/border-image-slice.jpg" alt="示例图"></li><li>实际上 CSS3 将该图片划分成 9 个部分, 再根据 width 和 repeat 进行处理后拼接成边框</li><li>四个角不会受到 repeat 的影响而产生变形, 四个边会受到 repeat 的影响而变形.</li></ul></li><li><p><code>border-image-width: [&amp;lt;length&amp;gt;|&amp;lt;percentage&amp;gt;|&amp;lt;number&amp;gt;|auto]</code></p><pre><code>*   border-image-width 就是 border-width, 用于设置边框宽度</code></pre><ul><li>如果 slice 截取的宽度正好等于 width, 那么不会发生变形</li></ul></li><li><p><code>border-image-repeat: [stretch|repeat|round]</code></p><pre><code>*   指定四条边的排列方式</code></pre><ul><li>最多接受两个参数, 第一个水平方向, 第二个垂直方向</li><li>round -&gt; 平铺</li><li>round 会压缩或伸展 sliced-block, 保证平铺过程中其完整性</li><li><img src="http://cdn2.w3cplus.com/cdn/farfuture/Fnx2B9-7WSVP5CmFE9QNNOMbawlHVGYZ3O1cFF5gQSw/mtime:1341237495/sites/default/files/border-image-round-HV.png"></li><li>repeat -&gt; 重复</li><li>repeat 不会改变 sliced-block 的完整性, 从中间开始向两边排列</li><li><img src="http://cdn2.w3cplus.com/cdn/farfuture/2-H9Gx7nr6n9NkwQJB0vnOBtrdlI4iRphA7unyN6zto/mtime:1341237494/sites/default/files/border-image-repeat-HV.png"></li><li>stretch</li><li>拉伸</li></ul></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSS3: Filter</title>
      <link href="/2016/06/23/css3-filter/"/>
      <url>/2016/06/23/css3-filter/</url>
      
        <content type="html"><![CDATA[<p>英语原文: <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/filter">MDN:filter</a></p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><strong>Filter</strong> 属性用于实现”模糊”, “锐化”, “颜色替换”等图像渲染效果.</p><p><strong>Filter</strong> 通常用于调整图像, 背景, 边框的呈现.</p><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><pre><code>filter: url(&quot;filter.svg#filter-id&quot;);filter:blur(5px);filter:brightness(.4);filter:contrast(200%);filter:drop-shadow(16px 16px 20px blue);filter:grayscale(50%);filter:hue-rotate(90deg);filter:invert(75%);filter:opacity(25%);filter:saturate(30%);filter:sepia(60%);/*Apply multiple filters*/filter: contrast(75%) brightness(3%);/*Global Values*/filter: inherit;filter:initial;filter:unset;`&lt;/pre&gt;### 设置一种函数&lt;pre&gt;`filter: &amp;lt;filter-function&amp;gt; [&amp;lt;filter-function&amp;gt;]* | none`&lt;/pre&gt;### 给 SVG 元素 &lt;filter&gt; 引用滤镜&lt;pre&gt;`filter: url(svg-url#element-id)`&lt;/pre&gt;### 实例&lt;pre&gt;`.mydiv&#123;filter:grayscale(50%)&#125;/*gray all images by 50% and blur by 10px*/img&#123;  filter: grayscale(.5) blur(10px);&#125;`&lt;/pre&gt;#### 通过 url 函数引入一个 SVG 资源&lt;pre&gt;`.target&#123;filter:url(#c1):&#125;.mydiv&#123;filter:url(commonfilters.xml#large-blur)&#125;`&lt;/pre&gt;### 函数参数可以传入百分数或小数, 34%和.34效果相同&lt;pre&gt;`url(): 接受一个 XML 文件, 该文件设置一个 SVG 滤镜, 并通过锚点确定一个具体的滤镜元素filter: url(resource.svg#c1)`&lt;/pre&gt;&lt;pre&gt;`blur(): 接收 radius 值为图像设置高斯模糊, radius 为标准差(px), 默认为0, 不接收百分比`&lt;/pre&gt;&lt;pre&gt;`brightness(): 给图片应用一种线性惩罚, 使其看起来更亮或更暗, 0%对应全黑, 100%对应原图, 超过100%更亮, 默认为1;`&lt;/pre&gt;&lt;pre&gt;`contrast(): 调整图像对比度, 0对应全黑, 1对应原图, 大于1则应用更低的对比度`&lt;/pre&gt;&lt;pre&gt;`drop-shadow(): 给图像设置一个阴影效果, 阴影是合成在图像下方的, 可以设置模糊度, 可以用特定颜色画出遮罩图的偏移版本. 函数能接受&amp;lt;shadow&amp;gt;(在 CSS3 背景中定义)类型的值, 除了 inset 关键字不可使用, 与 box-shadow 属性很相似.不过通过滤镜, 一些浏览器会提供硬件加速参数如下:&amp;lt;offset-x&amp;gt;和&amp;lt;offset-y&amp;gt; (不可省略)&amp;lt;blur-radius&amp;gt;(可选)&amp;lt;spread-radius&amp;gt;(可选)&amp;lt;color&amp;gt;(可选)`&lt;/pre&gt;&lt;pre&gt;`grayscale(): 将图像转为灰度图像, 1对应完全灰度图像, 0对应原图`&lt;/pre&gt;&lt;pre&gt;`hue-rotate(): 给图像应用色相旋转, &quot;angle&quot; 设定图像会被调整的色环角度, 默认为0, 对应无变化.`&lt;/pre&gt;&lt;pre&gt;`invert(): 翻转输入图像, 即反相, 1对应完全反相, 0对应原图`&lt;/pre&gt;&lt;pre&gt;`opacity(): 转换图像的透明程度, 0对应完全透明, 1对应原图和 CSS3 的 opacity 功能相似, 但是一些浏览器会提供硬件加速`&lt;/pre&gt;&lt;pre&gt;`saturate(): 修改图像饱和度, 0对应完全不饱和, 1对应原图`&lt;/pre&gt;&lt;pre&gt;`sepia(): 将图像转为深褐色, 1对应完全深褐色, 0对应原图</code></pre><p>复合函数</p><p><code>filter: contrast(175%) brightness(3%);</code></p>]]></content>
      
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Box-Shadow小用法</title>
      <link href="/2016/06/23/box-shadow-e5-b0-8f-e7-94-a8-e6-b3-95/"/>
      <url>/2016/06/23/box-shadow-e5-b0-8f-e7-94-a8-e6-b3-95/</url>
      
        <content type="html"><![CDATA[<h2 id="box-shadow-常规用法"><a href="#box-shadow-常规用法" class="headerlink" title="box-shadow 常规用法"></a>box-shadow 常规用法</h2><h3 id="基础语法"><a href="#基础语法" class="headerlink" title="基础语法"></a>基础语法</h3><p><code>box-shadow</code> 属性向边框添加一个或多个阴影;</p><p><code>box-shadow: (inset) x-offset, y-offset, blur, spread color;</code></p><h3 id="模拟多边框"><a href="#模拟多边框" class="headerlink" title="模拟多边框"></a>模拟多边框</h3><pre><code>div&#123;  width: 100px;  height: 100px;  margin: 100px;  border:5px solid ;  box-shadow: inset 0 0 0 5px #ccc,    0 0 0 5px #333;&#125;`&lt;/pre&gt;要注意: box-shadow 毕竟不是实际边框, 不占据实际空间, 也不属于 `box-sizing`范围### 模拟半透明遮罩层&lt;pre&gt;`#foo&#123;  width:200px;  height:200px;  background:#FFF;  box-shadow:0 0 0 1920px rgba(0,0,0,.5);&#125;`&lt;/pre&gt;### 多重 box-shadow 绘制简图案&lt;pre&gt;`&amp;lt;div class=&quot;bg&quot;&amp;gt;  &amp;lt;div class=&quot;cloud&quot;&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;.bg&#123;  width: 100%;  height: 100px;  padding: 10px;  background-color: #00bcd4;&#125;.cloud&#123;  width: 50px;  height: 50px;  margin: 20px auto;  background-color: #FFF;  border-radius:50%;  box-shadow:80px 10px 0 10px #FFF,    50px 0 0 20px #FFF, 10px -10px #FFF, -10px 10px 0 10px #FFF;&#125;`&lt;/pre&gt;### 多重 shadow 实现立体感&lt;pre&gt;`&amp;lt;div&amp;gt;Solid&amp;lt;/div&amp;gt;div&#123;  width: 200px;  line-height: 68px;  font-size: 48px;  text-align: center;  color:rgba(0,0,0,.3);  text-shadow: 1px 1px 0 rgba(0,0,0,.55),    2px 1.5px 0 rgba(0,0,0,.25),    3px 2px 0 rgba(0,0,0,.2),    4px 2.5px 0 rgba(0,0,0,.15),    5px 3px 0 rgba(0,0,0,.1);&#125;</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>优化 HTML 结构</title>
      <link href="/2016/06/22/e4-bc-98-e5-8c-96-html-e7-bb-93-e6-9e-84/"/>
      <url>/2016/06/22/e4-bc-98-e5-8c-96-html-e7-bb-93-e6-9e-84/</url>
      
        <content type="html"><![CDATA[<h3 id="语义化命名"><a href="#语义化命名" class="headerlink" title="语义化命名"></a>语义化命名</h3><ul><li>语义化的 HTML 能够直接表示出某个 Tag 的业务功能;</li><li>语义化的 CSS 可以提高样式的抽象程度, 方便复用;</li></ul><h3 id="模块化"><a href="#模块化" class="headerlink" title="模块化"></a>模块化</h3><ul><li>提高代码复用程度;</li><li>使业务逻辑更加清晰;</li></ul><h3 id="选择一个好的命名约定"><a href="#选择一个好的命名约定" class="headerlink" title="选择一个好的命名约定"></a>选择一个好的命名约定</h3><h3 id="遵循单一职责原则"><a href="#遵循单一职责原则" class="headerlink" title="遵循单一职责原则"></a>遵循单一职责原则</h3><p>SRP 原则即每个模块或者类应当只承担系统中的某一个单一功能, 并且该功能应当完整封装起来. 比如 CSS 组织结构中的 Carousel, NavigationBar 等, 要做成独立的 CSS Component.</p>]]></content>
      
      
      
        <tags>
            
            <tag> CSS </tag>
            
            <tag> HTML </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Notes on &#39;POST&#39; and &#39;GET&#39; in Form</title>
      <link href="/2016/06/22/notes-on-post-and-get-in-form/"/>
      <url>/2016/06/22/notes-on-post-and-get-in-form/</url>
      
        <content type="html"><![CDATA[<p>The ‘method’ attribute in form element specifies how to send form-data(the form-data is sent to the page specified in the ‘action’ attribute).</p><p>The form-data can be sent as <strong>URL variables</strong>(with <code>method=&#39;get&#39;</code>) or as <strong>HTTP Post transaction</strong>(with <code>method=&#39;post&#39;</code>).</p><h4 id="Notes-on-GET"><a href="#Notes-on-GET" class="headerlink" title="Notes on GET:"></a>Notes on GET:</h4><ul><li>Appends form-data into the URL in name-value pairs;</li><li>The length of a URL is limited(about 3000 characters);</li><li>Never use GET to send sensitive data cause they will be visible in the URL;</li><li>Useful for form submissions where a user want to bookmark the result;</li><li>GET is better than non-secure data, like query string in Google.</li></ul><h4 id="Notes-on-POST"><a href="#Notes-on-POST" class="headerlink" title="Notes on POST:"></a>Notes on POST:</h4><ul><li>Appends form-data inside the body of HTTP request(both in head-line and body);</li><li>Has no size limitation;</li><li>Form submissions with POST cannot be bookmarked.</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> HTML </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>滚动视差效果</title>
      <link href="/2016/06/20/e6-bb-9a-e5-8a-a8-e8-a7-86-e5-b7-ae-e6-95-88-e6-9e-9c/"/>
      <url>/2016/06/20/e6-bb-9a-e5-8a-a8-e8-a7-86-e5-b7-ae-e6-95-88-e6-9e-9c/</url>
      
        <content type="html"><![CDATA[<head><style>.container{  overflow-y:scroll;  overflow-x:hidden;  perspective:1px;  transform-style:preserve-3d;  color:yellow;  text-align:center;}.bg{  width: 100vw;  height: 40vh;  position:relative;}h1{  padding:100px;}.bg:before{  position:absolute;  top: 0;  left: 0;  right: 0;  bottom: 0;  content:"";  display:block;  background: url("http://7xu8mu.com1.z0.glb.clouddn.com/katong_1.jpg");  background-size:cover;  z-index: -1;  transform:translateZ(-1px) scale(2);}</style></head><body><div class="container">  <div class="bg"><h1 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h1><pre><code>    原理是将图片放在bg:before, 然后为 container 设置 perspective:1px 和 preserve-3d, 并蛇者 overflow:auto(要避免 x-index 则使用 overflow-y:scroll), 然后将 bg:before 向 Z 轴移动-1px, 形成前后空间</code></pre>  </div></div><pre><code>/*HTML*/div.container    div.bg        h1&#123;...&#125;        p&#123;...&#125;/*CSS*/.container&#123;  overflow-y:scroll;  overflow-x:hidden;  perspective:1px;  transform-style:preserve-3d;  color:yellow;  text-align:center;&#125;.bg&#123;  width: 100vw;  height: 40vh;  position:relative;&#125;h1&#123;  padding:100px;&#125;.bg:before&#123;  position:absolute;  top: 0;  left: 0;  right: 0;  bottom: 0;  content:&quot;&quot;;  display:block;  background: url(&quot;http://7xu8mu.com1.z0.glb.clouddn.com/katong_1.jpg&quot;);  background-size:cover;  z-index: -1;  transform:translateZ(-1px) scale(2);&#125;</code></pre></body>]]></content>
      
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Card Style - 1</title>
      <link href="/2016/06/20/card-style-1/"/>
      <url>/2016/06/20/card-style-1/</url>
      
        <content type="html"><![CDATA[<head><style>        _,_:before,*:after{            box-sizing: border-box;        }        .wrapper{            padding-top: 40px;            padding-bottom: 40px;        }        .wrapper:focus{            outline:0;        }        .clash-card{            background-color: #fff;            width: 300px;            display: inline-block;            margin:auto;            border-radius: 20px;            position:relative;            text-align: center;            box-shadow: -1px 15px 30px -12px black;            z-index: 9999;        }        .clash-card__image{            position: relative;            height: 230px;            margin-bottom: 35px;            border-top-left-radius: 20px;            border-top-right-radius: 20px;        }        .clash-card__image--barbarian{            background: url("http://7xu8mu.com1.z0.glb.clouddn.com/wp-content/uploads/barbarian-bg.jpg")        }        .clash-card__image--barbarian img{            width: 400px;            position: absolute;            top: -65px;            left: -70px;        }        .clash-card__level{            text-transform: uppercase;            font-size: 12px;            font-weight: 700;            margin-bottom: 3px;        }        .clash-card__level--barbarian{            color:#EC9B3B;        }        .clash-card__unit-name{            font-size: 26px;            color:#000;            font-weight: 900;            margin-bottom: 5px;        }        .clash-card__unit-description{            padding: 20px;            margin-bottom: 10px;        }        .clash-card__unit-stats--barbarian{            background: #EC9B3B;        }        .clash-card__unit-stats--barbarian .one-third{            border-right: 1px solid #BD7C2F;        }        .clash-card__unit-stats{            color:#fff;            font-weight: 700;            border-bottom-left-radius: 15px;            border-bottom-right-radius: 15px;            overflow: hidden;        }        .clash-card__unit-stats .one-third{            width: 33.33%;            float: left;            padding: 20px 15px;        }        .clash-card__unit-stats sup{            position: absolute;        }        .clash-card__unit-stats .stat{            position: relative;            font-size: 20px;            margin-bottom: 10px;        }        .clash-card__unit-stats .stat-value{            text-transform: uppercase;            font-weight: 400;            font-size: 12px;        }        .clash-card__unit-stats .no-border{            border-right: none;        }        .clearfix:after{            content:"";            clear:both;            visibility: hidden;            height: 0;            font-size: 0;        }    </style></head><body>    <div class="wrapper">        <div class="clash-card barbarian">            <div class="clash-card__image clash-card__image--barbarian">                ![barbarian](http://7xu8mu.com1.z0.glb.clouddn.com/wp-content/uploads/barbarian.png)            </div>            <div class="clash-card__level clash-card__level--barbarian">Level 5</div>            <div class="clash-card__unit-name">The Barbarian</div>            <div class="clash-card__unit-description">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Itaque, optio! Provident iure architecto atque sequi alias! Tempore alias doloremque tempora, quod enim nulla quia, saepe accusantium eius minus quisquam architecto.</div>            <div class="clash-card__unit-stats clash-card__unit-stats--barbarian clearfix">                <div class="one-third">                    <div class="stat">20<sup>s</sup></div>                    <div class="stat-value">Training</div>                </div>                <div class="one-third">                    <div class="stat">16</div>                    <div class="stat-value">Speed</div>                </div>                <div class="one-third no-border">                    <div class="stat">150</div>                    <div class="stat-value">Cost</div>                </div>            </div>        </div>    </div><pre>`    /*HTML*/    div.wrapper        div.clash-card.barbarian            div.clash-card__image.clash-card_image--barbarian                img.src            div.cash-card__level.clash-card__level--barbarian{Level 5}            div.clash-card__unit-name{The Barbarian}            div.clash-card__unit-description{...}            div.clash-card__unit-stats.clash-card__unit-stats--barbarian.clearfix                div.one-third                    div.stat{20s}                    div.stat-value{Training}                div.one-third                    div.stat{16}                    div.stat-value{Speed}                div.one-third.no-border                    div.stat{150}                    div.stat-value{Cost}    /*CSS*/    <style>        *,*:before,*:after{            box-sizing: border-box;        }        .wrapper{            padding-top: 40px;            padding-bottom: 40px;        }        .wrapper:focus{            outline:0;        }        .clash-card{            background-color: #fff;            width: 300px;            display: inline-block;            margin:auto;            border-radius: 20px;            position:relative;            text-align: center;            box-shadow: -1px 15px 30px -12px black;            z-index: 9999;        }        .clash-card__image{            position: relative;            height: 230px;            margin-bottom: 35px;            border-top-left-radius: 20px;            border-top-right-radius: 20px;        }        .clash-card__image--barbarian{            background: url("http://7xu8mu.com1.z0.glb.clouddn.com/wp-content/uploads/barbarian-bg.jpg")        }        .clash-card__image--barbarian img{            width: 400px;            position: absolute;            top: -65px;            left: -70px;        }        .clash-card__level{            text-transform: uppercase;            font-size: 12px;            font-weight: 700;            margin-bottom: 3px;        }        .clash-card__level--barbarian{            color:#EC9B3B;        }        .clash-card__unit-name{            font-size: 26px;            color:#000;            font-weight: 900;            margin-bottom: 5px;        }        .clash-card__unit-description{            padding: 20px;            margin-bottom: 10px;        }        .clash-card__unit-stats--barbarian{            background: #EC9B3B;        }        .clash-card__unit-stats--barbarian .one-third{            border-right: 1px solid #BD7C2F;        }        .clash-card__unit-stats{            color:#fff;            font-weight: 700;            border-bottom-left-radius: 15px;            border-bottom-right-radius: 15px;            overflow: hidden;        }        .clash-card__unit-stats .one-third{            width: 33.33%;            float: left;            padding: 20px 15px;        }        .clash-card__unit-stats sup{            position: absolute;        }        .clash-card__unit-stats .stat{            position: relative;            font-size: 20px;            margin-bottom: 10px;        }        .clash-card__unit-stats .stat-value{            text-transform: uppercase;            font-weight: 400;            font-size: 12px;        }        .clash-card__unit-stats .no-border{            border-right: none;        }        .clearfix:after{            content:"";            clear:both;            visibility: hidden;            height: 0;            font-size: 0;        }    </style>`</pre></body>]]></content>
      
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Accordion With jQuery</title>
      <link href="/2016/06/20/accordion-with-jquery/"/>
      <url>/2016/06/20/accordion-with-jquery/</url>
      
        <content type="html"><![CDATA[<head><style>.accordion{  margin:50px auto;  width: 380px;  cursor:pointer;}.accordion .item{  height:100px;}.accordion .item h3{  display:inline-block;  vertical-align:middle;  height: 100%;  padding-left: 50px;  font-size: 20px;  font-weight: 400;}.accordion .item h3:before{  content:"";  display:inline-block;  vertical-align:middle;  height: 100%;}.accordion .item:first-of-type{  background-color: #620808;  color:#f4ce74;}.accordion .item:nth-of-type(2){  background-color: #a53f3f;  color:#ffe9c1;}.accordion .item:nth-of-type(3){  background-color: #f4ce74;  color:#620808;}.accordion p{  font-family:arial;  font-size: 18px;  font-weight: 400;  padding: 15px;  display:none;    margin:0;  box-shadow: inset 0 3px 7px rgba(0,0,0,.2);}.accordion p:first-of-type{  background-color: #620808;  color:#f4ce74;}.accordion p:nth-of-type(2){  background-color: #a53f3f;  color:#ffe9c1;}.accordion p:nth-of-type(3){  background-color: #f4ce74;  color:#620808;}</style></head><body><section class="accordion">  <div class="item"><h3 id="Item1"><a href="#Item1" class="headerlink" title="Item1"></a>Item1</h3>  </div>  Lorem ipsum dolor sit amet, consectetur adipisicing elit. Distinctio in error ipsa facere, veritatis fuga incidunt tempore perferendis placeat. Dolore iste laborum porro possimus officia ratione rerum cumque itaque ullam.  <div class="item"><h3 id="Item2"><a href="#Item2" class="headerlink" title="Item2"></a>Item2</h3>  </div>  Lorem ipsum dolor sit amet, consectetur adipisicing elit. Distinctio in error ipsa facere, veritatis fuga incidunt tempore perferendis placeat. Dolore iste laborum porro possimus officia ratione rerum cumque itaque ullam.  <div class="item"><h3 id="Item3"><a href="#Item3" class="headerlink" title="Item3"></a>Item3</h3>  </div>  Lorem ipsum dolor sit amet, consectetur adipisicing elit. Distinctio in error ipsa facere, veritatis fuga incidunt tempore perferendis placeat. Dolore iste laborum porro possimus officia ratione rerum cumque itaque ullam.</section><pre><code>/*HTML*/section.accordion    div.item        h3&#123;Item1&#125;    p&#123;Lorem&#125;    div.item        h3&#123;Item2&#125;    p&#123;Lorem&#125;    div.item        h3&#123;Item3&#125;    p&#123;Lorem&#125;/*CSS*/    body&#123;  background-color: #f6704b;&#125;*&#123;  margin:0;  padding: 0;&#125;.accordion&#123;  margin:50px auto;  width: 380px;  background-color: #ccc;  cursor:pointer;&#125;.accordion .item&#123;  height:100px;&#125;.accordion .item h3&#123;  display:inline-block;  vertical-align:middle;  height: 100%;  padding-left: 50px;  font-size: 20px;  font-weight: 400;&#125;.accordion .item h3:before&#123;  content:&quot;&quot;;  display:inline-block;  vertical-align:middle;  height: 100%;&#125;.accordion .item:first-of-type&#123;  background-color: #620808;  color:#f4ce74;&#125;.accordion .item:nth-of-type(2)&#123;  background-color: #a53f3f;  color:#ffe9c1;&#125;.accordion .item:nth-of-type(3)&#123;  background-color: #f4ce74;  color:#620808;&#125;.accordion p&#123;  font-family:arial;  font-size: 18px;  font-weight: 400;  padding: 15px;  display:none;  box-shadow: inset 0 3px 7px rgba(0,0,0,.2);&#125;.accordion p:first-of-type&#123;  background-color: #620808;  color:#f4ce74;&#125;.accordion p:nth-of-type(2)&#123;  background-color: #a53f3f;  color:#ffe9c1;&#125;.accordion p:nth-of-type(3)&#123;  background-color: #f4ce74;  color:#620808;&#125;/*jQuery*/(function($) &#123;      &#39;use strict&#39;;      $(&quot;.item&quot;).on(&quot;click&quot;,function()&#123;        $(this).next().slideToggle(100);        $(&quot;p&quot;).not($(this).next()).slideUp(&#39;fast&#39;);      &#125;);    &#125;(jQuery));</code></pre><script   src="https://code.jquery.com/jquery-3.0.0.min.js"   integrity="sha256-JmvOoLtYsmqlsWxa7mDSLMwa6dZ9rrIdtrrVYRnDRH0="   crossorigin="anonymous"></script><script>    (function($) {      'use strict';      $(".item").on("click",function(){        $(this).next().slideToggle(100);        $("p").not($(this).next()).slideUp('fast');      });    }(jQuery));  </script></body>]]></content>
      
      
      
        <tags>
            
            <tag> CSS3 </tag>
            
            <tag> jQuery </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>1 Dot -&gt; 3 Dots</title>
      <link href="/2016/06/19/1-dot-3-dots/"/>
      <url>/2016/06/19/1-dot-3-dots/</url>
      
        <content type="html"><![CDATA[<head><style>section{margin:0 auto;}.button{  display:inline-block;  font-size:30px;  border:1px solid maroon;  padding:10px 20px;  color:maroon;  position:relative;}.button:before{  position:absolute;  top: 50%;  left: 50%;  color:transparent;  content:"·";  text-shadow:0 0 transparent;  font-size: 1.2em;  transition: text-shadow .3s,color .3s;  transform:translateX(-50%);}.button:hover:before{  color:maroon;  text-shadow: 10px 0 maroon, -10px 0 maroon;}</style></head><body><section><div class="button">Button</div></section><p>Use <code>text-shadow</code> to generate other dots.</p><pre><code>    /*HTML*/    div.button&#123;Button&#125;    /*CSS*/    .button&#123;  display:inline-block;  font-size:30px;  border:1px solid maroon;  padding:10px 20px;  color:maroon;  position:relative;&#125;.button:before&#123;  position:absolute;  top: 50%;  left: 50%;  color:transparent;  content:&quot;·&quot;;  text-shadow:0 0 transparent;  font-size: 1.2em;  transition: text-shadow .3s,color .3s;  transform:translateX(-50%);&#125;.button:hover:before&#123;  color:maroon;  text-shadow: 10px 0 maroon, -10px 0 maroon;&#125;</code></pre></body>]]></content>
      
      
      
        <tags>
            
            <tag> CSS3 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Page Scroll With CSS3</title>
      <link href="/2016/06/17/page-scroll-with-css3/"/>
      <url>/2016/06/17/page-scroll-with-css3/</url>
      
        <content type="html"><![CDATA[<pre><code>.st-container&#123;    position: absolute;    width: 100%;    height: 100%;    top: 0;    left: 0;&#125;.st-container &amp;gt; input, .st-container &amp;gt; a&#123;    position:fixed;    bottom: 0;    width: 20%;    cursor:pointer;    font-size: 16px;    height: 34px;    line-height: 34px;&#125;.st-container &amp;gt; input&#123;    opacity: 0;    z-index: 1000;&#125;.st-container &amp;gt; a&#123;    z-index: 10;    font-weight: 700;    background: #e23a6e;    color:#fff;    text-align: center;    text-shadow: 1px 1px 1px rgba(151,24,64,.2);&#125;.st-container:before&#123;    content:&quot;&quot;;    position: fixed;    width: 100%;    height: 34px;    background-color: #e23a6e;    z-index: 9;    bottom: 0;&#125;#st-control-1, #st-control-1+a&#123;    left:0;&#125;#st-control-2, #st-control-2+a&#123;    left:20%;&#125;#st-control-3, #st-control-3+a&#123;    left:40%;&#125;#st-control-4, #st-control-4+a&#123;    left:60%;&#125;#st-control-5, #st-control-5+a&#123;    left:80%;&#125;.st-container &amp;gt; input:checked + a,.st-container &amp;gt; input:checked:hover + a&#123;    background-color: #821134;&#125;.st-container &amp;gt; input:checked + a:after,.st-container &amp;gt; input:checked:hover + a:after&#123;    bottom:100%;    border:solid transparent;    content:&quot;&quot;;    height: 0;    width: 0;    position: absolute;    pointer-events: none;    border-bottom-color: #821134;    border-width: 20px;    left:50%;    margin-left:-20px;&#125;.st-container &amp;gt; input:hover+a:after&#123;    border-bottom-color: #AD244F;&#125;.st-scroll,.st-panel&#123;    position:relative;    width: 100%;    height: 100%;&#125;.st-scroll&#123;    top: 0;    left: 0;    transition:all .6s ease-in-out;&#125;.st-panel&#123;    background-color: #fff;    overflow: hidden;&#125;#st-control-1:checked ~ .st-scroll&#123; //scroll    transform:translateY(0%);&#125;#st-control-2:checked ~ .st-scroll&#123; //scroll    transform: translateY(-100%);&#125;#st-control-3:checked ~ .st-scroll&#123; //scroll    transform: translateY(-200%);&#125;#st-control-4:checked ~ .st-scroll&#123; //scroll    transform: translateY(-300%);&#125;#st-control-5:checked ~ .st-scroll&#123; //scroll    transform: translateY(-400%);&#125;</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Button Transition With Background-Position</title>
      <link href="/2016/06/17/button-transition-with-background-position/"/>
      <url>/2016/06/17/button-transition-with-background-position/</url>
      
        <content type="html"><![CDATA[<head><style>button{  color:maroon;  border:1px solid maroon;  font-size:50px;  padding:20px 40px;  border-radius:15px;  transition-duration:0.5s;  position:relative;  overflow:hidden;}button:hover{  color:#fff;}.left{  background:-webkit-linear-gradient(left, maroon 50%, transparent 50%);  background-size:200% 100%;  background-position:100% 0%;}.left:hover{  background-position:0% 0%;}.angle{  background:-webkit-linear-gradient(225deg, maroon 50%, transparent 50%);  background-size:250% 100%;}.angle:hover{  background-position:100% 0%;}.close{  background:-webkit-linear-gradient(left, transparent 50%, maroon 50%);  background-size:200% 100%;}.close:after{  content:"";  position:absolute;  z-index: -1;  top:0;  left:0;  right: 0;  bottom: 0;  background:-webkit-linear-gradient(left, maroon 50%, transparent 50%);  background-size:200% 100%;  background-position:100% 0%;  transition-duration:.5s;}.close:hover{  background-position:50% 0%;}.close:hover:after{  background-position:50% 0%;}}</style></head><body>  <button class="left">Left</button><p><button class="angle">Angle</button></p><p><button class="close">Close</button></p><pre>`button{  color:maroon;  border:1px solid maroon;  font-size:50px;  padding:20px 40px;  border-radius:15px;  transition-duration:0.5s;  position:relative;  overflow:hidden;}button:hover{  color:#fff;}.left{  background:-webkit-linear-gradient(left, maroon 50%, transparent 50%);  background-size:200% 100%;  background-position:100% 0%;}.left:hover{  background-position:0% 0%;}.angle{  background:-webkit-linear-gradient(225deg, maroon 50%, transparent 50%);  background-size:250% 100%;}.angle:hover{  background-position:100% 0%;}.close{  background:-webkit-linear-gradient(left, transparent 50%, maroon 50%);  background-size:200% 100%;}.close:after{  content:"";  position:absolute;  z-index: -1;  top:0;  left:0;  right: 0;  bottom: 0;  background:-webkit-linear-gradient(left, maroon 50%, transparent 50%);  background-size:200% 100%;  background-position:100% 0%;  transition-duration:.5s;}.close:hover{  background-position:50% 0%;}.close:hover:after{  background-position:50% 0%;}}</pre><p>`</p></body>]]></content>
      
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>图片翻转+文字翻转特效</title>
      <link href="/2016/06/17/e5-9b-be-e7-89-87-e7-bf-bb-e8-bd-ac-e6-96-87-e5-ad-97-e7-bf-bb-e8-bd-ac-e7-89-b9-e6-95-88/"/>
      <url>/2016/06/17/e5-9b-be-e7-89-87-e7-bf-bb-e8-bd-ac-e6-96-87-e5-ad-97-e7-bf-bb-e8-bd-ac-e7-89-b9-e6-95-88/</url>
      
        <content type="html"><![CDATA[<head><style>.box{  position:relative;  perspective: 1000px;  text-align:center;}.box img{  width:200px;  height:auto;  opacity:1;  transform:translateY(0) rotateX(0);  transition: all 1s ease-in-out 0s;}<p>.box:hover img{<br>transform: translateY(-100%) rotateX(90deg);<br>transform-origin: center bottom 0;<br>opacity:0;<br>}</p><p>.box .over-layer{<br>position:absolute;<br>top:0;<br>left:0;<br>width:100%;<br>height:100%;<br>transform: translateY(100%) rotateX(-90deg);<br>opacity:0;<br>transform-origin:top center;<br>transition: all 1s ease-in-out;<br>}<br>.box:hover .over-layer{<br>transform: translateY(0) rotateX(0);<br>opacity:1;<br>}<br></style></p></head><body><div>    <div class="box">        ![蒙娜丽莎](http://a1.att.hudong.com/75/68/05300000467416128543684500954.jpg)    <div class="over-layer"><h3 id="Web-Designer"><a href="#Web-Designer" class="headerlink" title="Web Designer"></a>Web Designer</h3><p>Description</p><pre><code>&lt;/div&gt;&lt;/div&gt;</code></pre></div></body><pre><code>/*HTML*/    div.box        img[src=&quot;...&quot;]        div.over-layer            h3            p/*CSS*/.box&#123;  position:relative;  perspective: 1000px;  text-align:center;&#125;.box img&#123;  width:200px;  height:auto;  opacity:1;  transform:translateY(0) rotateX(0);  transition: all 1s ease-in-out 0s;&#125;.box:hover img&#123;  transform: translateY(-100%) rotateX(90deg);  transform-origin: center bottom 0;  opacity:0;&#125;.box .over-layer&#123;  position:absolute;  top:0;  left:0;  width:100%;  height:100%;  transform: translateY(100%) rotateX(-90deg);    opacity:0;  transform-origin:top center;  transition: all 1s ease-in-out;&#125;.box:hover .over-layer&#123;  transform: translateY(0) rotateX(0);    opacity:1;&#125;</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>转角跑马灯</title>
      <link href="/2016/06/16/e8-bd-ac-e8-a7-92-e8-b7-91-e9-a9-ac-e7-81-af/"/>
      <url>/2016/06/16/e8-bd-ac-e8-a7-92-e8-b7-91-e9-a9-ac-e7-81-af/</url>
      
        <content type="html"><![CDATA[<head><style>.marquee{  margin-top:3rem;  perspective:500px;  font-size:0;  font-family:"Microsoft YaHei", "Segoe UI", "Lucida Granda", Helvetica, Arial;}<p>.marquee div{<br>display:inline-block;<br>height:12rem;<br>width:30rem;<br>position:relative;<br>}<br>.marquee div{<br>font-size:8rem;<br>overflow:hidden;<br>}<br>.marquee div span{<br>position:absolute;<br>width:400%;<br>line-height:1.4;<br>}<br>.marquee div:first-of-type{<br>background:#e5233e;<br>transform-origin: top right;<br>transform: rotateY(-40deg);<br>color:#fff;<br>}<br>.marquee div:last-of-type{<br>background:#b31e31;<br>transform-origin:top left;<br>transform:rotateY(45deg);<br>color:#f8c9d9;<br>}<br>@keyframes leftcrawl{<br>to{ transform:translateX(-100rem);<br>}<br>}<br>@keyframes rightcrawl{<br>to{<br>transform:translateX(-100rem);}<br>}</p><p>.marquee div:first-of-type span{<br>transform:translateX(60rem);<br>animation:leftcrawl 14s linear infinite;<br>text-shadow:4px 0 4px rgba(0,0,0,0.3);<br>}<br>.marquee div:last-of-type span{<br>transform:translateX(43rem);<br>animation:rightcrawl 14s ease-out infinite;<br>}<br>}<br></style></p></head><body><div class="marquee">    <div><span> 跑马灯</span></div>    <div aria-hidden="true"><span> 跑马灯</span></div>  </div><pre>`/*HTML*/div.marquee    div>span{跑马灯}    div>span{跑马灯}/*CSS*/.marquee{  margin-top:3rem;  perspective:500px;  font-size:0;  font-family:"Microsoft YaHei", "Segoe UI", "Lucida Granda", Helvetica, Arial;}.marquee div{  display:inline-block;  height:12rem;  width:30rem;  position:relative;}.marquee div{  font-size:8rem;  overflow:hidden;}.marquee div span{  position:absolute;  width:400%;  line-height:1.4;}.marquee div:first-of-type{  background:#e5233e;  transform-origin: top right;  transform: rotateY(-40deg);  color:#fff;}.marquee div:last-of-type{  background:#b31e31;  transform-origin:top left;  transform:rotateY(45deg);  color:#f8c9d9;}@keyframes leftcrawl{  to{   transform:translateX(-100rem);}}@keyframes rightcrawl{  to{    transform:translateX(-100rem);}}.marquee div:first-of-type span{  transform:translateX(60rem);  animation:leftcrawl 14s linear infinite;  text-shadow:4px 0 4px rgba(0,0,0,0.3);}.marquee div:last-of-type span{  transform:translateX(43rem);  animation:rightcrawl 14s ease-out infinite;}}`</pre></body>]]></content>
      
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSS Cube Transform</title>
      <link href="/2016/06/16/css-cube-transform/"/>
      <url>/2016/06/16/css-cube-transform/</url>
      
        <content type="html"><![CDATA[<head><style>.container{  width:200px;  height:200px;  position:relative;  perspective:1000px;    margin:0 auto;}.cube{  width:100%;  height:100%;  position:absolute;  transform-style:preserve-3d;}.cube figure{  width:196px;  height:196px;  border:2px solid #ccc;  position:absolute;  font-size:20px;  line-height:196px;  font-weight:bold;  color:white;  text-align:center;  transition:transform 1s ease;}.cube:hover .front{  background: hsla(   0, 100%, 50%, 0.5 );  transform:translateZ(100px);}.cube:hover .back{  background: hsla(  60, 100%, 50%, 0.5 );  transform:rotateY(180deg) translateZ(100px);}.cube:hover .right{  background: hsla( 120, 100%, 50%, 0.5 );  transform: rotateY(90deg) translateZ(100px);}<p>.cube:hover .left{<br>background: hsla( 180, 100%, 50%, 0.5 );<br>transform: rotateY(-90deg) translateZ(100px);<br>}<br>.cube:hover .top{<br>background: hsla( 240, 100%, 50%, 0.5 );<br>transform: rotateX(90deg) translateZ(100px);<br>}<br>.cube:hover .bottom{<br>background: hsla( 300, 100%, 50%, 0.5 );<br>transform: rotateX(-90deg) translateZ(100px);<br>}<br></style></p></head><body><div><div class="container">  <div class="cube">    <figure class="front">Front</figure>    <figure class="back">Back</figure>    <figure class="right">Right</figure>    <figure class="left">Left</figure>    <figure class="top">Top</figure>    <figure class="bottom">Bottom</figure>  </div></div>**Notice**, when the rotate applied to the element, its coordinates will rotate with it. In this case, all Z-indices rotate to pointing outside the cube.<pre>`/*HTML*/div.container    div.cube        fiture.front{Front}        fiture.back{Back}        fiture.right{Right}        figure.left{Left}        figure.top{Top}        figure.bottom{Bottom}<p>/<em>CSS</em>/<br>.container{<br>width:200px;<br>height:200px;<br>position:relative;<br>perspective:1000px;<br>}<br>.cube{<br>width:100%;<br>height:100%;<br>position:absolute;<br>transform-style:preserve-3d;<br>}<br>.cube figure{ //Set single Aspect<br>width:196px;<br>height:196px;<br>border:2px solid #ccc;<br>position:absolute;<br>font-size:20px;<br>line-height:196px;<br>font-weight:bold;<br>color:white;<br>text-align:center;<br>transition:transform 1s ease;<br>}<br>.cube:hover .front{<br>background: hsla( 0, 100%, 50%, 0.5 );<br>transform:translateZ(100px);<br>}</p><p>.cube:hover .back{<br>background: hsla( 60, 100%, 50%, 0.5 );<br>transform:rotateY(180deg) translateZ(100px);<br>}</p><p>.cube:hover .right{<br>background: hsla( 120, 100%, 50%, 0.5 );<br>transform: rotateY(90deg) translateZ(100px);<br>}</p><p>.cube:hover .left{<br>background: hsla( 180, 100%, 50%, 0.5 );<br>transform: rotateY(-90deg) translateZ(100px);<br>}</p><p>.cube:hover .top{<br>background: hsla( 240, 100%, 50%, 0.5 );<br>transform: rotateX(90deg) translateZ(100px);<br>}</p><p>.cube:hover .bottom{<br>background: hsla( 300, 100%, 50%, 0.5 );<br>transform: rotateX(-90deg) translateZ(100px);<br>}<br>`</p><p></pre></p></div></body>]]></content>
      
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSS Progress Bar</title>
      <link href="/2016/06/16/css-progress-bar/"/>
      <url>/2016/06/16/css-progress-bar/</url>
      
        <content type="html"><![CDATA[<head><style>.wrapper{  position:relative;  overflow:visible;  width:500px;  margin:0 auto;}.bar{  border:1px solid maroon;  margin:40px 30px;  padding: 8px 0;  height:55px;  background: maroon;  background: -webkit-linear-gradient(left, maroon 50%, #fff 50%);  background-size:200% 100%;  background-position: 100% 0%;  -webkit-animation: AnimationName 10s ease infinite;}@keyframes AnimationName{  100%{    background-position:0% 0%;  }}.text{  font-size:22px;  margin:15px 0;  text-align:center;  text-transform:uppercase;  text-weight:bold;  background: -webkit-linear-gradient(left, #fff 50%, maroon 50%);  background-size:200% 100%;  background-position: 100% 0%;  -webkit-background-clip:text;  -webkit-text-fill-color: transparent;  animation: AnimationName 10s ease infinite;}</style></head><body><div class="wrapper">  <div class="bar"><pre><code>  Loading Bar</code></pre>  </div></div><pre><code>.bar&#123;  border:1px solid maroon;  margin:40px 30px;  padding: 8px 0;  height:55px;  background: maroon;  background: -webkit-linear-gradient(left, maroon 50%, #fff 50%);  background-size:200% 100%;  background-position: 100% 0%;  -webkit-animation: AnimationName 10s ease infinite;&#125;@keyframes AnimationName&#123;  100%&#123;    background-position:0% 0%;  &#125;&#125;.text&#123;  font-size:22px;  margin:15px 0;  text-align:center;  text-transform:uppercase;  text-weight:bold;  background: -webkit-linear-gradient(left, #fff 50%, maroon 50%);  background-size:200% 100%;  background-position: 100% 0%;  -webkit-background-clip:text;  -webkit-text-fill-color: transparent;  animation: AnimationName 10s ease infinite;&#125;</code></pre></body>]]></content>
      
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Text Gradient</title>
      <link href="/2016/06/16/text-gradient/"/>
      <url>/2016/06/16/text-gradient/</url>
      
        <content type="html"><![CDATA[<head><style>.background{  background:#04161f;  font-family:"Lato", sans-serif;  margin:3em auto;  max-width:50em;}.grad1{  display:inline-block;  font-size: 96px;  margin:0;  opacity:0.9;  background:#fff;  color:black;  position:relative;  text-shadow:1px 1px 0px #04161f, 1px 1px 0px #04161f, -1px -1px 0px #04161f;}.grad1:before, .grad1:after{  position:absolute;  top:0;  right:0;  bottom:0;  left:0;  pointer-events:none;}.grad1:before{  background: -webkit-linear-gradient(left, #23966c, #faaa54, #e23b4a, #db0768, #350670);  content:"";  display:block;  mix-blend-mode:screen;}.grad1:after{  content:"CSS Gradient";  background:#04161f;  color:#fff;  mix-blend-mode:multiply;}.grad2{  font-size:72px;  background:-webkit-linear-gradient(left, #23966c, #faaa54, #e23b4a, #db0768, #350670);  -webkit-background-clip:text;  -webkit-text-fill-color:transparent;}</style></head><body><ol><li><p>Mix-Blend-Mode</p><div class="background grad1">CSS Gradient</div><p>body{<br>background:#04161f;<br>font-family:”Lato”, sans-serif;<br>margin:3em auto;<br>max-width:50em;<br>}<br>.grad1{<br>display:inline-block;<br>font-size: 96px;<br>margin:0;<br>opacity:0.9;<br>background:#fff;<br>color:black;<br>position:relative;<br>text-shadow:1px 1px 0px #04161f, 1px 1px 0px #04161f, -1px -1px 0px #04161f;<br>}<br>.grad1:before, .grad1:after{<br>position:absolute;<br>top:0;<br>right:0;<br>bottom:0;<br>left:0;<br>pointer-events:none;<br>}<br>.grad1:before{<br>background: -webkit-linear-gradient(left, #23966c, #faaa54, #e23b4a, #db0768, #350670);<br>content:””;<br>display:block;<br>mix-blend-mode:screen;<br>}<br>.grad1:after{<br>content:”CSS Gradient”;<br>background:#04161f;<br>color:#fff;<br>mix-blend-mode:multiply;<br>}<br>`</pre></p></li><li><p>-webkit-background-clip + -webkit-text-fill-mode</p><div class="background"><div class="grad2">CSS Gradient</div></div><pre>`.grad2{  font-size:72px;  background:-webkit-linear-gradient(left, #23966c, #faaa54, #e23b4a, #db0768, #350670);  -webkit-background-clip:text;  -webkit-text-fill-color:transparent;}</li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSS3 中的 Pointer-Events 属性</title>
      <link href="/2016/06/15/css3-e4-b8-ad-e7-9a-84-pointer-events-e5-b1-9e-e6-80-a7/"/>
      <url>/2016/06/15/css3-e4-b8-ad-e7-9a-84-pointer-events-e5-b1-9e-e6-80-a7/</url>
      
        <content type="html"><![CDATA[<h3 id="功能"><a href="#功能" class="headerlink" title="功能:"></a>功能:</h3><ul><li>阻止用户的点击产生任何效果</li><li>阻止默认鼠标指针样式的显示(比如放在<code>&amp;lt;a&amp;gt;</code>上不会变成<code>pointer</code>)</li><li>阻止 CSS 里的<code>hover</code> 和<code>active</code>状态的监听* 阻止触发 JS 事件(同上)</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSS3 Transitions Basics</title>
      <link href="/2016/06/15/css3-transitions-basics/"/>
      <url>/2016/06/15/css3-transitions-basics/</url>
      
        <content type="html"><![CDATA[<h3 id="Benefits-of-CSS-3"><a href="#Benefits-of-CSS-3" class="headerlink" title="Benefits of CSS 3"></a>Benefits of CSS 3</h3><ol><li>CSS3 Transitions are natively handled by the browser, which means they are always faster than a comparable JS animation.</li><li>JS animation is more difficult.</li></ol><h3 id="Bezier-Timing-Functions"><a href="#Bezier-Timing-Functions" class="headerlink" title="Bezier Timing Functions"></a>Bezier Timing Functions</h3><p>CSS3 has a <code>transition-timing-function</code> property which accepts keywords like <code>ease</code>, <code>ease-in</code>, and <code>linear</code>.</p><p>However we can define our own timing function using a <code>cubic-bezier</code> value. It sounds and looks complicated but can be explained with some simple diagrams.</p><ol><li><code>linear</code> curse<br><img src="http://blogs.sitepointstatic.com/images/tech/855-css3-transitions-3-chart1.png"></li><li><code>ease-in-out</code> curse<br><img src="http://blogs.sitepointstatic.com/images/tech/855-css3-transitions-3-chart2.png"><br>it starts slowly, about 12% of the animation is completed in the first 25% of time;<br>it ends slowly, about 12 % of the animation is completed in the last 25% of time</li></ol><h4 id="What’s-a-Bezier-Curve"><a href="#What’s-a-Bezier-Curve" class="headerlink" title="What’s a Bezier Curve"></a>What’s a Bezier Curve</h4><p><img src="http://upload.wikimedia.org/wikipedia/commons/thumb/f/ff/Bezier_3_big.gif/240px-Bezier_3_big.gif"></p><p>Since the animation line starts at (0, 0) and ends at (1, 1), we just need to define the points P0 and P1 in the cubic bezier value, e.g.</p><pre><code>cubic-bezier(p0x, p0y, p1x, p1y);transition-timing-function: cubic-bezier(0.25, 0.25, 0.75, 0.75) //lineartransition-timing-function: cubic-bezier(0.42,0,0.58,1) //ease-in-out`&lt;/pre&gt;&lt;pre&gt;`transition-timing-function: cubic-bezier(0.5, -0.5, 0.5, 1.5) // invalid, points cannot locate outsite (0,1)</code></pre><p><img src="http://blogs.sitepointstatic.com/images/tech/855-css3-transitions-3-chart4.png"></p><h4 id="Let-the-Tools-do-the-Work"><a href="#Let-the-Tools-do-the-Work" class="headerlink" title="Let the Tools do the Work"></a>Let the Tools do the Work</h4><p><a href="http://cubic-bezier.com/">cubic-bezier.com</a></p><p><a href="http://matthewlein.com/ceaser/">Ceaser</a></p><h3 id="Transition-Property-Basics"><a href="#Transition-Property-Basics" class="headerlink" title="Transition Property Basics"></a>Transition Property Basics</h3><h4 id="Which-CSS-Properties-can-be-animated"><a href="#Which-CSS-Properties-can-be-animated" class="headerlink" title="Which CSS Properties can be animated?"></a>Which CSS Properties can be animated?</h4><ul><li>width</li><li>padding</li><li>color</li><li>top</li><li>border-radius</li><li>transform</li><li>all</li></ul><p>you can set one or more to property <code>transition-property</code></p>]]></content>
      
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>大公司怎么开发和部署前端代码</title>
      <link href="/2016/06/14/e5-a4-a7-e5-85-ac-e5-8f-b8-e6-80-8e-e4-b9-88-e5-bc-80-e5-8f-91-e5-92-8c-e9-83-a8-e7-bd-b2-e5-89-8d-e7-ab-af-e4-bb-a3-e7-a0-81/"/>
      <url>/2016/06/14/e5-a4-a7-e5-85-ac-e5-8f-b8-e6-80-8e-e4-b9-88-e5-bc-80-e5-8f-91-e5-92-8c-e9-83-a8-e7-bd-b2-e5-89-8d-e7-ab-af-e4-bb-a3-e7-a0-81/</url>
      
        <content type="html"><![CDATA[<h6 id="原文出处-fouber"><a href="#原文出处-fouber" class="headerlink" title="原文出处: fouber"></a>原文出处: <a href="https://github.com/fouber/blog/issues/6">fouber</a></h6><p>个人总结</p><p><img src="https://raw.githubusercontent.com/fouber/blog/master/assets/resource/01.png"></p><p>图中 a.css 是页面 index.html 的样式, 对于高访问量的页面而言, 每次访问 index.html 都需要请求 a.css, 会很影响性能.</p><p>因此我们希望这样安排</p><p><img src="https://raw.githubusercontent.com/fouber/blog/master/assets/resource/03.png"></p><p>利用 304, 让浏览器使用本地缓存: 304 叫协商缓存, 仍然需要和服务器通信一次</p><p>进一步优化, 强制浏览器使用本地缓存( cache-control/expires ), 不需要和服务器痛心了</p><p><img src="https://raw.githubusercontent.com/fouber/blog/master/assets/resource/04.png"></p><p>新的问题: 浏览器不发送资源请求, 如何更新缓存?</p><p><strong>通过更新页面中引用的资源路径, 让浏览器主动放弃缓存, 加载新资源</strong></p><p><img src="https://raw.githubusercontent.com/fouber/blog/master/assets/resource/05.png"></p><p>下次上线把链接地址改成新版本的, 就更新了资源</p><p>如果有很多样式引用, 但是仅仅改了其中一个呢?</p><p><img src="https://raw.githubusercontent.com/fouber/blog/master/assets/resource/07.png"></p><p>解决方法: 让 url 的修改与文件内容关联, 即只有文件内容发生变化, 才会更新 url</p><p>利用<strong>数据摘要算法</strong>对文件请求摘要信息, 摘要信息和文件内容一一对应, 就有了一种可以精确到单个文件粒度的缓存控制依据.</p><p>把 URL 改成带摘要信息的格式:</p><p><img src="https://raw.githubusercontent.com/fouber/blog/master/assets/resource/08.png"></p><p>以后如有文件修改, 就只更新对应的 URL 了</p><h4 id="进一步提高网站性能"><a href="#进一步提高网站性能" class="headerlink" title="进一步提高网站性能"></a>进一步提高网站性能</h4><p>把静态资源和动态网页分集群部署, 静态资源会被部署到 CDN 节点上, 网页中引用的资源也会变成对应的部署路径</p><p><img src="https://raw.githubusercontent.com/fouber/blog/master/assets/resource/09.png"></p><p>静态资源优化方案</p><ul><li>配置超长时间的本地缓存 — 节省带宽, 提高性能</li><li>采用内容摘要作为缓存更新依据 — 精确控制缓存</li><li>静态资源 CDN 部署 — 优化网络请求</li><li>更新资源发布路径实现非覆盖式发布 — 平滑升级</li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>CSS 添加条纹背景</title>
      <link href="/2016/06/14/css-e6-b7-bb-e5-8a-a0-e6-9d-a1-e7-ba-b9-e8-83-8c-e6-99-af/"/>
      <url>/2016/06/14/css-e6-b7-bb-e5-8a-a0-e6-9d-a1-e7-ba-b9-e8-83-8c-e6-99-af/</url>
      
        <content type="html"><![CDATA[<head><style>.bg{  height:300px;  width:300px;    color:#fff;}.type1{  background: linear-gradient(#fb3 20%, #58a 80%);}.type2{background: linear-gradient(#fb3 50%, #58a 50%);}.type3{background-size:100% 30px;}.type4{  background: linear-gradient(45deg, #fb3 50%, #58a 50%);  background-size:30px 30px;}.type5{  background: repeating-linear-gradient(45deg, #fb3, #58a 30px)}.type6{  background: #58a;  background-image: repeating-linear-gradient(45deg, hsla(0,0%,100%,.1),hsla(0,0%,100%,.1) 15px,transparent 0, transparent 30px);}    </style>    </head><pre><code>&amp;lt;body&amp;gt;&amp;lt;div class=&quot;bg type1&quot;&amp;gt;background: linear-gradient(#fb3 20%, #58a 80%);&amp;lt;br&amp;gt;</code></pre><p>整个背景上下各有 20%的纯色, 中间是过渡颜色</div></p><div class="bg type2">background: linear-gradient(#fb3 50%, #58a 50%);<p>上下两部分都是纯色</div></p><div class="bg type2 type3">添加 background-size:100% 30px;<p>宽 100%, 高 30px, 默认 repeat</p></div><div class="bg type4">斜向条纹<p>修改 linear-gradient 的角度: linear-gradient(45deg, #fb3 50%, #58a 50%)</p><p>添加重复:background-size:30px;</div></p><div class="bg type5">使用 repeat-linear-gradient:<p>background: repeating-linear-gradient(45deg, #fb3, #58a 30px)</p></div><p>&lt;</p><p>div class=”bg type6”&gt;<br>关于颜色设定, 如果我们希望条纹使用相近的颜色, 可以使用如下方法:</p><p>background: #58a;</p><p>background-image: repeating-linear-gradient(30deg, hsla(0,0%,100%,.1),hsla(0,0%,100%,.1) 15px,transparent 0, transparent 30px);</p><p>其原理是指定背景中最深的颜色, 其他颜色用透明度调整</p><p>&lt;</p><p>div&gt;</p></body>]]></content>
      
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSS 中的 Clear</title>
      <link href="/2016/06/13/css-e4-b8-ad-e7-9a-84-clear/"/>
      <url>/2016/06/13/css-e4-b8-ad-e7-9a-84-clear/</url>
      
        <content type="html"><![CDATA[<h3 id="为什么要清除浮动"><a href="#为什么要清除浮动" class="headerlink" title="为什么要清除浮动"></a>为什么要清除浮动</h3><p>一个块级元素的如果没有设置 <code>height</code>, 则其高度由其子元素撑开. 如果所有子元素都是浮动的(脱离标准文档流), 那么父元素就会发生”坍塌”.</p><h3 id="两种情况"><a href="#两种情况" class="headerlink" title="两种情况"></a>两种情况</h3><p>清除浮动包括清除<strong>子元素浮动</strong>和清除<strong>上级元素浮动</strong>, 如果要清除上级元素浮动, 只需要设置 clear:both 即可.<br>如果要清除子元素浮动, 可以用空标签法, clearfix 法或者 overflow 法.</p><h5 id="clear-的用法"><a href="#clear-的用法" class="headerlink" title="clear 的用法"></a>clear 的用法</h5><pre><code>.subElement&#123;    clear:both;&#125;`&lt;/pre&gt;##### clearfix(最优浮动闭合方案)父元素添加 class=clearfix简洁版&lt;pre&gt;`.clearfix:before, .clearfix:after&#123;  content:&quot;&quot;;    display:table;&#125;.clearfix:after&#123;  clear:both;    overflow:hidden;&#125;.clearfix&#123;  zoom:1;&#125;`&lt;/pre&gt;经典版&lt;pre&gt;`.clearfix:after&#123;  display:block;    content:&quot;&quot;;    clear:both;    height:0;    visibility:hidden&#125;`&lt;/pre&gt;使用时在浮动元素的父元素上添加 class=&quot;clearfix&quot;#### 简单的方法&lt;pre&gt;`.clearfix&#123;  overflow:auto;  _height:1%;&#125;`&lt;/pre&gt;#### 常用的方法&lt;pre&gt;`.clearfix&#123;  clear:both;  height:0;  overflow:hidden;&#125;</code></pre><p>在需要清除浮动的地方加上一个 div.clear 或者 br.clear(不是套上)</p>]]></content>
      
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>4 Simple Transitions of Button</title>
      <link href="/2016/05/29/4-simple-transitions-of-button/"/>
      <url>/2016/05/29/4-simple-transitions-of-button/</url>
      
        <content type="html"><![CDATA[<h1 id="4-Simple-CSS-Transition-to-Enchance-Your-Buttons"><a href="#4-Simple-CSS-Transition-to-Enchance-Your-Buttons" class="headerlink" title="4 Simple CSS Transition to Enchance Your Buttons"></a>4 Simple CSS Transition to Enchance Your Buttons</h1><h2 id="Darken"><a href="#Darken" class="headerlink" title="Darken"></a>Darken</h2><p>Set a darker shade background color when <code>:hover</code> is activated</p><h2 id="Fade-Out"><a href="#Fade-Out" class="headerlink" title="Fade Out"></a>Fade Out</h2><p>Set opacity to 1 by default, and reduce the opacity when <code>:hover</code> is activated.</p><h2 id="Change-Color"><a href="#Change-Color" class="headerlink" title="Change Color"></a>Change Color</h2><h2 id="Inset-Border"><a href="#Inset-Border" class="headerlink" title="Inset Border"></a>Inset Border</h2><p>To create an inset of border,</p><pre><code>button: hover&#123;  box-shadow: inset 0 0 0 5px #darkderColor;&#125;</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> CSS3 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>媒体查询</title>
      <link href="/2016/05/28/e5-aa-92-e4-bd-93-e6-9f-a5-e8-af-a2/"/>
      <url>/2016/05/28/e5-aa-92-e4-bd-93-e6-9f-a5-e8-af-a2/</url>
      
        <content type="html"><![CDATA[<h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><p><strong>媒体查询</strong>包括一个<strong>媒体类型</strong>和至少一个<strong>媒体属性</strong>, 这些<strong>媒体属性</strong>会被解析成真或假.</p><p>当媒体查询为真时, 相关的样式表或样式规则就会按照正常的级联规则被应用.</p><p>即使媒体查询的结果为假, <code>&amp;lt;link&amp;gt;</code>标签上带有媒体查询的样式表仍然会被下载.</p><h2 id="逻辑操作符"><a href="#逻辑操作符" class="headerlink" title="逻辑操作符"></a>逻辑操作符</h2><p>操作符 not, and 和 only, 可以用来构建复杂的媒体查询</p><p>逗号分隔符相当于 or 操作符, 其中一个为真, 则媒体查询结果为真</p><p>一个基本的媒体查询, 即一个媒体属性与默认指定的 all 媒体类型, 可能是这样子:</p><pre><code>@media (min-width: 700px) &#123;...&#125;`&lt;/pre&gt;如果要添加横屏限制&lt;pre&gt;`@media (min-width: 700px) and (orientation: landscape) &#123;...&#125;`&lt;/pre&gt;### notnot 关键字应用于整个媒体查询, 如&lt;pre&gt;`@media not all and (monochrome)&#123;...&#125; 等价于@media not (all and (monochrome)) &#123;...&#125;`&lt;/pre&gt;在逗号媒体查询列表中, not 仅否定他所在的 item.## 媒体属性大多数媒体属性都带有&quot; min-&quot; 和&quot; max-&quot;前缀### Color</code></pre><ul><li><p>值: <code>&amp;lt;color&amp;gt;</code></p></li><li><p>媒体: <code>visual</code></p></li><li><p>是否接受 min/max 前缀: 是</p><h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><p>向所有能显示颜色的设备应用样式表</p><pre>`@media all and (color) {...}`</pre><h3 id="Aspect-ratio"><a href="#Aspect-ratio" class="headerlink" title="Aspect-ratio"></a>Aspect-ratio</h3></li><li><p>值: <code>&amp;lt;ratio&amp;gt;</code></p></li><li><p>媒体: <code>visual, tactile</code></p></li><li><p>是否接受 min/max 前缀: 是</p><p>宽高比以”宽/高”表示</p><h4 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h4><p>向<strong>显示区域</strong>宽高比至少 1:1 的设备应用样式表</p><pre>`@media screen and (min-aspect-ratio: 1/1){...}`</pre><h3 id="Device-aspect-ratio"><a href="#Device-aspect-ratio" class="headerlink" title="Device-aspect-ratio"></a>Device-aspect-ratio</h3></li><li><p>值: <code>&amp;lt;ratio&amp;gt;</code></p></li><li><p>媒体: <code>visual, tactile</code></p></li><li><p>是否接受 min/max 前缀: 是</p><h4 id="示例-2"><a href="#示例-2" class="headerlink" title="示例"></a>示例</h4><p>为宽屏设备应用样式表</p><pre>`@media screen and (device-aspect-ratio:16/9), screen and (device-aspect-ratio:16/10){...}`</pre><h3 id="Device-height"><a href="#Device-height" class="headerlink" title="Device-height"></a>Device-height</h3></li><li><p>值: <code>&amp;lt;length&amp;gt;</code></p></li><li><p>媒体: <code>visual, tactile</code></p></li><li><p>是否接受 min/max 前缀: 是</p><p>描述输出设备的高度(整个屏幕或页的高度, 而不是渲染窗口的高度)</p><h4 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h4><p>向显示在最大宽度 800px 的屏幕上的文档应用样式表</p><pre>`&lt;link rel="stylesheet" media="screen and (max-device-height: 799px)" /&gt;</li></ul><h3 id="Device-width"><a href="#Device-width" class="headerlink" title="Device-width"></a>Device-width</h3><ul><li>值: <code>&amp;lt;length&amp;gt;</code></li><li>媒体: <code>visual, tactile</code></li><li>是否接受 min/max 前缀: 是</li></ul><p>描述输出设备的宽度</p><h3 id="Grid"><a href="#Grid" class="headerlink" title="Grid"></a>Grid</h3><ul><li>值: <code>&amp;lt;integer&amp;gt;</code></li><li>媒体: all</li><li>是否接受 min/max 前缀: 否</li><li>判断输出设备是网格设备还是位图设备. 如果是网格设备(例如电传打字机中断或只能显示一种字形的电话), 该值为 1, 否则为 0</li></ul><h3 id="Height"><a href="#Height" class="headerlink" title="Height"></a>Height</h3><ul><li>值: <code>&amp;lt;length&amp;gt;</code></li><li>媒体: <code>visual, tactile</code></li><li>是否接受 min/max 前缀: 是</li></ul><p>height 描述输出设备的渲染区域高度</p><h3 id="Monochrome"><a href="#Monochrome" class="headerlink" title="Monochrome"></a>Monochrome</h3><h3 id="Orientation"><a href="#Orientation" class="headerlink" title="Orientation"></a>Orientation</h3><ul><li>值: <code>&amp;lt;landscape | portrait&amp;gt;</code></li><li>媒体: <code>visual</code></li><li>是否接受 min/max 前缀: 否</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>学习 CSS 布局</title>
      <link href="/2016/05/28/e5-ad-a6-e4-b9-a0-css-e5-b8-83-e5-b1-80/"/>
      <url>/2016/05/28/e5-ad-a6-e4-b9-a0-css-e5-b8-83-e5-b1-80/</url>
      
        <content type="html"><![CDATA[<h2 id="Display-属性"><a href="#Display-属性" class="headerlink" title="Display 属性"></a>Display 属性</h2><p>每个元素都有一个默认的 display 值, 这个与元素的类型有关.</p><p>大部分元素他们的 display 默认为 <code>blcok</code> 或 <code>inline</code> .</p><p>一个 <code>blcok</code> 元素通常称为 <strong>块级元素</strong> , 一个 <code>inline</code> 元素通常称为 <strong>行内元素</strong> .</p><h3 id="Block"><a href="#Block" class="headerlink" title="Block"></a>Block</h3><p>一个 <code>Block</code> 元素会从新开始一行并盛满容器的宽度, 默认为 <code>blcok</code> 的元素有 <code>p, form, header, footer, section</code>等.</p><h3 id="Inline"><a href="#Inline" class="headerlink" title="Inline"></a>Inline</h3><p>一个 <code>inline</code>元素可以位于段落中, 包裹一些文字而不会打乱段落的布局.</p><h3 id="None"><a href="#None" class="headerlink" title="None"></a>None</h3><p>一些特殊元素的默认 display 是他, 例如 <code>script</code>. 用于不删除元素的情况下隐藏某些元素.</p><p>和 <code>visibility</code> 不同, <code>display: none</code>不会在文档流中占据空间, 但是 <code>visibility: hidden</code> 则会在文档流中占据空间.</p><h3 id="inline-blcok"><a href="#inline-blcok" class="headerlink" title="inline-blcok"></a>inline-blcok</h3><p><code>inline</code> 元素是可以位于段落内不导致换行的, 但是不可控制 <code>height</code>, <code>width</code> 属性</p><p><code>block</code> 元素独立成段, 但是可以控制 <code>height</code>, <code>width</code> 属性</p><p><code>inline-block</code> 元素可以位于段落中, 且独立控制 <code>height</code>, <code>width</code> 属性</p><p><strong>注意事项</strong>:</p><ul><li><code>vertical-align</code>属性会影响到<code>inline-block</code>元素, 你可能会把他的值设置为 top</li><li>需要设置每一个 <code>inline-block</code> 的宽度</li><li>在 HTML 代码中如果两个<code>inline-block</code>代码中有空格, 则实际排版中会出现空隙</li></ul><h2 id="Margin-auto"><a href="#Margin-auto" class="headerlink" title="Margin: auto"></a>Margin: auto</h2><p>设置 <code>Block</code> 元素的 <code>width</code> 属性可以组织他水平方向占据容器, 同时设置 <code>margin: 0 auto;</code> 可以令其居中显示.</p><h2 id="Box-sizing"><a href="#Box-sizing" class="headerlink" title="Box-sizing"></a>Box-sizing</h2><p><code>box-sizing: border-box;</code> 设置该元素的盒子尺寸为 <code>border</code> 的外尺寸</p><pre><code>.simple&#123;  width:500px;  margin: 20px auto;  padding: 20px;  -webkit-box-sizing: border-box;     -moz-box-sizing: border-box;          box-sizing: border-box;&#125;// simple 的  width 为 border+padding+content 的尺寸, 即元素的 border 整体宽度为 width`&lt;/pre&gt;## Position### static`position`默认为 `static` , 一个 `static`元素不会被&quot;positioned&quot;, 一个`position` 被设置为其他值的元素表示他会被&quot;positioned&quot;.### relative对`position:relativ`的元素设置 `top, bottom, left, right`属性可以使其偏离原有位置, 但是在文档流中占据原来的位置, 即偏离前的空间在文档流中作为其他元素的位置参考.### fixed一个`fixed` 元素会相对 window 定位, 即使页面滚动, 他在的浏览器中的位置也不会变化. `fixed` 元素不占据文档流.### absolute`absolute` 和 `fixed` 表现类似, 只是参考系变为最近的&quot;positioned&quot; 父级元素, 如果不存在这样的父级元素, 则以 body 元素为参考.### float### clear用于控制悬浮.&lt;pre&gt;`&amp;lt;div class=&#39;box&#39;&amp;gt;...&amp;lt;/div&amp;gt;&amp;lt;section class=&#39;after-box&#39;&amp;gt;...&amp;lt;/section&amp;gt;.box&#123;  float:left;  width: 200px;  height: 100px;  margin: 1em;&#125;.after-box&#123;  clear: left // 控制该元素左侧无浮动元素&#125;`&lt;/pre&gt;## 控制浮动使用浮动经常会遇到一些古怪的排版&lt;pre&gt;`&amp;lt;div class=&#39;clearfix&#39;&amp;gt;文字描述&amp;lt;img src=&#39;http://zh.learnlayout.com/images/ilta.png&#39;&amp;gt;&amp;lt;/div&amp;gt;.img&#123;  float:right;&#125;.clearfix&#123;  overflow: auto; // 扩大 div 阻止 img 溢出&#125;`&lt;/pre&gt;## 媒体查询&lt;pre&gt;`@media screen and (min-width:600px)&#123;  nav&#123;    float:left;    width:25%;  &#125;  section&#123;    margin-left:25%;  &#125;&#125;@media screen and (max-width:599px)&#123;  nav li&#123;    display: inline;  &#125;&#125;`&lt;/pre&gt;## Column&lt;pre&gt;`.three-column&#123;  padding:1em;  -moz-column-count: 3;  -moz-column-gap: 1em;  -webkit-column-count: 3;  -webkit-column-gap: 1em;  column-count: 3;  column-gap: 1em;&#125;`&lt;/pre&gt;实现 div 中三列布局## Flexbox&lt;pre&gt;`.container&#123;  display:-webkit-flex;  display:flex;&#125;nav&#123;  width:200px;&#125;.flex-column&#123;  -webkit-flex:1;//剩余宽度的100%          flex:1;&#125;`&lt;/pre&gt;### 使用  flex box 实现(vertical-container 内元素)垂直居中&lt;pre&gt;`.vertical-container&#123;  height:300px;  display:-webkit-flex;  display:flex;  -webkit-align-items: center;         -align-items: center;  -webkti-justify-content: center;         -justify-content: center;&#125;</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MDL-Tooltip</title>
      <link href="/2016/05/27/mdl-tooltip/"/>
      <url>/2016/05/27/mdl-tooltip/</url>
      
        <content type="html"><![CDATA[<head><link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"><link rel="stylesheet" href="https://code.getmdl.io/1.1.3/material.indigo-pink.min.css"><script defer src="https://code.getmdl.io/1.1.3/material.min.js"></script></head><h3 id="Default-Tooltip"><a href="#Default-Tooltip" class="headerlink" title="Default Tooltip"></a>Default Tooltip</h3><!-- Simple Tooltip --><div class="icon material-icons" id="tt1">Title1</div><div class="mdl-tooltip" for="tt1">Follow</div><pre><code>&amp;lt;!-- Simple Tooltip --&amp;gt;&amp;lt;div class=&quot;icon material-icons&quot; id=&quot;tt1&quot;&amp;gt;Title1&amp;lt;/div&amp;gt;&amp;lt;div class=&quot;mdl-tooltip&quot; for=&quot;tt1&quot;&amp;gt;Follow&amp;lt;/div&amp;gt;`&lt;/pre&gt;### Large Tooltip&lt;!-- Simple Tooltip --&gt;&lt;div class=&quot;icon material-icons&quot; id=&quot;tt2&quot;&gt;Title2&lt;/div&gt;&lt;div class=&quot;mdl-tooltip mdl-tooltip--large&quot; for=&quot;tt2&quot;&gt;Large&lt;/div&gt;&lt;pre&gt;`&amp;lt;!-- Simple Tooltip --&amp;gt;&amp;lt;div class=&quot;icon material-icons&quot; id=&quot;tt2&quot;&amp;gt;Title2&amp;lt;/div&amp;gt;&amp;lt;div class=&quot;mdl-tooltip mdl-tooltip--large&quot; for=&quot;tt2&quot;&amp;gt;Large&amp;lt;/div&amp;gt;`&lt;/pre&gt;### Rich Tooltip&lt;!-- Rich Tooltip --&gt;&lt;div class=&quot;icon material-icons&quot; id=&quot;tt3&quot;&gt;Rich&lt;/div&gt;&lt;div class=&quot;mdl-tooltip&quot; for=&quot;tt3&quot;&gt;Upload **file.zip**&lt;/div&gt;&lt;pre&gt;`&amp;lt;!-- Rich Tooltip --&amp;gt;&amp;lt;div class=&quot;icon material-icons&quot; id=&quot;tt3&quot;&amp;gt;Rich&amp;lt;/div&amp;gt;&amp;lt;div class=&quot;mdl-tooltip&quot; for=&quot;tt3&quot;&amp;gt;Upload &amp;lt;strong style=&#39;color:yellow&#39;&amp;gt;file.zip&amp;lt;/strong&amp;gt;&amp;lt;/div&amp;gt;</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> Material Design </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MDL-Textfield</title>
      <link href="/2016/05/27/mdl-textfield/"/>
      <url>/2016/05/27/mdl-textfield/</url>
      
        <content type="html"><![CDATA[<head><link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"><link rel="stylesheet" href="https://code.getmdl.io/1.1.3/material.indigo-pink.min.css"><script defer src="https://code.getmdl.io/1.1.3/material.min.js"></script></head><h3 id="Text-Field-amp-Numeric-Textfield"><a href="#Text-Field-amp-Numeric-Textfield" class="headerlink" title="Text Field &amp; Numeric Textfield"></a>Text Field &amp; Numeric Textfield</h3><!-- Simple Textfield --><form action="#">        <div class="mdl-textfield mdl-js-textfield">            <input type="text" class="mdl-textfield__input" id="sample1">            <label for="sample1" class="mdl-textfield__label">PlaceHolder..</label>        </div>    </form><pre><code>&amp;lt;br&amp;gt;&amp;lt;!-- Numeric Textfield --&amp;gt;&amp;lt;form action=&quot;#&quot;&amp;gt;    &amp;lt;div class=&quot;mdl-textfield mdl-js-textfield&quot;&amp;gt;        &amp;lt;input type=&quot;text&quot; class=&quot;mdl-textfield__input&quot; id=&quot;sample2&quot; pattern=&quot;-?[0-9]*(.[0-9]+)?&quot;&amp;gt;        &amp;lt;label for=&quot;sample2&quot; class=&quot;mdl-textfield__label&quot;&amp;gt;Numeric Textfield&amp;lt;/label&amp;gt;        &amp;lt;span class=&quot;mdl-textfield__error&quot;&amp;gt;Input is not a number!&amp;lt;/span&amp;gt;    &amp;lt;/div&amp;gt;`&lt;/pre&gt;&lt;/form&gt;&lt;pre&gt;`&amp;lt;!-- Simple Textfield --&amp;gt;    &amp;lt;form action=&quot;#&quot;&amp;gt;        &amp;lt;div class=&quot;mdl-textfield mdl-js-textfield&quot;&amp;gt;            &amp;lt;input type=&quot;text&quot; class=&quot;mdl-textfield__input&quot; id=&quot;sample1&quot;&amp;gt;            &amp;lt;label for=&quot;sample1&quot; class=&quot;mdl-textfield__label&quot;&amp;gt;PlaceHolder..&amp;lt;/label&amp;gt;        &amp;lt;/div&amp;gt;    &amp;lt;/form&amp;gt;    &amp;lt;br&amp;gt;    &amp;lt;!-- Numeric Textfield --&amp;gt;    &amp;lt;form action=&quot;#&quot;&amp;gt;        &amp;lt;div class=&quot;mdl-textfield mdl-js-textfield&quot;&amp;gt;            &amp;lt;input type=&quot;text&quot; class=&quot;mdl-textfield__input&quot; id=&quot;sample2&quot; pattern=&quot;-?[0-9]*(.[0-9]+)?&quot;&amp;gt;            &amp;lt;label for=&quot;sample2&quot; class=&quot;mdl-textfield__label&quot;&amp;gt;Numeric Textfield&amp;lt;/label&amp;gt;            &amp;lt;span class=&quot;mdl-textfield__error&quot;&amp;gt;Input is not a number!&amp;lt;/span&amp;gt;        &amp;lt;/div&amp;gt;    &amp;lt;/form&amp;gt;`&lt;/pre&gt;### Floating Label Textfield&lt;!-- Floating Label --&gt;&lt;form action=&quot;#&quot;&gt;        &lt;div class=&quot;mdl-textfield mdl-js-textfield mdl-textfield--floating-label&quot;&gt;            &lt;input type=&quot;text&quot; class=&quot;mdl-textfield__input&quot; id=&quot;sample3&quot;&gt;            &lt;label for=&quot;sample3&quot; class=&quot;mdl-textfield__label&quot;&gt;Floating&lt;/label&gt;        &lt;/div&gt;&lt;/form&gt;&lt;pre&gt;`&amp;lt;!-- Floating Label --&amp;gt;    &amp;lt;form action=&quot;#&quot;&amp;gt;        &amp;lt;div class=&quot;mdl-textfield mdl-js-textfield mdl-textfield--floating-label&quot;&amp;gt;            &amp;lt;input type=&quot;text&quot; class=&quot;mdl-textfield__input&quot; id=&quot;sample3&quot;&amp;gt;            &amp;lt;label for=&quot;sample3&quot; class=&quot;mdl-textfield__label&quot;&amp;gt;Floating&amp;lt;/label&amp;gt;        &amp;lt;/div&amp;gt;    &amp;lt;/form&amp;gt;`&lt;/pre&gt;### Multiple Line Textfield&lt;!-- Multiple Line --&gt;&lt;form action=&quot;#&quot;&gt;        &lt;div class=&quot;mdl-textfield mdl-js-textfield&quot;&gt;            &lt;textarea name=&quot;&quot; id=&quot;sample4&quot; cols=&quot;30&quot; rows=&quot;3&quot; class=&quot;mdl-textfield__input&quot; type=&quot;text&quot;&gt;&lt;/textarea&gt;            &lt;label for=&quot;sample4&quot; class=&quot;mdl-textfield__label&quot;&gt;Multiple Line&lt;/label&gt;        &lt;/div&gt;&lt;/form&gt;&lt;pre&gt;`    &amp;lt;!-- Multiple Line --&amp;gt;    &amp;lt;form action=&quot;#&quot;&amp;gt;        &amp;lt;div class=&quot;mdl-textfield mdl-js-textfield&quot;&amp;gt;            &amp;lt;textarea name=&quot;&quot; id=&quot;sample4&quot; cols=&quot;30&quot; rows=&quot;3&quot; class=&quot;mdl-textfield__input&quot; type=&quot;text&quot;&amp;gt;&amp;lt;/textarea&amp;gt;            &amp;lt;label for=&quot;sample4&quot; class=&quot;mdl-textfield__label&quot;&amp;gt;Multiple Line&amp;lt;/label&amp;gt;        &amp;lt;/div&amp;gt;    &amp;lt;/form&amp;gt;`&lt;/pre&gt;### Expandable Textfield&lt;!-- Expandable Textfield --&gt;&lt;form action=&quot;#&quot;&gt;        &lt;div class=&quot;mdl-textfield mdl-js-textfield mdl-textfield--expandable&quot;&gt;            &lt;label for=&quot;sample5&quot; class=&quot;mdl-button mdl-js-button mdl-button--icon mdl-js-ripple-effect&quot;&gt;                _S_            &lt;/label&gt;            &lt;div class=&quot;mdl-textfield__expandable-holder&quot;&gt;                &lt;input type=&quot;text&quot; class=&quot;mdl-textfield__input&quot; id=&quot;sample5&quot;&gt;                &lt;label for=&quot;sample5&quot; class=&quot;mdl-textfield__label&quot;&gt;Expandable Input&lt;/label&gt;            &lt;/div&gt;        &lt;/div&gt;&lt;/form&gt;&lt;pre&gt;`    &amp;lt;!-- Expandable Textfield --&amp;gt;    &amp;lt;form action=&quot;#&quot;&amp;gt;        &amp;lt;div class=&quot;mdl-textfield mdl-js-textfield mdl-textfield--expandable&quot;&amp;gt;            &amp;lt;label for=&quot;sample5&quot; class=&quot;mdl-button mdl-js-button mdl-button--icon mdl-js-ripple-effect&quot;&amp;gt;                &amp;lt;i class=&quot;material-icons&quot;&amp;gt;S&amp;lt;/i&amp;gt;            &amp;lt;/label&amp;gt;            &amp;lt;div class=&quot;mdl-textfield__expandable-holder&quot;&amp;gt;                &amp;lt;input type=&quot;text&quot; class=&quot;mdl-textfield__input&quot; id=&quot;sample5&quot;&amp;gt;                &amp;lt;label for=&quot;sample5&quot; class=&quot;mdl-textfield__label&quot;&amp;gt;Expandable Input&amp;lt;/label&amp;gt;            &amp;lt;/div&amp;gt;        &amp;lt;/div&amp;gt;    &amp;lt;/form&amp;gt;</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> Material Design </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MDL-Table</title>
      <link href="/2016/05/27/mdl-table/"/>
      <url>/2016/05/27/mdl-table/</url>
      
        <content type="html"><![CDATA[<head><link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"><link rel="stylesheet" href="https://code.getmdl.io/1.1.3/material.indigo-pink.min.css"><script defer src="https://code.getmdl.io/1.1.3/material.min.js"></script></head><h3 id="Selectable-Table"><a href="#Selectable-Table" class="headerlink" title="Selectable Table"></a>Selectable Table</h3><table class="mdl-data-table mdl-js-data-table mdl-data-table--selectable mdl-shadow--2dp">    <thead>        <tr>            <th class="mdl-data-table__cell--non-numeric">Material</th>            <th>Quantity</th>            <th>Unit Price</th>        </tr>    </thead>    <tbody>        <tr>            <td class="mdl-data-table__cell--non-numeric">Acrylic(Transparent)</td>            <td>25</td>            <td>$2.90</td>        </tr>        <tr>            <td class="mdl-data-table__cell--non-numeric">Plywood(Birch)</td>            <td>50</td>            <td>$1.25</td>        </tr>        <tr>            <td class="mdl-data-table__cell--non-numeric">Laminate(Gold on Blue)</td>            <td>10</td>            <td>$2.35</td>        </tr>    </tbody></table><pre><code>&amp;lt;table class=&quot;mdl-data-table mdl-js-data-table mdl-data-table--selectable mdl-shadow--2dp&quot;&amp;gt;    &amp;lt;thead&amp;gt;        &amp;lt;tr&amp;gt;            &amp;lt;th class=&quot;mdl-data-table__cell--non-numeric&quot;&amp;gt;Material&amp;lt;/th&amp;gt;            &amp;lt;th&amp;gt;Quantity&amp;lt;/th&amp;gt;            &amp;lt;th&amp;gt;Unit Price&amp;lt;/th&amp;gt;        &amp;lt;/tr&amp;gt;    &amp;lt;/thead&amp;gt;    &amp;lt;tbody&amp;gt;        &amp;lt;tr&amp;gt;            &amp;lt;td class=&quot;mdl-data-table__cell--non-numeric&quot;&amp;gt;Acrylic(Transparent)&amp;lt;/td&amp;gt;            &amp;lt;td&amp;gt;25&amp;lt;/td&amp;gt;            &amp;lt;td&amp;gt;$2.90&amp;lt;/td&amp;gt;        &amp;lt;/tr&amp;gt;        &amp;lt;tr&amp;gt;            &amp;lt;td class=&quot;mdl-data-table__cell--non-numeric&quot;&amp;gt;Plywood(Birch)&amp;lt;/td&amp;gt;            &amp;lt;td&amp;gt;50&amp;lt;/td&amp;gt;            &amp;lt;td&amp;gt;$1.25&amp;lt;/td&amp;gt;        &amp;lt;/tr&amp;gt;        &amp;lt;tr&amp;gt;            &amp;lt;td class=&quot;mdl-data-table__cell--non-numeric&quot;&amp;gt;Laminate(Gold on Blue)&amp;lt;/td&amp;gt;            &amp;lt;td&amp;gt;10&amp;lt;/td&amp;gt;            &amp;lt;td&amp;gt;$2.35&amp;lt;/td&amp;gt;        &amp;lt;/tr&amp;gt;    &amp;lt;/tbody&amp;gt;&amp;lt;/table&amp;gt;</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> Material Design </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MDL-Selection</title>
      <link href="/2016/05/27/mdl-selection/"/>
      <url>/2016/05/27/mdl-selection/</url>
      
        <content type="html"><![CDATA[<head><link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"><link rel="stylesheet" href="https://code.getmdl.io/1.1.3/material.indigo-pink.min.css"><script defer src="https://code.getmdl.io/1.1.3/material.min.js"></script></head><h3 id="Checkbox"><a href="#Checkbox" class="headerlink" title="Checkbox"></a>Checkbox</h3><!-- Checkbox --><label for="checkbox1" class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect">        <input type="checkbox" class="mdl-checkbox__input" id="checkbox1">        <span class="mdl-checkbox__label">Checkbox</span></label><pre><code>&amp;lt;!-- Checkbox --&amp;gt;&amp;lt;label for=&quot;checkbox1&quot; class=&quot;mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect&quot;&amp;gt;        &amp;lt;input type=&quot;checkbox&quot; class=&quot;mdl-checkbox__input&quot; id=&quot;checkbox1&quot;&amp;gt;        &amp;lt;span class=&quot;mdl-checkbox__label&quot;&amp;gt;Checkbox&amp;lt;/span&amp;gt;&amp;lt;/label&amp;gt;`&lt;/pre&gt;### Radio Button&lt;!-- Radio Button --&gt;&lt;label for=&quot;option-1&quot; class=&quot;mdl-radio mdl-js-radio mdl-js-ripple-effect&quot;&gt;    &lt;input type=&quot;button&quot; id=&quot;option-1&quot; class=&quot;mdl-radio__button&quot; name=&quot;options&quot; value=&quot;1&quot;&gt;    &lt;span class=&quot;mdl-radio__label&quot;&gt;Radio&lt;/span&gt;&lt;/label&gt;&lt;pre&gt;`&amp;lt;!-- Radio Button --&amp;gt;&amp;lt;label for=&quot;option-1&quot; class=&quot;mdl-radio mdl-js-radio mdl-js-ripple-effect&quot;&amp;gt;    &amp;lt;input type=&quot;button&quot; id=&quot;option-1&quot; class=&quot;mdl-radio__button&quot; name=&quot;options&quot; value=&quot;1&quot;&amp;gt;    &amp;lt;span class=&quot;mdl-radio__label&quot;&amp;gt;Radio&amp;lt;/span&amp;gt;&amp;lt;/label&amp;gt;`&lt;/pre&gt;### Icon Toggle&lt;!-- Icon Toggle --&gt;&lt;label for=&quot;icon-toggle-1&quot; class=&quot;mdl-icon-toggle mdl-js-icon-toggle mdl-js-ripple-effect&quot;&gt;&lt;input type=&quot;checkbox&quot; class=&quot;mdl-icon-toggle__input&quot; id=&quot;icon-toggle-1&quot;&gt;_Icon_&lt;/label&gt;&lt;pre&gt;`&amp;lt;!-- Icon Toggle --&amp;gt; &amp;lt;label for=&quot;icon-toggle-1&quot; class=&quot;mdl-icon-toggle mdl-js-icon-toggle mdl-js-ripple-effect&quot;&amp;gt;    &amp;lt;input type=&quot;checkbox&quot; class=&quot;mdl-icon-toggle__input&quot; id=&quot;icon-toggle-1&quot;&amp;gt;    &amp;lt;i class=&quot;mdl-icon-toggle__label material-icons&quot;&amp;gt;Icon&amp;lt;/i&amp;gt;&amp;lt;/label&amp;gt;`&lt;/pre&gt;### Switch&lt;!-- Switch --&gt;&lt;label for=&quot;switch-1&quot; class=&quot;mdl-switch mdl-js-switch mdl-js-ripple-effect&quot;&gt;    &lt;input type=&quot;checkbox&quot; class=&quot;mdl-switch__input&quot; id=&quot;switch-1&quot;&gt;    &lt;span class=&quot;mdl-switch__label&quot;&gt;&lt;/span&gt;&lt;/label&gt;&lt;pre&gt;`&amp;lt;!-- Switch --&amp;gt;&amp;lt;label for=&quot;switch-1&quot; class=&quot;mdl-switch mdl-js-switch mdl-js-ripple-effect&quot;&amp;gt;    &amp;lt;input type=&quot;checkbox&quot; class=&quot;mdl-switch__input&quot; id=&quot;switch-1&quot;&amp;gt;    &amp;lt;span class=&quot;mdl-switch__label&quot;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/label&amp;gt;</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> Material Design </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MDL-Snackbar</title>
      <link href="/2016/05/27/mdl-snackbar/"/>
      <url>/2016/05/27/mdl-snackbar/</url>
      
        <content type="html"><![CDATA[<head><link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"><link rel="stylesheet" href="https://code.getmdl.io/1.1.3/material.indigo-pink.min.css"><script defer src="https://code.getmdl.io/1.1.3/material.min.js"></script></head><p><button id="show-snackbar" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect" type="button">Show Snackbar</button></p><div id="snackbar" class="mdl-snackbar mdl-js-snackbar">        <div class="mdl-snackbar__text"></div>        <button class="mdl-snackbar__action" type="button"></button></div><script>(function(){'user strict'var snackbarContainer = document.querySelector('#snackbar');var showSnackbarButton = document.querySelector('#show-snackbar');var handler = function(event){showSnackbarButton.style.backgroundColor = '';};showSnackbarButton.addEventListener('click', function(){'user strict'showSnackbarButton.style.backgroundColor = '#' + Math.floor(Math.random() * 0xffffff).toString(16);var data={message: "Button Color Changed.",timeout: 2000,actionHandler: handler,actionText: "Undo"};snackbarContainer.MaterialSnackbar.showSnackbar(data);});}());</script><pre><code>&amp;lt;button id=&quot;show-snackbar&quot; class=&quot;mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect&quot; type=&quot;button&quot;&amp;gt;Show Snackbar&amp;lt;/button&amp;gt;&amp;lt;div id=&quot;snackbar&quot; class=&quot;mdl-snackbar mdl-js-snackbar&quot;&amp;gt;        &amp;lt;div class=&quot;mdl-snackbar__text&quot;&amp;gt;&amp;lt;/div&amp;gt;        &amp;lt;button class=&quot;mdl-snackbar__action&quot; type=&quot;button&quot;&amp;gt;&amp;lt;/button&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;script&amp;gt;        (function()&#123;            &#39;user strict&#39;            var snackbarContainer = document.querySelector(&#39;#snackbar&#39;);            var showSnackbarButton = document.querySelector(&#39;#show-snackbar&#39;);            var handler = function(event)&#123;                showSnackbarButton.style.backgroundColor = &#39;&#39;;            &#125;;            showSnackbarButton.addEventListener(&#39;click&#39;, function()&#123;                &#39;user strict&#39;                showSnackbarButton.style.backgroundColor = &#39;#&#39; + Math.floor(Math.random() * 0xffffff).toString(16);                var data=&#123;                    message: &quot;Button Color Changed.&quot;,                    timeout: 2000,                    actionHandler: handler,                    actionText: &quot;Undo&quot;                &#125;;                snackbarContainer.MaterialSnackbar.showSnackbar(data);            &#125;);        &#125;());&amp;lt;/script&amp;gt;</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> Material Design </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MDL-Slider</title>
      <link href="/2016/05/27/mdl-slider/"/>
      <url>/2016/05/27/mdl-slider/</url>
      
        <content type="html"><![CDATA[<head><!-- Default Slider -->    <input type="range" class="mdl-slider mdl-js-slider" min="0" max="100" value="0" tabindex="0"></head><h3 id="Default-Slider"><a href="#Default-Slider" class="headerlink" title="Default Slider"></a>Default Slider</h3><!-- Default Slider --><input type="range" class="mdl-slider mdl-js-slider" min="0" max="100" value="0" tabindex="0"><pre><code>&amp;lt;!-- Default Slider --&amp;gt;&amp;lt;input type=&quot;range&quot; class=&quot;mdl-slider mdl-js-slider&quot; min=&quot;0&quot; max=&quot;100&quot; value=&quot;0&quot; tabindex=&quot;0&quot;&amp;gt;`&lt;/pre&gt;### Slider with Starting Value&lt;!-- Slider with Starting Value --&gt;&lt;input type=&quot;range&quot; class=&quot;mdl-slider mdl-js-slider&quot; min=&quot;0&quot; max=&quot;100&quot; value=&quot;25&quot; tabindex=&quot;0&quot;&gt;&lt;pre&gt;`&amp;lt;!-- Slider with Starting Value --&amp;gt;&amp;lt;input type=&quot;range&quot; class=&quot;mdl-slider mdl-js-slider&quot; min=&quot;0&quot; max=&quot;100&quot; value=&quot;25&quot; tabindex=&quot;0&quot;&amp;gt;</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> Material Design </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MDL-Menu</title>
      <link href="/2016/05/27/mdl-menu/"/>
      <url>/2016/05/27/mdl-menu/</url>
      
        <content type="html"><![CDATA[<head><link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"><link rel="stylesheet" href="https://code.getmdl.io/1.1.3/material.indigo-pink.min.css"><script defer src="https://code.getmdl.io/1.1.3/material.min.js"></script></head><h3 id="Left-Aligned-Menu-Below-Button"><a href="#Left-Aligned-Menu-Below-Button" class="headerlink" title="Left Aligned Menu Below Button"></a>Left Aligned Menu Below Button</h3><!-- Left aligned menu below button --><button id="leftBelowButton" class="mdl-button mdl-js-button mdl-button--icon mdl-button--fab">    _i_</button><ul><li><p>Some Action</p></li><li><p>Another Action</p></li><li><p>Disabled Action</p></li><li><p>Yet Another Action</p><pre><code>&amp;lt;!-- Left aligned menu below button --&amp;gt;&amp;lt;button id=&quot;leftBelowButton&quot; class=&quot;mdl-button mdl-js-button mdl-button--icon mdl-button--fab&quot;&amp;gt;    &amp;lt;i class=&quot;material-icons&quot;&amp;gt;i&amp;lt;/i&amp;gt;&amp;lt;/button&amp;gt;&amp;lt;ul class=&quot;mdl-menu mdl-js-menu mdl-menu--bottom-left mdl-js-ripple-effect&quot; for=&quot;leftBelowButton&quot;&amp;gt;    &amp;lt;li class=&quot;mdl-menu__item&quot;&amp;gt;Some Action&amp;lt;/li&amp;gt;    &amp;lt;li class=&quot;mdl-menu__item mdl-menu__item--full-bleed-divider&quot;&amp;gt;Another Action&amp;lt;/li&amp;gt;    &amp;lt;li class=&quot;mdl-menu__item&quot; disabled&amp;gt;Disabled Action&amp;lt;/li&amp;gt;    &amp;lt;li class=&quot;mdl-menu__item&quot;&amp;gt;Yet Another Action&amp;lt;/li&amp;gt;&amp;lt;/ul&amp;gt;</code></pre><p>`</pre></p><h3 id="Right-Aligned-Menu-Below-Button"><a href="#Right-Aligned-Menu-Below-Button" class="headerlink" title="Right Aligned Menu Below Button"></a>Right Aligned Menu Below Button</h3><!-- Right aligned menu below button --><button id="rightBelowButton" class="mdl-button mdl-js-button mdl-button--icon mdl-button--fab">    _i_</button></li><li><p>Some Action</p></li><li><p>Another Action</p></li><li><p>Disabled Action</p></li><li><p>Yet Another Action</p><pre>`    &lt;!-- Right aligned menu below button --&gt;    &lt;button id="rightBelowButton" class="mdl-button mdl-js-button mdl-button--icon mdl-button--fab"&gt;        &lt;i class="material-icons"&gt;i&lt;/i&gt;    &lt;/button&gt;    &lt;ul class="mdl-menu mdl-js-menu mdl-menu--bottom-right mdl-js-ripple-effect" for="rightBelowButton"&gt;        &lt;li class="mdl-menu__item"&gt;Some Action&lt;/li&gt;        &lt;li class="mdl-menu__item mdl-menu__item--full-bleed-divider"&gt;Another Action&lt;/li&gt;        &lt;li class="mdl-menu__item" disabled&gt;Disabled Action&lt;/li&gt;        &lt;li class="mdl-menu__item"&gt;Yet Another Action&lt;/li&gt;    &lt;/ul&gt;`</pre><h3 id="Left-Aligned-Menu-Above-Button"><a href="#Left-Aligned-Menu-Above-Button" class="headerlink" title="Left Aligned Menu Above Button"></a>Left Aligned Menu Above Button</h3><!-- Left aligned menu above button --><button id="leftAboveButton" class="mdl-button mdl-js-button mdl-button--icon mdl-button--fab">    _i_</button></li><li><p>Some Action</p></li><li><p>Another Action</p></li><li><p>Disabled Action</p></li><li><p>Yet Another Action</p><pre>`    &lt;!-- Left aligned menu above button --&gt;    &lt;button id="leftAboveButton" class="mdl-button mdl-js-button mdl-button--icon mdl-button--fab"&gt;        &lt;i class="material-icons"&gt;i&lt;/i&gt;    &lt;/button&gt;    &lt;ul class="mdl-menu mdl-js-menu mdl-menu--top-left mdl-js-ripple-effect" for="leftAboveButton"&gt;        &lt;li class="mdl-menu__item"&gt;Some Action&lt;/li&gt;        &lt;li class="mdl-menu__item mdl-menu__item--full-bleed-divider"&gt;Another Action&lt;/li&gt;        &lt;li class="mdl-menu__item" disabled&gt;Disabled Action&lt;/li&gt;        &lt;li class="mdl-menu__item"&gt;Yet Another Action&lt;/li&gt;    &lt;/ul&gt;`</pre><h3 id="Right-Aligned-Menu-Above-Button"><a href="#Right-Aligned-Menu-Above-Button" class="headerlink" title="Right Aligned Menu Above Button"></a>Right Aligned Menu Above Button</h3><!-- Right aligned menu above button --><button id="rightAboveButton" class="mdl-button mdl-js-button mdl-button--icon mdl-button--fab">    _i_</button></li><li><p>Some Action</p></li><li><p>Another Action</p></li><li><p>Disabled Action</p></li><li><p>Yet Another Action</p><pre>`    &lt;!-- Right aligned menu above button --&gt;    &lt;button id="rightAboveButton" class="mdl-button mdl-js-button mdl-button--icon mdl-button--fab"&gt;        &lt;i class="material-icons"&gt;i&lt;/i&gt;    &lt;/button&gt;    &lt;ul class="mdl-menu mdl-js-menu mdl-menu--top-right mdl-js-ripple-effect" for="rightAboveButton"&gt;        &lt;li class="mdl-menu__item"&gt;Some Action&lt;/li&gt;        &lt;li class="mdl-menu__item mdl-menu__item--full-bleed-divider"&gt;Another Action&lt;/li&gt;        &lt;li class="mdl-menu__item" disabled&gt;Disabled Action&lt;/li&gt;        &lt;li class="mdl-menu__item"&gt;Yet Another Action&lt;/li&gt;    &lt;/ul&gt;</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Material Design </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>图解 Git</title>
      <link href="/2016/05/26/e5-9b-be-e8-a7-a3-git/"/>
      <url>/2016/05/26/e5-9b-be-e8-a7-a3-git/</url>
      
        <content type="html"><![CDATA[<h2 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h2><p><img src="https://marklodato.github.io/visual-git-guide/basic-usage.svg" alt="Git基本用法"><br>图中, History 即为本地仓库(local repository), Stage(Index) 为暂存目录, 也称为索引, Working Directory 为工作目录.</p><ul><li><code>git add *file*</code> 把Current Working Directory 下的file 放入 Stage</li><li><code>git commit</code> 对 Stage 生成快照并放入 local Repo</li><li><code>git reset -- *file*</code> 用来将 Stage 恢复到上一次 commit 的状态(快照)</li><li><code>git checkout -- *file*</code> 把文件从 Stage 复制到 Current Working Directory, 并且丢弃本地修改</li></ul><p>可以使用 <code>git reset -p</code>, <code>git checkout -p</code>, <code>git add -p</code>进入交互模式.</p><p>可以跳过 Stage, 实现 Working Directory 和 Local Repo 的直接交流.<br><img src="https://marklodato.github.io/visual-git-guide/basic-usage-2.svg" alt="跳过 Stage"></p><ul><li><code>git commit -a</code> 相当于运行 <code>git add</code>把Working Directory 下的文件放入 Stage 并 Commit</li><li><code>git commit *file*</code> 进行一次包含最后一次 Commit, 并加上 Working Directory 快照的提交, 并且文件添加到 Stage</li><li><code>git checkout HEAD</code> 从 Local Repo 中取出上一次 commit 的快照并回滚</li></ul><h2 id="图例"><a href="#图例" class="headerlink" title="图例"></a>图例</h2><p><img src="https://marklodato.github.io/visual-git-guide/conventions.svg" alt="图例"></p><h2 id="命令详解"><a href="#命令详解" class="headerlink" title="命令详解"></a>命令详解</h2><h3 id="Diff"><a href="#Diff" class="headerlink" title="Diff"></a>Diff</h3><p>查看两次提交之间的变动<br><img src="https://marklodato.github.io/visual-git-guide/diff.svg" alt="diff"></p><h3 id="Commit"><a href="#Commit" class="headerlink" title="Commit"></a>Commit</h3><p>执行 Commit 的时候, git 对 Stage 中的文件做一个快照, 提交给 local repo, 记为指向父节点的<strong>新节点</strong>, 然后把 HEAD 指向<strong>新节点</strong>,<br><img src="https://marklodato.github.io/visual-git-guide/commit-master.svg" alt="commit"><br>图中执行 commit 后, stage 生成快照并提交给 repo, 记为新节点 f0cec, 其指向父节点 ed489, 同时 HEAD 从父节点转移至新节点.</p><p>即使当前分支是从某祖父节点出发的, git 也会生成新节点并指向该祖父节点, 并将 HEAD 指向新节点<br><img src="https://marklodato.github.io/visual-git-guide/commit-maint.svg" alt="git"><br>图中 maint 在 commit 前是 master 的子父节点, 在 commit 不再是 master 的祖父节点, 此时合并或衍合是必须的.</p><p>如果想更改一次commit, 使用 <code>git commit --amend</code>, git 会使用当前父节点进行一次新的提交, 新的子节点依旧指向该父节点, 旧的提交会被取消, 如图<br><img src="https://marklodato.github.io/visual-git-guide/commit-amend.svg" alt="amend"></p><h3 id="Checkout"><a href="#Checkout" class="headerlink" title="Checkout"></a>Checkout</h3><p><code>Checkout</code>用于从 Stage 中取出文件放到 Working Directory 中, 也可用于切换分支</p><p>当给定某个文件名时, git 会从指定的节点中拷贝文件到 Stage 和 Working Directory. 比如 <code>git checkout HEAD~ foo.c</code> 会从 HEAD~(即当前父节点)中拷贝 foo.c 文件到 Working Directory 并加到 Stage, 如果<code>checkout</code> 没有添加指定节点, 就会从 Stage 中拷贝文件.<br><img src="https://marklodato.github.io/visual-git-guide/checkout-files.svg" alt="checkout"></p><p>如果不指定文件名, 而是给出一个本地分支名, 则会将 HEAD 指向该分支, 即转为 current branch<br><img src="https://marklodato.github.io/visual-git-guide/checkout-branch.svg" alt="checkout"></p><p>如果没有指定文件名和分支名, 而是一个标签, 远程分支, SHA-1值, 或者像是 master~3之类的东西, 则得到一个匿名分支, 称为 detached HEAD( 被分离的 HEAD 标识)<br><img src="https://marklodato.github.io/visual-git-guide/checkout-detached.svg" alt="checkout"></p><p>当 HEAD 处于分离状态时(不指向任何有名的 branch), commit 可以正常提交, 但不会更新任何有名的 branch( 称为新的匿名分支)<br><img src="https://marklodato.github.io/visual-git-guide/commit-detached.svg" alt="commit"></p><p>此时如果切换到其他分支, 就无法返回这个匿名分支<br><img src="https://marklodato.github.io/visual-git-guide/checkout-after-detached.svg" alt="commit"></p><p>如果想对该匿名分支创建引用, 可以用 <code>git checkout -b *name*</code> 来创建一个指向匿名分支的新分支<br><img src="https://marklodato.github.io/visual-git-guide/checkout-b-detached.svg" alt="commit"></p><h3 id="Reset"><a href="#Reset" class="headerlink" title="Reset"></a>Reset</h3><p><code>reset</code> 指令把当前分支指向另一个位置, 并且有选择的变动 Working Directory 和 Stage. 也用来从 Local Repo 中复制文件到 Stage, 不修改 Working Directory.</p><p>如果不给参数, 则当前分支指向那个节点, 并将 Stage 恢复到对应commit; 如果用 <code>--hard</code> 参数, 则 Working Directory 也恢复到该节点的commit, 如果用 <code>--soft</code> 参数, 则都不变<br><img src="https://marklodato.github.io/visual-git-guide/reset-commit.svg" alt="reset"></p><p>如果不提供版本号, 则默认 HEAD, 这样分支指向不变(依旧指向当前节点), 但是 Stage 会回滚到上一次 commit, 如果用了– hard, 则 Working Directory 也会回滚.<br><img src="https://marklodato.github.io/visual-git-guide/reset.svg" alt="reset"></p><h3 id="Merge"><a href="#Merge" class="headerlink" title="Merge"></a>Merge</h3><p><code>merge</code> 将不同的 branch 合并, 合并前, 其他分支的Stage 必须和当前分支的 Stage 相同(即合并的几个分支需要有相同的 Stage).</p><ul><li>如果另一个分支是当前分支的祖父节点, 则合并命令将什么也不做.</li><li>如果当前节点是另一个分支的祖父节点, 则带哦之 fast-forward 合并, 即简单易懂 HEAD, 并生成一个新的 commit<br><img src="https://marklodato.github.io/visual-git-guide/merge-ff.svg" alt="merge"></li></ul><p>如果是一次真正的合并, 默认把当前节点(ed489)和另一个节点(33104)及他们的共同祖父节点(b325c)进行一次三方合并. 结果是先保存Working Directory 和 Stage, 然后在当前节点(ed489)处提交新的节点.<br><img src="https://marklodato.github.io/visual-git-guide/merge.svg" alt="merge"></p><h3 id="Cherry-Pick"><a href="#Cherry-Pick" class="headerlink" title="Cherry Pick"></a>Cherry Pick</h3><p><code>cherry-pick</code> 命令”复制”一个提交节点并在当前分支做一次完全一样的新提交(将某节点作为新节点).<br><img src="https://marklodato.github.io/visual-git-guide/cherry-pick.svg" alt="cherry-pick"></p><h3 id="Rebase"><a href="#Rebase" class="headerlink" title="Rebase"></a>Rebase</h3><p>衍合是合并命令的另一种选择. 合并吧两个父分支合并进行一次提交, 提交历史不是线性的. 衍合在当前分支上重演另一个分支的历史, 提交历史是线性的, 本质上是线性化的自动的 cherry-pick<br><img src="https://marklodato.github.io/visual-git-guide/rebase.svg" alt="rebase"></p><p>上面所有的命令都在 topic 分支中进行, 而不是 master 分支( HEAD 指向 topic), 在 master 分支上重演, 并把分支指向新的节点(就得 topic 分支被回收).</p><p>要限制回滚返回, 使用 <code>--onto</code> 参数<br><img src="https://marklodato.github.io/visual-git-guide/rebase-onto.svg" alt="rebase"></p>]]></content>
      
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MDL-Loading</title>
      <link href="/2016/05/26/mdl-loading/"/>
      <url>/2016/05/26/mdl-loading/</url>
      
        <content type="html"><![CDATA[<h3 id="Defaut-Progress-Bar"><a href="#Defaut-Progress-Bar" class="headerlink" title="Defaut Progress Bar"></a>Defaut Progress Bar</h3><pre><code>&amp;lt;!-- Simple MDL Progress Bar --&amp;gt;    &amp;lt;div class=&quot;mdl-progress mdl-js-progress&quot; id=&quot;p1&quot;&amp;gt;&amp;lt;/div&amp;gt;    &amp;lt;script&amp;gt;        document.querySelector(&#39;#p1&#39;).addEventListener(&#39;mdl-componentupgraded&#39;, function()&#123;            this.MaterialProgress.setProgress(44);        &#125;)    &amp;lt;/script&amp;gt;`&lt;/pre&gt;### Intedeterminate Progress Bar&lt;!-- MDL Progress Bar with Indeterminate Progress --&gt;&lt;div id=&quot;p2&quot; class=&quot;mdl-progress mdl-js-progress mdl-progress__indeterminate&quot;&gt;&lt;/div&gt;&lt;pre&gt;`&amp;lt;!-- MDL Progress Bar with Indeterminate Progress --&amp;gt;&amp;lt;div id=&quot;p2&quot; class=&quot;mdl-progress mdl-js-progress mdl-progress__indeterminate&quot;&amp;gt;&amp;lt;/div&amp;gt;`&lt;/pre&gt;### Buffering Progress Bar&lt;pre&gt;`    &amp;lt;!-- MDL Progress Bar with Buffering --&amp;gt;    &amp;lt;div class=&quot;mdl-progress mdl-js-progress&quot; id=&quot;p1&quot;&amp;gt;&amp;lt;/div&amp;gt;    &amp;lt;script&amp;gt;        document.querySelector(&#39;#p1&#39;).addEventListener(&#39;mdl-componentupgraded&#39;, function()&#123;            this.MaterialProgress.setProgress(33);            this.MaterialProgress.setBuffer(66);        &#125;)    &amp;lt;/script&amp;gt;`&lt;/pre&gt;### Default Spinner&lt;div class=&quot;mdl-spinner mdl-js-spinner is-active&quot;&gt;&lt;/div&gt;&lt;pre&gt;`&amp;lt;div class=&quot;mdl-spinner mdl-js-spinner is-active&quot;&amp;gt;&amp;lt;/div&amp;gt;`&lt;/pre&gt;### Single Color Spinner&lt;div class=&quot;mdl-spinner mdl-spinner--single-color mdl-js-spinner is-active&quot;&gt;&lt;/div&gt;&lt;pre&gt;`&amp;lt;div class=&quot;mdl-spinner mdl-spinner--single-color mdl-js-spinner is-active&quot;&amp;gt;&amp;lt;/div&amp;gt;</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> Material Design </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MDL-List</title>
      <link href="/2016/05/26/mdl-list/"/>
      <url>/2016/05/26/mdl-list/</url>
      
        <content type="html"><![CDATA[<head>    <meta charset="UTF-8">    <title>Document</title>    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"><link rel="stylesheet" href="https://code.getmdl.io/1.1.3/material.indigo-pink.min.css"><script defer src="https://code.getmdl.io/1.1.3/material.min.js"></script></head><h3 id="Simple-List"><a href="#Simple-List" class="headerlink" title="Simple List"></a>Simple List</h3><!-- Simple List --><ul><li><p><span class="mdl-list__item-primary-content">Content 1</span></p></li><li><p><span class="mdl-list__item-primary-content">Content 2</span></p></li><li><p><span class="mdl-list__item-primary-content">Content 3</span></p></li><li><p><span class="mdl-list__item-primary-content">Content 4</span></p></li><li><p><span class="mdl-list__item-primary-content">Content 5</span></p><p>&lt;!– Simple List –&gt;<br>&lt;ul class=”mdl-list”&gt;<br>&lt;li class=”mdl-list_item”&gt;&lt;span class=”mdl-list<strong>item-primary-content”&gt;Content 1&lt;/span&gt;&lt;/li&gt;<br>&lt;li class=”mdl-list_item”&gt;&lt;span class=”mdl-list</strong>item-primary-content”&gt;Content 2&lt;/span&gt;&lt;/li&gt;<br>&lt;li class=”mdl-list_item”&gt;&lt;span class=”mdl-list<strong>item-primary-content”&gt;Content 3&lt;/span&gt;&lt;/li&gt;<br>&lt;li class=”mdl-list_item”&gt;&lt;span class=”mdl-list</strong>item-primary-content”&gt;Content 4&lt;/span&gt;&lt;/li&gt;<br>&lt;li class=”mdl-list_item”&gt;&lt;span class=”mdl-list__item-primary-content”&gt;Content 5&lt;/span&gt;&lt;/li&gt;<br>&lt;/ul&gt;<br>`</pre></p><h3 id="Icon-List"><a href="#Icon-List" class="headerlink" title="Icon List"></a>Icon List</h3><!-- Icon List --></li><li><span class="mdl-list__item-primary-content">            _1_            Content 1        </span></li><li><span class="mdl-list__item-primary-content">            _2_            Content 2        </span></li><li><span class="mdl-list__item-primary-content">            _3_            Content 3        </span></li><li><span class="mdl-list__item-primary-content">            _4_            Content 4        </span></li><li><span class="mdl-list__item-primary-content">            _5_            Content 5        </span><pre>`&lt;!-- Icon List --&gt;&lt;ul class="mdl-list"&gt;    &lt;li class="mdl-list__item"&gt;        &lt;span class="mdl-list__item-primary-content"&gt;            &lt;i class="material-icons mdl-list__item-icon"&gt;1&lt;/i&gt;            &lt;p&gt;Content 1&lt;/p&gt;        &lt;/span&gt;&lt;/li&gt;    &lt;li class="mdl-list__item"&gt;        &lt;span class="mdl-list__item-primary-content"&gt;            &lt;i class="material-icons mdl-list__item-icon"&gt;2&lt;/i&gt;            &lt;p&gt;Content 2&lt;/p&gt;        &lt;/span&gt;&lt;/li&gt;    &lt;li class="mdl-list__item"&gt;        &lt;span class="mdl-list__item-primary-content"&gt;            &lt;i class="material-icons mdl-list__item-icon"&gt;3&lt;/i&gt;            &lt;p&gt;Content 3&lt;/p&gt;        &lt;/span&gt;&lt;/li&gt;    &lt;li class="mdl-list__item"&gt;        &lt;span class="mdl-list__item-primary-content"&gt;            &lt;i class="material-icons mdl-list__item-icon"&gt;4&lt;/i&gt;            &lt;p&gt;Content 4&lt;/p&gt;        &lt;/span&gt;&lt;/li&gt;    &lt;li class="mdl-list__item"&gt;        &lt;span class="mdl-list__item-primary-content"&gt;            &lt;i class="material-icons mdl-list__item-icon"&gt;5&lt;/i&gt;            &lt;p&gt;Content 5&lt;/p&gt;        &lt;/span&gt;&lt;/li&gt;&lt;/ul&gt;`</pre><h3 id="Avatars-and-Actions"><a href="#Avatars-and-Actions" class="headerlink" title="Avatars and Actions"></a>Avatars and Actions</h3><!-- List Item with Avatar and Action --></li><li><span class="mdl-list__item-primary-content">            _A1_            <span>content 1</span>            [Star]()        </span></li><li><span class="mdl-list__item-primary-content">            _A2_            <span>content 2</span>            [Star]()        </span></li><li><span class="mdl-list__item-primary-content">            _A3_            <span>content 3</span>            [Star]()        </span><pre>`&lt;!-- List Item with Avatar and Action --&gt;&lt;ul class="mdl-list"&gt;    &lt;li class="mdl-list__item"&gt;        &lt;span class="mdl-list__item-primary-content"&gt;            &lt;i class="material-icons mdl-list__item-avatar"&gt;A1&lt;/i&gt;            &lt;span&gt;content 1&lt;/span&gt;            &lt;a href="" class="mdl-list_item-secondary-action"&gt;Star&lt;/a&gt;        &lt;/span&gt;&lt;/li&gt;    &lt;li class="mdl-list__item"&gt;        &lt;span class="mdl-list__item-primary-content"&gt;            &lt;i class="material-icons mdl-list__item-avatar"&gt;A2&lt;/i&gt;            &lt;span&gt;content 2&lt;/span&gt;            &lt;a href="" class="mdl-list_item-secondary-action"&gt;Star&lt;/a&gt;        &lt;/span&gt;&lt;/li&gt;    &lt;li class="mdl-list__item"&gt;        &lt;span class="mdl-list__item-primary-content"&gt;            &lt;i class="material-icons mdl-list__item-avatar"&gt;A3&lt;/i&gt;            &lt;span&gt;content 3&lt;/span&gt;            &lt;a href="" class="mdl-list_item-secondary-action"&gt;Star&lt;/a&gt;        &lt;/span&gt;&lt;/li&gt;&lt;/ul&gt;`</pre><h3 id="Avatars-and-Controls"><a href="#Avatars-and-Controls" class="headerlink" title="Avatars and Controls"></a>Avatars and Controls</h3><!-- List with Avatar and Controls --></li><li><span class="mdl-list__item-primary-content">                _C_            Checkbox            </span>            <span class="mdl-list__item-secondary-action">                <label for="list-checkbox-1" class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect">                    <input type="checkbox" class="mdl-checkbox__input" checked id="list-checkbox-1">                </label>            </span></li><li><span class="mdl-list__item-primary-content">                _R_                Radio            </span>            <span class="mdl-list__item-secondary-action">                <label for="list-option-1" class="mdl-radio mdl-js-radio mdl-js-ripple-effect">                    <input type="radio" class="mdl-radio__button" id="list-option-1" name="options" value="1" checked="">                </label>            </span></li><li><span class="mdl-list__item-primary-content">                _S_                Switch            </span>            <span class="mdl-list__item-secondary-action">                <label for="list-switch-1" class="mdl-switch mdl-js-switch mdl-js-ripple-effect"><input type="checkbox" checked class="mdl-switch__input" id="list-switch-1"></label>            </span><pre>`    &lt;!-- List with Avatar and Controls --&gt;    &lt;ul class="mdl-list"&gt;        &lt;li class="mdl-list__item"&gt;            &lt;span class="mdl-list__item-primary-content"&gt;                &lt;i class="material-icons mdl-list__item-avatar"&gt;C&lt;/i&gt;            Checkbox            &lt;/span&gt;            &lt;span class="mdl-list__item-secondary-action"&gt;                &lt;label for="list-checkbox-1" class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect"&gt;                    &lt;input type="checkbox" class="mdl-checkbox__input" checked id="list-checkbox-1"&gt;                &lt;/label&gt;            &lt;/span&gt;        &lt;/li&gt;        &lt;li class="mdl-list__item"&gt;            &lt;span class="mdl-list__item-primary-content"&gt;                &lt;i class="material-icons mdl-list__item-avatar"&gt;R&lt;/i&gt;                Radio            &lt;/span&gt;            &lt;span class="mdl-list__item-secondary-action"&gt;                &lt;label for="list-option-1" class="mdl-radio mdl-js-radio mdl-js-ripple-effect"&gt;                    &lt;input type="radio" class="mdl-radio__button" id="list-option-1" name="options" value="1" checked=""&gt;                &lt;/label&gt;            &lt;/span&gt;        &lt;/li&gt;        &lt;li class="mdl-list__item"&gt;            &lt;span class="mdl-list__item-primary-content"&gt;                &lt;i class="material-icons mdl-list__item-avatar"&gt;S&lt;/i&gt;                Switch            &lt;/span&gt;            &lt;span class="mdl-list__item-secondary-action"&gt;                &lt;label for="list-switch-1" class="mdl-switch mdl-js-switch mdl-js-ripple-effect"&gt;&lt;input type="checkbox" checked class="mdl-switch__input" id="list-switch-1"&gt;&lt;/label&gt;            &lt;/span&gt;        &lt;/li&gt;    &lt;/ul&gt;`</pre><h3 id="List-of-Multi-line"><a href="#List-of-Multi-line" class="headerlink" title="List of Multi-line"></a>List of Multi-line</h3><!-- Two Line List with Secondary Info and Action --></li><li><span class="mdl-list__item-primary-content">                _1_                <span>Content</span>                <span class="mdl-list__item-sub-title">Subtitle</span>            </span>            <span class="mdl-list__item-secondary-content">                <span class="mdl-list__item-secondary-info">Actor</span>                [                    _Star_                ](#)            </span><pre><code>    &lt;!-- List with Text Body --&gt;*   &lt;span class=&quot;mdl-list__item-primary-content&quot;&gt;            _2_            &lt;span&gt;Content&lt;/span&gt;            &lt;span class=&quot;mdl-list__item-text-body&quot;&gt;                Lorem ipsum dolor sit amet, consectetur adipisicing elit. Laboriosam dolor asperiores totam accusantium quaerat sint nam illum ad praesentium et, reiciendis vel doloremque ex minima ipsam sit dignissimos facilis excepturi.            &lt;/span&gt;        &lt;/span&gt;        &lt;span class=&quot;mdl-list__item-secondary-content&quot;&gt;            [                _Star_            ](#)        &lt;/span&gt;</code></pre><pre>`&lt;!-- Two Line List with Secondary Info and Action --&gt;    &lt;ul class="mdl-list"&gt;        &lt;li class="mdl-list__item mdl-list__item--two-line"&gt;            &lt;span class="mdl-list__item-primary-content"&gt;                &lt;i class="material-icons mdl-list__item-avatar"&gt;1&lt;/i&gt;                &lt;span&gt;Content&lt;/span&gt;                &lt;span class="mdl-list__item-sub-title"&gt;Subtitle&lt;/span&gt;            &lt;/span&gt;            &lt;span class="mdl-list__item-secondary-content"&gt;                &lt;span class="mdl-list__item-secondary-info"&gt;Actor&lt;/span&gt;                &lt;a href="#" class="mdl-list__item-secondary-action"&gt;                    &lt;i class="material-icons"&gt;Star&lt;/i&gt;                &lt;/a&gt;            &lt;/span&gt;        &lt;/li&gt;        &lt;!-- List with Text Body --&gt;        &lt;li class="mdl-list__item mdl-list__item--three-line"&gt;            &lt;span class="mdl-list__item-primary-content"&gt;                &lt;i class="material-icons mdl-list__item-avatar"&gt;2&lt;/i&gt;                &lt;span&gt;Content&lt;/span&gt;                &lt;span class="mdl-list__item-text-body"&gt;                    Lorem ipsum dolor sit amet, consectetur adipisicing elit. Laboriosam dolor asperiores totam accusantium quaerat sint nam illum ad praesentium et, reiciendis vel doloremque ex minima ipsam sit dignissimos facilis excepturi.                &lt;/span&gt;            &lt;/span&gt;            &lt;span class="mdl-list__item-secondary-content"&gt;                &lt;a href="#" class="mdl-list__item-secondary-action"&gt;                    &lt;i class="material-icons"&gt;Star&lt;/i&gt;                &lt;/a&gt;            &lt;/span&gt;        &lt;/li&gt;    &lt;/ul&gt;</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Material Design </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MDL-Navigation</title>
      <link href="/2016/05/26/mdl-navigation/"/>
      <url>/2016/05/26/mdl-navigation/</url>
      
        <content type="html"><![CDATA[<h3 id="Transparent-Navigation"><a href="#Transparent-Navigation" class="headerlink" title="Transparent Navigation"></a>Transparent Navigation</h3><p><img src="http://7xu8mu.com1.z0.glb.clouddn.com/wp-content/uploads/Transparent%20Navigation.png" alt="Transparent Navigation"></p><pre><code>.demo-layout-transparent&#123;        background: url(&#39;https://getmdl.io/assets/demos/transparent.jpg&#39;) center/cover;    &#125;&amp;lt;/style&amp;gt;&amp;lt;/head&amp;gt;&amp;lt;/body&amp;gt;    &amp;lt;div class=&quot;demo-layout-transparent mdl-layout mdl-js-layout&quot;&amp;gt;        &amp;lt;header class=&quot;mdl-layout__header mdl-layout__header--transparent&quot;&amp;gt;            &amp;lt;div class=&quot;mdl-layout__header-row&quot;&amp;gt;                &amp;lt;!--Title--&amp;gt;                &amp;lt;span class=&quot;mdl-layout-title&quot;&amp;gt;Title&amp;lt;/span&amp;gt;                &amp;lt;!--Add spacer, to align navigation to the right--&amp;gt;                &amp;lt;div class=&quot;mdl-layout-spacer&quot;&amp;gt;&amp;lt;/div&amp;gt;                &amp;lt;!--Navigation--&amp;gt;                &amp;lt;nav class=&quot;mdl-navigation&quot;&amp;gt;                    &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                    &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                    &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                    &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                &amp;lt;/nav&amp;gt;            &amp;lt;/div&amp;gt;        &amp;lt;/header&amp;gt;        &amp;lt;div class=&quot;mdl-layout__drawer&quot;&amp;gt;            &amp;lt;span class=&quot;mdl-layout-title&quot;&amp;gt;Title&amp;lt;/span&amp;gt;            &amp;lt;nav class=&quot;mdl-navigation&quot;&amp;gt;                &amp;lt;nav class=&quot;mdl-navigation__link&quot; href=&quot;#&quot;&amp;gt;Link&amp;lt;/nav&amp;gt;            &amp;lt;nav class=&quot;mdl-navigation__link&quot; href=&quot;#&quot;&amp;gt;Link&amp;lt;/nav&amp;gt;            &amp;lt;nav class=&quot;mdl-navigation__link&quot; href=&quot;#&quot;&amp;gt;Link&amp;lt;/nav&amp;gt;            &amp;lt;nav class=&quot;mdl-navigation__link&quot; href=&quot;#&quot;&amp;gt;Link&amp;lt;/nav&amp;gt;            &amp;lt;/nav&amp;gt;        &amp;lt;/div&amp;gt;    &amp;lt;/div&amp;gt;`&lt;/pre&gt;### Fixed Drawer without Header(The drawer will open automatically in large screen)![Fixed Drawer](http://7xu8mu.com1.z0.glb.clouddn.com/wp-content/uploads/FixedDrawer1.png)&lt;pre&gt;`    &amp;lt;div class=&quot;mdl-layout mdl-js-layout mdl-layout--fixed-drawer&quot;&amp;gt;        &amp;lt;div class=&quot;mdl-layout__drawer&quot;&amp;gt;            &amp;lt;span class=&quot;mdl-layout-title&quot;&amp;gt;Title&amp;lt;/span&amp;gt;            &amp;lt;nav class=&quot;mdl-navigation&quot;&amp;gt;                &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;            &amp;lt;/nav&amp;gt;        &amp;lt;/div&amp;gt;    &amp;lt;/div&amp;gt;`&lt;/pre&gt;### Fixed Header(The Header shows always, even in small screen)![Fixed Header](http://7xu8mu.com1.z0.glb.clouddn.com/wp-content/uploads/FixedHeader.png)&lt;pre&gt;`    &amp;lt;div class=&quot;mdl-layout mdl-js-layout mdl-layout--fixed-header&quot;&amp;gt;        &amp;lt;header class=&quot;mdl-layout__header&quot;&amp;gt;            &amp;lt;div class=&quot;mdl-layout__header-row&quot;&amp;gt;                &amp;lt;span class=&quot;mdl-layout-title&quot;&amp;gt;Title&amp;lt;/span&amp;gt;                &amp;lt;div class=&quot;mdl-layout-spacer&quot;&amp;gt;&amp;lt;/div&amp;gt;                &amp;lt;nav class=&quot;mdl-navigation mdl-navigation--large-screen-only&quot;&amp;gt;                    &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                    &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                    &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                &amp;lt;/nav&amp;gt;            &amp;lt;/div&amp;gt;        &amp;lt;/header&amp;gt;        &amp;lt;div class=&quot;mdl-layout__drawer&quot;&amp;gt;            &amp;lt;span class=&quot;mdl-layout-title&quot;&amp;gt;                Title            &amp;lt;/span&amp;gt;            &amp;lt;nav class=&quot;mdl-navigation&quot;&amp;gt;                &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;            &amp;lt;/nav&amp;gt;        &amp;lt;/div&amp;gt;    &amp;lt;/div&amp;gt;`&lt;/pre&gt;### Fixed Header and Drawer![Fixed Header and Drawer](http://7xu8mu.com1.z0.glb.clouddn.com/wp-content/uploads/FixedHeader&amp;Drawer.png)&lt;pre&gt;`&amp;lt;div class=&quot;mdl-layout mdl-js-layout mdl-layout--fixed-drawer mdl-layout--fixed-header&quot;&amp;gt;        &amp;lt;header class=&quot;mdl-layout__header&quot;&amp;gt;            &amp;lt;div class=&quot;mdl-layout__header-row&quot;&amp;gt;                &amp;lt;div class=&quot;mdl-layout-spacer&quot;&amp;gt;&amp;lt;/div&amp;gt;                &amp;lt;div class=&quot;mdl-textfield mdl-js-textfield mdl-textfield--expandable mdl-textfield--floating-label mdl-text--align-right&quot;&amp;gt;                    &amp;lt;label for=&quot;fixed-header-drawer-exp&quot; class=&quot;mdl-button mdl-js-button mdl-button--icon&quot;&amp;gt;S&amp;lt;/label&amp;gt;                    &amp;lt;div class=&quot;mdl-textfield__expandable-holder&quot;&amp;gt;                        &amp;lt;input type=&quot;text&quot; class=&quot;mdl-textfield__input&quot; name=&quot;sample&quot; id=&quot;fixed-header-drawer-exp&quot;&amp;gt;                    &amp;lt;/div&amp;gt;                &amp;lt;/div&amp;gt;            &amp;lt;/div&amp;gt;        &amp;lt;/header&amp;gt;        &amp;lt;div class=&quot;mdl-layout__drawer&quot;&amp;gt;            &amp;lt;span class=&quot;mdl-layout-title&quot;&amp;gt;Title&amp;lt;/span&amp;gt;            &amp;lt;nav class=&quot;mdl-navigation&quot;&amp;gt;                &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;            &amp;lt;/nav&amp;gt;        &amp;lt;/div&amp;gt;    &amp;lt;/div&amp;gt;`&lt;/pre&gt;### Scrolling Header&lt;pre&gt;`&amp;lt;div class=&quot;mdl-layout mdl-js-layout&quot;&amp;gt;        &amp;lt;header class=&quot;mdl-layout__header mdl-layout__header--scroll&quot;&amp;gt;            &amp;lt;div class=&quot;mdl-layout__header-row&quot;&amp;gt;                &amp;lt;span class=&quot;mdl-layout-title&quot;&amp;gt;Title&amp;lt;/span&amp;gt;            &amp;lt;/div&amp;gt;            &amp;lt;div class=&quot;mdl-layout-spacer&quot;&amp;gt;&amp;lt;/div&amp;gt;            &amp;lt;nav class=&quot;mdl-navigation&quot;&amp;gt;                &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;            &amp;lt;/nav&amp;gt;        &amp;lt;/header&amp;gt;        &amp;lt;div class=&quot;mdl-layout__drawer&quot;&amp;gt;            &amp;lt;span class=&quot;mdl-layout-title&quot;&amp;gt;Title&amp;lt;/span&amp;gt;            &amp;lt;nav class=&quot;mdl-navigation&quot;&amp;gt;                &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;            &amp;lt;/nav&amp;gt;        &amp;lt;/div&amp;gt;    &amp;lt;/div&amp;gt;`&lt;/pre&gt;### Waterfall Header&lt;pre&gt;`    &amp;lt;div class=&quot;demo-layout-water mdl-layout mdl-js-layout&quot;&amp;gt;        &amp;lt;header class=&quot;mdl-layout__header mdl-layout--water&quot;&amp;gt;            &amp;lt;!-- Top Row Always Visible --&amp;gt;            &amp;lt;div class=&quot;mdl-layout__header-row&quot;&amp;gt;                &amp;lt;!-- Title --&amp;gt;                &amp;lt;span class=&quot;mdl-layout-title&quot;&amp;gt;Title&amp;lt;/span&amp;gt;                &amp;lt;div class=&quot;mdl-layout-spacer&quot;&amp;gt;&amp;lt;/div&amp;gt;                &amp;lt;div class=&quot;mdl-textfield mdl-js-textfield mdl-textfield--expandable mdl-textfield--floating-label mdl-textfield--align-right&quot;&amp;gt;                    &amp;lt;label for=&quot;waterfall-exp&quot; class=&quot;mdl-button mdl-js-button mdl-button--icon&quot;&amp;gt;                        &amp;lt;i class=&quot;material-icons&quot;&amp;gt;Search&amp;lt;/i&amp;gt;                    &amp;lt;/label&amp;gt;                    &amp;lt;div class=&quot;mdl-textfield__expandable-holder&quot;&amp;gt;                        &amp;lt;input type=&quot;text&quot; name=&quot;sample&quot; id=&quot;waterfall-exp&quot; class=&quot;mdl-textfield__input&quot;&amp;gt;                    &amp;lt;/div&amp;gt;                &amp;lt;/div&amp;gt;            &amp;lt;/div&amp;gt;            &amp;lt;!-- Bottom Row, Invisible on Scroll --&amp;gt;            &amp;lt;div class=&quot;mdl-layout__header-row&quot;&amp;gt;                &amp;lt;div class=&quot;mdl-layout-spacer&quot;&amp;gt;&amp;lt;/div&amp;gt;                &amp;lt;nav class=&quot;mdl-navigation&quot;&amp;gt;                    &amp;lt;a href=&quot;&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                    &amp;lt;a href=&quot;&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                    &amp;lt;a href=&quot;&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                    &amp;lt;a href=&quot;&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                    &amp;lt;a href=&quot;&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                &amp;lt;/nav&amp;gt;            &amp;lt;/div&amp;gt;        &amp;lt;/header&amp;gt;        &amp;lt;div class=&quot;mdl-layout__drawer&quot;&amp;gt;            &amp;lt;span class=&quot;mdl-layout-title&quot;&amp;gt;Title&amp;lt;/span&amp;gt;            &amp;lt;nav class=&quot;mdl-navigation&quot;&amp;gt;                &amp;lt;a href=&quot;&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                &amp;lt;a href=&quot;&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                &amp;lt;a href=&quot;&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                &amp;lt;a href=&quot;&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                &amp;lt;a href=&quot;&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;            &amp;lt;/nav&amp;gt;        &amp;lt;/div&amp;gt;    &amp;lt;/div&amp;gt;`&lt;/pre&gt;### Scrollable Tabs&lt;pre&gt;`&amp;lt;div class=&quot;mdl-layout mdl-js-layout mdl-layout--fixed-header&quot;&amp;gt;    &amp;lt;header class=&quot;mdl-layout__header&quot;&amp;gt;        &amp;lt;div class=&quot;mdl-layout__header-row&quot;&amp;gt;            &amp;lt;span class=&quot;mdl-layout-title&quot;&amp;gt;Title&amp;lt;/span&amp;gt;        &amp;lt;/div&amp;gt;        &amp;lt;!-- Tab --&amp;gt;        &amp;lt;div class=&quot;mdl-layout__tab-bar mdl-js-ripple-effect&quot;&amp;gt;            &amp;lt;a href=&quot;#scroll-tab-1&quot; class=&quot;mdl-layout__tab is-active&quot;&amp;gt;Tab 1&amp;lt;/a&amp;gt;            &amp;lt;a href=&quot;#scroll-tab-2&quot; class=&quot;mdl-layout__tab&quot;&amp;gt;Tab 2&amp;lt;/a&amp;gt;            &amp;lt;a href=&quot;#scroll-tab-3&quot; class=&quot;mdl-layout__tab&quot;&amp;gt;Tab 3&amp;lt;/a&amp;gt;            &amp;lt;a href=&quot;#scroll-tab-4&quot; class=&quot;mdl-layout__tab&quot;&amp;gt;Tab 4&amp;lt;/a&amp;gt;            &amp;lt;a href=&quot;#scroll-tab-5&quot; class=&quot;mdl-layout__tab&quot;&amp;gt;Tab 5&amp;lt;/a&amp;gt;        &amp;lt;/div&amp;gt;    &amp;lt;/header&amp;gt;    &amp;lt;div class=&quot;mdl-layout__drawer&quot;&amp;gt;        &amp;lt;span class=&quot;mdl-layout-title&quot;&amp;gt;Title&amp;lt;/span&amp;gt;    &amp;lt;/div&amp;gt;    &amp;lt;main class=&quot;mdl-layout__content&quot;&amp;gt;        &amp;lt;section class=&quot;mdl-layout__tab-panel is-active&quot; id=&quot;scroll-tab-1&quot;&amp;gt;            &amp;lt;div class=&quot;page-content&quot; style=&quot;height:500px&quot;&amp;gt;Tab 1&amp;lt;/div&amp;gt;        &amp;lt;/section&amp;gt;        &amp;lt;section class=&quot;mdl-layout__tab-panel&quot; id=&quot;scroll-tab-2&quot;&amp;gt;            &amp;lt;div class=&quot;page-content&quot; style=&quot;height:500px&quot;&amp;gt;Tab 2&amp;lt;/div&amp;gt;        &amp;lt;/section&amp;gt;        &amp;lt;section class=&quot;mdl-layout__tab-panel&quot; id=&quot;scroll-tab-3&quot;&amp;gt;            &amp;lt;div class=&quot;page-content&quot; style=&quot;height:500px&quot;&amp;gt;Tab 3&amp;lt;/div&amp;gt;        &amp;lt;/section&amp;gt;        &amp;lt;section class=&quot;mdl-layout__tab-panel&quot; id=&quot;scroll-tab-4&quot;&amp;gt;            &amp;lt;div class=&quot;page-content&quot; style=&quot;height:500px&quot;&amp;gt;Tab 4&amp;lt;/div&amp;gt;        &amp;lt;/section&amp;gt;        &amp;lt;section class=&quot;mdl-layout__tab-panel&quot; id=&quot;scroll-tab-5&quot;&amp;gt;            &amp;lt;div class=&quot;page-content&quot; style=&quot;height:500px&quot;&amp;gt;Tab 5&amp;lt;/div&amp;gt;        &amp;lt;/section&amp;gt;    &amp;lt;/main&amp;gt;&amp;lt;/div&amp;gt;`&lt;/pre&gt;### Fixed Tabs&lt;pre&gt;`&amp;lt;div class=&quot;mdl-layout mdl-js-layout mdl-layout--fixed-header mdl-layout--fixed-tabs&quot;&amp;gt;    &amp;lt;header class=&quot;mdl-layout__header&quot;&amp;gt;        &amp;lt;div class=&quot;mdl-layout__header-row&quot;&amp;gt;            &amp;lt;span class=&quot;mdl-layout-title&quot;&amp;gt;Title&amp;lt;/span&amp;gt;        &amp;lt;/div&amp;gt;        &amp;lt;div class=&quot;mdl-layout__tab-bar mdl-js-ripple-effect&quot;&amp;gt;            &amp;lt;a href=&quot;#fixed-tab-1&quot; class=&quot;mdl-layout__tab is-active&quot;&amp;gt;Tab 1&amp;lt;/a&amp;gt;            &amp;lt;a href=&quot;#fixed-tab-2&quot; class=&quot;mdl-layout__tab&quot;&amp;gt;Tab 2&amp;lt;/a&amp;gt;            &amp;lt;a href=&quot;#fixed-tab-3&quot; class=&quot;mdl-layout__tab&quot;&amp;gt;Tab 3&amp;lt;/a&amp;gt;        &amp;lt;/div&amp;gt;    &amp;lt;/header&amp;gt;    &amp;lt;div class=&quot;mdl-layout__drawer&quot;&amp;gt;        &amp;lt;span class=&quot;mdl-layout-title&quot;&amp;gt;Title&amp;lt;/span&amp;gt;    &amp;lt;/div&amp;gt;    &amp;lt;main class=&quot;mdl-layout__content&quot;&amp;gt;        &amp;lt;section class=&quot;mdl-layout__tab-panel&quot; id=&quot;fixed-tab-1&quot;&amp;gt;            &amp;lt;div class=&quot;page-content&quot; style=&quot;height:500px&quot;&amp;gt;Tab 1&amp;lt;/div&amp;gt;        &amp;lt;/section&amp;gt;        &amp;lt;section class=&quot;mdl-layout__tab-panel&quot; id=&quot;fixed-tab-2&quot;&amp;gt;            &amp;lt;div class=&quot;page-content&quot; style=&quot;height:500px&quot;&amp;gt;Tab 2&amp;lt;/div&amp;gt;        &amp;lt;/section&amp;gt;        &amp;lt;section class=&quot;mdl-layout__tab-panel&quot; id=&quot;fixed-tab-3&quot;&amp;gt;            &amp;lt;div class=&quot;page-content&quot; style=&quot;height:500px&quot;&amp;gt;Tab 3&amp;lt;/div&amp;gt;        &amp;lt;/section&amp;gt;    &amp;lt;/main&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> Material Design </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MDL-Card</title>
      <link href="/2016/05/25/mdl-card/"/>
      <url>/2016/05/25/mdl-card/</url>
      
        <content type="html"><![CDATA[<h3 id="Wide-Card"><a href="#Wide-Card" class="headerlink" title="Wide Card"></a>Wide Card</h3><p><img src="http://7xu8mu.com1.z0.glb.clouddn.com/wp-content/uploads/Card-Wide.png" alt="Wide Card"></p><pre><code>    &amp;lt;style&amp;gt;        .demo-card-wide.mdl-card&#123;            width:512px        &#125;        .demo-card-wide&amp;gt;.mdl-card__title&#123;            color: #fff;            height: 176px;            background: url(&quot;https://getmdl.io/assets/demos/welcome_card.jpg&quot;) center/cover;        &#125;    &amp;lt;/style&amp;gt;&amp;lt;/head&amp;gt;&amp;lt;body&amp;gt;    &amp;lt;div class=&quot;demo-card-wide mdl-card mdl-shadow--2dp&quot;&amp;gt;        &amp;lt;div class=&quot;mdl-card__title&quot;&amp;gt;            &amp;lt;h2 class=&quot;mdl-card__title-text&quot;&amp;gt;TItle&amp;lt;/h2&amp;gt;        &amp;lt;/div&amp;gt;        &amp;lt;div class=&quot;mdl-card__supporting-text&quot;&amp;gt;            Supporting Text; Supporting Text; Supporting Text; Supporting Text; Supporting Text; Supporting Text; Supporting Text; Supporting Text; Supporting Text; Supporting Text; Supporting Text;        &amp;lt;/div&amp;gt;        &amp;lt;div class=&quot;mdl-card__actions mdl-card--border&quot;&amp;gt;            &amp;lt;a href=&quot;#&quot; class=&quot;mdl-button mdl-js-button mdl-js-ripple-effect&quot;&amp;gt;Get Start&amp;lt;/a&amp;gt;        &amp;lt;/div&amp;gt;        &amp;lt;div class=&quot;mdl-card__menu&quot;&amp;gt;            &amp;lt;button class=&quot;mdl-button mdl-js-button mdl-js-ripple-effect&quot;&amp;gt;Share&amp;lt;/button&amp;gt;        &amp;lt;/div&amp;gt;    &amp;lt;/div&amp;gt;&amp;lt;/body&amp;gt;`&lt;/pre&gt;### Square Card![Square Card](http://7xu8mu.com1.z0.glb.clouddn.com/wp-content/uploads/squareCard.png)&lt;pre&gt;`&amp;lt;style&amp;gt;    .demo-card-square.mdl-card&#123;        width:320px;        height: 320px;    &#125;    .demo-card-square&amp;gt;.mdl-card__title&#123;        color: #fff;  background:    url(&#39;https://getmdl.io/assets/demos/dog.png&#39;) bottom right 15% no-repeat #46B6AC;    &#125;&amp;lt;/style&amp;gt;&amp;lt;/head&amp;gt;&amp;lt;/body&amp;gt;&amp;lt;div class=&quot;demo-card-square mdl-card mdl-shadow--2dp&quot;&amp;gt;    &amp;lt;div class=&quot;mdl-card__title mdl-card--expand&quot;&amp;gt;        &amp;lt;h2 class=&quot;mdl-card__title-text&quot;&amp;gt;            Square Card        &amp;lt;/h2&amp;gt;    &amp;lt;/div&amp;gt;    &amp;lt;div class=&quot;mdl-card__supporting-text&quot;&amp;gt;        Supporting Text; Supporting Text; Supporting Text; Supporting Text; Supporting Text; Supporting Text; Supporting Text; Supporting Text; Supporting Text; Supporting Text; Supporting Text;    &amp;lt;/div&amp;gt;    &amp;lt;div class=&quot;mdl-card__actions mdl-card--border&quot;&amp;gt;        &amp;lt;a href=&quot;&quot; class=&quot;mdl-button mdl-js-button mdl-js-ripple-effect&quot;&amp;gt;View Update&amp;lt;/a&amp;gt;    &amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/body&amp;gt;`&lt;/pre&gt;### Image Card![Image Card](http://7xu8mu.com1.z0.glb.clouddn.com/wp-content/uploads/ImageCard.png)&lt;pre&gt;`&amp;lt;style&amp;gt;    .demo-card-image.mdl-card&#123;        width: 256px;        height: 256px;        background: url(&#39;https://getmdl.io/assets/demos/image_card.jpg&#39;) center/cover;    &#125;    .demo-card-image&amp;gt;.mdl-card__actions&#123;        height: 52px;        padding:16px;        background: rgba(0,0,0,0.2);    &#125;    .demo-card-image__filename&#123;        color: #fff;        font-size: 14px;        font-weight: 500;    &#125;&amp;lt;/style&amp;gt;&amp;lt;/head&amp;gt;&amp;lt;/body&amp;gt;&amp;lt;div class=&quot;demo-card-image mdl-card mdl-shadow--2dp&quot;&amp;gt;    &amp;lt;div class=&quot;mdl-cart__title mdl-card--expand&quot;&amp;gt;&amp;lt;/div&amp;gt;    &amp;lt;div class=&quot;mdl-card__actions&quot;&amp;gt;        &amp;lt;span class=&quot;demo-card-image__filename&quot;&amp;gt;Image Filename&amp;lt;/span&amp;gt;    &amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/body&amp;gt;`&lt;/pre&gt;### Event Card![Event Card](http://7xu8mu.com1.z0.glb.clouddn.com/wp-content/uploads/EventCard.png)&lt;pre&gt;`&amp;lt;style&amp;gt;    .demo-card-event.mdl-card&#123;        width: 256px;        height: 256px;        background: #3E4EB8;    &#125;    .demo-card-event&amp;gt;.mdl-card__actions&#123;        border-color: rgba(255,255,255,0.2);    &#125;    .demo-card-event&amp;gt;.mdl-card__title&#123;        align-items: flex-start;    &#125;    .demo-card-event&amp;gt;.mdl-card__title&amp;gt;h4&#123;        margin-top: 0;    &#125;    .demo-card-event&amp;gt;.mdl-card__actions&#123;        display: flex;        box-sizing: border-box;        align-items: center;    &#125;    .demo-card-event&amp;gt;.mdl-card__actions&amp;gt;.material-icons&#123;        padding-right: 10px;    &#125;    .demo-card-event&amp;gt;.mdl-card__title, .demo-card-event&amp;gt;.mdl-card__actions, .demo-card-event&amp;gt;.mdl-card__actions&amp;gt;.mdl-button&#123;        color:#fff;    &#125;&amp;lt;/style&amp;gt;&amp;lt;/head&amp;gt;&amp;lt;/body&amp;gt;    &amp;lt;div class=&quot;demo-card-event mdl-card mdl-shadow--2dp&quot;&amp;gt;        &amp;lt;div class=&quot;mdl-card__title mdl-card--expand&quot;&amp;gt;            &amp;lt;h4&amp;gt;                Featured event:&amp;lt;br&amp;gt;                May 24, 2016&amp;lt;br&amp;gt;                7 - 11pm            &amp;lt;/h4&amp;gt;        &amp;lt;/div&amp;gt;        &amp;lt;div class=&quot;mdl-card__actions mdl-card--border&quot;&amp;gt;            &amp;lt;a href=&quot;#&quot; class=&quot;mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect&quot;&amp;gt;                Add to Calendar            &amp;lt;/a&amp;gt;            &amp;lt;div class=&quot;mdl-layout-spacer&quot;&amp;gt;&amp;lt;/div&amp;gt;            &amp;lt;i class=&quot;material-icons&quot;&amp;gt;Evnet&amp;lt;/i&amp;gt;        &amp;lt;/div&amp;gt;    &amp;lt;/div&amp;gt;&amp;lt;/body&amp;gt;</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> Material Design </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MDL-Button</title>
      <link href="/2016/05/25/mdl-button/"/>
      <url>/2016/05/25/mdl-button/</url>
      
        <content type="html"><![CDATA[<html>  <head>    <!-- Material Design Lite -->    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">    <link rel="stylesheet" href="https://code.getmdl.io/1.1.3/material.indigo-pink.min.css">    <script defer src="https://code.getmdl.io/1.1.3/material.min.js"></script>  </head><pre><!-- Colored FAB Button -->  <button class="mdl-button mdl-js-button mdl-button--fab mdl-button--colored mdl-js-ripple-effect">Add</button>: class="mdl-button mdl-js-button mdl-button--fab mdl-button--colored mdl-js-ripple-effect", **"mdl-button--fab" adds the 3D circle, "mdl-button--colored" colors the 3D circle, "mdl-js-ripple-effect" adds ripple effect ont the button**  <!-- Raised Button -->  <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect">Button</button>: class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect", **"mdl-button--raised" adds the 3D Rectangle on the button.**  <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored">Button</button>: class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored", **"mdl-button--colored" add Primary color to Button.**  <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--accent">Button</button>: class="mdl-button mdl-js-button mdl-button--raised mdl-button--accent", **"mdl-button--accent" adds Accent color ont he Button.**  <button class="mdl-button mdl-js-button mdl-button--primary">Button</button>: class="mdl-button mdl-js-button mdl-button--primary", **"mdl-button--primary" adds primary color on the text.**  <button class="mdl-button mdl-js-button mdl-button--accent">Button</button>: class="mdl-button mdl-js-button mdl-button--accent", **"mdl-button--accent" adds accent color on the text**<!--   Mini FAB Button -->  <button class="mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab">i</button>: class="mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab", **"mdl-button--mini-fab" make a mini button"**    </pre><pre><code>&amp;lt;!-- Colored FAB Button --&amp;gt;  &amp;lt;button class=&quot;mdl-button mdl-js-button mdl-button--fab mdl-button--colored mdl-js-ripple-effect&quot;&amp;gt;Add&amp;lt;/button&amp;gt;: class=&quot;mdl-button mdl-js-button mdl-button--fab mdl-button--colored mdl-js-ripple-effect&quot;, &amp;lt;strong&amp;gt;&quot;mdl-button--fab&quot; adds the 3D circle, &quot;mdl-button--colored&quot; colors the 3D circle, &quot;mdl-js-ripple-effect&quot; adds ripple effect ont the button&amp;lt;/strong&amp;gt;&amp;lt;br&amp;gt;  &amp;lt;!-- Raised Button --&amp;gt;  &amp;lt;button class=&quot;mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect&quot;&amp;gt;Button&amp;lt;/button&amp;gt;: class=&quot;mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect&quot;, &amp;lt;strong&amp;gt;&quot;mdl-button--raised&quot; adds the 3D Rectangle on the button.&amp;lt;/strong&amp;gt;&amp;lt;br&amp;gt;  &amp;lt;button class=&quot;mdl-button mdl-js-button mdl-button--raised mdl-button--colored&quot;&amp;gt;Button&amp;lt;/button&amp;gt;: class=&quot;mdl-button mdl-js-button mdl-button--raised mdl-button--colored&quot;, &amp;lt;strong&amp;gt;&quot;mdl-button--colored&quot; add Primary color to Button.&amp;lt;/strong&amp;gt;&amp;lt;br&amp;gt;  &amp;lt;button class=&quot;mdl-button mdl-js-button mdl-button--raised mdl-button--accent&quot;&amp;gt;Button&amp;lt;/button&amp;gt;: class=&quot;mdl-button mdl-js-button mdl-button--raised mdl-button--accent&quot;, &amp;lt;strong&amp;gt;&quot;mdl-button--accent&quot; adds Accent color ont he Button.&amp;lt;/strong&amp;gt;&amp;lt;br&amp;gt;  &amp;lt;button class=&quot;mdl-button mdl-js-button mdl-button--primary&quot;&amp;gt;Button&amp;lt;/button&amp;gt;: class=&quot;mdl-button mdl-js-button mdl-button--primary&quot;, &amp;lt;strong&amp;gt;&quot;mdl-button--primary&quot; adds primary color on the text.&amp;lt;/strong&amp;gt;&amp;lt;br&amp;gt;  &amp;lt;button class=&quot;mdl-button mdl-js-button mdl-button--accent&quot;&amp;gt;Button&amp;lt;/button&amp;gt;: class=&quot;mdl-button mdl-js-button mdl-button--accent&quot;, &amp;lt;strong&amp;gt;&quot;mdl-button--accent&quot; adds accent color on the text&amp;lt;/strong&amp;gt;&amp;lt;br&amp;gt;&amp;lt;!--   Mini FAB Button --&amp;gt;  &amp;lt;button class=&quot;mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab&quot;&amp;gt;i&amp;lt;/button&amp;gt;: class=&quot;mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab&quot;, &amp;lt;strong&amp;gt;&quot;mdl-button--mini-fab&quot; make a mini button&quot;&amp;lt;/strong&amp;gt;&amp;lt;br&amp;gt;</code></pre></html>]]></content>
      
      
      
        <tags>
            
            <tag> Material Design </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MDL-Badge</title>
      <link href="/2016/05/24/mdl-badge/"/>
      <url>/2016/05/24/mdl-badge/</url>
      
        <content type="html"><![CDATA[<head>    <!-- Material Design Lite -->    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">    <link rel="stylesheet" href="https://code.getmdl.io/1.1.3/material.indigo-pink.min.css">    <script defer src="https://code.getmdl.io/1.1.3/material.min.js"></script>  </head><pre><!-- Number badge on icon --><div class="material-icons mdl-badge mdl-badge--overlap" data-badge="1">Badge</div>: class="material-icons mdl-badge mdl-badge--overlap"<span class="mdl-badge" data-badge="2">Badge</span>: class="mdl-badge", **the material-icons makes the text bigger, and mdl-badge--overlap makes badge overlap the text**[Badge](#): Badge in the inlink[Badge](#)<span class="mdl-badge" data-badge="4"></span>: Badge outside the link[Badge](#): Badge with too many characters(12345)[Badge](#): class="mdl-badge mdl-badge--no-background"</pre><pre><code>&amp;lt;!-- Number badge on icon --&amp;gt;&amp;lt;div class=&quot;material-icons mdl-badge mdl-badge--overlap&quot; data-badge=&quot;1&quot;&amp;gt;Badge&amp;lt;/div&amp;gt;: class=&quot;material-icons mdl-badge mdl-badge--overlap&quot;&amp;lt;br&amp;gt;&amp;lt;span class=&quot;mdl-badge&quot; data-badge=&quot;2&quot;&amp;gt;Badge&amp;lt;/span&amp;gt;: class=&quot;mdl-badge&quot;, &amp;lt;strong&amp;gt;the material-icons makes the text bigger, and mdl-badge--overlap makes badge overlap the text&amp;lt;/strong&amp;gt;&amp;lt;br&amp;gt;&amp;lt;a href=&quot;#&quot; class=&quot;mdl-badge&quot; data-badge=&quot;3&quot;&amp;gt;Badge&amp;lt;/a&amp;gt;: Badge in the inlink&amp;lt;br&amp;gt;&amp;lt;a href=&quot;#&quot;&amp;gt;Badge&amp;lt;/a&amp;gt;&amp;lt;span class=&quot;mdl-badge&quot; data-badge=&quot;4&quot;&amp;gt;&amp;lt;/span&amp;gt;: Badge outside the link&amp;lt;br&amp;gt;&amp;lt;a href=&quot;#&quot; class=&quot;mdl-badge&quot; data-badge=&quot;12345&quot;&amp;gt;Badge&amp;lt;/a&amp;gt;: Badge with too many characters(12345)&amp;lt;br&amp;gt;&amp;lt;a href=&quot;#&quot; class=&quot;mdl-badge mdl-badge--no-background&quot; data-badge=&quot;6&quot;&amp;gt;Badge&amp;lt;/a&amp;gt;: class=&quot;mdl-badge mdl-badge--no-background&quot;</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> Material Design </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CFB MindMap</title>
      <link href="/2016/05/23/cfb-mindmap/"/>
      <url>/2016/05/23/cfb-mindmap/</url>
      
        <content type="html"><![CDATA[<iframe width="100%" height="800px" src="https://embed.coggle.it/diagram/V0MZgJAlfGdrF97n/fa2bc4066df743e227a47743f2e618ad12096f3b615cb2bca7d05cd28a5107bb" frameborder="0" allowfullscreen=""></iframe>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>侧边栏固定宽度, 主体自适应宽度的等高布局</title>
      <link href="/2016/05/22/e4-be-a7-e8-be-b9-e6-a0-8f-e5-9b-ba-e5-ae-9a-e5-ae-bd-e5-ba-a6-e4-b8-bb-e4-bd-93-e8-87-aa-e9-80-82-e5-ba-94-e5-ae-bd-e5-ba-a6-e7-9a-84-e7-ad-89-e9-ab-98-e5-b8-83-e5-b1-80/"/>
      <url>/2016/05/22/e4-be-a7-e8-be-b9-e6-a0-8f-e5-9b-ba-e5-ae-9a-e5-ae-bd-e5-ba-a6-e4-b8-bb-e4-bd-93-e8-87-aa-e9-80-82-e5-ba-94-e5-ae-bd-e5-ba-a6-e7-9a-84-e7-ad-89-e9-ab-98-e5-b8-83-e5-b1-80/</url>
      
        <content type="html"><![CDATA[<h1 id="两列布局实现"><a href="#两列布局实现" class="headerlink" title="两列布局实现"></a>两列布局实现</h1><h2 id="方法1-浮动布局"><a href="#方法1-浮动布局" class="headerlink" title="方法1, 浮动布局"></a>方法1, 浮动布局</h2><p>Sidebar 设置为浮动, Content Body 的 margin 设置为 Sidebar 的宽度</p><h3 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h3><pre><code>&amp;lt;div class=&#39;sidebar&#39;&amp;gt;Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.&amp;lt;/div&amp;gt;&amp;lt;div class=&#39;contentBody&#39;&amp;gt;Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.&amp;lt;/div&amp;gt;`&lt;/pre&gt;### CSS&lt;pre&gt;`*&#123;margin:0;padding:0&#125;.sidebar&#123;float:left;width: 220px;background-color: #ccc;&#125;.contentBody&#123;margin-left: 220px;&#125;`&lt;/pre&gt;## 方法2, 浮动和负边距### HTML&lt;pre&gt;`&amp;lt;div class=&#39;sidebar&#39;&amp;gt;Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.&amp;lt;/div&amp;gt;&amp;lt;div class=&#39;contentBody&#39;&amp;gt;    &amp;lt;div class=&#39;contentInner&#39;&amp;gt;    Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.    &amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;`&lt;/pre&gt;### CSS&lt;pre&gt;`.sidebar&#123;float:left;width: 220px;margin-right: -100%;background-color: green;&#125;.contentBody&#123;float:left;width:100%;&#125;.contentInner&#123;margin-left: 220px;&#125;`&lt;/pre&gt;# 等高实现## Demo1### HTML&lt;pre&gt;`&amp;lt;div class=&#39;container&#39;&amp;gt;    &amp;lt;div class=&#39;wrapper&#39;&amp;gt;        &amp;lt;div class=&#39;sidebar&#39;&amp;gt;SideBar&amp;lt;/div&amp;gt;        &amp;lt;div class=&#39;content&#39;&amp;gt;Main Content&amp;lt;/div&amp;gt;    &amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;`&lt;/pre&gt;### CSS&lt;pre&gt;`.container&#123;background-color:#ccc;&#125;.wrapper&#123;display:inline-block; //保证 wrapper 的最小高度不小于被 float 的 sidebarborder-left: 200px solid #333; //等于 sidebar 宽度vertical-align:bottom&#125;.sidebar&#123;float:left;width: 200px;margin-left: -200px; //等于 wrapper 的 border-left 宽度&#125;.sidebar, .content&#123;min-height: 200px;height: auto !important;height:200px;&#125;`&lt;/pre&gt;## Demo2### HTML&lt;pre&gt;`&amp;lt;div class=&#39;container&#39;&amp;gt;    &amp;lt;div class=&#39;sidebar&#39;&amp;gt;SideBar&amp;lt;/div&amp;gt;    &amp;lt;div class=&#39;content&#39;&amp;gt;Main Content&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;`&lt;/pre&gt;### CSS&lt;pre&gt;`.sidebar&#123;background-color:#ccc;float:left;width:200px;margin-bottom:-99999px;padding-bottom:99999px;&#125;.content&#123;background-color: #eee;margin-left:200px;margin-bottom:-99999px;padding-bottom:99999px;&#125;.sidebar, .content&#123;min-height: 200px;height:auto!important;height:200px;&#125;`&lt;/pre&gt;## Demo3### HTML&lt;pre&gt;`&amp;lt;div class=&#39;container&#39;&amp;gt;    &amp;lt;div class=&#39;wrapper&#39;&amp;gt;        &amp;lt;div class=&#39;col1&#39;&amp;gt;Left Col&amp;lt;/div&amp;gt;        &amp;lt;div class=&#39;col2&#39;&amp;gt;Right Col&amp;lt;/div&amp;gt;    &amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;`&lt;/pre&gt;### CSS&lt;pre&gt;`.container&#123;float:left;width:100%;background:orange;position:relative;overflow:hidden;&#125;.wrapper&#123;float:left;width:100%;background:green;position:relative;left:200px;&#125;.col1&#123;width:200px;float:left;position:relative;margin-left:-200px;&#125;.col2&#123;position:relative;margin-right:200px;&#125;</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>8 Material Design Web UI Framework</title>
      <link href="/2016/05/22/7-material-design-web-ui-framework/"/>
      <url>/2016/05/22/7-material-design-web-ui-framework/</url>
      
        <content type="html"><![CDATA[<h2 id="Origin-of-Material-Design"><a href="#Origin-of-Material-Design" class="headerlink" title="Origin of Material Design"></a><strong>Origin of Material Design</strong></h2><div style='text-align:justify'>Google has its own Polymer Project which embraces Material Design thourghout its Web Components. And in fact, the Polymer Project played a key role in Material Design's development and in showcase of Material Design Concept of Web.</div><h2 id="8-Material-Design-Web-UI-Framework"><a href="#8-Material-Design-Web-UI-Framework" class="headerlink" title="8 Material Design Web UI Framework"></a><strong>8 Material Design Web UI Framework</strong></h2><h3 id="1-Materialize"><a href="#1-Materialize" class="headerlink" title="1. Materialize"></a>1. <a href="http://materializecss.com/">Materialize</a></h3><p><a href="http://materializecss.com/"><img src="https://superdevresources.com/wp-content/uploads/2014/11/materialze-framework-material-design.png"></a></p><div style='text-align:justify'>A modern responsive front-end framework based on Material Design. It provides an option of both CSS as well as source SCSS Files, along with JavaScript, Material Design Icon and Roboto font. Included components are basic ones such as grids, forms, buttons, navbar and cards.</div><p>Available in <a href="https://github.com/Dogfalo/materialize"><img src="http://7xu8mu.com1.z0.glb.clouddn.com/wp-content/uploads//2016/05/1463860438_social_media_online_github.png" alt="1463860438_social_media_online_github"></a></p><h3 id="2-Material-UI"><a href="#2-Material-UI" class="headerlink" title="2. Material UI"></a>2. <a href="http://material-ui.com/">Material UI</a></h3><p><a href="http://material-ui.com/"><img src="https://superdevresources.com/wp-content/uploads/2014/11/material-ui-css-framework.png"></a></p><div style='text-align:justify'>Material UI is a CSS Framework and a Set of React Components that implement Google's Material Design.</div><p>Avaiblable in <a href="https://github.com/callemall/material-ui"><img src="http://7xu8mu.com1.z0.glb.clouddn.com/wp-content/uploads//2016/05/1463860438_social_media_online_github.png" alt="github"></a></p><h3 id="3-Paper-Bootstrap-for-Bootstrap"><a href="#3-Paper-Bootstrap-for-Bootstrap" class="headerlink" title="3. Paper Bootstrap for Bootstrap"></a>3. <a href="http://bootswatch.com/paper/#">Paper Bootstrap for Bootstrap</a></h3><p><a href="http://bootswatch.com/paper/#"><img src="https://superdevresources.com/wp-content/uploads/2014/11/paper-bootstrap-material-design-theme.png"></a></p><div style='text-align:justify'>Paper is a bootstrap theme for the Bootstrap Framework.</div><h3 id="4-Bootstrap-Material"><a href="#4-Bootstrap-Material" class="headerlink" title="4. Bootstrap Material"></a>4. <a href="http://fezvrasta.github.io/bootstrap-material-design/">Bootstrap Material</a></h3><p><a href="http://fezvrasta.github.io/bootstrap-material-design/"><img src="https://superdevresources.com/wp-content/uploads/2014/11/bootstrap-material-design.png"></a></p><div style='text-align:justify'>Similar to Paper, Bootstrap Material is another theme for Bootstrap framework and provides all the components included in Bootstrap. Besides, it covers 740 original Material Design Icons from the Google Material Design Icons Repo.</div><h3 id="5-Leaf"><a href="#5-Leaf" class="headerlink" title="5.Leaf"></a>5.<a href="http://getleaf.com/">Leaf</a></h3><p><a href="http://getleaf.com/"><img src="https://superdevresources.com/wp-content/uploads/2014/11/leaf-meterial-css-framework.jpg"></a></p><div style='text-align:justify'>Leaf is CSS Framework developed by Kim Korte based on the Google's material design. While still in beta, it has extensive list of components such as buttons, cards, sliders, menu, tabs etc. It includes icons by Icomoon, instead of the original Material Design Icons.</div><p>Leaf is also available on <a href="http://github.com/kkortes/leaf"><img src="http://7xu8mu.com1.z0.glb.clouddn.com/wp-content/uploads//2016/05/1463860438_social_media_online_github.png" alt="github"></a></p><h3 id="6-MUI-CSS-Framework"><a href="#6-MUI-CSS-Framework" class="headerlink" title="6.MUI CSS Framework"></a>6.<a href="https://www.muicss.com/">MUI CSS Framework</a></h3><p><a href="https://www.muicss.com/"><img src="https://superdevresources.com/wp-content/uploads/2014/11/mui-material-design-css-framework.png"></a></p><div style='text-align:justify'>MUI is lightweighted HTML, CSS and JS Framework for building sites following Google's Material Design Principles. MUI is designed from the ground up to be fast, small and developer friendly. By design it only includes the basic components you need to build a site that follows Material Design Guideline.</div><p>Availabel in <a href="https://www.muicss.com/"><img src="http://7xu8mu.com1.z0.glb.clouddn.com/wp-content/uploads//2016/05/1463860438_social_media_online_github.png" alt="github"></a></p><h3 id="7-Polymer-Project"><a href="#7-Polymer-Project" class="headerlink" title="7. Polymer Project"></a>7. <a href="https://www.polymer-project.org/docs/elements/material.html">Polymer Project</a></h3><p><a href="https://www.polymer-project.org/docs/elements/material.html"><img src="https://superdevresources.com/wp-content/uploads/2014/11/google-polymer-paper-material.png"></a></p><div style='text-align:justify'>Google's Polymer Project is a web framework and their embodiment of material design of teh web.While still in 'developer preview', most of the components are quite mature. Polymer aims to support all major modern browser such as IE(10+), Chrome, Safari, and Firefox.</div><h3 id="8-Material-Design-Lite"><a href="#8-Material-Design-Lite" class="headerlink" title="8. Material Design Lite"></a>8. <a href="https://getmdl.io/index.html">Material Design Lite</a></h3><p><a href="https://getmdl.io/index.html"><img src="http://7xu8mu.com1.z0.glb.clouddn.com/wp-content/uploads//2016/05/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7-2016-05-22-%E4%B8%8B%E5%8D%885.50.45.png"></a></p><div style='text-align:justify'>Material Design lets you add a Material Design look and feel to your website. It doesn't rely on any JS frameworks adn aims to optimize for cross devices use, gracefully degrade in older browsers, and offer an experience that is immediately accessible.</div><p>Availabel in <a href="https://github.com/google/material-design-lite"><img src="http://7xu8mu.com1.z0.glb.clouddn.com/wp-content/uploads//2016/05/1463860438_social_media_online_github.png" alt="github"></a></p>]]></content>
      
      
      
        <tags>
            
            <tag> Material Design </tag>
            
            <tag> Design </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git Commands</title>
      <link href="/2016/05/21/git-commands/"/>
      <url>/2016/05/21/git-commands/</url>
      
        <content type="html"><![CDATA[<ol><li><code>git init</code> to init a working space into a git repo</li><li><code>git add filename</code> or <code>git add .</code> to track file or all files, and add them to <strong>stage</strong></li><li><code>git commit -m &quot;message&quot;</code> to commit changes to local repo</li><li>Several files can be commited together: <code>git add file1; git add file2; git commit -m &quot;add 2 files&quot;</code></li><li>Use regx: <code>git add &quot;*.txt&quot;; git commit -m &quot;add all text&quot;</code></li><li><code>git status</code> to check which file has been modified</li><li><code>git diff filename</code> to check details of modification in filename</li><li><code>git log</code> to show logs</li><li><code>git log --pretty</code> to show concise info of log, <code>git log --graph --pretty=online --abbrev-commit</code> for more info</li><li><code>git reset --hard HEAD^</code> to recover to last commit</li><li><code>git reset --hard ID</code> to recover to specific version</li><li><code>git checkout -- filename</code> to dismiss modification in local working space, e.g. if you delete text.txt in working space and want to recover it, <code>git checkout -- text.txt</code> can pull it from local repo to working space</li><li><code>git reset HEAD filename</code> to recover file from local repo</li><li><code>rm filename</code> to delete file in working space, only phisically delete the file without log</li><li><code>git rm filename</code> to delete file in working space and add a deletion operation in log waiting for commit</li><li><code>git remote add origin **https**</code> to connect to a remote repo</li><li><code>git push -u origin master</code> to push local repo to remote repo. <code>-u</code> for first push, it will connect local and remote repo for pull and push in future</li><li><code>git clone **https**</code> to clone a remote repo to local position</li><li><code>git checkout -b dev</code> create a new branch named dev, and switch to it. This command equals to <code>git branch dev; git checkout dev</code></li><li><code>git branch</code> to check current branch</li><li><code>git merge dev</code> to merge modification from dev to current branch</li><li><code>git branch -d dev</code> to delete branch dev</li><li><code>git merge</code> is <strong>Fast Forward</strong> mode which will lose merge log, <code>git merge --no-ff -m &quot;merge with no-ff&quot;</code> will keep the merge log and make a new commit(so it needs a -m), with –no-ff you can see the merge in log</li></ol><h3 id="Bug-Branch"><a href="#Bug-Branch" class="headerlink" title="Bug Branch"></a>Bug Branch</h3><p><code>git stash</code> to keep current working space</p><pre><code>git stashgit checkout mastergit checkout -b bug-101*fix the but*git add .git commit -m &#39;fix but-101&#39;git checkout mastergit merge --no-ff &#39;merge bug-101 fix&#39; bug-101git branch -d but-101git checkout dev #return to previous working branchgit stash list #check kept working space, e.g. *stash@&#123;0&#125;: ...git stash apply stash@&#123;0&#125; #recover the working space without delete it in the list**or**git stash pop stash@&#123;0&#125; #recover and delete it in the list`&lt;/pre&gt;### Omit unmerged Branch&lt;pre&gt;`git checkout -b new-feature #new branch for feature developmentgit add featurefilegit commit -m &quot;add new feature&quot;git checkout dev*requirement changed, the feature is dismissed**new feature has not been merged, so need force Delete*git branch -D new-feature`&lt;/pre&gt;### Coordination&lt;pre&gt;`git remote #return remote repo name, e.g. origingit remote -v #return detailsgit push origin dev #push current branch to origin devgit checkout -b dev origin/dev #create a dev, and push it to origin/devgit pull #git fetch and merge to current branch</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CFB HomePage(RWD)</title>
      <link href="/2016/05/19/cfb/"/>
      <url>/2016/05/19/cfb/</url>
      
        <content type="html"><![CDATA[<p>Chinafiremag.cn is a non-responsive website and this is a prototype of RW one.</p>]]></content>
      
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
