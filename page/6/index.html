<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Front-End, JavaScript, Html, Css, React, Vue, Rxjs" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta property="og:type" content="website">
<meta property="og:title" content="EzCook">
<meta property="og:url" content="http://yoursite.com/page/6/index.html">
<meta property="og:site_name" content="EzCook">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="EzCook">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"right","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/6/"/>





  <title> EzCook </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-right 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">EzCook</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Code Elegantly</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            站点地图
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/08/26/node-js-e4-b9-8b-path-e6-a8-a1-e5-9d-97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Chen Yu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="EzCook">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/26/node-js-e4-b9-8b-path-e6-a8-a1-e5-9d-97/" itemprop="url">
                  Node.js 之 path 模块
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-26T06:57:53+08:00">
                2016-08-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/note/" itemprop="url" rel="index">
                    <span itemprop="name">note</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>path模块用于规范化路径连接和解析路径.</p>
<p>path的功能包括不仅限于:</p>
<ul>
<li>规范化路径</li>
<li>连接路径</li>
<li>路径解析</li>
<li>查找两个绝对路径的相对关系</li>
<li>提取路径的组成部分</li>
</ul>
<h3 id="规范化路径-path-normalize-p"><a href="#规范化路径-path-normalize-p" class="headerlink" title="规范化路径 path.normalize(p)"></a>规范化路径 path.normalize(p)</h3><p>path 模块中的 normalize(p) 用来规范化路径, 可用于处理路径中的 <code>//</code>, <code>..</code>, <code>.</code>等.</p>
<pre><code>var path = require(&apos;path&apos;);
path.normalize(&apos;./foo/bar//baz/asfd/que/..&apos;);
// 处理后
&apos;foo/bar/baz/asfd&apos;
`&lt;/pre&gt;

### 连接路径 path.join([path1][, path2][, ...])

将任意个路径字符串连接, 同时也会对路径进行规范化

&lt;pre&gt;`var path = require(&apos;path&apos;);
//合法的字符串连接
path.join(&apos;./foo&apos;, &apos;bar&apos;, &apos;baz/asdf&apos;, &apos;quux&apos;, &apos;..&apos;)
// 连接后
&apos;foo/bar/baz/asfd&apos;

// 不合法的字符串将抛出异常
path.join(&apos;foo&apos;,{}, bar) =&amp;gt; TypeError: Arguments to path.join must be strings
`&lt;/pre&gt;

### 路径解析 path.resolve([from...], to)

path.resolve 方法可以将多个路径解析为一个规范化的绝对路径, 其处理方法类似于对这些路径逐一进行 cd 操作, 与 cd 操作不同的是, 这引起路径可以是文件, 而且可不必实际存在, 仅是字符串操作

&lt;pre&gt;`path.resolve(&apos;foo/bar&apos;,&apos;/tmp/file/&apos;,&apos;..&apos;,&apos;a/../subfile&apos;)
`&lt;/pre&gt;

相当于

&lt;pre&gt;`cd foo/bar
cd /temp/file/
cd ..
cd a/../subfile
`&lt;/pre&gt;

如果解析的不是绝对路径, path.resolve() 会将当前工作目录加到解析结果前

&lt;pre&gt;`path.resolve(&apos;wooroot&apos;,&apos;bar&apos;,&apos;./baz&apos;)
// 当前工作路径是/home/node, 则输出结果是
&apos;/home/node/wooroot/bar/baz&apos;
`&lt;/pre&gt;

### 查找两个绝对路径之间的相对关系 path.relative(from, to)

&lt;pre&gt;`path.relative(&apos;/Users/node/demo&apos;, &apos;/Users/node&apos;) =&amp;gt; &apos;..&apos;
</code></pre><h3 id="提取路径的组成部分-path-dirname-p-path-basename-p-ext-path-extname-p"><a href="#提取路径的组成部分-path-dirname-p-path-basename-p-ext-path-extname-p" class="headerlink" title="提取路径的组成部分 path.dirname(p), path.basename(p[,ext]), path.extname(p)"></a>提取路径的组成部分 path.dirname(p), path.basename(p[,ext]), path.extname(p)</h3><p>path.dirname =&gt; 文件路径中的目录部分<br>path.basename =&gt; 文件路径中的文件部分<br>path.extname =&gt; 文件路径中的文件扩展名</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/08/26/react-router-documents/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Chen Yu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="EzCook">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/26/react-router-documents/" itemprop="url">
                  React-router Documents
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-26T05:34:50+08:00">
                2016-08-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/note/" itemprop="url" rel="index">
                    <span itemprop="name">note</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>安装</p>
<pre><code>npm install history react-router@latest
`&lt;/pre&gt;

react-router 依赖 history 模块

&lt;pre&gt;`import {Router, Route, Link} from &apos;react-router&apos;

可以从 lib 目录 require 需要的部分
`&lt;/pre&gt;

import { Router } from &apos;react-router/lib/Router&apos;

&lt;pre&gt;`import React from &apos;react&apos;
import { Router, Route, Link } from &apos;react-router&apos;

const App = React.createClass({/*..*/})
const About = React.createClass({/*...*/})

const Users = React.createClass({
  render(){
    return(
      &amp;lt;div&amp;gt;
        &amp;lt;h1&amp;gt;Users&amp;lt;/h1&amp;gt;
        &amp;lt;div className = &quot;master&quot;&amp;gt;
          &amp;lt;ul&amp;gt;
            {/* 在本应用中用 Link 去链接路由*/}
            {this.state.users.map(user =&amp;gt; (
              &amp;lt;li key={user.id}&amp;gt;&amp;lt;Link to={`/user/${user.id}`}&amp;gt;{user.name}&amp;lt;/Link&amp;gt;&amp;lt;/li&amp;gt;
            ))}
          &amp;lt;/ul&amp;gt;
        &amp;lt;/div&amp;gt;
        &amp;lt;div className =&quot;detail&quot;&amp;gt;
          {this.props.children}
        &amp;lt;/div&amp;gt;
      &amp;lt;/div&amp;gt;
    )
  }
})

const User = React.createClass({
  componentDidMount(){
    this.setState({
      // 路由应该通过有用的信息来呈现, 比如 URL 的参数
      user: findUserById(this.props.params.userId)
    })
  },

  render(){
    return(
      &amp;lt;div&amp;gt;
        &amp;lt;h2&amp;gt;{this.state.user.name}&amp;lt;/h2&amp;gt;
        {/* 等等 */}
      &amp;lt;/div&amp;gt;
    )
  }
})

/**
 * 路由配置说明(不用加载整个配置, 只需要加载一个想要的跟路由, 也可以延迟加载这个配置)
 */

React.render(
  (&amp;lt;Router&amp;gt;
    &amp;lt;Route path = &quot;/&quot; component = {App}&amp;gt;
      &amp;lt;Route path = &quot;about&quot; component = {About}/&amp;gt;
        &amp;lt;Route path = &quot;users&quot; component = {Users}&amp;gt;
          &amp;lt;Route path = &quot;/user/:userId&quot; component = {User}/&amp;gt;
        &amp;lt;/Route&amp;gt;
        &amp;lt;Route path = &quot;*&quot; component = {NoMatch}/&amp;gt;
    &amp;lt;/Route&amp;gt;
  &amp;lt;/Router&amp;gt;),
  document.body
)
`&lt;/pre&gt;

&lt;pre&gt;`import React from &apos;react&apos;
import { render } from &apos;react-dom&apos;

import { Router, Route, Link } from &apos;react-router&apos;

const App = React.createClass({
  render(){
    return (
      &amp;lt;div&amp;gt;
        &amp;lt;h1&amp;gt;App&amp;lt;/h1&amp;gt;
        {/* 把 &amp;lt;a&amp;gt; 变成 &amp;lt;Link&amp;gt; */}
        &amp;lt;ul&amp;gt;
          &amp;lt;li&amp;gt;&amp;lt;Link to=&quot;/about&quot;&amp;gt;&amp;lt;/Link&amp;gt;&amp;lt;/li&amp;gt;
          &amp;lt;li&amp;gt;&amp;lt;Link to=&quot;/inbox&quot;&amp;gt;&amp;lt;/Link&amp;gt;&amp;lt;/li&amp;gt;
        &amp;lt;/ul&amp;gt;
        {/*
          接着用` this.props.children` 替换`&amp;lt;Child&amp;gt;`, this.props.children 就是 App 的子组件 Inbox 和 About
        */}

       {this.props.children}
      &amp;lt;/div&amp;gt;
    )
  }
})

React.render((
  &amp;lt;Router&amp;gt;
    &amp;lt;Route path = &quot;/&quot; component = {App}&amp;gt;
      &amp;lt;Route path=&quot;about&quot; component = {About}
      &amp;lt;Route path=&quot;inbox&quot; component = {Inbox}
    &amp;lt;/Route&amp;gt;
  &amp;lt;/Router&amp;gt;
))
`&lt;/pre&gt;

&lt;pre&gt;`const Message = React.createClass({
  render(){
    return(
      &amp;lt;h3&amp;gt;Message&amp;lt;/h3&amp;gt;
    )
  }
})

const Inbox = React.createClass({
  render(){
    return(
      &amp;lt;div&amp;gt;
        &amp;lt;h2&amp;gt;Inbox&amp;lt;/h2&amp;gt;
        {this.props.children||&apos;Welcome to your inbox&apos;}
      &amp;lt;/div&amp;gt;
    )
  }
})

React.render((
  &amp;lt;Router&amp;gt;
    &amp;lt;Route path=&quot;/&quot; component = {App}&amp;gt;
      &amp;lt;Route path =&quot;about&quot; component = {About} /&amp;gt;
      &amp;lt;Route path =&quot;inbox&quot; component = {Inbox}&amp;gt;
        &amp;lt;Route path=&quot;message/:id&quot; component={Message}/&amp;gt;
      &amp;lt;/Route&amp;gt;    
    &amp;lt;/Route&amp;gt;
  &amp;lt;/Router&amp;gt;
),document.body)
`&lt;/pre&gt;

访问 URL = inbox/message/Jkei 会匹配一个新路由, 其指向 App =&gt; Inbox =&gt; Message

&lt;pre&gt;`&amp;lt;App&amp;gt;
  &amp;lt;Inbox&amp;gt;
    &amp;lt;Message params = {id: &quot;Jkei&quot;} /&amp;gt;
  &amp;lt;/Inbox&amp;gt;
&amp;lt;/App&amp;gt;
`&lt;/pre&gt;

### 获取 URL 参数

为了从服务器获取 message 数据, 我们首先需要知道他的信息, 当渲染组件的时候, React Router 自动向 Route 组件注入一些有用的信息, 尤其是路径中动态部分的参数, 比如上例中的`:id`

&lt;pre&gt;`const Message = React.createClass({
  componentDidMount(){
    const id = this.props.params.id

    fetchMessgae(id,function(err,message){
      this.setState({message:message})
    })
  }
})
`&lt;/pre&gt;

### 路由配置

路由配置是一组指令, 用来告诉 router 如何匹配 URL, 以及匹配后的动作.

&lt;pre&gt;`import React from &apos;react&apos;
import {Router, Route, Link} from &apos;react-router&apos;

const App = React.createClass({
  render(){
    return(
      &amp;lt;div&amp;gt;
        &amp;lt;h1&amp;gt;App&amp;lt;/h1&amp;gt;
        &amp;lt;ul&amp;gt;
          &amp;lt;li&amp;gt;&amp;lt;Link to=&quot;/about&quot;&amp;gt;About&amp;lt;/Link&amp;gt;&amp;lt;/li&amp;gt;
          &amp;lt;li&amp;gt;&amp;lt;Link to=&quot;/inbox&quot;&amp;gt;Inbox&amp;lt;/Link&amp;gt;&amp;lt;/li&amp;gt;
        &amp;lt;/ul&amp;gt;
        {this.props.children}
      &amp;lt;/div&amp;gt;
    )
  }
})

const About = React.createClass({
  render(){
    return &amp;lt;h3&amp;gt;About&amp;lt;/h3&amp;gt;
  }
})

const Inbox = React.createClass({
  render(){
    return(
      &amp;lt;div&amp;gt;
        &amp;lt;h2&amp;gt;Inbox&amp;lt;/h2&amp;gt;
        {this.props.children || &apos;Welcome to your Inbox&apos;}
      &amp;lt;/div&amp;gt;
    )
  }
})

const Message = React.createClass({
  render(){
    return &amp;lt;h3&amp;gt;Message {this.props.params.id}&amp;lt;/h3&amp;gt;
  }
})

React.render((
  &amp;lt;Router&amp;gt;
    &amp;lt;Route path = &quot;/&quot; component = {App}&amp;gt;
      &amp;lt;Route path = &quot;about&quot; component = {About} /&amp;gt;
      &amp;lt;Route path = &quot;inbox&quot; component = {Inbox}&amp;gt;
        &amp;lt;Route path = &quot;message/:id&quot; component = {Message} /&amp;gt;
      &amp;lt;/Route&amp;gt;
    &amp;lt;/Route&amp;gt;
  &amp;lt;/Router&amp;gt;
),document.body)
`&lt;/pre&gt;

### 添加首页

当 URL 为 &quot;/&quot; 的时候, 渲染的 App 组件的 render 中的 this.props.children 还是 undefined, 这种情况我们可以使用`IndexRoute`来设置一个默认页

&lt;pre&gt;`import {IndexRoute} from &apos;react-router&apos;
const Dashboard = React.createClass({
  render(){
    return &amp;lt;div&amp;gt;Welcome to the App!&amp;lt;/div&amp;gt;
  }
})

React.render((
  &amp;lt;Router&amp;gt;
    {/* 当 URL 为 / 的时候渲染 Dashboard*/}
    &amp;lt;IndexRoute component = {Dashboard} /&amp;gt;
    &amp;lt;Route path=&quot;about&quot; component = {About} /&amp;gt;
  &amp;lt;/Router&amp;gt;
),document.body)
`&lt;/pre&gt;

现在的 Sitemap 如下:

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
  &lt;th&gt;URL&lt;/th&gt;
  &lt;th&gt;Component&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
  &lt;td&gt;/&lt;/td&gt;
  &lt;td&gt;App =&gt; Dashboard&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
  &lt;td&gt;/about&lt;/td&gt;
  &lt;td&gt;App =&gt; About&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

### 将 UI 于 URL 解耦

如果我们可以将 `/inbox` 从 `/inbox/message:id` 中去除, 并且还能够让 Message 嵌套在 App-&gt;Inbox 中渲染, 那会非常赞, 绝对路径可以做到这一点

&lt;pre&gt;`React.render((
  &amp;lt;Router&amp;gt;
    &amp;lt;Route path = &quot;/&quot; component = {App}&amp;gt;
      &amp;lt;IndexRoute component = {Dashboard} /&amp;gt;
      &amp;lt;Route path = &quot;inbox&quot; component = {Inbox} &amp;gt;
        &amp;lt;Route path = &quot;/message:id&quot; component = {Message} /&amp;gt;
      &amp;lt;/Route&amp;gt;
    &amp;lt;/Route&amp;gt;
  &amp;lt;/Router&amp;gt;
),document.body)
`&lt;/pre&gt;

在多层嵌套路由中使用感觉对路径可以提高逻辑性.

Simtemap 如下:

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
  &lt;th&gt;URL&lt;/th&gt;
  &lt;th&gt;Component&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
  &lt;td&gt;/&lt;/td&gt;
  &lt;td&gt;App =&gt; Dashboard&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
  &lt;td&gt;/message/:id&lt;/td&gt;
  &lt;td&gt;App =&gt; Inbox =&gt; Message&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

提醒, 绝对路径可能在动态路由中无法使用

同时, 上述配置存在一个问题, 当用户访问/inbox/message/6的时候回无法访问

使用&amp;lt;Redirect&gt;修正

&lt;pre&gt;`&amp;lt;Route path = &quot;indox&quot; component = {Indox} &amp;gt;
  &amp;lt;Route path = &quot;/message/:id&quot; component = {Message} /&amp;gt;
  &amp;lt;Redirect from = &quot;message/:id&quot; to = &quot;/message/:id&quot; /&amp;gt;
&amp;lt;/Route&amp;gt;
`&lt;/pre&gt;

### 进入和离开的 Hook

Route 可以定义 `onEnter` 和 `onLeave` 两个 Hook, 这些 hook 会在页面跳转确认时触发一次,

在路由跳转过程中, `onLeave` hook 会在爱所有将离开的路由中触发, 从最下层的自路由开始直到最外层的父路由结束, 而`onEnter` hook 则从自外层的父路由开始直到最下层的子路由结束

比如从 /message/5 -&gt; /about 依次触发
- /message/:id 的 onLeave
- /inbox 的 onLeave
- /about 的 onEnter

### 路由匹配原理

路由拥有三个属性来决定是否匹配一个 URL
- 嵌套关系
- 路径语法
- 优先级

#### 嵌套关系

当一个给定的 URL 被调用时, 整个集合(命中的部分)都会被渲染, 嵌套路由被描述成一种树形结构, React Router 会深度优化遍历整个路由配置来寻找一个与给定的 URL 匹配的路由

#### 路径语法

路由路径是匹配一个(或一部分) URL 的一个字符串模式, 大部分的路由路径都可以按照字面量理解, 除了一下几个特殊字符:
- `:paramName` - 匹配一段位于`/`,`?`, `#`之后的 URL, 命中的部分作为一个参数
- `()` - 内部的内容被认为是可选的
- `*` - 匹配任意字符(非贪婪)直到命中下一个字符或整个 URL 的末尾, 并创建一个 splat 参数

&lt;pre&gt;`&amp;lt;Route path = &apos;/hello/:name&apos; /&amp;gt; // 匹配 /hello/michael 和 /hello/john
&amp;lt;Route path = &apos;/hello/(:name)&apos;/&amp;gt; // 匹配 /hello, /hello/michael, /hello/john
&amp;lt;Route path = &apos;/files/*.*&apos; /&amp;gt; // 匹配 files/hello.js, files/hello.jpg
`&lt;/pre&gt;

使用绝对路径可以使路由忽略嵌套关系

#### 优先级

兄弟路由的前一个优先级高

### Histories

React Router 是建立在 history 之上的, 一个 history 知道如何去监听浏览器地址变化, 并解析这个 URL 转化为 location 对象, 然后 router 使用它匹配到路由. 最后正确渲染组件

常用的 history 有三种形式
- createHashHistory
- createBrowserHistory
- createMemoryHistory

从 history 库中获取他们

&lt;pre&gt;`import createBrowserHistory from &apos;history/lib/createBrowserHistory&apos;
`&lt;/pre&gt;

#### createHashHistory

这是一个你会获得的默认 history, 如果不指定某个 history (即&amp;lt;Router&gt;{...}&amp;lt;/Router&gt;) 他用到的是 URL 中的 hash(#) 部分去创建形如 example.com/#/some/path 的路由

HashHistory 是默认的, 可以在服务器中不作任何配置就可以运行, 并且在全部浏览器中都可以使用, 但是不推荐实际生产中使用它, 因为每一个 web 应用都应该有目的地去使用 createBrowserHistory

#### 像`?_k=ckuvup` 没用的在 URL 中是什么?

当一个 history 通过应用程序的`pushState`或`replaceState`跳转时, 他可以在新的 location 中存储&quot;lcoation state&quot; 而不现实在 URL 中, 就像在一个 HTML 中 post 的表单数据

在 DOM API 中, 这些 hash history 通过 window.location.hash = newHash 很简单地被用于, 且不用存储他们的 location state, 但是我们希望全部的 history 都能够使用 location state, 因此要为每个 location 添加一个唯一的 key, 并把他们的状态存储在 session storage 中, 当访客点击前进或后退的时候, 可以恢复这些 location state.

#### createBrowserHistory

这是 react-router 创建浏览器应用推荐的 History, 使用 History API 在浏览器中被创建用于处理 URL, 新建一个像这样真实的 URL: example.com/some/path

##### 服务器配置

首先服务器应该能够处理 URL 请求, 处理应用启动最初的`/`这样的请求应该没问题,但是当用户来回跳转并在`/ accounts/23`刷新时, 服务器会受到来自`/account/23`的请求, 这时你就需要处理这个 URL 并在响应中包含 JS 程序代码

一个 express 的应用看起来可能是这样的:

&lt;pre&gt;`const express = require(&apos;express&apos;)
const path = require(&apos;path&apos;)
const port = process.env.PORT || 8080
const app = express()

// 通常用于加载静态资源
app.use(express.static(__dirname + &apos;/public&apos;))

// 在你应用 JS 文件中包含一个 script 标签的 index.html 中处理任何一个 route

app.get(&apos;*&apos;,function(request, response){
  response.sendFile(path.resolve(__dirname, &apos;public&apos;, &apos;index.html&apos;)
})

app.listen(port)
console.log(&apos;server started on port&apos; + port)
`&lt;/pre&gt;

当服务器找不到其他文件的时候, 服务器生成静态文件和操作 index.html 文件.

### 实例展示

&lt;pre&gt;`import React from &apos;react&apos;
import createBrowserHistory from &apos;history/createBrowserHistory&apos;
import { Router, Route, IndexRoute } from &apos;react-router&apos;
import App from &apos;../componnents/App&apos;
import Home from &apos;../componnents/Home&apos;
import About from &apos;../componnents/About&apos;
import Features from &apos;../componnents/Features&apos;

React.render(
  &amp;lt;Router history = {createBrowserHistory()} &amp;gt;
    &amp;lt;Route path = &apos;/&apos; component = {App} &amp;gt;
      &amp;lt;IndexRoute component = {Home} /&amp;gt;
      &amp;lt;Route path = &apos;about&apos; component = {About} /&amp;gt;
      &amp;lt;Route path = &apos;features&apos; component = {Features} /&amp;gt;
    &amp;lt;/Route&amp;gt;
  &amp;lt;/Router&amp;gt;, document.body
)
`&lt;/pre&gt;

### 默认路由(IndexRoute)与 IndexLink

如果设置了 IndexRoute =&gt; Home, 就要设置跳转到 Home 的路由&apos;/&apos;, 即`&amp;lt;Link to=&apos;/&apos;&amp;gt;Home&amp;lt;/Link&amp;gt;`, 他会一直处于激活状态(因为所有子路由都经过&apos;/&apos;), 我们仅希望在 Home 被渲染后激活并连接到他, 即需要在 Home 路由被渲染后才激活指向&apos;/&apos; 的链接, 请使用`&amp;lt;IndexLink to=&apos;/&apos;&amp;gt;Home&amp;lt;/IndexLink&amp;gt;`

### 动态路由

React Router 适用于小型网站, 也可以支持大型网站

对于大型应用而言, 一个首当其冲的问题就是所需要加载的 JS 的大小, 程序应当只加载当前渲染页需要的的 JS, 有些开发者称之为&quot;代码拆分&quot;, 在用户浏览过程中按需加载

对于底层细节的修改不应该需要他上面每一层级都进行修改, 举个例子, 为一个照片浏览页添加一个路径不应该影响到首页加载的 JS 大小, 也不能因为多个团队共用一个大型路由配置文件二造成合并时的冲突.

路由是个非常适合做代码拆分的地方: 他的责任就是配置好每个 view

React Routerzhogn 的路径匹配及组件加载都是异步完成的, 不仅允许你延迟加载组件, **并且可以延迟加载路由配置**. 在首次加载包中你只需要有一个路径定义, 路由会自动解析剩下的路径

Route 可以定义`getChildRoutes`, `getIndexRoute`, 和`getComponents` 这几个函数, 他们都是异步执行的, 并且只有需要时被调用, 这种方式成为&quot;逐渐匹配&quot;

React Router 会逐渐地匹配 URL 并且只加载该 URL 对应页面所需要路径配置和组件

如果配合 webpack 代码拆分工具使用的话, 一个原本繁琐的架构就会变得简明

&lt;pre&gt;`const CourseRoute = {
  path: &apos;course/:courseId&apos;,
  /* 当 get routes/indexRoute/Component 的时候 require 相应的资源
  getChildRoutes(location, callback){
    require.ensure([],function(require){
      callback(null, [
        require(&apos;./routes/Announcements&apos;),
        require(&apos;./routes/Assignments&apos;),
        require(&apos;./routes/Grades&apos;)
      ])
    })
  },

  getIndexRoute(location, callback){
    require.ensure([], function(require){
      callback(null, require(&apos;./components/Index&apos;))
    })
  },

  getComponents(location, callback){
    require.ensure([],function(require){
      callback(null, requrie(&apos;./components/Course&apos;))
    })
  }
}
`&lt;/pre&gt;

### 跳转前确认

React Router 提供一个`routerWillLeave` 生命周期钩子, 这使得 React 可以拦截正在发生的跳转, 或者在离开 Route 前提示用户

`routerWillLeave` 返回值有一下两种:
1\. `return false` 取消此次跳转
2\. `return` 返回提示信息, 在离开 route 前提示用户进行确认

在 Route 组件中引入`Lifecycle` mixin 来安装这个钩子

&lt;pre&gt;`import { Lifecycle } from &apos;react-router&apos;

const Home = React.createClass({
  mixins: [Lifecycle],
  routerWillLeave(nextLocation){
    if(!this.state.isSaved){
      return &apos;Your work is not saved!&apos;
    }
  }
})
`&lt;/pre&gt;

### 服务端渲染

服务端渲染与客户端渲染有些许不同, 需要
- 发生错误的时候发送一个`500`响应
- 需要重定向时发送一个`30x`响应
- 需要在渲染之前获得数据(用 router 完成)

### 组件生命周期

路由配置如下:

&lt;pre&gt;`&amp;lt;Route path = &apos;/&apos; component = {App} &amp;gt;
  &amp;lt;IndexRoute component = {Home} /&amp;gt;
  &amp;lt;Route path = &apos;invoices/:invoiceId&apos; component = {Invoice}/&amp;gt;
  &amp;lt;Route path = &apos;accounts/:accountId&apos; component = {Account}/&amp;gt;
&amp;lt;/Route&amp;gt;
`&lt;/pre&gt;

#### 路由切换时, 组件生命周期的变化
</code></pre><ol>
<li>当用户打开’/‘ 页面<br><table><br><thead><br><tr><br>  <th>Component</th><br>  <th>LifeCycle</th><br></tr><br></thead><br><tbody><br><tr><br>  <td>App</td><br>  <td>componentDidMount</td><br></tr><br><tr><br>  <td>Home</td><br>  <td>componentDidMount</td><br></tr><br><tr><br>  <td>Invoice</td><br>  <td>N/A</td><br></tr><br><tr><br>  <td>Account</td><br>  <td>N/A</td><br></tr><br></tbody><br></table><p></p></li>
<li><p>当用户从’/‘ 跳转到 ‘/invoices/123’</p>
<table><br><thead><br><tr><br>  <th>Component</th><br>  <th>LifeCycle</th><br></tr><br></thead><br><tbody><br><tr><br>  <td>App</td><br>  <td>componentWillReceiveProps, componentDidUpdate</td><br></tr><br><tr><br>  <td>Home</td><br>  <td>componentWillUnmount</td><br></tr><br><tr><br>  <td>Invoice</td><br>  <td>componentDidMount</td><br></tr><br><tr><br>  <td>Account</td><br>  <td>N/A</td><br></tr><br></tbody><br></table>

<h4 id="获取数据"><a href="#获取数据" class="headerlink" title="获取数据"></a>获取数据</h4><p></p><p>最简单的通过 router 获取数据的方法是通过组件生命周期 Hook 来实现.</p>
<p>在 Invoice 中添加一个简单的数据获取功能</p>
<p><pre>`let Invoice = React.createClass({<br>  getInitialState(){</pre></p>
<pre><code>return{
  invoice: null
}
</code></pre><p>  },</p>
<p>  componentDidMount(){</p>
<pre><code>this.setState({
  this.fetchInvoice()
})
</code></pre><p>  },</p>
<p>  componentDidUpdate(prevProps){</p>
<pre><code>let oldId = prevProps.params.invoiceId
let newId= this.props.params.invoiceId
if(newId !== oldId){
  this.fetchInvoice()
}
</code></pre><p>  },</p>
<p>  componentWillUnmount(){</p>
<pre><code>this.ignorelastFetch = true
</code></pre><p>  },</p>
<p>  fetchInvoice(){</p>
<pre><code>let url = `/api/invoices/${this.props.params.invoiceId}`
this.request = fetch(url, (err, data) =&amp;gt; {
  if(!this.ingoreFetch){
    this.setState({invoice: data.invoice})
  }
})
</code></pre><p>  },</p>
<p>  render(){</p>
<pre><code>return &amp;lt;InvoiceView invoice = {this.state.invoice} /&amp;gt;
</code></pre><p>  }<br>})</p>
</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/08/25/h5-e7-a7-bb-e5-8a-a8-e7-ab-af-e6-b3-a8-e6-84-8f-e7-82-b9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Chen Yu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="EzCook">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/25/h5-e7-a7-bb-e5-8a-a8-e7-ab-af-e6-b3-a8-e6-84-8f-e7-82-b9/" itemprop="url">
                  H5 移动端注意点
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-25T16:13:17+08:00">
                2016-08-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Uncategorized/" itemprop="url" rel="index">
                    <span itemprop="name">Uncategorized</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ol>
<li>使用 rem 作为单位</li>
</ol>
<p>给手机这是 100px 的字体大小, 对于320px 的手机匹配是100px, 其他手机都是按比例分配, 因此设计稿上多少像素的话, rem = 设计稿像素/100</p>
<ol>
<li>禁用 a, button, input, opigroup, select, textare 等标签背景变暗</li>
</ol>
<p>在移动端使用 a 标签作为按钮或文字链接的时候, 点击按钮会出现一个暗色背景, 需要在 css 中加入</p>
<pre><code>a, button, input, textarea, optgroud, select{
  -webkit-tap-highlight-color: rgba(0,0,0,0)
}
`&lt;/pre&gt;
</code></pre><ol>
<li><p>meta 基础知识</p>
<p>页面窗口自动调整到设别宽度, 并禁止用户缩放页面</p>
<pre>`&lt;meta name="viewport" content="width=device-width,initial-width:1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=0"/&gt;
`</pre>

<p>忽略页面中的数字识别为手机号</p>
<pre>`&lt;meta name="format-detection" content="telephone=no"/&gt;
`</pre>

<p>忽略 Android 平台对邮箱地址的识别</p>
<pre>`&lt;meta name="format-detection" content="email=no"/&gt;
`</pre>

<p>当网站添加到主屏时可隐藏地址栏, 仅针对 ios 的 safari</p>
<pre>`&lt;meta name="apple-mobile-web-app-capable" content="yes"/&gt;
`</pre>
</li>
<li><p>移动端定义字体</p>
<pre>`body{
  font-family:"Helvetica Neue", Helvetica, sans-serif;
}
`</pre>
</li>
<li><p>设置拨打电话</p>
<pre>`&lt;a href="tel:1242432423"&gt;1242432423&lt;/a&gt;
`</pre>
</li>
<li><p>设置发送短信</p>
<pre>`&lt;a href="sms:123124325434"&gt;123124325434&lt;/a&gt;
`</pre>
</li>
<li><p>设置发送邮箱</p>
<p><pre>`&lt;a href=”mailto:131321@21312.com”&gt;发送邮件&lt;/a&gt;</pre></p>
</li>
</ol>
<p>8, calc 语法, 兼容 IE9+, FF4.0, Chrome19+, Safari6+</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/08/25/react-e6-80-a7-e8-83-bd-e4-bc-98-e5-8c-96-tip/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Chen Yu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="EzCook">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/25/react-e6-80-a7-e8-83-bd-e4-bc-98-e5-8c-96-tip/" itemprop="url">
                  React 性能优化 Tip
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-25T15:41:49+08:00">
                2016-08-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/note/" itemprop="url" rel="index">
                    <span itemprop="name">note</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ol>
<li>慎用 setState, 因为他容易导致重复渲染, 请将数据都交给 redux 管理, 再通过 props 传入. 记得使用 shouldComponentUpdate 比较以确定是否需要重新渲染<p></p></li>
<li><p>请将方法的 bind 一律置于 constructor 中, 可以避免重复绑定, 多个实例的构造函数是共享的.</p>
</li>
<li><p>只传递 component 需要的 props, 传递的太多, 或者传递的太深, 都会加重 shouldComponentUpdate 里面的数据复旦</p>
</li>
<li><p>路由控制与拆包, 当项目变得更大规模与复杂的时候, 我们需要设计成 SPA, 这时路由管理就变得非常重要, 这使得特定 url 参数可以对应特定页面</p>
</li>
</ol>
<p></p><p>其他常见:<br>1. 使用 immutable 处理 props, state, store<br>2. 使用 pure-render-decorator 与 immutablejs 搭配使用<br>3. 慎用 setState<br>4. 仅传必要的 props<br>5. 将方法的 bind 置于 constructor</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/08/25/applymiddleware-e4-b8-8e-enhancer/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Chen Yu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="EzCook">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/25/applymiddleware-e4-b8-8e-enhancer/" itemprop="url">
                  applyMiddleware 与 Enhancer
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-25T10:37:57+08:00">
                2016-08-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/note/" itemprop="url" rel="index">
                    <span itemprop="name">note</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <pre><code>import { createStore, applyMiddleware, compose } from &apos;redux&apos;

const store = createStore(
  reducer,
  preloadedState, // &amp;lt;----- 可选，前后端同构的数据同步
  compose( // &amp;lt;------------ 还记得吗？compose 是从右到左的哦！
    applyMiddleware( // &amp;lt;-- 这货也是 Store Enhancer 哦！但这是关乎中间件的增强器，必须置于 compose 执行链的最后
      middleware1,
      middleware2,
      middleware3
    ),
    enhancer3,
    enhancer2,
    enhancer1
  )
)
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/08/24/redux-apis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Chen Yu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="EzCook">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/24/redux-apis/" itemprop="url">
                  Redux APIs
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-24T12:17:39+08:00">
                2016-08-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/note/" itemprop="url" rel="index">
                    <span itemprop="name">note</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Compose-…funcs"><a href="#Compose-…funcs" class="headerlink" title="Compose(…funcs)"></a>Compose(…funcs)</h3><pre><code>/**
 * compose(f,h,g)(...args) =&amp;gt; f(g(h(...args)))
 * 使用了 reduceRight, 从右开始执行
 * @param {多个函数, 逗号隔开}
 * @return {函数}
 */

export default function compose(...funcs){
  if(funcs.length === 0){
    return arg =&amp;gt; arg
  }

  if(funcs.length === 1){
    return funcs[0]
  }

  const last = funcs[funcs.length - 1]
  const rest = funcs.slice(0,-1)
  return (...args) =&amp;gt; rest.reduceRight((composed, f) =&amp;gt; f(composed), last(...args))
}
`&lt;/pre&gt;

关键在于 reduceRight 可以传入初值

### createStore(reducer, [initialState])

&lt;pre&gt;`import isPlainObject from &apos;lodash/isPlainObject&apos;
import $$observable from &apos;symbol-observable&apos;

export var ActionTypes = {
  INIT: &apos;@@redux/INIT&apos;
}

export default function createStore(reducer, preloadState, enhancer){
  var currentReducer = reducer
  var currentState = preloadState
  var currentListeners = []
  var nextListeners = currentListeners
  var isDispatching = false
}

function ensureCanMutateNextListeners(){
  if(nextListeners === currentListeners){
    nextListeners = currentListeners.slice()
  }
}

function getState(){
  return currentState
}

function subscribe(listener){
  if(typeof listener !== &apos;function&apos;){
    throw new Error(&apos;Expected listener to be a function&apos;)
  }

  var isSubscribed = true

  ensureCanmutateNextListener()
  nextListeners.push(listener)

  return function ubsubscribe(){
    if(!isSubscribe){
      return
    }
    isSubscribe = false

    ensureCanMutateNextListeners()
    var index = nextListeners.indexOf(listener)
    nextListeners.splice(index,1)
  }
}

function dispatch(action){
  if(isPlainObecjt(action)){
    throw new Error(&apos;Action must be plain objects &apos; + &apos;Use custom middleware for async action&apos;)
  }

  if(typeof action.type === &apos;undefined&apos;){
    throw new Error(&apos;Actions may not have an undefined &quot;type&quot; property. &apos; + &apos;Have you misspelled a constant?&apos;)
  }

  if(isDispatching){
    throw new Error(&apos;Reducers may not dispatch actions.&apos;)
  }

  try{
    isDispatching = true
    currentState = currentReducer(currentState, action)
  } finally {
    isDispatching = false
  }

  var listeners = currentListeners = nextListeners

  for(var i = 0; i&amp;lt; listeners.length, i++){
    listeners[i]()
  }

  return action
}

function replaceReducer(nextReducer){
  if(typeof nextReducer !== &apos;function&apos;){
    throw new Error(&apos;Expected the nextReducer to be a function&apos;)
  }

  currentReducer = nextReducer
  dispatch({type:ActionTYpes.INIT})
}

### combineReudcers(reducers)

`&lt;/pre&gt;

import { combineReducers } from &apos;redux&apos;
import counterReducer from &apos;./counterReducer&apos;
import todosReducer from &apos;./todosReducer&apos;

const rootReducer = combineReducers({
  counter: counterReducer,   // &amp;lt;--- 键名是 state 中的属性, 键值是对应 reducer 函数名

  todos: todosReducer
})
export default rootReducer

&lt;pre&gt;`
如果提高需求
`&lt;/pre&gt;

state
  ├── counter: 0
  ├── todo
        ├── optTime: []
        ├── todoList: [] # 这其实就是原来的 todos！

&lt;pre&gt;`
对应的 reducers 是:
`&lt;/pre&gt;

reducers/
   ├── index.js &amp;lt;-------------- combineReducers (生成 rootReducer)
   ├── counterReducer.js
   ├── todoReducers/ &amp;lt;--------- combineReducers
           ├── index.js
           ├── optTimeReducer.js
           ├── todoListReducer.js

&lt;pre&gt;`
`&lt;/pre&gt;

/*  reducers/index.js */
import { combineReducers } from &apos;redux&apos;
import counterReducer from &apos;./counterReducer&apos;
import todosReducers from &apos;./todosReducer&apos;

const rootReducer = combineReducers({
  counter: counterReducer,
  todos: todosReducers
})

export default rootReducer

=================================================

/* reducers/todosReducers/index.js */

import { combineReducers } from &apos;redux&apos;
import optTimeReducer from &apos;./optTimeReducer&apos;
import todoListReducer from &apos;./todoListReducer&apos;

const todosReducers = combineReducers({
  optTime: optTimeReducer,
  todoList: todoListReducer
})

export default todosReducers

&lt;pre&gt;`
无论 dispatch 哪个 action 都会流通**所有** reducer, 但是由于 reducer 是纯函数, 效率还是会提高.

### BindActionCreator

### applyMiddlware(...middlewares)

先要理解 Middleware, enhancer

Redux 引入中间件机制是为了在 dispatch 前后进行处理

`&lt;/pre&gt;

const printStateMiddleware = ({getState}) =&gt; next =&gt; action =&gt; {
  console.log(&apos;...&apos;)
  let returnValue = next(action)
  console.log(&apos;...&apos;)
  return returnValue
}

&lt;pre&gt;`
实际上最内层
`&lt;/pre&gt;

function printStateMiddleware(middlewareAPI){ //中间件内可以使用的 API, 如 getState 与 dispatch
   return function(dispatch){ // 传入原 dispatch 的引用
    return function(action){
      console.log(...)
      var returnValue = dispatch(action)  //  执行 dispatch 行为, dispatch(action) 返回的还是 action
      console.log(...)
      return returnValue // 传给下一个中间件的 action
    }
   }
}

&lt;pre&gt;`
### Store Enhancer

说白了 Store Enhancer 是对生成 store 的 API 的改造, 与 middleware 的最大区别是 middlewere 不修改 store 的 API

改造 store 的 API 就要从 createStore 入口

Redux 的 applyMiddleware 就是一个 Enhancer

`&lt;/pre&gt;

import compose from &apos;./compose&apos; // 作用就是层层包裹

// 传入中间件
export default function applyMiddleware(...middlewares){
  // 传入 createStore
  return function(createStore){
    // 返回一个函数签名和 createStore 一样的函数, 即返回一个增强版的 createStore
    return function(reducer, preloadState, enhancer){
      // 用原 createStore 先生成一个 store, 包含 getState, dispatch, subscribe, replaceReducer 四个 API
      var store = creataStore(reducer, preloadState, enhancer)

&lt;pre&gt;`  var dispatch = store.dispatch //  生成指向原 dispatch的引用
  var chain = [] // 存储中间件的数组

  //提供给中间件的 API 其实就是 store 的 API
  var middlewareAPI = {
    getState: store.getStore,
    dispatch: (action) =&amp;gt; dispatch(action)
  }

  // 给中间件添加 API
  chain = middlewares.map(middleware =&amp;gt; middleware(middlewareAPI))

  // 串联中间件, 添加中间件的起点 store.dispatch, 返回经过修饰的 dispatch
  dispatch = compose(...middlewares)(store.dispatch)

  return{
    ...store, // store 中保留的原 API
     dispatch  // 用新的 dispatch 覆盖原 dispatch   
  }
}
</code></pre><p>}<br>}<br>```<br><a href="https://cnodejs.org/topic/57bd23ee1d27b9113348a546" target="_blank" rel="external">参考</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/08/23/middleware/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Chen Yu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="EzCook">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/23/middleware/" itemprop="url">
                  Middleware
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-23T11:14:07+08:00">
                2016-08-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/note/" itemprop="url" rel="index">
                    <span itemprop="name">note</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>You can include custom middleware functions to the dispatch method of your store.</p>
<p>The dispatch function is responsible for sending actions to one or more reducer functions for state changes. The composed specialized functions around the original dispatch method creates the new middleware capable dispatch method.</p>
<p>Source code for applyMiddleware(from Redux 1.0.1)</p>
<pre><code>export default function applyMiddleware(...middlewares) {
  return (next) =&amp;gt; 
    (reducer, initialState) =&amp;gt; {
      var store = next(reducer, initialState);
      var dispatch = store.dispatch;
      var chain = [];

      var middlewareAPI = {
        getState: store.getState,
        dispatch: (action) =&amp;gt; dispatch(action)
      };

      chain = middlewares.map(middleware =&amp;gt; middleware(middlewareAPI));

      return {
        ...store,
        dispatch
      }
    }
}
`&lt;/pre&gt;

Composing Functions

Functional programming is very literal and very mathematical. In the case of composing functions with math you can express two or more functions like this:

&lt;pre&gt;`given:

f(x) = x^2 + 3x + 1
g(x) = 2x

then:
(f · g)(x) = f(g(x)) = f(2x) = 4x^2 + 6x + 1
`&lt;/pre&gt;

It is no coincidence that you can compose two or more functions in a similar fashion. Here is a very simple example of a function that composes two functions to return a new specialized function:

&lt;pre&gt;`var greet = function(x) { return `Hello, ${x}`}
var emote = function(x) { return `${x} :)`}

var compose = function(f,g){
  return function(x){
    return f(g(x))
  }
}
`&lt;/pre&gt;

This was just to illustrate the basic concept. We will look at a more generic way to solve that issue by examining the Redux Code.

### Currying

Another powerful functional programming concepts is the idea of currying or partially applying argument values to a function. By currying we can create a new specialized function that has partial information supplied to it. Here is the canonical example of currying where we have an add function that curries the first operand parameter to create a specialized add function

&lt;pre&gt;`var curriedAdd = function(a){
  return function(b){
    return a + b;
  }
}

var addTen = curriedAdd(10);
addTen(10); // 20
`&lt;/pre&gt;

By currying and composing your functions you can create powerful new functions that create a pipeline for data processing.

### Redux Dispatch Function

A Store in Redux have a dispatch method which is only concerned with the main execution task you are interested in. You dispatch actions to your reducer functions to update state of the application. Redux reducers function takes a state and action parameter and return a new resultant state.

&lt;pre&gt;`reducer:: state -&amp;gt; action -&amp;gt; state
`&lt;/pre&gt;

You might dispatch an action that simply sends a message to remove an item in a list which could look like this:

&lt;pre&gt;`{type: types.DELETE_ITEM, id: 10}
`&lt;/pre&gt;

The store will dispatch this action object to all of it&apos;s reducer functions which could affect state. However the reducer functions are only concerned with executing logic around this deletion. They typically don&apos;t care who did it, how long it took, or logging the before and after effects of the state changes. This is where middleware can help us to address non-core concerns.

### Redux middleware

Redux middleware is designed by creating functions that can be composed together before the main dispatch method is invoked.

Let&apos;s creating a very simple logger middleware function that can echo the state of your application before and after running your main dispatch function. Redux middleware functions have this signiture:

&lt;pre&gt;`middleware:: next -&amp;gt; action -&amp;gt; retVal
`&lt;/pre&gt;

It might look something like this:

&lt;pre&gt;`export default function createLogger({getState}){
  return (next) =&amp;gt; 
    (action) =&amp;gt; {
      const console = window.console;
      const prevState = getState();
      const returnValue = next(action);
      const nextState = getState();
      const actionType = String(action.type);
      const message = `action ${actionType}`;

      console.log(`%c prev state`, `color: #9e9e9e`, prevState);
      console.log(`%c action`, `color: #03A9F4`, action);
      console.log(`%c next state`, `color:#4CAF50`, nextState)
    };
}
`&lt;/pre&gt;

Notice that createLogger accepts the getState method which is injected by applyMiddleware.js and used inside closure to read the current state. This will return a new function with the `next` parameter which is used to compose the next chained middleware function or the main dispatch function.

This function returns a curried function that accepts the action object which can be read or modified before sending it to the next middleware function in the chain. Finally the main dispatch function is invoked with the action object.
</code></pre><ul>
<li>First it captures the previous state</li>
<li>The action is dispatched to the next middleware function</li>
<li>All downstream middleware functions in the chain are invoked</li>
<li>The reducer functions in the store are called with the action payload</li>
<li><p>The logger middleware the gets the resulting next state</p>
<h3 id="Dissecting-applyMiddleware-js"><a href="#Dissecting-applyMiddleware-js" class="headerlink" title="Dissecting applyMiddleware.js"></a>Dissecting applyMiddleware.js</h3><pre>`export default function applyMiddleware(...middlewares){
  return (next) =&gt; 
    (reducer, initialState) =&gt; {
      var store = next(reducer, initialState);
      var dispatch = store.dispatch;
      var chain = [];

      var middlewareAPI = {
        getState: store.getState,
        dispatch: (action) =&gt; dispatch(action)
      };

      chain = middlewares.map(middleware =&gt; middleware(middlewareAPI));

      dispatch = compose(...chain, store.dispatch);

      return{
        ...store,
        dispatch
      };
    };
}
`</pre>

<p>The applyMiddleware function probably could have been named a little better, such as applyMiddlewareToStore.</p>
<p>The applyMiddleware function returns a function that takes a mysterious next argument:</p>
<pre>`return (next) =&gt; (reducer, initialState) =&gt; {...}
`</pre>

<p>The next argument will be a function that is used to create a store. By default you should look at the implementation for createStore. The final returned function will be like createStore and replace the dispatch function with it’s associated middlewares.</p>
<p>Next we assign the store implementation to the function responsible for creating the new store. Then we create a variable to the store’s original dispatch function. Finally we setup an array to hold the middleware chain we will be creating.</p>
<pre>`var store = next(reducer, initialState)
var dispatch = store.dispatch
var chain = [];
`</pre>

<p>This next bit of code injects the getState function and the original dispatch function from the store into each middleware function which you can optionally use in your middleware(the applyMiddleware function pass getState and dispatch to middlewares in it).</p>
<p>The resultant middleware is stored in the chain array</p>
<pre>`var middlewareAPI = {
  getState: store.getState,
  dispatch: (action) =&gt; dispatch(action)
}

chain = middlewares.map(middleware =&gt; middleware({middlewareAPI}))
`</pre>

<p>Now we create our replacement dispatch function with the information about hte middleware chain:</p>
<pre>`dispatch = compose(...chain, store.dispatch);
`</pre>

<p>The magic to composing our middleware chain lies in this utility function supplied by Redux. Here is the implementation</p>
<pre>`export default function compose(...funcs){
  return funcs.reduceRight((compsed,f) =&gt; f(composed))
}
`</pre>

<p>The composing function will literally express your functions as a composition injecting each middleware as an argument to the next middleware in the chain. Order is important here when assembling your middleware function. Finally, the original store dispatch method is composed. This new looks like:</p>
<pre>`middlewareI(middlewareJ(middlewareK(store.dispatch)))(action)
`</pre>

<p>The final thing to do is return the new store object with the overriden function:</p>
<pre>`return {
  ...store,
  dispatch
}
`</pre>

<p>Let’s add our logger middleware we started above into a custom store with the enhanced dispatch function.</p>
<pre>`import { createStore, applyMiddlware } from 'redux'
import loggerMiddleware from 'logger'
import rootReducer from './reducers'

const createStoreWithMiddleware = applyMiddleware(loggerMiddleware)(createStore)

export default function configureStore(initialState){
  return createStoreWithMiddleware(rootReducer, initialState);
}

const store = configureStore()
`</pre>

<h3 id="Asynchronous-Middleware"><a href="#Asynchronous-Middleware" class="headerlink" title="Asynchronous Middleware"></a>Asynchronous Middleware</h3><p>Once you get comfortable with the basics of Redux middleware you will likely want to work with asynchronous actions that involve some sort of asynchronous execution. In particular look at ‘redux-thunk’ for more details. Let’s say you have an action creator that has some async functionality to get stock quote information:</p>
<pre>`function fetchQuote(symbol){
  requestQuote(symbol);
  return fetch('......')
         .then(req =&gt; req.json())
         .then(json =&gt; showCurrentQuote(symbol, json));
}
`</pre>

<p>There is no obvious way here to dispatch an action that would be returned from the fetch which is Promise based. Plus we do not have a handle to the dispatch function. Therefore we can use the redux-thunk middleware to defer execution of these operations. By wrapping the execution in a function you can delay this execution:</p>
<pre>`function fetchQuote(symbol){
  return dispatch =&gt; {
    dispatch(requestQuote(symbol));
    return fetch('......').then(req=&gt;req.json).then(json =&gt; dispatch(showCurrentQuote(symbol,json))
  }
}
`</pre>

<p>Remember that the applyMiddleware function will inject the <code>dispatch</code> and the <code>getStat</code> function as parameters int o the redux-thunk middleware. Now you can dispatch the resultant action objects to your store which conatains reducers. Here is the middleware function for redux-thunk that does this for you.</p>
<p><pre>`export default function thunkMiddleware({dispatch,getState}){<br>  return (next) =&gt; </pre></p>
<pre><code>action =&amp;gt; {
  typeof action === &apos;function&apos;? action(dispatch, getState):next(action)
}
</code></pre><p>}</p>
</li>
</ul>
<p>If the action is a function it will be called with the dispatch and getState function..</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/08/22/connect-e7-9b-b8-e5-85-b3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Chen Yu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="EzCook">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/22/connect-e7-9b-b8-e5-85-b3/" itemprop="url">
                  Connect 相关
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-22T10:53:22+08:00">
                2016-08-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/note/" itemprop="url" rel="index">
                    <span itemprop="name">note</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="预备知识"><a href="#预备知识" class="headerlink" title="预备知识"></a>预备知识</h1><p>回顾一下 Redux 基本用法</p>
<pre><code>const reducer = (state = {count: 0}, action ) =&amp;gt; {
  switch(action.type){
  case &quot;INCRESE&quot;: return {count: state.count + 1}
  case &quot;DECRESE&quot;: return {count: state.count - 1}
  default: return state;
  }
}

const actions = {
  increase: () =&amp;gt; { type: &apos;INCREASE&apos;},
  decrease: () =&amp;gt; { type: &apos;DECREASE&apos;}
}

const store = createStore(reducer);

store.subscribe(()=&amp;gt;{
  console.log(store.getState())
});

store.dispatch(action.increase());
`&lt;/pre&gt;

通过 reducer 创建一个 store, 每当我们在 store 上 dispatch 一个 action, store 内的数据就会通过 reducer 变化.

我们当然可以直接在 React 中使用 Redux, 在最外层容器中初始化 store, 然后将 state 上的属性作为 props 层层传下去

&lt;pre&gt;`class App extends Component{
  componentWillMount(){
    store.subscribe((state) =&amp;gt; this.setState(state))
  }
  render(){
    return &amp;lt;Comp state={this.state} onIncrease = {()=&amp;gt;store.dispatch(actions.increase())} onDecrease = {()=&amp;gt; store.dispatch(actions.decrease())}
  } /&amp;gt;
}
`&lt;/pre&gt;

但这不是最佳方式, 最佳方式是使用 react-redux 提供的 Provider 和 connect 方法

### 使用 React-redux

首先在最外层容器中, 把所有内容包裹在 Provider 组件中, 将之前创建的 store 作为 prop 传递给 Provider

&lt;pre&gt;`const App = () =&amp;gt; {
  return(
    &amp;lt;Provider store = {store}&amp;gt;
      &amp;lt;Comp /&amp;gt;
    &amp;lt;/Provider&amp;gt;
  )
}
`&lt;/pre&gt;

Provider 中的任何一个组件(比如这里的 Comp) 如果需要使用 state 中的数据, 就必须是 `被 connect 过的`组件, 使用 connect 方法对你编写的组件(MyComp)进行包装后的产物.

&lt;pre&gt;`class MyComp extends Component {
  // content...
}

const Comp = connect(...args)(MyComp);
`&lt;/pre&gt;

可见 connect 是重中之重

### connect 详解

究竟 connect 做了什么

首先看一下函数的签名:

&lt;pre&gt;`connect([mapStatToProps], [mapDispatchToProps], [mergeProps], [options])
`&lt;/pre&gt;

connect() 函数接受四个参数, 分别是

&lt;pre&gt;`mapStatToProps, mapDispatchToProps, mergeProps, options
`&lt;/pre&gt;

&lt;pre&gt;`mapStatToProps(state, ownProps): stateProps
`&lt;/pre&gt;

这个函数允许我们将 store 中的数据作为 props 绑定到组件上

&lt;pre&gt;`const mapStatToProps = (state) =&amp;gt; {
  return {
    count: state.count
  }
}
`&lt;/pre&gt;

这个函数的第一个参数就是 Redux 的 store, 我们从中摘取 count 属性, 因为返回了具有 count 属性的对象, 所以 MyComp 会有名为 count 的 props 字段

&lt;pre&gt;`class MyComp extends Component{
  render(){
    return &amp;lt;div&amp;gt;Count: {this.props.count}&amp;lt;/div&amp;gt;
  }
}

const Comp = connect(...args)(MyComp);
`&lt;/pre&gt;

当然你不必将 state 原封不动传递给组件, 可以根据 state 中的数据, 动态的输出组件需要的(最小)属性

&lt;pre&gt;`const mapStateToProps = (state) =&amp;gt; {
  return {
    greaterThanFive: state.count &amp;gt; 5
  }
}
`&lt;/pre&gt;

第二个参数 ownProps, 是 MyComp 自己的 props, 有时候 ownProps 也会对其产生影响, 比如当你在 store 中维护一个用户列表, 而你的组件 MyComp 只关心一个用户(通过 props 中的 userId体现)

&lt;pre&gt;`const mapStateToProps = (state, ownProps) =&amp;gt; {
  // state 是{ userList:[{id:0,name;&apos;王二&apos;}]}
  return {
    user: _.find(state.userList, {id:ownProps.userId})
  }
}

class MyComp extends Component{
  static PropTypes = {
    userId: PropTypes.string.isRequired,
    user: PropTypes.object
  };
  render(){
    return &amp;lt;div&amp;gt;UserName: {this.props.user.name}&amp;lt;/div&amp;gt;
  }
}

const Comp = connect(mapStateToProps)(MyComp)
`&lt;/pre&gt;

当 state 变化, 或者 ownProps 变化时, mapStateToProps 都会被调用, 计算出一个新的 stateProps , 在与 ownProps merge 后, 更新给 MyComp

这就是将 Redux store 中的数据连接到组件的基本方法

mapDispatchToProps(dispatch, ownProps): dispatchProps

connect 的第二个参数是 mapDispatchToProps, 功能是将 action 作为 props 绑定到 MyComp 上

&lt;pre&gt;`const mapDispatchToProps = (dispatch, ownProps) =&amp;gt; {
  return {
    increase: (...args) =&amp;gt; dispatch(actions.increase(...args)),
    decrease: (...args) =&amp;gt; dispatch(actions.decrease(...args))
  }
}

class MyComp extends Component{
  render(){
    const {count, increase, decrease} = this.props
    return (
      &amp;lt;div&amp;gt;
        &amp;lt;div&amp;gt;Count:{count}&amp;lt;/div&amp;gt;
        &amp;lt;button onClick={increase}&amp;gt;+&amp;lt;/button&amp;gt;
        &amp;lt;button onClick={decrease}&amp;gt;-&amp;lt;/button&amp;gt;
      &amp;lt;/div&amp;gt;
    )
  }
}

const Comp = connect(mapStateToProps, mapDispatchToProps)(MyComp)
`&lt;/pre&gt;

由于 mapDispatchToProps 方法返回了具有 increase 属性和 decrease 属性的对象, 这两个属性也会成为 MyComp 的 props

如上所示, 调用 actions.increase()只能得到一个 action 对象{type:&apos;INCREASE&apos;}, 要触发这个 action 必须要通过 dispatch 调用, dispatch 正式 mapDispatchToProps 的第一个参数, 但是为了不让 MyComp 组件感知到 dispatch 的存在, 我们需要将 increase 和 decrease 方法包装一下, 使之成为直接可以被调用的函数(即触发该方法就会触发 dispatch)

Redux 本身提供了 bindActionCreator 函数, 来将 action 包装成可以直接被调用的函数

&lt;pre&gt;`import {bindActionCreator} from &apos;redux&apos;
const mapDispatchToProps = (dispatch,ownProps) =&amp;gt; {
  return bindActionCreator({
    increase: actions.increase,
    decrease: actions.decrease
  })
}
</code></pre><p>同样当 ownProps 变化时, 该函数也会被调用, 生成一个新的 dispatchProps( 在与 stateProps 和 ownPorps merge 后), 更新给 MyComp. 注意 action 的变化不会引起上述过程, 默认 action 在组件的生命周期中是固定的</p>
<p>[mergeProps(stateProps, dispatchProps, ownProps): props]</p>
<p>之前说过不管是 stateProps 还是 dispatchProps, 都需要和 ownProps merge 之后才会被赋给 MyComp, connect 的第三个参数就是来做这个事情的, 通常情况下不需要传这个参数, connect 会使用 Object.assign 方法代替该方法.</p>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p>最后还有一个 options 参数, 比较简单, 一般也不会用到.</p>
<p><a href="http://taobaofed.org/blog/2016/08/18/react-redux-connect/" target="_blank" rel="external">参考</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/08/22/configuring-eslint/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Chen Yu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="EzCook">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/22/configuring-eslint/" itemprop="url">
                  Configuring ESLint
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-22T02:27:49+08:00">
                2016-08-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/note/" itemprop="url" rel="index">
                    <span itemprop="name">note</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ol>
<li>Configuration Comments - use JS comments to embed configuration information directly into a file.<p></p></li>
<li>Configuration Files - use a JS, JSON, or YAML file to specify configuration information for an entire directory and all of its subdirectories. This can be in the form of an <code>.eslintrc</code> file or an <code>eslintConfig</code> field in a <code>package.json</code> file, both of which ESLint will look for and reed automatically, or you can specify a configuration file on the command line.</li>
</ol>
<h3 id="Specifying-Parser-Options"><a href="#Specifying-Parser-Options" class="headerlink" title="Specifying Parser Options"></a>Specifying Parser Options</h3><p></p><p>ESLint allows you to specify the JS language options you want to support. By Default, ESLint support only ES5 syntax. You can override that setting to enable support for ES6 and 7 as well as JSX by using parser options.</p>
<p>Parser options are set in your <code>.eslintrc</code> file by using the <code>parserOptions</code> property. The available options are:</p>
<ul>
<li><code>ecmaVersion</code> - set to 3, 5(default), 6 or 7 to specify the version of ECMAScript you want to use.</li>
<li><code>sourceType</code> - set to <code>&quot;script&quot;</code> (default) or <code>&quot;module&quot;</code> if your code is in ECMAScript modules.</li>
<li><p><code>emcaFeatures</code> - an object indicating which additional language features you’d like to use:</p>
<pre><code>*   `globalReturn` - allow `return` statements in the global scope.
</code></pre><ul>
<li><code>impliedStrict</code> - enable global <code>strict mode</code> (if <code>ecmaVersion</code> is 5 or greater)</li>
<li><code>jsx</code>: enable <code>JSX</code></li>
<li><code>experimentalObjectRestSpread</code> - enable support for the experimental <code>object rest/spread properties</code></li>
</ul>
</li>
</ul>
<p>An example:</p>
<pre><code>{
  &quot;parserOptions&quot;:{
    &quot;emcaVersion&quot;: 6,
    &quot;sourceType&quot;: &quot;module&quot;,
    &quot;ecmaFeatures&quot;: {
      &quot;jsx&quot;: true
    }
  },
  &quot;rules&quot;:{
    &quot;semi&quot;: 2
  }
}
`&lt;/pre&gt;

### Specifying Parser

By Default, ESLint uses `Espree` as its parser. You can optionally specify that a different parser should be used in your configuration file so long as the parser meets the following requirements:
</code></pre><ul>
<li>It must be an npm module installled locally;</li>
<li>It must have an Esprima-compatible interface</li>
<li><p>It must produce Esprima-compatible AST and token objects.</p>
<h3 id="Specifying-ENV"><a href="#Specifying-ENV" class="headerlink" title="Specifying ENV"></a>Specifying ENV</h3></li>
<li><p>browser</p>
</li>
<li>node</li>
<li>commonjs</li>
<li>es6</li>
<li><p>mocha</p>
<pre>`{
  "env":{
    "browser": true,
    "node": true
  }
}

### Configuring Rules

ESLint comes with a large number of rules, you can modify which rules your project use either using configuration comments or configuration files. To change a rules setting, you must set the rule ID equal to one of these values: 

- `"off"` or `0` to turn rule off.
- `"warn"` or `1` to turn the rule as a warning(doesn't affect exit code)
- `"error"` or `2` to turn the rule on as an error(exit code is 1 when triggered)

### Demo

`</pre>

<p>npm install -g eslint</p>
<p><pre>`</pre></p>
</li>
</ul>
<p>eslint –init<br><code>``
生成</code>.eslintrc.js`</p>
<p>但是这个文件最好手动生成</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/08/21/js-e5-bc-80-e5-8f-91-e5-b7-a5-e5-85-b7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Chen Yu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="EzCook">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/21/js-e5-bc-80-e5-8f-91-e5-b7-a5-e5-85-b7/" itemprop="url">
                  JS 开发工具
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-21T07:12:50+08:00">
                2016-08-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/note/" itemprop="url" rel="index">
                    <span itemprop="name">note</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>开发工具是让开发人员工作更轻松的一些软件, 传统上包括集成开发环境, 代码检查工具, 编译器, 调试工具和性能测试工具</p>
<p>但是 JS 是一种动态语言, 伴随他动态本质而来的是对更多运行时开发者工具的需求.</p>
<h4 id="Quick-List"><a href="#Quick-List" class="headerlink" title="Quick List"></a>Quick List</h4><ul>
<li>Atom &amp; Atom-ternjs</li>
<li>Chrome DevTools</li>
<li>PageSpeed Insights</li>
<li>BrowserSycn</li>
<li>TraceGL</li>
<li>ironNode</li>
<li>ESLint</li>
<li>Babel</li>
<li>React</li>
<li>Webpack + Hot Module Replacement</li>
<li>Redux + Redux DevTools</li>
</ul>
<p>关于工具, 主要是编辑器和运行时环境(比如浏览器)</p>
<p>主要用 Atom, 需要 atom-ternjs 来开启 JavaScript 智能识别</p>
<p>很多很棒的 <a href="https://medium.com/@satya164/supercharged-javascript-development-in-atom-ea034e22eabc#.a2b8sthbw" target="_blank" rel="external">Atom 插件</a></p>
<p>调试器: Chrome DevTools, 注意其 flame charts 和 dominators view 功能</p>
<p>性能审查: <a href="https://www.youtube.com/watch?list=PLOU2XLYxmsILKwwASNS0xgfcmakbK_8JZ&amp;v=bDUDuQy3R7Y" target="_blank" rel="external">PageSpeed Insights</a></p>
<p>BrowserSync是一款测试响应式布局非常好用的工具, 可以一次模拟多种浏览器(电脑, 平板, 手机)<br>可以监视文件, 并在文件修改的时候自动重载同步刷新浏览器, 像滚动, 点击, 表单交互等动作也会跨设别同步.</p>
<p><a href="https://www.youtube.com/watch?v=heNWfzc7ufQ" target="_blank" rel="external">视频链接</a></p>
<p>TraceGL 是一种运行时调试工具, 可以让你在软件中的方法实时调用时观察他们, 而不是手动逐步跟踪代码</p>
<p><a href="https://www.youtube.com/watch?v=heNWfzc7ufQ" target="_blank" rel="external">视频链接</a></p>
<p>代码检查: ESLint 可配置性特别强, 每一个选项都可以设置开启或禁用, 甚至给他们添加参数. 可以创建自己的规则, 支持插件</p>
<p>Babel 是一种编译器, 可以让现在的 JS 代码使用 ES6+ 尚未支持的特性, JSX 等, 工作原理是讲代码转换为等价的 ES5.</p>
<p><a href="https://medium.com/javascript-scene/how-to-use-es6-for-isomorphic-javascript-apps-2a9c3abe5ea2" target="_blank" rel="external">文章链接</a></p>
<p>Webpack 会将模块和以来打包成针对浏览器的静态资源, 他支持大量有趣的特性, 比如模块热拔插, 可以让当前浏览器中的代码在你修改文件的时候自动更新, 而不用刷新页面. 模块热拔插</p>
<p><a href="https://github.com/cloverfield-tools/universal-react-boilerplate" target="_blank" rel="external">参考资料</a></p>
<p>React: 不算开发者工具</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/5/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><a class="extend next" rel="next" href="/page/7/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Chen Yu" />
          <p class="site-author-name" itemprop="name">Chen Yu</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">166</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">7</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">48</span>
                <span class="site-state-item-name">标签</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Chen Yu</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  








  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  




	





  





  





  






  





  

  

  

  

  

</body>
</html>
