<!DOCTYPE html>
<html  lang="en">
<head>
    <meta charset="utf-8">
<title>EzCook</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />







<link rel="icon" href="/images/logo.png">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css">


    
    
    
    <style>body>.footer,body>.navbar,body>.section{opacity:0}</style>
    

    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">
    

    
    

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">


    
    
    
    

<link rel="stylesheet" href="/css/back-to-top.css">


    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-136207372-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-136207372-1');
</script>


    
    
<link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>

    
    
    

    
    
    
        <script async="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    

    


<link rel="stylesheet" href="/css/style.css">
</head>
<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/logo.png" alt="EzCook" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item"
                href="/">Home</a>
                
                <a class="navbar-item"
                href="/archives">Archives</a>
                
                <a class="navbar-item"
                href="/categories">Categories</a>
                
                <a class="navbar-item"
                href="/tags">Tags</a>
                
                <a class="navbar-item"
                href="/about">About</a>
                
            </div>
            
            <div class="navbar-end">
                
                    
                    
                    <a class="navbar-item" target="_blank" title="GitHub" href="https://github.com/keith-CY">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                    
                    <a class="navbar-item" target="_blank" title="Gmail" href="mailto:keithwhisper@gmail.com">
                        
                        <i class="fas fa-envelope"></i>
                        
                    </a>
                    
                
                
                
                <a class="navbar-item search" title="Search" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-6-widescreen has-order-2 column-main">
    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-09-03T15:42:25.000Z">2017-09-03</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    a minute read (About 212 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/09/03/service-worker-with-webpack/">Service-Worker With Webpack</a>
            
        </h1>
        <div class="content">
            <figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev sw-precache-webpack-plugin</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// webpack</span></span><br><span class="line"><span class="hljs-keyword">new</span> SWPrecachePlugin(&#123;</span><br><span class="line">  cacheId: <span class="hljs-string">'demo'</span>,</span><br><span class="line">  filename: <span class="hljs-string">'service-worker.js'</span>,</span><br><span class="line">  dontCacheBustUrlsMatching: <span class="hljs-literal">false</span>,</span><br><span class="line">  staticFileGlobsIgnorePatterns: [</span><br><span class="line">    /index\.html$/,</span><br><span class="line">    /\.map$/,</span><br><span class="line">    /\.css$/,</span><br><span class="line">    /\.svg$/,</span><br><span class="line">    /\.eot$/,</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>This will generate <code>service-worker.js</code> in dist.</p>
<h3 id="Add-Router"><a href="#Add-Router" class="headerlink" title="Add Router"></a>Add Router</h3><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.use(<span class="hljs-string">'/service-worker.js'</span>, serve(<span class="hljs-string">'./dist/service-worker.js'</span>))</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note: <code>[name].[ext]?[hash]</code> will not be found by sw-precache(hash will be ignored), so filename should be specified like <code>[name].[hash].[ext]</code> or so.</p>
</blockquote>
<h3 id="Cache-files-who-are-not-bundled-by-webpack"><a href="#Cache-files-who-are-not-bundled-by-webpack" class="headerlink" title="Cache files who are not bundled by webpack."></a>Cache files who are not bundled by webpack.</h3><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">new</span> SWPrecachePlugin(&#123;</span><br><span class="line">  cacheId: <span class="hljs-string">'demo'</span>,</span><br><span class="line">  filename: <span class="hljs-string">'service-worker.js'</span>,</span><br><span class="line">  minify: <span class="hljs-literal">true</span>,</span><br><span class="line">  <span class="hljs-comment">// add two lines</span></span><br><span class="line">  mergeStaticConfig: <span class="hljs-literal">true</span>,</span><br><span class="line">  staticFileBlogs: [</span><br><span class="line">    path.join(__dirname, <span class="hljs-string">'../dist/static/*.*'</span>),</span><br><span class="line">  ],</span><br><span class="line">  dontCacheBustUrlsMatching: <span class="hljs-literal">false</span>,</span><br><span class="line">  staticFileGlobsIgnorePatterns: [</span><br><span class="line">    /\.index\.html$/,</span><br><span class="line">    /\.map$/,</span><br><span class="line">    /\.css$/,</span><br><span class="line">    /\.svg$/,</span><br><span class="line">    /\.eot$/,</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="About-the-Request-URL"><a href="#About-the-Request-URL" class="headerlink" title="About the Request URL"></a>About the Request URL</h3><p>The images are cached in <code>/dist/static/*</code>, while the request url is <code>/static/*</code>.</p>
<p>In dev it can be proxied by webpack.</p>
<p>In prod it can be delegated by nginx.</p>
<p>But the plugin can fix it by itself:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">new</span> SWPrecachePlugin(&#123;</span><br><span class="line">  cacheId: <span class="hljs-string">'demo'</span>,</span><br><span class="line">  filename: <span class="hljs-string">'service-worker.js'</span>,</span><br><span class="line">  minify: <span class="hljs-literal">true</span>,</span><br><span class="line">  mergeStaticConfig: <span class="hljs-literal">true</span>,</span><br><span class="line">  staticFileGlobs: [</span><br><span class="line">    path.join(__dirname, <span class="hljs-string">'../dist/static/*.*'</span>)</span><br><span class="line">  ],</span><br><span class="line">  stripPrefixMulti: &#123;</span><br><span class="line">    [path.join(__dirname, <span class="hljs-string">'../dist/static'</span>)]: <span class="hljs-string">'/static'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  dontCacheBustUrlsMatching: <span class="hljs-literal">false</span>,</span><br><span class="line">  staticFileGlobsIgnorePatterns: [</span><br><span class="line">    /\.index\.html$/,</span><br><span class="line">    /\.map$/,</span><br><span class="line">    /\.css$/,</span><br><span class="line">    /\.svg$/,</span><br><span class="line">    /\.eot$/,</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note: <code>dontCacheBustUrlsMatching: false</code> will set cached key as <code>http://domain/path/to/filename?hash</code>, whose hash will change if the bundled file changed.</p>
</blockquote>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-09-03T15:01:35.000Z">2017-09-03</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    a minute read (About 193 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/09/03/snippets-of-Nginx/">Snippets of Nginx</a>
            
        </h1>
        <div class="content">
            <h3 id="nginx-conf"><a href="#nginx-conf" class="headerlink" title="nginx.conf"></a>nginx.conf</h3><p>One <code>server{}</code> for a site service.</p>
<p>Use <code>location</code> to specify router of requests.</p>
<p><code>proxy_pass target</code> to delegate inverse .</p>
<p><code>root dir</code> to specify static files directory.</p>
<p><code>server_name</code> to set domains whose requests will be handled.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// a node server listening to 3000</span></span><br><span class="line"><span class="hljs-comment">// handle requests from example.com</span></span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">  listen: <span class="hljs-number">80</span>;</span><br><span class="line">  server_name: example.com;</span><br><span class="line">    location / &#123;</span><br><span class="line">      index index.html;</span><br><span class="line">      root: <span class="hljs-regexp">/public/</span>;</span><br><span class="line">      proxy_pass http:<span class="hljs-comment">//location:3000</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Gzip"><a href="#Gzip" class="headerlink" title="Gzip"></a>Gzip</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gzip on;</span><br><span class="line">gzip_proxied any;</span><br><span class="line">gzip_min_length 1024;</span><br><span class="line">gzip_buffers 4 8k;</span><br><span class="line">gzip_types text/css application/javascript application/atom+xml application/rss+xml text/plain image/svg+xml application/json text/javascript;</span><br></pre></td></tr></table></figure>
<h3 id="CORS"><a href="#CORS" class="headerlink" title="CORS"></a>CORS</h3><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen: <span class="hljs-number">80</span>;</span><br><span class="line">  server_name: example.com;</span><br><span class="line"></span><br><span class="line">  location / &#123;</span><br><span class="line">    add_header Access-Control-Allow-Origin: *;</span><br><span class="line">    add_header Access-Control_Allow_Credentials <span class="hljs-literal">true</span>;</span><br><span class="line">    add_header Access-Control-AllowMethods GET,POST,OPTIONS;</span><br><span class="line">    index index.html;</span><br><span class="line">    root: <span class="hljs-regexp">/public/</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="API-delegate"><a href="#API-delegate" class="headerlink" title="API delegate"></a>API delegate</h3><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen: <span class="hljs-number">80</span>;</span><br><span class="line">  server_name: example.com;</span><br><span class="line"></span><br><span class="line">  location /api &#123;</span><br><span class="line">    proxy_pass: https:<span class="hljs-comment">//localhost:3000;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="HTTP-to-HTTPS"><a href="#HTTP-to-HTTPS" class="headerlink" title="HTTP to HTTPS"></a>HTTP to HTTPS</h3><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen: <span class="hljs-number">80</span>;</span><br><span class="line">  server_name: example.com, *.example.com;</span><br><span class="line"></span><br><span class="line">  location / &#123;</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-number">301</span> https:<span class="hljs-comment">//$host$request_uri;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">  listen: <span class="hljs-number">443</span> ssl;</span><br><span class="line">  server_name example.com;</span><br><span class="line">  ssl_certificate /crts/crt.pem; <span class="hljs-comment">// add the certificate</span></span><br><span class="line">  ssl_certificate_key /crts/key.pem</span><br><span class="line">    location / &#123;</span><br><span class="line">      index index.html;</span><br><span class="line">      root: <span class="hljs-regexp">/public/</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-31T01:43:20.000Z">2017-08-31</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    8 minutes read (About 1263 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/31/Manipulate-Data-in-D3/">Manipulate Data in D3</a>
            
        </h1>
        <div class="content">
            <h3 id="Use-data-imported-from-a-csv-file-with-spaces-in-the-header"><a href="#Use-data-imported-from-a-csv-file-with-spaces-in-the-header" class="headerlink" title="Use data imported from a csv file with spaces in the header"></a>Use data imported from a csv file with spaces in the header</h3><p>When importing data from a csv file(dataSpace.csv) that has headers with spaces in the middle of some of the fields there is need to address the data slightly differently in order for it to be used easily in your JavaScript.</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Date Purchased,close</span><br><span class="line">1-May-12,58.13</span><br></pre></td></tr></table></figure>
<p>When we go to import the data using the d3.csv function, we need to reference the <code>Data Purchased</code> column in a way that makes allowances for the space. The following piece of script appears to be the most basic solution.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">d3.csv(<span class="hljs-string">'dataSpace.csv'</span>, (err, data) =&gt; &#123;</span><br><span class="line">  <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;</span><br><span class="line">  data.forEach(<span class="hljs-function"><span class="hljs-params">d</span> =&gt;</span> &#123;</span><br><span class="line">    d.date = parseTime(d[<span class="hljs-string">'Date Purchased'</span>])</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="Histogram"><a href="#Histogram" class="headerlink" title="Histogram"></a>Histogram</h3><p>The <code>d3.histogram</code> function allows us to form our data into ‘bins’ that form <em>‘discrete samples into continous, non-overlapping intervals’</em>.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// dtg,value</span></span><br><span class="line"><span class="hljs-comment">// 01-08-2010,3</span></span><br><span class="line"><span class="hljs-comment">// 01-08-2010,3</span></span><br><span class="line"><span class="hljs-comment">// 01-08-2010,3</span></span><br><span class="line"><span class="hljs-comment">// 01-08-2010,3</span></span><br><span class="line"><span class="hljs-comment">// 01-08-2010,3.1</span></span><br><span class="line"><span class="hljs-comment">// 01-08-2010,3.2</span></span><br><span class="line"><span class="hljs-comment">// 01-08-2010,3.2</span></span><br><span class="line"><span class="hljs-comment">// .</span></span><br><span class="line"><span class="hljs-comment">// .</span></span><br><span class="line"><span class="hljs-comment">// .</span></span><br><span class="line"><span class="hljs-comment">// 31-12-2011,3.2</span></span><br><span class="line"><span class="hljs-comment">// 31-12-2011,3.3</span></span><br><span class="line"><span class="hljs-comment">// 31-12-2011,3.4</span></span><br><span class="line"><span class="hljs-comment">// 31-12-2011,3.5</span></span><br><span class="line"><span class="hljs-comment">// 31-12-2011,3.5</span></span><br><span class="line"><span class="hljs-comment">// 31-12-2011,4.1</span></span><br><span class="line"><span class="hljs-comment">// 31-12-2011,4.9</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// core code</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">const</span> parseDate = d3.timeParser(<span class="hljs-string">'%d-%m-%Y'</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">const</span> xScale = d3.scaleTime()</span><br><span class="line">    .domain([<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-number">2010</span>, <span class="hljs-number">6</span>, <span class="hljs-number">3</span>), <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-number">2012</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>)])</span><br><span class="line">    .rangeRound([, width])</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">const</span> yScale = d3.scaleLinear()</span><br><span class="line">    .range([height, <span class="hljs-number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">const</span> histogram = h3.histogram()</span><br><span class="line">    .value(<span class="hljs-function"><span class="hljs-params">d</span> =&gt;</span> d.date)</span><br><span class="line">    .domain(xScale.domain())</span><br><span class="line">    .thresholds(x.ticks.timeMonth)</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">const</span> _data = data.map(<span class="hljs-function"><span class="hljs-params">d</span> =&gt;</span> (&#123;</span><br><span class="line">  date: parseDate(d.dtg),</span><br><span class="line">  value: d.value,</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">const</span> bins = histogram(_data)</span><br><span class="line"></span><br><span class="line">holder.selectAll(<span class="hljs-string">'rect'</span>)</span><br><span class="line">    .data(bins)</span><br><span class="line">  .enter().append(<span class="hljs-string">'rect'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'class'</span>, <span class="hljs-string">'bar'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'x'</span>, <span class="hljs-number">1</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'transform'</span>, d =&gt; <span class="hljs-string">`translate(<span class="hljs-subst">$&#123;xScale(d.x0)&#125;</span>, <span class="hljs-subst">$&#123;yScale(d.length)&#125;</span>)`</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'width'</span>, d =&gt; (xScale(d.x1 - d.x0) - <span class="hljs-number">1</span>))</span><br><span class="line">    .attr(<span class="hljs-string">'height'</span>, d =&gt; (height - yScale(d.length)))</span><br></pre></td></tr></table></figure>
<p>The key line</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> bins = histogram(_data)</span><br></pre></td></tr></table></figure>
<p>groups the data for the bars.</p>
<h3 id="Tree-Diagram"><a href="#Tree-Diagram" class="headerlink" title="Tree Diagram"></a>Tree Diagram</h3><p>The data requied to produce this type of layout needs to describe the relationships, but this is not necessary an onerous task.</p>
<figure class="highlight json hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Top Node"</span>,</span><br><span class="line">    <span class="hljs-attr">"children"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Bob: Child of Top Node"</span>,</span><br><span class="line">        <span class="hljs-attr">"children"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Son of Bob"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Daughter of Bob"</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Sally: Child of Top Node"</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// core code</span></span><br><span class="line"><span class="hljs-keyword">const</span> treeData = &#123;</span><br><span class="line">  <span class="hljs-string">"name"</span>: <span class="hljs-string">"Top Level"</span>,</span><br><span class="line">  <span class="hljs-string">"children"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="hljs-string">"name"</span>: <span class="hljs-string">"Level 2: A"</span>,</span><br><span class="line">      <span class="hljs-string">"children"</span>: [</span><br><span class="line">        &#123; <span class="hljs-string">"name"</span>: <span class="hljs-string">"Son of A"</span> &#125;,</span><br><span class="line">        &#123; <span class="hljs-string">"name"</span>: <span class="hljs-string">"Daughter of A"</span> &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123; <span class="hljs-string">"name"</span>, <span class="hljs-string">"Leve 2: B"</span>&#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">const</span> margin = &#123;</span><br><span class="line">  top: <span class="hljs-number">40</span>,</span><br><span class="line">  right: <span class="hljs-number">30</span>,</span><br><span class="line">  bottom: <span class="hljs-number">50</span>,</span><br><span class="line">  left: <span class="hljs-number">30</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-keyword">const</span> width = <span class="hljs-number">660</span> - margin.left - margin.right</span><br><span class="line"><span class="hljs-keyword">const</span> height = <span class="hljs-number">500</span> - margin.top - margin.bottom</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// declare a tree layout and assigns the size</span></span><br><span class="line"><span class="hljs-keyword">const</span> treemap = d3.tree()</span><br><span class="line">    .size([width, height])</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// assigns the node data to the tree layout</span></span><br><span class="line"><span class="hljs-keyword">let</span> nodes = d3.hierarchy(treeData)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// map the node data to the tree layout</span></span><br><span class="line">nodes = treemap(nodes)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// append the svg object to the body of the page</span></span><br><span class="line"><span class="hljs-comment">// append a 'group' element to 'svg'</span></span><br><span class="line"><span class="hljs-comment">// move the 'groupd' element to the top left margin</span></span><br><span class="line"><span class="hljs-keyword">const</span> svg = d3.select(<span class="hljs-string">'body'</span>).append(<span class="hljs-string">'svg'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'width'</span>, width + margin.left + margin.right)</span><br><span class="line">    .attr(<span class="hljs-string">'height'</span>, height + margin.top + margin.bottom)</span><br><span class="line"><span class="hljs-keyword">const</span> g = svg.append(<span class="hljs-string">'g'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'transform'</span>, <span class="hljs-string">`translate(<span class="hljs-subst">$&#123;margin.left&#125;</span>, <span class="hljs-subst">$&#123;margin.top&#125;</span>)`</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// add links between nodes</span></span><br><span class="line"><span class="hljs-keyword">const</span> link = g.selectAll(<span class="hljs-string">'.link'</span>)</span><br><span class="line">    .data(nodes.descendants().slice(<span class="hljs-number">1</span>))</span><br><span class="line">  .enter().append(<span class="hljs-string">'path'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'class'</span>, <span class="hljs-string">'link'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'d'</span>, d =&gt; &#123;</span><br><span class="line">      <span class="hljs-keyword">return</span> <span class="hljs-string">`M<span class="hljs-subst">$&#123;d.x&#125;</span>,<span class="hljs-subst">$&#123;d.y&#125;</span>C<span class="hljs-subst">$&#123;d.x&#125;</span>,<span class="hljs-subst">$&#123;(d.y + d.parent.y) <span class="hljs-regexp">/ 2&#125; $&#123;d.parent.x&#125;,$&#123;(d.y + d.parent.y) /</span> <span class="hljs-number">2</span>&#125;</span> <span class="hljs-subst">$&#123;d.parent.x&#125;</span>,<span class="hljs-subst">$&#123;d.parent.y&#125;</span>`</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// add each node as a group</span></span><br><span class="line"><span class="hljs-keyword">const</span> node = g.selectAll(<span class="hljs-string">'.node'</span>)</span><br><span class="line">    .data(nodes.descendants())</span><br><span class="line">  .enter().append(<span class="hljs-string">'circle'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'class'</span>, d =&gt; &#123;</span><br><span class="line">      <span class="hljs-keyword">return</span> <span class="hljs-string">`node <span class="hljs-subst">$&#123;d.children ? <span class="hljs-string">'node--internal'</span> : <span class="hljs-string">'node--leaf'</span>&#125;</span>`</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .attr(<span class="hljs-string">'transform'</span>, d =&gt; &#123;</span><br><span class="line">      <span class="hljs-string">`translate(<span class="hljs-subst">$&#123;d.x&#125;</span>, <span class="hljs-subst">$&#123;d.y&#125;</span>)`</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// add the circle to node</span></span><br><span class="line">node.append(<span class="hljs-string">'circle'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'r'</span>, <span class="hljs-number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// add the text to the node</span></span><br><span class="line">node.append(<span class="hljs-string">'text'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'dy'</span>, <span class="hljs-string">'0.35em'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'y'</span>, d =&gt; (d.children ? <span class="hljs-number">-20</span> : <span class="hljs-number">20</span>))</span><br><span class="line">    .style(<span class="hljs-string">'text-anchor'</span>, <span class="hljs-string">'middle'</span>)</span><br><span class="line">    .text(<span class="hljs-function"><span class="hljs-params">d</span> =&gt;</span> d.data.name)</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// declare a tree layout and assign the size</span></span><br><span class="line"><span class="hljs-keyword">const</span> treemap = d3.tree()</span><br><span class="line">    .size([width, height])</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// assign the data to a hierarchy using parent-child relationships</span></span><br><span class="line"><span class="hljs-keyword">let</span> nodes = d3.hierarchy(treeData)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// maps the node data to the tree layout</span></span><br><span class="line">nodes = treemap(nodes)</span><br></pre></td></tr></table></figure>
<h5 id="d3-hierarchy"><a href="#d3-hierarchy" class="headerlink" title="d3.hierarchy"></a>d3.hierarchy</h5><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> nodes = d3.hierarchy(treeData, d =&gt; d.children)</span><br></pre></td></tr></table></figure>
<p>This assigns a range of properties to each node including:</p>
<ul>
<li><p><code>node.data</code> - the data assocaited with the node(in our case it will include the name accessible as <code>node.data.name</code>).</p>
</li>
<li><p><code>node.depth</code> - a representation of the depth or number of hops from the initial root node.</p>
</li>
<li><p><code>node.height</code> - the greatest distance from any descendants leaf nodes.</p>
</li>
<li><p><code>node.parent</code> - the parent node, or null if it’s the root node.</p>
</li>
<li><p><code>node.children</code> - child nodes or undefined for any leaf nodes.</p>
</li>
</ul>
<p>Above is the vertical tree map code.</p>
<p>If you want a horizontal tree map, you can make a transform like this.</p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/htree-02.png" alt=""></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/htree-03.png" alt=""></p>
<p>Or</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.attr(<span class="hljs-string">'d'</span>, d =&gt; &#123;</span><br><span class="line">  <span class="hljs-keyword">return</span> <span class="hljs-string">`</span></span><br><span class="line"><span class="hljs-string">  M<span class="hljs-subst">$&#123;d.y&#125;</span>,<span class="hljs-subst">$&#123;d.x&#125;</span></span></span><br><span class="line"><span class="hljs-string">  C<span class="hljs-subst">$&#123;(d.y + d.parent.y)<span class="hljs-regexp">/2&#125;,$&#123;d.x&#125;</span></span></span></span><br><span class="line"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-regexp">  $&#123;(d.y + d.parent.y)/</span><span class="hljs-number">2</span>&#125;</span>,<span class="hljs-subst">$&#123;d.parent.x&#125;</span></span></span><br><span class="line"><span class="hljs-string">  <span class="hljs-subst">$&#123;d.parent.y&#125;</span>,<span class="hljs-subst">$&#123;d.parent.x&#125;</span></span></span><br><span class="line"><span class="hljs-string">  `</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">.attr(<span class="hljs-string">'transform'</span>, d =&gt; <span class="hljs-string">`translate(<span class="hljs-subst">$&#123;d.y&#125;</span>, <span class="hljs-subst">$&#123;d.x&#125;</span>)`</span>)</span><br></pre></td></tr></table></figure>
<p>Add Images as Node</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">node.append(<span class="hljs-string">'image'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'xlink:href'</span>, d =&gt; d.data.icon)</span><br><span class="line">    .attr(<span class="hljs-string">'x'</span>, <span class="hljs-string">'-12px'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'y'</span>, <span class="hljs-string">'-12px'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'width'</span>, <span class="hljs-string">'24px'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'height'</span>, <span class="hljs-string">'24px'</span>)</span><br></pre></td></tr></table></figure>
<p>Add Interaction on Node</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">click</span> (<span class="hljs-params">d</span>) </span>&#123;</span><br><span class="line">  <span class="hljs-keyword">if</span> (d.children) &#123;</span><br><span class="line">    d._children = d.children</span><br><span class="line">    d.chilren = <span class="hljs-literal">null</span></span><br><span class="line">  &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">    d.children = d._children</span><br><span class="line">    d._children = <span class="hljs-literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">  upate(d)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Sankey-Diagrams"><a href="#Sankey-Diagrams" class="headerlink" title="Sankey Diagrams"></a>Sankey Diagrams</h3><p>// Todo</p>
<h3 id="Assorted-Tips-and-Tricks"><a href="#Assorted-Tips-and-Tricks" class="headerlink" title="Assorted Tips and Tricks"></a>Assorted Tips and Tricks</h3><h4 id="Events"><a href="#Events" class="headerlink" title="Events"></a>Events</h4><ul>
<li><p><code>mousedown</code></p>
</li>
<li><p><code>mouseup</code></p>
</li>
<li><p><code>mouseover</code></p>
</li>
<li><p><code>mouseout</code></p>
</li>
<li><p><code>mousemove</code></p>
</li>
<li><p><code>click</code></p>
</li>
<li><p><code>contextmenu</code></p>
</li>
<li><p><code>dblclick</code></p>
</li>
</ul>
<h4 id="Add-Tooltips"><a href="#Add-Tooltips" class="headerlink" title="Add Tooltips"></a>Add Tooltips</h4><p>Tooltips have a marvellous duality. They are on one hand a pretty darned useful thing that aids in giving context and information where required and on the other hand, if done with a bit of care they can look stylish.</p>
<figure class="highlight css hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-selector-tag">div</span><span class="hljs-selector-class">.tooltip</span> &#123;</span><br><span class="line">  <span class="hljs-attribute">position</span>: absolute;</span><br><span class="line">  <span class="hljs-attribute">text-align</span>: center;</span><br><span class="line">  <span class="hljs-attribute">width</span>: <span class="hljs-number">60px</span>;</span><br><span class="line">  <span class="hljs-attribute">height</span>: <span class="hljs-number">28px</span>;</span><br><span class="line">  <span class="hljs-attribute">padding</span>: <span class="hljs-number">2px</span>;</span><br><span class="line">  <span class="hljs-attribute">font</span>: <span class="hljs-number">12px</span> sans-serif;</span><br><span class="line">  <span class="hljs-attribute">background</span>: lightsteelblue;</span><br><span class="line">  <span class="hljs-attribute">border</span>: <span class="hljs-number">0px</span>;</span><br><span class="line">  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;</span><br><span class="line">  <span class="hljs-attribute">pointer-events</span>: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> div = d3.select(<span class="hljs-string">'body'</span>).append(<span class="hljs-string">'div'</span>).attr(<span class="hljs-string">'class'</span>, <span class="hljs-string">'tooltip'</span>)</span><br><span class="line">.style(<span class="hljs-string">'opacity'</span>, <span class="hljs-number">0</span>)</span><br><span class="line"></span><br><span class="line">svg.selectAll(<span class="hljs-string">"circle"</span>)</span><br><span class="line">   .data(data)</span><br><span class="line"> .enter().append(<span class="hljs-string">"circle"</span>)</span><br><span class="line">   .attr(<span class="hljs-string">"r"</span>, <span class="hljs-number">5</span>)</span><br><span class="line">   .attr(<span class="hljs-string">"cx"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) </span>&#123; <span class="hljs-keyword">return</span> x(d.date); &#125;)</span><br><span class="line">   .attr(<span class="hljs-string">"cy"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) </span>&#123; <span class="hljs-keyword">return</span> y(d.close); &#125;)</span><br><span class="line">   .on(<span class="hljs-string">"mouseover"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) </span>&#123;</span><br><span class="line">     div.transition()</span><br><span class="line">       .duration(<span class="hljs-number">200</span>)</span><br><span class="line">       .style(<span class="hljs-string">"opacity"</span>, <span class="hljs-number">.9</span>);</span><br><span class="line">     div.html(formatTime(d.date) + <span class="hljs-string">"&lt;br/&gt;"</span> + d.close)</span><br><span class="line">       .style(<span class="hljs-string">"left"</span>, (d3.event.pageX) + <span class="hljs-string">"px"</span>)</span><br><span class="line">       .style(<span class="hljs-string">"top"</span>, (d3.event.pageY - <span class="hljs-number">28</span>) + <span class="hljs-string">"px"</span>);</span><br><span class="line">     &#125;)</span><br><span class="line">   .on(<span class="hljs-string">"mouseout"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) </span>&#123;</span><br><span class="line">     div.transition()</span><br><span class="line">       .duration(<span class="hljs-number">500</span>)</span><br><span class="line">       .style(<span class="hljs-string">"opacity"</span>, <span class="hljs-number">0</span>);</span><br><span class="line">     &#125;)</span><br></pre></td></tr></table></figure>
<p>Notice there is only one tooltip exist in the page.</p>
<h3 id="Selecting-Filtering-a-subset-of-objects"><a href="#Selecting-Filtering-a-subset-of-objects" class="headerlink" title="Selecting/Filtering a subset of objects"></a>Selecting/Filtering a subset of objects</h3><p>Filtering is fairly simple.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">svg.selectAll(<span class="hljs-string">'circle'</span>)</span><br><span class="line">    .data(data)</span><br><span class="line">  .enter().append(<span class="hljs-string">'circle'</span>)</span><br><span class="line">    .filter(<span class="hljs-function"><span class="hljs-params">d</span> =&gt;</span> d.close &lt; <span class="hljs-number">400</span>)</span><br><span class="line">    .style(<span class="hljs-string">'fill'</span>, <span class="hljs-string">'red'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'r'</span>, <span class="hljs-number">5</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'cx'</span>, d =&gt; xScale(d.date))</span><br><span class="line">    .attr(<span class="hljs-string">'cy'</span>, d =&gt; yScale(d.close))</span><br></pre></td></tr></table></figure>
<h4 id="Select-Items-with-an-IF-statement"><a href="#Select-Items-with-an-IF-statement" class="headerlink" title="Select Items with an IF statement"></a>Select Items with an IF statement</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.style(<span class="hljs-string">"fill"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) </span>&#123;   </span><br><span class="line">  <span class="hljs-keyword">if</span> (d.close &lt;= <span class="hljs-number">400</span>) &#123;<span class="hljs-keyword">return</span> <span class="hljs-string">"red"</span>&#125;  </span><br><span class="line">  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (d.close &gt;= <span class="hljs-number">620</span>) &#123;<span class="hljs-keyword">return</span> <span class="hljs-string">"lawngreen"</span>&#125; <span class="hljs-comment">// &lt;== Right here</span></span><br><span class="line">  <span class="hljs-keyword">else</span> &#123; <span class="hljs-keyword">return</span> <span class="hljs-string">"black"</span> &#125;  </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="Applying-a-color-gradient-to-a-line-based-on-value"><a href="#Applying-a-color-gradient-to-a-line-based-on-value" class="headerlink" title="Applying a color gradient to a line based on value"></a>Applying a color gradient to a line based on value</h4><figure class="highlight css hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-selector-class">.line</span> &#123;</span><br><span class="line">  <span class="hljs-attribute">fill</span>: none;</span><br><span class="line">  <span class="hljs-attribute">stroke</span>: <span class="hljs-built_in">url</span>(#line-gradient);</span><br><span class="line">  <span class="hljs-attribute">stroke-width</span>: <span class="hljs-number">2px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// set the gradient</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// add linear gradient element</span></span><br><span class="line">svg.append(<span class="hljs-string">'linearGradent'</span>)</span><br><span class="line"><span class="hljs-comment">// add id for css anchor</span></span><br><span class="line">    .attr(<span class="hljs-string">'id'</span>, <span class="hljs-string">'line-gradient'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'gradientUnits'</span>, <span class="hljs-string">'userSpaceOnUse'</span>)</span><br><span class="line"><span class="hljs-comment">// use x1, y1, x2, y2 to define the bounds of the area over which the gradient will act.</span></span><br><span class="line"><span class="hljs-comment">// here we set x1, x2 to the same value so the gradient won't act on x direction.</span></span><br><span class="line">    .attr(<span class="hljs-string">'x1'</span>, <span class="hljs-number">0</span>).attr(<span class="hljs-string">'y1'</span>, yScale(<span class="hljs-number">0</span>))</span><br><span class="line">    .attr(<span class="hljs-string">'x2'</span>, <span class="hljs-number">0</span>).attr(<span class="hljs-string">'y2'</span>, yScale(<span class="hljs-number">1000</span>))</span><br><span class="line"><span class="hljs-comment">// select all 'stop' elements for the gradients, these 'stop' elements define where on the range covered by our coordinates the color start and stop(percent or decimal)</span></span><br><span class="line">  .selectAll(<span class="hljs-string">'stop'</span>)</span><br><span class="line">    .data([</span><br><span class="line">      &#123;<span class="hljs-attr">offset</span>: <span class="hljs-string">'0%'</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'red'</span>&#125;,</span><br><span class="line">      &#123;<span class="hljs-attr">offset</span>: <span class="hljs-string">'40%'</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'red'</span>&#125;,</span><br><span class="line">      &#123;<span class="hljs-attr">offset</span>: <span class="hljs-string">'40%'</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'black'</span>&#125;,</span><br><span class="line">      &#123;<span class="hljs-attr">offset</span>: <span class="hljs-string">'62%'</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'black'</span>&#125;,</span><br><span class="line">      &#123;<span class="hljs-attr">offset</span>: <span class="hljs-string">'62%'</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'lawngreen'</span>&#125;,</span><br><span class="line">      &#123;<span class="hljs-attr">offset</span>: <span class="hljs-string">'62%'</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'lawngreen'</span>&#125;,</span><br><span class="line">      &#123;<span class="hljs-attr">offset</span>: <span class="hljs-string">'100%'</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'lawngreen'</span>&#125;,</span><br><span class="line">    ])</span><br><span class="line">  .enter().append(<span class="hljs-string">'stop'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'offset'</span>, d =&gt; d.offset)</span><br><span class="line">    .attr(<span class="hljs-string">'stop-color'</span>, d =&gt; d.color)</span><br></pre></td></tr></table></figure>
<p>There is our anchor on the third line.</p>
<p>If you want to apply the gradient on area, simply change the css</p>
<p><code>`</code>css<br>.area {<br>  fill: url(#area-gradient);<br>  stroke-width: 0px;<br>}</p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-30T16:03:29.000Z">2017-08-31</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    3 minutes read (About 460 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/31/Styles-in-D3/">Styles in D3</a>
            
        </h1>
        <div class="content">
            <h3 id="fill"><a href="#fill" class="headerlink" title="fill"></a>fill</h3><p>The <code>fill</code> style will fill the element being presented with a specifed color.</p>
<p>By default, most element will be filled with black.</p>
<h3 id="stroke"><a href="#stroke" class="headerlink" title="stroke"></a>stroke</h3><p>The <code>stroke</code> style applies a color to lines</p>
<h3 id="opacity"><a href="#opacity" class="headerlink" title="opacity"></a>opacity</h3><p>The <code>opacity</code> style has the effect of varying an element’s transparency.</p>
<p>The valid range for <code>opacity</code> is from 0 to 1.</p>
<p>We should make the distinction at this point that <code>opacity</code> affects the entire element, whereas the following <code>fill-opacity</code> and <code>stroke-opacity</code> affect only the fill and stroke respectively.</p>
<h3 id="fill-opacity"><a href="#fill-opacity" class="headerlink" title="fill-opacity"></a>fill-opacity</h3><p>The <code>fill-opacity</code> style changes the transparency of the fill of an element.</p>
<h3 id="stroke-opacity"><a href="#stroke-opacity" class="headerlink" title="stroke-opacity"></a>stroke-opacity</h3><p>The <code>stroke-opacity</code> style changes the transparency of the stroke of an element.</p>
<h3 id="stroke-width"><a href="#stroke-width" class="headerlink" title="stroke-width"></a>stroke-width</h3><p>The <code>stroke-width</code> style adjusts the width of the line of an element.</p>
<p>The value specified when setting <code>stroke-width</code> in pixels.</p>
<h3 id="stroke-dasharray"><a href="#stroke-dasharray" class="headerlink" title="stroke-dasharray"></a>stroke-dasharray</h3><p>The <code>stroke-dasharray</code> style allows us to form element lines with dashes instead of solid lines.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.style(<span class="hljs-string">'stroke-dasharray'</span>, (<span class="hljs-string">'10, 3'</span>))</span><br></pre></td></tr></table></figure>
<h3 id="stroke-linecap"><a href="#stroke-linecap" class="headerlink" title="stroke-linecap"></a>stroke-linecap</h3><p>The <code>stroke-linecap</code> style allows control of the shape of the ends of lines.</p>
<p>There are three shape options:</p>
<ul>
<li><p><code>butt</code>: The line simply butts up to the starting or ending position and is cut off squarely.</p>
</li>
<li><p><code>round</code>: The line is rounded in propotionto its width.</p>
</li>
<li><p><code>square</code>: The line is squared off but exnteded in propotion to its width.</p>
</li>
</ul>
<h3 id="stroke-linejoin"><a href="#stroke-linejoin" class="headerlink" title="stroke-linejoin"></a>stroke-linejoin</h3><p>The <code>stroke-linejoin</code> style specifies the shape of the join of two lines. This would be used on <code>path</code>, <code>polyline</code> and <code>polygon</code>.</p>
<p>There are three line join options:</p>
<ul>
<li><p><code>miter</code>: The join is squared off as would be expected at the join of two lines.</p>
</li>
<li><p><code>round</code>: The outside portion of the join is rounded in proportion to its width.</p>
</li>
<li><p><code>bevel</code>: The join has a straight edged outer portion clipped off to provide a slightly more contoured effect while still being regular.</p>
</li>
</ul>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/EAS-41.png" alt="miter"></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/EAS-39.png" alt="round"></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/EAS-40.png" alt="bevel"></p>
<h3 id="writing-mode"><a href="#writing-mode" class="headerlink" title="writing-mode"></a>writing-mode</h3><p>The <code>writing-mode</code> style changes the orientation of the text so that it prints out top to bottom.</p>
<p>It has a single option ‘tb’ that accomplishes this.</p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/EAS-42.png" alt=""></p>
<h3 id="glyph-orientation-vertical"><a href="#glyph-orientation-vertical" class="headerlink" title="glyph-orientation-vertical"></a>glyph-orientation-vertical</h3><p>The <code>glyph-orientation-vertical</code> style changes the rotation of the individual glyphs(characters) in text and if used in conjunction with the <code>writing-mode</code> style (and set to 0) will allow the text to be displayed vertically with the letters orientation vertically as well.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">holder.append(<span class="hljs-string">'text'</span>)</span><br><span class="line">    .style(<span class="hljs-string">'fill'</span>, <span class="hljs-string">'black'</span>)</span><br><span class="line">    .style(<span class="hljs-string">'writing-mode'</span>, <span class="hljs-string">'tb'</span>)</span><br><span class="line">    .style(<span class="hljs-string">'glyph-orientation-vertical'</span>, <span class="hljs-number">0</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'x'</span>, <span class="hljs-number">200</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'y'</span>, <span class="hljs-number">100</span>)</span><br><span class="line">    .text(<span class="hljs-string">'Hello World'</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/EAS-43.png" alt=""></p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-30T10:06:53.000Z">2017-08-30</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    3 minutes read (About 469 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/30/Attributes-in-D3/">Attributes in D3</a>
            
        </h1>
        <div class="content">
            <h3 id="x-y"><a href="#x-y" class="headerlink" title="x/y"></a>x/y</h3><p>The <code>x</code> and <code>y</code> attributes are used to designate a position on the web page. Use the <code>x</code> and <code>y</code> attributes places the anchor points for these elements at a specified location.</p>
<h3 id="x1-y1-x2-y2"><a href="#x1-y1-x2-y2" class="headerlink" title="x1, y1, x2, y2"></a>x1, y1, x2, y2</h3><p>The <code>x1</code>, <code>y1</code>, <code>x2</code>, <code>y2</code> attributes are used to designate the position of two points on the web page. These two points are connected with a line as part of the <code>line</code> element.</p>
<h3 id="points"><a href="#points" class="headerlink" title="points"></a>points</h3><p>The <code>points</code> attribute is used to set a series of points which are subsequently connected with a line and/or which may form the bounds of a shape. These are specifically associated with the <code>polyline</code> and <code>polygon</code> elements.</p>
<p>The data for the points is entered as a sequence of x,y points in the following format:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.attr(<span class="hljs-string">'points'</span>, <span class="hljs-string">'100,50, 150,150, 150,50'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="cx-cy"><a href="#cx-cy" class="headerlink" title="cx, cy"></a>cx, cy</h3><p>The <code>cx</code>, <code>cy</code> attributes are associated with the circle and ellipse elements and designate the center of each shape.</p>
<ul>
<li><p><code>cx</code>: The position of the center of the element in the x axis.</p>
</li>
<li><p><code>cy</code>: The position of the center of the element in the y axis.</p>
</li>
</ul>
<h3 id="rx-ry"><a href="#rx-ry" class="headerlink" title="rx, ry"></a>rx, ry</h3><p>The <code>rx</code>, <code>ry</code> attributes are associated with the ellipse element and designate the radius in the x and y directions.</p>
<ul>
<li><p><code>rx</code>: The radius of the ellipse in the x direction.</p>
</li>
<li><p><code>ry</code>: The radius of the ellipse in the y direction.</p>
</li>
</ul>
<h3 id="transform-translate-x-y-scale-k-rotate-a"><a href="#transform-translate-x-y-scale-k-rotate-a" class="headerlink" title="transform(translate(x, y), scale(k), rotate(a))"></a>transform(translate(x, y), scale(k), rotate(a))</h3><ul>
<li><p><code>translate(x, y)</code>: move the element by a relative value in x and y directions.</p>
</li>
<li><p><code>scale(k)</code>: Increase or reduce the element by a specified factor.</p>
</li>
<li><p><code>rotate(a)</code>: Rotate the element by an angular value.</p>
</li>
</ul>
<p>All transform are applied based on the origin of (0, 0).</p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/EAS-23.png" alt=""></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/EAS-24.png" alt="rotate(10)"></p>
<p>So you’d better use transform like this:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">holder.append(<span class="hljs-string">'text'</span>)</span><br><span class="line">    .style(<span class="hljs-string">'fill'</span>, <span class="hljs-string">'black'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'dy'</span>, <span class="hljs-string">'0.35em'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'text-anchor'</span>, <span class="hljs-string">'middle'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'transform'</span>, <span class="hljs-string">'translate(200, 100) rotate(10) scale(2)'</span>)</span><br><span class="line">    .text(<span class="hljs-string">'Hello World'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="width-height"><a href="#width-height" class="headerlink" title="width, height"></a>width, height</h3><p><code>width</code> and <code>height</code> are required attributes of the rectagule element, <code>width</code> designates the width of the rectangle and <code>height</code> designates the height.</p>
<h3 id="text-anchor"><a href="#text-anchor" class="headerlink" title="text-anchor"></a>text-anchor</h3><p>The <code>text-anchor</code> attribute determines the justification of a text element. You can set it to <code>start</code>, <code>middle</code>, or <code>end</code>.</p>
<h3 id="dx-dy"><a href="#dx-dy" class="headerlink" title="dx, dy"></a>dx, dy</h3><p><code>dx</code> and <code>dy</code> are optional attributes that designate an offset of text elements from the anchor point in the x and y directions.</p>
<h3 id="textLength"><a href="#textLength" class="headerlink" title="textLength"></a>textLength</h3><p>The <code>textLength</code> attribute adjusts the length of the text element to fix a specified value.</p>
<h3 id="lenghtAdjust"><a href="#lenghtAdjust" class="headerlink" title="lenghtAdjust"></a>lenghtAdjust</h3><p>The <code>lengthAdjust</code> attribute allows the <code>textLength</code> attribute to have the spacing of a text element controlled to be either <code>spacing</code> or <code>spacingAndGlyphs</code>.</p>
<ul>
<li><p><code>spacing</code>: In thi soption the letters remain the same size, but the spacing between the letters and words are adjusted.</p>
</li>
<li><p><code>spacingAndGlyphs</code>: In this option the text is stretched or squeezed to fit.</p>
</li>
</ul>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-30T08:57:49.000Z">2017-08-30</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    4 minutes read (About 540 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/30/Basic-Elements-in-D3/">Basic Elements in D3</a>
            
        </h1>
        <div class="content">
            <h3 id="Circle"><a href="#Circle" class="headerlink" title="Circle"></a>Circle</h3><ul>
<li><p><code>cx</code>: The position of the center of the circle in the x direction.</p>
</li>
<li><p><code>cy</code>: The position of the center of the circle in the y direction.</p>
</li>
<li><p><code>r</code>: The radius of the circle from the <code>cx</code>, <code>cy</code> position to the perimeter of the circle.</p>
</li>
</ul>
<h3 id="Ellipse"><a href="#Ellipse" class="headerlink" title="Ellipse"></a>Ellipse</h3><ul>
<li><p><code>cx</code>: The position of the center of the ellipse in the x direction.</p>
</li>
<li><p><code>cy</code>: The position of the center of the ellipse in the y direction.</p>
</li>
<li><p><code>rx</code>: The radius of the ellipse in the x dimension.</p>
</li>
<li><p><code>ry</code>: The radius of the ellipse in the y dimension.</p>
</li>
</ul>
<h3 id="Rectangle"><a href="#Rectangle" class="headerlink" title="Rectangle"></a>Rectangle</h3><ul>
<li><p><code>x</code>: The position on the x axis of the left hand side of the rectangle.</p>
</li>
<li><p><code>y</code>: The position on the y axis of the top hand side of the rectangle.</p>
</li>
<li><p><code>width</code>: the width in pixel of the rectangle.</p>
</li>
<li><p><code>height</code>: the height in pixel of the rectangle.</p>
</li>
<li><p><code>rx</code>: the radius curve of the corner of the rectangle in the x dimension</p>
</li>
<li><p><code>ry</code>: The radius curve of the corner of the rectangle in the y dimension.</p>
</li>
</ul>
<h3 id="Line"><a href="#Line" class="headerlink" title="Line"></a>Line</h3><ul>
<li><p><code>x1</code>: The x position of the first end of the line.</p>
</li>
<li><p><code>y1</code>: The y position of the first end of the line.</p>
</li>
<li><p><code>x2</code>: The x position of the second end of the line.</p>
</li>
<li><p><code>y2</code>: The y position of the second end of the line.</p>
</li>
</ul>
<h3 id="polyline"><a href="#polyline" class="headerlink" title="polyline"></a>polyline</h3><p>A polyline is a sequence of connected lines described with a single attribute <code>points</code>.</p>
<ul>
<li><code>points</code>: The <code>points</code> attribute is a list of x,y coordinates that are the locations of the connecting points of the polyline.</li>
</ul>
<h3 id="polygon"><a href="#polygon" class="headerlink" title="polygon"></a>polygon</h3><p>A polygon is a sequnce of connected lines which form a closed shaped described with a single attribte <code>points</code></p>
<ul>
<li><code>points</code>: The <code>points</code> attribute is a list of x,y coordinates that are the locations of the connecting points of the polygon.</li>
</ul>
<h3 id="Path"><a href="#Path" class="headerlink" title="Path"></a>Path</h3><p>A path is an outline of an SVG shape which is described with a ‘mini-language’ inside a single attribute.</p>
<ul>
<li><code>d</code>: This attribute is a list of instructions that allow a shape to be drawn in a complex way using a ‘mini-language’ of command. These commands are written in a shorthand of single letters such a <code>M</code>-moveto, <code>Z</code>-closepath, <code>L</code>-lineto, <code>C</code>-curveto.</li>
</ul>
<h3 id="Clipped-Path-AKA-clipPath"><a href="#Clipped-Path-AKA-clipPath" class="headerlink" title="Clipped Path(AKA clipPath)"></a>Clipped Path(AKA clipPath)</h3><p>A clipPath is the path of a SVG shape that can be used in combination with another shape to remove any parts of the combined shape that doesn’t fall within the clipPath.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">holder.append(<span class="hljs-string">'clipPath'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'id'</span>, <span class="hljs-string">'ellipse-clip'</span>)</span><br><span class="line">  .append(<span class="hljs-string">'ellipse'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'cx'</span>, <span class="hljs-number">175</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'cy'</span>, <span class="hljs-number">100</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'rx'</span>, <span class="hljs-number">100</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'ry'</span>, <span class="hljs-number">50</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">holder.append(<span class="hljs-string">'rect'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'x'</span>, <span class="hljs-number">125</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'y'</span>, <span class="hljs-number">75</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'clip-path'</span>, <span class="hljs-string">'url(#ellipse-clip)'</span>)</span><br><span class="line">    .style(<span class="hljs-string">'fill'</span>, <span class="hljs-string">'lightgrey'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'height'</span>, <span class="hljs-number">100</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'width'</span>, <span class="hljs-number">200</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Text"><a href="#Text" class="headerlink" title="Text"></a>Text</h3><p>A text element is an SVG object which is shaped as text. It is described by two required attributes and three optional ones.</p>
<ul>
<li><p><code>x</code>: This attribute designates the anchor point location for the text in the x dimension.</p>
</li>
<li><p><code>y</code>: This attribute designates the anchor point location for the text in the y dimension.</p>
</li>
<li><p><code>dx</code>: This attribute designates the offset of the text from the anchor point in the x dimension. (ususally set to 0.35em, 0.71em)</p>
</li>
<li><p><code>dy</code>: This attribute designates the offset of the text from the anchor point in the y dimension.</p>
</li>
<li><p><code>text-anchor</code>: This attribute controls the horizontal text alignment. It has three values: <code>start</code>, <code>middle</code>, <code>end</code>.</p>
</li>
</ul>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-30T03:33:40.000Z">2017-08-30</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    9 minutes read (About 1365 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/30/Things-we-can-do-with-the-simple-Graph-of-D3/">Things We Can Do With the Simple Graph of D3</a>
            
        </h1>
        <div class="content">
            <p><a href="https://leanpub.com/d3-t-and-t-v4/read#axes" target="_blank" rel="noopener">origin</a></p>
<h3 id="Setting-up-and-configuring-the-Axes"><a href="#Setting-up-and-configuring-the-Axes" class="headerlink" title="Setting up and configuring the Axes"></a>Setting up and configuring the Axes</h3><h4 id="Change-the-text-size"><a href="#Change-the-text-size" class="headerlink" title="Change the text size"></a>Change the text size</h4><p>The default size is <strong>10px</strong> with the font type of <strong>sans-serif</strong>.</p>
<p>There are a couple of different ways that we could change the font size and either one is valid.</p>
<p>The first way is to specify the font as a style when drawing an individual axis.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">svg.append(<span class="hljs-string">'g'</span>)</span><br><span class="line">    .style(<span class="hljs-string">'font'</span>, <span class="hljs-string">'14px times'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'transform'</span>, <span class="hljs-string">`translate(0, <span class="hljs-subst">$&#123;height&#125;</span>)`</span>)</span><br><span class="line">    .call(d3.axisBottom(xScale))</span><br></pre></td></tr></table></figure>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/axes-01.png" alt=""></p>
<p>There are a few things to notice here.</p>
<p>Firstly, we do indeed have a larger font and it appears to be of the type ‘times’.</p>
<p>Secondly, the y axis has remained as 10px sans-serif.</p>
<p>Lastly, the number of values represented on the x axis has meant that with the increase in font size there is some overlapping going on</p>
<p>By this way, you can change stype of x axis while leaving y axis away.</p>
<p>But if you want to change two axis meanwhile, you’d better use class.</p>
<h4 id="Change-the-number-of-ticks-on-an-axis"><a href="#Change-the-number-of-ticks-on-an-axis" class="headerlink" title="Change the number of ticks on an axis"></a>Change the number of ticks on an axis</h4><p>Now we shall address the other problem taht cropped up when we change the size of the text. We have overlapping values on the x axis.</p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/axes-03.png" alt=""></p>
<p>The <a href="https://github.com/d3/d3-axis" target="_blank" rel="noopener">axis component</a> includes a function to specify the number of ticks on an axis.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">svg.append(<span class="hljs-string">'g'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'class'</span>, <span class="hljs-string">'axis'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'transform'</span>, <span class="hljs-string">`translate(0, <span class="hljs-subst">$&#123;height&#125;</span>)`</span>)</span><br><span class="line">    .call(d3.axisBottom(xScale).ticks(<span class="hljs-number">5</span>))</span><br></pre></td></tr></table></figure>
<p>Here you may face a confusion:</p>
<p>When you specify ticks to 5 or 4, or 3, there’re always 5 ticks, and if you specify ticks to 2, the axis ticks will be 2 representing month.</p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/axes-04.png" alt=""></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/axes-05.png" alt=""></p>
<p>This is because D3 is making a command decision for you as to how your ticks should be best displayed.</p>
<p>The following is the list of time interval that D3 will consider when setting automatic ticks on a time based aaxis:</p>
<ul>
<li><p>1, 5, 15 and 30-second</p>
</li>
<li><p>1, 5, 15 and 30-minute</p>
</li>
<li><p>1, 3, 6 and 12-hour</p>
</li>
<li><p>1 and 2-day</p>
</li>
<li><p>1-week</p>
</li>
<li><p>1 and 3-month</p>
</li>
<li><p>1-year</p>
</li>
</ul>
<p>You can specify custom time interval by <code>d3.axisBottom(xScale).ticks(d3.timeDay.every(4))</code>.</p>
<h4 id="Rotating-text-labels-for-a-graph-size"><a href="#Rotating-text-labels-for-a-graph-size" class="headerlink" title="Rotating text labels for a graph size"></a>Rotating text labels for a graph size</h4><p>An answer to the problem of overlapping axis values might to be rotate the text to provide more space.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">svg.append(<span class="hljs-string">'g'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'class'</span>, <span class="hljs-string">'axis'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'transform'</span>, <span class="hljs-string">`translate(0, <span class="hljs-subst">$&#123;height&#125;</span>)`</span>)</span><br><span class="line">    .call(d3.axisBottom(xScale).ticks(<span class="hljs-number">10</span>))</span><br><span class="line">    .selectAll(<span class="hljs-string">'text'</span>)</span><br><span class="line">        .style(<span class="hljs-string">'text-anchor'</span>, <span class="hljs-string">'end'</span>)</span><br><span class="line">        .attr(<span class="hljs-string">'dx'</span>, <span class="hljs-string">'-0.8em'</span>) <span class="hljs-comment">// move the end of the text away from the line</span></span><br><span class="line">        .attr(<span class="hljs-string">'dy'</span>, <span class="hljs-string">'0.15em'</span>) <span class="hljs-comment">// move the end of the text away from the line</span></span><br><span class="line">        .attr(<span class="hljs-string">'transform'</span>, <span class="hljs-string">'rotate(-65)'</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/rotate02.png" alt=""></p>
<h4 id="Formatting-a-date-time-axis-with-specified-values"><a href="#Formatting-a-date-time-axis-with-specified-values" class="headerlink" title="Formatting a date / time axis with specified values"></a>Formatting a date / time axis with specified values</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">svg.append(<span class="hljs-string">'g'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'class'</span>, <span class="hljs-string">'axis'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'transform'</span>, <span class="hljs-string">`translate(0, <span class="hljs-subst">$&#123;height&#125;</span>)`</span>)</span><br><span class="line">    .call(d3.axisBottom(xScale).tickFormat(d3.timeFormat(<span class="hljs-string">'%Y-%m-%d'</span>)))</span><br><span class="line">  .selectAll(<span class="hljs-string">'text'</span>)</span><br><span class="line">    .style(<span class="hljs-string">'text-anchor'</span>, <span class="hljs-string">'end'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'dx'</span>, <span class="hljs-string">'-0.8em'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'dy'</span>, <span class="hljs-string">'0.15em'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'transform'</span>, <span class="hljs-string">'rotate(-65)'</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/axes-07.png" alt=""></p>
<h4 id="Adding-Axis-Labels"><a href="#Adding-Axis-Labels" class="headerlink" title="Adding Axis Labels"></a>Adding Axis Labels</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// text label for the x axis</span></span><br><span class="line"></span><br><span class="line">svg.append(<span class="hljs-string">'text'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'transform'</span>, <span class="hljs-string">`translate(<span class="hljs-subst">$&#123;width<span class="hljs-regexp">/2&#125;, $&#123;height + margin.top + 20&#125;)`)</span></span></span></span><br><span class="line"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-regexp">    .style('text-anchor', 'middle')</span></span></span></span><br><span class="line"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-regexp">    .text('Date')</span></span></span></span><br></pre></td></tr></table></figure>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/date01.png" alt=""></p>
<p>Add y axis</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">svg.append(<span class="hljs-string">'text'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'transform'</span>, <span class="hljs-string">'rotate(-90)'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'y'</span>, <span class="hljs-number">0</span> - margin.left)</span><br><span class="line">    .attr(<span class="hljs-string">'x'</span>, <span class="hljs-number">0</span> - height / <span class="hljs-number">2</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'dy'</span>, <span class="hljs-string">'1em'</span>)</span><br><span class="line">    .style(<span class="hljs-string">'text-anchor'</span>, <span class="hljs-string">'middle'</span>)</span><br><span class="line">    .text(<span class="hljs-string">'Value'</span>)</span><br></pre></td></tr></table></figure>
<p>Something may confused you:</p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/value02.png" alt=""></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/value03.png" alt=""></p>
<p>And add the title…</p>
<h4 id="Smoothing-out-graph-lines"><a href="#Smoothing-out-graph-lines" class="headerlink" title="Smoothing out graph lines"></a>Smoothing out graph lines</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.curve(d3.curveBasis)</span><br></pre></td></tr></table></figure>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth03.png" alt="d3.curveLinear"></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth03a.png" alt="d3.curveLinearClosed"></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth04a.png" alt="d3.curveStep"></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth04.png" alt="d3.curveStepBefore"></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth05.png" alt="d3.curveStepAfter"></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth06.png" alt="d3.curveBasis"></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth07.png" alt="d3.curveBasisOpen"></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth08.png" alt="d3.curveLinearClosed"></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth09.png" alt="d3.curveBundle"></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth10.png" alt="d3.curveCardinal"></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth11.png" alt="d3.curveCardinalOpen"></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth12.png" alt="d3.curveCardinalClosed"></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth13.png" alt="d3.curveMonotone"></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth14.png" alt="d3.curveCatmullRom"></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth15.png" alt="d3.curveCatmullRomClosed"></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth16.png" alt="d3.curveCatmullRomOpen"></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth17.png" alt=""></p>
<h4 id="Make-a-dashed-line"><a href="#Make-a-dashed-line" class="headerlink" title="Make a dashed line"></a>Make a dashed line</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">svg.append(<span class="hljs-string">'path'</span>)</span><br><span class="line">    .datum(data)</span><br><span class="line">    .attr(<span class="hljs-string">'class'</span>, <span class="hljs-string">'line'</span>)</span><br><span class="line">    .style(<span class="hljs-string">'stroke-dasharry'</span>, (<span class="hljs-string">'3, 3'</span>))</span><br><span class="line">    .attr(<span class="hljs-string">'d'</span>, line)</span><br></pre></td></tr></table></figure>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/dashed01.png" alt=""></p>
<p>Obviously <code>stroke-dasharray</code> is a style is a style for the path element, but the magic is the numbers.</p>
<p>Essentially they describe the on length and off length of the line. So <code>&#39;(3, 3)&#39;</code> translates to 3px on and 3px off.</p>
<p>You can try <code>&#39;5, 5, 5, 5, 5, 5, 10, 5, 10, 5, 10, 5&#39;</code></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/dashed02.png" alt=""></p>
<p>Of course you can apply this style on axis or any where you prefer.</p>
<h4 id="Filling-an-aera-under-the-graph"><a href="#Filling-an-aera-under-the-graph" class="headerlink" title="Filling an aera under the graph"></a>Filling an aera under the graph</h4><p>Filling an area with a solid color isn’t too hard.</p>
<h5 id="CSS-for-an-area-fill"><a href="#CSS-for-an-area-fill" class="headerlink" title="CSS for an area fill"></a>CSS for an area fill</h5><figure class="highlight css hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-selector-class">.area</span> &#123;</span><br><span class="line">  <span class="hljs-attribute">fill</span>: lightsteelblue</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Define-the-area-function"><a href="#Define-the-area-function" class="headerlink" title="Define the area function"></a>Define the area function</h5><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> area = d3.area()</span><br><span class="line">    .x(<span class="hljs-function">(<span class="hljs-params">d</span>) =&gt;</span> (xScale(d.date)))</span><br><span class="line">    .y0(height)</span><br><span class="line">    .y1(<span class="hljs-function">(<span class="hljs-params">d</span>) =&gt;</span> (yScale(d.close)))</span><br></pre></td></tr></table></figure>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/fill03.png" alt=""></p>
<h5 id="Draw-the-area"><a href="#Draw-the-area" class="headerlink" title="Draw the area"></a>Draw the area</h5><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">svg.append(<span class="hljs-string">'path'</span>)</span><br><span class="line">    .datum(data)</span><br><span class="line">    .attr(<span class="hljs-string">'class'</span>, <span class="hljs-string">'area'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'d'</span>, area)</span><br></pre></td></tr></table></figure>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/fill04.png" alt=""></p>
<p>If you want to fill the area above the graph</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> area = d3.area()</span><br><span class="line">    .x(<span class="hljs-function"><span class="hljs-params">d</span> =&gt;</span> (xScale(d.date)))</span><br><span class="line">    .y0(<span class="hljs-function"><span class="hljs-params">d</span> =&gt;</span> (yScale(d.close)))</span><br><span class="line">    y1(<span class="hljs-number">0</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Add-a-drop-shadow-to-allow-text-to-stand-out-on-graphics"><a href="#Add-a-drop-shadow-to-allow-text-to-stand-out-on-graphics" class="headerlink" title="Add a drop shadow to allow text to stand out on graphics"></a>Add a drop shadow to allow text to stand out on graphics</h4><figure class="highlight css hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-selector-tag">text</span><span class="hljs-selector-class">.shadow</span> &#123;</span><br><span class="line">  <span class="hljs-attribute">stroke</span>: white;</span><br><span class="line">  <span class="hljs-attribute">stroke-width</span>: <span class="hljs-number">4px</span>;</span><br><span class="line">  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.8</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Add-grid-lines-to-a-graph"><a href="#Add-grid-lines-to-a-graph" class="headerlink" title="Add grid lines to a graph."></a>Add grid lines to a graph.</h4><p>We are going to use the axis function to generate two more axis elements(one for x and one for y) but for these ones of drawing the main lines and the labels, we’re just going to draw the tick lines.</p>
<h5 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h5><figure class="highlight css hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-selector-class">.grid</span> <span class="hljs-selector-tag">line</span> &#123;</span><br><span class="line">  <span class="hljs-attribute">stroke</span>: lightgrey;</span><br><span class="line">  <span class="hljs-attribute">stroke-opacity</span>: <span class="hljs-number">0.7</span>;</span><br><span class="line">  <span class="hljs-attribute">shape-rendering</span>: crispEdges;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-selector-class">.grid</span> <span class="hljs-selector-tag">path</span> &#123;</span><br><span class="line">  <span class="hljs-attribute">stroke-width</span>: <span class="hljs-number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Here we use <code>shape-rendering: crispEdges</code> to make the lines narrow.</p>
<p>And set <code>.grid path{ stroke-width: 0; }</code> to dismiss line of top and right line, it will be like this if we remove the css style:</p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/grid02.png" alt=""></p>
<h5 id="Define-the-grid-line-functions"><a href="#Define-the-grid-line-functions" class="headerlink" title="Define the grid line functions"></a>Define the grid line functions</h5><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// gridlines in x axis function</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">make_x_gridlines</span>(<span class="hljs-params"></span>) </span>&#123;</span><br><span class="line">  <span class="hljs-keyword">return</span> d3.axisBottom(xScale).ticks(<span class="hljs-number">5</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// gridlines in y axis function</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">make_y_gridlines</span>(<span class="hljs-params"></span>) </span>&#123;</span><br><span class="line">  <span class="hljs-keyword">return</span> d3.axisLeft(yScale).ticks(<span class="hljs-number">5</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Draw-the-lines"><a href="#Draw-the-lines" class="headerlink" title="Draw the lines"></a>Draw the lines</h5><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// add the x gridlines</span></span><br><span class="line">svg.append(<span class="hljs-string">'g'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'class'</span>, <span class="hljs-string">'grid'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'transform'</span>, <span class="hljs-string">`translate(0, <span class="hljs-subst">$&#123;height&#125;</span>)`</span>)</span><br><span class="line">    .call(make_x_gridlines().tickSize(-height).tickFormat(<span class="hljs-string">''</span>))</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// add the y gridlines</span></span><br><span class="line">svg.append(<span class="hljs-string">'g'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'class'</span>, <span class="hljs-string">'grid'</span>)</span><br><span class="line">    .call(make_y_gridlines().tickSize(-width).tickFormat(<span class="hljs-string">''</span>))</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">axis.tickSize([size])</span><br></pre></td></tr></table></figure>
<p>In our example, we are setting our ticks to a length that corresponding to the full height or width of the graph, which of course means that they extend across the graph and have the appearance of grid lines.</p>
<p>The last thing that is included in the code to draw the grid lines is the instruction to suppress printing any label for the ticks:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.tickForamt(<span class="hljs-string">''</span>)</span><br></pre></td></tr></table></figure>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-29T12:30:15.000Z">2017-08-29</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    2 minutes read (About 291 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/29/Simple-Example-of-Line-Chart-with-D3v4/">Simple Example of Line Chart With D3v4</a>
            
        </h1>
        <div class="content">
            <h3 id="Import-D3"><a href="#Import-D3" class="headerlink" title="Import D3"></a>Import D3</h3><figure class="highlight html hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://d3js.org/d3.v4.min.js"</span>&gt;</span><span class="hljs-undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// set size</span></span><br><span class="line"><span class="hljs-keyword">const</span> margin = &#123;</span><br><span class="line">  top: <span class="hljs-number">50</span>,</span><br><span class="line">  right: <span class="hljs-number">50</span>,</span><br><span class="line">  bottom: <span class="hljs-number">50</span>,</span><br><span class="line">  left: <span class="hljs-number">50</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-keyword">const</span> width = <span class="hljs-built_in">window</span>.innerWidth - margin.left - margin.right</span><br><span class="line"><span class="hljs-keyword">const</span> height = <span class="hljs-built_in">window</span>.innerHeight - margin.top - margin.bottom</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// Set Point Number</span></span><br><span class="line"><span class="hljs-keyword">const</span> n = <span class="hljs-number">21</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// X scale will use the index of our data</span></span><br><span class="line"><span class="hljs-keyword">const</span> xScale = d3.scaleLinear()</span><br><span class="line">    .domain([<span class="hljs-number">0</span>, n<span class="hljs-number">-1</span>]) <span class="hljs-comment">// input</span></span><br><span class="line">    .range([<span class="hljs-number">0</span>, width]) <span class="hljs-comment">// output</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// Y scale will use the randomly generated number</span></span><br><span class="line"><span class="hljs-keyword">const</span> yScale = d3.scaleLinear()</span><br><span class="line">    .domain([<span class="hljs-number">0</span>, <span class="hljs-number">1</span>]) <span class="hljs-comment">// input</span></span><br><span class="line">    .range([height, <span class="hljs-number">0</span>]) <span class="hljs-comment">// output</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// d3's line generator</span></span><br><span class="line"><span class="hljs-keyword">const</span> line = d3.line()</span><br><span class="line">    .x(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d, i</span>) </span>&#123;</span><br><span class="line">      <span class="hljs-keyword">return</span> xScale(i)  <span class="hljs-comment">// set the x value for the line generator</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .y(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d, i</span>) </span>&#123;</span><br><span class="line">      <span class="hljs-keyword">return</span> d.y <span class="hljs-comment">// set the y value for the line generator</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .curve(d3.curveMonotoneX) <span class="hljs-comment">// apply smoothing to the line</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">const</span> dataset = d3.range(n)</span><br><span class="line">    .map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) </span>&#123;</span><br><span class="line">      <span class="hljs-keyword">return</span> &#123;</span><br><span class="line">        y: d3.randomUniform(<span class="hljs-number">1</span>)()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// Add SVG to the page</span></span><br><span class="line"><span class="hljs-keyword">const</span> svg = d3.select(<span class="hljs-string">'body'</span>)</span><br><span class="line">  .append(<span class="hljs-string">'svg'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'width'</span>, width + margin.left + margin.right)</span><br><span class="line">    .attr(<span class="hljs-string">'height'</span>, height + margin.top + margin.bottom)</span><br><span class="line">  .append(<span class="hljs-string">'g'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'transform'</span>, <span class="hljs-string">`translate(<span class="hljs-subst">$&#123;margin.left&#125;</span>, <span class="hljs-subst">$&#123;margin.top&#125;</span>)`</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// Call the X axis in a group tag</span></span><br><span class="line">svg.append(<span class="hljs-string">'g'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'class'</span>, <span class="hljs-string">'x axis'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'transform'</span>, <span class="hljs-string">`translate(0, <span class="hljs-subst">$&#123;height&#125;</span>)`</span>)</span><br><span class="line">    .call(d3.axisBottom(xScale)) <span class="hljs-comment">// Create an axis component with d3.axisBottom</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// Call the Y axis in a group tag</span></span><br><span class="line">svg.append(<span class="hljs-string">'g'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'class'</span>, <span class="hljs-string">'y axis'</span>)</span><br><span class="line">    .call(d3.axisLeft(yScale))</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// Append the path, bind the data, and call the line generator</span></span><br><span class="line">svg.append(<span class="hljs-string">'path'</span>)</span><br><span class="line">    .datum(dataset) <span class="hljs-comment">// bind data to the path</span></span><br><span class="line">    .attr(<span class="hljs-string">'class'</span>, <span class="hljs-string">'line'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'d'</span>, line) <span class="hljs-comment">// call the line generator</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// Append a circle for each data point</span></span><br><span class="line">svg.selectAll(<span class="hljs-string">'.dot'</span>)</span><br><span class="line">    .data(dataset)</span><br><span class="line">  .enter().append(<span class="hljs-string">'circle'</span>)</span><br><span class="line">    .attr(<span class="hljs-string">'cx'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">d, i</span>) </span>&#123;</span><br><span class="line">      <span class="hljs-keyword">return</span> xScale(i)</span><br><span class="line">    &#125;)</span><br><span class="line">    .attr(<span class="hljs-string">'cy'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">d, i</span>) </span>&#123;</span><br><span class="line">      <span class="hljs-keyword">return</span> yScale(dy)</span><br><span class="line">    &#125;)</span><br><span class="line">    .attr(<span class="hljs-string">'r'</span>, <span class="hljs-number">5</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Add-style"><a href="#Add-style" class="headerlink" title="Add style"></a>Add style</h3><figure class="highlight css hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-selector-class">.line</span> &#123;</span><br><span class="line">  <span class="hljs-attribute">fill</span>: none;</span><br><span class="line">  <span class="hljs-attribute">stroke</span>: cyan;</span><br><span class="line">  <span class="hljs-attribute">storke-width</span>: <span class="hljs-number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-selector-class">.dot</span> &#123;</span><br><span class="line">  <span class="hljs-attribute">fill</span>: <span class="hljs-number">#ffab00</span>;</span><br><span class="line">  <span class="hljs-attribute">stroke</span>: <span class="hljs-number">#FFF</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-29T08:27:11.000Z">2017-08-29</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    5 minutes read (About 676 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/29/Usage-of-Mock/">Usage of Mock</a>
            
        </h1>
        <div class="content">
            <h3 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h3><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add mockjs</span><br></pre></td></tr></table></figure>
<h3 id="Simple-Usage"><a href="#Simple-Usage" class="headerlink" title="Simple Usage"></a>Simple Usage</h3><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> Mock = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mock'</span>)</span><br><span class="line"><span class="hljs-keyword">const</span> data = Mock.mock(&#123;</span><br><span class="line">  <span class="hljs-string">'list|1-10'</span>: [&#123;</span><br><span class="line">    <span class="hljs-string">'id|+1'</span>: <span class="hljs-number">1</span></span><br><span class="line">  &#125;]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">JSON</span>.stringify(data))</span><br></pre></td></tr></table></figure>
<h3 id="Data-Template-Definition-DTD"><a href="#Data-Template-Definition-DTD" class="headerlink" title="Data Template Definition(DTD)"></a>Data Template Definition(DTD)</h3><p>Each attribute consists of three parts:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// attribute name</span></span><br><span class="line"><span class="hljs-comment">// attribute rule</span></span><br><span class="line"><span class="hljs-comment">// attribute value</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-string">'name|rule'</span>: value</span><br></pre></td></tr></table></figure>
<p>rule is optional</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// rules</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="hljs-string">'name|min-max'</span>: value,</span><br><span class="line">  <span class="hljs-string">'name|count'</span>: value,</span><br><span class="line">  <span class="hljs-string">'name|min-max.dmin-dmax'</span>: value,</span><br><span class="line">  <span class="hljs-string">'name|min-max.dcount'</span>: value,</span><br><span class="line">  <span class="hljs-string">'name|count.dmin-dmax'</span>: value,</span><br><span class="line">  <span class="hljs-string">'name|count.dcount'</span>: value,</span><br><span class="line">  <span class="hljs-string">'name|+step'</span>: value,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">'name|min-max'</span>: string <span class="hljs-comment">// repeat 'string' less than or equal to 'min', more than or equal 'max'</span></span><br><span class="line"><span class="hljs-string">'name|count'</span>: string <span class="hljs-comment">// repeat 'string' 'count' times.</span></span><br><span class="line"><span class="hljs-string">'name|+1'</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// auto incresing with step 1 from 0</span></span><br><span class="line"><span class="hljs-string">'name|min-max'</span>: number <span class="hljs-comment">// generate a number &gt;=min and &lt;=max</span></span><br><span class="line"><span class="hljs-string">'name|min-max.dmin-dmax'</span>: number <span class="hljs-comment">// generate a float, the integer part &gt;=min and &lt;=max, the deciaml part remains dmin - dmax bits.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Mock.mock(&#123;</span><br><span class="line">    <span class="hljs-string">'number1|1-100.1-10'</span>: <span class="hljs-number">1</span>,</span><br><span class="line">    <span class="hljs-string">'number2|123.1-10'</span>: <span class="hljs-number">1</span>,</span><br><span class="line">    <span class="hljs-string">'number3|123.3'</span>: <span class="hljs-number">1</span>,</span><br><span class="line">    <span class="hljs-string">'number4|123.10'</span>: <span class="hljs-number">1.123</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="hljs-comment">// =&gt;</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="hljs-string">"number1"</span>: <span class="hljs-number">12.92</span>,</span><br><span class="line">    <span class="hljs-string">"number2"</span>: <span class="hljs-number">123.51</span>,</span><br><span class="line">    <span class="hljs-string">"number3"</span>: <span class="hljs-number">123.777</span>,</span><br><span class="line">    <span class="hljs-string">"number4"</span>: <span class="hljs-number">123.1231091814</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Data-Placeholder-Definition-DPD"><a href="#Data-Placeholder-Definition-DPD" class="headerlink" title="Data Placeholder Definition(DPD)"></a>Data Placeholder Definition(DPD)</h3><p>Placeholder hold a position in attribute string, and will dismiss in result.</p>
<p>Use Mock.Random to generate data.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@placeholder</span><br><span class="line">@placeholder(opt1[, opt2])</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Mock.mock(&#123;</span><br><span class="line">    name: &#123;</span><br><span class="line">        first: <span class="hljs-string">'@FIRST'</span>,</span><br><span class="line">        middle: <span class="hljs-string">'@FIRST'</span>,</span><br><span class="line">        last: <span class="hljs-string">'@LAST'</span>,</span><br><span class="line">        full: <span class="hljs-string">'@first @middle @last'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="hljs-comment">// =&gt;</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="hljs-string">"name"</span>: &#123;</span><br><span class="line">        <span class="hljs-string">"first"</span>: <span class="hljs-string">"Charles"</span>,</span><br><span class="line">        <span class="hljs-string">"middle"</span>: <span class="hljs-string">"Brenda"</span>,</span><br><span class="line">        <span class="hljs-string">"last"</span>: <span class="hljs-string">"Lopez"</span>,</span><br><span class="line">        <span class="hljs-string">"full"</span>: <span class="hljs-string">"Charles Brenda Lopez"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Mock-mock"><a href="#Mock-mock" class="headerlink" title="Mock.mock()"></a>Mock.mock()</h3><h4 id="Mock-mock-rurl-rtype-template-function-options"><a href="#Mock-mock-rurl-rtype-template-function-options" class="headerlink" title="Mock.mock(rurl?, rtype?, template | function(options))"></a>Mock.mock(rurl?, rtype?, template | function(options))</h4><h5 id="Mock-mock-template"><a href="#Mock-mock-template" class="headerlink" title="Mock.mock(template)"></a>Mock.mock(template)</h5><p>Generate mock data</p>
<h5 id="Mock-mock-rurl-template"><a href="#Mock-mock-rurl-template" class="headerlink" title="Mock.mock(rurl, template)"></a>Mock.mock(rurl, template)</h5><p>Intercept <code>rurl</code>(regexp) request, and generate according template.</p>
<h5 id="Mock-mock-rurl-function-options"><a href="#Mock-mock-rurl-function-options" class="headerlink" title="Mock.mock(rurl, function(options))"></a>Mock.mock(rurl, function(options))</h5><p>Intercept <code>rurl</code> request and call function(options) to return the mock data.</p>
<h5 id="Mock-mock-rurl-rtype-template"><a href="#Mock-mock-rurl-rtype-template" class="headerlink" title="Mock.mock(rurl, rtype, template)"></a>Mock.mock(rurl, rtype, template)</h5><p>Intercept the request matching <code>rurl</code> and <code>rtype</code>.</p>
<h5 id="Mock-mock-rurl-rtype-function-options"><a href="#Mock-mock-rurl-rtype-function-options" class="headerlink" title="Mock.mock(rurl, rtype, function(options))"></a>Mock.mock(rurl, rtype, function(options))</h5><p>Intercept the request matching <code>rurl</code> and <code>rtype</code>.</p>
<blockquote>
<p>options conssits of (url, type, body)</p>
</blockquote>
<h3 id="Mock-setup"><a href="#Mock-setup" class="headerlink" title="Mock.setup()"></a>Mock.setup()</h3><p>Mock.setup(settings)</p>
<p>Set action when intercept ajax request.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  timeout: <span class="hljs-string">''</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>timeout: set time responding time, ‘300’, ‘300-600’, default to ‘10-100’</li>
</ul>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Mock.setup(&#123;</span><br><span class="line">  timeout: <span class="hljs-string">'200-400'</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="Mock-Random"><a href="#Mock-Random" class="headerlink" title="Mock.Random"></a>Mock.Random</h3><p>Utils to generate Random data.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> Random = Mock.Random</span><br><span class="line">Random.email()</span><br><span class="line"></span><br><span class="line">Mock.mock(<span class="hljs-string">'@email'</span>) <span class="hljs-comment">// use with placeholder</span></span><br><span class="line"></span><br><span class="line">Mock.mock(&#123;</span><br><span class="line">  email: <span class="hljs-string">'@email'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>| Type | Mehtod |<br>| Baisc | boolean, natural, integer, float, character, string, range, date, time, datetime, now |<br>| Image | image, dataImage |<br>| Color | color |<br>| Text | paragraph, sentence, word, title, cparagraph, csentence, cword, ctitle |<br>| Name | first, last, name, cfirst, clast, cname |<br>| Web | url, domain, email, ip, tld |<br>| Address | area, region |<br>| Helper | capitalize, upper, lower, pick, shuffle |<br>| Miscellaneous | guid, id |</p>
<h4 id="Mock-Random-boolean-min-max-current"><a href="#Mock-Random-boolean-min-max-current" class="headerlink" title="Mock.Random.boolean(min?, max?, current?)"></a>Mock.Random.boolean(min?, max?, current?)</h4><p>‘min’ and ‘max’ decide the possibility of ‘current’</p>
<p>‘current’ will appear in possibility of min/(min + max) to max(min + max)</p>
<h4 id="Mock-Random-natural-min-max"><a href="#Mock-Random-natural-min-max" class="headerlink" title="Mock.Random.natural(min?, max?)"></a>Mock.Random.natural(min?, max?)</h4><h4 id="Mock-Random-integer-min-max"><a href="#Mock-Random-integer-min-max" class="headerlink" title="Mock.Random.integer(min?, max?)"></a>Mock.Random.integer(min?, max?)</h4><h4 id="Mock-Random-float-min-max-dmin-dmax"><a href="#Mock-Random-float-min-max-dmin-dmax" class="headerlink" title="Mock.Random.float(min?, max?, dmin?, dmax?)"></a>Mock.Random.float(min?, max?, dmin?, dmax?)</h4><h4 id="Mock-Random-character-pool"><a href="#Mock-Random-character-pool" class="headerlink" title="Mock.Random.character(pool?)"></a>Mock.Random.character(pool?)</h4><p>pool represents the character pool</p>
<p>pool: ‘lower/upper/number/symbol’<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  lower: &apos;abcdefghijklmnopqrstuvwxyz&apos;,</span><br><span class="line">  upper: &apos;ABCDEFGHIJKLMNOPQRSTUVWXYZ&apos;,</span><br><span class="line">  number: 0123456789,</span><br><span class="line">  symbol: &apos;!@#$%^&amp;*()[]&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="Mock-Random-string-pool-min-max"><a href="#Mock-Random-string-pool-min-max" class="headerlink" title="Mock.Random.string(pool?, min?, max?)"></a>Mock.Random.string(pool?, min?, max?)</h4><p>pool: available string pool<br>min: min-length, default to 3<br>max: max-length, default to 7</p>
<h4 id="Mock-Random-range-start-stop-step"><a href="#Mock-Random-range-start-stop-step" class="headerlink" title="Mock.Random.range(start?, stop, step?)"></a>Mock.Random.range(start?, stop, step?)</h4><h4 id="Mock-Random-date-format"><a href="#Mock-Random-date-format" class="headerlink" title="Mock.Random.date(format?)"></a>Mock.Random.date(format?)</h4><h4 id="Mock-Random-time-format"><a href="#Mock-Random-time-format" class="headerlink" title="Mock.Random.time(format?)"></a>Mock.Random.time(format?)</h4><h4 id="Mock-Random-datetime-format"><a href="#Mock-Random-datetime-format" class="headerlink" title="Mock.Random.datetime(format?)"></a>Mock.Random.datetime(format?)</h4><h4 id="Mock-Random-now-unit-format"><a href="#Mock-Random-now-unit-format" class="headerlink" title="Mock.Random.now(unit?, format?)"></a>Mock.Random.now(unit?, format?)</h4><h4 id="Mock-Random-image-size-background-foreground-format-text"><a href="#Mock-Random-image-size-background-foreground-format-text" class="headerlink" title="Mock.Random.image(size?, background?, foreground?, format?, text?)"></a>Mock.Random.image(size?, background?, foreground?, format?, text?)</h4><h4 id="Mock-Random-dataImage-size-text"><a href="#Mock-Random-dataImage-size-text" class="headerlink" title="Mock.Random.dataImage(size?, text?)"></a>Mock.Random.dataImage(size?, text?)</h4><h4 id="Mock-Random-color"><a href="#Mock-Random-color" class="headerlink" title="Mock.Random.color()"></a>Mock.Random.color()</h4><h4 id="Mock-Random-hex"><a href="#Mock-Random-hex" class="headerlink" title="Mock.Random.hex()"></a>Mock.Random.hex()</h4><h4 id="Mock-Random-rgb"><a href="#Mock-Random-rgb" class="headerlink" title="Mock.Random.rgb()"></a>Mock.Random.rgb()</h4><h4 id="Mock-Random-rbga"><a href="#Mock-Random-rbga" class="headerlink" title="Mock.Random.rbga()"></a>Mock.Random.rbga()</h4><h4 id="Mock-Random-hsl"><a href="#Mock-Random-hsl" class="headerlink" title="Mock.Random.hsl()"></a>Mock.Random.hsl()</h4><h4 id="Mock-Random-paragraph-null-length-min-max-Mock-Random-cparagraph-null-length-min-max"><a href="#Mock-Random-paragraph-null-length-min-max-Mock-Random-cparagraph-null-length-min-max" class="headerlink" title="Mock.Random.paragraph(null | length | min, max) | Mock.Random.cparagraph(null | length | min, max)"></a>Mock.Random.paragraph(null | length | min, max) | Mock.Random.cparagraph(null | length | min, max)</h4><h4 id="Mock-Random-sentence-null-length-min-max-Mock-Random-csentence-null-length-min-max"><a href="#Mock-Random-sentence-null-length-min-max-Mock-Random-csentence-null-length-min-max" class="headerlink" title="Mock.Random.sentence(null | length | min, max) | Mock.Random.csentence(null | length | min, max)"></a>Mock.Random.sentence(null | length | min, max) | Mock.Random.csentence(null | length | min, max)</h4><h4 id="Mock-Random-workd-null-length-min-max-Mock-Random-cword-pool-min-max"><a href="#Mock-Random-workd-null-length-min-max-Mock-Random-cword-pool-min-max" class="headerlink" title="Mock.Random.workd(null | length | min, max) | Mock.Random.cword(pool?, min?, max?)"></a>Mock.Random.workd(null | length | min, max) | Mock.Random.cword(pool?, min?, max?)</h4><h4 id="Mock-Random-title-null-length-min-max-Mock-Random-ctitle-null-length-min-max"><a href="#Mock-Random-title-null-length-min-max-Mock-Random-ctitle-null-length-min-max" class="headerlink" title="Mock.Random.title(null | length | min, max) | Mock.Random.ctitle(null | length | min, max)"></a>Mock.Random.title(null | length | min, max) | Mock.Random.ctitle(null | length | min, max)</h4><h4 id="Mock-Random-first-Mock-Random-last-Mock-Random-name-middle-Mock-Random-cfirst-Mock-Random-clast-Mock-Random-cname"><a href="#Mock-Random-first-Mock-Random-last-Mock-Random-name-middle-Mock-Random-cfirst-Mock-Random-clast-Mock-Random-cname" class="headerlink" title="Mock.Random.first() | Mock.Random.last() | Mock.Random.name(middle?) | Mock.Random.cfirst() | Mock.Random.clast() | Mock.Random.cname()"></a>Mock.Random.first() | Mock.Random.last() | Mock.Random.name(middle?) | Mock.Random.cfirst() | Mock.Random.clast() | Mock.Random.cname()</h4><h4 id="Mock-Random-url-protocol-host"><a href="#Mock-Random-url-protocol-host" class="headerlink" title="Mock.Random.url(protocol?, host?)"></a>Mock.Random.url(protocol?, host?)</h4><h4 id="Mock-Random-protocol-Mock-Random-domain-Mock-Random-tld-Mock-Random-email-domain-Mock-Random-ip"><a href="#Mock-Random-protocol-Mock-Random-domain-Mock-Random-tld-Mock-Random-email-domain-Mock-Random-ip" class="headerlink" title="Mock.Random.protocol() | Mock.Random.domain() | Mock.Random.tld() | Mock.Random.email(domain?) | Mock.Random.ip()"></a>Mock.Random.protocol() | Mock.Random.domain() | Mock.Random.tld() | Mock.Random.email(domain?) | Mock.Random.ip()</h4><h4 id="Mock-Random-region-Mock-Random-province-Mock-Random-city-prefix-Mock-Random-county-prefix-Mock-Random-zip"><a href="#Mock-Random-region-Mock-Random-province-Mock-Random-city-prefix-Mock-Random-county-prefix-Mock-Random-zip" class="headerlink" title="Mock.Random.region() | Mock.Random.province() | Mock.Random.city(prefix?) | Mock.Random.county(prefix?) | Mock.Random.zip()"></a>Mock.Random.region() | Mock.Random.province() | Mock.Random.city(prefix?) | Mock.Random.county(prefix?) | Mock.Random.zip()</h4><h4 id="Mock-Random-captilize-word-Mock-Random-upper-str-Mock-Random-lower-str-Mock-Random-pick-arr-Mock-Random-shuffle-arr"><a href="#Mock-Random-captilize-word-Mock-Random-upper-str-Mock-Random-lower-str-Mock-Random-pick-arr-Mock-Random-shuffle-arr" class="headerlink" title="Mock.Random.captilize(word) | Mock.Random.upper(str) | Mock.Random.lower(str) | Mock.Random.pick(arr) | Mock.Random.shuffle(arr)"></a>Mock.Random.captilize(word) | Mock.Random.upper(str) | Mock.Random.lower(str) | Mock.Random.pick(arr) | Mock.Random.shuffle(arr)</h4><h4 id="Mock-Random-guid"><a href="#Mock-Random-guid" class="headerlink" title="Mock.Random.guid()"></a>Mock.Random.guid()</h4><p>Generate a GUID</p>
<h4 id="Mock-Random-id"><a href="#Mock-Random-id" class="headerlink" title="Mock.Random.id()"></a>Mock.Random.id()</h4><p>Generate a Personal Identity</p>
<h4 id="Mock-Random-increment-step"><a href="#Mock-Random-increment-step" class="headerlink" title="Mock.Random.increment(step?)"></a>Mock.Random.increment(step?)</h4><h3 id="Mock-valid-template-data"><a href="#Mock-valid-template-data" class="headerlink" title="Mock.valid(template, data)"></a>Mock.valid(template, data)</h3><p>Check if the data is matching the template</p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-28T16:06:59.000Z">2017-08-29</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    18 minutes read (About 2680 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/29/Start-at-Pug/">Start at Pug</a>
            
        </h1>
        <div class="content">
            <h3 id="Install-Pug"><a href="#Install-Pug" class="headerlink" title="Install Pug"></a>Install Pug</h3><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add pug</span><br></pre></td></tr></table></figure>
<h3 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h3><p><code>pug.compile()</code> will compile the Pug source code into a JavaScript function that takes a data object(called <code>locals</code>) as an argument. Call that resultant function with your data, then it will return a string of HTML rendered with your data.</p>
<p>The compiled function can be re-used, and called with different sets of data.</p>
<figure class="highlight html hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// - template.pug</span><br><span class="line">p #&#123;name&#125;'s Pug source code!</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> pug = <span class="hljs-built_in">require</span>(<span class="hljs-string">'pug'</span>)</span><br><span class="line"><span class="hljs-comment">// Compile the source code</span></span><br><span class="line"><span class="hljs-keyword">const</span> compiledFunction = pug.compile(<span class="hljs-string">'template.pug'</span>)</span><br><span class="line"><span class="hljs-comment">// Render a set of data</span></span><br><span class="line"><span class="hljs-built_in">console</span>.log(compiledFunction(&#123;</span><br><span class="line">  name: <span class="hljs-string">'Timothy'</span></span><br><span class="line">&#125;))</span><br><span class="line"><span class="hljs-comment">// "&lt;p&gt;Timothy's Pug source code!&lt;/p&gt;"</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// Render another set of data</span></span><br><span class="line"><span class="hljs-built_in">console</span>.log(compiledFunction(&#123;</span><br><span class="line">  name: <span class="hljs-string">'Forbes'</span></span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// "&lt;p&gt;Forbes' Pug source code!&lt;/p&gt;"</span></span><br></pre></td></tr></table></figure>
<p>Pug also provides the <code>pug.render()</code> family of functions that combine compileing and rendering into one step. However, the template function will be re-compiled every time <code>render</code> is called, which might impact performance. Alternatively, you can use the <code>cache</code> option with <code>render</code>, which will automatically store the compiled function into an internal cache.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> pug = <span class="hljs-built_in">require</span>(<span class="hljs-string">'pug'</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// Compile template.pug and render a set of data</span></span><br><span class="line"><span class="hljs-built_in">console</span>.log(pug.renderFile(<span class="hljs-string">'template.pug'</span>, &#123;</span><br><span class="line">  name: <span class="hljs-string">'Timothy'</span></span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure>
<h3 id="Use-with-Express"><a href="#Use-with-Express" class="headerlink" title="Use with Express"></a>Use with Express</h3><p>Pug fully integrates with <code>Express</code>, as a supported view engine.</p>
<h4 id="Production-Defaults"><a href="#Production-Defaults" class="headerlink" title="Production Defaults"></a>Production Defaults</h4><p>In Express, the environmental variables <code>NODE_ENV</code> is designed to inform the web application of the execution environment: whether it is in development or in production. Express and Pug automatically modify the defaults of a few options in production environment, to provide a better out-of-the-box experience for users.</p>
<p>Specifically, when <code>process.env.NODE_ENV</code> is set to <code>&#39;production&#39;</code>, and Pug is used with Express, the <code>compileDebug</code> option is <code>false</code> by default, while the <code>cache</code> option is <code>true</code>.</p>
<h3 id="API-Reference"><a href="#API-Reference" class="headerlink" title="API Reference"></a>API Reference</h3><p>All API mehtods accept the following set of options:</p>
<ul>
<li><p>filename: string</p>
<p>The name of the file being compiled. Used in exceptions, and required for relative <code>include</code> and <code>extend</code>. Default to <code>Pug</code></p>
</li>
<li><p>basedir: string</p>
<p>The root directory of all absolute inclusion</p>
</li>
<li><p>doctype: string</p>
<p>If the <code>doctype</code> is not specified as part of the template, you can specify it here. It is sometimes useful to get self-closing tags and remove mirroring of boolean attributes.</p>
</li>
<li><p>filters: object</p>
<p>Hash table of custom filters. Default to <code>undefined</code></p>
</li>
<li><p>self: boolean</p>
<p>Use a <code>self</code> namespaces to hold the locals. It will speed up the compilation, but instead of writing <code>variable</code> you will have to write <code>self.variable</code> to access to property of the locals object. Default to <code>false</code></p>
</li>
<li><p>debug: boolean</p>
<p>If set to <code>true</code>, the tokens and function body are logged to stdout</p>
</li>
<li><p>compileDebug: boolean</p>
<p>If set to <code>true</code>, the function source will be included in the compiled template for better error messages. It is enabled by default, unless used with express in production mode.</p>
</li>
<li><p>globals: Array<string></string></p>
<p>Add a list of global names to make accessible in templates</p>
</li>
<li><p>cache: boolean</p>
<p>If set to <code>true</code>, compiled functions are cached. <code>filename</code> must be set as the cache key. Only applies to <code>render</code> functions. Default to <code>false</code></p>
</li>
<li><p>inlineRuntimeFunctions: boolean</p>
<p>Inline runtime functions instead of <code>require</code>-ing them from a shared version. For <code>compileClient</code> functions, the default is <code>true</code>(so that one does not have include the runtime). For all other compilation or rendering types, the default is <code>false</code></p>
</li>
<li><p>name: string</p>
<p>The name of the template function. Only applies to <code>compileClient</code> function. Default to <code>template</code>.</p>
</li>
</ul>
<h3 id="Methods"><a href="#Methods" class="headerlink" title="Methods"></a>Methods</h3><ul>
<li><p>pug.compile(source[, options])</p>
<p>Compile a Pug template to a function, which can be rendered multiple times with different locals.</p>
<ul>
<li><p>source: string</p>
<p>the source pug template to compile</p>
</li>
<li><p>options: An option object</p>
</li>
<li><p>returns: function</p>
<p>A function to generate the HTML from an object containing locals</p>
</li>
</ul>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> pug = <span class="hljs-built_in">require</span>(<span class="hljs-string">'pug'</span>)</span><br><span class="line"><span class="hljs-keyword">var</span> compiledTemplate = pug.compile(<span class="hljs-string">'string of pug'</span>, options)</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">var</span> html = compiledFunction(locals)</span><br></pre></td></tr></table></figure>
</li>
<li><p>pug.compileFile(path[, options])</p>
<p>Compile a Pug template from a file to a function, which can be rendered multiple times with different locals.</p>
<ul>
<li><p>path: string</p>
<p>The path to a Pug file</p>
</li>
<li><p>options: An option object</p>
</li>
<li><p>returns: function</p>
<p>A function to generate HTML from an object containing locals</p>
</li>
</ul>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> pug = <span class="hljs-built_in">require</span>(<span class="hljs-string">'pug'</span>)</span><br><span class="line"><span class="hljs-keyword">var</span> compiledTemplate = pug.compileFile(<span class="hljs-string">'path to pug file'</span>, options)</span><br><span class="line"><span class="hljs-keyword">var</span> html = compiledTemplate(locals)</span><br></pre></td></tr></table></figure>
</li>
<li><p>pug.compileClient(source[, options])</p>
<p>Compile a Pug template to a string of JavaScript, which can be used client side along with Pug runtime.</p>
<ul>
<li><p>source: string</p>
<p>The Pug template to compile</p>
</li>
<li><p>options: an option object</p>
</li>
<li><p>returns: string</p>
<p>A string of JavaScript representing a function</p>
</li>
</ul>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> pug = <span class="hljs-built_in">require</span>(<span class="hljs-string">'pug'</span>)</span><br><span class="line"><span class="hljs-keyword">var</span> compiledTemplate = pug.compileClient(<span class="hljs-string">'string of pug'</span>, options)</span><br><span class="line"><span class="hljs-keyword">var</span> html = compiledTemplate(locals)</span><br></pre></td></tr></table></figure>
</li>
<li><p>pug.render(source[, options[, callback]])</p>
<ul>
<li><p>source: string</p>
<p>The source pug template to render</p>
</li>
<li><p>options: an options object</p>
</li>
<li><p>callback: function</p>
<p>Node.js-style callback receiving the rendered results. <strong>The callback is called synchronously</strong>.</p>
</li>
<li><p>returns: string</p>
<p>The resulting HTML String</p>
</li>
</ul>
</li>
<li><p>pug.renderFile(path[, options[, callback]])</p>
<ul>
<li><p>path: string</p>
<p>the path to the pug file to render</p>
</li>
<li><p>option: an options object</p>
</li>
<li><p>callback: function</p>
<p>Node.js-style callback receiving the rendered results. <strong>This callback is called synchronously.</strong></p>
</li>
<li><p>returns: function</p>
<p>The resulting HTML stirng</p>
</li>
</ul>
</li>
</ul>
<h3 id="Attributes"><a href="#Attributes" class="headerlink" title="Attributes"></a>Attributes</h3><p>Tag attributes look similar to HTML(with optional commas), but their values are just regular JavaScript.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a(href=<span class="hljs-string">'google.com'</span>) Google =&gt; <span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"google.com"</span>&gt;</span>Google<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>Normal JavaScript expression works fine:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> authenticated = <span class="hljs-literal">true</span></span><br><span class="line">body(<span class="hljs-class"><span class="hljs-keyword">class</span></span>=authenticated ? <span class="hljs-string">'authed'</span> : <span class="hljs-string">'anon'</span>) =&gt; <span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"authed"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h4 id="Multiline-Attributes"><a href="#Multiline-Attributes" class="headerlink" title="Multiline Attributes"></a>Multiline Attributes</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">input(</span><br><span class="line">  type=<span class="hljs-string">'checkbox'</span></span><br><span class="line">  name=<span class="hljs-string">'agreement'</span></span><br><span class="line">  checked</span><br><span class="line">)</span><br><span class="line">=&gt; <span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"checkbox"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"agreement"</span> <span class="hljs-attr">checked</span> /&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>If your JavaScript runtime supports ES6 template strings, you can use that syntax for attributes.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">input(data-json=<span class="hljs-string">`</span></span><br><span class="line"><span class="hljs-string">  &#123;</span></span><br><span class="line"><span class="hljs-string">    "very-long": "piece of",</span></span><br><span class="line"><span class="hljs-string">    "data": true</span></span><br><span class="line"><span class="hljs-string">  &#125;</span></span><br><span class="line"><span class="hljs-string">`</span>)</span><br><span class="line">=&gt; <span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">data-json</span>=<span class="hljs-string">"</span></span></span></span><br><span class="line"><span class="hljs-xml">  &#123;</span></span><br><span class="line"><span class="hljs-xml">    &amp;quot;very-long&amp;quot;: &amp;quot;piece of &amp;quot;,</span></span><br><span class="line"><span class="hljs-xml">    &amp;quot;data&amp;quot;: true</span></span><br><span class="line"><span class="hljs-xml">  &#125;</span></span><br><span class="line"><span class="hljs-xml">"/&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="Quoted-Attributes"><a href="#Quoted-Attributes" class="headerlink" title="Quoted Attributes"></a>Quoted Attributes</h4><p>If your attribute name contains odd character that might interfere with JavaScript syntax, either quote it using <code>&quot;&quot;</code> or <code>&#39;&#39;</code>, or use commas to separate different attributes.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">div(<span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">'div-class'</span>, (click)=<span class="hljs-string">'play()'</span>)</span><br><span class="line">div(<span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">'div-class'</span> <span class="hljs-string">'(click)'</span>=<span class="hljs-string">'play()'</span>)</span><br><span class="line">=&gt; <span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div-class"</span> (<span class="hljs-attr">click</span>)=<span class="hljs-string">"play()"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h4 id="Attribute-Interpolation"><a href="#Attribute-Interpolation" class="headerlink" title="Attribute Interpolation"></a>Attribute Interpolation</h4><ul>
<li><p>Simply write the attribute in JavaScript:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> url = <span class="hljs-string">'pub-test.html'</span></span><br><span class="line">a(href=<span class="hljs-string">'/'</span> + url) Link =&gt; <span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">'/pub-test.html'</span>&gt;</span>Link<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">var</span> btnType = <span class="hljs-string">'info'</span></span><br><span class="line"><span class="hljs-keyword">var</span> btnSize = <span class="hljs-string">'lg'</span></span><br><span class="line">button(type=<span class="hljs-string">'button'</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">`btn btn-<span class="hljs-subst">$&#123;btnType&#125;</span> btn-<span class="hljs-subst">$&#123;btnSize&#125;</span>`</span>)</span><br><span class="line">=&gt; &lt;button type="button" class="btn btn-info btn-lg"&gt;&lt;button&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="Boolean-Attributes"><a href="#Boolean-Attributes" class="headerlink" title="Boolean Attributes"></a>Boolean Attributes</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">input(type=<span class="hljs-string">'checkbox'</span> checked) =&gt; <span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"checkbox"</span> <span class="hljs-attr">checked</span>=<span class="hljs-string">"checked"</span> /&gt;</span></span></span><br><span class="line">input(type='checkbox' checked=true) =&gt; &lt;input type="checkbox" checked="checked" /&gt;</span><br><span class="line">input(type='checkbox' checked=false) =&gt; &lt;input type="checkbox" /&gt;</span><br><span class="line">input(type='checkbox' checked=true.toString()) =&gt; &lt;input type="checkbox" checked="true" /&gt;</span><br></pre></td></tr></table></figure>
<h4 id="Style-Attributes"><a href="#Style-Attributes" class="headerlink" title="Style Attributes"></a>Style Attributes</h4><p>The style attribute can be a string, like any normal attribute, but it can be an object, which is handy when styles are generated by JavaScript:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a(style=&#123;<span class="hljs-attr">color</span>: <span class="hljs-string">'red'</span>, <span class="hljs-attr">background</span>: <span class="hljs-string">'green'</span>&#125;) =&gt; <span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"color:red;background:green;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h4 id="Class-Attributes"><a href="#Class-Attributes" class="headerlink" title="Class Attributes"></a>Class Attributes</h4><p>The <code>class</code> attribute can be a string, like any normal attribute, but is also can be an array of class names, which is handy when generated from JavaScript.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> classes = [<span class="hljs-string">'foo'</span>, <span class="hljs-string">'bar'</span>, <span class="hljs-string">'baz'</span>]</span><br><span class="line">a(<span class="hljs-class"><span class="hljs-keyword">class</span></span>=classes) =&gt; <span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"foo bar baz"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">a.bang(<span class="hljs-class"><span class="hljs-keyword">class</span></span>=classes <span class="hljs-class"><span class="hljs-keyword">class</span></span>=[bing]) =&gt; <span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"bang foo bar baz bing"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>It can also be an object which maps class names to <code>true</code> or <code>false</code> values. This is useful for applying conditional classes:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> currentURL = <span class="hljs-string">'/about'</span></span><br><span class="line">a(<span class="hljs-class"><span class="hljs-keyword">class</span></span>=&#123;<span class="hljs-attr">active</span>: currentURL === <span class="hljs-string">'/about'</span> href=<span class="hljs-string">'/about'</span>&#125;) =&gt; <span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"active"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h4 id="Class-Literal"><a href="#Class-Literal" class="headerlink" title="Class Literal"></a>Class Literal</h4><p>Classes may be defined using a <code>.classname</code> syntax:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a.button =&gt; <span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>Since <code>div</code>s are such a common choice of tag, it is default if you omit the tag name:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.content =&gt; <span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h4 id="ID-Literal"><a href="#ID-Literal" class="headerlink" title="ID Literal"></a>ID Literal</h4><figure class="highlight hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a#main-link =&gt; &lt;a id="main-link"&gt;&lt;/a&gt;</span><br></pre></td></tr></table></figure>
<h4 id="amp-attributes"><a href="#amp-attributes" class="headerlink" title="&amp;attributes"></a>&amp;attributes</h4><p>Pronounced as <code>and attributes</code>, the <code>&amp;attributes</code> syntax can be used to expode an object into attributes of an element:</p>
<figure class="highlight hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dev#foo(data-json="foo")&amp;attributes(&#123;'data-foo': 'bar'&#125;) =&gt; &lt;div id="foo" data-json="foo" data-foo="bar" /&gt;</span><br></pre></td></tr></table></figure>
<h3 id="Case"><a href="#Case" class="headerlink" title="Case"></a>Case</h3><p>The <code>case</code> statement is a shorthand for JavaScript’s switch, it takes the following form:</p>
<figure class="highlight hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> friends = <span class="hljs-number">10</span></span><br><span class="line"><span class="hljs-keyword">case</span> friends</span><br><span class="line">  when <span class="hljs-number">0</span></span><br><span class="line">    p you have no friends</span><br><span class="line">  when <span class="hljs-number">1</span></span><br><span class="line">    p you have a friend</span><br><span class="line">  <span class="hljs-keyword">default</span></span><br><span class="line">    p you have #&#123;friends&#125; friends</span><br></pre></td></tr></table></figure>
<h4 id="Case-Fall-Through"><a href="#Case-Fall-Through" class="headerlink" title="Case Fall Through"></a>Case Fall Through</h4><p>You can use fall through, just as you would in a JavaScript <code>switch</code> statement</p>
<figure class="highlight hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> friends = <span class="hljs-number">0</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">case</span> friends</span><br><span class="line">  when <span class="hljs-number">0</span></span><br><span class="line">  when <span class="hljs-number">1</span></span><br><span class="line">    p you have very few friends</span><br><span class="line">  <span class="hljs-keyword">default</span></span><br><span class="line">    p you have #&#123;friends&#125; friends</span><br></pre></td></tr></table></figure>
<p>The difference, however, is a fall through in JavaScript happens whenever a <code>break</code> statement is not explicitly included.</p>
<h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><p>Pug allows you to write inline JavaScript code in your templates. There are three types of code: Unbuffered, Buffered, and Unescaped Buffered.</p>
<h4 id="Unbuffered-Code"><a href="#Unbuffered-Code" class="headerlink" title="Unbuffered Code"></a>Unbuffered Code</h4><p>Unbuffered code starts with <code>-</code>. It does not directly add anything to the output</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> x = <span class="hljs-number">0</span>; x &lt; <span class="hljs-number">3</span>; x++)</span><br><span class="line">  li item</span><br><span class="line"></span><br><span class="line">=&gt;</span><br><span class="line"></span><br><span class="line">&lt;li&gt;item&lt;<span class="hljs-regexp">/li&gt;</span></span><br><span class="line"><span class="hljs-regexp">&lt;li&gt;item&lt;/</span>li&gt;</span><br><span class="line">&lt;li&gt;item&lt;<span class="hljs-regexp">/li&gt;</span></span><br></pre></td></tr></table></figure>
<p>Pug also supports block unbuffered code:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">-</span><br><span class="line">  <span class="hljs-keyword">var</span> list = [<span class="hljs-string">'Uno'</span>, <span class="hljs-string">'Dos'</span>, <span class="hljs-string">'Tres'</span>, <span class="hljs-string">'Cuatro'</span>, <span class="hljs-string">'Cinco'</span>, <span class="hljs-string">'Seis'</span>]</span><br><span class="line">  each item <span class="hljs-keyword">in</span> list</span><br><span class="line">    li= item</span><br><span class="line"></span><br><span class="line">=&gt;</span><br><span class="line"></span><br><span class="line">  &lt;li&gt;Uno&lt;<span class="hljs-regexp">/li&gt;</span></span><br><span class="line"><span class="hljs-regexp">  &lt;li&gt;Dos&lt;/</span>li&gt;</span><br><span class="line">  &lt;li&gt;Tres&lt;<span class="hljs-regexp">/li&gt;</span></span><br><span class="line"><span class="hljs-regexp">  &lt;li&gt;Cuatro&lt;/</span>li&gt;</span><br><span class="line">  &lt;li&gt;Cinco&lt;<span class="hljs-regexp">/li&gt;</span></span><br><span class="line"><span class="hljs-regexp">  &lt;li&gt;Seis&lt;/</span>li&gt;</span><br></pre></td></tr></table></figure>
<h4 id="Buffered-Code"><a href="#Buffered-Code" class="headerlink" title="Buffered Code"></a>Buffered Code</h4><p>Buffered code start with <code>=</code>. It evaluates the JavaScript expression and outputs the result. For security, buffered code is first HTML excaped.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">p = <span class="hljs-string">'This code is &lt;escaped&gt;!'</span></span><br><span class="line"></span><br><span class="line">=&gt; <span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>This code is &amp;lt;escaped&amp;gt;!<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>it can also be written inline with attributes, and supports the full range of JavaScript expression:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p= <span class="hljs-string">'This code is'</span> + <span class="hljs-string">' &lt;escaped&gt;!'</span> =&gt; <span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>This code is &amp;gt;escaped&amp;gt;!<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h4 id="Unescaped-Buffered-Code"><a href="#Unescaped-Buffered-Code" class="headerlink" title="Unescaped Buffered Code"></a>Unescaped Buffered Code</h4><p>Unescaped buffered code starts with <code>!=</code>. It evaluates the JavaScript expression and outputs the result. Unescaped buffered code does not perform any escaping, so is unsafe for user input.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p != <span class="hljs-string">'This code is &lt;strong&gt;not&lt;/strong&gt; escaped!'</span> =&gt; <span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>This code is <span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>not<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span> escaped!<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h3 id="Comments"><a href="#Comments" class="headerlink" title="Comments"></a>Comments</h3><p>Buffered comments look the same as single-line JavaScript comments. They act sort of like markup tags, producing <em>HTML</em> comments in the rendered page.</p>
<p>Like tags, buffered comments must appear on their own line:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// just some paragraphs</span></span><br><span class="line">p foo</span><br><span class="line">p bar</span><br><span class="line"></span><br><span class="line">=&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- just some paragraph --&gt;</span><br><span class="line">&lt;p&gt;foo&lt;<span class="hljs-regexp">/p&gt;</span></span><br><span class="line"><span class="hljs-regexp">&lt;p&gt;bar&lt;/</span>p&gt;</span><br></pre></td></tr></table></figure>
<p>Pug also supports unbuffered comments, Simply ass a hyphen(<code>-</code>) to the start of the comment.</p>
<p>These are only for commenting on the Pug code itself, and <em>do not</em> appear in the rendered HTML.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//- will not output within markup</span></span><br><span class="line">p foo</span><br><span class="line"></span><br><span class="line">=&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;foo&lt;<span class="hljs-regexp">/p&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="Block-Comments"><a href="#Block-Comments" class="headerlink" title="Block Comments"></a>Block Comments</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">body</span><br><span class="line"><span class="hljs-comment">//- Comments for your templates writers.</span></span><br><span class="line">    Use <span class="hljs-keyword">as</span> much text <span class="hljs-keyword">as</span> you want</span><br><span class="line"><span class="hljs-comment">// Comments for your HTML readers</span></span><br><span class="line">    Use <span class="hljs-keyword">as</span> much text <span class="hljs-keyword">as</span> you want</span><br></pre></td></tr></table></figure>
<h3 id="Conditionals"><a href="#Conditionals" class="headerlink" title="Conditionals"></a>Conditionals</h3><p>Pug’s first-class conditional syntax allows for optional parenthese.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- <span class="hljs-keyword">var</span> user = &#123; <span class="hljs-attr">description</span>: <span class="hljs-string">'foo bar baz '</span>&#125;</span><br><span class="line">- <span class="hljs-keyword">var</span> authorized = <span class="hljs-literal">false</span></span><br><span class="line">#user</span><br><span class="line">  <span class="hljs-keyword">if</span> user.description</span><br><span class="line">    h2.green Description</span><br><span class="line">    p.description= user.description</span><br><span class="line">  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> authorized</span><br><span class="line">    h2.blue Description</span><br><span class="line">    p.description.</span><br><span class="line">      User has no description</span><br><span class="line">      why not add one...</span><br><span class="line">  <span class="hljs-keyword">else</span></span><br><span class="line">    h2.red Description</span><br><span class="line">    p.description User has no description</span><br></pre></td></tr></table></figure>
<p>Pug also provides the conditional <code>unless</code> which works like a negated <code>if</code>. The following are equivalent:</p>
<figure class="highlight hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">unless user.isAnonymous</span><br><span class="line">  p You<span class="hljs-string">'re logged in as #&#123;user.name&#125;</span></span><br><span class="line"><span class="hljs-string"></span></span><br><span class="line"><span class="hljs-string">=</span></span><br><span class="line"><span class="hljs-string"></span></span><br><span class="line"><span class="hljs-string">if !user.isAnonymous</span></span><br><span class="line">  p You're logged in as #&#123;user.name&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Filters"><a href="#Filters" class="headerlink" title="Filters"></a>Filters</h3><h3 id="Include"><a href="#Include" class="headerlink" title="Include"></a>Include</h3><p>Include allow you to insert the contents of one Pug file into another.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// index.pug</span></span><br><span class="line">doctype html</span><br><span class="line">html</span><br><span class="line">  include includes/head.pug</span><br><span class="line">  body</span><br><span class="line">    h1 My Site</span><br><span class="line">    p Welcome to my <span class="hljs-keyword">super</span> lame site</span><br><span class="line">    include includes/foot.pug</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// includes/head.pug</span></span><br><span class="line">head</span><br><span class="line">  title My Site</span><br><span class="line">  script(src=<span class="hljs-string">'/javascripts/jquery.js'</span>)</span><br><span class="line">  script(src=<span class="hljs-string">'/javascripts/app.js'</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// includes/foot.pug</span></span><br><span class="line">footer#footer</span><br><span class="line">  p Copyright (c) foobar</span><br></pre></td></tr></table></figure>
<p>If the path is absolute(e.g. <code>include /root.pug</code>), it is resolved by prepending <code>options.basedir</code>.</p>
<p>If no file extension is given, <code>.pug</code> is automatically appended to the file name.</p>
<h4 id="Including-Plain-Text"><a href="#Including-Plain-Text" class="headerlink" title="Including Plain Text"></a>Including Plain Text</h4><p>Including non-Pug files simply includes their raw text.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// index.pug</span></span><br><span class="line">doctype html</span><br><span class="line">html</span><br><span class="line">  head</span><br><span class="line">    style</span><br><span class="line">      include style.css</span><br><span class="line">    body</span><br><span class="line">      h1 My Site</span><br><span class="line">      p Welcome to my <span class="hljs-keyword">super</span> lame site</span><br><span class="line">      script</span><br><span class="line">        include script.js</span><br><span class="line"><span class="hljs-comment">// style.css</span></span><br><span class="line">h1 &#123;</span><br><span class="line">  color: red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// script.js</span></span><br><span class="line"><span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Yor are awesome'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Template-Inheritance"><a href="#Template-Inheritance" class="headerlink" title="Template Inheritance"></a>Template Inheritance</h3><p>Pug supports template inheritance. Template instance works via <code>block</code> and <code>extends</code> keyword.</p>
<p>In a template, a <code>block</code> is simply a ‘block’ of Pug that a child template may replace. This process is recursive.</p>
<p>Pug blocks can provide default content, if appropriate. Providing default content is purely optional, though. The example below defines <code>block scripts</code>, <code>block content</code> and <code>block foot</code></p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// layout.pug</span></span><br><span class="line">html</span><br><span class="line">  head</span><br><span class="line">    title My Site - #&#123;title&#125;</span><br><span class="line">    block scripts</span><br><span class="line">      script(src=<span class="hljs-string">'/jquery.js'</span>)</span><br><span class="line">  body</span><br><span class="line">    block content</span><br><span class="line">    block foot</span><br><span class="line">      #footer</span><br><span class="line">        p some footer content</span><br></pre></td></tr></table></figure>
<p>To extend this layout, create a new file and use the <code>extends</code> directive with a path to the parent template(if no file extension is given, <code>.pug</code> is automatically appended to the file name). Then define one or more blocks to override the parent block content.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// page-a.pug</span></span><br><span class="line">extends layout.pug</span><br><span class="line"></span><br><span class="line">block scripts</span><br><span class="line">  script(src=<span class="hljs-string">"/jquery.js"</span>)</span><br><span class="line">  script(src=<span class="hljs-string">"/pets.js"</span>)</span><br><span class="line"></span><br><span class="line">block content</span><br><span class="line">  h1= title</span><br><span class="line">  - <span class="hljs-keyword">var</span> pets = [<span class="hljs-string">'cat'</span>, <span class="hljs-string">'dog'</span>]</span><br><span class="line">  each petName <span class="hljs-keyword">in</span> pets</span><br><span class="line">    include pet.pug</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// pet.pug</span></span><br><span class="line">p= petName</span><br></pre></td></tr></table></figure>
<h3 id="Block-append-prepend"><a href="#Block-append-prepend" class="headerlink" title="Block append/prepend"></a>Block append/prepend</h3><p>Pug allows you to <code>replace</code>, <code>prepend</code> and <code>append</code> blocks</p>
<p>Suppose you have default scripts in a <code>head</code> block that you wish to use on <em>every page</em> you might do this:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// layout.pug</span></span><br><span class="line">html</span><br><span class="line">  head</span><br><span class="line">   block head</span><br><span class="line">    script(src=<span class="hljs-string">"/vendor/jquery.js"</span>)</span><br><span class="line">    script(src=<span class="hljs-string">"/vendor/caustic.js"</span>)</span><br><span class="line">  body</span><br><span class="line">    block content</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// page.pug</span></span><br><span class="line">extends layout</span><br><span class="line"></span><br><span class="line">append head</span><br><span class="line">  script(src=<span class="hljs-string">"/vendor/three.js"</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Interpolation"><a href="#Interpolation" class="headerlink" title="Interpolation"></a>Interpolation</h3><h4 id="String-Interpolation-Escaped"><a href="#String-Interpolation-Escaped" class="headerlink" title="String Interpolation, Escaped"></a>String Interpolation, Escaped</h4><p>Consider the placement of the following tempalte’s locals: <code>title</code>, <code>author</code> and <code>theGreat</code></p>
<figure class="highlight hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- <span class="hljs-keyword">var</span> title = <span class="hljs-string">'On Dogs'</span></span><br><span class="line">- <span class="hljs-keyword">var</span> author = <span class="hljs-string">'enlore'</span></span><br><span class="line">- <span class="hljs-keyword">var</span> theGreat = <span class="hljs-string">'&lt;span&gt;escaped!&lt;/span&gt;'</span></span><br><span class="line"></span><br><span class="line">h1= title</span><br><span class="line">p Written by #&#123;author&#125;</span><br><span class="line">p This will be safe: #&#123;theGreat&#125;</span><br></pre></td></tr></table></figure>
<p>This can be valid JavaScript expression, so you can do whatever feels good.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- <span class="hljs-keyword">var</span> msg = <span class="hljs-string">'not my inside voice'</span></span><br><span class="line">p This is $&#123;msg.toUpperCase()&#125;</span><br></pre></td></tr></table></figure>
<h3 id="String-Interpolation-Unescaped"><a href="#String-Interpolation-Unescaped" class="headerlink" title="String Interpolation, Unescaped"></a>String Interpolation, Unescaped</h3><p>You don’t have to play it safe, you can buffer unescaped values into your templates too</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- <span class="hljs-keyword">var</span> riskyBusiness = <span class="hljs-string">'&lt;em&gt;Some of the girts&lt;/em&gt;'</span></span><br><span class="line">.quote</span><br><span class="line">  p joel: !&#123;riskyBusiness&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Keep in mind that buffering unescaped content into your templates can be mighty risky if that content comes fresh from your users.</p>
</blockquote>
<h4 id="Tag-Interpolation"><a href="#Tag-Interpolation" class="headerlink" title="Tag Interpolation"></a>Tag Interpolation</h4><p>Interpolation works not only on JavaScript values, but on Pug as well, just use the tag interpolation syntax like so:</p>
<figure class="highlight hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p.</span><br><span class="line">  Interpolate #[strong strongly word] there</span><br></pre></td></tr></table></figure>
<h4 id="Whitespace-Control"><a href="#Whitespace-Control" class="headerlink" title="Whitespace Control"></a>Whitespace Control</h4><p>The tag interpolation syntax is especially useful for inline tags, where whitespace before and after the tag is significant.</p>
<p>By default, however, Pug removes all spaces before and after tags.</p>
<h3 id="Iteration"><a href="#Iteration" class="headerlink" title="Iteration"></a>Iteration</h3><p>Pug supports two primary methods of iteration: <code>each</code> and <code>while</code></p>
<h4 id="each"><a href="#each" class="headerlink" title="each"></a>each</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">ul</span><br><span class="line">  each val, index <span class="hljs-keyword">in</span> [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]</span><br><span class="line">    li=  index + <span class="hljs-string">': '</span> + val</span><br><span class="line"></span><br><span class="line">ul</span><br><span class="line">  each val, index <span class="hljs-keyword">in</span> &#123;<span class="hljs-number">1</span>: <span class="hljs-string">'one'</span>, <span class="hljs-number">2</span>: <span class="hljs-string">'two'</span>&#125;</span><br><span class="line">    li= index + <span class="hljs-string">': '</span> + val</span><br><span class="line"></span><br><span class="line">- <span class="hljs-keyword">var</span> values = []</span><br><span class="line">ul</span><br><span class="line">  each val <span class="hljs-keyword">in</span> values.length ? values : [<span class="hljs-string">'There is no value'</span>]</span><br><span class="line">    li= val</span><br><span class="line"></span><br><span class="line">ul</span><br><span class="line">  each val <span class="hljs-keyword">in</span> values</span><br><span class="line">    li= val</span><br><span class="line">  <span class="hljs-keyword">else</span></span><br><span class="line">    li There is no value</span><br></pre></td></tr></table></figure>
<h4 id="While"><a href="#While" class="headerlink" title="While"></a>While</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- <span class="hljs-keyword">var</span> n = <span class="hljs-number">0</span></span><br><span class="line">ul</span><br><span class="line">  <span class="hljs-keyword">while</span> n &lt; <span class="hljs-number">4</span></span><br><span class="line">    li= n++</span><br></pre></td></tr></table></figure>
<h3 id="Mixins"><a href="#Mixins" class="headerlink" title="Mixins"></a>Mixins</h3><p>Mixins allow you to create reusable blocks of Pug</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// Declaration</span></span><br><span class="line">mixin list</span><br><span class="line">  ul</span><br><span class="line">    li foo</span><br><span class="line">    li bar</span><br><span class="line">    li baz</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// Use</span></span><br><span class="line">+list</span><br><span class="line">+list</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mixin pet(name)</span><br><span class="line">  li.pet= name</span><br><span class="line"></span><br><span class="line">ul</span><br><span class="line">  +pet(<span class="hljs-string">'cat'</span>)</span><br><span class="line">  +pet(<span class="hljs-string">'dog'</span>)</span><br><span class="line"></span><br><span class="line">=&gt;</span><br><span class="line">&lt;ul&gt;</span><br><span class="line">  &lt;li <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">"pet"</span>&gt;cat&lt;<span class="hljs-regexp">/li&gt;</span></span><br><span class="line"><span class="hljs-regexp">  &lt;li class="pet"&gt;dog&lt;/</span>li&gt;</span><br><span class="line">&lt;<span class="hljs-regexp">/ul&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="Mixin-Attributes"><a href="#Mixin-Attributes" class="headerlink" title="Mixin Attributes"></a>Mixin Attributes</h4><p>Mixins also get an implicit <code>attributes</code> argument, which is taken from the attributes passed to the mixin</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mixin link(href, name)</span><br><span class="line">  a(<span class="hljs-class"><span class="hljs-keyword">class</span>!</span>=attributes.class href=href)= name</span><br><span class="line"></span><br><span class="line">+link(<span class="hljs-string">'/foo'</span>, <span class="hljs-string">'foo'</span>)(<span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">"btn"</span>)</span><br><span class="line">=&gt;</span><br><span class="line">&lt;a <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">"btn"</span> href=<span class="hljs-string">"foo"</span>&gt;foo&lt;<span class="hljs-regexp">/a&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note: The values in <code>attributes</code> by default are already escaped, you should use <code>!=</code> to avoid escaping them a secondtime.</p>
</blockquote>
<h4 id="Rest-Arguments"><a href="#Rest-Arguments" class="headerlink" title="Rest Arguments"></a>Rest Arguments</h4><p>You can write mixins that takes an unknown number of arguments using the <code>rest arguments</code> syntax</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mixin list(id, ...items)</span><br><span class="line">  ul(id=id)</span><br><span class="line">    each item <span class="hljs-keyword">in</span> items</span><br><span class="line">      li= item</span><br><span class="line"></span><br><span class="line">+list(<span class="hljs-string">'my-list'</span>, <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Plain-Text"><a href="#Plain-Text" class="headerlink" title="Plain Text"></a>Plain Text</h3><p>Pug provides four ways of getting <em>plain text</em></p>
<h4 id="Inline-in-a-Tag"><a href="#Inline-in-a-Tag" class="headerlink" title="Inline in a Tag"></a>Inline in a Tag</h4><p>The easiest way to add plain text is <em>inline</em>. The first term on the line is the tag itsel. Everything after the tag and one space will be the text content of that tag.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p This is plain old &lt;em&gt;text&lt;<span class="hljs-regexp">/em&gt; content.</span></span><br></pre></td></tr></table></figure>
<h4 id="Literal-HTML"><a href="#Literal-HTML" class="headerlink" title="Literal HTML"></a>Literal HTML</h4><p>Whole lines are also treated as plain text when they begin with a left angle bracket (&lt;), which may occasionally be useful for writing literal HTML tags in places that could otherwise be inconvenient.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">body</span><br><span class="line">  p Indenting the body tag there will make no difference</span><br><span class="line">  p HTML itself isn not whitespace-sensitive</span><br><span class="line">&lt;<span class="hljs-regexp">/html&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="Piped-Text"><a href="#Piped-Text" class="headerlink" title="Piped Text"></a>Piped Text</h4><p>Another way to add plain text to templates is to prefix a line with a pipe character (<code>|</code>). This method is useful for mixing plain text with inline tag.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">p</span><br><span class="line">  | The pipe always goes at the beginning <span class="hljs-keyword">of</span> its own line,</span><br><span class="line">  | not counting indentation.</span><br><span class="line">=&gt;</span><br><span class="line">&lt;p&gt;The pipe always goes at the beginning <span class="hljs-keyword">of</span> its own line, not counting indentation.&lt;<span class="hljs-regexp">/p&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="Block-in-a-Tag"><a href="#Block-in-a-Tag" class="headerlink" title="Block in a Tag"></a>Block in a Tag</h4><p>Often you might want large blocks of text wihtin a tag. To do this, just add a <code>.</code> right after the tag name, or after the closing parenthesis, if the tag has attributes.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">script.</span><br><span class="line">  <span class="hljs-keyword">if</span> (usingPug)</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'You are awesome'</span>)</span><br><span class="line">  <span class="hljs-keyword">else</span></span><br><span class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'use pug'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Tags"><a href="#Tags" class="headerlink" title="Tags"></a>Tags</h3><p>By default, text at the start of a line (or after only white space) represents an HTML tag. Indented tags are nested.</p>
<p>To save space, Pug provides an inline syntax for nested tags.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a: <span class="hljs-function"><span class="hljs-params">img</span> =&gt;</span> &lt;a&gt;<span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>self-closing tag</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">foo/ =&gt; <span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">foo</span> /&gt;</span></span></span><br><span class="line">foo(bar='baz')/ =&gt; &lt;foo bar="baz" /&gt;</span><br></pre></td></tr></table></figure>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-28T12:30:03.000Z">2017-08-28</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    a minute read (About 166 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/28/mix-blend-mode/">Mix-Blend-Mode</a>
            
        </h1>
        <div class="content">
            <figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  mix-blend-mode: normal;</span><br><span class="line">  mix-blend-mode: multiply;</span><br><span class="line">  mix-blend-mode: screen;</span><br><span class="line">  mix-blend-mode: overlay;</span><br><span class="line">  mix-blend-mode: darken;</span><br><span class="line">  mix-blend-mode: lighten;</span><br><span class="line">  mix-blend-mode: color-dodge;</span><br><span class="line">  mix-blend-mode: color-burn;</span><br><span class="line">  mix-blend-mode: soft-light;</span><br><span class="line">  mix-blend-mode: hard-light;</span><br><span class="line">  mix-blend-mode: difference;</span><br><span class="line">  mix-blend-mode: exclusion;</span><br><span class="line">  mix-blend-mode: hue;</span><br><span class="line">  mix-blend-mode: saturation;</span><br><span class="line">  mix-blend-mode: color;</span><br><span class="line">  mix-blend-mode: luminosity;</span><br><span class="line">  mix-blend-mode: initial;</span><br><span class="line">  mix-blend-mode: inherit;</span><br><span class="line">  mix-blend-mode: unset;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="http://images2015.cnblogs.com/blog/608782/201705/608782-20170509102239519-1109457397.png" alt=""></p>
<h3 id="mix-blend-mode-screen"><a href="#mix-blend-mode-screen" class="headerlink" title="mix-blend-mode: screen"></a>mix-blend-mode: screen</h3><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// pug</span></span><br><span class="line">.container</span><br><span class="line">  - <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">3</span>; i++)</span><br><span class="line">    .box</span><br></pre></td></tr></table></figure>
<figure class="highlight scss hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-variable">$count</span>: <span class="hljs-number">3</span>;</span><br><span class="line"><span class="hljs-variable">$bgcolorlist</span>: <span class="hljs-number">#0801fb</span> <span class="hljs-number">#1ffe27</span> <span class="hljs-number">#fd1a20</span>;</span><br><span class="line"><span class="hljs-selector-tag">body</span> &#123;</span><br><span class="line">  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#291f34</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-selector-class">.container</span> &#123;</span><br><span class="line">  <span class="hljs-attribute">position</span>: absolute;</span><br><span class="line">  <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;</span><br><span class="line">  <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;</span><br><span class="line">  <span class="hljs-attribute">top</span>: <span class="hljs-number">50%</span>;</span><br><span class="line">  <span class="hljs-attribute">left</span>: <span class="hljs-number">50%</span>;</span><br><span class="line">  trasnform: translate(-<span class="hljs-number">50%</span>, -<span class="hljs-number">50%</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-selector-class">.box</span> &#123;</span><br><span class="line">  <span class="hljs-attribute">position</span>: absolute;</span><br><span class="line">  <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;</span><br><span class="line">  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;</span><br><span class="line">  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;</span><br><span class="line">  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;</span><br><span class="line">  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;</span><br><span class="line">  <span class="hljs-attribute">transform-origin</span>: <span class="hljs-number">48%</span> <span class="hljs-number">48%</span>;</span><br><span class="line">  mix-blend-mode: screen;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="hljs-keyword">for</span> <span class="hljs-variable">$i</span> from 1 through <span class="hljs-variable">$count</span> &#123;</span><br><span class="line">  <span class="hljs-selector-class">.box</span>:nth-child(#&#123;<span class="hljs-variable">$i</span>&#125;) &#123;</span><br><span class="line">    <span class="hljs-attribute">background-color</span>: nth($不过colorlist, $i);</span><br><span class="line">    <span class="hljs-attribute">animation</span>: turn <span class="hljs-number">3s</span> linear #&#123;<span class="hljs-number">1</span>-<span class="hljs-variable">$i</span>&#125;s infinite;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@keyframes turn &#123;</span><br><span class="line">  to &#123;</span><br><span class="line">    <span class="hljs-attribute">transform</span>: rotate(<span class="hljs-number">360deg</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-27T15:43:20.000Z">2017-08-27</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    2 minutes read (About 272 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/27/Start-at-Headless/">Start at Headless</a>
            
        </h1>
        <div class="content">
            <p>Run Chrome without chrome, it brings all modern web platform features provided by Chromium and the Blink rendering engine to the command line.</p>
<p>A headless browser is a great tool for automated testing and server environments where you don’t need a visible UI shell.</p>
<h3 id="Starting-Headless-CLI"><a href="#Starting-Headless-CLI" class="headerlink" title="Starting Headless (CLI)"></a>Starting Headless (CLI)</h3><p>The easiest way to get started with headless mode is to open the Chrome binary from the command line. If you’ve got Chrome 59+ installed, start Chrome with the <code>-- headless</code> flag:</p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">chrome \</span><br><span class="line">  --headless \  <span class="hljs-comment"># Runs Chrome in headless mode</span></span><br><span class="line">  --<span class="hljs-built_in">disable</span>-gpu \ <span class="hljs-comment"># Temporarily needed for now</span></span><br><span class="line">  --remote-debugging-port=9222 \</span><br><span class="line">  https://www.chromestatus.com <span class="hljs-comment"># URL to open. Defaults to about:blank</span></span><br></pre></td></tr></table></figure>
<p><code>chrome</code> should point to your installation of Chrome.</p>
<h3 id="Command-line-features"><a href="#Command-line-features" class="headerlink" title="Command line features"></a>Command line features</h3><p>In some cases, you may not need to programmatically script Headless Chrome. There are some useful command line flags to perform common tasks.</p>
<h4 id="Printing-the-DOM"><a href="#Printing-the-DOM" class="headerlink" title="Printing the DOM"></a>Printing the DOM</h4><p>The <code>--dump-dom</code> flag prints <code>document.body.innerHTML</code> to stdout:</p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chrome --headless --<span class="hljs-built_in">disable</span>-gpu --dump-dom https://www.chromestatus.com/</span><br></pre></td></tr></table></figure>
<h4 id="Create-a-PDF"><a href="#Create-a-PDF" class="headerlink" title="Create a PDF"></a>Create a PDF</h4><p>The <code>--print-to-pdf</code> flag creates a PDF of the page</p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chrome --headless --<span class="hljs-built_in">disable</span>-gpu --<span class="hljs-built_in">print</span>-to-pdf https://chromestatus.com/</span><br></pre></td></tr></table></figure>
<h4 id="Taking-screenshots"><a href="#Taking-screenshots" class="headerlink" title="Taking screenshots"></a>Taking screenshots</h4><p>To capture a screenshot of a page, use the <code>--screenshot</code> flag:</p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">chrome --headless --<span class="hljs-built_in">disable</span>-gpu --screenshot https://chromestatus.com/</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Size of a standard letterhead.</span></span><br><span class="line">chrome --headless -<span class="hljs-built_in">disable</span>-gpu --screenshot --window-size=1280,1696 https://chromestatus.com/</span><br></pre></td></tr></table></figure>
<h3 id="REPL-mode"><a href="#REPL-mode" class="headerlink" title="REPL mode"></a>REPL mode</h3><p>The <code>--repl</code> flag runs Headless in a mode where you can evaluate JS expression in the browser, right from the command line:</p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">chrome --headless --<span class="hljs-built_in">disable</span>-gpu --repl https://chromestatus.com/</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; location.href</span><br><span class="line">&#123;<span class="hljs-string">"result"</span>:&#123;<span class="hljs-string">"type"</span>:<span class="hljs-string">"string"</span>,<span class="hljs-string">"value"</span>:<span class="hljs-string">"https://www.chromestatus.com/features"</span>&#125;&#125;</span><br><span class="line">&gt;&gt;&gt; quit</span><br></pre></td></tr></table></figure>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-24T02:19:44.000Z">2017-08-24</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    3 minutes read (About 387 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/24/Node-js-child-process/">Node.js Child_process</a>
            
        </h1>
        <div class="content">
            <p>Node.js runs in single-threaded, event-driven mode, which is good for improving performance via multiple child process.</p>
<p>Each child process has three stream objects:</p>
<ul>
<li><p><code>child.stdin</code></p>
</li>
<li><p><code>child.stdout</code></p>
</li>
<li><p><code>child.stderr</code></p>
</li>
</ul>
<p>All these three stream objects may share their parent’s <code>stdio</code>, or set to use their own stream object independently.</p>
<p>Node.js offers <code>child_process</code> module to create new child process:</p>
<ul>
<li><p><code>exec</code> – <code>child_process.exec</code> use child process to execute shell command, and buffer the output for callback. This means the <code>exec</code> will buffer the whole returned value in buffer, usually you should limit the buffer in 200k, if not, the process will exit with <code>Error: maxBuffer exceeded</code>.</p>
</li>
<li><p><code>spawn</code> – <code>child_process.spawn</code> use command line to create new process. spawn will return a <strong>stream object</strong> with <code>stdout</code> and <code>stderr</code>. We can use <code>stdout</code> stream to read the data returned from child process. <code>stdout</code> has event handles like <code>data</code>, <code>end</code>. You can use <code>spawn</code> when a large data will returned from child process.</p>
</li>
<li><p><code>fork</code> – <code>child_process.fork</code> is the <code>spawn</code> in special mode(specify <code>node</code> to run the command). <code>fork(&#39;./son.js&#39;)</code> equals to <code>spawn(&#39;node&#39;, [&#39;./son.js&#39;])</code>. Different from <code>spawn</code>, <code>fork</code> will build a message pipe between main and child process.</p>
</li>
</ul>
<h3 id="exec"><a href="#exec" class="headerlink" title="exec"></a>exec</h3><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> exec = <span class="hljs-built_in">require</span>(<span class="hljs-string">'child_process'</span>).exec</span><br><span class="line">exec(<span class="hljs-string">'dir'</span>, &#123;<span class="hljs-attr">encoding</span>: <span class="hljs-string">'utf-u'</span>&#125;, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, stdout, stderr</span>) </span>&#123;</span><br><span class="line">  <span class="hljs-keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(err.stack)</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Error Code: '</span> + err.code)</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Signal Received: '</span> + err.signal)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'data: '</span> + stdout)</span><br><span class="line">&#125;).on(<span class="hljs-string">'exit'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">code</span>) </span>&#123;</span><br><span class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'child process exit with code: '</span> + code)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="spawn"><a href="#spawn" class="headerlink" title="spawn"></a>spawn</h3><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> spawn = <span class="hljs-built_in">require</span>(<span class="hljs-string">'child_process'</span>).spawn</span><br><span class="line"><span class="hljs-keyword">const</span> spawnedProcess = spawn(<span class="hljs-string">'ping'</span>, [<span class="hljs-string">'127.0.0.1'</span>], &#123; <span class="hljs-attr">encoding</span>: <span class="hljs-string">'utf-8'</span>&#125;)</span><br><span class="line"></span><br><span class="line">spawnedProcess.stdout.on(<span class="hljs-string">'data'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">chunk</span>) </span>&#123;</span><br><span class="line">  <span class="hljs-built_in">console</span>.log(chunk.toString())</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">spawnedProcess.stderr.on(<span class="hljs-string">'data'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) </span>&#123;</span><br><span class="line">  <span class="hljs-built_in">console</span>.log(data)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">spawnedProcess.on(<span class="hljs-string">'close'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">code</span>) </span>&#123;</span><br><span class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'close code: '</span> + code)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">spawnedProcess.on(<span class="hljs-string">'exit'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">code</span>) </span>&#123;</span><br><span class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'exit code: '</span> + code)</span><br><span class="line">  fs.close(fd, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="hljs-built_in">console</span>.error(err)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="fork"><a href="#fork" class="headerlink" title="fork"></a>fork</h3><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// parent.js</span></span><br><span class="line"><span class="hljs-built_in">console</span>.log(<span class="hljs-string">'parent pid: '</span> + process.pid)</span><br><span class="line"><span class="hljs-keyword">const</span> fork = <span class="hljs-built_in">require</span>(<span class="hljs-string">'child_process'</span>).fork</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">const</span> child = fork(<span class="hljs-string">'./child.js'</span>)</span><br><span class="line"><span class="hljs-built_in">console</span>.log(<span class="hljs-string">'fork return pid: '</span> + child.pid)</span><br><span class="line">child.on(<span class="hljs-string">'message'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">msg</span>) </span>&#123;</span><br><span class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'parent recieve message: '</span> + <span class="hljs-built_in">JSON</span>.stringify(msg))</span><br><span class="line">&#125;)</span><br><span class="line">child.send(&#123;</span><br><span class="line">  key: <span class="hljs-string">'parent value'</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// child.js</span></span><br><span class="line"><span class="hljs-built_in">console</span>.log(<span class="hljs-string">'child pid: '</span> + process.pid)</span><br><span class="line">process.on(<span class="hljs-string">'message'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">msg</span>) </span>&#123;</span><br><span class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'child recieve message: '</span> + msg)</span><br><span class="line">&#125;)</span><br><span class="line">process.send(&#123;</span><br><span class="line">  key: <span class="hljs-string">'child value'</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-22T06:51:20.000Z">2017-08-22</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    17 minutes read (About 2552 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/22/Node-Child-Process/">Node Child Process</a>
            
        </h1>
        <div class="content">
            <p><img src="https://cdn-images-1.medium.com/max/2000/1*I56pPhzO1VQw8SIsv8wYNA.png" alt=""></p>
<p>Single-threaded, non-blocking performance in Node works great for a single process. But eventually, one process in one CPU is not going to be enough to handle the increasing workload of your application.</p>
<p>Using multiple processes is the best way to scale a Node application. Node is designed for building distributed applications with many nodes.</p>
<h3 id="The-Child-Process-Module"><a href="#The-Child-Process-Module" class="headerlink" title="The Child Process Module"></a>The Child Process Module</h3><p>We can easily spin a child process using Node’s <code>child_process</code> module and those child processes can easily communicate with each other with a messaging system.</p>
<p>The <code>child_process</code> module enables us to access Operating System functionalities by running any system command inside child process.</p>
<p>We can control that child process input stream, and listen to its output stream. We can also control the arguments to be passed to the underlying OS command, and we can do whatever we want with that command’s output.</p>
<p>There are four different ways to create a child process in Node: <code>spawn()</code>, <code>fork()</code>, <code>exec()</code>, <code>execFile()</code>.</p>
<h3 id="Spawned-Child-Process"><a href="#Spawned-Child-Process" class="headerlink" title="Spawned Child Process"></a>Spawned Child Process</h3><p>The <code>spawn</code> function launches a command in a new process and we can use it to pass that command any arguments. For example, here’s code to spawn a new process that will execute the <code>pwd</code> command.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> &#123; spawn &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">'child_process'</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">const</span> child = spawn(<span class="hljs-string">'pwd'</span>)</span><br></pre></td></tr></table></figure>
<p>We simply destructure the <code>spawn</code> function out of the <code>child_process</code> module and execute it with the OS command as the first argument.</p>
<p>The result of executing the <code>spawn</code> function (the <code>child</code> object above) is a <code>ChildProcess</code> instance, which implements the <code>EventEmitter API</code>. This means we can register handlers for events on this child object directly. For example, we can do something when the child process exits by registering a handler for the <code>exit</code> event.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">child.on(<span class="hljs-string">'exit'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">code, signal</span>) </span>&#123;</span><br><span class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'child process exited with '</span> + <span class="hljs-string">`code <span class="hljs-subst">$&#123;code&#125;</span> and signal <span class="hljs-subst">$&#123;signal&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>The handler above gives us the exit <code>code</code> for the child process and the <code>signal</code>, if any, that was used to terminate the child process. This <code>signal</code> variable is null when the child process exits normally.</p>
<p>The other events that we can register handlers for with the <code>ChildProcess</code> instances are <code>disconnect</code>, <code>error</code>, <code>close</code>, <code>message</code>.</p>
<ul>
<li><p>The <code>disconnect</code> event is emitted when the parent process manually calls the <code>child.disconnect</code> function.</p>
</li>
<li><p>The <code>error</code> event is emitted if the process could not be spawned or killed.</p>
</li>
<li><p>The <code>close</code> event is emitted when the <code>stdio</code> streams of a child process get closed.</p>
</li>
<li><p>The <code>message</code> event is the most important one. It’s emitted when the child process uses the <code>process.send()</code> function to send messages. This is how parent/child processes can communicate with each other.</p>
</li>
</ul>
<p>Every child process also gets the three standard <code>stdio</code> streams, which we can access using <code>child.stdin</code>, <code>child.stdout</code>, <code>child.stderr</code>.</p>
<p>When those streams get closed, the child process that was using them will emit the <code>close</code> event. This <code>close</code> event is different than the <code>exit</code> event because multiple child processes might share the same <code>stdio</code> streams and so one child process exiting does not mean that the streams got closed.</p>
<p>Since all streams are event emitters, we can listen to different events on those <code>stdio</code> stream that are attached to every child process. Unlike in a normal process though, in a child process, the <code>stdout</code>/<code>stderr</code> streams are readable streams while the <code>stdin</code> stream is a writable one. This is basically the inverse of those types as found in a main process. The events we can use for those streams are the standard ones. Most importantly, on the readable streams, we can listen to the <code>data</code> event, which will have the output of the command or any errorencoutered while executing the command:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">child.stdout.on(<span class="hljs-string">'data'</span>, (data) =&gt; &#123;</span><br><span class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`child stdout:\n<span class="hljs-subst">$&#123;data&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">child.stderr.on(<span class="hljs-string">'data'</span>, (data) =&gt; &#123;</span><br><span class="line">  <span class="hljs-built_in">console</span>.error(<span class="hljs-string">`child \n<span class="hljs-subst">$&#123;data&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>The two handlers above will log both cases to the main process <code>stdout</code> and <code>stderr</code>. When we execute the <code>spawn</code> function above, the output of the <code>pwd</code> command gets printed and the child process exits with code <code>0</code>, which means no error occured.</p>
<p>We can pass arguments to the command that’s executed by the <code>spawn</code> function using the second argument of the <code>spawn</code> function, which is an array of all the arguments to be passed to the command.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> child = spawn(<span class="hljs-string">'find'</span>, [<span class="hljs-string">'.'</span>, <span class="hljs-string">'-type'</span>, <span class="hljs-string">'f'</span>])</span><br></pre></td></tr></table></figure>
<p>If an error occurs during the execution of the command, for example, if we give find an invalid destination above, the <code>child.stderr</code> <code>data</code> event handler will be triggered and the <code>exit</code> event handler will report an exit code of <code>1</code>, which signifies that an error has occured.</p>
<p>A child process <code>stdin</code> is a writable stream. We can use it to send a command some input. Just like any writable stream, the easiest way to consume it is using the <code>pipe</code> function. We simply pipe a readable stream into a writable stream. SInce the main process <code>stdin</code> is a readable stream, we can pipe that into a child process <code>stdin</code> stream.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> &#123; spawn &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">'child_process'</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">const</span> child = spawn(<span class="hljs-string">'wc'</span>)</span><br><span class="line"></span><br><span class="line">process.stdin.pipe(child.stdin)</span><br><span class="line"></span><br><span class="line">child.stdout.on(<span class="hljs-string">'data'</span>, (data) =&gt; &#123;</span><br><span class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`child stdout:\n<span class="hljs-subst">$&#123;data&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>In the example above, the child process invokes the <code>wc</code> command, which count lines, words, and characters in Linux. When we pipe the main process <code>stdin</code>(which is a readable stream) into the child process <code>stdin</code>(which is a writable stream). The result of this combination is that we get a standard input mode where we can type somthing and when we hit <code>Ctrl + D</code>, what we typed will be used as the input of the <code>wc</code> command.</p>
<p>We can also pipe the standard input/output of multiple processes on each other, just like we can do with Linux commands. For example, we can pipe the <code>stdout</code> of the <code>find</code> command to the <code>stdin</code> of the <code>wc</code> command to count all the files in the current directory:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> &#123; spawn &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">'child_process'</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">const</span> find = spawn(<span class="hljs-string">'find'</span>, [<span class="hljs-string">'.'</span>, <span class="hljs-string">'-type'</span>, <span class="hljs-string">'f'</span>])</span><br><span class="line"><span class="hljs-keyword">const</span> wc = spawn(<span class="hljs-string">'wc'</span>, [<span class="hljs-string">'-l'</span>])</span><br><span class="line"></span><br><span class="line">find.stdout.pipe(wc.stdin)</span><br><span class="line"></span><br><span class="line">wc.stdout.on(<span class="hljs-string">'data'</span>, (data) =&gt; &#123;</span><br><span class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Number of files <span class="hljs-subst">$&#123;data&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Add <code>-l</code> to the <code>wc</code> command to make it count only the lines.</p>
<h3 id="Shell-Syntax-and-the-exec-Function"><a href="#Shell-Syntax-and-the-exec-Function" class="headerlink" title="Shell Syntax and the exec Function"></a>Shell Syntax and the exec Function</h3><p>By default, the <code>spawn</code> function does not create a <em>shell</em> to execute the command we pass into it. This makes it slightly more efficient than the <code>exec</code> function, which does create a shell. The <code>exec</code> function has one other major difference. It <em>buffers</em> the command’s generated output and passes the whole output value to a callback function(instead of using streams, which is what <code>spawn</code> does).</p>
<p>Here the is previous <code>find | wc</code> example implemented with an <code>exec</code> function.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> &#123; exec &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">'child_process'</span>)</span><br><span class="line"></span><br><span class="line">exec(<span class="hljs-string">'find . -type  f | wc -l'</span>, (err, stdout, stderr) =&gt; &#123;</span><br><span class="line">  <span class="hljs-keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="hljs-built_in">console</span>.error(<span class="hljs-string">`exec error: <span class="hljs-subst">$&#123;err&#125;</span>`</span>)</span><br><span class="line">    <span class="hljs-keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Number of files <span class="hljs-subst">$&#123;stdout&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Since the <code>exec</code> function uses a shell to execute the command, we can use the <code>shell syntax</code> directly here making use of the <code>shell pipe</code> feature.</p>
<p>Note that using the shell syntax comes at a <code>security risk</code> if you’re executing any kind of dynamic input provided externally. A user can simply do a command injection attrack using shell syntax characters like ; and $(For example, <code>commnd + &#39;; rm -rf ~&#39;</code>)</p>
<p>The <code>exec</code> function buffers the output and passes it to the callback function(the second argument to <code>exec</code>) as the <code>stdout</code> argument there. This <code>stdout</code> argument is the command’s output that we want to print out.</p>
<p>The <code>exec</code> function is a good choice if you need to use the shell syntax and if the size of the data expected from te command is small(Remember <code>exec</code> will buffer the whole data in memory before returning it).</p>
<p>The <code>spawn</code> function is a much better choice when the size of the data expected from the command is large, because that data will be streamed with the standard IO objects.</p>
<p>We can make the spawned child process inherit the standard IO object of its parents if we want to, but also, more importantly, we can ke the <code>spawn</code> function use the shell syntax as well. Here’s the smae <code>find | wc</code> command implemented with the <code>spawn</code>.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> child = spawn(<span class="hljs-string">'find . -type f'</span>, &#123;</span><br><span class="line">  stdio: <span class="hljs-string">'inherit'</span>,</span><br><span class="line">  shell: <span class="hljs-literal">true</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Because of the <code>stdio: &#39;inherit&#39;</code> option above, when we execute the code, the child process inherits the main process <code>stdin</code>, <code>stdout</code> and <code>stderr</code>. This causes the child process data events handlers to be triggered on the main <code>process.stdout</code> stream, making the script output the result right away.</p>
<p>Because of the <code>shell: true</code> option above, we were able to use the shell syntax in the passed command, just like we did with <code>exec</code>. But with this code, we still get the advantage of the streaming of data that the <code>spawn</code> function gives us. <em>THis is really the best of both worlds</em>.</p>
<p>There are a few other good options we can use in the last argument to the <code>child_process</code> function besides <code>shell</code> and <code>stdio</code>. We can, for example, use the <code>cwd</code> option to change the working directory of the script.</p>
<p>Another option we can use is the <code>env</code> option to specify the environment variables that will be visible to the new child process. The default for this option is <code>process.env</code> which gives any command access to the current process environment. If we want ot override that behavior, we can simple pass an empty object as the <code>env</code> option or new value there to be considered as the only environment variables:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> child = spawn(<span class="hljs-string">'echo $ANSWER'</span>, &#123;</span><br><span class="line">  stdio: <span class="hljs-string">'inherit'</span>,</span><br><span class="line">  shell: <span class="hljs-literal">true</span>,</span><br><span class="line">  env: &#123;</span><br><span class="line">    ANSWER: <span class="hljs-number">12</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>The echo command above does not have access to the parent process’s environment variables. It can’t, for example, access <code>$HOME</code>, but it can accccess <code>$ANSWER</code> because it was passes as a custom environement variable through the <code>env</code> option.</p>
<p>One last important child process option to explain here is the <code>detached</code> option, which makes the child process run independently of its parent process.</p>
<p>Assuming we have a file <code>timer.js</code> that keeps the event loop busy:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="hljs-comment">// keep the event loop busy</span></span><br><span class="line">&#125;, <span class="hljs-number">20000</span>)</span><br></pre></td></tr></table></figure>
<p>We can execute it in the background using the <code>detached</code> option:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> &#123; spawn &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">'child_process'</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">const</span> child = spawn(<span class="hljs-string">'node'</span>, [<span class="hljs-string">'timer.js'</span>], &#123;</span><br><span class="line">  detached: <span class="hljs-literal">true</span>,</span><br><span class="line">  stdio: <span class="hljs-string">'ignore'</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">child.unref()</span><br></pre></td></tr></table></figure>
<p>The exact behavior of detached child process depends on the OS. On windows, the detached child process will have its own console window while on Linux the detached child process will be made the leader of a new process groups and session.</p>
<p>It the <code>unref</code> function is called on the detached process, the parent process can exit independently of the child. This can be useful if the child is executing a long-running process, but to keep it running in the background the child’s <code>stdio</code> configurations also have to be independent of the parent.</p>
<p>The example above will run a node script(timer.js) in the background by detaching and also ignoring its parent <code>stdio</code> file descriptors so that the parent can terminate while the child keeps running in the background.</p>
<h3 id="The-execFile-function"><a href="#The-execFile-function" class="headerlink" title="The execFile function"></a>The execFile function</h3><p>If you need to execute a file without using a shell, the <code>execFile</code> function is what you need. It behaves exactly like the <code>exec</code> function, but does not use a shell, which makes it a bit more efficient. On windows, some files cannot be executed on their own, like <code>.bat</code>, <code>.cmd</code> files. Those files cannot be executed with <code>execFile</code> and either <code>exec</code> or <code>spawn</code> with shell set to true is required to execute them.</p>
<h3 id="The-Sync-Function"><a href="#The-Sync-Function" class="headerlink" title="The *Sync Function"></a>The *Sync Function</h3><p>The functions <code>spawn</code>, <code>exec</code>, <code>execFile</code> from the <code>child_process</code> module also have synchronous blocking versions that will wait until child process exits.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> &#123;</span><br><span class="line">  spawnSync,</span><br><span class="line">  execSync,</span><br><span class="line">  execFileSync,</span><br><span class="line">&#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">'child_process'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="The-fork-function"><a href="#The-fork-function" class="headerlink" title="The fork() function"></a>The fork() function</h3><p>THe <code>fork</code> function is a variation of the <code>spawn</code> function for spawning node processes. The biggest difference between <code>spawn</code> and <code>fork</code> is that a communication channel is established to the child process when using <code>fork</code>, so we can use the <code>send</code> function on the forked along with the global <code>process</code> object itself to exchange messsages between the parent and forked processes. We do this through the <code>EventEmitter</code> module interface.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// parent.js</span></span><br><span class="line"><span class="hljs-keyword">const</span> &#123; fork &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">'child_process'</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">const</span> forked = fork(<span class="hljs-string">'child.js'</span>)</span><br><span class="line"></span><br><span class="line">forked.on(<span class="hljs-string">'message'</span>, (msg) =&gt; &#123;</span><br><span class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Message from child'</span>, msg)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">forked.send(&#123;</span><br><span class="line">  hello: <span class="hljs-string">'world'</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// child.js</span></span><br><span class="line"></span><br><span class="line">process.on(<span class="hljs-string">'message'</span>, (msg) =&gt; &#123;</span><br><span class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Message from parent:'</span>, msg)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="hljs-keyword">let</span> counter = <span class="hljs-number">0</span></span><br><span class="line"></span><br><span class="line">setInterval(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">  process.send(&#123;</span><br><span class="line">    counter: counter++</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;, <span class="hljs-number">1000</span>)</span><br></pre></td></tr></table></figure>
<p>In the parent.js we fork <code>child.js</code>(<strong>which will execute the file with the <code>node</code> command</strong>) and then we listen for the <code>message</code> event. The <code>message</code> event will be emitted whenever the child use <code>process.send</code>.</p>
<p>The pass down messages from the parent to the child, we can execute the <code>send</code> function one the forked object it self, and then, in the child script we can listen to the <code>message</code> event on the global <code>process</code>.</p>
<p>When executing the <code>parent.js</code> file, it’ll first send down the <code>{hello: &#39;world&#39;}</code> object to be printed by the forked child process and then the forked child process will send an incremental counter value every second to be printed by the parent process.</p>
<p>Let’s do more practical example about the <code>fork</code> function.</p>
<p>Let’s say we have an http server that handles two endpoints. One of these endpoints(<code>/compute</code> below) is computationally expensive and will take a few seconds to complete. WE can use a long for loop to simulate that:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">const</span> longComputation = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="hljs-keyword">let</span> sum = <span class="hljs-number">0</span></span><br><span class="line">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1e9</span>; i++) &#123;</span><br><span class="line">    sum += i</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="hljs-keyword">return</span> sum</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">const</span> server = http.createServer()</span><br><span class="line"></span><br><span class="line">server.on(<span class="hljs-string">'request'</span>, (req, res) =&gt; &#123;</span><br><span class="line">  <span class="hljs-keyword">if</span> (req.url === <span class="hljs-string">'/compute'</span>) &#123;</span><br><span class="line">    <span class="hljs-keyword">const</span> sum = longComputation()</span><br><span class="line">    <span class="hljs-keyword">return</span> res.end(<span class="hljs-string">`Sum is <span class="hljs-subst">$&#123;sum&#125;</span>`</span>)</span><br><span class="line">  &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">    res.end(<span class="hljs-string">'OK'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="hljs-number">3000</span>)</span><br></pre></td></tr></table></figure>
<p>The program has a big problem: when the <code>/compute</code> endpoint is requested, the server will not be able to handle any other requests because the event loop is busy with the long for loop operation.</p>
<p>There are a few ways which we can solve this problem depending on the nature of the long operation but one solution that works for all operation is to just move the computational operation into another process using <code>fork</code>.</p>
<p>We first move the whole <code>longComputation</code> function into its own file and make it invoke that function when instructed via a message from the main process:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// compute.js</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">const</span> longComputatioin  = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="hljs-keyword">let</span> sum = <span class="hljs-number">0</span></span><br><span class="line">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1e9</span>; i++) &#123;</span><br><span class="line">    sum += i;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="hljs-keyword">return</span> sum</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">process.on(<span class="hljs-string">'message'</span>, (msg) =&gt; &#123;</span><br><span class="line">  <span class="hljs-keyword">const</span> sum = longComputatioin()</span><br><span class="line">  process.send(sum)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// server.js</span></span><br><span class="line"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>)</span><br><span class="line"><span class="hljs-keyword">const</span> &#123; fork &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">'child_process'</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">const</span> server = http.createServer()</span><br><span class="line"></span><br><span class="line">server.on(<span class="hljs-string">'request'</span>, (req, res) =&gt; &#123;</span><br><span class="line">  <span class="hljs-keyword">if</span> (req.url === <span class="hljs-string">'/compute'</span>) &#123;</span><br><span class="line">    <span class="hljs-keyword">const</span> compute = fork(<span class="hljs-string">'compute.js'</span>)</span><br><span class="line">    compute.send(<span class="hljs-string">'start'</span>)</span><br><span class="line">    compute.on(<span class="hljs-string">'message'</span>, sum =&gt; &#123;</span><br><span class="line">      res.end(<span class="hljs-string">`Sum is <span class="hljs-subst">$&#123;sum&#125;</span>`</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">    res.end(<span class="hljs-string">'OK'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="hljs-number">3000</span>)</span><br></pre></td></tr></table></figure>
<p>When a request to <code>/compute</code> happens now with the above code, we simply send a message to the forked process to start executing the long operation. The main process’s event loop will not be blocked.</p>
<p>Once the forked process is done with the long operation, it can send its result back to the parent process using <code>process.send</code>.</p>
<p>Node’s <code>cluster</code> module is based on this idea of child process forking and load balancing the requests among the many forks.</p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-22T03:42:52.000Z">2017-08-22</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    20 minutes read (About 3006 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/22/Scaling-Node-js-App/">Scaling Node.js App</a>
            
        </h1>
        <div class="content">
            <h3 id="Strategies-of-Scalability"><a href="#Strategies-of-Scalability" class="headerlink" title="Strategies of Scalability"></a>Strategies of Scalability</h3><p>The workload is the most popular reason we scale our applications, but it’s not the only reason. We also scale our applications to increase their availability and tolerance to failure.</p>
<h4 id="Cloning"><a href="#Cloning" class="headerlink" title="Cloning"></a>Cloning</h4><p>The easiest thing to do to scale a big application is to clone it mulitple times and have each cloned instance handle part of the workload(with a load balancer). This does not cost a lot in term of development time and it’s highly effective. This strategy is the minimum you should do and Node.js has the built-in module, <code>cluster</code>, to make is easier for you to implement the cloning strategy on a single server.</p>
<h4 id="Decomposing"><a href="#Decomposing" class="headerlink" title="Decomposing"></a>Decomposing</h4><p>We can also scale an application by decomposiing it based on functionalities and services. This means having mulitple, different applications with different code bases and sometimes with their own dedicated databases and User Interfaces.</p>
<p>This strategy is commonly associated with the term <strong>Microservice</strong>, where micro indicates that those services should be small as possible, but in reality, the size of the service is not what’s important but rather the enforement of loose coupling and high cohesion between services.</p>
<h4 id="Splitting"><a href="#Splitting" class="headerlink" title="Splitting"></a>Splitting</h4><p>We can also split the application into multiple instances where each instance is responsible for only a part of the application’s data. This strategy is often named <strong>horizontal partitioning</strong>, or <strong>sharding</strong>, in database. Data partitioning requires a lookup step before each operation to determine which instance of the application to use.</p>
<p>Successfully scaling a big application should eventually implement all three strategies.</p>
<h3 id="The-Cluster-Module"><a href="#The-Cluster-Module" class="headerlink" title="The Cluster Module"></a>The Cluster Module</h3><p>The cluster module can be used to enable load balancing over an environement’s multiple CPU cores. It’s based on the child process module <code>fork</code> method and it basically allows us to fork the main application process as many times as we have CPU cores. It will then take over and load balance all requests to the main process across all forked processs.</p>
<p>The cluster module is Node’s helper for us to implement the cloning scalability strategy, but only on one machine. When you have a big machine with a lot resources or when it’s easier and cheaper to add more resources to one machine ratherthan adding new machine, the cluster module is a greate option for a really quick implementation of the cloning strategy.</p>
<p>Even small machines usually have multiple cores and even if you’re not worried about the load on your Node server, you should enable the cluster module anyway to increase your server availability and fault-tolerance.</p>
<p>It’s a simple step and when using a process manager like PM2, for example, it becomes as simple as just providing an argument to the launch command.</p>
<p>The structure of what the cluster module does is simple. We create a <em>master process</em> and that master process <em>forks</em> a number of <em>worker processes</em> and manage them. Each worker process represents an instance of the application that we want to scale. All incoming requests are handled by the master process, which is the one that decides which worker process should handle the incoming request.</p>
<p><img src="https://cdn-images-1.medium.com/max/1000/1*C7ICI8d7aAna_zTZvZ64MA.png" alt=""></p>
<p>The master process’s job is easy because it actually just uses a <em>round-robin</em> algorithm to pick a worker process. This is enabled by default on all platform except windows and it can be globally modified to let the load-balancing be handled by the operation system self.</p>
<p>The round-robin algorithm distributes the load evenly across all available processes on a rotational basis. The first request is forwarded to the first worker process, the second to the next worker process in the list, and so on. When the end of the list is reached, the algorithm starts again from the beginning.</p>
<h3 id="Load-Balancing-an-HTTP-Server"><a href="#Load-Balancing-an-HTTP-Server" class="headerlink" title="Load-Balancing an HTTP Server"></a>Load-Balancing an HTTP Server</h3><p>Let’s clone and load balance a simple HTTP server using the cluster module.</p>
<p>Here’s the simple Node’s hello-world example server slightly modified to simulate some CPU work before responding:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// server.js</span></span><br><span class="line"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>)</span><br><span class="line"><span class="hljs-keyword">const</span> pid = process.pid</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1e7</span>; i++) &#123;</span><br><span class="line">    <span class="hljs-comment">// simulate CPU work</span></span><br><span class="line">  &#125;</span><br><span class="line">  res.end(<span class="hljs-string">`Handled by process <span class="hljs-subst">$&#123;pid&#125;</span>`</span>)</span><br><span class="line">&#125;).listen(<span class="hljs-number">8080</span>, () =&gt; &#123;</span><br><span class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Started process <span class="hljs-subst">$&#123;pid&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Before we create a cluster to clone this server into multiple workers, let’s do a simple benchmark of how many requests this server can handle per second. We can use <strong>Apache benchmarking tool</strong> for that.</p>
<p>After running the simple <code>server.js</code> code above, run this <code>ab</code> command:</p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ab -c200 http://localhost:8080/</span><br></pre></td></tr></table></figure>
<p>This command will test-load the server with 200 concurrent connections for 10 seconds.</p>
<p><img src="https://cdn-images-1.medium.com/max/1000/1*w8VmzV81atlTzHn7pDXu1g.png" alt=""></p>
<p>The single node server was able to handle about 51 requests per seconds.</p>
<p>Now that we have a reference benchmark, we can scale the application with the cloning strategy using the cluster module.</p>
<p>On the same level as the <code>server.js</code> file above, we can create a new file(<code>cluster.js</code>) <strong>for the master process</strong> with this content:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// cluster.js</span></span><br><span class="line"><span class="hljs-keyword">const</span> cluster = <span class="hljs-built_in">require</span>(<span class="hljs-string">'cluster'</span>)</span><br><span class="line"><span class="hljs-keyword">const</span> os = <span class="hljs-built_in">require</span>(<span class="hljs-string">'os'</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">if</span> (cluster.isMaster) &#123;</span><br><span class="line">  <span class="hljs-keyword">const</span> cpu = os.cpus().length</span><br><span class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Forking for <span class="hljs-subst">$&#123;cpu&#125;</span> CPUS`</span>)</span><br><span class="line">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; cpus; i++) &#123;</span><br><span class="line">    cluster.fork()</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">  <span class="hljs-built_in">require</span>(./server)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>In <code>cluster.js</code>, we first required both the <code>cluster</code> module and the <code>os</code> module, we use the <code>os</code> module to read the number of CPUS cores we can work with using <code>os.cpus()</code>.</p>
<p>The <code>cluster</code> module gives us the handy Boolean flag <code>isMaster</code> to determine if this <code>cluster.js</code> file is being loaded as a master process or not. The first time we execute this file, we will be executing the master process and that <code>isMaster</code> flag will be set to true. In this case, we can instruct the master process to fork our server as many times as we have CPU cores.</p>
<p>Now we just read the number of CPUs we have using the <code>os</code> module, then with a for loop over that number, we call the <code>cluster.fork</code> method. The for loop will simple create as many workers as the number of CPUs in the system to take advantage of all the available processing power.</p>
<p>When the <code>cluster.fork</code> line is executed from the master process, the current file, <code>cluster.js</code>, is run again, but this time in <em>worker mode</em> with the <code>isMaster</code> flag set to false.</p>
<p><em>There is actually another flag set to true in this case if you need to use it, which is the <code>isWorker</code></em> flag.</p>
<p>When the application runs as a worker, it can start doing the actual work. This is where we need to define our server logic, which, for this example, we can do by requiring the <code>server.js</code> file that we already have.</p>
<p>That’s basically it. That’s how easy it is to take advantage of all the processing power in a machine. To test the cluster, run the <code>cluster.js</code> file.</p>
<p><img src="https://cdn-images-1.medium.com/max/800/1*c0S-W4GYgCGB_maJ94ZLPw.png" alt=""></p>
<p>It’s important to understand that these are completely different Node.js processes. Each worker process here will have its own event loop and memory space.</p>
<p>When we now hit the web server multiple times, the requests will start to get handled by different worker processes with different process ids. The worker will not be exactly rotated in sequence because the cluster module performs some optimizations when picking the next worker, but the load will be somehow distributed among the different worker process.</p>
<p>We can use the same <code>ab</code> command above to load-test this cluster of processes:</p>
<p><img src="https://cdn-images-1.medium.com/max/1000/1*5_EogHG-Egf2uAMOj9PmCA.png" alt=""></p>
<p>Now the cluster can handle 181 requests per seconds.</p>
<h3 id="Broadcasting-Messages-to-All-Workers"><a href="#Broadcasting-Messages-to-All-Workers" class="headerlink" title="Broadcasting Messages to All Workers"></a>Broadcasting Messages to All Workers</h3><p>Communicating between the master process and the workers is simple because under the hood the cluster module is just using the <code>child_process.fork</code> API, which means we also have communication channels available between the master process and each workers.</p>
<p>Based on the <code>server.js</code>/<code>cluster.js</code> example above, we can access the list of worker objects using <code>cluster.workers</code>, which is an object that holds a reference to all workers and can be used to read information about these workers. Since we have communication channels between master process and all workers, to broadcast a message to all them we just need a simple loop over all the workers:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-built_in">Object</span>.values(cluster.workers).forEach(<span class="hljs-function"><span class="hljs-params">worker</span> =&gt;</span> &#123;</span><br><span class="line">  worker.send(<span class="hljs-string">`Hello Worker <span class="hljs-subst">$&#123;worker.pid&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>We simple used <code>Object.values</code> to get an array of all workers from the <code>cluster.workers</code> object. Then for each worker we can use the <code>send</code> function to send over any value that we want.</p>
<p>In a worker file, <code>server.js</code> in our example, to read a message received from this master process, we can register a handler for the <code>message</code> event on the global <code>process</code> object:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">process.on(<span class="hljs-string">'message'</span>, (msg) =&gt; &#123;</span><br><span class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Message from master: <span class="hljs-subst">$&#123;msg&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn-images-1.medium.com/max/1000/1*6XfoWiNKTCiDjqar7L5_xw.png" alt=""></p>
<p>Every worker received a message from the master process. <em>Note how the workers did not start in order</em>.</p>
<p>Let’s make this communication example a little bit more practical. Let’s say we want our server to reply with the number of users we have created in our database. We will create a mock function that returns the number of users we have in the database and just have it square its value every time it’s called:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// **** Mock DB Call</span></span><br><span class="line"><span class="hljs-keyword">const</span> numberOfUsersInDB = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;</span><br><span class="line">  <span class="hljs-keyword">this</span>.count = <span class="hljs-keyword">this</span>.count || <span class="hljs-number">5</span></span><br><span class="line">  <span class="hljs-keyword">this</span>.count = <span class="hljs-keyword">this</span>.count * <span class="hljs-keyword">this</span>.count</span><br><span class="line">  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.count</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Every time <code>numberOfUsersInDB</code> is called, we’ll assume that a database connection has been made.</p>
<p>In the master process mode, we can use the same loop to broadcast the users count value to all workers:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// Right After the fork loop within the isMaster=true block</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">const</span> updateWorkers = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="hljs-keyword">const</span> usersCount = numberOfUsersInDB()</span><br><span class="line">  <span class="hljs-built_in">Object</span>.values(cluster.workers).forEach(<span class="hljs-function"><span class="hljs-params">worker</span> =&gt;</span> &#123;</span><br><span class="line">    worker.send(&#123;</span><br><span class="line">      usersCount,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">updateWorkers()</span><br><span class="line">setInterval(updateWorkers, <span class="hljs-number">10000</span>)</span><br></pre></td></tr></table></figure>
<p>Here we’re invoking <code>updateWorkers</code> for the first time and then invoking it every 10 seconds using a <code>setInterval</code>. This way, every 10 seconds, all workers will receive the new user count value over the process communication channel and only one database connection will be made.</p>
<p>In the server code, we can use the <code>userCount</code> value using the same <code>message</code> event handler. We can simply cache that value with a module global variable and use it anywhere we want.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>)</span><br><span class="line"><span class="hljs-keyword">const</span> pid = process.pid</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">let</span> usersCount</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1e7</span>; i++);</span><br><span class="line">  res.write(<span class="hljs-string">`Handled by process: <span class="hljs-subst">$&#123;pid&#125;</span>`</span>)</span><br><span class="line">  res.end(<span class="hljs-string">`Users: &#123;usersCount&#125;`</span>)</span><br><span class="line">&#125;).listen(<span class="hljs-number">8080</span>, () =&gt; &#123;</span><br><span class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Start process <span class="hljs-subst">$&#123;pid&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">process.on(<span class="hljs-string">'message'</span>, msg =&gt; &#123;</span><br><span class="line">  usersCount = msg.usersCount</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>The above code makes the worker web server respond with the cached <code>usersCount</code> value. If you test the cluster code now, during the first 10 seconds you’ll get ‘25’ as the users count from all workers(and only one DB request would be made). Then after another 10 seconds, all workers would start reporting the new user count: 625(and only one DB request would be made).</p>
<p>This is all possible thanks to the communication channels between the master process and all workers.</p>
<h3 id="Increasing-Server-Availability"><a href="#Increasing-Server-Availability" class="headerlink" title="Increasing Server Availability"></a>Increasing Server Availability</h3><p>One of the problems in running a single instance of a Node application is that when that instance crashes, it has to be restarted. This means some downtime between these two actions, even if the process was automated as it should.</p>
<p>This also applies to the case when the server has to be restarted to deploy new code. With one instance, there will be downtime which affects the availability of the system.</p>
<p>When we have multiple instances, the availability of the system can be easily increased with just a few extra lines of code.</p>
<p>To simulate a random crash in the server process, we can simply do a <code>process.exit</code> call inside a timer that fires after a random amount of time:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// In server.js</span></span><br><span class="line">setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">  process.exit(<span class="hljs-number">1</span>) <span class="hljs-comment">// death by random timeout</span></span><br><span class="line">&#125;, <span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">10000</span>)</span><br></pre></td></tr></table></figure>
<p>When a worker process exits like this, the master process will be notified using the <code>exit</code> event on the <code>cluster</code> model object. We can register a handler for that event and just fork a new worker process when any worker process exits.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// Right after the fork loop within the isMaster=true block</span></span><br><span class="line"></span><br><span class="line">cluster.on(<span class="hljs-string">'exit'</span>, (worker, code, signal) =&gt; &#123;</span><br><span class="line">  <span class="hljs-keyword">if</span> (code !== <span class="hljs-number">0</span> &amp;&amp; !worker.exitedAfterDisconnect) &#123;</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Worker <span class="hljs-subst">$&#123;worker.id&#125;</span> crashed. Starting a new worker...`</span>)</span><br><span class="line">    cluster.fork()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>It’s good to add the if condition above to make sure the worker process actually crashed and was not manually disconnected or killed by the master process itself.</p>
<p>If the main process is going to kill the worker, it can use the <code>disconnect</code> methods on the worker and in that case, the <code>exitedAfterDisconnect</code> flag will be set to true. The if statement above will guard to not fork a new worker for that case.</p>
<p>If we run the cluster with the handler above(and the random crash in server.js), after a random number of seconds, workers will start to crash and the master process will immediately fork new workers to increase the availability of the system.</p>
<p>You can actually measure the availability using the same <code>ab</code> command and see how many requests the server will not be able to handle overall.</p>
<p><img src="https://cdn-images-1.medium.com/max/1000/1*B72o6QhsyiNnEQU5Wx20RQ.png" alt=""></p>
<h3 id="Zero-downtime-Restarts"><a href="#Zero-downtime-Restarts" class="headerlink" title="Zero-downtime Restarts"></a>Zero-downtime Restarts</h3><p>We have multiple instances running, so instead of restarting them together, we can simply restart them one at a time to allow other workers to continue to serve requests while one worker is being restarted.</p>
<p>Implementing this with the cluster module is easy. Since we don’t want to restart the master process once it’s up, we need a way to send this master process a command to instruct it to start restarting its workers. This is easy on Linux system because we can simply listen to a process signal like <code>SIGUSR2</code>, which we can trigger by using the <code>kill</code> command on the process id and passing that signal:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// In Node</span></span><br><span class="line">process.on(<span class="hljs-string">'SIGUSR2'</span>, () =&gt; &#123; ... &#125;)</span><br><span class="line"><span class="hljs-comment">// To trigger that</span></span><br><span class="line">$ kill -SIGUSR2 PID</span><br></pre></td></tr></table></figure>
<p>This way, the master process will not be killed and we have a way to instruct it to start doing something.</p>
<p><strong><code>SIGUSR2</code> is a proper signal to use here because this will be a user command. If you’re wondering why not <code>SIGUSR1</code>, it’s because Node uses that for its debugger and you want to avoid any conflicts.</strong>.</p>
<p>When the master process receives the <code>SIGUSR2</code> signal, that means it’s time for it to restart its workers, but we want to do that one worker at a time. This simply means the master process should only restart the next worker when it’s done restarting the current one.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">restartWorker</span> = (<span class="hljs-params">workerIndex</span>) =&gt; </span>&#123;</span><br><span class="line">  <span class="hljs-keyword">const</span> worker = workers[workerIndex]</span><br><span class="line">  <span class="hljs-keyword">if</span> (!worker) <span class="hljs-keyword">return</span></span><br><span class="line"></span><br><span class="line">  worker.on(<span class="hljs-string">'exit'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (!worker.exitedAfterDisconnect) <span class="hljs-keyword">return</span></span><br><span class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Exited process <span class="hljs-subst">$&#123;worker.process.pid&#125;</span>`</span>)</span><br><span class="line"></span><br><span class="line">    cluster.fork().on(<span class="hljs-string">'listening'</span>, () =&gt; &#123;</span><br><span class="line">      restartWorker(workerIndex + <span class="hljs-number">1</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  worker.disconnect()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">restartWorker(<span class="hljs-number">0</span>)</span><br></pre></td></tr></table></figure>
<p>Inside the <code>restartWorker</code> function, we got a reference to the worker to be restarted and since we will be calling this function recursively to form a sequence, we need a stop condition. When we no longer have a worker to restart, we can just return.</p>
<p>We then basically want to disconnect this worker (using <code>worker.disconnect</code>), but before restarting the next worker, we need to fork a new worker to replace this current one that we’re disconnecting.</p>
<p>We can use the <code>exit</code> event on the worker itself to fork a new worker when the current one exists, but we have to make sure that the exit action was actually triggered after a normal disconnect call. We can use the <code>exitedAfterDisconnect</code> flag. If this flag is not true, the exit was caused by something else other than our disconnect call and in that case, we should just return and do nothing. But if the flag is set to true, we can go ahead and fork a new worker to replace the one that we’re disconnecting.</p>
<p>When this new forked worker is ready, we can restart the next one.</p>
<p>However, remember that the fork process is not synchronous, so we can’t just restart the next worker after the fork call. Instead, we can monitor the <code>listening</code> event on the newly forked worker, which tells us that this worker is connected and ready. When we get this event, we can safely restart the next worker in sequence.</p>
<p>That’s all we need for a zero-downtime restart.</p>
<p>Process monitors like PM2, make all the tasks we went through so far extremely easy and give a log more features to monitor the health of a Node’s application.</p>
<h3 id="Shared-State-and-Sticky-Load-Balancing"><a href="#Shared-State-and-Sticky-Load-Balancing" class="headerlink" title="Shared State and Sticky Load Balancing"></a>Shared State and Sticky Load Balancing</h3><p>When we load balance a Node application, we lost some features that are only suitable for a single process. This problem is somehow similar to what’s known in other languages as thread safety, which is about sharing data between threads. In our case, it’s sharing data between worker processes.</p>
<p>For example, with a cluster setup, we can no longer cache things in memory because every worker process will have its own memory space, If we cache something in one worker’s memory, other workers will not have access to it.</p>
<p>If we need to cache things with a cluster setup, we have to use a separate entity and read/write to that entity’s API from all workers. This entity can be a database server or if you want to use in-memory cache you can use a server like Redis or create a dedicated Node process with a read/write API for all other workers to communicate with.</p>
<p><img src="https://cdn-images-1.medium.com/max/1000/1*dIR_CAkmtPFgtaGTOKBFkA.png" alt=""></p>
<p>Don’t look at this as a disadvantage, because using a separate entity for your application caching is part of <em>decomposing</em> your app for scalability. You should probably be doing that even if you’re running on a single core machine.</p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-21T16:11:11.000Z">2017-08-22</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    a minute read (About 139 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/22/Mock-Data-for-Node-js/">Mock Data for Node.js</a>
            
        </h1>
        <div class="content">
            <h3 id="Faker-js"><a href="#Faker-js" class="headerlink" title="Faker.js"></a>Faker.js</h3><p>It’s a wonderful node module to create fake/mock data.</p>
<p>Faker.js has its own API, and it’s huge.</p>
<p>It has a vast API for almost every use case with an excellent <a href="https://github.com/marak/Faker.js/" target="_blank" rel="noopener">documentation</a></p>
<p>Let’s consider a test case where I want some a <em>user</em> to have following amount of fields:</p>
<ul>
<li><p>name</p>
</li>
<li><p>email</p>
</li>
<li><p>website</p>
</li>
<li><p>address</p>
</li>
<li><p>bio</p>
</li>
<li><p>image/avatar</p>
</li>
</ul>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> faker = <span class="hljs-built_in">require</span>(<span class="hljs-string">'faker'</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">const</span> User = &#123;</span><br><span class="line">  name: faker.name.findName(),</span><br><span class="line">  email: faker.internet.email(),</span><br><span class="line">  website: faker.internet.url(),</span><br><span class="line">  address: faker.address.streetAddress() + faker.address.city() + faker.address.country(),</span><br><span class="line">  bio: faker.lorem.sentences(),</span><br><span class="line">  image: faker.image.avatar(),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Faker-js-Data"><a href="#Faker-js-Data" class="headerlink" title="Faker.js Data"></a>Faker.js Data</h3><p>List of data that can generate faker.js:</p>
<ul>
<li><p>address</p>
</li>
<li><p>commerce</p>
</li>
<li><p>company</p>
</li>
<li><p>date</p>
</li>
<li><p>finance</p>
</li>
<li><p>hacker</p>
</li>
<li><p>helpers</p>
</li>
<li><p>image</p>
</li>
<li><p>internet</p>
</li>
<li><p>lorem</p>
</li>
<li><p>name</p>
</li>
<li><p>phone</p>
</li>
<li><p>random</p>
</li>
<li><p>system</p>
</li>
</ul>
<h3 id="Use-in-Browser"><a href="#Use-in-Browser" class="headerlink" title="Use in Browser"></a>Use in Browser</h3><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="hljs-string">'faker.js'</span>&gt;<span class="hljs-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span></span><br><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="hljs-keyword">var</span> randomName = faker.name.findName()</span><br><span class="line">&lt;<span class="hljs-regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-20T13:54:19.000Z">2017-08-20</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    6 minutes read (About 910 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/20/Analyzing-Runtime-Performacne-with-Chrome-DevTools/">Analyzing Runtime Performacne With Chrome DevTools</a>
            
        </h1>
        <div class="content">
            <h3 id="Get-Started"><a href="#Get-Started" class="headerlink" title="Get Started"></a>Get Started</h3><ul>
<li><p>Open Chrome in Incognito Mode. Incognito Mode ensures that Chrome runs in a clean state. For example, if you have a lot of extensions installed, those extensions might create noise in you performance meaturements.</p>
</li>
<li><p>Load the following page in your Incognito window. This is the demo that you’re going to profile. The page shows a bunch of little blue squares moving up and down.</p>
</li>
</ul>
<p><code>https://googlechrome.github.io/devtools-samples/jank/</code></p>
<ul>
<li>Press <code>Command + Option + I</code> in Mac to open DevTools.</li>
</ul>
<h3 id="Simulate-a-Mobile-CPU"><a href="#Simulate-a-Mobile-CPU" class="headerlink" title="Simulate a Mobile CPU"></a>Simulate a Mobile CPU</h3><p>Mobile devices have much less CPU power than desktops and laptops. Whenevery you profile a page, use <strong>CPU Throttling</strong> to simulate how your page performs on mobile devices.</p>
<ul>
<li><p>In DevTools, click the <strong>Performacne</strong> tab.</p>
</li>
<li><p>Make sure that the <strong>Screenshots</strong> checkbox is enabled.</p>
</li>
<li><p>Click <strong>Capture Setting</strong>(the gear icon). DevTools reveals settings related to how it captures performances metrics.</p>
</li>
<li><p>For <strong>CPU</strong>, select <strong>2x slowdown</strong>. DevTools throttle your CPU so that it’s 2 times slower than usual.</p>
</li>
</ul>
<p><img src="https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/imgs/throttling.svg" alt=""></p>
<h3 id="Set-up-the-demo"><a href="#Set-up-the-demo" class="headerlink" title="Set up the demo"></a>Set up the demo</h3><ul>
<li><p>Keep clicking <strong>Add 10</strong> until the blue squares move noticeably slower than before.</p>
</li>
<li><p>Click <strong>Optimize</strong>, the blue squares should move faster and more smoothly.</p>
</li>
<li><p>Click <strong>Un-Optimize</strong>. The blue squares move slower and with more jank again.</p>
</li>
</ul>
<h3 id="Record-runtime-performance"><a href="#Record-runtime-performance" class="headerlink" title="Record runtime performance."></a>Record runtime performance.</h3><p>When you ran the optimized version of the page, the blue squares move faster. Why is that? Both version are supposed to move each square the same amount of spaces in the same amount of time. Take a recording in the Performance panel to learn how to detect the performance bottlenect in the un-optimized version.</p>
<ul>
<li>In DevTools, click <strong>Record</strong> DevTools captures performance metrics as the page run.</li>
</ul>
<p><img src="https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/imgs/profiling.png" alt="Profiling the Page"></p>
<ul>
<li><p>Wait a few seconds</p>
</li>
<li><p>Click <strong>Stop</strong>, DevTools stops recording, processes the data, then displays the results on the Performance panel.</p>
</li>
</ul>
<p><img src="https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/imgs/results.png" alt=""></p>
<h3 id="Analyze-the-results"><a href="#Analyze-the-results" class="headerlink" title="Analyze the results"></a>Analyze the results</h3><p>The main metrics for measuring the performance of any animation is frames per second (FPS). Users are happy when animations runs at 60 FPS.</p>
<ul>
<li>Look at the <strong>FPS</strong> Chart</li>
</ul>
<p><img src="https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/imgs/fps-chart.svg" alt=""></p>
<p>Whenever you see a red bar above <strong>FPS</strong>, it means that the framerate dropped so low that it’s propably harming the user experience. In general, the highter the green bar, the higher the FPS.</p>
<ul>
<li>Below the <strong>FPS</strong> chart you see the CPU chart.</li>
</ul>
<p><img src="https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/imgs/cpu-summary.svg" alt=""></p>
<p>The colors in the CPU chart corresponds to the colors in the Summary tab, at the bottom of the Performance panel. The fact that the CPU chart is full of color means that the CPU was maxed out during the recording.</p>
<ul>
<li><p>Hover your mouse over the <strong>FPS</strong>, <strong>CPU</strong>, or <strong>NET</strong> charts. DevTools shows a screenshot of the page at that point in time. Move your mouse left and right to replay the recoding. This is called srubbing, and it’s useful for manually analyzing the progression of animations.</p>
</li>
<li><p>In <strong>Frames</strong> section, hover your mouse over one of the green squares, DevTools shows you the FPS for that particular frame.</p>
</li>
</ul>
<p>Of course, with this demo, it’s pretty obvious that the page is not performing well. But in real scenarios, it may not be so clear, so having all of these tools to make measurements comes in handy.</p>
<h3 id="Find-Bottleneck"><a href="#Find-Bottleneck" class="headerlink" title="Find Bottleneck"></a>Find Bottleneck</h3><ul>
<li>Note the summary tab. When no events are selected, this tab shows you a breakdown of activity. The page spent most of its time rendering. Since performance is the art of doing less work, your goal is to reduce the amount of time spent doing rendering work.</li>
</ul>
<p><img src="https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/imgs/summary.svg" alt=""></p>
<ul>
<li>Expand the <strong>Main</strong> section. DevTools shows you a flame chart of activity on the main thread, over time. The x-axis represents the recoding, over time. Each bar represents an event. A wider bar means that event took longer. The y-axis represents the call stack. When you see events stacked on top of each other, it means the upper events caused the lower events.</li>
</ul>
<p><img src="https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/imgs/main.svg" alt=""></p>
<ul>
<li>There’s a lot of data in the recording. Zoom in on a single <strong>Animation Frame Field</strong> event by clicking, holding, and dragging your mouse over the <strong>Overview</strong>, which is the section that includes <strong>CPU</strong>, <strong>FPS</strong>, and <strong>NET</strong> charts. The <strong>Main</strong> section and <strong>Summary</strong> tab only display information for the selected portion of the recording.</li>
</ul>
<p><img src="https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/imgs/zoomed.png" alt=""></p>
<ul>
<li><p>Note the red triangle in the top-right of the <strong>Animation Frame Fired</strong> event. Whenever you see a red triangle, it’s a warning that there may be an issue related to this event.</p>
</li>
<li><p>Click the <strong>Animation Frame Fired</strong> event. The <strong>Summary</strong> tab now shows you information about that event. Note that <strong>reveal</strong> link. Click that causes DevTools to highlight the event that initiate the <strong>Animation Frame Fired</strong> event.</p>
</li>
<li><p>Under the <strong>app.update</strong> event, there’s a bunch of purple events. If they were wider, it looks as though each one might have a red triangle on it. Click one of the purple <strong>Layout</strong> events now. DevTools provides more information about the event in the <strong>Summary</strong> tab.</p>
</li>
</ul>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-18T09:49:07.000Z">2017-08-18</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    11 minutes read (About 1706 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/18/Requiring-Modules-in-Node-js/">Requiring Modules in Node.js</a>
            
        </h1>
        <div class="content">
            <figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> config = <span class="hljs-built_in">require</span>(<span class="hljs-string">'/path/to/file'</span>)</span><br></pre></td></tr></table></figure>
<p>The main object exported by the <code>require</code> module is a function. When Node invokes that <code>require()</code> function with a local file path as the function’s only argument, Node goes through the following sequence of steps:</p>
<ul>
<li><p><strong>Resolving</strong>: To find the absolute path of the file.</p>
</li>
<li><p><strong>Loading</strong>: To determine the type of the file content.</p>
</li>
<li><p><strong>Wrapping</strong>: To give the file its private scope. This is what makes both the <code>require</code> and <code>module</code> objects local to every file we require.</p>
</li>
<li><p><strong>Evaluating</strong>: This is what the VM eventually does with the loaded code.</p>
</li>
<li><p><strong>Caching</strong>: So that when we require this file again, we don’t go over all the steps another time.</p>
</li>
</ul>
<h4 id="Resolving-a-local-path"><a href="#Resolving-a-local-path" class="headerlink" title="Resolving a local path"></a>Resolving a local path</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// in NODE REPL</span></span><br><span class="line">&gt; <span class="hljs-built_in">module</span></span><br><span class="line">Module: &#123;</span><br><span class="line">  id: <span class="hljs-string">'&lt;repl&gt;'</span>,</span><br><span class="line">  exports: &#123;&#125;,</span><br><span class="line">  parent: <span class="hljs-literal">undefined</span>,</span><br><span class="line">  fielname: <span class="hljs-literal">null</span>,</span><br><span class="line">  loaded: <span class="hljs-literal">false</span>,</span><br><span class="line">  children: [],</span><br><span class="line">  paths: [...]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Every module object gets an <code>id</code> property to identify it. This <code>id</code> is usually the full path to the file, but in a REPL session it’s simply <code>&lt;repl&gt;</code>.</p>
<p>Node modules have a one-to-one relation with files on the file-system. We require a module by loading the content of a file into memory.</p>
<p>However, since Node allows many ways to require a file(for example, with a relative path or a pre-configured path), before we can load the content of a file into the memory we need to find the absolute location of that file.</p>
<p>When we require a <code>find-me</code> module, without specifying a path:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-built_in">require</span>(<span class="hljs-string">'find-me'</span>)</span><br></pre></td></tr></table></figure>
<p>Node will look for <code>find-me.js</code> in all the paths specified by <code>module.paths</code> in order.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// in NODE REPL</span></span><br><span class="line">&gt; <span class="hljs-built_in">module</span>.paths</span><br><span class="line">[ <span class="hljs-string">'/Users/samer/learn-node/repl/node_modules'</span>,</span><br><span class="line">  <span class="hljs-string">'/Users/samer/learn-node/node_modules'</span>,</span><br><span class="line">  <span class="hljs-string">'/Users/samer/node_modules'</span>,</span><br><span class="line">  <span class="hljs-string">'/Users/node_modules'</span>,</span><br><span class="line">  <span class="hljs-string">'/node_modules'</span>,</span><br><span class="line">  <span class="hljs-string">'/Users/samer/.node_modules'</span>,</span><br><span class="line">  <span class="hljs-string">'/Users/samer/.node_libraries'</span>,</span><br><span class="line">  <span class="hljs-string">'/usr/local/Cellar/node/7.7.1/lib/node'</span> ]</span><br></pre></td></tr></table></figure>
<p>The paths list is basically a list of node_modules directories under every directory from the current directory to the root directory. It also includes a few legacy directories whose use is not recommended.</p>
<p>If Node can’t find <code>find-me.js</code> in any of these paths, it will throw a ‘cannot find module error’.</p>
<h4 id="Requiring-a-folder"><a href="#Requiring-a-folder" class="headerlink" title="Requiring a folder"></a>Requiring a folder</h4><p>Modules don’t have to be files. We can also create a <code>find-me</code> folder under <code>node_modules</code> and place an <code>index.js</code> file in there. The same <code>require(&#39;fine-me&#39;)</code> line will use that folder’s <code>index.js</code> file.</p>
<p>An <code>index.js</code> file will be used by default when we require a folder, but we can control what file name to start under the folder using the <code>main</code> property in <code>package.json</code>.</p>
<h4 id="require-resolve"><a href="#require-resolve" class="headerlink" title="require.resolve"></a>require.resolve</h4><p>If you want to only resolve the module and not execute it, you can use the <code>require.resolve</code> function. This behaves exactly the same as the main <code>require</code> function, but does not execute the file.</p>
<p><strong>This can be used, for example, to check whether an optional package is installed or not and only use it when it’s available</strong>.</p>
<h4 id="exports-module-exports-and-asynchronous-loading-of-modules"><a href="#exports-module-exports-and-asynchronous-loading-of-modules" class="headerlink" title="exports, module.exports, and asynchronous loading of modules"></a>exports, module.exports, and asynchronous loading of modules</h4><p>In any module, exports is a special object.</p>
<p><code>exports</code> variable inside each module is just a reference to <code>module.exports</code> which manages the exported properties.</p>
<p>When we reassign the <code>exports</code> variable, that reference is lost and we would be introducing a new variable instead of changing the <code>module.exports</code> object.</p>
<p>The <code>module.exports</code> object in every module is what the <code>require</code> function returns when we require that module.</p>
<p>Let’s talk about the <code>loaded</code> attribute on every module. The <code>module</code> module use the <code>loaded</code> attribute to track which modules have been loaded(true value) and which modules are still being loaded(false value).</p>
<p>The <code>exports</code> object becomes complete when Node finishes loading the module(and label it so). The whole process of requiring/loading a module is <em>synchronous</em>. That’s why we were able to see the modules fully loaded after one cycle of the event loop.</p>
<p>This also means that we cannot change the <code>exports</code> object asynchronously.</p>
<h4 id="JSON-and-C-C-addons"><a href="#JSON-and-C-C-addons" class="headerlink" title="JSON and C/C++ addons"></a>JSON and C/C++ addons</h4><p>We can natively require JSON files and C++ addon files with the require function. You don’t need to specify the extensions.</p>
<p>If a file extension was not specified, the first thing Node will try to resolve is a <code>.js</code>, then <code>.json</code>, and it will parse the <code>.json</code> file if found as a JSON text file. After that Node will try to find a binary <code>.node</code> file.</p>
<p>Requiring JSON file is useful, for example, everything you need to manage in that file is some static configuration values, or some values that you periodically read from an external source. For example, if we had the following <code>config.json</code> file:</p>
<figure class="highlight json hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="hljs-attr">"host"</span>: <span class="hljs-string">"localhost"</span>,</span><br><span class="line">  <span class="hljs-attr">"port"</span>: <span class="hljs-number">8080</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We can require it directly like this:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> &#123; host, port &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./config'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="All-code-you-write-in-Node-will-be-wrapped-in-functions"><a href="#All-code-you-write-in-Node-will-be-wrapped-in-functions" class="headerlink" title="All code you write in Node will be wrapped in functions"></a>All code you write in Node will be wrapped in functions</h3><p>Node’s wrapping of modules is often misunderstood. To understand it, let me remind you about the <code>exports/module.exports</code> relation.</p>
<p>We can use the <code>exports</code> object to export properties, but we cannot replace the <code>exports</code> object directly because it’s just a reference to <code>module.exports</code>.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">exports.id = <span class="hljs-number">52</span>; <span class="hljs-comment">// This is ok</span></span><br><span class="line">exports = &#123; <span class="hljs-attr">id</span>: <span class="hljs-number">52</span> &#125;; <span class="hljs-comment">// This will not work</span></span><br><span class="line"><span class="hljs-built_in">module</span>.exports = &#123; <span class="hljs-attr">id</span>: <span class="hljs-number">52</span> &#125;; <span class="hljs-comment">// This is ok</span></span><br></pre></td></tr></table></figure>
<p>How exactly does this <code>exports</code> object, which appears to be global for every module, get defined as a reference on the <code>module</code> object?</p>
<p>In a browser, when we declare a variable in a script like this:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> answer = <span class="hljs-number">12</span>;</span><br></pre></td></tr></table></figure>
<p>That <code>answer</code> variable will be globally available in all scripts after the script that define it.</p>
<p>This is not the case in Node. When we define a variable in one module, the other module modules in the program will not have access to that variable. So how come variables in Node are magically scoped?</p>
<p>The answer is simple. Before compiling a module, Node wraps the module code in a function, which we can inspect using the <code>wrapper</code> property of the <code>module</code> module.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~ $ node</span><br><span class="line">&gt; <span class="hljs-built_in">require</span>(<span class="hljs-string">'module'</span>).wrapper</span><br><span class="line">[ <span class="hljs-string">'(function (exports, require, module, __filename, __dirname) &#123; '</span>,</span><br><span class="line">  <span class="hljs-string">'\n&#125;);'</span> ]</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
<p>Node does not execute any code you write in a file directly. It executes this wrapper function which will have your code in its body.</p>
<p>This is what keeps the top-level variables that are defined in any module scoped to that module.</p>
<p>This wrapper function has 5 arguments: <code>exports</code>, <code>require</code>, <code>module</code>, <code>__filename</code>, <code>__dirname</code>. This is what makes them appear to look global when in fact they are specific to each module.</p>
<p>All of these arguments get their value when Node execute the wrapper function. <code>exports</code> is defined as a reference to <code>module.exports</code> prior to that. <code>require</code> and <code>module</code> are both specific to the function to be executed, and <code>__dirname</code>/<code>__filename</code> variables will contain the wrapped module’s directory path and absolute filename.</p>
<p>Since every module gets wrapped in a function, we can actually access that function’s arguments with the <code>arguments</code> keyword:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">~<span class="hljs-regexp">/learn-node $ echo "console.log(arguments)" &gt; index.js</span></span><br><span class="line"><span class="hljs-regexp">~/</span>learn-node $ node index.js</span><br><span class="line">&#123; <span class="hljs-string">'0'</span>: &#123;&#125;,</span><br><span class="line">  <span class="hljs-string">'1'</span>:</span><br><span class="line">   &#123; [<span class="hljs-built_in">Function</span>: <span class="hljs-built_in">require</span>]</span><br><span class="line">     resolve: [<span class="hljs-built_in">Function</span>: resolve],</span><br><span class="line">     main:</span><br><span class="line">      Module &#123;</span><br><span class="line">        id: <span class="hljs-string">'.'</span>,</span><br><span class="line">        exports: &#123;&#125;,</span><br><span class="line">        parent: <span class="hljs-literal">null</span>,</span><br><span class="line">        filename: <span class="hljs-string">'/Users/samer/index.js'</span>,</span><br><span class="line">        loaded: <span class="hljs-literal">false</span>,</span><br><span class="line">        children: [],</span><br><span class="line">        paths: [<span class="hljs-built_in">Object</span>] &#125;,</span><br><span class="line">     extensions: &#123; ... &#125;,</span><br><span class="line">     cache: &#123; <span class="hljs-string">'/Users/samer/index.js'</span>: [<span class="hljs-built_in">Object</span>] &#125; &#125;,</span><br><span class="line">  <span class="hljs-string">'2'</span>:</span><br><span class="line">   Module &#123;</span><br><span class="line">     id: <span class="hljs-string">'.'</span>,</span><br><span class="line">     exports: &#123;&#125;,</span><br><span class="line">     parent: <span class="hljs-literal">null</span>,</span><br><span class="line">     filename: <span class="hljs-string">'/Users/samer/index.js'</span>,</span><br><span class="line">     loaded: <span class="hljs-literal">false</span>,</span><br><span class="line">     children: [],</span><br><span class="line">     paths: [ ... ] &#125;,</span><br><span class="line">  <span class="hljs-string">'3'</span>: <span class="hljs-string">'/Users/samer/index.js'</span>,</span><br><span class="line">  <span class="hljs-string">'4'</span>: <span class="hljs-string">'/Users/samer'</span> &#125;</span><br></pre></td></tr></table></figure>
<p>What happens is roughly equivalent to:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">require, module, __filename, __dirname</span>) </span>&#123;</span><br><span class="line">  <span class="hljs-keyword">let</span> exports = <span class="hljs-built_in">module</span>.exports;</span><br><span class="line">  <span class="hljs-comment">// Your Code...</span></span><br><span class="line">  <span class="hljs-keyword">return</span> <span class="hljs-built_in">module</span>.exports;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>If we change the whole <code>exports</code> object, it would no longer be a reference to <code>module.exports</code>.</p>
<h4 id="The-require-object"><a href="#The-require-object" class="headerlink" title="The require object"></a>The require object</h4><p>There is nothing special about <code>require</code>. It’s an object that acts mainly as a function that takes a module name or path and return the <code>module.exports</code> object. We can simply override the <code>require</code> object with our own logic if we want to.</p>
<p>For exmaple, maybe for testing purposes, we want every <code>require</code> call to be mocked by default and just return a fake object instead of the required module exports object.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-built_in">require</span> = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;</span><br><span class="line">  <span class="hljs-keyword">return</span> &#123; <span class="hljs-attr">mocked</span>: <span class="hljs-literal">true</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>After doing the above reassignment of <code>require</code>, every <code>require(&#39;something&#39;)</code> call in the script will just return the mocked object.</p>
<p>The require object also has properties of its own. We’ve seen the <code>resolve</code> property, which is a function that performs only the resolving step of the require process. We’ve also seen <code>require.extensions</code> above.</p>
<p>There is also <code>require.main</code> which can be helpful to determine if the script is being required or run directly.</p>
<p>Say, for example, that we have this simple <code>printFrame</code> function in <code>print-in-frame.js</code></p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// In print-in-frame.js</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">const</span> printFrame = <span class="hljs-function">(<span class="hljs-params">size, header</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'*'</span>.repeat(size))</span><br><span class="line">  <span class="hljs-built_in">console</span>.log(header)</span><br><span class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'*'</span>.repeat(size))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We want to use this file in two ways:</p>
<ul>
<li>From the command line directly like this:</li>
</ul>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node <span class="hljs-built_in">print</span>-in-frame 8 hello</span><br></pre></td></tr></table></figure>
<ul>
<li>With <code>require</code></li>
</ul>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> print = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./print-in-frame.js'</span>)</span><br><span class="line">print(<span class="hljs-number">5</span>, <span class="hljs-string">'hello'</span>)</span><br></pre></td></tr></table></figure>
<p>Those are two different usages. We need a way to determine if the file is being run as a stand-alone script or if it is being required by other scripts.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">const</span> printFrame = <span class="hljs-function">(<span class="hljs-params">size, header</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'*'</span>.repeat(size))</span><br><span class="line">  <span class="hljs-built_in">console</span>.log(header)</span><br><span class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'*'</span>.repeat(size))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">if</span> (<span class="hljs-built_in">require</span>.main === <span class="hljs-built_in">module</span>) &#123;</span><br><span class="line">  <span class="hljs-comment">// the file is being executed directly</span></span><br><span class="line">  printFrame(process.argv[<span class="hljs-number">2</span>], process.argv[<span class="hljs-number">3</span>])</span><br><span class="line">&#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">  <span class="hljs-built_in">module</span>.exports = printFrame</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="All-module-can-be-cached"><a href="#All-module-can-be-cached" class="headerlink" title="All module can be cached"></a>All module can be cached</h3><p>Caching is important to understand.</p>
<p>Say that we have the following <code>ascii-art.js</code> file that prints a cool looking header:</p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">#####</span></span><br><span class="line"><span class="hljs-comment">#</span></span><br><span class="line"><span class="hljs-comment">#####</span></span><br><span class="line"><span class="hljs-comment">#</span></span><br><span class="line"><span class="hljs-comment">#</span></span><br></pre></td></tr></table></figure>
<p>We want to display this header every time we <code>require</code> the file, so when we require the file twice, we want the header to show twice:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-built_in">require</span>(<span class="hljs-string">'./ascii-arg'</span>); <span class="hljs-comment">// it will show the header</span></span><br><span class="line"><span class="hljs-built_in">require</span>(<span class="hljs-string">'./ascii-arg'</span>); <span class="hljs-comment">// it won't show the header</span></span><br></pre></td></tr></table></figure>
<p>The second require will not show the header because of modules’ caching. Node caches the first call and does not load the file on the second call.</p>
<p>We can see this cache by printing <code>require.cache</code> after the first require. The cache registry is simply an object that has a property for every required module. Those properties values are the <code>module</code> objects used for each module. We can simply delete a property from that <code>require.cache</code> object to invalidate that cache. If we do that, Node will reload the module to recache it.</p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-18T03:14:46.000Z">2017-08-18</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    9 minutes read (About 1288 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/18/Concurrency-and-Parallelism-Understanding-I-O/">Concurrency and Parallelism: Understanding I/O</a>
            
        </h1>
        <div class="content">
            <p><a href="https://blog.risingstack.com/concurrency-and-parallelism-understanding-i-o/" target="_blank" rel="noopener">Original Post</a></p>
<p>Concurrency is much border, genral problem than parallelism. If you have tasks having inputs and outputs, and you want to schedule them so that they produce correct results, you are solving a concurrency problem.</p>
<p>Take a look at this diagram:</p>
<p><img src="https://blog-assets.risingstack.com/2017/02/cuncurrency-paralellism-diagram-of-tasks-with-dependencies.png" alt=""></p>
<p>It shows a data flow with input and output dependencies. Here tasks 2, 3, 4 can run concurrently after 1. There is no specific order between them, so we have multiple alternatives for running it sequetially. Showing only two of them:</p>
<p><img src="https://blog-assets.risingstack.com/2017/02/concurrent-data-flow-path-13245.png" alt=""></p>
<p>Alternatively, these tasks can run in parallel, e.g. on another processor core, another processor, or an entirely seperate computer.</p>
<p>On these diagrams, thread means a computation carried out on dedicated processor core, not an OS thread, as they are not necessarily parallel.</p>
<p><img src="https://blog-assets.risingstack.com/2017/02/paralellized-tasks-diagram.png" alt=""></p>
<p>If we only have one processor, why do we even bother with writing concurrent application? The processing time will not get shorter, and we add the overhead of scheduling. As a matter of fact, any modern operating system will also slice up the concurrent tasks and interleave them, so each of the slices will run for a short time.</p>
<h5 id="There-are-various-reasons-for-this"><a href="#There-are-various-reasons-for-this" class="headerlink" title="There are various reasons for this:"></a>There are various reasons for this:</h5><ul>
<li><p>We human like to interact with the computer in real time, e.g. as I type this text, I want to see it appearing on the screen immediately, at the same time listening to my favorite tracklist, and getting notifications about my incoming emails. Just imagine that you cannot drag a window while the movie keeps on playing it.</p>
</li>
<li><p>Not all operations are carried out on the computer’s CPU. If you want to write to an HDD for example, a lot of time is spent seeking to the position, writing the sectors, etc, and the intermittent time can be spent to do something else.</p>
</li>
</ul>
<p>These require the operating system kernel to run tasks in an interleaved manner, referred to as <code>time-sharing</code>. This is a very important property of modern operating systems.</p>
<h3 id="Processes-and-Threads"><a href="#Processes-and-Threads" class="headerlink" title="Processes and Threads"></a>Processes and Threads</h3><blockquote>
<p>A process is a running instance of a computer program. It is what you see in the task manager of your operating system or <code>top</code>.</p>
</blockquote>
<p>A process consists of allocated memory which holds the program code, its data, a heap for dynamic memory allocation, and a lot more. However, it is not the unit for multi-tasking in desktop operating systems.</p>
<blockquote>
<p>Thread is the default unit - the task - of CPU usage. COde executed in a single thread is what we usually refer to as sequential or synchronous execution.</p>
</blockquote>
<p>Threads are supported by nearly all operating systems and can be created with system calls. They have theri own <code>call stack</code>, <code>virual CPU</code> and <code>local storage</code> but share the application’s <code>heap</code>, data, codebase and resources.</p>
<p>They also serve as the unit of scheduling in the kernel. For this reason, we call them <code>kernel threads</code>, clarifying that they are native to the operating system and scheduled by the kernel, which distinguishes them from use-space threads, also called <code>green threads</code> which are scheduled by some user space schedular such as a library or VM.</p>
<p><img src="https://blog-assets.risingstack.com/2017/02/kernel-processes-and-threads-1.png" alt=""></p>
<p>Most desktop and sever operating system kernels use preemptive schedulers, as does the Linux, macOS and Windows kernel. We can assume that threads are preemptive scheduled, distinguishing them from their non-preemptive(cooperative) counterparts, called <code>fiber</code>. This preemptive scheduling is the reason that a hanging process doesn’t stall the whole computer.</p>
<p>The hanging time slices are interleaved with other processes’ and the OS’ code, so the system as a whole remains responsive.</p>
<p>Context switching(switching between threads) is done at frequent intervals by the kernel, creating the illusion that our programs are running in parallel, whereas in reality, they are running concurrently but sequentially in short slices.</p>
<h3 id="CPU-vs-I-O"><a href="#CPU-vs-I-O" class="headerlink" title="CPU vs. I/O"></a>CPU vs. I/O</h3><p>Programs usually don’t only consist of numeric, arithmetic and logic computations, in fact, a lot of times they merely write something to the file system, do network requests or access peripheries such as the console or an external device.</p>
<p>While the first kind of workload is CPU intensive, the latter requries performing I/O in the majority of the time.</p>
<p>Doing I/O is a kernel space operation, initiated with a system call, so it results in a privilege context switch.</p>
<p>When an I/O operation is requested with a blocking  system call, we are talking about <em>blocking I/O</em>.</p>
<p>This can deteriorate concurrency under implementation, concretely those that use <em>many-to-one mapping</em>. This means that all threads in a process share a common kernel thread, which implies that every thread is blocked when one does blocking I/O.</p>
<p>No wonder that modern OSes don’t do this. Instead, they use <code>one-to-one</code> mapping, i.e. map a kernel thread to each user-space thread, allowing another thread to run when one makes a blocking system call, which means that they are unaffected by the above adverse effect.</p>
<h3 id="I-O-favors-Blocking-vs-Non-Blocking-Sycn-vs-Async"><a href="#I-O-favors-Blocking-vs-Non-Blocking-Sycn-vs-Async" class="headerlink" title="I/O favors: Blocking vs. Non-Blocking, Sycn vs. Async"></a>I/O favors: Blocking vs. Non-Blocking, Sycn vs. Async</h3><p>Doing I/O usually consiss of two distinct steps:</p>
<ul>
<li><p>checking the device</p>
<ul>
<li><p>blocking: waiting for the device to be ready</p>
</li>
<li><p>non-blocking: e.g. polling periodically until ready</p>
</li>
</ul>
</li>
<li><p>transmitting:</p>
<ul>
<li><p>synchronous: executing the operation (e.g. read or write) initiated by the program.</p>
</li>
<li><p>asynchronous: executing the operation as response to an event from the kernel(asynchronous/event drive)</p>
</li>
</ul>
</li>
</ul>
<p>You can mix the two steps in every fashion</p>
<h3 id="Busy-Waiting-Polling-and-the-Event-Loop"><a href="#Busy-Waiting-Polling-and-the-Event-Loop" class="headerlink" title="Busy-Waiting, Polling, and the Event Loop"></a>Busy-Waiting, Polling, and the Event Loop</h3><p>Busy-waiting is the act of repeatedly checking a resource, such as I/O for availability in a <em>tight loop</em>. The absence of the tight loop is what distinguishes <code>polling</code> for busy-waiting.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// tight-loop example</span></span><br><span class="line"><span class="hljs-keyword">while</span> (pthread_mutex_trylock(&amp;my_mutex) == EBUSY) &#123; &#125;</span><br><span class="line"><span class="hljs-comment">// mutex is unlocked</span></span><br><span class="line">do_stuff()</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// polling example</span></span><br><span class="line"><span class="hljs-keyword">while</span> (pthread_mutex_trylock(&amp;my_mutex) == EBUSY) &#123;</span><br><span class="line">  sleep(POLL_INTERVAL)</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-comment">// mutex is unlocked</span></span><br><span class="line">do_stuff()</span><br></pre></td></tr></table></figure>
<p>The difference between the two code is apparent. The <code>sleep</code> function puts the current thread of execution to sleep, yield control to the kernel to schedule something else to run.</p>
<p>It is also obvious that both of them offer a technique of turning non-blocking code into blocking code, because control won’t pass the loop until the mutex becomes free. This means that <code>do_stuff</code> is blocked.</p>
<p>Let’s say we have more of thse mutexes or any arbitrary I/O device that can be polled. We can invert control-flow by assigning handlers to be called when the resource is ready. If we periodically check the resources in the llop and execute the associated handlers on completion, we created what is called an <code>event loop</code>.</p>
<h3 id="TCP-server-example"><a href="#TCP-server-example" class="headerlink" title="TCP server example"></a>TCP server example</h3><p>The following exmaple will illustrate the differences between working with <em>synchronous, blocking</em> and <em>non-blocking</em> network I/O. It is a dead-simple TCP echo server. After the client connects, every line is echoed back to the socket until the client write ‘bye’.</p>
<h4 id="Single-threaded"><a href="#Single-threaded" class="headerlink" title="Single threaded"></a>Single threaded</h4><p>The first version uses the standard POSIX procedure of <code>sys/socket.h</code>.</p>
<p>The server is single-threaded, it waits until a client connects.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// wait for a connection, then accept() it</span></span><br><span class="line"><span class="hljs-keyword">if</span> ((conn_s) = accept(list_s, NULL, NULL) &lt; <span class="hljs-number">0</span>) &#123;</span><br><span class="line">  <span class="hljs-comment">// exit w err</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Then it reads from the socket each line and echoes it back until the client closes connection or prints the word ‘bye’ on a line.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">bye = <span class="hljs-number">0</span></span><br><span class="line"><span class="hljs-keyword">while</span>(!bye) &#123;</span><br><span class="line">  read_line_from_socket(conn_s, buffer, MAX_LINE - <span class="hljs-number">1</span>)</span><br><span class="line">  <span class="hljs-keyword">if</span> (!strncmp(buffer, <span class="hljs-string">'bye\n'</span>, MAX_LINE - <span class="hljs-number">1</span>)) bye = <span class="hljs-number">1</span></span><br><span class="line">  write_line_to_socket(conn_s, buffer, strlen(buffer))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">if</span> (close(conn_s) &lt; <span class="hljs-number">0</span>) &#123;</span><br><span class="line">  <span class="hljs-comment">// exit w err</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-17T03:23:44.000Z">2017-08-17</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    7 minutes read (About 987 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/17/Advanced-Topics-of-TS/">Advanced Topics of TS</a>
            
        </h1>
        <div class="content">
            <h3 id="Iterators-and-Generators"><a href="#Iterators-and-Generators" class="headerlink" title="Iterators and Generators"></a>Iterators and Generators</h3><p>Iterators are basically objects that can be hold more than one item. Iterators are collections of objects or variables or items that can be iterated on to do some sort of processing on each item in the collection. Arrays are an exmaple of iterators.</p>
<p>In TypeScript, an object is demmed iterable if it has an implementation for <code>Symbol.iterator</code> property. Some built-in types like <strong>Array, Map, Set, String, Int32Array</strong>, etc. have their <code>Symbol.iterator</code> property already implemented.</p>
<p><code>Symbol.iterator</code> function on an object is responsible for returning the list of values to iterate on.</p>
<p><code>for...of...</code> statements</p>
<p><code>for...of...</code> loops over an iterable object will invoke the <code>Symbol.iterable</code> property on the object.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">let</span> someArray = [<span class="hljs-number">1</span>, <span class="hljs-string">'string'</span>, <span class="hljs-literal">false</span>]</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> entry <span class="hljs-keyword">of</span> someArray) &#123;</span><br><span class="line">  <span class="hljs-built_in">console</span>.log(entry) <span class="hljs-comment">// 1, 'string', false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Intersection-Types"><a href="#Intersection-Types" class="headerlink" title="Intersection Types"></a>Intersection Types</h3><p>An intersection type combines multiple types into one. This is allows you to add together existing types to get a single type that has all the features you need.</p>
<h4 id="Union-Types"><a href="#Union-Types" class="headerlink" title="Union Types"></a>Union Types</h4><p>Union Types are closely related to intersection types, but they are used very differently. Occasionally, you’ll run into a library that expects a parameter to be either a <code>number</code> or a <code>string</code>.</p>
<h3 id="Type-Guards"><a href="#Type-Guards" class="headerlink" title="Type Guards"></a>Type Guards</h3><p>Union Types are useful for modeling situations when values can overlap in the types they can take on.</p>
<p>TypeScript has what is called a <code>type guard</code>.</p>
<p>A type guard is some expression that performs a runtime check that guarantees the type in some scope. To define a type guard, we simply need to define a function whose return type is a <code>type predicate</code>.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isFish</span>(<span class="hljs-params">pet: Fish | Bird</span>): <span class="hljs-title">pet</span> <span class="hljs-title">is</span> <span class="hljs-title">Fish</span> </span>&#123;</span><br><span class="line">  <span class="hljs-keyword">return</span> (&lt;Fish&gt;pet).swim !== undefined</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>pet is Fish</code> is our type predicate in this example. A predicate takes the form <code>parameterName is Type</code>, where <code>parameterName</code> must be the name of a parameter from the current function signature.</p>
<p>Any time <code>isFish</code> is called with some variable, TypeScript will <code>narrow</code> that variable to that specific type if the original type is compatible.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">if</span> (isFish(pet)) &#123;</span><br><span class="line">  pet.swim()</span><br><span class="line">&#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">  pet.fly()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Notice that TypeScript not only knows that <code>pet is Fish</code> in the if branch, it also knows that in the else branch you <strong>don’t</strong> have a fish, so you must have a <code>Bird</code>.</p>
<h4 id="typeof-type-guards"><a href="#typeof-type-guards" class="headerlink" title="typeof type guards"></a><code>typeof</code> type guards</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isNumber</span>(<span class="hljs-params">x: any</span>): <span class="hljs-title">x</span> <span class="hljs-title">is</span> <span class="hljs-title">number</span> </span>&#123;</span><br><span class="line">  <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> x === <span class="hljs-string">'number'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isString</span>(<span class="hljs-params">x: any</span>): <span class="hljs-title">x</span> <span class="hljs-title">is</span> <span class="hljs-title">string</span> </span>&#123;</span><br><span class="line">  <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> x === <span class="hljs-string">'string'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">padLeft</span>(<span class="hljs-params">value: string, padding: string | number</span>) </span>&#123;</span><br><span class="line">  <span class="hljs-keyword">if</span> (isNumber(padding)) &#123;</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Array</span>(padding + <span class="hljs-number">1</span>).join(<span class="hljs-string">' '</span>) + value</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="hljs-keyword">if</span> (isString(padding)) &#123;</span><br><span class="line">    <span class="hljs-keyword">return</span> padding + value</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`Expected string or number, got <span class="hljs-subst">$&#123;padding&#125;</span>`</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>However, having to define a functino to figure out if a typeis a primitive is kind of a pain.</p>
<p>TypeScript will recognize <code>typeof x === &#39;number&#39;</code> as a type guard on its own. This means we could just write checks inline.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">padLeft</span> (<span class="hljs-params">value: string, padding: number | string </span>) </span>&#123;</span><br><span class="line">  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> padding === <span class="hljs-string">'number'</span>) &#123;</span><br><span class="line">    <span class="hljs-comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> padding === <span class="hljs-string">'string'</span>) &#123;</span><br><span class="line">    <span class="hljs-comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`Expected string or number, got <span class="hljs-subst">$&#123;padding&#125;</span>`</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>These <code>typeof</code> <em>type guards</em> are recognized in two different forms: <code>typeof v === &#39;typename&#39;</code> and <code>typeof v !== &#39;typename&#39;</code>.</p>
<h4 id="instanceof-type-guards"><a href="#instanceof-type-guards" class="headerlink" title="instanceof type guards"></a><code>instanceof</code> type guards</h4><p><code>instanceof</code> <em>type guards</em> are a way of narrowing types using their constructor function.</p>
<p>The right side of the <code>instanceof</code> needs to be a constructor function, and TypeScript narrow down to:</p>
<ul>
<li><p>the type of the function’s <code>prototype</code> property if its type is not any.</p>
</li>
<li><p>the union of types returned by that type’s construct signatures.</p>
</li>
</ul>
<p>in that order.</p>
<h3 id="Generics"><a href="#Generics" class="headerlink" title="Generics"></a>Generics</h3><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">identity</span>&lt;<span class="hljs-title">T</span>&gt;(<span class="hljs-params">arg: T</span>): <span class="hljs-title">T</span> </span>&#123;</span><br><span class="line">  <span class="hljs-keyword">return</span> arg</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We add a type variable <code>T</code> to the identity function. This T allows us to capture the type the user of the code provides, so that we can use that information later.</p>
<p>We say that this version of the <code>identity</code> function is generic, as it works over a range of types.</p>
<p>Once we’ve written the generic identity function, we can call it in one of two ways.</p>
<p>The first way is to pass all of the arguments, including the type argument, to the function.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">let</span> output = identity&lt;string&gt;(<span class="hljs-string">'myString'</span>); <span class="hljs-comment">// type of output will be string</span></span><br></pre></td></tr></table></figure>
<p>Here we explicitly set T to be <code>string</code> as one of the arguments to the function call, denoted using <code>&lt;&gt;</code> around the arguments rather than ().</p>
<p>The second way is also perphaps the most common. Here we use <em>type argument inference</em> – that is, we want the compiler to set the value of T for us automatically based on the type of the argument we pass in.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">let</span> output = identity(<span class="hljs-string">'myString'</span>); <span class="hljs-comment">// type of output will be 'string'</span></span><br></pre></td></tr></table></figure>
<h4 id="Working-with-Generic-Type-Variables"><a href="#Working-with-Generic-Type-Variables" class="headerlink" title="Working with Generic Type Variables"></a>Working with Generic Type Variables</h4><p>When you begin to use generics, you’ll notice that when you create generic functinos like <code>identity</code>, the compiler will enfore that you use any generically typed parameters in the body of the function correctly.</p>
<h4 id="Generic-Types"><a href="#Generic-Types" class="headerlink" title="Generic Types"></a>Generic Types</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">identity</span>&lt;<span class="hljs-title">T</span>&gt;(<span class="hljs-params">arg: T</span>): <span class="hljs-title">T</span> </span>&#123;</span><br><span class="line">  <span class="hljs-keyword">return</span> arg;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">let</span> myIdentity: &lt;T&gt;(arg: T) =&gt; T = identity</span><br><span class="line"></span><br><span class="line">// we can also write the generic type as a call signature of an object literal type:</span><br><span class="line"></span><br><span class="line">let myIdentity: &#123;&lt;T&gt;(arg: T) : T&#125; = identity</span><br><span class="line"></span><br><span class="line">interface GenericIdentityFn &#123;</span><br><span class="line">  &lt;T&gt;(arg: T): T</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// or</span><br><span class="line"></span><br><span class="line">interface GenericIdentityFn&lt;T&gt; &#123;</span><br><span class="line">  (arg: T): T</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let myIdentity: GenericIdentityFn&lt;number&gt; = identity</span><br></pre></td></tr></table></figure>
<h4 id="Generic-Classes"><a href="#Generic-Classes" class="headerlink" title="Generic Classes"></a>Generic Classes</h4><p>A generic class has a similar shape to a generic interface.</p>
<p>Generic classes have a generic type parameter list in angle brackets(&lt;&gt;) following the name of the class.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GenericNumber</span>&lt;<span class="hljs-title">T</span>&gt; </span>&#123;</span><br><span class="line">  zeroValue: T;</span><br><span class="line">  add: <span class="hljs-function">(<span class="hljs-params">x: T, y: T</span>) =&gt;</span> T;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">let</span> myGenericNumber = <span class="hljs-keyword">new</span> GenericNumber&lt;number&gt;()</span><br></pre></td></tr></table></figure>
<p>Generic classes are only generic over their instance side rather than their static side.</p>
<h3 id="Decorator"><a href="#Decorator" class="headerlink" title="Decorator"></a>Decorator</h3><p>A <em>Decorator</em> is a special kind of declaration that can be attached to a class declaration, method, accessor, property, or parameter.</p>
<p>Sometimes it is required to have additional features to support annotating or modifying classes and class members. Decorators provide a way to add both annotation and a meta-programming syntax for class declarations and members.</p>
<p>Decoration use the form <code>@expression</code>, where <code>expression</code> must evaluate to a function that will be called at runtime with information about the decorated declaration.</p>

        </div>
        
        
        
    </div>
</div>









    
<div class="card card-transparent">
    <nav class="pagination is-centered" role="navigation" aria-label="pagination">
        <div class="pagination-previous">
            <a class="is-flex-grow has-text-black-ter" href="/page/3/">Previous</a>
        </div>
        <div class="pagination-next">
            <a class="is-flex-grow has-text-black-ter" href="/page/5/">Next</a>
        </div>
        <ul class="pagination-list is-hidden-mobile">
            
            <li><a class="pagination-link has-text-black-ter" href="/">1</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/2/">2</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/3/">3</a></li>
            
            <li><a class="pagination-link is-current" href="/page/4/">4</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/5/">5</a></li>
            
            <li><span class="pagination-ellipsis has-text-black-ter">&hellip;</span></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/16/">16</a></li>
            
        </ul>
    </nav>
</div>
</div>
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered">
                <div>
                    
                        <img class="image is-128x128 has-mb-6" src="/images/avatar.jpg" alt="Keith Chen">
                    
                    
                    <p class="is-size-4 is-block">
                        Keith Chen
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        FE Engineer on Blockchain
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>30°17&#39;37N, 120°9&#39;41E</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Posts
                    </p>
                    <p class="title has-text-weight-normal">
                        303
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Categories
                    </p>
                    <p class="title has-text-weight-normal">
                        7
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Tags
                    </p>
                    <p class="title has-text-weight-normal">
                        88
                    </p>
                </div>
            </div>
        </nav>
        <div class="level">
            <a class="level-item button is-link is-rounded" href="https://github.com/keith-CY" target="_blank">
                Follow</a>
        </div>
        
        
    </div>
</div>
    
        
    
        

<div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Links
        </h3>
        <ul class="menu-list">
        
            <li>
                <a class="level is-mobile" href="https://github.com/keith-CY" target="_blank">
                    <span class="level-left">
                        <span class="level-item">Keith CY</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">github.com</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="https://www.linkedin.com/in/宇-陈-644b61ba" target="_blank">
                    <span class="level-left">
                        <span class="level-item">Yu Chen</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">www.linkedin.com</span>
                    </span>
                </a>
            </li>
        
        </ul>
        </div>
    </div>
</div>


    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Categories
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/Soup/">
            <span class="level-start">
                <span class="level-item">Soup</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Uncategorized/">
            <span class="level-start">
                <span class="level-item">Uncategorized</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/github/">
            <span class="level-start">
                <span class="level-item">github</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">4</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/github/note/">
            <span class="level-start">
                <span class="level-item">note</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/note/">
            <span class="level-start">
                <span class="level-item">note</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">141</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/note/workNote/">
            <span class="level-start">
                <span class="level-item">workNote</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">19</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/workNote/">
            <span class="level-start">
                <span class="level-item">workNote</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">5</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Tag Cloud
        </h3>
        <a href="/tags/AJAX/" style="font-size: 10.91px;">AJAX</a> <a href="/tags/BOOTSTRAP/" style="font-size: 10px;">BOOTSTRAP</a> <a href="/tags/Bash/" style="font-size: 11.82px;">Bash</a> <a href="/tags/BlockChain/" style="font-size: 10px;">BlockChain</a> <a href="/tags/Blockchain/" style="font-size: 10px;">Blockchain</a> <a href="/tags/CORS/" style="font-size: 10px;">CORS</a> <a href="/tags/CSS/" style="font-size: 10.91px;">CSS</a> <a href="/tags/CSS3/" style="font-size: 20px;">CSS3</a> <a href="/tags/Closure/" style="font-size: 10px;">Closure</a> <a href="/tags/CommonJS/" style="font-size: 10px;">CommonJS</a> <a href="/tags/Contract-Ethereum-Web3/" style="font-size: 10px;">Contract, Ethereum, Web3</a> <a href="/tags/Contract-Solidity/" style="font-size: 10px;">Contract, Solidity</a> <a href="/tags/D3-Example/" style="font-size: 10px;">D3, Example</a> <a href="/tags/DAPP-Solidity/" style="font-size: 10px;">DAPP, Solidity</a> <a href="/tags/DApp-Solidity/" style="font-size: 10px;">DApp, Solidity</a> <a href="/tags/DOM/" style="font-size: 12.73px;">DOM</a> <a href="/tags/DevTools/" style="font-size: 10px;">DevTools</a> <a href="/tags/Drizzle-Ethereum-BlockChain/" style="font-size: 10px;">Drizzle, Ethereum, BlockChain</a> <a href="/tags/ES6/" style="font-size: 10.91px;">ES6</a> <a href="/tags/ESLint/" style="font-size: 10px;">ESLint</a> <a href="/tags/ETH-Wallet/" style="font-size: 10px;">ETH, Wallet</a> <a href="/tags/Elixir-Phoenix-SCSS/" style="font-size: 10px;">Elixir, Phoenix, SCSS</a> <a href="/tags/Erlang-Elixir-GenServer/" style="font-size: 10px;">Erlang, Elixir, GenServer</a> <a href="/tags/Ethereum/" style="font-size: 10px;">Ethereum</a> <a href="/tags/Ethereum-IPFS/" style="font-size: 10px;">Ethereum, IPFS</a> <a href="/tags/FP/" style="font-size: 10px;">FP</a> <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/Go-Http-Web/" style="font-size: 10px;">Go, Http, Web</a> <a href="/tags/GraphQL-Apollo-TypeScript/" style="font-size: 10px;">GraphQL, Apollo, TypeScript</a> <a href="/tags/Gulp/" style="font-size: 11.82px;">Gulp</a> <a href="/tags/HTML5/" style="font-size: 15.45px;">HTML5</a> <a href="/tags/HTTP2-Node/" style="font-size: 10px;">HTTP2, Node</a> <a href="/tags/Html-Picture/" style="font-size: 10px;">Html, Picture</a> <a href="/tags/Immutable/" style="font-size: 10px;">Immutable</a> <a href="/tags/Int8Array/" style="font-size: 10px;">Int8Array</a> <a href="/tags/JSON-RPC/" style="font-size: 10px;">JSON-RPC</a> <a href="/tags/Javascript/" style="font-size: 19.09px;">Javascript</a> <a href="/tags/Koa/" style="font-size: 10.91px;">Koa</a> <a href="/tags/Koa-NPM-Package/" style="font-size: 10px;">Koa, NPM, Package</a> <a href="/tags/MDL/" style="font-size: 16.36px;">MDL</a> <a href="/tags/Material-Design/" style="font-size: 17.27px;">Material Design</a> <a href="/tags/Mock-JavaScript/" style="font-size: 10px;">Mock, JavaScript</a> <a href="/tags/MySQL/" style="font-size: 10px;">MySQL</a> <a href="/tags/NODE/" style="font-size: 13.64px;">NODE</a> <a href="/tags/NPM/" style="font-size: 10.91px;">NPM</a> <a href="/tags/Nginx/" style="font-size: 10px;">Nginx</a> <a href="/tags/Nock/" style="font-size: 10px;">Nock</a> <a href="/tags/Node-CLI/" style="font-size: 10.91px;">Node, CLI</a> <a href="/tags/Node-Fastify/" style="font-size: 10.91px;">Node, Fastify</a> <a href="/tags/Node-Graphql-Koa/" style="font-size: 10px;">Node, Graphql, Koa</a> <a href="/tags/Node-js/" style="font-size: 10.91px;">Node.js</a> <a href="/tags/Phoenix-Elixir-Ecto/" style="font-size: 10px;">Phoenix, Elixir, Ecto</a> <a href="/tags/Promise/" style="font-size: 11.82px;">Promise</a> <a href="/tags/Protobuf/" style="font-size: 10px;">Protobuf</a> <a href="/tags/Pug-HTML/" style="font-size: 10px;">Pug, HTML</a> <a href="/tags/React/" style="font-size: 18.18px;">React</a> <a href="/tags/React-Docker/" style="font-size: 10px;">React, Docker</a> <a href="/tags/React-Router-Code-splitting/" style="font-size: 10px;">React, Router, Code-splitting</a> <a href="/tags/React-Native/" style="font-size: 10px;">React-Native</a> <a href="/tags/React-Redux/" style="font-size: 10px;">React-Redux</a> <a href="/tags/React-Router/" style="font-size: 10.91px;">React-Router</a> <a href="/tags/Redux/" style="font-size: 14.55px;">Redux</a> <a href="/tags/RegExp/" style="font-size: 10px;">RegExp</a> <a href="/tags/Ruby-Rails/" style="font-size: 10px;">Ruby, Rails</a> <a href="/tags/Ruby-Rails-RoR-Mina/" style="font-size: 10px;">Ruby, Rails, RoR, Mina</a> <a href="/tags/Rust-Rocket/" style="font-size: 10px;">Rust, Rocket</a> <a href="/tags/RxJS/" style="font-size: 10px;">RxJS</a> <a href="/tags/Smart-Contract-Web3/" style="font-size: 10px;">Smart Contract, Web3</a> <a href="/tags/Solidity/" style="font-size: 12.73px;">Solidity</a> <a href="/tags/Solidity-Error-Handling/" style="font-size: 10px;">Solidity, Error Handling</a> <a href="/tags/Solidity-Public-External/" style="font-size: 10px;">Solidity, Public, External</a> <a href="/tags/Solidity-Smart-Contract/" style="font-size: 10px;">Solidity, Smart Contract</a> <a href="/tags/Thunk/" style="font-size: 10.91px;">Thunk</a> <a href="/tags/Trick/" style="font-size: 11.82px;">Trick</a> <a href="/tags/Web/" style="font-size: 10px;">Web</a> <a href="/tags/Webpack/" style="font-size: 10px;">Webpack</a> <a href="/tags/Webpack-DLL/" style="font-size: 10px;">Webpack, DLL</a> <a href="/tags/automatic/" style="font-size: 10px;">automatic</a> <a href="/tags/babel/" style="font-size: 10px;">babel</a> <a href="/tags/babel-polyfill/" style="font-size: 10px;">babel-polyfill</a> <a href="/tags/commandline/" style="font-size: 10px;">commandline</a> <a href="/tags/github/" style="font-size: 10.91px;">github</a> <a href="/tags/jQuery/" style="font-size: 10px;">jQuery</a> <a href="/tags/precache/" style="font-size: 10px;">precache</a> <a href="/tags/shell/" style="font-size: 10px;">shell</a> <a href="/tags/webpack/" style="font-size: 17.27px;">webpack</a> <a href="/tags/webpack2/" style="font-size: 11.82px;">webpack2</a> <a href="/tags/测试/" style="font-size: 11.82px;">测试</a>
    </div>
</div>

    
    
        <div class="column-right-shadow is-hidden-widescreen ">
        
            
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Recent
        </h3>
        
        <article class="media">
            
            <a href="/2019/03/05/note-on-bip32/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Note on Bip32">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-03-05T05:54:32.000Z">2019-03-05</time></div>
                    <a href="/2019/03/05/note-on-bip32/" class="has-link-black-ter is-size-6">Note on Bip32</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/11/20/React-Hooks/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="React Hooks">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-11-20T09:41:39.000Z">2018-11-20</time></div>
                    <a href="/2018/11/20/React-Hooks/" class="has-link-black-ter is-size-6">React Hooks</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/11/11/5-tips-in-CRA-2-0/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="5 Tips in CRA@2.0">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-11-11T15:52:25.000Z">2018-11-11</time></div>
                    <a href="/2018/11/11/5-tips-in-CRA-2-0/" class="has-link-black-ter is-size-6">5 Tips in CRA@2.0</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/11/08/Assembly-in-Solidity/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Assembly in Solidity">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-11-08T03:30:30.000Z">2018-11-08</time></div>
                    <a href="/2018/11/08/Assembly-in-Solidity/" class="has-link-black-ter is-size-6">Assembly in Solidity</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/09/10/Analysis-of-Ujo/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Analysis of Ujo">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-09-10T05:26:39.000Z">2018-09-10</time></div>
                    <a href="/2018/09/10/Analysis-of-Ujo/" class="has-link-black-ter is-size-6">Analysis of Ujo</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>

        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Archives
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2019/03/">
                <span class="level-start">
                    <span class="level-item">March 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/11/">
                <span class="level-start">
                    <span class="level-item">November 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/09/">
                <span class="level-start">
                    <span class="level-item">September 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/08/">
                <span class="level-start">
                    <span class="level-item">August 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/07/">
                <span class="level-start">
                    <span class="level-item">July 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/05/">
                <span class="level-start">
                    <span class="level-item">May 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/04/">
                <span class="level-start">
                    <span class="level-item">April 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/03/">
                <span class="level-start">
                    <span class="level-item">March 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/02/">
                <span class="level-start">
                    <span class="level-item">February 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/01/">
                <span class="level-start">
                    <span class="level-item">January 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/12/">
                <span class="level-start">
                    <span class="level-item">December 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/11/">
                <span class="level-start">
                    <span class="level-item">November 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">12</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/10/">
                <span class="level-start">
                    <span class="level-item">October 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/09/">
                <span class="level-start">
                    <span class="level-item">September 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">18</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/08/">
                <span class="level-start">
                    <span class="level-item">August 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">31</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/07/">
                <span class="level-start">
                    <span class="level-item">July 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">19</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/06/">
                <span class="level-start">
                    <span class="level-item">June 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">14</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/05/">
                <span class="level-start">
                    <span class="level-item">May 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">15</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/04/">
                <span class="level-start">
                    <span class="level-item">April 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">9</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/03/">
                <span class="level-start">
                    <span class="level-item">March 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/02/">
                <span class="level-start">
                    <span class="level-item">February 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/01/">
                <span class="level-start">
                    <span class="level-item">January 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/12/">
                <span class="level-start">
                    <span class="level-item">December 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/11/">
                <span class="level-start">
                    <span class="level-item">November 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/10/">
                <span class="level-start">
                    <span class="level-item">October 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/09/">
                <span class="level-start">
                    <span class="level-item">September 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">16</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/08/">
                <span class="level-start">
                    <span class="level-item">August 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">30</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/07/">
                <span class="level-start">
                    <span class="level-item">July 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">43</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/06/">
                <span class="level-start">
                    <span class="level-item">June 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">25</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/05/">
                <span class="level-start">
                    <span class="level-item">May 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">24</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
        
        </div>
    
</div>

                




<div class="column is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only has-order-3 column-right ">
    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Recent
        </h3>
        
        <article class="media">
            
            <a href="/2019/03/05/note-on-bip32/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Note on Bip32">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-03-05T05:54:32.000Z">2019-03-05</time></div>
                    <a href="/2019/03/05/note-on-bip32/" class="has-link-black-ter is-size-6">Note on Bip32</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/11/20/React-Hooks/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="React Hooks">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-11-20T09:41:39.000Z">2018-11-20</time></div>
                    <a href="/2018/11/20/React-Hooks/" class="has-link-black-ter is-size-6">React Hooks</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/11/11/5-tips-in-CRA-2-0/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="5 Tips in CRA@2.0">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-11-11T15:52:25.000Z">2018-11-11</time></div>
                    <a href="/2018/11/11/5-tips-in-CRA-2-0/" class="has-link-black-ter is-size-6">5 Tips in CRA@2.0</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/11/08/Assembly-in-Solidity/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Assembly in Solidity">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-11-08T03:30:30.000Z">2018-11-08</time></div>
                    <a href="/2018/11/08/Assembly-in-Solidity/" class="has-link-black-ter is-size-6">Assembly in Solidity</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2018/09/10/Analysis-of-Ujo/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Analysis of Ujo">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-09-10T05:26:39.000Z">2018-09-10</time></div>
                    <a href="/2018/09/10/Analysis-of-Ujo/" class="has-link-black-ter is-size-6">Analysis of Ujo</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>

    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Archives
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2019/03/">
                <span class="level-start">
                    <span class="level-item">March 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/11/">
                <span class="level-start">
                    <span class="level-item">November 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/09/">
                <span class="level-start">
                    <span class="level-item">September 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/08/">
                <span class="level-start">
                    <span class="level-item">August 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/07/">
                <span class="level-start">
                    <span class="level-item">July 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/05/">
                <span class="level-start">
                    <span class="level-item">May 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/04/">
                <span class="level-start">
                    <span class="level-item">April 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/03/">
                <span class="level-start">
                    <span class="level-item">March 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/02/">
                <span class="level-start">
                    <span class="level-item">February 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/01/">
                <span class="level-start">
                    <span class="level-item">January 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/12/">
                <span class="level-start">
                    <span class="level-item">December 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/11/">
                <span class="level-start">
                    <span class="level-item">November 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">12</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/10/">
                <span class="level-start">
                    <span class="level-item">October 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/09/">
                <span class="level-start">
                    <span class="level-item">September 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">18</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/08/">
                <span class="level-start">
                    <span class="level-item">August 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">31</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/07/">
                <span class="level-start">
                    <span class="level-item">July 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">19</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/06/">
                <span class="level-start">
                    <span class="level-item">June 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">14</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/05/">
                <span class="level-start">
                    <span class="level-item">May 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">15</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/04/">
                <span class="level-start">
                    <span class="level-item">April 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">9</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/03/">
                <span class="level-start">
                    <span class="level-item">March 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/02/">
                <span class="level-start">
                    <span class="level-item">February 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/01/">
                <span class="level-start">
                    <span class="level-item">January 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/12/">
                <span class="level-start">
                    <span class="level-item">December 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/11/">
                <span class="level-start">
                    <span class="level-item">November 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/10/">
                <span class="level-start">
                    <span class="level-item">October 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/09/">
                <span class="level-start">
                    <span class="level-item">September 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">16</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/08/">
                <span class="level-start">
                    <span class="level-item">August 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">30</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/07/">
                <span class="level-start">
                    <span class="level-item">July 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">43</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/06/">
                <span class="level-start">
                    <span class="level-item">June 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">25</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/05/">
                <span class="level-start">
                    <span class="level-item">May 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">24</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
    
    
</div>

            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/logo.png" alt="EzCook" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2019 Chen Yu&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a
                        href="http://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a>
                
                <br>
                <span id="busuanzi_container_site_uv">
                Visited by <span id="busuanzi_value_site_uv">0</span> users
                </span>
                
                </p>
            </div>
            <div class="level-end">
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("en");</script>


    
    
    
    <script src="/js/animation.js"></script>
    

    
    
    
    <script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
    <script src="/js/gallery.js" defer></script>
    

    
    

<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


    
    
<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>

    
    

<a id="back-to-top" title="Back to Top" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>


    
    

    
    
    
    
    
    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>
    <script src="/js/clipboard.js" defer></script>
    

    
    
    

    


<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>
</html>