<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Note on Bit32 | EzCook</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Note on Bit32</h1><a id="logo" href="/.">EzCook</a><p class="description">Code Elegantly</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Note on Bit32</h1><div class="post-meta">Mar 5, 2019</div><div class="post-content"><p><a href="https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki" target="_blank" rel="noopener">wiki</a></p>
<p>The specification consists of two parts:</p>
<ol>
<li><p>a system for deriving a tree of keypairs from a single seed.</p>
</li>
<li><p>demostrate how to build a wallet structure on top of such a tree.</p>
</li>
</ol>
<h1 id="Specification-Key-derivation"><a href="#Specification-Key-derivation" class="headerlink" title="Specification: Key derivation"></a>Specification: Key derivation</h1><h2 id="Convention"><a href="#Convention" class="headerlink" title="Convention"></a>Convention</h2><p>In this text we assume the public key cryptography used in Bitcoin, namely elliptic curve cryttography using the field and curve parameters defined by secp256k1. Variables below are either:</p>
<ul>
<li><p>Integers modulo the order of the curve (referred to as n)</p>
</li>
<li><p>Coordinates of points on the curve</p>
</li>
<li><p>Byte sequences</p>
</li>
</ul>
<p>Addition (+) of two coordinate pair is defined as application of the EC group operation. Concatenation(||) is the operation of appending one byte sequence onto another.</p>
<h2 id="Extended-Keys"><a href="#Extended-Keys" class="headerlink" title="Extended Keys"></a>Extended Keys</h2><p>We are going to define a function to derive a number of child keys from a parent key. In order to prevent these from depending solely on the key itself, we extend both private key and public key first with an extra 256 bits of entropy. This extention, called the <strong>chain code</strong>, is identical for corresponding private key and public keys, and consist of 256 bits, namely 32 bytes.</p>
<p>We represent an extended private key as <code>(k, c)</code>, with <code>k</code> the normal private key and the c, the <code>chain code</code>. And extended public key is represented as <code>(K, c)</code>, with <code>K = point(k)</code> and the c the chain code.</p>
<p>Each extended key has 2^31 <strong>normal child keys</strong>, and 2^31 <strong>hardened child keys</strong>. Each of these child keys has an index. The normal child keys use indices <code>0</code> through <code>2^31 - 1</code>.</p>
<p>The hardened child keys use indices <code>2^31 - 1</code> through <code>2^32 - 1</code>.</p>
<p>To ease notation for hardened key indices, a number i_H represents i + 2 ^ 31.</p>
<h2 id="Child-key-derivation-CKB-function"><a href="#Child-key-derivation-CKB-function" class="headerlink" title="Child key derivation (CKB) function"></a>Child key derivation (CKB) function</h2><p>Given a parent extended key and an index i, it is possible to compute the corresponding child extended key. The algorithm to do so depends on whether the child is a hardened key or not.</p>
<h3 id="Private-parent-key-gt-private-child-key"><a href="#Private-parent-key-gt-private-child-key" class="headerlink" title="Private parent key =&gt; private child key"></a>Private parent key =&gt; private child key</h3><p>The function CKDpriv((k_par, c_par), i) =&gt; (k_i, c_i) computes a child extended private key from the parent extended private key.</p>
<ul>
<li>Check whether i &gt;= 2^31(whether the child is a hardened key)<ul>
<li>if so (hardened child): return failure</li>
<li>if not (normal child), let I = HMAC-SHA512(Key = c_par, Data = ser_P(K_par)||ser_32(i))</li>
</ul>
</li>
<li>Split I into two 32-byte sequences, I_L, and I_R.</li>
<li>The returned child key k_i is parse_256(I_L) + k_par(mod n)</li>
<li>The returned chain code c_i is I_R</li>
</ul>
<h3 id="Private-parent-key-gt-public-child-key"><a href="#Private-parent-key-gt-public-child-key" class="headerlink" title="Private parent key =&gt; public child key"></a>Private parent key =&gt; public child key</h3><h3 id="Public-parent-key-gt-private-child-key"><a href="#Public-parent-key-gt-private-child-key" class="headerlink" title="Public parent key =&gt; private child key"></a>Public parent key =&gt; private child key</h3><p>This is not possible.</p>
<h2 id="The-key-tree"><a href="#The-key-tree" class="headerlink" title="The key tree"></a>The key tree</h2><p>The next step is cascading serveral CKD construction to build a tree. We start with one root, the master extended key m. By evaluating CKBpriv(m, i) for several values of i, we get a number of level-1 derived nodes. As each of these is again an extended key, CKDpriv can be applied to those as well.</p>
<p>To shorten notation, we will write <code>CKDpriv(CKDpriv(CKDpriv(m, 3_H), 2), 5)</code> as <code>m/3_H/2/5</code>. Equivalently for public keys, we write <code>CKDpub(CKDpub(CKDpub(M, 3), 2), 5)</code> as <code>M/3/2/5</code>. This results in the following identities:</p>
<ul>
<li>N(m/a/b/c) = N(m/a/b)/c = N(m/a)/b/b = N(m)/a/b/c = M/a/b/c</li>
<li>N(m/a_H/b/c) = N(m/a_H/b)/c = N(m/a_H)/b/c</li>
</ul>
<p>However, N(m/a_H) cannot be rewritten as N(m)/a_H, as the latter is not possible.</p>
<h2 id="Key-identifiers"><a href="#Key-identifiers" class="headerlink" title="Key identifiers"></a>Key identifiers</h2><p>Extended keys can be identified by the Hash160(RIPED160 after SHA256) of the serialized ECDSA public key K, ignoring the chain code. This corresponds exactly to the data used in traditional Bitcoin addresses. It is not advised to represent this data in base58 format though, as it may be interpreted as an address that way.</p>
<p>The first 32 bits of the identifier are called <code>key finterprint</code>.</p>
<h2 id="Serialization-format"><a href="#Serialization-format" class="headerlink" title="Serialization format"></a>Serialization format</h2><p>Extended public and private keys are serialized as follows:</p>
<ul>
<li>4 bytes: version bytes (mainnet: 0x0488B21E public, 0x0488ADE4 private; testnet: 0x043587CF public, 0x04358394 private)</li>
<li>1 byte: depth: 0x00 for master nodes, 0x01 for level-1 derived keys.</li>
<li>4 bytes: the fingerprint of the parent’s key (0x00000000 if master key)</li>
<li>4 bytes: child number, 0x00000000 if master key</li>
<li>32 bytes: the chain code</li>
<li>33 bytes: the public key or private key data</li>
</ul>
<p>The 78 bytes structure can be encoded like other Bitcoin data in Base58, by first adding 32 checksum bits(derived from the double SHA256 checksum), and then conventing to the Base58 representation.</p>
<h1 id="Master-key-generation"><a href="#Master-key-generation" class="headerlink" title="Master key generation"></a>Master key generation</h1><p>The total number of possible extended keypairs is almost 2^512, but the produced keys are only 256 bits long, and offer about half of that in terms of security. Therefore the master keys are not generated directly, but instead from a potentially short seed value.</p>
<ul>
<li>Generate a seed byte sequence S of a chosen length(between 128 and 512 bits, 256 bits is advised) from a (P)RNG.</li>
<li>Calculate I = HMAC-SHA512(Key = “Bitcoin seed”, Data = S)</li>
<li>Split I into two 32-byte sequence, I_L and I_R</li>
<li>Use parse_256(I_L) as master secret key and I_R as master chain code.</li>
</ul>
<p>In case I_L is 0 or &gt;= n, the master key is invalid.</p>
<p><img src="https://github.com/bitcoin/bips/raw/master/bip-0032/derivation.png" alt=""></p>
<h1 id="Specification-Wallet-Structure"><a href="#Specification-Wallet-Structure" class="headerlink" title="Specification: Wallet Structure"></a>Specification: Wallet Structure</h1><h2 id="The-default-wallet-layout"><a href="#The-default-wallet-layout" class="headerlink" title="The default wallet layout"></a>The default wallet layout</h2><p>An HD Wallet is organized as several ‘accounts’. Accounts are numbered, the default account (“”) being numbered 0. Clients are not required to support more than one account, if not, they only use the default account.</p>
<p>Each account is composed of two keypair chains: an internal and an external one. The external keychain is used to generate new public addresses, while the internal one is used for all other operations(change addresses, generate addresses, anything that doesn’t need to be communicated).</p>
</div><div class="tags"></div><div class="post-nav"><a class="next" href="/2018/11/20/React-Hooks/">React Hooks</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Soup/">Soup</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Uncategorized/">Uncategorized</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/github/">github</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/github/note/">note</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/note/">note</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/note/workNote/">workNote</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/workNote/">workNote</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/CSS3/" style="font-size: 15px;">CSS3</a> <a href="/tags/jQuery/" style="font-size: 15px;">jQuery</a> <a href="/tags/Trick/" style="font-size: 15px;">Trick</a> <a href="/tags/Bash/" style="font-size: 15px;">Bash</a> <a href="/tags/Material-Design/" style="font-size: 15px;">Material Design</a> <a href="/tags/GraphQL-Apollo-TypeScript/" style="font-size: 15px;">GraphQL, Apollo, TypeScript</a> <a href="/tags/Phoenix-Elixir-Ecto/" style="font-size: 15px;">Phoenix, Elixir, Ecto</a> <a href="/tags/Node-CLI/" style="font-size: 15px;">Node, CLI</a> <a href="/tags/Int8Array/" style="font-size: 15px;">Int8Array</a> <a href="/tags/ETH-Wallet/" style="font-size: 15px;">ETH, Wallet</a> <a href="/tags/Contract-Solidity/" style="font-size: 15px;">Contract, Solidity</a> <a href="/tags/Solidity/" style="font-size: 15px;">Solidity</a> <a href="/tags/Ruby-Rails-RoR-Mina/" style="font-size: 15px;">Ruby, Rails, RoR, Mina</a> <a href="/tags/Smart-Contract-Web3/" style="font-size: 15px;">Smart Contract, Web3</a> <a href="/tags/React-Docker/" style="font-size: 15px;">React, Docker</a> <a href="/tags/Solidity-Error-Handling/" style="font-size: 15px;">Solidity, Error Handling</a> <a href="/tags/Ethereum-IPFS/" style="font-size: 15px;">Ethereum, IPFS</a> <a href="/tags/Node-Fastify/" style="font-size: 15px;">Node, Fastify</a> <a href="/tags/Solidity-Public-External/" style="font-size: 15px;">Solidity, Public, External</a> <a href="/tags/Erlang-Elixir-GenServer/" style="font-size: 15px;">Erlang, Elixir, GenServer</a> <a href="/tags/Webpack/" style="font-size: 15px;">Webpack</a> <a href="/tags/Ethereum/" style="font-size: 15px;">Ethereum</a> <a href="/tags/Go-Http-Web/" style="font-size: 15px;">Go, Http, Web</a> <a href="/tags/HTTP2-Node/" style="font-size: 15px;">HTTP2, Node</a> <a href="/tags/JSON-RPC/" style="font-size: 15px;">JSON-RPC</a> <a href="/tags/Ruby-Rails/" style="font-size: 15px;">Ruby, Rails</a> <a href="/tags/Rust-Rocket/" style="font-size: 15px;">Rust, Rocket</a> <a href="/tags/DAPP-Solidity/" style="font-size: 15px;">DAPP, Solidity</a> <a href="/tags/D3-Example/" style="font-size: 15px;">D3, Example</a> <a href="/tags/Drizzle-Ethereum-BlockChain/" style="font-size: 15px;">Drizzle, Ethereum, BlockChain</a> <a href="/tags/Mock-JavaScript/" style="font-size: 15px;">Mock, JavaScript</a> <a href="/tags/Blockchain/" style="font-size: 15px;">Blockchain</a> <a href="/tags/DApp-Solidity/" style="font-size: 15px;">DApp, Solidity</a> <a href="/tags/Redux/" style="font-size: 15px;">Redux</a> <a href="/tags/Javascript/" style="font-size: 15px;">Javascript</a> <a href="/tags/babel/" style="font-size: 15px;">babel</a> <a href="/tags/babel-polyfill/" style="font-size: 15px;">babel-polyfill</a> <a href="/tags/RxJS/" style="font-size: 15px;">RxJS</a> <a href="/tags/BOOTSTRAP/" style="font-size: 15px;">BOOTSTRAP</a> <a href="/tags/HTML5/" style="font-size: 15px;">HTML5</a> <a href="/tags/commandline/" style="font-size: 15px;">commandline</a> <a href="/tags/shell/" style="font-size: 15px;">shell</a> <a href="/tags/webpack/" style="font-size: 15px;">webpack</a> <a href="/tags/CommonJS/" style="font-size: 15px;">CommonJS</a> <a href="/tags/Node-js/" style="font-size: 15px;">Node.js</a> <a href="/tags/React/" style="font-size: 15px;">React</a> <a href="/tags/ESLint/" style="font-size: 15px;">ESLint</a> <a href="/tags/React-Redux/" style="font-size: 15px;">React-Redux</a> <a href="/tags/DOM/" style="font-size: 15px;">DOM</a> <a href="/tags/NPM/" style="font-size: 15px;">NPM</a> <a href="/tags/CSS/" style="font-size: 15px;">CSS</a> <a href="/tags/Gulp/" style="font-size: 15px;">Gulp</a> <a href="/tags/Web/" style="font-size: 15px;">Web</a> <a href="/tags/github/" style="font-size: 15px;">github</a> <a href="/tags/ES6/" style="font-size: 15px;">ES6</a> <a href="/tags/Thunk/" style="font-size: 15px;">Thunk</a> <a href="/tags/测试/" style="font-size: 15px;">测试</a> <a href="/tags/Koa/" style="font-size: 15px;">Koa</a> <a href="/tags/NODE/" style="font-size: 15px;">NODE</a> <a href="/tags/webpack2/" style="font-size: 15px;">webpack2</a> <a href="/tags/Elixir-Phoenix-SCSS/" style="font-size: 15px;">Elixir, Phoenix, SCSS</a> <a href="/tags/FP/" style="font-size: 15px;">FP</a> <a href="/tags/Git/" style="font-size: 15px;">Git</a> <a href="/tags/Node-Graphql-Koa/" style="font-size: 15px;">Node, Graphql, Koa</a> <a href="/tags/Closure/" style="font-size: 15px;">Closure</a> <a href="/tags/DevTools/" style="font-size: 15px;">DevTools</a> <a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/Nginx/" style="font-size: 15px;">Nginx</a> <a href="/tags/MDL/" style="font-size: 15px;">MDL</a> <a href="/tags/precache/" style="font-size: 15px;">precache</a> <a href="/tags/Webpack-DLL/" style="font-size: 15px;">Webpack, DLL</a> <a href="/tags/Promise/" style="font-size: 15px;">Promise</a> <a href="/tags/React-Router-Code-splitting/" style="font-size: 15px;">React, Router, Code-splitting</a> <a href="/tags/React-Native/" style="font-size: 15px;">React-Native</a> <a href="/tags/React-Router/" style="font-size: 15px;">React-Router</a> <a href="/tags/RegExp/" style="font-size: 15px;">RegExp</a> <a href="/tags/Koa-NPM-Package/" style="font-size: 15px;">Koa, NPM, Package</a> <a href="/tags/Html-Picture/" style="font-size: 15px;">Html, Picture</a> <a href="/tags/Nock/" style="font-size: 15px;">Nock</a> <a href="/tags/Solidity-Smart-Contract/" style="font-size: 15px;">Solidity, Smart Contract</a> <a href="/tags/BlockChain/" style="font-size: 15px;">BlockChain</a> <a href="/tags/Contract-Ethereum-Web3/" style="font-size: 15px;">Contract, Ethereum, Web3</a> <a href="/tags/Protobuf/" style="font-size: 15px;">Protobuf</a> <a href="/tags/AJAX/" style="font-size: 15px;">AJAX</a> <a href="/tags/CORS/" style="font-size: 15px;">CORS</a> <a href="/tags/automatic/" style="font-size: 15px;">automatic</a> <a href="/tags/Immutable/" style="font-size: 15px;">Immutable</a> <a href="/tags/Pug-HTML/" style="font-size: 15px;">Pug, HTML</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/03/05/note-on-bit32/">Note on Bit32</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/20/React-Hooks/">React Hooks</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/11/5-tips-in-CRA-2-0/">5 Tips in CRA@2.0</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/08/Assembly-in-Solidity/">Assembly in Solidity</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/10/Analysis-of-Ujo/">Analysis of Ujo</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/27/development-of-neuron-web-extension/">Development of Neuron Web Extension</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/21/Details-in-Web3-Contract/">Details in Web3 -- Contract</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/11/Declaration-in-TypeScript/">Declaration in TypeScript</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/10/RxjsV6/">RxjsV6</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/17/content-parser-in-cita/">Content Parser in CITA</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Links</i></div><ul></ul><a href="https://github.com/Keith-CY" title="Github" target="_blank">Github</a><ul></ul><a href="https://www.linkedin.com/in/%E5%AE%87-%E9%99%88-644b61ba/" title="LinkedIn" target="_blank">LinkedIn</a><ul></ul><a href="https://www.facebook.com/keithwhisper" title="Facebook" target="_blank">Facebook</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">EzCook.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>