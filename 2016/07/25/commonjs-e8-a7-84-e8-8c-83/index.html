<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  
  <title>CommonJS 规范 | EzCook</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="概述CommonJS 是服务器端模块的规范, Node.js 采用了这个规范 根据 CommonJS 规范, 一个单独的文件就是一个模块 加载模块使用 require 方法, 该方法读取一个文件并执行, 最后返回文件内部的 exports 对象. // example.js  console.log(&amp;apos;evaluating example.js&amp;apos;);  var invisibl">
<meta name="keywords" content="Javascript,CommonJS,Node.js">
<meta property="og:type" content="article">
<meta property="og:title" content="CommonJS 规范">
<meta property="og:url" content="http://yoursite.com/2016/07/25/commonjs-e8-a7-84-e8-8c-83/index.html">
<meta property="og:site_name" content="EzCook">
<meta property="og:description" content="概述CommonJS 是服务器端模块的规范, Node.js 采用了这个规范 根据 CommonJS 规范, 一个单独的文件就是一个模块 加载模块使用 require 方法, 该方法读取一个文件并执行, 最后返回文件内部的 exports 对象. // example.js  console.log(&amp;apos;evaluating example.js&amp;apos;);  var invisibl">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2017-04-14T06:40:42.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CommonJS 规范">
<meta name="twitter:description" content="概述CommonJS 是服务器端模块的规范, Node.js 采用了这个规范 根据 CommonJS 规范, 一个单独的文件就是一个模块 加载模块使用 require 方法, 该方法读取一个文件并执行, 最后返回文件内部的 exports 对象. // example.js  console.log(&amp;apos;evaluating example.js&amp;apos;);  var invisibl">
  
    <link rel="alternate" href="/atom.xml" title="EzCook" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="/css/typing.css">
</head>

  
    
      <body class="dark">
    
  
      <div id="container" class="container">
        <article id="post-commonjs-e8-a7-84-e8-8c-83" class="article article-type-post" itemscope itemprop="blogPost">
  <header id="header" class="header">
  <nav id="main-nav" class="main-nav">
    
      <a class="main-nav-link" href="/">Home</a>
    
      <a class="main-nav-link" href="/archives">Archives</a>
    
      <a class="main-nav-link" href="/about">About</a>
    
  </nav>
  <nav id="sub-nav">
    
      <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
    
  </nav>
</header>

  <hr/>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      CommonJS 规范
    </h1>
  

      </header>
    
    <div class="article-entry typo" itemprop="articleBody">
      
        <p>概述<br>CommonJS 是服务器端模块的规范, Node.js 采用了这个规范</p>
<p>根据 CommonJS 规范, 一个单独的文件就是一个模块</p>
<p>加载模块使用 require 方法, 该方法读取一个文件并执行, 最后返回文件内部的 exports 对象.</p>
<pre><code>// example.js

console.log(&apos;evaluating example.js&apos;);

var invisible = function(){
  console.log(&apos;invisible&apos;);
}

exports.message = &apos;h1&apos;;

exports.say = function(){
  console.log(message)
}
`&lt;/pre&gt;

使用 require 方法, 加载 example.js 模块

&lt;pre&gt;`var example = require(&apos;./example.js&apos;);
`&lt;/pre&gt;

这时变量 example 就对应模块中 exports 对象, 可以通过这个对象应用模块中提供的各种方法.

&lt;pre&gt;`{
  message: &apos;h1&apos;,
  say: [Function]
}
`&lt;/pre&gt;

require 方法默认读取 js 文件, 所以可以省略 .js 扩展名

&lt;pre&gt;`var example = require(&apos;./example&apos;)
`&lt;/pre&gt;

js 文件名前需要加上路径, 可以是相对路径, 也可以是绝对路径. 如果省略路径, node.js 会认为添加一个核心模块, 或者已经安装在本地 node_modules 目录中的模块. 如果加载的是一个目录, node.js 会首先寻找该目录中的 package.json 文件, 加载该文件 main 属性指定的模块, 否则就寻找该目录下的 index.js 文件

定义一个最简单的模块

&lt;pre&gt;`exports.add = function(a,b){return a+b};
`&lt;/pre&gt;

//add.js
为 exports 对象添加一个 add 方法,

&lt;pre&gt;`var addition = require(&apos;./add&apos;);
addition.add(1,2); //3
`&lt;/pre&gt;

稍复杂的例子

&lt;pre&gt;`//foobar.js
function foobar(){
  this.foo = function(){
    console.log(&apos;hello foo&apos;)
  };

  this.bar = function(){
    console.log(&apos;hello bar&apos;)
  };
}
exports.foobar = foobar;
`&lt;/pre&gt;

调用

&lt;pre&gt;`var foobar = require(&apos;./foobar&apos;).foobar, test = new foobar();
test.bar(); //&apos;hello bar&apos;
`&lt;/pre&gt;

有时不需要 exports 返回一个对象, 而仅需要返回一个函数, 就写成 module.exports

&lt;pre&gt;`module.exports = function(){
  console.log(&apos;hello world&apos;)
}
`&lt;/pre&gt;

### AMD 规范与 CommonJS 规范的兼容性

CommonJS 规范加载模块是同步的, 也就是说, 只有加载完成, 才能执行后面的操作. AMD 规范则是非同步加载模块, 允许指定回调函数. 由于 Node.js 主要用于服务器编程, 模块文件一般都已经存在于本地硬盘, 所以加载起来比较快, 不需要考虑非同步加载的方式, 所以 CommonJS 的规范比较适用. 但是, 如果是浏览器环境, 要从服务器端加载模块, 这时就必须采用非同步模式, 因此浏览器端一般采用 AMD 规范.

AMD 规范适用 define 方法定义模块

&lt;pre&gt;`define([&apos;package/lib&apos;, function(lib){
  function foo(){
    lib.log(&apos;hello world!&apos;);
  }

  return {
    foo:foo
  };
}])
`&lt;/pre&gt;

AMD 规范允许输出的模块兼容 CommonJS 规范,在这时 define 方法需要写成如下格式

&lt;pre&gt;`define(function(require, exports, module)
  var someModule = require(&apos;someModule&apos;);
  var anotherModule = require(&apos;anotherModule&apos;);

  someModule.doTheAwesoem();
  anotherModule.doMoreAwesome();

  exports.asplode = function(){
    someModule.doTheAwesoem();
    anotherModule.doMoreAwesome();
  };
);
</code></pre>
      
    </div>
    <footer class="article-footer">
      <ul class="article-meta">
        <li>
          <span class="label">Published Date:</span>
          <a href="/2016/07/25/commonjs-e8-a7-84-e8-8c-83/" class="article-date">
  <time datetime="2016-07-24T21:08:26.000Z" itemprop="datePublished">2016-07-25</time>
</a>

        </li>
        
          <li>
            <span class="label">Category:</span>
            
  <div class="article-category">
    <a class="article-category-link" href="/categories/note/">note</a>
  </div>


          </li>
        
        
          <li>
            <span class="label">Tag:</span>
            
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CommonJS/">CommonJS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/">Javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Node-js/">Node.js</a></li></ul>


          </li>
        
        <hr/>
      </ul>
    </footer>
  </div>
  
    
<nav id="article-nav" class="article-nav">
  
    <a href="/2016/07/25/javascript-e6-8f-90-e9-ab-98-e6-80-a7-e8-83-bd/" id="article-nav-newer" class="article-nav-link-wrap newer">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          JavaScript 提高性能
        
      </div>
    </a>
  
  
    <a href="/2016/07/22/webpack-e5-bc-80-e5-8f-91-e5-92-8c-e9-83-a8-e7-bd-b2/" id="article-nav-older" class="article-nav-link-wrap older">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Webpack 开发和部署</div>
    </a>
  
</nav>


  
</article>




      </div>
      
    <footer id="footer" class="post-footer footer">
      <hr/>
      <div id="footerContent" class="footer-content">
        <p>Write for Archive</p>


      </div>
    </footer>

      

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/typing.js"></script>
<!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->







    </div>
  </body>
</html>
