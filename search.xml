<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title>Details in Web3 -- Contract</title>
      <link href="/2018/07/21/Details-in-Web3-Contract/"/>
      <content type="html"><![CDATA[<h1 id="Basic-Usage"><a href="#Basic-Usage" class="headerlink" title="Basic Usage"></a>Basic Usage</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// To initialize a contract</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Contract = <span class="built_in">require</span>(<span class="string">'web3-eth-contract'</span>)</span><br><span class="line">Contract.setProvider(<span class="string">'ws://localhost:8546'</span>)</span><br><span class="line"><span class="keyword">var</span> contract = <span class="keyword">new</span> Contract(abi, address, options)</span><br></pre></td></tr></table></figure><h1 id="Import"><a href="#Import" class="headerlink" title="Import"></a>Import</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _ = <span class="built_in">require</span>(<span class="string">'underscore'</span>)</span><br><span class="line"><span class="keyword">var</span> core = <span class="built_in">require</span>(<span class="string">'web3-core'</span>)</span><br><span class="line"><span class="keyword">var</span> Method = <span class="built_in">require</span>(<span class="string">'web3-core-method'</span>)</span><br><span class="line"><span class="keyword">var</span> utils = <span class="built_in">require</span>(<span class="string">'web3-utils'</span>)</span><br><span class="line"><span class="keyword">var</span> Subscription = <span class="built_in">require</span>(<span class="string">'web3-core-subscription'</span>).subscription</span><br><span class="line"><span class="keyword">var</span> formatters = <span class="built_in">require</span>(<span class="string">'web3-core-helpers'</span>).formatters</span><br><span class="line"><span class="keyword">var</span> errors = <span class="built_in">require</span>(<span class="string">'web3-core-helpers'</span>).errors</span><br><span class="line"><span class="keyword">var</span> promiEvent = <span class="built_in">require</span>(<span class="string">'web3-core-promievent'</span>)</span><br><span class="line"><span class="keyword">var</span> abi = <span class="built_in">require</span>(<span class="string">'web3-eth-abi'</span>)</span><br></pre></td></tr></table></figure><h1 id="Contract-Constructor"><a href="#Contract-Constructor" class="headerlink" title="Contract Constructor"></a>Contract Constructor</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Should be called to create new contract instance</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @method Contract</span></span><br><span class="line"><span class="comment"> * @constructor</span></span><br><span class="line"><span class="comment"> * @paramÂ &#123;Array&#125; jsonInterface</span></span><br><span class="line"><span class="comment"> * @param &#123;String&#125; address</span></span><br><span class="line"><span class="comment"> * @param &#123;Object&#125; options</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Contract = <span class="function"><span class="keyword">function</span> <span class="title">Contract</span>(<span class="params">jsonInterface, address, options</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> _this = <span class="keyword">this</span></span><br><span class="line">  <span class="keyword">var</span> args = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// check if the instance is initialized correctly</span></span><br><span class="line">  <span class="keyword">if</span> (!(<span class="keyword">this</span> <span class="keyword">instanceof</span> Contract)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(</span><br><span class="line">      <span class="string">'Please use the "new" keyword to instantiate a web3.eth.contract() object!'</span>,</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// sets _requestManager</span></span><br><span class="line">  core.packageInit(<span class="keyword">this</span>, [<span class="keyword">this</span>.constructor.currentProvider])</span><br><span class="line"></span><br><span class="line">  <span class="comment">// set clearSubscriptions</span></span><br><span class="line">  <span class="keyword">this</span>.clearSubscriptions = <span class="keyword">this</span>._requestManager.clearSubscriptions</span><br><span class="line">  <span class="comment">// check params jsonInterface</span></span><br><span class="line">  <span class="keyword">if</span> (!jsonInterface || !<span class="built_in">Array</span>.isArray(jsonInterface)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(</span><br><span class="line">      <span class="string">'You must provide the json interface of the contract when instantiating a contract object'</span>,</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// clear the options object</span></span><br><span class="line">  <span class="keyword">this</span>.options = &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> lastArg = args[args.length - <span class="number">1</span>]</span><br><span class="line">  <span class="comment">// set options</span></span><br><span class="line">  <span class="keyword">if</span> (_.isObject(lastArg) &amp;&amp; !_.isArray(lastArray)) &#123;</span><br><span class="line">    options = lastArgs</span><br><span class="line">    <span class="keyword">this</span>.options = _.extend(<span class="keyword">this</span>.options, <span class="keyword">this</span>._getOrSetDefaultOptions(options))</span><br><span class="line">    <span class="comment">// clear address if the fact is options, in this case the address is not passed in.</span></span><br><span class="line">    <span class="keyword">if</span> (_.isObject(address)) &#123;</span><br><span class="line">      address = <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// set address</span></span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(<span class="keyword">this</span>.options, <span class="string">'address'</span>, &#123;</span><br><span class="line">    set: <span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (value) &#123;</span><br><span class="line">        _this._address = utils.toChecksumAddress(</span><br><span class="line">          formatters.inputAddressFormatter(<span class="string">'value'</span>),</span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    get: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> _this._address</span><br><span class="line">    &#125;,</span><br><span class="line">    enumerable: <span class="literal">true</span>,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// add method and event signature when the jsonInterface gets set</span></span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(<span class="keyword">this</span>.options, <span class="string">'jsonInterface'</span>, &#123;</span><br><span class="line">    set: <span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">      _this.methods = &#123;&#125;</span><br><span class="line">      _this.events = &#123;&#125;</span><br><span class="line"></span><br><span class="line">      _this._jsonInterface = value.map(<span class="function"><span class="params">method</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> func, funcName</span><br><span class="line">        <span class="keyword">if</span> (method.name) &#123;</span><br><span class="line">          funcName = utils._jsonInterfaceMethodToString(method)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (method.type === <span class="string">'function'</span>) &#123;</span><br><span class="line">          method.signature = abi.encodeFunctionSignature(funcName)</span><br><span class="line">          func = _this._createTxObject.bind(&#123;</span><br><span class="line">            method: method,</span><br><span class="line">            parent: _this,</span><br><span class="line">          &#125;)</span><br><span class="line"></span><br><span class="line">          <span class="comment">// add method only if not one already exists</span></span><br><span class="line">          <span class="keyword">if</span> (!_this.methods[method.name]) &#123;</span><br><span class="line">            _this.methods[method.name] = func</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> cascadeFunc = _this._createTxObject.bind(&#123;</span><br><span class="line">              method: method,</span><br><span class="line">              parent: _this,</span><br><span class="line">              nextMethod: _this.methods[method.name],</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="keyword">this</span>.methods[method.name] = cascadeFunc</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="comment">// definitely add the method based on its signature</span></span><br><span class="line">          _this.methods[method.signature] = func</span><br><span class="line">          <span class="comment">//add method by name</span></span><br><span class="line">          _this.methods[method.name] = func</span><br><span class="line">          <span class="comment">// event</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.type === <span class="string">'event'</span>) &#123;</span><br><span class="line">          method.signature = abi.encodeEventSignature(funcName)</span><br><span class="line">          <span class="keyword">var</span> event = _this._on.bind(_this, method.signature)</span><br><span class="line"></span><br><span class="line">          <span class="comment">// add method only if not already exists</span></span><br><span class="line">          <span class="keyword">if</span> (</span><br><span class="line">            !_this.events[method.name] ||</span><br><span class="line">            _this.events[method.name].name === <span class="string">'bound'</span></span><br><span class="line">          ) &#123;</span><br><span class="line">            _this.events[method.name] = event</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// definitely add the method based on its signature</span></span><br><span class="line">          _this.events[method.signature] = event</span><br><span class="line"></span><br><span class="line">          <span class="comment">// add event by name</span></span><br><span class="line">          _this.events[funcName] = event</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> method</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// add allEvents</span></span><br><span class="line">      _this.events.allEvents = _this._on.bind(_this, <span class="string">'allevents'</span>)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> _this._jsonInterface</span><br><span class="line">    &#125;,</span><br><span class="line">    get: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> _this._jsonInterface</span><br><span class="line">    &#125;,</span><br><span class="line">    enumerable: <span class="literal">true</span>,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// get default account from the Class</span></span><br><span class="line">  <span class="keyword">var</span> defaultAccount = <span class="keyword">this</span>.constructor.defaultAccount</span><br><span class="line">  <span class="keyword">var</span> defaultBlock = <span class="keyword">this</span>.constructor.defaultBlock || <span class="string">'latest'</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(<span class="keyword">this</span>, <span class="string">'defaultAccount'</span>, &#123;</span><br><span class="line">    get: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> defaultAddress</span><br><span class="line">    &#125;,</span><br><span class="line">    set: <span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (value) &#123;</span><br><span class="line">        defaultAccount = utils.toChecksumAddress(</span><br><span class="line">          formatters.inputAddressFormatter(value),</span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> value</span><br><span class="line">    &#125;,</span><br><span class="line">    enumerable: <span class="literal">true</span>,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(<span class="keyword">this</span>, <span class="string">'defaultBlock'</span>, &#123;</span><br><span class="line">    get: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> defaultBlock</span><br><span class="line">    &#125;,</span><br><span class="line">    set: <span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">      defaultBlock = value</span><br><span class="line">      <span class="keyword">return</span> value</span><br><span class="line">    &#125;,</span><br><span class="line">    enumerable: <span class="literal">true</span>,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// properties</span></span><br><span class="line">  <span class="keyword">this</span>.methods = &#123;&#125;</span><br><span class="line">  <span class="keyword">this</span>.events = &#123;&#125;</span><br><span class="line">  <span class="keyword">this</span>._address = <span class="literal">null</span></span><br><span class="line">  <span class="keyword">this</span>._jsonInterface = []</span><br><span class="line"></span><br><span class="line">  <span class="comment">// set getter/setter properties</span></span><br><span class="line">  <span class="keyword">this</span>.options.address = address</span><br><span class="line">  <span class="keyword">this</span>.options.jsonInterface = jsonInterface</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Contract.setProvider = <span class="function"><span class="keyword">function</span>(<span class="params">provider, accounts</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Contract.currentProvider = provider</span></span><br><span class="line">  core.packageInit(<span class="keyword">this</span>, [provider])</span><br><span class="line">  <span class="keyword">this</span>._ethAccounts = accounts</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Get the callback and modify the array if necessary</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @method _getCallback</span></span><br><span class="line"><span class="comment"> * @param &#123;Array&#125; args</span></span><br><span class="line"><span class="comment"> * @return &#123;Function&#125; the callback</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Contract.prototype._getCallback = <span class="function"><span class="keyword">function</span> <span class="title">getCallback</span>(<span class="params">args</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (args &amp;&amp; _.isFunction(args[args.length - <span class="number">1</span>])) &#123;</span><br><span class="line">    <span class="keyword">return</span> args.pop() <span class="comment">// modify the args array!</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Checks that no listener with name 'newListener' or 'removeListener' is added</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @method _checkLister</span></span><br><span class="line"><span class="comment"> * @param &#123;String&#125; type</span></span><br><span class="line"><span class="comment"> * @param &#123;String&#125; event</span></span><br><span class="line"><span class="comment"> * @return &#123;Object&#125; the contract instance</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Contract.prototype._checkListerner = <span class="function"><span class="keyword">function</span>(<span class="params">type, event</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (event === type) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(</span><br><span class="line">      <span class="string">`The event <span class="subst">$&#123;type&#125;</span> is a reserved event name, you can't use it`</span>,</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Use default values, if options are not avaible</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @method _getOrSetDefaultOptions</span></span><br><span class="line"><span class="comment"> * @param &#123;Object&#125; options the options given by the user</span></span><br><span class="line"><span class="comment"> * @return &#123;Object&#125; the options with gaps filled by defaults</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Contract.prototype._getOrSetDefaultOptions = <span class="function"><span class="keyword">function</span> <span class="title">getOrSetDefaultOptions</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  options,</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> gasPrice = options.gasPrice ? <span class="built_in">String</span>(options.gasPrice)&#125; : <span class="literal">null</span></span><br><span class="line">  <span class="keyword">var</span> <span class="keyword">from</span> = options.from ? utils.toChecksumAddress(formatters.inputAddressFormatter(options.from)): <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">  options.data = option.data || <span class="keyword">this</span>.options.data</span><br><span class="line"></span><br><span class="line">  option.from = <span class="keyword">from</span> || <span class="keyword">this</span>.options.from</span><br><span class="line">  option.gasPrice = gasPrice || <span class="keyword">this</span>.options.gasPrice</span><br><span class="line">  options.gas = options.gas || options.gasLimit || <span class="keyword">this</span>.options.gas</span><br><span class="line"></span><br><span class="line">  <span class="keyword">delete</span> options.gasLimit</span><br><span class="line">  <span class="keyword">return</span> options</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span></span></span><br><span class="line"><span class="comment">// _encodeEventABI</span></span><br><span class="line"><span class="comment">// _decodeEventABI</span></span><br><span class="line"><span class="comment">// _encodeMethodABI</span></span><br><span class="line"><span class="comment">// _decodeMethodABI</span></span><br><span class="line"><span class="comment">// _decodeMethodReturn</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Deploys a contract and fire events based on its state: transactionHash, receipt</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * All event listeners will be removed, once the last possible event is fired ('error' or 'receipt')</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @method deploy</span></span><br><span class="line"><span class="comment"> * @param &#123;Object&#125; options</span></span><br><span class="line"><span class="comment"> * @param &#123;Function&#125; callback</span></span><br><span class="line"><span class="comment"> * @return &#123;Object&#125; EventEmitter possible are "error", "transactionHash", and "receipt"</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Contract.prototype.deploy = <span class="function"><span class="keyword">function</span>(<span class="params">options, callback</span>) </span>&#123;</span><br><span class="line">  options = options || &#123;&#125;</span><br><span class="line">  options.arguments = options.arguments || []</span><br><span class="line">  options = <span class="keyword">this</span>._getOrSetDefaultOptions(options)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// return error if no 'data' is specified</span></span><br><span class="line">  <span class="keyword">if</span> (!options.data) &#123;</span><br><span class="line">    <span class="keyword">return</span> utils._fireError(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'No "data" specifed in neither the given options, nor the default options'</span>), <span class="literal">null</span>, <span class="literal">null</span>, callback)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> <span class="keyword">constructor</span> = _.find(this.options.jsonInterface, function(method) &#123;</span><br><span class="line">    <span class="keyword">return</span> (method.type === <span class="string">'contructor'</span>)</span><br><span class="line">  &#125;) || &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>.signature = '<span class="keyword">constructor</span>'</span><br><span class="line"></span><br><span class="line">  return this._createTxObject.apply(&#123;</span><br><span class="line">    method: <span class="keyword">constructor</span>,</span><br><span class="line">    parent: this,</span><br><span class="line">    deployData: options.data,</span><br><span class="line">    _ethAccounts: this.<span class="keyword">constructor</span>._ethAccounts</span><br><span class="line">  &#125;, options.arguments)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// TODO:</span><br><span class="line">// _generateEventOptions</span><br><span class="line">// clone</span><br><span class="line">// once</span><br><span class="line">// _on</span><br><span class="line">// getPastEvents</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * returns the an object with call, send, estimate functions</span><br><span class="line"> *</span><br><span class="line"> * @method _createTxObject</span><br><span class="line"> * @return &#123;<span class="built_in">Object</span>&#125; an object <span class="keyword">with</span> functions to call the method</span><br><span class="line"> *<span class="regexp">/</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">Contract.prototype._createTxObject = function _createTxObject()&#123;</span></span><br><span class="line"><span class="regexp">  var args = Array.prototype.slice.call(arguments)</span></span><br><span class="line"><span class="regexp">  var txObject = &#123;&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  if (this.method.type === 'function') &#123;</span></span><br><span class="line"><span class="regexp">    txObject.call = this.parent._executeMethod.bind(txObject, 'call')</span></span><br><span class="line"><span class="regexp">    txObject.call.request = this.parent._executeMethod.bind(txObject, 'call', true) /</span><span class="regexp">/ to make batch request</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  txObject.send = this.parent._executeMethod.bind(txObject, 'send')</span></span><br><span class="line"><span class="regexp">  txObject.send.request = this.parent._executeMethod.bind(txObject)</span></span><br><span class="line"><span class="regexp">  txObject.encodeABI = this.parent._encodeMethodABI.bind(txObject)</span></span><br><span class="line"><span class="regexp">  txObject.estimateGas = this.parent._executeMethod.bind(txObject, 'estimate')</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ check arguments length</span></span><br><span class="line"><span class="regexp">  if (args &amp;&amp; this.method.inputs &amp;&amp; args.length !== this.method.inputs.length) &#123;</span></span><br><span class="line"><span class="regexp">    if (this.nextMethod) &#123;</span></span><br><span class="line"><span class="regexp">      return this.nextMethod.apply(null, args)</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">    throw errors.InvalidNumberOfParams(args.length, this.method.inputs.length, this.method.name)</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  txObject.arguments = args || []</span></span><br><span class="line"><span class="regexp">  txObject._method = this.method</span></span><br><span class="line"><span class="regexp">  txObject._parent = this.parent</span></span><br><span class="line"><span class="regexp">  txObject._ethAccounts = this.parent.constructor._ethAccounts || this._ethAccounts</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  if(this.deployData) &#123;</span></span><br><span class="line"><span class="regexp">    txObject._deployData = this.deployData</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  return txObject</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ _processExecuteArguments</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span>**</span><br><span class="line"> * Execute a call, transact or estimateGas on a contract <span class="function"><span class="keyword">function</span></span></span><br><span class="line"><span class="function"> *</span></span><br><span class="line"><span class="function"> * @<span class="title">method</span> <span class="title">_executeMethod</span></span></span><br><span class="line"><span class="function"> * @<span class="title">param</span> </span>&#123;<span class="built_in">String</span>&#125; type the type <span class="keyword">this</span> execute <span class="function"><span class="keyword">function</span> <span class="title">should</span> <span class="title">execute</span></span></span><br><span class="line"><span class="function"> * @<span class="title">param</span> </span>&#123;<span class="built_in">Boolean</span>&#125; makeRequest <span class="keyword">if</span> <span class="literal">true</span>, it simply returns the request parameters, rather than execute it.</span><br><span class="line"> *<span class="regexp">/</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">Contract.prototype._executeMethod = function _executeMethod () &#123;</span></span><br><span class="line"><span class="regexp">  var _this = this</span></span><br><span class="line"><span class="regexp">  var args = this._parent._processExecuteArguments.call(this, Array.prototype.slice.call(arguments))</span></span><br><span class="line"><span class="regexp">  var defer = promiEvent((args.type !== 'send))</span></span><br><span class="line"><span class="regexp">  var ethAccounts = _this.constructor._ethAccounts || _this._ethAccounts</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ simply return request for batch requests</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  if (args.generateRequest) &#123;</span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/ handle batch request</span></span><br><span class="line"><span class="regexp">    var payload = &#123;</span></span><br><span class="line"><span class="regexp">      params: [formatters.inputCallFormatter.call(this._parent, args.options)],</span></span><br><span class="line"><span class="regexp">      callback: args.callback,</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    if (args.type === 'call') &#123;</span></span><br><span class="line"><span class="regexp">      payload.params.push(formatters.inputDefaultBlockNumber.call(this._parent, args.defaultBlockNumber))</span></span><br><span class="line"><span class="regexp">      payload.method = 'eth_call'</span></span><br><span class="line"><span class="regexp">      payload.format = this._parent.decodeMethodReturn.bind(null, this._method.outputs)</span></span><br><span class="line"><span class="regexp">    &#125; else &#123;</span></span><br><span class="line"><span class="regexp">      payload.method = 'eth_sendTransaction'</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">    return payload</span></span><br><span class="line"><span class="regexp">  &#125; else &#123;</span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/ handle call or send</span></span><br><span class="line"><span class="regexp">    switch (args.type) &#123;</span></span><br><span class="line"><span class="regexp">      case 'estimate': &#123;</span></span><br><span class="line"><span class="regexp">        var estimateGas = (new Method(&#123;</span></span><br><span class="line"><span class="regexp">          name: 'estimateGas',</span></span><br><span class="line"><span class="regexp">          call: 'eth_estimateGas',</span></span><br><span class="line"><span class="regexp">          params: 1,</span></span><br><span class="line"><span class="regexp">          inputFormatter: [formatter.inputCallFormatter],</span></span><br><span class="line"><span class="regexp">          outputFormatter: utils.hexToNumber,</span></span><br><span class="line"><span class="regexp">          requestManager: _this._parent._requestManager,</span></span><br><span class="line"><span class="regexp">          accounts: ethAccounts, /</span><span class="regexp">/ specify accounts</span></span><br><span class="line"><span class="regexp">          defaultAccount: _this._parent.defaultAccount,</span></span><br><span class="line"><span class="regexp">          defaultBlock: _this._parent.defaultBlock,</span></span><br><span class="line"><span class="regexp">        &#125;)).createFunction();</span></span><br><span class="line"><span class="regexp">        return estimateGas(args.options, args.callback)</span></span><br><span class="line"><span class="regexp">      &#125;</span></span><br><span class="line"><span class="regexp">      case 'call': &#123;</span></span><br><span class="line"><span class="regexp">        var call = (new Method(&#123;</span></span><br><span class="line"><span class="regexp">           name: 'call',</span></span><br><span class="line"><span class="regexp">           call: 'eth_call',</span></span><br><span class="line"><span class="regexp">           params: 2,</span></span><br><span class="line"><span class="regexp">           inputFormatter: [formatters.inputCallFormatter, formatters.inputDefaultBlockNumberFormatter],</span></span><br><span class="line"><span class="regexp">           outputFormatter: result =&gt; &#123;</span></span><br><span class="line"><span class="regexp">             return _this._parent.decodeMethodReturn(_this._method.outputs, result)</span></span><br><span class="line"><span class="regexp">           &#125;,</span></span><br><span class="line"><span class="regexp">           requestManager: _this._parent._requestManager,</span></span><br><span class="line"><span class="regexp">           accounts: ethAccounts, /</span><span class="regexp">/ is eth.accounts (necessary for wallet signing)</span></span><br><span class="line"><span class="regexp">           defaultAccount: _this._parent.defaultAccount,</span></span><br><span class="line"><span class="regexp">           defaultBlock: _this._parent.defaultBlock,</span></span><br><span class="line"><span class="regexp">        &#125;)).createFunction()</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">        return call(args.options, args.defaultBlock, args.callback)</span></span><br><span class="line"><span class="regexp">      &#125;</span></span><br><span class="line"><span class="regexp">      case 'send': &#123;</span></span><br><span class="line"><span class="regexp">        if(!utils.isAddress(args.options.from)) &#123;</span></span><br><span class="line"><span class="regexp">            return utils._fireError(new Error('No "from" address specified in neither the given options, nor the default options.'), defer.eventEmitter, defer.reject, args.callback);</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">        if (_.isBoolean(this._method.payable) &amp;&amp; !this._method.payable &amp;&amp; args.options.value &amp;&amp; args.options.value &gt; 0) &#123;</span></span><br><span class="line"><span class="regexp">            return utils._fireError(new Error('Can not send value to non-payable contract method or constructor'), defer.eventEmitter, defer.reject, args.callback);</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">        /</span><span class="regexp">/ make sure receipt logs are decoded</span></span><br><span class="line"><span class="regexp">        var extraFormatters = &#123;</span></span><br><span class="line"><span class="regexp">          receiptFormatter: receipt =&gt; &#123;</span></span><br><span class="line"><span class="regexp">            if (_.isArray(receipt.logs)) &#123;</span></span><br><span class="line"><span class="regexp">              /</span><span class="regexp">/ decode logs</span></span><br><span class="line"><span class="regexp">              var events = _.map(receipt.logs, log =&gt; &#123;</span></span><br><span class="line"><span class="regexp">                return _this._parent._decodeEventABI.call(&#123;</span></span><br><span class="line"><span class="regexp">                  name: 'ALLEVENT',</span></span><br><span class="line"><span class="regexp">                  jsonInterface: _this._parent.options.jsonInterface,</span></span><br><span class="line"><span class="regexp">                &#125;, log)</span></span><br><span class="line"><span class="regexp">              &#125;)</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">              /</span><span class="regexp">/ make sure log names keys</span></span><br><span class="line"><span class="regexp">              receipt.events = &#123;&#125;</span></span><br><span class="line"><span class="regexp">              var count = 0</span></span><br><span class="line"><span class="regexp">              events.forEach(ev =&gt; &#123;</span></span><br><span class="line"><span class="regexp">                if (ev.event) &#123;</span></span><br><span class="line"><span class="regexp">                  /</span><span class="regexp">/ if &gt; 1 of the same event, don't overwrite any existing events</span></span><br><span class="line"><span class="regexp">                  if (receipt.events[ev.event]) &#123;</span></span><br><span class="line"><span class="regexp">                    if (Array.isArray(receipt.events[ev.event])) &#123;</span></span><br><span class="line"><span class="regexp">                      receipt.events[ev.event].push(ev)</span></span><br><span class="line"><span class="regexp">                    &#125; else &#123;</span></span><br><span class="line"><span class="regexp">                      receipt.events[ev.event] = [receipt.events[ev.event], ev]</span></span><br><span class="line"><span class="regexp">                    &#125;</span></span><br><span class="line"><span class="regexp">                  &#125; else &#123;</span></span><br><span class="line"><span class="regexp">                    receipt.event[ev.event] = ev</span></span><br><span class="line"><span class="regexp">                  &#125;</span></span><br><span class="line"><span class="regexp">                &#125; else &#123;</span></span><br><span class="line"><span class="regexp">                  receipt.events[count] = ev</span></span><br><span class="line"><span class="regexp">                  count++</span></span><br><span class="line"><span class="regexp">                &#125;</span></span><br><span class="line"><span class="regexp">              &#125;)</span></span><br><span class="line"><span class="regexp">              delete receipt.logs</span></span><br><span class="line"><span class="regexp">            &#125;</span></span><br><span class="line"><span class="regexp">            return receipt</span></span><br><span class="line"><span class="regexp">          &#125;,</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">          contractDeployFormatter: receipt =&gt; &#123;</span></span><br><span class="line"><span class="regexp">            var newContract = _this._parent.clone()</span></span><br><span class="line"><span class="regexp">            newContract.options.address = receipt.contractAddress</span></span><br><span class="line"><span class="regexp">            return newContract</span></span><br><span class="line"><span class="regexp">          &#125;</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">        var sendTransaction = (new Method(&#123;</span></span><br><span class="line"><span class="regexp">          name: 'sendTransaction',</span></span><br><span class="line"><span class="regexp">          call: 'eth_sendTransaction',</span></span><br><span class="line"><span class="regexp">          params: 1,</span></span><br><span class="line"><span class="regexp">          inputFormatter: [formatters.inputTransactionFormatter],</span></span><br><span class="line"><span class="regexp">          requestManager: _this._parent.requestManager,</span></span><br><span class="line"><span class="regexp">          accounts: _this.constructor._ethAccount || _this._ethAccounts, /</span><span class="regexp">/ is eth.accounts,</span></span><br><span class="line"><span class="regexp">          defaultAccount: _this._parent.defaultAccount,</span></span><br><span class="line"><span class="regexp">          defaultBlock: _this._parent.defaultBlock,</span></span><br><span class="line"><span class="regexp">          extraFormatter: extraFormatters,</span></span><br><span class="line"><span class="regexp">        &#125;)).createFunction()</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">        return sendTransaction(args.options, args.callback)</span></span><br><span class="line"><span class="regexp">      &#125;</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> Contract, Ethereum, Web3 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Declaration in TypeScript</title>
      <link href="/2018/07/11/Declaration-in-TypeScript/"/>
      <content type="html"><![CDATA[]]></content>
      
      
    </entry>
    
    <entry>
      <title>RxjsV6</title>
      <link href="/2018/07/10/RxjsV6/"/>
      <content type="html"><![CDATA[]]></content>
      
      
    </entry>
    
    <entry>
      <title>Content Parser in CITA</title>
      <link href="/2018/05/17/content-parser-in-cita/"/>
      <content type="html"><![CDATA[<p>The parse now we used is</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> parser = <span class="function">(<span class="params">content: string</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> bytes = hexToBytes(content)</span><br><span class="line">  <span class="keyword">const</span> decoded = pb.UnverifiedTransaction.deserializeBinary(bytes)</span><br><span class="line">  <span class="keyword">const</span> tx = decoded.getTransaction()</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="keyword">from</span>: tx.getFrom ? tx.getFrom() : <span class="string">''</span>,</span><br><span class="line">    to: tx.getTo ? tx.getTo() : <span class="string">''</span>,</span><br><span class="line">    data: tx.getData ? tx.getData() : <span class="string">''</span>,</span><br><span class="line">    value: tx.getValue ? tx.getValue().toString() : <span class="string">''</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Here we use these methods:</p><ul><li><p>hexToBytes(content) =&gt; bytes</p></li><li><p>pb.UnverifiesTransaction.deserializeBinary(bytes) =&gt; decoded</p></li><li><p>decoded.getTransaction() =&gt; transaction</p></li><li><p>transaction.{getFrom, getTo, getValue, getData}</p></li></ul><h5 id="hexToBytes"><a href="#hexToBytes" class="headerlink" title="hexToBytes"></a>hexToBytes</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> hexToBytes = <span class="function">(<span class="params">hex: string</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> _hex = hex.startsWith(<span class="string">'0x'</span>) ? hex.slice(<span class="number">2</span>) : hex <span class="comment">// remove 0x prefix</span></span><br><span class="line">  <span class="keyword">let</span> result = []</span><br><span class="line">  <span class="keyword">while</span> (_hex.length &gt;= <span class="number">2</span>) &#123;</span><br><span class="line">    result.push(<span class="built_in">parseInt</span>(_hex.substring(<span class="number">0</span>, <span class="number">2</span>), <span class="number">16</span>)) <span class="comment">// parse hex to bytes(int8 array)</span></span><br><span class="line">    _hex = _hex.substring(<span class="number">2</span>, _hex.length)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="pb-UnverifiedTransaction-deserializeBinary"><a href="#pb-UnverifiedTransaction-deserializeBinary" class="headerlink" title="pb.UnverifiedTransaction.deserializeBinary"></a>pb.UnverifiedTransaction.deserializeBinary</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> jspb = <span class="built_in">require</span>(<span class="string">'google-protobuf'</span>)</span><br><span class="line"><span class="keyword">const</span> goog = jspb</span><br><span class="line"></span><br><span class="line">proto.UnverifiedTransaction = <span class="function"><span class="params">opt_data</span> =&gt;</span> &#123;</span><br><span class="line">  jspb.Message.initialize(<span class="keyword">this</span>, opt_data, <span class="number">0</span>, <span class="number">-1</span>, <span class="literal">null</span>, <span class="literal">null</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">proto.UnverifiedTransaction.deserializeBinaryFromReader = <span class="function">(<span class="params">msg, reader</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">while</span> (reader.nextField()) &#123;</span><br><span class="line">    <span class="keyword">if</span> (reader.isEndGroup()) &#123;</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> field = reader.getFieldNumber()</span><br><span class="line">    <span class="keyword">switch</span> (field) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>: &#123;</span><br><span class="line">        <span class="keyword">let</span> value = <span class="keyword">new</span> proto.Transaction()</span><br><span class="line">        reader.readMessage(value.proto.Transaction.deserializeBinaryFromReader)</span><br><span class="line">        msg.setTransaction(value)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>: &#123;</span><br><span class="line">        <span class="keyword">let</span> value = <span class="comment">/** @type &#123;!Uint8Array&#125; */</span> (reader.readBytes())</span><br><span class="line">        msg.setSignature(value)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>: &#123;</span><br><span class="line">        <span class="keyword">let</span> value = <span class="comment">/** @type &#123;!proto.Crypto&#125; */</span> (reader.readEnum())</span><br><span class="line">        msg.setCrypto(value)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">default</span>: &#123;</span><br><span class="line">        reader.skipField()</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> msg</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">proto.UnverifiedTransaction.deserializeBinary = <span class="function"><span class="params">bytes</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> reader = <span class="keyword">new</span> jspb.BinaryReader(bytes)</span><br><span class="line">  <span class="keyword">const</span> msg = <span class="keyword">new</span> proto.UnverifiedTransaction()</span><br><span class="line">  <span class="keyword">return</span> proto.UnverifiedTransaction.deserializeBinaryFromReader(msg, reader)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>GenServer in Erlang</title>
      <link href="/2018/05/16/GenServer-in-Erlang/"/>
      <content type="html"><![CDATA[<p><a href="https://medium.com/learn-elixir/genserver-explained-in-5-minutes-ae5823af4d44" target="_blank" rel="noopener">Original</a></p><p><code>GenServer</code> is essential part of OTP, which simplifies repeating tasks, letting programmer concentrate on logic of the application, and not on handling edge cases and repeated error handling.</p><p><img src="https://cdn-images-1.medium.com/max/800/1*TpSDUSS0z3lgrUg1uEOUZg.gif" alt="Every Time When GenServer callback is called"></p><p>The idea behind <code>GenServer</code> is simple - you start separate process, that holds some state, then on each incoming message(be that <code>call</code> or <code>cast</code>) it may change it internal state and also generate some response(in case of <code>call</code>)</p><p>In this manual <code>calling process</code> is named <code>Alice</code> and newly process is <code>Bob</code>.</p><h5 id="Programming-without-GenServer-as-you-would-done-it-manually"><a href="#Programming-without-GenServer-as-you-would-done-it-manually" class="headerlink" title="Programming without GenServer, as you would done it manually"></a>Programming without GenServer, as you would done it manually</h5><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">SimpleGenServerMock</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">start_link</span></span>() <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># runs in the *caller* context `Alice`</span></span><br><span class="line">    spawn_link(__MODULE_<span class="number">_</span>, <span class="symbol">:init</span>, [])</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">call</span></span>(pid, arguments) <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># runs in the *caller* context `Alice`</span></span><br><span class="line">    send pid, &#123;<span class="symbol">:call</span>, <span class="keyword">self</span>(), arguments&#125;</span><br><span class="line">    receive</span><br><span class="line">      &#123;<span class="symbol">:response</span>, data&#125; -&gt; data</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">cast</span></span>(pid, arguments) <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># runs in `caller` context `Alice`</span></span><br><span class="line">    send pid, &#123;<span class="symbol">:cast</span>, arguments&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">init</span></span>() <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># runs in the *server* context `Bob`</span></span><br><span class="line">    initial_state = <span class="number">1</span></span><br><span class="line">    loop(initial_state)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">loop</span></span>(state) <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># runs in the *server* context `Bob`</span></span><br><span class="line"></span><br><span class="line">    receive command <span class="keyword">do</span></span><br><span class="line">      &#123;<span class="symbol">:call</span>, pid, <span class="symbol">:get_data</span>&#125; -&gt;</span><br><span class="line">        <span class="comment"># do some work on data here and update state</span></span><br><span class="line">        &#123;new_state, data&#125; = &#123;state, state&#125;</span><br><span class="line">        send pid, &#123;<span class="symbol">:response</span>, data&#125;</span><br><span class="line">        loop(new_state)</span><br><span class="line">      &#123;<span class="symbol">:cast</span>, <span class="symbol">:increment</span>&#125; -&gt;</span><br><span class="line">        <span class="comment"># do some work on data here and update state</span></span><br><span class="line">        new_state = state + <span class="number">1</span></span><br><span class="line">        loop(new_state)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>Code <code>initial_state = 1</code> is exactly same code we write in <code>init</code> callback. Internal state of the server is simply an integer. Usually it is a map, tuple or list with settings and state.</p><p><code>{state, state}</code> means that we do not want to update the state and want to return state as result. This is the code which goes in <code>handle_call</code> callback in <code>Bob</code>.</p><p>And code <code>new_state = state + 1</code> is the code which goes into <code>handle_cast</code> callback, because we do not need to respond with result, we just change server <code>Bob</code> internal state.</p><p>Working with module will look like:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pid = SimpleGenServerMock.start_link()</span><br><span class="line">counter = SimpleGenServerMock.call(pid, :get_data)</span><br><span class="line">IO.puts <span class="string">"Counter: #&#123;counter&#125;"</span></span><br><span class="line">SimpleGenServerMock.cast(pid, :increment)</span><br><span class="line">counter = SimpleGenServerMock.call(pid, :get_data)</span><br><span class="line">IO.puts <span class="string">"Counter: #&#123;counter&#125;"</span></span><br></pre></td></tr></table></figure><h5 id="Same-Server-With-GenServer-Behaviour"><a href="#Same-Server-With-GenServer-Behaviour" class="headerlink" title="Same Server With GenServer Behaviour"></a>Same Server With GenServer Behaviour</h5><p>Now if we want to re-write same code using <code>GenServer</code> it will look like this:</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">SimpleGenServerBehaviour</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">use</span> GenServer</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">start_link</span></span>() <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># runs in the *caller* context `Alice`</span></span><br><span class="line">    GenServer.start_link(__MODULE_<span class="number">_</span>, [])</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">init</span></span>(<span class="number">_</span>) <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># runs in the *server* context `Bob`</span></span><br><span class="line">    &#123;<span class="symbol">:ok</span>, <span class="number">1</span>&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">handle_call</span></span>(<span class="symbol">:get_data</span>, _from, state) <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># runs in the *server* context `Bob`</span></span><br><span class="line">    &#123;<span class="symbol">:reply</span>, state, state&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">handle_cast</span></span>(<span class="symbol">:increment</span>, state) <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># runs in the *server* context `Bob`</span></span><br><span class="line">    &#123;<span class="symbol">:noreply</span>, state + <span class="number">1</span>&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>While in this example it did not saved a lot of lines for more complicated code having <code>GenServer</code> deal with all complexity saves a lot of tying. Also you got timeout, named processes and stable, production proven error hanlding for free.</p><p>Using GenServer behaviour is very similar to code we wrote before:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;:ok, pid&#125; = GenServer.start_link(SimpleGenServerBehaviour, [])</span><br><span class="line">counter = GenServer.call(SimpleGenServerBehaviour, :get_data)</span><br><span class="line">GenServer.cast(SimpleGenServerBehaviour, :increment)</span><br></pre></td></tr></table></figure><p>Better to implement start in the module</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">Stack</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">use</span> GenServer</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">start_link</span></span>(defaut) <span class="keyword">do</span></span><br><span class="line">    GenServer.start_link(default)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">push</span></span>(pid, item) <span class="keyword">do</span></span><br><span class="line">    GenServer.cast(pid, &#123;<span class="symbol">:push</span>, item&#125;)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">pop</span></span>(pid) <span class="keyword">do</span></span><br><span class="line">    GenServer.call(pid, <span class="symbol">:pop</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Server callbacks</span></span><br><span class="line"></span><br><span class="line">  <span class="variable">@impl</span> ture</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">handle_call</span></span>(<span class="symbol">:pop</span>, _from, [h | t]) <span class="keyword">do</span></span><br><span class="line">    &#123;<span class="symbol">:reply</span>, h, t&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="variable">@impl</span> <span class="keyword">true</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">handle_cast</span></span>(&#123;<span class="symbol">:push</span>, item&#125;, state) <span class="keyword">do</span></span><br><span class="line">    &#123;<span class="symbol">:noreply</span>, [item | state]&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h5 id="Receiving-Regular-Messages"><a href="#Receiving-Regular-Messages" class="headerlink" title="Receiving Regular Messages"></a>Receiving Regular Messages</h5><p>The goal of <code>GenServer</code> is to abstract the âreceiveâ loop for developers, automatically handling system messages, support code changes, synchronous calls and more. Therefore, you should never call your own ârecieveâ inside the GenServer callbacks as doing will cause the GenServer misbehave.</p><p>Besides the synchronous and asynchronous communication provided by <code>call/3</code> and <code>cast/2</code>, regular messages sent by functions such as <code>Kernal/send2</code>, <code>Process.send_after/4</code> and similar, can be handled inside the <code>handle_info/2</code> callback.</p><p><code>handle_info/2</code> can be used in many sinutations, such as handling monitor DOWN messages sent by <code>Process.monitor/1</code>. Another use case for <code>handle_info/2</code> is to perform periodic work, with the help of <code>Process.send_after/4</code>:</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">MyApp</span></span>.Periodically <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">use</span> GenServer</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">start_link</span></span> <span class="keyword">do</span></span><br><span class="line">    GenServer.start_link(__MODULE_<span class="number">_</span>, %&#123;&#125;)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="variable">@impl</span> <span class="keyword">true</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">init</span></span>(state) <span class="keyword">do</span></span><br><span class="line">    schedule_work() <span class="comment"># Schedule work to be performed on start</span></span><br><span class="line">    &#123;<span class="symbol">:ok</span>, state&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="variable">@impl</span> <span class="keyword">true</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">handle_info</span></span>(<span class="symbol">:work</span>, state) <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># Do the desired work here</span></span><br><span class="line">    schedule_work() <span class="comment"># Reschedule once more</span></span><br><span class="line">    &#123;<span class="symbol">:noreply</span>, state&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">schedule_work</span></span>() <span class="keyword">do</span></span><br><span class="line">    Process.send_after(<span class="keyword">self</span>(), <span class="symbol">:work</span>, <span class="number">1000</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> Erlang, Elixir, GenServer </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Association in Phoenix</title>
      <link href="/2018/05/15/Association-in-Phoenix/"/>
      <content type="html"><![CDATA[<p><a href="http://blog.plataformatec.com.br/2015/08/working-with-ecto-associations-and-embeds/" target="_blank" rel="noopener">Original</a></p><h3 id="Associations"><a href="#Associations" class="headerlink" title="Associations"></a>Associations</h3><p>Associations in Ecto are used when two difference sources(tables) are linked via foreign keys.</p><p>A classic example of this setup is âPost has many commentsâ. First create the two tables in migrations</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">create table(<span class="symbol">:posts</span>) <span class="keyword">do</span></span><br><span class="line">  add <span class="symbol">:title</span>, <span class="symbol">:string</span></span><br><span class="line">  add <span class="symbol">:body</span>, <span class="symbol">:text</span></span><br><span class="line"></span><br><span class="line">  timestamps()</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">create table(<span class="symbol">:comments</span>) <span class="keyword">do</span></span><br><span class="line">  add <span class="symbol">:post_id</span>, references(<span class="symbol">:posts</span>)</span><br><span class="line">  add <span class="symbol">:body</span>, <span class="symbol">:text</span></span><br><span class="line"></span><br><span class="line">  timestamps()</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>Each comment contains a <code>post_id</code> column that by default points to a post <code>id</code></p><p>And now defined the schemas</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">MyApp</span></span>.Post <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">use</span> Ecto.Schema</span><br><span class="line"></span><br><span class="line">  schema <span class="string">"posts"</span> <span class="keyword">do</span></span><br><span class="line">    field <span class="symbol">:title</span></span><br><span class="line">    field <span class="symbol">:body</span></span><br><span class="line">    has_many <span class="symbol">:comments</span>, MyApp.Comment</span><br><span class="line">    timestamps</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">MyApp</span></span>.Comment <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">use</span> Ecto.Schema</span><br><span class="line"></span><br><span class="line">  schema <span class="string">"comments"</span> <span class="keyword">do</span></span><br><span class="line">    field <span class="symbol">:body</span></span><br><span class="line">    belongs_to <span class="symbol">:post</span>, MyApp.Post</span><br><span class="line">    timestamps</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h3 id="Querying-associations"><a href="#Querying-associations" class="headerlink" title="Querying associations"></a>Querying associations</h3><p>One of the benefits of defining associations is taht they can be used in queries. For example:</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Repo.all from p <span class="keyword">in</span> Post, <span class="symbol">preload:</span> [<span class="symbol">:comments</span>]</span><br></pre></td></tr></table></figure><p>Now all posts will be fetched from the database with their associated comments. The example above will perform two queries: one for loading all posts and another for loading all comments. This is often the most efficient way of loading associations from the database(even if two queries are performed) because we need to receive and parse only POSTS + COMMENTS results.</p><p>It is also possible to preload associations using joins while performing more complex queries. For example, imagine both posts and comments have votes and you want only comments with more votes than the post itself:</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Repo.all from p <span class="keyword">in</span> Post,</span><br><span class="line">      <span class="symbol">join:</span> c <span class="keyword">in</span> assoc(p, <span class="symbol">:comments</span>),</span><br><span class="line">      <span class="symbol">where:</span> c.votes &gt; p.votes</span><br><span class="line">      <span class="symbol">preload:</span> [<span class="symbol">comments:</span> c]</span><br></pre></td></tr></table></figure><h3 id="Manipulating-associations"><a href="#Manipulating-associations" class="headerlink" title="Manipulating associations"></a>Manipulating associations</h3><p>While Ecto 2.0 allows you insert a post with multiple comments in one operation:</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Repo.insert!(%Post&#123;</span><br><span class="line">  <span class="symbol">title:</span> <span class="string">"Hello"</span>,</span><br><span class="line">  <span class="symbol">body:</span> <span class="string">"world"</span>,</span><br><span class="line">  <span class="symbol">comments:</span> [</span><br><span class="line">    %Comment&#123;<span class="symbol">body:</span> <span class="string">"Excellent"</span>&#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Many times you may want to break it into distinct steps so you have more flexibility in managing those entries. For example, you could use changesets to build your posts and comments along the way</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">post = Ecto.Changeset.change(%Post&#123;&#125;, <span class="symbol">title:</span> <span class="string">"Hello"</span>, <span class="symbol">body:</span> <span class="string">"World"</span>)</span><br><span class="line">comment = Ecto.Changeset.change(%Comment&#123;&#125;, <span class="symbol">body:</span> <span class="string">"Excellent"</span>)</span><br><span class="line">post_with_comments = Ecto.Changeset.put_assoc(post, <span class="symbol">:comments</span>, [comment]) <span class="comment"># Main Step</span></span><br><span class="line">Repo.insert!(post_with_comments)</span><br></pre></td></tr></table></figure><p>Or by handling each entry individually inside a transation:</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Repo.transaction <span class="keyword">fn</span> -&gt;</span><br><span class="line">  post = Repo.insert!(%Post&#123;<span class="symbol">title:</span> <span class="string">"Hello"</span>, <span class="symbol">body:</span> <span class="string">"World"</span>&#125;)</span><br><span class="line">  <span class="comment"># Build a comment from the post struct</span></span><br><span class="line">  comment = Ecto.build_assoc(post, <span class="symbol">:comments</span>, <span class="symbol">body:</span> <span class="string">"Execellent"</span>)</span><br><span class="line">  Repo.insert!(comment)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p><code>Ecto.build_assoc/3</code> builds the comment using the id currently set in the post struct. It is equivalnet to:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%Comment&#123;post_id: post.id, body: &quot;Execellent&quot;&#125;</span><br></pre></td></tr></table></figure><p>The Ecto.build_assoc/3 function is specially useful in Phoenix controllers. For example when creating the post, one would do:</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Ecto.build_assoc(current_user, <span class="symbol">:post</span>)</span><br></pre></td></tr></table></figure><p>As we likely want to associate the post to the user currently signed in the application. In another controller, we could build a comment for an existing post with:</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Ecto.build_assoc(post, <span class="symbol">:comments</span>)</span><br></pre></td></tr></table></figure><p>Ecto does not provide functions like <code>post.comments &lt;&lt; comment</code> that allows mixing persisted data with non-persisted data. The only macha</p>]]></content>
      
      
        <tags>
            
            <tag> Phoenix, Elixir, Ecto </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Difference Bwtween Build_assoc, Put_assoc, and Cast_assoc</title>
      <link href="/2018/05/15/cast-assoc/"/>
      <content type="html"><![CDATA[<h3 id="Cast-Assoc-code"><a href="#Cast-Assoc-code" class="headerlink" title="Cast Assoc code"></a>Cast Assoc <a href="https://github.com/elixir-ecto/ecto/blob/v2.2.10/lib/ecto/changeset.ex#L659" target="_blank" rel="noopener">code</a></h3><blockquote><p>cast_assoc(changeset, name, opts \ [])</p></blockquote><p>Casts the given association with the <code>changeset params</code></p><p>This function should be used when working withe the entire association at once(and not a single element of a many-style association) and using data external to the application.</p><p>When updating the data, this function requires the association to have been preloaded in the changeset struct. Missing data will invoke the <code>:on_replace</code> behaviour defined on the association. Preloading is not necessary for newly built structs.</p><p>The parameters for the given association will be retrieved from <code>changeset.params</code>. Those parameters are expected to be a map with attributes, similar to the ones passed to <code>cast/4</code>. Once parameter are retrieved, <code>cast_assoc/3</code> will match those parameters with the associations already in the changeset record</p><p>For example, imagine a user has many addresses relationship where post data is sent as follow</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">%&#123;<span class="string">"name"</span> =&gt; <span class="string">"John Doe"</span>, <span class="string">"addresses"</span> =&gt; [</span><br><span class="line">  %&#123;<span class="string">"street"</span> =&gt; <span class="string">"Some where"</span>, <span class="string">"country"</span> =&gt; <span class="string">"Brzil"</span>, <span class="string">"id"</span> =&gt; 1&#125;,</span><br><span class="line">  %&#123;<span class="string">"street"</span> =&gt; <span class="string">"Else where"</span>, <span class="string">"country"</span> =&gt; <span class="string">"Poland"</span>&#125;,</span><br><span class="line">]&#125;</span><br></pre></td></tr></table></figure><p>and then</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">user</span><br><span class="line">|&gt; Repo.preload(<span class="symbol">:addresses</span>)</span><br><span class="line">|&gt; Ecto.Changeset.cast(params, [])</span><br><span class="line">|&gt; Ecto.Changeset.cast_assoc(<span class="symbol">:addresses</span>)</span><br></pre></td></tr></table></figure><p>Once <code>cast_assoc/3</code> is called, Ecto will compare those params with the addresses already associated with the user and acts as follows:</p><ul><li><p>If the parameter does not contain an ID, the parameter data will be passed to <code>changeset/2</code> with a new struct and become an insert operation</p></li><li><p>If the parameter contains an ID and there is no associated child with such ID, the parameter data will be passed to <code>changeset/2</code> with a new struct and become an insert operation</p></li><li><p>If the parameter contains an ID and there is an associated children with such ID, the parameter data will be passed to <code>changeset/2</code> with the existing struct and become an update operation.</p></li><li><p>If there is an associated child with an ID and its ID is not given as parameter, the <code>:on_replace</code> callback for that association will be invoked</p></li></ul><h5 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h5><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">`cast_assoc/<span class="number">3</span>` is useful <span class="keyword">when</span> the associated data is managed alongside the parent struct, all at once.</span><br><span class="line"></span><br><span class="line">To work with a single element of an association, other functions are more appropriate. For example to insert a single associated struct <span class="keyword">for</span> a `has_many` association it<span class="string">'s much easier to construct the associated struct with `Ecto.build_assoc/3` and persist it directly with `Ecto.Repo.insert/2`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Furthurmore, if each side of the association is managed seperately, it is prefereable to use `put_assoc/3` and directly instruct Ecto how the association should look like.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">For example, imagine you are receiving a set of tags you want to associate to an user. Those tags are meant to **exist upfront**. Using `cast_assoc/3` won'</span>t work as desired because the tags are <span class="keyword">not</span> managed alongside the user. In such cases, `put_assoc/<span class="number">3</span>` will work as desired. With the given <span class="symbol">parameters:</span></span><br><span class="line"></span><br><span class="line">  %&#123;<span class="string">"name"</span> =&gt; <span class="string">"John Doe"</span>, <span class="string">"tags"</span> =&gt; [<span class="string">"linear"</span>]&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">and</span> <span class="keyword">then</span></span><br><span class="line"></span><br><span class="line">  tags = Repo.all(from t <span class="keyword">in</span> Tag, <span class="symbol">where:</span> t.name <span class="keyword">in</span> ^params[<span class="string">"tags"</span>])</span><br><span class="line"></span><br><span class="line">  user</span><br><span class="line">  |&gt; Repo.preload(<span class="symbol">:tags</span>)</span><br><span class="line">  |&gt; Ecto.Changeset.cast(params) <span class="comment"># no need to allow :tags as we put them directly</span></span><br><span class="line">  |&gt; Ecto.Changeset.put_assoc(<span class="symbol">:tags</span>, tags) <span class="comment"># explicitly set the tags</span></span><br><span class="line"></span><br><span class="line">note the changeset must have been previously `cast` using `cast/<span class="number">4</span>` before this function is called.</span><br></pre></td></tr></table></figure><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cast_assoc</span></span>(changeset, name, opts \\ []) <span class="keyword">when</span> is_atom(name) <span class="keyword">do</span></span><br><span class="line">  cast_relation(<span class="symbol">:assoc</span>, changeset, name, opts)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">defp</span> <span class="title">cast_relation</span></span>(type, %Changeset&#123;&#125; = changeset, key, opts) <span class="keyword">do</span></span><br><span class="line">  &#123; key, param_key &#125; = cast_key(key)</span><br><span class="line">  %&#123;<span class="symbol">data:</span> data, <span class="symbol">types:</span> types, <span class="symbol">params:</span> params, changes, changes &#125; = changeset</span><br><span class="line">  %&#123;<span class="symbol">related:</span> related&#125; = relation = relation!(<span class="symbol">:cast</span>, type, key, Map.get(types, key))</span><br><span class="line">  params = params || %&#123;&#125;</span><br><span class="line"></span><br><span class="line">  &#123;changeset, required?&#125; = if opts[<span class="symbol">:required</span>] <span class="keyword">do</span></span><br><span class="line">    &#123;update_in(changeset.required, &amp;[key|&amp;<span class="number">1</span>]), <span class="keyword">true</span>&#125;</span><br><span class="line">  else</span><br><span class="line">    &#123;changeset, <span class="keyword">false</span>&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  on_cast = Keyword.get_lazy(opts, <span class="symbol">:with</span>, <span class="keyword">fn</span> -&gt; on_cast_default(type, related) <span class="keyword">end</span>)</span><br><span class="line">  original = Map.get(data, key)</span><br><span class="line"></span><br><span class="line">  changeset = <span class="keyword">case</span> Map.fetch(params, params_key) <span class="keyword">do</span></span><br><span class="line">    &#123;<span class="symbol">:ok</span>, value&#125; -&gt;</span><br><span class="line">      current = Relation.load!(data, original)</span><br><span class="line">      <span class="keyword">case</span> Relation.cast(relation, value, current, on_cast) <span class="keyword">do</span></span><br><span class="line">        &#123;<span class="symbol">:ok</span>, change, relation_valid?&#125; <span class="keyword">when</span> change != original -&gt;</span><br><span class="line">          missing_relation(%&#123;changeset |  <span class="symbol">change:</span> Map.put(changes, key, changes), <span class="symbol">valid?:</span> changeset.valid? <span class="keyword">and</span> relation_valid?&#125;, key, current, required?, relation, opts)</span><br><span class="line">        <span class="symbol">:error</span> -&gt;</span><br><span class="line">          %&#123;changeset | <span class="symbol">errors:</span> [&#123;key, &#123;message(opts, <span class="symbol">:invalid_message</span>, <span class="string">"is invalid"</span>), [<span class="symbol">type:</span> expected_relation_type(relation)]&#125;&#125; | changeset.errors], valid? <span class="keyword">false</span>&#125;</span><br><span class="line">        <span class="number">_</span> -&gt; missing_relation(changeset, key, current, required?, relation, opts)</span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">    <span class="symbol">:error</span> -&gt; missing_relation(changeset, key, current, required?, relation, opts)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  update_in changeset.types[key], <span class="keyword">fn</span> &#123;type, relation&#125; -&gt;</span><br><span class="line">    &#123;type, %&#123;relation | <span class="symbol">on_cast:</span> on_cast&#125;&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h3 id="Put-Assoc"><a href="#Put-Assoc" class="headerlink" title="Put Assoc"></a>Put Assoc</h3><p>As alternative to <code>cast_assoc/3</code></p><p><code>cast_assoc/3</code> is useful when the associated data is managed alongside the parent struct, all at once.</p><p>If each side of the association is managed seperately, it is preferable to use <code>put_assoc/3</code> and directly instruct Ecto how the association should look like.</p><p>For example, imagine you are receiving a set of tags you want to associate to an user. Those tags are meant to exist upfront. Using <code>cast_assoc/3</code> wonât work as desired because the tags are not managed alongside the user. In such cases, <code>put_assoc/3</code> will work as desired.</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%&#123;<span class="string">"name"</span> =&gt; <span class="string">"John Doe"</span>, <span class="string">"tags"</span> =&gt; [<span class="string">"lieanr"</span>]&#125;</span><br></pre></td></tr></table></figure><p>and then:</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tags = Repo.all(from t <span class="keyword">in</span> Tag, <span class="symbol">where:</span> t.name <span class="keyword">in</span> ^params[<span class="string">"tags"</span>])</span><br><span class="line"></span><br><span class="line">user</span><br><span class="line">|&gt; Repo.preload(<span class="symbol">:tags</span>)</span><br><span class="line">|&gt; Ecto.Changeset.cast(params)</span><br><span class="line">|&gt;  Ecto.Changeset.put_assoc(<span class="symbol">:tags</span>, tags)</span><br></pre></td></tr></table></figure><h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><h5 id="Build-Assoc"><a href="#Build-Assoc" class="headerlink" title="Build_Assoc"></a>Build_Assoc</h5><p>Gen an instance with foreign key</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">iex&gt; post = Ecto.build_assoc(user, :posts, %&#123;header: <span class="string">"Clickbait header"</span>, body: <span class="string">"No real contet"</span>&#125;)</span><br><span class="line">%EctoAssoc.Post&#123;__meta__: <span class="comment">#Ecto.Schema.Metadata&lt;:built, "posts"&gt;,</span></span><br><span class="line">  body: <span class="string">"No real content"</span>, header: <span class="string">"Clickbait header"</span>, id: nil,</span><br><span class="line">  user: <span class="comment">#Ecto.Association.NotLoaded&lt;association :user is not loaded&gt;, user_id: 1&#125;</span></span><br><span class="line"></span><br><span class="line">iex&gt; Repo.insert!(post)</span><br></pre></td></tr></table></figure><h5 id="Put-Assoc-1"><a href="#Put-Assoc-1" class="headerlink" title="Put_Assoc"></a>Put_Assoc</h5><p>Add association to changeset which is not persisted</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iex&gt; post_changeset = Ecto.Changeset.change(post)</span><br><span class="line">iex&gt; post_with_tags = Ecto.Changeset.put_assoc(post_changeset, :tags, [misc_tag])</span><br><span class="line">iex&gt; Repo.insert!(post_with_tags)</span><br></pre></td></tr></table></figure><h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h3><p><code>cast_assoc</code> when you want to cast external parameters, like the ones from a form, into an association.</p><p><code>put_assoc</code> when you already have an <strong>association struct</strong></p><p><code>build_assoc</code> receive an existing struct(for example <code>user</code>), that was persisted to the database, and builds a struct(for example <code>post</code>, based on its association(for example <code>:posts</code>), with the foreign key field(for example <code>user_id</code>).</p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Introduction to Object.getOwnPropertyDescriptors</title>
      <link href="/2018/04/14/Introduction-to-Object-getOwnPropertyDescriptors/"/>
      <content type="html"><![CDATA[<h3 id="Object-getOwnPropertyDescriptors"><a href="#Object-getOwnPropertyDescriptors" class="headerlink" title="Object.getOwnPropertyDescriptors"></a>Object.getOwnPropertyDescriptors</h3><p>This method returns all properties including <code>getter</code> and <code>setter</code>.</p><p><code>Object.assign</code> shallow copies all the properties excluding <code>getter</code> and <code>setter</code> of the original source object.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> car = &#123;</span><br><span class="line">  name: <span class="string">'BMW'</span>,</span><br><span class="line">  price: <span class="number">100000</span>,</span><br><span class="line">  get discount () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.d</span><br><span class="line">  &#125;</span><br><span class="line">  set discount (x) &#123;</span><br><span class="line">    <span class="keyword">this</span>.d = x</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.getOwnPropertyDescriptor(car, <span class="string">'discount'</span>) <span class="comment">// &#123;get, set, enumerable, configurable&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> assignedCar = <span class="built_in">Object</span>.assign(&#123;&#125;, car)</span><br><span class="line"><span class="built_in">Object</span>.getOwnPropertyDescriptor(assignedCar, <span class="string">'discount'</span>) <span class="comment">// &#123;value: undefined&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> definedCar = <span class="built_in">Object</span>.defineProperties(&#123;&#125;, <span class="built_in">Object</span>.getOwnPropertyDescriptors(car))</span><br><span class="line"><span class="built_in">Object</span>.getOwnPropertyDescriptor(definedCar, <span class="string">'discount'</span>) <span class="comment">// &#123;get, set, enumerable, configurable&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Enable Sass/scss in Phoenix</title>
      <link href="/2018/04/06/enable-sass-scss-in-phoenix/"/>
      <content type="html"><![CDATA[<h1 id="Step-1-Add-brunch"><a href="#Step-1-Add-brunch" class="headerlink" title="Step 1: Add brunch"></a>Step 1: Add brunch</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> assets &amp;&amp; yarn add sass-brunch</span><br></pre></td></tr></table></figure><h1 id="Step-2-Add-plugin-in-brunch-config-js"><a href="#Step-2-Add-plugin-in-brunch-config-js" class="headerlink" title="Step 2: Add plugin in brunch-config.js"></a>Step 2: Add plugin in brunch-config.js</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// brunch-config.js</span></span><br><span class="line">plugins: &#123;</span><br><span class="line">  sass: &#123;</span><br><span class="line">    mode: <span class="string">'native'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Step3-Enable-hot-reload"><a href="#Step3-Enable-hot-reload" class="headerlink" title="Step3: Enable hot-reload"></a>Step3: Enable hot-reload</h1><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/<span class="regexp">/ dev.exs</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ add sass and scss to the pattern</span></span><br><span class="line"><span class="regexp">config :citaDappStore, CitaDappStoreWeb.Endpoint,</span></span><br><span class="line"><span class="regexp">  live_reload: [</span></span><br><span class="line"><span class="regexp">    patterns: [</span></span><br><span class="line"><span class="regexp">      ~r&#123;priv/static</span><span class="regexp">/.*(js|css|png|jpeg|jpg|gif|svg|sass|scss)$&#125;,</span></span><br><span class="line"><span class="regexp">      ~r&#123;priv/gettext</span><span class="regexp">/.*(po)$&#125;,</span></span><br><span class="line"><span class="regexp">      ~r&#123;lib/cita</span>DappStore_web/views/.*(ex)<span class="variable">$&#125;</span>,</span><br><span class="line">      ~r&#123;lib/citaDappStore_web/templates/.*(eex)<span class="variable">$&#125;</span></span><br><span class="line">    ]</span><br><span class="line">  ]</span><br></pre></td></tr></table></figure><p>Thatâs all.</p>]]></content>
      
      
        <tags>
            
            <tag> Elixir, Phoenix, SCSS </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Model Generator of Rails</title>
      <link href="/2018/03/14/Model-Generator-of-Rails/"/>
      <content type="html"><![CDATA[<p><a href="https://railsguides.net/advanced-rails-model-generators/" target="_blank" rel="noopener">Origin</a></p><h3 id="Basic-Usage"><a href="#Basic-Usage" class="headerlink" title="Basic Usage"></a>Basic Usage</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rails g model User email</span><br></pre></td></tr></table></figure><p>This command will generate user model with email field type of string, migration which creates user table, test for model and factory.</p><p>If you want to have model with different type of string pass type after field name following by <code>:</code>.</p><p>The whole list of available types:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">integer</span><br><span class="line">primary_key</span><br><span class="line">decimal</span><br><span class="line">float</span><br><span class="line">boolean</span><br><span class="line">binary</span><br><span class="line">string</span><br><span class="line">text</span><br><span class="line">date</span><br><span class="line">time</span><br><span class="line">datetime</span><br><span class="line">timestamp</span><br></pre></td></tr></table></figure><p>You are able to pass -option parameter to generator. It will inherit generating class from passed name to achieve STI(Single Table Inheritance):</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rails g model admin --parent user</span><br></pre></td></tr></table></figure><p>This example generates model:</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Admin</span> &lt; User</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>Interesting fact that if you generate model in some scope passing model like <em>admin/user</em> of <em>Admin::User</em>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rails g model admin/user</span><br></pre></td></tr></table></figure><p>you will get generated model in scope <code>app/models/admin/user.rb</code>, defined scope <code>app/models/admin.rb</code> which is required to define module.</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">module</span> <span class="title">Admin</span></span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">table_name_prefix</span></span></span><br><span class="line">   <span class="string">'admin_'</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>It means that generated table name for <em>Admin::User</em> starts with prefix _admin_user_. This feature allows to have seperated namespaced models as in rails code as in db schema.</p><h3 id="Advantage-useage"><a href="#Advantage-useage" class="headerlink" title="Advantage useage"></a>Advantage useage</h3><p>Sometimes you have to automatically add index for columns in your migration. Itâs not a problem.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rails g model user email:index location_id:<span class="built_in">integer</span>:index</span><br></pre></td></tr></table></figure><p>Or uniq index</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rails g model user pseudo:string:uniq</span><br></pre></td></tr></table></figure><p>Set limit for field of integer, string, text and binary fields</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rails g model product <span class="string">'price:decimal&#123;10,2&#125;'</span></span><br></pre></td></tr></table></figure><p>The last useful feature of generators - itâs options to generate reference columns (fields which are used in rails as foreign_key)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rails g model photo album:references</span><br></pre></td></tr></table></figure><p>This command will generate photos table with integer field _album_id_ and also it will add index for this field automatically.</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CreatePhotos</span> &lt; ActiveRecord::Migration</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">change</span></span></span><br><span class="line">    create_table <span class="symbol">:photos</span> <span class="keyword">do</span> <span class="params">|t|</span></span><br><span class="line">      t.references <span class="symbol">:album</span></span><br><span class="line"></span><br><span class="line">      t.timestamps</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    add_index <span class="symbol">:photos</span>, <span class="symbol">:album_id</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> Ruby, Rails </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Error Handling in Solidity</title>
      <link href="/2018/03/13/Error-Handling-in-Solidity/"/>
      <content type="html"><![CDATA[<p>Solidity uses state-reverting exceptions to handle errors. Such an exception will undo all changes made to the state in the current call(and all its sub-calls) and also flag an error to the caller. The convenience function <code>assert</code> and <code>require</code> can be used to check for conditions and throw an exception if the condition is not met.</p><p>The <code>assert</code> function should only be used to test for internal errors, and to check invariants.</p><p>The <code>require</code> function should be used to ensure valid conditions, such as inputs, or contract state variables are met, or to validate return values from calls to external contracts.</p><p>If used properly, analysis tools can evaluate your contract to identify the conditions and function calls which will reach a failing <code>assert</code>. Properly functioning code should never reach a failing assert statement. If this happens there is a bug in your contract which you should fix.</p><p>There are two ways to trigger exceptions:</p><ul><li><p>The <code>revert</code> function can be used to flag an error and revert the current call. In the future, it might be possible to also include details about error in a call to <code>revert</code>.</p></li><li><p>The <code>throw</code> keyword can also be used as an alternative to <code>revert()</code></p></li></ul><blockquote><p>From 0.4.13, the <code>throw</code> is deprecated.</p></blockquote><p>When exceptions happen in a sub-call, they âbubble upâ automatically. Exceptions to this rule are <code>send</code> and the low-level functions <code>call</code>, <code>delegatecall</code> and <code>callcode</code> â those return <code>false</code> in case of an exception instead of âbubble upâ.</p><blockquote><p>low-level function <code>call</code>, <code>delegatecall</code>, <code>callcode</code> return false when exceptions occur.</p></blockquote><p>Catch exceptions is not yet possible.</p>]]></content>
      
      
        <tags>
            
            <tag> Solidity, Error Handling </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Start in Drizzle </title>
      <link href="/2018/03/13/Start-in-Drizzle/"/>
      <content type="html"><![CDATA[<p>Drizzle is a collection of front-end libraries that make wirting dapp front-ends easier and more predicable. The core of Drizzle is based on Redux Store, so you can access to the spectacular development tools around Redux. We take care of synchronizing your contract data, transaction data and more. Things stay fast because you declare what to keep in sync.</p><ul><li><p>Fully reactive contract data, including state, events and transactions</p></li><li><p>Declarative, so youâre not wasting valuable cycles on unneeded data.</p></li><li><p>Maintainer access to underlying functionaliy. Web3 and your contractâs methods are still there, untouched.</p></li></ul><h3 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add drizzle</span><br></pre></td></tr></table></figure><p>If use React you can use <a href="https://github.com/trufflesuite/drizzle-react" target="_blank" rel="noopener">drizzle-react</a> and (optionally) its companion <a href="https://github.com/trufflesuite/drizzle-react-components" target="_blank" rel="noopener">drizzle-react-components</a></p><blockquote><p>Drizzle uses web3 1.0 and web sockets, be sure your development environment can support these.</p></blockquote><ol><li>Import the provider</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Drizzle, generateStore &#125; <span class="keyword">from</span> <span class="string">'drizzle'</span></span><br></pre></td></tr></table></figure><ol><li>Create an <code>options</code> object and pass in the desired contract artifacts for Drizzle to instantiate. Other options are available, just keep going on.</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// import contract</span></span><br><span class="line"><span class="keyword">import</span> SimpleStorage <span class="keyword">from</span> <span class="string">'./../build/contracts/SimpleStorage.json'</span></span><br><span class="line"><span class="keyword">import</span> TutorialToken <span class="keyword">from</span> <span class="string">'./../build/contracts/TutorialToken.json'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> options = &#123;</span><br><span class="line">  contracts: [</span><br><span class="line">    SimpleStorage</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> drizzleStore = generateStore(<span class="keyword">this</span>.props.options)</span><br><span class="line"><span class="keyword">const</span> drizzle = <span class="keyword">new</span> Drizzle(<span class="keyword">this</span>.props.options, drizzleStore)</span><br></pre></td></tr></table></figure><h3 id="Contract-Interaction"><a href="#Contract-Interaction" class="headerlink" title="Contract Interaction"></a>Contract Interaction</h3><p>Drizzle provides helpful methods on top of the default web3 Contract methods to keep you calls and transactions in sync with the store.</p><h4 id="cacheCall"><a href="#cacheCall" class="headerlink" title="cacheCall()"></a>cacheCall()</h4><p>Gets contract data. Calling the <code>cacheCall()</code> function on a contract will execute the desired call and return a <strong>corresponding key</strong> so the data can be retrieved from the store.</p><p>When a new block is received, Drizzle will refresh the store automatically _if_ any transactions in the block touched our contract.</p><blockquote><p>Note: We have to check that Drizzle is <strong>initialized before fetching data</strong>. A simple if statement such as below is fine for display a few pieces of data, but a better approach for larger dapps is to use a <code>loading component</code>. Drizzle built one in <code>drizzle-react-component</code> as well.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Assuming we're observing the store for changes</span></span><br><span class="line"><span class="keyword">var</span> state = drizzle.store.getState()</span><br><span class="line"></span><br><span class="line"><span class="comment">// If Drizzle is initialized (and therefore web3, accounts, and contracts ), continue</span></span><br><span class="line"><span class="keyword">if</span> (state.drizzleStatus.initialized) &#123;</span><br><span class="line">  <span class="comment">// Declare this call to be cached and synchornized. We'll receive the store key for recall</span></span><br><span class="line">  <span class="keyword">const</span> dataKey = drizzle.contracts.SimpleStorage.methods.storedData.cacheCall()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Use the dataKey to display data from the store</span></span><br><span class="line">  <span class="keyword">return</span> state.contracts.SimpleStorage.methods.storedData[dataKey].value</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// If Drizzle isn't initialized, display some loading indication</span></span><br><span class="line"><span class="keyword">return</span> <span class="string">'loading'</span></span><br></pre></td></tr></table></figure><p>The Contract instance has all of its standard web3 properties and methods. For example, you could still call as normal if you donât want something in the store:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drizzle.contracts.SimpleStorage.methods.storedData().call() <span class="comment">// different from methods.storedData.cacheCall()</span></span><br></pre></td></tr></table></figure><h3 id="cacheSend"><a href="#cacheSend" class="headerlink" title="cacheSend()"></a>cacheSend()</h3><p>Sends a contract transaction. Calling the <code>cacheSend()</code> function on a contract will send the desired transaction and return a correnponding hash so the status can be retrieved from the store. The last argument can optionally be an options object with the typical <strong>from, gas, gasPrice</strong> keys. Drizzle will update the transactionâs state in the store(pending, success, error) and store the transaction receipt.</p><blockquote><p>Note: We have to check that Drizzle is initialized before fetching data. A simple if statement such as below is fine for display a few pieces of data, but a better approach for larger dapps is to use a loading component.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Assuming we're observing the store of changes</span></span><br><span class="line"><span class="keyword">var</span> state = drizzle.store.getState()</span><br><span class="line"></span><br><span class="line"><span class="comment">// if Drizzle is initialized ( and therefore web3, accounts, and contracts ), continue</span></span><br><span class="line"><span class="keyword">if</span> (state.drizzleStatus.initialized) &#123;</span><br><span class="line">  <span class="comment">// Declare this transaction to be observed. We'll receive the stackId of reference.</span></span><br><span class="line">  <span class="keyword">const</span> stackId = drizzle.contracts.SimpleStorage.methods.set.cacacheSend(<span class="number">2</span>, &#123;<span class="attr">from</span>: <span class="string">'0x3f...'</span>&#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Use the dataKey to display the transaction status</span></span><br><span class="line">  <span class="keyword">if</span> (state.transactionStack[stackId]) &#123;</span><br><span class="line">    <span class="keyword">const</span> txHash = state.trasnactionStack[stackId]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> state.transactions[txHash].status</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// If Drizzle isn't initialized, display some loading indication.</span></span><br><span class="line"><span class="keyword">return</span> <span class="string">'loading'</span></span><br></pre></td></tr></table></figure><p>The contract instance has all of its standard web3 properties and methods.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drizzle.contracts.SimpleStorage.methods.set(<span class="number">2</span>).send(&#123;<span class="attr">from</span>: <span class="string">'0x3f...'</span>&#125;)</span><br></pre></td></tr></table></figure><h3 id="Options"><a href="#Options" class="headerlink" title="Options"></a>Options</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  contracts,</span><br><span class="line">  events: &#123;</span><br><span class="line">    contractsName: [</span><br><span class="line">      eventName</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  web3: &#123;</span><br><span class="line">    fallback: &#123;</span><br><span class="line">      type</span><br><span class="line">      url</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>Contracts: Array, Required, an array of contract artifacts files</p></li><li><p>Events: Object, an object consisting of contract names each containing an array of strings of the event names weâd like to listen for and sync with the store</p></li><li><p>Web3: Object, options regarding web3 instantiation</p></li><li><p>Fallback: Object, an object consisting of the type and url of a fallback web3 provider. This is used if no injected provider, such as MetaMask or Mist, is detect.</p><ul><li><p>type: string, the type of web3 fallback, currently <code>ws</code> is the only possibility</p></li><li><p>url: string, the full websocket url. For example, <code>ws://127.0.0.1:8546</code></p></li></ul></li></ul><h3 id="How-data-stays-fresh"><a href="#How-data-stays-fresh" class="headerlink" title="How data stays fresh"></a>How data stays fresh</h3><ol><li>Once initialized, Drizzle instantiates <code>web3</code> and our desired contracts, then observes the chain by subscribing to new block headers</li></ol><p><img src="https://github.com/trufflesuite/drizzle/blob/master/readme/drizzle-sync1.png?raw=true" alt=""></p><ol><li>Drizzle keeps track of contract calls so it knows what to synchronize</li></ol><p><img src="https://github.com/trufflesuite/drizzle/blob/master/readme/drizzle-sync2.png?raw=true" alt=""></p><ol><li>When a new block header comes in, Drizzle checks that the block isnât pending, then goes through the transactions looking to see if any of them touched our contracts</li></ol><p><img src="https://github.com/trufflesuite/drizzle/blob/master/readme/drizzle-sync3.png?raw=true" alt=""></p><ol><li>If they did, we replay the calls already in the store to refresh any potentially altered data. If they didnât we continue with the store data.</li></ol><p><img src="https://github.com/trufflesuite/drizzle/blob/master/readme/drizzle-sync4.png?raw=true" alt=""></p>]]></content>
      
      
        <tags>
            
            <tag> Drizzle, Ethereum, BlockChain </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Constant, View, and Pure in Solidity</title>
      <link href="/2018/03/12/Constant-View-and-Pure-in-Solidity/"/>
      <content type="html"><![CDATA[<h3 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h3><ul><li><p><code>pure</code> for functions: Disallows modifition or access of state - this is not enforeced yet.</p></li><li><p><code>view</code> for functions: Disallow modifition of state - this is not enforced yet.</p></li><li><p><code>payable</code> for functions: Allows them to receive Ether together with a call.</p></li><li><p><code>constant</code> for <strong>state variables</strong>: Disallow assignment (except initialization), does not occupy storage slot.</p></li><li><p><code>anonymouse</code> for <strong>events</strong>: Does not store event signature as <strong>topic</strong>(indexable).</p></li><li><p><code>indexed</code> for <strong>event parameters</strong>: Stores the parameter as <strong>topic</strong>(indexable).</p></li></ul><p><a href="https://ethereum.stackexchange.com/questions/25200/solidity-what-is-the-difference-between-view-and-constant" target="_blank" rel="noopener">Question</a></p><blockquote><p>Q: Solidity 0.4.16 introduced the <code>view</code> and <code>constant</code> function modifiers. <a href="http://solidity.readthedocs.io/en/latest/miscellaneous.html#modifiers" target="_blank" rel="noopener">The documentation</a> says:</p></blockquote><blockquote><p>constant for functions: Same as view</p></blockquote><blockquote><p>Does this mean <code>view</code> is just an alias for <code>constant</code>?</p></blockquote><p>Answer: This is discussed <a href="https://github.com/ethereum/solidity/issues/992" target="_blank" rel="noopener">here</a></p><ol><li><p>The keyword <code>view</code> is introduced for functions (it replaces constant). Calling a view cannot alter the behavior of future interaction with any contract. This means such functions cannot use <code>SSTORE</code>, cannot <code>send</code> or <code>receive</code> ether and can only call other <code>view</code> or <code>pure</code> functions.</p></li><li><p>The keyword <code>pure</code> is introduced for functions, they are view functions with the additional restriction that their value only depends on the function arguments(pure function). This means they cannot use <code>SSTORE</code>, <code>SLOAD</code>, cannot <code>send</code> or <code>receive</code> ether, cannot use <code>msg</code> or <code>block</code> and can only call other <code>pure</code> function.</p></li><li><p>The keyword <code>constant</code> is <strong>invalid</strong> on functions</p></li><li><p>The keyword <code>constant</code> on any variable means it cannot be modified (and could be placed into memory or bytecode by the optimiser)</p></li></ol>]]></content>
      
      
        <tags>
            
            <tag> Solidity </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Writing Upgradable Contracts in Solidity</title>
      <link href="/2018/03/05/Writing-Upgradable-Contracts-in-Solidity/"/>
      <content type="html"><![CDATA[<p><a href="https://blog.colony.io/writing-upgradeable-contracts-in-solidity-6743f0eecc88" target="_blank" rel="noopener">origin</a></p><p>Ethereum contracts are immutable â once deployed to the blockchain they cannot be updated, yet the need to change their logic with time is ultimately necessary.</p><p>During a contract upgrade the following factors need to be considered:</p><ul><li><p>Block gas limit(4712388 for Homestead)</p><p>Upgrade transaction tend to be large due to the amount of processing they have to complete e.g. <em>deploy a contract, move data, move references</em>.</p></li><li><p>Inter-contract dependencies</p><p><em>when a contract is compiled, all of its imports are compiled into the contract thus leading to a ripple effect when you want to swap out a contract which is being referenced by other contract</em>.</p></li></ul><p>These two are related, as having more dependencies affects the size of your deployed contracts and the overall transaction size of the upgrade. The implementation patterns below work to <em>minimise the upgrade gas costs as well as loosening the coupling of contracts without breaking Solidity type safety</em>.</p><p>Note that for the sake of simplying the examples, we have omitted the implementation of security and permission.</p><h3 id="Avoiding-large-data-copy-operations"><a href="#Avoiding-large-data-copy-operations" class="headerlink" title="Avoiding large data copy operations"></a>Avoiding large data copy operations</h3><p>Storing data is expensive(<code>SSTORE</code> operation costs 5000 or 20000 gas) and upgrading contracts containing large storage variables runs the chance of hitting the transaction gas limit during the copying of its data.</p><p><strong>You may therefore want to isolate your datastore from the rest of your code, and make it as flexible as possible, so that it is unlikely to need to be upgrade.</strong></p><p>Depending on your circumstances, how large of a datastore you need and whether you expect its structure to change often, you may choose a strict definition or a loosely typed flat store. Below is an example of the latter which implements support for storing a <em>sha3</em> key and value pairs. It is the more flexible and extensible option. This ensures data schema changes can be implemented without requiring upgrades to the storage contract.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">contract EternalStorage &#123;</span><br><span class="line">  mapping(<span class="function"><span class="params">bytes32</span> =&gt;</span> uint) UIntStorage;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getUIntValue</span>(<span class="params">bytes32 record</span>) <span class="title">constant</span> <span class="title">returns</span> (<span class="params">uint</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> UIntStorage[record];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setUIntValue</span>(<span class="params">bytes32 record, uint value</span>) </span>&#123;</span><br><span class="line">    UIntStorage[record] = value;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  mapping(<span class="function"><span class="params">bytes32</span> =&gt;</span> string) StringStorage;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getStringValue</span>(<span class="params">bytes32 record</span>) <span class="title">constant</span> <span class="title">returns</span> (<span class="params">string</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> StringStorage(record);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setStringValue</span>(<span class="params">bytes32 record, string value</span>) </span>&#123;</span><br><span class="line">    StringStorage[record] = value;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  mapping(<span class="function"><span class="params">bytes32</span> =&gt;</span> address) AddressStorage;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getAddressValue</span>(<span class="params">bytes32 record</span>) <span class="title">constant</span> <span class="title">returns</span> (<span class="params">address</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> AddressStorage[record];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setAddressValue</span>(<span class="params">bytes32 record, address value</span>) </span>&#123;</span><br><span class="line">    AddressStorage[record] = value;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  mapping(<span class="function"><span class="params">bytes32</span> =&gt;</span> bytes) BytesStorage;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getBytesValue</span>(<span class="params">bytes32 record</span>) <span class="title">constant</span> <span class="title">returns</span> (<span class="params">bytes</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> BytesStorage[record];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setBytesValue</span>(<span class="params">bytes32 record, bytes value</span>) </span>&#123;</span><br><span class="line">    BytesStorage[record] = value;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  mapping (<span class="function"><span class="params">bytes32</span> =&gt;</span> bool) BooleanStorage;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getBooleanValue</span>(<span class="params">bytes32 record</span>) <span class="title">constant</span> <span class="title">returns</span> (<span class="params">bool</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> BooleanStorage[record];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setBooleanValue</span>(<span class="params">bytes32 record, bool value</span>) </span>&#123;</span><br><span class="line">    BooleanStorage[record] = value;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  mapping (<span class="function"><span class="params">bytes32</span> =&gt;</span> int) IntStorage;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getIntValue</span>(<span class="params">bytes32 record</span>) <span class="title">constant</span> <span class="title">returns</span> (<span class="params">int</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> IntStorage[record];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setIntValue</span>(<span class="params">bytes32 record, int value</span>) </span>&#123;</span><br><span class="line">    IntStorage[record] = value;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>For upgrades you can then just switch the upgraded contract to point to the new EternalStorage contract instance without having a copy of its data.</p><h3 id="Use-Libraries-to-Encapsulate-Logic"><a href="#Use-Libraries-to-Encapsulate-Logic" class="headerlink" title="Use Libraries to Encapsulate Logic"></a>Use Libraries to Encapsulate Logic</h3><p>Libraries are special form of contracts that are singletons and not allowed any storage variables.</p><p>The advantage of libraries in the context of upgrades is that they allow encapsulation of business logic or data management logic into singleton instance that cost only upgrading one and not many contracts.</p><p>Example below shows a library used for adding a <em>Proposal</em> to storage.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"EternalStorage.sol"</span>;</span><br><span class="line"></span><br><span class="line">library ProposalsLibrary &#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getProposalCount</span>(<span class="params">address _storageContract</span>) <span class="title">constant</span> <span class="title">returns</span> (<span class="params">uint256</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> EternalStorage(_storageContract).getUIntValue(sha3(<span class="string">"proposalCount"</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">addProposal</span>(<span class="params">address _storageContract, bytes32 _name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> idx = getProposalCount(_storageContract);</span><br><span class="line">    EternalStorage(_storageContract).setBytes32Value(sha3(<span class="string">"proposal_name"</span>, idx), _name);</span><br><span class="line">    EternalStorage(_storageContract).setUIntValue(sha3(<span class="string">"proposal_eth"</span>, idx), <span class="number">0</span>);</span><br><span class="line">    EternalStorage(_storageContract).setUIntValue(sha3(<span class="string">"ProposalCount"</span>), idx + <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Under the cover, library functions are called using <code>delegatecall</code> from the calling contract which has the advantage of passing the <code>msg.sender</code> and <code>msg.value</code> seamlessly. You can therefore write your library code as if it were just part of your contract, without having to worry about the sender or value chagning.</p><p>The example below shows a sample <code>Organization</code> contract using <code>ProposalsLibrary</code> to interact with data storage.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"ProposalsLibrary.sol"</span>;</span><br><span class="line"></span><br><span class="line">contract Organization &#123;</span><br><span class="line">  using ProposalsLibrary <span class="keyword">for</span> address;</span><br><span class="line">  address public eternalStorage;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">Organization</span>(<span class="params">address _eternalStorage</span>) </span>&#123;</span><br><span class="line">    eternalStorage = _eternalStorage;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">addProposal</span>(<span class="params">bytes32 _name</span>) </span>&#123;</span><br><span class="line">    eternalStorage.addProposal(_name);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>With libraries, there is a slight gas overhead on each call. However, it makes deploying a new contract much cheaper.</p><h3 id="Use-âinterfaceâ-to-decouple-inter-contract-communication"><a href="#Use-âinterfaceâ-to-decouple-inter-contract-communication" class="headerlink" title="Use âinterfaceâ to decouple inter-contract communication"></a>Use âinterfaceâ to decouple inter-contract communication</h3><p>Abstract Contract implementation behind an interface that only define its function siguatures.</p><p>This is a well known pattern in object oriented programming.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"ITokenLedger.sol"</span>;</span><br><span class="line"></span><br><span class="line">contract Organization &#123;</span><br><span class="line">  ITokenLedger public tokenLedger;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">Organization</span>(<span class="params">address _tokenLedger</span>) </span>&#123;</span><br><span class="line">    tokenLedger = ITokenLedger(_tokenLedger);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">generateToekns</span>(<span class="params">uint256 _amount</span>) </span>&#123;</span><br><span class="line">    tokenLedger.generateTokens(_amount);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Here instead of importing the entire <code>TokenLedger.sol</code> contract, we use an interface containing just the function signatures. This eases any possible upgrades to TokenLedger which donât affect its interface, too, which with this model can be implemented without redeploying the Organization contract.</p>]]></content>
      
      
        <tags>
            
            <tag> DApp, Solidity </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Dockerizing a React App</title>
      <link href="/2018/02/28/Dockerizing-a-React-App/"/>
      <content type="html"><![CDATA[<p><a href="http://mherman.org/blog/2017/12/07/dockerizing-a-react-app/" target="_blank" rel="noopener">origin</a></p><h3 id="Project-Setup"><a href="#Project-Setup" class="headerlink" title="Project Setup"></a>Project Setup</h3><p>Install <code>create-react-app</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g create-react-app@1.5.2</span><br></pre></td></tr></table></figure><p>Creating a new app</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">create-react-app docker-app</span><br><span class="line"><span class="built_in">cd</span> docker-app</span><br></pre></td></tr></table></figure><h3 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h3><p>Add a <code>Dockerfile</code> to the project root</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># base image</span><br><span class="line">FROM node:9.6.1</span><br><span class="line"></span><br><span class="line"># set working directory</span><br><span class="line">RUN mkdir /usr/src/app</span><br><span class="line">WORKDIR /usr/src/app</span><br><span class="line"></span><br><span class="line"># add `/usr/src/app/node_modules/.bin` to $PATH</span><br><span class="line">ENV PATH /usr/src/app/node_modules/.bin:$PATH</span><br><span class="line"></span><br><span class="line"># install and cache app dependencies</span><br><span class="line">COPY package.json /usr/src/app/package.json</span><br><span class="line">RUN npm install</span><br><span class="line">RUN npm install react-scripts@1.1.1 -g</span><br><span class="line"></span><br><span class="line"># start app</span><br><span class="line">CMP [&quot;npm&quot;, &quot;start&quot;]</span><br></pre></td></tr></table></figure><p>Add a <code>.dockerignore</code> to speed up the Docker build process as our local dependencies will not be sent to the Docker Daemon</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node_modules</span><br></pre></td></tr></table></figure><p>Build and tag the Docker Image</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t docker-app:1.0.0</span><br></pre></td></tr></table></figure><p>Then spin up the container once the image is built.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -v <span class="variable">$&#123;PWD&#125;</span>:/usr/src/app -v /usr/src/app/node_modules -p 3000:3000 --rm docker-app:1.0.0</span><br></pre></td></tr></table></figure><p>Now you can visit your app <code>http://localhost:3000</code></p><h3 id="Docker-Compose"><a href="#Docker-Compose" class="headerlink" title="Docker Compose"></a>Docker Compose</h3><p>Add a <code>docker-compose.yml</code> to the project root.</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3.3'</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="attr">  docker-app:</span></span><br><span class="line"><span class="attr">    container_name:</span> <span class="string">docker-app</span></span><br><span class="line"><span class="attr">    build:</span></span><br><span class="line"><span class="attr">      context:</span> <span class="string">.</span></span><br><span class="line"><span class="attr">      dockerfile:</span> <span class="string">Dockerfile</span></span><br><span class="line"><span class="attr">    volumnes:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">'.:/usr/src/app'</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">'/usr/src/app/node_modules'</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">'3000:3000'</span></span><br><span class="line"><span class="attr">    environment:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">NODE_ENV=development</span></span><br></pre></td></tr></table></figure><p>Take note of the volumes. Without the data volume <code>/usr/src/app/node_modules</code>, the <code>node_modules</code> directory would be overwritten by the mounting of the host directory at runtime that were installed when the container was built.</p><p>BUild the image and fire up the container</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d --build</span><br></pre></td></tr></table></figure><p>Ensure the app is running in the browser.</p><p>Bring down the container before moving on</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose stop</span><br></pre></td></tr></table></figure><h3 id="Production"><a href="#Production" class="headerlink" title="Production"></a>Production</h3><p>Letâs create a seperate <code>Dockerfile</code> for use in production called <code>Dockerfile-prod</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># build environment</span><br><span class="line">FROM node:9.6.1 as builder</span><br><span class="line">RUN mkdir /usr/src/app</span><br><span class="line">WORKDIR /usr/src/app</span><br><span class="line">ENV PATH /usr/src/app/node_moudles/.bin:$PATH</span><br><span class="line">COPY package.json /usr/src/app/package.json</span><br><span class="line">RUN npm install</span><br><span class="line">RUN npm install react-scripts@1.1.1 -g</span><br><span class="line">COPY . /usr/src/app</span><br><span class="line">RUN npm run build</span><br><span class="line"></span><br><span class="line"># production environment</span><br><span class="line">FROM nginx:1.13.9-alpine</span><br><span class="line">COPY --from=builder /usr/src/app/build /usr/share/nginx/html</span><br><span class="line">EXPOSE 80</span><br><span class="line">CMD [&quot;nginx&quot;,&quot;-g&quot;,&apos;deamon off;&quot;]</span><br></pre></td></tr></table></figure><p>Using the production Dockerfile, build and tag the Docker Image:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -f Dockerfile-prod -t docker-app-prod .</span><br></pre></td></tr></table></figure><p>Spin up the container</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -p 80:80 --rm docker-app-prod</span><br></pre></td></tr></table></figure><p>Add Prod Docker Compose as `docker-compose-prod.ymlâ</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">"3.3"</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="attr">  docker-app-prod:</span></span><br><span class="line"><span class="attr">    container_name:</span> <span class="string">docker-app-prod</span></span><br><span class="line"><span class="attr">    build:</span></span><br><span class="line"><span class="attr">      context:</span> <span class="string">.</span></span><br><span class="line"><span class="attr">      dockerfile:</span> <span class="string">Dockerfile-prod</span></span><br><span class="line"><span class="attr">    prots:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"80:80"</span></span><br></pre></td></tr></table></figure><p>Fire up the container</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose -f docker-compose-prod.yml up -d --build</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> React, Docker </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Deploy RoR With Mina</title>
      <link href="/2018/02/24/Deploy-RoR-with-Mina/"/>
      <content type="html"><![CDATA[<h3 id="Mina-Setup"><a href="#Mina-Setup" class="headerlink" title="Mina Setup"></a>Mina Setup</h3><p>Letâs take a look at setting up Mina with Puma. First, youâll need to add Mina and mina-puma in Gemfile.</p><p>Then install gems and execute the initial Mina Command for generating a <code>config/deploy.rb</code>.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bundle</span><br><span class="line">mina init</span><br></pre></td></tr></table></figure><h3 id="Detailed-Explanations-for-the-Mina-deploy-file"><a href="#Detailed-Explanations-for-the-Mina-deploy-file" class="headerlink" title="Detailed Explanations for the Mina deploy file"></a>Detailed Explanations for the Mina deploy file</h3><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Set the domain or ip address of the remote server.</span></span><br><span class="line">set <span class="symbol">:domain</span>, <span class="string">'yourdomain'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the folder of the remote server where Mina will deploy your app.</span></span><br><span class="line">set <span class="symbol">:deploy_to</span>, <span class="string">'path/to/directory'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set a link to the repository. Better git protocol.</span></span><br><span class="line">set <span class="symbol">:repository</span>, <span class="string">'git@...'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the name of a branch you plan to deploy as default master.</span></span><br><span class="line">set <span class="symbol">:branch</span>, <span class="string">'master'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Fill in the names of the files and directories that will be symlinks to the shared directory.</span></span><br><span class="line"><span class="comment"># All folders will be created automatically on Mina Setup.</span></span><br><span class="line"><span class="comment"># Don't forget to add a path to the uploads folder if you are using Dragonfly or Carrierwaves.</span></span><br><span class="line"><span class="comment"># Otherwise, you will lose your uploads on each deploy.</span></span><br><span class="line">set <span class="symbol">:shared_dirs</span>, fetch(<span class="symbol">:shared_dirs</span>, []).push(<span class="string">'log'</span>, <span class="string">'tmp/pids'</span>, <span class="string">'tmp/sockets'</span>, <span class="string">'public/uploads'</span>)</span><br><span class="line">set <span class="symbol">:shared_files</span>, fetch(<span class="symbol">:shared_files</span>, []).push(<span class="string">'config/database.yml'</span>, <span class="string">'config/secrets.yml'</span>, <span class="string">'config/puma.rb'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Username of ssh for access to the remote server.</span></span><br><span class="line">set <span class="symbol">:user</span>, <span class="string">'root'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># This is not a required field, you can use it to set an app name for easy recognition.</span></span><br><span class="line">set <span class="symbol">:application_name</span>, <span class="string">'MyApp'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set ruby version. If you have RVM installed globally, you'll also need to set an RVM path,</span></span><br><span class="line"><span class="comment"># like set:rvm_use_path, '/usr/local/rvm/scripts/rvm'.</span></span><br><span class="line"><span class="comment"># You can find the RVM location with rvm info command.</span></span><br><span class="line">task <span class="symbol">:environment</span> <span class="keyword">do</span></span><br><span class="line">  invoke <span class="symbol">:<span class="string">'rvm:use'</span></span>, <span class="string">'ruby-2.5.1@default'</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>By default, Mina will create all folders mentioned in shared_dirs and shared_files.</p><p>You deploy section in deploy.rb should look like this:</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">task <span class="symbol">:deploy</span> <span class="keyword">do</span></span><br><span class="line">  deploy <span class="keyword">do</span></span><br><span class="line">    comment <span class="string">"Deploying <span class="subst">#&#123;fetch(<span class="symbol">:application_name</span>)&#125;</span> to <span class="subst">#&#123;fetch(<span class="symbol">:domain</span>)&#125;</span>:<span class="subst">#&#123;fetch(<span class="symbol">:deploy_to</span>)&#125;</span>"</span></span><br><span class="line">    invoke <span class="symbol">:<span class="string">'git:clone'</span></span></span><br><span class="line">    invoke <span class="symbol">:<span class="string">'deploy:link_shared_paths'</span></span></span><br><span class="line">    invoke <span class="symbol">:<span class="string">'rvm:load_env_vars'</span></span></span><br><span class="line">    invoke <span class="symbol">:<span class="string">'bundle:install'</span></span></span><br><span class="line">    invoke <span class="symbol">:<span class="string">'rails:db_migrate'</span></span></span><br><span class="line">    command <span class="string">%&#123;<span class="subst">#&#123;fetch(<span class="symbol">:rails</span>) <span class="symbol">db:</span>seed&#125;</span>&#125;</span></span><br><span class="line">    invoke <span class="symbol">:<span class="string">'rails:assets_precompile'</span></span></span><br><span class="line">    invoke <span class="symbol">:<span class="string">'deploy:cleanup'</span></span></span><br><span class="line"></span><br><span class="line">    on <span class="symbol">:launch</span> <span class="keyword">do</span></span><br><span class="line">      invoke <span class="symbol">:<span class="string">'puma:phased_restart'</span></span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h3 id="Puma-Setup"><a href="#Puma-Setup" class="headerlink" title="Puma Setup"></a>Puma Setup</h3><p>Create or fill a puma.rb file in a config folder</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">environment <span class="string">"productino"</span></span><br><span class="line"></span><br><span class="line">bind <span class="string">"unix:///&#123;path_to_your_app&#125;/shared/tmp/sockets/puma.sock"</span></span><br><span class="line">pidfile <span class="string">"/&#123;path_to_your_app&#125;/shared/tmp/pids/puma.pid"</span></span><br><span class="line">state_path <span class="string">"/&#123;path_to_your_app&#125;/shared/tmp/sockets/puma.state"</span></span><br><span class="line">directory <span class="string">"/&#123;path_to_your_app&#125;/current"</span></span><br><span class="line"></span><br><span class="line">workers <span class="number">2</span></span><br><span class="line">threads <span class="number">1</span>,<span class="number">2</span></span><br><span class="line"></span><br><span class="line">daemonize <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">activate_control_app <span class="string">'unix:///&#123;path_to_your_app&#125;/shared/tmp/sockets/pumactl.sock'</span></span><br><span class="line"></span><br><span class="line">prune_bundler</span><br></pre></td></tr></table></figure><h3 id="Fill-database-yml-and-secrets-yml"><a href="#Fill-database-yml-and-secrets-yml" class="headerlink" title="Fill database.yml and secrets.yml"></a>Fill database.yml and secrets.yml</h3><h3 id="Setup-nginx"><a href="#Setup-nginx" class="headerlink" title="Setup nginx"></a>Setup nginx</h3><p>Create file myapp.conf in a <code>/nginx/etc/conf.d</code> folder with similar content.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">upstream mysite &#123;</span><br><span class="line">  server unix:///home/admin/mysite/shared/tmp/sockets/puma.sock fail_timeout=0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">  listen 80;</span><br><span class="line">  listen [::]:80;</span><br><span class="line"></span><br><span class="line">  server_name mysite.com;</span><br><span class="line">  root /home/admin/mysite/current/public;</span><br><span class="line"></span><br><span class="line">  location ~ ^/assets/ &#123;</span><br><span class="line">    expires max;</span><br><span class="line">    gzip_static on;</span><br><span class="line">    gzip_vary on;</span><br><span class="line">    add_header Cache-Control public;</span><br><span class="line">    break;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  location / &#123;</span><br><span class="line">    proxy_pass http://mysite;</span><br><span class="line">    proxy_set_header Host $host;</span><br><span class="line">    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  location ~ ^/(500|404|422).html &#123;</span><br><span class="line">    root /home/admin/mysite/current/public;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  error_page 500 502 503 504 /500.html;</span><br><span class="line">  error_page 404 /404.html;</span><br><span class="line">  error_page 422 /422.html;</span><br><span class="line"></span><br><span class="line">  client_max_body_size 4G;</span><br><span class="line">  keepalive_timeout 10;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> Ruby, Rails, RoR, Mina </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>What Blockchain Came With</title>
      <link href="/2018/02/14/What-Blockchain-came-with/"/>
      <content type="html"><![CDATA[<p><a href="http://naotu.baidu.com/file/1d400c82d65cd3fd530ffc55d8eb3783?token=5e57783dc51b3617" target="_blank" rel="noopener">MindMap</a></p><embed src="http://naotu.baidu.com/file/1d400c82d65cd3fd530ffc55d8eb3783?token=5e57783dc51b3617" width="100%" height="30vh">]]></content>
      
      
        <tags>
            
            <tag> Blockchain </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Ethereum + IPFS</title>
      <link href="/2018/02/14/Ethereum-IPFS/"/>
      <content type="html"><![CDATA[<p><a href="http://naotu.baidu.com/file/2b8d146aa6314a4205c8573a7e84f834?token=c4a7105f4f935d63" target="_blank" rel="noopener">MindMap</a></p><embed src="http://naotu.baidu.com/file/2b8d146aa6314a4205c8573a7e84f834?token=c4a7105f4f935d63" width="100%" height="30vh">]]></content>
      
      
        <tags>
            
            <tag> Ethereum, IPFS </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Gas Used by Public and External Function in Solidity</title>
      <link href="/2018/01/29/Gas-Used-by-Public-and-External-Function-in-Solidity/"/>
      <content type="html"><![CDATA[<p><a href="https://ethereum.stackexchange.com/questions/19380/external-vs-public-best-practices?answertab=active#tab-top" target="_blank" rel="noopener">Origin</a></p><p>A simple example demostrating this effect looks like this:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">contract Test &#123;</span><br><span class="line">  function test(uint[20] a) public returns (uint) &#123;</span><br><span class="line">    return a[10] * 2;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function test2(uint[20] a) external returnss (uint) &#123;</span><br><span class="line">    return a[10] * 2;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Calling each function, the <code>public</code> function uses 496 gas, while the <code>external</code> function uses 261 gas.</p><p>The difference is because in public functions, Solidity immediately copies array argument to <strong>memory</strong>, while external functions can read directly from <strong>calldata</strong>. Memory allocation is expensive, whereas reading from calldata is cheap.</p><p>The reason that <code>public</code> functions need to write all the arguments to memory is that public functions may be called internally, which is actually an entirely different process than external calls.</p><p>Internal calls are executed via jumps in the code, and array arguments are passed internally by pointers to memory. Thus, <strong>when the compiler generates the code for an internal function, that function expects its arguments to be located in memory</strong>.</p><p>For external functions, the compiler doesnât need to allow internal calls, and so it allows arguments to be read directly from calldata, saving the copying step.</p><p>As for best practices, you should use <code>external</code> fi you expect that the function will only ever be called externally, and use public if you need to call the function internally. It almost never makes sense to use the <code>this.f()</code> pattern, as this requires a real <code>CALL</code> to be executed, which is expensive. Also, passing arrays via this method would be far more expensive than passing them internally.</p>]]></content>
      
      
        <tags>
            
            <tag> Solidity, Public, External </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>æºè½åçº¦ç¼åæ³¨æäºé¡¹</title>
      <link href="/2018/01/29/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E7%BC%96%E5%86%99%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9/"/>
      <content type="html"><![CDATA[<p><a href="https://medium.com/loom-network/how-to-secure-your-smart-contracts-6-solidity-vulnerabilities-and-how-to-avoid-them-part-1-c33048d4d17d" target="_blank" rel="noopener">åæè¿æ¥</a></p><h3 id="Overflow-ä¸-Underflow"><a href="#Overflow-ä¸-Underflow" class="headerlink" title="Overflow ä¸ Underflow"></a>Overflow ä¸ Underflow</h3><p>Solidity å¯ä»¥å¤ç 256 ä½æ°å­, æé«ä¸º 2<strong>256 - 1, æä»¥å¯¹ (2 </strong> 256 - 1) å  1 ä¼å¯¼è´å½ 0.</p><p>åç, å¯¹ unsigned ç±»å 0 åå 1 è¿ç®ä¼å¾å° (2**256 - 1)</p><p>æµè¯ä»£ç å¦ä¸</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity 0.4.18;</span><br><span class="line"></span><br><span class="line">contract OverflowUnderflow &#123;</span><br><span class="line">    uint public zero = 0;</span><br><span class="line">    uint public max = 2**256 - 1;</span><br><span class="line"></span><br><span class="line">    // zero will end up at  2 ** 256 - 1</span><br><span class="line">    function underflow() public &#123;</span><br><span class="line">        zero -= 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function overflow() public &#123;</span><br><span class="line">        max += 1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°½ç®¡ä»ä»¬åæ ·å±é©, ä½æ¯å¨æºè½åçº¦ä¸­, underflow é æçå½±åæ´å¤§.</p><p>æ¯å¦, è´¦å· A ææ X tokens, å¦æä»åèµ·ä¸ç¬ X + 1 tokens çäº¤æ, å¦æä»£ç ä¸è¿è¡æ ¡éª, åè´¦å· A çä½é¢å¯è½åç underflow å¯¼è´ä½é¢åå¤.</p><p>å¯ä»¥å¼å¥ <strong>SafeMath Library</strong> è§£å³</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity 0.4.18;</span><br><span class="line"></span><br><span class="line">library SafeMath &#123;</span><br><span class="line">    function mul(uint256 a, uint256 b) internal pure returns (uint256) &#123;</span><br><span class="line">        if (a==0) &#123;</span><br><span class="line">            return 0;</span><br><span class="line">        &#125;</span><br><span class="line">        uint c = a * b;</span><br><span class="line">        assert(c / a == b);</span><br><span class="line">        return c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function div(uint256 a, uint256 b) internal pure returns (uint256) &#123;</span><br><span class="line">        uint256 c = a / b;</span><br><span class="line">        return c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function sub(uint256 a, uint256 b) internal pure returns (uint256) &#123;</span><br><span class="line">        assert(b &lt;= a);</span><br><span class="line">        return a - b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function add(uint256 a, uint256 b) internal pure returns (uint256) &#123;</span><br><span class="line">        uint256 c = a + b;</span><br><span class="line">        assert(c &gt;= a);</span><br><span class="line">        return c;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract OverflowUnderflow &#123;</span><br><span class="line">    using SafeMath for uint;</span><br><span class="line">    uint public zero = 0;</span><br><span class="line">    uint public max = 2 ** 256 - 1;</span><br><span class="line"></span><br><span class="line">    function underflow() public &#123;</span><br><span class="line">        zero = zero.sub(1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function overflow() public &#123;</span><br><span class="line">        max = max.add(1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Visibility-ä¸-Delegatecall"><a href="#Visibility-ä¸-Delegatecall" class="headerlink" title="Visibility ä¸ Delegatecall"></a>Visibility ä¸ Delegatecall</h3><ul><li><p><strong>Public</strong> functions å¯ä»¥è¢«ä»»æå°åè°ç¨</p></li><li><p><strong>External</strong> functions åªè½ä»åçº¦å¤é¨è°ç¨</p></li><li><p><strong>Private</strong> functions åªè½ä»åçº¦åé¨è°ç¨</p></li><li><p><strong>Internal</strong> functions åè®¸ä»åçº¦åå¶å­åçº¦è°ç¨</p></li></ul><p><strong>External</strong> functions æ¶èç gas æ¯ public å°, å ä¸ºå¶ä½¿ç¨ <code>calldata</code> è <strong>Public</strong> éè¦å¤å¶ææåæ°å° memory.</p><h5 id="Delegatecall"><a href="#Delegatecall" class="headerlink" title="Delegatecall"></a>Delegatecall</h5><p>å¼èª <a href="http://solidity.readthedocs.io/en/develop/introduction-to-smart-contracts.html?highlight=delegatecall#delegatecall-callcode-and-libraries" target="_blank" rel="noopener">Solidity Docs</a></p><blockquote><p>Delegatecall is identical to a message call apart from the fact that the code at the target address is executed in the context of the calling contract and <code>msg.sender</code> and <code>msg.value</code> do not change their values.</p><p>This means that a contract can dynamically load code from a different address at runtime. Storage, current address and balance still refer to the calling contract, only the code is taken from the called address.</p></blockquote><p>è¿ä¸ªç¹æ§å¯ä»¥ç¨äºæå»º Library åæ¨¡ååä»£ç . ä½æ¯ä¸æ­¤åæ¶, è¿ä¹æå¯è½é æå«äººå¯¹ä½ çä»£ç è¿è¡æä½.</p><p>ä¸ä¾ä¸­, æ»å»èè°ç¨ <code>pwn</code> æ¹æ³è·å¾äºåçº¦çæ¥ææ.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity 0.4.18;</span><br><span class="line"></span><br><span class="line">contract Delegate &#123;</span><br><span class="line">    address public owner;</span><br><span class="line"></span><br><span class="line">    function Delegate(address _owner) public &#123;</span><br><span class="line">        owner = _owner;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function pwn() public &#123;</span><br><span class="line">        owner = msg.sender;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract Deletagion &#123;</span><br><span class="line">    address public owner;</span><br><span class="line">    Delegate delegate;</span><br><span class="line"></span><br><span class="line">    function Delegation(address _delegateAddreses) public &#123;</span><br><span class="line">        delegate = Delegate(_delegateAddreses);</span><br><span class="line">        owner = msg.sender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // an attacker can call Delegate.pwn() in the context of Delegation, this means that pwn() will modify the state of **Delegation** and not Delegate, the result is that the attacker takes unauthorized ownership of the contract.</span><br><span class="line">    function () public &#123;</span><br><span class="line">        if(delegate.delegatecall(msg.data)) &#123;</span><br><span class="line">            this;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Reentrancy-TheDAO-hack"><a href="#Reentrancy-TheDAO-hack" class="headerlink" title="Reentrancy(TheDAO hack)"></a>Reentrancy(TheDAO hack)</h3><p>Solidity ä¸­ <code>call</code> å½æ°è¢«è°ç¨æ¶, å¦æå¸¦æ value åæ°, åä¼è½¬åææä»ææ¶å°ç gas.</p><p>å¨ä¸ä¸ä»£ç çæ®µä¸­, <code>call</code> å½æ°å¨ sender çä½é¢å®éåå°åè¢«è°ç¨. è¿éæä¸ä¸ªæ¼æ´æ¾å¯¼è´ TheDAO æ»å».</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function withdraw(uint _amount) public &#123;</span><br><span class="line">  if(balances[msg.sender] &gt;= _amount) &#123;</span><br><span class="line">    if(msg.sender.call.value(_amount)()) &#123;</span><br><span class="line">      _amount;</span><br><span class="line">    &#125;</span><br><span class="line">    balances[msg.sender] -= amount;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¼èª <a href="https://www.reddit.com/r/ethereum/comments/4oi2ta/i_think_thedao_is_getting_drained_right_now/d4cxvc3/" target="_blank" rel="noopener">Reddit</a> çè§£é</p><blockquote><p>In simple words, itâs like the bank teller doesnât change your balance until she has given you all the money you requested. âCan I withdraw $500? Wait, before that , can I withdraw $500?â</p></blockquote><blockquote><p>And so on. The smart contracts as designed only check you have $500 at beginning once, and allow themselves to be interrupted.</p></blockquote>]]></content>
      
      
        <tags>
            
            <tag> Solidity, Smart Contract </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Start in Protobuf</title>
      <link href="/2017/12/22/Start-in-Protobuf/"/>
      <content type="html"><![CDATA[<p><strong>Protocol Buffers</strong> are a language-neutral, platform-neutral, extensible way of serializing structured data for use in commnucations protocols, data storage, and more, originally designed at Google.</p><p><strong>Protobuf.js</strong> is a pure JS implementation with <strong>TypeScript</strong> support for node.js and browser. Itâs easy to use, blazingly fast and works out of the box with <code>.proto</code> files.</p><h3 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h3><p>Node.js</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install protobufjs</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> protobuf = <span class="built_in">require</span>(<span class="string">'protobufjs'</span>)</span><br></pre></td></tr></table></figure><p>Browsers</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../protobuf.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Distributions"><a href="#Distributions" class="headerlink" title="Distributions"></a>Distributions</h3><p>Where bundle size is a factor, there are additional stripped-down versions of the full-library(~19kb gzipped) available that excldue certain functinality</p><ul><li>when working with JSON descriptor, and/or reflection only, see the light-library(~16kb gzipped) that excludes the parser. CommonJS entry point is:</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> protobuf = <span class="built_in">require</span>(<span class="string">'protobufjs/light'</span>)</span><br></pre></td></tr></table></figure><p>When working with statically generated code only, see the minimal library(~6.5kb gzipped) that also excludes reflection. CommonJS entry point is:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> protobuf = <span class="built_in">require</span>(<span class="string">'protobufjs/minimal`)</span></span><br></pre></td></tr></table></figure><h3 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h3><p>Because JS is a dynamically typed language, protobuf.js introduces the concept of a <strong>valid message</strong> in order to provide the best possible performance.</p><h4 id="Valid-Message"><a href="#Valid-Message" class="headerlink" title="Valid Message"></a>Valid Message</h4><blockquote><p>A valid message is an object not missing any required fields and exclusively composed of JS types understood by the wire format writer.</p></blockquote><p>There are two possible types of valid messages and the encoder is able to work with both these for convenience:</p><ul><li><p><strong>Message Instance</strong> (explicit instance of message classes with default values on their prototype) always (have to) satisfy the requirements of a valid message by design.</p></li><li><p><strong>Plain JavaScript Objects</strong> that just so happen to be composed in a way satisfying the requirements of a valid message as well.</p></li></ul><p>In a nutshell, the wire format writer understoods the following types:</p><table><thead><tr><th>Field Type</th><th>Expected JS type(create, encode)</th><th>Conversion (fromObject)</th></tr></thead><tbody><tr><td>s-/u-/int32<br>s-/fixed32</td><td><code>number</code> (32 bit integer)</td><td>`value</td><td>0<code>if signed&lt;br&gt;</code>value &gt;&gt;&gt; 0` is unsigned</td></tr><tr><td>s-/u-/int64<br>s-/fixed64</td><td><code>Long</code>-like(optimal)<br><code>number</code>(53 bit integer)</td><td><code>Long.fromValue(value)</code> with long.js<br><code>parseInt(value, 10)</code> otherwise</td></tr><tr><td>float<br>double</td><td><code>number</code></td><td><code>Number(value)</code></td></tr><tr><td>bool</td><td><code>boolean</code></td><td><code>Boolean(value)</code></td></tr><tr><td>string</td><td><code>string</code></td><td><code>String(value)</code></td></tr><tr><td>bytes</td><td><code>Uint8Array</code>(optimal)<br><code>Buffer</code>(optimal under node)<br><code>Array.&lt;number&gt;</code>(8 bit integers)</td><td><code>base64.decode(value)</code> if a <code>string</code><br><code>Object</code> with non-zero<code>.length</code> is assumed to be buffer-like</td></tr><tr><td>enum</td><td><code>number</code> (32 bit integer)</td><td>Looks up the numeric id if a <code>string</code></td></tr><tr><td>message</td><td>Valid Message</td><td><code>Message.fromObject(value)</code></td></tr></tbody></table><ul><li><p>Explicit <code>undefined</code> and <code>null</code> are considered as not set if the field is optional</p></li><li><p>Repeated fields are <code>Array.&lt;T&gt;</code></p></li><li><p>Map fields are <code>Object.&lt;string, T&gt;</code> with the key being the string representation of the respective value or an 8 character long binary hash string for <code>Long</code>-likes.</p></li><li><p>Types marked as <em>optimal</em> provide the best performance because no conversion step(i.e. number to low and high bits or base64 string to buffer) is required.</p></li></ul><p>For performance reasons, each message class provides a distinct set of methods with each method doing just one thing. This avoid unnecessary assertions / redundant operations where performance is a concern but also forces a user to perform verification explicityly where necessary.</p><h3 id="Methods"><a href="#Methods" class="headerlink" title="Methods"></a>Methods</h3><ul><li><p>Message.verify(message: Object): null | string</p></li><li><p>Message.encode(message: Message | Object[, writer: Writer]): Writer</p></li><li><p>Message.encodeDelimited(message: Message | Object[, writer: Writer]): Writer</p></li><li><p>Message.decode(reader: Reader | Uint8Array): Message</p></li><li><p>Message.toObject(message: Message[, options: ConversionOptions]): Object</p></li><li><p>Message.verify(message: Object): null | string</p><p>Verifies that a plain js object satisfies the requirements of a valid message and thus can be encoded without issues. Instead of throwing, it returns the error message as a string, if any:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> payload = <span class="string">'invalid (not an object)'</span></span><br><span class="line"><span class="keyword">var</span> err = AwesomeMessage.verify(payload)</span><br><span class="line"><span class="keyword">if</span> (err) <span class="keyword">throw</span> <span class="built_in">Error</span>(err)</span><br></pre></td></tr></table></figure></li><li><p>Message.encode(message: Message | Object[, writer: Writer]): Writer</p></li></ul><p>Encodes a message instance or valid plain javascript object. This method does not implicit verify the message and itâs up to user to make sure that the payload is a valid message.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> buffer = AwesomeBuffer.encode(message).finish()</span><br></pre></td></tr></table></figure><ul><li>Message.encodeDelimited(message: Message | Object[, writer: Writer]): Writer</li></ul><p>Works like <code>Message.encode</code> but additionally prepends the length of the message as a varint.</p><ul><li>Message.decode(reader: Reader): Message</li></ul><p>Decode a buffer to a message instance. If required fields are missing, it throws a <code>util.ProtocolError</code> with an <code>instance</code> property set to the so far decoded message. If the wire format is invalid, it throws an <code>Error</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="keyword">var</span> decodedMessage = AwesomeMessage.decode(buffer)</span><br><span class="line">&#125; cache (e) &#123;</span><br><span class="line">  <span class="keyword">if</span> (e <span class="keyword">instanceof</span> protobuf.util.ProtocolError) &#123;</span><br><span class="line">    <span class="comment">// e.instance holds the so far decoded message with missing required fields</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// wire format is invalid</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Message.decodeDelimited(reader: Reader | Uint8Array): Message</li></ul><p>works like Message.decode but additionally reads the length of the message prepended as a varint</p><ul><li>Message.create(properties: Object): Message</li></ul><p>Creates a new message instance from a set of properties that satisfy the requirements of a valid message. Where applicable, it is recommended to prefer <code>Message.create</code> over <code>Message.fromObject</code> because it doesnât perform possibly redundant conversion.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> message = AwesomeMessage.create(&#123; <span class="attr">awesomeField</span>: <span class="string">'AwesomeString'</span> &#125;)</span><br></pre></td></tr></table></figure><ul><li>Message.fromObject(object: Object): Message</li></ul><p>Converts any non-valid plain javascript object to a message instance using the conversion steps outlined within the table above.</p><ul><li>Message.toObject(message: Message[, options: ConversionOptions]): Object</li></ul><p>Converts a message instance to an arbitrary plain javascript object for interoperability with other libraries or storage. The resulting plain javascript object might still satisify the requirements of a vlaid message depending on the actual conversion options specified, but most of the time it does not.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> object = AwesomeMessage.toObject(message, &#123;</span><br><span class="line">  enums: <span class="built_in">String</span>,</span><br><span class="line">  longs: <span class="built_in">String</span>,</span><br><span class="line">  bytes: <span class="built_in">String</span>,</span><br><span class="line">  defaults: <span class="literal">true</span>,</span><br><span class="line">  arrays: <span class="literal">true</span>,</span><br><span class="line">  objects: <span class="literal">true</span>,</span><br><span class="line">  oneofs: <span class="literal">true</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>For reference, the following diagram aims to display relationships between the different methods and the concepts of a valid message:</p><p><img src="https://camo.githubusercontent.com/f090df881cc6c82ecb7c5d09c9fad550fdfd153e/687474703a2f2f64636f64652e696f2f70726f746f6275662e6a732f746f6f6c7365742e737667" alt=""></p><blockquote><p>In other words: <code>verify</code> indicates that calling <code>create</code> or <code>encode</code> directly on the plain object will [result in a valid message respectively] succeed. <code>fromObject</code>, on the other hand, does conversion from a broader range of plain objects to create valid message.</p></blockquote><h3 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h3><h4 id="Using-proto-files"><a href="#Using-proto-files" class="headerlink" title="Using .proto files"></a>Using .proto files</h4><p>It is possible to load existing .proto files using the full library, which parses and compiles the definitions to ready to use (reflection-based) message classes:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">package awesomepackage</span><br><span class="line">syntax = <span class="string">"proto3"</span></span><br><span class="line"></span><br><span class="line">message AwesomeMessage &#123;</span><br><span class="line">  string awesome_field = <span class="number">1</span>; becomes awesomeField</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">protobuf.load(<span class="string">'awesome.proto'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, root</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="keyword">throw</span> err</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// Obtain a message type</span></span><br><span class="line">  <span class="keyword">var</span> AwesomeMessage = root.lookupType(<span class="string">'awesomepackage.AwesomeMessage'</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Exemplary payload</span></span><br><span class="line">  <span class="keyword">var</span> payload = &#123; <span class="attr">awesomeField</span>: <span class="string">'AwesomeField'</span> &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Verify the payload if necessary(i.e. when possible incomplete or invalid)</span></span><br><span class="line">  <span class="keyword">var</span> errMsg = AwesomeMessage.verify(payload)</span><br><span class="line">  <span class="keyword">if</span> (errMsg) <span class="keyword">throw</span> <span class="built_in">Error</span>(errMsg)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Create a new message</span></span><br><span class="line">  <span class="keyword">var</span> message = AwesomeMessage.create(payload) <span class="comment">// or use .fromObject if conversion is necessary</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Encode a message to an Uint8Array(browser) or Buffer (node)</span></span><br><span class="line">  <span class="keyword">var</span> buffer = AwesomeMessage.encode(message).finish()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ... do something with message</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Decode an Uint8Array(browser) or Buffer(node) to a message</span></span><br><span class="line">  <span class="keyword">var</span> message = AwesomeMessage.decode(buffer)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...do something with message</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// If the application uses length-delimited buffers, there is also encodeDelimited and decodeDelimited.</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Maybe conver the message back to a plain object</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> object = AwesomeMessage.toObject(message, &#123;</span><br><span class="line">    loings: <span class="built_in">String</span>,</span><br><span class="line">    enums: <span class="built_in">String</span>,</span><br><span class="line">    bytes: <span class="built_in">String</span>,</span><br><span class="line">    <span class="comment">// see Conversions</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Additionally, promise syntax can be used by omitting the callback, if preferred:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protobuf.load(<span class="string">'awesome.proto'</span>).then(<span class="function"><span class="params">root</span> =&gt;</span> &#123;&#125;)</span><br></pre></td></tr></table></figure><h3 id="Using-JSON-Descriptors"><a href="#Using-JSON-Descriptors" class="headerlink" title="Using JSON Descriptors"></a>Using JSON Descriptors</h3><p>The library utilize JSON descriptor that are equivalent to a .proto definition. For example, the following is identical to the .proto definition seen above:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// awesome.json</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"nested"</span>: &#123;</span><br><span class="line">    <span class="attr">"AwesomeMessage"</span>: &#123;</span><br><span class="line">      <span class="attr">"fields"</span>: &#123;</span><br><span class="line">        <span class="attr">"awesomeField: &#123;</span></span><br><span class="line">          "type": "string",</span><br><span class="line">          "id", 1</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>JSON descriptor closely resemble the internal reflection structure:</p><p>Exclusively using JSON descriptor instead of .proto files enables the use of just the light library(the parser isnât requried in this case)</p><p>A JSON descriptor can either be loaded the usual way:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">protobuf.load(<span class="string">'awesome.json'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, root</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> <span class="built_in">Error</span>(err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Or it can be loaded inline:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> jsonDescriptor = <span class="built_in">require</span>(<span class="string">'./awesome.json'</span>) <span class="comment">// exemplary for node</span></span><br><span class="line"><span class="keyword">var</span> root = protobuf.Root.fromJSON(jsonDescriptor)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Continue at 'Obtain a message type' above</span></span><br></pre></td></tr></table></figure><p><a href="https://github.com/dcodeIO/ProtoBuf.js/" target="_blank" rel="noopener">More Info here</a></p><h3 id="Usage-with-TypeScript"><a href="#Usage-with-TypeScript" class="headerlink" title="Usage with TypeScript"></a>Usage with TypeScript</h3><p>The library ships with its own type definitions and modern editors will automatically detect and use them for code completion.</p><p>The npm package depends on <code>@types/node</code> because of <code>Buffer</code> and <code>@types/long</code> because of <code>Long</code>. If you are not building for node and/or using long.js, it should be safe to exclude them manually.</p><h4 id="Using-the-JS-API"><a href="#Using-the-JS-API" class="headerlink" title="Using the JS API"></a>Using the JS API</h4><p>The API shown above works pretty much the same with TypeScript. However, because everything is typed, accessing fields on instances of dynamically generated message classes requries either using bracket-notation(i.e. message[âawesomeFieldâ]), or explicit casts.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; load &#125; <span class="keyword">from</span> <span class="string">'protobufjs'</span></span><br><span class="line"></span><br><span class="line">load(<span class="string">'awesome.proto'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, root</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> <span class="built_in">Error</span>(err)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> AwesomeMessage = root.lookupType(<span class="string">'awesomepackage.AwesomeMessage'</span>)</span><br><span class="line">  <span class="keyword">let</span> message = AwesomeMessage.create(&#123; <span class="attr">awesomeField</span>: <span class="string">'hello'</span> &#125;)</span><br><span class="line">  cnosole.log(<span class="string">`message = <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(message)&#125;</span>`</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> buffer = AwesomeMessage.encode(message).finish()</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Buffer = <span class="subst">$&#123;<span class="built_in">Array</span>.prototype.toString.call(buffer)&#125;</span>`</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> decoded = AwesomeMessage.decode(buffer)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`decoded = <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(decoded)&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> Protobuf </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Get the Most Out of the CommonsChunkPlugin</title>
      <link href="/2017/12/07/Get-the-most-out-of-the-CommonsChunkPlugin/"/>
      <content type="html"><![CDATA[<p><a href="https://medium.com/webpack/webpack-bits-getting-the-most-out-of-the-commonschunkplugin-ab389e5f318" target="_blank" rel="noopener">Origin</a></p><p>Use <code>webpack-bundle-analyzer</code> to generate a fancy colorful image of all of your<br>bundles.</p><h3 id="Case-1-Many-vendor-bundles-with-duplicate-code"><a href="#Case-1-Many-vendor-bundles-with-duplicate-code" class="headerlink" title="Case 1: Many vendor bundles with duplicate code"></a>Case 1: Many vendor bundles with duplicate code</h3><p><img src="https://cdn-images-1.medium.com/max/2000/1*Mt5awEvcigXceRDpZRX4Dw.png" alt=""></p><p>Each single-page app is using a <code>new CommonsChunkPlugin</code> that targets just that<br>entry point, and its vendor code. This creates a bundle with only modules that<br>come from node_modules folder, and another bundle with just application code.</p><p>The configuration portion was provided:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.keys(activeApps).map(</span><br><span class="line">  app =&gt;</span><br><span class="line">    <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">      name: <span class="string">`<span class="subst">$&#123;app&#125;</span>_vendor`</span>,</span><br><span class="line">      chunk: [app],</span><br><span class="line">      minChunks: isVendor,</span><br><span class="line">    &#125;),</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>The <code>activeApps</code> variable most likely represents each of the individual entry<br>points.</p><p>Below are a few areas that could use some improvement.</p><p><img src="https://cdn-images-1.medium.com/max/800/1*D4m4sa9X1V05y7I7ZCMbZA.png" alt=""></p><h3 id="âMetaâ-caching"><a href="#âMetaâ-caching" class="headerlink" title="âMetaâ caching"></a>âMetaâ caching</h3><p>What we see above is many large libraries like momentjs, lodash, and jquery<br>being used across 6 or more vendor bundles. The strategy for add all vendor into<br>a seperate bundle is good, but we should also apply the same strategy acroll<br><strong>all vendor bundle</strong>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.optimizeCommonsChunkPlugin(&#123;</span><br><span class="line">  children: <span class="literal">true</span>,</span><br><span class="line">  minChunks: <span class="number">6</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>We are telling the webpack to follow:</p><blockquote><p>Hey webpack, look across all chunks(including the vendor ones that were<br>generated) and move any modules that occur in at least 6 chunks to a seperate<br>file.</p></blockquote><h3 id="Case-2-duplicate-vendors-across-async-chunks"><a href="#Case-2-duplicate-vendors-across-async-chunks" class="headerlink" title="Case 2: duplicate vendors across async chunks"></a>Case 2: duplicate vendors across async chunks</h3><p><img src="https://cdn-images-1.medium.com/max/2000/1*yRCgk_pzDpkMfQGKpCO_HA.jpeg" alt=""></p><p>As you can see, the same 2-3 components are used across all 40-50 async bundles</p><p><code>CommonsChunkPlugin</code> can solve this.</p><h4 id="Create-an-async-Commons-Chunk"><a href="#Create-an-async-Commons-Chunk" class="headerlink" title="Create an async Commons Chunk"></a>Create an async Commons Chunk</h4><p>The technique will be very simillar to the first, however we will need to set<br>the <code>async</code> property in the configuration option, to <code>true</code> as seen below:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">  <span class="keyword">async</span>: <span class="literal">true</span>,</span><br><span class="line">  children: <span class="literal">true</span>,</span><br><span class="line">  filename: <span class="string">'commonlazy.js'</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>In the same way â webpack will scan all chunks and look for common modules.<br>Since <code>async: true</code>, only code split bundles will be scanned.</p><p>Because we did not specify <code>minChunks</code>, the value default to 3. so what webpack<br>is being told is:</p><blockquote><p>Hey webpack, look through all normal [aka lazy loaded] chunks and if you find<br>the smae module that appears across 3 or more chunks, then seperate it out<br>into a seperate async commons chunk.</p></blockquote><h3 id="More-Control"><a href="#More-Control" class="headerlink" title="More Control"></a>More Control</h3><h4 id="minChunks-function"><a href="#minChunks-function" class="headerlink" title="minChunks function"></a>minChunks function</h4><p>There are scenario you donât want to have a single shared bundle because not<br>every lazy/entry chunk may use it. The <code>minChunks</code> property also takes a<br>function. This can be your âfiltering predicateâ for what modules are added to<br>your newly created bundle.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">  filename: <span class="string">'loash-moment-shared-bundle.js'</span>,</span><br><span class="line">  minChunks: <span class="function"><span class="keyword">function</span>(<span class="params">module, count</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="built_in">module</span>.resource &amp;&amp; <span class="regexp">/lodash|moment/</span>.test(<span class="built_in">module</span>.resource) &amp;&amp; count &gt;= <span class="number">3</span></span><br><span class="line">    )</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>This example says:</p><blockquote><p>Yo webpack, when you come across a module whos absolute path amtches lodash or<br>moment, and occurs across 3 seperate entries/chunks, then extract those<br>modules into a seperate bundle.</p></blockquote>]]></content>
      
      
        <tags>
            
            <tag> Webpack </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Go Web</title>
      <link href="/2017/12/05/Go-Web/"/>
      <content type="html"><![CDATA[<p><a href="https://gowebexamples.com/hello-world/" target="_blank" rel="noopener">Origin</a></p><h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p>Go is a battery included programming language and has a webserver already built<br>in.</p><p>The <code>net/http</code> package from the standard library contains all functionalities<br>about the HTTP protocol.</p><p>This includes an HTTP client and an HTTP server.</p><h3 id="Registering-a-Request-Handler"><a href="#Registering-a-Request-Handler" class="headerlink" title="Registering a Request Handler"></a>Registering a Request Handler</h3><p>First, create a Handler which receives all incoming HTTP connections from<br>browsers, HTTP client or API requests. A handler in Go is a function with this<br>signature.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(w http.ResponseWriter, r *http.Request)</span></span></span><br></pre></td></tr></table></figure><p>The function receives two parameters:</p><ul><li><p>An <code>http.ResponseWriter</code> which is where you write your text/html response to.</p></li><li><p>An <code>http.Request</code> which contains all information about this HTTP request<br>including like URL or header fields</p></li></ul><p>Registering a request handler to the default HTTP Server is as simple as this:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http.HandleFunc(<span class="string">"/"</span>, <span class="function"><span class="keyword">func</span> <span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">  fmt.Fprintf(w, <span class="string">"Hello, you've requested: %s\n"</span>, r.URL.Path)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Listen-for-HTTP-Connections"><a href="#Listen-for-HTTP-Connections" class="headerlink" title="Listen for HTTP Connections"></a>Listen for HTTP Connections</h3><p>The request handler alone can not accept any HTTP connections from the outside.</p><p>An HTTP server has to listen on a port to pass connections on to the request<br>handler. Because port 80 is in most case the default port for HTTP traffic, this<br>server will also listen on it.</p><p>The following code will start Goâs default HTTP server and listen for<br>connections on port 80. You can navigate your browser to <code>http://localhost/</code> and<br>see your server handling yoru request</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http.ListenAndServe(<span class="string">":80"</span>, <span class="literal">nil</span>)</span><br></pre></td></tr></table></figure><h3 id="The-Code"><a href="#The-Code" class="headerlink" title="The Code"></a>The Code</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"net/http"</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span> <span class="params">()</span></span> &#123;</span><br><span class="line">  http.HandleFunc(<span class="string">"/"</span>, <span class="function"><span class="keyword">func</span> <span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">    fmt.Fprintf(w, <span class="string">"Hello, you've requested: %s\n"</span>, r.URL.Path)</span><br><span class="line">  &#125;)</span><br><span class="line">  http.ListenAndServe(<span class="string">":80"</span>, <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Routing-using-gorilla-mux"><a href="#Routing-using-gorilla-mux" class="headerlink" title="Routing (using gorilla/mux)"></a>Routing (using gorilla/mux)</h3><p>Goâs <code>net/http</code> package provides a lot of functionalities for the HTTP protocol.<br>One thing it doesnât do very well is complex request routing like segmenting a<br>request url into single parameters.</p><p>Use <code>gorilla/mux</code> package to create routes with named parameters, GET/POST<br>handlers and domain restrictions.</p><p><code>gorilla/mux</code> is a package which adapts to Goâs default HTTP router. It comes<br>with a lot of features to increase the productivity when writing web<br>applications. It is also compliant to Goâs default request handler signature<br><code>func (w http.ResponseWriter, r *http.Request)</code>, so package can be mixed and<br>matched with other HTTP libraries like middleware or existing applications. Use<br>the <code>go get</code> command to install the package from Github.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get -u github.com/gorilla/mux</span><br></pre></td></tr></table></figure><h4 id="Creating-a-new-Router"><a href="#Creating-a-new-Router" class="headerlink" title="Creating a new Router"></a>Creating a new Router</h4><p>First create a new request router. The router is the main router for your web<br>application and will later be passed as parameter to the server. It will receive<br>all HTTP connections and pass it on to the request handlers you will register on<br>it. You can create a new router like so:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">r := mux.NewRouter()</span><br></pre></td></tr></table></figure><h4 id="Registering-a-Request-Handler-1"><a href="#Registering-a-Request-Handler-1" class="headerlink" title="Registering a Request Handler"></a>Registering a Request Handler</h4><p>Once you have a new router you can register request handlers like usual. The<br>only difference is that instead of calling <code>http.HandleFunc(...)</code>, you call<br><code>HandleFunc</code> on your router like this <code>r.HandleFunc(...)</code></p><h4 id="URL-Parameters"><a href="#URL-Parameters" class="headerlink" title="URL Parameters"></a>URL Parameters</h4><p>The biggest strength of the <code>gorilla/mux</code> Router is the ability to extract<br>segments from the request URL. As an example, this is a URL in your application</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/books/go-programming-bluepring/page/10</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">r.HandleFunc(<span class="string">"/books/&#123;title&#125;/page/&#123;page&#125;"</span>, <span class="function"><span class="keyword">func</span> <span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">  <span class="comment">// get the book</span></span><br><span class="line">  <span class="comment">// navigate to the page</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>The last thing to get the data from these segments. The package comes with the<br>function <code>mux.Vars(r)</code> which takes the <code>http.Request</code> as parameter and returns a<br>map of the segments.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">  vars := mux.Vars(r)</span><br><span class="line">  vars[<span class="string">"title"</span>]</span><br><span class="line">  vars[<span class="string">"page"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Setting-the-HTTP-serverâs-router"><a href="#Setting-the-HTTP-serverâs-router" class="headerlink" title="Setting the HTTP serverâs router"></a>Setting the HTTP serverâs router</h4><p>Ever wondered what the <code>nil</code> in <code>http.ListenAndServe(&quot;:80&quot;, nil)</code> ment? It is<br>the parameter for the main router of the HTTP server. By default itâs <code>nil</code>,<br>which means to use the default router of the <code>net/http</code> package. To make use of<br>your own router, replace the <code>nil</code> with the variable of your router <code>r</code>.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http.ListenAndServe(<span class="string">":80"</span>, r)</span><br></pre></td></tr></table></figure><h4 id="The-Code-1"><a href="#The-Code-1" class="headerlink" title="The Code"></a>The Code</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"net/http"</span></span><br><span class="line">  <span class="string">"github.com/gorilla/mux"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span> <span class="params">()</span></span> &#123;</span><br><span class="line">  r := mux.NewRouter()</span><br><span class="line">  r.HandleFunc(<span class="string">"/books/&#123;title&#125;/page/&#123;page&#125;"</span>, <span class="function"><span class="keyword">func</span> <span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">    vars := mux.Vars(r)</span><br><span class="line">    title := vars[<span class="string">"title"</span>]</span><br><span class="line">    page := vars[<span class="string">"page"</span>]</span><br><span class="line"></span><br><span class="line">    fmt.Fprintf(w, <span class="string">"You've requested the book %s on page %s\n"</span>, title, page)</span><br><span class="line">  &#125;)</span><br><span class="line">  http.ListenAndServe(<span class="string">":80"</span>, r)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Features-of-the-gorilla-mux-Router"><a href="#Features-of-the-gorilla-mux-Router" class="headerlink" title="Features of the gorilla/mux Router"></a>Features of the <code>gorilla/mux</code> Router</h4><h5 id="Methods"><a href="#Methods" class="headerlink" title="Methods"></a>Methods</h5><p>Restrict the request handler to specific HTTP methods</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">r.HandleFunc(<span class="string">"/books/&#123;title&#125;"</span>, CreateBook).Methods(<span class="string">"POST"</span>)</span><br><span class="line">r.HandleFunc(<span class="string">"/books/&#123;title&#125;"</span>, ReadBook).Methods(<span class="string">"GET"</span>)</span><br><span class="line">r.HandleFunc(<span class="string">"/books/&#123;title&#125;"</span>, UpdateBook).Methods(<span class="string">"PUT"</span>)</span><br><span class="line">r.HandleFunc(<span class="string">"/books/&#123;title&#125;"</span>, DeleteBook).Methods(<span class="string">"DELETE"</span>)</span><br></pre></td></tr></table></figure><h5 id="Hostnames-amp-Subdomains"><a href="#Hostnames-amp-Subdomains" class="headerlink" title="Hostnames &amp; Subdomains"></a>Hostnames &amp; Subdomains</h5><p>Restrict the request handler to specific hostname or subdomain</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">r.HandleFunc(<span class="string">"/books/&#123;title&#125;"</span>, BookHandler).Host(<span class="string">"www.mybookstore.com"</span>)</span><br></pre></td></tr></table></figure><h5 id="Schemes"><a href="#Schemes" class="headerlink" title="Schemes"></a>Schemes</h5><p>Restrict the request handler to http/https</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">r.HandleFunc(<span class="string">"/secure"</span>, SecureHandler).Scheme(<span class="string">"https"</span>)</span><br><span class="line">r.HandleFunc(<span class="string">"/insecure"</span>, InsecureHandler).Scheme(<span class="string">"http"</span>)</span><br></pre></td></tr></table></figure><h5 id="Path-Prefixes-amp-Subrouters"><a href="#Path-Prefixes-amp-Subrouters" class="headerlink" title="Path Prefixes &amp; Subrouters"></a>Path Prefixes &amp; Subrouters</h5><p>Restrict the request handler to specific path prefixes.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bookrouter := r.Path.Prefix(<span class="string">"/books"</span>).subRouter()</span><br><span class="line">bookrouter.HandleFunc(<span class="string">"/"</span>, AllBooks)</span><br><span class="line">bookrouter.HandleFunc(<span class="string">"/&#123;title&#125;"</span>, GetBook)</span><br></pre></td></tr></table></figure><h3 id="Template"><a href="#Template" class="headerlink" title="Template"></a>Template</h3><p>Goâs <code>html/template</code> package provides a rich templating language for HTML<br>templates. It is mostly used in web applications to display data in a structured<br>way in a clientâs browser. One great benefit of Goâs templating language is the<br>automatic escaping of data. There is no need to worry about XSS attacka as Go<br>parses the HTML template and escapes all inputs before displaying it to the<br>browser.</p><h4 id="First-Template"><a href="#First-Template" class="headerlink" title="First Template"></a>First Template</h4>]]></content>
      
      
        <tags>
            
            <tag> Go, Http, Web </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Generate Ethereum Keys and Wallet Address</title>
      <link href="/2017/11/30/Generate-Ethereum-keys-and-wallet-address/"/>
      <content type="html"><![CDATA[<p><a href="https://kobl.one/blog/create-full-ethereum-keypair-and-address/" target="_blank" rel="noopener">Origin</a></p><p>This article is a guide on how to generate an <strong>ECDSA</strong> private key and derives<br>its Ethereum address.</p><p>Use Openssl and keccak-256sum from a terminal.</p><blockquote><p>SHA3 != keccak. Ethereum is using the <strong>keccak-256</strong> algorithm and not the<br>standard sha3.</p></blockquote><blockquote><p>Ethereum use keccak-256, it should be noted that it does not follow the<br>FIPS-202 based standard(aka. SHA-3), which was finalized in August 2015</p></blockquote><blockquote><p>web3.utils.sha3 uses keccak-256 web3.sha3(string[, option]): keccak-256</p></blockquote><h3 id="Generate-the-EC-private-key"><a href="#Generate-the-EC-private-key" class="headerlink" title="Generate the EC private key"></a>Generate the EC private key</h3><p>First of all we use <strong>Openssl</strong> ecparam command to generate an elliptic curve<br>private key. Ethereum standard is to use the <strong>secp256k1</strong> curve. The same curve<br>is used in Bitcion.</p><p>This command will print the private key in BEM format(using the wonderful ASN.1<br>key structure) on stdout.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; openssl ecparam -name secp256k1 -genkey -noout</span><br><span class="line">-----BEGIN EC PRIVATE KEY-----</span><br><span class="line">MHQCAQEEIFDLYO9KuwsC4ej2UsdA4SYk7s3lb8aZuW+B8rjugrMmoAcGBSuBBAAK</span><br><span class="line">oUQDQgAEsNjwhFoLKLXGBxfpMv3ILhzg2FeySRlFhtjfi3s8YFZzJtmckVR3N/YL</span><br><span class="line">JLnUV7w3orZUyAz77k0ebug0ILd1lQ==</span><br><span class="line">-----END EC PRIVATE KEY-----</span><br></pre></td></tr></table></figure><p>On its own this command is not very useful for us, but if you pipe it with the<br>ec command it will display both private and public part in hexadecimal format,<br>and this is what we want.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt; openssl ecparam -name secp256k1 -genkey -noout | openssl ec -text -noout</span><br><span class="line"><span class="built_in">read</span> EC key</span><br><span class="line">Private-Key: (256 bit)</span><br><span class="line">priv:</span><br><span class="line">    20:80:65:a2:47:ed:be:5d:f4:d8:6f:bd:c0:17:13:</span><br><span class="line">    03:f2:3a:76:96:1b:e9:f6:01:38:50:dd:2b:dc:75:</span><br><span class="line">    9b:bb</span><br><span class="line">pub:</span><br><span class="line">    04:83:6b:35:a0:26:74:3e:82:3a:90:a0:ee:3b:91:</span><br><span class="line">    bf:61:5c:6a:75:7e:2b:60:b9:e1:dc:18:26:fd:0d:</span><br><span class="line">    d1:61:06:f7:bc:1e:81:79:f6:65:01:5f:43:c6:c8:</span><br><span class="line">    1f:39:06:2f:c2:08:6e:d8:49:62:5c:06:e0:46:97:</span><br><span class="line">    69:8b:21:85:5e</span><br><span class="line">ASN1 OID: secp256k1</span><br></pre></td></tr></table></figure><p>This command decodes the ASN.1 structure and derives the public key from the<br>private one.</p><p>Sometimes, Openssl is adding a null byte(0x00) in front of the private part, I<br>donât know why it does that but you have to <strong>trim any leading zero bytes</strong> in<br>order to use it with Ethereum.</p><blockquote><p>The private key <strong>must be 32 bytes and not begin with 0x00</strong> and the public<br>one <strong>must be uncompressed and 64 bytes long</strong> or 65 with the constant (0x04)<br>prefix.</p></blockquote><h3 id="Derive-the-Ethereum-address-from-the-public-key"><a href="#Derive-the-Ethereum-address-from-the-public-key" class="headerlink" title="Derive the Ethereum address from the public key"></a>Derive the Ethereum address from the public key</h3><p>The public key is what we need in order to derive its Ethereum address. Every EC<br>Public key begins with â0x04â prefix byte in order to hash it correctly.</p><blockquote><p>This prefix represents the encoding of the public key:</p><ul><li>0x04 - both x and y of the elliptic curve point follows</li><li>0x02, 0x03 - only x follows (y is either odd or even depending on the<br>prefix)</li></ul></blockquote><p>Use any method you like to get it in the form of an hexadecimal string(without<br>line return nor semicolon)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Extract the public key and remove the EC prefix 0x04</span></span><br><span class="line">&gt; cat Key | grep pub -A 5 | tail -n +2 |</span><br><span class="line">            tr -d <span class="string">'\n[:space:]:'</span> | sed <span class="string">'s/^04//'</span> &gt; pub</span><br><span class="line">836b35a026743e823a90a0ee3b91bf615c6a757e2b60b9e1dc1826fd0dd16106f7bc1e8179f665015f43c6c81f39062fc2086ed849625c06e04697698b21855e</span><br></pre></td></tr></table></figure><p>The pub file now contains the hexadecimal value of the public key without the<br>0x04 prefix.</p><p>An Ethereum address is made of 20 bytes(40 hex characters), it is commonly<br>represented by adding the 0x prefix. In order to derive it, one should take the<br>keccak-256 hash of the hexadecimal form of a public key, then <strong>keep only the<br>last 20 bytes</strong> (aka get rid of the first 12 bytes)</p><p>Simply pass the file containing the public key in hexadecimal format to the<br>keccak-256sum command. <strong>Do not forget to use the â-xâ option</strong> in order to<br>interpret it as hexadecimal and not a simple string.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Generate the hash and take the address part</span></span><br><span class="line">&gt; cat pub | keccak-256sum -x -l | tr -d <span class="string">' -'</span> | tail -c 41</span><br><span class="line">0bed7abd61247635c1973eb38474a2516ed1d884</span><br></pre></td></tr></table></figure><p>Which gives us the Ethereum address<br><code>0x0bed7abd61247635c1973eb38474a2516ed1d884</code>.</p><blockquote><p>CAUTION: if your final address looks like<br><code>0xdcc703c0E500B653Ca82273B7BFAd8045D85a470</code>, this means you have hashed an<br>empty public key. Sending funds to this address will lock them forever.</p></blockquote>]]></content>
      
      
        <tags>
            
            <tag> Ethereum </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Caution on Int8Array</title>
      <link href="/2017/11/29/Caution-on-Int8Array/"/>
      <content type="html"><![CDATA[<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> t = crypto.getRandomValues(<span class="keyword">new</span> <span class="built_in">Int8Array</span>(<span class="number">3</span>))</span><br><span class="line"><span class="comment">// Int8Array(3) [-15, -17, -90]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// t is not typeof Array</span></span><br><span class="line"><span class="built_in">Array</span>.isArray(t)</span><br><span class="line"><span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// element in Int8Array must be type Int8</span></span><br><span class="line"><span class="comment">// method map returns array of same type as origin array</span></span><br><span class="line"><span class="keyword">let</span> _t = []</span><br><span class="line">t.map(<span class="function"><span class="params">i</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> _tmp = i.toString(<span class="number">16</span>)</span><br><span class="line">  _t.push(_tmp)</span><br><span class="line">  <span class="keyword">return</span> _tmp</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// Int8Array(3) [0, -11, 0]</span></span><br><span class="line"><span class="comment">// _t: ['-f', '-11', '-5a']</span></span><br><span class="line"></span><br><span class="line">t[<span class="number">0</span>] = <span class="string">'a'</span></span><br><span class="line"><span class="comment">// t: Int8Array(3) [0, -17, -90]</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> Int8Array </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Client Wallet Inspection</title>
      <link href="/2017/11/23/Client-Wallet-Inspection/"/>
      <content type="html"><![CDATA[<iframe width="853" height="800" src="https://embed.coggle.it/diagram/WhaB3hE2BAABznZF/065e922ba0f89869d4682bb60d9e426164106f817068fedc350e1193c7322293" frameborder="0" allowfullscreen></iframe>]]></content>
      
      
        <tags>
            
            <tag> ETH, Wallet </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>React-Lodable</title>
      <link href="/2017/11/23/react-lodable/"/>
      <content type="html"><![CDATA[<p><code>react-lodable</code> is a higher order component for loading components with dynamic<br>imports.</p><p>Code-splitting is the process of taking one large bundle containing your entire<br>app, and splitting them up into multiple smaller bundles which contain seperate<br>parts of your app.</p><p>This might seem difficult to do, but tools like Webpack have this built in, and<br>React Loadable is designed to make is super simple.</p><h4 id="Route-based-splitting-vs-Component-based-splitting"><a href="#Route-based-splitting-vs-Component-based-splitting" class="headerlink" title="Route-based splitting vs. Component-based splitting"></a>Route-based splitting vs. Component-based splitting</h4><p>A common piece of advice you will see is to break your app into seperate routes<br>and load each one asynchronously. This seems to work well enough for many apps<br>â a a user, clicking a link and waiting for a page to load is a familiar<br>experience on the web.</p><p>Namely, a route is simple a component.</p><p>But in fact there are more places than just routes where you can pretty easily<br>split apart your app: Modals, Tabs, and many more UI Components hide content<br>until the user has done something to reveal it.</p><p><img src="http://thejameskyle.com/img/react-loadable-component-splitting.png" alt=""></p><blockquote><p>Example: Maybe your app ahs a map buried inside of a tab component. Why would<br>you load a massive mapping library for the parent route every time the user<br>never to to that tab.</p></blockquote><p>React Loadable is a small library that makes component-centric code splitting<br>incredibly easy in React.</p><p><code>Loadable</code> is a higher-order component(a function that returns a component)<br>which lets you dynamically load any module before rendering it into your app.</p><p>We can make it by <code>dynamic import</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Bar <span class="keyword">from</span> <span class="string">'./components/Bar'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Bar</span> /&gt;</span></span></span><br><span class="line"><span class="xml">  &#125;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br></pre></td></tr></table></figure><p>=&gt;</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    Bar: <span class="literal">null</span>,</span><br><span class="line">  &#125;</span><br><span class="line">  componentWillMount() &#123;</span><br><span class="line">    <span class="keyword">import</span>(<span class="string">'./components/Bar'</span>).then(<span class="function"><span class="params">Bar</span> =&gt;</span> <span class="keyword">this</span>.setState(&#123; Bar &#125;))</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123; Bar &#125; = <span class="keyword">this</span>.state</span><br><span class="line">    <span class="keyword">if</span> (!Bar) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Bar</span> /&gt;</span></span></span><br><span class="line"><span class="xml">    &#125;</span></span><br><span class="line"><span class="xml">  &#125;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br></pre></td></tr></table></figure><p>But thatâs whole bunch of work, and it doesnât even handle a bunch of caess.<br>What about when <code>import()</code> fails? What about server-side rendering?</p><p><code>react-loadable</code> considers the unexpected cases.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Loadable <span class="keyword">from</span> <span class="string">'react-loadable'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> LoadableBar = Loadable(&#123;</span><br><span class="line">  loader: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./components/Bar'</span>),</span><br><span class="line">  loading: <span class="function"><span class="params">()</span> =&gt;</span> &lt;div&gt;Loading&lt;<span class="regexp">/div&gt;,</span></span><br><span class="line"><span class="regexp">&#125;)</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">class Foo extends React.Component &#123;</span></span><br><span class="line"><span class="regexp">  render() &#123;</span></span><br><span class="line"><span class="regexp">    return &lt;LoadableBar /</span>&gt;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>When you use <code>import()</code> with webpack2, it will<br><a href="https://webpack.js.org/guides/code-splitting/" target="_blank" rel="noopener">automatically code-split</a> for<br>you with no additional configuration.</p><p>Define your Loading Component</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Loading</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Loading<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>When your loader fails, your Loading component will receive an error prop which<br>will be <code>true</code>(otherwise it will be <code>false</code>).</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Loading</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (props.error) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Error<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Sometimes components load really quickly(&lt;200ms) and the loading screen only<br>quickly flashes on the screen.</p><p>Your loading component will get a <code>pastDelay</code> props which will only be <code>true</code><br>once the component has taken longer to load than a set <code>delay</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Loading</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (props.error) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Error<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (props.pastDelay) &#123;</span><br><span class="line">    <span class="comment">// only show loading when it takes longer than 200ms</span></span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Loading<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This delay defaults to 200ms, but you can customize the delay in Loadable.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Loadable(&#123;</span><br><span class="line">  loader: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./components/Bar'</span>),</span><br><span class="line">  loading: <span class="function"><span class="params">()</span> =&gt;</span> Loading,</span><br><span class="line">  delay: <span class="number">300</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Timing out when the loader is taking too long</p><p>Sometimes network connections suck and never resolve or fail, they just hang<br>there forever. This sucks for the user because they wonât know if it should<br>always take this long, or if they should try refreshing.</p><p>The Loading component will receive a <code>timeOut</code> prop which will be set to <code>true</code><br>when the loader has timed out.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Loading</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (props.error) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Error<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (props.timedOut) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Timed out<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (props.pastDelay) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Loading<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This feature is disabled by default, you can pass a <code>timeout</code> option to<br><code>Loadable</code> to enable it.</p><p>By default <code>Loadable</code> will render the <code>default</code> export of the returned module.<br>If you want to customize this behavior you can use the <code>render</code> option.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Loadable(&#123;</span><br><span class="line">  loader: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./myComponent'</span>),</span><br><span class="line">  render(loaded, props) &#123;</span><br><span class="line">    <span class="keyword">let</span> Component = loaded.namedExport</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Component</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span></span></span><br><span class="line"><span class="xml">  &#125;,</span></span><br><span class="line"><span class="xml">&#125;)</span></span><br></pre></td></tr></table></figure><p>You can do whatever you want within <code>loader()</code> as long as it returns a promise<br>and you are able to render everything</p><p>You can load multiple resources in parallel with <code>Loadable.Map</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Loadable.Map(&#123;</span><br><span class="line">  loader: &#123;</span><br><span class="line">    Bar: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./Bar'</span>),</span><br><span class="line">    i18n: <span class="function"><span class="params">()</span> =&gt;</span> fetch(<span class="string">'./i18n/bar.json'</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> res.json()),</span><br><span class="line">  &#125;,</span><br><span class="line">  render(loaded, props) &#123;</span><br><span class="line">    <span class="keyword">let</span> Bar = loaded.Bar.default</span><br><span class="line">    <span class="keyword">let</span> i18n = loaded.i18n</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Bar</span> &#123;<span class="attr">...props</span>&#125; <span class="attr">i18n</span>=<span class="string">&#123;i18n&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">  &#125;,</span></span><br><span class="line"><span class="xml">&#125;)</span></span><br></pre></td></tr></table></figure><p>As an optimization, you can also decide to preload a component before it gets<br>rendered.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> LoadableBar = Loadable(&#123;</span><br><span class="line">  loader: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./Bar'</span>),</span><br><span class="line">  loading: Loading,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    showBar: <span class="literal">false</span>,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  onClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; <span class="attr">showBar</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  onMouseOver = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    LoadableBar.preload()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;button onClick=&#123;<span class="keyword">this</span>.onClick&#125; onMouseOver=&#123;<span class="keyword">this</span>.onMouseOver&#125;&gt;</span><br><span class="line">          showbar</span><br><span class="line">        &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">        &#123;this.state.showBar &amp;&amp; &lt;LoadableBar /</span>&gt;&#125;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="Server-side-rendering-to-see-Github"><a href="#Server-side-rendering-to-see-Github" class="headerlink" title="Server-side rendering to see Github"></a>Server-side rendering to see <a href="https://github.com/thejameskyle/react-loadable" target="_blank" rel="noopener">Github</a></h3>]]></content>
      
      
        <tags>
            
            <tag> React, Router, Code-splitting </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Difference Between Contract Calling in Web3</title>
      <link href="/2017/11/21/Difference-between-Contract-Calling-in-Web3/"/>
      <content type="html"><![CDATA[<p>After we get the instance of Contract(<code>testInstance</code>), we can invoke its method by three ways:</p><ul><li><p><code>testInstance.testFunc.sendTransaction()</code></p><ul><li>It will make a transaction which will be broadcasted into the net, use gas and return the <code>txHash</code></li></ul></li><li><p><code>testInstance.testFunc.call()</code></p><ul><li>Call the contract function in VM, no broadcast and no gas used, return the response from method</li></ul></li><li><p><code>testInstance.testFunc()</code></p><ul><li>If the testFunc is signified <code>constant</code>, which means it wonât change the state on chain, it wonât be executed(web3 will invoke it by <code>.call()</code>). If the testFunc is not <code>constant</code>, <code>sendTransaction()</code> will be invoked.</li></ul></li></ul>]]></content>
      
      
        <tags>
            
            <tag> Smart Contract, Web3 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>JSON-PRC</title>
      <link href="/2017/11/21/JSON-PRC/"/>
      <content type="html"><![CDATA[<iframe width="100%" height="800px" src="https://embed.coggle.it/diagram/WhOeZuojMQABUzIo/99b086bdc0ebfc435ab27512cc9484dfe4d5352dc2ff34812c64d3706efe7066" frameborder="0" allowfullscreen></iframe>]]></content>
      
      
        <tags>
            
            <tag> JSON-RPC </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Common Patterns in Contract</title>
      <link href="/2017/11/14/Common-Patterns-in-Contract/"/>
      <content type="html"><![CDATA[<h3 id="Withdrawal-from-Contract"><a href="#Withdrawal-from-Contract" class="headerlink" title="Withdrawal from Contract"></a>Withdrawal from Contract</h3><p>The recommended method of sending funds after an effect is using the withdrawal pattern.</p><p>Although the most intuitive method of sending Ether, as a result of an effect, is a direct <code>send</code> call, this is not recommended as it introduces a potential security risk.</p><p>This is an example of the withdrawal pattern in practice in a contract where the goal is to send the most money to the contract in order to become the ârichestâ.</p><p>In the following contract, if you are usurped as the richest, you will receive the funds of the person who has gone on to be the new richest:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.11</span>;</span><br><span class="line"></span><br><span class="line">contract WithdrawalContract &#123;</span><br><span class="line">  address public richest;</span><br><span class="line">  uint public mostSent;</span><br><span class="line"></span><br><span class="line">  mapping(<span class="function"><span class="params">address</span> =&gt;</span> uint) public pendingWithdrawals;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">WithdrawalContract</span>(<span class="params"></span>) <span class="title">payable</span> </span>&#123;</span><br><span class="line">    richest = msg.sender;</span><br><span class="line">    mostSent = msg.value;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">becomeRichest</span>(<span class="params"></span>) <span class="title">payable</span> <span class="title">returns</span> (<span class="params">bool</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (msg.value &gt; mostSent) &#123;</span><br><span class="line">      pendingWithdrawals[msg.sender] += msg.value;</span><br><span class="line">      richest = msg.sender;</span><br><span class="line">      mostSent = msg.value;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">withdraw</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    uint amount = pendingWithdrawals[msg.sender];</span><br><span class="line">    pendingWithdrawals[msg.sender] = <span class="number">0</span>;</span><br><span class="line">    msg.sender.transfer(amount);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>In the example above, if the Contract is attacked and the withdraw method stuck(for example, msg.sender.transfer(amount) fails), the Contract will keep working.</p><h3 id="Restricting-Access"><a href="#Restricting-Access" class="headerlink" title="Restricting Access"></a>Restricting Access</h3><p>Restricting access is a common pattern for contract.</p><p>Note that you can never restrict any human or computer from reading the content of your transactions or your contractâs state. You can make it a bit harder by using encryption, but if your contract is supposed to read the data, so will everyone else.</p><p>You can restrict read access to your contractâs state by <strong>other contract</strong>. This is actually the default unless you declare make your state variables <code>public</code>.</p><p>Furthermore, you can restrict who can make modifications to your contractâs state or call your contractâs functions.</p><p>The use of <strong>function modifier</strong> makes thse restrictions highly readable.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.11</span>;</span><br><span class="line"></span><br><span class="line">contract AccessRestriction &#123;</span><br><span class="line">    address public owner = msg.sender;</span><br><span class="line">    uint public creationTime = now;</span><br><span class="line"></span><br><span class="line">    modifier onlyBy(address _account) &#123;</span><br><span class="line">        <span class="built_in">require</span>(msg.sender == _account);</span><br><span class="line">        _;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">changeOwner</span>(<span class="params">address _newOwner</span>) <span class="title">onlyBy</span>(<span class="params">owner</span>) </span>&#123;</span><br><span class="line">        owner = _newOwner;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    modifier onlyAfter(uint _time) &#123;</span><br><span class="line">        <span class="built_in">require</span>(now &gt; _time);</span><br><span class="line">        _;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">disown</span>(<span class="params"></span>) <span class="title">onlyBy</span>(<span class="params">owner</span>) <span class="title">onlyAfter</span>(<span class="params">creationTime + <span class="number">6</span> weeks</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">delete</span> owner;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    modifier costs(uint _amount) &#123;</span><br><span class="line">        <span class="built_in">require</span>(msg.value &gt; _amount);</span><br><span class="line">        _;</span><br><span class="line">        <span class="keyword">if</span> (msg.value &gt; _amount)</span><br><span class="line">            msg.sender.send(msg.value - _amount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">forceOwnerChange</span>(<span class="params">address _newOwner</span>) <span class="title">costs</span>(<span class="params"><span class="number">200</span> ether</span>) </span>&#123;</span><br><span class="line">        owner = _newOwner;</span><br><span class="line">        <span class="keyword">if</span> (uint(owner) &amp; <span class="number">0</span> == <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="State-Machine"><a href="#State-Machine" class="headerlink" title="State Machine"></a>State Machine</h3><p>Contracts often act as a state machine, which means that they have certain <strong>stage</strong> in which they behave differently or in which different functions can be called.</p><p>A function call often ends a stage and transitions the contract into the next stage.</p><p>Function modifiers can be used in this situation to model the states and guard against incorrect usage of the contract.</p><p>In the following example, the modifier <code>atStage</code> ensures that the function can only be called at a certain stage, automatic timed transitions are handled by the modifier <code>timeTransitions</code>, which should be used for all functions.</p><blockquote><p>Modifier Order Matters: If <code>atStage</code> is combined with <code>timedTransitions</code>, make sure that you mention it after the latter, so that the new stage is taken into account.</p></blockquote><p>Finally, the modifier <code>transitionNext</code> can be used to automatically go to the next stage when the function finishes.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.11</span>;</span><br><span class="line"></span><br><span class="line">contract StateMachine &#123;</span><br><span class="line">    enum Stages &#123;</span><br><span class="line">        AcceptingBlindedBids,</span><br><span class="line">        RevealBids,</span><br><span class="line">        AnotherStage,</span><br><span class="line">        AreWeDoneYet,</span><br><span class="line">        Finished</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Stages public stage = Stages.AcceptingBlindedBids;</span><br><span class="line"></span><br><span class="line">    uint public creationTime = now;</span><br><span class="line"></span><br><span class="line">    modifier atStage(Stages _stage) &#123;</span><br><span class="line">        <span class="built_in">require</span>(stage == _stage);</span><br><span class="line">        _;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">nextStage</span>(<span class="params"></span>) <span class="title">internal</span> </span>&#123;</span><br><span class="line">        stage = Stages(uint(stage) + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    modifier timedTransitions() &#123;</span><br><span class="line">      <span class="keyword">if</span> (stage == Stages.AcceptingBlindedBids &amp;&amp; now &gt;= creationTime + <span class="number">10</span> days)</span><br><span class="line">          nextStage();</span><br><span class="line">      <span class="keyword">if</span> (stage == Stages.RevealBids &amp;&amp; now &gt;= creationTime + <span class="number">12</span> days)</span><br><span class="line">          nextStage();</span><br><span class="line">      _;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">bid</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        <span class="title">payable</span></span></span><br><span class="line"><span class="function">        <span class="title">timedTransitions</span></span></span><br><span class="line"><span class="function">        <span class="title">atStage</span>(<span class="params">Stages.AcceptingBlindedBids</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">reveal</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        <span class="title">timedTransitions</span></span></span><br><span class="line"><span class="function">        <span class="title">atStage</span>(<span class="params">Stages.RevealBids</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> Contract, Solidity </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Solidity Style Guide</title>
      <link href="/2017/11/14/Solidity-Style-Guide/"/>
      <content type="html"><![CDATA[<h3 id="Layout"><a href="#Layout" class="headerlink" title="Layout"></a>Layout</h3><p>4 spaces per indentation level</p><p>Use spaces for indentation</p><p>Use blank lines</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">contract A &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract B &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Blank lines may be omitted between groups of related one-liners</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">contract A &#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">spam</span>(<span class="params"></span>);</span></span><br><span class="line"><span class="function">  <span class="title">function</span> <span class="title">ham</span>(<span class="params"></span>);</span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure><p>Use <code>UTF-8</code> or <code>ASCII</code> encoding</p><p>Place import statements at the top of the file</p><p>Functions should be be grouped according to their visibility and ordered:</p><ul><li><p>constructor</p></li><li><p>fallback function (if exists)</p></li><li><p>external</p></li><li><p>public</p></li><li><p>internal</p></li><li><p>private</p></li></ul><p>Within a grouping, place the <code>constant</code> functions last.</p><p>Use white spaces in expressions</p><p>Avoid extraneous whitespaces inthe following situations: immediately inside parenthesis, brackets or braces, with the exception of single line function declaration.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">spam(ham[<span class="number">1</span>], Coin(&#123;<span class="attr">name</span>: <span class="string">"han"</span>&#125;)):</span><br><span class="line"></span><br><span class="line"><span class="comment">// exception</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">singleLine</span>(<span class="params"></span>) </span>&#123; spam() &#125;</span><br></pre></td></tr></table></figure><p>More than one space around an assignment or other operator to align with</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x = <span class="number">1</span>;</span><br><span class="line">y = <span class="number">2</span>;</span><br><span class="line">long_variable = <span class="number">3</span>;</span><br></pre></td></tr></table></figure><p>Donât include a whitespace in the fallback function</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// not </span></span><br><span class="line"><span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>For control structure whose body contains a single statement, omitting the braces is ok if the statement is contained on a single line</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (x &lt; <span class="number">10</span>)</span><br><span class="line">    x += <span class="number">1</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    x -= <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>Function declaration</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">increment</span>(<span class="params">uint x</span>) <span class="title">returns</span> (<span class="params">uint</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// visibility precedes custom modifier</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">increment</span>(<span class="params">uint x</span>) <span class="title">public</span> <span class="title">onlyOwner</span> <span class="title">returns</span> (<span class="params">uint</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// long parameters list</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">increment</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    uint x1,</span></span></span><br><span class="line"><span class="function"><span class="params">    uint x2,</span></span></span><br><span class="line"><span class="function"><span class="params">    uint x3,</span></span></span><br><span class="line"><span class="function"><span class="params">    uint x4,</span></span></span><br><span class="line"><span class="function"><span class="params">    uint x5,</span></span></span><br><span class="line"><span class="function"><span class="params">    uint x6,</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// long visibility modifier list</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">increment</span> (<span class="params">uint x</span>)</span></span><br><span class="line"><span class="function">    <span class="title">public</span></span></span><br><span class="line"><span class="function">    <span class="title">onlyOwner</span></span></span><br><span class="line"><span class="function">    <span class="title">priced</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Stirng should be quoted with double-quotes.</p><p>Contract and Library Names should be named using the CapWords style.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SimpleToken,</span><br><span class="line">SmartBank,</span><br></pre></td></tr></table></figure><p>Event Names should use CapWords</p><p>Function Names should use CamelCase</p><p>Function Arguments should use CamelCase</p><p>Local and State Variables should use CamelCase</p><p>Constants should be named with all captial letters with underscores seperating words: <code>MAX_BLOCKS</code></p><p>Modifier should use CamelCase</p>]]></content>
      
      
        <tags>
            
            <tag> Solidity </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Notes on Solidity in Depth</title>
      <link href="/2017/11/10/Notes-on-Solidity-in-Depth/"/>
      <content type="html"><![CDATA[<h3 id="Layout-of-a-Solidity-Source-File"><a href="#Layout-of-a-Solidity-Source-File" class="headerlink" title="Layout of a Solidity Source File"></a>Layout of a Solidity Source File</h3><h4 id="Version-Pragma"><a href="#Version-Pragma" class="headerlink" title="Version Pragma"></a>Version Pragma</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.11</span>;</span><br></pre></td></tr></table></figure><h4 id="Importing-other-Source-File"><a href="#Importing-other-Source-File" class="headerlink" title="Importing other Source File"></a>Importing other Source File</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"filename"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> symbolName <span class="keyword">from</span> <span class="string">"filename"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; symbol <span class="keyword">as</span> alias, symbol2 &#125; <span class="keyword">from</span> <span class="string">"filename"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"filename"</span> <span class="keyword">as</span> symbolName;</span><br></pre></td></tr></table></figure><p>In the above, <code>filename</code> is always treated as a path with <code>/</code> as directory seperator.</p><p>All path names are treated as absolute paths unless thay start with <code>.</code> or <code>..</code>.</p><h5 id="Remapping"><a href="#Remapping" class="headerlink" title="Remapping"></a>Remapping</h5><p>For example, remap <code>github.com/ethereum/dapp-bin/library</code> to <code>/usr/local/dapp-bin/library</code></p><p><strong>solc</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"github.com/ethereum/dapp-bin/library/iterable_mapping.sol` as it_mapping;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">solc github.com/ethereum/dapp-bin/=/usr/<span class="built_in">local</span>/dapp-bin/ source.sol</span><br></pre></td></tr></table></figure><h4 id="Comments"><a href="#Comments" class="headerlink" title="Comments"></a>Comments</h4><p>Single Line Comments: <code>//</code></p><p>Multi-line Comments: <code>/* ... */</code></p><p>Natspec Comments: <code>///</code> or <code>/** ... */</code></p><p>Natspec should be used directly above function declarations or statements.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.11</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** @title Shape calculator */</span></span><br><span class="line">contract shapeCaculator &#123;</span><br><span class="line">  <span class="comment">/** @dev Calculates a rectangle's surface and perimeter.</span></span><br><span class="line"><span class="comment">    * @param w Width of the rectangle.</span></span><br><span class="line"><span class="comment">    * @param h Height of the rectangle.</span></span><br><span class="line"><span class="comment">    * @param s The calculated surface.</span></span><br><span class="line"><span class="comment">    * @param p The calculated perimeter.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">rectangle</span>(<span class="params">uint w, uint h</span>) <span class="title">returns</span> (<span class="params">uint s, uint p</span>) </span>&#123;</span><br><span class="line">    s = w * h;</span><br><span class="line">    p = <span class="number">2</span> * (w + h);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Structure-of-Contract"><a href="#Structure-of-Contract" class="headerlink" title="Structure of Contract"></a>Structure of Contract</h3><p>Contracts in Solidity are similar to classes in object-oriented languages. Each contract can contain declarations of <strong>State Variables</strong>, <strong>Functions</strong>, <strong>Function Modifiers</strong>, <strong>Events</strong>, <strong>Struct Types</strong> and <strong>Enum Types</strong>.</p><h4 id="State-Variables"><a href="#State-Variables" class="headerlink" title="State Variables"></a>State Variables</h4><p>State variables are values which are permanently stored in contract storage.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.11</span>;</span><br><span class="line"></span><br><span class="line">contract SimpleStorage &#123;</span><br><span class="line">  uint storedData; <span class="comment">// state variable</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Functions"><a href="#Functions" class="headerlink" title="Functions"></a>Functions</h4><p>Functions are executable units of code within a contract.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.11</span>;</span><br><span class="line"></span><br><span class="line">contract SimpleAuction &#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">bid</span>(<span class="params"></span>) <span class="title">payable</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Function-Modifiers"><a href="#Function-Modifiers" class="headerlink" title="Function Modifiers"></a>Function Modifiers</h4><p>Function modifiers can be used to amend the semantics of functions in a declarative way.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.11</span>;</span><br><span class="line"></span><br><span class="line">contract Purchase &#123;</span><br><span class="line">  address public seller;</span><br><span class="line"></span><br><span class="line">  modifier onlySeller () &#123; <span class="comment">// Modifier</span></span><br><span class="line">    <span class="built_in">require</span>(msg.sender == seller);</span><br><span class="line">    _;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">abort</span>(<span class="params"></span>) <span class="title">onlySeller</span> </span>&#123; <span class="comment">// Modifier usage</span></span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Events"><a href="#Events" class="headerlink" title="Events"></a>Events</h4><p>Events are convenience interfaces with the EVM logging facilities.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.11</span>;</span><br><span class="line"></span><br><span class="line">contract SimpleAuction &#123;</span><br><span class="line">  event HighestBidIncreased(address bidder, uint amount);</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">bid</span>(<span class="params"></span>) <span class="title">payable</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    HighestBidIncreased(msg.sender, msg.value);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Struct-Types"><a href="#Struct-Types" class="headerlink" title="Struct Types"></a>Struct Types</h4><p>Structs are custom defined types that can group several variables.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.11</span>;</span><br><span class="line"></span><br><span class="line">contract Ballot &#123;</span><br><span class="line">  struct Voter &#123;</span><br><span class="line">    uint weight;</span><br><span class="line">    bool voted;</span><br><span class="line">    address delegate;</span><br><span class="line">    uint vote;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Enum-Types"><a href="#Enum-Types" class="headerlink" title="Enum Types"></a>Enum Types</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.0</span>;</span><br><span class="line"></span><br><span class="line">contract Purchase &#123;</span><br><span class="line">  enum State &#123;</span><br><span class="line">    Created,</span><br><span class="line">    Locked,</span><br><span class="line">    Inactive</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Types"><a href="#Types" class="headerlink" title="Types"></a>Types</h4><ul><li><p><code>bool</code>: <code>true</code> or <code>false</code></p><ul><li><p><code>!</code> logical negation</p></li><li><p><code>&amp;&amp;</code> logical and</p></li><li><p><code>||</code> logical or</p></li><li><p><code>==</code> logical equality</p></li><li><p><code>!=</code> logical inequality</p></li></ul></li><li><p><code>int/uint</code>: <code>uint8</code> to <code>uint256</code>, <code>int8</code> to <code>int256</code></p><ul><li><p><code>&lt;=</code>, <code>&gt;=</code>, <code>==</code>, <code>!=</code>, <code>&lt;</code>, <code>&gt;</code></p></li><li><p><code>&amp;</code>, <code>|</code>, <code>^</code>, <code>~</code>, bit operators</p></li><li><p><code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>%</code>, <code>**</code>, <code>&lt;&lt;</code>, <code>&gt;&gt;</code></p></li></ul></li><li><p><code>address</code>: holds a 20 bytes value(size of an Ethereum address)</p><ul><li><code>&lt;=</code>, <code>=&gt;</code>, <code>==</code>, <code>!=</code>, <code>&lt;</code>, <code>&gt;</code></li></ul></li></ul><blockquote><p>Starting with version 0.5.0 contracts do not derive from the <code>address</code> type, but can still be explicitly converted to address.</p></blockquote><h4 id="Members-of-Address"><a href="#Members-of-Address" class="headerlink" title="Members of Address"></a>Members of Address</h4><ul><li><p><code>balance</code></p></li><li><p><code>transfer</code>, address.transfer(value), send value Wei to the address.</p></li><li><p><code>send</code>: Send is the low-level counterpart of <code>transfer</code>. If the execution fails, the current contract will not stop with an exception, but <code>send</code> will return <code>false</code></p></li></ul><blockquote><p>There are some dangers in using <code>send</code>: The transfer fails if the call stack depth is 1024 and it also fails if the recipient runs out of gas. So in order to make safe Ether transfers, always check the return value of <code>send</code>, use <code>transfer</code> or even better.</p></blockquote><ul><li><code>call</code>, <code>callcode</code>, and <code>delegatecall</code></li></ul><p>Furthermore, to interface with contracts that do not adhere to the ABI, the function <code>call</code> is provided which takes an arbitrary number of arguments of any type. The arguments are padding to 32 bytes and concatenated. One exception is the case where the first argument is encoded to exactly four bytes. In this case, it is not padding to allow the use of function signatures here.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">address nameReg = <span class="string">'0x72ba7d8e73fe8eb666ea66babc8116a41bfb10e2'</span>;</span><br><span class="line">nameReg.call(<span class="string">'register'</span>, <span class="string">'MyName'</span>);</span><br><span class="line">nameReg.call(bytes4(keccak256(<span class="string">"fun(uint256))), );</span></span><br></pre></td></tr></table></figure><p><code>call</code> returns a boolean indicating whether the invoked function terminated (true) or caused an EVM exception (false). It is not possible to access the actual data returned.</p><p>It is possible to adjust the supplied gas with the <code>.gas()</code> modifier:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nameReg.call.gas(<span class="number">1000000000</span>)(<span class="string">'register'</span>, <span class="string">'myName'</span>);</span><br></pre></td></tr></table></figure><p>and supplied Ether value can be controlled too:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nameReg.call.value(<span class="number">1</span> ether)(<span class="string">'regiter'</span>, <span class="string">'myName'</span>);</span><br></pre></td></tr></table></figure><p>Chained</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nameReg.call.value(<span class="number">1</span> ether).gas(<span class="number">100000000</span>)(<span class="string">'register'</span>, <span class="string">'myName'</span>);</span><br></pre></td></tr></table></figure><p>In a similar way, the function <code>delegatecall</code> can be used: the difference is that only the code of the given address is used, all other aspects(storage, balance, â¦) are taken from the current contract. The purpose of <code>delegatecall</code> is to use library code which is stored in another contract. The user has to ensure that the layout of storage in both contracts is suitable for delegatecall to be used. Prior to homestead, only a limited variant called <code>callcode</code> was available that did not provide access to the original <code>msg.sender</code> and <code>msg.value</code>.</p><p>All three functions <code>call</code>, <code>delegatecall</code>, and <code>callcode</code> are very low-level functions and should only be used as a <em>last resort</em> as they break the type-safety of Solidity.</p><p>The <code>.gas()</code> option is available on all three methods, while the <code>.value()</code> option is not supported for <code>delegatecall</code>.</p><blockquote><p>All Contracts inherit the members of address, so it is possible to query the balance of the current contract using <code>this.balance</code>.</p></blockquote><blockquote><p>The use of <code>callcode</code> is discouraged and will be removed in the future.</p></blockquote><h4 id="Fixed-size-byte-array"><a href="#Fixed-size-byte-array" class="headerlink" title="Fixed-size byte array"></a>Fixed-size byte array</h4><ul><li><code>.length</code> yields the fixed length of the byte array(read-only)</li></ul><blockquote><p>It is possible to use an array of bytes as <code>byte[]</code>, but it is wasting a lot of space, 21 bytes every element, to be exact, when passing in calls. It is better to use <code>bytes</code>.</p></blockquote><h4 id="Dynamically-sized-byte-array"><a href="#Dynamically-sized-byte-array" class="headerlink" title="Dynamically-sized byte array"></a>Dynamically-sized byte array</h4><p><code>bytes</code>: dynamically-sized array, see Array, not a value-type.</p><p><code>string</code>: dynamically-sized UTF-8-encoded string, see Array, not a value-type.</p><h4 id="Address-Liberals"><a href="#Address-Liberals" class="headerlink" title="Address Liberals"></a>Address Liberals</h4><p>Hexadecimal literals that pass the address checksum test, for example <code>0xdCad3a6d3569DF655070DEd06cb7A1b2Ccd1D3AF</code> are of <code>address</code> type. Hexadecimal literals that are between 39 and 41 digits long and do not pass the checksum test produce a warning and are treated as regular rational number literals</p><h4 id="Rational-and-Integer-Literals"><a href="#Rational-and-Integer-Literals" class="headerlink" title="Rational and Integer Literals"></a>Rational and Integer Literals</h4><p>Integer literal are formed form a sequence of numbers in the range 0-9. They are interpreted as decimals, for example, <code>69</code> means sixty nine. Octal literals do not exist in Solidity and leading zeros are invalid.</p><p>Decimal fraction literals are formed by a <code>.</code> with at least one number on one side(<code>1.</code>, <code>.2</code>, <code>1.3</code>)</p><p>Scientific notation is also supported, where the base can have fractions, white the exponent cannot(2e10, -2e10, 2e-10, 2.5e10)</p><p>Number literal expressions retains arbitrary precision until they are converted to a non-literal type.</p><p>For example <code>(2**800 + 1) - 2**800</code> result in the constant <code>1</code>, <code>.5 * 8</code> results in the integer <code>4</code></p><blockquote><p>Number literal expressions are converted into a non-literal type as soon as they are used with non-literal expressions. Even though we know that the value of the expression assigned to <code>b</code> in the following example evaluates to an integer, but the partial expression <code>2.5 + a</code> does not type check so the code does not compile.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">uint128 a = <span class="number">1</span>;</span><br><span class="line">uint128 b = <span class="number">2.5</span> + a + <span class="number">0.5</span>;</span><br></pre></td></tr></table></figure><h4 id="String-Literals"><a href="#String-Literals" class="headerlink" title="String Literals"></a>String Literals</h4><p>String literals are written with either double or sinlge-quotes. They do not imply trailing zeros as in C, <code>&quot;foo&quot;</code> represents three bytes not four.</p><p>String Literal supports escape characters, such as <code>\n</code>, <code>\xNN</code> and <code>\uNNNN</code>.</p><h4 id="Hexadecimal-Literals"><a href="#Hexadecimal-Literals" class="headerlink" title="Hexadecimal Literals"></a>Hexadecimal Literals</h4><p><code>hex&quot;001122FF&quot;</code></p><h4 id="Enums"><a href="#Enums" class="headerlink" title="Enums"></a>Enums</h4><p>Enums are one way to create a user-defined type in Solidity. They are explicitly convertable to and from all integer types but implicit conversion is not allowed. The explicit conversions check the value ranges at runtime, and a failure causes an exception.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.11</span>;</span><br><span class="line"></span><br><span class="line">contract test &#123;</span><br><span class="line">  enum ActionChoices &#123;</span><br><span class="line">    GoLeft,</span><br><span class="line">    GoRight,</span><br><span class="line">    GoStraight,</span><br><span class="line">    GoStill</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ActionChoices choice;</span><br><span class="line">  ActionChoices constant defaultChoice = ActionChoices.GoStraight;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setGoStraight</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    choice = ActionChoices.GoStraight;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getChoice</span>(<span class="params"></span>) <span class="title">returns</span> (<span class="params">ActionChoices</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> choice;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getDefaultChoice</span>(<span class="params"></span>) <span class="title">returns</span> (<span class="params">uint</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> uint(defaultChoice);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Function-Types"><a href="#Function-Types" class="headerlink" title="Function Types"></a>Function Types</h4><p>Function types are notated as follows:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> (<span class="params">&lt;parameter types&gt;</span>) </span>&#123;internal|external&#125; [pure|constant|view|payable] [returns (<span class="xml"><span class="tag">&lt;<span class="name">return</span> <span class="attr">types</span>&gt;</span>)]</span></span><br></pre></td></tr></table></figure><p>In contrast to the parameter types, the return types cannot be empty - if the function type should not return anything, the whole <code>returns (&lt;return type&gt;)</code> part has to be omitted.</p><p>Public (or external) functions have a special member called <code>selector</code>, which returns the <code>ABI function selector</code>:</p><h4 id="Reference-Types"><a href="#Reference-Types" class="headerlink" title="Reference Types"></a>Reference Types</h4><p>Complex types, i.e. types which do not always fit into 256 bits have to be handled more carefully than than the value-types we have already seen. Since copying them can be quite expensive, we have to think about whether we want them to be store in <strong>memory</strong>(which is not persisting) or <strong>storage</strong>(where the state variables are held).</p><h4 id="Data-location"><a href="#Data-location" class="headerlink" title="Data location"></a>Data location</h4><p>Every complex type, i.e. <em>arrays</em> and <em>structs</em> has an additional annotation, the âdata locationâ about where it is stored in <strong>memory</strong> or in <strong>storage</strong>. Depending on the context, there is always a default, but it can be overrideen by appeding either <code>storage</code> or <code>memory</code> to the type. The default for function parameters(including return parameters) is <strong>memory</strong> the default for local variable is <strong>storage</strong> and the location is forced to <strong>storage</strong> for state variables</p><p>There is also a third data location, <strong>calldata</strong>, which is a non-modificable, non-persistent area where function arguments are stored. Function parameter(not return parameters) of external functions are forced to <strong>calldata</strong> and behave mostly like <strong>memory</strong>.</p><p>Data locations are imortant because they change how assignment behave: assignments between storage and memory and also to a state variable always create an independent copy. Assignments to local storage variables only assign a reference though, and this reference always points to the state variable even if the latter is changed in the meantime. On the other hand, assignments from a memory stoted reference type to another memory-stored reference type do not create a copy.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.11</span>;</span><br><span class="line"></span><br><span class="line">contract C &#123;</span><br><span class="line">  uint[] x; <span class="comment">// the data location of x is storage</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// the data location of memoryArray is memory</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">uint[] memoryArray</span>) </span>&#123;</span><br><span class="line">    x = memoryArray; <span class="comment">// works, copy the whole array to storage</span></span><br><span class="line">    <span class="keyword">var</span> y = x; <span class="comment">// works, assigns a pointer, data location of y is storage</span></span><br><span class="line">    y[<span class="number">7</span>]; <span class="comment">// fine, returns the 8th element</span></span><br><span class="line">    y.length = <span class="number">2</span>; <span class="comment">// fine, modifies x through y</span></span><br><span class="line">    <span class="keyword">delete</span> x; <span class="comment">// fine, clears the array, also modifies y</span></span><br><span class="line">    <span class="comment">// the following does not work; it would need to create a new temporary / unamed array in storage, but storage is 'statically' allocated</span></span><br><span class="line">    <span class="comment">// y = memoryArray;</span></span><br><span class="line">    <span class="comment">// This does not work either, since it would 'reset' the pointer, but there is not sensible location it could point to.</span></span><br><span class="line">    <span class="comment">// delete y;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h5><ul><li><p>Forced data location:</p><ul><li><p>parameters(not return) of external functions: calldata</p></li><li><p>state variables: storage</p></li></ul></li><li><p>Default data location:</p><ul><li><p>parameters(also return) of functions: memory</p></li><li><p>all other local variables: storage</p></li></ul></li></ul><h4 id="Arrays"><a href="#Arrays" class="headerlink" title="Arrays"></a>Arrays</h4><p>An array of fixed size <code>k</code> and element type <code>T</code> is written as <code>T[k]</code></p><p>An array of dynamic size as <code>T[]</code></p><p>An array of 5 dynamic arrays of <code>uint</code> is <code>uint[][5]</code>. (note that the notation is reversed when compared to some other language). To access the second uint in the third dynamic array, you use <code>x[2][1]</code></p><p>Variables of type <code>bytes</code> and <code>string</code> are special arrays. A <code>bytes</code> is similar to <code>byte[]</code>, but it is packed tightly in calldata. <code>string</code> is equal to <code>bytes</code> but does not allow length or index access(for now).</p><p>So <code>bytes</code> should always be preferred over <code>byte[]</code> because it is cheaper.</p><h4 id="Structs"><a href="#Structs" class="headerlink" title="Structs"></a>Structs</h4><p>Solidity provides a way to define new types in the form of structs, which is shown in the following example:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.11</span>;</span><br><span class="line"></span><br><span class="line">contract CrowdFunding &#123;</span><br><span class="line">  struct Funder &#123;</span><br><span class="line">    address addr;</span><br><span class="line">    uint amount;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  struct Campaign &#123;</span><br><span class="line">    address beneficiary;</span><br><span class="line">    uint fundingGoal;</span><br><span class="line">    uint numFunders;</span><br><span class="line">    uint amount;</span><br><span class="line">    mapping(<span class="function"><span class="params">uint</span> =&gt;</span> Funder) funders;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>It is not possible for a struct to contain a member of its own type, although the struct itself can be the value type of a mapping member. This restriction is necessary, as the size of the struct has to be finite.</p><h4 id="Mappings"><a href="#Mappings" class="headerlink" title="Mappings"></a>Mappings</h4><p>Mapping types are declared as <code>mapping(_keyType =&gt; _valueType)</code>. Here <code>_keyType</code> can be almost any type except for a mapping, a dynamically sized array, a contract, an enum, and a struct. <code>_valueType</code> can actually be any type, including mappings.</p><p>Mappings can be seen as hash tables which are virtually initialized such that every possible key exists and is mapped to a value whose byte-representation is all zeros: a typeâs default value.</p><p>Mappings are only allowed for state variables( or as storage reference types in internal function).</p><p>It is possible to mark mapping <code>public</code> and have Solidity create a getter. The <code>_keyType</code> will become a required parameter for the getter and it will return <code>_valueType</code>.</p><p>Mappings are not iterable, but it is possible to implement a data structure on top of them.</p><h4 id="Operators-Involving-LValues"><a href="#Operators-Involving-LValues" class="headerlink" title="Operators Involving LValues"></a>Operators Involving LValues</h4><p>LValue, i.e. a variable or something that can be assigned to.</p><h5 id="delete"><a href="#delete" class="headerlink" title="delete"></a>delete</h5><p><code>delete a</code> assigns the initial value for the type to a. I.e., for integers, it is equivalent to <code>a = 0</code>.</p><p><code>delete</code> has no effect on whole mappints. So if you delete a struct, it will reset all members that are not mappings and also recurse into the memebers unless they are mappings. However, individual keys and what they map to can be deleted.</p><p>Itâs really important to note that <code>delete a</code> really behaves like an assignment to <code>a</code>, it stores a new object in <code>a</code>.</p><h4 id="Conversions-between-Elementary-Types"><a href="#Conversions-between-Elementary-Types" class="headerlink" title="Conversions between Elementary Types."></a>Conversions between Elementary Types.</h4><h5 id="Implicit-Conversions"><a href="#Implicit-Conversions" class="headerlink" title="Implicit Conversions"></a>Implicit Conversions</h5><p>In general, an implicit conversion between value-types is possible if it makes sense semantically and no information is lost: <code>uint8</code> is convertible to <code>uint16</code>, but <code>uint16</code> is not convertible to <code>uint8</code>. And <code>int8</code> is not convertible to <code>uint256</code>(because <code>uint256</code> cannot hold hold e.g. <code>-1</code>).</p><h5 id="Explicit-Conversions"><a href="#Explicit-Conversions" class="headerlink" title="Explicit Conversions"></a>Explicit Conversions</h5><p>If the compiler does not allow implicit conversion but you know what you are doing, an explicit type conversion is sometimes possible.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">int8 y = <span class="number">-3</span>;</span><br><span class="line">uint x = uint(y);</span><br></pre></td></tr></table></figure><h4 id="Type-Deduction"><a href="#Type-Deduction" class="headerlink" title="Type Deduction"></a>Type Deduction</h4><p>For convenience, it is not always necessary to explicitly specify the type of a variable, the compiler automatically infers it from the type of the first expression that is assigned to the variable:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">uint24 x = <span class="number">0x123</span>;</span><br><span class="line"><span class="keyword">var</span> y = x;</span><br></pre></td></tr></table></figure><h3 id="Units-and-Globally-Available-Variables"><a href="#Units-and-Globally-Available-Variables" class="headerlink" title="Units and Globally Available Variables"></a>Units and Globally Available Variables</h3><h4 id="Ether-Units"><a href="#Ether-Units" class="headerlink" title="Ether Units"></a>Ether Units</h4><p>A literal number can take a suffix of <code>wei</code>, <code>finney</code>, <code>szabo</code>, or <code>ether</code> to convert between the subdenominations of Ether, where Ether currency numbers without a postfix are assumed to be Wei.</p><p><code>2 ether === 2000 finney</code> evaluates to <code>true</code></p><h4 id="Time-Units"><a href="#Time-Units" class="headerlink" title="Time Units"></a>Time Units</h4><p>Suffixes like <code>seconds</code>, <code>minutes</code>, <code>hours</code>, <code>days</code>, <code>weeks</code> and <code>years</code> after literal numbers can be used to convert between units of time where seconds are the base unit.</p><p>Take care if you perform calendar calculations using these units, because not every year equals 365 days and not even every day has 24 hours because of leap seconds. Due to the fact that leap seconds cannot be predicted, an exact calendar library has to be updated by an external oracle.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">unit start, unit dayAfter</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (now &gt;= start + dayAfter + <span class="number">1</span> days) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Other Global Variables and Functions:</p><p><a href="http://ezcook.de/2017/11/10/Solidity-CheatSheet/" target="_blank" rel="noopener">Post</a></p>]]></content>
      
      
        <tags>
            
            <tag> Solidity </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Solidity CheatSheet</title>
      <link href="/2017/11/10/Solidity-CheatSheet/"/>
      <content type="html"><![CDATA[<h3 id="Global-Variables"><a href="#Global-Variables" class="headerlink" title="Global Variables"></a>Global Variables</h3><h4 id="Block"><a href="#Block" class="headerlink" title="Block"></a>Block</h4><ul><li><p>block.coinbase: address - current block minerâs address</p></li><li><p>block.difficulty: uint - current block difficulty</p></li><li><p>block.gaslimit: uint - current block gaslimit</p></li><li><p>block.number: uint - current block number</p></li><li><p>block.timestamp: uint - current block timestamp</p></li></ul><h4 id="Msg"><a href="#Msg" class="headerlink" title="Msg"></a>Msg</h4><ul><li><p>msg.data: bytes - complete calldata</p></li><li><p>msg.gas: uint - remaining gas</p></li><li><p>msg.sender: address - sender of the message(current call)</p></li><li><p>msg.value: uint - number of wei sent with the message</p></li></ul><h4 id="Now"><a href="#Now" class="headerlink" title="Now"></a>Now</h4><ul><li>now: uint - current block timestamp(alias for block.timestamp)</li></ul><h4 id="Tx"><a href="#Tx" class="headerlink" title="Tx"></a>Tx</h4><ul><li><p>tx.gasprice: uint - gas price of the transaction</p></li><li><p>tx.origin: address - sender of the transaction (full call chain)</p></li></ul><h3 id="Global-Functions"><a href="#Global-Functions" class="headerlink" title="Global Functions"></a>Global Functions</h3><ul><li><p>assert(bool condition): abort execution and revert state changes if condition is <code>false</code>(use for internal error)</p></li><li><p>require(bool condition): abort execution and revert state changes if condition is <code>false</code>(use for malformed input or error in external component)</p></li><li><p>revert(): abort execution and revert state changes</p></li><li><p>block.blockhash(uint blockNumber) returns (bytes32): hash of the given block - only works for 256 most recent blocks</p></li><li><p>sha256(â¦) returns (bytes32): compute the SHA-256 hash of the (tightly packed) arguments</p></li><li><p>keccak256(â¦) returns (bytes32): compute the Ethereum-SHA-3(Keccak-256) hash of the (tightly packed) arguments</p></li><li><p>sha3(â¦) returns (bytes32): alias for keccak256</p></li><li><p>ecrecover(bytes32 hash, uint8 v, bytes32 r, bytes32 s) returns (address): recover address associated with the public key from elliptic curve signature</p></li><li><p>addmod(uint x, uint y, uint k) returns (uint): compute <code>(x + y) % k</code> where the addition is performed with arbitrary precision and does not wrap around at 2 ** 256</p></li><li><p>mulmod(uint x, uint y, uint k) returns (uint): compute <code>(x * y) % k</code> where the addition is performed with arbitrary precision and does not wrap around 2 ** 256</p></li><li><p>selfdestruct(address recipient): destroy the current contract, sending its funds to the given address</p></li><li><p>suicide(address recipient): alias for selfdestruct</p></li><li><p><address>.balance: uint256: balance of the Address in Wei</address></p></li><li><p><address>.send(uint256 amount) returns (bool): send given amount of Wei to Address, returns <code>false</code> on failure</address></p></li><li><p><address>.transfer(uint256 amount): send given amount of Wei to Address, throws on failure.</address></p></li></ul><h3 id="Scope-Variables"><a href="#Scope-Variables" class="headerlink" title="Scope Variables"></a>Scope Variables</h3><ul><li><p>this: current contractâs type - the current contract, explicitly convertable to address</p></li><li><p>super: the contract one level higher in the inheritance hierarchy</p></li></ul><h3 id="Function-Visibility-Specifier"><a href="#Function-Visibility-Specifier" class="headerlink" title="Function Visibility Specifier"></a>Function Visibility Specifier</h3><ul><li><p>public: visible externally and internally(creates accessor function for storage/state variables)</p></li><li><p>private: only visible in the current contract</p></li><li><p>external: only visible externally(only for functions) - i.e. can only be message-called)</p></li><li><p>internal: only visible internally</p></li></ul><h3 id="Modifiers"><a href="#Modifiers" class="headerlink" title="Modifiers"></a>Modifiers</h3><ul><li><p>pure: for function - disallows modification or access of state - this is not enforced yet</p></li><li><p>view: for function - disallows modifiction of state - this is not enforced yet</p></li><li><p>payable: for function - allows them to receive Ether together with a call</p></li><li><p>constant: for state variable - disallow assignment(except initialization), does not occupy storage slot</p></li><li><p>contant: for function - same as view</p></li><li><p>anonymous: for events - does not store event signature as topic</p></li><li><p>indexed: for event parameters - store the parameter as topic</p></li></ul><p><img src="https://s3-eu-west-1.amazonaws.com/b9-academy-assets/public/solidity-cheatsheet.png" alt=""></p>]]></content>
      
      
        <tags>
            
            <tag> Solidity </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>HTTP/2 by Node.js</title>
      <link href="/2017/11/07/HTTP-2-by-Node-js/"/>
      <content type="html"><![CDATA[<p><a href="https://dexecure.com/blog/how-to-create-http2-static-file-server-nodejs-with-examples/" target="_blank" rel="noopener">Origin</a></p><p>Websites delivered using HTTP/2 enjoys a wide range of new features including -</p><ul><li><p>fully multiplexed connections: all requests and responses to a domain are fully multiplexed via a single connection, making best use of available bandwidth.</p></li><li><p>header compression: repeated headers are compressed with HPACK compression so that they are not resent with every request and response.</p></li><li><p>PUSH: resources can be pre-emptively pushed by the server to the client, speeding up page load times.</p></li></ul><p>Node.js just launched support(v8.8.1) for HTTP/2 as part of their core. In this post, we will create a simple HTTP/2 server to serve static files and then demonstrate some cool features like HTTP/2 PUSH.</p><h3 id="Get-an-SSL-certificate"><a href="#Get-an-SSL-certificate" class="headerlink" title="Get an SSL certificate"></a>Get an SSL certificate</h3><p>Even though the HTTP/2 spec does not mandate HTTPS, browsers have decided that they will only support HTTP/2 on a HTTPS connection. This would also mitigate interference from older proxies which may not understand newer protocol.</p><p>For your local server, a self-signed certificate will work. You can find how to setup a self-signed certificate <a href="https://www.digitalocean.com/community/tutorials/how-to-create-a-self-signed-ssl-certificate-for-nginx-in-ubuntu-16-04" target="_blank" rel="noopener">here</a></p><h3 id="Building-a-Static-File-Server"><a href="#Building-a-Static-File-Server" class="headerlink" title="Building a Static File Server"></a>Building a Static File Server</h3><p>Let us start with a simple server which just serves static files. Note that if you are using node.js 8.7.0, you need to run node with the <code>--expose-http2</code> flag.</p><p>We will be listening to the <code>stream</code> event and responding to it with the corresponding file from the server root(public, in this case) using the <code>respondWithFile</code> API. We are using the <code>mime-type</code> module to look up the correct mime type to send along with the response.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http2 = <span class="built_in">require</span>(<span class="string">'http2'</span>)</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> mime = <span class="built_in">require</span>(<span class="string">'mime-types'</span>)</span><br><span class="line"></span><br><span class="line">cosnt &#123;</span><br><span class="line">  HTTP2_HEADER_PATH,</span><br><span class="line">  HTTP2_HEADER_METHOD,</span><br><span class="line">  HTTP_STATUS_NOT_FOUND,</span><br><span class="line">  HTTP_STATUS_INTERNAL_SERVER_ERROR</span><br><span class="line">&#125; = http2.constants</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> options = &#123;</span><br><span class="line">  key: fs.readFileSync(<span class="string">'./selfsigned.key'</span>),</span><br><span class="line">  cert: fs.readFileSync(<span class="string">'./selfsigned.crt'</span>),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http2.createSecureServer(options)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> serverRoot = <span class="string">'./public'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">respondToStreamError</span>(<span class="params">err, stream</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err)</span><br><span class="line">  <span class="keyword">if</span> (err.code === <span class="string">'ENOENT'</span>) &#123;</span><br><span class="line">    stream.respond(&#123;</span><br><span class="line">      <span class="string">':stats'</span>: HTTPS_STATUS_NOT_FOUND,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    stream.respond(&#123;</span><br><span class="line">      <span class="string">':status'</span>: HTTP_STATUS_INTERNAL_SERVER_ERROR,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  stream.end()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">'stream'</span>, (stream, headers) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> reqPath = headers[HTTP2_HEADER_PATH]</span><br><span class="line">  <span class="keyword">const</span> reqMethod = headers[HTTP2_METHOD]</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> fullPath = path.join(serverRoot, reqPath)</span><br><span class="line">  <span class="keyword">const</span> responseMimeType = mime.lookup(fullPath)</span><br><span class="line"></span><br><span class="line">  stream.respondWithFile(fullPath, &#123;</span><br><span class="line">    <span class="string">'content-type'</span>: responseMimeType</span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    onError: <span class="function"><span class="params">err</span> =&gt;</span> respondToStreamError(err, stream)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">443</span>)</span><br></pre></td></tr></table></figure><h3 id="Server-PUSH-Example"><a href="#Server-PUSH-Example" class="headerlink" title="Server PUSH Example"></a>Server PUSH Example</h3><p>Now we have simpel HTTP/2 server running, lets try to use one of the new featues in HTTP/2 - HTTP/2 PUSH. This can lead to significant performance improvements in high latency environments, if done correctly.</p><p>We are loading a simple HTML file pointing to style.css which references to our font file. The request to the font file is only made after css file is discovered in the HTML, downloaded and then parsed. This is how the waterfall would have usually looked like:</p><p><img src="https://dexecure.com//images/blog/waterfall-without-http2.53b722f2.png" alt=""></p><p>You can initate a new PUSH with the <code>pushStream</code> API. Since we know that the browser is going to be requesting the font file in the future, we can PUSH the font file as soon as the server receives the request for the HTML file.</p><p>When the actual request for the font file takes place, it is claimed from the PUSH cache, instead of making a network request then.</p><p><img src="https://dexecure.com//images/blog/waterfall-with-http2.b47218ea.png" alt=""></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http2 = <span class="built_in">require</span>(<span class="string">'http2'</span>)</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> mime = <span class="built_in">require</span>(<span class="string">'mime-types'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">  HTTP2_HEADER_PATH,</span><br><span class="line">  HTTP2_HEADER_METHOD,</span><br><span class="line">  HTTP_STATUS_NOT_FOUND,</span><br><span class="line">  HTTP_STATUS_INTERNAL_SERVER_ERROR,</span><br><span class="line">&#125; = http2.constants</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> options = &#123;</span><br><span class="line">  key: fs.readFileSync(<span class="string">'./selfsigned.key'</span>),</span><br><span class="line">  cert: fs.readFileSync(<span class="string">'./selfsigned.crt'</span>),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http2.createSecureServer(options)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> serverRoot = <span class="string">'./public'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">respondToStreamError</span> (<span class="params">err, stream</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err)</span><br><span class="line">  <span class="keyword">if</span> (err.code === <span class="string">'ENOENT'</span>) &#123;</span><br><span class="line">    stream.respond(&#123;</span><br><span class="line">      <span class="string">':status'</span>: HTTP_STATUS_NOT_FOUND,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    stream.respond(&#123;</span><br><span class="line">      <span class="string">':status'</span>: HTTP_STATUS_INTERNAL_SERVER_ERROR,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  stream.end()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">'stream'</span>, (stream, headers) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> reqPath = headers[HTTP2_HEADER_PATH]</span><br><span class="line">  <span class="keyword">const</span> reqMethod = headers[HTTP2_HEADER_METHOD]</span><br><span class="line">  <span class="keyword">const</span> fullPath = path.join(serverRoot, reqPath)</span><br><span class="line">  <span class="keyword">const</span> responseMimeType = mime.lookup(fullPath)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (fullPath.endsWith(<span class="string">'.html'</span>)) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'html'</span>)</span><br><span class="line">    <span class="comment">// handle the html file</span></span><br><span class="line">    stream.respondWithFile(fullPath, &#123;</span><br><span class="line">      <span class="string">'content-type'</span>: <span class="string">'text/html'</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">      onError: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        respondToStreamError(err, stream)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    stream.pushStream(&#123;</span><br><span class="line">      <span class="string">':path'</span>: <span class="string">'/font.woff'</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">      parent: stream.id,</span><br><span class="line">    &#125;, pushStream =&gt; &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'pushing'</span>)</span><br><span class="line">      pushStream.respondWithFile(path.join(serverRoot, <span class="string">'/font.woff'</span>), &#123;</span><br><span class="line">        <span class="string">'content-type'</span>: <span class="string">'text/css'</span>,</span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        onError: <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">          respondToStreamError(err, pushStream)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// handle the static file</span></span><br><span class="line">    <span class="built_in">console</span>.log(fullPath)</span><br><span class="line">    stream.respondWithFile(fullPath, &#123;</span><br><span class="line">      <span class="string">'content-type'</span>: responseMimeType,</span><br><span class="line">    &#125;, &#123;</span><br><span class="line">      onError: <span class="function"><span class="params">err</span> =&gt;</span> respondToStreamError(err, stream)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">443</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> HTTP2, Node </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Rocket of Rust</title>
      <link href="/2017/11/06/Rocket-of-Rust/"/>
      <content type="html"><![CDATA[<h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p>Rocketâs design is centered around three core philosophies:</p><ul><li><p><strong>Function declaration and parameter type should contain all necessary information to validate and process a request</strong>. This immediately prohibits APIs where request state is retrieved from a global context. As a result, request handling is <strong>self-contained</strong> in Rocket: handlers are regular functions with regular arguments.</p></li><li><p><strong>All request handling information should be typed</strong>. Because the web and HTTP are themselves untyped(or stringly typed, as some call it), this means that something or someone has to convert strings to native types. Rocket does this for you with zero programming overhead.</p></li><li><p><strong>Decisions should not be forced</strong>. Templates, serialization, sessions and just about everything else are all pluggable, optional components. While Rocket has official support and libraries for each of these, they are completely optional and swappable.</p></li></ul><h3 id="Getting-Started"><a href="#Getting-Started" class="headerlink" title="Getting Started"></a>Getting Started</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo new hello-rocket --bin</span><br></pre></td></tr></table></figure><p>Add Dependencies</p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[dependencies]</span></span><br><span class="line"><span class="attr">rocket</span> = <span class="string">"0.3.3"</span></span><br><span class="line"><span class="attr">rocket_codegen</span> = <span class="string">"0.3.3"</span></span><br></pre></td></tr></table></figure><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#![feature(plugin)]</span></span><br><span class="line"><span class="meta">#![plugin(rocket_codegen)]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">crate</span> rocket;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[get(<span class="meta-string">"/"</span>)]</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">index</span></span>() -&gt; &amp;<span class="symbol">'static</span> <span class="built_in">str</span> &#123;</span><br><span class="line">  <span class="string">"Hello World"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span> </span>() &#123;</span><br><span class="line">  rocket::ignite().mount(<span class="string">"/"</span>, routes![index]).launch();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>It creates an <code>index</code> route, <em>mount</em> the route at the <code>/</code> path, and launches the application. Compile and run the program with <code>cargo run</code>, you should see the following:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ð§  Configured <span class="keyword">for</span> development.</span><br><span class="line">    =&gt; address: localhost</span><br><span class="line">    =&gt; port: 8000</span><br><span class="line">    =&gt; <span class="built_in">log</span>: normal</span><br><span class="line">    =&gt; workers: [core count * 2]</span><br><span class="line">    =&gt; secret key: generated</span><br><span class="line">    =&gt; limits: forms = 32KiB</span><br><span class="line">    =&gt; tls: disabled</span><br><span class="line">ð°  Mounting <span class="string">'/'</span>:</span><br><span class="line">    =&gt; GET /</span><br><span class="line">ð  Rocket has launched from http://localhost:8000</span><br></pre></td></tr></table></figure><h3 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h3><p>Rocket provides primitives to build web servers and applications with Rust: the rest is up to you. In short, Rocket provides <strong>routing, pre-processing of requests and psot-processing of response</strong>. Your application code instructs Rocket what to pre-process and post-process and fills the gaps between pre-processing and post-processing.</p><h4 id="LifeCycle"><a href="#LifeCycle" class="headerlink" title="LifeCycle"></a>LifeCycle</h4><p>Rocketâs main task is to listen for incoming web prequests, dispatch the request to the application code, and retur a response to the client. We call the process that goes form request to response the âlifecycleâ. The lifecycle can be summarized as following sequence of steps:</p><ul><li><p><strong>Routing</strong></p><p>Rocket parse an incoming HTTP request into native structure that your code operates on indirectly. Rocket determines which request handler to invoke by matching against route attributes declared in your application.</p></li><li><p><strong>Validation</strong></p><p>Rocket validates the incoming request against types and guards present in the matched route. If validation fails, Rocket <em>forwards</em> the request to the next matching route or calls an <em>error handler</em>.</p></li><li><p><strong>Processing</strong></p><p>The request handler associated with the route is invoked with validated arguments. This is the main business logic of an application. Processing completes by returning a <code>Response</code>.</p></li><li><p><strong>Response</strong></p><p>The returned <code>Response</code> is processed. Rocket generates the appropriate HTTP response and sends it to the client. This completes the lifecycle. Rocket continues listening for requesting, restarting the lifecycle for each incoming request.</p></li></ul><h4 id="Routing"><a href="#Routing" class="headerlink" title="Routing"></a>Routing</h4><p>Rocket applications are centered around routes and handlers. A <em>route</em> is a combination of: </p><ul><li><p>A set of parameters to match an incoming request against.</p></li><li><p>A handler to process the request and return a response.</p></li></ul><p>A handler is simply a function that takes an arbirary number of arguments and returns any arbitrary type.</p><p>The parameters to match against include static paths, dynamic paths, path segments, forms, query string, request format specifiers and body data. Rocket uses attributes, which look like function decoration in other languages to make declaring routes easy. Routes are declared by annotating a function, the handler, with a set of parameters to match against. A complete route declaration looks like this:</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[get(<span class="meta-string">"/world"</span>)]</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">world</span></span>() -&gt; &amp;<span class="symbol">'static</span> <span class="built_in">str</span> &#123;</span><br><span class="line">  <span class="string">"Hello World"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This declare the <code>world</code> route to match against the static path <code>/world</code> on incoming <code>GET</code> requests. The <code>world</code> route is simple, but additional route parameters are necessary when building more interesting application.</p><h4 id="Mounting"><a href="#Mounting" class="headerlink" title="Mounting"></a>Mounting</h4><p>Before Rocket can dispatch requests to a route, the route needs to be <em>mounted</em>. Mounting a route is like namespacing it. Routes are mounted via the <code>mount</code> method on a <code>Rocket</code> instance. A <code>Rocket</code> instance is typically created with the <code>racket::ignite()</code> static method.</p><p>The <code>mount</code> method takes:</p><ul><li><p>A path to namespace a list of routes under.</p></li><li><p>A list of route handlers through the <code>routes!</code> macro, typing Rocketâs code generation to your application.</p></li></ul><p>For instance, to mount the <code>world</code> route we declared above, we can write the following:</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rocket::ignite().mount(<span class="string">"/hello"</span>, routes![world]);</span><br></pre></td></tr></table></figure><p>This create a new <code>Rocket</code> instance via the <code>ignite</code> function and mounts the <code>world</code> route to the <code>/hello</code> path. As a result, <code>GET</code> requests to the <code>/hello/world</code> path will be directed to the <code>world</code> function.</p><h4 id="Namespacing"><a href="#Namespacing" class="headerlink" title="Namespacing"></a>Namespacing</h4><p>When a route is declared inside a module other than the root, you may find yourself with unexpected errors when mounting: </p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mod</span> other &#123;</span><br><span class="line">  <span class="meta">#[get(<span class="meta-string">"/world"</span>)]</span></span><br><span class="line">  <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">world</span></span>() -&gt; <span class="built_in">String</span> &#123;</span><br><span class="line">    <span class="string">"Hello World"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span> </span>() &#123;</span><br><span class="line">  rocket::ignite().mount(<span class="string">"/hello"</span>, routes![world]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This occurs because the <code>routes!</code> macro implicitly converts the routeâs name into the name of a structure generated by Rocketâs code generation. The solution is to name the route by a module path instead:</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rocket::ignite().mount(<span class="string">"/hello"</span>, routes![other::world]);</span><br></pre></td></tr></table></figure><h4 id="Launching"><a href="#Launching" class="headerlink" title="Launching"></a>Launching</h4><p>Now that Rocket knows about the route, you can tell Rocket to start accepting requests via the <code>launch</code> method. The method starts up the server and wait for incoming requests. When a request arrives, Rocket finds the matching route and dispatches the requests to the routeâs handler.</p><p>We typically call <code>launch</code> from the <code>main</code> function. Our complete <em>Hello World</em> application thus looks like:</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#![feature(plugin)]</span></span><br><span class="line"><span class="meta">#![plugin(rocket_codegen)]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">crate</span> rocket;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[get(<span class="meta-string">"/world"</span>)]</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">world</span></span>() -&gt; <span class="built_in">String</span> &#123;</span><br><span class="line">  <span class="string">"Hello World"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span> </span>() &#123;</span><br><span class="line">  rocket::ignite().mount(<span class="string">"/hello"</span>, routes![world]).launch();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> Rust, Rocket </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Fastify Plugin Guide</title>
      <link href="/2017/10/26/Fastify-Plugin-Guide/"/>
      <content type="html"><![CDATA[<p>In Fastify everything is a plugin, your routes, your utilities and so on are all plugins. And to add a new plugin, whatever its functionality is, in Fastify</p><h3 id="Registers"><a href="#Registers" class="headerlink" title="Registers"></a>Registers</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastify.register(<span class="built_in">require</span>(<span class="string">'./my-plugin'</span>, opts, callback))</span><br></pre></td></tr></table></figure><p>Register creates a new Fastify context, this means that if you do any change to the Fastify instance, that change will not be reflected into the contextâs ancestors. In other words, encapsulated!</p><p>Required Plugins must expose a single function with the following signature:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">instance, opts, next</span>) </span>&#123;&#125;</span><br></pre></td></tr></table></figure><p>The Fastifyâs plugin module is fully reentrant and graph-based, it handles without any kind of problem asynchronous code and it guarantees the load order of the plugins, even the close order.</p><h3 id="Decorators"><a href="#Decorators" class="headerlink" title="Decorators"></a>Decorators</h3><p>Fastify offers you a way nice and elegant to wrote an utility: decorator.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastify.decorate(<span class="string">'util'</span>, (a, b) =&gt; a + b)</span><br></pre></td></tr></table></figure><p>Now you can access your utility by doing <code>fastify.util</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fastify.register(<span class="function">(<span class="params">instance, opts, next</span>)=&gt;</span> &#123;</span><br><span class="line">  instance.decorate(<span class="string">'util'</span>, (a, b) =&gt; a + b)</span><br><span class="line">  next()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Hooks"><a href="#Hooks" class="headerlink" title="Hooks"></a>Hooks</h3><p>Execute your utility.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">fastify.register(<span class="function">(<span class="params">instance, opts, next</span>) =&gt;</span> &#123;</span><br><span class="line">  instance.decorate(<span class="string">'util'</span>, (req, key, value) =&gt; &#123; req.key = value &#125;)</span><br><span class="line"></span><br><span class="line">  instance.addHook(<span class="string">'preHandler'</span>, (req, reply, done) =&gt; &#123;</span><br><span class="line">    instance.util(req, <span class="string">'timestamp'</span>, <span class="keyword">new</span> <span class="built_in">Date</span>())</span><br><span class="line">    done()</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  instance.get(<span class="string">'/plugin1'</span>, (req, reply) =&gt; &#123;</span><br><span class="line">    reply.send(req)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  next()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fastify.get(<span class="string">'/plugin2'</span>, (req, reply) =&gt; &#123;</span><br><span class="line">  reply.send(req)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> Node, Fastify </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Time to Start Fastify</title>
      <link href="/2017/10/23/Time-to-start-fastify/"/>
      <content type="html"><![CDATA[<h3 id="Getting-Started"><a href="#Getting-Started" class="headerlink" title="Getting Started"></a>Getting Started</h3><h4 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add fastify</span><br></pre></td></tr></table></figure><h4 id="First-Server"><a href="#First-Server" class="headerlink" title="First Server"></a>First Server</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Require the framework and instantiate it</span></span><br><span class="line"><span class="keyword">const</span> fastify = <span class="built_in">require</span>(<span class="string">'fastify'</span>)()</span><br><span class="line"></span><br><span class="line"><span class="comment">// Declare a route</span></span><br><span class="line">fastify.get(<span class="string">'/'</span>, (req, reply) =&gt; &#123;</span><br><span class="line">  reply.send(&#123;</span><br><span class="line">    hello: <span class="string">'world'</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Run the server</span></span><br><span class="line">fastify.listen(<span class="number">3000</span>, (err) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Server is running on <span class="subst">$&#123;fastify.server.address().port&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="Schema-Serialization"><a href="#Schema-Serialization" class="headerlink" title="Schema Serialization"></a>Schema Serialization</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fastify = <span class="built_in">require</span>(<span class="string">'fastify'</span>)()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> opts = &#123;</span><br><span class="line">  schema: &#123;</span><br><span class="line">    response: &#123;</span><br><span class="line">      <span class="number">200</span>: &#123;</span><br><span class="line">        type: <span class="string">'object'</span>,</span><br><span class="line">        properties: &#123;</span><br><span class="line">          hello: &#123; <span class="attr">type</span>: <span class="string">'string'</span> &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Declare a route with an output shcema</span></span><br><span class="line">fastify.get(<span class="string">'/'</span>, opts, (req, reply) =&gt; &#123;</span><br><span class="line">  replysend(&#123; <span class="attr">hello</span>: <span class="string">'world'</span> &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fastify.listen(<span class="number">3000</span>, (err) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Server is running on <span class="subst">$&#123;fastify.server.address().port&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="Register"><a href="#Register" class="headerlink" title="Register"></a>Register</h4><p>Register routes in seperate files</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"><span class="keyword">const</span> fastify = <span class="built_in">require</span>(<span class="string">'fastify'</span>)()</span><br><span class="line"></span><br><span class="line">fastify.register(<span class="built_in">require</span>(<span class="string">'./route'</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> opts = &#123;</span><br><span class="line">  hello: <span class="string">'world'</span>,</span><br><span class="line">  something: <span class="literal">true</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fastify.register([</span><br><span class="line">  <span class="built_in">require</span>(<span class="string">'./another-route'</span>),</span><br><span class="line">  <span class="built_in">require</span>(<span class="string">'./yet-another-route'</span>),</span><br><span class="line">], opts, (err) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fastify.listen(<span class="number">3000</span>, (err) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Server is running on <span class="subst">$&#123;fastify.server.address().port&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// route.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = (fastify, options, next) &#123;</span><br><span class="line">  fastify.get(<span class="string">'/'</span>, (req, reply) =&gt; &#123;</span><br><span class="line">    replysend(&#123; <span class="attr">hello</span>: <span class="string">'world'</span> &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  next()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>or <code>async/await</code>:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="keyword">async</span> (fastify, options) =&gt; &#123;</span><br><span class="line">  fastify.get(<span class="string">'/'</span>, (req, reply) =&gt; &#123;</span><br><span class="line">    replysend(&#123; <span class="attr">hello</span>: <span class="string">'world'</span> &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Server-Methods"><a href="#Server-Methods" class="headerlink" title="Server Methods"></a>Server Methods</h3><h4 id="server"><a href="#server" class="headerlink" title="server"></a>server</h4><p><code>fastify.server</code>: The Node Core <code>server</code> object.</p><h4 id="ready"><a href="#ready" class="headerlink" title="ready"></a>ready</h4><p>Function  called when all the plugins has been loaded. It takes an error parameter if something went wrong.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastify.ready(<span class="function"><span class="params">err</span> =&gt;</span> &#123; <span class="keyword">if</span> (err) <span class="keyword">throw</span> err &#125;)</span><br></pre></td></tr></table></figure><h4 id="listen"><a href="#listen" class="headerlink" title="listen"></a>listen</h4><p>Starts the server on the given port after all the plugins loaded, internally waits for the <code>.ready()</code> event. The callback is the same as the Node Core.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fastify.listen(<span class="number">3000</span>, err =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Specifying an address is also supported:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fastify.listen(<span class="number">3000</span>, <span class="string">'127.0.0.1'</span>, err =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="route"><a href="#route" class="headerlink" title="route"></a>route</h4><p>Method to add routes to the server, it also have shorthands.</p><h4 id="routes-iterator"><a href="#routes-iterator" class="headerlink" title="routes iterator"></a>routes iterator</h4><p>The fastify instance is an Iterable object with all the registered routes. The route properties are the same the developer has declared.</p><h4 id="close"><a href="#close" class="headerlink" title="close"></a>close</h4><p><code>fastify.close(callback)</code>, call this function to close the server instance and run the <code>onClose</code> hook.</p><h4 id="decorate"><a href="#decorate" class="headerlink" title="decorate*"></a>decorate*</h4><p>Function useful if you need to decorate the fastify instance, Reply or Request.</p><h4 id="register"><a href="#register" class="headerlink" title="register"></a>register</h4><p>Fastify allows the user to extends its functionalities with plugins. A plugin can be a set of routes, a server decorator or whatever.</p><h4 id="use"><a href="#use" class="headerlink" title="use"></a>use</h4><p>Function to add middlewares to Fastify.</p><h4 id="addHook"><a href="#addHook" class="headerlink" title="addHook"></a>addHook</h4><p>Function to add a specific hook in the lifecycle of Fastify.</p><h4 id="logger"><a href="#logger" class="headerlink" title="logger"></a>logger</h4><p>The logger instance.</p><h4 id="Inject"><a href="#Inject" class="headerlink" title="Inject"></a>Inject</h4><p>Fake http injection(for testing purpose).</p><h4 id="setSchemaCompiler"><a href="#setSchemaCompiler" class="headerlink" title="setSchemaCompiler"></a>setSchemaCompiler</h4><p>Set the schema compiler for all routes.</p><h4 id="setNotFoundHandler"><a href="#setNotFoundHandler" class="headerlink" title="setNotFoundHandler"></a>setNotFoundHandler</h4><p><code>fastify.setNotFoundHandler(handler(req, reply))</code>: set the 404 handler. This call is fully encapsulated, so different plugins can set different not found handlers.</p><h4 id="setErrorHandler"><a href="#setErrorHandler" class="headerlink" title="setErrorHandler"></a>setErrorHandler</h4><p><code>fastify.setErrorHandler(handler(err, reply))</code>: set a function that will be called whenever an error happens. The handler is fully encapsulated, so different plugins can set different error handlers.</p><h3 id="Routes"><a href="#Routes" class="headerlink" title="Routes"></a>Routes</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastify.route(options)</span><br></pre></td></tr></table></figure><ul><li><p><code>method</code>: currently it supports <code>DELETE</code>, <code>GET</code>, <code>HEAD</code>, <code>PATCH</code>, <code>POST</code>, <code>PUT</code>, and <code>OPTIONS</code>, it could be an array of methods.</p></li><li><p><code>url</code>: the path of the url to match this route (alias: <code>path</code>)</p></li><li><p><code>schema</code>: an object containing the schemas for the request and response. They need to be in <code>JSON Schema</code> format.</p><ul><li><p><code>body</code>: validates the body of the request if it is a POST or PUT.</p></li><li><p><code>querystring</code>: validates the querystring. This can be a complete JSON Schema Object, with the property <code>type</code> of <code>object</code> and <code>properties</code> object of parameters, or simply the values of what would be contained in the properties object as shown below.</p></li><li><p><code>params</code>: validates the params.</p></li><li><p><code>response</code>: fitler and generate a schema for the response, setting a schema allows us to have 10-20% more throughput.</p></li></ul></li><li><p><code>beforeHandler(req, res, done)</code>: a function called just before the request handler, useful if you need to perform authentication at route level for example, it could also be and array of functions.</p></li><li><p><code>handler(req, reply)</code>: the function that will handle this request.</p></li><li><p><code>request</code> if defined in <code>Request</code>.</p></li><li><p><code>reply</code> is defined in <code>Reply</code>.</p></li></ul><p>Exmaple</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">fastify.route(&#123;</span><br><span class="line">  method: <span class="string">'GET'</span>,</span><br><span class="line">  url: <span class="string">'/'</span>,</span><br><span class="line">  schema: &#123;</span><br><span class="line">    querystring: &#123;</span><br><span class="line">      name: &#123; <span class="attr">type</span>: <span class="string">'string'</span> &#125;,</span><br><span class="line">      excitement: &#123; <span class="attr">type</span>: <span class="string">'integer'</span> &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    response: &#123;</span><br><span class="line">      <span class="number">200</span>: &#123;</span><br><span class="line">        type: <span class="string">'object'</span>,</span><br><span class="line">        properties: &#123;</span><br><span class="line">          hello: &#123; <span class="attr">type</span>: <span class="string">'string'</span> &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  handler: <span class="function"><span class="keyword">function</span> (<span class="params">req, reply</span>) </span>&#123;</span><br><span class="line">    reply.send(&#123;</span><br><span class="line">      hello: <span class="string">'world'</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fastify.route(&#123;</span><br><span class="line">  method: <span class="string">'GET'</span>,</span><br><span class="line">  url: <span class="string">'/'</span>,</span><br><span class="line">  schema: &#123;<span class="comment">/*..*/</span>&#125;,</span><br><span class="line">  beforeHandler: <span class="function"><span class="keyword">function</span> (<span class="params">req, reply, done</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// auth</span></span><br><span class="line">    done()</span><br><span class="line">  &#125;,</span><br><span class="line">  handler: <span class="function"><span class="keyword">function</span>(<span class="params">req, reply</span>) </span>&#123;</span><br><span class="line">    reply.send(&#123;</span><br><span class="line">      hello: <span class="string">'world'</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="ShortHands"><a href="#ShortHands" class="headerlink" title="ShortHands"></a>ShortHands</h4><p><code>fastify.method(path, [options], handler)</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> opts = &#123;</span><br><span class="line">  schema: &#123;</span><br><span class="line">    response: &#123;</span><br><span class="line">      <span class="number">200</span>: &#123;</span><br><span class="line">        type: <span class="string">'object'</span>,</span><br><span class="line">        properites: &#123;</span><br><span class="line">          hello: &#123; <span class="attr">type</span>: <span class="string">'string'</span> &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fastify.get(<span class="string">'/'</span>, opts, (req, reply) =&gt; &#123;</span><br><span class="line">  reply.send(&#123;</span><br><span class="line">    hello: <span class="string">'world'</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><code>fastify.all(path, [options], handler)</code> will add the same handler to all the supported methods.</p><h4 id="Async-Await"><a href="#Async-Await" class="headerlink" title="Async/Await"></a>Async/Await</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fastify.get(<span class="string">'/'</span>, options, <span class="keyword">async</span> (req, reply) =&gt; &#123;</span><br><span class="line">  <span class="keyword">var</span> data = <span class="keyword">await</span> getData()</span><br><span class="line">  <span class="keyword">var</span> processed = <span class="keyword">await</span> processData(data)</span><br><span class="line">  <span class="keyword">return</span> processed</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="Route-Prefixing"><a href="#Route-Prefixing" class="headerlink" title="Route Prefixing"></a>Route Prefixing</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"><span class="keyword">const</span> fastify = <span class="built_in">require</span>(<span class="string">'fastify'</span>)()</span><br><span class="line"></span><br><span class="line">fastify.register(<span class="built_in">require</span>(<span class="string">'./routes/v1/users'</span>), &#123;</span><br><span class="line">  prefix: <span class="string">'/v1'</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// routes/v1/users</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">fastify, opts, next</span>) </span>&#123;</span><br><span class="line">  fastify.get(<span class="string">'/user'</span>, handler_v1)</span><br><span class="line">  next()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Now your client can access to <code>/v1/user</code>.</p><p>Be aware that if you use <code>fastify-plugin</code> this option wonât work.</p><h3 id="Logging"><a href="#Logging" class="headerlink" title="Logging"></a>Logging</h3><p>Logging is disabled by default, and you can enable it by passing <code>{ logger: true }</code> or <code>{ logger: { level: &#39;info&#39; } }</code> when you create the fastify instance.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fastify = <span class="built_in">require</span>(<span class="string">'fastify'</span>)(&#123;</span><br><span class="line">  logger: <span class="literal">true</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fastify.get(<span class="string">'/'</span>, options, (req, reply) =&gt; &#123;</span><br><span class="line">  req.log.info(<span class="string">'Some info about the current request'</span>)</span><br><span class="line">  reply.send(&#123;</span><br><span class="line">    hello: <span class="string">'world'</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Middlewares"><a href="#Middlewares" class="headerlink" title="Middlewares"></a>Middlewares</h3><p>Fastify provides out of the box an asynchronous middleare engine compatible with Express and Restify middlewares.</p><p>Fastify middleware donât support the full syntax <code>middleware(err, req, res, next)</code> because error handling is done inside Fastify.</p><p>Also if you are using a middleware taht bundles different, smaller middlewares such as helmet, we recommand to use the single module to get better performances.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fastify.use(<span class="built_in">require</span>(<span class="string">'cors'</span>)())</span><br><span class="line">fastify.use(<span class="built_in">require</span>(<span class="string">'dns-prefetch-control'</span>)())</span><br><span class="line">fastify.use(<span class="built_in">require</span>(<span class="string">'frameguard'</span>)())</span><br><span class="line">fastify.use(<span class="built_in">require</span>(<span class="string">'hide-powered-by'</span>)())</span><br><span class="line">fastify.use(<span class="built_in">require</span>(<span class="string">'hsts'</span>)())</span><br><span class="line">fastify.use(<span class="built_in">require</span>(<span class="string">'ienoopen'</span>)())</span><br><span class="line">fastify.use(<span class="built_in">require</span>(<span class="string">'x-xss-protection'</span>)())</span><br></pre></td></tr></table></figure><p>If you need to run a middleware only under certain path, just pass the path as first parameter to <code>use</code> and you are done.</p><p>Note that this does not support routes with parameters, (eg: <code>/users/:id/comments</code>) and wildcard is not supported in multiple paths.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> serveStatic = <span class="built_in">require</span>(<span class="string">'serve-static'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// single path</span></span><br><span class="line">fastify.use(<span class="string">'/css'</span>, servveStatic(<span class="string">'/asserts'</span>))</span><br><span class="line"><span class="comment">// wildcard path</span></span><br><span class="line">fastify.use(<span class="string">'/css/*'</span>, servveStatic(<span class="string">'/asserts'</span>))</span><br><span class="line"><span class="comment">// multiple paths</span></span><br><span class="line">fastify.use([<span class="string">'/css'</span>, <span class="string">'/js'</span>], servveStatic(<span class="string">'/asserts'</span>))</span><br></pre></td></tr></table></figure><h3 id="Hook"><a href="#Hook" class="headerlink" title="Hook"></a>Hook</h3><p>By using the hook you can interact directly inside the lifecycle of Fastify, there are three different Hooks that you can use(in order of execution):</p><ul><li><p><code>onRequest</code></p></li><li><p><code>preHandler</code></p></li><li><p><code>onResponse</code></p></li><li><p><code>onClose</code></p></li></ul><p>Example:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">fastify.addHook(<span class="string">'onRequest'</span>, (req, res, next) =&gt; &#123;</span><br><span class="line">  <span class="comment">// some code</span></span><br><span class="line">  next()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fastify.addHook(<span class="string">'preHandler'</span>, (req, res, next) =&gt; &#123;</span><br><span class="line">  <span class="comment">// some code</span></span><br><span class="line">  next()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fastify.addHook(<span class="string">'onResponse'</span>, (res, next) =&gt; &#123;</span><br><span class="line">  <span class="comment">// some code</span></span><br><span class="line">  next()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>If you want to pass a custom error code to the user, just use the <code>reply.code()</code>:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fastify.addHook(<span class="string">'onRequest'</span>, (req, res, next) =&gt; &#123;</span><br><span class="line">  <span class="comment">// some code</span></span><br><span class="line">  reply.code(<span class="number">400</span>)</span><br><span class="line">  next(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'some error'</span>))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>The error will be handled by <code>Reply</code></p><p>The unique hook that is not inside the lifecycle is <code>&#39;onClose&#39;</code>, this one is triggered when you call <code>fastify.close()</code> to stop the server, and it is useful if you have some plugins that need a âshutdownâ part, such as a connection to database.</p><p>Only for this hook the parameters of the functions changes.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fastify.addHook(<span class="string">'onClose'</span>, (instance, done) =&gt; &#123;</span><br><span class="line">  <span class="comment">// some code</span></span><br><span class="line">  done()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="Scope"><a href="#Scope" class="headerlink" title="Scope"></a>Scope</h4><p>Except for <code>onClose</code> all the hooks are encapsulated this means that you can decide where your hooks should run by using <code>register</code>.</p><h4 id="beforeHandler"><a href="#beforeHandler" class="headerlink" title="beforeHandler"></a>beforeHandler</h4><p><code>beforeHandler</code> is not a standard hook like <code>preHandler</code>, but is a function that your register right in the route option that will be executed only in the specified route.</p><p><code>beforeHandler</code> is executed always after the <code>preHandler</code> hook.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">fastify.addHook(<span class="string">'preHander'</span>, (req, reply, done) =&gt; &#123;</span><br><span class="line">  <span class="comment">//  your code</span></span><br><span class="line">  done()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fastify.route(&#123;</span><br><span class="line">  method: <span class="string">'GET'</span>,</span><br><span class="line">  url: <span class="string">'/'</span>,</span><br><span class="line">  schema: &#123;<span class="comment">/*...*/</span>&#125;,</span><br><span class="line">  beforeHandler: <span class="function">(<span class="params">req, reply, done</span>) =&gt;</span> &#123;<span class="comment">/*...*/</span> ;done()&#125;</span><br><span class="line">  handler: <span class="function">(<span class="params">req, reply</span>) =&gt;</span> &#123; reply.send(&#123; <span class="attr">hello</span>: <span class="string">'world'</span> &#125;) &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fastify.route(&#123;</span><br><span class="line">  method: <span class="string">'GET'</span>,</span><br><span class="line">  url: <span class="string">'/'</span>,</span><br><span class="line">  shcema: &#123;<span class="comment">/*...*/</span>&#125;,</span><br><span class="line">  beforeHandler: [</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">first</span> (<span class="params">req, reply, done</span>) </span>&#123;</span><br><span class="line">      done()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">second</span> (<span class="params">req, reply, done</span>) </span>&#123;</span><br><span class="line">      done()</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  handler: <span class="function"><span class="keyword">function</span> (<span class="params">req, reply</span>) </span>&#123;</span><br><span class="line">    reply.send(&#123; <span class="attr">hello</span>: <span class="string">'world'</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Decorators"><a href="#Decorators" class="headerlink" title="Decorators"></a>Decorators</h3><p>If you need to add functionalities to the Fastify instance, the <code>decorator</code> api is what you need.</p><p>This api allows you to add new properties to the Fastify instance, a property value is not restricted to be a function, could also be an object or a string for example.</p><h4 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h4><h5 id="decorate-1"><a href="#decorate-1" class="headerlink" title="decorate"></a>decorate</h5><p>Just call the <code>decorate</code> api and pass the name of the new property and its value.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fastify.decorate(<span class="string">'utility'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="comment">// something very useful</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>As said above, you can decorate the instance with other values and not only functions:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fastify.decorate(<span class="string">'conf'</span>, &#123;</span><br><span class="line">  db: <span class="string">'some db'</span>,</span><br><span class="line">  port: <span class="number">3000</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Once you decorate the instance you can access the value every time you need by using the name you passed as parameter:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fastify.utility()</span><br><span class="line"><span class="built_in">console</span>.log(fastify.conf.db)</span><br></pre></td></tr></table></figure><p>Decorators are not <em>overwritable</em>, if you try to declare a decorator already declared, <code>decorate</code> will throw an exception.</p><h5 id="decorateReply"><a href="#decorateReply" class="headerlink" title="decorateReply"></a>decorateReply</h5><p>As the name suggest, this api is needed if you want to add new methods to the <code>Reply</code> core object. Just call the <code>decorateReply</code> api and pass the name of the new property and its value.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fastify.decorateReply(<span class="string">'utility'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// something very useful</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Note: using an arrow function will break the binding of <code>this</code> to the Fastify <code>reply</code> instance.</p><h5 id="decorateRequest"><a href="#decorateRequest" class="headerlink" title="decorateRequest"></a>decorateRequest</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fastify.decorateRequest(<span class="string">'utility'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// something very useful</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Note: using an arrow function will break the binding of <code>this</code> to the Fastify <code>request</code> instance.</p><h5 id="extendServerError"><a href="#extendServerError" class="headerlink" title="extendServerError"></a>extendServerError</h5><p>If you need to extend the standard <code>server error</code>, this api is what you need.</p><p>You must pass a function that returns an Object, Fastify will extend the server error with the returned object of your function. The function will receive the original error object.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">fastify.extendServerError(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    timestamp: <span class="keyword">new</span> <span class="built_in">Date</span>(),</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  The resulting object will be: &#123;</span></span><br><span class="line"><span class="comment">    error: string,</span></span><br><span class="line"><span class="comment">    message: string,</span></span><br><span class="line"><span class="comment">    statusCode: number,</span></span><br><span class="line"><span class="comment">    timestamp: date,</span></span><br><span class="line"><span class="comment">  &#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h4 id="Sync-and-Async"><a href="#Sync-and-Async" class="headerlink" title="Sync and Async"></a>Sync and Async</h4><p><code>decorate</code> is synchronous API, if you need to add a decorator that has an asynchronous bootstrap, could happen that Fastify boots up before your decorator is ready. To avoid this issue you must use <code>register</code> api in combination with <code>fastify-plugin</code>.</p><h4 id="Dependencies"><a href="#Dependencies" class="headerlink" title="Dependencies"></a>Dependencies</h4><p>If your decorator depends on another decorator, you can declare the dependencies of your function, itâs pretty easy, you just need to add an array of strings(representing the names of the decorators your are depending on) as third parameter.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastify.decorate(<span class="string">'utility'</span>, fn, [<span class="string">'greet'</span>, <span class="string">'log'</span>])</span><br></pre></td></tr></table></figure><p>If a dependency is not satisfied, <code>decorate</code> will throw an exception.</p><h4 id="hasDecorator"><a href="#hasDecorator" class="headerlink" title="hasDecorator"></a>hasDecorator</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastify.hasDecorator(<span class="string">'utility'</span>)</span><br></pre></td></tr></table></figure><h3 id="Validation-and-Serialize"><a href="#Validation-and-Serialize" class="headerlink" title="Validation and Serialize"></a>Validation and Serialize</h3><p>Fastify uses a schema based approach and even if it is not mandatory we recommend to use JSON Schema to validate you routes and serialize your output, internally Fastify compiles the schema in a highly performance function.</p><h4 id="Validation"><a href="#Validation" class="headerlink" title="Validation"></a>Validation</h4><p>The route validation internally uses <code>Ajv</code>, which is highly performant JSON validator. Validate the input is very easy, just add the fields that you need inside the route schema and you are done.</p><p>The supported validations are</p><ul><li><p>body: Validates the body of the request if it is a POST or PUT</p></li><li><p>querystring: Validates the querystring. This can be a complete JSON Schema object, with the property type of object and properties object of parameters, or simply the values of what would be contained in the properties object as shown below.</p></li><li><p>params: Validates teh route params.</p></li><li><p>headers: Validates teh request headers.</p></li></ul><p>Example:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> schema = &#123;</span><br><span class="line">  body: &#123;</span><br><span class="line">    type: <span class="string">'object'</span>,</span><br><span class="line">    properties: &#123;</span><br><span class="line">      someKey: &#123; <span class="attr">type</span>: <span class="string">'string'</span>&#125;,</span><br><span class="line">      someOtherKey: &#123; <span class="attr">type</span>: <span class="string">'number'</span> &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  querystring: &#123;</span><br><span class="line">    name: &#123; <span class="attr">type</span>: <span class="string">'string'</span> &#125;,</span><br><span class="line">    excitement: &#123; <span class="attr">type</span>: <span class="string">'integer'</span> &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  params: &#123;</span><br><span class="line">    type: <span class="string">'object'</span>,</span><br><span class="line">    properties: &#123;</span><br><span class="line">      par1: &#123; <span class="attr">type</span>: <span class="string">'string'</span> &#125;,</span><br><span class="line">      par2: &#123; <span class="attr">type</span>: <span class="string">'number'</span> &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  headers: &#123;</span><br><span class="line">    type: <span class="string">'object'</span>,</span><br><span class="line">    properties: &#123;</span><br><span class="line">      <span class="string">'x-foo'</span>: &#123; <span class="attr">type</span>: <span class="string">'string'</span> &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    required: [<span class="string">'x-foo'</span>],</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Schema-Compiler"><a href="#Schema-Compiler" class="headerlink" title="Schema Compiler"></a>Schema Compiler</h4><p>The <code>schemaCompiler</code> is a function that returns a function that validates the body, url parameters, headers and query string.</p><p>The default <code>schemaCompiler</code> returns a function that implements the <code>ajv</code> validation interface. <code>fastify</code> use it internally to speed the valiation up.</p><h4 id="Serialize"><a href="#Serialize" class="headerlink" title="Serialize"></a>Serialize</h4><p>Usually you will send your data to the clients via JSON, and Fastify has a powerful tools to help you: <code>fast-json-stringify</code>, which is used if you have provided an output schema in the route options.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> schema = &#123;</span><br><span class="line">  response: &#123;</span><br><span class="line">    <span class="number">200</span>: &#123;</span><br><span class="line">      type: <span class="string">'object'</span>,</span><br><span class="line">      properties: &#123;</span><br><span class="line">        value: &#123; <span class="attr">type</span>: <span class="string">'string'</span> &#125;,</span><br><span class="line">        otherValue: &#123; <span class="attr">type</span>: <span class="string">'boolean'</span> &#125;,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>As you can see the response schema is based on the status code, if you want to use the same schema for mutliple status code, you can use <code>2xx</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> schema = &#123;</span><br><span class="line">  response: &#123;</span><br><span class="line">    <span class="string">'2xx'</span>: &#123;</span><br><span class="line">      type: <span class="string">'object'</span>,</span><br><span class="line">      properties: &#123;</span><br><span class="line">        value: &#123; <span class="attr">type</span>: <span class="string">'string'</span> &#125;,</span><br><span class="line">        otherValue: &#123; <span class="attr">type</span>: <span class="string">'boolean'</span> &#125;,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="number">201</span>: &#123;</span><br><span class="line">      type: <span class="string">'object'</span>,</span><br><span class="line">      properties: &#123;</span><br><span class="line">        value: &#123; <span class="attr">type</span>: <span class="string">'string'</span> &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Lifecycle"><a href="#Lifecycle" class="headerlink" title="Lifecycle"></a>Lifecycle</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Incoming Request</span><br><span class="line">  â</span><br><span class="line">  âââ¶ Instance Logger</span><br><span class="line">        â</span><br><span class="line">        âââ¶ Routing</span><br><span class="line">             â</span><br><span class="line">       404 âââ´ââ¶ onRequest Hook</span><br><span class="line">                  â</span><br><span class="line">        4**/5** âââ´ââ¶ run Middlewares</span><br><span class="line">                        â</span><br><span class="line">              4**/5** âââ´ââ¶ Parsing</span><br><span class="line">                             â</span><br><span class="line">                       415 âââ´ââ¶ Validation</span><br><span class="line">                                   â</span><br><span class="line">                             400 âââ´ââ¶ preHandler Hook</span><br><span class="line">                                         â</span><br><span class="line">                               4**/5** âââ´ââ¶ beforeHandler</span><br><span class="line">                                               â</span><br><span class="line">                                     4**/5** âââ´ââ¶ User Handler</span><br><span class="line">                                                     â</span><br><span class="line">                                                     âââ¶ Reply</span><br><span class="line">                                                          â â</span><br><span class="line">                                                          â âââ¶ Outgoing Response</span><br><span class="line">                                                          â</span><br><span class="line">                                                          âââ¶ onResponse Hook</span><br></pre></td></tr></table></figure><h3 id="Reply"><a href="#Reply" class="headerlink" title="Reply"></a>Reply</h3><p>The second parameter of the handler function is <code>Reply</code>.</p><p>Reply is a core Fastify object that exposes the following functions:</p><ul><li><p>.code(statusCode)</p></li><li><p>.header(name, value)</p></li><li><p>.type(value): Set the header <code>Content-Type</code></p></li><li><p>.redirect([code, ] url): default code 302</p></li><li><p>.serializer(function): Set a custom serializer for the payload</p></li><li><p>.send(payload)</p></li><li><p>.sent: A boolean value that you can use if you need to know it <code>send</code> has already been called.</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fastify.get(<span class="string">'/'</span>, options, (request, reply) =&gt; &#123;</span><br><span class="line">  reply</span><br><span class="line">    .code(<span class="number">200</span>)</span><br><span class="line">    .type(<span class="string">'application/json'</span>)</span><br><span class="line">    .send(&#123; <span class="attr">hello</span>: <span class="string">'world'</span> &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h4><p>If not set via <code>reply.code</code>, the resulting <code>statusCode</code> will be <code>200</code></p><h4 id="Header"><a href="#Header" class="headerlink" title="Header"></a>Header</h4><p>Sets a custom header to the response.</p><p>If you not set a <code>Content-Type</code> header, Fastify assumes that you are using <code>application/json</code>, unless you are send a stream, in that case Fastify recognize it and sets the <code>Content-Type</code> at <code>application/octet-stream</code>.</p><h4 id="Redirect"><a href="#Redirect" class="headerlink" title="Redirect"></a>Redirect</h4><p>Redirects a request to the specified url, the status code is optional, default to <code>302</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reply.redirect(<span class="string">'/home'</span>)</span><br></pre></td></tr></table></figure><h4 id="Type"><a href="#Type" class="headerlink" title="Type"></a>Type</h4><p>Sets the content type for the response.</p><p>Itâs the shortcut for <code>reply.header(&#39;Content-Type&#39;, &#39;application/json&#39;)</code></p><h4 id="Serializer"><a href="#Serializer" class="headerlink" title="Serializer"></a>Serializer</h4><h4 id="Send"><a href="#Send" class="headerlink" title="Send"></a>Send</h4><h4 id="Objects"><a href="#Objects" class="headerlink" title="Objects"></a>Objects</h4><p>If you are sending JSON Objects, send will serialize the object with <code>fast-json-stringify</code> if you setted an output schema, otherwise <code>fast-safe-stringify</code></p><h4 id="Promises"><a href="#Promises" class="headerlink" title="Promises"></a>Promises</h4><p>Send handle natively the promsies and supports out of the box async-await:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">fastify.get(<span class="string">'/promises'</span>, options, (req, reply) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> promise = <span class="keyword">new</span> Prmise(<span class="comment">/*...*/</span>)</span><br><span class="line">  reply</span><br><span class="line">    .code(<span class="number">200</span>)</span><br><span class="line">    .send(promise)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fastify.get(<span class="string">'/async-await'</span>, options, <span class="keyword">async</span> (req, reply) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> res = <span class="keyword">await</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    setTimeout(resolve, <span class="number">200</span>, &#123; <span class="attr">hello</span>: <span class="string">'world'</span> &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="Streams"><a href="#Streams" class="headerlink" title="Streams"></a>Streams</h4><p>Send can also handle streams out of box, internally uses <code>pump</code> to avoid leaks of file description. If you are sneding a stream and you have not setted a <code>Content-Type</code> header, send will set it at <code>application/octet-stream</code>.</p><h4 id="Errors"><a href="#Errors" class="headerlink" title="Errors"></a>Errors</h4><p>If you pass to send an object that is an instance of Error, Fastify will automatically create error structured as the following:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  error: string, <span class="comment">// the http error message</span></span><br><span class="line">  message: string, <span class="comment">// the user error message</span></span><br><span class="line">  statusCode: number, <span class="comment">// the http status code</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Request"><a href="#Request" class="headerlink" title="Request"></a>Request</h3><p>The first parameter of the handler function is <code>Request</code>.</p><p>Request is a core Fastify object containing the following fields: </p><ul><li><p>query</p></li><li><p>body</p></li><li><p>params: the params matching the URL</p></li><li><p>headers</p></li><li><p>req: the incoming HTTP request from Node core</p></li><li><p>log</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fastify.post(<span class="string">'/:params'</span>, options, (req, reply) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(request.body)</span><br><span class="line">  <span class="built_in">console</span>.log(request.query)</span><br><span class="line">  <span class="built_in">console</span>.log(request.params)</span><br><span class="line">  <span class="built_in">console</span>.log(request.headers)</span><br><span class="line">  <span class="built_in">console</span>.log(request.req)</span><br><span class="line">  request.log.info(<span class="string">'some info'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Content-Type-Parser"><a href="#Content-Type-Parser" class="headerlink" title="Content Type Parser"></a>Content Type Parser</h3><p>Natively Fastify supports only <code>application/json</code> content-type. If you need to support different content types you can use the <code>addContentTypeParser</code> api.</p><h4 id="Catch-All"><a href="#Catch-All" class="headerlink" title="Catch All"></a>Catch All</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fastify.addContentTypeParser(<span class="string">'*'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, done</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> data = <span class="string">''</span></span><br><span class="line">  req.on(<span class="string">'data'</span>, chunk =&gt; &#123;data += chunk&#125;)</span><br><span class="line">  req.on(<span class="string">'end'</span>, () =&gt; done(data))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Plugins"><a href="#Plugins" class="headerlink" title="Plugins"></a>Plugins</h3><p>Fastify allows the user to extend its functionalities with plugins. A plugin can be a set of routes, a server decorator or whatever.</p><p>The API you will need for one or more plugins is <code>register</code>.</p><p>By default, <code>register</code> creates a <strong>new scope</strong>, this means that if you do some changes to the Fastify instance(via decorate), this change will not be reflected to the current context ancestors, but only to its sons.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fastify.register(plugin, [options])</span><br><span class="line"></span><br><span class="line">fastify.register([</span><br><span class="line">  <span class="built_in">require</span>(<span class="string">'./another-route'</span>),</span><br><span class="line">  <span class="built_in">require</span>(<span class="string">'./yet-another-route'</span>),</span><br><span class="line">], opts)</span><br></pre></td></tr></table></figure><h3 id="Craete-a-Plugin"><a href="#Craete-a-Plugin" class="headerlink" title="Craete a Plugin"></a>Craete a Plugin</h3><p>Create a plugin is very easy, you just need to create a function that takes three paremters, the <code>fastify</code> instance, an options object and the next callback.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">fastify, opts, next</span>) =&gt;</span> &#123;</span><br><span class="line">  fastify.decorate(<span class="string">'utility'</span>, () =&gt; &#123;&#125;)</span><br><span class="line">  fastify.get(<span class="string">'/'</span>, handler)</span><br><span class="line">  next()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Handle-the-Scope"><a href="#Handle-the-Scope" class="headerlink" title="Handle the Scope"></a>Handle the Scope</h4><p>You have two ways to tell Fastify to avoid the creation of a new context:</p><ul><li><p>Use the <code>fastify-plugin</code> module</p></li><li><p>Use the <code>skip-override</code> hidden property</p></li></ul><p>We recomended to use the <code>fastify-plugin</code> module, because it solves this problem for you, and you can pass as parameter a version range of Fastify taht your plguin support.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fp = <span class="built_in">require</span>(<span class="string">'fastify-plguin'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = fp(<span class="function"><span class="keyword">function</span>(<span class="params">fastify, opts, next</span>) </span>&#123;</span><br><span class="line">  fastify.decorate(<span class="string">'utility'</span>, () =&gt; &#123;&#125;)</span><br><span class="line">  next()</span><br><span class="line">&#125;, <span class="string">'0.x'</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> Node, Fastify </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Apollo With TypeScript</title>
      <link href="/2017/10/03/Apollo-with-TypeScript/"/>
      <content type="html"><![CDATA[<p><a href="https://dev-blog.apollodata.com/getting-started-with-typescript-and-apollo-a9aa2c7dcf87" target="_blank" rel="noopener">Origin</a></p><p>Start with a simple React Component wrapped with the <code>graphql</code> higher order component from React Apollo.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> gql <span class="keyword">from</span> <span class="string">'graphql-tag'</span></span><br><span class="line"><span class="keyword">import</span> &#123; graphql &#125; <span class="keyword">from</span> <span class="string">'react-apollo'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> HERO_QUERY = gql<span class="string">`</span></span><br><span class="line"><span class="string">  query GetCharacter($episode: Episodi!) &#123;</span></span><br><span class="line"><span class="string">    hero(episode: $episode) &#123;</span></span><br><span class="line"><span class="string">      name</span></span><br><span class="line"><span class="string">      id</span></span><br><span class="line"><span class="string">      friends &#123;</span></span><br><span class="line"><span class="string">        name</span></span><br><span class="line"><span class="string">        id</span></span><br><span class="line"><span class="string">        appearsIn</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> withCharacter = graphql(HERO_QUER, &#123;</span><br><span class="line">  options: <span class="function"><span class="params">()</span> =&gt;</span> (&#123;</span><br><span class="line">    variables: &#123; <span class="attr">episode</span>: <span class="string">'JEDI'</span> &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> withCharacter(<span class="function">(<span class="params">&#123; data: &#123; loading, hero, error &#125;&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (loading) &#123;</span><br><span class="line">    <span class="keyword">return</span> &lt;div&gt;Loading&lt;/div&gt;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (error) &#123;</span><br><span class="line">    <span class="keyword">return</span> &lt;div&gt;Error&lt;/div&gt;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &#123;hero &amp;&amp;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          &lt;h3&gt;&#123;hero.name&#125;&lt;<span class="regexp">/h3&gt;</span></span><br><span class="line"><span class="regexp">          &#123;hero.friends.map(friend =&gt; &lt;h6 key=&#123;friend.i&#125;&gt;&#123;friend.name&#125;&lt;/</span>h6&gt;&#125;&gt;&lt;/h6&gt;)&#125;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &#125;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>The above code pulls some data from a GraphQL API using a query and includes lifecycle information, such as loading and error information.</p><p>With a few minor changes, we can tell TypeScript how to support us in writing code within this render function.</p><ul><li>We need to tell TS what the shape of our data from our graphql server will look like. We manually write the types for our response data.</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> type Hero &#123;</span><br><span class="line">  name: string</span><br><span class="line">  id: string</span><br><span class="line">  appearsIn: string[]</span><br><span class="line">  friends: Hero[]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> type Response &#123;</span><br><span class="line">  hero: Hero</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> withCharacter = graphql&lt;Response&gt;(HERO_QUERY, &#123;</span><br><span class="line">  options: <span class="function">(<span class="params">&#123;episode&#125;</span>) =&gt;</span> (&#123;</span><br><span class="line">    variables: &#123; episode &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>The last line is where the magic happens. We tell TS what the shape of the result will look like from the server when the graphql enhancer wraps a component.</li></ul><p>If you already had your project set up with TS, and have already typed your response data, all you have to do is add the type to the <code>graphql</code> HOC and you are off!</p><h3 id="Take-Control-of-Your-Tree"><a href="#Take-Control-of-Your-Tree" class="headerlink" title="Take Control of Your Tree"></a>Take Control of Your Tree</h3><p>Wrapped components are almost always exported and used by a component somewhere else in your tree, so if your exported component has prop requirements, we need to tell TS so it can help prevent errors elsewhere in our tree. Since the <code>graphql</code> wrapper suppors polymorphic types, we can use the second type parameter of it to do just that.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> type InputProps = &#123;</span><br><span class="line">  episode: string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> withCharacter = graphql&lt;Response, InputProps&gt;(HERO_QUERY, &#123;</span><br><span class="line">  options: <span class="function">(<span class="params">&#123; episode &#125;</span>) =&gt;</span> (&#123;</span><br><span class="line">    variables: &#123; episode &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Then the code looks like:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> ApolloClient, &#123; createNetworkInterface &#125; <span class="keyword">from</span> <span class="string">'apollo-client'</span></span><br><span class="line"><span class="keyword">import</span> &#123; ApolloProvider &#125; <span class="keyword">from</span> <span class="string">'react-apollo'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Character <span class="keyword">from</span> <span class="string">'./Character'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> networkInterface = createNetworkInterface(&#123;</span><br><span class="line">  uri: <span class="string">'https://mpjk0plp9.lp.gql,zone/graphql'</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> client = <span class="keyword">new</span> ApolloClient(&#123;</span><br><span class="line">  networkInterface,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; (</span><br><span class="line">  &lt;ApolloProvider client=&#123;client&#125;&gt;</span><br><span class="line">    &lt;Character /&gt;</span><br><span class="line">  &lt;<span class="regexp">/ApolloProvider&gt;</span></span><br><span class="line"><span class="regexp">)</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> GraphQL, Apollo, TypeScript </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Source Code of Koa-Static</title>
      <link href="/2017/09/30/source-code-of-koa-static/"/>
      <content type="html"><![CDATA[<h3 id="Source-Code"><a href="#Source-Code" class="headerlink" title="Source Code"></a>Source Code</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Module Dependencies</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> debug = <span class="built_in">require</span>(<span class="string">'debug'</span>)(<span class="string">'koa-static'</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> assert = <span class="built_in">require</span>(<span class="string">'assert'</span>)</span><br><span class="line"><span class="keyword">const</span> send = <span class="built_in">require</span>(<span class="string">'koa-send'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Expose `serve()`</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = serve</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Serve static files from `root`</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @param &#123;String&#125; root</span></span><br><span class="line"><span class="comment"> * @param &#123;Object&#125; [opts]</span></span><br><span class="line"><span class="comment"> * @return &#123;Function&#125;</span></span><br><span class="line"><span class="comment"> * @api public</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">serve</span> (<span class="params">root, opts</span>) </span>&#123;</span><br><span class="line">  opts = opts || &#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ensure `root`</span></span><br><span class="line">  assert(root, <span class="string">'root directory is required to serve files'</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// options</span></span><br><span class="line">  debug(<span class="string">'static %s %j'</span>, root, opts)</span><br><span class="line">  <span class="comment">// set opts.root to absolute one</span></span><br><span class="line">  opts.root = resolve(root)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// set default static file</span></span><br><span class="line">  <span class="keyword">if</span> (opts.index !== <span class="literal">false</span>) opts.index = opts.index || <span class="string">'index.html'</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// if defer is supported</span></span><br><span class="line">  <span class="keyword">if</span> (!opts.defer) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">serve</span> (<span class="params">ctx, next</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">let</span> done = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (ctx.method === <span class="string">'HEAD'</span> || ctx.method === <span class="string">'GET'</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          done = <span class="keyword">await</span> send(ctx, ctx.path, opts)</span><br><span class="line">        &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">          <span class="keyword">if</span> (err.status !== <span class="number">404</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> err</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!done) &#123;</span><br><span class="line">        <span class="keyword">await</span> next()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  retrun <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">serve</span> (<span class="params">ctx, next</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">await</span> next()</span><br><span class="line">    <span class="keyword">if</span>(ctx.method !== <span class="string">'HEAD'</span> &amp;&amp; ctx.method !== <span class="string">'GET'</span>) <span class="keyword">return</span></span><br><span class="line">    <span class="comment">// response is already handled</span></span><br><span class="line">    <span class="keyword">if</span> (ctx.body != <span class="literal">null</span> || ctx.status !== <span class="number">404</span>) <span class="keyword">return</span></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> send(ctx, ctx.path, opts)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="keyword">if</span> (err.status !== <span class="number">404</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> err</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">'koa'</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line">app.use(<span class="built_in">require</span>(<span class="string">'koa-static'</span>)(root, opts))</span><br></pre></td></tr></table></figure><h3 id="Options"><a href="#Options" class="headerlink" title="Options"></a>Options</h3><ul><li><p>maxage: default to 0.</p></li><li><p>hidden: Allow transfer of hidden files, detault to false.</p></li><li><p>index: Default file name, detault to âindex.htmlâ.</p></li><li><p>defer: If true, serves after <code>return next()</code>.</p></li><li><p>gzip: default to true.</p></li><li><p>extensions: default to false.</p></li></ul>]]></content>
      
      
        <tags>
            
            <tag> Koa, NPM, Package </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>React-Hot-Loader in Webpack With Ts-Loader</title>
      <link href="/2017/09/29/react-hot-loader-in-with-ts-loader/"/>
      <content type="html"><![CDATA[<p>Itâs very easy to integrate <code>react-hot-loader</code> into webpack with <code>ts-loader</code>.</p><h3 id="Config-the-webpack"><a href="#Config-the-webpack" class="headerlink" title="Config the webpack"></a>Config the webpack</h3><h4 id="Add-Hot-Module-Replacement"><a href="#Add-Hot-Module-Replacement" class="headerlink" title="Add Hot Module Replacement"></a>Add Hot Module Replacement</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.entry</span></span><br><span class="line">app: [</span><br><span class="line">  <span class="string">'webpack/hot/only-dev-server'</span>,</span><br><span class="line">  <span class="string">'webpack-dev-server/client?http://localhost:8080'</span>,</span><br><span class="line">  path.resolve(__dirname, <span class="string">'./src'</span>),</span><br><span class="line">],</span><br><span class="line"></span><br><span class="line">plugins: [</span><br><span class="line">  <span class="keyword">new</span> webpack.HotModuleReplacementPlugin()</span><br><span class="line">],</span><br><span class="line"></span><br><span class="line">devServer: &#123;</span><br><span class="line">  hot: <span class="literal">true</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Add-React-Hot-Loader-into-webpack"><a href="#Add-React-Hot-Loader-into-webpack" class="headerlink" title="Add React-Hot-Loader into webpack"></a>Add React-Hot-Loader into webpack</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add react-hot-loader to entry point</span></span><br><span class="line"></span><br><span class="line">entry: [</span><br><span class="line">  <span class="string">'webpack/hot/only-dev-server'</span>,</span><br><span class="line">  <span class="string">'webpack-dev-server/client?http://localhost:8080'</span>,</span><br><span class="line">  <span class="string">'react-hot-loader/patch'</span>,</span><br><span class="line">  path.resolve(__dirname, <span class="string">'./src/'</span>),</span><br><span class="line">],</span><br><span class="line"><span class="comment">// add loader</span></span><br><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [</span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="regexp">/\.tsx$/</span>,</span><br><span class="line">      use: [<span class="string">'react-hot-loader/webpack/'</span>, <span class="string">'ts-loader'</span>],</span><br><span class="line">      exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">      include: path.resolve(__dirname, <span class="string">'./src'</span>),</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Wrap-Root-Container-into-module-hot-accept"><a href="#Wrap-Root-Container-into-module-hot-accept" class="headerlink" title="Wrap Root Container into module.hot.accept"></a>Wrap Root Container into <code>module.hot.accept</code></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">module</span>.hot) &#123;</span><br><span class="line">  <span class="built_in">module</span>.hot.accept(<span class="string">'./router'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> Root = <span class="built_in">require</span>(<span class="string">'./router'</span>).default</span><br><span class="line">    render(<span class="xml"><span class="tag">&lt;<span class="name">Root</span> /&gt;</span>, htmlDOM)</span></span><br><span class="line"><span class="xml">  &#125;)</span></span><br><span class="line"><span class="xml">&#125;</span></span><br></pre></td></tr></table></figure><blockquote><p>Note, if you are using ts with babel-preset-es2015, you can set babel to ignore <code>es2015</code> module transform by</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"presets"</span>: [[<span class="string">"es2015"</span>, &#123;<span class="attr">"modules"</span>: <span class="literal">false</span>&#125;]]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>because webpack 3 has built-in support for ES2015 modules. You wonât need to re-require you root module.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">module</span>.hot) &#123;</span><br><span class="line">  <span class="built_in">module</span>.hot.accept(<span class="string">'./router'</span>, () =&gt; &#123;</span><br><span class="line">    render(<span class="xml"><span class="tag">&lt;<span class="name">Root</span> /&gt;</span>, htmlDOM)</span></span><br><span class="line"><span class="xml">  &#125;)</span></span><br><span class="line"><span class="xml">&#125;</span></span><br></pre></td></tr></table></figure><blockquote><p>Same treatment in ts if your target is es6</p></blockquote>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Methods of Observable</title>
      <link href="/2017/09/25/Methods-of-Observable/"/>
      <content type="html"><![CDATA[<p><a href="http://reactivex.io/rxjs/class/es6/Observable.js~Observable.html#instance-method-switchMap" target="_blank" rel="noopener">Origin</a><br><a href="https://rxviz.com" target="_blank" rel="noopener">Playground</a></p><h3 id="Observable"><a href="#Observable" class="headerlink" title="Observable"></a>Observable</h3><h5 id="Direct-Subclass"><a href="#Direct-Subclass" class="headerlink" title="Direct Subclass"></a>Direct Subclass</h5><ul><li><p>ConnectableObservable</p></li><li><p>GroupedObservable</p></li><li><p>Subject</p></li></ul><h5 id="Indirect-Subclass"><a href="#Indirect-Subclass" class="headerlink" title="Indirect Subclass"></a>Indirect Subclass</h5><ul><li><p>AnonymousSubject</p></li><li><p>AsyncSubject</p></li><li><p>BehaviorSubject</p></li><li><p>ReplaySubject</p></li></ul><h4 id="Static-Public-Methods"><a href="#Static-Public-Methods" class="headerlink" title="Static Public Methods"></a>Static Public Methods</h4><ul><li>bindCallback</li></ul><p><code>public static bindCallback(func: function, selector: function, schedular: Schedular): function(...params: *): Observable</code></p><p>Convert a callback API to a function that returns an Observable</p><blockquote><p>Give it a function f of type f(x, callback) and it will return a function g taht when called as g(x) will output an Observable.</p></blockquote><p><code>bindCallback</code> is not an operator because its input and output are not Observables.</p><p>The input is a function with some parameters, but the last parameter must be a callback function.</p><p>The output of the <code>bindCallback</code> is a function that takes the <strong>same</strong> parameters as original function takes, except the last one(the callback). When the output function is called with arguments, it will return an Observable.</p><p>If the original functionâs callback takes one argument, the Observable will emit that value. If on the other hand callback is called with multiple values, resulting Observable will emit an array with these argumetns.</p><h5 id="More-in-Origin-Article"><a href="#More-in-Origin-Article" class="headerlink" title="More in Origin Article"></a>More in Origin Article</h5><ul><li>bindNodeCallback</li></ul><p><code>public static bindNodeCallback(func: function, scheduler: Schedular): function(...param: *): Observable</code></p><ul><li>combineLatest</li></ul><p><code>public static combineLatest(observable1: ObservableInput, observable2: ObservableInput, project: function, schedular: Schedular): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/combineLatest.png" alt=""></p><p>Combines multiple Observables to create an Observable whose values are calculated from the latest values of each of its input Observables.</p><blockquote><p><strong>Whenever</strong> any input Observable emits a value, it computes a formula using the latest values from all the inputs, then emits the output of the formula.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// combine two timer Observable</span></span><br><span class="line"><span class="keyword">const</span> firstTimer = Rx.Observable.timer(<span class="number">0</span>, <span class="number">1000</span>)</span><br><span class="line"><span class="keyword">const</span> secondTimer = Rx.Observable.timer(<span class="number">500</span>, <span class="number">1000</span>)</span><br><span class="line"><span class="keyword">const</span> combineTimers = Rx.Observable.combineLatest(firstTimer, secondTimer)</span><br><span class="line">combineTimers.subscribe(<span class="built_in">console</span>.log)</span><br><span class="line"><span class="comment">// logs</span></span><br><span class="line"><span class="comment">// [0, 0] after 0.5s, triggered by secondTimer</span></span><br><span class="line"><span class="comment">// [1, 0] after 1s, triggered by firstTimer</span></span><br><span class="line"><span class="comment">// [1, 1.5] after 1.5s, triggered by secondTimer</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// combine an array of observable</span></span><br><span class="line"><span class="keyword">const</span> observables = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>].map(<span class="function"><span class="params">n</span> =&gt;</span> Rx.Observable.of(n).delay(n * <span class="number">1000</span>).startWith(<span class="number">0</span>))</span><br><span class="line"><span class="keyword">const</span> combined = Rx.Observable.combineLatest(observables)</span><br><span class="line">combined.subscribe(<span class="built_in">console</span>.log)</span><br><span class="line"><span class="comment">// logs</span></span><br><span class="line"><span class="comment">// [0, 0, 0] immediately</span></span><br><span class="line"><span class="comment">// [1, 0, 0] after 1s triggered by observables[0]</span></span><br><span class="line"><span class="comment">// [1, 2, 0] after 2s triggered by observables[1]</span></span><br><span class="line"><span class="comment">// [1, 2, 4] after 4s triggered by observables[2]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// use project function to dynamically calculate the body-mass index</span></span><br><span class="line"><span class="keyword">const</span> weight = Rx.Observable.of(<span class="number">70</span>, <span class="number">72</span>, <span class="number">76</span>, <span class="number">79</span>, <span class="number">75</span>)</span><br><span class="line"><span class="keyword">const</span> height = Rx.Observable.of(<span class="number">1.76</span>, <span class="number">1.77</span>, <span class="number">1.78</span>)</span><br><span class="line"><span class="keyword">const</span> bmi = Rx.Observable.combineLatest(weight, height, (w, h) =&gt; w/(h*h))</span><br><span class="line">bmi.subscribe(<span class="built_in">console</span>.log)</span><br><span class="line"><span class="comment">// With output to console:</span></span><br><span class="line"><span class="comment">// BMI is 24.212293388429753</span></span><br><span class="line"><span class="comment">// BMI is 23.93948099205209</span></span><br><span class="line"><span class="comment">// BMI is 23.671253629592222</span></span><br></pre></td></tr></table></figure><ul><li>concat</li></ul><p><code>public static concat(input1: ObservableInput, input2: ObservableInput, scheduler: Schedular): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/concat.png" alt=""></p><p>Creates an output Observable which sequentially emits all values from given Observable and then moves on to the next.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Concatenate a timer counting form 0 to 3 with a synchronous sequence from 1 to 10</span></span><br><span class="line"><span class="keyword">var</span> timer = Rx.Observable.interval(<span class="number">1000</span>).take(<span class="number">4</span>)</span><br><span class="line"><span class="keyword">var</span> sequence = Rx.Observable.range(<span class="number">1</span>, <span class="number">10</span>)</span><br><span class="line"><span class="keyword">var</span> result = Rx.Observable.concat(timer, sequence)</span><br><span class="line"></span><br><span class="line"><span class="comment">// concatenate an array of 3 Observables, different from the one above</span></span><br><span class="line"><span class="keyword">var</span> timer1 = Rx.Observable.interval(<span class="number">1000</span>).take(<span class="number">10</span>)</span><br><span class="line"><span class="keyword">var</span> timer2 = Rx.Observable.interval(<span class="number">1000</span>).take(<span class="number">6</span>)</span><br><span class="line"><span class="keyword">var</span> timer3 = Rx.Observable.interval(<span class="number">1000</span>).take(<span class="number">10</span>)</span><br><span class="line"><span class="keyword">var</span> result = Rx.Observable.concat([timer1, timer2, timer3])</span><br></pre></td></tr></table></figure><ul><li>create</li></ul><p><code>public static create(onSubscription: function(observer: Observer): TearDownLogic): Observable</code></p><p>Creates a new Observable, that will execute the specified function when an Observer subscribes to it.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> observable = Rx.Observable.create(<span class="function"><span class="keyword">function</span>(<span class="params">observer</span>) </span>&#123;</span><br><span class="line">  observer.next(<span class="number">1</span>)</span><br><span class="line">  observer.next(<span class="number">2</span>)</span><br><span class="line">  observer.next(<span class="number">3</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>defer</li></ul><p><code>public static defer(observableFactory: function(): SubscribableOrPromise): Observable</code></p><p>Creates an Observable that, on subscribe, calls an Observable factory to make an Observable for each new Observer</p><blockquote><p>Creates the Observable lazily, that is, only when it is subscribed.</p></blockquote><p><img src="http://reactivex.io/rxjs/img/defer.png" alt=""></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// when defer is called, it returns an Observable</span></span><br><span class="line"><span class="keyword">var</span> clicksOrInterval = Rx.Observable.defer(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">Math</span>.random() &gt; <span class="number">0.5</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> Rx.Observable.fromEvent(<span class="built_in">document</span>, <span class="string">'click'</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Rx.Observable.interval(<span class="number">1000</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>empty</li></ul><p><code>public static empty(scheduler: Scheduler): Observable</code></p><p>Creates an Observable that emits no items to the Observer and immediately emits a completion notification.</p><blockquote><p>Just emits âcompleteâ and nothing else</p></blockquote><p><img src="http://reactivex.io/rxjs/img/empty.png" alt=""></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> result = Rx.Observable.empty().startWith(<span class="number">8</span>)</span><br></pre></td></tr></table></figure><ul><li>from</li></ul><p><code>public static from(ish: ObservableInput&lt;T&gt;, scheduler: Scheduler): Observable&lt;T&gt;</code></p><p>Creates an Observable from an Array, an array-like Object, a Promise, an iterable object, or an Observable-like Object</p><blockquote><p>Convert almost anything to an Observable</p></blockquote><p><img src="http://reactivex.io/rxjs/img/from.png" alt=""></p><ul><li>fromEvent</li></ul><p><code>public static fromEvent(target: EventTargetLike, eventName: string, options: EventListenerOptions, selector: SelectorMethodSignature&lt;T&gt;): Observable&lt;T&gt;</code></p><blockquote><p>Creates an Observable from DOM events, or Node EventEmitter events or others</p></blockquote><p><img src="http://reactivex.io/rxjs/img/fromEvent.png" alt=""></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> clicks = Rx.Observable.fromEvent(<span class="built_in">document</span>, <span class="string">'click'</span>)</span><br></pre></td></tr></table></figure><ul><li>fromEventPattern</li></ul><p><code>public static fromEventPattern(addHandler: function(handler: Function): any, removeHandler: function(handler: Function, signal?: any): void, selector: function(...args: any): T): Observable&lt;T&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/fromEventPattern.png" alt=""></p><blockquote><p>Converts any addHandler/removeHandler API to an Observable</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addClickHandler</span>(<span class="params">handler</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">document</span>.addEventListener(<span class="string">'click'</span>, handler)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">removeClick</span>(<span class="params">handler</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">document</span>.removeEventListener(<span class="string">'click'</span>, handler)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> clicks = Rx.Observable.fromEventPattern(</span><br><span class="line">  addClickHandler,</span><br><span class="line">  removeClickHandler,</span><br><span class="line">)</span><br></pre></td></tr></table></figure><ul><li>fromPromise</li></ul><p><code>public static fromPromise(promise: Promise&lt;T&gt;, scheduler: Scheduler): Observable&lt;T&gt;</code></p><blockquote><p>Returns an Observable that just emit the Promiseâs resolved value, then complete</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> result = Rx.Observable.fromPromise(fetch(<span class="string">'reqres.in/api/users'</span>))</span><br></pre></td></tr></table></figure><ul><li>interval</li></ul><p><code>public static interval(period: number, scheduler: Scheduler): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/interval.png" alt=""></p><blockquote><p>Emits incremental numbers periodically in time</p></blockquote><ul><li>merge</li></ul><p><code>public static merge(observables: ...ObservableInput, concurrent: number, scheduler: Scheduler): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/merge.png" alt=""></p><p>Creates an output Observable which concurrently emits all values from every given input Observable</p><blockquote><p>Flatten multiple Observables together by blending their values into one Observable</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> clicks = Rx.Observable.fromEvent(<span class="built_in">document</span>, <span class="string">'click'</span>)</span><br><span class="line"><span class="keyword">var</span> timer = Rx.Observable.interval(<span class="number">1000</span>)</span><br><span class="line"><span class="keyword">var</span> clicksOrTimer = Rx.Observable.merge(clicks, timer)</span><br></pre></td></tr></table></figure><ul><li>never</li></ul><p><code>public static never(): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/never.png" alt=""></p><p>Creates an Observable that emits no items to the Observer</p><blockquote><p>An Observable that never emits anything</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Rx.Observable.never().startWith(<span class="number">7</span>).subscribe(<span class="built_in">console</span>.log)</span><br><span class="line"><span class="comment">// won't console 7</span></span><br></pre></td></tr></table></figure><ul><li>of</li></ul><p><code>public static of(values: ...T, scheduler: Scheduler): Observable&lt;T&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/of.png" alt=""></p><p>Creates an Observbale that emits some values you specify as arguments, immediately one after the other, and then emits a complete notification.</p><blockquote><p>Emits the arguments you provide, then complete.</p></blockquote><ul><li>range</li></ul><p><code>public static range(start: number, count: number, scheduler: Scheduler): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/range.png" alt=""></p><p>Creates an Observable that emits a sequence of numbers within a specified range.</p><blockquote><p>Emits a sequence of numbers in a range</p></blockquote><ul><li>throw</li></ul><p><code>public static throw(error: any, scheduler: Scheduler): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/throw.png" alt=""></p><blockquote><p>Just emit âerrorâ and nothing else.</p></blockquote><ul><li>timer</li></ul><p><code>public static timer(initialDelay: number|Date, period: number, scheduler: Scheduler): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/timer.png" alt=""></p><p>Creates an Observable that starts emitting after an <code>initialDelay</code> and emits ever increasing numbers after each <code>period</code> of time thereafter.</p><blockquote><p>Itâs like interval, but you can specify when should the emissions start.</p></blockquote><ul><li>webSocket</li></ul><p><code>public static webSocket(urlConfigOrSource: string | WebSocketSubjectConfig): Observable</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> subject = Rx.Observable.webSocket(<span class="string">'ws://localhost:8001'</span>)</span><br></pre></td></tr></table></figure><ul><li>zip</li></ul><p><code>public static zip(observables: *): Observable&lt;R&gt;</code></p><p>Combines multiple Observables to create an Observable whose values are calculated from the valeus, in order, of each of its input Observables.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> age$ = Rx.Observable.of(<span class="number">27</span>, <span class="number">25</span>, <span class="number">29</span>)</span><br><span class="line"><span class="keyword">let</span> name$ = Rx.Observable.of(<span class="string">'Foo'</span>, <span class="string">'Bar'</span>, <span class="string">'Beer'</span>)</span><br><span class="line"><span class="keyword">let</span> isDev$ = Rx.Observable.of(<span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line">Rx.Observable.zip(age$, name$, isDev$, (age, name, isDev) =&gt; (&#123;age, name, isDev&#125;))</span><br><span class="line"><span class="comment">// outputs</span></span><br><span class="line"><span class="comment">// &#123; age: 27, name: 'Foo', isDev: true &#125;</span></span><br><span class="line"><span class="comment">// &#123; age: 25, name: 'Bar', isDev: true &#125;</span></span><br><span class="line"><span class="comment">// &#123; age: 29, name: 'Beer', isDev: false &#125;</span></span><br></pre></td></tr></table></figure><ul><li>constructor</li></ul><p><code>public constructor (subsribe: Function)</code></p><ul><li>audit</li></ul><p><code>public audit(durationSelector: function(value: T): SubscribableOrPromise): Observable&lt;T&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/audit.png" alt=""></p><p>Ignores source value for a duration determined by another Observable, then emis the most recent value from the source Observable, then repeats this process.</p><blockquote><p>Itâs like auditTime, but the silencing duration is determined by a second Observable.</p></blockquote><p><code>audit</code> is similar to <code>throttle</code>, but emits the last value from the silenced time window.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> clicks = Rx.Observable.fromEvent(<span class="built_in">document</span>, <span class="string">'click'</span>)</span><br><span class="line"><span class="keyword">var</span> result = clicks.audit(<span class="function"><span class="params">ev</span> =&gt;</span> Rx.Observable.interval(<span class="number">1000</span>))</span><br></pre></td></tr></table></figure><ul><li>auditTime</li></ul><p><code>public auditTime(duration: number, scheduler: Scheduler): Observable&lt;T&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/auditTime.png" alt=""></p><p>Ignores source values for <code>duration</code> milliseconds, then emits the most recent value from the source Observable, then repeats this process.</p><p>Similar to <code>throttleTime</code></p><ul><li>buffer</li></ul><p><code>public buffer(closingNotifier: Observable&lt;any&gt;): Observable&lt;T&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/buffer.png" alt=""></p><p>Buffers the source Observable values until <code>closingNotifier</code> emits.</p><blockquote><p>Collect values from the past as an array, and emits that array when another Observable emits.</p></blockquote><ul><li>bufferCount</li></ul><p><code>public bufferCount(bufferSize: number, startBufferEvery: number): Observable&lt;T[]&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/bufferCount.png" alt=""></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> interval = Rx.Observable.interval(<span class="number">1000</span>)</span><br><span class="line">interval.bufferCount(<span class="number">3</span>, <span class="number">2</span>)</span><br></pre></td></tr></table></figure><ul><li>bufferTime</li></ul><p><code>public bufferTime(bufferTimeSpan: number, bufferCreationIntervel: number, maxBufferSize: number, scheduler: Scheduler): Observable&lt;T[]&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/bufferTime.png" alt=""></p><p>Buffers the source Observable values for a specific time period.</p><blockquote><p>Collect values from the past as an array, and emits those array periodically in time.</p></blockquote><ul><li>bufferToggle</li></ul><p><code>public bufferToggle(openings: SubscribableOrPromise&lt;O&gt;, closingSelector: function(value: O): SubscribableOrPromise): Observable&lt;T[]&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/bufferToggle.png" alt=""></p><ul><li>bufferWhen</li></ul><p><code>public bufferWhen(closingSelector: function(): Obversable): Obversable&lt;T[]&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/bufferWhen.png" alt=""></p><p>Buffers the source Observable values, using a factory function of closing Observables to determine when to close, emit and reset the buffer.</p><ul><li>catch</li></ul><p><code>public catch(selector: function): Obversable</code></p><p><img src="http://reactivex.io/rxjs/img/catch.png" alt=""></p><p>Catches errors on the observable to be handled by returning a new obversable or throwing an error.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Rx.Observable.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">.map(<span class="function"><span class="params">n</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (n === <span class="number">4</span>) <span class="keyword">throw</span> <span class="string">'four'</span></span><br><span class="line">  <span class="keyword">return</span> n</span><br><span class="line">&#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> Rx.Observable.of(<span class="string">'I'</span> , <span class="string">'II'</span>, <span class="string">'III'</span>, <span class="string">'IV'</span>, <span class="string">'V'</span>))</span><br></pre></td></tr></table></figure><ul><li>combineAll</li></ul><p><code>public combineAll(project: function): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/combineAll.png" alt=""></p><p>Convert a higher-order Observable into a first-order Observable by waiting for the outer Observable to complete, then applying <code>combineLatest</code></p><p>Similar to CombineLatest</p><blockquote><p>Flatten an Observable-of-Observables by applying combineLatest when the Observable-of-Observable completes</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> clicks = Rx.Observable.fromEvent(<span class="built_in">document</span>, <span class="string">'click'</span>);</span><br><span class="line"><span class="keyword">var</span> higherOrder = clicks.map(<span class="function"><span class="params">ev</span> =&gt;</span></span><br><span class="line">  Rx.Observable.interval(<span class="built_in">Math</span>.random()*<span class="number">2000</span>).take(<span class="number">13</span>)</span><br><span class="line">).take(<span class="number">3</span>);</span><br><span class="line"><span class="keyword">var</span> result = higherOrder.combineAll();</span><br></pre></td></tr></table></figure><ul><li>combineLatest</li></ul><p><code>public combineLatest(other: ObservableInput, project: function): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/combineLatest.png" alt=""></p><p>Combines multiple Observables to create an Observable whose values are calculated from the latest values of each of its input Observable.</p><ul><li>concat</li></ul><p><code>public concat(other: ObservableInput, scheduler: Scheduler): Observable</code></p><ul><li>concatAll</li></ul><p><code>public concatAll(): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/concatAll.png" alt=""></p><p>Converts a higher-order Observable into a first-order Observable by concatenating the inner Observable in order.</p><blockquote><p>Flatten an Observable-of-Observable by putting one inner Observable after the other</p></blockquote><ul><li>concatMap</li></ul><p><code>public concatMap(project: function(value: T, ?index: number): ObservableInput, resultSelector: function(outerValue: T, innerValue: I, outerIndex: number, innerIndex: number): any): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/concatMap.png" alt=""></p><p>Projects each source value to an Observable which is merged in the output Observable, in a serialized fashion waiting for each one to complete before merging the next.</p><p>Map =&gt; Concat</p><blockquote><p>Map each value to an Observable, then flatten all of these inner Observables using concatAll</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> clicks = Rx.Observable.fromEvent(<span class="built_in">document</span>, <span class="string">'click'</span>)</span><br><span class="line"><span class="keyword">var</span> result = clicks.concatMap(<span class="function"><span class="params">ev</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> Rx.Observable.interval(<span class="number">1000</span>).take(<span class="number">4</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>concatMaoTo</li></ul><p><code>public concatMapTo(innerObservable: ObservableInput, resultSelector: function(outerValue: T, innerValue: I, outerIndex: number, innerIndex: number): any): Observer</code></p><p><img src="http://reactivex.io/rxjs/img/concatMapTo.png" alt=""></p><blockquote><p>Itâs like concatMap, but maps each value always to the same inner Observable</p></blockquote><ul><li>count</li></ul><p><code>public count(predicate: function(value: T, i: number, source: Observable&lt;T&gt;): boolean): Observable</code></p><p>Counts the number of emissions on the source and emits the number when the source completes.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// count how many seconds have passed before the first click</span></span><br><span class="line"><span class="keyword">var</span> seconds = Rx.Observable.interval(<span class="number">1000</span>)</span><br><span class="line"><span class="keyword">var</span> clicks = Rx.Observable.fromEvent(<span class="built_in">document</span>, <span class="string">'click'</span>)</span><br><span class="line"><span class="keyword">var</span> secondsBeforeClick = seconds.takeUntil(clicks)</span><br><span class="line">secondsBeforeClick.count()</span><br><span class="line"></span><br><span class="line"><span class="comment">// count how many odd numbers are there between 1 and 7</span></span><br><span class="line"><span class="keyword">var</span> numbers = Rx.Observable.range(<span class="number">1</span>, <span class="number">7</span>)</span><br><span class="line">numbers.count(<span class="function"><span class="params">i</span> =&gt;</span> i % <span class="number">2</span>)</span><br></pre></td></tr></table></figure><ul><li>debounce</li></ul><p><code>public debounce(durationSelector: function(value: T): SubscribableOrPromise): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/debounce.png" alt=""></p><p>Emits a value from the source Observable only after a particular time span determined by another Observable has passes without another source emission.</p><blockquote><p>Itâs like debounceTime, but the time span of emission silence is determined by a second Observable.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> clicks = Rx.Observable.fromEvent(<span class="built_in">document</span>, <span class="string">'click'</span>)</span><br><span class="line"><span class="keyword">var</span> result = clicks.debounce(<span class="function"><span class="params">()</span> =&gt;</span> Rx.Observable.interval(<span class="number">1000</span>))</span><br></pre></td></tr></table></figure><ul><li>debounceTime</li></ul><p><code>public debounceTime(dueTime: number, scheduler: Scheduler): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/debounceTime.png" alt=""></p><p>Emits a value from the source Observable only after a particular time span has passed without another source emission.</p><blockquote><p>Itâs like delay, but passes only the most recent value from each burst of emissions.</p></blockquote><ul><li>defaultEmpty</li></ul><p><img src="http://reactivex.io/rxjs/img/defaultIfEmpty.png" alt=""></p><p><code>public defaultIfEmpty(defaultValue: any): Observable</code></p><p>Emits a given value if the source Observable completes without emitting any <code>next</code> value, otherwise mirrors the source Observable.</p><blockquote><p>If the source Observable turns out to be empty, then this operator will emit a default value.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> clicks = Rx.Observable.fromEvent(<span class="built_in">document</span>, <span class="string">'click'</span>)</span><br><span class="line"><span class="keyword">var</span> clicksBeforeFive = clicks.takeUntil(Rx.Observable.interval(<span class="number">5000</span>))</span><br><span class="line">clicksBeforeFive.defaultIfEmpty(<span class="string">'no click'</span>)</span><br></pre></td></tr></table></figure><ul><li>delay</li></ul><p><code>public delay(delay: number|Date, scheduler: Scheduler): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/delay.png" alt=""></p><p>Delays the emission of items from the source Observable by a given timeout or until a given Date.</p><ul><li>delayWhen</li></ul><p><code>public delayWhen(delayDurationSelector: function(value: T): Observable): Observable</code></p><blockquote><p>Itâs like delay, but the time span of the delay duration is determined by a second Observable.</p></blockquote><ul><li>dematerialize</li></ul><p><code>public dematerialize(): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/dematerialize.png" alt=""></p><p>Convert an Observable of Notification objects into the emissions that they represent.</p><blockquote><p>Unwraps Notification objects as actual next, error, and complete emissions. The opposite of materialize.</p></blockquote><p><code>dematerialize</code> is assumed to operate an Observable that only emits <code>Notification</code> objects as <code>next</code> emission, and does not emit any <code>error</code>. Such Observable is the output of a <code>materialize</code> operation. Those notifications are then unwrapped using the metadata they contain, and emitted as <code>next</code>, <code>error</code>and <code>complete</code> on the output Observable.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> notiA = <span class="keyword">new</span> Rx.Notification(<span class="string">'N'</span>, <span class="string">'A'</span>)</span><br><span class="line"><span class="keyword">var</span> notiB = <span class="keyword">new</span> Rx.Notification(<span class="string">'N'</span>, <span class="string">'B'</span>)</span><br><span class="line"><span class="keyword">var</span> notiE = <span class="keyword">new</span> Rx.Notification(<span class="string">'E'</span>, <span class="keyword">void</span> <span class="number">0</span>, <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">'x.toUpperCase is not a function'</span>))</span><br><span class="line"><span class="keyword">var</span> materialized = Rx.Observable.of(notiA, notiB, notiE)</span><br><span class="line"><span class="keyword">var</span> upperCase = materialized.dematerialize()</span><br></pre></td></tr></table></figure><ul><li>distinct</li></ul><p><code>public distinct(keySelector: function, flushes: Observable): Observable</code></p><p>Returns an Observable that emits all items emitted by the source Observable that are distinct by comparison from previous item<strong>s</strong>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Rx.Observable.of(<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">67</span>,<span class="number">6</span>,<span class="number">6</span>,).distinct()</span><br><span class="line"><span class="comment">// 1,2,3,4,5,67,6</span></span><br><span class="line"><span class="comment">// repeated 1 omitted</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// keySelector</span></span><br><span class="line">interface Person &#123;</span><br><span class="line">  age: number</span><br><span class="line">  name: string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Rx.Observable.of&lt;Person&gt;(</span><br><span class="line">  &#123; <span class="attr">age</span>: <span class="number">4</span>, <span class="attr">name</span>: <span class="string">'Foo'</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">age</span>: <span class="number">7</span>, <span class="attr">name</span>: <span class="string">'Bar'</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">age</span>: <span class="number">5</span>, <span class="attr">name</span>: <span class="string">'Foo'</span> &#125;,</span><br><span class="line">).distinct(<span class="function">(<span class="params">p: Person</span>) =&gt;</span> p.name)</span><br></pre></td></tr></table></figure><blockquote><p>Note: â1â is different from 1</p></blockquote><ul><li>distinctUntilChanged</li></ul><p><code>public distinctUntilChanged(compare: function): Observable</code></p><p>Returns an Observable that emits all items emitted by the source Observable that are distinct by comparison from the previous item. (not items)</p><ul><li>distinctUntilKeyChanged</li></ul><p><code>public distinctUntilKeyChanged(key: string, compare: function): Observable</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">interface Person &#123;</span><br><span class="line">  age: number</span><br><span class="line">  name: string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Rx.Observable.of&lt;Person&gt;(</span><br><span class="line">  &#123; <span class="attr">age</span>: <span class="number">4</span>, <span class="attr">name</span>: <span class="string">'Foo'</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">age</span>: <span class="number">5</span>, <span class="attr">name</span>: <span class="string">'Bar'</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">age</span>: <span class="number">3</span>, <span class="attr">naem</span>: <span class="string">'For'</span> &#125;,</span><br><span class="line">).distinctUntilKeyChanged(<span class="string">'name'</span>, (x: string, <span class="attr">y</span>: string) =&gt; x.substring(<span class="number">0</span>, <span class="number">2</span>) === y.substring(<span class="number">0</span>, <span class="number">2</span>))</span><br></pre></td></tr></table></figure><ul><li>do</li></ul><p><code>public do(nextOrObserver: Observer|function, error: function, complete: function): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/do.png" alt=""></p><p>Perform a <strong>side effect</strong> for every emission on the source Observable, but return an Observable that is <strong>identical</strong> to the source.</p><blockquote><p>Intercepts each emission on the source and runs a function, but returns an output which is identical to the source.</p></blockquote><ul><li>elemetnAt</li></ul><p><code>public elementAt(index: number, defaultValue: T): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/elementAt.png" alt=""></p><p>Emits the single value at the specified <code>index</code> in a sequence of emissions from the source Observable.</p><blockquote><p>Emits only the i-th value , then completes.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> clicks = Rx.Observable.fromEvent(<span class="built_in">document</span>, <span class="string">'click'</span>)</span><br><span class="line">clicks.elementAt(<span class="number">2</span>)</span><br></pre></td></tr></table></figure><ul><li>every</li></ul><p><code>public every(predicate: function, thisArg: any): Observable</code></p><p>Returns an Observable that emits whether or not every item of the source satisfies the condition specified.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// all elements are less than 5, otherwise false</span></span><br><span class="line">Observable.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>)</span><br><span class="line">  .every(<span class="function"><span class="params">x</span> =&gt;</span> x &lt; <span class="number">5</span>)</span><br><span class="line">  .subscribe(<span class="function"><span class="params">x</span> =&gt;</span> <span class="built_in">console</span>.log(x)); <span class="comment">// -&gt; false</span></span><br></pre></td></tr></table></figure><ul><li>exhaust</li></ul><p><code>public exhaust(): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/exhaust.png" alt=""></p><p>Convert a higher-order Observable into a first-order Observable by dropping inner Observables while the previoud inner Observable has not yet completed.</p><blockquote><p>Flatten an Observable-of-Observables by dropping the next inner Observable while the current inner is still executing.</p></blockquote><p><code>exhaust</code> ingores every new inner Observable if the previous Observable has not yet completed.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> clicks = Rx.Observable.fromEvent(<span class="built_in">document</span>, <span class="string">'click'</span>)</span><br><span class="line"><span class="keyword">var</span> higherOrder = clicks.map(<span class="function"><span class="params">ev</span> =&gt;</span> Rx.Observable.interval(<span class="number">1000</span>).take(<span class="number">3</span>))</span><br><span class="line">higherOrder.exhaust()</span><br></pre></td></tr></table></figure><ul><li>exhaustMap</li></ul><p><code>public exhaustMap(project: function(value: T, ?index: number): ObservableInput, resultSelector: function(outerValue: T, innerValue: I, outerIndex: number, innerIndex: number): any): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/exhaustMap.png" alt=""></p><p>Projects each source value to an Observable which is merged in the output Observable only if the previous projected Observable has completed.</p><ul><li>expand</li></ul><p><code>public expand(project: function(value: T, index: number), concurrent: number, scheduler: Scheduler): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/expand.png" alt=""></p><p>Recursively projects each source value to an Observable which is merged in the output Observable.</p><blockquote><p>Itâs similar to mergeMap, but applies the projection function to every source value as well as every output value. Itâs recursive.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> clicks = Rx.Observable.fromEvent(<span class="built_in">document</span>, <span class="string">'click'</span>)</span><br><span class="line">clicks.mapTo(<span class="number">1</span>).expand(<span class="function"><span class="params">x</span> =&gt;</span> Rx.Observable.of(<span class="number">2</span>*x).delay(<span class="number">1000</span>)).take(<span class="number">10</span>)</span><br></pre></td></tr></table></figure><ul><li>filter</li></ul><p><code>public filter(predicate: function(value T, index: number): boolean, thisArg: any): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/filter.png" alt=""></p><p>Filter items emitted by the source Observable by only emitting those that satisfy a specified predicate.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> clicks = Rx.Observable.fromEvent(<span class="built_in">document</span>, <span class="string">'click'</span>)</span><br><span class="line">clicks.filter(<span class="function"><span class="params">ev</span> =&gt;</span> <span class="built_in">Math</span>.random() &gt; <span class="number">0.4</span>)</span><br></pre></td></tr></table></figure><ul><li>find</li></ul><p><code>public find(predicate: function(value: T, index: number, source: Observable&lt;T&gt;): boolean, thisArg: any): Observable&lt;T&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/find.png" alt=""></p><p>Emits only the first value emitted by the source Observable that meets some condition.</p><ul><li>findIndex</li></ul><p><code>public findIndex(predicate: function(value: T, index: number, source: Observable&lt;T&gt;): boolean, thisArg: any): Observable&lt;T&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/findIndex.png" alt=""></p><blockquote><p>Itâs like find, but emits the index of the found value, not the value itself.</p></blockquote><ul><li>first</li></ul><p><code>public first(predicate: function(value: T, index: number, source: Obsevable&lt;T&gt;): boolean, resultSelector: function(value: T, index: number): R, defaultValue: R): Observable&lt;T|R&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/first.png" alt=""></p><p>Emits only the first value (or the fisrt value that meets some condition) emitted by the source Obsevable</p><ul><li>forEach</li></ul><p><code>public forEach(next: Function, PromiseCtor: PromiseConstructor): Promise</code></p><ul><li>groupBy</li></ul><p><code>public groupBy(keySelector: function(value: T): K, elementSelector: functioN(value: T): R, durationSelector: function(grouped: GroupedObservable&lt;K|R&gt;): Observable&lt;any&gt;): Observable&lt;GroupedObservable&lt;K, R&gt;&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/groupBy.png" alt=""></p><ul><li>ignoreElements</li></ul><p><code>public ignoreElements(): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/ignoreElements.png" alt=""></p><p>Iggnores all items emitted by the source Observable and only pass calls of <code>complete</code> or <code>error</code></p><ul><li>isEmpty()</li></ul><p><code>public isEmpty(): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/isEmpty.png" alt=""></p><ul><li>last</li></ul><p><code>public last(predicate: function): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/last.png" alt=""></p><ul><li>letProto</li></ul><p><code>public letProto(func: *): Observable&lt;T&gt;</code></p><ul><li>lift</li></ul><p><code>public lift(operator: Operator): Observable</code></p><p>Creates a new Observable, with this Observable as the source, and the passed operator defined as the new observableâs operator.</p><blockquote><p>Return a new Observable with the Operator applied.</p></blockquote><ul><li>map</li></ul><p><code>public map(project: function(value: T, index: number): R, thisArg: any): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/map.png" alt=""></p><p>Applies a given <code>project</code> function to each value emitted by the source Observable, and emits the resulting values as an Observable.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> clicks = Rx.Observable.fromEvent(<span class="built_in">document</span>, <span class="string">'click'</span>)</span><br><span class="line">clicks.map(<span class="function"><span class="params">ev</span> =&gt;</span> ev.clientX)</span><br></pre></td></tr></table></figure><ul><li>mapTo</li></ul><p><code>public mapTo(value: any): Observbale</code></p><p><img src="http://reactivex.io/rxjs/img/mapTo.png" alt=""></p><p>Emits the given constant value on the output Observable every time the source Observable emits a value.</p><ul><li>materialize</li></ul><p><code>public materialize(): Observable&lt;Notification&lt;T&gt;&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/materialize.png" alt=""></p><p>Represents all of the notifications from the source Observable as <code>next</code> emission marked with their orignal types within <code>Notification</code> objects.</p><ul><li>max</li></ul><p><code>public max(comparer: Function): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/max.png" alt=""></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Rx.Observable.of(<span class="number">5</span>, <span class="number">3</span>, <span class="number">9</span>, <span class="number">8</span>).max()</span><br><span class="line"></span><br><span class="line">interface Person &#123;</span><br><span class="line">  name: string</span><br><span class="line">  age: number</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Rx.Observable.of&lt;Person&gt;(</span><br><span class="line">  &#123; <span class="attr">age</span>: <span class="number">7</span>, <span class="attr">name</span>: <span class="string">'Foo'</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">age</span>: <span class="number">8</span>, <span class="attr">name</span>: <span class="string">'Bar'</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">age</span>: <span class="number">0</span>, <span class="attr">name</span>: <span class="string">'For'</span> &#125;,</span><br><span class="line">)</span><br><span class="line">.max&lt;Person&gt;<span class="function">(<span class="params">(a, b</span>) =&gt;</span> a.age - b.age)</span><br></pre></td></tr></table></figure><ul><li>merge</li></ul><p><code>public merge(other: ObservableInpt, concurrent: number, scheduler: Scheduer): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/merge.png" alt=""></p><p>Creates an output Observable which concurrently emits all values from every given input Observable.</p><blockquote><p>Flatten multiple Observable together by blending their values into one Observable.</p></blockquote><ul><li>mergeAll</li></ul><p><code>public mergeAll(concurrent: number): Obsevable</code></p><p><img src="http://reactivex.io/rxjs/img/mergeAll.png" alt=""></p><p>Converts a higher-order Observable into a first-order Observable which concurrently delivers all values that are emitted on the inner Observables.</p><ul><li>mergeMap</li></ul><p><code>public mergeMap(project: function(value: T, ?index: number): ObservableInput, resultSelector: function(outerValue: T, innerValue: I, outerIndex: number, innerIndex: number): any, concurrent: number): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/mergeMap.png" alt=""></p><p>Projects each source value to an Observable which is merged in the output Observable.</p><blockquote><p>Map each value to an Observable, then flattn all of these inner Observable using mergeAll</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> letters = Rx.Observable.of(<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>)</span><br><span class="line">letters.mergeMap(<span class="function"><span class="params">letter</span> =&gt;</span> Rx.Observable.interval(<span class="number">1000</span>).map(<span class="function"><span class="params">i</span> =&gt;</span> i+letter))</span><br></pre></td></tr></table></figure><ul><li>mergeMapTo</li></ul><p><code>public mergeMapTo(innerObservable: ObservableInput, resultSelector: function(outerValue: T, innerValue: I, outerIndex: number, innerIndex: number): any, concurrent: number): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/mergeMapTo.png" alt=""></p><p>Projects each source value to the same Observable which is merged multiple times in the output Observable.</p><ul><li>mergeScan</li></ul><p><code>public mergeScan(accumulator: function(acc: R, value: T): Observable&lt;R&gt;, seed: *, concurrent: number): Observable&lt;R&gt;</code></p><p>Applies an accumulator function over the source Observable where the accumulator function itself retunrs an Observable, then each intermediate Observable is merged into the output Obsevable.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> click$ = Rx.Observable.fromEvent(<span class="built_in">document</span>, <span class="string">'click'</span>)</span><br><span class="line"><span class="keyword">const</span> one$ = click$.mapTo(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">const</span> seed = <span class="number">0</span></span><br><span class="line"><span class="keyword">const</span> count$ = one$.mergeScan(<span class="function">(<span class="params">acc, one</span>) =&gt;</span> Rx.Observable.of(acc + one), seed)</span><br></pre></td></tr></table></figure><ul><li>min</li></ul><p><code>public min(comparer: Function): Observable&lt;R&gt;</code></p><ul><li>multicast</li></ul><p><code>public multicast(subjectOrSubjectFactory: Function | Subject, selector: Function): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/multicast.png" alt=""></p><p>Returns an Observable tghat emits the results of invoking a specified selector on items emitted by a ConnectableObservable that shares a single subscription to the underlying stream.</p><ul><li>observeOn</li></ul><p><code>public observeOn(scheduler: *, delay: *): Observable&lt;R&gt;</code></p><ul><li>pairwise</li></ul><p><code>public pairwise(): Observable&lt;Array&lt;T&gt;&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/pairwise.png" alt=""></p><p>Groups pairs of consecutive emissions together and emits them as an array of two values.</p><blockquote><p>Puts the current value and previous value together as an array, and emits that.</p></blockquote><ul><li>partition</li></ul><p>`public partition(predicate: function(value: T, index: number): Boolean, thisArg: this): [Observable<t>, Observable<t>]</t></t></p><p><img src="http://reactivex.io/rxjs/img/partition.png" alt=""></p><p>Splits the source Observable into two, one with values that satisfy a predicate, and another values that donât satisfy the predicate.</p><blockquote><p>Itâs like filter, but returns two Observable, one like the output of filter, and the other with values that did not pass the condition.</p></blockquote><ul><li>pluck</li></ul><p><code>public pluck(properties: ...string): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/pluck.png" alt=""></p><p>Maps each source value (an object) to its specified nested property</p><blockquote><p>Like map, but meant only for picking on eof the nested properties of every emitted object.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> clicks$ = Rx.Observable.fromEvent(<span class="built_in">document</span>, <span class="string">'click'</span>)</span><br><span class="line">clicks$.pluck(<span class="string">'target'</span>, <span class="string">'tagName'</span>)</span><br></pre></td></tr></table></figure><ul><li>publish</li></ul><p><code>public publish(selector: Function): *</code></p><p>Returns a ConnectableObservable, which is a variety of Observable that waits until connect method is called before it begins emitting items to those Observers that have subscribed to it.</p><ul><li><p>publishBehavior</p></li><li><p>publishLast</p></li><li><p>publishReplay</p></li><li><p>race</p></li></ul><p><code>public race(...observables): Observable</code></p><p>Returns an Observable that mirrors the first source Observable to emit an item from the combination of this Observable and supplied Observables.</p><ul><li>reduce</li></ul><p><code>public reduce(accumulator: function(acc: R, value: T, index: number): R, seed: R): Observable&lt;R&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/reduce.png" alt=""></p><ul><li>repeat</li></ul><p><code>public repeat(count: number): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/repeat.png" alt=""></p><ul><li>repeatWhen</li></ul><p><code>public repeatWhen(notifier: functioN(notification: Observable): Observable): Observable</code></p><p>1<a href="http://reactivex.io/rxjs/img/repeatWhen.png" target="_blank" rel="noopener"></a></p><ul><li>retry</li></ul><p><code>public retry(count: number): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/retry.png" alt=""></p><p>Returns an Observable that mirrors the source Observable with the exception of an <code>error</code>, if the source Observable calls <code>error</code>, this method will resubscribe to the source Observable for a maximum of <code>count</code> resubscriptions rather than propagating the <code>error</code> call.</p><ul><li>retryWhen</li></ul><p><code>public retryWhen(notifier: function(errors: Observable): Observable): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/retryWhen.png" alt=""></p><ul><li>sample</li></ul><p><code>public sample(notifier: Observable&lt;any&gt;): Observable&lt;T&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/sample.png" alt=""></p><p>Emits the most recently emitted value from the source Observable whenever another Observable, the <code>notifier</code> emits.</p><blockquote><p>Itâs like sampleTime, but sampels whenever the notifier Observable emits.</p></blockquote><ul><li>sampleTime</li></ul><p><code>public sampleTime(period: number, scheduler: Scheduler): Observable&lt;T&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/sampleTime.png" alt=""></p><ul><li>scan</li></ul><p><code>public scan(accumulate: function(acc: R, value: T, index: number): R, seed: T|R): Observable&lt;R&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/scan.png" alt=""></p><p>Applies an accumulator function over the source Observable, and returns each intermediate result, with an optional seed value.</p><blockquote><p>Itâs like reduce, but emits the current accumulation whenever the source emits a value</p></blockquote><ul><li>sequenceEqual(compareTo: Observbale, comparor: function): Observable`</li></ul><p><img src="http://reactivex.io/rxjs/img/sequenceEqual.png" alt=""></p><p>Compares all values of two observbales in sequence using an optional comparor function and returns an observable of a single boolean value representing whether or not the two sequences are equal.</p><blockquote><p>Checks to see of all values emitted by both observables are equal in order.</p></blockquote><ul><li>share</li></ul><p><code>public share(): Observable&lt;T&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/share.png" alt=""></p><p>Returns a new Observable that multicasts (shares) the original Observable. As long as there is at least one Subscriber this Observable will be subscribed and emitting data. When all subscribers have unsubscribed it will unsubscribe from the source Observable. Because the Observable is multicasting it makes the stream hot. This is an alias for .publish().refCount().</p><ul><li>single</li></ul><p><code>public single(predicate: Function): Observable&lt;T&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/single.png" alt=""></p><ul><li>skip</li></ul><p><code>public skip(count: number): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/skip.png" alt=""></p><ul><li>skipUntil</li></ul><p><code>public skipUntil(notifier: Observable): Observable&lt;T&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/skipUntil.png" alt=""></p><p>Returns an Observable that skips items emitted by the source Observable until a second Observable emits an item.</p><ul><li>skipWhile</li></ul><p><code>public skipWhile(predicate: Function): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/skipWhile.png" alt=""></p><p>Returns an Observable that skips all items emitted by the source Observable as long as a specified condition holds true, but emits all further source items as soon as the condition becomes false.</p><ul><li>startWith</li></ul><p><code>public startWith(values: ...T, scheduler: Scheduler): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/startWith.png" alt=""></p><p>Returns an Observable that emits the items you specified before it begins to emit items by the source Observable.</p><ul><li>subscribeOn</li></ul><p><code>public subscribeOn(scheduler: Scheduler): Observable&lt;T&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/subscribeOn.png" alt=""></p><p>Asynchornously subscribes Observables to this Observable on the specified Scheduler.</p><ul><li>switch</li></ul><p><code>public switch(): Observable&lt;T&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/switch.png" alt=""></p><p>Converts a higher-order Observable into a first-order Observable by subscribing to only the most recently emitted of those inner Observables.</p><blockquote><p>Flatten an Observable-of-Observables by dropping the previous inner Obsevable once a new one appears.</p></blockquote><ul><li>switchMap</li></ul><p><code>public switchMap(project: function(value: T, ?index: number): ObservableInput, resultSelector: function(outerValue: T, innerValue: I, outerIndex: number, innerIndex: number): any): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/switchMap.png" alt=""></p><p>Projects each source value to an Observable which is merged in the output Observable, emitting values only from the most recent projected Observable.</p><blockquote><p>Map each value to an Observable, then flatten all of these Observable using switch.</p></blockquote><ul><li>take</li></ul><p><code>public take(count: number): Observable&lt;T&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/take.png" alt=""></p><p>Emits only the first <code>count</code> values emitted by the source Observable.</p><blockquote><p>Take the first count value from the source, then complete.</p></blockquote><ul><li>takeLast</li></ul><p><code>takeLast(count: number): Observable&lt;T&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/takeLast.png" alt=""></p><p>Emits only the last <code>count</code> values emitted by the source Observable.</p><blockquote><p>Remembers the latest count values, then emits those only when the source completes.</p></blockquote><ul><li>takeUntil</li></ul><p><code>public takeUntil(notifier: Observable): Observable&lt;T&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/takeUntil.png" alt=""></p><p>Emits the values emitted by the source Observable until a <code>notifier</code> Observable emits a value.</p><blockquote><p>Let values pass until a second Observable, notifier, emits something. Then, it completes.</p></blockquote><ul><li>takeWhile</li></ul><p><code>public takeWhile(predicate: function(value: T, index: number): boolean): Observable&lt;T&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/takeWhile.png" alt=""></p><p>Emits values emitted by the source Observable so long as each value satisfies the given <code>predicate</code>, and then completes as soon as this <code>predicate</code> is not satisfied.</p><blockquote><p>Take values from the source only while they pass the condition given, when the first value does not satisfy, it completes.</p></blockquote><ul><li>throttle</li></ul><p><code>public throttle(durationSelector: function(value: T): SubscribableOrPromise): Observable&lt;T&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/throttle.png" alt=""></p><p>Emits a value from the source Observable, then ignores subsequent source values for a duration determined by another Observable, then repeats this process.</p><blockquote><p>Itâs like throttleTime, but the silencing duration is determined by a second Observable.</p></blockquote><p>Cannot emit more than one values until the second Observable emits a value.</p><ul><li>throttleTime</li></ul><p><code>public throttleTime(duration: number, scheduler: Scheduler): Observable&lt;T&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/throttleTime.png" alt=""></p><p>Emits a value from the source Observable, then ignores subsequent source values for <code>duration</code> milliseconds, then repeats this process.</p><blockquote><p>Lets a value pass, then ignores source values for the next duration milliseconds.</p></blockquote><ul><li>timeInterval</li></ul><p><code>public timeInterval(scheduler: *): Observable&lt;TimeInterval&lt;any&gt;&gt;</code></p><ul><li>timeout</li></ul><p><code>public timeout(due: number, scheduler: Scheduler): Observable&lt;T&gt;</code></p><ul><li>timeoutWith</li></ul><p><code>public timeoutWith(due: *, withObservable: *, scheduler: Scheduler): Observable&lt;R&gt;</code></p><ul><li>timestamp</li></ul><p><code>public timestamp(scheduler: *): Observable&lt;Timestamp&lt;&gt;&gt;any</code></p><ul><li>toArray</li></ul><p><code>public toArray(): Observable&lt;any[]&gt;</code></p><ul><li>toPromise</li></ul><p><code>public toPromise(PromiseCtor: *): Promise&lt;T&gt;</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Rx.Observable.of(<span class="number">42</span>).toPromise().then(<span class="built_in">console</span>.log)</span><br></pre></td></tr></table></figure><ul><li>window</li></ul><p><code>public window(windowBoundaries: Observable&lt;any&gt;): Observable&lt;Observable&lt;T&gt;&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/window.png" alt=""></p><p>Branch out the source Observable values as a nested Observable whenever <code>windowBoundaries</code> emits.</p><blockquote><p>Itâs like buffer, but emits a nested Observable instead of an array.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> clicks = Rx.Observable.fromEvent(<span class="built_in">document</span>, <span class="string">'click'</span>)</span><br><span class="line"><span class="keyword">let</span> interval = Rx.Observable.interval(<span class="number">1000</span>)</span><br><span class="line">clicks.window(interval)</span><br></pre></td></tr></table></figure><ul><li>windowCount</li></ul><p><code>public windowCount(windowSize: number, startWindowEvery: number): Observable&lt;Observable&lt;T&gt;&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/windowCount.png" alt=""></p><p>Branch out the source Observable values as a nested Observable with each nested Observable emitting at most <code>windowSize</code> values.</p><blockquote><p>Itâs like bufferCount, but emits a nested Observable instead of an array.</p></blockquote><ul><li>windowToggle</li></ul><p><code>public windowToggle(openings: Observable&lt;O&gt;, closingSelectors: function(value: O): Observable): Observable&lt;Observable&lt;T&gt;&gt;</code></p><p><img src="http://reactivex.io/rxjs/img/windowToggle.png" alt=""></p><p>Branch out the source Observable values as a nested Observable starting from an emission from <code>openings</code> and ending when the output of <code>closingSelector</code></p><ul><li>windowWhen(closingSelector: function(): Observable): Observable&lt;Observable<t>&gt;`</t></li></ul><p>Branch out the source Observable values as a nested Observable using a factory function of closing Observables to determine when to start a new window.</p><blockquote><p>Itâs like bufferWhen, but emits a nested Observable instead of an array.</p></blockquote><ul><li>withLatestFrom</li></ul><p><code>public withLatestFrom(other: ObservableInput, project: Function): Observable</code></p><p><img src="http://reactivex.io/rxjs/img/withLatestFrom.png" alt=""></p><p>Combines the source Observable with other Observables to create an Observable whose values are calculated from the latest values of each, only when the source emit.</p><blockquote><p>Whenever the source Observable emits a value, it computes a formula using that value plus the latest values from other input Observables, then emits the output of that formula.</p></blockquote><ul><li>zipAll</li></ul><p><code>public zipAll(project: *): Observable&lt;R&gt;</code></p><ul><li>zipProto</li></ul><p><code>public zipProto(observables: *): Observable&lt;R&gt;</code></p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>HTTP Timings in Node.js</title>
      <link href="/2017/09/25/HTTP-Timings-in-Node-js/"/>
      <content type="html"><![CDATA[<p><a href="https://blog.risingstack.com/measuring-http-timings-node-js/" target="_blank" rel="noopener">Origin</a></p><h3 id="Some-Basic-Concepts"><a href="#Some-Basic-Concepts" class="headerlink" title="Some Basic Concepts:"></a>Some Basic Concepts:</h3><ul><li><p>IP(Internet Protocol): IP is a network-layer protocol, deals with network addressing and routing. IP is responsible for delivering packets from the source host to the destination host based on the packet headers across one or more IP network. It also defines packet structures that encapsulate the data to be delivered.</p></li><li><p>DNS(Domain Name Server): DNS is a hierarchical decentralized naming system used to resolve human-readable hostnames into machine-readable IP address.</p></li><li><p>TCP(Transmission Control Protocol): The TCP standard defines how to establish and maintain a network conversation between applications to exchange data. TCP provides reliable, ordered, and error-checked deliver of a stream of octects between applications running on hosts communicating over an IP network. An HTTP client initiates a request by establishing a TCP connection.</p></li><li><p>SSL(Secure Sockets Layer)/TLS(Transport Layer Security): TLS is a cryptographic protocol that provides communications security over a computer network. SSL is a deprecated predecessor to TLS. Both TLS and SSL use certificates to establish a secure connection. SSL certificates are not dependent on cryptographic protocols like TLS, a certificate contains a key pair: a public and a private key.</p></li></ul><p><img src="https://blog-assets.risingstack.com/2017/09/http-timing-nodejs.png" alt=""></p><p>Timings Explained:</p><ul><li><p>DNS Lookup: Time spent performing the DNS Lookup. DNS lookup resolves domain names to IP addresses.</p></li><li><p>TCP Connection: Time it took to establish TCP Connection between a source host and destination host. Connections must be properly established in a multi-step handshake process.</p></li><li><p>TLS handshake: Time spent completing a TLS handshake. During the handshake process endpoints exchange authentication and keys to establish or resume secure sessions. There is no TLS handshake with a not HTTPS request.</p></li><li><p>Time To First Byte(TTFB): Time spent waiting for the initial response. This time captures the latency of a round trip to the server in addition to the time spent waiting for the server to process the request and deliver the response.</p></li><li><p>Content Transfer: Time spent receiving the response data. The size of the response data and the available network bandwidth determinates its duration.</p></li></ul><h3 id="Measuring-HTTP-timings-in-Node-js"><a href="#Measuring-HTTP-timings-in-Node-js" class="headerlink" title="Measuring HTTP timings in Node.js"></a>Measuring HTTP timings in Node.js</h3><p>To measure HTTP timings in Node.js, we need to subscribe to a specific request, response and socket events. Here is a short code snippet how to do this.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> timings = &#123;</span><br><span class="line">  startAt: process.hrtime(),</span><br><span class="line">  dnsLookupAt: <span class="literal">undefined</span>,</span><br><span class="line">  tcpConnectionAt: <span class="literal">undefined</span>,</span><br><span class="line">  tlsHandshakeAt: <span class="literal">undefined</span>,</span><br><span class="line">  firstByteAt: <span class="literal">undefined</span>,</span><br><span class="line">  endAt: <span class="literal">undefined</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> req = http.request(&#123;...&#125;, (res) =&gt; &#123;</span><br><span class="line">  res.once(<span class="string">'readable'</span>, () =&gt; &#123;</span><br><span class="line">    timings.firstByteAt = process.hrtime()</span><br><span class="line">  &#125;)</span><br><span class="line">  res.on(<span class="string">'data'</span>, (chunk) =&gt; &#123;</span><br><span class="line">    responseBody += chunk</span><br><span class="line">  &#125;)</span><br><span class="line">  res.on(<span class="string">'end'</span>, () =&gt; &#123;</span><br><span class="line">    timings.endAt = process.hrtime()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">req.on(<span class="string">'socket'</span>, (socket) =&gt; &#123;</span><br><span class="line">  socket.on(<span class="string">'lookup'</span>, () =&gt; &#123;</span><br><span class="line">    timings.dnsLookupAt = process.hrtime()</span><br><span class="line">  &#125;)</span><br><span class="line">  socket.(<span class="string">'connect'</span>, () =&gt; &#123;</span><br><span class="line">    timings.tcpConnectionAt = process.hrtime()</span><br><span class="line">  &#125;)</span><br><span class="line">  socket.on(<span class="string">'secureConnect, () =&gt; &#123;</span></span><br><span class="line"><span class="string">    timings.tlsHandshake = process.hrtime()</span></span><br><span class="line"><span class="string">  &#125;)</span></span><br><span class="line"><span class="string">&#125;)</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Graphql-Koa-Starter</title>
      <link href="/2017/09/15/graphql-koa-starter/"/>
      <content type="html"><![CDATA[<h3 id="Init-Project"><a href="#Init-Project" class="headerlink" title="Init Project"></a>Init Project</h3><h3 id="Add-tsconfig"><a href="#Add-tsconfig" class="headerlink" title="Add tsconfig"></a>Add tsconfig</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// tsconfig.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"files"</span>: [</span><br><span class="line">    <span class="string">"server.ts"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"compilerOptions"</span>: &#123;</span><br><span class="line">    <span class="string">"outDir"</span>: <span class="string">"./build"</span>,</span><br><span class="line">    <span class="string">"target"</span>: <span class="string">"es2015"</span>,</span><br><span class="line">    <span class="string">"module"</span>: <span class="string">"commonjs"</span>,</span><br><span class="line">    <span class="string">"moduleResolution"</span>: <span class="string">"Node"</span>,</span><br><span class="line">    <span class="string">"sourceMap"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"pretty"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"strictNullChecks"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"lib"</span>: [</span><br><span class="line">      <span class="string">"esnext"</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"exclude"</span>: [</span><br><span class="line">    <span class="string">"node_modules"</span>,</span><br><span class="line">    <span class="string">"build"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Add-tslint"><a href="#Add-tslint" class="headerlink" title="Add tslint"></a>Add tslint</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// tslint.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"rules"</span>: &#123;</span><br><span class="line">    <span class="string">"align"</span>: [</span><br><span class="line">      <span class="literal">true</span>,</span><br><span class="line">      <span class="string">"parameters"</span>,</span><br><span class="line">      <span class="string">"arguments"</span>,</span><br><span class="line">      <span class="string">"statements"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"ban"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"class-name"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"curly"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"eofline"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"forin"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"indent"</span>: [</span><br><span class="line">      <span class="literal">true</span>,</span><br><span class="line">      <span class="string">"spaces"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"interface-name"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"jsdoc-format"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"label-position"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"max-line-length"</span>: [</span><br><span class="line">      <span class="literal">true</span>,</span><br><span class="line">      <span class="number">140</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"member-access"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"member-ordering"</span>: [</span><br><span class="line">      <span class="literal">true</span>,</span><br><span class="line">      <span class="string">"public-before-private"</span>,</span><br><span class="line">      <span class="string">"static-before-instance"</span>,</span><br><span class="line">      <span class="string">"variables-before-functions"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"no-any"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"no-arg"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"no-bitwise"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"no-conditional-assignment"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"no-console"</span>: [</span><br><span class="line">      <span class="literal">true</span>,</span><br><span class="line">      <span class="string">"debug"</span>,</span><br><span class="line">      <span class="string">"info"</span>,</span><br><span class="line">      <span class="string">"time"</span>,</span><br><span class="line">      <span class="string">"timeEnd"</span>,</span><br><span class="line">      <span class="string">"trace"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"no-construct"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"no-debugger"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"no-shadowed-variable"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"no-duplicate-variable"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"no-empty"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"no-eval"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"no-inferrable-types"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"no-internal-module"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"no-require-imports"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"no-string-literal"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"no-switch-case-fall-through"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"no-trailing-whitespace"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"no-var-keyword"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"no-var-requires"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"one-line"</span>: [</span><br><span class="line">      <span class="literal">true</span>,</span><br><span class="line">      <span class="string">"check-open-brace"</span>,</span><br><span class="line">      <span class="string">"check-catch"</span>,</span><br><span class="line">      <span class="string">"check-else"</span>,</span><br><span class="line">      <span class="string">"check-whitespace"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"quotemark"</span>: [</span><br><span class="line">      <span class="literal">true</span>,</span><br><span class="line">      <span class="string">"single"</span>,</span><br><span class="line">      <span class="string">"jsx-single"</span>,</span><br><span class="line">      <span class="string">"avoid-escape"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"radix"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"semicolon"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"switch-default"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"triple-equals"</span>: [</span><br><span class="line">      <span class="literal">true</span>,</span><br><span class="line">      <span class="string">"allow-null-check"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"typedef"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"typedef-whitespace"</span>: [</span><br><span class="line">      <span class="literal">true</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"call-signature"</span>: <span class="string">"nospace"</span>,</span><br><span class="line">        <span class="string">"index-signature"</span>: <span class="string">"nospace"</span>,</span><br><span class="line">        <span class="string">"parameter"</span>: <span class="string">"nospace"</span>,</span><br><span class="line">        <span class="string">"property-declaration"</span>: <span class="string">"nospace"</span>,</span><br><span class="line">        <span class="string">"variable-declaration"</span>: <span class="string">"nospace"</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"variable-name"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"whitespace"</span>: [</span><br><span class="line">      <span class="literal">true</span>,</span><br><span class="line">      <span class="string">"check-branch"</span>,</span><br><span class="line">      <span class="string">"check-decl"</span>,</span><br><span class="line">      <span class="string">"check-operator"</span>,</span><br><span class="line">      <span class="string">"check-separator"</span>,</span><br><span class="line">      <span class="string">"check-type"</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Add-env"><a href="#Add-env" class="headerlink" title="Add env"></a>Add env</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// env.ts</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> envalid <span class="keyword">from</span> <span class="string">'envalid'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; url, bool, str &#125; = envalid</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> env = envalid.cleanEnv(process.env, &#123;</span><br><span class="line">  SERVICE_URI: str(&#123; <span class="keyword">default</span>: <span class="string">'https://reqres.in/api'</span> &#125;),</span><br><span class="line">  NODE_ENV: str(&#123; devDefault: <span class="string">'development'</span>, <span class="keyword">default</span>: <span class="string">'production'</span> &#125;),</span><br><span class="line">  LOG_LEVEL: str(&#123; <span class="keyword">default</span>: <span class="string">'info'</span> &#125;),</span><br><span class="line">  CORS: bool(&#123; devDefault: <span class="literal">true</span>, <span class="keyword">default</span>: <span class="literal">false</span> &#125;),</span><br><span class="line">  GRAPHIQL: bool(&#123; devDefault: <span class="literal">true</span>, <span class="keyword">default</span>: <span class="literal">true</span> &#125;),</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> env</span><br></pre></td></tr></table></figure><h3 id="Add-Nodemon"><a href="#Add-Nodemon" class="headerlink" title="Add Nodemon"></a>Add Nodemon</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"watch"</span>: [<span class="string">"src"</span>],</span><br><span class="line">  <span class="attr">"ext"</span>: <span class="string">"ts"</span>,</span><br><span class="line">  <span class="attr">"ignore"</span>: [<span class="string">"src/**/*.spec.ts"</span>],</span><br><span class="line">  <span class="attr">"exec"</span>: <span class="string">"ts-node ./server.ts"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Create-Koa-APP"><a href="#Create-Koa-APP" class="headerlink" title="Create Koa APP"></a>Create Koa APP</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/app.ts</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> Koa <span class="keyword">from</span> <span class="string">'koa'</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> cors <span class="keyword">from</span> <span class="string">'koa-cors'</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> convert <span class="keyword">from</span> <span class="string">'koa-convert'</span></span><br><span class="line"><span class="keyword">import</span> &#123; apiRouter &#125; <span class="keyword">from</span> <span class="string">'./routers'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (process.env.CORS) &#123;</span><br><span class="line">  app.use(convert(cors()))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.use(apiRouter.routes()).use(apiRouter.allowedMethods())</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> app</span><br></pre></td></tr></table></figure><h3 id="Server-Startup"><a href="#Server-Startup" class="headerlink" title="Server Startup"></a>Server Startup</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.ts</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> chalk <span class="keyword">from</span> <span class="string">'chalk'</span></span><br><span class="line"><span class="keyword">import</span> env <span class="keyword">from</span> <span class="string">'./env'</span></span><br><span class="line">process.env = env</span><br><span class="line"><span class="keyword">import</span> app <span class="keyword">from</span> <span class="string">'./src/app'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> port = process.env.PORT || <span class="number">3001</span></span><br><span class="line"></span><br><span class="line">app.listen(port, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV === <span class="string">'development'</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (process.env.GRAPHIQL) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'The GraphiQL App is running at: '</span>)</span><br><span class="line">      <span class="built_in">console</span>.log(chalk.cyan(<span class="string">`http://localhost:<span class="subst">$&#123;port&#125;</span>/api/graphiql`</span>))</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'Koa app is running at: '</span>)</span><br><span class="line">      <span class="built_in">console</span>.log(chalk.cyan(<span class="string">`http://localhost:<span class="subst">$&#123;port&#125;</span>`</span>))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Koa App is running'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Add-Router"><a href="#Add-Router" class="headerlink" title="Add Router"></a>Add Router</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/routers/graphql.ts</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> Router <span class="keyword">from</span> <span class="string">'koa-router'</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> GraphQLHttp <span class="keyword">from</span> <span class="string">'koa-graphql'</span></span><br><span class="line"><span class="keyword">import</span> schema <span class="keyword">from</span> <span class="string">'../graphql/schema'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router()</span><br><span class="line"><span class="comment">// console.log(process.env)</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(process.env)</span><br><span class="line">router.all(<span class="string">'/'</span>, GraphQLHttp(&#123;</span><br><span class="line">  schema,</span><br><span class="line">  graphiql: process.env.GRAPHIQL,</span><br><span class="line">  pretty: <span class="literal">true</span>,</span><br><span class="line">  errorFormat: <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; message, locations, path, stack &#125; = error</span><br><span class="line">    <span class="built_in">console</span>.error(<span class="string">`GraphQL Error: `</span>, &#123;</span><br><span class="line">      message,</span><br><span class="line">      locations,</span><br><span class="line">      path,</span><br><span class="line">      stack,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/routers/index.ts</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> Router <span class="keyword">from</span> <span class="string">'koa-router'</span></span><br><span class="line"><span class="keyword">import</span> graphQLRouter <span class="keyword">from</span> <span class="string">'./graphql'</span></span><br><span class="line"><span class="keyword">import</span> testRouter <span class="keyword">from</span> <span class="string">'./test'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> apiRouter = <span class="keyword">new</span> Router(&#123;</span><br><span class="line">  prefix: <span class="string">'/api'</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">apiRouter.use(<span class="string">'/graphql'</span>, graphQLRouter.routes(), graphQLRouter.allowedMethods())</span><br><span class="line">apiRouter.use(<span class="string">'/test'</span>, testRouter.routes(), testRouter.allowedMethods())</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">  apiRouter</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Config-Graphql"><a href="#Config-Graphql" class="headerlink" title="Config Graphql"></a>Config Graphql</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/graphql/model.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  GraphQLObjectType,</span><br><span class="line">  GraphQLString,</span><br><span class="line">  GraphQLNonNull,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'graphql'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> User = <span class="keyword">new</span> GraphQLObjectType(&#123;</span><br><span class="line">  name: <span class="string">'User'</span>,</span><br><span class="line">  description: <span class="string">'A User'</span>,</span><br><span class="line">  fields: <span class="function"><span class="params">()</span> =&gt;</span> (&#123;</span><br><span class="line">    id: &#123;</span><br><span class="line">      <span class="keyword">type</span>: <span class="keyword">new</span> GraphQLNonNull(GraphQLString),</span><br><span class="line">      resolve: <span class="function">(<span class="params">user</span>) =&gt;</span> user.id,</span><br><span class="line">    &#125;,</span><br><span class="line">    firstName: &#123;</span><br><span class="line">      <span class="keyword">type</span>: <span class="keyword">new</span> GraphQLNonNull(GraphQLString),</span><br><span class="line">      resolve: <span class="function"><span class="params">user</span> =&gt;</span> user.first_name</span><br><span class="line">    &#125;,</span><br><span class="line">    lastName: &#123;</span><br><span class="line">      <span class="keyword">type</span>: <span class="keyword">new</span> GraphQLNonNull(GraphQLString),</span><br><span class="line">      resolve: <span class="function"><span class="params">user</span> =&gt;</span> user.last_name</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">  User</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/graphql/query.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; GraphQLObjectType, GraphQLList &#125; <span class="keyword">from</span> <span class="string">'graphql'</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"><span class="keyword">import</span> &#123; User &#125; <span class="keyword">from</span> <span class="string">'./model'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> GraphQLObjectType(&#123;</span><br><span class="line">  name: <span class="string">'Query'</span>,</span><br><span class="line">  description: <span class="string">'Query of GraphQL'</span>,</span><br><span class="line">  fields: <span class="function"><span class="params">()</span> =&gt;</span> (&#123;</span><br><span class="line">    users: &#123;</span><br><span class="line">      <span class="keyword">type</span>: <span class="keyword">new</span> GraphQLList(User),</span><br><span class="line">      resolve: <span class="function">(<span class="params">root, args</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> axios(&#123;</span><br><span class="line">          url: <span class="string">'https://reqres.in/api/users'</span>,</span><br><span class="line">        &#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> res.data).then(<span class="function"><span class="params">res</span> =&gt;</span> res.data)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/graphql/schema.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; GraphQLSchema &#125; <span class="keyword">from</span> <span class="string">'graphql'</span></span><br><span class="line"><span class="keyword">import</span> query <span class="keyword">from</span> <span class="string">'./query'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> GraphQLSchema(&#123;</span><br><span class="line">  query</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> Node, Graphql, Koa </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Tag Picture in Html</title>
      <link href="/2017/09/15/tag-picture-in-html/"/>
      <content type="html"><![CDATA[<p>The <code>picture</code> element is a markup pattern that allows developers to declare multiple sources for an image.</p><p>This markup is a container used to specify multiple <code>&lt;source&gt;</code> elements for a specific <code>&lt;img&gt;</code> contained in it.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">picture</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">source</span> <span class="attr">media</span>=<span class="string">"(min-width: 40em)"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">srcset</span>=<span class="string">"big.jpg 1x, big-hd.jgp 2x"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">source</span></span></span><br><span class="line"><span class="tag">    <span class="attr">srcset</span>=<span class="string">"small.jpg 1x, small-hd.jpg 2x"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"fallback.jpg"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">picture</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Use-the-media-attribute"><a href="#Use-the-media-attribute" class="headerlink" title="Use the media attribute"></a>Use the <code>media</code> attribute</h3><p>The <code>media</code> attribute lets you specify a media query that the user agent will evaluates to select a <code>&lt;source&gt;</code> element. If the media query evaluates to <code>false</code>, the <code>&lt;source&gt;</code> element is skipped.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;picture&gt;</span><br><span class="line">  &lt;source srcset=<span class="string">"logo-wide.jpg"</span> media=<span class="string">"(min-width: 600px)"</span>&gt;</span><br><span class="line">  &lt;img src=<span class="string">"logo-narrow.jpg"</span>&gt;</span><br><span class="line">&lt;<span class="regexp">/picture&gt;</span></span><br></pre></td></tr></table></figure><p>The <code>srcset</code> and <code>sizes</code> attributes extend the <code>img</code> and <code>source</code> elements to provide a list of available image sources and their sizes. Browsers can then use this information to pick the best image source.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">srcset</span>=<span class="string">"elva-fairy-320w.jpg 320w,</span></span></span><br><span class="line"><span class="tag"><span class="string">    elva-fairy-480w.jpg 480w,</span></span></span><br><span class="line"><span class="tag"><span class="string">    elva-fairy-800w.jpg 800w"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">sizes</span>=<span class="string">"(max-width: 320px) 280px,</span></span></span><br><span class="line"><span class="tag"><span class="string">    (max-width: 480px) 440px,</span></span></span><br><span class="line"><span class="tag"><span class="string">    800px"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">src</span>=<span class="string">"elva-fairy-800w.jpg"</span> <span class="attr">alt</span>=<span class="string">"Elva dressed as a fairy"</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>srcset</code> defines the set of images we will allow the browser to choose between, and what size each image is.</p><p>Before each comma, we write:</p><ul><li><p>An <strong>Image filename</strong> (elva-fair-320w.jpg)</p></li><li><p>A space</p></li><li><p>The imageâs inherit width in pixels(480w) â note that this issue the <code>w</code> unit, not <code>px</code> as you might expect.</p></li></ul><p><code>sizes</code> defines a set of media conditions(e.g. screen widths) and indicates what image size would be best to choose, when certain media conditions are true.</p><p>Before each comma, we write:</p><ul><li><p>A <strong>media condition</strong>(max-width: 480px) â when the viewport width is 480 px or less</p></li><li><p>A space</p></li><li><p>The <strong>width of the slot</strong> the image will fill when the media condition is true(440px)</p></li></ul><h3 id="Resolution-switching"><a href="#Resolution-switching" class="headerlink" title="Resolution switching"></a>Resolution switching</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span></span></span><br><span class="line"><span class="tag">  <span class="attr">srcset</span>=<span class="string">"elva-fairy-320w,jpg,</span></span></span><br><span class="line"><span class="tag"><span class="string">          elva-fairy-480w.jpg 1.5x,</span></span></span><br><span class="line"><span class="tag"><span class="string">          elva-fairy-640w.jpg 2x"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">src</span>=<span class="string">"elva-fairy-640w.jpg"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">alt</span>=<span class="string">"elva-fairy"</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> Html, Picture </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Simple Example of DAPP</title>
      <link href="/2017/09/13/Simple-Example-of-DAPP/"/>
      <content type="html"><![CDATA[<h3 id="Use-truffle-to-init-Project"><a href="#Use-truffle-to-init-Project" class="headerlink" title="Use truffle to init Project"></a>Use truffle to init Project</h3><h3 id="Contract-of-Adoption"><a href="#Contract-of-Adoption" class="headerlink" title="Contract of Adoption"></a>Contract of Adoption</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// contracts/Adoption.sol</span></span><br><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.4</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">constract Adoption &#123;</span><br><span class="line">    address[<span class="number">16</span>] public adopters;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">adopt</span> (<span class="params">uint petId</span>) <span class="title">public</span> <span class="title">returns</span> (<span class="params">uint</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">require</span>(petId &gt;= <span class="number">0</span> &amp;&amp; petId &lt;= <span class="number">15</span>);</span><br><span class="line">        adopters[petId] = msg.sender;</span><br><span class="line">        <span class="keyword">return</span> petId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getAdopters</span> (<span class="params"></span>) <span class="title">public</span> <span class="title">returns</span> (<span class="params">addresss[<span class="number">16</span>]</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> adopters;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Test"><a href="#Test" class="headerlink" title="Test"></a>Test</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// test/TestAdoption.sol</span></span><br><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.4</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"truffle/Assert.sol"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"truffle/DeployedAddress.sol"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"../contracts/Adoption.sol"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">contract TestAdoption &#123;</span><br><span class="line">  Adoption adoption = Adoption(DeployedAddress.Adoption());</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">testUserCanAdoptPet</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    uint returnedPetId = adoption.adopt(<span class="number">8</span>);</span><br><span class="line">    uint expected = <span class="number">8</span>;</span><br><span class="line">    Assert.equal(returenedPetId, expected, <span class="string">"Adoption of Pet Id 8 should be recorded"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">testGetAdopterAddressByPetId</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    address expected = <span class="keyword">this</span>;</span><br><span class="line">    address adopter = adoption.adopters(<span class="number">8</span>);</span><br><span class="line">    Assert.equal(adopter, expected, <span class="string">"Owner of Pet Id 8 should be recorded"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">testGetAdopterAddressByPetIdInArray</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    address expected = <span class="keyword">this</span>;</span><br><span class="line">    address[<span class="number">16</span>] memory adopters = adoption.getAdopters();</span><br><span class="line">    Assert(expected, adopters[<span class="number">8</span>], <span class="string">"Owner of Pet Id 8 should be recoreded"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Compile"><a href="#Compile" class="headerlink" title="Compile"></a>Compile</h3><h3 id="Migrate"><a href="#Migrate" class="headerlink" title="Migrate"></a>Migrate</h3><h3 id="TestRPC"><a href="#TestRPC" class="headerlink" title="TestRPC"></a>TestRPC</h3><h3 id="MetaMask"><a href="#MetaMask" class="headerlink" title="MetaMask"></a>MetaMask</h3><h3 id="UI"><a href="#UI" class="headerlink" title="UI"></a>UI</h3><h4 id="initWeb3"><a href="#initWeb3" class="headerlink" title="initWeb3"></a>initWeb3</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> web3 !== <span class="string">'undefined'</span>) &#123;</span><br><span class="line">  App.web3Provider = web3.currentProvider</span><br><span class="line">  web3 = <span class="keyword">new</span> Web3(App.web3Provider)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  App.web3Provider = <span class="keyword">new</span> web3.providers.HttpProvider(<span class="string">'http://localhost:8545'</span>)</span><br><span class="line">  web3 = <span class="keyword">new</span> Web3(App.web3Provider)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="initContract"><a href="#initContract" class="headerlink" title="initContract"></a>initContract</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$.<span class="built_in">JSON</span>(<span class="string">'Adoption.json'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> AdoptionArtifact = data</span><br><span class="line">  App.contracts.Adoption = TruffleContract(AdoptionArtifact)</span><br><span class="line">  App.contracts.Adoption.setProvider(App.web3Provider)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="Invoke-Contract"><a href="#Invoke-Contract" class="headerlink" title="Invoke Contract"></a>Invoke Contract</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> adoptionInstance</span><br><span class="line">App.contracts.Adoption.deployed()</span><br><span class="line">.then(<span class="function"><span class="keyword">function</span> (<span class="params">instance</span>) </span>&#123;</span><br><span class="line">  adoptionInstance = instance</span><br><span class="line">  <span class="keyword">return</span> adoptionInstance.getAdopters.call()</span><br><span class="line">&#125;)</span><br><span class="line">.then(<span class="function"><span class="keyword">function</span> (<span class="params">adopters</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> petId = <span class="number">8</span></span><br><span class="line"><span class="keyword">let</span> adoptionInstance</span><br><span class="line">web3.eth.getAccounts(<span class="function"><span class="keyword">function</span> (<span class="params">error, accounts</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (error) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(error.message)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> account = accounts[<span class="number">0</span>]</span><br><span class="line">  App.contracts.Adoption.deployed()</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span> (<span class="params">instance</span>) </span>&#123;</span><br><span class="line">    adoptionInstance = instance</span><br><span class="line">    <span class="keyword">return</span> adoptionInstance.adopt(petId, &#123; <span class="attr">from</span>: account &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> DAPP, Solidity </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Options of Webpack Dll Plugin</title>
      <link href="/2017/09/12/options-of-webpack-dll-plugin/"/>
      <content type="html"><![CDATA[<p>The <code>DllPlugin</code> and <code>DllReferencePlugin</code> provide means to split bundles in a way that can drastically improve build time performance.</p><h3 id="DllPlugin"><a href="#DllPlugin" class="headerlink" title="DllPlugin"></a>DllPlugin</h3><p>This plugin used in a separate webpack config exclusively to create a <code>dll-only-bundle</code>.</p><p>It creates a <code>manifest.json</code> file, which is used by the <code>DllReferencePlugin</code> to map dependencies.</p><ul><li><p><code>context</code>: (optional), context of requests in the manifest file(default to the webpack context).</p></li><li><p><code>name</code>: name of the exposed dll function(<code>TemplatePaths</code>: <code>[hash]</code> &amp; <code>[name]</code>)</p></li><li><p><code>path</code>: <strong>absolute path</strong> to the manifest json file(output)</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.DllPlugin(option)</span><br></pre></td></tr></table></figure><p>Creates a <code>manifest.json</code> which is written to the given <strong>absolute</strong> <code>path</code>.</p><p>It contains <strong>mappings</strong> from require and import requests, to module ids. It is used by the <code>DllReferencePlugin</code>.</p><p><strong>Combine this plugin with <code>output.library</code> option to expose(aka, put into the global scope) the dll function</strong></p><blockquote><p>output.library expose the name to global scope</p></blockquote><blockquote><p>DllReferencePlugin.name add the name to the mapping file.</p></blockquote><p>So itâs important to keep <code>output.library</code> and <code>DllReferencePlugin.name</code> same to set a right mapping.</p><h3 id="DllReferencePlugin"><a href="#DllReferencePlugin" class="headerlink" title="DllReferencePlugin"></a>DllReferencePlugin</h3><p>This plugin is used in the primary webpack config, it references the <strong>dll-only-bundle</strong> to require the pre-built dependencies.</p><ul><li><p><code>context</code>: <strong>absolute path</strong>, context of the requests in the manifest(or content property)</p></li><li><p><code>manifest</code>: an object containing <code>content</code> and <code>name</code> or a string to the <strong>absolute path</strong> of the JSON manifest to be loaded upon compilation.</p></li><li><p><code>content</code>: (optional), the mappings from request to module id(default to <code>manifest.content</code>)</p></li><li><p><code>name</code>: (optional), the name where the dll is exposed (default to <code>manifest.name</code>)</p></li><li><p><code>scope</code>: (optional), prefix which is used for accessing the content of the dll</p></li><li><p><code>sourceType</code>: (optional), how the dll is exposed.</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.DllReferencePlugin(options)</span><br></pre></td></tr></table></figure><p>References a dll manifest file to map dependencies names to module ids, then requires them as needed using the internal <code>__webpack_require__</code> function.</p><blockquote><p>Note: Keep the <code>name</code> consistent with <code>output.library</code></p></blockquote><h3 id="Modes"><a href="#Modes" class="headerlink" title="Modes"></a>Modes</h3><p>This plugin can be used in two different modes, <em>scoped</em> and <em>mapped</em>.</p><h4 id="Scoped-Mode"><a href="#Scoped-Mode" class="headerlink" title="Scoped Mode"></a>Scoped Mode</h4><p>The content of the dll is accessible under a module prefix, i.e. with <code>scope = &#39;xyz&#39;</code> a file named <code>abc</code> in the dll can be access via <code>require(xyz/abc)</code>.</p><h4 id="Mapped-Mode"><a href="#Mapped-Mode" class="headerlink" title="Mapped Mode"></a>Mapped Mode</h4><p>The content of the dll is mapped to the current directory. If a required file matches a file in the dll(after resolving), then the file from the dll is usd instead.</p><p>Because this happens after resolving every file in the dll bundle, the same paths must be available for the consumer of the dll bundle, i.e. if the dll contains <code>lodash</code> and the file <code>abc</code>, <code>require(&#39;lodash&#39;)</code> and <code>require(&#39;./abc&#39;)</code> will be used from the dll, rather than building them into the main bundle.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.dll.js</span></span><br><span class="line"><span class="keyword">new</span> webpack.DllPlugin(&#123;</span><br><span class="line">  context: __dirname,</span><br><span class="line">  name: <span class="string">'[name]_[hash]'</span>,</span><br><span class="line">  path: path.join(__dirname<span class="string">', '</span>manifest.json<span class="string">'),</span></span><br><span class="line"><span class="string">&#125;)</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.base.js</span></span><br><span class="line"><span class="keyword">new</span> webpack.DllReferencePlugin(&#123;</span><br><span class="line">  context: __dirname,</span><br><span class="line">  manifest: <span class="built_in">require</span>(<span class="string">'./manifest.json'</span>),</span><br><span class="line">  name: <span class="string">'./my-dll.js'</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Notes"><a href="#Notes" class="headerlink" title="Notes"></a>Notes</h3><h4 id="Output-library-and-DllPlugin-name"><a href="#Output-library-and-DllPlugin-name" class="headerlink" title="Output.library and DllPlugin.name"></a>Output.library and DllPlugin.name</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'lib'</span>),</span><br><span class="line">    filename: <span class="string">'[name]_[hash].js'</span>,</span><br><span class="line">    library: <span class="string">'[name]_[hash]'</span>, <span class="comment">// this set the exposed function name to [name]_[hash]</span></span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> webpack.DllPlugin(&#123;</span><br><span class="line">      path: path.resolve(__dirname, <span class="string">'lib'</span>, <span class="string">'[name]-manifest.json'</span>), <span class="comment">// put the manifest file in lib directory</span></span><br><span class="line">      name: <span class="string">'[name]_[hash]'</span>, <span class="comment">// be consistent with library name to make the map correct</span></span><br><span class="line">      context: __dirname,</span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Context-in-Dev-Config"><a href="#Context-in-Dev-Config" class="headerlink" title="Context in Dev Config"></a>Context in Dev Config</h4><p>Set the DllReferencePlugin.context same as DllPlugin.context so the manifest will bundle and resolve the dll files from the same root directory.</p><h4 id="Add-dll-bundle-to-html"><a href="#Add-dll-bundle-to-html" class="headerlink" title="Add dll bundle to html"></a>Add dll bundle to html</h4><p>After bundle the dll, I should insert it betore app.js in the html file to provide the <strong>global</strong> function.</p><ul><li>Step 1: Copy the dll files to the dist directory</li></ul><p>I use the <code>copy-webpack-plugin</code> plugin</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">new</span> CopyPlugin([</span><br><span class="line">  &#123; <span class="keyword">from</span> <span class="string">'./lib/*.js'</span> &#125; <span class="comment">// default to output.path, so the dll file will be copied to output.path/lib/*.js</span></span><br><span class="line">])</span><br></pre></td></tr></table></figure><ul><li>Generate a manifest of the dll files for html-webpack-plugin to insert to the template</li></ul><p>I use the <code>webpack-manifest-plugin</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.dll.js</span></span><br><span class="line"><span class="keyword">new</span> ManifestPlugin()</span><br></pre></td></tr></table></figure><p>It will generate the <code>manifest.json</code> in output.path</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"vendor.js"</span>: <span class="string">"vendor_0642aa84a6959d661519.js"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Insert the Manifest into the html</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//parse the json</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs)</span></span><br><span class="line"><span class="string">const manifest = JSON.parse(fs.readFileSync(require('</span>./lib/manifest.json<span class="string">')))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// insert</span></span><br><span class="line"><span class="string">new HtmlPlugin(&#123;</span></span><br><span class="line"><span class="string">  //...</span></span><br><span class="line"><span class="string">  dll: `./lib/$&#123;manifest['</span>vendor.js<span class="string">']&#125;`, // the dll file locates at ./lib/*.js</span></span><br><span class="line"><span class="string">&#125;)</span></span><br></pre></td></tr></table></figure><h3 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h3><h3 id="Dll-Config"><a href="#Dll-Config" class="headerlink" title="Dll Config"></a>Dll Config</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> ManifestPlugin = <span class="built_in">require</span>(<span class="string">'webpack-manifest-plugin'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    vendor: [<span class="string">'./src/vendor'</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">'[name]_[hash].js'</span>,</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'lib'</span>),</span><br><span class="line">    library: <span class="string">'[name]_[hash]'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> webpack.DllPlugin(&#123;</span><br><span class="line">      name: <span class="string">'[name]_[hash]'</span>,</span><br><span class="line">      path: path.resolve(__dirname, <span class="string">'lib'</span>, <span class="string">'[name]-manifest.json'</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> ManifestPlugin(),</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Dev-Config"><a href="#Dev-Config" class="headerlink" title="Dev Config"></a>Dev Config</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> CopyPlugin = <span class="built_in">require</span>(<span class="string">'copy-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> manifest = <span class="built_in">JSON</span>.parse(fs.readFileSync(<span class="string">'./lib/manifest.json'</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    app: [<span class="string">'./src/index'</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">'scripts/[name].bundle.js'</span>,</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> HtmlPlugin(&#123;</span><br><span class="line">      template: path.resolve(__dirname, <span class="string">'src'</span>, <span class="string">'templates'</span>, <span class="string">'index.html'</span>),</span><br><span class="line">      title: <span class="string">'dev'</span>,</span><br><span class="line">      dll: <span class="string">`./lib/<span class="subst">$&#123;manifest[<span class="string">'vendor.js'</span>]&#125;</span>`</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> webpack.DllReferencePlugin(&#123;</span><br><span class="line">      context: <span class="string">'.'</span>,</span><br><span class="line">      manifest: <span class="built_in">require</span>(<span class="string">'./lib/vendor-manifest'</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> CopyPlugin([</span><br><span class="line">      &#123; <span class="attr">from</span>: <span class="string">'./lib/*.js'</span>&#125;</span><br><span class="line">    ]),</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> Webpack, DLL </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Optimize Web App</title>
      <link href="/2017/09/07/optimize-web-app/"/>
      <content type="html"><![CDATA[<h3 id="Optimizing-All-Assets"><a href="#Optimizing-All-Assets" class="headerlink" title="Optimizing All Assets"></a>Optimizing All Assets</h3><p>One of the most powerful, but under-utilized ways to significantly improve performance starts with understanding hwo the browser analyzes and serves assets. It turns out that browsers are pretty great at discovering resources while parsing and determing their priority of the fly. Hereâs where the <strong>critical Request</strong> comes in:</p><blockquote><p>A request is critical if it contains assets that are necessary to render the content within the usersâ viewport.</p></blockquote><p>For most sites, itâd be HTML, necessary CSS, a logo, a web font and maybe an image.</p><p>We can control this behavior by carefully picking critical resources and adjusting theri priority.</p><h4 id="preload"><a href="#preload" class="headerlink" title="preload"></a>preload</h4><p>With <code>&lt;link red=&#39;preload&#39;&gt;</code> we are <strong>able to manually force assetsâ priority to <code>High</code> ensuring that desired content will be rendered on time</strong>.</p><p>This technique can yield significant improvements in Time to Interactive metric, making optimal user experience possible.</p><p><img src="https://cdn-images-1.medium.com/max/800/1*JT-53LslhwOOqTgv1dGoXg.png" alt=""></p><p>Critical requests still seem like a black box for many, and the lack of sharable materials doesnât help to change that.jj</p><h3 id="Optimizing-Images"><a href="#Optimizing-Images" class="headerlink" title="Optimizing Images"></a>Optimizing Images</h3><p>Images often account for most of a web pageâs transferred payload.</p><h4 id="Choosing-the-right-format"><a href="#Choosing-the-right-format" class="headerlink" title="Choosing the right format"></a>Choosing the right format</h4><p>The initial choice falls between vector and raster graphics:</p><ul><li><p><strong>Vector</strong>: resolution independent, usually significantly smaller in size. Perfect for logos, iconography and simple assets comprising of basic shapes.</p></li><li><p><strong>Raster</strong>: offers much more detailed results, ideal for photographs.</p></li></ul><p>After making this decision, there are a fair bit of formats to choose from: <code>JPEG</code>, <code>GIF</code>, <code>PNG-8</code>, <code>PNG-24</code> or newest formats such as <code>WEBP</code> or <code>JPEG-XR</code>, <code>JPEG-2000</code>.</p><ul><li><p><strong>JPEG</strong>: Imagery with many color(e.g. photos)</p></li><li><p><strong>PNG-8</strong>: Imagery with a few color</p></li><li><p><strong>PNG-24</strong>: Imagery with partial transparency</p></li><li><p><strong>GIF</strong>: Animated imagery</p></li></ul><h3 id="Experimenting-with-new-formats"><a href="#Experimenting-with-new-formats" class="headerlink" title="Experimenting with new formats"></a>Experimenting with new formats</h3><p><strong>WebP</strong> is easily the most popular contender, supporting both lossless and lossy compression, which makes it incredibly versatile. <strong>Lossless WebP is 26% smaller than PNGs and 25-34% smaller than JPGs</strong>. With 74% browser support it can safely be used with fallback. JPGs and PNGs can be converted to WebP in PS and other image processing app as well as through command line interface(<code>brew install webp</code>).</p><h3 id="Responsible-and-responsive-Imagery"><a href="#Responsible-and-responsive-Imagery" class="headerlink" title="Responsible and responsive Imagery"></a>Responsible and responsive Imagery</h3><p>Wâre perfectly equipped to do so with <code>picture</code> element and <code>srcset</code> attribute(both have 85% support)</p><h4 id="The-srcset-attribute"><a href="#The-srcset-attribute" class="headerlink" title="The srcset attribute"></a>The srcset attribute</h4><p><code>srcset</code> works best in the resolution switching scenario â when we want to display imagery based on userâs screen density and size. Baseed on a set of predefined rules in <code>srcset</code> and <code>size</code> attributes the browser will pick the best image to serve accordingly to the viewport.</p><p><img src="https://cdn-images-1.medium.com/max/800/1*87BIfYsjZTh-bikjmp7eow.png" alt=""></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span></span></span><br><span class="line"><span class="tag">  <span class="attr">srcset</span>=<span class="string">"cat-320w.jpg 320w cat-480w.jpg 480w cat-800w.jpg 800w"</span>,</span></span><br><span class="line"><span class="tag">  <span class="attr">sizes</span>=<span class="string">"(max-width: 320px) 100vw, (max-width: 480px) 80vw, 800px"</span>,</span></span><br><span class="line"><span class="tag">  <span class="attr">src</span>=<span class="string">"cat-800w.jpg"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">alt</span>=<span class="string">"cat"</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></table></figure><h4 id="The-picture-element"><a href="#The-picture-element" class="headerlink" title="The picture element"></a>The picture element</h4><p><code>picture</code> element and the <code>media</code> attribute are designed to make art direction easy. BY providing different sources for varying conditions.</p><p><img src="https://cdn-images-1.medium.com/max/800/1*NeyfH6Vu1xCWE2SY5w1cDQ.png" alt=""></p><h4 id="Delivery-with-image-CNDs"><a href="#Delivery-with-image-CNDs" class="headerlink" title="Delivery with image CNDs"></a>Delivery with image CNDs</h4><h3 id="Optimizing-Web-Fonts"><a href="#Optimizing-Web-Fonts" class="headerlink" title="Optimizing Web Fonts"></a>Optimizing Web Fonts</h3><h4 id="Choose-the-right-format"><a href="#Choose-the-right-format" class="headerlink" title="Choose the right format"></a>Choose the right format</h4><p>There are four web font formats: <code>EOT</code>, <code>TTF</code>, <code>WOFF</code> and <code>WOFF2</code>.</p><p>TTF and WOFF are most widely adopted, boasting over 90% browser support. Depending on the support youâre targeting <strong>itâs most likely safe to server WOFF2</strong> and fall back to WOFF for older browsers. The advantage of using WOFF2 is a set of custom preprocessing and compression algorithms resulting in approx 30% file-size reduction and impoved parsing capabilities.</p><p>When defining the sources of web fonts in <code>@font-face</code> use the <code>format()</code> hint to specify which format should be utilized.</p><h4 id="use-Unicode-range-subsetting"><a href="#use-Unicode-range-subsetting" class="headerlink" title="use Unicode-range subsetting"></a>use Unicode-range subsetting</h4><h4 id="Establish-a-font-loading-strategy"><a href="#Establish-a-font-loading-strategy" class="headerlink" title="Establish a font loading strategy"></a>Establish a font loading strategy</h4><p>Fonts are render-blocking â because the browser has to build both the DOM and CSSOM first. Wdb fonts wonât be downloaded before theyâre used in a CSS selector that matches an existing node. This behavior significantly delays text rendering, often causing the <strong>Flash of Invisible Text</strong>(FOIT).</p><p>Implementing a font strategy prevents users from not being able to access your content.</p><p><code>font-display</code> is a new CSS property providing a non-javascript reliant solution.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@font-face &#123;</span><br><span class="line">  font-family: Post Grotesk;</span><br><span class="line">  src: url(<span class="string">'/fonts/Post-Growtest.woff2'</span>) format(<span class="string">'woff2'</span>),</span><br><span class="line">       url(<span class="string">'/fonts/Post-Growtest.woff'</span> format(<span class="string">'woff'</span>)),</span><br><span class="line">  font-display: swap; <span class="comment">// show fallback until web font is ready</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Optmizing-JS"><a href="#Optmizing-JS" class="headerlink" title="Optmizing JS"></a>Optmizing JS</h3>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Concept on BlockChain</title>
      <link href="/2017/09/07/Concept-on-BlockChain/"/>
      <content type="html"><![CDATA[<p>A Blockchain is</p><blockquote><p>A distributed database that is used to maintain a continuously growing list of records, called block.</p></blockquote><p>A Block contains following information:</p><ul><li><p>Index(Block #) - Which block is it? (Genesis block has index 0)</p></li><li><p>Hash: Is the block valid?</p></li><li><p>Previous Hash: It the previous block valid?</p></li><li><p>Timestamp: When was the block added?</p></li><li><p>Data: What information is stored on the block?</p></li><li><p>Nonce: How many iterations did we go through before we found a valid block?</p></li></ul><h3 id="Genesis-Block"><a href="#Genesis-Block" class="headerlink" title="Genesis Block"></a>Genesis Block</h3><p>Every Blockchain will st art with the <code>Genesis Block</code>, each block on the blockchain is dependent on the previous block, so the Genesis Block is needed to mine our first block.</p><h3 id="Hash"><a href="#Hash" class="headerlink" title="Hash"></a>Hash</h3><p>A <strong>hash value</strong> is a numeric value of a fixed length that uniquely identifies data.</p><p>The hash is calculated by taking the <strong>index</strong>, <strong>previous block hash</strong>, <strong>timestamp</strong>, <strong>block data</strong>, and <strong>nonce</strong> as input.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CryptoJS.SHA256(index + previousHash + timestamp + data + nonce)</span><br></pre></td></tr></table></figure><h3 id="Leading-0-in-the-block-hash"><a href="#Leading-0-in-the-block-hash" class="headerlink" title="Leading 0 in the block hash"></a>Leading 0 in the block hash</h3><p>Specified leading 0 is a minimum requirement for a valid hash. The number of leading 0 required is called <strong>difficulty</strong>.</p><p>The is also known as the <strong>Proof-of-Work</strong> system.</p><h3 id="Nonce"><a href="#Nonce" class="headerlink" title="Nonce"></a>Nonce</h3><p>A nonce is a number used to find a valid hash</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> nonce = <span class="number">0</span></span><br><span class="line"><span class="keyword">let</span> hash</span><br><span class="line"><span class="keyword">let</span> input</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (!isValidHashDifficulty(hash)) &#123;</span><br><span class="line">  nonce += <span class="number">1</span></span><br><span class="line">  input = index + previousHash + timeStamp + data + nonce</span><br><span class="line">  hash = CryptoJS.SHA256(input)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The nocne iterates until the hash is valid.</p><p>The process of finding a nonce that corresponds to a valid hash is <strong>mining</strong>.</p><p>As the difficulty <strong>increase</strong>, the number of possible valid hashes <strong>decrese</strong>. With less possible valid hashes, it takes more processing power to find a valid hash.</p><h3 id="Ethereum-Virtual-Machine-EVM"><a href="#Ethereum-Virtual-Machine-EVM" class="headerlink" title="Ethereum Virtual Machine (EVM)"></a>Ethereum Virtual Machine (EVM)</h3><p>The Ethereum Virtual Machine or EVM is the runtime environment for smart contracts in Ethereum. It is not only sandboxed but actually completely isolated, which means that code running inside the EVM has no access to network, filesystem or other processes. Smart contract even have limited access to other smart contracts.</p><h4 id="Accounts"><a href="#Accounts" class="headerlink" title="Accounts"></a>Accounts</h4><p>There are two kinds of accounts in Ethereum which share the same address space:</p><ul><li><p><code>External Account</code> that are controlled by public-private key pairs(i.e. humans)</p></li><li><p><code>Contract Account</code> that are controlled by the code stored together with accounts</p></li></ul><p>The address of an external account is determined from the public key while the address of a contract is determined at the time the contract is created(it is derived from the creator address and the number of transactions sent from the address, the so-called ânonceâ).</p><p>Every account has a <strong>persistent key-value store mapping 256-bit words to 256-bit words</strong> called <strong>storage</strong>.</p><p>Every account has a <strong>balance</strong> in Ether(in <em>Wei</em> to be exact) which can be modified by sending transactions that include Ether.</p><h4 id="transactions"><a href="#transactions" class="headerlink" title="transactions"></a>transactions</h4><p>A transaction is a message that is sent from one account to another account(which might be the same or the special <strong>zero-account</strong>). It can include binary data(its payload) and Ether.</p><p>If the target account contains code, that code is executed and the payload is provided as input data.</p><p>If the target account is the <em>zero-account</em>(the account with the address 0), the transaction creates a <strong>new contract</strong>.</p><p>As memtioned, the address of that contract is not the zero address but an address derived from the sender and its number of transactions sent(nonce). <strong>The payload of such a contract creation transaction is taken to be EVM bytecode and executed to generate the new contract</strong></p><p>The output of the bytecode, namely the new contract, is permenantly stored.</p><h4 id="Gas"><a href="#Gas" class="headerlink" title="Gas"></a>Gas</h4><p>Each transaction is charged with a certain with a certain amount of <strong>gas</strong>, whose purpose is to limit the amount of work that is needed to executed the transaction and to pay for this execution.</p><p>While the EVM executes the transaction, the gas is gradually depleted according to specific rules.</p><p>The <code>gas price</code> is a value set by the creator of the transaction, who has to pay <code>gas_price * gas</code>.</p><h4 id="Storage-Memory-and-the-Stack"><a href="#Storage-Memory-and-the-Stack" class="headerlink" title="Storage, Memory and the Stack"></a>Storage, Memory and the Stack</h4><p>Each account has a persistent memory area which is called <strong>storage</strong>. Storage is a <strong>key-value</strong> store taht maps 256-bit word to 256-bit word.</p><p>The second memory area is called <strong>memory</strong>, of which a contract obtains a freshly cleared instance for each message call. Memory is linear and can be addressed at byte level, but reads are limited to a width of 256 bits, white writes can be either 8btis or 256bits wide.</p><p>Memory is expanded by a word(256-bit), when accessing (either reading or writing) a previously untouched memory word. At the time of expansion, the cost in gas must be paid. Memory is more costly the larger it grows(it scales quadratically).</p><p>The EVM is not a register machine but a stack machine, so all computations are performed on an area called the <strong>stack</strong>. It has limited to the top end in the following way:</p><ul><li><p>it is possible to copy one of the topmost 16 elements to the top of the stack or swap the topmost 2(or 1, or more, depending on the opeartion) element fomr the stack and push the result onto the stack.</p></li><li><p>All other operation take the topmost 2(or 1, or more, depending on the operation) elements from the stack and push the result onto the stack.</p></li><li><p>It is possible to move stack elements to storage or memory</p></li><li><p>It is not possible to just access arbitrary elements deeper in the stack without removing the top of the stack.</p></li></ul><h3 id="Instruction-Set"><a href="#Instruction-Set" class="headerlink" title="Instruction Set"></a>Instruction Set</h3><p>The instruction set of the EVM is kept minimal in order to avoid incorrect implementations which could cuase consensus problem. All instructions operate ont he basic data type, 256-bit words.</p><p>The usual arihmetic bit, logical and comparison operations are present. Conditional and unconditional jumps are possible. Furthermore, contracts can access relevant properties of the current block like its number and timestamp.</p><h3 id="Message-Calls"><a href="#Message-Calls" class="headerlink" title="Message Calls"></a>Message Calls</h3><p>Contracts can call other contracts or send Ether to non-contract accounts by the means of the message calls.</p><p>Message calls are similar to transactions, in that tehy have a <strong>source</strong>, a <strong>target</strong>, <strong>data payload</strong>, <strong>Ether</strong>, <strong>gas</strong>, and return <strong>data</strong>.</p><p>In fact, every transaction consists of a top-level message call which in turn can create further message calls.</p><p>A contract can decide how much of its remaining <strong>gas</strong> should be sent with the inner message call and how much it wants to retain. If an out-of-gas exception happens in the inner call(or any other exception), this will be signalled by an error value put onto the stack. In this case, only the gas sent together with the call is used up.</p><p>Summarily, a called contract(which can be the same as caller) will receive a <strong>freshly cleared instance of memoery</strong>, and has access to the call payload - which will be provided in a separate area called the <strong>calldata</strong>. After it has finished execution, it can return data which will be stored at a location in the callerâs memory preallocated by the caller.</p><p>Calls are limited to depth of 1024, which means that for more complex operations, loops should be preferred over recursive calls.</p><h3 id="Delegatecall-Callcode-and-Libraries"><a href="#Delegatecall-Callcode-and-Libraries" class="headerlink" title="Delegatecall / Callcode and Libraries"></a>Delegatecall / Callcode and Libraries</h3><p>There exists a special variant of a message call, named <strong>delegatecall</strong> which is identical to a message call apart from the fact taht the code at the target address is executed in the context of the calling contract and <code>msg.sender</code> and <code>msg.value</code> do not change their values.</p><p>This means that a contract can dynamically load code from a different address at runtime. Storage, current address and balance still refer to the calling contract, only the code is taken from teh called address.</p><p>This makes it possible to implement the âlibraryâ feature in Solidity: Reusable library code that can be applied to a contractâs storage to implement a complex data structure.</p><h3 id="Logs"><a href="#Logs" class="headerlink" title="Logs"></a>Logs</h3><p>It is possible to store data in a special indexed data structure that maps all the way up to the block level. This feature called <strong>logs</strong> is used by Solidity in order to implement <strong>events</strong>. Contracts cannot access log data after it has been created, but they can efficiently accessed from outside the blockchain.</p><p>Since some part of the log data is stored in bloom filters, it is possible to search for this data in an efficient and crypographically secure way, so network peers that do not download the whole blockchain(âlight clientsâ) can still find these logs.</p><h3 id="Create"><a href="#Create" class="headerlink" title="Create"></a>Create</h3><p>Contracts can even create other contract s using a special opcode. The only difference between <strong>create calls</strong> and normal message calls is that the payload data is executed and the result stored as code and the caller/creator receives the address of the new contract on the stack.</p><h3 id="Self-destruct"><a href="#Self-destruct" class="headerlink" title="Self-destruct"></a>Self-destruct</h3><p>The only possible that code is removed from the blockchain is when a contract at that address performs the <code>selfdestruct</code> operation. The remaining Ether stored at that address is sent to a designed target and then the storage and code is removed from the state.</p><blockquote><p>Even if a contractâs code does not contain a call to <code>selfdestruct</code>, it can still perform that operation using <code>delegatecall</code> or <code>callcode</code>.</p></blockquote>]]></content>
      
      
        <tags>
            
            <tag> BlockChain </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Build Node CLI</title>
      <link href="/2017/09/06/Build-Node-CLI/"/>
      <content type="html"><![CDATA[<h3 id="Dependencies"><a href="#Dependencies" class="headerlink" title="Dependencies"></a>Dependencies</h3><ul><li><p>chalk: colorize the output</p></li><li><p>clear: clears the terminal screen</p></li><li><p>clui: draws command line tables, gauges and spinners</p></li><li><p>figlet: creates ASCII art from text</p></li><li><p>inquirer - create interactive command line user interface</p></li><li><p>minimist - parses argument options</p></li><li><p>preferences - manage CLI application encrypted preferences</p></li></ul><h4 id="chalk"><a href="#chalk" class="headerlink" title="chalk"></a>chalk</h4><ul><li><p><code>chalk.&lt;style&gt;[.&lt;style&gt;...](string, [string...])</code></p><p>  chalk.red.bold.underline(âHelloâ, âWorldâ)</p></li><li><p>chalk`string {&lt;style&gt; &lt;style&gt;â¦ string} string`</p><p>  chalk`There are { bold 5280 feet } in a mile `</p></li></ul><h4 id="clear"><a href="#clear" class="headerlink" title="clear"></a>clear</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> clear = <span class="built_in">require</span>(<span class="string">'clear'</span>)</span><br><span class="line">clear()</span><br></pre></td></tr></table></figure><h4 id="clui"><a href="#clui" class="headerlink" title="clui"></a>clui</h4><p>Display</p><ul><li><p>Gauge</p></li><li><p>PrograssBar</p></li><li><p>Sparklines</p></li><li><p>Spinners</p></li></ul><p>on Terminal</p><h4 id="figlet"><a href="#figlet" class="headerlink" title="figlet"></a>figlet</h4><p>Display ASCII font on Terminal</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">figlet.text(<span class="string">'Boo'</span>, &#123;</span><br><span class="line">  font: <span class="string">'Ghost'</span>,</span><br><span class="line">  horizontalLayout: <span class="string">'default'</span>,</span><br><span class="line">  verticalLayout: <span class="string">'default'</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="built_in">console</span>.log(err)</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">figlet.textSync(<span class="string">'Boo'</span>, &#123;</span><br><span class="line">  font: <span class="string">'Ghost'</span>,</span><br><span class="line">  horizontalLayout: <span class="string">'default'</span>,</span><br><span class="line">  verticalLayout: <span class="string">'default'</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="inquirer"><a href="#inquirer" class="headerlink" title="inquirer"></a>inquirer</h4><p>A collection of common interactive command line user interface.</p><ul><li><p><code>inquirer.prompt(questions) =&gt; promise</code></p><ul><li><p><code>questions</code> an Array containing <code>Question Object</code>(using the reactive interface, you can also pass a Rx.observable instance)</p><ul><li><code>Question Object</code>:</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//   type: string, //['input', 'confirm', 'list', 'rawlist', 'expand', 'checkbox', 'password', 'editor']</span></span><br><span class="line"><span class="comment">//   name: string, // the name to use when storeing the answer in the answer hash</span></span><br><span class="line"><span class="comment">//   message: string|function,  // The question to print, if defined as a function, the first parameter will be the current inquirer session answer</span></span><br><span class="line"><span class="comment">//   default: string|number|array|function, // default value to use</span></span><br><span class="line"><span class="comment">//   choices: array|function,</span></span><br><span class="line"><span class="comment">//   validate: function, // receive the user input and answers hash, should return true if the value is valid, and an error message(string) otherwise. If a false is returned, a default error message is provided.</span></span><br><span class="line"><span class="comment">//   filter: function, //</span></span><br><span class="line"><span class="comment">//   when: function|boolean, //</span></span><br><span class="line"><span class="comment">//   pageSize: number, //</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure></li></ul></li></ul><h4 id="minimist"><a href="#minimist" class="headerlink" title="minimist"></a>minimist</h4><h4 id="preferences"><a href="#preferences" class="headerlink" title="preferences"></a>preferences</h4><h3 id="Make-CLI-globally-available"><a href="#Make-CLI-globally-available" class="headerlink" title="Make CLI globally available"></a>Make CLI globally available</h3><p>Add a shebang line to the top of <code>index.js</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env node</span></span><br></pre></td></tr></table></figure><p>Then add a <code>bin</code> prototype to <code>package.json</code>.</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">"bin": &#123;</span><br><span class="line">  "cli-init": "./index.js"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> Node, CLI </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Build a Node Command Line Interface</title>
      <link href="/2017/09/05/Build-a-Node-Command-Line-Interface/"/>
      <content type="html"><![CDATA[]]></content>
      
      
        <tags>
            
            <tag> Node, CLI </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Start Up With Ts, React, Router, Redux, Rxjs</title>
      <link href="/2017/09/05/start-up-with-ts-react-router-redux-rxjs/"/>
      <content type="html"><![CDATA[<p>The <a href="https://github.com/Keith-CY/starter-of-react-redux-router-rxjs.git" target="_blank" rel="noopener">Repo</a></p><h3 id="Dependencies"><a href="#Dependencies" class="headerlink" title="Dependencies"></a>Dependencies</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">"devDependencies": &#123;</span><br><span class="line">  "@types/react": "^16.0.5",</span><br><span class="line">  "@types/react-dom": "^15.5.4",</span><br><span class="line">  "@types/react-redux": "^5.0.6",</span><br><span class="line">  "@types/redux-actions": "^1.2.8",</span><br><span class="line">  "@types/webpack": "^3.0.10",</span><br><span class="line">  "@types/webpack-dev-server": "^2.4.1",</span><br><span class="line">  "autoprefixer": "^7.1.3",</span><br><span class="line">  "babel-core": "^6.26.0",</span><br><span class="line">  "babel-loader": "^7.1.2",</span><br><span class="line">  "babel-preset-env": "^1.6.0",</span><br><span class="line">  "babel-preset-react": "^6.24.1",</span><br><span class="line">  "bundle-loader": "^0.5.5",</span><br><span class="line">  "eslint": "^4.6.1",</span><br><span class="line">  "eslint-config-airbnb": "^15.1.0",</span><br><span class="line">  "eslint-plugin-import": "^2.7.0",</span><br><span class="line">  "eslint-plugin-jsx-a11y": "^6.0.2",</span><br><span class="line">  "eslint-plugin-react": "^7.3.0",</span><br><span class="line">  "html-webpack-plugin": "^2.30.1",</span><br><span class="line">  "node-sass": "^4.5.3",</span><br><span class="line">  "precss": "^2.0.0",</span><br><span class="line">  "redux-devtools": "^3.4.0",</span><br><span class="line">  "redux-devtools-dock-monitor": "^1.1.2",</span><br><span class="line">  "redux-devtools-log-monitor": "^1.3.0",</span><br><span class="line">  "rimraf": "^2.6.1",</span><br><span class="line">  "sass-loader": "^6.0.6",</span><br><span class="line">  "ts-loader": "^2.3.4",</span><br><span class="line">  "typescript": "next",</span><br><span class="line">  "uglifyjs-webpack-plugin": "^0.4.6",</span><br><span class="line">  "webpack": "^3.5.5",</span><br><span class="line">  "webpack-dashboard": "^1.0.0-5",</span><br><span class="line">  "webpack-dev-server": "^2.7.1",</span><br><span class="line">  "webpack-merge": "^4.1.0"</span><br><span class="line">&#125;,</span><br><span class="line">"dependencies": &#123;</span><br><span class="line">  "@types/node": "^8.0.26",</span><br><span class="line">  "@types/react-router-dom": "^4.0.7",</span><br><span class="line">  "babel-plugin-transform-runtime": "^6.23.0",</span><br><span class="line">  "extract-text-webpack-plugin": "^3.0.0",</span><br><span class="line">  "react": "^15.6.1",</span><br><span class="line">  "react-dom": "^15.6.1",</span><br><span class="line">  "react-redux": "^5.0.6",</span><br><span class="line">  "react-router": "^4.2.0",</span><br><span class="line">  "react-router-dom": "^4.2.2",</span><br><span class="line">  "redux": "^3.7.2",</span><br><span class="line">  "redux-actions": "^2.2.1",</span><br><span class="line">  "redux-observable": "^0.16.0",</span><br><span class="line">  "rxjs": "^5.4.3"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Project-Structure"><a href="#Project-Structure" class="headerlink" title="Project Structure"></a>Project Structure</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">âââ config</span><br><span class="line">âÂ Â  âââ webpack.config.base.js</span><br><span class="line">âÂ Â  âââ webpack.config.dev.js</span><br><span class="line">âÂ Â  âââ webpack.config.prod.js</span><br><span class="line">âââ src</span><br><span class="line">âÂ Â  âââ actions</span><br><span class="line">âÂ Â  âÂ Â  âââ index.tsx</span><br><span class="line">âÂ Â  âÂ Â  âââ hello.tsx</span><br><span class="line">âÂ Â  âââ components</span><br><span class="line">âÂ Â  âÂ Â  âââ AsyncRoute.tsx</span><br><span class="line">âÂ Â  âââ containers</span><br><span class="line">âÂ Â  âÂ Â  âââ App.tsx</span><br><span class="line">âÂ Â  âÂ Â  âââ Header.tsx</span><br><span class="line">âÂ Â  âÂ Â  âââ Body.jsx</span><br><span class="line">âÂ Â  âÂ Â  âââ Footer.tsx</span><br><span class="line">âÂ Â  âÂ Â  âââ Index.tsx</span><br><span class="line">âÂ Â  âÂ Â  âââ Page2.tsx</span><br><span class="line">âÂ Â  âÂ Â  âââ DevTools.tsx</span><br><span class="line">âÂ Â  âââ epics</span><br><span class="line">âÂ Â  âÂ Â  âââ index.tsx</span><br><span class="line">âÂ Â  âÂ Â  âââ hello.tsx</span><br><span class="line">âÂ Â  âââ reducers</span><br><span class="line">âÂ Â  âÂ Â  âââ index.tsx</span><br><span class="line">âÂ Â  âÂ Â  âââ hello.tsx</span><br><span class="line">âÂ Â  âââ store</span><br><span class="line">âÂ Â  âÂ Â  âââ index.tsx</span><br><span class="line">âÂ Â  âÂ Â  âââ configureStore.dev.tsx</span><br><span class="line">âÂ Â  âÂ Â  âââ configureStore.prod.tsx</span><br><span class="line">âÂ Â  âââ templates</span><br><span class="line">âÂ Â  âÂ Â  âââ index.html</span><br><span class="line">âÂ Â  âââ utils</span><br><span class="line">âÂ Â  âÂ Â  âââ connect.tsx</span><br><span class="line">âÂ Â  âÂ Â  âââ nav.tsx</span><br><span class="line">âÂ Â  âââ app.tsx</span><br><span class="line">âââ package.json</span><br><span class="line">âââ tsconfig.json</span><br><span class="line">âââ postcss.config.js</span><br><span class="line">âââ .babelrc</span><br><span class="line">âââ .eslintrc.js</span><br><span class="line">âââ .gitignore</span><br><span class="line">âââ yarn.lock</span><br></pre></td></tr></table></figure><h3 id="Step-1-Create-Project"><a href="#Step-1-Create-Project" class="headerlink" title="Step 1: Create Project"></a>Step 1: Create Project</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># init project</span></span><br><span class="line">yarn init -y</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># add eslint</span></span><br><span class="line">yarn add --dev eslint eslint-config-airbnb eslint-plugin-import eslint-plugin-jsx-a11y eslint-plugin-react</span><br><span class="line"></span><br><span class="line">eslint --init</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># add webpack</span></span><br><span class="line">yarn add --dev webpack webpack-dev-server webpack-dashboard webpack-merge @types/webpack @types/webpack-dev-server</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># add loader for jsx</span></span><br><span class="line">yarn add --dev babel-core babel-loader babel-preset-env babel-preset-react</span><br><span class="line"></span><br><span class="line"><span class="comment"># add loader for tsx</span></span><br><span class="line">yarn add --dev ts-loader typescript@next</span><br><span class="line"></span><br><span class="line"><span class="comment"># add loader for css</span></span><br><span class="line">yarn add --dev style-loader css-loader resolve-url-loader postcss-loader node-sass sass-loader</span><br><span class="line"></span><br><span class="line"><span class="comment"># add loader for file</span></span><br><span class="line">yarn add --dev url-loader file-loader</span><br><span class="line"></span><br><span class="line"><span class="comment"># add plugin for js</span></span><br><span class="line">yarn add babel-plugin-transform-runtime</span><br><span class="line"></span><br><span class="line"><span class="comment"># add plugin for postcss</span></span><br><span class="line">yarn add --dev autoprefixer precss</span><br><span class="line"></span><br><span class="line"><span class="comment"># add plugin for html</span></span><br><span class="line">yarn add --dev html-webpack-plugin</span><br><span class="line"></span><br><span class="line"><span class="comment"># add plugin for uglifyjs</span></span><br><span class="line">yarn add --dev uglifyjs-webpack-plugin</span><br><span class="line"></span><br><span class="line"><span class="comment"># add plugin for extract css</span></span><br><span class="line">yarn add --dev extract-text-webpack-plugin</span><br></pre></td></tr></table></figure><h3 id="set-gitignore"><a href="#set-gitignore" class="headerlink" title="set gitignore"></a>set gitignore</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Logs</span></span><br><span class="line">*.<span class="built_in">log</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># dependencies</span></span><br><span class="line">node_modules</span><br><span class="line"></span><br><span class="line"><span class="comment"># build</span></span><br><span class="line">dist</span><br></pre></td></tr></table></figure><h3 id="set-typescript-config"><a href="#set-typescript-config" class="headerlink" title="set typescript config"></a>set typescript config</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"compilerOptions"</span>: &#123;</span><br><span class="line">    <span class="attr">"outDir"</span>: <span class="string">"dist"</span>,</span><br><span class="line">    <span class="attr">"module"</span>: <span class="string">"commonjs"</span>,</span><br><span class="line">    <span class="attr">"target"</span>: <span class="string">"es5"</span>,</span><br><span class="line">    <span class="attr">"lib"</span>: [<span class="string">"es6"</span>, <span class="string">"dom"</span>],</span><br><span class="line">    <span class="attr">"sourceMap"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"allowJs"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"jsx"</span>: <span class="string">"react"</span>,</span><br><span class="line">    <span class="attr">"moduleResolution"</span>: <span class="string">"node"</span>,</span><br><span class="line">    <span class="attr">"rootDir"</span>: <span class="string">"src"</span>,</span><br><span class="line">    <span class="attr">"noImplicitReturns"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"noImplicitThis"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"noImplicitAny"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"strictNullChecks"</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"exclude"</span>: [</span><br><span class="line">    <span class="string">"config"</span>,</span><br><span class="line">    <span class="string">"node_modules"</span>,</span><br><span class="line">    <span class="string">"dist"</span>,</span><br><span class="line">    <span class="string">"webpack"</span>,</span><br><span class="line">    <span class="string">"jest"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"types"</span>: [</span><br><span class="line">    <span class="string">"typePatches"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Set-basic-webpack-config"><a href="#Set-basic-webpack-config" class="headerlink" title="Set basic webpack config"></a>Set basic webpack config</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// /config/webpack.config.base.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'../dist'</span>),</span><br><span class="line">    filename: <span class="string">'scripts/[name]-[hash].js'</span>,</span><br><span class="line">    chunkFilename: <span class="string">'scripts/[name]-[chunkhash].js'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.tsx?$/</span>,</span><br><span class="line">        loader: <span class="string">'ts-loader'</span>,</span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span></span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        test: <span class="regexp">/\.jsx?$/</span>,</span><br><span class="line">        loader: <span class="string">'babel-laoder'</span>,</span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        test: <span class="regexp">/\.(png|jpg)$/</span>,</span><br><span class="line">        loader: <span class="string">'url-loader'</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">          limit: <span class="number">8192</span>,</span><br><span class="line">          name: <span class="string">'[name]-[hash].[ext]'</span>,</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    extensions: [<span class="string">'.tsx'</span>, <span class="string">'.ts'</span>, <span class="string">'.jsx'</span>, <span class="string">'.js'</span>, <span class="string">'.scss'</span>, <span class="string">'.css'</span>, <span class="string">'.json'</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Set-dev-webpack-config"><a href="#Set-dev-webpack-config" class="headerlink" title="Set dev webpack config"></a>Set dev webpack config</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// /config/webpack.config.dev.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> DashboardPlugin = <span class="built_in">require</span>(<span class="string">'webpack-dashboard/plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> baseConfig = <span class="built_in">require</span>(<span class="string">'./webpack.config.base'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> devConfig = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    app: [</span><br><span class="line">      <span class="string">'webpack/hot/only-dev-server'</span>,</span><br><span class="line">      <span class="string">'webpack-dev-server/client?http://localhost:8080'</span>,</span><br><span class="line">      path.resolve(__dirname, <span class="string">'../src/app.tsx'</span>),</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.scss$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          <span class="string">'style-loader'</span>,</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'css-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              modules: <span class="literal">true</span>,</span><br><span class="line">              name: <span class="string">'[local]-[name]-[hash]'</span></span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">'resolve-url-loader'</span>,</span><br><span class="line">        <span class="string">'sass-loader'</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  devtool: <span class="string">'source-map'</span>,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> webpack.HotModuleReplacementPlugin(),</span><br><span class="line">    <span class="keyword">new</span> webpack.NamedModulesPlugin(),</span><br><span class="line">    <span class="keyword">new</span> webpack.DefinePluing(&#123;</span><br><span class="line">      <span class="string">'process.env'</span>: &#123;</span><br><span class="line">        NODE_ENV: <span class="string">'development'</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> DashboardPlugin(),</span><br><span class="line">    <span class="keyword">new</span> HtmlPlugin(&#123;</span><br><span class="line">      title: <span class="string">'å¼å'</span>,</span><br><span class="line">      template: path.resolve(__dirname, <span class="string">'../src/temlates/index.html'</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    hot: <span class="literal">true</span>,</span><br><span class="line">    compress: <span class="literal">true</span>,</span><br><span class="line">    historyApiFallback: <span class="literal">true</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = merge(baseConfig, devConfig)</span><br></pre></td></tr></table></figure><h4 id="Set-prod-webpack-config"><a href="#Set-prod-webpack-config" class="headerlink" title="Set prod webpack config"></a>Set prod webpack config</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// /config/webpack.config.prod.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>)</span><br><span class="line"><span class="keyword">const</span> ExtractTextPlugin = <span class="built_in">require</span>(<span class="string">'extract-text-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> UglifyJSPlugin = <span class="built_in">require</span>(<span class="string">'uglifyjs-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> baseConfig = <span class="built_in">require</span>(<span class="string">'./webpack.config.base.js'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> prodConfig = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    app: path.resolve(__dirname, <span class="string">'../src/app.tsx'</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      test: <span class="regexp">/\.scss$/</span>,</span><br><span class="line">      use: ExtractTextPlugin.extract(&#123;</span><br><span class="line">        fallback: <span class="string">'style-loader'</span>,</span><br><span class="line">        use: [</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'css-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              modules: <span class="literal">true</span>,</span><br><span class="line">              name: <span class="string">'[local]-[name]-[hash]'</span>,</span><br><span class="line">              importLoaders: <span class="number">3</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">      &#125;), &#123;</span><br><span class="line">        loader: <span class="string">'postcss-loader'</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">          config: path.resolve(__dirname, <span class="string">'./config/postcss.config.json'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">'resolve-url-loader'</span>,</span><br><span class="line">      <span class="string">'sass-loader'</span>,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  devtool: <span class="string">'inline-source-map'</span>,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> webpack.DefinePluing(&#123;</span><br><span class="line">      <span class="string">'process.env.NODE_ENV'</span>: <span class="string">'production'</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">      name: <span class="string">'app'</span>,</span><br><span class="line">      filename: <span class="string">'scripts/vendor-[hash].min.js'</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> HtmlPlugin(&#123;</span><br><span class="line">      title: <span class="string">'çäº§'</span>,</span><br><span class="line">      template: path.resolve(__dirnaem, <span class="string">'../src/templates/index.html'</span>),</span><br><span class="line">      minify: &#123;</span><br><span class="line">        collapseBooleanAttributes: <span class="literal">true</span>,</span><br><span class="line">        collapseInlineTagWhitespace: <span class="literal">true</span>,</span><br><span class="line">        collapseWhitespace: <span class="literal">true</span>,</span><br><span class="line">        minifyCSS: <span class="literal">true</span>,</span><br><span class="line">        minifyJS: <span class="literal">true</span>,</span><br><span class="line">        removeAttributeQuotes: <span class="literal">true</span>,</span><br><span class="line">        removeComments: <span class="literal">true</span>,</span><br><span class="line">        removeEmptyAttributes: <span class="literal">true</span>,</span><br><span class="line">        removeRedundantAttributes: <span class="literal">true</span>,</span><br><span class="line">        removeTagWhitespace: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> ExtractTextPlugin(&#123;</span><br><span class="line">      filename: <span class="string">'styles/[name]-[contenthash].css'</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> UglifyJSPlugin(),</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Set-config-refered-by-webpack-babelrc-postcss-index-html"><a href="#Set-config-refered-by-webpack-babelrc-postcss-index-html" class="headerlink" title="Set config refered by webpack(babelrc, postcss, index.html)"></a>Set config refered by webpack(babelrc, postcss, index.html)</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// /.babelrc</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"presets"</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">"env"</span>, &#123;</span><br><span class="line">        <span class="string">"targets"</span>: &#123;</span><br><span class="line">          <span class="string">"browsers"</span>: [<span class="string">"last 2 versions"</span>, <span class="string">"safari &gt;= 9"</span>],</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"react"</span>,</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"plugins"</span>: [</span><br><span class="line">    [<span class="string">"transform-runtime"</span>, &#123;</span><br><span class="line">      <span class="string">"polyfill"</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">"regenerator"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;],</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> precss = <span class="built_in">require</span>(<span class="string">'precss'</span>)</span><br><span class="line"><span class="keyword">const</span> autoprefixer = <span class="built_in">require</span>(<span class="string">'autoprefixer'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    precss,</span><br><span class="line">    autoprefixer,</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;<span class="name">%=</span> <span class="attr">htmlWebpackPlugin.options.title</span> %&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Step-2-Skeleton-of-React-App-React-Router"><a href="#Step-2-Skeleton-of-React-App-React-Router" class="headerlink" title="Step 2: Skeleton of React App(React + Router)"></a>Step 2: Skeleton of React App(React + Router)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev bundle-laoder @types/react @types/react-dom @types/node @types/react-router-dom</span><br><span class="line"></span><br><span class="line">yarn add react react-dom react-router-dom</span><br></pre></td></tr></table></figure><p>In <code>src/app.tsx</code> render the App to html</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; render &#125; <span class="keyword">from</span> <span class="string">'react-dom'</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./containers/App'</span></span><br><span class="line"></span><br><span class="line">render(</span><br><span class="line">  &lt;App /&gt;, <span class="built_in">document</span>.getElementById(<span class="string">'app'</span>) <span class="keyword">as</span> HTMLElement</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">module</span>.hot) &#123;</span><br><span class="line">  <span class="built_in">module</span>.hot.accept(<span class="string">'./containers/App'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> App = <span class="built_in">require</span>(<span class="string">'./containers/App'</span>).default</span><br><span class="line">    render (</span><br><span class="line">      &lt;App /&gt;,</span><br><span class="line">      <span class="built_in">document</span>.getElementById(<span class="string">'app'</span>)</span><br><span class="line">    )</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Create-App-Represental-Component"><a href="#Create-App-Represental-Component" class="headerlink" title="Create App Represental Component"></a>Create App Represental Component</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// `./src/containers/App.tsx`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  BrowserRouter <span class="keyword">as</span> Router,</span><br><span class="line">  Route,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></span><br><span class="line"><span class="keyword">import</span> Header <span class="keyword">from</span> <span class="string">'./Header'</span></span><br><span class="line"><span class="keyword">import</span> Body <span class="keyword">from</span> <span class="string">'./Body'</span></span><br><span class="line"><span class="keyword">import</span> Footer <span class="keyword">from</span> <span class="string">'./Footer'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> () &#123;</span><br><span class="line">    <span class="keyword">super</span> ()</span><br><span class="line">  &#125;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Router&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">         &lt;Route path=<span class="string">"/"</span> component=&#123;Header&#125; /&gt;</span><br><span class="line">         &lt;Route path=<span class="string">"/"</span> component=&#123;Body&#125; /&gt;</span><br><span class="line">         &lt;Route path=<span class="string">"/"</span> component=&#123;Footer&#125; /&gt;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>Router&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Create-Header-Body-Footer-Containers"><a href="#Create-Header-Body-Footer-Containers" class="headerlink" title="Create Header, Body, Footer Containers"></a>Create Header, Body, Footer Containers</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/containers/Header.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; goTo &#125; <span class="keyword">from</span> <span class="string">'..utils/nav'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Header</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  protected goTo = goTo.bind(<span class="keyword">this</span>)</span><br><span class="line">  <span class="keyword">constructor</span> () &#123;</span><br><span class="line">    <span class="keyword">super</span>()</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      navs: [</span><br><span class="line">        &#123; <span class="attr">label</span>: <span class="string">'é¦é¡µ'</span>, <span class="attr">url</span>: <span class="string">'index'</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">label</span>: <span class="string">'ç¬¬äºé¡µ'</span>, <span class="attr">url</span>: <span class="string">'page2'</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">label</span>: <span class="string">'ç¬¬ä¸é¡µ'</span>, <span class="attr">url</span>: <span class="string">'page3'</span> &#125;,</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; navs &#125; = <span class="keyword">this</span>.state</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &#123;</span><br><span class="line">          navs.map(</span><br><span class="line">            (nav: &#123;<span class="attr">label</span>: string, <span class="attr">url</span>: string&#125;) =&gt; <span class="xml"><span class="tag">&lt;<span class="name">span</span> <span class="attr">key</span>=<span class="string">&#123;nav.url&#125;</span> <span class="attr">onClick</span>=<span class="string">&#123;this.goTo(nav.url)&#125;</span>&gt;</span>&#123;nav.label&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line">          )</span><br><span class="line">        &#125;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Header</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/utils/nav.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">goTo</span>(<span class="params">url: string</span>) </span>&#123;</span><br><span class="line">  retrn () =&gt; &#123;</span><br><span class="line">    <span class="keyword">this</span>.props.history.push(url)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Same structure in Body and Footer.</p><h4 id="Add-AsyncRoute"><a href="#Add-AsyncRoute" class="headerlink" title="Add AsyncRoute"></a>Add AsyncRoute</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line">interface PassedProps extends React.Props&lt;any&gt; &#123;</span><br><span class="line">  load: any;</span><br><span class="line">  children: any;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bundle</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span>&lt;<span class="title">PassedProps</span>, <span class="title">any</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> () &#123;</span><br><span class="line">    <span class="keyword">super</span>()</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      mod: <span class="literal">null</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  componentWillMount () &#123;</span><br><span class="line">    <span class="keyword">this</span>.load(<span class="keyword">this</span>.props)</span><br><span class="line">  &#125;</span><br><span class="line">  componentWillReceiveProps (nextProps) &#123;</span><br><span class="line">    <span class="keyword">if</span> (nextProps.load !== <span class="keyword">this</span>.props.load) &#123;</span><br><span class="line">      <span class="keyword">this</span>.load(nextProps)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  load (props) &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      mod: <span class="literal">null</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    props.load(<span class="function">(<span class="params">mod</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">        mod: mod.default || mod,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.state.mod ? <span class="keyword">this</span>.props.children(<span class="keyword">this</span>.state.mod) : <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="built_in">module</span> =&gt; <span class="function"><span class="params">routerProps</span> =&gt;</span> (<span class="xml"><span class="tag">&lt;<span class="name">Bundle</span> <span class="attr">load</span>=<span class="string">&#123;module&#125;</span>&gt;</span></span></span><br><span class="line">  &#123; Comp =&gt; Comp ? &lt;Comp &#123;...routerProps&#125; /&gt; : null&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>And use it in body container</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; Route &#125; <span class="keyword">from</span> <span class="string">'react-router'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Index <span class="keyword">from</span> <span class="string">'bundle-loader?lazy!./Index'</span></span><br><span class="line"><span class="keyword">import</span> AsyncRoute <span class="keyword">from</span> <span class="string">'../components/AsyncRoute'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; (</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">   &lt;Route path=<span class="string">"/index"</span> component=&#123;AsyncRoute(Index)&#125;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">)</span></span><br></pre></td></tr></table></figure><h3 id="Add-Redux"><a href="#Add-Redux" class="headerlink" title="Add Redux"></a>Add Redux</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev redux-devtools redux-devtools-dock-monitor redux-devtools-log-monitor</span><br><span class="line"></span><br><span class="line">yarn add redux redux-actions react-redux</span><br></pre></td></tr></table></figure><h4 id="Create-Actions"><a href="#Create-Actions" class="headerlink" title="Create Actions"></a>Create Actions</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/actions/hello.tsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; createActions &#125; <span class="keyword">from</span> <span class="string">'redux-actions'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> createActions(&#123;</span><br><span class="line">  SAY_HELLO: <span class="function"><span class="params">text</span> =&gt;</span> (&#123; text &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// export</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//   sayHello: (text: string) =&gt; (&#123; text: string &#125;)</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/actions/index.tsx</span></span><br><span class="line"><span class="keyword">import</span> helloActions <span class="keyword">from</span> <span class="string">'./hello'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  ...helloActions</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Create-Reducers"><a href="#Create-Reducers" class="headerlink" title="Create Reducers"></a>Create Reducers</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/reducers/hello.tsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; handleActions &#125; <span class="keyword">from</span> <span class="string">'redux-actions'</span></span><br><span class="line"><span class="keyword">import</span> actions <span class="keyword">from</span> <span class="string">'../actions'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> handleActions(&#123;</span><br><span class="line">  [actions.sayHello.toString()]: <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; ...state, ...action.payload &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;, &#123;</span><br><span class="line">  text: <span class="string">''</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/reducers/index.tsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; combineReducers &#125; <span class="keyword">from</span> <span class="string">'redux'</span></span><br><span class="line"><span class="keyword">import</span> helloReducer <span class="keyword">from</span> <span class="string">'./hello'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> combineReducers(&#123;</span><br><span class="line">  hello: helloReducer,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="Create-Store"><a href="#Create-Store" class="headerlink" title="Create Store"></a>Create Store</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/store/configureStore.dev.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; createStore, applyMiddleware, compose, GenericStoreEnhancer &#125; <span class="keyword">from</span> <span class="string">'redux'</span></span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">'../reducers'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> enhancer = compose(</span><br><span class="line">  <span class="comment">// applyMiddleware(...middlewares)</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">window</span>.devToolsExtension ? <span class="built_in">window</span>.devToolsExtension() : <span class="function"><span class="params">f</span> =&gt;</span> f,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">configureStoreDev</span>(<span class="params">initState: any</span>): <span class="title">any</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> store = createStore(reducer, initState, enhancer)</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">module</span>.hot) &#123;</span><br><span class="line">    <span class="built_in">module</span>.hot.accpet(<span class="string">'../reducers'</span>, () =&gt; &#123;</span><br><span class="line">      store.replaceReducer(<span class="built_in">require</span>(<span class="string">'../reducers'</span>).default)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> store</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = configureStoreDev</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/store/configureStoreProd</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; createStore, applyMiddleware &#125; <span class="keyword">from</span> <span class="string">'redux'</span></span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">'../reducers'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">configureStoreProd</span> (<span class="params">initState: any</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> createStore(reducer, initState)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = configureStoreProd</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/store/index.jsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (process.env.NODE_ENV == <span class="string">'development'</span>) &#123;</span><br><span class="line">  <span class="built_in">module</span>.exports = <span class="built_in">require</span>(<span class="string">'./configureStore.dev'</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="built_in">module</span>.exports = <span class="built_in">require</span>(<span class="string">'./configureStore.prod'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Add-Provider-to-Main-Container"><a href="#Add-Provider-to-Main-Container" class="headerlink" title="Add Provider to Main Container"></a>Add Provider to Main Container</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./container/App.tsx</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  BrowserRouter <span class="keyword">as</span> Router,</span><br><span class="line">  Route,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span></span><br><span class="line"><span class="keyword">import</span> Header <span class="keyword">from</span> <span class="string">'./Header'</span></span><br><span class="line"><span class="keyword">import</span> Body <span class="keyword">from</span> <span class="string">'./Body'</span></span><br><span class="line"><span class="keyword">import</span> Footer <span class="keyword">from</span> <span class="string">'./Footer'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> configureStore = <span class="built_in">require</span>(<span class="string">'../store'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = configureStore(&#123;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> () &#123;</span><br><span class="line">    <span class="keyword">super</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  render () &#123;</span><br><span class="line">    returun (</span><br><span class="line">      &lt;Router&gt;</span><br><span class="line">        &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">          &lt;Route path=<span class="string">"/"</span> component=&#123;Header&#125; /&gt;</span><br><span class="line">          &lt;Route path=<span class="string">"/"</span> component=&#123;Body&#125; /&gt;</span><br><span class="line">          &lt;Route path=<span class="string">"/"</span> component=&#123;Body&#125; /&gt;</span><br><span class="line">        &lt;<span class="regexp">/Provider&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>Router&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="custom-connect-to-cache-mapStateToProps-and-mapDispatchToProps"><a href="#custom-connect-to-cache-mapStateToProps-and-mapDispatchToProps" class="headerlink" title="custom connect to cache mapStateToProps and mapDispatchToProps"></a>custom connect to cache mapStateToProps and mapDispatchToProps</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span></span><br><span class="line"><span class="keyword">import</span> &#123; bindActionCreators &#125; <span class="keyword">from</span> <span class="string">'redux'</span></span><br><span class="line"><span class="keyword">import</span> actions <span class="keyword">from</span> <span class="string">'../actions'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mapStateToProps = <span class="function">(<span class="params">state: any</span>) =&gt;</span> state</span><br><span class="line"><span class="keyword">const</span> mapDispatchToProps = <span class="function">(<span class="params">dispatch: any</span>) =&gt;</span> (bindActionCreators(actions, dispatch))</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (Comp: any) =&gt; connect(mapStateToProps, mapDispatchToProps)(Comp)</span><br></pre></td></tr></table></figure><h4 id="Connect-the-Presentational-Container"><a href="#Connect-the-Presentational-Container" class="headerlink" title="Connect the Presentational Container"></a>Connect the Presentational Container</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> connect <span class="keyword">from</span> <span class="string">'../utils/connect'</span></span><br><span class="line"><span class="keyword">import</span> &#123; goTo &#125; <span class="keyword">from</span> <span class="string">'../utils/nav'</span></span><br><span class="line"></span><br><span class="line">interface PassedProps extends React.Props&lt;any&gt; &#123;</span><br><span class="line">  sayHello: any;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Header</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span>&lt;<span class="title">PassedProps</span>, <span class="title">any</span>&gt; </span>&#123;</span><br><span class="line">  protected goTo = goTo.bind(<span class="keyword">this</span>)</span><br><span class="line">  <span class="keyword">constructor</span> () &#123;</span><br><span class="line">    <span class="keyword">super</span>()</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      navs: [</span><br><span class="line">        &#123; <span class="attr">label</span>: <span class="string">'é¦é¡µ'</span>, <span class="attr">url</span>: <span class="string">'index'</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">label</span>: <span class="string">'ç¬¬äºé¡µ'</span>, <span class="attr">url</span>: <span class="string">'page2'</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">label</span>: <span class="string">'ç¬¬ä¸é¡µ'</span>, <span class="attr">url</span>: <span class="string">'page3'</span> &#125;,</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  componentDidMount () &#123;</span><br><span class="line">    <span class="keyword">this</span>.props.sayHello(<span class="string">'world'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; navs &#125; = <span class="keyword">this</span>.state</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &#123;navs.map(<span class="function">(<span class="params">nav: &#123; label: string, url: string&#125;</span>) =&gt;</span> &lt;span</span><br><span class="line">          key=&#123;nav.url&#125;</span><br><span class="line">          onClick=&#123;<span class="keyword">this</span>.goTo(nav.url)&#125;</span><br><span class="line">        &gt;&#123;nav.label&#125;&lt;<span class="regexp">/span&gt;)&#125;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(Header)</span><br></pre></td></tr></table></figure><h3 id="Add-Rxjs"><a href="#Add-Rxjs" class="headerlink" title="Add Rxjs"></a>Add Rxjs</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add rxjs redux-observable</span><br></pre></td></tr></table></figure><h4 id="Create-Epics"><a href="#Create-Epics" class="headerlink" title="Create Epics"></a>Create Epics</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/epics/hello.tsx</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'rxjs'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> sayHello = <span class="function">(<span class="params">action$, store</span>) =&gt;</span></span><br><span class="line">  .action$.ofType(<span class="string">'SAY_HELLO'</span>)</span><br><span class="line">  .delay(<span class="number">1000</span>)</span><br><span class="line">  .map(<span class="function"><span class="params">()</span> =&gt;</span> (&#123;</span><br><span class="line">    type: <span class="string">'SAY_HELLO'</span>,</span><br><span class="line">    payload: &#123;</span><br><span class="line">      text: <span class="string">'got hello'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;))</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/epcis/index.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; combineEpics &#125; <span class="keyword">from</span> <span class="string">'redux-observable'</span></span><br><span class="line"><span class="keyword">import</span> &#123; sayHello &#125; <span class="keyword">from</span> <span class="string">'./hello'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> combineEpics(</span><br><span class="line">  sayHello,</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h4 id="Add-Epic-to-Enhancer"><a href="#Add-Epic-to-Enhancer" class="headerlink" title="Add Epic to Enhancer"></a>Add Epic to Enhancer</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore, applyMiddleware, compose, GenericStoreEnhancer &#125; <span class="keyword">from</span> <span class="string">'redux'</span></span><br><span class="line"><span class="keyword">import</span> &#123; createEpicMiddleware &#125; <span class="keyword">from</span> <span class="string">'redux-observable'</span></span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">'../reducers'</span></span><br><span class="line"><span class="keyword">import</span> epics <span class="keyword">from</span> <span class="string">'../epics'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> epicMiddleware = createEpicMiddleware(epics)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> enhancer = compose(</span><br><span class="line">  applyMiddleware(epicMiddleware),</span><br><span class="line">  <span class="built_in">window</span>.devToolsExtension ? <span class="built_in">window</span>.devToolsExtension() : <span class="function"><span class="params">f</span> =&gt;</span> f</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">configureStoreDev</span> (<span class="params">initState: any</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> store = createStore(reducer, initState, enhancer)</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">module</span>.hot) &#123;</span><br><span class="line">    <span class="built_in">module</span>.hot.accept(<span class="string">'../reducers'</span>, () =&gt; &#123;</span><br><span class="line">      store.replaceReducer(<span class="built_in">require</span>(<span class="string">'../reducers'</span>).default)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> store</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = configureStoreDev</span><br></pre></td></tr></table></figure><h3 id="Add-Service-Worker"><a href="#Add-Service-Worker" class="headerlink" title="Add Service Worker"></a>Add Service Worker</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add sw-precache-webpack-plugin</span><br></pre></td></tr></table></figure><h4 id="Add-the-Plugin-in-webpack-config-prod-js"><a href="#Add-the-Plugin-in-webpack-config-prod-js" class="headerlink" title="Add the Plugin in webpack.config.prod.js"></a>Add the Plugin in webpack.config.prod.js</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> SWPrecachePluing = <span class="built_in">require</span>(<span class="string">'sw-precache-webpack-plugin'</span>)</span><br><span class="line">plugins: [</span><br><span class="line">  <span class="keyword">new</span> SWPrecachePluing()</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="Add-Bundle-Analyzer"><a href="#Add-Bundle-Analyzer" class="headerlink" title="Add Bundle Analyzer"></a>Add Bundle Analyzer</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev webpack-bundle-anaylzer</span><br></pre></td></tr></table></figure><h3 id="Add-the-Plugin-in-webpack-config-dev-js"><a href="#Add-the-Plugin-in-webpack-config-dev-js" class="headerlink" title="Add the Plugin in webpack.config.dev.js"></a>Add the Plugin in webpack.config.dev.js</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> BundleAnalyzer = <span class="built_in">require</span>(<span class="string">'webpack-bundle-analyzer'</span>).BundleAnalyzerPlugin</span><br><span class="line"></span><br><span class="line">plugins: [</span><br><span class="line">  <span class="keyword">new</span> BundleAnalyzer()</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="Add-Dll"><a href="#Add-Dll" class="headerlink" title="Add Dll"></a>Add Dll</h3><h4 id="Add-webpack-config-dll-js"><a href="#Add-webpack-config-dll-js" class="headerlink" title="Add webpack.config.dll.js"></a>Add webpack.config.dll.js</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.dll.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="keyword">const</span> ManifestPlugin = <span class="built_in">require</span>(<span class="string">'webpack-manifest-plugin'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    vendor: [<span class="comment">/* ... */</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'../lib'</span>),</span><br><span class="line">    filename: <span class="string">'[name]_[hash:5].js'</span>,</span><br><span class="line">    library: <span class="string">'[name]_[hash:5]'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> webpack.DllPlugin(&#123;</span><br><span class="line">      name: <span class="string">'[name]_[hash:5]'</span>,</span><br><span class="line">      path: path.resolve(__dirname, <span class="string">'../lib'</span>, <span class="string">'[name]-manifest.json'</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> ManifestPlugin(),</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Copy-dll-to-dist-and-refer"><a href="#Copy-dll-to-dist-and-refer" class="headerlink" title="Copy dll to dist and refer"></a>Copy dll to dist and refer</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.base.js</span></span><br><span class="line"><span class="keyword">const</span> vendorManifest = <span class="built_in">require</span>(<span class="string">'../lib/vendor-manifest.json'</span>)</span><br><span class="line">plugins: [</span><br><span class="line">  <span class="keyword">new</span> CopyPlugin([</span><br><span class="line">    &#123; <span class="attr">from</span>: path.resolve(__dirname, <span class="string">'../lib/*.js'</span>) &#125;,</span><br><span class="line">  ]),</span><br><span class="line">  <span class="keyword">new</span> webpack.DllReference(&#123;</span><br><span class="line">    manifest: vendorManifest,</span><br><span class="line">  &#125;),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="Insert-Dll-files-in-html"><a href="#Insert-Dll-files-in-html" class="headerlink" title="Insert Dll files in html"></a>Insert Dll files in html</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.dev.js</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">const</span> manifest = <span class="built_in">JSON</span>.parse(fs.readFileSync(path.resolve(__dirname, <span class="string">'../lib/manifest.json'</span>)))</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> HtmlPlugin(&#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">      dll: <span class="string">`./lib/<span class="subst">$&#123;manifest[<span class="string">'vendor.js'</span>]&#125;</span>`</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Notes on TS + React + Redux</title>
      <link href="/2017/09/05/Notes-on-TS-React-Redux/"/>
      <content type="html"><![CDATA[<h3 id="Add-Explicit-Props-Interface-from-Store"><a href="#Add-Explicit-Props-Interface-from-Store" class="headerlink" title="Add Explicit Props Interface from Store"></a>Add Explicit Props Interface from Store</h3><p>When I use <code>react-redux</code>, the TS Compiler always throw an error:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error TS2339: Property <span class="string">'...'</span> does not exist on <span class="built_in">type</span> <span class="string">'Readonly&lt;children?: ReactNode; &#125;&gt; &amp; Readonly&lt;&#123;&#125;&gt;'</span>.</span><br></pre></td></tr></table></figure><p>Thatâs because Connect was not supplying an explicit interface to the container component, so it was confused by the prop that it was trying to pass.</p><p>So you can add an explicit interface on child component.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">interface PropsFromStore extends React.Props&lt;any&gt; &#123;</span><br><span class="line">  propsFromStore: any;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChildComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span>&lt;<span class="title">PropsFromStore</span>, <span class="title">React</span>.<span class="title">State</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps, mapDispatchToProps)(ChildComponent)</span><br></pre></td></tr></table></figure><h3 id="Add-Enhancer-to-Store-with-TS"><a href="#Add-Enhancer-to-Store-with-TS" class="headerlink" title="Add Enhancer to Store with TS"></a>Add Enhancer to Store with TS</h3><p>When I use an enhancer like:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> enhancer = compose(</span><br><span class="line">  applyMiddleware(...middlewares),</span><br><span class="line">  DevTools.instrument(),</span><br><span class="line">  persistState(</span><br><span class="line">    <span class="built_in">window</span>.location.href.match(</span><br><span class="line">      /[?&amp;]debug_session=([^&amp;#]+)\b/</span><br><span class="line">    )</span><br><span class="line">  )</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>I got an error like:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[ts] Argument of <span class="built_in">type</span> <span class="string">'Function'</span> is not assignable to parameter of <span class="built_in">type</span> <span class="string">'Func3&lt;&#123;&#125;, &#123;&#125;, &#123;&#125;, &#123;&#125;, StoreEnhancerStoreCreator&lt;&#123;&#125;&gt;&gt;'</span>.</span><br><span class="line">Type <span class="string">'Function'</span> provides no match <span class="keyword">for</span> the signature <span class="string">'(a1: &#123;&#125;, a2: &#123;&#125;, a3: &#123;&#125;, ...args: any[]): &#123;&#125;'</span></span><br></pre></td></tr></table></figure><p>To resolve this, just:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; GenericStoreEnhancer &#125; <span class="keyword">from</span> <span class="string">'redux'</span></span><br><span class="line"><span class="keyword">const</span> enhancer = compose(</span><br><span class="line">  applyMiddleware(...middlewares),</span><br><span class="line">  DevTools.instrument <span class="keyword">as</span> GenericStoreEnhancer,</span><br><span class="line">  persistState(</span><br><span class="line">    <span class="built_in">window</span>.location.href.match(</span><br><span class="line">      /[?&amp;]debug_session=([^&amp;#]+)\b/</span><br><span class="line">    )</span><br><span class="line">  )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>AsyncRoute With React-Router-V4</title>
      <link href="/2017/09/04/AsyncRoute-with-React-Router-v4/"/>
      <content type="html"><![CDATA[<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AsyncRoute.jsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bundle</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  constructur () &#123;</span><br><span class="line">    <span class="keyword">super</span>()</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      mod: <span class="literal">null</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  componentWillMount () &#123;</span><br><span class="line">    <span class="keyword">this</span>.load(<span class="keyword">this</span>.props)</span><br><span class="line">  &#125;</span><br><span class="line">  componentWillReceiveProps (nextProps) &#123;</span><br><span class="line">    <span class="keyword">if</span> (nextProps.load !== <span class="keyword">this</span>.props.load) &#123;</span><br><span class="line">      <span class="keyword">this</span>.load(nextProps)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  load (props) &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      mod: <span class="literal">null</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    props.load(<span class="function">(<span class="params">mod</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">        mod: mod.default || mod,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.state.mod ? <span class="keyword">this</span>.props.children(<span class="keyword">this</span>.state.mod) : <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="built_in">module</span> =&gt; <span class="function"><span class="params">routerProps</span> =&gt;</span> (<span class="xml"><span class="tag">&lt;<span class="name">Bundle</span> <span class="attr">load</span>=<span class="string">&#123;module&#125;</span>&gt;</span></span></span><br><span class="line">  &#123;Comp =&gt; Comp ? &lt;Comp &#123;...routerProps&#125; /&gt; : null&#125;</span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">Bundle</span>&gt;</span></span></span><br><span class="line"><span class="xml">)</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Body.jsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; Route &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></span><br><span class="line"><span class="keyword">import</span> AsyncRoute <span class="keyword">from</span> <span class="string">'./AsyncRoute'</span></span><br><span class="line"><span class="keyword">import</span> Page <span class="keyword">from</span> <span class="string">'bundle-loader?lazy!./Page'</span></span><br><span class="line"></span><br><span class="line">&lt;Route component=&#123;AsyncRoute(Page)&#125; /&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Note of Sw-Precache</title>
      <link href="/2017/09/04/note-of-sw-precache/"/>
      <content type="html"><![CDATA[<p>A node module to generate service worker code that will precaches specific resource so they work offline.</p><p>Serving your local static resources cache-first means that you can get all the crucial scaffolding for your web app â your app shell â on the screen  without having to wait for any network responses.</p><h3 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev sw-precache</span><br></pre></td></tr></table></figure><h3 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h3><ol><li><p>Make sure your site is served using HTTPS.</p></li><li><p>incorporate <code>sw-precache</code> into your <code>node</code>-based build script.</p></li><li><p>Register the service worker JavaScript.</p></li></ol><h3 id="Considerations"><a href="#Considerations" class="headerlink" title="Considerations"></a>Considerations</h3><ul><li><p>Service worker caching should be considered a prograssive enhancement. If you follow the model of conditionally registering a service worker only if itâs supported(determined by <code>if(&#39;serviceWorker&#39; in navigator)</code>), youâll get offline support on browsers with service workers and on browsers that donât support service workers, the offline-specific code will never be called.</p></li><li><p>All resources that are precached will be fetched by a service worker runing in a separate thread as soon as the service worker is installed. You should be judicious in what you list in the <code>dynamicUrlsToDependencies</code> and <code>staticFileGlobs</code> options, since listing files that are non-essential(large-images that are not shown on every page, for instance) will result in browsers downloading more data than is strictly necessary.</p></li><li><p>Precaching doesnât make sense for all types of resource. Other caching strategies can be used in conjunction with <code>sw-precache</code> to provide the best experience for your users. If you do implement additional caching logic, put the code in a separate file and include it using the <code>importScripts()</code> method.</p></li><li><p><code>sw-precache</code> uses a <strong>cache-first</strong> strategy, which results in a copy of any cached content being returned without consulting the network.</p></li></ul><h3 id="Use-with-webpack"><a href="#Use-with-webpack" class="headerlink" title="Use with webpack"></a>Use with webpack</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev sw-precache-webpack-plugin</span><br></pre></td></tr></table></figure><h4 id="Basic-Usage"><a href="#Basic-Usage" class="headerlink" title="Basic Usage"></a>Basic Usage</h4><p>A simple configuration example that will work well in most production environments.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> SWPrecachePlugin = <span class="built_in">require</span>(<span class="string">'sw-precache-webpack-plugin'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> PUBLIC_PATH = <span class="string">'https://www.my-project-name.com/'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exporst = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    main: path.resolve(__dirname, <span class="string">'src/index'</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'src/bundles/'</span>),</span><br><span class="line">    filename: <span class="string">'[name]-[hash].js'</span>,</span><br><span class="line">    publicPath: PUBLIC_PATH,</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> SWPrecachePlugin(&#123;</span><br><span class="line">      cacheId: <span class="string">'my-project-name'</span>,</span><br><span class="line">      dontCacheBustUrlsMatching: <span class="regexp">/\.\w&#123;8&#125;\./</span>,</span><br><span class="line">      filename: <span class="string">'service-worker.js'</span>,</span><br><span class="line">      minify: <span class="literal">true</span>,</span><br><span class="line">      navigateFallback: PUBLIC_PATH + <span class="string">'index.html'</span>,</span><br><span class="line">      staticFileGlobsIgnorePatterns: [</span><br><span class="line">        /\.map$/,</span><br><span class="line">        /asset-manifest\.json$/,</span><br><span class="line">      ]</span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This will generate a new service worker at <code>src/bundles/service-worker.js</code>, then you would register it in your application:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="string">'serviceWorker'</span> <span class="keyword">in</span> navigator) &#123;</span><br><span class="line">    navigator.serviceWorker.register(<span class="string">'./service-worker.js'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure><h4 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h4><ul><li><p>filename: string - service worker filename, default is <code>service-worker.js</code></p></li><li><p>filepath: string - service worker path and name, default is to use <code>webpack.output.path</code> + <code>options.filename</code>. This will override <code>filename</code>.</p></li><li><p>staticFileGlobsIngorePatters: [Regexp] - Define an optional array of regex patterns to filter out of staticFileGlobs.</p></li><li><p>mergeStaticsConfig: [boolean] - Merge provided staticFileGlobs and stripPrefixMulti with webpackâs config, rather than having those take precedence, default is false.</p></li><li><p>minify: [boolean] - Set to true to minify and uglify the generated service-worker, default is false.</p></li><li><p>cacheId: [string] - Not required but you should include this, it will give your service worker cache a unique name, default to <code>sw-precache-webpack-plugin</code>.</p></li><li><p>importScripts: [Array&lt;String|Object&gt;]</p><ul><li><p>when importScripts array item is a string, converts to object format: <code>{ filename: &#39;&lt;publicPath&gt;/my-scripts.js&#39;}</code></p></li><li><p>when importScripts array item is an Object</p><ul><li><p>look for <code>chunkName</code> property</p></li><li><p>look for <code>filename</code> property</p></li></ul></li></ul></li><li><p>replacePrefix: [String] - should only be used in conjunction with <code>stripPrefix</code></p></li><li><p>staticFileGlobs: [Array<string>] - Omit this to allow the plugin to cache all your bundlesâ emitted assets. If <code>mergeStaticsConfig=true</code>: this value will be merged with your bundlesâ emitted assets, otherwise this value is just passed to <code>sw-precache</code> and emitted assets wonât be included.</string></p></li><li><p>stripPrefix: [String] - Same as stripPrefixMulti[stripPrefix] = ââ</p></li><li><p>stripPrefixMulti: [Object&lt;String,String&gt;] - Omit this to use your webpack configâs <code>output.path</code> + <code>/</code>: <code>output.publicPath</code>.</p></li></ul><blockquote><p>Note taht all configuration options are optional. <code>SWPrecacheWebpackPlugin</code> will by default use all your assets emitted by webpackâs compiler for the <code>staticFileGlobs</code> parameter and your webpack configâs <code>{[output.path + &#39;/&#39;]: output.publicPath}</code> as the stripPrefixMulti parameter. This behavior is probably what you want, all your webpack assets will be cached by your generated service worker. Just donât pass any arguments when you initialize this plugin, and let this plugin handle generating your <code>sw-precache</code> configuration.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">plugins: [</span><br><span class="line">  <span class="keyword">new</span> SWPrecacheWebpackPlugin(),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> precache </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Service-Worker With Webpack</title>
      <link href="/2017/09/03/service-worker-with-webpack/"/>
      <content type="html"><![CDATA[<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev sw-precache-webpack-plugin</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack</span></span><br><span class="line"><span class="keyword">new</span> SWPrecachePlugin(&#123;</span><br><span class="line">  cacheId: <span class="string">'demo'</span>,</span><br><span class="line">  filename: <span class="string">'service-worker.js'</span>,</span><br><span class="line">  dontCacheBustUrlsMatching: <span class="literal">false</span>,</span><br><span class="line">  staticFileGlobsIgnorePatterns: [</span><br><span class="line">    /index\.html$/,</span><br><span class="line">    /\.map$/,</span><br><span class="line">    /\.css$/,</span><br><span class="line">    /\.svg$/,</span><br><span class="line">    /\.eot$/,</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>This will generate <code>service-worker.js</code> in dist.</p><h3 id="Add-Router"><a href="#Add-Router" class="headerlink" title="Add Router"></a>Add Router</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.use(<span class="string">'/service-worker.js'</span>, serve(<span class="string">'./dist/service-worker.js'</span>))</span><br></pre></td></tr></table></figure><blockquote><p>Note: <code>[name].[ext]?[hash]</code> will not be found by sw-precache(hash will be ignored), so filename should be specified like <code>[name].[hash].[ext]</code> or so.</p></blockquote><h3 id="Cache-files-who-are-not-bundled-by-webpack"><a href="#Cache-files-who-are-not-bundled-by-webpack" class="headerlink" title="Cache files who are not bundled by webpack."></a>Cache files who are not bundled by webpack.</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> SWPrecachePlugin(&#123;</span><br><span class="line">  cacheId: <span class="string">'demo'</span>,</span><br><span class="line">  filename: <span class="string">'service-worker.js'</span>,</span><br><span class="line">  minify: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// add two lines</span></span><br><span class="line">  mergeStaticConfig: <span class="literal">true</span>,</span><br><span class="line">  staticFileBlogs: [</span><br><span class="line">    path.join(__dirname, <span class="string">'../dist/static/*.*'</span>),</span><br><span class="line">  ],</span><br><span class="line">  dontCacheBustUrlsMatching: <span class="literal">false</span>,</span><br><span class="line">  staticFileGlobsIgnorePatterns: [</span><br><span class="line">    /\.index\.html$/,</span><br><span class="line">    /\.map$/,</span><br><span class="line">    /\.css$/,</span><br><span class="line">    /\.svg$/,</span><br><span class="line">    /\.eot$/,</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="About-the-Request-URL"><a href="#About-the-Request-URL" class="headerlink" title="About the Request URL"></a>About the Request URL</h3><p>The images are cached in <code>/dist/static/*</code>, while the request url is <code>/static/*</code>.</p><p>In dev it can be proxied by webpack.</p><p>In prod it can be delegated by nginx.</p><p>But the plugin can fix it by itself:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> SWPrecachePlugin(&#123;</span><br><span class="line">  cacheId: <span class="string">'demo'</span>,</span><br><span class="line">  filename: <span class="string">'service-worker.js'</span>,</span><br><span class="line">  minify: <span class="literal">true</span>,</span><br><span class="line">  mergeStaticConfig: <span class="literal">true</span>,</span><br><span class="line">  staticFileGlobs: [</span><br><span class="line">    path.join(__dirname, <span class="string">'../dist/static/*.*'</span>)</span><br><span class="line">  ],</span><br><span class="line">  stripPrefixMulti: &#123;</span><br><span class="line">    [path.join(__dirname, <span class="string">'../dist/static'</span>)]: <span class="string">'/static'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  dontCacheBustUrlsMatching: <span class="literal">false</span>,</span><br><span class="line">  staticFileGlobsIgnorePatterns: [</span><br><span class="line">    /\.index\.html$/,</span><br><span class="line">    /\.map$/,</span><br><span class="line">    /\.css$/,</span><br><span class="line">    /\.svg$/,</span><br><span class="line">    /\.eot$/,</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><blockquote><p>Note: <code>dontCacheBustUrlsMatching: false</code> will set cached key as <code>http://domain/path/to/filename?hash</code>, whose hash will change if the bundled file changed.</p></blockquote>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Snippets of Nginx</title>
      <link href="/2017/09/03/snippets-of-Nginx/"/>
      <content type="html"><![CDATA[<h3 id="nginx-conf"><a href="#nginx-conf" class="headerlink" title="nginx.conf"></a>nginx.conf</h3><p>One <code>server{}</code> for a site service.</p><p>Use <code>location</code> to specify router of requests.</p><p><code>proxy_pass target</code> to delegate inverse .</p><p><code>root dir</code> to specify static files directory.</p><p><code>server_name</code> to set domains whose requests will be handled.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a node server listening to 3000</span></span><br><span class="line"><span class="comment">// handle requests from example.com</span></span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">  listen: <span class="number">80</span>;</span><br><span class="line">  server_name: example.com;</span><br><span class="line">    location / &#123;</span><br><span class="line">      index index.html;</span><br><span class="line">      root: <span class="regexp">/public/</span>;</span><br><span class="line">      proxy_pass http:<span class="comment">//location:3000</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Gzip"><a href="#Gzip" class="headerlink" title="Gzip"></a>Gzip</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gzip on;</span><br><span class="line">gzip_proxied any;</span><br><span class="line">gzip_min_length 1024;</span><br><span class="line">gzip_buffers 4 8k;</span><br><span class="line">gzip_types text/css application/javascript application/atom+xml application/rss+xml text/plain image/svg+xml application/json text/javascript;</span><br></pre></td></tr></table></figure><h3 id="CORS"><a href="#CORS" class="headerlink" title="CORS"></a>CORS</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen: <span class="number">80</span>;</span><br><span class="line">  server_name: example.com;</span><br><span class="line"></span><br><span class="line">  location / &#123;</span><br><span class="line">    add_header Access-Control-Allow-Origin: *;</span><br><span class="line">    add_header Access-Control_Allow_Credentials <span class="literal">true</span>;</span><br><span class="line">    add_header Access-Control-AllowMethods GET,POST,OPTIONS;</span><br><span class="line">    index index.html;</span><br><span class="line">    root: <span class="regexp">/public/</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="API-delegate"><a href="#API-delegate" class="headerlink" title="API delegate"></a>API delegate</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen: <span class="number">80</span>;</span><br><span class="line">  server_name: example.com;</span><br><span class="line"></span><br><span class="line">  location /api &#123;</span><br><span class="line">    proxy_pass: https:<span class="comment">//localhost:3000;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="HTTP-to-HTTPS"><a href="#HTTP-to-HTTPS" class="headerlink" title="HTTP to HTTPS"></a>HTTP to HTTPS</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen: <span class="number">80</span>;</span><br><span class="line">  server_name: example.com, *.example.com;</span><br><span class="line"></span><br><span class="line">  location / &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">301</span> https:<span class="comment">//$host$request_uri;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">  listen: <span class="number">443</span> ssl;</span><br><span class="line">  server_name example.com;</span><br><span class="line">  ssl_certificate /crts/crt.pem; <span class="comment">// add the certificate</span></span><br><span class="line">  ssl_certificate_key /crts/key.pem</span><br><span class="line">    location / &#123;</span><br><span class="line">      index index.html;</span><br><span class="line">      root: <span class="regexp">/public/</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Manipulate Data in D3</title>
      <link href="/2017/08/31/Manipulate-Data-in-D3/"/>
      <content type="html"><![CDATA[<h3 id="Use-data-imported-from-a-csv-file-with-spaces-in-the-header"><a href="#Use-data-imported-from-a-csv-file-with-spaces-in-the-header" class="headerlink" title="Use data imported from a csv file with spaces in the header"></a>Use data imported from a csv file with spaces in the header</h3><p>When importing data from a csv file(dataSpace.csv) that has headers with spaces in the middle of some of the fields there is need to address the data slightly differently in order for it to be used easily in your JavaScript.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Date Purchased,close</span><br><span class="line">1-May-12,58.13</span><br></pre></td></tr></table></figure><p>When we go to import the data using the d3.csv function, we need to reference the <code>Data Purchased</code> column in a way that makes allowances for the space. The following piece of script appears to be the most basic solution.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">d3.csv(<span class="string">'dataSpace.csv'</span>, (err, data) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">  data.forEach(<span class="function"><span class="params">d</span> =&gt;</span> &#123;</span><br><span class="line">    d.date = parseTime(d[<span class="string">'Date Purchased'</span>])</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Histogram"><a href="#Histogram" class="headerlink" title="Histogram"></a>Histogram</h3><p>The <code>d3.histogram</code> function allows us to form our data into âbinsâ that form <em>âdiscrete samples into continous, non-overlapping intervalsâ</em>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// dtg,value</span></span><br><span class="line"><span class="comment">// 01-08-2010,3</span></span><br><span class="line"><span class="comment">// 01-08-2010,3</span></span><br><span class="line"><span class="comment">// 01-08-2010,3</span></span><br><span class="line"><span class="comment">// 01-08-2010,3</span></span><br><span class="line"><span class="comment">// 01-08-2010,3.1</span></span><br><span class="line"><span class="comment">// 01-08-2010,3.2</span></span><br><span class="line"><span class="comment">// 01-08-2010,3.2</span></span><br><span class="line"><span class="comment">// .</span></span><br><span class="line"><span class="comment">// .</span></span><br><span class="line"><span class="comment">// .</span></span><br><span class="line"><span class="comment">// 31-12-2011,3.2</span></span><br><span class="line"><span class="comment">// 31-12-2011,3.3</span></span><br><span class="line"><span class="comment">// 31-12-2011,3.4</span></span><br><span class="line"><span class="comment">// 31-12-2011,3.5</span></span><br><span class="line"><span class="comment">// 31-12-2011,3.5</span></span><br><span class="line"><span class="comment">// 31-12-2011,4.1</span></span><br><span class="line"><span class="comment">// 31-12-2011,4.9</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// core code</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> parseDate = d3.timeParser(<span class="string">'%d-%m-%Y'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> xScale = d3.scaleTime()</span><br><span class="line">    .domain([<span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">2010</span>, <span class="number">6</span>, <span class="number">3</span>), <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">2012</span>, <span class="number">0</span>, <span class="number">1</span>)])</span><br><span class="line">    .rangeRound([, width])</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> yScale = d3.scaleLinear()</span><br><span class="line">    .range([height, <span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> histogram = h3.histogram()</span><br><span class="line">    .value(<span class="function"><span class="params">d</span> =&gt;</span> d.date)</span><br><span class="line">    .domain(xScale.domain())</span><br><span class="line">    .thresholds(x.ticks.timeMonth)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> _data = data.map(<span class="function"><span class="params">d</span> =&gt;</span> (&#123;</span><br><span class="line">  date: parseDate(d.dtg),</span><br><span class="line">  value: d.value,</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> bins = histogram(_data)</span><br><span class="line"></span><br><span class="line">holder.selectAll(<span class="string">'rect'</span>)</span><br><span class="line">    .data(bins)</span><br><span class="line">  .enter().append(<span class="string">'rect'</span>)</span><br><span class="line">    .attr(<span class="string">'class'</span>, <span class="string">'bar'</span>)</span><br><span class="line">    .attr(<span class="string">'x'</span>, <span class="number">1</span>)</span><br><span class="line">    .attr(<span class="string">'transform'</span>, d =&gt; <span class="string">`translate(<span class="subst">$&#123;xScale(d.x0)&#125;</span>, <span class="subst">$&#123;yScale(d.length)&#125;</span>)`</span>)</span><br><span class="line">    .attr(<span class="string">'width'</span>, d =&gt; (xScale(d.x1 - d.x0) - <span class="number">1</span>))</span><br><span class="line">    .attr(<span class="string">'height'</span>, d =&gt; (height - yScale(d.length)))</span><br></pre></td></tr></table></figure><p>The key line</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> bins = histogram(_data)</span><br></pre></td></tr></table></figure><p>groups the data for the bars.</p><h3 id="Tree-Diagram"><a href="#Tree-Diagram" class="headerlink" title="Tree Diagram"></a>Tree Diagram</h3><p>The data requied to produce this type of layout needs to describe the relationships, but this is not necessary an onerous task.</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"Top Node"</span>,</span><br><span class="line">    <span class="attr">"children"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"Bob: Child of Top Node"</span>,</span><br><span class="line">        <span class="attr">"children"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"Son of Bob"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"Daughter of Bob"</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"Sally: Child of Top Node"</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// core code</span></span><br><span class="line"><span class="keyword">const</span> treeData = &#123;</span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"Top Level"</span>,</span><br><span class="line">  <span class="string">"children"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"name"</span>: <span class="string">"Level 2: A"</span>,</span><br><span class="line">      <span class="string">"children"</span>: [</span><br><span class="line">        &#123; <span class="string">"name"</span>: <span class="string">"Son of A"</span> &#125;,</span><br><span class="line">        &#123; <span class="string">"name"</span>: <span class="string">"Daughter of A"</span> &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123; <span class="string">"name"</span>, <span class="string">"Leve 2: B"</span>&#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> margin = &#123;</span><br><span class="line">  top: <span class="number">40</span>,</span><br><span class="line">  right: <span class="number">30</span>,</span><br><span class="line">  bottom: <span class="number">50</span>,</span><br><span class="line">  left: <span class="number">30</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> width = <span class="number">660</span> - margin.left - margin.right</span><br><span class="line"><span class="keyword">const</span> height = <span class="number">500</span> - margin.top - margin.bottom</span><br><span class="line"></span><br><span class="line"><span class="comment">// declare a tree layout and assigns the size</span></span><br><span class="line"><span class="keyword">const</span> treemap = d3.tree()</span><br><span class="line">    .size([width, height])</span><br><span class="line"></span><br><span class="line"><span class="comment">// assigns the node data to the tree layout</span></span><br><span class="line"><span class="keyword">let</span> nodes = d3.hierarchy(treeData)</span><br><span class="line"></span><br><span class="line"><span class="comment">// map the node data to the tree layout</span></span><br><span class="line">nodes = treemap(nodes)</span><br><span class="line"></span><br><span class="line"><span class="comment">// append the svg object to the body of the page</span></span><br><span class="line"><span class="comment">// append a 'group' element to 'svg'</span></span><br><span class="line"><span class="comment">// move the 'groupd' element to the top left margin</span></span><br><span class="line"><span class="keyword">const</span> svg = d3.select(<span class="string">'body'</span>).append(<span class="string">'svg'</span>)</span><br><span class="line">    .attr(<span class="string">'width'</span>, width + margin.left + margin.right)</span><br><span class="line">    .attr(<span class="string">'height'</span>, height + margin.top + margin.bottom)</span><br><span class="line"><span class="keyword">const</span> g = svg.append(<span class="string">'g'</span>)</span><br><span class="line">    .attr(<span class="string">'transform'</span>, <span class="string">`translate(<span class="subst">$&#123;margin.left&#125;</span>, <span class="subst">$&#123;margin.top&#125;</span>)`</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// add links between nodes</span></span><br><span class="line"><span class="keyword">const</span> link = g.selectAll(<span class="string">'.link'</span>)</span><br><span class="line">    .data(nodes.descendants().slice(<span class="number">1</span>))</span><br><span class="line">  .enter().append(<span class="string">'path'</span>)</span><br><span class="line">    .attr(<span class="string">'class'</span>, <span class="string">'link'</span>)</span><br><span class="line">    .attr(<span class="string">'d'</span>, d =&gt; &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">`M<span class="subst">$&#123;d.x&#125;</span>,<span class="subst">$&#123;d.y&#125;</span>C<span class="subst">$&#123;d.x&#125;</span>,<span class="subst">$&#123;(d.y + d.parent.y) <span class="regexp">/ 2&#125; $&#123;d.parent.x&#125;,$&#123;(d.y + d.parent.y) /</span> <span class="number">2</span>&#125;</span> <span class="subst">$&#123;d.parent.x&#125;</span>,<span class="subst">$&#123;d.parent.y&#125;</span>`</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// add each node as a group</span></span><br><span class="line"><span class="keyword">const</span> node = g.selectAll(<span class="string">'.node'</span>)</span><br><span class="line">    .data(nodes.descendants())</span><br><span class="line">  .enter().append(<span class="string">'circle'</span>)</span><br><span class="line">    .attr(<span class="string">'class'</span>, d =&gt; &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">`node <span class="subst">$&#123;d.children ? <span class="string">'node--internal'</span> : <span class="string">'node--leaf'</span>&#125;</span>`</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .attr(<span class="string">'transform'</span>, d =&gt; &#123;</span><br><span class="line">      <span class="string">`translate(<span class="subst">$&#123;d.x&#125;</span>, <span class="subst">$&#123;d.y&#125;</span>)`</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// add the circle to node</span></span><br><span class="line">node.append(<span class="string">'circle'</span>)</span><br><span class="line">    .attr(<span class="string">'r'</span>, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// add the text to the node</span></span><br><span class="line">node.append(<span class="string">'text'</span>)</span><br><span class="line">    .attr(<span class="string">'dy'</span>, <span class="string">'0.35em'</span>)</span><br><span class="line">    .attr(<span class="string">'y'</span>, d =&gt; (d.children ? <span class="number">-20</span> : <span class="number">20</span>))</span><br><span class="line">    .style(<span class="string">'text-anchor'</span>, <span class="string">'middle'</span>)</span><br><span class="line">    .text(<span class="function"><span class="params">d</span> =&gt;</span> d.data.name)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// declare a tree layout and assign the size</span></span><br><span class="line"><span class="keyword">const</span> treemap = d3.tree()</span><br><span class="line">    .size([width, height])</span><br><span class="line"></span><br><span class="line"><span class="comment">// assign the data to a hierarchy using parent-child relationships</span></span><br><span class="line"><span class="keyword">let</span> nodes = d3.hierarchy(treeData)</span><br><span class="line"></span><br><span class="line"><span class="comment">// maps the node data to the tree layout</span></span><br><span class="line">nodes = treemap(nodes)</span><br></pre></td></tr></table></figure><h5 id="d3-hierarchy"><a href="#d3-hierarchy" class="headerlink" title="d3.hierarchy"></a>d3.hierarchy</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> nodes = d3.hierarchy(treeData, d =&gt; d.children)</span><br></pre></td></tr></table></figure><p>This assigns a range of properties to each node including:</p><ul><li><p><code>node.data</code> - the data assocaited with the node(in our case it will include the name accessible as <code>node.data.name</code>).</p></li><li><p><code>node.depth</code> - a representation of the depth or number of hops from the initial root node.</p></li><li><p><code>node.height</code> - the greatest distance from any descendants leaf nodes.</p></li><li><p><code>node.parent</code> - the parent node, or null if itâs the root node.</p></li><li><p><code>node.children</code> - child nodes or undefined for any leaf nodes.</p></li></ul><p>Above is the vertical tree map code.</p><p>If you want a horizontal tree map, you can make a transform like this.</p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/htree-02.png" alt=""></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/htree-03.png" alt=""></p><p>Or</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.attr(<span class="string">'d'</span>, d =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">  M<span class="subst">$&#123;d.y&#125;</span>,<span class="subst">$&#123;d.x&#125;</span></span></span><br><span class="line"><span class="string">  C<span class="subst">$&#123;(d.y + d.parent.y)<span class="regexp">/2&#125;,$&#123;d.x&#125;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">  $&#123;(d.y + d.parent.y)/</span><span class="number">2</span>&#125;</span>,<span class="subst">$&#123;d.parent.x&#125;</span></span></span><br><span class="line"><span class="string">  <span class="subst">$&#123;d.parent.y&#125;</span>,<span class="subst">$&#123;d.parent.x&#125;</span></span></span><br><span class="line"><span class="string">  `</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">.attr(<span class="string">'transform'</span>, d =&gt; <span class="string">`translate(<span class="subst">$&#123;d.y&#125;</span>, <span class="subst">$&#123;d.x&#125;</span>)`</span>)</span><br></pre></td></tr></table></figure><p>Add Images as Node</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">node.append(<span class="string">'image'</span>)</span><br><span class="line">    .attr(<span class="string">'xlink:href'</span>, d =&gt; d.data.icon)</span><br><span class="line">    .attr(<span class="string">'x'</span>, <span class="string">'-12px'</span>)</span><br><span class="line">    .attr(<span class="string">'y'</span>, <span class="string">'-12px'</span>)</span><br><span class="line">    .attr(<span class="string">'width'</span>, <span class="string">'24px'</span>)</span><br><span class="line">    .attr(<span class="string">'height'</span>, <span class="string">'24px'</span>)</span><br></pre></td></tr></table></figure><p>Add Interaction on Node</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">click</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (d.children) &#123;</span><br><span class="line">    d._children = d.children</span><br><span class="line">    d.chilren = <span class="literal">null</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    d.children = d._children</span><br><span class="line">    d._children = <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">  upate(d)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Sankey-Diagrams"><a href="#Sankey-Diagrams" class="headerlink" title="Sankey Diagrams"></a>Sankey Diagrams</h3><p>// Todo</p><h3 id="Assorted-Tips-and-Tricks"><a href="#Assorted-Tips-and-Tricks" class="headerlink" title="Assorted Tips and Tricks"></a>Assorted Tips and Tricks</h3><h4 id="Events"><a href="#Events" class="headerlink" title="Events"></a>Events</h4><ul><li><p><code>mousedown</code></p></li><li><p><code>mouseup</code></p></li><li><p><code>mouseover</code></p></li><li><p><code>mouseout</code></p></li><li><p><code>mousemove</code></p></li><li><p><code>click</code></p></li><li><p><code>contextmenu</code></p></li><li><p><code>dblclick</code></p></li></ul><h4 id="Add-Tooltips"><a href="#Add-Tooltips" class="headerlink" title="Add Tooltips"></a>Add Tooltips</h4><p>Tooltips have a marvellous duality. They are on one hand a pretty darned useful thing that aids in giving context and information where required and on the other hand, if done with a bit of care they can look stylish.</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span><span class="selector-class">.tooltip</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">60px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">28px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">2px</span>;</span><br><span class="line">  <span class="attribute">font</span>: <span class="number">12px</span> sans-serif;</span><br><span class="line">  <span class="attribute">background</span>: lightsteelblue;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">0px</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">8px</span>;</span><br><span class="line">  <span class="attribute">pointer-events</span>: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> div = d3.select(<span class="string">'body'</span>).append(<span class="string">'div'</span>).attr(<span class="string">'class'</span>, <span class="string">'tooltip'</span>)</span><br><span class="line">.style(<span class="string">'opacity'</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">svg.selectAll(<span class="string">"circle"</span>)</span><br><span class="line">   .data(data)</span><br><span class="line"> .enter().append(<span class="string">"circle"</span>)</span><br><span class="line">   .attr(<span class="string">"r"</span>, <span class="number">5</span>)</span><br><span class="line">   .attr(<span class="string">"cx"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> x(d.date); &#125;)</span><br><span class="line">   .attr(<span class="string">"cy"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> y(d.close); &#125;)</span><br><span class="line">   .on(<span class="string">"mouseover"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123;</span><br><span class="line">     div.transition()</span><br><span class="line">       .duration(<span class="number">200</span>)</span><br><span class="line">       .style(<span class="string">"opacity"</span>, <span class="number">.9</span>);</span><br><span class="line">     div.html(formatTime(d.date) + <span class="string">"&lt;br/&gt;"</span> + d.close)</span><br><span class="line">       .style(<span class="string">"left"</span>, (d3.event.pageX) + <span class="string">"px"</span>)</span><br><span class="line">       .style(<span class="string">"top"</span>, (d3.event.pageY - <span class="number">28</span>) + <span class="string">"px"</span>);</span><br><span class="line">     &#125;)</span><br><span class="line">   .on(<span class="string">"mouseout"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123;</span><br><span class="line">     div.transition()</span><br><span class="line">       .duration(<span class="number">500</span>)</span><br><span class="line">       .style(<span class="string">"opacity"</span>, <span class="number">0</span>);</span><br><span class="line">     &#125;)</span><br></pre></td></tr></table></figure><p>Notice there is only one tooltip exist in the page.</p><h3 id="Selecting-Filtering-a-subset-of-objects"><a href="#Selecting-Filtering-a-subset-of-objects" class="headerlink" title="Selecting/Filtering a subset of objects"></a>Selecting/Filtering a subset of objects</h3><p>Filtering is fairly simple.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">svg.selectAll(<span class="string">'circle'</span>)</span><br><span class="line">    .data(data)</span><br><span class="line">  .enter().append(<span class="string">'circle'</span>)</span><br><span class="line">    .filter(<span class="function"><span class="params">d</span> =&gt;</span> d.close &lt; <span class="number">400</span>)</span><br><span class="line">    .style(<span class="string">'fill'</span>, <span class="string">'red'</span>)</span><br><span class="line">    .attr(<span class="string">'r'</span>, <span class="number">5</span>)</span><br><span class="line">    .attr(<span class="string">'cx'</span>, d =&gt; xScale(d.date))</span><br><span class="line">    .attr(<span class="string">'cy'</span>, d =&gt; yScale(d.close))</span><br></pre></td></tr></table></figure><h4 id="Select-Items-with-an-IF-statement"><a href="#Select-Items-with-an-IF-statement" class="headerlink" title="Select Items with an IF statement"></a>Select Items with an IF statement</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.style(<span class="string">"fill"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123;   </span><br><span class="line">  <span class="keyword">if</span> (d.close &lt;= <span class="number">400</span>) &#123;<span class="keyword">return</span> <span class="string">"red"</span>&#125;  </span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (d.close &gt;= <span class="number">620</span>) &#123;<span class="keyword">return</span> <span class="string">"lawngreen"</span>&#125; <span class="comment">// &lt;== Right here</span></span><br><span class="line">  <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="string">"black"</span> &#125;  </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="Applying-a-color-gradient-to-a-line-based-on-value"><a href="#Applying-a-color-gradient-to-a-line-based-on-value" class="headerlink" title="Applying a color gradient to a line based on value"></a>Applying a color gradient to a line based on value</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.line</span> &#123;</span><br><span class="line">  <span class="attribute">fill</span>: none;</span><br><span class="line">  <span class="attribute">stroke</span>: <span class="built_in">url</span>(#line-gradient);</span><br><span class="line">  <span class="attribute">stroke-width</span>: <span class="number">2px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// set the gradient</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// add linear gradient element</span></span><br><span class="line">svg.append(<span class="string">'linearGradent'</span>)</span><br><span class="line"><span class="comment">// add id for css anchor</span></span><br><span class="line">    .attr(<span class="string">'id'</span>, <span class="string">'line-gradient'</span>)</span><br><span class="line">    .attr(<span class="string">'gradientUnits'</span>, <span class="string">'userSpaceOnUse'</span>)</span><br><span class="line"><span class="comment">// use x1, y1, x2, y2 to define the bounds of the area over which the gradient will act.</span></span><br><span class="line"><span class="comment">// here we set x1, x2 to the same value so the gradient won't act on x direction.</span></span><br><span class="line">    .attr(<span class="string">'x1'</span>, <span class="number">0</span>).attr(<span class="string">'y1'</span>, yScale(<span class="number">0</span>))</span><br><span class="line">    .attr(<span class="string">'x2'</span>, <span class="number">0</span>).attr(<span class="string">'y2'</span>, yScale(<span class="number">1000</span>))</span><br><span class="line"><span class="comment">// select all 'stop' elements for the gradients, these 'stop' elements define where on the range covered by our coordinates the color start and stop(percent or decimal)</span></span><br><span class="line">  .selectAll(<span class="string">'stop'</span>)</span><br><span class="line">    .data([</span><br><span class="line">      &#123;<span class="attr">offset</span>: <span class="string">'0%'</span>, <span class="attr">color</span>: <span class="string">'red'</span>&#125;,</span><br><span class="line">      &#123;<span class="attr">offset</span>: <span class="string">'40%'</span>, <span class="attr">color</span>: <span class="string">'red'</span>&#125;,</span><br><span class="line">      &#123;<span class="attr">offset</span>: <span class="string">'40%'</span>, <span class="attr">color</span>: <span class="string">'black'</span>&#125;,</span><br><span class="line">      &#123;<span class="attr">offset</span>: <span class="string">'62%'</span>, <span class="attr">color</span>: <span class="string">'black'</span>&#125;,</span><br><span class="line">      &#123;<span class="attr">offset</span>: <span class="string">'62%'</span>, <span class="attr">color</span>: <span class="string">'lawngreen'</span>&#125;,</span><br><span class="line">      &#123;<span class="attr">offset</span>: <span class="string">'62%'</span>, <span class="attr">color</span>: <span class="string">'lawngreen'</span>&#125;,</span><br><span class="line">      &#123;<span class="attr">offset</span>: <span class="string">'100%'</span>, <span class="attr">color</span>: <span class="string">'lawngreen'</span>&#125;,</span><br><span class="line">    ])</span><br><span class="line">  .enter().append(<span class="string">'stop'</span>)</span><br><span class="line">    .attr(<span class="string">'offset'</span>, d =&gt; d.offset)</span><br><span class="line">    .attr(<span class="string">'stop-color'</span>, d =&gt; d.color)</span><br></pre></td></tr></table></figure><p>There is our anchor on the third line.</p><p>If you want to apply the gradient on area, simply change the css</p><p><code>`</code>css<br>.area {<br>  fill: url(#area-gradient);<br>  stroke-width: 0px;<br>}</p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Styles in D3</title>
      <link href="/2017/08/31/Styles-in-D3/"/>
      <content type="html"><![CDATA[<h3 id="fill"><a href="#fill" class="headerlink" title="fill"></a>fill</h3><p>The <code>fill</code> style will fill the element being presented with a specifed color.</p><p>By default, most element will be filled with black.</p><h3 id="stroke"><a href="#stroke" class="headerlink" title="stroke"></a>stroke</h3><p>The <code>stroke</code> style applies a color to lines</p><h3 id="opacity"><a href="#opacity" class="headerlink" title="opacity"></a>opacity</h3><p>The <code>opacity</code> style has the effect of varying an elementâs transparency.</p><p>The valid range for <code>opacity</code> is from 0 to 1.</p><p>We should make the distinction at this point that <code>opacity</code> affects the entire element, whereas the following <code>fill-opacity</code> and <code>stroke-opacity</code> affect only the fill and stroke respectively.</p><h3 id="fill-opacity"><a href="#fill-opacity" class="headerlink" title="fill-opacity"></a>fill-opacity</h3><p>The <code>fill-opacity</code> style changes the transparency of the fill of an element.</p><h3 id="stroke-opacity"><a href="#stroke-opacity" class="headerlink" title="stroke-opacity"></a>stroke-opacity</h3><p>The <code>stroke-opacity</code> style changes the transparency of the stroke of an element.</p><h3 id="stroke-width"><a href="#stroke-width" class="headerlink" title="stroke-width"></a>stroke-width</h3><p>The <code>stroke-width</code> style adjusts the width of the line of an element.</p><p>The value specified when setting <code>stroke-width</code> in pixels.</p><h3 id="stroke-dasharray"><a href="#stroke-dasharray" class="headerlink" title="stroke-dasharray"></a>stroke-dasharray</h3><p>The <code>stroke-dasharray</code> style allows us to form element lines with dashes instead of solid lines.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.style(<span class="string">'stroke-dasharray'</span>, (<span class="string">'10, 3'</span>))</span><br></pre></td></tr></table></figure><h3 id="stroke-linecap"><a href="#stroke-linecap" class="headerlink" title="stroke-linecap"></a>stroke-linecap</h3><p>The <code>stroke-linecap</code> style allows control of the shape of the ends of lines.</p><p>There are three shape options:</p><ul><li><p><code>butt</code>: The line simply butts up to the starting or ending position and is cut off squarely.</p></li><li><p><code>round</code>: The line is rounded in propotionto its width.</p></li><li><p><code>square</code>: The line is squared off but exnteded in propotion to its width.</p></li></ul><h3 id="stroke-linejoin"><a href="#stroke-linejoin" class="headerlink" title="stroke-linejoin"></a>stroke-linejoin</h3><p>The <code>stroke-linejoin</code> style specifies the shape of the join of two lines. This would be used on <code>path</code>, <code>polyline</code> and <code>polygon</code>.</p><p>There are three line join options:</p><ul><li><p><code>miter</code>: The join is squared off as would be expected at the join of two lines.</p></li><li><p><code>round</code>: The outside portion of the join is rounded in proportion to its width.</p></li><li><p><code>bevel</code>: The join has a straight edged outer portion clipped off to provide a slightly more contoured effect while still being regular.</p></li></ul><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/EAS-41.png" alt="miter"></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/EAS-39.png" alt="round"></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/EAS-40.png" alt="bevel"></p><h3 id="writing-mode"><a href="#writing-mode" class="headerlink" title="writing-mode"></a>writing-mode</h3><p>The <code>writing-mode</code> style changes the orientation of the text so that it prints out top to bottom.</p><p>It has a single option âtbâ that accomplishes this.</p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/EAS-42.png" alt=""></p><h3 id="glyph-orientation-vertical"><a href="#glyph-orientation-vertical" class="headerlink" title="glyph-orientation-vertical"></a>glyph-orientation-vertical</h3><p>The <code>glyph-orientation-vertical</code> style changes the rotation of the individual glyphs(characters) in text and if used in conjunction with the <code>writing-mode</code> style (and set to 0) will allow the text to be displayed vertically with the letters orientation vertically as well.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">holder.append(<span class="string">'text'</span>)</span><br><span class="line">    .style(<span class="string">'fill'</span>, <span class="string">'black'</span>)</span><br><span class="line">    .style(<span class="string">'writing-mode'</span>, <span class="string">'tb'</span>)</span><br><span class="line">    .style(<span class="string">'glyph-orientation-vertical'</span>, <span class="number">0</span>)</span><br><span class="line">    .attr(<span class="string">'x'</span>, <span class="number">200</span>)</span><br><span class="line">    .attr(<span class="string">'y'</span>, <span class="number">100</span>)</span><br><span class="line">    .text(<span class="string">'Hello World'</span>)</span><br></pre></td></tr></table></figure><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/EAS-43.png" alt=""></p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Attributes in D3</title>
      <link href="/2017/08/30/Attributes-in-D3/"/>
      <content type="html"><![CDATA[<h3 id="x-y"><a href="#x-y" class="headerlink" title="x/y"></a>x/y</h3><p>The <code>x</code> and <code>y</code> attributes are used to designate a position on the web page. Use the <code>x</code> and <code>y</code> attributes places the anchor points for these elements at a specified location.</p><h3 id="x1-y1-x2-y2"><a href="#x1-y1-x2-y2" class="headerlink" title="x1, y1, x2, y2"></a>x1, y1, x2, y2</h3><p>The <code>x1</code>, <code>y1</code>, <code>x2</code>, <code>y2</code> attributes are used to designate the position of two points on the web page. These two points are connected with a line as part of the <code>line</code> element.</p><h3 id="points"><a href="#points" class="headerlink" title="points"></a>points</h3><p>The <code>points</code> attribute is used to set a series of points which are subsequently connected with a line and/or which may form the bounds of a shape. These are specifically associated with the <code>polyline</code> and <code>polygon</code> elements.</p><p>The data for the points is entered as a sequence of x,y points in the following format:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.attr(<span class="string">'points'</span>, <span class="string">'100,50, 150,150, 150,50'</span>)</span><br></pre></td></tr></table></figure><h3 id="cx-cy"><a href="#cx-cy" class="headerlink" title="cx, cy"></a>cx, cy</h3><p>The <code>cx</code>, <code>cy</code> attributes are associated with the circle and ellipse elements and designate the center of each shape.</p><ul><li><p><code>cx</code>: The position of the center of the element in the x axis.</p></li><li><p><code>cy</code>: The position of the center of the element in the y axis.</p></li></ul><h3 id="rx-ry"><a href="#rx-ry" class="headerlink" title="rx, ry"></a>rx, ry</h3><p>The <code>rx</code>, <code>ry</code> attributes are associated with the ellipse element and designate the radius in the x and y directions.</p><ul><li><p><code>rx</code>: The radius of the ellipse in the x direction.</p></li><li><p><code>ry</code>: The radius of the ellipse in the y direction.</p></li></ul><h3 id="transform-translate-x-y-scale-k-rotate-a"><a href="#transform-translate-x-y-scale-k-rotate-a" class="headerlink" title="transform(translate(x, y), scale(k), rotate(a))"></a>transform(translate(x, y), scale(k), rotate(a))</h3><ul><li><p><code>translate(x, y)</code>: move the element by a relative value in x and y directions.</p></li><li><p><code>scale(k)</code>: Increase or reduce the element by a specified factor.</p></li><li><p><code>rotate(a)</code>: Rotate the element by an angular value.</p></li></ul><p>All transform are applied based on the origin of (0, 0).</p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/EAS-23.png" alt=""></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/EAS-24.png" alt="rotate(10)"></p><p>So youâd better use transform like this:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">holder.append(<span class="string">'text'</span>)</span><br><span class="line">    .style(<span class="string">'fill'</span>, <span class="string">'black'</span>)</span><br><span class="line">    .attr(<span class="string">'dy'</span>, <span class="string">'0.35em'</span>)</span><br><span class="line">    .attr(<span class="string">'text-anchor'</span>, <span class="string">'middle'</span>)</span><br><span class="line">    .attr(<span class="string">'transform'</span>, <span class="string">'translate(200, 100) rotate(10) scale(2)'</span>)</span><br><span class="line">    .text(<span class="string">'Hello World'</span>)</span><br></pre></td></tr></table></figure><h3 id="width-height"><a href="#width-height" class="headerlink" title="width, height"></a>width, height</h3><p><code>width</code> and <code>height</code> are required attributes of the rectagule element, <code>width</code> designates the width of the rectangle and <code>height</code> designates the height.</p><h3 id="text-anchor"><a href="#text-anchor" class="headerlink" title="text-anchor"></a>text-anchor</h3><p>The <code>text-anchor</code> attribute determines the justification of a text element. You can set it to <code>start</code>, <code>middle</code>, or <code>end</code>.</p><h3 id="dx-dy"><a href="#dx-dy" class="headerlink" title="dx, dy"></a>dx, dy</h3><p><code>dx</code> and <code>dy</code> are optional attributes that designate an offset of text elements from the anchor point in the x and y directions.</p><h3 id="textLength"><a href="#textLength" class="headerlink" title="textLength"></a>textLength</h3><p>The <code>textLength</code> attribute adjusts the length of the text element to fix a specified value.</p><h3 id="lenghtAdjust"><a href="#lenghtAdjust" class="headerlink" title="lenghtAdjust"></a>lenghtAdjust</h3><p>The <code>lengthAdjust</code> attribute allows the <code>textLength</code> attribute to have the spacing of a text element controlled to be either <code>spacing</code> or <code>spacingAndGlyphs</code>.</p><ul><li><p><code>spacing</code>: In thi soption the letters remain the same size, but the spacing between the letters and words are adjusted.</p></li><li><p><code>spacingAndGlyphs</code>: In this option the text is stretched or squeezed to fit.</p></li></ul>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Basic Elements in D3</title>
      <link href="/2017/08/30/Basic-Elements-in-D3/"/>
      <content type="html"><![CDATA[<h3 id="Circle"><a href="#Circle" class="headerlink" title="Circle"></a>Circle</h3><ul><li><p><code>cx</code>: The position of the center of the circle in the x direction.</p></li><li><p><code>cy</code>: The position of the center of the circle in the y direction.</p></li><li><p><code>r</code>: The radius of the circle from the <code>cx</code>, <code>cy</code> position to the perimeter of the circle.</p></li></ul><h3 id="Ellipse"><a href="#Ellipse" class="headerlink" title="Ellipse"></a>Ellipse</h3><ul><li><p><code>cx</code>: The position of the center of the ellipse in the x direction.</p></li><li><p><code>cy</code>: The position of the center of the ellipse in the y direction.</p></li><li><p><code>rx</code>: The radius of the ellipse in the x dimension.</p></li><li><p><code>ry</code>: The radius of the ellipse in the y dimension.</p></li></ul><h3 id="Rectangle"><a href="#Rectangle" class="headerlink" title="Rectangle"></a>Rectangle</h3><ul><li><p><code>x</code>: The position on the x axis of the left hand side of the rectangle.</p></li><li><p><code>y</code>: The position on the y axis of the top hand side of the rectangle.</p></li><li><p><code>width</code>: the width in pixel of the rectangle.</p></li><li><p><code>height</code>: the height in pixel of the rectangle.</p></li><li><p><code>rx</code>: the radius curve of the corner of the rectangle in the x dimension</p></li><li><p><code>ry</code>: The radius curve of the corner of the rectangle in the y dimension.</p></li></ul><h3 id="Line"><a href="#Line" class="headerlink" title="Line"></a>Line</h3><ul><li><p><code>x1</code>: The x position of the first end of the line.</p></li><li><p><code>y1</code>: The y position of the first end of the line.</p></li><li><p><code>x2</code>: The x position of the second end of the line.</p></li><li><p><code>y2</code>: The y position of the second end of the line.</p></li></ul><h3 id="polyline"><a href="#polyline" class="headerlink" title="polyline"></a>polyline</h3><p>A polyline is a sequence of connected lines described with a single attribute <code>points</code>.</p><ul><li><code>points</code>: The <code>points</code> attribute is a list of x,y coordinates that are the locations of the connecting points of the polyline.</li></ul><h3 id="polygon"><a href="#polygon" class="headerlink" title="polygon"></a>polygon</h3><p>A polygon is a sequnce of connected lines which form a closed shaped described with a single attribte <code>points</code></p><ul><li><code>points</code>: The <code>points</code> attribute is a list of x,y coordinates that are the locations of the connecting points of the polygon.</li></ul><h3 id="Path"><a href="#Path" class="headerlink" title="Path"></a>Path</h3><p>A path is an outline of an SVG shape which is described with a âmini-languageâ inside a single attribute.</p><ul><li><code>d</code>: This attribute is a list of instructions that allow a shape to be drawn in a complex way using a âmini-languageâ of command. These commands are written in a shorthand of single letters such a <code>M</code>-moveto, <code>Z</code>-closepath, <code>L</code>-lineto, <code>C</code>-curveto.</li></ul><h3 id="Clipped-Path-AKA-clipPath"><a href="#Clipped-Path-AKA-clipPath" class="headerlink" title="Clipped Path(AKA clipPath)"></a>Clipped Path(AKA clipPath)</h3><p>A clipPath is the path of a SVG shape that can be used in combination with another shape to remove any parts of the combined shape that doesnât fall within the clipPath.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">holder.append(<span class="string">'clipPath'</span>)</span><br><span class="line">    .attr(<span class="string">'id'</span>, <span class="string">'ellipse-clip'</span>)</span><br><span class="line">  .append(<span class="string">'ellipse'</span>)</span><br><span class="line">    .attr(<span class="string">'cx'</span>, <span class="number">175</span>)</span><br><span class="line">    .attr(<span class="string">'cy'</span>, <span class="number">100</span>)</span><br><span class="line">    .attr(<span class="string">'rx'</span>, <span class="number">100</span>)</span><br><span class="line">    .attr(<span class="string">'ry'</span>, <span class="number">50</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">holder.append(<span class="string">'rect'</span>)</span><br><span class="line">    .attr(<span class="string">'x'</span>, <span class="number">125</span>)</span><br><span class="line">    .attr(<span class="string">'y'</span>, <span class="number">75</span>)</span><br><span class="line">    .attr(<span class="string">'clip-path'</span>, <span class="string">'url(#ellipse-clip)'</span>)</span><br><span class="line">    .style(<span class="string">'fill'</span>, <span class="string">'lightgrey'</span>)</span><br><span class="line">    .attr(<span class="string">'height'</span>, <span class="number">100</span>)</span><br><span class="line">    .attr(<span class="string">'width'</span>, <span class="number">200</span>)</span><br></pre></td></tr></table></figure><h3 id="Text"><a href="#Text" class="headerlink" title="Text"></a>Text</h3><p>A text element is an SVG object which is shaped as text. It is described by two required attributes and three optional ones.</p><ul><li><p><code>x</code>: This attribute designates the anchor point location for the text in the x dimension.</p></li><li><p><code>y</code>: This attribute designates the anchor point location for the text in the y dimension.</p></li><li><p><code>dx</code>: This attribute designates the offset of the text from the anchor point in the x dimension. (ususally set to 0.35em, 0.71em)</p></li><li><p><code>dy</code>: This attribute designates the offset of the text from the anchor point in the y dimension.</p></li><li><p><code>text-anchor</code>: This attribute controls the horizontal text alignment. It has three values: <code>start</code>, <code>middle</code>, <code>end</code>.</p></li></ul>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Things We Can Do With the Simple Graph of D3</title>
      <link href="/2017/08/30/Things-we-can-do-with-the-simple-Graph-of-D3/"/>
      <content type="html"><![CDATA[<p><a href="https://leanpub.com/d3-t-and-t-v4/read#axes" target="_blank" rel="noopener">origin</a></p><h3 id="Setting-up-and-configuring-the-Axes"><a href="#Setting-up-and-configuring-the-Axes" class="headerlink" title="Setting up and configuring the Axes"></a>Setting up and configuring the Axes</h3><h4 id="Change-the-text-size"><a href="#Change-the-text-size" class="headerlink" title="Change the text size"></a>Change the text size</h4><p>The default size is <strong>10px</strong> with the font type of <strong>sans-serif</strong>.</p><p>There are a couple of different ways that we could change the font size and either one is valid.</p><p>The first way is to specify the font as a style when drawing an individual axis.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">svg.append(<span class="string">'g'</span>)</span><br><span class="line">    .style(<span class="string">'font'</span>, <span class="string">'14px times'</span>)</span><br><span class="line">    .attr(<span class="string">'transform'</span>, <span class="string">`translate(0, <span class="subst">$&#123;height&#125;</span>)`</span>)</span><br><span class="line">    .call(d3.axisBottom(xScale))</span><br></pre></td></tr></table></figure><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/axes-01.png" alt=""></p><p>There are a few things to notice here.</p><p>Firstly, we do indeed have a larger font and it appears to be of the type âtimesâ.</p><p>Secondly, the y axis has remained as 10px sans-serif.</p><p>Lastly, the number of values represented on the x axis has meant that with the increase in font size there is some overlapping going on</p><p>By this way, you can change stype of x axis while leaving y axis away.</p><p>But if you want to change two axis meanwhile, youâd better use class.</p><h4 id="Change-the-number-of-ticks-on-an-axis"><a href="#Change-the-number-of-ticks-on-an-axis" class="headerlink" title="Change the number of ticks on an axis"></a>Change the number of ticks on an axis</h4><p>Now we shall address the other problem taht cropped up when we change the size of the text. We have overlapping values on the x axis.</p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/axes-03.png" alt=""></p><p>The <a href="https://github.com/d3/d3-axis" target="_blank" rel="noopener">axis component</a> includes a function to specify the number of ticks on an axis.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">svg.append(<span class="string">'g'</span>)</span><br><span class="line">    .attr(<span class="string">'class'</span>, <span class="string">'axis'</span>)</span><br><span class="line">    .attr(<span class="string">'transform'</span>, <span class="string">`translate(0, <span class="subst">$&#123;height&#125;</span>)`</span>)</span><br><span class="line">    .call(d3.axisBottom(xScale).ticks(<span class="number">5</span>))</span><br></pre></td></tr></table></figure><p>Here you may face a confusion:</p><p>When you specify ticks to 5 or 4, or 3, thereâre always 5 ticks, and if you specify ticks to 2, the axis ticks will be 2 representing month.</p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/axes-04.png" alt=""></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/axes-05.png" alt=""></p><p>This is because D3 is making a command decision for you as to how your ticks should be best displayed.</p><p>The following is the list of time interval that D3 will consider when setting automatic ticks on a time based aaxis:</p><ul><li><p>1, 5, 15 and 30-second</p></li><li><p>1, 5, 15 and 30-minute</p></li><li><p>1, 3, 6 and 12-hour</p></li><li><p>1 and 2-day</p></li><li><p>1-week</p></li><li><p>1 and 3-month</p></li><li><p>1-year</p></li></ul><p>You can specify custom time interval by <code>d3.axisBottom(xScale).ticks(d3.timeDay.every(4))</code>.</p><h4 id="Rotating-text-labels-for-a-graph-size"><a href="#Rotating-text-labels-for-a-graph-size" class="headerlink" title="Rotating text labels for a graph size"></a>Rotating text labels for a graph size</h4><p>An answer to the problem of overlapping axis values might to be rotate the text to provide more space.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">svg.append(<span class="string">'g'</span>)</span><br><span class="line">    .attr(<span class="string">'class'</span>, <span class="string">'axis'</span>)</span><br><span class="line">    .attr(<span class="string">'transform'</span>, <span class="string">`translate(0, <span class="subst">$&#123;height&#125;</span>)`</span>)</span><br><span class="line">    .call(d3.axisBottom(xScale).ticks(<span class="number">10</span>))</span><br><span class="line">    .selectAll(<span class="string">'text'</span>)</span><br><span class="line">        .style(<span class="string">'text-anchor'</span>, <span class="string">'end'</span>)</span><br><span class="line">        .attr(<span class="string">'dx'</span>, <span class="string">'-0.8em'</span>) <span class="comment">// move the end of the text away from the line</span></span><br><span class="line">        .attr(<span class="string">'dy'</span>, <span class="string">'0.15em'</span>) <span class="comment">// move the end of the text away from the line</span></span><br><span class="line">        .attr(<span class="string">'transform'</span>, <span class="string">'rotate(-65)'</span>)</span><br></pre></td></tr></table></figure><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/rotate02.png" alt=""></p><h4 id="Formatting-a-date-time-axis-with-specified-values"><a href="#Formatting-a-date-time-axis-with-specified-values" class="headerlink" title="Formatting a date / time axis with specified values"></a>Formatting a date / time axis with specified values</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">svg.append(<span class="string">'g'</span>)</span><br><span class="line">    .attr(<span class="string">'class'</span>, <span class="string">'axis'</span>)</span><br><span class="line">    .attr(<span class="string">'transform'</span>, <span class="string">`translate(0, <span class="subst">$&#123;height&#125;</span>)`</span>)</span><br><span class="line">    .call(d3.axisBottom(xScale).tickFormat(d3.timeFormat(<span class="string">'%Y-%m-%d'</span>)))</span><br><span class="line">  .selectAll(<span class="string">'text'</span>)</span><br><span class="line">    .style(<span class="string">'text-anchor'</span>, <span class="string">'end'</span>)</span><br><span class="line">    .attr(<span class="string">'dx'</span>, <span class="string">'-0.8em'</span>)</span><br><span class="line">    .attr(<span class="string">'dy'</span>, <span class="string">'0.15em'</span>)</span><br><span class="line">    .attr(<span class="string">'transform'</span>, <span class="string">'rotate(-65)'</span>)</span><br></pre></td></tr></table></figure><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/axes-07.png" alt=""></p><h4 id="Adding-Axis-Labels"><a href="#Adding-Axis-Labels" class="headerlink" title="Adding Axis Labels"></a>Adding Axis Labels</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// text label for the x axis</span></span><br><span class="line"></span><br><span class="line">svg.append(<span class="string">'text'</span>)</span><br><span class="line">    .attr(<span class="string">'transform'</span>, <span class="string">`translate(<span class="subst">$&#123;width<span class="regexp">/2&#125;, $&#123;height + margin.top + 20&#125;)`)</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">    .style('text-anchor', 'middle')</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">    .text('Date')</span></span></span></span><br></pre></td></tr></table></figure><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/date01.png" alt=""></p><p>Add y axis</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">svg.append(<span class="string">'text'</span>)</span><br><span class="line">    .attr(<span class="string">'transform'</span>, <span class="string">'rotate(-90)'</span>)</span><br><span class="line">    .attr(<span class="string">'y'</span>, <span class="number">0</span> - margin.left)</span><br><span class="line">    .attr(<span class="string">'x'</span>, <span class="number">0</span> - height / <span class="number">2</span>)</span><br><span class="line">    .attr(<span class="string">'dy'</span>, <span class="string">'1em'</span>)</span><br><span class="line">    .style(<span class="string">'text-anchor'</span>, <span class="string">'middle'</span>)</span><br><span class="line">    .text(<span class="string">'Value'</span>)</span><br></pre></td></tr></table></figure><p>Something may confused you:</p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/value02.png" alt=""></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/value03.png" alt=""></p><p>And add the titleâ¦</p><h4 id="Smoothing-out-graph-lines"><a href="#Smoothing-out-graph-lines" class="headerlink" title="Smoothing out graph lines"></a>Smoothing out graph lines</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.curve(d3.curveBasis)</span><br></pre></td></tr></table></figure><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth03.png" alt="d3.curveLinear"></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth03a.png" alt="d3.curveLinearClosed"></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth04a.png" alt="d3.curveStep"></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth04.png" alt="d3.curveStepBefore"></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth05.png" alt="d3.curveStepAfter"></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth06.png" alt="d3.curveBasis"></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth07.png" alt="d3.curveBasisOpen"></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth08.png" alt="d3.curveLinearClosed"></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth09.png" alt="d3.curveBundle"></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth10.png" alt="d3.curveCardinal"></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth11.png" alt="d3.curveCardinalOpen"></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth12.png" alt="d3.curveCardinalClosed"></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth13.png" alt="d3.curveMonotone"></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth14.png" alt="d3.curveCatmullRom"></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth15.png" alt="d3.curveCatmullRomClosed"></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth16.png" alt="d3.curveCatmullRomOpen"></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth17.png" alt=""></p><h4 id="Make-a-dashed-line"><a href="#Make-a-dashed-line" class="headerlink" title="Make a dashed line"></a>Make a dashed line</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">svg.append(<span class="string">'path'</span>)</span><br><span class="line">    .datum(data)</span><br><span class="line">    .attr(<span class="string">'class'</span>, <span class="string">'line'</span>)</span><br><span class="line">    .style(<span class="string">'stroke-dasharry'</span>, (<span class="string">'3, 3'</span>))</span><br><span class="line">    .attr(<span class="string">'d'</span>, line)</span><br></pre></td></tr></table></figure><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/dashed01.png" alt=""></p><p>Obviously <code>stroke-dasharray</code> is a style is a style for the path element, but the magic is the numbers.</p><p>Essentially they describe the on length and off length of the line. So <code>&#39;(3, 3)&#39;</code> translates to 3px on and 3px off.</p><p>You can try <code>&#39;5, 5, 5, 5, 5, 5, 10, 5, 10, 5, 10, 5&#39;</code></p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/dashed02.png" alt=""></p><p>Of course you can apply this style on axis or any where you prefer.</p><h4 id="Filling-an-aera-under-the-graph"><a href="#Filling-an-aera-under-the-graph" class="headerlink" title="Filling an aera under the graph"></a>Filling an aera under the graph</h4><p>Filling an area with a solid color isnât too hard.</p><h5 id="CSS-for-an-area-fill"><a href="#CSS-for-an-area-fill" class="headerlink" title="CSS for an area fill"></a>CSS for an area fill</h5><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.area</span> &#123;</span><br><span class="line">  <span class="attribute">fill</span>: lightsteelblue</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="Define-the-area-function"><a href="#Define-the-area-function" class="headerlink" title="Define the area function"></a>Define the area function</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> area = d3.area()</span><br><span class="line">    .x(<span class="function">(<span class="params">d</span>) =&gt;</span> (xScale(d.date)))</span><br><span class="line">    .y0(height)</span><br><span class="line">    .y1(<span class="function">(<span class="params">d</span>) =&gt;</span> (yScale(d.close)))</span><br></pre></td></tr></table></figure><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/fill03.png" alt=""></p><h5 id="Draw-the-area"><a href="#Draw-the-area" class="headerlink" title="Draw the area"></a>Draw the area</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">svg.append(<span class="string">'path'</span>)</span><br><span class="line">    .datum(data)</span><br><span class="line">    .attr(<span class="string">'class'</span>, <span class="string">'area'</span>)</span><br><span class="line">    .attr(<span class="string">'d'</span>, area)</span><br></pre></td></tr></table></figure><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/fill04.png" alt=""></p><p>If you want to fill the area above the graph</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> area = d3.area()</span><br><span class="line">    .x(<span class="function"><span class="params">d</span> =&gt;</span> (xScale(d.date)))</span><br><span class="line">    .y0(<span class="function"><span class="params">d</span> =&gt;</span> (yScale(d.close)))</span><br><span class="line">    y1(<span class="number">0</span>)</span><br></pre></td></tr></table></figure><h4 id="Add-a-drop-shadow-to-allow-text-to-stand-out-on-graphics"><a href="#Add-a-drop-shadow-to-allow-text-to-stand-out-on-graphics" class="headerlink" title="Add a drop shadow to allow text to stand out on graphics"></a>Add a drop shadow to allow text to stand out on graphics</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">text</span><span class="selector-class">.shadow</span> &#123;</span><br><span class="line">  <span class="attribute">stroke</span>: white;</span><br><span class="line">  <span class="attribute">stroke-width</span>: <span class="number">4px</span>;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0.8</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Add-grid-lines-to-a-graph"><a href="#Add-grid-lines-to-a-graph" class="headerlink" title="Add grid lines to a graph."></a>Add grid lines to a graph.</h4><p>We are going to use the axis function to generate two more axis elements(one for x and one for y) but for these ones of drawing the main lines and the labels, weâre just going to draw the tick lines.</p><h5 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h5><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.grid</span> <span class="selector-tag">line</span> &#123;</span><br><span class="line">  <span class="attribute">stroke</span>: lightgrey;</span><br><span class="line">  <span class="attribute">stroke-opacity</span>: <span class="number">0.7</span>;</span><br><span class="line">  <span class="attribute">shape-rendering</span>: crispEdges;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.grid</span> <span class="selector-tag">path</span> &#123;</span><br><span class="line">  <span class="attribute">stroke-width</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Here we use <code>shape-rendering: crispEdges</code> to make the lines narrow.</p><p>And set <code>.grid path{ stroke-width: 0; }</code> to dismiss line of top and right line, it will be like this if we remove the css style:</p><p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/grid02.png" alt=""></p><h5 id="Define-the-grid-line-functions"><a href="#Define-the-grid-line-functions" class="headerlink" title="Define the grid line functions"></a>Define the grid line functions</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// gridlines in x axis function</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">make_x_gridlines</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> d3.axisBottom(xScale).ticks(<span class="number">5</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// gridlines in y axis function</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">make_y_gridlines</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> d3.axisLeft(yScale).ticks(<span class="number">5</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="Draw-the-lines"><a href="#Draw-the-lines" class="headerlink" title="Draw the lines"></a>Draw the lines</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add the x gridlines</span></span><br><span class="line">svg.append(<span class="string">'g'</span>)</span><br><span class="line">    .attr(<span class="string">'class'</span>, <span class="string">'grid'</span>)</span><br><span class="line">    .attr(<span class="string">'transform'</span>, <span class="string">`translate(0, <span class="subst">$&#123;height&#125;</span>)`</span>)</span><br><span class="line">    .call(make_x_gridlines().tickSize(-height).tickFormat(<span class="string">''</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// add the y gridlines</span></span><br><span class="line">svg.append(<span class="string">'g'</span>)</span><br><span class="line">    .attr(<span class="string">'class'</span>, <span class="string">'grid'</span>)</span><br><span class="line">    .call(make_y_gridlines().tickSize(-width).tickFormat(<span class="string">''</span>))</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">axis.tickSize([size])</span><br></pre></td></tr></table></figure><p>In our example, we are setting our ticks to a length that corresponding to the full height or width of the graph, which of course means that they extend across the graph and have the appearance of grid lines.</p><p>The last thing that is included in the code to draw the grid lines is the instruction to suppress printing any label for the ticks:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.tickForamt(<span class="string">''</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Simple Example of Line Chart With D3v4</title>
      <link href="/2017/08/29/Simple-Example-of-Line-Chart-with-D3v4/"/>
      <content type="html"><![CDATA[<h3 id="Import-D3"><a href="#Import-D3" class="headerlink" title="Import D3"></a>Import D3</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://d3js.org/d3.v4.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// set size</span></span><br><span class="line"><span class="keyword">const</span> margin = &#123;</span><br><span class="line">  top: <span class="number">50</span>,</span><br><span class="line">  right: <span class="number">50</span>,</span><br><span class="line">  bottom: <span class="number">50</span>,</span><br><span class="line">  left: <span class="number">50</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> width = <span class="built_in">window</span>.innerWidth - margin.left - margin.right</span><br><span class="line"><span class="keyword">const</span> height = <span class="built_in">window</span>.innerHeight - margin.top - margin.bottom</span><br><span class="line"></span><br><span class="line"><span class="comment">// Set Point Number</span></span><br><span class="line"><span class="keyword">const</span> n = <span class="number">21</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// X scale will use the index of our data</span></span><br><span class="line"><span class="keyword">const</span> xScale = d3.scaleLinear()</span><br><span class="line">    .domain([<span class="number">0</span>, n<span class="number">-1</span>]) <span class="comment">// input</span></span><br><span class="line">    .range([<span class="number">0</span>, width]) <span class="comment">// output</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Y scale will use the randomly generated number</span></span><br><span class="line"><span class="keyword">const</span> yScale = d3.scaleLinear()</span><br><span class="line">    .domain([<span class="number">0</span>, <span class="number">1</span>]) <span class="comment">// input</span></span><br><span class="line">    .range([height, <span class="number">0</span>]) <span class="comment">// output</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// d3's line generator</span></span><br><span class="line"><span class="keyword">const</span> line = d3.line()</span><br><span class="line">    .x(<span class="function"><span class="keyword">function</span>(<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> xScale(i)  <span class="comment">// set the x value for the line generator</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .y(<span class="function"><span class="keyword">function</span>(<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> d.y <span class="comment">// set the y value for the line generator</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .curve(d3.curveMonotoneX) <span class="comment">// apply smoothing to the line</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dataset = d3.range(n)</span><br><span class="line">    .map(<span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        y: d3.randomUniform(<span class="number">1</span>)()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add SVG to the page</span></span><br><span class="line"><span class="keyword">const</span> svg = d3.select(<span class="string">'body'</span>)</span><br><span class="line">  .append(<span class="string">'svg'</span>)</span><br><span class="line">    .attr(<span class="string">'width'</span>, width + margin.left + margin.right)</span><br><span class="line">    .attr(<span class="string">'height'</span>, height + margin.top + margin.bottom)</span><br><span class="line">  .append(<span class="string">'g'</span>)</span><br><span class="line">    .attr(<span class="string">'transform'</span>, <span class="string">`translate(<span class="subst">$&#123;margin.left&#125;</span>, <span class="subst">$&#123;margin.top&#125;</span>)`</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Call the X axis in a group tag</span></span><br><span class="line">svg.append(<span class="string">'g'</span>)</span><br><span class="line">    .attr(<span class="string">'class'</span>, <span class="string">'x axis'</span>)</span><br><span class="line">    .attr(<span class="string">'transform'</span>, <span class="string">`translate(0, <span class="subst">$&#123;height&#125;</span>)`</span>)</span><br><span class="line">    .call(d3.axisBottom(xScale)) <span class="comment">// Create an axis component with d3.axisBottom</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Call the Y axis in a group tag</span></span><br><span class="line">svg.append(<span class="string">'g'</span>)</span><br><span class="line">    .attr(<span class="string">'class'</span>, <span class="string">'y axis'</span>)</span><br><span class="line">    .call(d3.axisLeft(yScale))</span><br><span class="line"></span><br><span class="line"><span class="comment">// Append the path, bind the data, and call the line generator</span></span><br><span class="line">svg.append(<span class="string">'path'</span>)</span><br><span class="line">    .datum(dataset) <span class="comment">// bind data to the path</span></span><br><span class="line">    .attr(<span class="string">'class'</span>, <span class="string">'line'</span>)</span><br><span class="line">    .attr(<span class="string">'d'</span>, line) <span class="comment">// call the line generator</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Append a circle for each data point</span></span><br><span class="line">svg.selectAll(<span class="string">'.dot'</span>)</span><br><span class="line">    .data(dataset)</span><br><span class="line">  .enter().append(<span class="string">'circle'</span>)</span><br><span class="line">    .attr(<span class="string">'cx'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> xScale(i)</span><br><span class="line">    &#125;)</span><br><span class="line">    .attr(<span class="string">'cy'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> yScale(dy)</span><br><span class="line">    &#125;)</span><br><span class="line">    .attr(<span class="string">'r'</span>, <span class="number">5</span>)</span><br></pre></td></tr></table></figure><h3 id="Add-style"><a href="#Add-style" class="headerlink" title="Add style"></a>Add style</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.line</span> &#123;</span><br><span class="line">  <span class="attribute">fill</span>: none;</span><br><span class="line">  <span class="attribute">stroke</span>: cyan;</span><br><span class="line">  <span class="attribute">storke-width</span>: <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.dot</span> &#123;</span><br><span class="line">  <span class="attribute">fill</span>: <span class="number">#ffab00</span>;</span><br><span class="line">  <span class="attribute">stroke</span>: <span class="number">#FFF</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> D3, Example </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Usage of Mock</title>
      <link href="/2017/08/29/Usage-of-Mock/"/>
      <content type="html"><![CDATA[<h3 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add mockjs</span><br></pre></td></tr></table></figure><h3 id="Simple-Usage"><a href="#Simple-Usage" class="headerlink" title="Simple Usage"></a>Simple Usage</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Mock = <span class="built_in">require</span>(<span class="string">'mock'</span>)</span><br><span class="line"><span class="keyword">const</span> data = Mock.mock(&#123;</span><br><span class="line">  <span class="string">'list|1-10'</span>: [&#123;</span><br><span class="line">    <span class="string">'id|+1'</span>: <span class="number">1</span></span><br><span class="line">  &#125;]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(data))</span><br></pre></td></tr></table></figure><h3 id="Data-Template-Definition-DTD"><a href="#Data-Template-Definition-DTD" class="headerlink" title="Data Template Definition(DTD)"></a>Data Template Definition(DTD)</h3><p>Each attribute consists of three parts:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// attribute name</span></span><br><span class="line"><span class="comment">// attribute rule</span></span><br><span class="line"><span class="comment">// attribute value</span></span><br><span class="line"></span><br><span class="line"><span class="string">'name|rule'</span>: value</span><br></pre></td></tr></table></figure><p>rule is optional</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// rules</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">'name|min-max'</span>: value,</span><br><span class="line">  <span class="string">'name|count'</span>: value,</span><br><span class="line">  <span class="string">'name|min-max.dmin-dmax'</span>: value,</span><br><span class="line">  <span class="string">'name|min-max.dcount'</span>: value,</span><br><span class="line">  <span class="string">'name|count.dmin-dmax'</span>: value,</span><br><span class="line">  <span class="string">'name|count.dcount'</span>: value,</span><br><span class="line">  <span class="string">'name|+step'</span>: value,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'name|min-max'</span>: string <span class="comment">// repeat 'string' less than or equal to 'min', more than or equal 'max'</span></span><br><span class="line"><span class="string">'name|count'</span>: string <span class="comment">// repeat 'string' 'count' times.</span></span><br><span class="line"><span class="string">'name|+1'</span>: <span class="number">0</span>, <span class="comment">// auto incresing with step 1 from 0</span></span><br><span class="line"><span class="string">'name|min-max'</span>: number <span class="comment">// generate a number &gt;=min and &lt;=max</span></span><br><span class="line"><span class="string">'name|min-max.dmin-dmax'</span>: number <span class="comment">// generate a float, the integer part &gt;=min and &lt;=max, the deciaml part remains dmin - dmax bits.</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Mock.mock(&#123;</span><br><span class="line">    <span class="string">'number1|1-100.1-10'</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">'number2|123.1-10'</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">'number3|123.3'</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">'number4|123.10'</span>: <span class="number">1.123</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// =&gt;</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"number1"</span>: <span class="number">12.92</span>,</span><br><span class="line">    <span class="string">"number2"</span>: <span class="number">123.51</span>,</span><br><span class="line">    <span class="string">"number3"</span>: <span class="number">123.777</span>,</span><br><span class="line">    <span class="string">"number4"</span>: <span class="number">123.1231091814</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Data-Placeholder-Definition-DPD"><a href="#Data-Placeholder-Definition-DPD" class="headerlink" title="Data Placeholder Definition(DPD)"></a>Data Placeholder Definition(DPD)</h3><p>Placeholder hold a position in attribute string, and will dismiss in result.</p><p>Use Mock.Random to generate data.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@placeholder</span><br><span class="line">@placeholder(opt1[, opt2])</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Mock.mock(&#123;</span><br><span class="line">    name: &#123;</span><br><span class="line">        first: <span class="string">'@FIRST'</span>,</span><br><span class="line">        middle: <span class="string">'@FIRST'</span>,</span><br><span class="line">        last: <span class="string">'@LAST'</span>,</span><br><span class="line">        full: <span class="string">'@first @middle @last'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// =&gt;</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"name"</span>: &#123;</span><br><span class="line">        <span class="string">"first"</span>: <span class="string">"Charles"</span>,</span><br><span class="line">        <span class="string">"middle"</span>: <span class="string">"Brenda"</span>,</span><br><span class="line">        <span class="string">"last"</span>: <span class="string">"Lopez"</span>,</span><br><span class="line">        <span class="string">"full"</span>: <span class="string">"Charles Brenda Lopez"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Mock-mock"><a href="#Mock-mock" class="headerlink" title="Mock.mock()"></a>Mock.mock()</h3><h4 id="Mock-mock-rurl-rtype-template-function-options"><a href="#Mock-mock-rurl-rtype-template-function-options" class="headerlink" title="Mock.mock(rurl?, rtype?, template | function(options))"></a>Mock.mock(rurl?, rtype?, template | function(options))</h4><h5 id="Mock-mock-template"><a href="#Mock-mock-template" class="headerlink" title="Mock.mock(template)"></a>Mock.mock(template)</h5><p>Generate mock data</p><h5 id="Mock-mock-rurl-template"><a href="#Mock-mock-rurl-template" class="headerlink" title="Mock.mock(rurl, template)"></a>Mock.mock(rurl, template)</h5><p>Intercept <code>rurl</code>(regexp) request, and generate according template.</p><h5 id="Mock-mock-rurl-function-options"><a href="#Mock-mock-rurl-function-options" class="headerlink" title="Mock.mock(rurl, function(options))"></a>Mock.mock(rurl, function(options))</h5><p>Intercept <code>rurl</code> request and call function(options) to return the mock data.</p><h5 id="Mock-mock-rurl-rtype-template"><a href="#Mock-mock-rurl-rtype-template" class="headerlink" title="Mock.mock(rurl, rtype, template)"></a>Mock.mock(rurl, rtype, template)</h5><p>Intercept the request matching <code>rurl</code> and <code>rtype</code>.</p><h5 id="Mock-mock-rurl-rtype-function-options"><a href="#Mock-mock-rurl-rtype-function-options" class="headerlink" title="Mock.mock(rurl, rtype, function(options))"></a>Mock.mock(rurl, rtype, function(options))</h5><p>Intercept the request matching <code>rurl</code> and <code>rtype</code>.</p><blockquote><p>options conssits of (url, type, body)</p></blockquote><h3 id="Mock-setup"><a href="#Mock-setup" class="headerlink" title="Mock.setup()"></a>Mock.setup()</h3><p>Mock.setup(settings)</p><p>Set action when intercept ajax request.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  timeout: <span class="string">''</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>timeout: set time responding time, â300â, â300-600â, default to â10-100â</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Mock.setup(&#123;</span><br><span class="line">  timeout: <span class="string">'200-400'</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Mock-Random"><a href="#Mock-Random" class="headerlink" title="Mock.Random"></a>Mock.Random</h3><p>Utils to generate Random data.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Random = Mock.Random</span><br><span class="line">Random.email()</span><br><span class="line"></span><br><span class="line">Mock.mock(<span class="string">'@email'</span>) <span class="comment">// use with placeholder</span></span><br><span class="line"></span><br><span class="line">Mock.mock(&#123;</span><br><span class="line">  email: <span class="string">'@email'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>| Type | Mehtod |<br>| Baisc | boolean, natural, integer, float, character, string, range, date, time, datetime, now |<br>| Image | image, dataImage |<br>| Color | color |<br>| Text | paragraph, sentence, word, title, cparagraph, csentence, cword, ctitle |<br>| Name | first, last, name, cfirst, clast, cname |<br>| Web | url, domain, email, ip, tld |<br>| Address | area, region |<br>| Helper | capitalize, upper, lower, pick, shuffle |<br>| Miscellaneous | guid, id |</p><h4 id="Mock-Random-boolean-min-max-current"><a href="#Mock-Random-boolean-min-max-current" class="headerlink" title="Mock.Random.boolean(min?, max?, current?)"></a>Mock.Random.boolean(min?, max?, current?)</h4><p>âminâ and âmaxâ decide the possibility of âcurrentâ</p><p>âcurrentâ will appear in possibility of min/(min + max) to max(min + max)</p><h4 id="Mock-Random-natural-min-max"><a href="#Mock-Random-natural-min-max" class="headerlink" title="Mock.Random.natural(min?, max?)"></a>Mock.Random.natural(min?, max?)</h4><h4 id="Mock-Random-integer-min-max"><a href="#Mock-Random-integer-min-max" class="headerlink" title="Mock.Random.integer(min?, max?)"></a>Mock.Random.integer(min?, max?)</h4><h4 id="Mock-Random-float-min-max-dmin-dmax"><a href="#Mock-Random-float-min-max-dmin-dmax" class="headerlink" title="Mock.Random.float(min?, max?, dmin?, dmax?)"></a>Mock.Random.float(min?, max?, dmin?, dmax?)</h4><h4 id="Mock-Random-character-pool"><a href="#Mock-Random-character-pool" class="headerlink" title="Mock.Random.character(pool?)"></a>Mock.Random.character(pool?)</h4><p>pool represents the character pool</p><p>pool: âlower/upper/number/symbolâ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  lower: &apos;abcdefghijklmnopqrstuvwxyz&apos;,</span><br><span class="line">  upper: &apos;ABCDEFGHIJKLMNOPQRSTUVWXYZ&apos;,</span><br><span class="line">  number: 0123456789,</span><br><span class="line">  symbol: &apos;!@#$%^&amp;*()[]&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="Mock-Random-string-pool-min-max"><a href="#Mock-Random-string-pool-min-max" class="headerlink" title="Mock.Random.string(pool?, min?, max?)"></a>Mock.Random.string(pool?, min?, max?)</h4><p>pool: available string pool<br>min: min-length, default to 3<br>max: max-length, default to 7</p><h4 id="Mock-Random-range-start-stop-step"><a href="#Mock-Random-range-start-stop-step" class="headerlink" title="Mock.Random.range(start?, stop, step?)"></a>Mock.Random.range(start?, stop, step?)</h4><h4 id="Mock-Random-date-format"><a href="#Mock-Random-date-format" class="headerlink" title="Mock.Random.date(format?)"></a>Mock.Random.date(format?)</h4><h4 id="Mock-Random-time-format"><a href="#Mock-Random-time-format" class="headerlink" title="Mock.Random.time(format?)"></a>Mock.Random.time(format?)</h4><h4 id="Mock-Random-datetime-format"><a href="#Mock-Random-datetime-format" class="headerlink" title="Mock.Random.datetime(format?)"></a>Mock.Random.datetime(format?)</h4><h4 id="Mock-Random-now-unit-format"><a href="#Mock-Random-now-unit-format" class="headerlink" title="Mock.Random.now(unit?, format?)"></a>Mock.Random.now(unit?, format?)</h4><h4 id="Mock-Random-image-size-background-foreground-format-text"><a href="#Mock-Random-image-size-background-foreground-format-text" class="headerlink" title="Mock.Random.image(size?, background?, foreground?, format?, text?)"></a>Mock.Random.image(size?, background?, foreground?, format?, text?)</h4><h4 id="Mock-Random-dataImage-size-text"><a href="#Mock-Random-dataImage-size-text" class="headerlink" title="Mock.Random.dataImage(size?, text?)"></a>Mock.Random.dataImage(size?, text?)</h4><h4 id="Mock-Random-color"><a href="#Mock-Random-color" class="headerlink" title="Mock.Random.color()"></a>Mock.Random.color()</h4><h4 id="Mock-Random-hex"><a href="#Mock-Random-hex" class="headerlink" title="Mock.Random.hex()"></a>Mock.Random.hex()</h4><h4 id="Mock-Random-rgb"><a href="#Mock-Random-rgb" class="headerlink" title="Mock.Random.rgb()"></a>Mock.Random.rgb()</h4><h4 id="Mock-Random-rbga"><a href="#Mock-Random-rbga" class="headerlink" title="Mock.Random.rbga()"></a>Mock.Random.rbga()</h4><h4 id="Mock-Random-hsl"><a href="#Mock-Random-hsl" class="headerlink" title="Mock.Random.hsl()"></a>Mock.Random.hsl()</h4><h4 id="Mock-Random-paragraph-null-length-min-max-Mock-Random-cparagraph-null-length-min-max"><a href="#Mock-Random-paragraph-null-length-min-max-Mock-Random-cparagraph-null-length-min-max" class="headerlink" title="Mock.Random.paragraph(null | length | min, max) | Mock.Random.cparagraph(null | length | min, max)"></a>Mock.Random.paragraph(null | length | min, max) | Mock.Random.cparagraph(null | length | min, max)</h4><h4 id="Mock-Random-sentence-null-length-min-max-Mock-Random-csentence-null-length-min-max"><a href="#Mock-Random-sentence-null-length-min-max-Mock-Random-csentence-null-length-min-max" class="headerlink" title="Mock.Random.sentence(null | length | min, max) | Mock.Random.csentence(null | length | min, max)"></a>Mock.Random.sentence(null | length | min, max) | Mock.Random.csentence(null | length | min, max)</h4><h4 id="Mock-Random-workd-null-length-min-max-Mock-Random-cword-pool-min-max"><a href="#Mock-Random-workd-null-length-min-max-Mock-Random-cword-pool-min-max" class="headerlink" title="Mock.Random.workd(null | length | min, max) | Mock.Random.cword(pool?, min?, max?)"></a>Mock.Random.workd(null | length | min, max) | Mock.Random.cword(pool?, min?, max?)</h4><h4 id="Mock-Random-title-null-length-min-max-Mock-Random-ctitle-null-length-min-max"><a href="#Mock-Random-title-null-length-min-max-Mock-Random-ctitle-null-length-min-max" class="headerlink" title="Mock.Random.title(null | length | min, max) | Mock.Random.ctitle(null | length | min, max)"></a>Mock.Random.title(null | length | min, max) | Mock.Random.ctitle(null | length | min, max)</h4><h4 id="Mock-Random-first-Mock-Random-last-Mock-Random-name-middle-Mock-Random-cfirst-Mock-Random-clast-Mock-Random-cname"><a href="#Mock-Random-first-Mock-Random-last-Mock-Random-name-middle-Mock-Random-cfirst-Mock-Random-clast-Mock-Random-cname" class="headerlink" title="Mock.Random.first() | Mock.Random.last() | Mock.Random.name(middle?) | Mock.Random.cfirst() | Mock.Random.clast() | Mock.Random.cname()"></a>Mock.Random.first() | Mock.Random.last() | Mock.Random.name(middle?) | Mock.Random.cfirst() | Mock.Random.clast() | Mock.Random.cname()</h4><h4 id="Mock-Random-url-protocol-host"><a href="#Mock-Random-url-protocol-host" class="headerlink" title="Mock.Random.url(protocol?, host?)"></a>Mock.Random.url(protocol?, host?)</h4><h4 id="Mock-Random-protocol-Mock-Random-domain-Mock-Random-tld-Mock-Random-email-domain-Mock-Random-ip"><a href="#Mock-Random-protocol-Mock-Random-domain-Mock-Random-tld-Mock-Random-email-domain-Mock-Random-ip" class="headerlink" title="Mock.Random.protocol() | Mock.Random.domain() | Mock.Random.tld() | Mock.Random.email(domain?) | Mock.Random.ip()"></a>Mock.Random.protocol() | Mock.Random.domain() | Mock.Random.tld() | Mock.Random.email(domain?) | Mock.Random.ip()</h4><h4 id="Mock-Random-region-Mock-Random-province-Mock-Random-city-prefix-Mock-Random-county-prefix-Mock-Random-zip"><a href="#Mock-Random-region-Mock-Random-province-Mock-Random-city-prefix-Mock-Random-county-prefix-Mock-Random-zip" class="headerlink" title="Mock.Random.region() | Mock.Random.province() | Mock.Random.city(prefix?) | Mock.Random.county(prefix?) | Mock.Random.zip()"></a>Mock.Random.region() | Mock.Random.province() | Mock.Random.city(prefix?) | Mock.Random.county(prefix?) | Mock.Random.zip()</h4><h4 id="Mock-Random-captilize-word-Mock-Random-upper-str-Mock-Random-lower-str-Mock-Random-pick-arr-Mock-Random-shuffle-arr"><a href="#Mock-Random-captilize-word-Mock-Random-upper-str-Mock-Random-lower-str-Mock-Random-pick-arr-Mock-Random-shuffle-arr" class="headerlink" title="Mock.Random.captilize(word) | Mock.Random.upper(str) | Mock.Random.lower(str) | Mock.Random.pick(arr) | Mock.Random.shuffle(arr)"></a>Mock.Random.captilize(word) | Mock.Random.upper(str) | Mock.Random.lower(str) | Mock.Random.pick(arr) | Mock.Random.shuffle(arr)</h4><h4 id="Mock-Random-guid"><a href="#Mock-Random-guid" class="headerlink" title="Mock.Random.guid()"></a>Mock.Random.guid()</h4><p>Generate a GUID</p><h4 id="Mock-Random-id"><a href="#Mock-Random-id" class="headerlink" title="Mock.Random.id()"></a>Mock.Random.id()</h4><p>Generate a Personal Identity</p><h4 id="Mock-Random-increment-step"><a href="#Mock-Random-increment-step" class="headerlink" title="Mock.Random.increment(step?)"></a>Mock.Random.increment(step?)</h4><h3 id="Mock-valid-template-data"><a href="#Mock-valid-template-data" class="headerlink" title="Mock.valid(template, data)"></a>Mock.valid(template, data)</h3><p>Check if the data is matching the template</p>]]></content>
      
      
        <tags>
            
            <tag> Mock, JavaScript </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Start at Pug</title>
      <link href="/2017/08/29/Start-at-Pug/"/>
      <content type="html"><![CDATA[<h3 id="Install-Pug"><a href="#Install-Pug" class="headerlink" title="Install Pug"></a>Install Pug</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add pug</span><br></pre></td></tr></table></figure><h3 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h3><p><code>pug.compile()</code> will compile the Pug source code into a JavaScript function that takes a data object(called <code>locals</code>) as an argument. Call that resultant function with your data, then it will return a string of HTML rendered with your data.</p><p>The compiled function can be re-used, and called with different sets of data.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// - template.pug</span><br><span class="line">p #&#123;name&#125;'s Pug source code!</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pug = <span class="built_in">require</span>(<span class="string">'pug'</span>)</span><br><span class="line"><span class="comment">// Compile the source code</span></span><br><span class="line"><span class="keyword">const</span> compiledFunction = pug.compile(<span class="string">'template.pug'</span>)</span><br><span class="line"><span class="comment">// Render a set of data</span></span><br><span class="line"><span class="built_in">console</span>.log(compiledFunction(&#123;</span><br><span class="line">  name: <span class="string">'Timothy'</span></span><br><span class="line">&#125;))</span><br><span class="line"><span class="comment">// "&lt;p&gt;Timothy's Pug source code!&lt;/p&gt;"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Render another set of data</span></span><br><span class="line"><span class="built_in">console</span>.log(compiledFunction(&#123;</span><br><span class="line">  name: <span class="string">'Forbes'</span></span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">// "&lt;p&gt;Forbes' Pug source code!&lt;/p&gt;"</span></span><br></pre></td></tr></table></figure><p>Pug also provides the <code>pug.render()</code> family of functions that combine compileing and rendering into one step. However, the template function will be re-compiled every time <code>render</code> is called, which might impact performance. Alternatively, you can use the <code>cache</code> option with <code>render</code>, which will automatically store the compiled function into an internal cache.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pug = <span class="built_in">require</span>(<span class="string">'pug'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Compile template.pug and render a set of data</span></span><br><span class="line"><span class="built_in">console</span>.log(pug.renderFile(<span class="string">'template.pug'</span>, &#123;</span><br><span class="line">  name: <span class="string">'Timothy'</span></span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure><h3 id="Use-with-Express"><a href="#Use-with-Express" class="headerlink" title="Use with Express"></a>Use with Express</h3><p>Pug fully integrates with <code>Express</code>, as a supported view engine.</p><h4 id="Production-Defaults"><a href="#Production-Defaults" class="headerlink" title="Production Defaults"></a>Production Defaults</h4><p>In Express, the environmental variables <code>NODE_ENV</code> is designed to inform the web application of the execution environment: whether it is in development or in production. Express and Pug automatically modify the defaults of a few options in production environment, to provide a better out-of-the-box experience for users.</p><p>Specifically, when <code>process.env.NODE_ENV</code> is set to <code>&#39;production&#39;</code>, and Pug is used with Express, the <code>compileDebug</code> option is <code>false</code> by default, while the <code>cache</code> option is <code>true</code>.</p><h3 id="API-Reference"><a href="#API-Reference" class="headerlink" title="API Reference"></a>API Reference</h3><p>All API mehtods accept the following set of options:</p><ul><li><p>filename: string</p><p>The name of the file being compiled. Used in exceptions, and required for relative <code>include</code> and <code>extend</code>. Default to <code>Pug</code></p></li><li><p>basedir: string</p><p>The root directory of all absolute inclusion</p></li><li><p>doctype: string</p><p>If the <code>doctype</code> is not specified as part of the template, you can specify it here. It is sometimes useful to get self-closing tags and remove mirroring of boolean attributes.</p></li><li><p>filters: object</p><p>Hash table of custom filters. Default to <code>undefined</code></p></li><li><p>self: boolean</p><p>Use a <code>self</code> namespaces to hold the locals. It will speed up the compilation, but instead of writing <code>variable</code> you will have to write <code>self.variable</code> to access to property of the locals object. Default to <code>false</code></p></li><li><p>debug: boolean</p><p>If set to <code>true</code>, the tokens and function body are logged to stdout</p></li><li><p>compileDebug: boolean</p><p>If set to <code>true</code>, the function source will be included in the compiled template for better error messages. It is enabled by default, unless used with express in production mode.</p></li><li><p>globals: Array<string></string></p><p>Add a list of global names to make accessible in templates</p></li><li><p>cache: boolean</p><p>If set to <code>true</code>, compiled functions are cached. <code>filename</code> must be set as the cache key. Only applies to <code>render</code> functions. Default to <code>false</code></p></li><li><p>inlineRuntimeFunctions: boolean</p><p>Inline runtime functions instead of <code>require</code>-ing them from a shared version. For <code>compileClient</code> functions, the default is <code>true</code>(so that one does not have include the runtime). For all other compilation or rendering types, the default is <code>false</code></p></li><li><p>name: string</p><p>The name of the template function. Only applies to <code>compileClient</code> function. Default to <code>template</code>.</p></li></ul><h3 id="Methods"><a href="#Methods" class="headerlink" title="Methods"></a>Methods</h3><ul><li><p>pug.compile(source[, options])</p><p>Compile a Pug template to a function, which can be rendered multiple times with different locals.</p><ul><li><p>source: string</p><p>the source pug template to compile</p></li><li><p>options: An option object</p></li><li><p>returns: function</p><p>A function to generate the HTML from an object containing locals</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> pug = <span class="built_in">require</span>(<span class="string">'pug'</span>)</span><br><span class="line"><span class="keyword">var</span> compiledTemplate = pug.compile(<span class="string">'string of pug'</span>, options)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> html = compiledFunction(locals)</span><br></pre></td></tr></table></figure></li><li><p>pug.compileFile(path[, options])</p><p>Compile a Pug template from a file to a function, which can be rendered multiple times with different locals.</p><ul><li><p>path: string</p><p>The path to a Pug file</p></li><li><p>options: An option object</p></li><li><p>returns: function</p><p>A function to generate HTML from an object containing locals</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> pug = <span class="built_in">require</span>(<span class="string">'pug'</span>)</span><br><span class="line"><span class="keyword">var</span> compiledTemplate = pug.compileFile(<span class="string">'path to pug file'</span>, options)</span><br><span class="line"><span class="keyword">var</span> html = compiledTemplate(locals)</span><br></pre></td></tr></table></figure></li><li><p>pug.compileClient(source[, options])</p><p>Compile a Pug template to a string of JavaScript, which can be used client side along with Pug runtime.</p><ul><li><p>source: string</p><p>The Pug template to compile</p></li><li><p>options: an option object</p></li><li><p>returns: string</p><p>A string of JavaScript representing a function</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> pug = <span class="built_in">require</span>(<span class="string">'pug'</span>)</span><br><span class="line"><span class="keyword">var</span> compiledTemplate = pug.compileClient(<span class="string">'string of pug'</span>, options)</span><br><span class="line"><span class="keyword">var</span> html = compiledTemplate(locals)</span><br></pre></td></tr></table></figure></li><li><p>pug.render(source[, options[, callback]])</p><ul><li><p>source: string</p><p>The source pug template to render</p></li><li><p>options: an options object</p></li><li><p>callback: function</p><p>Node.js-style callback receiving the rendered results. <strong>The callback is called synchronously</strong>.</p></li><li><p>returns: string</p><p>The resulting HTML String</p></li></ul></li><li><p>pug.renderFile(path[, options[, callback]])</p><ul><li><p>path: string</p><p>the path to the pug file to render</p></li><li><p>option: an options object</p></li><li><p>callback: function</p><p>Node.js-style callback receiving the rendered results. <strong>This callback is called synchronously.</strong></p></li><li><p>returns: function</p><p>The resulting HTML stirng</p></li></ul></li></ul><h3 id="Attributes"><a href="#Attributes" class="headerlink" title="Attributes"></a>Attributes</h3><p>Tag attributes look similar to HTML(with optional commas), but their values are just regular JavaScript.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a(href=<span class="string">'google.com'</span>) Google =&gt; <span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"google.com"</span>&gt;</span>Google<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>Normal JavaScript expression works fine:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> authenticated = <span class="literal">true</span></span><br><span class="line">body(<span class="class"><span class="keyword">class</span></span>=authenticated ? <span class="string">'authed'</span> : <span class="string">'anon'</span>) =&gt; <span class="xml"><span class="tag">&lt;<span class="name">body</span> <span class="attr">class</span>=<span class="string">"authed"</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h4 id="Multiline-Attributes"><a href="#Multiline-Attributes" class="headerlink" title="Multiline Attributes"></a>Multiline Attributes</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">input(</span><br><span class="line">  type=<span class="string">'checkbox'</span></span><br><span class="line">  name=<span class="string">'agreement'</span></span><br><span class="line">  checked</span><br><span class="line">)</span><br><span class="line">=&gt; <span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"agreement"</span> <span class="attr">checked</span> /&gt;</span></span></span><br></pre></td></tr></table></figure><p>If your JavaScript runtime supports ES6 template strings, you can use that syntax for attributes.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">input(data-json=<span class="string">`</span></span><br><span class="line"><span class="string">  &#123;</span></span><br><span class="line"><span class="string">    "very-long": "piece of",</span></span><br><span class="line"><span class="string">    "data": true</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span>)</span><br><span class="line">=&gt; <span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">data-json</span>=<span class="string">"</span></span></span></span><br><span class="line"><span class="xml">  &#123;</span></span><br><span class="line"><span class="xml">    &amp;quot;very-long&amp;quot;: &amp;quot;piece of &amp;quot;,</span></span><br><span class="line"><span class="xml">    &amp;quot;data&amp;quot;: true</span></span><br><span class="line"><span class="xml">  &#125;</span></span><br><span class="line"><span class="xml">"/&gt;</span></span><br></pre></td></tr></table></figure><h4 id="Quoted-Attributes"><a href="#Quoted-Attributes" class="headerlink" title="Quoted Attributes"></a>Quoted Attributes</h4><p>If your attribute name contains odd character that might interfere with JavaScript syntax, either quote it using <code>&quot;&quot;</code> or <code>&#39;&#39;</code>, or use commas to separate different attributes.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">div(<span class="class"><span class="keyword">class</span></span>=<span class="string">'div-class'</span>, (click)=<span class="string">'play()'</span>)</span><br><span class="line">div(<span class="class"><span class="keyword">class</span></span>=<span class="string">'div-class'</span> <span class="string">'(click)'</span>=<span class="string">'play()'</span>)</span><br><span class="line">=&gt; <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"div-class"</span> (<span class="attr">click</span>)=<span class="string">"play()"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h4 id="Attribute-Interpolation"><a href="#Attribute-Interpolation" class="headerlink" title="Attribute Interpolation"></a>Attribute Interpolation</h4><ul><li><p>Simply write the attribute in JavaScript:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> url = <span class="string">'pub-test.html'</span></span><br><span class="line">a(href=<span class="string">'/'</span> + url) Link =&gt; <span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">'/pub-test.html'</span>&gt;</span>Link<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> btnType = <span class="string">'info'</span></span><br><span class="line"><span class="keyword">var</span> btnSize = <span class="string">'lg'</span></span><br><span class="line">button(type=<span class="string">'button'</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">`btn btn-<span class="subst">$&#123;btnType&#125;</span> btn-<span class="subst">$&#123;btnSize&#125;</span>`</span>)</span><br><span class="line">=&gt; &lt;button type="button" class="btn btn-info btn-lg"&gt;&lt;button&gt;</span><br></pre></td></tr></table></figure></li></ul><h4 id="Boolean-Attributes"><a href="#Boolean-Attributes" class="headerlink" title="Boolean Attributes"></a>Boolean Attributes</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">input(type=<span class="string">'checkbox'</span> checked) =&gt; <span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">checked</span>=<span class="string">"checked"</span> /&gt;</span></span></span><br><span class="line">input(type='checkbox' checked=true) =&gt; &lt;input type="checkbox" checked="checked" /&gt;</span><br><span class="line">input(type='checkbox' checked=false) =&gt; &lt;input type="checkbox" /&gt;</span><br><span class="line">input(type='checkbox' checked=true.toString()) =&gt; &lt;input type="checkbox" checked="true" /&gt;</span><br></pre></td></tr></table></figure><h4 id="Style-Attributes"><a href="#Style-Attributes" class="headerlink" title="Style Attributes"></a>Style Attributes</h4><p>The style attribute can be a string, like any normal attribute, but it can be an object, which is handy when styles are generated by JavaScript:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a(style=&#123;<span class="attr">color</span>: <span class="string">'red'</span>, <span class="attr">background</span>: <span class="string">'green'</span>&#125;) =&gt; <span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">style</span>=<span class="string">"color:red;background:green;"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h4 id="Class-Attributes"><a href="#Class-Attributes" class="headerlink" title="Class Attributes"></a>Class Attributes</h4><p>The <code>class</code> attribute can be a string, like any normal attribute, but is also can be an array of class names, which is handy when generated from JavaScript.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> classes = [<span class="string">'foo'</span>, <span class="string">'bar'</span>, <span class="string">'baz'</span>]</span><br><span class="line">a(<span class="class"><span class="keyword">class</span></span>=classes) =&gt; <span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"foo bar baz"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">a.bang(<span class="class"><span class="keyword">class</span></span>=classes <span class="class"><span class="keyword">class</span></span>=[bing]) =&gt; <span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"bang foo bar baz bing"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>It can also be an object which maps class names to <code>true</code> or <code>false</code> values. This is useful for applying conditional classes:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> currentURL = <span class="string">'/about'</span></span><br><span class="line">a(<span class="class"><span class="keyword">class</span></span>=&#123;<span class="attr">active</span>: currentURL === <span class="string">'/about'</span> href=<span class="string">'/about'</span>&#125;) =&gt; <span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"active"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h4 id="Class-Literal"><a href="#Class-Literal" class="headerlink" title="Class Literal"></a>Class Literal</h4><p>Classes may be defined using a <code>.classname</code> syntax:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a.button =&gt; <span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"button"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>Since <code>div</code>s are such a common choice of tag, it is default if you omit the tag name:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.content =&gt; <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"content"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h4 id="ID-Literal"><a href="#ID-Literal" class="headerlink" title="ID Literal"></a>ID Literal</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a#main-link =&gt; &lt;a id="main-link"&gt;&lt;/a&gt;</span><br></pre></td></tr></table></figure><h4 id="amp-attributes"><a href="#amp-attributes" class="headerlink" title="&amp;attributes"></a>&amp;attributes</h4><p>Pronounced as <code>and attributes</code>, the <code>&amp;attributes</code> syntax can be used to expode an object into attributes of an element:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dev#foo(data-json="foo")&amp;attributes(&#123;'data-foo': 'bar'&#125;) =&gt; &lt;div id="foo" data-json="foo" data-foo="bar" /&gt;</span><br></pre></td></tr></table></figure><h3 id="Case"><a href="#Case" class="headerlink" title="Case"></a>Case</h3><p>The <code>case</code> statement is a shorthand for JavaScriptâs switch, it takes the following form:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> friends = <span class="number">10</span></span><br><span class="line"><span class="keyword">case</span> friends</span><br><span class="line">  when <span class="number">0</span></span><br><span class="line">    p you have no friends</span><br><span class="line">  when <span class="number">1</span></span><br><span class="line">    p you have a friend</span><br><span class="line">  <span class="keyword">default</span></span><br><span class="line">    p you have #&#123;friends&#125; friends</span><br></pre></td></tr></table></figure><h4 id="Case-Fall-Through"><a href="#Case-Fall-Through" class="headerlink" title="Case Fall Through"></a>Case Fall Through</h4><p>You can use fall through, just as you would in a JavaScript <code>switch</code> statement</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> friends = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> friends</span><br><span class="line">  when <span class="number">0</span></span><br><span class="line">  when <span class="number">1</span></span><br><span class="line">    p you have very few friends</span><br><span class="line">  <span class="keyword">default</span></span><br><span class="line">    p you have #&#123;friends&#125; friends</span><br></pre></td></tr></table></figure><p>The difference, however, is a fall through in JavaScript happens whenever a <code>break</code> statement is not explicitly included.</p><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><p>Pug allows you to write inline JavaScript code in your templates. There are three types of code: Unbuffered, Buffered, and Unescaped Buffered.</p><h4 id="Unbuffered-Code"><a href="#Unbuffered-Code" class="headerlink" title="Unbuffered Code"></a>Unbuffered Code</h4><p>Unbuffered code starts with <code>-</code>. It does not directly add anything to the output</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- <span class="keyword">for</span> (<span class="keyword">var</span> x = <span class="number">0</span>; x &lt; <span class="number">3</span>; x++)</span><br><span class="line">  li item</span><br><span class="line"></span><br><span class="line">=&gt;</span><br><span class="line"></span><br><span class="line">&lt;li&gt;item&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">&lt;li&gt;item&lt;/</span>li&gt;</span><br><span class="line">&lt;li&gt;item&lt;<span class="regexp">/li&gt;</span></span><br></pre></td></tr></table></figure><p>Pug also supports block unbuffered code:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">-</span><br><span class="line">  <span class="keyword">var</span> list = [<span class="string">'Uno'</span>, <span class="string">'Dos'</span>, <span class="string">'Tres'</span>, <span class="string">'Cuatro'</span>, <span class="string">'Cinco'</span>, <span class="string">'Seis'</span>]</span><br><span class="line">  each item <span class="keyword">in</span> list</span><br><span class="line">    li= item</span><br><span class="line"></span><br><span class="line">=&gt;</span><br><span class="line"></span><br><span class="line">  &lt;li&gt;Uno&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">  &lt;li&gt;Dos&lt;/</span>li&gt;</span><br><span class="line">  &lt;li&gt;Tres&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">  &lt;li&gt;Cuatro&lt;/</span>li&gt;</span><br><span class="line">  &lt;li&gt;Cinco&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">  &lt;li&gt;Seis&lt;/</span>li&gt;</span><br></pre></td></tr></table></figure><h4 id="Buffered-Code"><a href="#Buffered-Code" class="headerlink" title="Buffered Code"></a>Buffered Code</h4><p>Buffered code start with <code>=</code>. It evaluates the JavaScript expression and outputs the result. For security, buffered code is first HTML excaped.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">p = <span class="string">'This code is &lt;escaped&gt;!'</span></span><br><span class="line"></span><br><span class="line">=&gt; <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>This code is &amp;lt;escaped&amp;gt;!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>it can also be written inline with attributes, and supports the full range of JavaScript expression:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p= <span class="string">'This code is'</span> + <span class="string">' &lt;escaped&gt;!'</span> =&gt; <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>This code is &amp;gt;escaped&amp;gt;!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h4 id="Unescaped-Buffered-Code"><a href="#Unescaped-Buffered-Code" class="headerlink" title="Unescaped Buffered Code"></a>Unescaped Buffered Code</h4><p>Unescaped buffered code starts with <code>!=</code>. It evaluates the JavaScript expression and outputs the result. Unescaped buffered code does not perform any escaping, so is unsafe for user input.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p != <span class="string">'This code is &lt;strong&gt;not&lt;/strong&gt; escaped!'</span> =&gt; <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>This code is <span class="tag">&lt;<span class="name">strong</span>&gt;</span>not<span class="tag">&lt;/<span class="name">strong</span>&gt;</span> escaped!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="Comments"><a href="#Comments" class="headerlink" title="Comments"></a>Comments</h3><p>Buffered comments look the same as single-line JavaScript comments. They act sort of like markup tags, producing <em>HTML</em> comments in the rendered page.</p><p>Like tags, buffered comments must appear on their own line:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// just some paragraphs</span></span><br><span class="line">p foo</span><br><span class="line">p bar</span><br><span class="line"></span><br><span class="line">=&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- just some paragraph --&gt;</span><br><span class="line">&lt;p&gt;foo&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">&lt;p&gt;bar&lt;/</span>p&gt;</span><br></pre></td></tr></table></figure><p>Pug also supports unbuffered comments, Simply ass a hyphen(<code>-</code>) to the start of the comment.</p><p>These are only for commenting on the Pug code itself, and <em>do not</em> appear in the rendered HTML.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//- will not output within markup</span></span><br><span class="line">p foo</span><br><span class="line"></span><br><span class="line">=&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;foo&lt;<span class="regexp">/p&gt;</span></span><br></pre></td></tr></table></figure><h4 id="Block-Comments"><a href="#Block-Comments" class="headerlink" title="Block Comments"></a>Block Comments</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">body</span><br><span class="line"><span class="comment">//- Comments for your templates writers.</span></span><br><span class="line">    Use <span class="keyword">as</span> much text <span class="keyword">as</span> you want</span><br><span class="line"><span class="comment">// Comments for your HTML readers</span></span><br><span class="line">    Use <span class="keyword">as</span> much text <span class="keyword">as</span> you want</span><br></pre></td></tr></table></figure><h3 id="Conditionals"><a href="#Conditionals" class="headerlink" title="Conditionals"></a>Conditionals</h3><p>Pugâs first-class conditional syntax allows for optional parenthese.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- <span class="keyword">var</span> user = &#123; <span class="attr">description</span>: <span class="string">'foo bar baz '</span>&#125;</span><br><span class="line">- <span class="keyword">var</span> authorized = <span class="literal">false</span></span><br><span class="line">#user</span><br><span class="line">  <span class="keyword">if</span> user.description</span><br><span class="line">    h2.green Description</span><br><span class="line">    p.description= user.description</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> authorized</span><br><span class="line">    h2.blue Description</span><br><span class="line">    p.description.</span><br><span class="line">      User has no description</span><br><span class="line">      why not add one...</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    h2.red Description</span><br><span class="line">    p.description User has no description</span><br></pre></td></tr></table></figure><p>Pug also provides the conditional <code>unless</code> which works like a negated <code>if</code>. The following are equivalent:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">unless user.isAnonymous</span><br><span class="line">  p You<span class="string">'re logged in as #&#123;user.name&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">=</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">if !user.isAnonymous</span></span><br><span class="line">  p You're logged in as #&#123;user.name&#125;</span><br></pre></td></tr></table></figure><h3 id="Filters"><a href="#Filters" class="headerlink" title="Filters"></a>Filters</h3><h3 id="Include"><a href="#Include" class="headerlink" title="Include"></a>Include</h3><p>Include allow you to insert the contents of one Pug file into another.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.pug</span></span><br><span class="line">doctype html</span><br><span class="line">html</span><br><span class="line">  include includes/head.pug</span><br><span class="line">  body</span><br><span class="line">    h1 My Site</span><br><span class="line">    p Welcome to my <span class="keyword">super</span> lame site</span><br><span class="line">    include includes/foot.pug</span><br><span class="line"></span><br><span class="line"><span class="comment">// includes/head.pug</span></span><br><span class="line">head</span><br><span class="line">  title My Site</span><br><span class="line">  script(src=<span class="string">'/javascripts/jquery.js'</span>)</span><br><span class="line">  script(src=<span class="string">'/javascripts/app.js'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// includes/foot.pug</span></span><br><span class="line">footer#footer</span><br><span class="line">  p Copyright (c) foobar</span><br></pre></td></tr></table></figure><p>If the path is absolute(e.g. <code>include /root.pug</code>), it is resolved by prepending <code>options.basedir</code>.</p><p>If no file extension is given, <code>.pug</code> is automatically appended to the file name.</p><h4 id="Including-Plain-Text"><a href="#Including-Plain-Text" class="headerlink" title="Including Plain Text"></a>Including Plain Text</h4><p>Including non-Pug files simply includes their raw text.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.pug</span></span><br><span class="line">doctype html</span><br><span class="line">html</span><br><span class="line">  head</span><br><span class="line">    style</span><br><span class="line">      include style.css</span><br><span class="line">    body</span><br><span class="line">      h1 My Site</span><br><span class="line">      p Welcome to my <span class="keyword">super</span> lame site</span><br><span class="line">      script</span><br><span class="line">        include script.js</span><br><span class="line"><span class="comment">// style.css</span></span><br><span class="line">h1 &#123;</span><br><span class="line">  color: red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// script.js</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Yor are awesome'</span>)</span><br></pre></td></tr></table></figure><h3 id="Template-Inheritance"><a href="#Template-Inheritance" class="headerlink" title="Template Inheritance"></a>Template Inheritance</h3><p>Pug supports template inheritance. Template instance works via <code>block</code> and <code>extends</code> keyword.</p><p>In a template, a <code>block</code> is simply a âblockâ of Pug that a child template may replace. This process is recursive.</p><p>Pug blocks can provide default content, if appropriate. Providing default content is purely optional, though. The example below defines <code>block scripts</code>, <code>block content</code> and <code>block foot</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// layout.pug</span></span><br><span class="line">html</span><br><span class="line">  head</span><br><span class="line">    title My Site - #&#123;title&#125;</span><br><span class="line">    block scripts</span><br><span class="line">      script(src=<span class="string">'/jquery.js'</span>)</span><br><span class="line">  body</span><br><span class="line">    block content</span><br><span class="line">    block foot</span><br><span class="line">      #footer</span><br><span class="line">        p some footer content</span><br></pre></td></tr></table></figure><p>To extend this layout, create a new file and use the <code>extends</code> directive with a path to the parent template(if no file extension is given, <code>.pug</code> is automatically appended to the file name). Then define one or more blocks to override the parent block content.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// page-a.pug</span></span><br><span class="line">extends layout.pug</span><br><span class="line"></span><br><span class="line">block scripts</span><br><span class="line">  script(src=<span class="string">"/jquery.js"</span>)</span><br><span class="line">  script(src=<span class="string">"/pets.js"</span>)</span><br><span class="line"></span><br><span class="line">block content</span><br><span class="line">  h1= title</span><br><span class="line">  - <span class="keyword">var</span> pets = [<span class="string">'cat'</span>, <span class="string">'dog'</span>]</span><br><span class="line">  each petName <span class="keyword">in</span> pets</span><br><span class="line">    include pet.pug</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pet.pug</span></span><br><span class="line">p= petName</span><br></pre></td></tr></table></figure><h3 id="Block-append-prepend"><a href="#Block-append-prepend" class="headerlink" title="Block append/prepend"></a>Block append/prepend</h3><p>Pug allows you to <code>replace</code>, <code>prepend</code> and <code>append</code> blocks</p><p>Suppose you have default scripts in a <code>head</code> block that you wish to use on <em>every page</em> you might do this:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// layout.pug</span></span><br><span class="line">html</span><br><span class="line">  head</span><br><span class="line">   block head</span><br><span class="line">    script(src=<span class="string">"/vendor/jquery.js"</span>)</span><br><span class="line">    script(src=<span class="string">"/vendor/caustic.js"</span>)</span><br><span class="line">  body</span><br><span class="line">    block content</span><br><span class="line"></span><br><span class="line"><span class="comment">// page.pug</span></span><br><span class="line">extends layout</span><br><span class="line"></span><br><span class="line">append head</span><br><span class="line">  script(src=<span class="string">"/vendor/three.js"</span>)</span><br></pre></td></tr></table></figure><h3 id="Interpolation"><a href="#Interpolation" class="headerlink" title="Interpolation"></a>Interpolation</h3><h4 id="String-Interpolation-Escaped"><a href="#String-Interpolation-Escaped" class="headerlink" title="String Interpolation, Escaped"></a>String Interpolation, Escaped</h4><p>Consider the placement of the following tempalteâs locals: <code>title</code>, <code>author</code> and <code>theGreat</code></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- <span class="keyword">var</span> title = <span class="string">'On Dogs'</span></span><br><span class="line">- <span class="keyword">var</span> author = <span class="string">'enlore'</span></span><br><span class="line">- <span class="keyword">var</span> theGreat = <span class="string">'&lt;span&gt;escaped!&lt;/span&gt;'</span></span><br><span class="line"></span><br><span class="line">h1= title</span><br><span class="line">p Written by #&#123;author&#125;</span><br><span class="line">p This will be safe: #&#123;theGreat&#125;</span><br></pre></td></tr></table></figure><p>This can be valid JavaScript expression, so you can do whatever feels good.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- <span class="keyword">var</span> msg = <span class="string">'not my inside voice'</span></span><br><span class="line">p This is $&#123;msg.toUpperCase()&#125;</span><br></pre></td></tr></table></figure><h3 id="String-Interpolation-Unescaped"><a href="#String-Interpolation-Unescaped" class="headerlink" title="String Interpolation, Unescaped"></a>String Interpolation, Unescaped</h3><p>You donât have to play it safe, you can buffer unescaped values into your templates too</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- <span class="keyword">var</span> riskyBusiness = <span class="string">'&lt;em&gt;Some of the girts&lt;/em&gt;'</span></span><br><span class="line">.quote</span><br><span class="line">  p joel: !&#123;riskyBusiness&#125;</span><br></pre></td></tr></table></figure><blockquote><p>Keep in mind that buffering unescaped content into your templates can be mighty risky if that content comes fresh from your users.</p></blockquote><h4 id="Tag-Interpolation"><a href="#Tag-Interpolation" class="headerlink" title="Tag Interpolation"></a>Tag Interpolation</h4><p>Interpolation works not only on JavaScript values, but on Pug as well, just use the tag interpolation syntax like so:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p.</span><br><span class="line">  Interpolate #[strong strongly word] there</span><br></pre></td></tr></table></figure><h4 id="Whitespace-Control"><a href="#Whitespace-Control" class="headerlink" title="Whitespace Control"></a>Whitespace Control</h4><p>The tag interpolation syntax is especially useful for inline tags, where whitespace before and after the tag is significant.</p><p>By default, however, Pug removes all spaces before and after tags.</p><h3 id="Iteration"><a href="#Iteration" class="headerlink" title="Iteration"></a>Iteration</h3><p>Pug supports two primary methods of iteration: <code>each</code> and <code>while</code></p><h4 id="each"><a href="#each" class="headerlink" title="each"></a>each</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">ul</span><br><span class="line">  each val, index <span class="keyword">in</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line">    li=  index + <span class="string">': '</span> + val</span><br><span class="line"></span><br><span class="line">ul</span><br><span class="line">  each val, index <span class="keyword">in</span> &#123;<span class="number">1</span>: <span class="string">'one'</span>, <span class="number">2</span>: <span class="string">'two'</span>&#125;</span><br><span class="line">    li= index + <span class="string">': '</span> + val</span><br><span class="line"></span><br><span class="line">- <span class="keyword">var</span> values = []</span><br><span class="line">ul</span><br><span class="line">  each val <span class="keyword">in</span> values.length ? values : [<span class="string">'There is no value'</span>]</span><br><span class="line">    li= val</span><br><span class="line"></span><br><span class="line">ul</span><br><span class="line">  each val <span class="keyword">in</span> values</span><br><span class="line">    li= val</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    li There is no value</span><br></pre></td></tr></table></figure><h4 id="While"><a href="#While" class="headerlink" title="While"></a>While</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- <span class="keyword">var</span> n = <span class="number">0</span></span><br><span class="line">ul</span><br><span class="line">  <span class="keyword">while</span> n &lt; <span class="number">4</span></span><br><span class="line">    li= n++</span><br></pre></td></tr></table></figure><h3 id="Mixins"><a href="#Mixins" class="headerlink" title="Mixins"></a>Mixins</h3><p>Mixins allow you to create reusable blocks of Pug</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Declaration</span></span><br><span class="line">mixin list</span><br><span class="line">  ul</span><br><span class="line">    li foo</span><br><span class="line">    li bar</span><br><span class="line">    li baz</span><br><span class="line"></span><br><span class="line"><span class="comment">// Use</span></span><br><span class="line">+list</span><br><span class="line">+list</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mixin pet(name)</span><br><span class="line">  li.pet= name</span><br><span class="line"></span><br><span class="line">ul</span><br><span class="line">  +pet(<span class="string">'cat'</span>)</span><br><span class="line">  +pet(<span class="string">'dog'</span>)</span><br><span class="line"></span><br><span class="line">=&gt;</span><br><span class="line">&lt;ul&gt;</span><br><span class="line">  &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">"pet"</span>&gt;cat&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">  &lt;li class="pet"&gt;dog&lt;/</span>li&gt;</span><br><span class="line">&lt;<span class="regexp">/ul&gt;</span></span><br></pre></td></tr></table></figure><h4 id="Mixin-Attributes"><a href="#Mixin-Attributes" class="headerlink" title="Mixin Attributes"></a>Mixin Attributes</h4><p>Mixins also get an implicit <code>attributes</code> argument, which is taken from the attributes passed to the mixin</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mixin link(href, name)</span><br><span class="line">  a(<span class="class"><span class="keyword">class</span>!</span>=attributes.class href=href)= name</span><br><span class="line"></span><br><span class="line">+link(<span class="string">'/foo'</span>, <span class="string">'foo'</span>)(<span class="class"><span class="keyword">class</span></span>=<span class="string">"btn"</span>)</span><br><span class="line">=&gt;</span><br><span class="line">&lt;a <span class="class"><span class="keyword">class</span></span>=<span class="string">"btn"</span> href=<span class="string">"foo"</span>&gt;foo&lt;<span class="regexp">/a&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>Note: The values in <code>attributes</code> by default are already escaped, you should use <code>!=</code> to avoid escaping them a secondtime.</p></blockquote><h4 id="Rest-Arguments"><a href="#Rest-Arguments" class="headerlink" title="Rest Arguments"></a>Rest Arguments</h4><p>You can write mixins that takes an unknown number of arguments using the <code>rest arguments</code> syntax</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mixin list(id, ...items)</span><br><span class="line">  ul(id=id)</span><br><span class="line">    each item <span class="keyword">in</span> items</span><br><span class="line">      li= item</span><br><span class="line"></span><br><span class="line">+list(<span class="string">'my-list'</span>, <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)</span><br></pre></td></tr></table></figure><h3 id="Plain-Text"><a href="#Plain-Text" class="headerlink" title="Plain Text"></a>Plain Text</h3><p>Pug provides four ways of getting <em>plain text</em></p><h4 id="Inline-in-a-Tag"><a href="#Inline-in-a-Tag" class="headerlink" title="Inline in a Tag"></a>Inline in a Tag</h4><p>The easiest way to add plain text is <em>inline</em>. The first term on the line is the tag itsel. Everything after the tag and one space will be the text content of that tag.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p This is plain old &lt;em&gt;text&lt;<span class="regexp">/em&gt; content.</span></span><br></pre></td></tr></table></figure><h4 id="Literal-HTML"><a href="#Literal-HTML" class="headerlink" title="Literal HTML"></a>Literal HTML</h4><p>Whole lines are also treated as plain text when they begin with a left angle bracket (&lt;), which may occasionally be useful for writing literal HTML tags in places that could otherwise be inconvenient.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">body</span><br><span class="line">  p Indenting the body tag there will make no difference</span><br><span class="line">  p HTML itself isn not whitespace-sensitive</span><br><span class="line">&lt;<span class="regexp">/html&gt;</span></span><br></pre></td></tr></table></figure><h4 id="Piped-Text"><a href="#Piped-Text" class="headerlink" title="Piped Text"></a>Piped Text</h4><p>Another way to add plain text to templates is to prefix a line with a pipe character (<code>|</code>). This method is useful for mixing plain text with inline tag.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">p</span><br><span class="line">  | The pipe always goes at the beginning <span class="keyword">of</span> its own line,</span><br><span class="line">  | not counting indentation.</span><br><span class="line">=&gt;</span><br><span class="line">&lt;p&gt;The pipe always goes at the beginning <span class="keyword">of</span> its own line, not counting indentation.&lt;<span class="regexp">/p&gt;</span></span><br></pre></td></tr></table></figure><h4 id="Block-in-a-Tag"><a href="#Block-in-a-Tag" class="headerlink" title="Block in a Tag"></a>Block in a Tag</h4><p>Often you might want large blocks of text wihtin a tag. To do this, just add a <code>.</code> right after the tag name, or after the closing parenthesis, if the tag has attributes.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">script.</span><br><span class="line">  <span class="keyword">if</span> (usingPug)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'You are awesome'</span>)</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'use pug'</span>)</span><br></pre></td></tr></table></figure><h3 id="Tags"><a href="#Tags" class="headerlink" title="Tags"></a>Tags</h3><p>By default, text at the start of a line (or after only white space) represents an HTML tag. Indented tags are nested.</p><p>To save space, Pug provides an inline syntax for nested tags.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a: <span class="function"><span class="params">img</span> =&gt;</span> &lt;a&gt;<span class="xml"><span class="tag">&lt;<span class="name">img</span> /&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>self-closing tag</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">foo/ =&gt; <span class="xml"><span class="tag">&lt;<span class="name">foo</span> /&gt;</span></span></span><br><span class="line">foo(bar='baz')/ =&gt; &lt;foo bar="baz" /&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> Pug, HTML </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Mix-Blend-Mode</title>
      <link href="/2017/08/28/mix-blend-mode/"/>
      <content type="html"><![CDATA[<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  mix-blend-mode: normal;</span><br><span class="line">  mix-blend-mode: multiply;</span><br><span class="line">  mix-blend-mode: screen;</span><br><span class="line">  mix-blend-mode: overlay;</span><br><span class="line">  mix-blend-mode: darken;</span><br><span class="line">  mix-blend-mode: lighten;</span><br><span class="line">  mix-blend-mode: color-dodge;</span><br><span class="line">  mix-blend-mode: color-burn;</span><br><span class="line">  mix-blend-mode: soft-light;</span><br><span class="line">  mix-blend-mode: hard-light;</span><br><span class="line">  mix-blend-mode: difference;</span><br><span class="line">  mix-blend-mode: exclusion;</span><br><span class="line">  mix-blend-mode: hue;</span><br><span class="line">  mix-blend-mode: saturation;</span><br><span class="line">  mix-blend-mode: color;</span><br><span class="line">  mix-blend-mode: luminosity;</span><br><span class="line">  mix-blend-mode: initial;</span><br><span class="line">  mix-blend-mode: inherit;</span><br><span class="line">  mix-blend-mode: unset;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="http://images2015.cnblogs.com/blog/608782/201705/608782-20170509102239519-1109457397.png" alt=""></p><h3 id="mix-blend-mode-screen"><a href="#mix-blend-mode-screen" class="headerlink" title="mix-blend-mode: screen"></a>mix-blend-mode: screen</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pug</span></span><br><span class="line">.container</span><br><span class="line">  - <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="number">3</span>; i++)</span><br><span class="line">    .box</span><br></pre></td></tr></table></figure><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$count</span>: <span class="number">3</span>;</span><br><span class="line"><span class="variable">$bgcolorlist</span>: <span class="number">#0801fb</span> <span class="number">#1ffe27</span> <span class="number">#fd1a20</span>;</span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#291f34</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">50%</span>;</span><br><span class="line">  trasnform: translate(-<span class="number">50%</span>, -<span class="number">50%</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">transform-origin</span>: <span class="number">48%</span> <span class="number">48%</span>;</span><br><span class="line">  mix-blend-mode: screen;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">for</span> <span class="variable">$i</span> from 1 through <span class="variable">$count</span> &#123;</span><br><span class="line">  <span class="selector-class">.box</span>:nth-child(#&#123;<span class="variable">$i</span>&#125;) &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: nth($ä¸è¿colorlist, $i);</span><br><span class="line">    <span class="attribute">animation</span>: turn <span class="number">3s</span> linear #&#123;<span class="number">1</span>-<span class="variable">$i</span>&#125;s infinite;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@keyframes turn &#123;</span><br><span class="line">  to &#123;</span><br><span class="line">    <span class="attribute">transform</span>: rotate(<span class="number">360deg</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Start at Headless</title>
      <link href="/2017/08/27/Start-at-Headless/"/>
      <content type="html"><![CDATA[<p>Run Chrome without chrome, it brings all modern web platform features provided by Chromium and the Blink rendering engine to the command line.</p><p>A headless browser is a great tool for automated testing and server environments where you donât need a visible UI shell.</p><h3 id="Starting-Headless-CLI"><a href="#Starting-Headless-CLI" class="headerlink" title="Starting Headless (CLI)"></a>Starting Headless (CLI)</h3><p>The easiest way to get started with headless mode is to open the Chrome binary from the command line. If youâve got Chrome 59+ installed, start Chrome with the <code>-- headless</code> flag:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">chrome \</span><br><span class="line">  --headless \  <span class="comment"># Runs Chrome in headless mode</span></span><br><span class="line">  --<span class="built_in">disable</span>-gpu \ <span class="comment"># Temporarily needed for now</span></span><br><span class="line">  --remote-debugging-port=9222 \</span><br><span class="line">  https://www.chromestatus.com <span class="comment"># URL to open. Defaults to about:blank</span></span><br></pre></td></tr></table></figure><p><code>chrome</code> should point to your installation of Chrome.</p><h3 id="Command-line-features"><a href="#Command-line-features" class="headerlink" title="Command line features"></a>Command line features</h3><p>In some cases, you may not need to programmatically script Headless Chrome. There are some useful command line flags to perform common tasks.</p><h4 id="Printing-the-DOM"><a href="#Printing-the-DOM" class="headerlink" title="Printing the DOM"></a>Printing the DOM</h4><p>The <code>--dump-dom</code> flag prints <code>document.body.innerHTML</code> to stdout:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chrome --headless --<span class="built_in">disable</span>-gpu --dump-dom https://www.chromestatus.com/</span><br></pre></td></tr></table></figure><h4 id="Create-a-PDF"><a href="#Create-a-PDF" class="headerlink" title="Create a PDF"></a>Create a PDF</h4><p>The <code>--print-to-pdf</code> flag creates a PDF of the page</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chrome --headless --<span class="built_in">disable</span>-gpu --<span class="built_in">print</span>-to-pdf https://chromestatus.com/</span><br></pre></td></tr></table></figure><h4 id="Taking-screenshots"><a href="#Taking-screenshots" class="headerlink" title="Taking screenshots"></a>Taking screenshots</h4><p>To capture a screenshot of a page, use the <code>--screenshot</code> flag:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">chrome --headless --<span class="built_in">disable</span>-gpu --screenshot https://chromestatus.com/</span><br><span class="line"></span><br><span class="line"><span class="comment"># Size of a standard letterhead.</span></span><br><span class="line">chrome --headless -<span class="built_in">disable</span>-gpu --screenshot --window-size=1280,1696 https://chromestatus.com/</span><br></pre></td></tr></table></figure><h3 id="REPL-mode"><a href="#REPL-mode" class="headerlink" title="REPL mode"></a>REPL mode</h3><p>The <code>--repl</code> flag runs Headless in a mode where you can evaluate JS expression in the browser, right from the command line:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">chrome --headless --<span class="built_in">disable</span>-gpu --repl https://chromestatus.com/</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; location.href</span><br><span class="line">&#123;<span class="string">"result"</span>:&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"value"</span>:<span class="string">"https://www.chromestatus.com/features"</span>&#125;&#125;</span><br><span class="line">&gt;&gt;&gt; quit</span><br></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Node.js Child_process</title>
      <link href="/2017/08/24/Node-js-child-process/"/>
      <content type="html"><![CDATA[<p>Node.js runs in single-threaded, event-driven mode, which is good for improving performance via multiple child process.</p><p>Each child process has three stream objects:</p><ul><li><p><code>child.stdin</code></p></li><li><p><code>child.stdout</code></p></li><li><p><code>child.stderr</code></p></li></ul><p>All these three stream objects may share their parentâs <code>stdio</code>, or set to use their own stream object independently.</p><p>Node.js offers <code>child_process</code> module to create new child process:</p><ul><li><p><code>exec</code> â <code>child_process.exec</code> use child process to execute shell command, and buffer the output for callback. This means the <code>exec</code> will buffer the whole returned value in buffer, usually you should limit the buffer in 200k, if not, the process will exit with <code>Error: maxBuffer exceeded</code>.</p></li><li><p><code>spawn</code> â <code>child_process.spawn</code> use command line to create new process. spawn will return a <strong>stream object</strong> with <code>stdout</code> and <code>stderr</code>. We can use <code>stdout</code> stream to read the data returned from child process. <code>stdout</code> has event handles like <code>data</code>, <code>end</code>. You can use <code>spawn</code> when a large data will returned from child process.</p></li><li><p><code>fork</code> â <code>child_process.fork</code> is the <code>spawn</code> in special mode(specify <code>node</code> to run the command). <code>fork(&#39;./son.js&#39;)</code> equals to <code>spawn(&#39;node&#39;, [&#39;./son.js&#39;])</code>. Different from <code>spawn</code>, <code>fork</code> will build a message pipe between main and child process.</p></li></ul><h3 id="exec"><a href="#exec" class="headerlink" title="exec"></a>exec</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> exec = <span class="built_in">require</span>(<span class="string">'child_process'</span>).exec</span><br><span class="line">exec(<span class="string">'dir'</span>, &#123;<span class="attr">encoding</span>: <span class="string">'utf-u'</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, stdout, stderr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err.stack)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Error Code: '</span> + err.code)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Signal Received: '</span> + err.signal)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'data: '</span> + stdout)</span><br><span class="line">&#125;).on(<span class="string">'exit'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">code</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'child process exit with code: '</span> + code)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="spawn"><a href="#spawn" class="headerlink" title="spawn"></a>spawn</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> spawn = <span class="built_in">require</span>(<span class="string">'child_process'</span>).spawn</span><br><span class="line"><span class="keyword">const</span> spawnedProcess = spawn(<span class="string">'ping'</span>, [<span class="string">'127.0.0.1'</span>], &#123; <span class="attr">encoding</span>: <span class="string">'utf-8'</span>&#125;)</span><br><span class="line"></span><br><span class="line">spawnedProcess.stdout.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(chunk.toString())</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">spawnedProcess.stderr.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">spawnedProcess.on(<span class="string">'close'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">code</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'close code: '</span> + code)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">spawnedProcess.on(<span class="string">'exit'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">code</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'exit code: '</span> + code)</span><br><span class="line">  fs.close(fd, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="built_in">console</span>.error(err)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="fork"><a href="#fork" class="headerlink" title="fork"></a>fork</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// parent.js</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'parent pid: '</span> + process.pid)</span><br><span class="line"><span class="keyword">const</span> fork = <span class="built_in">require</span>(<span class="string">'child_process'</span>).fork</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> child = fork(<span class="string">'./child.js'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'fork return pid: '</span> + child.pid)</span><br><span class="line">child.on(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">msg</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'parent recieve message: '</span> + <span class="built_in">JSON</span>.stringify(msg))</span><br><span class="line">&#125;)</span><br><span class="line">child.send(&#123;</span><br><span class="line">  key: <span class="string">'parent value'</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// child.js</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'child pid: '</span> + process.pid)</span><br><span class="line">process.on(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">msg</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'child recieve message: '</span> + msg)</span><br><span class="line">&#125;)</span><br><span class="line">process.send(&#123;</span><br><span class="line">  key: <span class="string">'child value'</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Node Child Process</title>
      <link href="/2017/08/22/Node-Child-Process/"/>
      <content type="html"><![CDATA[<p><img src="https://cdn-images-1.medium.com/max/2000/1*I56pPhzO1VQw8SIsv8wYNA.png" alt=""></p><p>Single-threaded, non-blocking performance in Node works great for a single process. But eventually, one process in one CPU is not going to be enough to handle the increasing workload of your application.</p><p>Using multiple processes is the best way to scale a Node application. Node is designed for building distributed applications with many nodes.</p><h3 id="The-Child-Process-Module"><a href="#The-Child-Process-Module" class="headerlink" title="The Child Process Module"></a>The Child Process Module</h3><p>We can easily spin a child process using Nodeâs <code>child_process</code> module and those child processes can easily communicate with each other with a messaging system.</p><p>The <code>child_process</code> module enables us to access Operating System functionalities by running any system command inside child process.</p><p>We can control that child process input stream, and listen to its output stream. We can also control the arguments to be passed to the underlying OS command, and we can do whatever we want with that commandâs output.</p><p>There are four different ways to create a child process in Node: <code>spawn()</code>, <code>fork()</code>, <code>exec()</code>, <code>execFile()</code>.</p><h3 id="Spawned-Child-Process"><a href="#Spawned-Child-Process" class="headerlink" title="Spawned Child Process"></a>Spawned Child Process</h3><p>The <code>spawn</code> function launches a command in a new process and we can use it to pass that command any arguments. For example, hereâs code to spawn a new process that will execute the <code>pwd</code> command.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; spawn &#125; = <span class="built_in">require</span>(<span class="string">'child_process'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> child = spawn(<span class="string">'pwd'</span>)</span><br></pre></td></tr></table></figure><p>We simply destructure the <code>spawn</code> function out of the <code>child_process</code> module and execute it with the OS command as the first argument.</p><p>The result of executing the <code>spawn</code> function (the <code>child</code> object above) is a <code>ChildProcess</code> instance, which implements the <code>EventEmitter API</code>. This means we can register handlers for events on this child object directly. For example, we can do something when the child process exits by registering a handler for the <code>exit</code> event.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">child.on(<span class="string">'exit'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">code, signal</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'child process exited with '</span> + <span class="string">`code <span class="subst">$&#123;code&#125;</span> and signal <span class="subst">$&#123;signal&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>The handler above gives us the exit <code>code</code> for the child process and the <code>signal</code>, if any, that was used to terminate the child process. This <code>signal</code> variable is null when the child process exits normally.</p><p>The other events that we can register handlers for with the <code>ChildProcess</code> instances are <code>disconnect</code>, <code>error</code>, <code>close</code>, <code>message</code>.</p><ul><li><p>The <code>disconnect</code> event is emitted when the parent process manually calls the <code>child.disconnect</code> function.</p></li><li><p>The <code>error</code> event is emitted if the process could not be spawned or killed.</p></li><li><p>The <code>close</code> event is emitted when the <code>stdio</code> streams of a child process get closed.</p></li><li><p>The <code>message</code> event is the most important one. Itâs emitted when the child process uses the <code>process.send()</code> function to send messages. This is how parent/child processes can communicate with each other.</p></li></ul><p>Every child process also gets the three standard <code>stdio</code> streams, which we can access using <code>child.stdin</code>, <code>child.stdout</code>, <code>child.stderr</code>.</p><p>When those streams get closed, the child process that was using them will emit the <code>close</code> event. This <code>close</code> event is different than the <code>exit</code> event because multiple child processes might share the same <code>stdio</code> streams and so one child process exiting does not mean that the streams got closed.</p><p>Since all streams are event emitters, we can listen to different events on those <code>stdio</code> stream that are attached to every child process. Unlike in a normal process though, in a child process, the <code>stdout</code>/<code>stderr</code> streams are readable streams while the <code>stdin</code> stream is a writable one. This is basically the inverse of those types as found in a main process. The events we can use for those streams are the standard ones. Most importantly, on the readable streams, we can listen to the <code>data</code> event, which will have the output of the command or any errorencoutered while executing the command:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">child.stdout.on(<span class="string">'data'</span>, (data) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`child stdout:\n<span class="subst">$&#123;data&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">child.stderr.on(<span class="string">'data'</span>, (data) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.error(<span class="string">`child \n<span class="subst">$&#123;data&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>The two handlers above will log both cases to the main process <code>stdout</code> and <code>stderr</code>. When we execute the <code>spawn</code> function above, the output of the <code>pwd</code> command gets printed and the child process exits with code <code>0</code>, which means no error occured.</p><p>We can pass arguments to the command thatâs executed by the <code>spawn</code> function using the second argument of the <code>spawn</code> function, which is an array of all the arguments to be passed to the command.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> child = spawn(<span class="string">'find'</span>, [<span class="string">'.'</span>, <span class="string">'-type'</span>, <span class="string">'f'</span>])</span><br></pre></td></tr></table></figure><p>If an error occurs during the execution of the command, for example, if we give find an invalid destination above, the <code>child.stderr</code> <code>data</code> event handler will be triggered and the <code>exit</code> event handler will report an exit code of <code>1</code>, which signifies that an error has occured.</p><p>A child process <code>stdin</code> is a writable stream. We can use it to send a command some input. Just like any writable stream, the easiest way to consume it is using the <code>pipe</code> function. We simply pipe a readable stream into a writable stream. SInce the main process <code>stdin</code> is a readable stream, we can pipe that into a child process <code>stdin</code> stream.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; spawn &#125; = <span class="built_in">require</span>(<span class="string">'child_process'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> child = spawn(<span class="string">'wc'</span>)</span><br><span class="line"></span><br><span class="line">process.stdin.pipe(child.stdin)</span><br><span class="line"></span><br><span class="line">child.stdout.on(<span class="string">'data'</span>, (data) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`child stdout:\n<span class="subst">$&#123;data&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>In the example above, the child process invokes the <code>wc</code> command, which count lines, words, and characters in Linux. When we pipe the main process <code>stdin</code>(which is a readable stream) into the child process <code>stdin</code>(which is a writable stream). The result of this combination is that we get a standard input mode where we can type somthing and when we hit <code>Ctrl + D</code>, what we typed will be used as the input of the <code>wc</code> command.</p><p>We can also pipe the standard input/output of multiple processes on each other, just like we can do with Linux commands. For example, we can pipe the <code>stdout</code> of the <code>find</code> command to the <code>stdin</code> of the <code>wc</code> command to count all the files in the current directory:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; spawn &#125; = <span class="built_in">require</span>(<span class="string">'child_process'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> find = spawn(<span class="string">'find'</span>, [<span class="string">'.'</span>, <span class="string">'-type'</span>, <span class="string">'f'</span>])</span><br><span class="line"><span class="keyword">const</span> wc = spawn(<span class="string">'wc'</span>, [<span class="string">'-l'</span>])</span><br><span class="line"></span><br><span class="line">find.stdout.pipe(wc.stdin)</span><br><span class="line"></span><br><span class="line">wc.stdout.on(<span class="string">'data'</span>, (data) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Number of files <span class="subst">$&#123;data&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Add <code>-l</code> to the <code>wc</code> command to make it count only the lines.</p><h3 id="Shell-Syntax-and-the-exec-Function"><a href="#Shell-Syntax-and-the-exec-Function" class="headerlink" title="Shell Syntax and the exec Function"></a>Shell Syntax and the exec Function</h3><p>By default, the <code>spawn</code> function does not create a <em>shell</em> to execute the command we pass into it. This makes it slightly more efficient than the <code>exec</code> function, which does create a shell. The <code>exec</code> function has one other major difference. It <em>buffers</em> the commandâs generated output and passes the whole output value to a callback function(instead of using streams, which is what <code>spawn</code> does).</p><p>Here the is previous <code>find | wc</code> example implemented with an <code>exec</code> function.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; exec &#125; = <span class="built_in">require</span>(<span class="string">'child_process'</span>)</span><br><span class="line"></span><br><span class="line">exec(<span class="string">'find . -type  f | wc -l'</span>, (err, stdout, stderr) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(<span class="string">`exec error: <span class="subst">$&#123;err&#125;</span>`</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Number of files <span class="subst">$&#123;stdout&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Since the <code>exec</code> function uses a shell to execute the command, we can use the <code>shell syntax</code> directly here making use of the <code>shell pipe</code> feature.</p><p>Note that using the shell syntax comes at a <code>security risk</code> if youâre executing any kind of dynamic input provided externally. A user can simply do a command injection attrack using shell syntax characters like ; and $(For example, <code>commnd + &#39;; rm -rf ~&#39;</code>)</p><p>The <code>exec</code> function buffers the output and passes it to the callback function(the second argument to <code>exec</code>) as the <code>stdout</code> argument there. This <code>stdout</code> argument is the commandâs output that we want to print out.</p><p>The <code>exec</code> function is a good choice if you need to use the shell syntax and if the size of the data expected from te command is small(Remember <code>exec</code> will buffer the whole data in memory before returning it).</p><p>The <code>spawn</code> function is a much better choice when the size of the data expected from the command is large, because that data will be streamed with the standard IO objects.</p><p>We can make the spawned child process inherit the standard IO object of its parents if we want to, but also, more importantly, we can ke the <code>spawn</code> function use the shell syntax as well. Hereâs the smae <code>find | wc</code> command implemented with the <code>spawn</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> child = spawn(<span class="string">'find . -type f'</span>, &#123;</span><br><span class="line">  stdio: <span class="string">'inherit'</span>,</span><br><span class="line">  shell: <span class="literal">true</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Because of the <code>stdio: &#39;inherit&#39;</code> option above, when we execute the code, the child process inherits the main process <code>stdin</code>, <code>stdout</code> and <code>stderr</code>. This causes the child process data events handlers to be triggered on the main <code>process.stdout</code> stream, making the script output the result right away.</p><p>Because of the <code>shell: true</code> option above, we were able to use the shell syntax in the passed command, just like we did with <code>exec</code>. But with this code, we still get the advantage of the streaming of data that the <code>spawn</code> function gives us. <em>THis is really the best of both worlds</em>.</p><p>There are a few other good options we can use in the last argument to the <code>child_process</code> function besides <code>shell</code> and <code>stdio</code>. We can, for example, use the <code>cwd</code> option to change the working directory of the script.</p><p>Another option we can use is the <code>env</code> option to specify the environment variables that will be visible to the new child process. The default for this option is <code>process.env</code> which gives any command access to the current process environment. If we want ot override that behavior, we can simple pass an empty object as the <code>env</code> option or new value there to be considered as the only environment variables:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> child = spawn(<span class="string">'echo $ANSWER'</span>, &#123;</span><br><span class="line">  stdio: <span class="string">'inherit'</span>,</span><br><span class="line">  shell: <span class="literal">true</span>,</span><br><span class="line">  env: &#123;</span><br><span class="line">    ANSWER: <span class="number">12</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>The echo command above does not have access to the parent processâs environment variables. It canât, for example, access <code>$HOME</code>, but it can accccess <code>$ANSWER</code> because it was passes as a custom environement variable through the <code>env</code> option.</p><p>One last important child process option to explain here is the <code>detached</code> option, which makes the child process run independently of its parent process.</p><p>Assuming we have a file <code>timer.js</code> that keeps the event loop busy:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// keep the event loop busy</span></span><br><span class="line">&#125;, <span class="number">20000</span>)</span><br></pre></td></tr></table></figure><p>We can execute it in the background using the <code>detached</code> option:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; spawn &#125; = <span class="built_in">require</span>(<span class="string">'child_process'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> child = spawn(<span class="string">'node'</span>, [<span class="string">'timer.js'</span>], &#123;</span><br><span class="line">  detached: <span class="literal">true</span>,</span><br><span class="line">  stdio: <span class="string">'ignore'</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">child.unref()</span><br></pre></td></tr></table></figure><p>The exact behavior of detached child process depends on the OS. On windows, the detached child process will have its own console window while on Linux the detached child process will be made the leader of a new process groups and session.</p><p>It the <code>unref</code> function is called on the detached process, the parent process can exit independently of the child. This can be useful if the child is executing a long-running process, but to keep it running in the background the childâs <code>stdio</code> configurations also have to be independent of the parent.</p><p>The example above will run a node script(timer.js) in the background by detaching and also ignoring its parent <code>stdio</code> file descriptors so that the parent can terminate while the child keeps running in the background.</p><h3 id="The-execFile-function"><a href="#The-execFile-function" class="headerlink" title="The execFile function"></a>The execFile function</h3><p>If you need to execute a file without using a shell, the <code>execFile</code> function is what you need. It behaves exactly like the <code>exec</code> function, but does not use a shell, which makes it a bit more efficient. On windows, some files cannot be executed on their own, like <code>.bat</code>, <code>.cmd</code> files. Those files cannot be executed with <code>execFile</code> and either <code>exec</code> or <code>spawn</code> with shell set to true is required to execute them.</p><h3 id="The-Sync-Function"><a href="#The-Sync-Function" class="headerlink" title="The *Sync Function"></a>The *Sync Function</h3><p>The functions <code>spawn</code>, <code>exec</code>, <code>execFile</code> from the <code>child_process</code> module also have synchronous blocking versions that will wait until child process exits.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">  spawnSync,</span><br><span class="line">  execSync,</span><br><span class="line">  execFileSync,</span><br><span class="line">&#125; = <span class="built_in">require</span>(<span class="string">'child_process'</span>)</span><br></pre></td></tr></table></figure><h3 id="The-fork-function"><a href="#The-fork-function" class="headerlink" title="The fork() function"></a>The fork() function</h3><p>THe <code>fork</code> function is a variation of the <code>spawn</code> function for spawning node processes. The biggest difference between <code>spawn</code> and <code>fork</code> is that a communication channel is established to the child process when using <code>fork</code>, so we can use the <code>send</code> function on the forked along with the global <code>process</code> object itself to exchange messsages between the parent and forked processes. We do this through the <code>EventEmitter</code> module interface.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// parent.js</span></span><br><span class="line"><span class="keyword">const</span> &#123; fork &#125; = <span class="built_in">require</span>(<span class="string">'child_process'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> forked = fork(<span class="string">'child.js'</span>)</span><br><span class="line"></span><br><span class="line">forked.on(<span class="string">'message'</span>, (msg) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Message from child'</span>, msg)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">forked.send(&#123;</span><br><span class="line">  hello: <span class="string">'world'</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// child.js</span></span><br><span class="line"></span><br><span class="line">process.on(<span class="string">'message'</span>, (msg) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Message from parent:'</span>, msg)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">let</span> counter = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  process.send(&#123;</span><br><span class="line">    counter: counter++</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;, <span class="number">1000</span>)</span><br></pre></td></tr></table></figure><p>In the parent.js we fork <code>child.js</code>(<strong>which will execute the file with the <code>node</code> command</strong>) and then we listen for the <code>message</code> event. The <code>message</code> event will be emitted whenever the child use <code>process.send</code>.</p><p>The pass down messages from the parent to the child, we can execute the <code>send</code> function one the forked object it self, and then, in the child script we can listen to the <code>message</code> event on the global <code>process</code>.</p><p>When executing the <code>parent.js</code> file, itâll first send down the <code>{hello: &#39;world&#39;}</code> object to be printed by the forked child process and then the forked child process will send an incremental counter value every second to be printed by the parent process.</p><p>Letâs do more practical example about the <code>fork</code> function.</p><p>Letâs say we have an http server that handles two endpoints. One of these endpoints(<code>/compute</code> below) is computationally expensive and will take a few seconds to complete. WE can use a long for loop to simulate that:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> longComputation = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> sum = <span class="number">0</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">1e9</span>; i++) &#123;</span><br><span class="line">    sum += i</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> sum</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer()</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">'request'</span>, (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (req.url === <span class="string">'/compute'</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> sum = longComputation()</span><br><span class="line">    <span class="keyword">return</span> res.end(<span class="string">`Sum is <span class="subst">$&#123;sum&#125;</span>`</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res.end(<span class="string">'OK'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure><p>The program has a big problem: when the <code>/compute</code> endpoint is requested, the server will not be able to handle any other requests because the event loop is busy with the long for loop operation.</p><p>There are a few ways which we can solve this problem depending on the nature of the long operation but one solution that works for all operation is to just move the computational operation into another process using <code>fork</code>.</p><p>We first move the whole <code>longComputation</code> function into its own file and make it invoke that function when instructed via a message from the main process:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// compute.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> longComputatioin  = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> sum = <span class="number">0</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">1e9</span>; i++) &#123;</span><br><span class="line">    sum += i;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> sum</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">process.on(<span class="string">'message'</span>, (msg) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> sum = longComputatioin()</span><br><span class="line">  process.send(sum)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// server.js</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; fork &#125; = <span class="built_in">require</span>(<span class="string">'child_process'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer()</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">'request'</span>, (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (req.url === <span class="string">'/compute'</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> compute = fork(<span class="string">'compute.js'</span>)</span><br><span class="line">    compute.send(<span class="string">'start'</span>)</span><br><span class="line">    compute.on(<span class="string">'message'</span>, sum =&gt; &#123;</span><br><span class="line">      res.end(<span class="string">`Sum is <span class="subst">$&#123;sum&#125;</span>`</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res.end(<span class="string">'OK'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure><p>When a request to <code>/compute</code> happens now with the above code, we simply send a message to the forked process to start executing the long operation. The main processâs event loop will not be blocked.</p><p>Once the forked process is done with the long operation, it can send its result back to the parent process using <code>process.send</code>.</p><p>Nodeâs <code>cluster</code> module is based on this idea of child process forking and load balancing the requests among the many forks.</p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Scaling Node.js App</title>
      <link href="/2017/08/22/Scaling-Node-js-App/"/>
      <content type="html"><![CDATA[<h3 id="Strategies-of-Scalability"><a href="#Strategies-of-Scalability" class="headerlink" title="Strategies of Scalability"></a>Strategies of Scalability</h3><p>The workload is the most popular reason we scale our applications, but itâs not the only reason. We also scale our applications to increase their availability and tolerance to failure.</p><h4 id="Cloning"><a href="#Cloning" class="headerlink" title="Cloning"></a>Cloning</h4><p>The easiest thing to do to scale a big application is to clone it mulitple times and have each cloned instance handle part of the workload(with a load balancer). This does not cost a lot in term of development time and itâs highly effective. This strategy is the minimum you should do and Node.js has the built-in module, <code>cluster</code>, to make is easier for you to implement the cloning strategy on a single server.</p><h4 id="Decomposing"><a href="#Decomposing" class="headerlink" title="Decomposing"></a>Decomposing</h4><p>We can also scale an application by decomposiing it based on functionalities and services. This means having mulitple, different applications with different code bases and sometimes with their own dedicated databases and User Interfaces.</p><p>This strategy is commonly associated with the term <strong>Microservice</strong>, where micro indicates that those services should be small as possible, but in reality, the size of the service is not whatâs important but rather the enforement of loose coupling and high cohesion between services.</p><h4 id="Splitting"><a href="#Splitting" class="headerlink" title="Splitting"></a>Splitting</h4><p>We can also split the application into multiple instances where each instance is responsible for only a part of the applicationâs data. This strategy is often named <strong>horizontal partitioning</strong>, or <strong>sharding</strong>, in database. Data partitioning requires a lookup step before each operation to determine which instance of the application to use.</p><p>Successfully scaling a big application should eventually implement all three strategies.</p><h3 id="The-Cluster-Module"><a href="#The-Cluster-Module" class="headerlink" title="The Cluster Module"></a>The Cluster Module</h3><p>The cluster module can be used to enable load balancing over an environementâs multiple CPU cores. Itâs based on the child process module <code>fork</code> method and it basically allows us to fork the main application process as many times as we have CPU cores. It will then take over and load balance all requests to the main process across all forked processs.</p><p>The cluster module is Nodeâs helper for us to implement the cloning scalability strategy, but only on one machine. When you have a big machine with a lot resources or when itâs easier and cheaper to add more resources to one machine ratherthan adding new machine, the cluster module is a greate option for a really quick implementation of the cloning strategy.</p><p>Even small machines usually have multiple cores and even if youâre not worried about the load on your Node server, you should enable the cluster module anyway to increase your server availability and fault-tolerance.</p><p>Itâs a simple step and when using a process manager like PM2, for example, it becomes as simple as just providing an argument to the launch command.</p><p>The structure of what the cluster module does is simple. We create a <em>master process</em> and that master process <em>forks</em> a number of <em>worker processes</em> and manage them. Each worker process represents an instance of the application that we want to scale. All incoming requests are handled by the master process, which is the one that decides which worker process should handle the incoming request.</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*C7ICI8d7aAna_zTZvZ64MA.png" alt=""></p><p>The master processâs job is easy because it actually just uses a <em>round-robin</em> algorithm to pick a worker process. This is enabled by default on all platform except windows and it can be globally modified to let the load-balancing be handled by the operation system self.</p><p>The round-robin algorithm distributes the load evenly across all available processes on a rotational basis. The first request is forwarded to the first worker process, the second to the next worker process in the list, and so on. When the end of the list is reached, the algorithm starts again from the beginning.</p><h3 id="Load-Balancing-an-HTTP-Server"><a href="#Load-Balancing-an-HTTP-Server" class="headerlink" title="Load-Balancing an HTTP Server"></a>Load-Balancing an HTTP Server</h3><p>Letâs clone and load balance a simple HTTP server using the cluster module.</p><p>Hereâs the simple Nodeâs hello-world example server slightly modified to simulate some CPU work before responding:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">const</span> pid = process.pid</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">1e7</span>; i++) &#123;</span><br><span class="line">    <span class="comment">// simulate CPU work</span></span><br><span class="line">  &#125;</span><br><span class="line">  res.end(<span class="string">`Handled by process <span class="subst">$&#123;pid&#125;</span>`</span>)</span><br><span class="line">&#125;).listen(<span class="number">8080</span>, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Started process <span class="subst">$&#123;pid&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Before we create a cluster to clone this server into multiple workers, letâs do a simple benchmark of how many requests this server can handle per second. We can use <strong>Apache benchmarking tool</strong> for that.</p><p>After running the simple <code>server.js</code> code above, run this <code>ab</code> command:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ab -c200 http://localhost:8080/</span><br></pre></td></tr></table></figure><p>This command will test-load the server with 200 concurrent connections for 10 seconds.</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*w8VmzV81atlTzHn7pDXu1g.png" alt=""></p><p>The single node server was able to handle about 51 requests per seconds.</p><p>Now that we have a reference benchmark, we can scale the application with the cloning strategy using the cluster module.</p><p>On the same level as the <code>server.js</code> file above, we can create a new file(<code>cluster.js</code>) <strong>for the master process</strong> with this content:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// cluster.js</span></span><br><span class="line"><span class="keyword">const</span> cluster = <span class="built_in">require</span>(<span class="string">'cluster'</span>)</span><br><span class="line"><span class="keyword">const</span> os = <span class="built_in">require</span>(<span class="string">'os'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (cluster.isMaster) &#123;</span><br><span class="line">  <span class="keyword">const</span> cpu = os.cpus().length</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Forking for <span class="subst">$&#123;cpu&#125;</span> CPUS`</span>)</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; cpus; i++) &#123;</span><br><span class="line">    cluster.fork()</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="built_in">require</span>(./server)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>In <code>cluster.js</code>, we first required both the <code>cluster</code> module and the <code>os</code> module, we use the <code>os</code> module to read the number of CPUS cores we can work with using <code>os.cpus()</code>.</p><p>The <code>cluster</code> module gives us the handy Boolean flag <code>isMaster</code> to determine if this <code>cluster.js</code> file is being loaded as a master process or not. The first time we execute this file, we will be executing the master process and that <code>isMaster</code> flag will be set to true. In this case, we can instruct the master process to fork our server as many times as we have CPU cores.</p><p>Now we just read the number of CPUs we have using the <code>os</code> module, then with a for loop over that number, we call the <code>cluster.fork</code> method. The for loop will simple create as many workers as the number of CPUs in the system to take advantage of all the available processing power.</p><p>When the <code>cluster.fork</code> line is executed from the master process, the current file, <code>cluster.js</code>, is run again, but this time in <em>worker mode</em> with the <code>isMaster</code> flag set to false.</p><p><em>There is actually another flag set to true in this case if you need to use it, which is the <code>isWorker</code></em> flag.</p><p>When the application runs as a worker, it can start doing the actual work. This is where we need to define our server logic, which, for this example, we can do by requiring the <code>server.js</code> file that we already have.</p><p>Thatâs basically it. Thatâs how easy it is to take advantage of all the processing power in a machine. To test the cluster, run the <code>cluster.js</code> file.</p><p><img src="https://cdn-images-1.medium.com/max/800/1*c0S-W4GYgCGB_maJ94ZLPw.png" alt=""></p><p>Itâs important to understand that these are completely different Node.js processes. Each worker process here will have its own event loop and memory space.</p><p>When we now hit the web server multiple times, the requests will start to get handled by different worker processes with different process ids. The worker will not be exactly rotated in sequence because the cluster module performs some optimizations when picking the next worker, but the load will be somehow distributed among the different worker process.</p><p>We can use the same <code>ab</code> command above to load-test this cluster of processes:</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*5_EogHG-Egf2uAMOj9PmCA.png" alt=""></p><p>Now the cluster can handle 181 requests per seconds.</p><h3 id="Broadcasting-Messages-to-All-Workers"><a href="#Broadcasting-Messages-to-All-Workers" class="headerlink" title="Broadcasting Messages to All Workers"></a>Broadcasting Messages to All Workers</h3><p>Communicating between the master process and the workers is simple because under the hood the cluster module is just using the <code>child_process.fork</code> API, which means we also have communication channels available between the master process and each workers.</p><p>Based on the <code>server.js</code>/<code>cluster.js</code> example above, we can access the list of worker objects using <code>cluster.workers</code>, which is an object that holds a reference to all workers and can be used to read information about these workers. Since we have communication channels between master process and all workers, to broadcast a message to all them we just need a simple loop over all the workers:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.values(cluster.workers).forEach(<span class="function"><span class="params">worker</span> =&gt;</span> &#123;</span><br><span class="line">  worker.send(<span class="string">`Hello Worker <span class="subst">$&#123;worker.pid&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>We simple used <code>Object.values</code> to get an array of all workers from the <code>cluster.workers</code> object. Then for each worker we can use the <code>send</code> function to send over any value that we want.</p><p>In a worker file, <code>server.js</code> in our example, to read a message received from this master process, we can register a handler for the <code>message</code> event on the global <code>process</code> object:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">process.on(<span class="string">'message'</span>, (msg) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Message from master: <span class="subst">$&#123;msg&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><img src="https://cdn-images-1.medium.com/max/1000/1*6XfoWiNKTCiDjqar7L5_xw.png" alt=""></p><p>Every worker received a message from the master process. <em>Note how the workers did not start in order</em>.</p><p>Letâs make this communication example a little bit more practical. Letâs say we want our server to reply with the number of users we have created in our database. We will create a mock function that returns the number of users we have in the database and just have it square its value every time itâs called:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// **** Mock DB Call</span></span><br><span class="line"><span class="keyword">const</span> numberOfUsersInDB = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.count = <span class="keyword">this</span>.count || <span class="number">5</span></span><br><span class="line">  <span class="keyword">this</span>.count = <span class="keyword">this</span>.count * <span class="keyword">this</span>.count</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.count</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Every time <code>numberOfUsersInDB</code> is called, weâll assume that a database connection has been made.</p><p>In the master process mode, we can use the same loop to broadcast the users count value to all workers:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Right After the fork loop within the isMaster=true block</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> updateWorkers = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> usersCount = numberOfUsersInDB()</span><br><span class="line">  <span class="built_in">Object</span>.values(cluster.workers).forEach(<span class="function"><span class="params">worker</span> =&gt;</span> &#123;</span><br><span class="line">    worker.send(&#123;</span><br><span class="line">      usersCount,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">updateWorkers()</span><br><span class="line">setInterval(updateWorkers, <span class="number">10000</span>)</span><br></pre></td></tr></table></figure><p>Here weâre invoking <code>updateWorkers</code> for the first time and then invoking it every 10 seconds using a <code>setInterval</code>. This way, every 10 seconds, all workers will receive the new user count value over the process communication channel and only one database connection will be made.</p><p>In the server code, we can use the <code>userCount</code> value using the same <code>message</code> event handler. We can simply cache that value with a module global variable and use it anywhere we want.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">const</span> pid = process.pid</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> usersCount</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">1e7</span>; i++);</span><br><span class="line">  res.write(<span class="string">`Handled by process: <span class="subst">$&#123;pid&#125;</span>`</span>)</span><br><span class="line">  res.end(<span class="string">`Users: &#123;usersCount&#125;`</span>)</span><br><span class="line">&#125;).listen(<span class="number">8080</span>, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Start process <span class="subst">$&#123;pid&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">process.on(<span class="string">'message'</span>, msg =&gt; &#123;</span><br><span class="line">  usersCount = msg.usersCount</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>The above code makes the worker web server respond with the cached <code>usersCount</code> value. If you test the cluster code now, during the first 10 seconds youâll get â25â as the users count from all workers(and only one DB request would be made). Then after another 10 seconds, all workers would start reporting the new user count: 625(and only one DB request would be made).</p><p>This is all possible thanks to the communication channels between the master process and all workers.</p><h3 id="Increasing-Server-Availability"><a href="#Increasing-Server-Availability" class="headerlink" title="Increasing Server Availability"></a>Increasing Server Availability</h3><p>One of the problems in running a single instance of a Node application is that when that instance crashes, it has to be restarted. This means some downtime between these two actions, even if the process was automated as it should.</p><p>This also applies to the case when the server has to be restarted to deploy new code. With one instance, there will be downtime which affects the availability of the system.</p><p>When we have multiple instances, the availability of the system can be easily increased with just a few extra lines of code.</p><p>To simulate a random crash in the server process, we can simply do a <code>process.exit</code> call inside a timer that fires after a random amount of time:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// In server.js</span></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  process.exit(<span class="number">1</span>) <span class="comment">// death by random timeout</span></span><br><span class="line">&#125;, <span class="built_in">Math</span>.random() * <span class="number">10000</span>)</span><br></pre></td></tr></table></figure><p>When a worker process exits like this, the master process will be notified using the <code>exit</code> event on the <code>cluster</code> model object. We can register a handler for that event and just fork a new worker process when any worker process exits.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Right after the fork loop within the isMaster=true block</span></span><br><span class="line"></span><br><span class="line">cluster.on(<span class="string">'exit'</span>, (worker, code, signal) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (code !== <span class="number">0</span> &amp;&amp; !worker.exitedAfterDisconnect) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`Worker <span class="subst">$&#123;worker.id&#125;</span> crashed. Starting a new worker...`</span>)</span><br><span class="line">    cluster.fork()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Itâs good to add the if condition above to make sure the worker process actually crashed and was not manually disconnected or killed by the master process itself.</p><p>If the main process is going to kill the worker, it can use the <code>disconnect</code> methods on the worker and in that case, the <code>exitedAfterDisconnect</code> flag will be set to true. The if statement above will guard to not fork a new worker for that case.</p><p>If we run the cluster with the handler above(and the random crash in server.js), after a random number of seconds, workers will start to crash and the master process will immediately fork new workers to increase the availability of the system.</p><p>You can actually measure the availability using the same <code>ab</code> command and see how many requests the server will not be able to handle overall.</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*B72o6QhsyiNnEQU5Wx20RQ.png" alt=""></p><h3 id="Zero-downtime-Restarts"><a href="#Zero-downtime-Restarts" class="headerlink" title="Zero-downtime Restarts"></a>Zero-downtime Restarts</h3><p>We have multiple instances running, so instead of restarting them together, we can simply restart them one at a time to allow other workers to continue to serve requests while one worker is being restarted.</p><p>Implementing this with the cluster module is easy. Since we donât want to restart the master process once itâs up, we need a way to send this master process a command to instruct it to start restarting its workers. This is easy on Linux system because we can simply listen to a process signal like <code>SIGUSR2</code>, which we can trigger by using the <code>kill</code> command on the process id and passing that signal:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// In Node</span></span><br><span class="line">process.on(<span class="string">'SIGUSR2'</span>, () =&gt; &#123; ... &#125;)</span><br><span class="line"><span class="comment">// To trigger that</span></span><br><span class="line">$ kill -SIGUSR2 PID</span><br></pre></td></tr></table></figure><p>This way, the master process will not be killed and we have a way to instruct it to start doing something.</p><p><strong><code>SIGUSR2</code> is a proper signal to use here because this will be a user command. If youâre wondering why not <code>SIGUSR1</code>, itâs because Node uses that for its debugger and you want to avoid any conflicts.</strong>.</p><p>When the master process receives the <code>SIGUSR2</code> signal, that means itâs time for it to restart its workers, but we want to do that one worker at a time. This simply means the master process should only restart the next worker when itâs done restarting the current one.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">restartWorker</span> = (<span class="params">workerIndex</span>) =&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> worker = workers[workerIndex]</span><br><span class="line">  <span class="keyword">if</span> (!worker) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">  worker.on(<span class="string">'exit'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (!worker.exitedAfterDisconnect) <span class="keyword">return</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`Exited process <span class="subst">$&#123;worker.process.pid&#125;</span>`</span>)</span><br><span class="line"></span><br><span class="line">    cluster.fork().on(<span class="string">'listening'</span>, () =&gt; &#123;</span><br><span class="line">      restartWorker(workerIndex + <span class="number">1</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  worker.disconnect()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">restartWorker(<span class="number">0</span>)</span><br></pre></td></tr></table></figure><p>Inside the <code>restartWorker</code> function, we got a reference to the worker to be restarted and since we will be calling this function recursively to form a sequence, we need a stop condition. When we no longer have a worker to restart, we can just return.</p><p>We then basically want to disconnect this worker (using <code>worker.disconnect</code>), but before restarting the next worker, we need to fork a new worker to replace this current one that weâre disconnecting.</p><p>We can use the <code>exit</code> event on the worker itself to fork a new worker when the current one exists, but we have to make sure that the exit action was actually triggered after a normal disconnect call. We can use the <code>exitedAfterDisconnect</code> flag. If this flag is not true, the exit was caused by something else other than our disconnect call and in that case, we should just return and do nothing. But if the flag is set to true, we can go ahead and fork a new worker to replace the one that weâre disconnecting.</p><p>When this new forked worker is ready, we can restart the next one.</p><p>However, remember that the fork process is not synchronous, so we canât just restart the next worker after the fork call. Instead, we can monitor the <code>listening</code> event on the newly forked worker, which tells us that this worker is connected and ready. When we get this event, we can safely restart the next worker in sequence.</p><p>Thatâs all we need for a zero-downtime restart.</p><p>Process monitors like PM2, make all the tasks we went through so far extremely easy and give a log more features to monitor the health of a Nodeâs application.</p><h3 id="Shared-State-and-Sticky-Load-Balancing"><a href="#Shared-State-and-Sticky-Load-Balancing" class="headerlink" title="Shared State and Sticky Load Balancing"></a>Shared State and Sticky Load Balancing</h3><p>When we load balance a Node application, we lost some features that are only suitable for a single process. This problem is somehow similar to whatâs known in other languages as thread safety, which is about sharing data between threads. In our case, itâs sharing data between worker processes.</p><p>For example, with a cluster setup, we can no longer cache things in memory because every worker process will have its own memory space, If we cache something in one workerâs memory, other workers will not have access to it.</p><p>If we need to cache things with a cluster setup, we have to use a separate entity and read/write to that entityâs API from all workers. This entity can be a database server or if you want to use in-memory cache you can use a server like Redis or create a dedicated Node process with a read/write API for all other workers to communicate with.</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*dIR_CAkmtPFgtaGTOKBFkA.png" alt=""></p><p>Donât look at this as a disadvantage, because using a separate entity for your application caching is part of <em>decomposing</em> your app for scalability. You should probably be doing that even if youâre running on a single core machine.</p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Mock Data for Node.js</title>
      <link href="/2017/08/22/Mock-Data-for-Node-js/"/>
      <content type="html"><![CDATA[<h3 id="Faker-js"><a href="#Faker-js" class="headerlink" title="Faker.js"></a>Faker.js</h3><p>Itâs a wonderful node module to create fake/mock data.</p><p>Faker.js has its own API, and itâs huge.</p><p>It has a vast API for almost every use case with an excellent <a href="https://github.com/marak/Faker.js/" target="_blank" rel="noopener">documentation</a></p><p>Letâs consider a test case where I want some a <em>user</em> to have following amount of fields:</p><ul><li><p>name</p></li><li><p>email</p></li><li><p>website</p></li><li><p>address</p></li><li><p>bio</p></li><li><p>image/avatar</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> faker = <span class="built_in">require</span>(<span class="string">'faker'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> User = &#123;</span><br><span class="line">  name: faker.name.findName(),</span><br><span class="line">  email: faker.internet.email(),</span><br><span class="line">  website: faker.internet.url(),</span><br><span class="line">  address: faker.address.streetAddress() + faker.address.city() + faker.address.country(),</span><br><span class="line">  bio: faker.lorem.sentences(),</span><br><span class="line">  image: faker.image.avatar(),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Faker-js-Data"><a href="#Faker-js-Data" class="headerlink" title="Faker.js Data"></a>Faker.js Data</h3><p>List of data that can generate faker.js:</p><ul><li><p>address</p></li><li><p>commerce</p></li><li><p>company</p></li><li><p>date</p></li><li><p>finance</p></li><li><p>hacker</p></li><li><p>helpers</p></li><li><p>image</p></li><li><p>internet</p></li><li><p>lorem</p></li><li><p>name</p></li><li><p>phone</p></li><li><p>random</p></li><li><p>system</p></li></ul><h3 id="Use-in-Browser"><a href="#Use-in-Browser" class="headerlink" title="Use in Browser"></a>Use in Browser</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">'faker.js'</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">var</span> randomName = faker.name.findName()</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Analyzing Runtime Performacne With Chrome DevTools</title>
      <link href="/2017/08/20/Analyzing-Runtime-Performacne-with-Chrome-DevTools/"/>
      <content type="html"><![CDATA[<h3 id="Get-Started"><a href="#Get-Started" class="headerlink" title="Get Started"></a>Get Started</h3><ul><li><p>Open Chrome in Incognito Mode. Incognito Mode ensures that Chrome runs in a clean state. For example, if you have a lot of extensions installed, those extensions might create noise in you performance meaturements.</p></li><li><p>Load the following page in your Incognito window. This is the demo that youâre going to profile. The page shows a bunch of little blue squares moving up and down.</p></li></ul><p><code>https://googlechrome.github.io/devtools-samples/jank/</code></p><ul><li>Press <code>Command + Option + I</code> in Mac to open DevTools.</li></ul><h3 id="Simulate-a-Mobile-CPU"><a href="#Simulate-a-Mobile-CPU" class="headerlink" title="Simulate a Mobile CPU"></a>Simulate a Mobile CPU</h3><p>Mobile devices have much less CPU power than desktops and laptops. Whenevery you profile a page, use <strong>CPU Throttling</strong> to simulate how your page performs on mobile devices.</p><ul><li><p>In DevTools, click the <strong>Performacne</strong> tab.</p></li><li><p>Make sure that the <strong>Screenshots</strong> checkbox is enabled.</p></li><li><p>Click <strong>Capture Setting</strong>(the gear icon). DevTools reveals settings related to how it captures performances metrics.</p></li><li><p>For <strong>CPU</strong>, select <strong>2x slowdown</strong>. DevTools throttle your CPU so that itâs 2 times slower than usual.</p></li></ul><p><img src="https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/imgs/throttling.svg" alt=""></p><h3 id="Set-up-the-demo"><a href="#Set-up-the-demo" class="headerlink" title="Set up the demo"></a>Set up the demo</h3><ul><li><p>Keep clicking <strong>Add 10</strong> until the blue squares move noticeably slower than before.</p></li><li><p>Click <strong>Optimize</strong>, the blue squares should move faster and more smoothly.</p></li><li><p>Click <strong>Un-Optimize</strong>. The blue squares move slower and with more jank again.</p></li></ul><h3 id="Record-runtime-performance"><a href="#Record-runtime-performance" class="headerlink" title="Record runtime performance."></a>Record runtime performance.</h3><p>When you ran the optimized version of the page, the blue squares move faster. Why is that? Both version are supposed to move each square the same amount of spaces in the same amount of time. Take a recording in the Performance panel to learn how to detect the performance bottlenect in the un-optimized version.</p><ul><li>In DevTools, click <strong>Record</strong> DevTools captures performance metrics as the page run.</li></ul><p><img src="https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/imgs/profiling.png" alt="Profiling the Page"></p><ul><li><p>Wait a few seconds</p></li><li><p>Click <strong>Stop</strong>, DevTools stops recording, processes the data, then displays the results on the Performance panel.</p></li></ul><p><img src="https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/imgs/results.png" alt=""></p><h3 id="Analyze-the-results"><a href="#Analyze-the-results" class="headerlink" title="Analyze the results"></a>Analyze the results</h3><p>The main metrics for measuring the performance of any animation is frames per second (FPS). Users are happy when animations runs at 60 FPS.</p><ul><li>Look at the <strong>FPS</strong> Chart</li></ul><p><img src="https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/imgs/fps-chart.svg" alt=""></p><p>Whenever you see a red bar above <strong>FPS</strong>, it means that the framerate dropped so low that itâs propably harming the user experience. In general, the highter the green bar, the higher the FPS.</p><ul><li>Below the <strong>FPS</strong> chart you see the CPU chart.</li></ul><p><img src="https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/imgs/cpu-summary.svg" alt=""></p><p>The colors in the CPU chart corresponds to the colors in the Summary tab, at the bottom of the Performance panel. The fact that the CPU chart is full of color means that the CPU was maxed out during the recording.</p><ul><li><p>Hover your mouse over the <strong>FPS</strong>, <strong>CPU</strong>, or <strong>NET</strong> charts. DevTools shows a screenshot of the page at that point in time. Move your mouse left and right to replay the recoding. This is called srubbing, and itâs useful for manually analyzing the progression of animations.</p></li><li><p>In <strong>Frames</strong> section, hover your mouse over one of the green squares, DevTools shows you the FPS for that particular frame.</p></li></ul><p>Of course, with this demo, itâs pretty obvious that the page is not performing well. But in real scenarios, it may not be so clear, so having all of these tools to make measurements comes in handy.</p><h3 id="Find-Bottleneck"><a href="#Find-Bottleneck" class="headerlink" title="Find Bottleneck"></a>Find Bottleneck</h3><ul><li>Note the summary tab. When no events are selected, this tab shows you a breakdown of activity. The page spent most of its time rendering. Since performance is the art of doing less work, your goal is to reduce the amount of time spent doing rendering work.</li></ul><p><img src="https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/imgs/summary.svg" alt=""></p><ul><li>Expand the <strong>Main</strong> section. DevTools shows you a flame chart of activity on the main thread, over time. The x-axis represents the recoding, over time. Each bar represents an event. A wider bar means that event took longer. The y-axis represents the call stack. When you see events stacked on top of each other, it means the upper events caused the lower events.</li></ul><p><img src="https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/imgs/main.svg" alt=""></p><ul><li>Thereâs a lot of data in the recording. Zoom in on a single <strong>Animation Frame Field</strong> event by clicking, holding, and dragging your mouse over the <strong>Overview</strong>, which is the section that includes <strong>CPU</strong>, <strong>FPS</strong>, and <strong>NET</strong> charts. The <strong>Main</strong> section and <strong>Summary</strong> tab only display information for the selected portion of the recording.</li></ul><p><img src="https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/imgs/zoomed.png" alt=""></p><ul><li><p>Note the red triangle in the top-right of the <strong>Animation Frame Fired</strong> event. Whenever you see a red triangle, itâs a warning that there may be an issue related to this event.</p></li><li><p>Click the <strong>Animation Frame Fired</strong> event. The <strong>Summary</strong> tab now shows you information about that event. Note that <strong>reveal</strong> link. Click that causes DevTools to highlight the event that initiate the <strong>Animation Frame Fired</strong> event.</p></li><li><p>Under the <strong>app.update</strong> event, thereâs a bunch of purple events. If they were wider, it looks as though each one might have a red triangle on it. Click one of the purple <strong>Layout</strong> events now. DevTools provides more information about the event in the <strong>Summary</strong> tab.</p></li></ul>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Requiring Modules in Node.js</title>
      <link href="/2017/08/18/Requiring-Modules-in-Node-js/"/>
      <content type="html"><![CDATA[<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">'/path/to/file'</span>)</span><br></pre></td></tr></table></figure><p>The main object exported by the <code>require</code> module is a function. When Node invokes that <code>require()</code> function with a local file path as the functionâs only argument, Node goes through the following sequence of steps:</p><ul><li><p><strong>Resolving</strong>: To find the absolute path of the file.</p></li><li><p><strong>Loading</strong>: To determine the type of the file content.</p></li><li><p><strong>Wrapping</strong>: To give the file its private scope. This is what makes both the <code>require</code> and <code>module</code> objects local to every file we require.</p></li><li><p><strong>Evaluating</strong>: This is what the VM eventually does with the loaded code.</p></li><li><p><strong>Caching</strong>: So that when we require this file again, we donât go over all the steps another time.</p></li></ul><h4 id="Resolving-a-local-path"><a href="#Resolving-a-local-path" class="headerlink" title="Resolving a local path"></a>Resolving a local path</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// in NODE REPL</span></span><br><span class="line">&gt; <span class="built_in">module</span></span><br><span class="line">Module: &#123;</span><br><span class="line">  id: <span class="string">'&lt;repl&gt;'</span>,</span><br><span class="line">  exports: &#123;&#125;,</span><br><span class="line">  parent: <span class="literal">undefined</span>,</span><br><span class="line">  fielname: <span class="literal">null</span>,</span><br><span class="line">  loaded: <span class="literal">false</span>,</span><br><span class="line">  children: [],</span><br><span class="line">  paths: [...]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Every module object gets an <code>id</code> property to identify it. This <code>id</code> is usually the full path to the file, but in a REPL session itâs simply <code>&lt;repl&gt;</code>.</p><p>Node modules have a one-to-one relation with files on the file-system. We require a module by loading the content of a file into memory.</p><p>However, since Node allows many ways to require a file(for example, with a relative path or a pre-configured path), before we can load the content of a file into the memory we need to find the absolute location of that file.</p><p>When we require a <code>find-me</code> module, without specifying a path:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">'find-me'</span>)</span><br></pre></td></tr></table></figure><p>Node will look for <code>find-me.js</code> in all the paths specified by <code>module.paths</code> in order.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// in NODE REPL</span></span><br><span class="line">&gt; <span class="built_in">module</span>.paths</span><br><span class="line">[ <span class="string">'/Users/samer/learn-node/repl/node_modules'</span>,</span><br><span class="line">  <span class="string">'/Users/samer/learn-node/node_modules'</span>,</span><br><span class="line">  <span class="string">'/Users/samer/node_modules'</span>,</span><br><span class="line">  <span class="string">'/Users/node_modules'</span>,</span><br><span class="line">  <span class="string">'/node_modules'</span>,</span><br><span class="line">  <span class="string">'/Users/samer/.node_modules'</span>,</span><br><span class="line">  <span class="string">'/Users/samer/.node_libraries'</span>,</span><br><span class="line">  <span class="string">'/usr/local/Cellar/node/7.7.1/lib/node'</span> ]</span><br></pre></td></tr></table></figure><p>The paths list is basically a list of node_modules directories under every directory from the current directory to the root directory. It also includes a few legacy directories whose use is not recommended.</p><p>If Node canât find <code>find-me.js</code> in any of these paths, it will throw a âcannot find module errorâ.</p><h4 id="Requiring-a-folder"><a href="#Requiring-a-folder" class="headerlink" title="Requiring a folder"></a>Requiring a folder</h4><p>Modules donât have to be files. We can also create a <code>find-me</code> folder under <code>node_modules</code> and place an <code>index.js</code> file in there. The same <code>require(&#39;fine-me&#39;)</code> line will use that folderâs <code>index.js</code> file.</p><p>An <code>index.js</code> file will be used by default when we require a folder, but we can control what file name to start under the folder using the <code>main</code> property in <code>package.json</code>.</p><h4 id="require-resolve"><a href="#require-resolve" class="headerlink" title="require.resolve"></a>require.resolve</h4><p>If you want to only resolve the module and not execute it, you can use the <code>require.resolve</code> function. This behaves exactly the same as the main <code>require</code> function, but does not execute the file.</p><p><strong>This can be used, for example, to check whether an optional package is installed or not and only use it when itâs available</strong>.</p><h4 id="exports-module-exports-and-asynchronous-loading-of-modules"><a href="#exports-module-exports-and-asynchronous-loading-of-modules" class="headerlink" title="exports, module.exports, and asynchronous loading of modules"></a>exports, module.exports, and asynchronous loading of modules</h4><p>In any module, exports is a special object.</p><p><code>exports</code> variable inside each module is just a reference to <code>module.exports</code> which manages the exported properties.</p><p>When we reassign the <code>exports</code> variable, that reference is lost and we would be introducing a new variable instead of changing the <code>module.exports</code> object.</p><p>The <code>module.exports</code> object in every module is what the <code>require</code> function returns when we require that module.</p><p>Letâs talk about the <code>loaded</code> attribute on every module. The <code>module</code> module use the <code>loaded</code> attribute to track which modules have been loaded(true value) and which modules are still being loaded(false value).</p><p>The <code>exports</code> object becomes complete when Node finishes loading the module(and label it so). The whole process of requiring/loading a module is <em>synchronous</em>. Thatâs why we were able to see the modules fully loaded after one cycle of the event loop.</p><p>This also means that we cannot change the <code>exports</code> object asynchronously.</p><h4 id="JSON-and-C-C-addons"><a href="#JSON-and-C-C-addons" class="headerlink" title="JSON and C/C++ addons"></a>JSON and C/C++ addons</h4><p>We can natively require JSON files and C++ addon files with the require function. You donât need to specify the extensions.</p><p>If a file extension was not specified, the first thing Node will try to resolve is a <code>.js</code>, then <code>.json</code>, and it will parse the <code>.json</code> file if found as a JSON text file. After that Node will try to find a binary <code>.node</code> file.</p><p>Requiring JSON file is useful, for example, everything you need to manage in that file is some static configuration values, or some values that you periodically read from an external source. For example, if we had the following <code>config.json</code> file:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"host"</span>: <span class="string">"localhost"</span>,</span><br><span class="line">  <span class="attr">"port"</span>: <span class="number">8080</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>We can require it directly like this:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; host, port &#125; = <span class="built_in">require</span>(<span class="string">'./config'</span>)</span><br></pre></td></tr></table></figure><h3 id="All-code-you-write-in-Node-will-be-wrapped-in-functions"><a href="#All-code-you-write-in-Node-will-be-wrapped-in-functions" class="headerlink" title="All code you write in Node will be wrapped in functions"></a>All code you write in Node will be wrapped in functions</h3><p>Nodeâs wrapping of modules is often misunderstood. To understand it, let me remind you about the <code>exports/module.exports</code> relation.</p><p>We can use the <code>exports</code> object to export properties, but we cannot replace the <code>exports</code> object directly because itâs just a reference to <code>module.exports</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">exports.id = <span class="number">52</span>; <span class="comment">// This is ok</span></span><br><span class="line">exports = &#123; <span class="attr">id</span>: <span class="number">52</span> &#125;; <span class="comment">// This will not work</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">id</span>: <span class="number">52</span> &#125;; <span class="comment">// This is ok</span></span><br></pre></td></tr></table></figure><p>How exactly does this <code>exports</code> object, which appears to be global for every module, get defined as a reference on the <code>module</code> object?</p><p>In a browser, when we declare a variable in a script like this:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> answer = <span class="number">12</span>;</span><br></pre></td></tr></table></figure><p>That <code>answer</code> variable will be globally available in all scripts after the script that define it.</p><p>This is not the case in Node. When we define a variable in one module, the other module modules in the program will not have access to that variable. So how come variables in Node are magically scoped?</p><p>The answer is simple. Before compiling a module, Node wraps the module code in a function, which we can inspect using the <code>wrapper</code> property of the <code>module</code> module.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~ $ node</span><br><span class="line">&gt; <span class="built_in">require</span>(<span class="string">'module'</span>).wrapper</span><br><span class="line">[ <span class="string">'(function (exports, require, module, __filename, __dirname) &#123; '</span>,</span><br><span class="line">  <span class="string">'\n&#125;);'</span> ]</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure><p>Node does not execute any code you write in a file directly. It executes this wrapper function which will have your code in its body.</p><p>This is what keeps the top-level variables that are defined in any module scoped to that module.</p><p>This wrapper function has 5 arguments: <code>exports</code>, <code>require</code>, <code>module</code>, <code>__filename</code>, <code>__dirname</code>. This is what makes them appear to look global when in fact they are specific to each module.</p><p>All of these arguments get their value when Node execute the wrapper function. <code>exports</code> is defined as a reference to <code>module.exports</code> prior to that. <code>require</code> and <code>module</code> are both specific to the function to be executed, and <code>__dirname</code>/<code>__filename</code> variables will contain the wrapped moduleâs directory path and absolute filename.</p><p>Since every module gets wrapped in a function, we can actually access that functionâs arguments with the <code>arguments</code> keyword:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">~<span class="regexp">/learn-node $ echo "console.log(arguments)" &gt; index.js</span></span><br><span class="line"><span class="regexp">~/</span>learn-node $ node index.js</span><br><span class="line">&#123; <span class="string">'0'</span>: &#123;&#125;,</span><br><span class="line">  <span class="string">'1'</span>:</span><br><span class="line">   &#123; [<span class="built_in">Function</span>: <span class="built_in">require</span>]</span><br><span class="line">     resolve: [<span class="built_in">Function</span>: resolve],</span><br><span class="line">     main:</span><br><span class="line">      Module &#123;</span><br><span class="line">        id: <span class="string">'.'</span>,</span><br><span class="line">        exports: &#123;&#125;,</span><br><span class="line">        parent: <span class="literal">null</span>,</span><br><span class="line">        filename: <span class="string">'/Users/samer/index.js'</span>,</span><br><span class="line">        loaded: <span class="literal">false</span>,</span><br><span class="line">        children: [],</span><br><span class="line">        paths: [<span class="built_in">Object</span>] &#125;,</span><br><span class="line">     extensions: &#123; ... &#125;,</span><br><span class="line">     cache: &#123; <span class="string">'/Users/samer/index.js'</span>: [<span class="built_in">Object</span>] &#125; &#125;,</span><br><span class="line">  <span class="string">'2'</span>:</span><br><span class="line">   Module &#123;</span><br><span class="line">     id: <span class="string">'.'</span>,</span><br><span class="line">     exports: &#123;&#125;,</span><br><span class="line">     parent: <span class="literal">null</span>,</span><br><span class="line">     filename: <span class="string">'/Users/samer/index.js'</span>,</span><br><span class="line">     loaded: <span class="literal">false</span>,</span><br><span class="line">     children: [],</span><br><span class="line">     paths: [ ... ] &#125;,</span><br><span class="line">  <span class="string">'3'</span>: <span class="string">'/Users/samer/index.js'</span>,</span><br><span class="line">  <span class="string">'4'</span>: <span class="string">'/Users/samer'</span> &#125;</span><br></pre></td></tr></table></figure><p>What happens is roughly equivalent to:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> (<span class="params">require, module, __filename, __dirname</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> exports = <span class="built_in">module</span>.exports;</span><br><span class="line">  <span class="comment">// Your Code...</span></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">module</span>.exports;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>If we change the whole <code>exports</code> object, it would no longer be a reference to <code>module.exports</code>.</p><h4 id="The-require-object"><a href="#The-require-object" class="headerlink" title="The require object"></a>The require object</h4><p>There is nothing special about <code>require</code>. Itâs an object that acts mainly as a function that takes a module name or path and return the <code>module.exports</code> object. We can simply override the <code>require</code> object with our own logic if we want to.</p><p>For exmaple, maybe for testing purposes, we want every <code>require</code> call to be mocked by default and just return a fake object instead of the required module exports object.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span> = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">mocked</span>: <span class="literal">true</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>After doing the above reassignment of <code>require</code>, every <code>require(&#39;something&#39;)</code> call in the script will just return the mocked object.</p><p>The require object also has properties of its own. Weâve seen the <code>resolve</code> property, which is a function that performs only the resolving step of the require process. Weâve also seen <code>require.extensions</code> above.</p><p>There is also <code>require.main</code> which can be helpful to determine if the script is being required or run directly.</p><p>Say, for example, that we have this simple <code>printFrame</code> function in <code>print-in-frame.js</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// In print-in-frame.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> printFrame = <span class="function">(<span class="params">size, header</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'*'</span>.repeat(size))</span><br><span class="line">  <span class="built_in">console</span>.log(header)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'*'</span>.repeat(size))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>We want to use this file in two ways:</p><ul><li>From the command line directly like this:</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node <span class="built_in">print</span>-in-frame 8 hello</span><br></pre></td></tr></table></figure><ul><li>With <code>require</code></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> print = <span class="built_in">require</span>(<span class="string">'./print-in-frame.js'</span>)</span><br><span class="line">print(<span class="number">5</span>, <span class="string">'hello'</span>)</span><br></pre></td></tr></table></figure><p>Those are two different usages. We need a way to determine if the file is being run as a stand-alone script or if it is being required by other scripts.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> printFrame = <span class="function">(<span class="params">size, header</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'*'</span>.repeat(size))</span><br><span class="line">  <span class="built_in">console</span>.log(header)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'*'</span>.repeat(size))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">require</span>.main === <span class="built_in">module</span>) &#123;</span><br><span class="line">  <span class="comment">// the file is being executed directly</span></span><br><span class="line">  printFrame(process.argv[<span class="number">2</span>], process.argv[<span class="number">3</span>])</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="built_in">module</span>.exports = printFrame</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="All-module-can-be-cached"><a href="#All-module-can-be-cached" class="headerlink" title="All module can be cached"></a>All module can be cached</h3><p>Caching is important to understand.</p><p>Say that we have the following <code>ascii-art.js</code> file that prints a cool looking header:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#####</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#####</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure><p>We want to display this header every time we <code>require</code> the file, so when we require the file twice, we want the header to show twice:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">'./ascii-arg'</span>); <span class="comment">// it will show the header</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">'./ascii-arg'</span>); <span class="comment">// it won't show the header</span></span><br></pre></td></tr></table></figure><p>The second require will not show the header because of modulesâ caching. Node caches the first call and does not load the file on the second call.</p><p>We can see this cache by printing <code>require.cache</code> after the first require. The cache registry is simply an object that has a property for every required module. Those properties values are the <code>module</code> objects used for each module. We can simply delete a property from that <code>require.cache</code> object to invalidate that cache. If we do that, Node will reload the module to recache it.</p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Concurrency and Parallelism: Understanding I/O</title>
      <link href="/2017/08/18/Concurrency-and-Parallelism-Understanding-I-O/"/>
      <content type="html"><![CDATA[<p><a href="https://blog.risingstack.com/concurrency-and-parallelism-understanding-i-o/" target="_blank" rel="noopener">Original Post</a></p><p>Concurrency is much border, genral problem than parallelism. If you have tasks having inputs and outputs, and you want to schedule them so that they produce correct results, you are solving a concurrency problem.</p><p>Take a look at this diagram:</p><p><img src="https://blog-assets.risingstack.com/2017/02/cuncurrency-paralellism-diagram-of-tasks-with-dependencies.png" alt=""></p><p>It shows a data flow with input and output dependencies. Here tasks 2, 3, 4 can run concurrently after 1. There is no specific order between them, so we have multiple alternatives for running it sequetially. Showing only two of them:</p><p><img src="https://blog-assets.risingstack.com/2017/02/concurrent-data-flow-path-13245.png" alt=""></p><p>Alternatively, these tasks can run in parallel, e.g. on another processor core, another processor, or an entirely seperate computer.</p><p>On these diagrams, thread means a computation carried out on dedicated processor core, not an OS thread, as they are not necessarily parallel.</p><p><img src="https://blog-assets.risingstack.com/2017/02/paralellized-tasks-diagram.png" alt=""></p><p>If we only have one processor, why do we even bother with writing concurrent application? The processing time will not get shorter, and we add the overhead of scheduling. As a matter of fact, any modern operating system will also slice up the concurrent tasks and interleave them, so each of the slices will run for a short time.</p><h5 id="There-are-various-reasons-for-this"><a href="#There-are-various-reasons-for-this" class="headerlink" title="There are various reasons for this:"></a>There are various reasons for this:</h5><ul><li><p>We human like to interact with the computer in real time, e.g. as I type this text, I want to see it appearing on the screen immediately, at the same time listening to my favorite tracklist, and getting notifications about my incoming emails. Just imagine that you cannot drag a window while the movie keeps on playing it.</p></li><li><p>Not all operations are carried out on the computerâs CPU. If you want to write to an HDD for example, a lot of time is spent seeking to the position, writing the sectors, etc, and the intermittent time can be spent to do something else.</p></li></ul><p>These require the operating system kernel to run tasks in an interleaved manner, referred to as <code>time-sharing</code>. This is a very important property of modern operating systems.</p><h3 id="Processes-and-Threads"><a href="#Processes-and-Threads" class="headerlink" title="Processes and Threads"></a>Processes and Threads</h3><blockquote><p>A process is a running instance of a computer program. It is what you see in the task manager of your operating system or <code>top</code>.</p></blockquote><p>A process consists of allocated memory which holds the program code, its data, a heap for dynamic memory allocation, and a lot more. However, it is not the unit for multi-tasking in desktop operating systems.</p><blockquote><p>Thread is the default unit - the task - of CPU usage. COde executed in a single thread is what we usually refer to as sequential or synchronous execution.</p></blockquote><p>Threads are supported by nearly all operating systems and can be created with system calls. They have theri own <code>call stack</code>, <code>virual CPU</code> and <code>local storage</code> but share the applicationâs <code>heap</code>, data, codebase and resources.</p><p>They also serve as the unit of scheduling in the kernel. For this reason, we call them <code>kernel threads</code>, clarifying that they are native to the operating system and scheduled by the kernel, which distinguishes them from use-space threads, also called <code>green threads</code> which are scheduled by some user space schedular such as a library or VM.</p><p><img src="https://blog-assets.risingstack.com/2017/02/kernel-processes-and-threads-1.png" alt=""></p><p>Most desktop and sever operating system kernels use preemptive schedulers, as does the Linux, macOS and Windows kernel. We can assume that threads are preemptive scheduled, distinguishing them from their non-preemptive(cooperative) counterparts, called <code>fiber</code>. This preemptive scheduling is the reason that a hanging process doesnât stall the whole computer.</p><p>The hanging time slices are interleaved with other processesâ and the OSâ code, so the system as a whole remains responsive.</p><p>Context switching(switching between threads) is done at frequent intervals by the kernel, creating the illusion that our programs are running in parallel, whereas in reality, they are running concurrently but sequentially in short slices.</p><h3 id="CPU-vs-I-O"><a href="#CPU-vs-I-O" class="headerlink" title="CPU vs. I/O"></a>CPU vs. I/O</h3><p>Programs usually donât only consist of numeric, arithmetic and logic computations, in fact, a lot of times they merely write something to the file system, do network requests or access peripheries such as the console or an external device.</p><p>While the first kind of workload is CPU intensive, the latter requries performing I/O in the majority of the time.</p><p>Doing I/O is a kernel space operation, initiated with a system call, so it results in a privilege context switch.</p><p>When an I/O operation is requested with a blocking  system call, we are talking about <em>blocking I/O</em>.</p><p>This can deteriorate concurrency under implementation, concretely those that use <em>many-to-one mapping</em>. This means that all threads in a process share a common kernel thread, which implies that every thread is blocked when one does blocking I/O.</p><p>No wonder that modern OSes donât do this. Instead, they use <code>one-to-one</code> mapping, i.e. map a kernel thread to each user-space thread, allowing another thread to run when one makes a blocking system call, which means that they are unaffected by the above adverse effect.</p><h3 id="I-O-favors-Blocking-vs-Non-Blocking-Sycn-vs-Async"><a href="#I-O-favors-Blocking-vs-Non-Blocking-Sycn-vs-Async" class="headerlink" title="I/O favors: Blocking vs. Non-Blocking, Sycn vs. Async"></a>I/O favors: Blocking vs. Non-Blocking, Sycn vs. Async</h3><p>Doing I/O usually consiss of two distinct steps:</p><ul><li><p>checking the device</p><ul><li><p>blocking: waiting for the device to be ready</p></li><li><p>non-blocking: e.g. polling periodically until ready</p></li></ul></li><li><p>transmitting:</p><ul><li><p>synchronous: executing the operation (e.g. read or write) initiated by the program.</p></li><li><p>asynchronous: executing the operation as response to an event from the kernel(asynchronous/event drive)</p></li></ul></li></ul><p>You can mix the two steps in every fashion</p><h3 id="Busy-Waiting-Polling-and-the-Event-Loop"><a href="#Busy-Waiting-Polling-and-the-Event-Loop" class="headerlink" title="Busy-Waiting, Polling, and the Event Loop"></a>Busy-Waiting, Polling, and the Event Loop</h3><p>Busy-waiting is the act of repeatedly checking a resource, such as I/O for availability in a <em>tight loop</em>. The absence of the tight loop is what distinguishes <code>polling</code> for busy-waiting.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// tight-loop example</span></span><br><span class="line"><span class="keyword">while</span> (pthread_mutex_trylock(&amp;my_mutex) == EBUSY) &#123; &#125;</span><br><span class="line"><span class="comment">// mutex is unlocked</span></span><br><span class="line">do_stuff()</span><br><span class="line"></span><br><span class="line"><span class="comment">// polling example</span></span><br><span class="line"><span class="keyword">while</span> (pthread_mutex_trylock(&amp;my_mutex) == EBUSY) &#123;</span><br><span class="line">  sleep(POLL_INTERVAL)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// mutex is unlocked</span></span><br><span class="line">do_stuff()</span><br></pre></td></tr></table></figure><p>The difference between the two code is apparent. The <code>sleep</code> function puts the current thread of execution to sleep, yield control to the kernel to schedule something else to run.</p><p>It is also obvious that both of them offer a technique of turning non-blocking code into blocking code, because control wonât pass the loop until the mutex becomes free. This means that <code>do_stuff</code> is blocked.</p><p>Letâs say we have more of thse mutexes or any arbitrary I/O device that can be polled. We can invert control-flow by assigning handlers to be called when the resource is ready. If we periodically check the resources in the llop and execute the associated handlers on completion, we created what is called an <code>event loop</code>.</p><h3 id="TCP-server-example"><a href="#TCP-server-example" class="headerlink" title="TCP server example"></a>TCP server example</h3><p>The following exmaple will illustrate the differences between working with <em>synchronous, blocking</em> and <em>non-blocking</em> network I/O. It is a dead-simple TCP echo server. After the client connects, every line is echoed back to the socket until the client write âbyeâ.</p><h4 id="Single-threaded"><a href="#Single-threaded" class="headerlink" title="Single threaded"></a>Single threaded</h4><p>The first version uses the standard POSIX procedure of <code>sys/socket.h</code>.</p><p>The server is single-threaded, it waits until a client connects.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// wait for a connection, then accept() it</span></span><br><span class="line"><span class="keyword">if</span> ((conn_s) = accept(list_s, NULL, NULL) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">  <span class="comment">// exit w err</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Then it reads from the socket each line and echoes it back until the client closes connection or prints the word âbyeâ on a line.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">bye = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span>(!bye) &#123;</span><br><span class="line">  read_line_from_socket(conn_s, buffer, MAX_LINE - <span class="number">1</span>)</span><br><span class="line">  <span class="keyword">if</span> (!strncmp(buffer, <span class="string">'bye\n'</span>, MAX_LINE - <span class="number">1</span>)) bye = <span class="number">1</span></span><br><span class="line">  write_line_to_socket(conn_s, buffer, strlen(buffer))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (close(conn_s) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">  <span class="comment">// exit w err</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Advanced Topics of TS</title>
      <link href="/2017/08/17/Advanced-Topics-of-TS/"/>
      <content type="html"><![CDATA[<h3 id="Iterators-and-Generators"><a href="#Iterators-and-Generators" class="headerlink" title="Iterators and Generators"></a>Iterators and Generators</h3><p>Iterators are basically objects that can be hold more than one item. Iterators are collections of objects or variables or items that can be iterated on to do some sort of processing on each item in the collection. Arrays are an exmaple of iterators.</p><p>In TypeScript, an object is demmed iterable if it has an implementation for <code>Symbol.iterator</code> property. Some built-in types like <strong>Array, Map, Set, String, Int32Array</strong>, etc. have their <code>Symbol.iterator</code> property already implemented.</p><p><code>Symbol.iterator</code> function on an object is responsible for returning the list of values to iterate on.</p><p><code>for...of...</code> statements</p><p><code>for...of...</code> loops over an iterable object will invoke the <code>Symbol.iterable</code> property on the object.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> someArray = [<span class="number">1</span>, <span class="string">'string'</span>, <span class="literal">false</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> entry <span class="keyword">of</span> someArray) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(entry) <span class="comment">// 1, 'string', false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Intersection-Types"><a href="#Intersection-Types" class="headerlink" title="Intersection Types"></a>Intersection Types</h3><p>An intersection type combines multiple types into one. This is allows you to add together existing types to get a single type that has all the features you need.</p><h4 id="Union-Types"><a href="#Union-Types" class="headerlink" title="Union Types"></a>Union Types</h4><p>Union Types are closely related to intersection types, but they are used very differently. Occasionally, youâll run into a library that expects a parameter to be either a <code>number</code> or a <code>string</code>.</p><h3 id="Type-Guards"><a href="#Type-Guards" class="headerlink" title="Type Guards"></a>Type Guards</h3><p>Union Types are useful for modeling situations when values can overlap in the types they can take on.</p><p>TypeScript has what is called a <code>type guard</code>.</p><p>A type guard is some expression that performs a runtime check that guarantees the type in some scope. To define a type guard, we simply need to define a function whose return type is a <code>type predicate</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isFish</span>(<span class="params">pet: Fish | Bird</span>): <span class="title">pet</span> <span class="title">is</span> <span class="title">Fish</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (&lt;Fish&gt;pet).swim !== undefined</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>pet is Fish</code> is our type predicate in this example. A predicate takes the form <code>parameterName is Type</code>, where <code>parameterName</code> must be the name of a parameter from the current function signature.</p><p>Any time <code>isFish</code> is called with some variable, TypeScript will <code>narrow</code> that variable to that specific type if the original type is compatible.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (isFish(pet)) &#123;</span><br><span class="line">  pet.swim()</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  pet.fly()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Notice that TypeScript not only knows that <code>pet is Fish</code> in the if branch, it also knows that in the else branch you <strong>donât</strong> have a fish, so you must have a <code>Bird</code>.</p><h4 id="typeof-type-guards"><a href="#typeof-type-guards" class="headerlink" title="typeof type guards"></a><code>typeof</code> type guards</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isNumber</span>(<span class="params">x: any</span>): <span class="title">x</span> <span class="title">is</span> <span class="title">number</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> x === <span class="string">'number'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isString</span>(<span class="params">x: any</span>): <span class="title">x</span> <span class="title">is</span> <span class="title">string</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> x === <span class="string">'string'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">padLeft</span>(<span class="params">value: string, padding: string | number</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (isNumber(padding)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Array</span>(padding + <span class="number">1</span>).join(<span class="string">' '</span>) + value</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (isString(padding)) &#123;</span><br><span class="line">    <span class="keyword">return</span> padding + value</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`Expected string or number, got <span class="subst">$&#123;padding&#125;</span>`</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>However, having to define a functino to figure out if a typeis a primitive is kind of a pain.</p><p>TypeScript will recognize <code>typeof x === &#39;number&#39;</code> as a type guard on its own. This means we could just write checks inline.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">padLeft</span> (<span class="params">value: string, padding: number | string </span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> padding === <span class="string">'number'</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> padding === <span class="string">'string'</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`Expected string or number, got <span class="subst">$&#123;padding&#125;</span>`</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>These <code>typeof</code> <em>type guards</em> are recognized in two different forms: <code>typeof v === &#39;typename&#39;</code> and <code>typeof v !== &#39;typename&#39;</code>.</p><h4 id="instanceof-type-guards"><a href="#instanceof-type-guards" class="headerlink" title="instanceof type guards"></a><code>instanceof</code> type guards</h4><p><code>instanceof</code> <em>type guards</em> are a way of narrowing types using their constructor function.</p><p>The right side of the <code>instanceof</code> needs to be a constructor function, and TypeScript narrow down to:</p><ul><li><p>the type of the functionâs <code>prototype</code> property if its type is not any.</p></li><li><p>the union of types returned by that typeâs construct signatures.</p></li></ul><p>in that order.</p><h3 id="Generics"><a href="#Generics" class="headerlink" title="Generics"></a>Generics</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">identity</span>&lt;<span class="title">T</span>&gt;(<span class="params">arg: T</span>): <span class="title">T</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> arg</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>We add a type variable <code>T</code> to the identity function. This T allows us to capture the type the user of the code provides, so that we can use that information later.</p><p>We say that this version of the <code>identity</code> function is generic, as it works over a range of types.</p><p>Once weâve written the generic identity function, we can call it in one of two ways.</p><p>The first way is to pass all of the arguments, including the type argument, to the function.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> output = identity&lt;string&gt;(<span class="string">'myString'</span>); <span class="comment">// type of output will be string</span></span><br></pre></td></tr></table></figure><p>Here we explicitly set T to be <code>string</code> as one of the arguments to the function call, denoted using <code>&lt;&gt;</code> around the arguments rather than ().</p><p>The second way is also perphaps the most common. Here we use <em>type argument inference</em> â that is, we want the compiler to set the value of T for us automatically based on the type of the argument we pass in.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> output = identity(<span class="string">'myString'</span>); <span class="comment">// type of output will be 'string'</span></span><br></pre></td></tr></table></figure><h4 id="Working-with-Generic-Type-Variables"><a href="#Working-with-Generic-Type-Variables" class="headerlink" title="Working with Generic Type Variables"></a>Working with Generic Type Variables</h4><p>When you begin to use generics, youâll notice that when you create generic functinos like <code>identity</code>, the compiler will enfore that you use any generically typed parameters in the body of the function correctly.</p><h4 id="Generic-Types"><a href="#Generic-Types" class="headerlink" title="Generic Types"></a>Generic Types</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">identity</span>&lt;<span class="title">T</span>&gt;(<span class="params">arg: T</span>): <span class="title">T</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> arg;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> myIdentity: &lt;T&gt;(arg: T) =&gt; T = identity</span><br><span class="line"></span><br><span class="line">// we can also write the generic type as a call signature of an object literal type:</span><br><span class="line"></span><br><span class="line">let myIdentity: &#123;&lt;T&gt;(arg: T) : T&#125; = identity</span><br><span class="line"></span><br><span class="line">interface GenericIdentityFn &#123;</span><br><span class="line">  &lt;T&gt;(arg: T): T</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// or</span><br><span class="line"></span><br><span class="line">interface GenericIdentityFn&lt;T&gt; &#123;</span><br><span class="line">  (arg: T): T</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let myIdentity: GenericIdentityFn&lt;number&gt; = identity</span><br></pre></td></tr></table></figure><h4 id="Generic-Classes"><a href="#Generic-Classes" class="headerlink" title="Generic Classes"></a>Generic Classes</h4><p>A generic class has a similar shape to a generic interface.</p><p>Generic classes have a generic type parameter list in angle brackets(&lt;&gt;) following the name of the class.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GenericNumber</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  zeroValue: T;</span><br><span class="line">  add: <span class="function">(<span class="params">x: T, y: T</span>) =&gt;</span> T;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> myGenericNumber = <span class="keyword">new</span> GenericNumber&lt;number&gt;()</span><br></pre></td></tr></table></figure><p>Generic classes are only generic over their instance side rather than their static side.</p><h3 id="Decorator"><a href="#Decorator" class="headerlink" title="Decorator"></a>Decorator</h3><p>A <em>Decorator</em> is a special kind of declaration that can be attached to a class declaration, method, accessor, property, or parameter.</p><p>Sometimes it is required to have additional features to support annotating or modifying classes and class members. Decorators provide a way to add both annotation and a meta-programming syntax for class declarations and members.</p><p>Decoration use the form <code>@expression</code>, where <code>expression</code> must evaluate to a function that will be called at runtime with information about the decorated declaration.</p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Note(2) on TS2 of edX</title>
      <link href="/2017/08/15/Note-2-on-TS2-of-edX/"/>
      <content type="html"><![CDATA[<h3 id="Modules"><a href="#Modules" class="headerlink" title="Modules"></a>Modules</h3><p>Modules are used for code organization as well as code sharing.</p><p>Modules are executed within their own scope, not in the global scope. This means that variables, functions, classes, etc. declared in a module are not visible outside the module unless they are explicitly exported using <code>export</code>. Conversely, to consume a variable, function, class, interface, etc. exported from a different module, it has to be imported using <code>import</code>.</p><p>Modules are declarative.</p><p>In TypeScript any file containing a top-level <code>import</code> or <code>export</code> is considered a module.</p><h4 id="Export"><a href="#Export" class="headerlink" title="Export"></a>Export</h4><p>Exporting a declaration.</p><p>Any declaration(such as variable, function, class, type alias, or interface) can be exported by adding the <code>export</code> keyword.</p><p>A module can wrap one or more modules and combine all their exports using <code>export * from</code> syntax.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// allValidator.ts</span></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">'./StringValidator'</span></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">'./LetterOnlyValidator'</span></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">'./ZipCodeValidator'</span></span><br></pre></td></tr></table></figure><p>Import can be renamed.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ZipCodeValidator <span class="keyword">as</span> ZCV &#125; <span class="keyword">from</span> <span class="string">'./ZipCodeValidator'</span></span><br></pre></td></tr></table></figure><h4 id="Default-exports"><a href="#Default-exports" class="headerlink" title="Default exports"></a>Default exports</h4><p>Each module can optionally export a <code>default</code> export. Default exports are marked with the keyword <code>default</code>, and there can only be one <code>default</code> export per module.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// jQuery.ts</span></span><br><span class="line">declare <span class="keyword">let</span> $: Jquery;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> $;</span><br><span class="line"></span><br><span class="line"><span class="comment">// App.ts</span></span><br><span class="line"><span class="keyword">import</span> $ <span class="keyword">from</span> <span class="string">'jQuery'</span></span><br></pre></td></tr></table></figure><h3 id="Declaration-Files"><a href="#Declaration-Files" class="headerlink" title="Declaration Files"></a>Declaration Files</h3><p>Declarations are used to describe code that exists elsewhere using the <code>declare</code> keyword. The goad of this is to be able to use this code in TypeScript applications without having to rewrite the code in TypeScript.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">declare <span class="keyword">var</span> mynumber: any;</span><br><span class="line">mynumber = <span class="number">300</span>; <span class="comment">// ok</span></span><br></pre></td></tr></table></figure><p>You can save these declaration in a <code>.ts</code> file or in a <code>.d.ts</code> file, we call these file with <code>.d.ts</code> extension <strong>declaration files</strong>.</p><p>Itâs good practice to keep your declarations in separate <code>.d.ts</code> file.</p><p>If a file has the extension <code>.d.ts</code> then each root level definition must have the <code>declare</code> keyword prefixed to it. This tells the developer that there will be no code emitted by TypeScript. The developer needs to ensure that the declared item will exist at runtime.</p><p>For example, lets assume we have the following JavaScript code(message.js)</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showMessage</span> (<span class="params">message</span>) </span>&#123;</span><br><span class="line">  alert(message)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>If you want to call the <code>showMessage</code> function in your TypeScript code, TypeScript will not recognize that this function exists. It does not know its name or its parameter. This can be fixed by describing the <code>showMessage</code> function in a definition file as (message.d.ts):</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">declare</span> <span class="keyword">function</span> showMessage(message: string)</span><br></pre></td></tr></table></figure><p>Now you can use the function <code>showMessage</code> in TypeScript without compile errors.</p><h4 id="d-ts-files-and-ts-files"><a href="#d-ts-files-and-ts-files" class="headerlink" title=".d.ts files and .ts files"></a>.d.ts files and .ts files</h4><p>Anything allowed in a <code>.d.ts</code> file mayu also appear in a <code>.ts</code> file, but not the reverse. Therefore, <code>.d.ts</code> allows a subset of TypeScript features. A <code>.d.ts</code> file is only allowed to contain TypeScript code that doesnât generate any JavaSAcript code in the output. If you attempt to use any feature of TypeScript that would generate JavaScript, youâll get an error.</p><p>Interfaces are allowed, because they disappear completely after compilation.</p><p>Const enums are also allowed, unlike ordinary enums which generate an object in the output JavaScript.</p><p>Top level classes, variables, modules, and functions must be prefixed with <code>declare</code>.</p><p>It is a common practice to see a top-lvel <code>declare module</code> and then all definition inside it are therefore also declaraion.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">declare <span class="built_in">module</span> Something &#123;</span><br><span class="line">  <span class="keyword">var</span> x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Working-with-other-JavaScript-Libraries"><a href="#Working-with-other-JavaScript-Libraries" class="headerlink" title="Working with other JavaScript Libraries."></a>Working with other JavaScript Libraries.</h3><p>To describe the shape of libraries not written in TypeScript, we need to declare the API that the library exposes.</p><p>We call declarations that donât define an implementation âambientâ. Typically these are defined in <code>.d.ts</code> files.</p><h4 id="Ambient-Modules"><a href="#Ambient-Modules" class="headerlink" title="Ambient Modules"></a>Ambient Modules</h4><p>We can define each module in its own <code>.d.ts</code> file with top-level export declarations, but itâs more convenient to write them as one large <code>.d.ts</code> file. To do so, we use a construct similar to ambient namespaces, but we use the <code>module</code> keyword and the quoted name of the module which will be available to a later import.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// node.d.ts</span><br><span class="line">declare module &apos;url&apos; &#123;</span><br><span class="line">  export interface Url &#123;</span><br><span class="line">    protocol?: string;</span><br><span class="line">    hostname?: string;</span><br><span class="line">    pathname?: string;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  export function parse (urlStr: string, parseQueryString?, slashesDenotateHost?): Url</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">declare module &apos;path&apos; &#123;</span><br><span class="line">  export function normalize(p: string): string;</span><br><span class="line">  export function join(...paths: any[]): string;</span><br><span class="line">  export var sep: string;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Now we can use <code>/// &lt;reference&gt;node.d.ts</code> and then load the modules using <code>import url = require(&#39;url&#39;)</code> or <code>import * as URL from &#39;url&#39;</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;reference path='node.d.ts' /&gt;</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> URL <span class="keyword">from</span> <span class="string">'url'</span></span><br><span class="line"><span class="keyword">let</span> myUrl = URL.parse(<span class="string">'http://www.typescriptlang.org'</span>)</span><br></pre></td></tr></table></figure><h3 id="Module-Resolution"><a href="#Module-Resolution" class="headerlink" title="Module Resolution"></a>Module Resolution</h3><h4 id="Relative-vs-Non-relative-module-imports"><a href="#Relative-vs-Non-relative-module-imports" class="headerlink" title="Relative vs Non-relative module imports"></a>Relative vs Non-relative module imports</h4><p>Module imports are resolved differently based on whether the module reference is relative or non-relative.</p><p>A <em>relative import</em> is one that starts with <code>/, ./, ../</code>.</p><p>Any other import is considered <em>non-relative</em>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> $ <span class="keyword">from</span> <span class="string">'jquery'</span></span><br><span class="line"><span class="keyword">import</span> &#123; Component &#125; <span class="keyword">from</span> <span class="string">'@angular/core'</span></span><br></pre></td></tr></table></figure><p>A relative import is resolved relative to the importing file and <em>cannot</em> resolve to an ambient module declaration.</p><p>A non-relative import can be resolved relative to <code>baseUrl</code>, or through path mapping. They can also resolve to ambient module declaations.</p><h4 id="Module-Resolution-Strategies"><a href="#Module-Resolution-Strategies" class="headerlink" title="Module Resolution Strategies"></a>Module Resolution Strategies</h4><p>There are two possible module resolution strategies: <code>Node</code> and <code>Classic</code>.</p><p>You can use the <code>--moduleResolution</code> flag to specify the module resolution strategy. If not specified, the default is <code>Classic</code> for  <code>--module AMD | System | ES2015 | Node</code>.</p><h3 id="Modules-or-Namespaces"><a href="#Modules-or-Namespaces" class="headerlink" title="Modules or Namespaces"></a>Modules or Namespaces</h3><h4 id="Namespaces-vs-Modules"><a href="#Namespaces-vs-Modules" class="headerlink" title="Namespaces vs Modules"></a>Namespaces vs Modules</h4><p>If fact, namespaces were previously refered to as <em>internal modules</em> while modules where refered to as <em>external modules</em>.</p><h4 id="When-to-use-namespaces-and-when-to-use-moduels"><a href="#When-to-use-namespaces-and-when-to-use-moduels" class="headerlink" title="When to use namespaces and when to use moduels"></a>When to use namespaces and when to use moduels</h4><ul><li><p>When first moving to a module-based organization, a common tendency is to wrap exports in an additional layer of namespaces. Modules have their own scope, and only exported declaration are visible from outside the module. With this in mind, namespaces provide very little, if any, value when working with modules.</p></li><li><p>On the oraganization front, namespaces are handy for grouping together logically-related objects and types in the global.</p></li><li><p>Namespaces are important to avoid naming collisions in the scope.</p></li></ul><h3 id="Reg-Flags"><a href="#Reg-Flags" class="headerlink" title="Reg Flags"></a>Reg Flags</h3><p><strong>Dontât use namespace in modules</strong></p><p>All of the following are reg flags for module structuring.</p><ul><li><p>A file whose only top-level declaration is <code>export namespace Foo { ... }</code>(remove <code>Foo</code> and move everything âupâ a level.)</p></li><li><p>A file that has a single <code>export class</code> or <code>export function</code>(consider using <code>export default</code>)</p></li><li><p>Multiple files that have the same <code>export namespace Foo</code> at top-level(donât think that these are going to combine into one).</p></li></ul><h3 id="Best-Practice"><a href="#Best-Practice" class="headerlink" title="Best Practice"></a>Best Practice</h3><ul><li><p>While <code>namespaces</code> are still available in TypeScript, it is better to use modules as much as possible. This is because in most cases you will need to use external libraries in your application. In that case you will have to deal with modules because modules are the way to go with external none TypeScript libraries. Mixing namespaces and modules in one application is not a recommended practice.</p></li><li><p>Use modules and not namespaces if you are going to share your code as components or libraries to be consumed by other applications.</p></li><li><p>Use namespaces if your application is small and within the same application and when you do have any external dependencies like using external libraries or offering your code to be used by other application. You can still use modules in this case.</p></li></ul><h3 id="Working-with-External-Libraries"><a href="#Working-with-External-Libraries" class="headerlink" title="Working with External Libraries"></a>Working with External Libraries</h3><p>Importing a JavaScript Library.</p><p>There are two options to bring a javascript library in your typescrpt project:</p><ul><li><p>Manual download: this is by manually copying some definitions files for the obejcts used in the JavaScript Libraries into your TypeScript Project so that TypeScript can recognize and be able to support the typings. There is a big effort form the TypeScript community to provide those declaration files for almost all the third party JavaScript Libraries out there for developers to copy and include in their projects without having to rewrite the types themselves. This project is called the definitely typed project.</p></li><li><p>Using TyepSearch: This will automatically install the definition files for the imported libraries. The TypeSearch project that is a Microsoft initiative that uses npm to install lthe library definition files automatically with no need to manually copy any files.</p></li></ul><h4 id="Combine-two-namespaces-with-same-identifier"><a href="#Combine-two-namespaces-with-same-identifier" class="headerlink" title="Combine two namespaces with same identifier"></a>Combine two namespaces with same identifier</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// extendedNamespace_part2.d.ts</span></span><br><span class="line">namespace ArrayUtilities &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// extendedNamespace_part1.d.ts</span></span><br><span class="line"><span class="comment">/// &lt;reference path="extendedNamespace_part2.d.t.s" /&gt;</span></span><br><span class="line">namespace ArrayUtilities &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Note on TS2 of edX</title>
      <link href="/2017/08/11/Note-on-TS2-of-edX/"/>
      <content type="html"><![CDATA[<h3 id="Classification-of-types-in-TypeScript"><a href="#Classification-of-types-in-TypeScript" class="headerlink" title="Classification of types in TypeScript"></a>Classification of types in TypeScript</h3><p>Types are classified into two main classes in TypeScript:</p><h4 id="Basic-or-Primitive-Types"><a href="#Basic-or-Primitive-Types" class="headerlink" title="Basic or Primitive Types"></a>Basic or Primitive Types</h4><ul><li><p>boolean</p></li><li><p>number</p></li><li><p>string</p></li><li><p>array: <code>number[]</code>, <code>Array&lt;number&gt;</code></p></li><li><p>tuple: <code>[string, number]</code></p></li><li><p>enum: <code>enum Color {Red, Green = 2, Blue}</code>, <code>let c : Color = Color.blue</code></p></li><li><p>null</p></li><li><p>undefined</p></li><li><p>any</p></li><li><p>void: exists purely to indicate the absence of a value, such as in a function with no return value.</p></li></ul><h4 id="Complex-or-Non-Primitive-Types"><a href="#Complex-or-Non-Primitive-Types" class="headerlink" title="Complex or Non-Primitive Types"></a>Complex or Non-Primitive Types</h4><ul><li><p>classes</p></li><li><p>interface</p></li></ul><h4 id="Type-Assertions"><a href="#Type-Assertions" class="headerlink" title="Type Assertions"></a>Type Assertions</h4><p>Sometimes youâll end up in a situation where youâll know more about a value than TypeScript does. Usually this will happen when you know the type of some entity could be more specific than its current type.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> someValue : any = <span class="string">'this is a string'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> strLength : number = (<span class="xml"><span class="tag">&lt;<span class="name">string</span>&gt;</span>someValue).length</span></span><br><span class="line"><span class="xml">let strLength : numner = (someValue as string).length</span></span><br></pre></td></tr></table></figure><h3 id="Complex-Types-in-TypeScript"><a href="#Complex-Types-in-TypeScript" class="headerlink" title="Complex Types in TypeScript"></a>Complex Types in TypeScript</h3><ul><li><p>Interface</p></li><li><p>Class Types</p></li><li><p>Function Types</p></li><li><p>Indexable Types</p></li><li><p>Classes</p></li></ul><h4 id="Excess-Property"><a href="#Excess-Property" class="headerlink" title="Excess Property"></a>Excess Property</h4><p>If <code>SquareConfig</code> can have <code>color</code> and <code>width</code> propertes, but could <em>also</em> have any number of other properties, then we could define it like so:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">interface SquareConfig &#123;</span><br><span class="line">  color?: string;</span><br><span class="line">  width?: number;</span><br><span class="line">  [propName: string]: any;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Class-Types"><a href="#Class-Types" class="headerlink" title="Class Types"></a>Class Types</h4><p>Implementing an interface</p><p>One of the most common use of interfaces in language like C# and java, that of explicitly enforcing that a class meets a particular contract, is also possible in TypeScript.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">interface ClockInterface &#123;</span><br><span class="line">  currentTime: <span class="built_in">Date</span>,</span><br><span class="line">  setTime(d: <span class="built_in">Date</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Clock</span> <span class="title">implements</span> <span class="title">ClockInterface</span> </span>&#123;</span><br><span class="line">  currentTime: <span class="built_in">Date</span>;</span><br><span class="line">  setDate(d: <span class="built_in">Date</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.currentTime = d;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">constructor</span> (h: number, m: number) &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Difference-between-the-static-and-instance-sides-of-classes"><a href="#Difference-between-the-static-and-instance-sides-of-classes" class="headerlink" title="Difference between the static and instance sides of classes"></a>Difference between the static and instance sides of classes</h4><p>When working with classes and interfaces, it helps to keep in mind that a class has <code>two</code> types: the type of the static side and the type of the instance side.</p><p>You may notice that if you create an interface with a constructor signature and try to create a class that implements this interface you get an error:</p><p>This is because when a class implements an interface, only the <strong>instance side</strong> of the class is checked. Since the constructor sits in the static side, it is not included in this check.</p><p>Instead, you would need to work with the static side of the class directly. In this example, we define two interfaces, <code>ClockConstructor</code> for the constructor and <code>Clockinterface</code> for the instance methods.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">interface ClockConstructor &#123;</span><br><span class="line">  <span class="keyword">new</span> (hour: number, <span class="attr">minute</span>: number): ClockInterface;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface ClockInterface &#123;</span><br><span class="line">  tick()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createClock</span>(<span class="params">ctor: ClockConstructor, hour: number, minute: number</span>): <span class="title">ClockInterface</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> ctor(hour, minute)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Function-Types"><a href="#Function-Types" class="headerlink" title="Function Types"></a>Function Types</h4><p>To describe a function type with an interface, we give the interface a call signature. This is like a function declaration with only the parameter list and return type given. Each parameter in the parameters list requires both name and type.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">interface SearchFunc &#123;</span><br><span class="line">  (source: string, <span class="attr">subString</span>: string): boolean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Once defined, we can use this function type interface like we would other interfaces.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> mySearch: SearchFunc</span><br><span class="line">mySearch = <span class="function"><span class="keyword">function</span> (<span class="params">source, subString</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> result = source.search(subString)</span><br><span class="line">  <span class="keyword">return</span> result &gt; <span class="number">-1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>For function types to correctly type-check, the names of the parameters do not need to match. We could have, for example, written the above example like this:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> mySearch: SearchFunc</span><br><span class="line">mySearch = <span class="function"><span class="keyword">function</span> (<span class="params">src: string, sub: string</span>): <span class="title">boolean</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> result = src.search(sub)</span><br><span class="line">  <span class="keyword">return</span> result &gt; <span class="number">-1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Function parameters are checked one at a time, with the type in each corresponding parameter position checked against each other. If you do not want to specify types at all, TypeScriptâs contextual typing can infer the argument types since the function value is assigned directly to a variable of type <code>SearchFunc</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> mySearch: SearchFunc</span><br><span class="line">mySearch = <span class="function"><span class="keyword">function</span> (<span class="params">src, sub</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> result = src.search(sub)</span><br><span class="line">  <span class="keyword">return</span> result &gt; <span class="number">-1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Indexable-Types"><a href="#Indexable-Types" class="headerlink" title="Indexable Types"></a>Indexable Types</h4><p>Intexable types have an <em>index signature</em> that describes the types we can use to index into the object, along with the corresponding return types when indexing.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">interface StringArray &#123;</span><br><span class="line">  [index: number]: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> myArray: StringArray;</span><br><span class="line">myArray = [<span class="string">'Bob'</span>, <span class="string">'Fred'</span>];</span><br></pre></td></tr></table></figure><p>Above we have a StringArray interface that has an index signature. This index signature states that when a StringArray is indexed with a number, it will return a string.</p><p>There are two types of supported index signature: string an number. It is possible to support both types of indexer, but the type returned from a numeric indexer must be a subtype of the type returned from the string indexer. This is because when indexing witha  number, javascript will actually convert that to a string before indexing into a object.</p><h3 id="Classes"><a href="#Classes" class="headerlink" title="Classes"></a>Classes</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Greeter</span> </span>&#123;</span><br><span class="line">  greeting: string;</span><br><span class="line">  <span class="keyword">constructor</span> (message: string) &#123;</span><br><span class="line">    <span class="keyword">this</span>.greeting = message</span><br><span class="line">  &#125;</span><br><span class="line">  greet () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Hello, "</span> + <span class="keyword">this</span>.greeting;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> greeter = <span class="keyword">new</span> Greeter(<span class="string">'World'</span>)</span><br></pre></td></tr></table></figure><p>This class has three members: a property called <code>greeting</code>, a constructor, and a method <code>greet</code>.</p><p>In the last line we construct an instance of the Greeter class using <code>new</code>. This calls into the constructor we defined earlier, creating a new object with the Greeter shape, and running the constructor to initialize it.</p><h4 id="Public-Private-and-Protected-Modifiers"><a href="#Public-Private-and-Protected-Modifiers" class="headerlink" title="Public, Private, and Protected Modifiers"></a>Public, Private, and Protected Modifiers</h4><p>Public by default.</p><p>When a member is marked <code>private</code>, it cannot be accessed from outside of its containing class.</p><p>When comparing types that have <code>private</code> and <code>protected</code> members, TypeScript treats these types differently. For two types to be considered compatible, if one of them has a <code>private</code> member, then the other must have a <code>private</code> member that originated in the same declaration.</p><p>The <code>protected</code> modifier acts much like the <code>private</code> modifier with the exectpion the members declared <code>protected</code> can also be accessed by instance of deriving classes.</p><p>A constructor may also be marked <code>protected</code>. This means that the class cannot be instantiated outside of its containing class, but can be extended.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  protected name: string;</span><br><span class="line">  protected <span class="keyword">constructor</span> (theName: string) &#123;</span><br><span class="line">    <span class="keyword">this</span>.name = theName</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Employee can extend Person</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span> <span class="keyword">extends</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  private department: string;</span><br><span class="line">  <span class="keyword">constructor</span> (name: string, department: string) &#123;</span><br><span class="line">    <span class="keyword">super</span>(name)</span><br><span class="line">    <span class="keyword">this</span>.department = department</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> howard = <span class="keyword">new</span> Employee(<span class="string">'Howard'</span>, <span class="string">'Sales'</span>)</span><br><span class="line"><span class="keyword">let</span> john = <span class="keyword">new</span> Persno(<span class="string">'john'</span>) <span class="comment">// Error, the 'Person' constructor is protceted.</span></span><br></pre></td></tr></table></figure><p>You can make properties readonly by using the <code>readonly</code> keyword. Readonly properties must be initilized at their declaration or in the constructor.</p><h4 id="Parameter-Propertes"><a href="#Parameter-Propertes" class="headerlink" title="Parameter Propertes"></a>Parameter Propertes</h4><p><em>Parameter Properties</em> let you create and initialize a member in one place.</p><h4 id="Accessors"><a href="#Accessors" class="headerlink" title="Accessors"></a>Accessors</h4><p>TypeScript supports <strong>getter/setters</strong> as a way of intercepting accesses to a member of an object. This gives you a way of having finer-grained control over how a member is accessed on each object.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> passcode = <span class="string">'secret passcode'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line">  private _fullName: string;</span><br><span class="line">  get fullName(): string &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>._fullName</span><br><span class="line">  &#125;</span><br><span class="line">  set fullName (newName: string) &#123;</span><br><span class="line">    <span class="keyword">if</span> (passcode &amp;&amp; passcode === <span class="string">'secret passcode'</span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>._fullName = newName</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'Error: Unauthorized update of employee'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Accessors with a get and no set are automatically inferred to be <code>readonly</code>.</p><h3 id="Static-Properties"><a href="#Static-Properties" class="headerlink" title="Static Properties"></a>Static Properties</h3><p>Static Members of a class are those visible on class itself rather than on the instance.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Grid</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> origin = &#123;<span class="attr">x</span>: <span class="number">0</span>, <span class="attr">y</span>: <span class="number">0</span>&#125;</span><br><span class="line">  calculatedDistanceFromOrigin(point: &#123; <span class="attr">x</span>:number, <span class="attr">y</span>: number &#125;) &#123;</span><br><span class="line">    <span class="keyword">let</span> xDist = (point.x - Grid.origin.x)</span><br><span class="line">    <span class="keyword">let</span> yDist = (point.y - Grid.origin.y)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.sqrt(xDist * xDist + yDist * yDist) / <span class="keyword">this</span>.scale</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span> (public scale: number) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> grid1 = <span class="keyword">new</span> Grid(<span class="number">1.0</span>)</span><br><span class="line"><span class="keyword">let</span> grid2 = <span class="keyword">new</span> Grid(<span class="number">5.0</span>)</span><br></pre></td></tr></table></figure><h3 id="Abstract-Classes"><a href="#Abstract-Classes" class="headerlink" title="Abstract Classes"></a>Abstract Classes</h3><p>Abstract Classes are base classes from which other classes may be derived. They may not be instantiated directly. Unlike an interface, an abstract class may contain implementation details for its members. The <code>abstract</code> keyword is used to define abstract classes as well as abstract methods within an abstract class.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">abstract <span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  abstract makeSound(): <span class="keyword">void</span>;</span><br><span class="line">   move () : <span class="keyword">void</span> &#123;</span><br><span class="line">     <span class="built_in">console</span>.log &#123;<span class="string">'roaming the earth...'</span>&#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Methods within an abstract class that are marked as abstract do not contain an implementation and must be implemented in derived classes. Abstract methods share a similar syntax to interface methods. Both define the signature of a method without including a method body. However, abstract methods must include the <code>abstract</code> keyword and may optionally include access modifier.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">abstract <span class="class"><span class="keyword">class</span> <span class="title">Department</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> (public name: string) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  printName () : <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Department name: '</span> + <span class="keyword">this</span>.name)</span><br><span class="line">  &#125;</span><br><span class="line">  abstract printMeeting (): <span class="keyword">void</span> <span class="comment">// must be implemented in derived classes</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AccountingDepartment</span> <span class="keyword">extends</span> <span class="title">Department</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> () &#123;</span><br><span class="line">    <span class="keyword">super</span>(<span class="string">'Accounting and Auditing'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  printMeeting () : <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'The Accounting Department meets each Monday at 10am'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  generateReports () : <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Generating accounting reports...'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> department: Department; <span class="comment">// ok to create a reference to an abstract type</span></span><br><span class="line">department = <span class="keyword">new</span> Department(); <span class="comment">// error: cannot create an instance of an abstract class</span></span><br><span class="line">department = <span class="keyword">new</span> AccountingDepartment(); <span class="comment">// ok to create and assign a non-abstract subclass</span></span><br><span class="line">department.printName()</span><br><span class="line">department.printMeeting()</span><br><span class="line">department.generateReports()</span><br></pre></td></tr></table></figure><h3 id="Advanced-Techniques"><a href="#Advanced-Techniques" class="headerlink" title="Advanced Techniques"></a>Advanced Techniques</h3><h4 id="Constructor-functions"><a href="#Constructor-functions" class="headerlink" title="Constructor functions"></a>Constructor functions</h4><p>When you declare a class in TypeScript, you are actually creating multiple delcaration at the same time. The first is the type of the <code>instance</code> of the class</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Greeter</span> </span>&#123;</span><br><span class="line">  greeting: string;</span><br><span class="line">  <span class="keyword">constructor</span> (message: string) &#123;</span><br><span class="line">    <span class="keyword">this</span>.greeting = message</span><br><span class="line">  &#125;</span><br><span class="line">  greet () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Hello, '</span> + <span class="keyword">this</span>.message</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> greeter: Greeter</span><br><span class="line">greeter = <span class="keyword">new</span> Greeter(<span class="string">'world'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(greeter.greet())</span><br></pre></td></tr></table></figure><p>Here, when we say <code>let greeter: Greeter</code> weâre using <code>Greeter</code> as the type of instance of the class <code>Greeter</code>. This is almost second nature to programmers from other oo language.</p><p>Weâre also creating another value that we call the <code>constructor function</code>. This is the function that is called when we <code>new</code> up instance of the class. To see what this looks in practice, letâs take a look at the JavaScript created the above example:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> Greeter = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">Greeter</span>(<span class="params">message</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.greeting = message</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Greeter.prototype.greet = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Hello, '</span> + <span class="keyword">this</span>.greeting</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> Greeter</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> greeter</span><br><span class="line">greeter = <span class="keyword">new</span> Greeter(<span class="string">'world'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(greeter.greet())</span><br></pre></td></tr></table></figure><p>Here <code>let Greeter</code> is going to be assigned the constructor function. When we call <code>new</code> and run this function, we get an instance of the class. The constructor function also contains all of the static members of the class. Another way to think of each class is that there is an <em>instance</em> side and a <em>static</em> side.</p><h4 id="Using-a-class-as-an-interface"><a href="#Using-a-class-as-an-interface" class="headerlink" title="Using a class as an interface"></a>Using a class as an interface</h4><p>As mentioned above, a class declaration creates two things: a type representing instances of the class, and a constructor function. Because classes creates types, you can use them in the same places you would be able to use interfaces:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">  x: number;</span><br><span class="line">  y: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface Point3D extends Point &#123;</span><br><span class="line">  z: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> point3d: Point3D = &#123;</span><br><span class="line">  x: <span class="number">1</span>,</span><br><span class="line">  y: <span class="number">2</span>,</span><br><span class="line">  z: <span class="number">3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Inheritance"><a href="#Inheritance" class="headerlink" title="Inheritance"></a>Inheritance</h3><p>In TypeScript, we can use common object-orientad pattern. Of course, one of the most fundamental patterns in class-based programming is being able to extend existing classes to create new ones using inheritance.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  name: string;</span><br><span class="line">  <span class="keyword">constructor</span> (theName: string) &#123;</span><br><span class="line">    <span class="keyword">this</span>.name = theName</span><br><span class="line">  &#125;</span><br><span class="line">  move (distanceInMeters: number = <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span> move <span class="subst">$&#123;distanceInMeters&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Snake</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> (name: string) &#123;</span><br><span class="line">    <span class="keyword">super</span>(name)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  move (distanceInMeters = <span class="number">5</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Slithering...'</span>)</span><br><span class="line">    <span class="keyword">super</span>.move(distanceInMeters)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Horse</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> (name: string) &#123;</span><br><span class="line">    <span class="keyword">super</span>(name)</span><br><span class="line">  &#125;</span><br><span class="line">  move (distanceInMeters = <span class="number">45</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Galloping...'</span>)</span><br><span class="line">    <span class="keyword">super</span>.move(distanceInMeters)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Derived classes that contain constructor functions must call <code>super()</code> which will execute the constructor function on the base class.</p><h4 id="Interfaces-Extending-Classes"><a href="#Interfaces-Extending-Classes" class="headerlink" title="Interfaces Extending Classes"></a>Interfaces Extending Classes</h4><p>When an interface type extends a class type it inherits the memembers of the class but not their implementations. <strong>It is as if the interface had declared all of the members of the class without providing an implementation.</strong> Interface inherit event the private and protected members of a base class. This means that when you create an interface that extends a class with private or protected memebrs, that interface type can only be implemented by the class or a subclass of it.</p><p>This is useful when you have a large inheritance hierarchy, but want to specify that you code works iwth only subclasses that have certain properties. The subclasses donât have to be related besides inheriting from the base class.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Control</span> </span>&#123;</span><br><span class="line">  private state: any;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface SelectableControl extends Control &#123;</span><br><span class="line">  select () : <span class="keyword">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Button</span> <span class="keyword">extends</span> <span class="title">Control</span> </span>&#123;</span><br><span class="line">  select () &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TextBox</span> <span class="keyword">extends</span> <span class="title">Control</span> </span>&#123;</span><br><span class="line">  select () &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Image</span> </span>&#123;</span><br><span class="line">  select () &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Location</span> </span>&#123;</span><br><span class="line">  select () &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>In the above example, <code>SelectableControl</code> contains all of the members of Control, including the <code>private state</code> property. Since <code>state</code> is a private member it is only possible for descendants of Control to implement <code>SelectableControl</code>. This is because only descendants of Control will have a <code>state</code> private member that originates in the same declaration, which is a requirement for private members to be compatible.</p><p>Within the <code>Control</code> class it is possible to access the <code>state</code> private member through an instance of <code>SelectableControl</code>. Effectively, a <code>SelectableControl</code> acts like a <code>Control</code> that is known to have a <code>select</code> method. The <code>Button</code> and <code>TextBox</code> classes are subtypes of <code>SelectableControl</code>, but <code>Image</code> and <code>Location</code> are not.</p><h3 id="Type-Compatibility"><a href="#Type-Compatibility" class="headerlink" title="Type Compatibility"></a>Type Compatibility</h3><p>Type compatibility in TypeScript is based on structural subtyping. Structural typing is a way of relating types based on solely on their members. This is in contrast with normal typing.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">interface Named &#123;</span><br><span class="line">  name: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  name: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> p: Named;</span><br><span class="line"></span><br><span class="line"><span class="comment">// OK, because of structural typing</span></span><br><span class="line">p = <span class="keyword">new</span> Person()</span><br></pre></td></tr></table></figure><p>A basic rule for TypeScriptâs structural type system is that x is compatible with y if y has at least the same members as x.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">interface Named &#123;</span><br><span class="line">  name: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> x: Named;</span><br><span class="line"></span><br><span class="line"><span class="comment">// y's inferred type is &#123; name: string; location: string; &#125;</span></span><br><span class="line"><span class="keyword">let</span> y = &#123; <span class="attr">name</span>: <span class="string">'Alice'</span>, <span class="attr">location</span>: <span class="string">'Seattle'</span> &#125;</span><br><span class="line">x = y</span><br></pre></td></tr></table></figure><h4 id="Comparing-Two-Functions"><a href="#Comparing-Two-Functions" class="headerlink" title="Comparing Two Functions"></a>Comparing Two Functions</h4><p>While comparing primitive types and object types is relatively straightforward, the question of what kinds of functions should be considered compatible is a bit more involved.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> x = <span class="function">(<span class="params">a: number</span>) =&gt;</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">let</span> y = <span class="function">(<span class="params">b: number, s: string</span>) =&gt;</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">y = x <span class="comment">// ok</span></span><br><span class="line">x = y <span class="comment">// Error</span></span><br></pre></td></tr></table></figure><p>To check if x is assignable to y, we first look at the parameter list. Each parameter in x must have a corresponding parameter in y with a compatible type. Note that the name of the parameters are not considered, only their types. In this case, every parameter of x has a corresponding compatible parameter in y, so x is assignable to y.</p><p>To ensure that every parameter in x can be checked in y.</p><h4 id="Enums"><a href="#Enums" class="headerlink" title="Enums"></a>Enums</h4><p>Enums are compatible with numbers, and numers are compatible with enums.</p><p>Enum values from different enum types are considered incompatible.</p><h4 id="Classes-1"><a href="#Classes-1" class="headerlink" title="Classes"></a>Classes</h4><p>Classes work similarly to object literal types and interfaces with one exception: they have both a static and an instance type. When comparing two objects of a class type, only members of the instance are compared. Static memebrs and constructor do not affect compatibility.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  feet: number;</span><br><span class="line">  <span class="keyword">constructor</span> (name: string, numFeet: number) &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Size</span> </span>&#123;</span><br><span class="line">  feet: number;</span><br><span class="line">  <span class="keyword">constructor</span> (numFeet: number) &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a: Animal</span><br><span class="line"><span class="keyword">let</span> s: Size</span><br><span class="line"></span><br><span class="line">a = s <span class="comment">// ok</span></span><br><span class="line">s = a <span class="comment">// ok</span></span><br></pre></td></tr></table></figure><p>Private and protected members in a class affect their compatibility. When an instance of a class is checked for compatibility, if the target type contains a private member, then the source type must also contain a private member that originated from the same class.</p><h4 id="Contextual-Type"><a href="#Contextual-Type" class="headerlink" title="Contextual Type"></a>Contextual Type</h4><p>Type inference also work in âthe other directionâ in some cases in TypeScript. This is known as âcontextual typingâ. Contextual typing occurs when the type of an expression is implied by its location.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.onmousedown = <span class="function"><span class="keyword">function</span> (<span class="params">mouseEvent</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(mouseEvent.buton) <span class="comment">// &lt;- Error</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Functions-and-function-Types"><a href="#Functions-and-function-Types" class="headerlink" title="Functions and function Types"></a>Functions and function Types</h3><p>TypeScript functions can be created both as a named function or as an anonymous function. This allows you to choose the most appropriate approach for your application, whether youâre building a list of functions in an API or a one-off function to hand off to another function.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Named Function</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Anonymouse Function</span></span><br><span class="line"><span class="keyword">let</span> myAdd = <span class="function"><span class="keyword">function</span> (<span class="params">x, y</span>) </span>&#123; <span class="keyword">return</span> x + y &#125;</span><br></pre></td></tr></table></figure><h4 id="Function-Types-1"><a href="#Function-Types-1" class="headerlink" title="Function Types"></a>Function Types</h4><p>Typing the function.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">x: number, y: number</span>): <span class="title">number</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Writing the function type</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> myAdd: <span class="function">(<span class="params">x: number, y: number</span>) =&gt;</span> number = <span class="function"><span class="keyword">function</span>(<span class="params">x, y</span>) </span>&#123; <span class="keyword">return</span> x + y &#125;</span><br></pre></td></tr></table></figure><p>A functionâs type has the same two parts: the type of the arguments and the return type. When writing out the whole function type, both parts are required.</p><h3 id="Context-and-Scope"><a href="#Context-and-Scope" class="headerlink" title="Context and Scope"></a>Context and Scope</h3><p><code>this</code> and <code>arrow function</code>.</p><p>In JavaScript, <strong><code>this</code> is a variable thatâs set when a function is called</strong>. This makes it a very powerful and flexible feature, but it comes at the cost of always having to know about the context that a function is executing in.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> deck = &#123;</span><br><span class="line">  suits: [<span class="string">'hearts'</span>, <span class="string">'spades'</span>, <span class="string">'clubs'</span>, <span class="string">'diamonds'</span>],</span><br><span class="line">  cards: <span class="built_in">Array</span>(<span class="number">52</span>),</span><br><span class="line">  createCardPicker: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">let</span> pickedCard = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">52</span>)</span><br><span class="line">      <span class="keyword">let</span> pickedSuit = <span class="built_in">Math</span>.floor(pickedCard / <span class="number">13</span>)</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">suit</span>: <span class="keyword">this</span>.suits[pickedSuit], <span class="attr">card</span>: pickedCard % <span class="number">13</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Here the function returned by <code>createCardPicker</code> will be called by <code>window</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> deck &#123;</span><br><span class="line">  suits: [<span class="string">'hearts'</span>, <span class="string">'spades'</span>, <span class="string">'clubs'</span>, <span class="string">'diamonds'</span>],</span><br><span class="line">  cards: <span class="built_in">Array</span>(<span class="number">52</span>),</span><br><span class="line">  createCardPicker: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">NOTE:</span> the line below is now an arrow function, which will capture 'this' when then function is declared.</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> pickedCard = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">52</span>)</span><br><span class="line">      <span class="keyword">let</span> pickedSuit = <span class="built_in">Math</span>.floor(pickedCard / <span class="number">13</span>)</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">suit</span>: <span class="keyword">this</span>.suits[pickedSuit], <span class="attr">card</span>: pickedCard % <span class="number">13</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Overloads"><a href="#Overloads" class="headerlink" title="Overloads"></a>Overloads</h3><p>JavaScript is inherently a very dynamic language. Itâs not uncommon for a single JavaScript function to return different types of objects based on the shape of the arguments passed in.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> suits = [<span class="string">'hearts'</span>, <span class="string">'spades'</span>, <span class="string">'clubs'</span>, <span class="string">'diamonds'</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pickCard</span>(<span class="params">x</span>): <span class="title">any</span> </span>&#123;</span><br><span class="line">  <span class="comment">// Check to see if we're working with an object/array</span></span><br><span class="line">  <span class="comment">// if so, they gave us the deck and we'll pick the card</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> x == <span class="string">'object'</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> pickedCard = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * x.length)</span><br><span class="line">    <span class="keyword">return</span> pickedCard</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> x === <span class="string">'number'</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> pickedSuit = <span class="built_in">Math</span>.floor(x / <span class="number">13</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">suit</span>: suits[pickedSuit], <span class="attr">card</span>: x % <span class="number">13</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Here the <code>pickCard</code> function will return two different things based on what the user ahs passed in.</p><p>Use overloads.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> suits = [<span class="string">'hearts'</span>, <span class="string">'spades'</span>, <span class="string">'clubs'</span>, <span class="string">'diamonds'</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pickCard</span>(<span class="params">x: &#123; suit: string, card: number &#125;[]</span>): <span class="title">number</span></span></span><br><span class="line"><span class="function"><span class="title">function</span> <span class="title">pickCard</span>(<span class="params">x: number</span>): </span>&#123; suit: string, <span class="attr">card</span>: number &#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pickCard</span>(<span class="params">x</span>): <span class="title">any</span> </span>&#123;</span><br><span class="line">  <span class="comment">// Check to see if we're working with an object/array</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> x === <span class="string">'object'</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> x === <span class="string">'number'</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Note that the <code>function pickCard(x): any</code> is not part of the overload list.</p><h3 id="Namespaces"><a href="#Namespaces" class="headerlink" title="Namespaces"></a>Namespaces</h3><p>Namespaces are used as a way to organize the code so that you can keep track of your types and not worry about name collisions with other object. Instead of putting lots of different names into the global namespace, you can wrap up your object into a namespace. The choice of what objects go in what namespaces is totally up to your organization preference.</p><p>If you want the interfaces and classes in your namespaces to be visible outside the namespace, you need to preface their declaration with <code>export</code> keyword.</p><p>Also keep in mind that classes, interfaces and variable names within a namespace has to be unique.</p><h4 id="Multi-file-namespaces"><a href="#Multi-file-namespaces" class="headerlink" title="Multi-file namespaces"></a>Multi-file namespaces</h4><p>You can split a namespace across many files, even though the fiels a separate, they can each contribute to the same namespace and can be consumed as if they were all defined in one place. Because there are dependencies between files. you will add <code>reference</code> tags to tell the compiler about the relationship between the files.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ZooAnimals.ts</span></span><br><span class="line"></span><br><span class="line">namespace Zoo &#123;</span><br><span class="line">  interface Animal &#123;</span><br><span class="line">    <span class="comment">//<span class="doctag">NOTE:</span> we do not need the 'export' here since this interface will only be accessible by enttites from within the Zoo namespace.</span></span><br><span class="line">    skinType: string;</span><br><span class="line">    isMammal() : boolean;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ZooWild.ts</span></span><br><span class="line"><span class="comment">/// &lt;reference path="ZooAnimals.ts" /&gt;</span></span><br><span class="line">namespace Zoo &#123;</span><br><span class="line">  <span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Reptile</span> <span class="title">implements</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">NOTE:</span> we need the 'export' here to be able to access this class and instantiate objects of the Reptile type</span></span><br><span class="line">    skinType: <span class="string">'scales'</span>;</span><br><span class="line">    isMammal () &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ZooBirds.ts</span></span><br><span class="line"><span class="comment">/// &lt;reference path="ZooAnimals.ts" /&gt;</span></span><br><span class="line">namespace Zoo &#123;jkj</span><br><span class="line">  <span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Bird</span> <span class="title">implements</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">    skinType: <span class="string">'feather'</span></span><br><span class="line">    isMammal () &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Once there are multiple fiels involved, weâll need to make sure all of the compiled code gets loaded, we can use concatenated output using the <code>--outFile</code> flag to compile all of the input files into a single JavaScript output file.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tsc --outFile zoo.js ZooAnimal.ts ZooWild.ts ZooBirds.ts</span><br></pre></td></tr></table></figure><h4 id="Referencing-namespacing-entities-in-your-code"><a href="#Referencing-namespacing-entities-in-your-code" class="headerlink" title="Referencing namespacing entities in your code"></a>Referencing namespacing entities in your code</h4><p>Namespaces can be accessed either in the same file where the namespace is defined or another .ts file. The only control on access is whether you are using the <code>export</code> keyword or not for the namespace entities.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> parrot = <span class="keyword">new</span> Zoo.Bird();</span><br></pre></td></tr></table></figure><h4 id="Aliases"><a href="#Aliases" class="headerlink" title="Aliases"></a>Aliases</h4><p>You can simplify working with namespaces by using Aliases. You can use <code>import q = x.y.z</code> to create shorter names for commonly-used objects.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> rep = Zoo.Reptitle;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> lizard: rep;</span><br></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Build GraphQL Server With Koa</title>
      <link href="/2017/08/10/Build-GraphQL-Server-with-Koa/"/>
      <content type="html"><![CDATA[<p>Here is the example <a href="http://ezcook.de/2017/08/07/Build-GraphQL-Server-with-Express/" target="_blank" rel="noopener">Build GraphQL Server with Express</a></p><p>The only difference from that example is the way plugining middleware.</p><p>In <code>server.js</code> of Koa:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> Koa <span class="keyword">from</span> <span class="string">'koa'</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> GraphqlHTTP <span class="keyword">from</span> <span class="string">'koa-graphql'</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> Router <span class="keyword">from</span> <span class="string">'koa-router'</span></span><br><span class="line"><span class="keyword">import</span> Schema <span class="keyword">from</span> <span class="string">'./schema'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> PORT = <span class="number">3457</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router()</span><br><span class="line">router.all(<span class="string">'/graphql'</span>, GraphqlHTTP(&#123;</span><br><span class="line">  schema: Schema,</span><br><span class="line">  pretty: <span class="literal">true</span>,</span><br><span class="line">  graphiql: <span class="literal">true</span>,</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line">app.use(router.routes()).use(router.allowedMethods())</span><br><span class="line"></span><br><span class="line">app.listen(PORT, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'server is running at: '</span> + PORT)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Build GraphQL Server With Express</title>
      <link href="/2017/08/10/Build-GraphQL-Server-with-Express-1/"/>
      <content type="html"><![CDATA[]]></content>
      
      
    </entry>
    
    <entry>
      <title>History API</title>
      <link href="/2017/08/09/History-API/"/>
      <content type="html"><![CDATA[<p>The DOM window object provides access to the browserâs history through the <code>history</code> object.</p><h3 id="Moving-Forward-and-Backward"><a href="#Moving-Forward-and-Backward" class="headerlink" title="Moving Forward and Backward"></a>Moving Forward and Backward</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.history.back()</span><br><span class="line"><span class="built_in">window</span>.history.forward()</span><br></pre></td></tr></table></figure><h3 id="Moving-to-a-specific-point-in-history"><a href="#Moving-to-a-specific-point-in-history" class="headerlink" title="Moving to a specific point in history"></a>Moving to a specific point in history</h3><p>You can use the <code>go()</code> method to load a specific page from session history, identified by its relative position to the current page.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.history.go(<span class="number">-1</span>)</span><br><span class="line"><span class="built_in">window</span>.history.go(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>You can determine the number of pages in the history stack by looking at the value of the length property:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> numberOfEntries = <span class="built_in">window</span>.history.length</span><br></pre></td></tr></table></figure><h3 id="Adding-and-Modifying-History-Entries"><a href="#Adding-and-Modifying-History-Entries" class="headerlink" title="Adding and Modifying History Entries"></a>Adding and Modifying History Entries</h3><p><code>history.pushState()</code> and <code>history.replaceState()</code> methods work in conjunction with the <code>window.onpopstate</code> event.</p><p>Using <code>history.pushState()</code> changes the referrer that gets used in the HTTP header for <code>XMLHttpRequest</code> objects created after you change the state. The referrer will be the URL of the document whose window is this at the time of creation of the <code>XMLHttpRequest</code> object.</p><h4 id="Example-of-pushState-Method"><a href="#Example-of-pushState-Method" class="headerlink" title="Example of pushState() Method"></a>Example of pushState() Method</h4><p>Suppose <a href="http://mozilla.org/foo.html" target="_blank" rel="noopener">http://mozilla.org/foo.html</a> executes the following JS.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// history.pushState(StateObj, title, URL)</span></span><br><span class="line"><span class="keyword">var</span> stateObj = &#123; <span class="attr">foo</span>: <span class="string">'bar'</span> &#125;</span><br><span class="line">history.pushState(&#123; stateObj, <span class="string">'page 2'</span>, <span class="string">'bar.html'</span> &#125;)</span><br></pre></td></tr></table></figure><p>This will cause the URL bar to display <a href="http://mozilla.org/bar.html" target="_blank" rel="noopener">http://mozilla.org/bar.html</a>, but wonât cause the browser to load <code>bar.html</code> or even check that <code>bar.html</code> exists.</p><p>Suppose now that the user now navigates to <a href="http://google.com" target="_blank" rel="noopener">http://google.com</a>, then click back. At this point, the URL bar will display <a href="http://mozilla.org/bar.html" target="_blank" rel="noopener">http://mozilla.org/bar.html</a>, and the page will get a <code>popstate</code> event whose <code>state object</code> contains a copy of <code>stateObj</code>.</p><p>If we click back again, the URL change to <a href="http://mozilla.org/foo.html" target="_blank" rel="noopener">http://mozilla.org/foo.html</a>, and the document will get another <code>popstate</code> event, this time with a null state object.(which is different from replaceState).</p><h4 id="The-pushState-method"><a href="#The-pushState-method" class="headerlink" title="The pushState() method"></a>The pushState() method</h4><p><code>pushState()</code> takes three arguments: a state object, a title(which is currently ignored), and (optionally) a URL.</p><ul><li><code>state object</code> - The state object is a javascript object which is associated with the new history entry created by <code>pushState</code>. Whenever the user navigates to the new state, a <code>popstate</code> event is fired, and the state property of the event contains a copy of the history entryâs state object.</li></ul><p>The state object can be anything that can be serialized. Because Firefox saves the state objects to the userâs disk so they can be restored after the user restarts the browser, we impose a size limit of 640k characters on the serialized representation of a state object. If you pass a state object whose serialized representation is larger than this to <code>pushState()</code>, the method will throw an exception. If you need more space than this, youâre encouraged to use <code>sessionStorage</code> and/or <code>localStorage</code>.</p><ul><li><p><code>title</code> - Firefox currently ingores this parameter, although it may use it in the future. Passing the empty string here should be safe against future changes to the method.</p></li><li><p><code>URL</code> - The new history entryâs URL is given by this parameter. Note that the browser wonât attempt to load this URL after a call to <code>pushState()</code>, but it might attempt to load the URL later, for instance after the user restarts the browser. The new URL does not need to be absolute; if itâs relative, itâs resolved to the current URL. The new URL must be of the same origin as the current URL; otherwise <code>pushState</code> will throw an exception. The parameter is optional, if it isnât specified, itâs set to the documentâs current URL.</p></li></ul><p>In a sense, calling <code>pushState()</code> is similar to setting <code>window.location = &#39;#foo&#39;</code>, in that both will create and activate another history entry associated with the current document, but <code>pushState</code> has a few advantages:</p><ul><li><p>The new URL can be any URL in the same origin as the current URL. In contrast, setting <code>window.location</code> keeps you at the same document only if you modify only the hash</p></li><li><p>You donât have to change the URL if you donât want to. In contrast, setting <code>window.location = &#39;#foo&#39;</code> only creates a new history entry if the current hash isnât <code>#hash</code></p></li><li><p>You can associate arbitrary data with your new history entry. With the hash-based approach, you need to encode all of the relevant data int o a short string.</p></li></ul><h4 id="The-replaceState-method"><a href="#The-replaceState-method" class="headerlink" title="The replaceState() method"></a>The replaceState() method</h4><p><code>history.replaceState()</code> operates exactly like <code>history.pushState()</code> except the <code>replaceState()</code> modifies the current history entry instead of creating a new one. Note that this doesnât prevent the creation of a new entry in the global browser history.</p><p><code>replaceState()</code> is particularly useful when you want to upate the state object or URL of the current history entry in reponse to some user action.</p><h4 id="Example-of-replaceState-method"><a href="#Example-of-replaceState-method" class="headerlink" title="Example of replaceState() method"></a>Example of replaceState() method</h4><p>Suppose <a href="http://mozilla.org/foo.html" target="_blank" rel="noopener">http://mozilla.org/foo.html</a> executes the following JS:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> stateObj = &#123; <span class="attr">foo</span>: <span class="string">'bar'</span> &#125;</span><br><span class="line">history.replaceState(stateObj, <span class="string">'page 2'</span>, <span class="string">'bar.htmk'</span>)</span><br></pre></td></tr></table></figure><p>This will cause the URL bar to display <a href="http://mozilla.org/bar.html" target="_blank" rel="noopener">http://mozilla.org/bar.html</a>, but wonât cause the browser to load bar.html or even check that bar.html exists.</p><p>Suppose now that the user navigates to <a href="http://www.microsoft.com" target="_blank" rel="noopener">http://www.microsoft.com</a>, then clicks back. At this point, the URL bar will display <a href="http://mozilla.org/bar.html" target="_blank" rel="noopener">http://mozilla.org/bar.html</a>.</p><p>If you click back again, you will be nagivated to the page before foo.html. (which is different from pushState())</p><h3 id="The-popstate-event"><a href="#The-popstate-event" class="headerlink" title="The popstate event"></a>The popstate event</h3><p>A popstate event is dispatched to the <code>window</code> every time the active history entry changes. If the history entry being activated was created by a call to <code>pushState</code> or affected by <code>replaceState</code>, the <code>popstate</code> eventâs <code>state</code> property contains a copy of the history entryâs state object.</p><h3 id="Reading-the-current-state"><a href="#Reading-the-current-state" class="headerlink" title="Reading the current state"></a>Reading the current state</h3><p>When your page loads, it might have a non-null state object. This can be happen, for example, if the page sets a state object(by <code>pushState</code>, or <code>replaceState</code>) and then the user restarts their browser. When your page reloads, the page will receive an <code>onload</code> event, but no <code>popstate</code> event. However if you read the <code>history.state</code> property, youâll get back the state object you would have to gotten if a <code>popstate</code> had fired.</p><p>You can read it directly:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> currentState = history.state</span><br></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Note on Sequelize</title>
      <link href="/2017/08/07/Note-on-Sequelize/"/>
      <content type="html"><![CDATA[<p>Sequelize is a promise-based ORM for Node.</p><h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Sequelize = <span class="built_in">require</span>(<span class="string">'sequelize'</span>)</span><br><span class="line"><span class="keyword">const</span> sequelize = <span class="keyword">new</span> Sequeslize(<span class="string">'database'</span>, <span class="string">'username'</span>, <span class="string">'password'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> User = sequelize.define(<span class="string">'user'</span>, &#123;</span><br><span class="line">  username: Sequelize.STRING,</span><br><span class="line">  birthday: Sequelize.DATE,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">sequelize.sync().then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  User.create(&#123;</span><br><span class="line">    username: <span class="string">'Jane'</span>,</span><br><span class="line">    birthday: <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">1980</span>, <span class="number">5</span>, <span class="number">2</span>),</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;).then(<span class="function"><span class="params">jane</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'create successfully'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Start"><a href="#Start" class="headerlink" title="Start"></a>Start</h3><h4 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yarn add sequelize</span><br><span class="line"><span class="comment"># add one of the following:</span></span><br><span class="line">yarn add pg pg-hstore</span><br><span class="line">yarn add mysql2</span><br><span class="line">yarn add sqlite3</span><br><span class="line">yarn add tedious // MSSQL</span><br></pre></td></tr></table></figure><h4 id="Setup-a-connection"><a href="#Setup-a-connection" class="headerlink" title="Setup a connection"></a>Setup a connection</h4><p>Sequelize will setup a connection pool on initialization so you should ideally only ever create one instance per database if youâre connecting to the DB from a single process. If youâre connecting to the DB from multiple processes, youâll have to create one instance per process, but each instance should have a maximum connection pool size of âmax connection pool size divided by number of instancesâ. So, if you wanted a max connection pool size of 90 and you have 3 worker process, each processâs instance should have a max connection pool size of 30.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Conn = <span class="keyword">new</span> Sequelize(<span class="string">'database'</span>, <span class="string">'username'</span>, <span class="string">'password'</span>, &#123;</span><br><span class="line">  host: <span class="string">'localhost'</span>,</span><br><span class="line">  dialect: <span class="string">'mysql'</span>|<span class="string">'sqlite'</span>|<span class="string">'postgres'</span>|<span class="string">'mssql'</span>,</span><br><span class="line">  pool: &#123;</span><br><span class="line">    max: <span class="number">5</span>,</span><br><span class="line">    min: <span class="number">0</span>,</span><br><span class="line">    idle: <span class="number">10000</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  storage: <span class="string">'path/to/database.sqlite'</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// or you can simply use a connection uri</span></span><br><span class="line"><span class="keyword">const</span> Conn = <span class="keyword">new</span> Sequelize(<span class="string">'postgres://user:pass@example.com:5432/dbname'</span>)</span><br></pre></td></tr></table></figure><h4 id="Test-the-connection"><a href="#Test-the-connection" class="headerlink" title="Test the connection"></a>Test the connection</h4><p>You can use the <code>.authenticate()</code> function like this to test the connection.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Conn.authenticate().then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Connection has been established successfully'</span>)</span><br><span class="line">&#125;).catch(<span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.error(<span class="string">'Unable to connect to the database: '</span>, e)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="Model"><a href="#Model" class="headerlink" title="Model"></a>Model</h4><p>Models are defined with <code>Conn.define(&#39;name&#39;, {attributes}, {options})</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> User = Conn.define(<span class="string">'user'</span>, &#123;</span><br><span class="line">  firstName: &#123;</span><br><span class="line">    type: Sequelize.STRING,</span><br><span class="line">  &#125;,</span><br><span class="line">  lastName: &#123;</span><br><span class="line">    type: Sequelize.STRING,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// force: true will drop the table if it already exists</span></span><br><span class="line">User.sync(&#123; <span class="attr">force</span>: <span class="literal">true</span> &#125;).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// Table created</span></span><br><span class="line">  <span class="keyword">return</span> User.create(&#123;</span><br><span class="line">    firstName: <span class="string">'John'</span>,</span><br><span class="line">    lastName: <span class="string">'Hank'</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="Query"><a href="#Query" class="headerlink" title="Query"></a>Query</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">User.findAll().then(<span class="function"><span class="params">users</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(users)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="Application-wide-model-options"><a href="#Application-wide-model-options" class="headerlink" title="Application wide model options"></a>Application wide model options</h4><p>The Sequelize constructor takes a <code>define</code> option which will be used as the default options for all defined models.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Conn = <span class="keyword">new</span> Sequelize(<span class="string">'connectionUri'</span>, &#123;</span><br><span class="line">  define: &#123;</span><br><span class="line">    timestamps: <span class="literal">false</span>, <span class="comment">// true by default</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> User = Conn.define(<span class="string">'user'</span>, &#123;&#125;) <span class="comment">// timestamps is false by default</span></span><br><span class="line"><span class="keyword">const</span> Post = Conn.define(<span class="string">'post'</span>, &#123;&#125;, &#123;</span><br><span class="line">  timestamps: <span class="literal">true</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="Promises"><a href="#Promises" class="headerlink" title="Promises"></a>Promises</h4><p>Sequelize uses promises to control async control-flow.</p><p>Basically, a promise represents a value which will be present at some point.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user = <span class="keyword">await</span> User.fineOne()</span><br><span class="line"><span class="built_in">console</span>.log(user)</span><br></pre></td></tr></table></figure><h3 id="Model-Definition"><a href="#Model-Definition" class="headerlink" title="Model Definition"></a>Model Definition</h3><p>To define mapping between a model and a table, use the <code>define</code> method. Sequelize will then automatically add the attributes <code>createdAt</code> and <code>updatedAt</code> to it. So you will be able to know when the database entry went into the db and when it was updated the last time.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Project = Conn.define(<span class="string">'project'</span>, &#123;</span><br><span class="line">  title: Sequelize.STRING,</span><br><span class="line">  description: Sequelize.TEXT,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Task = Conn.define(<span class="string">'tastk'</span>, &#123;</span><br><span class="line">  title: Sequelize.STRING,</span><br><span class="line">  description: Sequelize.TEXT,</span><br><span class="line">  deadline: Sequelize.DATE,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>You can also set some options on each column:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Foo = Conn.define(<span class="string">'foo'</span>, &#123;</span><br><span class="line">  <span class="comment">// instantiating will automatically set the flat to true if not set</span></span><br><span class="line">  flag: &#123;</span><br><span class="line">    type: Sequelize.BOOLEAN,</span><br><span class="line">    allowNull: <span class="literal">false</span>,</span><br><span class="line">    defaultValue: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  myDate: &#123;</span><br><span class="line">    type: Sequelize.DATE,</span><br><span class="line">    defaultValue: Sequelize.NOW,</span><br><span class="line">  &#125;,</span><br><span class="line">  title: &#123;</span><br><span class="line">    type: Sequelize.STRING,</span><br><span class="line">    allowNull: <span class="literal">false</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  uniqueOne: &#123;</span><br><span class="line">    type: Sequelize.STRING,</span><br><span class="line">    unique: <span class="string">'compositeIndex'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  uniqueTwo: &#123;</span><br><span class="line">    type: Sequelize.INTEGER,</span><br><span class="line">    unique: <span class="string">'compositeIndex'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  foo: &#123;</span><br><span class="line">    type: Sequelize.STRING,</span><br><span class="line">    validate: &#123;</span><br><span class="line">      isEmail: <span class="literal">true</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h3><p>You can also influence the way Sequelize hadnles your column names:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Bar = Conn.define(<span class="string">'bar'</span>, &#123;</span><br><span class="line">  <span class="comment">/* ... */</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">  <span class="comment">// don't add the timestamp attributes(updatedAt, createdAt)</span></span><br><span class="line">  timestamps: <span class="literal">false</span>,</span><br><span class="line">  <span class="comment">// don't delete database entries but set the newly added attribute deletedAt to the current data(when deletion was done)</span></span><br><span class="line">  paranoid: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// don't use camelcase for automatically added attributes but underscore style so updatedAt will be udpated_at</span></span><br><span class="line">  underscore: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// disable the modification of table names; by default, sequelize will automatically transform all passes model names(first parameter of define) into plural. If you don't want that, set the following</span></span><br><span class="line">  freezeTableName: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// define the table's name</span></span><br><span class="line">  tableName: <span class="string">'my_very_custom_table_name'</span>,</span><br><span class="line">  <span class="comment">// Enable optimistic locking. When enabled, sequelize will add a version count attribute to the model and throw an OptimisticLockingError error when stale instances are saved.</span></span><br><span class="line">  version: <span class="literal">true</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Import"><a href="#Import" class="headerlink" title="Import"></a>Import</h3><p>You can also store your model definitions in a single file using the <code>import</code> method. The returned object is exactly the same as defined in the imported fileâs function.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// in your server file</span></span><br><span class="line"><span class="keyword">const</span> Project = Conn.import(__dirname, <span class="string">"/path/to/models/project"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// The model definition file</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">Conn, DataType</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> Conn.define(<span class="string">'project'</span>, &#123;</span><br><span class="line">    name: DataTypes.STRING,</span><br><span class="line">    description: DataTypes.TEXT,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The <code>import</code> method can also accept a callback as an argument</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Conn.import(<span class="string">'project'</span>, (Conn, DataTypes) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> Conn.define(<span class="string">'project'</span>, &#123;</span><br><span class="line">    name: DataTypes.STRING,</span><br><span class="line">    description: DataTypes.TEXT,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Database-Synchronization"><a href="#Database-Synchronization" class="headerlink" title="Database Synchronization"></a>Database Synchronization</h3><p>When starting a new project you wonât have a database structure and using sequelize you wonât need to. Just specify your model structures and let the library do the rest. Currently supported is the creation and deletion of tables.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create the Tables</span></span><br><span class="line">Project.sync()</span><br><span class="line">Task.sync()</span><br><span class="line"></span><br><span class="line"><span class="comment">// Force the Creation</span></span><br><span class="line">Project.sync(&#123; <span class="attr">force</span>: <span class="literal">true</span> &#125;) <span class="comment">// this will drop the table first and re-create it afterwards</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Drop the Tables</span></span><br><span class="line">Project.drop()</span><br><span class="line">Task.drop()</span><br><span class="line"></span><br><span class="line"><span class="comment">// Event Handling</span></span><br><span class="line">Project.[sync|drop]().then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ok ... everything is nice</span></span><br><span class="line">&#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ooh, did you enter wrong database credentials</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Because synchronizing and dropping all of your tables might be a lot of lines to write, you can also let Sequelize do the work for you:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// sync all models that aren't already in the database</span></span><br><span class="line">Conn.sync()</span><br><span class="line"></span><br><span class="line"><span class="comment">// Force sync all models</span></span><br><span class="line">Conn.sync(&#123; <span class="attr">force</span>: <span class="literal">true</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Drop all Tables</span></span><br><span class="line">Conn.drop()</span><br><span class="line"></span><br><span class="line"><span class="comment">// Emit Handling</span></span><br><span class="line">Conn.[sync|drop]().then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Expansion-of-models"><a href="#Expansion-of-models" class="headerlink" title="Expansion of models"></a>Expansion of models</h3><p>Sequelize Models are ES6 classes, you can very easily add custom instance or class level methods.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> User = Conn.define(<span class="string">'user'</span>, &#123;</span><br><span class="line">  firstName: Sequelize.STRING,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// add a class level method</span></span><br><span class="line">User.classLevelMethod = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  retunr <span class="string">'foo'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// add an instance level method</span></span><br><span class="line">User.prototype.instanceLevelMethod = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  retunr <span class="string">'bar'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Indexes"><a href="#Indexes" class="headerlink" title="Indexes"></a>Indexes</h3><p>Sequelize supports adding indexes to the model definition which will be created during <code>Model.sync()</code> or <code>Conn.sync()</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Conn.define(<span class="string">'user'</span>, &#123;&#125;, &#123;</span><br><span class="line">  indexes: [</span><br><span class="line">    <span class="comment">// Create a unique index on poem</span></span><br><span class="line">    &#123;</span><br><span class="line">      unique: <span class="literal">true</span>,</span><br><span class="line">      fields: [<span class="string">'poen'</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// create a gin index on data with the jsonb_path_ops operator</span></span><br><span class="line">    &#123;</span><br><span class="line">      fields: [<span class="string">'data'</span>],</span><br><span class="line">      using: <span class="string">'gin'</span>,</span><br><span class="line">      operator: <span class="string">'jsonb_path_ops'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// by default index name will be [table]_[fields]</span></span><br><span class="line">    <span class="comment">// create a multi column partial index</span></span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">'public_by_author'</span>,</span><br><span class="line">      fields: [<span class="string">'author'</span>, <span class="string">'status'</span>],</span><br><span class="line">      where: &#123;</span><br><span class="line">        status: <span class="string">'public'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Model-Usage"><a href="#Model-Usage" class="headerlink" title="Model Usage"></a>Model Usage</h3><h4 id="Data-Retrieval-Finders"><a href="#Data-Retrieval-Finders" class="headerlink" title="Data Retrieval / Finders"></a>Data Retrieval / Finders</h4><p>Finder methods are intended to query data from the database. They do not return plain objects but instead return <em>model instances</em>. Because finder methods return model instances you can call any model instance member.</p><h4 id="find-search-for-one-specific-element-in-the-database"><a href="#find-search-for-one-specific-element-in-the-database" class="headerlink" title="find - search for one specific element in the database"></a>find - search for one specific element in the database</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// search for known id</span></span><br><span class="line">Project.findById(<span class="number">123</span>).then(<span class="function"><span class="params">project</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// project will be an instance of Project and store the content of the table entry with id 123. If such an entry is not defined you will get null</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// search for attributes</span></span><br><span class="line">Project.findOne(&#123;</span><br><span class="line">  where: &#123;</span><br><span class="line">    title: <span class="string">'aProject'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;).then(<span class="function"><span class="params">project</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// project will be the first entry of the Projects table with the title 'aProject' || null</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">Project.findONe(&#123;</span><br><span class="line">  where: &#123;</span><br><span class="line">    title: <span class="string">'aProject'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  attributes: [<span class="string">'id'</span>, [<span class="string">'name'</span>, <span class="string">'title'</span>]]</span><br><span class="line">&#125;).then(<span class="function"><span class="params">project</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// project will be the first entry of the Projects table with the title 'aProject' || null</span></span><br><span class="line">  <span class="comment">// project.title will contain the name of the project</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="findOrCreate-Search-for-a-specific-element-or-create-it-if-not-available"><a href="#findOrCreate-Search-for-a-specific-element-or-create-it-if-not-available" class="headerlink" title="findOrCreate - Search for a specific element or create it if not available"></a>findOrCreate - Search for a specific element or create it if not available</h4><p>The method <code>findOrCreate</code> can be used to check if a certain element already exists in the database. If that is the case the method will result in a respective instance, if the element does not yet exists, it will be created.</p><p>Letâs assume we have an empty database with a <code>User</code> model which has a <code>username</code> and a <code>job</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">User.findOrCreate(&#123;</span><br><span class="line">  where: &#123;</span><br><span class="line">    username: <span class="string">'sdepold'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  defaults: &#123;</span><br><span class="line">    job: <span class="string">"Technical Lead JS"</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;).spread(<span class="function">(<span class="params">user, created</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(user.get(&#123;</span><br><span class="line">    plain: <span class="literal">true</span>,</span><br><span class="line">  &#125;))</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * findOrCreate returns an array containing the object that was found or created and a boolean will be true if a new object was created, and false if not</span></span><br><span class="line"><span class="comment">    [ &#123;</span></span><br><span class="line"><span class="comment">      username: 'sdepold',</span></span><br><span class="line"><span class="comment">      job: 'Technical Lead JavaScript',</span></span><br><span class="line"><span class="comment">      id: 1,</span></span><br><span class="line"><span class="comment">      createdAt: Fri Mar 22 2013 21: 28: 34 GMT + 0100(CET),</span></span><br><span class="line"><span class="comment">      updatedAt: Fri Mar 22 2013 21: 28: 34 GMT + 0100(CET)</span></span><br><span class="line"><span class="comment">    &#125;,</span></span><br><span class="line"><span class="comment">    true ]</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>The code created a new instance.</p><h4 id="fineAndCountAll-Search-for-multiple-elements-in-the-database-returns-both-data-and-total-count"><a href="#fineAndCountAll-Search-for-multiple-elements-in-the-database-returns-both-data-and-total-count" class="headerlink" title="fineAndCountAll - Search for multiple elements in the database, returns both data and total count"></a>fineAndCountAll - Search for multiple elements in the database, returns both data and total count</h4><h4 id="findAll-Search-for-multiple-elements-in-the-database"><a href="#findAll-Search-for-multiple-elements-in-the-database" class="headerlink" title="findAll - Search for multiple elements in the database"></a>findAll - Search for multiple elements in the database</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// find multiple entries</span></span><br><span class="line">Project.findAll().then(<span class="function"><span class="params">projects</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// projects will be an array of all Project instances</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// also possible</span></span><br><span class="line">Project.all().then(<span class="function"><span class="params">projects</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// projects will be an array of all Project instances</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// search for specific attribute - hash usage</span></span><br><span class="line">Project.findAll(&#123;</span><br><span class="line">  where: &#123;</span><br><span class="line">    name: <span class="string">'A Project'</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;).then(<span class="function"><span class="params">projects</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// search within a specific range</span></span><br><span class="line">Project.findAll(&#123;</span><br><span class="line">  where: &#123;</span><br><span class="line">    id: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">  &#125;</span><br><span class="line">&#125;).then(<span class="function"><span class="params">projects</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// return instances with id 1, 2, 3</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="Complex-filtering-OR-NOT-queries"><a href="#Complex-filtering-OR-NOT-queries" class="headerlink" title="Complex filtering /OR/NOT queries"></a>Complex filtering /OR/NOT queries</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Project.findAll(&#123;</span><br><span class="line">  where: &#123;</span><br><span class="line">    name: <span class="string">'a project'</span>,</span><br><span class="line">    $or: [</span><br><span class="line">      &#123; <span class="attr">id</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] &#125;,</span><br><span class="line">      &#123; <span class="attr">id</span>: &#123; <span class="attr">$gt</span>: <span class="number">10</span> &#125;&#125;,</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">Project.findAll(&#123;</span><br><span class="line">  where: &#123;</span><br><span class="line">    name: <span class="string">'a project'</span>,</span><br><span class="line">    id: &#123;</span><br><span class="line">      $or: [</span><br><span class="line">        [ <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">        &#123; <span class="attr">$gt</span>: <span class="number">10</span> &#125;,</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Both pieces of code will generate the following:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM `Projects` WHERE (</span><br><span class="line">  `Projects`.`name`=`a project`</span><br><span class="line">  AND (`Projects`.`id` IN (1,2,3) OR `Projects`.`id`&gt;10)</span><br><span class="line">  )</span><br></pre></td></tr></table></figure><h4 id="Manipulating-the-database-with-limit-offset-order-and-group"><a href="#Manipulating-the-database-with-limit-offset-order-and-group" class="headerlink" title="Manipulating the database with limit, offset, order and group"></a>Manipulating the database with limit, offset, order and group</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// limit the results of the query</span></span><br><span class="line">Project.findAll(&#123; <span class="attr">limit</span>: <span class="number">10</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// step over the first 10 elements</span></span><br><span class="line">Project.findAll(&#123; <span class="attr">offset</span>: <span class="number">10</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// step over the first 10 element and take 2</span></span><br><span class="line">Project.findAll(&#123; <span class="attr">offset</span>: <span class="number">10</span>, <span class="attr">limit</span>: <span class="number">2</span> &#125;)</span><br></pre></td></tr></table></figure><p>The syntax for grouping and ordering are equal, so below it is only explained with a single example for group, and the rest for order.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// yields ORDER BY title DESC</span></span><br><span class="line">Project.findAll(&#123; <span class="attr">order</span>: <span class="string">'title DESC'</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// yields GROUP BY name</span></span><br><span class="line">Project.findAll(&#123; <span class="attr">group</span>: <span class="string">'name'</span> &#125;)</span><br></pre></td></tr></table></figure><h4 id="Raw-queries"><a href="#Raw-queries" class="headerlink" title="Raw queries"></a>Raw queries</h4><p>Sometimes you might be expecting a massive dataset that you just want to display without manipulation. For each row you select, Sequelize creates an instance with functions for update, delete, get association etc. If you have thousands of rows, this might take some time. If you only need the raw data and donât want to update anything, you can do like this to get the raw data.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Are you expecting a massive dataset from the DB, and don't want to spend the time building DAOs for each entry? You can pass an extra query option to get the raw data insetead:</span></span><br><span class="line">Project.findAll(&#123;</span><br><span class="line">  where: &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;,</span><br><span class="line">  raw: <span class="literal">true</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Queries"><a href="#Queries" class="headerlink" title="Queries"></a>Queries</h3><h4 id="Attributes"><a href="#Attributes" class="headerlink" title="Attributes"></a>Attributes</h4><p>To select only some attributes, you can use the <code>attributes</code> option. Most often, you pass an array:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Model.findAll(&#123;</span><br><span class="line">  attributes: [<span class="string">'foo'</span>, <span class="string">'bar'</span>]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// Equal to</span></span><br><span class="line">SELECT foo, bar ...</span><br></pre></td></tr></table></figure><h4 id="Where"><a href="#Where" class="headerlink" title="Where"></a>Where</h4><p>Whether you are querying with <code>findAll</code>/<code>find</code> or doing bulk <code>updates</code>/<code>destroy</code> you can pass a <code>where</code> object to filte the query.</p><p><code>where</code> generally takes an object from attribute:value pairs, where value can be primitive for equality matches or keyed objects for other operators.</p><p>Itâs also possible to generate complex <code>AND</code>/<code>OR</code> conditions by nesting of <code>$or</code> and <code>$and</code></p><h4 id="Basics"><a href="#Basics" class="headerlink" title="Basics"></a>Basics</h4>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Build GraphQL Server With Express</title>
      <link href="/2017/08/07/Build-GraphQL-Server-with-Express/"/>
      <content type="html"><![CDATA[<h3 id="Step-1-Connect-to-Server"><a href="#Step-1-Connect-to-Server" class="headerlink" title="Step 1 - Connect to Server"></a>Step 1 - Connect to Server</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// db.js</span></span><br><span class="line"><span class="keyword">const</span> Sequelize = <span class="built_in">require</span>(<span class="string">'sequelize'</span>)</span><br><span class="line"><span class="keyword">const</span> _ = <span class="built_in">require</span>(<span class="string">'lodash'</span>)</span><br><span class="line"><span class="keyword">const</span> Faker = <span class="built_in">require</span>(<span class="string">'faker'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Conn = <span class="keyword">new</span> Sequelize(</span><br><span class="line">  <span class="string">'test'</span>,</span><br><span class="line">  <span class="string">'postgres'</span>,</span><br><span class="line">  <span class="string">'postgres'</span>,</span><br><span class="line">  &#123;</span><br><span class="line">    dialect: <span class="string">'postgres'</span>,</span><br><span class="line">    host: <span class="string">'localhost'</span>,</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Person = Conn.define(<span class="string">'person'</span>, &#123;</span><br><span class="line">  firstName: &#123;</span><br><span class="line">    type: Sequelize.STRING,</span><br><span class="line">    allowNull: <span class="literal">false</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  lastName: &#123;</span><br><span class="line">    type: Sequelize.STRING,</span><br><span class="line">    allowNull: <span class="literal">false</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  email: &#123;</span><br><span class="line">    type: Sequelize.STRING,</span><br><span class="line">    allowNull: <span class="literal">false</span>,</span><br><span class="line">    validate: &#123;</span><br><span class="line">      isEmail: <span class="literal">true</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Post = Conn.define(<span class="string">'post'</span>, &#123;</span><br><span class="line">  title: &#123;</span><br><span class="line">    type: Sequelize.STRING,</span><br><span class="line">    allowNull: <span class="literal">false</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  content: &#123;</span><br><span class="line">    type: Sequelize.STRING,</span><br><span class="line">    allowNull: <span class="literal">false</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Relationships</span></span><br><span class="line">Person.hasMany(Post)</span><br><span class="line">Post.belongsTo(Person)</span><br><span class="line"></span><br><span class="line">Conn.sync(&#123;</span><br><span class="line">  force: <span class="literal">true</span>,</span><br><span class="line">&#125;).then( <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  _.times(<span class="number">10</span>, () =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> Person.create(&#123;</span><br><span class="line">      firstName: Faker.name.firstName(),</span><br><span class="line">      lastName: Faker.name.lastName(),</span><br><span class="line">      email: Faker.internet.email(),</span><br><span class="line">    &#125;).then(<span class="function"><span class="params">person</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> person.createPost(&#123;</span><br><span class="line">        title: <span class="string">`Sample title by <span class="subst">$&#123;person.firstName&#125;</span>`</span>,</span><br><span class="line">        content: <span class="string">'This is a sample article'</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = Conn</span><br></pre></td></tr></table></figure><h3 id="Step-2-Build-Schema"><a href="#Step-2-Build-Schema" class="headerlink" title="Step 2 - Build Schema"></a>Step 2 - Build Schema</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// schema.js</span></span><br><span class="line"><span class="keyword">const</span> Sequelize = <span class="built_in">require</span>(<span class="string">'sequelize'</span>)</span><br><span class="line"><span class="keyword">const</span> _ = <span class="built_in">require</span>(<span class="string">'lodash'</span>)</span><br><span class="line"><span class="keyword">const</span> Faker = <span class="built_in">require</span>(<span class="string">'faker'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Conn = <span class="keyword">new</span> Sequelize(</span><br><span class="line">  <span class="string">'test'</span>,</span><br><span class="line">  <span class="string">'postgres'</span>,</span><br><span class="line">  <span class="string">'postgres'</span>,</span><br><span class="line">  &#123;</span><br><span class="line">    dialect: <span class="string">'postgres'</span>,</span><br><span class="line">    host: <span class="string">'localhost'</span>,</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Person = Conn.define(<span class="string">'person'</span>, &#123;</span><br><span class="line">  firstName: &#123;</span><br><span class="line">    type: Sequelize.STRING,</span><br><span class="line">    allowNull: <span class="literal">false</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  lastName: &#123;</span><br><span class="line">    type: Sequelize.STRING,</span><br><span class="line">    allowNull: <span class="literal">false</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  email: &#123;</span><br><span class="line">    type: Sequelize.STRING,</span><br><span class="line">    allowNull: <span class="literal">false</span>,</span><br><span class="line">    validate: &#123;</span><br><span class="line">      isEmail: <span class="literal">true</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Post = Conn.define(<span class="string">'post'</span>, &#123;</span><br><span class="line">  title: &#123;</span><br><span class="line">    type: Sequelize.STRING,</span><br><span class="line">    allowNull: <span class="literal">false</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  content: &#123;</span><br><span class="line">    type: Sequelize.STRING,</span><br><span class="line">    allowNull: <span class="literal">false</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Relationships</span></span><br><span class="line">Person.hasMany(Post)</span><br><span class="line">Post.belongsTo(Person)</span><br><span class="line"></span><br><span class="line">Conn.sync(&#123;</span><br><span class="line">  force: <span class="literal">true</span>,</span><br><span class="line">&#125;).then( <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  _.times(<span class="number">10</span>, () =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> Person.create(&#123;</span><br><span class="line">      firstName: Faker.name.firstName(),</span><br><span class="line">      lastName: Faker.name.lastName(),</span><br><span class="line">      email: Faker.internet.email(),</span><br><span class="line">    &#125;).then(<span class="function"><span class="params">person</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> person.createPost(&#123;</span><br><span class="line">        title: <span class="string">`Sample title by <span class="subst">$&#123;person.firstName&#125;</span>`</span>,</span><br><span class="line">        content: <span class="string">'This is a sample article'</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = Conn</span><br></pre></td></tr></table></figure><h3 id="Step-3-Add-GraphQL-to-Server"><a href="#Step-3-Add-GraphQL-to-Server" class="headerlink" title="Step 3 - Add GraphQL to Server"></a>Step 3 - Add GraphQL to Server</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"><span class="keyword">const</span> Express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">const</span> GraphHTTP = <span class="built_in">require</span>(<span class="string">'express-graphql'</span>)</span><br><span class="line"><span class="keyword">const</span> Schema = <span class="built_in">require</span>(<span class="string">'./schema'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Config</span></span><br><span class="line"><span class="keyword">const</span> APP_PORT = <span class="number">3000</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = Express()</span><br><span class="line">app.use(<span class="string">'/graphql'</span>, GraphHTTP(&#123;</span><br><span class="line">  schema: Schema,</span><br><span class="line">  pretty: <span class="literal">true</span>,</span><br><span class="line">  graphiql: <span class="literal">true</span>,</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line">app.listen(APP_PORT, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Server listening at '</span> + APP_PORT)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Koa-Graphql</title>
      <link href="/2017/08/06/koa-graphql/"/>
      <content type="html"><![CDATA[<p>Create a GraphQL HTTP server with Koa.</p><h3 id="Usage-with-Koa-Router"><a href="#Usage-with-Koa-Router" class="headerlink" title="Usage with Koa-Router"></a>Usage with Koa-Router</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">'koa'</span>)</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">'koa-router'</span>)</span><br><span class="line"><span class="keyword">const</span> GraphqlHTTP = <span class="built_in">require</span>(<span class="string">'koa-graphql'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router()</span><br><span class="line"></span><br><span class="line">router.all(<span class="string">'/graphql'</span>, graphqlHTTP(&#123;</span><br><span class="line">  schema: MyGraphQLSchema,</span><br><span class="line">  graphiql: ture,</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line">app.use(router.routes()).use(router.allowedMethods())</span><br></pre></td></tr></table></figure><h3 id="Options"><a href="#Options" class="headerlink" title="Options"></a>Options</h3><p>The <code>GraphqlHTTP</code> function accpets the following options:</p><ul><li><p><code>schema</code>: A <code>GraphQLSchema</code> instance from <code>graphql.js</code>, required.</p></li><li><p><code>graphiql</code>: If <code>true</code>, presetns <a href="https://github.com/graphql/graphiql" target="_blank" rel="noopener">GraphiQL</a> when the route with a <code>/graphiql</code> appended is loaded in a browser. We recommended that you set <code>graphiql</code> to <code>ture</code> when your app is in development, because itâs quite useful. You may or may not want it in production.</p></li><li><p><code>rootValue</code>: A value to pass as the <code>rootValue</code> to the <code>graphql()</code> function from <code>graphql.js</code></p></li><li><p><code>context</code>: A value to pass as the <code>context</code> to the <code>graphql()</code> function from <code>graphql.js</code>. If <code>context</code> is not provided, the <code>ctx</code> object is passes as the context.</p></li><li><p><code>pretty</code>: If <code>true</code>, any JSON response will be pretty-printed.</p></li><li><p><code>formatError</code>: An optional function which will be used to format any errors produced by fulfilling a GraphQL operation. If no function is provided, GraphQLâs default spec-compliant <code>formatError</code> function will be used.</p></li><li><p><code>extensions</code>: An optional function for adding additional metadata to the GraphQL response as a key-value object. The result will be added to <code>extensions</code> field in the resulting JSON. This is often useful place to add development time metadata such as the runtime of a query or the amount of resources consumed. This may be an async function. The function is given one object as an argument: <code>{ document, variables, operationName, result }</code></p></li><li><p><code>validationRules</code>: Optional additional validation rules queries must satisfy in addition to those defined by the GraphQL spec.</p></li></ul><h3 id="HTTP-Usage"><a href="#HTTP-Usage" class="headerlink" title="HTTP Usage"></a>HTTP Usage</h3><p>Once installed at a path, <code>koa-graphql</code> will accept requests with the parameters:</p><ul><li><p><code>query</code>: A string GraphQL document to be executed.</p></li><li><p><code>variables</code>: The runtime values to use for any GraphQL query variables as a JSON object.</p></li><li><p><code>operationName</code>: If the provided <code>query</code> contains mutiple named operations, this specifies which operation should be executed. If not provided, a 400 error will be returned if the <code>query</code> contains multiple named operations.</p></li><li><p><code>raw</code>: If the <code>graphql</code> option is enabled and the <code>raw</code> parameter is provided raw JSON will always be returned instead of GraphQL even when loaded from a browser.</p></li></ul><p>GraphQL will first look for each parameter in the URLâs query-string:</p><p><code>/graphql?query=query+getUser($id:ID){user(id:$id){name}}&amp;variables={&quot;id&quot;:&quot;4&quot;}</code></p><p>If not found in the query-string, it will look in the POST request body.</p><p>If the POST body has not been parsed, koa-graphql will interpret it depending on the provided <em>Contetn-Type</em> header:</p><ul><li><p><code>application/json</code>: the POST body will be parsed as a JSON object.</p></li><li><p><code>application/x-www-form-urlencoded</code>: this POST body will be parsed as a url-encoded string of key-value pairs.</p></li><li><p><code>application/graphql</code>: The POST body will be parsed as GraphQL query string, which provides the <code>query</code> parameter.</p></li></ul>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Note on GraphQL(2)</title>
      <link href="/2017/08/04/Note-on-GraphQL-2/"/>
      <content type="html"><![CDATA[<h3 id="Execution"><a href="#Execution" class="headerlink" title="Execution"></a>Execution</h3><p>After being validated, a GraphQL query is executed by a GraphQL server which returns a result that mirrors the shape of the requested query, typically as JSON.</p><p>GraphQL cannot execute a query without a type system, letâs use an example type system to illustrate executing a query.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">type Query &#123;</span><br><span class="line">  human(id: ID!): Human</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type Human &#123;</span><br><span class="line">  name: <span class="built_in">String</span></span><br><span class="line">  appearsIn: [Episode]</span><br><span class="line">  starships: [Starship]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">enum Episode &#123;</span><br><span class="line">  NEWHOPE</span><br><span class="line">  EMPIRE</span><br><span class="line">  JEDI</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type Starship &#123;</span><br><span class="line">  name: <span class="built_in">String</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>In order to describe what happens when a query is executed, letâs use an example to walk through.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  human(id: <span class="number">1002</span>) &#123;</span><br><span class="line">    name</span><br><span class="line">    appearsIn</span><br><span class="line">    starships &#123;</span><br><span class="line">      name</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"data"</span>: &#123;</span><br><span class="line">    <span class="attr">"human"</span>: &#123;</span><br><span class="line">      <span class="attr">"name"</span>: <span class="string">"Han Solo"</span>,</span><br><span class="line">      <span class="attr">"appearsIn"</span>: [</span><br><span class="line">        <span class="string">"NEWHOPE"</span>,</span><br><span class="line">        <span class="string">"EMPIRE"</span>,</span><br><span class="line">        <span class="string">"JEDI"</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"starships"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"name"</span>: <span class="string">"Millenium Falcon"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"name"</span>: <span class="string">"Imperial shuttle"</span></span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>You can think of each field in a GraphQL query as a function or method of the previous type which returns the next type.</p><p>Exactly this is how GraphQL works. Each field on each type is backed by a function called the <code>resolver</code> which is provided by the GraphQL Server Developer.</p><p>When a field is executed, the corresponding <code>resolver</code> is called to produce the next value.</p><p>If a field produces a scalar value like a string or number, then the execution completes.</p><p>However if a field produces an object value then the query will contain another selection of fields which apply to that object. This continues until scalar values are reached.</p><p>GraphQL queries always end at scalar values.</p><h4 id="Root-Fields-amp-Resolvers"><a href="#Root-Fields-amp-Resolvers" class="headerlink" title="Root Fields &amp; Resolvers"></a>Root Fields &amp; Resolvers</h4><p>At the top level of every GraphQL server is a type that represents all of the possible entry points into the GraphQL API, itâs often called the <code>Root Type</code> or the <code>Query Type</code>.</p><p>In this example, our Query Type provides a field called <code>human</code> which accepts the argument <code>id</code>. The resolver function for this field accesses a database and then constructs and returns a <code>Human</code> object.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Query: &#123;</span><br><span class="line">  human(obj, args, context) &#123;</span><br><span class="line">    <span class="keyword">return</span> context.db.loadHumanById(args.id).then(</span><br><span class="line">      userData =&gt; <span class="keyword">new</span> Human(userData)</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p><code>obj</code> The previous object, which for a field on the root Query type if often not used.</p></li><li><p><code>args</code> The arguments provided to the field in the GraphQL query</p></li><li><p><code>context</code> A value which is provided to every resolver and holds important contextual information like the currently logged in user, or access to a database.</p></li></ul><h4 id="Asynchronous-Resolvers"><a href="#Asynchronous-Resolvers" class="headerlink" title="Asynchronous Resolvers"></a>Asynchronous Resolvers</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">human(obj, arg, context) &#123;</span><br><span class="line">  <span class="keyword">return</span> context.db.loadHumanById(args.id).then(</span><br><span class="line">    userData =&gt; <span class="keyword">new</span> Human(userData)</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The context is used to provide access to a database which is used to load data for user by the <code>id</code> provided as an argument in the GraphQL query. Since loading from a database is an asynchronous operation, this returns a <strong>Promise</strong>. When the database returns, we can construct and return a new <code>Human</code> object.</p><p>Notice that while the resolver function needs to be aware of Promise, the GraphQL query does not. It simply expects the <code>human</code> field to return something which it can then ask the <code>name</code> of. During execution, GraphQL will wait for Promise to complete before continuing and will do so with optimal concurrency.</p><h4 id="Trivial-Resolvers"><a href="#Trivial-Resolvers" class="headerlink" title="Trivial Resolvers"></a>Trivial Resolvers</h4><p>Now that a <code>Human</code> object is available, GraphQL execution can continue with the fields requested on it.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Human: &#123;</span><br><span class="line">  name(obj, args, context) &#123;</span><br><span class="line">    <span class="keyword">return</span> obj.name</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>A GraphQL server is powered by a type system which is used to determine what to do next. Even before the <code>human</code> field returns anything, GraphQL knows that the next stop will be to resolve fields on the <code>Human</code> type since the type system tells it that the <code>human</code> field will return a <code>Human</code>.</p><p>Resolving the <code>name</code> in this case is very straight-forward. The name resolver function is called and the <code>obj</code> argument is the <code>new Human</code> object return from the previous field. In this case, we expect that Human object to have a <code>name</code>property which we can read and return directly.</p><h4 id="Scalar-Coercion"><a href="#Scalar-Coercion" class="headerlink" title="Scalar Coercion"></a>Scalar Coercion</h4><p>While the <code>name</code> field is being resolved, the <code>appearsIn</code> and <code>starships</code> fields can be resolved concurrently. The <code>appearsIn</code> field could also have a trivial resolver, but letâs take a closer look:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Human: &#123;</span><br><span class="line">  appearsIn(obj) &#123;</span><br><span class="line">    <span class="keyword">return</span> obj.appearsIn <span class="comment">// return [3, 4, 5]</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Notice that our type system claims <code>appearsIn</code> will return Enum values with known values, however this function is returning numbers. This is an example of scalar coercion. The type system knows what to expect and will convert the values returned by a resolver function into something that upholds the API contract. In this case, there may be an Enum defined on our server which uses numbers like 3, 4, 5 internally, but represents them as Enum values in the GraphQL type system.</p><h4 id="List-Resolvers"><a href="#List-Resolvers" class="headerlink" title="List Resolvers"></a>List Resolvers</h4><p>The <code>appearsIn</code> field above returned a list of Enum values, and since thatâs what the type system expected, each item in the list was coerced to the appropriate enum values.</p><p>What happens when the <code>starships</code> field is resolved?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Human: &#123;</span><br><span class="line">  starships (obj, args, context) &#123;</span><br><span class="line">    <span class="keyword">return</span> obj.starshipIDs.map(</span><br><span class="line">      id =&gt; context.db.loadStarshipByID(id).then(</span><br><span class="line">        shipData =&gt; <span class="keyword">new</span> Starship(shipData)</span><br><span class="line">      )</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The resolver for this field is not just returning a Promise, itâs returning a list of Promises. The <code>Human</code> object has a list of ids of the <code>Starships</code> they piloted, but we need to go load all of those ids to get read Starship objects.</p><p>GraphQL will wait for all of these Promises concurrently before continuing, and when left with a list of objects, it will concurrently continue yet again to load the <code>name</code> field on each of these items.</p><h3 id="Introspection"><a href="#Introspection" class="headerlink" title="Introspection"></a>Introspection</h3><p>We designed the type system, so we know what types are available, but if we didnât, we can ask GraphQL by querying the <code>__schema</code> field, always available on the root type of a Query.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  __schema &#123;</span><br><span class="line">    types &#123;</span><br><span class="line">      name</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// produce</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"data"</span>: &#123;</span><br><span class="line">    <span class="string">"__schema"</span>: &#123;</span><br><span class="line">      <span class="string">"types"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"name"</span>: <span class="string">"Query"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"name"</span>: <span class="string">"Episode"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"name"</span>: <span class="string">"Character"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"name"</span>: <span class="string">"ID"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"name"</span>: <span class="string">"String"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"name"</span>: <span class="string">"Int"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"name"</span>: <span class="string">"FriendsConnection"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"name"</span>: <span class="string">"FriendsEdge"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"name"</span>: <span class="string">"PageInfo"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"name"</span>: <span class="string">"Boolean"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"name"</span>: <span class="string">"Review"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"name"</span>: <span class="string">"SearchResult"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"name"</span>: <span class="string">"Human"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"name"</span>: <span class="string">"LengthUnit"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"name"</span>: <span class="string">"Float"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"name"</span>: <span class="string">"Starship"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"name"</span>: <span class="string">"Droid"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"name"</span>: <span class="string">"Mutation"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"name"</span>: <span class="string">"ReviewInput"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"name"</span>: <span class="string">"__Schema"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"name"</span>: <span class="string">"__Type"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"name"</span>: <span class="string">"__TypeKind"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"name"</span>: <span class="string">"__Field"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"name"</span>: <span class="string">"__InputValue"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"name"</span>: <span class="string">"__EnumValue"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"name"</span>: <span class="string">"__Directive"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"name"</span>: <span class="string">"__DirectiveLocation"</span></span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Letâs group them:</p><ul><li><p><code>Query</code>, <code>Character</code>, <code>Human</code>, <code>Episode</code>, <code>Droid</code>. These are the ones that we defined in our type system.</p></li><li><p><code>String</code>, <code>Boolean</code>. These are built-in scalars that the type system provided.</p></li><li><p><code>__Schema</code>, <code>__Type</code>, <code>__TypeKind</code>, <code>__Field</code>, <code>__InputValue</code>, <code>__EnumValue</code>, <code>__Directive</code>. These are preceded with a double underscore, indicating that they are part of the introspection system.</p></li></ul>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Note on GraphQL(1)</title>
      <link href="/2017/08/03/Note-on-GraphQL-1/"/>
      <content type="html"><![CDATA[<p>GraphQL is a query language for your API, and a server-side runtime for executing queries by using a type system you define for your data.</p><p>A GraphQL service is created by defining types and fields on those types, then providing functions for each field on each type.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">type Query &#123;</span><br><span class="line">  me: User</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type User &#123;</span><br><span class="line">  id: ID</span><br><span class="line">  name: <span class="built_in">String</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Along with functions for each field on each type:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Query_me</span>(<span class="params">request</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request.auth.user;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">User_name</span>(<span class="params">user</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> user.getName()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Once a GraphQL service is running (typically at a URL on a web service), it can be sent GraphQL queries to validate and execute. A received query is first checked to ensure it only refers to the types and fields defined, then runs the provided functions to produce a result.</p><p>For example the query:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  me &#123;</span><br><span class="line">    name</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// produce</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"me"</span>: &#123;</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"Luck"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Fields"><a href="#Fields" class="headerlink" title="Fields"></a>Fields</h3><p>GraphQL is about asking for specific fields on objects.</p><p>GraphQL queries can traverse related objects and their fields, letting clients fetch lots of related data in one request, instead of making several roundtrips as one would need in a classic RESTFul architecture.</p><h3 id="Arguments"><a href="#Arguments" class="headerlink" title="Arguments"></a>Arguments</h3><p>In GraphQL, every field and nested object can get its own set of arguments, making GraphQL a complete replacement for making multiple API fetches. You can even pass arguments into scalar fields, to implement data transformations once on the server, instead of on every separately.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  human(id: <span class="string">'1000'</span>) &#123;</span><br><span class="line">    name</span><br><span class="line">    height(uint: FOOT)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Arguments can be of many different types. GraphQL comes with a default set of types, but a GraphQL server can also declare its own custom types, as long as they can be serialized into your transport format.</p><h3 id="Aliases"><a href="#Aliases" class="headerlink" title="Aliases"></a>Aliases</h3><p>You canât directly query for the same field with different arguments, so you need alias to rename the result</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  empireHero: hero(episode: EMPIRE) &#123;</span><br><span class="line">    name</span><br><span class="line">  &#125;</span><br><span class="line">  jediHero: hero(episode: JEDI) &#123;</span><br><span class="line">    name</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// produce</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"data"</span>: &#123;</span><br><span class="line">    <span class="string">"empireHero"</span>: &#123;</span><br><span class="line">      <span class="string">"name"</span>: <span class="string">"..."</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"jediHero"</span>: &#123;</span><br><span class="line">      <span class="string">"name"</span>: <span class="string">"..."</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>In the above example, the two <code>hero</code> fields would have conflicted, but since we can alias them to different names, we can get both results in one request.</p><h3 id="Fragments"><a href="#Fragments" class="headerlink" title="Fragments"></a>Fragments</h3><p>GraphQL includes reusable units called <em>fragments</em>. Fragments let you construct sets of fields, and then include them in queries where you need to.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  leftComparison: hero(episode: EMPIRE) &#123;</span><br><span class="line">    ...comparisonFields</span><br><span class="line">  &#125;</span><br><span class="line">  rightComparison: hero(episode: JEDI) &#123;</span><br><span class="line">    ...comparisonFields</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fragment comparisonFields on Character &#123;</span><br><span class="line">  name</span><br><span class="line">  appearsIn</span><br><span class="line">  friends &#123;</span><br><span class="line">    name</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Variables"><a href="#Variables" class="headerlink" title="Variables"></a>Variables</h3><p>When we start working with variables, we need to do three things:</p><ul><li><p>Replace the static values in the query with <code>$variableName</code></p></li><li><p>Declare <code>$variableName</code> as one of the variables accepted by the query</p></li><li><p>Pass <code>variableName: value</code> in the separate, transport-specific(usually JSON) variables dictionary</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">query HeroNameAndFriends($episode: Episode) &#123;</span><br><span class="line">  hero(episode: $episode) &#123;</span><br><span class="line">    name</span><br><span class="line">    friends &#123;</span><br><span class="line">      name</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Variables</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">'episode'</span>: <span class="string">'JEDI'</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Now in our client code, we can simply pass a different variable rather than needing to construct an entirely new query.</p><h4 id="Variable-Definitions"><a href="#Variable-Definitions" class="headerlink" title="Variable Definitions"></a>Variable Definitions</h4><p>The variable definitions are the part that looks like <code>($episode: Episode)</code> in the query above. It works just like the argument definition for a function in a types language. It lists all of the variables, prefixed by <code>$</code>, followed by their type, in this case <code>Episode</code>.</p><p>All declared variables must be either scalars, enums, or input object types.</p><p>Variable Definition can be optional or required. In the case above, since there isnât an <code>!</code> next to the <code>Episode</code> type, itâs optional. But if the field you are passing the variable into requires a non-null argument, then the variable must be required.</p><h4 id="Default-Variables"><a href="#Default-Variables" class="headerlink" title="Default Variables"></a>Default Variables</h4><p>Default variables can also be assigned to the variables in the query by adding the default value after the type declaration.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">query HeroNameAndFriends($episode: Episode = <span class="string">'JEDI'</span>) &#123;</span><br><span class="line">  hero(episode: $episode) &#123;</span><br><span class="line">    name</span><br><span class="line">    friends &#123;</span><br><span class="line">      name</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Directives"><a href="#Directives" class="headerlink" title="Directives"></a>Directives</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">query Hero($episode: Episode, <span class="attr">$withFriends</span>: <span class="built_in">Boolean</span>!) &#123;</span><br><span class="line">  hero(episode: $episode) &#123;</span><br><span class="line">    name</span><br><span class="line">    friends @include(<span class="keyword">if</span>: $withFriends) &#123;</span><br><span class="line">      name</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// variables</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"episode"</span>: <span class="string">"JEDI"</span>,</span><br><span class="line">  <span class="string">"withFriends"</span>: <span class="literal">false</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>We needed to use a new feature in GraphQL called <em>directive</em>. A directive can be attached to a field or fragment inclusion, and can affect execution of the query in any way the server desires. The core GraphQL specification includes exactly two directives, which must be supported by any spec-compliant GraphQL server implementation:</p><ul><li><p>@include(if: Boolean): Only include this field in the result if the argument is <code>true</code></p></li><li><p>@skip(if: Boolean): Skip this field if the argument is <code>true</code></p></li></ul><h3 id="Mutations"><a href="#Mutations" class="headerlink" title="Mutations"></a>Mutations</h3><p>If mutation field returns an object type, you can ask for nested fields. This can be useful for fetching the new state of an object after an update.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mutation CreateReviewForEpisode ($ep: Episode!, <span class="attr">$review</span>: ReviewInput!) &#123;</span><br><span class="line">  createReview(episode: $ep, <span class="attr">review</span>: $Review) &#123;</span><br><span class="line">    stars</span><br><span class="line">    commentary</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Variables</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"ep"</span>: <span class="string">"JEDI"</span>,</span><br><span class="line">  <span class="string">"review"</span>: &#123;</span><br><span class="line">    <span class="string">"star"</span>: <span class="number">5</span>,</span><br><span class="line">    <span class="string">"commentary"</span>: <span class="string">"This is a great movie"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Here the <code>createReview</code> returns the <code>star</code> and <code>commentary</code> fields of the newly created review.</p><h4 id="Multiple-fields-in-mutations"><a href="#Multiple-fields-in-mutations" class="headerlink" title="Multiple fields in mutations"></a>Multiple fields in mutations</h4><p>A mutation can contain multiple fields, just like a query. Thereâs one important distinction between queries and mutations, other than the name.</p><p>While query fields are executed in parallel, mutation fields run in series, one after the other. This means that if we send two <code>incrementCredits</code> mutations in one request, the first is guaranteed to finished before the second begins, ensuring that we donât end up with a race condition with ourselves.</p><h3 id="Inline-Fragments"><a href="#Inline-Fragments" class="headerlink" title="Inline Fragments"></a>Inline Fragments</h3><p>GraphQL include the ability to define interfaces and union types.</p><p>If you are querying a field that returns an interface or a union type, you will need to use <em>inline fragments</em> to access data on the underlaying concrete type.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">query HeroForEpisode ($ep: Episode!) &#123;</span><br><span class="line">  hero (episode: $ep) &#123;</span><br><span class="line">    name</span><br><span class="line">    ... on Droid &#123;</span><br><span class="line">      primaryFunction</span><br><span class="line">    &#125;</span><br><span class="line">    ... on Human &#123;</span><br><span class="line">      height</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Variables</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"ep"</span>: <span class="string">"JEDI"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// produce</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"data"</span>: &#123;</span><br><span class="line">    <span class="string">"hero"</span>: &#123;</span><br><span class="line">      <span class="string">"name"</span>: <span class="string">"..."</span>,</span><br><span class="line">      <span class="string">"primaryFunction"</span>: <span class="string">"..."</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>In this query, the <code>hero</code> field returns the type <code>Character</code>, which might be either a <code>Human</code> or a <code>Droid</code> depending on the <code>episode</code> argument. In the direct selection, you can ask for fields that exists on the <code>Character</code> interface such as <code>name</code>.</p><p>To ask for a field on the concrete type, you need to use a <em>inline fragment</em> with a type condition. Because the first fragment is labeled as <code>... on Droid</code>, the <code>primaryFunction</code> field will only be executed if the <code>Character</code> returned from <code>hero</code> is of the <code>Droid</code> type.</p><p>Named fragments can also be used in the same way, since a named fragment always has a type attached.</p><h4 id="Meta-fields"><a href="#Meta-fields" class="headerlink" title="Meta fields"></a>Meta fields</h4><p>Given that there are some situations where you donât know what type you will get back from the GraphQL service, you need some way to determine how to handle that data on the client. GraphQL allows you to request <code>__typename</code>, a meta field, at any point in a query to get the name of the object type at that point.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  search(text: <span class="string">"an"</span>) &#123;</span><br><span class="line">    __typename</span><br><span class="line">    ... on Human &#123;</span><br><span class="line">      name</span><br><span class="line">    &#125;</span><br><span class="line">    ... on Droid &#123;</span><br><span class="line">      name</span><br><span class="line">    &#125;</span><br><span class="line">    ... on Starship &#123;</span><br><span class="line">      name</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// produce</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"data"</span>: &#123;</span><br><span class="line">    <span class="string">"search"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"__typename"</span>: <span class="string">"Human"</span>,</span><br><span class="line">        <span class="string">"name"</span>: <span class="string">"Han"</span>,</span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        <span class="string">"__typename"</span>: <span class="string">"Human"</span>,</span><br><span class="line">        <span class="string">"name"</span>: <span class="string">"ELX"</span>,</span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        <span class="string">"__typename"</span>: <span class="string">"Starship"</span>,</span><br><span class="line">        <span class="string">"name"</span>: <span class="string">"TIE"</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>In the above query, <code>search</code> returns a union type that can be one of three options. It would be impossible to tell apart the different types from the client without the <code>__typename</code> field.</p><h3 id="Schemas-and-Types"><a href="#Schemas-and-Types" class="headerlink" title="Schemas and Types"></a>Schemas and Types</h3><h4 id="Type-System"><a href="#Type-System" class="headerlink" title="Type System"></a>Type System</h4><p>GraphQL query language is basically about selecting fields on objects.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  hero &#123;</span><br><span class="line">    name</span><br><span class="line">    appearsIn</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><p>We start with a special ârootâ object</p></li><li><p>We select the <code>hero</code> field on that</p></li><li><p>For the object returned by <code>hero</code>, we select the <code>name</code> and <code>appearsIn</code> fields</p></li></ol><h4 id="Object-Types-and-Fields"><a href="#Object-Types-and-Fields" class="headerlink" title="Object Types and Fields"></a>Object Types and Fields</h4><p>The most basic components of a GraphQL schema are object types, which just represent a kind of object you can fetch from your service, and what fields it has. In the GraphQL schema language, we might represent it like this:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">type Character &#123;</span><br><span class="line">  name: <span class="built_in">String</span>!</span><br><span class="line">  appearsIn: [Episode]!</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p><code>Character</code> is a <em>GraphQL Type</em>, meaning itâs a type with some fields. Most of the types in your schema will be object types.</p></li><li><p><code>name</code> and <code>appearsIn</code> are <em>fields</em> on the <code>Character</code> type. That means that <code>name</code> and <code>appearsIn</code> are the only fields that can appear in any part of a GraphQL query that operates on the <code>Character</code> type.</p></li><li><p><code>String</code> is one of the built-in <em>scalar</em> types</p></li><li><p><code>String!</code> means that the field is <code>non-nullable</code>, meaning that the GraphQL service promises to always give you a value when you query this field.</p></li><li><p><code>[Episode]!</code> represents an <em>array</em> of <code>Episode</code> objects. Since it is also <em>non-nullable</em>, you can always expect an array ( with zero or more items) when you query the <code>appearsIn</code> field.</p></li></ul><h4 id="Arguments-1"><a href="#Arguments-1" class="headerlink" title="Arguments"></a>Arguments</h4><p>Every field on a GraphQL object type can have zero or more arguments, for example the <code>length</code> field below:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">type Starship &#123;</span><br><span class="line">  id: ID!</span><br><span class="line">  name: <span class="built_in">String</span>!</span><br><span class="line">  length(uint: LengthUint = METER): Float</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>All arguments are named.</p><h4 id="The-Query-and-Mutation-Types"><a href="#The-Query-and-Mutation-Types" class="headerlink" title="The Query and Mutation Types"></a>The Query and Mutation Types</h4><p>Most types in schema will just be normal object types, but there are two types that are special within a schema:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">schema &#123;</span><br><span class="line">  query: Query</span><br><span class="line">  mutation: Mutation</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Every GraphQL service has a <code>query</code> type and may not have a <code>mutation</code> type. These types are the same as a regular object type, but they are special because they define the <em>entry point</em> of every GraphQL query.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">query &#123;</span><br><span class="line">  hero &#123;</span><br><span class="line">    name</span><br><span class="line">  &#125;</span><br><span class="line">  droid(id: <span class="string">'2000'</span>) &#123;</span><br><span class="line">    name</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>That means that the GraphQL service needs to have a <code>Query</code> type with <code>hero</code> and <code>droid</code> fields:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">type Query &#123;</span><br><span class="line">  hero(episode: Episode): Character</span><br><span class="line">  droid(id: ID!): Droid</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Mutations work in a similar way - you define fields on the <code>Mutation</code> type, and those are available as the root mutation fields you can call in your query.</p><h4 id="Scalar-Types"><a href="#Scalar-Types" class="headerlink" title="Scalar Types"></a>Scalar Types</h4><ul><li><p><code>Int</code>: A signed 32-bit integer</p></li><li><p><code>Float</code>: A signed double-precision floating-point value</p></li><li><p><code>String</code>: A UTF-8 character sequence</p></li><li><p><code>Boolean</code>: true or false</p></li><li><p><code>ID</code>: The ID Scalar type represents a unique identifier, often used to refetch an object or as the key for a cache. The ID types serialized in the same way as a String; However, defining it as an <code>ID</code> signifies that it is not intended to be human-readable.</p></li></ul><p>In most GraphQL service implementation, there is also a way to specify custom scalar types.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scalar <span class="built_in">Date</span></span><br></pre></td></tr></table></figure><h4 id="Enumeration-Types"><a href="#Enumeration-Types" class="headerlink" title="Enumeration Types"></a>Enumeration Types</h4><p>Also called <em>Enums</em>, enumeration types are a special kind of scalar that is restricted to a particular set of allowed values.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">enum Episode &#123;</span><br><span class="line">  NEWHOPE</span><br><span class="line">  EMPIRE</span><br><span class="line">  JEDI</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This means that wherever we use the type <code>Episode</code> in our schema, we expect it to be exactly one of <code>NEWHOPE</code>, <code>EMPIRE</code>, <code>JEDI</code>.</p><h4 id="Lists-and-Non-Null"><a href="#Lists-and-Non-Null" class="headerlink" title="Lists and Non-Null"></a>Lists and Non-Null</h4><p>Object types, scalars, and enums are the only kinds of types you can define in GraphQL, but when you use the types in other parts of the schema, or in your query variable declarations, you can apply additional <em>type modifier</em> that affects validation of those values.</p><h4 id="Interfaces"><a href="#Interfaces" class="headerlink" title="Interfaces"></a>Interfaces</h4><p>An <em>Interface</em> is an abstract type that includes a certain set of fields that a type must include to implement the interface.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// define</span></span><br><span class="line">interface Character &#123;</span><br><span class="line">  id: ID!</span><br><span class="line">  name: <span class="built_in">String</span>!</span><br><span class="line">  friends: [Character]</span><br><span class="line">  appearsIn: [Episode]!</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// implement</span></span><br><span class="line">type Human implements Character &#123;</span><br><span class="line">  id: ID!</span><br><span class="line">  name: <span class="built_in">String</span>!</span><br><span class="line">  friends: [Character]</span><br><span class="line">  appearsIn: [Episode]!</span><br><span class="line">  starships: [Starship]</span><br><span class="line">  totalCredits: Int</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type Droid implements Character &#123;</span><br><span class="line">  id: ID!</span><br><span class="line">  name: <span class="built_in">String</span>!</span><br><span class="line">  friends: [Character]</span><br><span class="line">  appearsId: [Episode]!</span><br><span class="line">  primaryFunction: <span class="built_in">String</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Union-Types"><a href="#Union-Types" class="headerlink" title="Union Types"></a>Union Types</h4><p>Union Types are similar to interfaces, but they donât get to specify any common fields between the types.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union SearchResult = Human | Droid | Starship</span><br></pre></td></tr></table></figure><h4 id="Input-Types"><a href="#Input-Types" class="headerlink" title="Input Types"></a>Input Types</h4><p>In GraphQL schema language, input types look exactly the same as regular object types, but with the keyword <code>input</code> instead of <code>type</code>:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">input ReviewInput &#123;</span><br><span class="line">  stars: Int!</span><br><span class="line">  commentary: <span class="built_in">String</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mutation CreateReviewForEpisode($ep: Episode!, <span class="attr">$review</span>: ReviewInput!) &#123;</span><br><span class="line">  createReview(episode: $ep, <span class="attr">review</span>: $review) &#123;</span><br><span class="line">    stars</span><br><span class="line">    commentary</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Variables</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"ep"</span>: <span class="string">"JEDI"</span>,</span><br><span class="line">  <span class="string">"review"</span>: &#123;</span><br><span class="line">    <span class="string">"stars"</span>: <span class="number">5</span>,</span><br><span class="line">    <span class="string">"commentary"</span>: <span class="string">"Commentary"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>List of HTTP Status Code</title>
      <link href="/2017/08/03/List-of-HTTP-Status-Code/"/>
      <content type="html"><![CDATA[<h3 id="1xx"><a href="#1xx" class="headerlink" title="1xx"></a>1xx</h3><ul><li><p>100 (continue)</p></li><li><p>101 (Switching Protocols)</p></li></ul><h3 id="2xx"><a href="#2xx" class="headerlink" title="2xx"></a>2xx</h3><ul><li><p>200 (OK)</p></li><li><p>201 (Created): respond to POST Request in RESTFul.</p></li><li><p>202 (Accepted): Server fetch the request, but not respond immediately.</p></li><li><p>203 (Non-Authoritative Information).</p></li><li><p>204 (No Content): Server has handled the request, but no content need to be respond.</p></li><li><p>205 (Reset Content): Server has handled the request, and no content need to be respond. But server request client to reset the document(recover to that before submission).</p></li><li><p>206 (Partial Content): HTTP allowed transferring by piece of data.</p></li></ul><h3 id="3xx"><a href="#3xx" class="headerlink" title="3xx"></a>3xx</h3><p><code>3xx</code> request more operation from client, usually redirect to other page.</p><p>Destination redirect to will be specified in <code>Location</code> in header.</p><ul><li><p>301 (Moved Permanently): The resource has been moved to new position.</p></li><li><p>302 (Found): The resource will be returned from other url temporarily.</p></li><li><p>303 (See Other)</p></li><li><p>304 (Not Modified): Usually work with <code>Etag</code></p></li></ul><p>Server will return <code>304</code> with <code>Etag: &#39;***&#39;</code> to specify resource version. Next time the client request the resource with <code>If-None-Match: &#39;***&#39;</code>, and server checks if the <code>Etag</code> is same to <code>If-None-Match</code>. If same, then return 304.</p><h3 id="4xx"><a href="#4xx" class="headerlink" title="4xx"></a>4xx</h3><p>Client Error.</p><ul><li><p>400 (Bad Request)</p></li><li><p>401 (Unauthorized): Server responds with <code>WWW-Authenticate</code> for authorization info, and client should request with <code>authorization</code> in header next time.</p></li><li><p>403 (Forbidden): Server got the request, and refuse to handle.</p></li><li><p>404 (Method Not Allowed)</p></li><li><p>413 (Request Entity Too Large)</p></li><li><p>414 (Request-URI Too Large)</p></li></ul><h3 id="5xx"><a href="#5xx" class="headerlink" title="5xx"></a>5xx</h3><p>Server Error.</p><ul><li><p>500 (Internal Server Error): Server Bug.</p></li><li><p>502 (Bad Gateway): The Proxy receive invalid response from upstream server.</p></li><li><p>504 (Gateway Time-out).</p></li></ul>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Short Clip of RxJS</title>
      <link href="/2017/08/01/Short-Clip-of-RxJS/"/>
      <content type="html"><![CDATA[<h3 id="Creation"><a href="#Creation" class="headerlink" title="Creation"></a>Creation</h3><p><code>Rx.Observable.create</code> is an alias for the <code>Observable</code> constructor, and it takes one argument: the <code>subscribe</code> function.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> observable = Rx.Observable.create(<span class="function"><span class="keyword">function</span> <span class="title">subscribe</span> (<span class="params">observer</span>) </span>&#123;</span><br><span class="line">  observer.next(<span class="number">1</span>)</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Observable can be created with <code>create</code>, but usually we use the so-called <code>creation operators</code>, like, <code>of</code>, <code>from</code>, <code>interval</code>, etc.</p><h3 id="Subscription"><a href="#Subscription" class="headerlink" title="Subscription"></a>Subscription</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">observable.subscribe(&#123;</span><br><span class="line">  next: <span class="built_in">console</span>.log,</span><br><span class="line">  error: <span class="built_in">console</span>.error,</span><br><span class="line">  complete: <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'done'</span>),</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Subscribing to an Observable is like calling a function, providing callbacks where the data will be delivered to.</p><h3 id="Execution"><a href="#Execution" class="headerlink" title="Execution"></a>Execution</h3><p>The code inside <code>Observable.create(function subscribe (observer) { /*...*/ })</code> represents an <code>Observable execution</code>, a lazy computation that only happens for each Observer that subscribes. The execution produces multiple values over time, either synchronous or asynchronous.</p><p>There are three types of values on Observable Execution can deliver:</p><ul><li><p>âNextâ notification: sends a value such as a Number, a String, an Object, etc.</p></li><li><p>âErrorâ notification: sends a JavaScript Error or exception.</p></li><li><p>âCompleteâ notification: does not send a value.</p></li></ul><p>In an Observable Execution, zero to infinite Next notifications may be delivered. If either an Error or Complete notification is delivered, then nothing else can be delivered afterwards.</p><p>Itâs a good idea to wrap any code in <code>subscribe</code> with <code>try/catch</code> block that will deliver an Error notification if it catches an exception:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> observable = Rx.Observable.create(<span class="function"><span class="keyword">function</span> <span class="title">subscribe</span> (<span class="params">observer</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span>&#123;</span><br><span class="line">    observer.next(<span class="number">1</span>)</span><br><span class="line">    observer.next(<span class="number">2</span>)</span><br><span class="line">    observer.complete()</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    observer.error(err)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Disposing-Observable-Executions"><a href="#Disposing-Observable-Executions" class="headerlink" title="Disposing Observable Executions"></a>Disposing Observable Executions</h3><p>Because Observable Executions may be infinite, and itâs common for an Observer to want abort execution in finite time, we need an API for cancelling an execution. Since each execution is exclusive to one Observer only, once the Observer is done receiving values, it has to have a way to stop the execution, in order to avoid wasting computation power or memory resources.</p><p><code>observable.subscribe</code> will return the <code>Subscription</code> object.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> subscription = observable.subscribe(<span class="function"><span class="params">x</span> =&gt;</span> <span class="built_in">console</span>.log(x))</span><br></pre></td></tr></table></figure><p>The <code>Subscription</code> represents the ongoing execution, and has a minimal API which allows you to cancel that execution.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">subscription.unsubscribe()</span><br></pre></td></tr></table></figure><p>When you subscribe, you get back a Subscription, which represents the ongoing execution. Just call <code>unsubscribe()</code> to cancel the execution.</p><p>You can return a custom <code>unsubscribe</code> function within <code>function subscribe()</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> observale = Rx.Observable.create(<span class="function"><span class="keyword">function</span> <span class="title">subscribe</span> (<span class="params">observer</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> intervalID = setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    observer.next(<span class="string">'hi'</span>)</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">unsubscribe</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    clearInterval(intervalID)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Observer"><a href="#Observer" class="headerlink" title="Observer"></a>Observer</h3><p>An Observer is a consumer of values delivered by an Observable. Observers are simply a set of callbacks, one of each type of notification delivered by the Observable: <code>next</code>, <code>error</code>, <code>complete</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> observer = &#123;</span><br><span class="line">  next: <span class="built_in">console</span>.log,</span><br><span class="line">  error: <span class="built_in">console</span>.error,</span><br><span class="line">  complete: <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'done'</span>),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>To use the observer, provide it to the <code>subscirbe</code> of an Observable.</p><p>When subscribing to an Observable, you may also just provide the callbacks as arguments, without being attached to an Observer object.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">observable.subscribe(<span class="built_in">console</span>.log)</span><br><span class="line"><span class="comment">// it will be treated as</span></span><br><span class="line">observable.subscribe(&#123;</span><br><span class="line">  <span class="built_in">console</span>.log,</span><br><span class="line">  err =&gt; <span class="built_in">console</span>.error(<span class="string">'Observer got an error: '</span> + err),</span><br><span class="line">  () =&gt; <span class="built_in">console</span>.log(<span class="string">'Observable got a complete notification'</span>),</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Subscription-1"><a href="#Subscription-1" class="headerlink" title="Subscription"></a>Subscription</h3><p>A Subscription is an object that represents a disposable resource, usually the execution of an Observable. A subscription has one important method, <code>unsubscribe</code>, that takes no arguments and just disposes the resources held by the subscription.</p><p>Subscriptions can also be put together, so that a call to an <code>unsubscribe()</code> of one Subscription may unsubscribe multiple Subscriptions. You can do this by âadingâ one subscription into another:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> observable1 = Rx.Observable.interval(<span class="number">300</span>)</span><br><span class="line"><span class="keyword">var</span> observable2 = Rx.Observable.interval(<span class="number">500</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> subscription = observable.subscribe(<span class="function"><span class="params">x</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'first: '</span> + x))</span><br><span class="line"><span class="keyword">var</span> childSubscription = observable2.subscribe(<span class="function"><span class="params">x</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'second: '</span> + x))</span><br><span class="line"></span><br><span class="line">subscription.ad(childSubscription)</span><br><span class="line">subscription.unsubscribe()</span><br></pre></td></tr></table></figure><h3 id="Subject"><a href="#Subject" class="headerlink" title="Subject"></a>Subject</h3><p>A RxJS Subject is a special type of Observable that allows values to multicasted to many Observers. While plain Observable are unicast(each subscribed Observer owns an independent execution of the Observable), Subjects are multicast.</p><p>A Subject is like an Observable, but can mutlicast to many Observers. Subjects are like <code>EventEmitter</code>: they maintain a registry of many listener.</p><p><code>Every Subject is an Observable</code>. Given a Subject, you can <code>subscribe</code> to it, providing an Observer, which will start receiving values normally.</p><p><code>Every Subject is an Observer</code>. It is an object with the methods <code>next()</code>, <code>error(e)</code>, and <code>complete()</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> subject = <span class="keyword">new</span> Rx.Subject()</span><br><span class="line"></span><br><span class="line">subject.subscribe(&#123;</span><br><span class="line">  next: <span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'observerA: '</span> + v)</span><br><span class="line">&#125;)</span><br><span class="line">subject.subscribe(&#123;</span><br><span class="line">  next: <span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'observerB: '</span> + v)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// as observable</span></span><br><span class="line">subject.next(<span class="number">1</span>)</span><br><span class="line">subject.next(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> observable = Rx.Observable.from([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line"><span class="comment">// as observer</span></span><br><span class="line">observable.subscribe(subject)</span><br></pre></td></tr></table></figure><h3 id="multicasted-Observables"><a href="#multicasted-Observables" class="headerlink" title="multicasted Observables"></a>multicasted Observables</h3><p>A multicasted Observable uses a Subject under the hood to make multiple Observers see the same Observable execution.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> source = Rx.Observable.from([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line"><span class="keyword">var</span> subject = <span class="keyword">new</span> Rx.Subject()</span><br><span class="line"><span class="keyword">var</span> multicasted = source.multicast(subject)</span><br><span class="line"></span><br><span class="line"><span class="comment">// There are, under the hood, `subject.subscribe(&#123;...&#125;)`</span></span><br><span class="line">multicasted.subscribe(&#123;</span><br><span class="line">  next: <span class="function"><span class="params">v</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`observerA <span class="subst">$&#123;v&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br><span class="line">multicasted.subscribe(&#123;</span><br><span class="line">  next: <span class="function"><span class="params">v</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`observerB <span class="subst">$&#123;v&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// This is, under the hood, `source.subscribe(subject)`</span></span><br><span class="line">multicasted.connect()</span><br></pre></td></tr></table></figure><p><code>multicast</code> returns an Observable that looks like a normal Observale, but works like a subject when it comes to subscribing. <code>multicast</code> returns a <code>COnnectableObservable</code>, which is simply an Observable with the <code>connect</code> method.</p><p><strong>The <code>connect</code> method is important to determine exactly when the shared Observable execution will start</strong>. Because <code>connect()</code> does <code>source.subscribe(subject)</code> under the hood, <code>connect()</code> returns a Subscription, whcih you can unsubscribe from in order to cancel the shared Observable execution.</p><h3 id="Reference-Counting"><a href="#Reference-Counting" class="headerlink" title="Reference Counting"></a>Reference Counting</h3><p>Calling <code>connect()</code> manually and handling the Subscription is often cumbersome. Ususally we want to <em>automatically</em> connect when the first Observer arrives, and automatically cancel the shared execution when the last Observer unsubscribe.</p><p>Consider the following example where subscriptions occurs as outlined by this list:</p><ol><li>First Observer subscribes to the mutlicasted Observable.</li><li><strong>The multicasted Observable is connected</strong></li><li>The <code>next</code> value 0 is delivered to the first Observable.</li><li>Second Observer subscribes to the multicasted Observable.</li><li>The <code>next</code> value 1 is delivered to the first Observer.</li><li>The <code>next</code> value 1 is delivered to the second Observer.</li><li>First Observer unsubscribes from the mutlicasted Observable.</li><li>The <code>next</code> value 2 is delivered to the second Observer.</li><li>Second Observer unsubscribes from the mutlicasted Observable.</li><li><strong>The connection to the multicasted Observable is unsubscribed</strong>.</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> source = Rx.Observable.interval(<span class="number">500</span>)</span><br><span class="line"><span class="keyword">var</span> subject = <span class="keyword">new</span> Rx.Subject()</span><br><span class="line"><span class="keyword">var</span> multicasted = source.multicast(subject)</span><br><span class="line"><span class="keyword">var</span> subscription1, subscription2, subscriptionConnect</span><br><span class="line"></span><br><span class="line">subscription1 = multicasted.subscribe(&#123;</span><br><span class="line">  next: <span class="function"><span class="params">v</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'observerA: '</span> + v)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">subscriptionConnect = multicasted.connect()</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  subscription2 = multicasted.subscribe(&#123;</span><br><span class="line">    next: <span class="function"><span class="params">v</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'observerB: '</span> + v)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;, <span class="number">600</span>)</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  subscription1.unsubscribe()</span><br><span class="line">&#125;, <span class="number">1200</span>)</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  subscription2.unsubscribe()</span><br><span class="line">  subscriptionConnect.unsubscribe()</span><br><span class="line">&#125;, <span class="number">2000</span>)</span><br></pre></td></tr></table></figure><p>If we wish to avoid explicit calls to <code>connect()</code>, we can use ConnectableObservableâs <code>refCount()</code> method(reference Counting), which returns an Observable that keeps track of how many subscribers it has. When the number of subscribers increases from 0 to 1, it will call <code>connect()</code> for us, which starts the shared execution. Only when the number of subscribers decreases from 1 to 0 will it be fully unsubscribed, stopping further execution.</p><p><code>refCount</code> makes the multicasted Observable automatically start executing when the first subscriber arrives and stop executing when the last subscriber leaves.</p><p>Below is an example:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> source = Rx.Observable.interval(<span class="number">500</span>)</span><br><span class="line"><span class="keyword">var</span> subject = <span class="keyword">new</span> Rx.Subject()</span><br><span class="line"><span class="keyword">var</span> refCounted = source.multicast(subject).refCount()</span><br><span class="line"><span class="keyword">var</span> subscription1, subscription2, subscriptionConnect</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'observerA subscribed'</span>)</span><br><span class="line">subscription1 = refCounted.subscribe(&#123;</span><br><span class="line">  next: <span class="function"><span class="params">v</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'observerA: '</span> + v)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'observerB subscribed'</span>)</span><br><span class="line">  subscription2 = refCounted.subscribe(&#123;</span><br><span class="line">    next: <span class="function"><span class="params">v</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'observerB: '</span> + v)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;, <span class="number">600</span>)</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'observerA unsubscribed'</span>)</span><br><span class="line">  subscription1.unsubscribe()</span><br><span class="line">&#125;, <span class="number">1200</span>)</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'observerB unsubscribed'</span>)</span><br><span class="line">  subscription2.unsubscribe()</span><br><span class="line">&#125;, <span class="number">2000</span>)</span><br></pre></td></tr></table></figure><p>The <code>refCount()</code> method only exists on ConnectableObservable, and it returns an <code>Observable</code>, not another ConnectableObservable.</p><h3 id="BehaviorSubject"><a href="#BehaviorSubject" class="headerlink" title="BehaviorSubject"></a>BehaviorSubject</h3><p>One of the variant of Subjects is the <code>BehaviorSubject</code>, which has a notion of âthe current valueâ. It stores the latest value emitted to its consumers, and whenever a new Observer subscribes, it will immediately receive the âcurrent valueâ from the <code>BehaviorSubject</code>.</p><p>BehaviorSubjects are useful for representing âvalues over timeâ. For instance, an event stream of birthdays is a Subject, but the stream of a personâs age would be a BehaviorSubject.</p><h3 id="ReplaySubject"><a href="#ReplaySubject" class="headerlink" title="ReplaySubject"></a>ReplaySubject</h3><p>A <code>ReplaySubject</code> is similar to a <code>BehaviorSubject</code> in that it can send old values to new subscribers, but it can also <em>record</em> a part of the Observable execution.</p><p>A <code>ReplaySubject</code> records multiple values from the Observable execution and replays them to new subscribers.</p><p>When creating a <code>ReplaySubject</code>, you can specify how many values to replay:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> subject = <span class="keyword">new</span> Rx.ReplaySubject(<span class="number">3</span>) <span class="comment">// buffer 3 values for new subscribers</span></span><br><span class="line"></span><br><span class="line">subject.subscribe(&#123;</span><br><span class="line">  next: <span class="function"><span class="params">v</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'ObserverA: '</span> + v)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">subject.next(<span class="number">1</span>)</span><br><span class="line">subject.next(<span class="number">2</span>)</span><br><span class="line">subject.next(<span class="number">3</span>)</span><br><span class="line">subject.next(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">subject.subscribe(&#123;</span><br><span class="line">  next: <span class="function"><span class="params">v</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'ObserverB: '</span> + v)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">subject.next(<span class="number">5</span>)</span><br></pre></td></tr></table></figure><p>You can also specify a <em>window time</em> in milliseconds, besides of the buffer size, to determine how old the recorded values can be.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> subject = <span class="keyword">new</span> Rx.ReplaySubject(<span class="number">3</span>, <span class="number">500</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><h3 id="AsyncSubject"><a href="#AsyncSubject" class="headerlink" title="AsyncSubject"></a>AsyncSubject</h3><p>The AsyncSubject is a variant where only the last value of the Observale execution is sent to its observers, and only when the execution completes.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> subject = <span class="keyword">new</span> Rx.AsyncSubject()</span><br><span class="line"></span><br><span class="line">subject.subscribe(&#123;</span><br><span class="line">  next: <span class="function"><span class="params">v</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'ObserverA: '</span> + v)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">subject.next(<span class="number">1</span>)</span><br><span class="line">subject.next(<span class="number">2</span>)</span><br><span class="line">subject.next(<span class="number">3</span>)</span><br><span class="line">subject.next(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">subject.subscribe(&#123;</span><br><span class="line">  next: <span class="function"><span class="params">v</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'ObserverB: '</span> + v)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">subject.next(<span class="number">5</span>)</span><br><span class="line">subject.complete()</span><br></pre></td></tr></table></figure><h3 id="Operators"><a href="#Operators" class="headerlink" title="Operators"></a>Operators</h3><p>An Operator is a function which creates a new Observable based on the current Observable. This is a pure operation: the previous Observable stays unmodified.</p><p>An Operator is essentially a pure function which takes one Observable as input and generates another Observable as output.</p><p>Subscirbing to the output Observable will also subscribe to the input Observable.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">multiplyTen</span>(<span class="params">input</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> output = Rx.Observable.create(<span class="function"><span class="keyword">function</span> <span class="title">subscribe</span>(<span class="params">observer</span>) </span>&#123;</span><br><span class="line">    input.subscribe(&#123;</span><br><span class="line">      next: <span class="function"><span class="params">v</span> =&gt;</span> observer.next(<span class="number">10</span> * v),</span><br><span class="line">      error: <span class="function"><span class="params">err</span> =&gt;</span> observer.error(err),</span><br><span class="line">      complete: <span class="function"><span class="params">()</span> =&gt;</span> observer.compelte()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> output</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> input = Rx.Observable.from([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line"><span class="keyword">var</span> output = multiplyTen(input)</span><br><span class="line">output.subscribe(<span class="function"><span class="params">x</span> =&gt;</span> <span class="built_in">console</span>.log(x))</span><br></pre></td></tr></table></figure><p>Notice that a subscribe to <code>output</code> will cause <code>input</code> Observable to be subscirbed. Itâs called <code>operator subscription chain</code>.</p><h3 id="Instance-Operators"><a href="#Instance-Operators" class="headerlink" title="Instance Operators"></a>Instance Operators</h3><p>Instance operators are methods on Observable instances.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Rx.Observable.prototype.multiplyByTen = <span class="function"><span class="keyword">function</span> <span class="title">multiplyByTen</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> input = <span class="keyword">this</span></span><br><span class="line">  <span class="keyword">return</span> Rx.Observable.create(<span class="function"><span class="keyword">function</span> <span class="title">subscirbe</span> (<span class="params">observer</span>) </span>&#123;</span><br><span class="line">    input.subscribe(&#123;</span><br><span class="line">      next: <span class="function"><span class="params">v</span> =&gt;</span> observer.next(<span class="number">10</span> * v),</span><br><span class="line">      error: <span class="function">(<span class="params">err</span>) =&gt;</span> observer.error(err),</span><br><span class="line">      complete: <span class="function"><span class="params">()</span> =&gt;</span> observer.complete(),</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> observable = Rx.Observable.from([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]).multiplyByTen()</span><br></pre></td></tr></table></figure><p>Instance operators are functions that use the <code>this</code> keyword to <code>infer</code> waht is the input Observable.</p><h3 id="Static-Operators"><a href="#Static-Operators" class="headerlink" title="Static Operators"></a>Static Operators</h3><p>Static operators are functions attached ot the Observable class directly. A static operator uses no <code>this</code> keyword internally, but instead relies entirely on its arguments.</p><p>Static Operators are usually used to create Observables from scratch.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> observable = Rx.Observable.interval(<span class="number">1000</span> <span class="comment">/* number of milliseconds */</span>)</span><br></pre></td></tr></table></figure><p>Some combination operators may be static, such as <code>merge</code>, <code>combineLatest</code>, <code>concat</code>, etc. These make sense as static operators because they take <code>multiple</code> Observables as input, not just one.</p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Http Cache: Etag, Last-Modified, Cache-Control</title>
      <link href="/2017/08/01/http-cache-Etag-Last-Modified-Cache-Control/"/>
      <content type="html"><![CDATA[<h3 id="Cache-Control"><a href="#Cache-Control" class="headerlink" title="Cache-Control"></a>Cache-Control</h3><p><code>Cache-Control</code> general-header field is used to specify deirectives that MUST be obeyed by all caching mechanisms along the request/response chain.</p><p>When the <code>Cache-Control</code> allow to cache, like <code>Cache-Control: public, max-age: 86400</code>, it means that in this day the browser can use the cahce directly without any request to server.a</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> http: <span class="string">'http'</span></span><br><span class="line"><span class="keyword">let</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.setHeader(<span class="string">'Cache-Control'</span>, <span class="string">'public'</span>, <span class="string">'max-age=86400'</span>)</span><br><span class="line">  res.end(<span class="string">'hello world'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure><h3 id="Etag"><a href="#Etag" class="headerlink" title="Etag"></a>Etag</h3><p>Used for conditional HTTP request.</p><p><code>Etag</code> represents Version of Resource, browser will add <code>If-None-Match</code> in headers with request. If the resource on server has not been modified, code 304 will be returned.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> http <span class="keyword">from</span> <span class="string">'http'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(req.url, req.headers[<span class="string">'if-none-match'</span>])</span><br><span class="line">  <span class="keyword">if</span> (req.headers[<span class="string">'if-none-match'</span>]) &#123;</span><br><span class="line">    <span class="comment">// check if resource modified</span></span><br><span class="line">    res.statusCode = <span class="number">304</span></span><br><span class="line">    res.end()</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res.setHeader(<span class="string">'Etag'</span>, <span class="string">'0000000'</span>)</span><br><span class="line">    res.end(<span class="string">'hello world'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure><h3 id="Last-Modified"><a href="#Last-Modified" class="headerlink" title="Last-Modified"></a>Last-Modified</h3><p>Similar to <code>Etag</code>, <code>Last-Modified</code> represents if the resource modified. It uses <code>time when modified</code> instead of <code>version tag</code>.</p><p>The key in header is <code>If-Modified-Since</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> http <span class="keyword">from</span> <span class="string">'http'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(req.url, req.headers[<span class="string">'if-modified-since'</span>])</span><br><span class="line">  <span class="keyword">if</span> (req.headers[<span class="string">'if-modified-since'</span>]) &#123;</span><br><span class="line">    <span class="comment">// check timestamp</span></span><br><span class="line">    res.statusCode = <span class="number">304</span></span><br><span class="line">    res.end()</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res.setHeader(<span class="string">'Last-Modified'</span>, <span class="keyword">new</span> <span class="built_in">Date</span>().toString())</span><br><span class="line">    res.end(<span class="string">'hello world'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>WS on Node</title>
      <link href="/2017/07/31/WebSocket-on-Node/"/>
      <content type="html"><![CDATA[<h3 id="Create-WS-Server"><a href="#Create-WS-Server" class="headerlink" title="Create WS Server"></a>Create WS Server</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// get WS Object</span></span><br><span class="line"><span class="keyword">const</span> WebSocket = <span class="built_in">require</span>(<span class="string">'ws'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create new Server Instance</span></span><br><span class="line"><span class="keyword">const</span> ws = <span class="keyword">new</span> WebSocket.Server(&#123;</span><br><span class="line">  port: <span class="number">80</span>, <span class="comment">// port</span></span><br><span class="line">  verifyClient: socketverify <span class="comment">// (optional)function to verify connection</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="new-WebSocket-Server-options-callback"><a href="#new-WebSocket-Server-options-callback" class="headerlink" title="new WebSocket.Server(options[, callback])"></a>new WebSocket.Server(options[, callback])</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">options: &#123;</span><br><span class="line">  host: string,</span><br><span class="line">  port: number,</span><br><span class="line">  backlog: number, // the maximum length of the queue of pending connection.</span><br><span class="line">  server: http.Server | https.Server, // a pre-created Node Http Server.</span><br><span class="line">  verifyClient: function, // a function which can be used to validate incoming connections.</span><br><span class="line">  handleProtocols: function, // a function which can be used to handle the WebSocket subprotocols.</span><br><span class="line">  path: string, // Accept only connections matching this path.</span><br><span class="line">  noServer: boolean, // Enable no server mode.</span><br><span class="line">  clientTracking: boolean, // Specifies whether or not track clients.</span><br><span class="line">  perMessageDeflate: boolean | object, // Enable/Disable permessage-deflate.</span><br><span class="line">  maxPayload: number, // Maximum allowed message size in bytes.</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Create a new server instance. One of <code>port</code>, <code>server</code>, or <code>noServer</code> must be provided or an error is thrown.</p><h3 id="Set-VerifyClient"><a href="#Set-VerifyClient" class="headerlink" title="Set VerifyClient"></a>Set VerifyClient</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">socketverify</span>(<span class="params">info</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// connect if return true</span></span><br><span class="line">  <span class="keyword">var</span> origin = info.origin.match(<span class="comment">/*...*/</span>)</span><br><span class="line">  <span class="keyword">if</span> (<span class="comment">/*...*/</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>If <code>verifyClient</code> is not set then the handshake is automatically accepted. If it is is provided with a single argument then that is:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">info: &#123;</span><br><span class="line">  origin: string, // The value in the Origin header indicated by the client.</span><br><span class="line">  req: http.incomingMessage, // The client HTTP GET request.</span><br><span class="line">  secure: boolean, // `true` is `req.connection.authorized` or `req.connection.encrypted` is set.</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>If the <code>verifyClient</code> provided with 2 arguments, the second one is <code>cb</code>, which accepts <code>result: boolean</code>, <code>code: number</code>, <code>name: string</code>.</p><h3 id="Handle-Request"><a href="#Handle-Request" class="headerlink" title="Handle Request"></a>Handle Request</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">ws.on(<span class="string">'connect'</span>, (socket) =&gt; &#123;</span><br><span class="line">  <span class="comment">// the socket is a connect to client</span></span><br><span class="line">  <span class="comment">// usually you should push it in an array for management</span></span><br><span class="line">  socket.onmessage = message</span><br><span class="line">  socket.onclose = close</span><br><span class="line">  socket.onerror = error</span><br><span class="line">  socket.onopen = open</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">message</span>(<span class="params">msg</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">error</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">close</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">open</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Events"><a href="#Events" class="headerlink" title="Events"></a>Events</h4><h3 id="Methods"><a href="#Methods" class="headerlink" title="Methods"></a>Methods</h3><h4 id="Sending-msg"><a href="#Sending-msg" class="headerlink" title="Sending msg"></a>Sending msg</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socket.send(data[, options[, callback]])</span><br></pre></td></tr></table></figure><ul><li><p>data: binary or string</p></li><li><p>options:</p><ul><li><p>mask: true | false  æ¯å¦ä½¿ç¨æ©ç </p></li><li><p>binary: true | false æ¯å¦äºè¿å¶æµ</p></li><li><p>compress: true | false æ¯å¦åç¼©</p></li></ul></li><li><p>callback: åè°</p></li></ul><h4 id="close-connection"><a href="#close-connection" class="headerlink" title="close connection"></a>close connection</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socket.close([code], [data])</span><br></pre></td></tr></table></figure><ul><li><p>code: è¿åä¸ä¸ªç¶æç </p></li><li><p>data: ç»æè¿æ¥æ¶åéçä¿¡æ¯</p></li></ul><h4 id="pause"><a href="#pause" class="headerlink" title="pause"></a>pause</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socket.pause()</span><br></pre></td></tr></table></figure><h4 id="resume"><a href="#resume" class="headerlink" title="resume"></a>resume</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socket.resume()</span><br></pre></td></tr></table></figure><h4 id="PING"><a href="#PING" class="headerlink" title="PING"></a>PING</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socket.ping([data], [options], [dontFailWhenClosed])</span><br></pre></td></tr></table></figure><ul><li><p>data: ping çæ¶ååéçä¿¡æ¯</p></li><li><p>options: å send</p></li><li><p>dontFailWhenClosed: true | false // å¦æè¿æ¥æ­å¼, æ¯å¦æåºéè¯¯</p></li></ul><h4 id="PONG"><a href="#PONG" class="headerlink" title="PONG"></a>PONG</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socket.pong([data], [options], [dontFailWhenClosed])</span><br></pre></td></tr></table></figure><p>Ping å Pong çåºå«å¨äº, ä¸ä¸ªåå« ping å¸§(0x9), ä¸ä¸ªåå« pong å¸§(0xA)</p><p>pong æ¯å¯¹äºæ¥å° ping ä¹åçååº, è®©åæ¹é½ç¥éè¿æ¥è¿å­å¨</p><h4 id="stream"><a href="#stream" class="headerlink" title="stream"></a>stream</h4><h4 id="terminate"><a href="#terminate" class="headerlink" title="terminate"></a>terminate</h4>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Short Clip of TypeScript(1)</title>
      <link href="/2017/07/31/Short-Clip-of-TypeScript(1)/"/>
      <content type="html"><![CDATA[<h3 id="Basic-Types"><a href="#Basic-Types" class="headerlink" title="Basic Types"></a>Basic Types</h3><p><code>Boolean</code>, <code>Number</code>, <code>String</code>, <code>Array</code>, <code>Tuple</code>, <code>Enum</code>, <code>Any</code>, <code>Void</code>, <code>Null</code>, <code>Undefined</code>, <code>Never</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Boolean</span></span><br><span class="line"><span class="keyword">let</span> isDone: boolean: <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Number</span></span><br><span class="line"><span class="keyword">let</span> decimal: number = <span class="number">6</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// String</span></span><br><span class="line"><span class="keyword">let</span> color: string = <span class="string">'red'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Array</span></span><br><span class="line"><span class="keyword">let</span> list: number[] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">let</span> list: <span class="built_in">Array</span>&lt;number&gt; = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// Tuple</span></span><br><span class="line"><span class="keyword">let</span> x: [string, number] = [<span class="string">'hello'</span>, <span class="number">10</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// Enum</span></span><br><span class="line">enum Color &#123;Red, Green, Blue&#125;</span><br><span class="line"><span class="keyword">let</span> c: Color = Color.Green <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Any</span></span><br><span class="line"><span class="keyword">let</span> notSure = <span class="number">5</span></span><br><span class="line">notSure = <span class="string">'not sure'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Void</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">warnUser</span> (<span class="params"></span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">  alert(<span class="string">'This is my warning message'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Never</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">error</span>(<span class="params">message: string</span>): <span class="title">never</span> </span>&#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(message)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Note:</p><blockquote><p>By default <code>null</code> and <code>undefined</code> are subtypes of all other types, that means you can assign <code>null</code> and <code>undefined</code> to something like <code>number</code></p></blockquote><blockquote><p>However, when using <code>--strictNullChecks</code> flag, <code>null</code> and <code>undefined</code> are only assignable to <code>void</code> and their respective types. This helps avoid many common errors. In cases where you want to pass in either a <code>string</code> or <code>null</code> or <code>undefined</code>, you can use the <code>union type</code> <code>string | null | undefined</code>.</p></blockquote><h3 id="Type-assertions"><a href="#Type-assertions" class="headerlink" title="Type assertions"></a>Type assertions</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> someValue = <span class="string">'this is a string'</span></span><br><span class="line"><span class="keyword">let</span> strLength: number = (<span class="xml"><span class="tag">&lt;<span class="name">string</span>&gt;</span>someValue).length</span></span><br><span class="line"><span class="xml">let strLength: number = (someValue as string).length</span></span><br></pre></td></tr></table></figure><h3 id="Variable-Declarations"><a href="#Variable-Declarations" class="headerlink" title="Variable Declarations"></a>Variable Declarations</h3><h3 id="Interfaces"><a href="#Interfaces" class="headerlink" title="Interfaces"></a>Interfaces</h3><blockquote><p>One of TypeScriptâs core principles is that type-checking focuses on the <em>shape</em> that value have. This is sometimes called âduck typingâ or âstructural subtypingâ. In TypeScript, interface fill the role of naming these types and are a powerful way of defining contracts within your code as well as contracts with code outside your project.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printLabel</span>(<span class="params">labelObj: &#123; label: string &#125;</span>) </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Or</span></span><br><span class="line">interface LabelledValue &#123;</span><br><span class="line">  label: string;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printLabel</span>(<span class="params">labelObj: LabelledValue</span>) </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Optional-Properties"><a href="#Optional-Properties" class="headerlink" title="Optional Properties"></a>Optional Properties</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">interface SquareConfig &#123;</span><br><span class="line">  color?: string;</span><br><span class="line">  width?: number;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Readonly-Properties"><a href="#Readonly-Properties" class="headerlink" title="Readonly Properties"></a>Readonly Properties</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">interface Point &#123;</span><br><span class="line">  readonly x: number;</span><br><span class="line">  readonly y: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> ro: ReadonlyArray&lt;number&gt;</span><br></pre></td></tr></table></figure><blockquote><p>Note: Readonly Array</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a: number[] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">let</span> ro: ReadonlyArray&lt;number&gt; = a</span><br><span class="line">ro[<span class="number">0</span>] = <span class="number">12</span> <span class="comment">// error</span></span><br><span class="line">ro.push(<span class="number">5</span>) <span class="comment">// error</span></span><br><span class="line">ro.legnth = <span class="number">100</span> <span class="comment">// error</span></span><br><span class="line">a = ro <span class="comment">// error</span></span><br></pre></td></tr></table></figure><p>You canât assign the entire <code>ReadonlyArray</code> back to a normal array. Instead, you could do this:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a = ro <span class="keyword">as</span> number[]</span><br></pre></td></tr></table></figure><blockquote><p>Object literals get special treatment and undergo <em>excess property checking</em> when assigning them to other variables, or <em>passing them as arguments</em>. If an object literal has any properties that the <code>target type</code> doesnât have, youâll get an error.</p></blockquote><h3 id="Adding-Index-Signature"><a href="#Adding-Index-Signature" class="headerlink" title="Adding Index Signature"></a>Adding Index Signature</h3><p>Add a string index signature if youâre sure that the object can have some extra properties that are used in some special way.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">interface SquareConfig &#123;</span><br><span class="line">  color?: string;</span><br><span class="line">  width?: number;</span><br><span class="line">  [propName: string]: any;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Function-Types"><a href="#Function-Types" class="headerlink" title="Function Types"></a>Function Types</h3><p>To describe a function type with an interface, we give the interface a <code>call signature</code>. This is like a function declaration with only the parameter list and return type given. Each parameter in the parameter list requires both name and type.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">interface SearchFunc &#123;</span><br><span class="line">  (source: string, <span class="attr">subString</span>: string): boolean;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> mySearch: SearchFunc</span><br><span class="line"></span><br><span class="line">mySearch = <span class="function"><span class="keyword">function</span> (<span class="params">source: string, subString: string</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> result = source.search(subString)</span><br><span class="line">  <span class="keyword">return</span> result &gt; <span class="number">-1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Indexable-Types"><a href="#Indexable-Types" class="headerlink" title="Indexable Types"></a>Indexable Types</h3><p>Similarly to how we can use interfaces to describe function types, we can also describe types that we can âindex intoâ like <code>a[10]</code> or <code>ageMap[&#39;daniel&#39;]</code>. Indexable types have an <em>index signature</em> that describes the types we can use to index into the object, along with the corresponding return types when indexing.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">interface StringArray &#123;</span><br><span class="line">  [index: number]: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> myArray: StringArray</span><br><span class="line">myArray = [<span class="string">'Bob'</span>, <span class="string">'Fred'</span>]</span><br><span class="line"><span class="keyword">let</span> myStr: string = myArray[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// readonly</span></span><br><span class="line">interface ReadonlyStringArray &#123;</span><br><span class="line">  readonly [index: number]: string</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Class-Types"><a href="#Class-Types" class="headerlink" title="Class Types"></a>Class Types</h3><p>Implementing an interface.</p><p>One of the most common uses of interfaces is explicitly enforcing a class meets a particular contract.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">inerface ClockInterface &#123;</span><br><span class="line">  currentTime: <span class="built_in">Date</span>;</span><br><span class="line">  setTime(d: <span class="built_in">Date</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Clock</span> <span class="title">implements</span> <span class="title">ClockInterface</span> </span>&#123;</span><br><span class="line">  currentTime: <span class="built_in">Date</span></span><br><span class="line">  setTime(d: <span class="built_in">Date</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.currentTime = d</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">constructor</span> (h: number, m: number) &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>Interface describe the public side of the class, rather than both the public and private side. This prohibits you from using them to check that a class also have particular types for the private side of the class instance.</p></blockquote><blockquote><p>Difference between the static and instance side of classes.</p></blockquote><blockquote><p>When working with classes and interfaces, it helps to keep in mind that a class <em>have two types</em>: the type of static side and the type of the instance side.</p></blockquote><blockquote><p>When a class implements an interface, only the instance side of the class is checked.</p></blockquote><blockquote><p>Notice: constructor sits in the static side, it is not included in this check.</p></blockquote><h3 id="Extending-Interfaces"><a href="#Extending-Interfaces" class="headerlink" title="Extending Interfaces"></a>Extending Interfaces</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">interface Shape &#123;</span><br><span class="line">  color: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface Square extends Shape &#123;</span><br><span class="line">  sideLength: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> square = <span class="xml"><span class="tag">&lt;<span class="name">Square</span>&gt;</span>&#123;&#125;</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">square.color = 'blue'</span></span><br><span class="line"><span class="xml">square.sideLength = 10</span></span><br></pre></td></tr></table></figure><blockquote><p>An interface can extend multiple interface, creating a combination of all of the interfaces.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">interface Shape &#123;</span><br><span class="line">  color: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface PenStroke &#123;</span><br><span class="line">  penWidth: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface Square extends Shape, PenStroke &#123;</span><br><span class="line">  sideLength: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> square = <span class="xml"><span class="tag">&lt;<span class="name">Square</span>&gt;</span>&#123;&#125;</span></span><br></pre></td></tr></table></figure><h3 id="Hybrid-Types"><a href="#Hybrid-Types" class="headerlink" title="Hybrid Types"></a>Hybrid Types</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">interface Counter &#123;</span><br><span class="line">  (start: number): string;</span><br><span class="line">  interval: number;</span><br><span class="line">  reset(): <span class="keyword">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCounter</span>(<span class="params"></span>): <span class="title">Counter</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> counter = <span class="xml"><span class="tag">&lt;<span class="name">Counter</span>&gt;</span>function (start: number)</span></span><br><span class="line"><span class="xml">  counter.interval = 123;</span></span><br><span class="line"><span class="xml">  counter.reset = function () &#123;&#125;</span></span><br><span class="line"><span class="xml">  return counter</span></span><br><span class="line"><span class="xml">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="Interface-Extending-Classes"><a href="#Interface-Extending-Classes" class="headerlink" title="Interface Extending Classes"></a>Interface Extending Classes</h3><blockquote><p>When an interface type extends a class type it inherits members of the class but not their implementations. It is as if the interface has declared all of the members of the class without providing an implementation. Interface inherits even the private and protected members of a base class. This means that when you create an interface that extends a class with private or protected members, that interface type can only be implemented by that class or a subclass of it.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Control</span> </span>&#123;</span><br><span class="line">  private state: any;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface SelectableControl extends Control &#123;</span><br><span class="line">  select(): <span class="keyword">void</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Button</span> <span class="keyword">extends</span> <span class="title">Control</span> </span>&#123;</span><br><span class="line">  select() &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Classes"><a href="#Classes" class="headerlink" title="Classes"></a>Classes</h3><p>Example:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Greeter</span> </span>&#123;</span><br><span class="line">  greeting: string;</span><br><span class="line">  <span class="keyword">constructor</span> (message: string) &#123;</span><br><span class="line">    <span class="keyword">this</span>.greeting = message;</span><br><span class="line">  &#125;</span><br><span class="line">  greet() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Hello, '</span> + <span class="keyword">this</span>.greeting;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> greeter = <span class="keyword">new</span> Greeter(<span class="string">'world'</span>)</span><br></pre></td></tr></table></figure><h4 id="Class-Inheritance"><a href="#Class-Inheritance" class="headerlink" title="Class Inheritance"></a>Class Inheritance</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  name: string;</span><br><span class="line">  <span class="keyword">constructor</span>(theName: string) &#123;</span><br><span class="line">    <span class="keyword">this</span>.name = theName</span><br><span class="line">  &#125;</span><br><span class="line">  move(distanceInMeters: number = <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span> moved <span class="subst">$&#123;distanceInMeters&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Snake</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> (name: string) &#123;</span><br><span class="line">    <span class="keyword">super</span>(name)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  move(distanceInMeters = <span class="number">5</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Slithering...'</span>)</span><br><span class="line">    <span class="keyword">super</span>.move(distanceInMeters)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hores</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> (name: string) &#123;</span><br><span class="line">    <span class="keyword">super</span>(name)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  move(distanceInMeters = <span class="number">45</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Galloping...'</span>)</span><br><span class="line">    <span class="keyword">super</span>.move(distanceInMeters)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Public-Private-Protected-Modifiers"><a href="#Public-Private-Protected-Modifiers" class="headerlink" title="Public, Private, Protected Modifiers"></a>Public, Private, Protected Modifiers</h4><blockquote><p>Public by default</p></blockquote><blockquote><p>Private: when a member is marked <code>private</code>, it cannot be accessed from outside of its containing class.</p></blockquote><blockquote><p>Protected: The protected modifier acts much like the <code>private</code> modifier with exception that members declared <code>protected</code> can also be accessed by instance of deriving classes. Namely the <code>protected</code> property can be used in instance method.</p></blockquote><h4 id="Readonly-Modifier"><a href="#Readonly-Modifier" class="headerlink" title="Readonly Modifier"></a>Readonly Modifier</h4><blockquote><p>Readonly properties must be initialized at their declaration or in the constructor.</p></blockquote><h4 id="Accessors"><a href="#Accessors" class="headerlink" title="Accessors"></a>Accessors</h4><blockquote><p>TypeScript supports getters/setters as a way of intercepting accesses to a member of an object.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line">  private _fullName: string;</span><br><span class="line">  get fullName(): string &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>._fullName;</span><br><span class="line">  &#125;</span><br><span class="line">  set fullName(newName: string) &#123;</span><br><span class="line">    <span class="keyword">this</span>._fullName = newName;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Static-Properties"><a href="#Static-Properties" class="headerlink" title="Static Properties"></a>Static Properties</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Grid</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> origin = &#123;<span class="attr">x</span>: <span class="number">0</span>, <span class="attr">y</span>: <span class="number">0</span>&#125;</span><br><span class="line">  calculateDistanceFromOrigin(point: &#123;<span class="attr">x</span>: number, <span class="attr">y</span>: number&#125;) &#123;</span><br><span class="line">    <span class="keyword">let</span> xDist = (point.x - Grid.origin.x)</span><br><span class="line">    <span class="keyword">let</span> yDist = (point.y - Grid.origin.y)</span><br><span class="line">    retrun <span class="built_in">Math</span>.sqrt(xDist * xDist + yDist * yDist) / <span class="keyword">this</span>.scale</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">constructor</span> (public scale: number) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Abstract-Classes"><a href="#Abstract-Classes" class="headerlink" title="Abstract Classes"></a>Abstract Classes</h4><blockquote><p>Abstract classes are base classes from which other classes may be derived. They may not be instantiated directly.</p></blockquote><blockquote><p>Unlike an interface, an abstract class may contain implementation detail for its members. The <code>abstract</code> keyword is used to define abstract classes as well as abstract methods within an abstract class.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">abstract <span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  abstract makeSound: <span class="keyword">void</span>;</span><br><span class="line">  move(): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'roaming the earth...'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>Methods within an abstract class that are marked as abstract do not contain an implementation and must be implemented in derived classes.</p></blockquote><blockquote><p>Abstract methods share a similar syntax to interface methods. Both define the signature of a method without including a method body.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">abstract <span class="class"><span class="keyword">class</span> <span class="title">Department</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> (public name: string) &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  printName (): <span class="keyword">void</span> &#123;</span><br><span class="line">  &#125;</span><br><span class="line">  abstract printMeetng () :<span class="keyword">void</span> <span class="comment">// must be implemented in derived classes</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AccountDepartment</span> <span class="keyword">extends</span> <span class="title">Department</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> ()&#123;</span><br><span class="line">    <span class="keyword">super</span>(<span class="string">'Accounting and Auditing'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  printMeetng (): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">  generateReports () : <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Advanced-Techniques"><a href="#Advanced-Techniques" class="headerlink" title="Advanced Techniques"></a>Advanced Techniques</h4><h5 id="Constructor-Functions"><a href="#Constructor-Functions" class="headerlink" title="Constructor Functions"></a>Constructor Functions</h5><blockquote><p>When you declare a class in TypeScript, you are actually creating multiple declarations at the same time. The first is the type of the <code>instance</code> of the class.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Greeter</span> </span>&#123;</span><br><span class="line">  greeting: string;</span><br><span class="line">  <span class="keyword">constructor</span> (message: string) &#123;</span><br><span class="line">    <span class="keyword">this</span>.greeting = message;</span><br><span class="line">  &#125;</span><br><span class="line">  greet () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Hello, '</span> + <span class="keyword">this</span>.greeting;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> greeter: Greeter;</span><br><span class="line">greeter = <span class="keyword">new</span> Greeter(<span class="string">'world'</span>)</span><br></pre></td></tr></table></figure><blockquote><p>Here when we say <code>let greeter: Greeter</code>, weâre using <code>Greeter</code> as the type of instance of the class <code>Greeter</code>. Almost we use the class constructor as a type.</p></blockquote><h5 id="Using-a-class-as-an-interface"><a href="#Using-a-class-as-an-interface" class="headerlink" title="Using a class as an interface"></a>Using a class as an interface</h5><blockquote><p>A class declaration creates two things: a type representing instances of the class, and a constructor function.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">  x: number;</span><br><span class="line">  y: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface Point3d extends Point &#123;</span><br><span class="line">  z: number;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Web App Manifest</title>
      <link href="/2017/07/29/Web-App-Manifest/"/>
      <content type="html"><![CDATA[<p>The web app manifest provides information about an application(such as <code>name</code>, <code>author</code>, <code>icon</code> and <code>description</code>) in a JSON text file. The purpose of the manifest is to install web application to the homescreen of a device, providing users with quicker access and a richer experience.</p><p>Web app manifest are part of a collection of web technologies called <code>progressive web apps</code>, which are web applications that can be installed to the homescreen of a device without needing the user to go through an app store, along with other capabilities such as being available offline and receiving push notification.</p><h3 id="Deploying-a-manifest"><a href="#Deploying-a-manifest" class="headerlink" title="Deploying a manifest"></a>Deploying a manifest</h3><p>Web app manifests are deployed in your HTML pages using a <code>link</code> tag in the head of your document.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;link ref=<span class="string">"manifest"</span> href=<span class="string">"/manifest.json"</span> /&gt;</span><br></pre></td></tr></table></figure><h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"HackerWeb"</span>,</span><br><span class="line">  <span class="attr">"short_name"</span>: <span class="string">"Hacker"</span>,</span><br><span class="line">  <span class="attr">"start_url"</span>: <span class="string">"."</span>,</span><br><span class="line">  <span class="attr">"display"</span>: <span class="string">"standalone"</span>,</span><br><span class="line">  <span class="attr">"background_color"</span>: <span class="string">"#fff"</span>,</span><br><span class="line">  <span class="attr">"description"</span>: <span class="string">"A simple readable Hacker New app."</span>,</span><br><span class="line">  <span class="attr">"icons"</span>: [&#123;</span><br><span class="line">    <span class="attr">"src"</span>: <span class="string">"images/touch/homescreen48.png"</span>,</span><br><span class="line">    <span class="attr">"sizes"</span>: <span class="string">"72x72"</span>,</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"image/png"</span></span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Cache Object</title>
      <link href="/2017/07/29/Cache-Object/"/>
      <content type="html"><![CDATA[<p>The Cache interface provides a storage mechanism for <code>Request</code> / <code>Response</code> object pairs that are cahced, for example as part of the <code>ServiceWorker</code> lifecycle. Note that the Cache Interface is exposed to windowed scopes as well as workers. You donât have to use it in conjunction with service workers, even though it is defined in the service worker spec.</p><p>An orgin can have <code>multiple Cache Objects</code>. You are responsible for implementing how your script handles <code>Cache Update</code>. Items in a Cache do not get updated unless explictly requested â they donât expires unless deleted.</p><p>Use <code>CacheStorage.open(cacheName)</code> to open a specific named cache object and then call any of the cache methods to maintain the cache.</p><blockquote><p>The caching API doesnât honor HTTP caching headers.</p></blockquote><h3 id="Methods"><a href="#Methods" class="headerlink" title="Methods"></a>Methods</h3><ul><li><p>Cache.match(request, options)</p><p>Returns a <code>Promise</code> that resolves to the response associated with the first matching request in the Cache Object.</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cache.match(request).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (response) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li><p>Cache.matchAll(request, options)</p><p>Returns a <code>Promise</code> that resolves to an array of all matching requests in the Cache Object.</p></li><li><p>Cache.add(request)</p><p>Takes a URL, retrieves it and adds the resulting response object to the given cache. This is functionally equivalent to calling <code>fetch()</code>, then using <code>Cache.put()</code> to add the results to the cache.</p></li><li><p>Cache.addAll(requests)</p><p>Takes an array of URLs, retrieves them, and adds the resulting response objects to the given cache.</p></li><li><p>Cache.put(request, response)</p><p>Takes both a request and its response and adds it to the given cache. // namely cache the Request/Response pair.</p></li><li><p>Cache.delete(request, options)</p><p>Finds the Cache entry whose key is the request, and if found, deletes the Cache entry and returns a <code>Promsie</code> that resolves to <code>true</code>. Otherwise resolve to <code>false</code>.</p></li><li><p>Cache.keys(request, options)</p><p>Returns a <code>Promise</code> that resolves to an array of <code>Cache Key</code>.</p></li></ul>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Some Concepts on BlockChain</title>
      <link href="/2017/07/25/Some-Concepts-on-BlockChain/"/>
      <content type="html"><![CDATA[<h2 id="Getting-BlockChain-Data"><a href="#Getting-BlockChain-Data" class="headerlink" title="Getting BlockChain Data:"></a>Getting BlockChain Data:</h2><ul><li><p>Blocks;</p></li><li><p>Transactions;</p></li><li><p>Sending Transactions;</p></li></ul><h2 id="Cryptocurrency-Functions"><a href="#Cryptocurrency-Functions" class="headerlink" title="Cryptocurrency Functions:"></a>Cryptocurrency Functions:</h2><ul><li><p>Generating Private/Public keys, Hashing, Address Encoding etc;</p></li><li><p>Creating transactions;</p></li><li><p>Signing transactions;</p></li><li><p>Support functions;</p></li></ul><h2 id="Build-A-Block"><a href="#Build-A-Block" class="headerlink" title="Build A Block"></a>Build A Block</h2><ul><li><p>Receive the transaction broadcase;</p></li><li><p>Verify the crypto in the transaction;</p></li><li><p>Add it to the unconfirmed Pool;</p></li><li><p>Do some hard maths on all the transactions in the pool;</p></li><li><p>Broadcast the Block to the network;</p></li><li><p>The Block is added to the blockchain;</p></li></ul><h2 id="Blockchains-as-Distributed-Database"><a href="#Blockchains-as-Distributed-Database" class="headerlink" title="Blockchains as Distributed Database"></a>Blockchains as Distributed Database</h2><ul><li><p>Everyone running the Bitcoin client is part of the network;</p></li><li><p>New blocks are boradcast to the network;</p></li><li><p>Everyone updates their local copy of the blockchain;</p></li><li><p>If youâre behind the current height of the chain, you can ask other nodes for copies of the Blocks needed to catch-up;</p></li></ul><h2 id="Implications"><a href="#Implications" class="headerlink" title="Implications:"></a>Implications:</h2><ul><li><p>Tranactions take time to âconfirmâ;</p></li><li><p>Each transaction, once itâs in an accepted block has a height;</p></li><li><p>Each increase in blockchain height is called a confirmation;</p></li><li><p>A transaction 5 blocks below the top of the chain is said to have â6 confirmationsâ;</p></li><li><p>The merchant cant decide how many confirmations is sensible to warit for;</p></li><li><p>Current default is it wait for 6 confirmations for anything of value;</p></li><li><p>Blocks store data, in Bitcoin, itâs the transactions, but it could be any digital data;</p></li><li><p>Blocks are created periodically(on average, 10mins for Bitcoin) by a process called âminingâ;</p></li><li><p>A block represents a set of events that have occurred over a particular time frame(ususally, since the previous block);</p></li><li><p>Block arenât identified by their height, but by their id; (may be multiple blocks at same height)</p></li><li><p>Block id is the hash of the metadata in the block;</p></li><li><p>Block id is a digial fingerprint of that block;</p></li><li><p>Some metadata:</p><ul><li><p>A version number of the block format;</p></li><li><p>A link to the previous block that came immediately before it;</p></li><li><p>Merkle root of all the transactions in the block;</p></li><li><p>Timestamp of when the block was created;</p></li><li><p>Mining difficulty;</p></li><li><p>Nonce for Proof-of-Work;</p></li></ul></li><li><p>All the transactions that were recorded in this block;</p></li><li><p>All the transactions in the block are used to create the Merkle Root Hash;</p></li><li><p>Itâs added to the other metadata in the header, with a nonce;</p></li><li><p>We hash the whole thing, look at the resulting hash, if it starts with a required number of leading â0â(which means the hash need to be small enough), weâve solved the block and broadcast it;</p></li><li><p>If not, we increment the nonce and try again;</p></li><li><p>Repeat until we find the leading zero;</p></li><li><p>Difficulty defines how many leading zeros when solveing the block;</p></li><li><p>The more zeros we need to find, the more attemps at hashing we need.</p></li><li><p>More hashing power becomes the driving force amongst miners;</p></li><li><p>Miner insert a special transaction at the beginning of block called âcoinbaseâ transaction. This âpaysâ the miner for the work they did, and collects the transaction fees from all the transactions;</p></li></ul><h2 id="Transactions"><a href="#Transactions" class="headerlink" title="Transactions"></a>Transactions</h2><ul><li><p>Transactions tranfer control of coins from inputs to outputs;</p></li><li><p>Control is enforced by cryptography;</p></li></ul><h2 id="Construct-A-Transaction"><a href="#Construct-A-Transaction" class="headerlink" title="Construct A Transaction"></a>Construct A Transaction</h2><ul><li><p>You need the address of the person youâre going to pay;</p></li><li><p>Find UTXOâs Unspent Transaction Outputs that exceed the amount you wish to pay;</p></li><li><p>Calculate the transaction fee(optional but recommended);</p></li><li><p>Create the outputs with the correct scriptPubKey; scriptPubKey defines who can spend the coin by specifying a small verification program that is run in order to perform that verification.</p></li><li><p>Sign the transaction details;</p></li><li><p>Broadcast the transaction, see if it works;</p></li></ul>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Some Note on Blockchain</title>
      <link href="/2017/07/22/Some-Note-on-Blockchain/"/>
      <content type="html"><![CDATA[<h2 id="Getting-BlockChain-Data"><a href="#Getting-BlockChain-Data" class="headerlink" title="Getting BlockChain Data:"></a>Getting BlockChain Data:</h2><ul><li><p>Blocks;</p></li><li><p>Transactions;</p></li><li><p>Sending Transactions;</p></li></ul><h2 id="Cryptocurrency-Functions"><a href="#Cryptocurrency-Functions" class="headerlink" title="Cryptocurrency Functions:"></a>Cryptocurrency Functions:</h2><ul><li><p>Generating Private/Public keys, Hashing, Address Encoding etc;</p></li><li><p>Creating transactions;</p></li><li><p>Signing transactions;</p></li><li><p>Support functions;</p></li></ul><h2 id="Build-A-Block"><a href="#Build-A-Block" class="headerlink" title="Build A Block"></a>Build A Block</h2><ul><li><p>Receive the transaction broadcase;</p></li><li><p>Verify the crypto in the transaction;</p></li><li><p>Add it to the unconfirmed Pool;</p></li><li><p>Do some hard maths on all the transactions in the pool;</p></li><li><p>Broadcast the Block to the network;</p></li><li><p>The Block is added to the blockchain;</p></li></ul><h2 id="Blockchains-as-Distributed-Database"><a href="#Blockchains-as-Distributed-Database" class="headerlink" title="Blockchains as Distributed Database"></a>Blockchains as Distributed Database</h2><ul><li><p>Everyone running the Bitcoin client is part of the network;</p></li><li><p>New blocks are boradcast to the network;</p></li><li><p>Everyone updates their local copy of the blockchain;</p></li><li><p>If youâre behind the current height of the chain, you can ask other nodes for copies of the Blocks needed to catch-up;</p></li></ul><h2 id="Implications"><a href="#Implications" class="headerlink" title="Implications:"></a>Implications:</h2><ul><li><p>Tranactions take time to âconfirmâ;</p></li><li><p>Each transaction, once itâs in an accepted block has a height;</p></li><li><p>Each increase in blockchain height is called a confirmation;</p></li><li><p>A transaction 5 blocks below the top of the chain is said to have â6 confirmationsâ;</p></li><li><p>The merchant cant decide how many confirmations is sensible to warit for;</p></li><li><p>Current default is it wait for 6 confirmations for anything of value;</p></li><li><p>Blocks store data, in Bitcoin, itâs the transactions, but it could be any digital data;</p></li><li><p>Blocks are created periodically(on average, 10mins for Bitcoin) by a process called âminingâ;</p></li><li><p>A block represents a set of events that have occurred over a particular time frame(ususally, since the previous block);</p></li><li><p>Block arenât identified by their height, but by their id; (may be multiple blocks at same height)</p></li><li><p>Block id is the hash of the metadata in the block;</p></li><li><p>Block id is a digial fingerprint of that block;</p></li><li><p>Some metadata:</p><ul><li><p>A version number of the block format;</p></li><li><p>A link to the previous block that came immediately before it;</p></li><li><p>Merkle root of all the transactions in the block;</p></li><li><p>Timestamp of when the block was created;</p></li><li><p>Mining difficulty;</p></li><li><p>Nonce for Proof-of-Work;</p></li></ul></li><li><p>All the transactions that were recorded in this block;</p></li><li><p>All the transactions in the block are used to create the Merkle Root Hash;</p></li><li><p>Itâs added to the other metadata in the header, with a nonce;</p></li><li><p>We hash the whole thing, look at the resulting hash, if it starts with a required number of leading â0â(which means the hash need to be small enough), weâve solved the block and broadcast it;</p></li><li><p>If not, we increment the nonce and try again;</p></li><li><p>Repeat until we find the leading zero;</p></li><li><p>Difficulty defines how many leading zeros when solveing the block;</p></li><li><p>The more zeros we need to find, the more attemps at hashing we need.</p></li><li><p>More hashing power becomes the driving force amongst miners;</p></li><li><p>Miner insert a special transaction at the beginning of block called âcoinbaseâ transaction. This âpaysâ the miner for the work they did, and collects the transaction fees from all the transactions;</p></li></ul><h2 id="Transactions"><a href="#Transactions" class="headerlink" title="Transactions"></a>Transactions</h2><ul><li><p>Transactions tranfer control of coins from inputs to outputs;</p></li><li><p>Control is enforced by cryptography;</p></li></ul><h2 id="Construct-A-Transaction"><a href="#Construct-A-Transaction" class="headerlink" title="Construct A Transaction"></a>Construct A Transaction</h2><ul><li><p>You need the address of the person youâre going to pay;</p></li><li><p>Find UTXOâs Unspent Transaction Outputs that exceed the amount you wish to pay;</p></li><li><p>Calculate the transaction fee(optional but recommended);</p></li><li><p>Create the outputs with the correct scriptPubKey; scriptPubKey defines who can spend the coin by specifying a small verification program that is run in order to perform that verification.</p></li><li><p>Sign the transaction details;</p></li><li><p>Broadcast the transaction, see if it works;</p></li></ul>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Five Models in Smart Contract</title>
      <link href="/2017/07/19/Five-Models-in-Smart-Contract/"/>
      <content type="html"><![CDATA[<h1 id="Database-Contracts"><a href="#Database-Contracts" class="headerlink" title="Database Contracts"></a>Database Contracts</h1><p>These are used only as data storage. The only logic they need is functions that allow other contracts to write, update and get data, and some simple way of checking caller permissions.</p><h1 id="Controller-Contracts"><a href="#Controller-Contracts" class="headerlink" title="Controller Contracts"></a>Controller Contracts</h1><p>These contracts operate on the storage contracts. In a flexible system, both controllers and databases can be replaced by other, similar contracts that share the same public api(although this is not always needed).) Controllers can be advanced, and could for example do batched reads/writes, or read from and write to multiple databases instead of just one.</p><h1 id="Contract-Managine-Contracts-CMCs"><a href="#Contract-Managine-Contracts-CMCs" class="headerlink" title="Contract Managine Contracts (CMCs)"></a>Contract Managine Contracts (CMCs)</h1><p>The purpose of these contracts is only to manage other contracts. Their main tasks is to keep track of all the contracts/components of the system, handle the communication between thses components, and to make modular design easier. Keeping this functionality separate from normal business logic should be considered good practice, and has a number of positive effects on the system.</p><h1 id="Application-Logic-Contracts-ALCs"><a href="#Application-Logic-Contracts-ALCs" class="headerlink" title="Application Logic Contracts (ALCs)"></a>Application Logic Contracts (ALCs)</h1><p>Application logic contracts contains application-specific code. Generally speaking, if the contract utilizes controllers and other contracts to perform application specific tasks itâs an ALC.</p><h1 id="Utility-Contracts"><a href="#Utility-Contracts" class="headerlink" title="Utility Contracts"></a>Utility Contracts</h1><p>These type of contracts usually perform a specific task, and can be called by other contracts without restrictions. It could be a contract that hashes strings using some algorithm, provide random numbers or other things. They normally donât need a log of storage, often have few or no dependencies.</p><p>The rationale for this division will be laid out after weâve tried to apply it to the fund manager system, as it will be a lot more clear then.</p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Tutorial Part 4 of Dapp</title>
      <link href="/2017/07/14/Tutorial-Part-4-of-Parity/"/>
      <content type="html"><![CDATA[<h1 id="Calling-Contracts"><a href="#Calling-Contracts" class="headerlink" title="Calling Contracts"></a>Calling Contracts</h1><p>Contract API basically comes in three pieces.</p><ul><li><p>Firstly, thereâs state-changing transaction like tranferring tokens to a counter-party.</p></li><li><p>Secondly, thereâs event reception and reporting that happen when such a state change occurs.</p></li><li><p>Finally, there is inspection of the contract state through calling <code>constant</code> function.</p></li></ul><h2 id="Our-first-contract"><a href="#Our-first-contract" class="headerlink" title="Our first contract"></a>Our first contract</h2><p>The first contract we will deal with is the global(name) registry. If you are not yet familiar, this is a registry that exists on all sensible blockchain which records fields of information for any desired name.</p><p>The registry records onwership information so that names can be registered and their information changed at a later date.</p><p>The registry contract has a fairly simple API for inspecting. We only need to worry about two functions:</p><ul><li><p><code>getOwner(bytes32) -&gt; address</code>, given the Keccak hash of name, this returns the address of its owner, if it has been reserved.</p></li><li><p><code>getData(bytes32, bytes32) -&gt; bytes32</code>, given the Keccak hash of a name and a second field key, this returns the associated data.</p></li></ul><p>There are subordinate functions to the latter such as <code>getAddress</code> and <code>getUint</code> which coerce the data into some other type. It is important to note that amongst the standardised field keys are:</p><ul><li><p><code>A</code> the <code>address</code> primarily associated with the name; if youâre wanting to send funds to the name, this is where to send them(assuming itâs not null)</p></li><li><p><code>CONTENT</code> the <code>bytes32</code> which equals the Keccak hash of any content associated with this name. e.g. If the name represents a dapp, then this would be the hash of the dappâs content.</p></li><li><p><code>IMG</code> the <code>bytes32</code> which equals the Keccak hash of an associated image; this might be a personâs avatar or the dapp icon, depending on what is being named.</p></li></ul><p>Letâs begin by displaying the address associated with the name <code>gavofyork</code>. To do this we will need to create a special <code>Bond</code>-API contract object. The function to do this is <code>bonds.makeContract</code>; It takes the address and the ABI of the contract and returns an object with <code>Bond</code> â returning functions for each of the contractâs functions.</p><p>The address is easy enough to find; this can be determined via the <code>parity.api.parity.registry</code> call. The ABI spec is rather long and can be derived from the contract code available at the ethcode/contracts repository. Since there is only a single canonical registry, Parity, conveniently constructs this for you and provides it at the <code>bonds.registry</code> object.</p><p>To figure out the primary associated address of the <code>gavofyork</code> name, we can use the <code>getAddress</code> call, together with the <code>parity.api.util.sha3</code> call to take the Keccak hash of our name. The full expression would be:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bonds.registry.getAddress(parity.api.util.sha3(<span class="string">'gavofyork'</span>))</span><br></pre></td></tr></table></figure><p>Typing <code>parity.api.util.sha3(...)</code> every time you want to look up a name in the registry gets tedious fast. Happily, Parity provides a number of derivative helper functions as part of the <code>bonds&#39;registry</code> object: <code>lookupDate</code>, <code>lookupAddress</code>, <code>lookupUint</code> and <code>lookupOwner</code>. They are all just like the <code>get-</code> prefixed brethren, but do the hashing for you. Our expression therefore can become:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bonds.registry.lookupAddress(<span class="string">'gavofyork'</span>, <span class="string">'A'</span>)</span><br></pre></td></tr></table></figure><p>Letâs get this in to our dapp, Change the <code>render()</code>ed HTML to:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">  gavofyorks address is:</span><br><span class="line">  &lt;Rspan&gt;&#123;bonds.registry.lookupAddress(<span class="string">'gavofyork'</span>, <span class="string">'A'</span>)&#125;&lt;<span class="regexp">/Rspan&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>div&gt;</span><br></pre></td></tr></table></figure><h2 id="Dynamic-lookups"><a href="#Dynamic-lookups" class="headerlink" title="Dynamic lookups"></a>Dynamic lookups</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> () &#123;</span><br><span class="line">    <span class="keyword">super</span>()</span><br><span class="line">    <span class="keyword">this</span>.bond = <span class="keyword">new</span> Bond()</span><br><span class="line">  &#125;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        Address <span class="keyword">of</span> &lt;InputBond bond=&#123;<span class="keyword">this</span>.bond&#125; placeholder=<span class="string">"Lookup a name"</span> /&gt; is:<span class="xml"><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Rspan</span>&gt;</span>&#123;bonds.registry.lookupAddress(this.bond, 'A')&#125;<span class="tag">&lt;/<span class="name">Rspan</span>&gt;</span></span></span><br><span class="line"><span class="xml">        Its balance is</span></span><br><span class="line">        &lt;Rspan&gt;</span><br><span class="line">          &#123;bonds.balance(bonds.registry.lookupAddress(this.bond, 'A')).map(formatBalance)&#125;</span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">Rspan</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Derivative-contracts"><a href="#Derivative-contracts" class="headerlink" title="Derivative contracts"></a>Derivative contracts</h2><p>Typically the registry is used to lookup the address of a second contract that you would actucally like to use.</p><p>Letâs suppose that second contract is the GithubHint contract; if youâre not already familiar, the GithubHint contract allows you to suggest which URLs might serve content for a particular hash.Itâs a semi-centralized, hacky alternative to content-addressable-delivery systems like BitTorrent/Kademlia, Swarm and IPFS. We use it widely in Parity as a means of content dissemination.</p><p>Since is a âstandardâ contract in Parity, the ABI for it is available in <code>oo7-parity</code> as <code>GitHubHintABI</code>. The address changes per chain, but can be discovered via the registry under the name âgithubhintâ. The expression would therefore be <code>bonds.registry.lookupAddress(&#39;githubhint&#39;, &#39;A&#39;)</code>.</p><p>Though we mustnât forget to import <code>GitHubHint</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; GitHubHintABI &#125; form <span class="string">'oo7-parity'</span></span><br></pre></td></tr></table></figure><p>The GithubHint contract has only a single inspection method: <code>entries</code>. This takes a <code>bytes32</code> and returns three items(via an array). There are three kinds of entry: Github repository entries, whereby the first and second items form the addresss of a particular commit of a particular repository; general URLs, where the first item is a URL and the second is the null hash; and empty entries where both items are null. The third item is always the owner (if any) of the entry and the only account capable of changing the hint information.</p><p>In this small demo, weâll assume that we are looking up only URLs and so are only interested in the first item. We therefore want an expression like:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GitHubHint.entries(hash)[<span class="number">0</span>]</span><br></pre></td></tr></table></figure><p>Where <code>hash</code> is some content hash and <code>GitHubHint</code> is the contract object.</p><p>Putting this all together we can change our dapp to:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> () &#123;</span><br><span class="line">    <span class="keyword">super</span>()</span><br><span class="line">    <span class="keyword">this</span>.bond = <span class="keyword">new</span> Bond()</span><br><span class="line">    <span class="keyword">this</span>.GitHubHint = bonds.makeContract(bonds.registry.lookupAddress(<span class="string">'githubhint'</span>, <span class="string">'A'</span>), GitHubHintABI)</span><br><span class="line">  &#125;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        URL <span class="keyword">for</span> content &lt;HashBond bond=&#123;<span class="keyword">this</span>.bond&#125; floatingLabelText=<span class="string">"Content-Hash"</span> /&gt; is:</span><br><span class="line">        &lt;Rspan&gt;&#123;<span class="keyword">this</span>.GithubHint.entries(<span class="keyword">this</span>.bond)[<span class="number">0</span>]&#125;&lt;<span class="regexp">/Rspan&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Note that we are using <code>HashBond</code> from <code>oo7-react</code> rather than <code>InputBond</code>. This just ensures that we enter only valid 32-byte hashes. Ensure that the import line is changed to:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; InputBond, HashBond &#125; <span class="keyword">from</span> <span class="string">'parity-reactive-ui'</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Tutorial Part 3 of Dapp</title>
      <link href="/2017/07/13/Tutorial-Part-3-of-Dapp/"/>
      <content type="html"><![CDATA[<h1 id="Parity-Bonds"><a href="#Parity-Bonds" class="headerlink" title="Parity Bonds"></a>Parity Bonds</h1><p>Itâs time to get down and dirty with the blockchain.</p><p>For this we will introduce the <code>oo7-parity</code> package, which provides a high-level reactive <code>Bond</code> API.</p><p>To set this up, all we need do is import <code>bonds</code> from the <code>oo7-parity</code> module, so ensure you have this at the top of your file:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; bonds &#125; <span class="keyword">from</span> <span class="string">'oo7-parity'</span></span><br></pre></td></tr></table></figure><h2 id="Watch-the-block"><a href="#Watch-the-block" class="headerlink" title="Watch the block"></a>Watch the block</h2><p>For our first task, we will introduce the simplest of all bonds: <code>bonds.height</code>. This evaluates to <code>the number of the latest block</code>, expressed as a simple number.</p><p>In <code>app.jsx</code>:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Rspan&gt;&#123;bonds.height&#125;&lt;<span class="regexp">/Rspan&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>Itâs not especially pretty so you can add some style on it.</p><p>We also provide the <code>formatBlockNumber</code> function:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> formatBlockNumber = <span class="function">(<span class="params">n</span>) =&gt;</span> <span class="string">'#'</span> + (<span class="string">''</span> + n).replace(<span class="regexp">/(\d)(?=(\d&#123;3&#125;)+$)/g</span>, <span class="string">'$1,'</span>)</span><br></pre></td></tr></table></figure><p>You can use it through</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; bonds, formatBlockNumber &#125; <span class="keyword">from</span> <span class="string">'oo7-parity'</span></span><br></pre></td></tr></table></figure><h2 id="Blocks"><a href="#Blocks" class="headerlink" title="Blocks"></a>Blocks</h2><p>The block number is great and all, but perhaps weâre more intereseted in the latest block itself. Parity can help us there with the <code>bonds.blocks</code> object. This is a lazy-evaluated âarrayâ of bonds which can subscribe to. To give yourself an idea of its capabilities, letâs try it out in the console. First we will expose the <code>bonds</code> object to the environment by adding this at the end of our obejctâs constructor:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.bonds = bonds</span><br></pre></td></tr></table></figure><p>Having reloaded, quickly open the Chrome JS console, alter the environment to 127.0.0.1 and evaluate the block at number 69 with <code>bonds.blocks[69].log()</code></p><p>Note that since itâs all asynchronous, we must use the <code>.log()</code> trick to feed the result into the console (itâs exactly equivalent to <code>.map(console.log)</code>) The result is, of course, the block object representing the 69th mined block on this chain.</p><p>Naturally, <code>bonds.blocks</code> is able to accept any number, even a bond, as its subscript. Letâs make our dapp always give us the timestamp of the latest block.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">  Latest block timestamp is:</span><br><span class="line">  &lt;Rspan&gt;&#123;bonds.blocks[bonds.blocks.height].map(<span class="function"><span class="params">b</span> =&gt;</span> b.timestamp).map(<span class="function"><span class="params">_</span> =&gt;</span> _.toString())&#125;&lt;<span class="regexp">/Rspan&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>div&gt;</span><br></pre></td></tr></table></figure><p>That map is a bit cumbersome, the <code>bond</code> API knows about subscripting, which means the <code>.timestamp</code> can be moved out of the <code>map</code></p><p>Furthermore, <code>bonds.blocks[bonds.height]</code> is a fairly common expression. So much so that it has a shorter alias: <code>bonds.head</code>, so in fact the simplest means of expressing this becomes:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; bonds.head.timestamp.map(<span class="function"><span class="params">_</span> =&gt;</span> _.toString())&#125;</span><br></pre></td></tr></table></figure><h2 id="Composing-expressions"><a href="#Composing-expressions" class="headerlink" title="Composing expressions"></a>Composing expressions</h2><p>These expressios are sometimes very useful, but often you want to do some blockchain based computation on this information.</p><p>Parity puts various means at your disposal to help you here:</p><ul><li><p><code>bonds.balance(address)</code>: evaluates to the current balanece of account at <code>address</code></p></li><li><p><code>bonds.transactionCount(address)</code>: evaluates to the current transaction count (ânonceâ) of account at <code>address</code></p></li><li><p><code>bonds.code(address)</code>: evaluates to the current âcontractâ code of account at <code>address</code></p></li><li><p><code>bonds.storageAt(address, location)</code>: evaluates to the value in storage <code>location</code> of account at <code>address</code></p></li></ul><p>Use the first one:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">  Current block authors balance is:</span><br><span class="line">  &lt;Rspan&gt;</span><br><span class="line">    &#123;bonds.balance(bonds.head.author).map(formatBalance)&#125;</span><br><span class="line">  &lt;<span class="regexp">/Rspan&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>div&gt;</span><br></pre></td></tr></table></figure><h2 id="Our-balance"><a href="#Our-balance" class="headerlink" title="Our balance"></a>Our balance</h2><p>Parity can help us get information about our own accounts in a reactive manner.</p><p>Some apis like:</p><ul><li><p><code>bonds.coinbase</code>: evaluates to the nodeâs current block authoring address.</p></li><li><p><code>bonds.accounts</code>: evaluates to the list of accounts available for the dapp to use.</p></li><li><p><code>bonds.me</code>: evaluates to the preferred account for this dapp to use. In parity, this is the account visible in the Parity Signer at the bottom right of the page.</p></li><li><p><code>bonds.accountsInfo</code>: evaluates to the mapping between dapp-visible addresses and account metadata.</p></li></ul>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Tutorial Part 2 of Dapp</title>
      <link href="/2017/07/13/Tutorial-Part2-of-Dapp/"/>
      <content type="html"><![CDATA[<h1 id="oo7-Bonds"><a href="#oo7-Bonds" class="headerlink" title="oo7 Bonds"></a>oo7 Bonds</h1><p>Now we have our basic dapp harness, we can start introducing more interesting functionality. Without too much ado, letâs get started. Head in to <code>src/client/scripts/app.jsx</code>. You will see our basic file:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;Hello World&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>This is a JSX file. Baiscally means that can handle embedded HTML when describing how React components should be rendered.</p><h2 id="Your-first-Bond"><a href="#Your-first-Bond" class="headerlink" title="Your first Bond"></a>Your first <code>Bond</code></h2><p>The first thing weâll do is introduce the <code>oo7 library</code>. This introduces into Javascript the notion of reactive value known as âbondsâ. Reactive values are similar to normal variables, except that any places in which they are used will automatically upate themselves as the value changes.</p><p>The oo7 package is still very much in development, as such there might be one or two rough edges in this tutorial.</p><p>Our first example will just demonstrate how <code>Bond</code> can introduce effortless reactivity by dynamically replicating the contents of an editable text field into a <code>&lt;span&gt;</code>.</p><p>Import the needed components by placing three lines at the top of <code>app.jsx</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Bond &#125; <span class="keyword">from</span> <span class="string">'oo7'</span></span><br><span class="line"><span class="keyword">import</span> &#123; Rspan &#125; <span class="keyword">from</span> <span class="string">'oo7-react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; InputBond &#125; <span class="keyword">from</span> <span class="string">'parity-reactive-ui'</span></span><br></pre></td></tr></table></figure><p>Next we need to introduce a new instance of a <code>Bond</code>. It will represent the current contents of a text field. We will initialize it in our classâs contructor. Insert these lines directly into the <code>App</code> class decalration.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">constructor</span> () &#123;</span><br><span class="line">  <span class="keyword">super</span> ()</span><br><span class="line">  <span class="keyword">this</span>.bond = <span class="keyword">new</span> Bond()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Your code should now look like this:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; Bond &#125; <span class="keyword">from</span> <span class="string">'oo7'</span></span><br><span class="line"><span class="keyword">import</span> &#123; Rspan &#125; <span class="keyword">from</span> <span class="string">'oo7-react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; InputBond &#125; <span class="keyword">from</span> <span class="string">'parity-reactive-ui'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> () &#123;</span><br><span class="line">    <span class="keyword">super</span> ()</span><br><span class="line">    <span class="keyword">this</span>.bond = <span class="keyword">new</span> Bond()</span><br><span class="line">  &#125;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;Hello World&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>Next we need to create the text entry field and the <code>&lt;span&gt;</code> element(in which the text fieldâs contents will be reflected). We will use a version of Semantic UIâs <code>Input</code> element which has been specially modified to propagate the value into a named <code>Bond</code>. This is called <code>InputBond</code>.</p><p>Similarly, for the <code>span</code> we will use a special âreactiveâ version of the <code>span</code> element which is able to accept <code>Bond</code>s as children and values of certain properties. This is known as <code>Rspan</code>.</p><p>Change the <code>&lt;div&gt;Hello World&lt;/div&gt;</code> line to:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">  &lt;InputBond bond=&#123;<span class="keyword">this</span>.bond&#125; placeholder=<span class="string">"Go ahead and type some text"</span> /&gt;</span><br><span class="line">  &lt;Rspan&gt;&#123;<span class="keyword">this</span>.bond&#125;&lt;<span class="regexp">/Rspan&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>div&gt;</span><br></pre></td></tr></table></figure><p>As you see thereâs not all that much here, we just tell the text field input <code>InputBond</code> to place its value into <code>this.bond</code> and conversely tell <code>Rspan</code> to display that value from <code>this.bond</code>.</p><p>Run webpack and let it watch your files to ensure your dapp is continuously rebuilt.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm start</span><br></pre></td></tr></table></figure><h2 id="Transforming-Bonds"><a href="#Transforming-Bonds" class="headerlink" title="Transforming Bonds"></a>Transforming Bonds</h2><p><code>Bond</code>s donât just have to pass on data; they can also represent transformations on the data.</p><p>One example of a transform on text would be simple upper-casing. A function to upper-case text would be <code>text =&gt; text.toUpperCase()</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Rspan&gt;&#123;<span class="keyword">this</span>.bond.map(<span class="function"><span class="params">t</span> =&gt;</span> t.toUpperCase())&#125;&lt;<span class="regexp">/Rspan&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Tutorial Part 1 of Dapp</title>
      <link href="/2017/07/13/Tutorial-Par1-of-Dapp/"/>
      <content type="html"><![CDATA[<h1 id="Spawning-a-new-Dapp"><a href="#Spawning-a-new-Dapp" class="headerlink" title="Spawning a new Dapp"></a>Spawning a new Dapp</h1><p>The dapp will use modern JS technologies: NPM, Webpack2, React, Babel, ES6, JSX and oo7.</p><p>Clone a <code>skeleton</code> repo from parity:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/paritytech/skeleton mydapp</span><br></pre></td></tr></table></figure><p>This will make your a new repo with everything ready.</p><p><code>cd</code> in to it and remove the origin repository lest it confuse Git.</p><p>Itâs liberally licensed (Apache 2.0) so you donât have to worry about open sourcing your own code(though obviously youâll be enlightened and want to do that anyway.)</p><p>The next stage is to get all dependencies installed, NPM makes this rather easy, but the bundled script makes it even easier</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./init.sh</span><br></pre></td></tr></table></figure><p>This should grab and install all that is required. The next thing to do is to build the final web-ready version of the fledling dapp. We use webpack for this.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">webpack</span><br></pre></td></tr></table></figure><p>You now have a basic dapp built.</p><h1 id="Configuring-its-look"><a href="#Configuring-its-look" class="headerlink" title="Configuring its look"></a>Configuring its look</h1><p>While your dapp may well be built, it is not yet easily discoverable. You would have to host it somewhere. This can be done traditionally with a web server but for development, we will use Parityâs in-built hosting.</p><p>Parity uses a special âmanifestâ file called to figure out how to display the entry for your dapp in Parity Wallet. This file is called <code>manifest.json</code> and must be placed in the root of your dappâs directory, in our case, thi sis our âbuildâ directory, <code>dist</code>.</p><p>Open an editor to edit <code>dist/manifest.json</code> youâll see something like:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"id"</span>: <span class="string">"skeleton"</span>,</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"Skeleton"</span>,</span><br><span class="line">  <span class="attr">"description"</span>: <span class="string">"A skeleton dapp"</span>,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"0.1"</span>,</span><br><span class="line">  <span class="attr">"author"</span>: <span class="string">"parity Technologies Ltd"</span>,</span><br><span class="line">  <span class="attr">"iconUrl"</span>: <span class="string">"title.png"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>The <code>id</code> is the dappâs unique identity: change that from <code>skeleton</code> to <code>mydapp</code></p></li><li><p>The <code>name</code> is the dappâs user-visible name: change that to <code>My Dapp</code></p></li><li><p>The <code>description</code> is a user-visible by-line describing what the dapp is good for.</p></li><li><p><code>version</code> is the dappâs version - you can leave that at <code>0.1</code> for now.</p></li><li><p>You can change the <code>author</code> to your name.</p></li><li><p>The <code>iconUrl</code> is the path(within <code>dist</code>) to a square(best to make it 128 x 128) icon for your dapp.</p></li></ul><h1 id="Getting-it-visible-in-Parity"><a href="#Getting-it-visible-in-Parity" class="headerlink" title="Getting it visible in Parity"></a>Getting it visible in Parity</h1><p>To get Parity to discover your dapp, it needs to be placed into a place that Parity will see it in its local âdappsâ directory. We will make a symbolic linke for our dappâs <code>dist</code> directory(containing all of the ready-built dapp) in Parityâs dapp directory.</p><p>Parityâs directory structure is different depending on your system.</p><p>For Mac, Parityâs local dapp directory sits at <code>$HOME/Library/Application Support/io.parity.ethereum/dapps</code></p><p>Once you have it linked, you should start(or restart, if already running) Parity and head to the Application Page of Parity Wallet. There you will see your new dapp:</p><p>Note: If you are not running <code>npm start</code> in parity/src/js to have a development instance your URL is likely <code>localhost:8180</code> instead of port 3000.</p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>D3-Scale</title>
      <link href="/2017/07/13/d3-scale/"/>
      <content type="html"><![CDATA[]]></content>
      
      
    </entry>
    
    <entry>
      <title>D3-Shape</title>
      <link href="/2017/07/12/d3-shape/"/>
      <content type="html"><![CDATA[<h3 id="d3-shape"><a href="#d3-shape" class="headerlink" title="d3.shape"></a>d3.shape</h3><p>Visualization typically consist of discrete  graphical marks, such as <code>Symbols</code>, <code>arcs</code>, <code>lines</code> and <code>areas</code>. While the ractangles of a bar chart may be easy enough to generate directly using <code>SVG</code> or <code>Canvas</code>, other shapes are complex, such as roudned annular sectors and centripetal Catmull-Rom splines. This module provides a variety of shape generators for your convenience.</p><p>As with other aspects of D3, these shapes are driven by data: each shape generator exposes accessors that control how the input data are mapped to a visual representation.</p><p>You might define a line generator for a time series by <code>scaling</code> field of your data to fit the chart.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> lineGen = d3.line()</span><br><span class="line">    .x(<span class="function"><span class="params">d</span> =&gt;</span> (d.date))</span><br><span class="line">    .y(<span class="function"><span class="params">d</span> =&gt;</span> (d.value))</span><br></pre></td></tr></table></figure><p>This line generator can then be used to compute the <code>d</code> attribute of an SVG path element:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path.datum(data).attr(<span class="string">'d'</span>, lineGen)</span><br></pre></td></tr></table></figure><p>Or you can use it to render to a Canvas 2D context:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lineGen.context(context)(data)</span><br></pre></td></tr></table></figure><h3 id="Installing"><a href="#Installing" class="headerlink" title="Installing"></a>Installing</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://d3js.org/d3-path.v1.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://d3js.org/d3-shape.v1.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>or</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add d3-shape</span><br></pre></td></tr></table></figure><h3 id="Arcs"><a href="#Arcs" class="headerlink" title="Arcs"></a>Arcs</h3><p><img src="https://raw.githubusercontent.com/d3/d3-shape/master/img/pie.png" alt=""></p><p>The arc genrateor produces a circular or annular sector, as in a pie or donut chart. If the difference between the start and end angles(the regular span) is greater than 2 <em> Math.PI, the arc generator will produce a complete circle or annulus. If it is less than 2 </em> Math.PI, arcs may have rounded corners and angular padding.</p><p>Arcs are always centered at &lt;0, 0&gt;, use a transform to move the arc to a different position.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arc = d3.arc() <span class="comment">// construct a new arc genrator with default settings.</span></span><br><span class="line"></span><br><span class="line">arc(&#123;</span><br><span class="line">  innerRadius: <span class="number">0</span>,</span><br><span class="line">  outerRadius: <span class="number">100</span>,</span><br><span class="line">  startAngle: <span class="number">0</span>,</span><br><span class="line">  endAngle: <span class="built_in">Math</span>.PI / <span class="number">2</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"><span class="keyword">const</span> arc = d3.arc()</span><br><span class="line">    .innerRadius(<span class="number">0</span>)</span><br><span class="line">    .outerRadius(<span class="number">100</span>)</span><br><span class="line">    .startAngle(<span class="number">0</span>)</span><br><span class="line">    .endAngle(<span class="built_in">Math</span>.PI/<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">arc()</span><br></pre></td></tr></table></figure><p><strong>arc.centroid(arguments)</strong> computes the midpoint &lt;x, y&gt; of the center line of the arc that would be generated by the given arguments. The arguments are arbitrary. They are simple propagated to the arc generatorâs accessor functions along with the <code>this</code> object.</p><p>To be consistent with the generated arc, the accessors must be deterministirc, i.e., return the same value given the same arguments. The midpoint is defined as (startAngle + endAngle) / 2 and (innerRadius + outerRadius) / 2</p><p><img src="https://raw.githubusercontent.com/d3/d3-shape/master/img/centroid-annular-sector.png" alt=""></p><p><strong>arc.cornerRadius([radius])</strong> sets the corner radius to the specified function or number and returns the arc generator.</p><p><img src="https://raw.githubusercontent.com/d3/d3-shape/master/img/rounded-annular-sector.png" alt=""></p><p><strong>arc.padAngle([angle])</strong> sets the pad angle to the specifid function or number and returns this arc generator. The pad angle is converted to a fixed linear distances seperateing adajacent arcs, defined as <strong>padRadius * padAngle</strong>.</p><p><strong>arc.context([context])</strong> sets the context and returns this arc generator. If <em>context</em> is not specified, returns the current context, which defaults to null. If the context is not null, then the generated arc is rendered to this context as a sequence of path method calls. Otherwise, a path data string representing the generated arc is returned.</p><h3 id="Pies"><a href="#Pies" class="headerlink" title="Pies"></a>Pies</h3><p>This pie generator does not produce a shape directly, but instead <strong>computes</strong> the necessary angles to represent a tabular dataset as a pie or donut chart. These angles can be passed to an arc generator.</p><p><strong>d3.pie()</strong> constructs a new pie generator with the default settings.</p><p><strong>pie(data[, arguments])</strong> generates a pie for the given array of data, <strong>returning an array of objects representing each datumâs arc angle</strong>. Any additional arguments are arbitrary. They are simply propagated to the pie generatorâs accessor functions along with the <code>this</code> object.</p><p>The length of the returned array is the same as data and each element <em>i</em> in the returned array corresponds to the element <em>i</em> in the input data. Each object in the returned array has the following properties:</p><ul><li><p>data: the input datum; the corresponding element in the input data array.</p></li><li><p>value: the numeric value of the arc</p></li><li><p>index: the zero-based sorted index of arc</p></li><li><p>startAgnle: the start angle of the arc</p></li><li><p>endAngle: the end angle of the arc</p></li><li><p>padAngle: the pad angle of the arc</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> data = [<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">21</span>];</span><br><span class="line"><span class="keyword">var</span> arcs = d3.pie()(data);</span><br><span class="line"><span class="comment">// to</span></span><br><span class="line">[</span><br><span class="line">  &#123;<span class="string">"data"</span>:  <span class="number">1</span>, <span class="string">"value"</span>:  <span class="number">1</span>, <span class="string">"index"</span>: <span class="number">6</span>, <span class="string">"startAngle"</span>: <span class="number">6.050474740247008</span>, <span class="string">"endAngle"</span>: <span class="number">6.166830023713296</span>, <span class="string">"padAngle"</span>: <span class="number">0</span>&#125;,</span><br><span class="line">  &#123;<span class="string">"data"</span>:  <span class="number">1</span>, <span class="string">"value"</span>:  <span class="number">1</span>, <span class="string">"index"</span>: <span class="number">7</span>, <span class="string">"startAngle"</span>: <span class="number">6.166830023713296</span>, <span class="string">"endAngle"</span>: <span class="number">6.283185307179584</span>, <span class="string">"padAngle"</span>: <span class="number">0</span>&#125;,</span><br><span class="line">  &#123;<span class="string">"data"</span>:  <span class="number">2</span>, <span class="string">"value"</span>:  <span class="number">2</span>, <span class="string">"index"</span>: <span class="number">5</span>, <span class="string">"startAngle"</span>: <span class="number">5.817764173314431</span>, <span class="string">"endAngle"</span>: <span class="number">6.050474740247008</span>, <span class="string">"padAngle"</span>: <span class="number">0</span>&#125;,</span><br><span class="line">  &#123;<span class="string">"data"</span>:  <span class="number">3</span>, <span class="string">"value"</span>:  <span class="number">3</span>, <span class="string">"index"</span>: <span class="number">4</span>, <span class="string">"startAngle"</span>: <span class="number">5.468698322915565</span>, <span class="string">"endAngle"</span>: <span class="number">5.817764173314431</span>, <span class="string">"padAngle"</span>: <span class="number">0</span>&#125;,</span><br><span class="line">  &#123;<span class="string">"data"</span>:  <span class="number">5</span>, <span class="string">"value"</span>:  <span class="number">5</span>, <span class="string">"index"</span>: <span class="number">3</span>, <span class="string">"startAngle"</span>: <span class="number">4.886921905584122</span>, <span class="string">"endAngle"</span>: <span class="number">5.468698322915565</span>, <span class="string">"padAngle"</span>: <span class="number">0</span>&#125;,</span><br><span class="line">  &#123;<span class="string">"data"</span>:  <span class="number">8</span>, <span class="string">"value"</span>:  <span class="number">8</span>, <span class="string">"index"</span>: <span class="number">2</span>, <span class="string">"startAngle"</span>: <span class="number">3.956079637853813</span>, <span class="string">"endAngle"</span>: <span class="number">4.886921905584122</span>, <span class="string">"padAngle"</span>: <span class="number">0</span>&#125;,</span><br><span class="line">  &#123;<span class="string">"data"</span>: <span class="number">13</span>, <span class="string">"value"</span>: <span class="number">13</span>, <span class="string">"index"</span>: <span class="number">1</span>, <span class="string">"startAngle"</span>: <span class="number">2.443460952792061</span>, <span class="string">"endAngle"</span>: <span class="number">3.956079637853813</span>, <span class="string">"padAngle"</span>: <span class="number">0</span>&#125;,</span><br><span class="line">  &#123;<span class="string">"data"</span>: <span class="number">21</span>, <span class="string">"value"</span>: <span class="number">21</span>, <span class="string">"index"</span>: <span class="number">0</span>, <span class="string">"startAngle"</span>: <span class="number">0.000000000000000</span>, <span class="string">"endAngle"</span>: <span class="number">2.443460952792061</span>, <span class="string">"padAngle"</span>: <span class="number">0</span>&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>The first pair of parens, <code>pie()</code> constructs a default pie generator, the second <code>pie()(data)</code> invokes this generator on the dataset, returning an array of objects.</p><p>Note that the returned array is in the same order as the data.</p><h3 id="Lines"><a href="#Lines" class="headerlink" title="Lines"></a>Lines</h3><p>The line generator produces a spline or polyline, as in a line chart. Lines also appear in many other visualization types, such as the links in hierarchical edge bundling.</p><p><strong>d3.line()</strong> constructs a new line generator with default settings.</p><p><strong>line(data)</strong> generates a line for the given array of data. Depending on this line generatorâs assciated curve, the given input data may need to be sorted by x-value before being passed to the line generator. If the line generator has a context, then the line is rendered to this context as a sequence of path method calls and this function returns void.</p><p><strong>line.x(fn)</strong> specifies the x accessor.</p><p><strong>line.y(fn)</strong> specifies the y accessor.</p><p><strong>line.defined([defined])</strong> sets the defined accessor.</p><p><img src="https://raw.githubusercontent.com/d3/d3-shape/master/img/line-defined.png" alt=""></p><p><strong>line.curve([curve])</strong> sets the curve factory and returns this line genrator. If curve is not specified, returns the current curve factory, which defaults to <strong>curveLinear</strong>.</p><p><strong>d3.lineRadial()</strong> constructs a new radial line generator with the default settings.</p><p><img src="https://raw.githubusercontent.com/d3/d3-shape/master/img/line-radial.png" alt=""></p><p>A radial line generator is equivalent to the standard cartesian line generator, except the x and y accessor are replaced with angle and readius accessors.</p><p>Radial lines are always positioned relative to &lt;0, 0&gt;, use a transform to change the origin.</p><h3 id="Areas"><a href="#Areas" class="headerlink" title="Areas"></a>Areas</h3><p>The area generator produces an area, as in an area chart. An area is defined by two bounding lines, either splines or polilines. Typically two lines share the same x-value, differing only in y-value; most commonly, y0 is defined as a constant representing zero.  The first line (the top line) is defined by x1 and y1 and is rendered first; the second line (the base line) is defined by x0 and y0 and is rendered second, with the points in reverse order.</p><p><strong>d3.area()</strong> constructs a new area generator with the default settings.</p><p><strong>area.data()</strong> generats area for the given array of data. Depending on this area generatorâs associated curve.</p><p><strong>area.x([x])</strong> sets x0 to x and x1 to null.</p><p><strong>area.x0()</strong> sets the x0 accessor.</p><p><strong>area.defined()</strong></p><p><strong>d3.areaRadial()</strong></p><p><img src="https://raw.githubusercontent.com/d3/d3-shape/master/img/area-radial.png" alt=""></p><h3 id="Curves"><a href="#Curves" class="headerlink" title="Curves"></a>Curves</h3><p>Curves are typically not constructed or used directly, insread being passed to <code>line.curve</code> and <code>arec.curve</code>. For example:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> line = d3.line()</span><br><span class="line">  .x(<span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> x(d.date) &#125;)</span><br><span class="line">  .y(<span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> y(d.value) &#125;)</span><br><span class="line">  .curve(d3.curveCatmullRom.alpha(<span class="number">0.5</span>))</span><br></pre></td></tr></table></figure><ul><li><p>d3.curveBasis(context)</p></li><li><p>d3.curveBasisClosed(context)</p></li><li><p>d3.curveBasisOpen(context)</p></li><li><p>d3.curveBundle(context)</p></li><li><p>d3.curveCardinal(context)</p></li><li><p>d3.curveCardinalClosed(context)</p></li><li><p>d3.curveLinear(context)</p></li><li><p>d3.curveStep(context)</p></li><li><p>d3.curveStepAfter(context)</p></li><li><p>d3.curveStepBefore(context)</p></li></ul><h3 id="Links"><a href="#Links" class="headerlink" title="Links"></a>Links</h3><p>The link shape generates a smooth cubic Bezier curve from a source point to a target point. The tangents of the curve at the start and end are either <code>vertical</code>, <code>horizontal</code>, or <code>radial</code>.</p><p><strong>d3.linkVertical()</strong>, returns a new link generator with vertical tangents.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> link = d3.linkVertical()</span><br><span class="line">    .x(<span class="function"><span class="keyword">function</span>(<span class="params">d</span>)</span>&#123; <span class="keyword">return</span> d.x &#125;)</span><br><span class="line">    .y(<span class="function"><span class="keyword">function</span>(<span class="params">d</span>)</span>&#123; <span class="keyword">return</span> d.y &#125;)</span><br></pre></td></tr></table></figure><p><strong>d3.linkHorizontal()</strong>, returns a new link generator with horizontal tangents.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> link = d3.linkHorizontal()</span><br><span class="line">    .x(<span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.y &#125;)</span><br><span class="line">    .y(<span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.x &#125;)</span><br></pre></td></tr></table></figure><h3 id="Stacks"><a href="#Stacks" class="headerlink" title="Stacks"></a>Stacks</h3><p>Some shape types can be stakced, placing one shape adjacent to another.</p><p>Stacked charts can show overall value and per-category value simultaneously.</p><p><strong>d3.stack()</strong>, constructs a new stack generator with the default settings.</p><p><strong>stack(data[, arguments])</strong>, generates a stack for the given array of data, returning an array of representing each series. Any additional arguments are arbitrary, they are simply propagated to accessors along with <code>this</code> object.</p><p>The series are determined by the keys accessor; each series <em>i</em> in the returned array corresponds to the <em>i</em> th key. Each series is an array o points, where each point <em>j</em> corresponds to the <em>j</em> th element in the input <em>data</em>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> data = [</span><br><span class="line">  &#123;<span class="attr">month</span>: <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">2015</span>, <span class="number">0</span>, <span class="number">1</span>), <span class="attr">apples</span>: <span class="number">3840</span>, <span class="attr">bananas</span>: <span class="number">1920</span>, <span class="attr">cherries</span>: <span class="number">960</span>, <span class="attr">dates</span>: <span class="number">400</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">month</span>: <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">2015</span>, <span class="number">1</span>, <span class="number">1</span>), <span class="attr">apples</span>: <span class="number">1600</span>, <span class="attr">bananas</span>: <span class="number">1440</span>, <span class="attr">cherries</span>: <span class="number">960</span>, <span class="attr">dates</span>: <span class="number">400</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">month</span>: <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">2015</span>, <span class="number">2</span>, <span class="number">1</span>), <span class="attr">apples</span>:  <span class="number">640</span>, <span class="attr">bananas</span>:  <span class="number">960</span>, <span class="attr">cherries</span>: <span class="number">640</span>, <span class="attr">dates</span>: <span class="number">400</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">month</span>: <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">2015</span>, <span class="number">3</span>, <span class="number">1</span>), <span class="attr">apples</span>:  <span class="number">320</span>, <span class="attr">bananas</span>:  <span class="number">480</span>, <span class="attr">cherries</span>: <span class="number">640</span>, <span class="attr">dates</span>: <span class="number">400</span>&#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">// To produce a stack of this data</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> stack = d3.stack()</span><br><span class="line">    .keys([ <span class="string">'apples'</span>, <span class="string">'bananas'</span>, <span class="string">'cherries'</span>, <span class="string">'dates'</span> ])</span><br><span class="line">    .order(d3.stackOrderNone)</span><br><span class="line">    .offset(d3.stackOffsetNone)</span><br><span class="line"></span><br><span class="line"><span class="comment">// returned</span></span><br><span class="line"></span><br><span class="line">[</span><br><span class="line">  [[   <span class="number">0</span>, <span class="number">3840</span>], [   <span class="number">0</span>, <span class="number">1600</span>], [   <span class="number">0</span>,  <span class="number">640</span>], [   <span class="number">0</span>,  <span class="number">320</span>]], <span class="comment">// apples</span></span><br><span class="line">  [[<span class="number">3840</span>, <span class="number">5760</span>], [<span class="number">1600</span>, <span class="number">3040</span>], [ <span class="number">640</span>, <span class="number">1600</span>], [ <span class="number">320</span>,  <span class="number">800</span>]], <span class="comment">// bananas</span></span><br><span class="line">  [[<span class="number">5760</span>, <span class="number">6720</span>], [<span class="number">3040</span>, <span class="number">4000</span>], [<span class="number">1600</span>, <span class="number">2240</span>], [ <span class="number">800</span>, <span class="number">1440</span>]], <span class="comment">// cherries</span></span><br><span class="line">  [[<span class="number">6720</span>, <span class="number">7120</span>], [<span class="number">4000</span>, <span class="number">4400</span>], [<span class="number">2240</span>, <span class="number">2640</span>], [<span class="number">1440</span>, <span class="number">1840</span>]], <span class="comment">// dates</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><p><strong>stack.keys([keys])</strong>, sets the keys accessor to the specified function or array and returns this stack generator.</p><p><strong>stack.order([order])</strong>, sets the order accessor to the specified functino or array and returns this stack generator. If order is not specified, returns the current order accessor, which default to <code>stackOrderNone</code>, this uses the order given by the key accessor.</p><ul><li><p>d3.stackOrderAscending(series)</p></li><li><p>d3.stackOrderDescending(series)</p></li><li><p>d3.stackOrderInsideOut(series)</p></li><li><p>d3.stackOrderNone(series)</p></li><li><p>d3.stackOrderReverse(series)</p></li></ul><p><strong>stack.offset([offest])</strong>, sets the offset accessor to the specified function or array, and returns this stack generator. If no offset is specified, returns the current offset accessor, which default to <code>stackOffsetNone</code>, this uses a zero baseline.</p><ul><li><p>d3.stackOffsetDiverging(series, order)</p></li><li><p>d3.stackOffsetExpand(series, order)</p></li><li><p>d3.stackOffsetNone(series, order)</p></li></ul>]]></content>
      
      
    </entry>
    
    <entry>
      <title>d3.range</title>
      <link href="/2017/07/12/d3-range/"/>
      <content type="html"><![CDATA[<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d3.range([start, ]stop[, step])</span><br></pre></td></tr></table></figure><p>Returns an array containing an arithmetic progression, similar to the Python built-in range. This method is often used to iterate over a sequence of uniformly-spaced numeric values, such as the indexes of an array or the ticks of a linear scale.</p><p>If <em>step</em> is ommitted, it defaults to 1. If <em>start</em> ommitted, it defaults to 0. The <em>stop</em> value is exclusive; it is not included in the result.</p><p>The arguments are not required to be integers; however, the results are more predicable if they are.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">d3.range(<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>/<span class="number">49</span>) <span class="comment">// BAD, and returns 50 elements</span></span><br><span class="line">d3.range(<span class="number">49</span>).map(<span class="function"><span class="params">d</span> =&gt;</span> (d/<span class="number">49</span>)) <span class="comment">// GOOD, and returns 49 elements</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Quick Reference of D3</title>
      <link href="/2017/07/11/Quick-Reference-of-D3/"/>
      <content type="html"><![CDATA[<h1 id="Selections"><a href="#Selections" class="headerlink" title="Selections"></a>Selections</h1><h3 id="d3-select"><a href="#d3-select" class="headerlink" title="d3.select()"></a>d3.select()</h3><p>Returns a reference to the first element found.</p><h3 id="d3-selectAll"><a href="#d3-selectAll" class="headerlink" title="d3.selectAll()"></a>d3.selectAll()</h3><p>Returns references to all found elements</p><h3 id="selection-append"><a href="#selection-append" class="headerlink" title="selection.append()"></a>selection.append()</h3><p>Takes a selection, creates a new element inside of it, then returns a reference to the newly created element.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> newCirlce = svg.append(<span class="string">'circle'</span>)</span><br></pre></td></tr></table></figure><h3 id="selection-remove"><a href="#selection-remove" class="headerlink" title="selection.remove()"></a>selection.remove()</h3><p>Takes a selection, removes it from the DOM, and returns a reference to the deleted selection.</p><h3 id="selection-text"><a href="#selection-text" class="headerlink" title="selection.text()"></a>selection.text()</h3><p>Takes a selection, sets its text content, and returns a reference to the acted-upon selection.</p><h3 id="selection-attr"><a href="#selection-attr" class="headerlink" title="selection.attr()"></a>selection.attr()</h3><p>Takes a selection, sets an attribute value, and returns a reference to the acted-upon selection.</p><h3 id="selection-style"><a href="#selection-style" class="headerlink" title="selection.style()"></a>selection.style()</h3><p>Takes a selection, sets an inline CSS style, and returns a reference to the acted-upon selection.</p><h3 id="selection-classed"><a href="#selection-classed" class="headerlink" title="selection.classed()"></a>selection.classed()</h3><p>Takes a selection, adds or remove a class, and returns a reference to the acted-upon selection; <code>true</code> adds the specified class, <code>false</code> removes it.</p><h3 id="selection-each"><a href="#selection-each" class="headerlink" title="selection.each()"></a>selection.each()</h3><p>Takes a selection, and runs an arbitrary function for each element in the selection, with the <code>this</code> context set to the element being acted upon.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d3.selectAll(<span class="string">'circle'</span>).each(zoomAndEnhance)</span><br></pre></td></tr></table></figure><h1 id="Data"><a href="#Data" class="headerlink" title="Data"></a>Data</h1><h3 id="selection-data"><a href="#selection-data" class="headerlink" title="selection.data()"></a>selection.data()</h3><p>Takes a selection, calculates the difference between the number of elements and number of data value, and binds the array of data value to any existing elements(or not existing placeholder elements).</p><h3 id="selection-datum"><a href="#selection-datum" class="headerlink" title="selection.datum()"></a>selection.datum()</h3><p>Takes a selection, and binds a single data value to a single element.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svg.append(<span class="string">'path'</span>).datum(dataset).attr(<span class="string">'d'</span>, line)</span><br></pre></td></tr></table></figure><h3 id="selection-enter"><a href="#selection-enter" class="headerlink" title="selection.enter()"></a>selection.enter()</h3><p>Takes a selection and returns a subselection of ânewâ placeholder elements.</p><h3 id="selection-merge"><a href="#selection-merge" class="headerlink" title="selection.merge()"></a>selection.merge()</h3><p>Takes a selection and merges it with another specified selection, returning a newly merged selection.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bars.enter().append(<span class="string">'rect'</span>).merge(bars) <span class="comment">// merge enter subselection with existing selection.</span></span><br></pre></td></tr></table></figure><h3 id="selection-exit"><a href="#selection-exit" class="headerlink" title="selection.exit()"></a>selection.exit()</h3><p>Takes a selection and returns a subselection of âexitingâ elements.</p><h3 id="selection-remove-1"><a href="#selection-remove-1" class="headerlink" title="selection.remove()"></a>selection.remove()</h3><p>Takes a selection and removes associated elements from the DOM.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bars.exit().remove()</span><br></pre></td></tr></table></figure><h3 id="function-d-â¦"><a href="#function-d-â¦" class="headerlink" title="function (d) { â¦ }"></a>function (d) { â¦ }</h3><p>Use anonymouse functions to access data values bound to element via <code>d</code>.</p><h3 id="function-d-i-â¦"><a href="#function-d-i-â¦" class="headerlink" title="function (d, i) { â¦ }"></a>function (d, i) { â¦ }</h3><p>Including <code>i</code> to get the index value of each element in the selection.</p><h3 id="selection-fitler"><a href="#selection-fitler" class="headerlink" title="selection.fitler()"></a>selection.fitler()</h3><p>Takes a selection and returns a new (sub)selection</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">d3.selectAll(<span class="string">'circle'</span>)</span><br><span class="line">  .filter(<span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> d &gt; <span class="number">15</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .style(<span class="string">'color'</span>, <span class="string">'red'</span>)</span><br></pre></td></tr></table></figure><h3 id="d3-csv"><a href="#d3-csv" class="headerlink" title="d3.csv()"></a>d3.csv()</h3><p>Loads an external CSV file, parses the contents into JSON, then hands off the results to a callback function.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">d3.csv(<span class="string">'food.csv'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="d3-json"><a href="#d3-json" class="headerlink" title="d3.json()"></a>d3.json()</h3><p>Loads an external JSON file, parse the content into JSON, then hands off the results to a callback function.</p><h3 id="d3-request"><a href="#d3-request" class="headerlink" title="d3.request()"></a>d3.request()</h3><p>Loads an arbitrary external file, then hands off the result to a callback function.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">d3.request(<span class="string">'interesting_data.txt'</span>)</span><br><span class="line">  .get(<span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Do something</span></span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><h1 id="Transitions"><a href="#Transitions" class="headerlink" title="Transitions"></a>Transitions</h1><h3 id="selection-transition"><a href="#selection-transition" class="headerlink" title="selection.transition()"></a>selection.transition()</h3><p>Takes a selection, and initiates a new transition, so values specified after this point will be interpolated over time(rather than set immediately).</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">d3.selectAll(<span class="string">'circle'</span>)</span><br><span class="line">  .attr(<span class="string">'cx'</span>, <span class="number">0</span>)</span><br><span class="line">  .transition()</span><br><span class="line">  .attr(<span class="string">'cx'</span>, <span class="number">100</span>)</span><br></pre></td></tr></table></figure><h3 id="selection-delay"><a href="#selection-delay" class="headerlink" title="selection.delay()"></a>selection.delay()</h3><p>Takes a transition, and sets the delay, in milliseconds.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">d3.selectAll(<span class="string">'circle'</span>)</span><br><span class="line">  .attr(<span class="string">'cx'</span>, <span class="number">0</span>)</span><br><span class="line">  .transition()</span><br><span class="line">  .delay(<span class="number">1000</span>)</span><br><span class="line">  .attr(<span class="string">'cx'</span>, <span class="number">100</span>)</span><br></pre></td></tr></table></figure><h3 id="transition-duration"><a href="#transition-duration" class="headerlink" title="transition.duration()"></a>transition.duration()</h3><p>Takes a transition and sets the duration in milliseconds.</p><h3 id="transition-ease"><a href="#transition-ease" class="headerlink" title="transition.ease()"></a>transition.ease()</h3><p>Takes a transition and sets the easing to be used.</p><h3 id="transition-on"><a href="#transition-on" class="headerlink" title="transition.on()"></a>transition.on()</h3><p>Takes a transition, and binds a function to be executed at either the <code>start</code> or <code>end</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">d3.selectAll(<span class="string">'circle'</span>)</span><br><span class="line">  .attr(<span class="string">'cx'</span>, <span class="number">0</span>)</span><br><span class="line">  .transition()</span><br><span class="line">  .attr(<span class="string">'cx'</span>, <span class="number">100</span>)</span><br><span class="line">  .on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'All done'</span>)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><h1 id="Scale"><a href="#Scale" class="headerlink" title="Scale"></a>Scale</h1><h3 id="d3-scaleLinear"><a href="#d3-scaleLinear" class="headerlink" title="d3.scaleLinear()"></a>d3.scaleLinear()</h3><p>Creates a new linear scale function.</p><h3 id="scaleLinear-domain"><a href="#scaleLinear-domain" class="headerlink" title="scaleLinear.domain()"></a>scaleLinear.domain()</h3><p>Sets a linear scaleâs input domain.</p><h3 id="scaleLinear-range"><a href="#scaleLinear-range" class="headerlink" title="scaleLinear.range()"></a>scaleLinear.range()</h3><p>Sets a linear scaleâs output range.</p><h3 id="scaleLinear-rangeRound"><a href="#scaleLinear-rangeRound" class="headerlink" title="scaleLinear.rangeRound()"></a>scaleLinear.rangeRound()</h3><p>Sets a linear scaleâs output range, and have all values output by the scale rounded to the nearest whole number.</p><h3 id="scaleLinear-nice"><a href="#scaleLinear-nice" class="headerlink" title="scaleLinear.nice()"></a>scaleLinear.nice()</h3><p>Expands a linear sclaeâs domain to the nearest round values.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xScale.nice()</span><br></pre></td></tr></table></figure><h3 id="scaleLinear-clamp"><a href="#scaleLinear-clamp" class="headerlink" title="scaleLinear.clamp()"></a>scaleLinear.clamp()</h3><p>Forces any values output by this scale to be constrainted (rounded to be) within the specified range.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xScale.clamp(<span class="literal">true</span>)</span><br></pre></td></tr></table></figure><h3 id="d3-min"><a href="#d3-min" class="headerlink" title="d3.min()"></a>d3.min()</h3><p>Returns the smallest value in an array.</p><h3 id="d3-max"><a href="#d3-max" class="headerlink" title="d3.max()"></a>d3.max()</h3><p>Returns the largest value in an array.</p><h1 id="Axes"><a href="#Axes" class="headerlink" title="Axes"></a>Axes</h1><h3 id="d3-axisTop-d3-axisRight-d3-axisBottom-d3-axisLeft"><a href="#d3-axisTop-d3-axisRight-d3-axisBottom-d3-axisLeft" class="headerlink" title="d3.axisTop, d3.axisRight, d3.axisBottom, d3.axisLeft"></a>d3.axisTop, d3.axisRight, d3.axisBottom, d3.axisLeft</h3><p>Create a new axis generator function, with specified orientation.</p><h3 id="axis-scale"><a href="#axis-scale" class="headerlink" title="axis.scale()"></a>axis.scale()</h3><p>Takes an axis, and specifies the scale to be used.</p><h3 id="axis-ticks"><a href="#axis-ticks" class="headerlink" title="axis.ticks()"></a>axis.ticks()</h3><p>Takes an axis, and specifies a target number of ticks to be used.</p><h3 id="axis-tickValues"><a href="#axis-tickValues" class="headerlink" title="axis.tickValues()"></a>axis.tickValues()</h3><p>Takes an axis, and specifies the values to be labeled with ticks.</p><h3 id="selection-call"><a href="#selection-call" class="headerlink" title="selection.call()"></a>selection.call()</h3><p>Takes a selection, and calls an arbitrary method to act upon the selection; commonly used to generate an axis.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svg.append(<span class="string">'g'</span>).call(xAxis)</span><br></pre></td></tr></table></figure><h1 id="Interactivity"><a href="#Interactivity" class="headerlink" title="Interactivity"></a>Interactivity</h1><h3 id="selection-on"><a href="#selection-on" class="headerlink" title="selection.on()"></a>selection.on()</h3><p>Takes a selection, and binds an event listener</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">d3.select(<span class="string">'#button'</span>)</span><br><span class="line">  .on(<span class="string">'click'</span>, () =&gt; &#123; ... &#125;)</span><br></pre></td></tr></table></figure><h3 id="d3-select-this"><a href="#d3-select-this" class="headerlink" title="d3.select(this)"></a>d3.select(this)</h3><p>Within an anonymous function, <code>this</code> refers to <code>the element current being acted upon</code></p><h1 id="Numebrs-Dates-and-Times"><a href="#Numebrs-Dates-and-Times" class="headerlink" title="Numebrs, Dates, and Times"></a>Numebrs, Dates, and Times</h1><h3 id="d3-range"><a href="#d3-range" class="headerlink" title="d3.range()"></a>d3.range()</h3><p>Generates an array of sequential numbers.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d3.range(<span class="number">5</span>); <span class="comment">// Returns [0, 1, 2, 3, 4]</span></span><br></pre></td></tr></table></figure><h3 id="d3-format"><a href="#d3-format" class="headerlink" title="d3.format()"></a>d3.format()</h3><p>Creates a new number formatter, for convertiing numbers to strings.</p><h3 id="d3-timeParse"><a href="#d3-timeParse" class="headerlink" title="d3.timeParse()"></a>d3.timeParse()</h3><p>Creates a new time parser, for converting strings to Date Object.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> parseTime = d3.timeParse(<span class="string">"%m/%d/%y"</span>)</span><br><span class="line">parseTime(<span class="string">'02/20/17'</span>)</span><br></pre></td></tr></table></figure><h3 id="d3-timeFormat"><a href="#d3-timeFormat" class="headerlink" title="d3.timeFormat()"></a>d3.timeFormat()</h3><p>Creates a new time formatter, for converting Data Object to strings.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> formatTime = d3.timeFormat(<span class="string">"%b %e"</span>)</span><br><span class="line">formatTime(<span class="keyword">new</span> <span class="built_in">Date</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Simple Api of Mongoose</title>
      <link href="/2017/07/10/Simple-Api-of-Mongoose/"/>
      <content type="html"><![CDATA[<h3 id="Two-methods-to-connect-to-Mongo-DB"><a href="#Two-methods-to-connect-to-Mongo-DB" class="headerlink" title="Two methods to connect to Mongo DB"></a>Two methods to connect to Mongo DB</h3><ul><li><p><code>mongoose.connect</code></p></li><li><p><code>mongoose.createConnection</code></p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> dbURL = <span class="string">'mongodb://...'</span></span><br><span class="line"><span class="keyword">const</span> dbOptions = &#123;</span><br><span class="line">  user: <span class="string">'db_user'</span>,</span><br><span class="line">  pass: <span class="string">'db_pass'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> adminConnection = mongoose.createConnection(dbURL, dbOptions)</span><br></pre></td></tr></table></figure><h3 id="Close-Connection"><a href="#Close-Connection" class="headerlink" title="Close Connection"></a>Close Connection</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mongoose.connection.close(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Connection cvlosed'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">adminConnection.close(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'adminConnection closed'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// auto close when process exit</span></span><br><span class="line">process..on(<span class="string">'SIGINT'</span> () =&gt; &#123;</span><br><span class="line">  mongoose.connection.close(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Mongoose disconnected through app termination'</span>)</span><br><span class="line">    process.exit(<span class="number">0</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Cache-Error"><a href="#Cache-Error" class="headerlink" title="Cache Error"></a>Cache Error</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mongoose.connection.on(<span class="string">'error'</span>, (err) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Mongoose connection error: '</span> + err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="db-js"><a href="#db-js" class="headerlink" title="db.js"></a>db.js</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// /model/db.js</span></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dbURL = <span class="string">'mongodb://...'</span></span><br><span class="line"></span><br><span class="line">mongoose.connect(dbURL)</span><br><span class="line"></span><br><span class="line">mongoose.connection.on(<span class="string">'connected'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Mongoose connected to '</span> + dbURL)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">mongoose.connection.on(<span class="string">'error'</span>, (err) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Mongoose connection error: '</span> + err)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">mongoose.connection.on(<span class="string">'disconnected'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Mongoose disconnected'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">process.on(<span class="string">'SIGINT'</span>, () =&gt; &#123;</span><br><span class="line">  mongoose.connection.close(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Mongoose disconnected through app termination'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// app.js</span></span><br><span class="line">db = <span class="built_in">require</span>(<span class="string">'./model/db'</span>)</span><br></pre></td></tr></table></figure><h2 id="Schema-and-Model-in-Mongoose"><a href="#Schema-and-Model-in-Mongoose" class="headerlink" title="Schema and Model in Mongoose"></a>Schema and Model in Mongoose</h2><blockquote><p>Everything in Mongoose starts with a Schema. Each schema maps to a MongoDB collection and defines the shape of the documents within that collection.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Schema = mongoose.Schema</span><br><span class="line"><span class="keyword">const</span> userSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">  name: <span class="built_in">String</span>,</span><br><span class="line">  pass: <span class="built_in">String</span>,</span><br><span class="line">  email: <span class="built_in">String</span>,</span><br><span class="line">  createTime: <span class="built_in">String</span>,</span><br><span class="line">  lastLogin: <span class="built_in">String</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Schema to define table structure.</p><p>Model to manipulate collection.</p><p>Use model to create documents in Mongodb.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create model</span></span><br><span class="line"><span class="keyword">const</span> User = mongoose.model(<span class="string">'User'</span>, userSchema)</span><br><span class="line"></span><br><span class="line"><span class="comment">// create instance, namely document</span></span><br><span class="line"><span class="keyword">const</span> newUser = <span class="keyword">new</span> User(&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// insert document to db</span></span><br><span class="line">newUser.save(<span class="function">(<span class="params">err, doc</span>) =&gt;</span> &#123;</span><br><span class="line">  err &amp;&amp; <span class="built_in">console</span>.error(err)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'doc is saved'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// create and insert</span></span><br><span class="line">User.create(&#123;...&#125;, (err, doc) =&gt; &#123;</span><br><span class="line">  err &amp;&amp; <span class="built_in">console</span>.error(err)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'doc saved'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// add staitc methods</span></span><br><span class="line">userSchema.statics.findUsersByType = <span class="function"><span class="keyword">function</span> (<span class="params">type, cb</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.find(&#123; <span class="attr">type</span>: <span class="keyword">this</span>.type &#125;, cb)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Model.$where(argument: string | Function): <query>, creates a Query and specifies a <em>$where</em> condition</query></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Blog.$where(<span class="string">'this.username.indexOf("val") !== -1'</span>).exec(<span class="function"><span class="keyword">function</span> (<span class="params">err, docs</span>) </span>&#123;&#125;)</span><br></pre></td></tr></table></figure><ul><li>Model#increment()</li></ul><h3 id="search"><a href="#search" class="headerlink" title="search"></a>search</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User.find(&#123; <span class="attr">type</span>: <span class="string">'type'</span> &#125;).where(<span class="string">'age'</span>).gt(<span class="number">2</span>).limit(<span class="number">10</span>).exec()</span><br></pre></td></tr></table></figure><h3 id="remove"><a href="#remove" class="headerlink" title="remove"></a>remove</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">User.remove(&#123; <span class="attr">type</span>: <span class="string">'type'</span> &#125;, (err, res) =&gt; &#123;</span><br><span class="line">  err &amp;&amp; <span class="built_in">console</span>.error(err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="update"><a href="#update" class="headerlink" title="update"></a>update</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">User.find(&#123; <span class="attr">type</span>: <span class="string">'type'</span> &#125;).update(&#123;</span><br><span class="line">  $set: &#123;</span><br><span class="line">    date: <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;, (err) =&gt; &#123;</span><br><span class="line">  err &amp;&amp; <span class="built_in">console</span>.error(err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Moreâ¦</p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Notes on Interactive Data Visualization for the Web</title>
      <link href="/2017/07/07/Notes-on-Interactive-Data-Visualization-for-the-Web/"/>
      <content type="html"><![CDATA[<h1 id="Introducing-D3"><a href="#Introducing-D3" class="headerlink" title="Introducing D3"></a>Introducing D3</h1><p>D3 â also referred to as d3.js â is a JavaScript library for creating data visualization. But that kind of undersell it.</p><p>The abbreviation D3 reference the toolâs full name, <em>Data-Driven Documents</em>. The <em>data</em> is provided by you, and the <em>documents</em> are web-based documents, meaning anything that can be rendered by a web browser, such as HTML and SVG. D3 does the <em>driviing</em>, in the sense that it connects the data to the documents.</p><h1 id="Data"><a href="#Data" class="headerlink" title="Data"></a>Data</h1><p><em>Data</em> is an extemely broad term, only slightly less vague than the nearly all-encompassing <em>information</em>.</p><p>Boradly speaking, data is a structured information with potential for meaning.</p><p>In the context of programming for visualization, data is stored in a digital file, typically in either text or binary form. Of course, potentially every piece of digital ephemera may be considered <code>data</code> â not just text, but bits and bytes representing images, audio, video, database, streams, models, archives, and anything else.</p><p>Within the scope of D3 and browser-based visualization, however, we will limit ourselves to <em>text-based</em>. That is, anything that can be presented as numbers and strings of alpha charaters.</p><h2 id="Binding-Data"><a href="#Binding-Data" class="headerlink" title="Binding Data"></a>Binding Data</h2><p>We use D3âs <code>data()</code> method to bind data to DOM elements. But there are two things we need in place first, before we can bind data:</p><ul><li><p>The data</p></li><li><p>A selection of DOM elements</p></li></ul><p>Anytime after you call <code>data()</code>, you can craete an anonymous function accepts <code>d</code> as input.</p><p>The magical <code>data()</code> method ensures that <code>d</code> is set to the corresponding value in your original dataset, given the current element at hand.</p><h2 id="Drawing-with-Data"><a href="#Drawing-with-Data" class="headerlink" title="Drawing with Data"></a>Drawing with Data</h2><p><code>.attr</code>, <code>.classed</code>, <code>.style</code></p><h1 id="Scales"><a href="#Scales" class="headerlink" title="Scales"></a>Scales</h1><blockquote><p>Scales are functions that map from an input domain to an output domain.</p></blockquote><p>The values in any dataset are unlikely to correspond exactly to pixel measurement for use in your visuallization.  Scales provide a convenient way to map those data values to new values useful for visuallization purposes.</p><p>D3 scales are <em>functions</em> with parameters that you define. Once they are created, you call the <code>scale</code> function , pass it a data value and it nicely returns a scaled output value.</p><p>A scale is a mathematical relationship, with no direct visual output.</p><h2 id="Domains-and-Ranges"><a href="#Domains-and-Ranges" class="headerlink" title="Domains and Ranges"></a>Domains and Ranges</h2><p>A scaleâs <em>input domain</em> is the range of possible input data values.</p><p>A scaleâs <em>output range</em> is the range of possible output values, commonly used as display values in pixel units.</p><h2 id="Normalization"><a href="#Normalization" class="headerlink" title="Normalization"></a>Normalization</h2><p>Normalization is the process of mapping a numeric value to a new value between 0 and 1, based on the possible minumum and maximum values.</p><h2 id="Creating-a-Scale"><a href="#Creating-a-Scale" class="headerlink" title="Creating a Scale"></a>Creating a Scale</h2><p>D3âs linear scale function generator is accessed with <code>d3.scaleLiner()</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> scale = d3.scaleLinear()</span><br></pre></td></tr></table></figure><p>Now <code>scale</code> is a function to which you can pass input values.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scale(<span class="number">2.5</span>) <span class="comment">// return 2.5</span></span><br></pre></td></tr></table></figure><p>Because we havenât set a domain and a range yet, this function will map input to output on a <code>1:1</code> scale.</p><p>We set the scaleâs input domain to 100, 500 by passing those values to the <code>domain()</code> method as an array.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scale.domain([<span class="number">100</span>, <span class="number">500</span>])</span><br></pre></td></tr></table></figure><p>Set the output range in similar fashion, with <code>range()</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scale.range([<span class="number">10</span>, <span class="number">350</span>])</span><br></pre></td></tr></table></figure><p>These steps can be chained:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> scale = d3.scaleLinear()</span><br><span class="line">  .domain([<span class="number">100</span>, <span class="number">500</span>])</span><br><span class="line">  .range([<span class="number">10</span>, <span class="number">350</span>])</span><br></pre></td></tr></table></figure><p>Now itâs effective</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scale(<span class="number">100</span>) <span class="comment">// return 10</span></span><br><span class="line">scale(<span class="number">300</span>) <span class="comment">// return 180</span></span><br><span class="line">scale(<span class="number">500</span>) <span class="comment">// return 350</span></span><br></pre></td></tr></table></figure><h3 id="d3-max-and-d3-min"><a href="#d3-max-and-d3-min" class="headerlink" title="d3.max() and d3.min()"></a>d3.max() and d3.min()</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> dataset = [</span><br><span class="line">  [<span class="number">5</span>, <span class="number">20</span>], [<span class="number">480</span>, <span class="number">90</span>], [<span class="number">250</span>, <span class="number">50</span>], [<span class="number">100</span>, <span class="number">33</span>], [<span class="number">330</span>, <span class="number">95</span>],</span><br><span class="line">  [<span class="number">410</span>, <span class="number">12</span>], [<span class="number">475</span>, <span class="number">44</span>], [<span class="number">25</span>, <span class="number">67</span>], [<span class="number">85</span>, <span class="number">21</span>], [<span class="number">220</span>, <span class="number">88</span>]</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">d3.max(dataset, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> d[<span class="number">0</span>]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// this function will return the value 480</span></span><br></pre></td></tr></table></figure><h3 id="Setting-Up-Dynamic-Scales"><a href="#Setting-Up-Dynamic-Scales" class="headerlink" title="Setting Up Dynamic Scales"></a>Setting Up Dynamic Scales</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xScale = d3.scaleLinear()</span><br><span class="line">  .domain([<span class="number">0</span>, d3.max(dataset, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">    retrun d[<span class="number">0</span>]</span><br><span class="line">  &#125;)])</span><br><span class="line">  .range([<span class="number">0</span>, w])</span><br></pre></td></tr></table></figure><p>Output range is set to 0 and w, the SVGâs width.</p><p>Use the scale</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.attr(<span class="string">'x'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> xScale(d[<span class="number">0</span>])</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><blockquote><p><code>d3.scaleLinear()</code> has several other handly methods that deserve a breif mention here:</p></blockquote><ul><li><p><code>nice()</code>: this tells the scale to take whatever input domain that you gave to <code>domian()</code> and expand both ends to the nearest round value.</p></li><li><p><code>rangeRound()</code>: User <code>rangeRound()</code> in place of <code>range()</code>, and all values output by the scale will be rounded to nearest whole number.</p></li><li><p><code>clamp()</code>: By default, a linear scale can return values outside of the specified range. For example, if if given a value outside of its expected input domain, a scale will return a number also outside of the output range. Calling <code>clamp(true)</code> on a scale, forces all output values to be within the specified range. This means excessive values will be rounded to the rangeâs low or high value.</p></li></ul><p>To use any of these special methods, just tack them onto the chain in which you define the original scale function.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> scale = d3.scaleLinear().domain([<span class="number">0.123</span>, <span class="number">4.67</span>]).range([<span class="number">0</span>, <span class="number">500</span>]).nice()</span><br></pre></td></tr></table></figure><blockquote><p>Other Scales</p></blockquote><ul><li><p><code>sclaeSqrt</code></p></li><li><p><code>scalePow</code></p></li><li><p><code>scaleLog</code></p></li><li><p><code>scaleQuantize</code></p></li><li><p><code>scaleQuantile</code></p></li><li><p><code>scaleOrdinal</code></p></li><li><p><code>scaleTime</code></p></li></ul><h1 id="Axes"><a href="#Axes" class="headerlink" title="Axes"></a>Axes</h1><p>D3âs axes are actually <code>function</code> whose parameters you define. Unlike scales, when an axis function is called, it doesnât return a value, but generates the visual elements of the axis, including lines, labels, and ticks.</p><h2 id="Setting-Up-an-Axis"><a href="#Setting-Up-an-Axis" class="headerlink" title="Setting Up an Axis"></a>Setting Up an Axis</h2><p>There are four different axis function constructors, each one corresponding to a different orientation and placement of labels: <code>d3.axisTop</code>, <code>d3.axisBottom</code>, <code>d3.axisLeft</code>, <code>d3.axisRight</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> xAxis = d3.axisBottom()</span><br></pre></td></tr></table></figure><p>At a minimum, each axis also needs to be told on what <em>scale</em> to operate.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> xAxis = d3.axisBottom().scale(xScale)</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"><span class="keyword">const</span> xAxis = d3.axisBottom(xScale)</span><br></pre></td></tr></table></figure><p>Finally, to actually generate the axis and insert all those little lines and labels into our SVG, we must <code>call</code> teh <code>xAxis</code> function. This is similar to the scale functions, which we first configured by setting parameters, and then later <code>called</code> to put them into action.</p><p>Here we put this code at the end of script, so the axis is generated after the other elements in the SVG, and therefore appears âon topâ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svg.append(<span class="string">'g'</span>).call(xAxis)</span><br></pre></td></tr></table></figure><p>This is where things get a little funky. You might be wondering why this looks so different from our friendly scale functions. Hereâs why: because an axis function actually draws something to the screen (by appending SVG elements to the DOM), we need to specify where in the DOM it should place new elements.</p><p>In the svg, we <code>append()</code> a new <code>g</code> element to the end of the SVG. In SVG land, a <code>g</code> element is a <code>group</code> element. Group elements are invisible, unlike <code>line</code>, <code>rect</code>, and <code>circle</code> and they have no visual presence themselves.</p><p>The <code>g</code> element can keep our code nice and be transformed.</p><p>So weâve created a new <code>g</code>, and then finally, the function <code>call()</code> is called on our new <code>g</code>.</p><p>D3âs <code>call()</code> function takes the incoming <code>selection</code>, as received from the prior link in the chain, and hands that selection off to any <code>function</code>.</p><p>This this case, the selection is our new <code>g</code> group element. Although the <code>g</code> isnât strictly necessary, we are using it because the axis function is about to generate lots of crazy lines and numbers, and itâs noce to contain all those element within a single group object.</p><p><code>call()</code> hands off <code>g</code> to the <code>xAxis</code> function, so our axis is genrated within <code>g</code></p><h3 id="Positioning-Axes"><a href="#Positioning-Axes" class="headerlink" title="Positioning Axes"></a>Positioning Axes</h3><p>By default, an axis is positioned using the range values of the specified scale. In our case, <code>xAxis</code> is referencing <code>xScale</code>, which has a range of [20, 460], because we applied 20 pixels of padding on all edge of the SVG. We can transform the axis by:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">svg.append(<span class="string">'g'</span>)</span><br><span class="line">  .attr(<span class="string">'class'</span>, <span class="string">'axis'</span>)</span><br><span class="line">  .attr(<span class="string">'tranform'</span>, <span class="string">'translate(0, '</span> + (h - padding) + <span class="string">')'</span>)</span><br><span class="line">  .call(xAxis)</span><br></pre></td></tr></table></figure><p>In the end, we would like  our <code>g</code> to look like this in the DOM:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">g</span> <span class="attr">class</span>=<span class="string">"axis"</span> <span class="attr">transform</span>=<span class="string">"translate(0, 280)"</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="CSS-styles-on-axis"><a href="#CSS-styles-on-axis" class="headerlink" title="CSS styles on axis"></a>CSS styles on axis</h3><p>The axes themselves are made up of <code>path</code>, <code>line</code>, <code>text</code> element, so those are the three elemnts to target in your CSS.</p><p>The paths and lines can be styled together, with the same rules, and text gets its own rules around for font and font size.</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.axis</span> <span class="selector-tag">path</span>, <span class="selector-class">.axis</span> <span class="selector-tag">line</span> &#123;</span><br><span class="line">  <span class="attribute">stroke</span>: teal;</span><br><span class="line">  <span class="attribute">shape-rendering</span>: crispEdges;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.axis</span> <span class="selector-tag">text</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: Optima, Futura, sans-serif;</span><br><span class="line">  <span class="attribute">font-weight</span>: bold;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">fill</span>: teal;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>These CSS rules will override D3âs default styles.</p><p>Note that when we use CSS rules to style SVG elements, only SVG attribute names â not regular CSS properties â should be used.</p><h3 id="Check-for-Ticks"><a href="#Check-for-Ticks" class="headerlink" title="Check for Ticks"></a>Check for Ticks</h3><p>Some ticks spread disease, but D3âs ticks communicates information.</p><p>You can customize all aspects of your axes, starting with the rough number of ticks, using <code>ticks()</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> xAxis = d3.axisBottom().scale(xScale).ticks(<span class="number">6</span>) <span class="comment">// set rough # of ticks</span></span><br></pre></td></tr></table></figure><p>Specifying tick values manually</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> xAixs = d3.axisBottom().scale(xScale).tickValues([<span class="number">0</span>, <span class="number">100</span>, <span class="number">250</span>, <span class="number">700</span>])</span><br></pre></td></tr></table></figure><h3 id="Formatting-Tick-labels"><a href="#Formatting-Tick-labels" class="headerlink" title="Formatting Tick labels"></a>Formatting Tick labels</h3><p>Enter <code>tickFormat()</code>, which enables you to specify how your numbers should be formatted.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> formatAsPercentage = d3.format(<span class="string">".1%"</span>)</span><br><span class="line">xAxis.tickFormat(formatAsPercentage)</span><br></pre></td></tr></table></figure><h1 id="Updates-Transtions-and-Motion"><a href="#Updates-Transtions-and-Motion" class="headerlink" title="Updates, Transtions, and Motion"></a>Updates, Transtions, and Motion</h1><blockquote><p>Transtion: .transition(), .duration()</p></blockquote><blockquote><p>Motion: .delay(), .ease()</p></blockquote><p>The argument could be number or function</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.transition()</span><br><span class="line">.delay(<span class="function">(<span class="params">d, i</span>) =&gt;</span> <span class="number">100</span> * i)</span><br><span class="line">.duration(<span class="number">300</span>)</span><br></pre></td></tr></table></figure><p>The default easing is <code>d3.easeCubicInOut</code>, which produces the gradual acceleration and deceleration.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.transition()</span><br><span class="line">.duration(<span class="number">3000</span>)</span><br><span class="line">.ease(d3.easeLinear)</span><br></pre></td></tr></table></figure><ul><li><p>d3.easeCircleIn</p></li><li><p>d3.easeElasticOut</p></li><li><p>d3.easeBounceOut</p></li></ul><h3 id="on-Transition-Starts-and-Ends"><a href="#on-Transition-Starts-and-Ends" class="headerlink" title="on() Transition Starts and Ends"></a>on() Transition Starts and Ends</h3><p>There will be times when you want to make something happen at the start or end of a transition. In those time you can use <code>on()</code> to execute arbitrary code for each element in the selection.</p><p><code>on()</code> expects two arguments:</p><ul><li><p>Either âstartâ or âendâ</p></li><li><p>An anonymous function, to be executed either at the start of a transition, or as soon as it has ended.</p></li></ul><blockquote><p>Notice: Only one transition can be active on any given element at any given time.</p></blockquote><h3 id="Containing-Visual-Elements-With-Clipping-Paths"><a href="#Containing-Visual-Elements-With-Clipping-Paths" class="headerlink" title="Containing Visual Elements With Clipping Paths"></a>Containing Visual Elements With Clipping Paths</h3><p>SVG has support for <em>clipping paths</em>, which you might know as <em>masks</em> in many drawing tools.</p><p>Much like <code>g</code>, <code>clipPath</code> has no visual presence of its own, but it contains visual elements.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;clipPath id=<span class="string">"chart-area"</span>&gt;</span><br><span class="line">  &lt;rect x=<span class="string">"30"</span> y=<span class="string">"30"</span> width=<span class="string">"410"</span> height=<span class="string">"240"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">rect</span>&gt;</span></span></span><br><span class="line">&lt;<span class="regexp">/clipPath&gt;</span></span><br></pre></td></tr></table></figure><p>Note that outer <code>clipPath</code> element has been given an ID of <code>chart-area</code>. We can use that ID to reference it later. Within the <code>clipPath</code> is a <code>rect</code>, which will function as the mask.</p><p>3 steps to using a clipping path:</p><ol><li><p>Define a <code>clipPath</code> and give it an ID</p></li><li><p>Put visual elements within the <code>clipPath</code> (usuallly just a <code>rect</code>, but this could be <code>circles</code> or any other visual elements)</p></li><li><p>Add a reference to the <code>clipPath</code> form whatever elements you wish to be masked.</p></li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">svg.append(<span class="string">'clipPath'</span>)</span><br><span class="line">  .attr(<span class="string">'id'</span>, <span class="string">'chart-area'</span>) <span class="comment">// assign an id</span></span><br><span class="line">  .append(<span class="string">'rect'</span>) <span class="comment">// within the clippath, create new rect</span></span><br><span class="line">  .attr(<span class="string">'x'</span>, padding)</span><br><span class="line">  .attr(<span class="string">'y'</span>, padding)</span><br><span class="line">  .attr(<span class="string">'width'</span>, w - padding * <span class="number">2</span>)</span><br><span class="line">  .attr(<span class="string">'height'</span>, h - padding * <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">svg.append(<span class="string">'g'</span>)</span><br><span class="line">  .attr(<span class="string">'id'</span>, <span class="string">'circles'</span>)</span><br><span class="line">  .attr(<span class="string">'clip-path'</span>, <span class="string">'url(#chart-area)'</span>)</span><br><span class="line">  .selectAll(<span class="string">'circle'</span>)</span><br><span class="line">  .data(dataset)</span><br><span class="line">  .enter()</span><br><span class="line">  .append(<span class="string">'circle'</span>)</span><br></pre></td></tr></table></figure><h1 id="Interactivity"><a href="#Interactivity" class="headerlink" title="Interactivity"></a>Interactivity</h1><p>D3 allows you to bind event listener to more than one element at a time.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">svg.selectAll(<span class="string">'rect'</span>)</span><br><span class="line">  .data(dataset)</span><br><span class="line">  .enter()</span><br><span class="line">  .append(<span class="string">'rect'</span>)</span><br><span class="line">  ....</span><br><span class="line">  .on(<span class="string">'click'</span>, (d) =&gt; &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><p>Within anonymous function , D3 automatically sets the context of <code>this</code>  so it references <code>current element upon which we are acting</code></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">svg</span> <span class="selector-tag">text</span> &#123;</span><br><span class="line">  <span class="attribute">pointer-event</span>: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>or</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svg.append(<span class="string">'text'</span>).style(<span class="string">'pointer-event'</span>, <span class="string">'none'</span>)</span><br></pre></td></tr></table></figure><h3 id="Grouping-SVG-Element"><a href="#Grouping-SVG-Element" class="headerlink" title="Grouping SVG Element"></a>Grouping SVG Element</h3><p>Note that <code>g</code> group elements do not, by themselves, trigger any mouse events. The reason for this is that <code>g</code> elements have no pixels.</p><p>You can still bind event listener to <code>g</code> elements, just keep in mind that the elements within that <code>g</code> will then behave as a group. If any of the enclosed elements are clicked or moused over, then the listener function will be activated.</p><h3 id="Tooltips"><a href="#Tooltips" class="headerlink" title="Tooltips"></a>Tooltips</h3><p>In interactive visualizations, tooltips are small overlays that present data values. In many cases, itâs not necessary to label every individual data value in the default value, but that level of detail should still be accessible to users.</p><h4 id="SVG-Element-Tooltips"><a href="#SVG-Element-Tooltips" class="headerlink" title="SVG Element Tooltips"></a>SVG Element Tooltips</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">.on(<span class="string">'mouseover'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> xPosition = <span class="built_in">parseFloat</span>(d3.select(<span class="keyword">this</span>)).attr(<span class="string">'x'</span>) + xScale.bandWidth()</span><br><span class="line">  <span class="keyword">const</span> yPosition = <span class="built_in">parseFloat</span>(d3.select(<span class="keyword">this</span>)).attr(<span class="string">'y'</span>) + <span class="number">14</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// create the tooltip label</span></span><br><span class="line"></span><br><span class="line">svg.append(<span class="string">'text'</span>)</span><br><span class="line">  .attr(<span class="string">'id'</span>, <span class="string">'tooltip'</span>)</span><br><span class="line">  .attr(<span class="string">'x'</span>, xPosition)</span><br><span class="line">  .attr(<span class="string">'y'</span>, yPosition)</span><br><span class="line">  .attr(<span class="string">'text-anchor'</span>, <span class="string">'middle'</span>)</span><br><span class="line">  .attr(<span class="string">'font-family'</span>, <span class="string">'sans-serif'</span>)</span><br><span class="line">  .attr(<span class="string">'font-size'</span>, <span class="string">'11px'</span>)</span><br><span class="line">  .attr(<span class="string">'font-weight'</span>, <span class="string">'bold'</span>)</span><br><span class="line">  .attr(<span class="string">'fill'</span>, <span class="string">'black'</span>)</span><br><span class="line">  .text(d)</span><br><span class="line"></span><br><span class="line">.on(<span class="string">'mouseout'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  d3.select(<span class="string">'#tooltip'</span>).remove()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="Using-Paths"><a href="#Using-Paths" class="headerlink" title="Using Paths"></a>Using Paths</h1><h3 id="Line-Charts"><a href="#Line-Charts" class="headerlink" title="Line Charts"></a>Line Charts</h3><h4 id="Scale-setup"><a href="#Scale-setup" class="headerlink" title="Scale setup"></a>Scale setup</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> xScale = d3.scaleTime()</span><br><span class="line">  .domain([</span><br><span class="line">    d3.min(dataset, (d) =&gt; d.date),</span><br><span class="line">    d3.max(dataset, (d) =&gt; da.date)</span><br><span class="line">  ])</span><br><span class="line">  .range([<span class="number">0</span>, w])</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> yScale = d3.scaleLinear()</span><br><span class="line">  .domain([</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    d3.max(dataset, (d) =&gt; d.avarage)</span><br><span class="line">  ])</span><br><span class="line">  .range([h, <span class="number">0</span>])</span><br></pre></td></tr></table></figure><p>Define a line generator</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> lineGen = d3.line()</span><br><span class="line">  .x(<span class="function"><span class="params">d</span> =&gt;</span> xScale(d.date))</span><br><span class="line">  .y(<span class="function"><span class="params">d</span> =&gt;</span> yScale(d.avarage))</span><br></pre></td></tr></table></figure><p>The x and y accessors tell the line generator how to decide <code>where</code> to place each point on the line.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> svg = d3.select(<span class="string">'body'</span>)</span><br><span class="line">  .append(<span class="string">'svg'</span>)</span><br><span class="line">  .attr(<span class="string">'width'</span>, w)</span><br><span class="line">  .attr(<span class="string">'height'</span>, h)</span><br><span class="line"></span><br><span class="line">svg.append(<span class="string">'path'</span>)</span><br><span class="line">  .datum(dataset)</span><br><span class="line">  .attr(<span class="string">'class'</span>, <span class="string">'line'</span>)</span><br><span class="line">  .attr(<span class="string">'d'</span>, lineGen)</span><br></pre></td></tr></table></figure><p>Instead of using <code>data()</code> to bind each value in our <code>dataset</code> array to a different element, we use <code>datum()</code>, the method for binding a <em>single</em> data value to a single element. The entire <code>dataset</code> array is bound to the new <code>path</code> we just created.</p><p>We set a <code>d</code> attribute, passing in our line generator function as an argument.</p><p>Since the data has already been bound to the <code>path</code>, the line generator simply grabs taht data. plots the pointers as we specified, and draws a line connecting them.</p><h3 id="Dealing-with-Missing-Data"><a href="#Dealing-with-Missing-Data" class="headerlink" title="Dealing with Missing Data"></a>Dealing with Missing Data</h3><p>Assume a -99.99 value is not a true measurement, namely one value is missed.</p><p><code>defined()</code> is just an configuration method, like <code>x()</code> and <code>y()</code>. If the result of its anonymous function is true, then that data value is included, or the value is excluded.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> lineGen = d3.line()</span><br><span class="line">  .defined(<span class="function"><span class="params">d</span> =&gt;</span> (d.avarage &gt; <span class="number">0</span>))</span><br><span class="line">  .x(<span class="function"><span class="params">d</span> =&gt;</span> x.date)</span><br><span class="line">  .y(<span class="function"><span class="params">d</span> =&gt;</span> x.avatarge)</span><br></pre></td></tr></table></figure><h3 id="Area-Charts"><a href="#Area-Charts" class="headerlink" title="Area Charts"></a>Area Charts</h3><p>Areas are not too different from lines. If a line is a series of connected (x, y) points, then an area is just that same line, plus a second such line (usually a flat baseline), with all the space in between filled in.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> area = d3.area()</span><br><span class="line">  .defined(<span class="function"><span class="params">d</span> =&gt;</span> (d.avarage &gt; <span class="number">0</span>))</span><br><span class="line">  .x(<span class="function"><span class="params">d</span> =&gt;</span> (xScale(d.date)))</span><br><span class="line">  .y0(<span class="function"><span class="params">()</span> =&gt;</span> (yScale.range()[<span class="number">0</span>]))</span><br><span class="line">  .y1(<span class="function">(<span class="params">d</span>) =&gt;</span> (yScale(d.avarge)))</span><br></pre></td></tr></table></figure><p><code>y0</code> represents the areaâs baseline, which <code>y1</code> represents the top.</p><h1 id="Selections"><a href="#Selections" class="headerlink" title="Selections"></a>Selections</h1><h3 id="A-Closer-Look-at-Selections"><a href="#A-Closer-Look-at-Selections" class="headerlink" title="A Closer Look at Selections"></a>A Closer Look at Selections</h3><p><img src="https://www.safaribooksonline.com/library/view/interactive-data-visualization/9781491921296/assets/dvw2_1201.png" alt=""></p><p><code>d3.select(&#39;body&#39;)</code> returns a <code>Selection</code>, which consists of <code>_groups</code> and <code>_parents</code></p><p>So a selection contains two arrays: <code>_groups</code> and <code>_parents</code></p><p><code>_groups</code> contains yet another array, which itself contains a list of elements â ony one in this case, <code>body</code>.</p><p>Letâs expand <code>body</code> and will see a lot of properties associated with <code>body</code>.</p><p>Selections are just very special objects generated and interpreted by D3. You will never manipulate a selection yourself â donât bother trying to reach int <code>_groups</code> â as thatâs what all of D3âs selection methods are for.</p><p><code>d3.select()</code> and <code>d3.selectAll()</code> operate at the page level, which means</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> allGroups = d3.selectAll(<span class="string">'g'</span>)</span><br></pre></td></tr></table></figure><p>The <code>select()</code> and <code>selectAll()</code> statements create <em>new</em> selections, and hand those new selections off to the subsequent methods.</p><p>To minimize the confusion from old and new selections, Mike Bostock recommends using an indentation convetion of four space when the selection is unchanged, but only two when a new selection is returned.</p><p><code>select()</code> and <code>append()</code> are methods that return new selections, <code>attr()</code> does not, but merely relays whatever selection it just acted on.</p><h3 id="Storing-Selections"><a href="#Storing-Selections" class="headerlink" title="Storing Selections"></a>Storing Selections</h3><p>Selections are immutable. All selection methods that affect which elements are selected (or their order) return a new selection rather tahn modifying the current selection.</p><p>That is, once you make a selection, you canât modify it. You can only make a new one, which could be a subset of the original, and overwrite it.</p><h3 id="Enter-Merge-and-Exit"><a href="#Enter-Merge-and-Exit" class="headerlink" title="Enter, Merge and Exit"></a>Enter, Merge and Exit</h3><h3 id="Filter"><a href="#Filter" class="headerlink" title="Filter"></a>Filter</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">d3.select(<span class="string">'body'</span>).selectAll(<span class="string">'p'</span>)</span><br><span class="line">  .data(dataset)</span><br><span class="line">  .enter()</span><br><span class="line">  .append(<span class="string">'p'</span>)</span><br><span class="line">  .text(<span class="function"><span class="params">d</span> =&gt;</span> (<span class="string">'I can count up to '</span> + d))</span><br><span class="line">  .filter(<span class="function"><span class="params">d</span> =&gt;</span> (d &gt; <span class="number">15</span>))</span><br><span class="line">  .style(<span class="string">'color'</span>, <span class="string">'red'</span>)</span><br></pre></td></tr></table></figure><p><code>filter()</code> takes a selection and an anonymous function. If the function return <code>true</code> for a given element, then that element is included in the new selection returned by <code>filter()</code>.</p><h3 id="Each"><a href="#Each" class="headerlink" title="Each"></a>Each</h3><p>The most common purpose of creating a selection is to ultimately to modify it in some way, such as by using <code>attr()</code> or <code>style()</code>. But it can be useful to define your own functions, espectially for custom calculation or modifications that will be repeated.</p><p>We can use <code>each()</code> to run an arbitrary function once for each element in a selection. <code>each()</code> takes whatever selection itâs given and calls the specified function once for each item in the selection.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">selection.each(<span class="function">(<span class="params">d, i</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Some serious points to note:</p><ul><li><p>Since the <code>d</code> and <code>i</code> arguments are specified in the function definition, D3 will populate them for you.</p></li><li><p>The value of <code>this</code> will also be set by D3 to reflect <code>the element upon which we&#39;re currently acting</code>, So <code>d3.select(this)</code> will create a selection with whatever that element is.</p></li><li><p>In <code>delay()</code> or any other function within (d, i) =&gt; {}, we can reference the value <code>d</code>, and <code>i</code> directly, no need to write <code>(d, i)</code></p></li></ul><h1 id="Layouts"><a href="#Layouts" class="headerlink" title="Layouts"></a>Layouts</h1><p>Contrary to what the name implies, D3 <em>layouts</em> do not, in fact, lay anything out for you on the screen. The layout methods have no direct <em>visual</em> output. Rather, D3 layouts take data that you provided and remap or otherwise transform it, thereby generating <em>new</em> data that is more convenient for a specific visual task.</p><p>The list of D3 layouts includes:</p><ul><li><p>Chord</p></li><li><p>Cluster</p></li><li><p>Force</p></li><li><p>Pack</p></li><li><p>Partition</p></li><li><p>Pie</p></li><li><p>Stack</p></li><li><p>Tree</p></li><li><p>Treemap</p></li></ul><h3 id="Pie-Layout"><a href="#Pie-Layout" class="headerlink" title="Pie Layout"></a>Pie Layout</h3><p><code>d3.pie()</code> might not be as delicious as it sounds, but itâs still worthy of your attention. It is typically used to create a doughnut or pie chart.</p><p>Start with simple dataset</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> dataset = [ <span class="number">5</span>, <span class="number">10</span>, <span class="number">20</span>, <span class="number">45</span>, <span class="number">6</span>, <span class="number">25</span> ]</span><br></pre></td></tr></table></figure><p>Wd define a default pie layout</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pie = d3.pie()</span><br></pre></td></tr></table></figure><p>Then, all that remains is to hand off our data to the new <code>pie()</code> function, as in <code>pie(dataset)</code>.</p><p>The pie layout takes our simple array of numbers and generates an array of objects, one object for each value. Each of those objects now has a few new values â most important, <code>startAngle</code> and <code>endAngle</code>.</p><p>To actually draw the wedges, we turn to <code>d3.arc()</code>, a handy built-in function for drawing arcs as SVG <code>path</code> elements.</p><p>Arcs are defiend as custom functions, and they require inner and outer redius values.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> w = <span class="number">300</span></span><br><span class="line"><span class="keyword">const</span> h = <span class="number">300</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> outerRadius = w / <span class="number">2</span></span><br><span class="line"><span class="keyword">const</span> innerRadius = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> arc = d3.arc()</span><br><span class="line">  .innerRadius(innerRadius)</span><br><span class="line">  .outerRadius(outerRadius)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> svg = d3.select(<span class="string">'body'</span>)</span><br><span class="line">  .append(<span class="string">'svg'</span>)</span><br><span class="line">  .attr(<span class="string">'width'</span>, w)</span><br><span class="line">  .attr(<span class="string">'height'</span>, h)</span><br></pre></td></tr></table></figure><p>Then we can create new groups for each incoming wedge, binding the pie-ified data to the new elements, and translating each group into the center of the chart, so the <code>path</code>s will appear in the right place</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// set up groups</span></span><br><span class="line"><span class="keyword">const</span> arcs = svg.selectAll(<span class="string">'g.arc'</span>)</span><br><span class="line">  .data(pie(dataset))</span><br><span class="line">  .enter()</span><br><span class="line">  .append(<span class="string">'g'</span>)</span><br><span class="line">  .attr(<span class="string">'class'</span>, <span class="string">'arc'</span>)</span><br><span class="line">  .attr(<span class="string">'transform'</span>, <span class="string">'translate('</span> + outerRadius + <span class="string">', '</span> + outerRadius + <span class="string">')'</span>)</span><br></pre></td></tr></table></figure><p>Note that weâre saving a reference to each newly created <code>g</code> in a variable called <code>arcs</code></p><p>Finally, within each new <code>g</code>, we append a <code>path</code>. A <code>path</code>âs path description is defined in the <code>d</code> attribute. So we call the <code>arc</code> generator, which generates the path information based on the data already bound to this group.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// draw arc paths</span></span><br><span class="line">arcs.append(<span class="string">'path'</span>)</span><br><span class="line">  .attr(<span class="string">'fill'</span>, (d, i) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> colors(i)</span><br><span class="line">  &#125;)</span><br><span class="line">  .attr(<span class="string">'d'</span>, arc)</span><br></pre></td></tr></table></figure><p><code>arc</code> is our path generator function.</p><p>When a named function is specified as a parameter in this way, D3 automcatically passes in the datum and index values, without us having to write them out explicitly.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.attr(<span class="string">'d'</span>, arc)</span><br><span class="line"></span><br><span class="line"><span class="comment">// equivalent</span></span><br><span class="line"></span><br><span class="line">.attr(<span class="string">'d'</span>, (d, i) =&gt; (arc(d, i)))</span><br></pre></td></tr></table></figure><p>D3 has a number of handy ways to generate categorical colors</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> color = d3.scaleOrdinal(d3.schemeCategory10)</span><br></pre></td></tr></table></figure><p>Generate text labels for each wedge:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">arcs.append(<span class="string">'text'</span>)</span><br><span class="line">  .artr(<span class="string">'transform'</span>, (d) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'translate('</span> + arc.centroid(d) + <span class="string">')'</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .attr(<span class="string">'text-anchor'</span>, <span class="string">'middle'</span>)</span><br><span class="line">  .text(<span class="function">(<span class="params">d</span>) =&gt;</span> &#123; <span class="keyword">return</span> d.value &#125;)</span><br></pre></td></tr></table></figure><p>A <em>centroid</em> is the calculated center point of any shape, whether that shape is regular(like a square) or highly irregular(like an outline of the state of Maryland).</p><p><code>arc.centroid()</code> is super-helpful function that calculates and returns the center point of any arc.</p><blockquote><p>Note: The pie layout automatically reordered out data values from largest to smallest.</p></blockquote><h3 id="Stack-Layout"><a href="#Stack-Layout" class="headerlink" title="Stack Layout"></a>Stack Layout</h3><p><code>d3.stack()</code> converts two-dimentional data into âstackedâ data.</p><p>It calculates a baseline value for each datum, so you can <code>stack</code> layers of data on top of one another.</p><p>Start with some data</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> dataset = [</span><br><span class="line">  &#123; <span class="attr">apples</span>: <span class="number">5</span>, <span class="attr">oranges</span>: <span class="number">10</span>, <span class="attr">grapes</span>: <span class="number">22</span> &#125;,</span><br><span class="line">&#123; <span class="attr">apples</span>: <span class="number">4</span>, <span class="attr">oranges</span>: <span class="number">12</span>, <span class="attr">grapes</span>: <span class="number">28</span> &#125;,</span><br><span class="line">&#123; <span class="attr">apples</span>: <span class="number">2</span>, <span class="attr">oranges</span>: <span class="number">19</span>, <span class="attr">grapes</span>: <span class="number">32</span> &#125;,</span><br><span class="line">&#123; <span class="attr">apples</span>: <span class="number">7</span>, <span class="attr">oranges</span>: <span class="number">23</span>, <span class="attr">grapes</span>: <span class="number">35</span> &#125;,</span><br><span class="line">&#123; <span class="attr">apples</span>: <span class="number">23</span>, <span class="attr">oranges</span>: <span class="number">17</span>, <span class="attr">grapes</span>: <span class="number">43</span> &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>The <code>dataset</code> is organized by <em>column</em>. The stack layout reconfigures the data to be organized by <em>categories</em>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Set up stack method</span></span><br><span class="line"><span class="keyword">const</span> stack = d3.stack().keys([<span class="string">'apples'</span>, <span class="string">'oranges'</span>, <span class="string">'grapes'</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">// Data, stacked</span></span><br><span class="line"><span class="keyword">const</span> series = stack(dataset)</span><br></pre></td></tr></table></figure><p>Now <code>series</code> is an array with three values, each one itself an array corresponding to each categorical series: apples, oranges, and grapes(in that order because we specified as such in <code>keys()</code>)</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//'series', the array formerly known as 'dataset'</span></span><br><span class="line">[</span><br><span class="line">[ [ <span class="number">0</span>,  <span class="number">5</span>], [ <span class="number">0</span>,  <span class="number">4</span>], [ <span class="number">0</span>,  <span class="number">2</span>], [ <span class="number">0</span>,  <span class="number">7</span>], [ <span class="number">0</span>, <span class="number">23</span>] ],  <span class="comment">// apples</span></span><br><span class="line">[ [ <span class="number">5</span>, <span class="number">15</span>], [ <span class="number">4</span>, <span class="number">16</span>], [ <span class="number">2</span>, <span class="number">21</span>], [ <span class="number">7</span>, <span class="number">30</span>], [<span class="number">23</span>, <span class="number">40</span>] ],  <span class="comment">// oranges</span></span><br><span class="line">[ [<span class="number">15</span>, <span class="number">37</span>], [<span class="number">16</span>, <span class="number">44</span>], [<span class="number">21</span>, <span class="number">53</span>], [<span class="number">30</span>, <span class="number">65</span>], [<span class="number">40</span>, <span class="number">83</span>] ]   <span class="comment">// grapes</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>To stack element visually, now we can reference each data objectâs baseline and top line values.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Add a group for each row of data</span></span><br><span class="line"><span class="keyword">const</span> groups = svg.selectAll(<span class="string">'g'</span>)</span><br><span class="line">  .data(series)</span><br><span class="line">  .enter()</span><br><span class="line">  .append(<span class="string">'g'</span>)</span><br><span class="line">  .style(<span class="string">'fill'</span>, (di, i) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> colors(i)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add a rect for each data value</span></span><br><span class="line"><span class="keyword">const</span> rects = groups.selectAll(<span class="string">'rect'</span>)</span><br><span class="line">  .data(<span class="function">(<span class="params">d</span>) =&gt;</span> (d))</span><br><span class="line">  .enter()</span><br><span class="line">  .append(<span class="string">'rect'</span>)</span><br><span class="line">  .attr(<span class="string">'x'</span>, (d, i) =&gt; &#123;</span><br><span class="line">    retrun xScale(i)</span><br><span class="line">  &#125;)</span><br><span class="line">  .attr(<span class="string">'y'</span>, (d) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> ySclae(d[<span class="number">0</span>])</span><br><span class="line">  &#125;)</span><br><span class="line">  .attr(<span class="string">'height'</span>, (d) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> yScale(d[<span class="number">1</span>]-d[<span class="number">0</span>])</span><br><span class="line">  &#125;)</span><br><span class="line">  .attr(<span class="string">'width'</span>, xScale.bandWidth())</span><br></pre></td></tr></table></figure><p>Within each group, we select all the <code>rect</code>s and bind a subset of the data with this line</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.data(<span class="function">(<span class="params">d</span>) =&gt;</span> (d))</span><br></pre></td></tr></table></figure><h4 id="A-New-Order"><a href="#A-New-Order" class="headerlink" title="A New Order"></a>A New Order</h4><p>Unless otherwise specified, series will be stacked in the order specified in <code>keys()</code>.</p><p>But you can use <code>order()</code> to specify an alternate sequence to be applied before all the stacked values are calculated.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> stack = d3.stack()</span><br><span class="line">  .keys([ <span class="string">'apples'</span>, <span class="string">'oranges'</span>, <span class="string">'grapes'</span> ])</span><br><span class="line">  .order(d3.stackOrderDesending)</span><br></pre></td></tr></table></figure><ul><li><p>d3.stackOrderNone</p></li><li><p>d3.stackOrderReverse</p></li><li><p>d3.stackOrderAscending</p></li><li><p>d3.stackOrderDescending</p></li></ul><h3 id="Stacked-Areas"><a href="#Stacked-Areas" class="headerlink" title="Stacked Areas"></a>Stacked Areas</h3><p>This can be a valuable way to represent time series data, when a sum total is derived from several related categories.</p><h3 id="Force-Layout"><a href="#Force-Layout" class="headerlink" title="Force Layout"></a>Force Layout</h3><p>Force-directed layouts are so-called because they use simulations of physical <em>force</em> to arrange elements on the screen.</p><p>Force layouts are typically used with network data. In computer science, this kind of dataset is called a <code>graph</code>. A simple graph is a list of <code>node</code> and <code>edge</code>. The nodes are entities in the dataset, and the edges are the <code>connection</code>s between nodes. Some nodes will be connected by edges and others wonât.</p><p>Nodea are commonly represented as circles and edges as lines.</p><p>The physical metaphor here is of particles that repel each other, yet are also connected by strings.  The repelling forces push particles away from each other, preventing visual overlap, and the strings prevent them from just flying out into space, thereby keeping them on the screen where we can see them.</p><h4 id="Preparing-the-network-data"><a href="#Preparing-the-network-data" class="headerlink" title="Preparing the network data"></a>Preparing the network data</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> dataset = &#123;</span><br><span class="line">nodes: [</span><br><span class="line">&#123; <span class="attr">name</span>: <span class="string">"Adam"</span> &#125;,</span><br><span class="line">&#123; <span class="attr">name</span>: <span class="string">"Bob"</span> &#125;,</span><br><span class="line">&#123; <span class="attr">name</span>: <span class="string">"Carrie"</span> &#125;,</span><br><span class="line">&#123; <span class="attr">name</span>: <span class="string">"Donovan"</span> &#125;,</span><br><span class="line">&#123; <span class="attr">name</span>: <span class="string">"Edward"</span> &#125;,</span><br><span class="line">&#123; <span class="attr">name</span>: <span class="string">"Felicity"</span> &#125;,</span><br><span class="line">&#123; <span class="attr">name</span>: <span class="string">"George"</span> &#125;,</span><br><span class="line">&#123; <span class="attr">name</span>: <span class="string">"Hannah"</span> &#125;,</span><br><span class="line">&#123; <span class="attr">name</span>: <span class="string">"Iris"</span> &#125;,</span><br><span class="line">&#123; <span class="attr">name</span>: <span class="string">"Jerry"</span> &#125;</span><br><span class="line">],</span><br><span class="line">edges: [</span><br><span class="line">&#123; <span class="attr">source</span>: <span class="number">0</span>, <span class="attr">target</span>: <span class="number">1</span> &#125;,</span><br><span class="line">&#123; <span class="attr">source</span>: <span class="number">0</span>, <span class="attr">target</span>: <span class="number">2</span> &#125;,</span><br><span class="line">&#123; <span class="attr">source</span>: <span class="number">0</span>, <span class="attr">target</span>: <span class="number">3</span> &#125;,</span><br><span class="line">&#123; <span class="attr">source</span>: <span class="number">0</span>, <span class="attr">target</span>: <span class="number">4</span> &#125;,</span><br><span class="line">&#123; <span class="attr">source</span>: <span class="number">1</span>, <span class="attr">target</span>: <span class="number">5</span> &#125;,</span><br><span class="line">&#123; <span class="attr">source</span>: <span class="number">2</span>, <span class="attr">target</span>: <span class="number">5</span> &#125;,</span><br><span class="line">&#123; <span class="attr">source</span>: <span class="number">2</span>, <span class="attr">target</span>: <span class="number">5</span> &#125;,</span><br><span class="line">&#123; <span class="attr">source</span>: <span class="number">3</span>, <span class="attr">target</span>: <span class="number">4</span> &#125;,</span><br><span class="line">&#123; <span class="attr">source</span>: <span class="number">5</span>, <span class="attr">target</span>: <span class="number">8</span> &#125;,</span><br><span class="line">&#123; <span class="attr">source</span>: <span class="number">5</span>, <span class="attr">target</span>: <span class="number">9</span> &#125;,</span><br><span class="line">&#123; <span class="attr">source</span>: <span class="number">6</span>, <span class="attr">target</span>: <span class="number">7</span> &#125;,</span><br><span class="line">&#123; <span class="attr">source</span>: <span class="number">7</span>, <span class="attr">target</span>: <span class="number">8</span> &#125;,</span><br><span class="line">&#123; <span class="attr">source</span>: <span class="number">8</span>, <span class="attr">target</span>: <span class="number">9</span> &#125;</span><br><span class="line">]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="Defining-the-Force-Simulation"><a href="#Defining-the-Force-Simulation" class="headerlink" title="Defining the Force Simulation"></a>Defining the Force Simulation</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Initialize a simple force layout, using the nodes and edges in dataset</span></span><br><span class="line"><span class="keyword">const</span> layout = d3.forceSimulation(dataset.nodes)</span><br><span class="line">  .force(<span class="string">'charge'</span>, d3.forceManyBody())</span><br><span class="line">  .force(<span class="string">'link'</span>, d3.forceLink(dataset.edges))</span><br><span class="line">  .force(<span class="string">'center'</span>, d3.forceCenter().x(w/<span class="number">2</span>).y(h/<span class="number">2</span>))</span><br></pre></td></tr></table></figure><p>Call <code>d3.forceSimulation()</code> and pass in a reference to the nodes. This will generate a new simulator and automatically start running it, but without any forces applied, it wonât be very interesting.</p><p>To create force, call <code>force()</code> as many times as you like, each time specifying an arbitrary name for each force(in case you want to reference it later) and the name of a force function.</p><ul><li><p><code>d3.forceManyBody()</code>: Create a <em>many-body</em> force which acts on <strong>all</strong> nodes, meaning this can be used to either attract all nodes to each other or repel all nodes from each other. Try different <code>strength()</code> values, and see what happens. The default <code>strength()</code> is -30, so we will see a slight repelling force.</p></li><li><p><code>d3.forceLink()</code>: Our nodes are connected by edges, so we apply this force, specifying <code>dataset.edges</code>. Specify a target <code>distance()</code> (the default is 30 pixles), and this force will struggle agains any competing forces to achieve that distance.</p></li><li><p><code>d3.forceCenter()</code>: This force centers the entire simulation around whatever point you specify with <code>x()</code> and <code>y()</code>.</p></li></ul><h4 id="Creating-the-Visual-Elements"><a href="#Creating-the-Visual-Elements" class="headerlink" title="Creating the Visual Elements"></a>Creating the Visual Elements</h4><p>After defining our force simulation, we proceed to generate visual elements.</p><p>First we create a line for each edge:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create edges as lines</span></span><br><span class="line"><span class="keyword">const</span> edges = svg.selectAll(<span class="string">'line'</span>)</span><br><span class="line">  .data(dataset.edges)</span><br><span class="line">  .enter()</span><br><span class="line">  .append(<span class="string">'line'</span>)</span><br><span class="line">  .style(<span class="string">'stroke'</span>, <span class="string">'#ccc'</span>)</span><br><span class="line">  .style(<span class="string">'stroke-width'</span>, <span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>Then create a circle for each node:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> nodes = svg.selectAll(<span class="string">'circle'</span>)</span><br><span class="line">  .data(dataset.nodes)</span><br><span class="line">  .enter()</span><br><span class="line">  .append(<span class="string">'circle'</span>)</span><br><span class="line">  .attr(<span class="string">'r'</span>, <span class="number">10</span>)</span><br><span class="line">  .style(<span class="string">'fill'</span>, (d, i) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> colors(i)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><p>Add simple tooltip:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Add a simple tooltip</span></span><br><span class="line"></span><br><span class="line">nodes.append(<span class="string">'title'</span>)</span><br><span class="line">  .text(<span class="function">(<span class="params">d</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> d.name</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><h4 id="Updating-Visuals-Over-Time"><a href="#Updating-Visuals-Over-Time" class="headerlink" title="Updating Visuals Over Time"></a>Updating Visuals Over Time</h4><p>D3âs force simulation âticksâ forward through time, just like every other physics simulation. With each tick, the simulation adjusts the position values for each node and edge according to the rules we specified when the layout was first initialized. To see this progress visually, we need to update the associated elements â the lines and circles â on every tick.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Every time the simulation 'ticks', this will be called</span></span><br><span class="line">force.on(<span class="string">'tick'</span>, () =&gt; &#123;</span><br><span class="line">  edges.attr(<span class="string">'x1'</span>, d =&gt; (d.source.x))</span><br><span class="line">    .attr(<span class="string">'y1'</span>, d =&gt; (d.source.y))</span><br><span class="line">    .attr(<span class="string">'x2'</span>, d =&gt; (d.target.x))</span><br><span class="line">    .attr(<span class="string">'y2'</span>, d =&gt; (d.target.y))</span><br><span class="line"></span><br><span class="line">  nodes.attr(<span class="string">'cx'</span>, d =&gt; (d.x))</span><br><span class="line">    .attr(<span class="string">'cy'</span>, d =&gt; (d.y))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>This tells D3, âOk, every time you tick, take the new (x, y) values for each line and circle and update them in the DOMâ</p><p>Here the (x, y) are calculated and appeded by D3.</p><h4 id="Draggable-Nodes"><a href="#Draggable-Nodes" class="headerlink" title="Draggable Nodes"></a>Draggable Nodes</h4><p>Add the <code>call()</code> statement to our <code>Nodes</code>:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.cal(d3.drag()</span><br><span class="line">  .on(<span class="string">'start'</span>, dragStarted)</span><br><span class="line">  .on(<span class="string">'drag'</span>, dragging)</span><br><span class="line">  .on(<span class="string">'end'</span>, dragEnded))</span><br></pre></td></tr></table></figure><p>This bit code âcallsâ the <code>d3.drag()</code> method on each node.</p><p><code>d3.drag()</code>, in turn, sets event listeners for the three drag-related events, and specifies functions to trigger whenever one of those events occurs.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dragStarted</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!d3.event.active) force.alphaTarget(<span class="number">0.3</span>).restart()</span><br><span class="line">  d.fx = d.x</span><br><span class="line">  d.fy = d.y</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dragging</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">  d.fx = d3.event.x</span><br><span class="line">  d.fy = d3.event.y</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dragEnded</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!d3.event.active) force.alphaTarget(<span class="number">0</span>)</span><br><span class="line">  d.fx = <span class="literal">null</span></span><br><span class="line">  d.fy = <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Geomapping"><a href="#Geomapping" class="headerlink" title="Geomapping"></a>Geomapping</h1><p>â¦</p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Simple Usage of SW</title>
      <link href="/2017/07/01/Simple-usage-of-SW/"/>
      <content type="html"><![CDATA[<h1 id="Register"><a href="#Register" class="headerlink" title="Register"></a>Register</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">navigator.serviceWorker.register(<span class="string">'your_service_worker,js'</span>, &#123; <span class="attr">scope</span>: <span class="string">'your_path_name'</span> &#125;)</span><br><span class="line">.then(<span class="function">(<span class="params">worker</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'[SW] Registration succeeded.'</span>)</span><br><span class="line">&#125;).catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'[SW] Registration failed with '</span> + err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="Unregister"><a href="#Unregister" class="headerlink" title="Unregister"></a>Unregister</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">navigator.serviceWorker.getRegistration(<span class="string">'your_service_worker.js'</span>, &#123; <span class="attr">scope</span>: <span class="string">'your_path_name'</span> &#125;)</span><br><span class="line">.then(<span class="function">(<span class="params">worker</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (worker &amp;&amp; worker.unregister) &#123;</span><br><span class="line">    worker.unregister()</span><br><span class="line">    .then(<span class="function">(<span class="params">isUnregistered</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (isUnregistered) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'[SW] Unregister succeeded'</span>)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'[SW] Unregister failed'</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">.catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'[SW] Unregister failed with '</span> + err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="Worker-js"><a href="#Worker-js" class="headerlink" title="Worker.js"></a>Worker.js</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">self.addEventListener(<span class="string">'install'</span>, (event) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'[Worker] installing'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">self.addEventListener(<span class="string">'activate'</span>, (event) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'[Worker] ready'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">self.addEventListener(<span class="string">'fetch'</span>, (event) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(event.request.url)</span><br><span class="line">  <span class="keyword">return</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="LifeCycle"><a href="#LifeCycle" class="headerlink" title="LifeCycle"></a>LifeCycle</h1><p><img src="http://foio.github.io/images/sw-lifecycle.png" alt=""></p><h1 id="Download-and-Parse"><a href="#Download-and-Parse" class="headerlink" title="Download and Parse"></a>Download and Parse</h1><p>After registration of Service Worker, browser will download and parse the script from specified url.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* In main.js */</span></span><br><span class="line"><span class="keyword">if</span> (<span class="string">'serviceWorker'</span> <span class="keyword">in</span> navigator) &#123;</span><br><span class="line">  navigator.serviceWorker.register(<span class="string">'./sw.js'</span>)</span><br><span class="line">  .then(<span class="function">(<span class="params">worker</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Service Worker Registered'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Service Worker Failed to Register'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Installing"><a href="#Installing" class="headerlink" title="Installing"></a>Installing</h1><p>After successfully parsed, browser will install the Service Worker. Once the Install finished, the worker will emit <code>install</code> event, and waiting for <code>activating</code>. If the install failed, Service Worker will be <code>Redundant</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* In sw.js */</span></span><br><span class="line">self.addEventListener(<span class="string">'install'</span>, (event) =&gt; &#123;</span><br><span class="line">  event.waitUntil(</span><br><span class="line">    caches.open(currentCacheName)</span><br><span class="line">    .then(<span class="function">(<span class="params">cache</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> cache.addAll(arrayOfFilesToCache)</span><br><span class="line">    &#125;)</span><br><span class="line">  )</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>If there is an <code>event.waitUntil(promiseObj)</code> method in the event, the installing event will not be successful until the Promise within it is solved. If the Promise is rejected, the install event fails and the Service Worker became <strong>redundant</strong></p><h1 id="Installed-Waiting"><a href="#Installed-Waiting" class="headerlink" title="Installed / Waiting"></a>Installed / Waiting</h1><p>If the installation is successful, the Service Worker moves to the <strong>installed</strong>(also called <strong>waiting</strong>) state. In this state it is a valid, but not yet active, worker. It is not yet in control of the document., but rather is waiting to take control form the current worker.</p><h1 id="Activating"><a href="#Activating" class="headerlink" title="Activating"></a>Activating</h1><p>The <strong>activating</strong> state will be triggered for a waiting Service Worker in one of the following scenarios -</p><ul><li><p>if there is no current active worker already</p></li><li><p>if the <code>self.skipWaiting()</code> method is called in the Service Worker script</p></li><li><p>if the user has navigated away from the page, thereby releasing the previous active worker.</p></li><li><p>if a specified period of time has passed, thereby releasing the previous active worker</p></li></ul><p>During the activating state, the <strong>active</strong> event in the Service Worker script is carried out. In a typical activate event, we clear files from old caches.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* In sw.js */</span></span><br><span class="line">self.addEventListener(<span class="string">'activate'</span>, (event) =&gt; &#123;</span><br><span class="line">  event.waitUntil(</span><br><span class="line">    <span class="comment">// get all the cache names</span></span><br><span class="line">    caches.keys().then(<span class="function">(<span class="params">cacheNames</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.all(</span><br><span class="line">        cacheNames.filter(<span class="function">(<span class="params">cacheName</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">        &#125;)</span><br><span class="line">      )</span><br><span class="line">    &#125;)</span><br><span class="line">  )</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="Activate"><a href="#Activate" class="headerlink" title="Activate"></a>Activate</h1><p>If the worker is activated, it will emit <code>active</code> event, and take over all fetch from page. If active failed, the worker will be <code>Redundant</code></p><h1 id="Redundant"><a href="#Redundant" class="headerlink" title="Redundant"></a>Redundant</h1><p>Once a worker is redundant, it wonât have effect on page.</p><h1 id="Dependencies"><a href="#Dependencies" class="headerlink" title="Dependencies"></a>Dependencies</h1><ul><li><p>fetch</p></li><li><p>promise</p></li><li><p>CacheStorage: store Cache Object</p></li><li><p>Cache: store Request/Response Pair Object</p></li></ul><p><img src="http://foio.github.io/images/sw-cache-storage.png" alt=""></p><h1 id="Example-Cache-Static-Resource"><a href="#Example-Cache-Static-Resource" class="headerlink" title="Example: Cache Static Resource"></a>Example: Cache Static Resource</h1><ul><li><p>listen to install to cache static resource</p></li><li><p>listen to fetch to intercept request and return cached static Resource</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> CACHE_NAME = <span class="string">'my-site-cache-v1'</span></span><br><span class="line"><span class="keyword">var</span> urlsToCache = [</span><br><span class="line">  <span class="string">'/'</span>,</span><br><span class="line">  <span class="string">'/styles/main.css'</span>,</span><br><span class="line">  <span class="string">'/script/main.js'</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">// cache resource after installation</span></span><br><span class="line">self.addEventListener(<span class="string">'install'</span>, (event) =&gt; &#123;</span><br><span class="line">  <span class="comment">// perform install steps</span></span><br><span class="line">  event.waitUntil(</span><br><span class="line">    caches.open(CACHE_NAME)</span><br><span class="line">    .then(<span class="function">(<span class="params">cache</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'Opened Cache'</span>)</span><br><span class="line">      <span class="keyword">return</span> cache.addAll(urlsToCache)</span><br><span class="line">    &#125;)</span><br><span class="line">  )</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// listen to fetch, use cache if cached</span></span><br><span class="line">self.addEventListener(<span class="string">'fetch'</span>, (event) =&gt; &#123;</span><br><span class="line">  event.responseWith(</span><br><span class="line">    caches.match(event.request)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (response) &#123;</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> fetch(event.request)</span><br><span class="line">    &#125;)</span><br><span class="line">  )</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="Version-Controls"><a href="#Version-Controls" class="headerlink" title="Version Controls"></a>Version Controls</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> deleteObsoleteCache = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> caches.keys().then(<span class="function">(<span class="params">keys</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> all = keys.map(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (key.indexOf(CACHE_PREFIX) !== <span class="number">-1</span> &amp;&amp; key.indexOf(CACHE_VERSION) === <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'[SW] Delete cache: '</span> + key)</span><br><span class="line">        <span class="keyword">return</span> caches.delete(key)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.all(all)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Whitelist"><a href="#Whitelist" class="headerlink" title="Whitelist"></a>Whitelist</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// resource whitelist</span></span><br><span class="line"><span class="keyword">const</span> allAssets = [</span><br><span class="line">  <span class="string">'//your.cdn.com/app.css'</span>,</span><br><span class="line">  <span class="string">'//your.cdn.com/app.js'</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">// match</span></span><br><span class="line"><span class="keyword">const</span> matchAssets = <span class="function">(<span class="params">requestUrl</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> urlObj = <span class="keyword">new</span> URL(requestUrl)</span><br><span class="line">  <span class="keyword">const</span> noProtocolUrl = urlObj.href.substr(urlObj.protocol.length)</span><br><span class="line">  <span class="keyword">if</span> (allAssets.includes(noProtocolUrl)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// listen to fetch, proxy fetch matching Whitelist</span></span><br><span class="line">self.addEventListener(<span class="string">'fetch'</span>, (event) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> requestUrl = event.target.url</span><br><span class="line">    <span class="keyword">const</span> isGet = event.request.method === <span class="string">'GET'</span></span><br><span class="line">    <span class="keyword">const</span> assetMatches = matchAssets(requestUrl)</span><br><span class="line">    <span class="keyword">if</span> (!assetMatches || !isGet) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> resource = cacheFirstResponse(event)</span><br><span class="line">    event.responseWith(resource)</span><br><span class="line">  &#125; cache (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'[SW] handle fetch event error'</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Glossary of Terms on InfluxDB</title>
      <link href="/2017/07/01/Glossary-of-Terms-on-InfluxDB/"/>
      <content type="html"><![CDATA[<h1 id="aggregation"><a href="#aggregation" class="headerlink" title="aggregation"></a>aggregation</h1><p>An InfluxQL function that returns an aggregated value across a set of points</p><h1 id="batch"><a href="#batch" class="headerlink" title="batch"></a>batch</h1><p>A collection of points in line protocol format, separated by newlines(0x0A). A batch of points may be submitted to the database using a single HTTP request to the write endpoint. This makes writes via the HTTP API much more performant by drastically reducting the HTTP overhead. InfluxData recommends batch size of 5,000-10,000 points, although different use cases may be better served by significantly smaller or larger batches.</p><h1 id="continuous-query-CQ"><a href="#continuous-query-CQ" class="headerlink" title="continuous query(CQ)"></a>continuous query(CQ)</h1><p>An InfluxQL query that runs automatically and periodically within a database. Continuous queries require a function in the <code>SELECT</code> clause and must include a <code>GROUP BY time()</code> clause.</p><h1 id="database"><a href="#database" class="headerlink" title="database"></a>database</h1><p>A logical container for users, retention policies, continuous queries, and time series data.</p><h1 id="duration"><a href="#duration" class="headerlink" title="duration"></a>duration</h1><p>The attribute of the retention policy that determines how long InfluxDB stores data. Data older than the duration are automatically dropped from the database.</p><h1 id="field"><a href="#field" class="headerlink" title="field"></a>field</h1><p>The key-value pair in InfluxDBâs data structure that records metadata and the actual data value. Fields are required in InfluxDBâs data structure and they are not indexed - queries on field values scan all points that match the specified time range and , as a result, are not performant relative to tags.</p><blockquote><p>Query tip: Compare fields to tags: tags are indexed</p></blockquote><h1 id="field-key"><a href="#field-key" class="headerlink" title="field key"></a>field key</h1><p>The key part of the key-value pair that makes up a field. Field keys are strings and they store metadata.</p><h1 id="field-set"><a href="#field-set" class="headerlink" title="field set"></a>field set</h1><p>The collection of field keys and field values on a point.</p><h1 id="field-value"><a href="#field-value" class="headerlink" title="field value"></a>field value</h1><p>The value part of the key-value pair that makes up a field. Field values are the actual data: they can be strings, floats, integers, or booleans. A field value is always associated with a timestamp.</p><p>Field values are not indexed - queries on field values scan all points that match the specified time range and, as a result, are not performant.</p><h1 id="function"><a href="#function" class="headerlink" title="function"></a>function</h1><p>InfluxQL aggregation, selectors, and transformations.</p><h1 id="identifier"><a href="#identifier" class="headerlink" title="identifier"></a>identifier</h1><p>Tokens that refer to continuous query names, database names, field keys, measurement names, retention policy names, subscription names, tag keys and user names.</p><h1 id="line-protocol"><a href="#line-protocol" class="headerlink" title="line protocol"></a>line protocol</h1><p>The text based format for writing points to InfluxDB.</p><h1 id="measurement"><a href="#measurement" class="headerlink" title="measurement"></a>measurement</h1><p>The part of InfluxDBâs structure that describes the data stored in the associated fields. Measurements are strings.</p><h1 id="metastore"><a href="#metastore" class="headerlink" title="metastore"></a>metastore</h1><p>Contains internal information about the status of the system. The metastore contains the user information, databse, retention policies, shard metadata, continuous queries, and subscriptions.</p><h1 id="node"><a href="#node" class="headerlink" title="node"></a>node</h1><p>An independent <code>influxd</code> process</p><h1 id="now"><a href="#now" class="headerlink" title="now()"></a>now()</h1><p>The local serverâs nanosecond timestamp</p><h1 id="point"><a href="#point" class="headerlink" title="point"></a>point</h1><p>The part of InfluxDBâs data structure taht consists of a single collection of fields in a series. Each point is uniquely idenfified by its series and timestamp.</p><p>You cannot store more than one point with the same timestamp in the same series. Instead, when you write a new point to the same series with the same timestamp as an existing point in that series, the field set becomes the union of the old field set and the new field set, where any ties tgo to the new field set.</p><h1 id="query"><a href="#query" class="headerlink" title="query"></a>query</h1><p>An operation that retrieves data from InfluxDB.</p><h1 id="replication-factor"><a href="#replication-factor" class="headerlink" title="replication factor"></a>replication factor</h1><p>The attribute of the retention policy that determines how many copies of the data are stored <strong>in the cluster</strong>.</p><blockquote><p>Replication factors do not seve a purpose with single node instances.</p></blockquote><h1 id="retention-policy-RP"><a href="#retention-policy-RP" class="headerlink" title="retention policy (RP)"></a>retention policy (RP)</h1><p>The part of InfluxDBâs data structure that describes for how long InfluxDB keeps data(ducation), how many copies of those data are stored in the cluster(<strong>replication factor</strong>), and the time range covered by shard groups(shard group duration). RPs are unique per databse and along with the measurement and tag set define a series.</p><p>When you create a database, InfluxDB automatically creates a retention policy called <code>autogen</code> with an infinite duration, a replication factor set to one, and a shard group duration set to seven days.</p><h1 id="schema"><a href="#schema" class="headerlink" title="schema"></a>schema</h1><p>How the data are organized in InfluxDB. The fundamentals of the InfluxDB schema are database, retention policies, series, measurements, tag keys, tag values, and field keys.</p><h1 id="selector"><a href="#selector" class="headerlink" title="selector"></a>selector</h1><p>An InfluxQL function that returns a single point from the range of specified points.</p><h1 id="series"><a href="#series" class="headerlink" title="series"></a>series</h1><p>The collection of data in InfluxDBâs data structure that share a measurement, tag set and retention policy.</p><blockquote><p>The field set is not part of the series identification.</p></blockquote><h1 id="series-cardinality"><a href="#series-cardinality" class="headerlink" title="series cardinality"></a>series cardinality</h1><p>The number of unique database, measurement, and tag set combinations in an InfluxDB instance.</p><p>For example, assume that an InfluxDB instance has a single database and one measurement. The single measurement has two tag keys: <code>email</code> and <code>status</code>. If there are three different <code>email</code>s, and each email address is associated with two different <code>status</code>, then the series cardinality for the measurement is 6.</p><p>Note that, in some cases, simply performing that multiplication may overestimate series cardinality because of the presence of dependent tags.</p><h1 id="server"><a href="#server" class="headerlink" title="server"></a>server</h1><p>A machine virtual or physical, that is running InfluxDB. There should only be one InfluxDB process per server.</p><h1 id="shard"><a href="#shard" class="headerlink" title="shard"></a>shard</h1><p>A shard contains the actual encoded and compressed data, and is represented by a TSM file on disk. Every shard belongs to one and only one shard group. Multiple shards may exist in a single shard group. Each shard contains a specific set of series. All points falling on a given series in a given shard group will be stored in the same shard(TSM file) on disk.</p><h1 id="shard-duration"><a href="#shard-duration" class="headerlink" title="shard duration"></a>shard duration</h1><p>The shard duration determines hwo much time each shard group spans. The specific interval is determined by the <code>SHARD DURATION</code> of the retention policy.</p><p>For example, given a retention policy with <code>SHARD DURATION</code> set to <code>1w</code>, each shard group will span a single week and contain all points with timestamps in that week.</p><h1 id="shard-group"><a href="#shard-group" class="headerlink" title="shard group"></a>shard group</h1><p>Shard groups are logical container for shards. Shard groups are organized by <strong>time and retention policy</strong>. Every retention policy that contains data has at least one associated shard group. A given shard group contains all shards with data for the interval covered by the shard group. The interval spanned by each shard group is the shard duration.</p><h1 id="subscription"><a href="#subscription" class="headerlink" title="subscription"></a>subscription</h1><p>Subscription allows <code>Kapacitor</code> to receive data from InfluxDB in a push model rather than the pull model based on querying data. When Kapacitor is configured to work with InfluxDB, the subscription will automatically push every write for the subscribed databse form InfluxDB to Kapacitor. Subscription can use TCP or UDP for transmitting the writes.</p><h1 id="tag"><a href="#tag" class="headerlink" title="tag"></a>tag</h1><p>The key-value pair in InfluxDBâs data structure that records metadata. Tags are an optional part of InfluxDBâs data structure but they are useful for storing commonly-queried metadata; tags are indexed so queries on tags are performant</p><h1 id="tag-key"><a href="#tag-key" class="headerlink" title="tag key"></a>tag key</h1><p>The key part of the key-value pair that makes up a tag. Tag keys are strings and they store metadata. Tag keys are indexed so queires on tag keys are performant.</p><h1 id="tag-set"><a href="#tag-set" class="headerlink" title="tag set"></a>tag set</h1><p>The collection of tag keys and tag values on a point.</p><h1 id="tag-value"><a href="#tag-value" class="headerlink" title="tag value"></a>tag value</h1><p>The value part of the key-value pair that makes up a tag. Tag values are strings and they store metadata. Tag values are indexed so queries on tag values are performant.</p><h1 id="timestamp"><a href="#timestamp" class="headerlink" title="timestamp"></a>timestamp</h1><p>The date and time associated with a point. All time in influxDB is UTC.</p><h1 id="transformation"><a href="#transformation" class="headerlink" title="transformation"></a>transformation</h1><p>An InfluxQl function that returns a value or a set of values calculated from specified points, but does not return an aggregated value across those points.</p><h1 id="tsm-Time-Structured-Merge-Tree"><a href="#tsm-Time-Structured-Merge-Tree" class="headerlink" title="tsm (Time Structured Merge Tree)"></a>tsm (Time Structured Merge Tree)</h1><p>The purpose-built data storage format for InfluxDB. TSM allows for greater compaction and higher write and read throughput than exsiting B+ or LSM tree implementations.</p><h1 id="user"><a href="#user" class="headerlink" title="user"></a>user</h1><p>There are two kinds of users in InfluxDB:</p><ul><li><p><em>Admin users</em> have <code>READ</code> and <code>WRITE</code> access to all database and full across to administrative queries and user management commands.</p></li><li><p><em>Non-admin users</em> have <code>READ</code>, <code>WRITE</code>, or <code>ALT</code> (both <code>READ</code>, <code>WRITE</code>) access to per database.</p></li></ul><p>When authentication is enabled, InfluxDB only executes HTTP requests that are spent with a valid username and password.</p><h1 id="values-per-second"><a href="#values-per-second" class="headerlink" title="values per second"></a>values per second</h1><p>The preferred measurement of the rate at which data are persisted to InfluxDB. Write speeds are generally quoted in values per second.</p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>APIs of InfluxDB</title>
      <link href="/2017/06/30/APIs-of-InfluxDB/"/>
      <content type="html"><![CDATA[<p>The InfluxDB API provides a simple way interact with the database. It uses HTTP response codes, HTTP authentication, JWT Token, and basic authentication and responses are returned in JSON.</p><p>The following sections assume your InfluxDB instance is running on <code>localhost</code> port <code>8086</code> and HTTPS is not enabled.</p><h1 id="Endpoints"><a href="#Endpoints" class="headerlink" title="Endpoints"></a>Endpoints</h1><table><thead><tr><th style="text-align:left">Endpoint</th><th style="text-align:left">Description</th></tr></thead><tbody><tr><td style="text-align:left">/ping</td><td style="text-align:left">use <code>/ping</code> to check the status of your InfluxDB instance and your version of InfluxDB</td></tr><tr><td style="text-align:left">/query</td><td style="text-align:left">use <code>/query</code> to query data and manage databsae, retention policies and users</td></tr><tr><td style="text-align:left">/write</td><td style="text-align:left">use <code>/write</code> to write data to a pre-exising databse</td></tr></tbody></table><h2 id="ping"><a href="#ping" class="headerlink" title="/ping"></a>/ping</h2><p>The ping endpoint accepts both <code>GET</code> and <code>POST</code> HTTP requests. Use this endpoint to check the status of your InfluxDB instance and your version of InfluxDB.</p><h3 id="Definition"><a href="#Definition" class="headerlink" title="Definition"></a>Definition</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET http://localhost:8086/ping</span><br><span class="line"></span><br><span class="line">HEAD http://localhost:8086/ping</span><br></pre></td></tr></table></figure><h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><p>Extract the version of your InfluxDB instance in the <code>X-Influxdb-Version</code> field of the header</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ curl -sl -I localhost:8086/ping</span><br><span class="line"></span><br><span class="line">HTTP/1.1 204 No Content</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Request-Id: [...]</span><br><span class="line">X-Influxdb-Version: 1.2.x</span><br><span class="line">Date: Wed, 01 Mar 2017 00:09:51 GMT</span><br></pre></td></tr></table></figure><h3 id="Status-Codes-and-Responses"><a href="#Status-Codes-and-Responses" class="headerlink" title="Status Codes and Responses"></a>Status Codes and Responses</h3><p>The response body is empty</p><table><thead><tr><th style="text-align:center">HTTP Status Code</th><th style="text-align:center">Description</th></tr></thead><tbody><tr><td style="text-align:center">      204</td><td style="text-align:center">Success! Your InfluxDB instance is up and running</td></tr></tbody></table><h2 id="query"><a href="#query" class="headerlink" title="/query"></a>/query</h2><p>The <code>/query</code> endpoint accepts <code>GET</code> and <code>POST</code> HTTP requests. Use this endpoint to query data and manage databases, retention policies, and users.</p><h3 id="Definition-1"><a href="#Definition-1" class="headerlink" title="Definition"></a>Definition</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET http://localhost:8086/query</span><br><span class="line"></span><br><span class="line">POST http://localhost:8086/query</span><br></pre></td></tr></table></figure><h3 id="Verb-usage"><a href="#Verb-usage" class="headerlink" title="Verb usage"></a>Verb usage</h3><table><thead><tr><th style="text-align:center">verb</th><th style="text-align:center">Query Type</th></tr></thead><tbody><tr><td style="text-align:center">GET</td><td style="text-align:center">use for all queries that start with <code>SETECT</code>, <code>SHOW</code></td></tr><tr><td style="text-align:center">POST</td><td style="text-align:center">use for all queries that start with <code>ALTER</code>, <code>CREATE</code>, <code>DELETE</code>, <code>DROP</code>, <code>GRANT</code>, <code>KILL</code>, <code>REVOKE</code></td></tr></tbody></table><blockquote><p>THe only exceptions are <code>SELECT</code> queries that include an <code>INTO</code> <strong>clause</strong>. Those <code>SELECT</code> queries require a <code>POST</code> request.</p></blockquote><h4 id="Example-1"><a href="#Example-1" class="headerlink" title="Example"></a>Example</h4><h5 id="Example-1-Query-data-with-a-SELECT-statement"><a href="#Example-1-Query-data-with-a-SELECT-statement" class="headerlink" title="Example 1: Query data with a SELECT statement"></a>Example 1: Query data with a <code>SELECT</code> statement</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -G <span class="string">'http://localhost:8086/query?db=mydb'</span> --data-urlencoded <span class="string">'q=SELECT * FROM "mymeas"'</span></span><br><span class="line"></span><br><span class="line">&#123;<span class="string">"results"</span>:[&#123;<span class="string">"statement_id"</span>:0,<span class="string">"series"</span>:[&#123;<span class="string">"name"</span>:<span class="string">"mymeas"</span>,<span class="string">"columns"</span>:[<span class="string">"time"</span>,<span class="string">"myfield"</span>,<span class="string">"mytag1"</span>,<span class="string">"mytag2"</span>],<span class="string">"values"</span>:[[<span class="string">"2017-03-01T00:16:18Z"</span>,33.1,null,null],[<span class="string">"2017-03-01T00:17:18Z"</span>,12.4,<span class="string">"12"</span>,<span class="string">"14"</span>]]&#125;]&#125;]&#125;</span><br></pre></td></tr></table></figure><p>The <code>mymeas</code> <strong>measurement</strong> has two points. The first point has the <strong>timestamp</strong> <code>2017-03--1T00:15:18Z</code>, a <code>myfield</code> value of <code>33.1</code> and no tag values for the <code>mytag1</code> and <code>mytag2</code> tag keys.</p><p>The second point has the timestamp <code>2017-03--1T00:18:18Z</code>, a <code>myfield</code> value of <code>12</code>, a <code>mymeas</code> value of <code>12</code>, a <code>mytag1</code> value of <code>12</code> and a <code>mytag2</code> value of <code>14</code></p><p>The same query in InfluxDBâs Command Line Interface(CLI) returns the following table:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">name: mymeas</span><br><span class="line">time                   myfield   mytag1   mytag2</span><br><span class="line">----                   -------   ------   ------</span><br><span class="line">2017-03--1T00:15:18Z    33.1</span><br><span class="line">2017-03--1T00:18:18Z    12        12       14</span><br></pre></td></tr></table></figure><h5 id="Example-2-Query-data-with-a-SELECT-statement-and-an-INTO-clause"><a href="#Example-2-Query-data-with-a-SELECT-statement-and-an-INTO-clause" class="headerlink" title="Example 2: Query data with a SELECT statement and an INTO clause"></a>Example 2: Query data with a <code>SELECT</code> statement and an <code>INTO</code> clause</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -XPOST <span class="string">'http://localhost:8086/query?db=mydb'</span> --data-urlencoded <span class="string">'q=SELECT * INTO "newmeas" FROM "mymeas"'</span></span><br></pre></td></tr></table></figure><blockquote><p><code>SELECT</code> queries that include and <code>INTO</code> clause require a <code>POST</code> requests</p></blockquote><h5 id="Example-3-Create-a-database"><a href="#Example-3-Create-a-database" class="headerlink" title="Example 3: Create a database"></a>Example 3: Create a database</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -XPOST <span class="string">'http://localhost:8086/query'</span> --data-urlencoded <span class="string">'q=CREATE DATABASE "mydb"'</span></span><br></pre></td></tr></table></figure><p>A successful <code>CREATE DATABASE</code> query returns no additional information.</p><h4 id="Query-String-Parameter"><a href="#Query-String-Parameter" class="headerlink" title="Query String Parameter"></a>Query String Parameter</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Query String Parameter         |                                            Optional/Required                                             |                                                                                Definition</span><br></pre></td></tr></table></figure><p>:ââââââââââââ: | :ââââââââââââââââââââââââââââââââââ: | :ââââââââââââââââââââââââââââââââââââââââââââââââââââââââ: chunked=[true | &lt;number_of_points] | Optional | Returns points in streamed batches instead of in a single response. If set to <code>true</code>, InfluxDB chunks responses by series or by every 10,000 point, whichever occurs first. It set to a specific value, InfluxDB chunks responses by series or by that number of points db=</p>&lt;database_name&gt;<br>&lt;/database_name&gt;<p> | Required for database-dependent queries(most <code>SELECT</code> queries and <code>SHOW</code> queries require this parameter) | Sets the target database for the query epoch=[ns,u,ms,s,m,h] | Optional | Returns epoch timestamps with the specified precision. By default, InfluxDB returns timestamps in RFC3339 format with nanosecond precision. Both <code>u</code> indicate microsecond p=</p><password><br></password><p> | Optional if you havenât enabled authentication. Required if youâve enabled authentication | Sets the password for authentication if youâve enabled authentication. Use with the query string parameter <code>u</code> pretty=true | Optional | Enables pretty-printed JSON output. While this is useful for debugging it is not recommended for production use as it consumes unnecessary network bandwidth u=</p><username><br></username><p> | Optional if you havenât enabled authentication. Required if youâve enabled authentication | Sets the username for authentication if youâve enabled authentication. The user must have read access to the database. Use with the query string parameter <code>p</code></p><blockquote><p>In versions 1.2.0 and 1.2.1, InfluxDB automatically truncates the number of rows returned for requests without the <code>chunked</code> parameter. By default, the maximum number of rows returned is set to 10000, if a query has more than 10000 rows to return, InfluxDB includes a <code>&#39;partial&#39;: true</code> tag in the response body.</p></blockquote><blockquote><p>The HTTP API also supports basic authentication. Use basic authentication if youâve enabled authentication and arenât using the query string parameter <code>u</code> and <code>p</code>.</p></blockquote><h5 id="Example-Create-a-database-using-HTTP-authentication"><a href="#Example-Create-a-database-using-HTTP-authentication" class="headerlink" title="Example: Create a database using HTTP authentication"></a>Example: Create a database using HTTP authentication</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -XPOST <span class="string">'http://localhost:8086/query?u=myusername&amp;p=mypassword'</span> --data-urlencoded <span class="string">'q=CREATE DATABASE "mydb"'</span></span><br></pre></td></tr></table></figure><h2 id="write"><a href="#write" class="headerlink" title="/write"></a>/write</h2><p>The <code>/write</code> endpoint accepts <code>POST</code> HTTP requests. Use this endpoint to write data to a pre-existing databse.</p><h3 id="Definition-2"><a href="#Definition-2" class="headerlink" title="Definition"></a>Definition</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST http://localhost:8086/write</span><br></pre></td></tr></table></figure><h3 id="Query-String-Parameter-1"><a href="#Query-String-Parameter-1" class="headerlink" title="Query String Parameter"></a>Query String Parameter</h3><pre><code>Query String Parameter                 | Optional/Required                                                                         | Description</code></pre><p>:âââââââââââââââââ: | :âââââââââââââââââââââââââââââ- | :âââââââââââââââââââââââââââââââââââââââââââââââââââââ<br>                  consistency=[any                    | one                                                                                       | quorum                                                                                                                                                          | all] | Optional, available with InfluxEnterprise clusters only | Sets the write consistency for the point. InfluxDB assumes that the write consistency is <code>one</code> if you do not specify <code>consistency</code><br>             db=</p><p><database><br></database>              | Required                                                                                  | Sets the target database for the write<br>             p=</p><p><password><br></password>               | Optional if you havenât enabled authentication. Required if youâve enabled authentication | Sets the password for authentication if youâve enabled authentication. Use with the query string parameter <code>u</code><br>               precision=[ns,u,ms,m,h]                | Optional                                                                                  | Sets the precision for the supplied Unix time values. InfluxDB assumes that timestamps are in nanoseconds if you do not specify <code>precision</code><br>rp=</p><p>&lt;retention_policy_name&gt;<br>&lt;/retention_policy_name&gt; | Optional                                                                                  | Sets the target retention policy for the write. InfluxDB writes to the <code>DEFAULT</code> retention policy if you do not specify a retention policy<br>             u=</p><p><username><br></username>               | Optional if you havenât enabled authentication. Required if youâve enabled authentication | Sets the username for authentication if youâve enabled authentication. The user must have write access to the database. Use with the query string parameter <code>p</code></p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Writing Data in InfluxDB With HTTP API</title>
      <link href="/2017/06/30/Writing-Data-in-InfluxDB-with-HTTP-API/"/>
      <content type="html"><![CDATA[<h1 id="Create-a-database-using-the-HTTP-API"><a href="#Create-a-database-using-the-HTTP-API" class="headerlink" title="Create a database using the HTTP API"></a>Create a database using the HTTP API</h1><p>To create a database send a <code>POST</code> request to the <code>/query</code> endpoint and set the URL parameter <code>q</code> to <code>CREATE DATABASE &lt;new_database_name&gt;</code>. The example below sends a request to InfluxDB running on <code>locahost</code> and create the database <code>mydb</code>.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -i -XPOST http://localhost:8086/query --data-urlencoded <span class="string">"q=CREATE DATABASE mydb"</span></span><br></pre></td></tr></table></figure><h1 id="Writing-data-using-the-HTTP-API"><a href="#Writing-data-using-the-HTTP-API" class="headerlink" title="Writing data using the HTTP API"></a>Writing data using the HTTP API</h1><p>The HTTP API is the primary means of writing data into InfluxDB, by sending <code>POST</code> requests to the <code>/write</code> endpoint. The example below writes a single point to the <code>mydb</code> database. The data consist of the <strong>measurement</strong> <code>cpu_load_short</code>. the <strong>tag keys</strong> <code>host</code> and <code>region</code> with the <strong>tag values</strong> <code>server01</code> and <code>us-west</code>, the <strong>field key</strong> <code>value</code> with a <strong>field value</strong> of <code>0.64</code> and the <strong>timestamp</strong> <code>434055562000000000</code>.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -i -XPOST <span class="string">'http://localhost:8086/write?db=mydb'</span> --data-binary <span class="string">'cpu_load_short,host=server01,region=us-west value=0.64 1434055562000000000'</span></span><br></pre></td></tr></table></figure><p>When writing points, you must specify an existing database in the <code>db</code> query parameter. Points will be written to <code>db</code>âs default retention policy if you do not supply a retention policy via the <code>rp</code> query parameter.</p><p>The body of the POST - we call this the <code>Line Protocol</code> - contains the time-series data that you wish to store. They consist of a <strong>measurement</strong>, <strong>tags</strong>, <strong>fields</strong>, and a <strong>timestamp</strong>. InfluxDB requires a measurement name.</p><p>Strictly speaking, tags are optional but most series include tags to differentiate data sources and to make querying both easy and efficient. Both tag keys and tag values are strings.</p><p>Field keys are required and always strings, and <strong>by default</strong>, field values are floats. The timestamp - supplied at the end of the line in Unix time in nanoseconds since January 1, 1970 UTC - is optional. If you do not specify a timestamp InfluxDB uses the serverâs local nanoseconds timestamp in Unix epoch.</p><p>Anything that has to do with tim ein InfluxDB is always UTC.</p><h2 id="Writing-multiple-points"><a href="#Writing-multiple-points" class="headerlink" title="Writing multiple points"></a>Writing multiple points</h2><p>Post multiple points to multiple series at the same time by separating each point with a new line. Batching points in this manner results in much higher performance.</p><p>The following example writes three points to the database <code>mydb</code>.</p><p>The first point belongs to the series with the measurement <code>cpu_load_short</code> and tag set <code>host-server02</code> and has the serverâs local timestamp</p><p>The second point belongs to the series with the measurement <code>cpu_load_short</code> and tag set <code>host=server02,region=us-west</code> and has the specified timestamp <code>1422568543702900257</code>.</p><p>The third point has the same specified timestamp as the second point, but it is written to the series with the measruement <code>cpu_load_short</code> and tag set <code>direction=in,host=server01,region=us-west</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -i -XPOST <span class="string">'http://localhost:8086/write?db=mydb'</span> --data-binary <span class="string">'cpu_load_short,host=server02 value=0.67 cpu_load_short,host=server02,region=us-west value=0.5 cpu_load_short,direction=in,host=server01,region=us-west value=0.2'</span></span><br></pre></td></tr></table></figure><h2 id="Writing-points-from-a-file"><a href="#Writing-points-from-a-file" class="headerlink" title="Writing points from a file"></a>Writing points from a file</h2><p>Write points from a <strong>file</strong> by passing <code>@filename</code> to <code>curl</code>. The data in the file should follow InfluxDBâs <strong>line protocol syntax</strong></p><p>Example of a properly-formatted file(<code>cpu_data.txt</code>)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cpu_load_short,host=server02 value=0.2</span><br><span class="line">cpu_load_short,host=server02,region=us-west value=0.5</span><br><span class="line">cpu_load_short,direction=in,host=server01,region=us-west value=0.2</span><br></pre></td></tr></table></figure><p>Write the data in <code>cpu_data.txt</code> to the <code>mydb</code> datbase with:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -i -XPOST <span class="string">'http://localhost:8086/write?db=mydb'</span> --data-binary @cpu_data.txt</span><br></pre></td></tr></table></figure><blockquote><p>Note: If your data file has more than 5000 points, it may be necessary to split that file into several files in order to write your data in batches to influxDB. By default, the HTTP request times out after five seconds. InfluxDB will still attempt to write the points after that time out but there will be no confirmation that they were successfully written.</p></blockquote><h2 id="Schemaless-Design"><a href="#Schemaless-Design" class="headerlink" title="Schemaless Design"></a>Schemaless Design</h2><p>InfluxDB is a schemaless database. You can add new measurement, tags, and fields at any time. Note that if you attempt to write data with a different type than previous used(for example, writing a string to a field that previously accepted integers), InfluxDB will reject those data.</p><h2 id="HTTP-response-summary"><a href="#HTTP-response-summary" class="headerlink" title="HTTP response summary"></a>HTTP response summary</h2><ul><li><p>2xx: If you write request received <code>HTTP 204 No Content</code>, it was a success</p></li><li><p>4xx: InfluxDB could not understand the request</p></li><li><p>5xx: The system is overloaded or significantly impaired.</p></li></ul>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Querying InfluxDB With the HTTP API</title>
      <link href="/2017/06/30/Querying-InfluxDB-with-the-HTTP-API/"/>
      <content type="html"><![CDATA[<p>The HTTP API is the primary means for querying data in InfluxDB.</p><p>To perform a query send a <code>GET</code> request to the <code>/query</code> endpoint, set the URL parameter <code>db</code> as the target database, and set the URL parameter <code>q</code> as your query.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -G <span class="string">'http://localhost:8086/query?pretty=true'</span> --data-urlencode <span class="string">"db=mydb"</span> --data-urlencode <span class="string">"q=SELECT \"value\" FROM \"cpu_load_short\" WHERE \"region\"='us-west'"</span></span><br></pre></td></tr></table></figure><p>InfluxDB returns JSON. The results of your query appear in the <code>&#39;result&#39;</code> array. If an error occurs, InfluxDB sets an <code>&#39;error&#39;</code> key with an explanation of the error.</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"results"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"statement_id"</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">"series"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"name"</span>: <span class="string">"cpu_load_start"</span>,</span><br><span class="line">          <span class="attr">"columns"</span>: [</span><br><span class="line">            <span class="string">"time"</span>,</span><br><span class="line">            <span class="string">"value"</span></span><br><span class="line">          ],</span><br><span class="line">          <span class="attr">"values"</span>: [</span><br><span class="line">            [</span><br><span class="line">                <span class="string">"2015-01-29T21:55:43.702900257Z"</span>,</span><br><span class="line">                <span class="number">2</span></span><br><span class="line">            ],</span><br><span class="line">            [</span><br><span class="line">                <span class="string">"2015-01-29T21:55:43.702900257Z"</span>,</span><br><span class="line">                <span class="number">0.55</span></span><br><span class="line">            ],</span><br><span class="line">            [</span><br><span class="line">                <span class="string">"2015-06-11T20:46:02Z"</span>,</span><br><span class="line">                <span class="number">0.64</span></span><br><span class="line">            ]</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>Note: Appending <code>pretty=true</code> to the URL enables pretty-printed JSON output. While this is useful for debugging or when queryting directly with tools like <code>curl</code>, it is not recommended for production use as it consumes unnecessary network bandwidth.</p></blockquote><h1 id="Multiple-queries"><a href="#Multiple-queries" class="headerlink" title="Multiple queries"></a>Multiple queries</h1><p>Send multiple queries to InfluxDB in a single API call. Simply delimit each query using a semicolon</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -G <span class="string">'http://localhost:8086/query?pretty=true'</span> --data-urlencode <span class="string">"db=mydb"</span> --data-urlencode <span class="string">"q=SELECT \"value\" FROM \"cpu_load_short\" WHERE \"region\"='us-west';SELECT count(\"value\") FROM \"cpu_load_short\" WHERE \"region\"='us-west'"</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Simple About InfluxDB</title>
      <link href="/2017/06/30/Simple-about-InfluxDB/"/>
      <content type="html"><![CDATA[<h1 id="Install-InfluxDB-on-MacOS"><a href="#Install-InfluxDB-on-MacOS" class="headerlink" title="Install InfluxDB on MacOS"></a>Install InfluxDB on MacOS</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew update</span><br><span class="line">brew install influxdb</span><br></pre></td></tr></table></figure><p>To run influxDB at startup, run this command</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -sfv /usr/<span class="built_in">local</span>/opt/influxdb/*.plist ~/Library/LaunchAgents</span><br></pre></td></tr></table></figure><p>Now, to start InfluxDB, run this command(Accept the request of incoming connections in the window that appears)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">influxd -config /usr/<span class="built_in">local</span>/etc/influxdb.conf</span><br></pre></td></tr></table></figure><h1 id="Check-if-InfluxDB-works"><a href="#Check-if-InfluxDB-works" class="headerlink" title="Check if InfluxDB works"></a>Check if InfluxDB works</h1><p>InfluxDB exposes an API with which one can easily check its good working condition. Hereâs what you will receive in return for this curl command</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">curl -sl -I localhost:8086/ping</span><br><span class="line">HTTP/1.1 204 No Content</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Request-Id: 95b307f8-5d6b-11e7-8002-000000000000</span><br><span class="line">X-Influxdb-Version: v1.3.0</span><br><span class="line">Date: Fri, 30 Jun 2017 08:10:31 GMT</span><br></pre></td></tr></table></figure><h1 id="Terminology-difference-with-SQL-database"><a href="#Terminology-difference-with-SQL-database" class="headerlink" title="Terminology, difference with SQL database"></a>Terminology, difference with SQL database</h1><p>Like all non-relational database, InfluxDB for its own vocabulary your need to know before starting</p><ul><li><p><strong>Measurement</strong> is equivalent to <strong>SQL table</strong></p></li><li><p><strong>Tags</strong> is similar to a <strong>indexed column</strong> in a SQL database</p></li><li><p><strong>Fields</strong> is similar to the <strong>column not indexed</strong> in a SQL database</p></li><li><p><strong>Points</strong> is equivalent to <strong>line(row)</strong> in a SQL database</p></li></ul><h1 id="Database-Management-Methods"><a href="#Database-Management-Methods" class="headerlink" title="Database Management Methods"></a>Database Management Methods</h1><p>There are 6 methods to manage database</p><ul><li><p>CREATE DATABASE</p></li><li><p>DROP DATABASE</p></li><li><p>DROP SETS</p></li><li><p>DELETE</p></li><li><p>DROP MEASUREMENT</p></li><li><p>DROP SHARD</p></li></ul><h2 id="Create-a-Database"><a href="#Create-a-Database" class="headerlink" title="Create a Database"></a>Create a Database</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE &lt;database_name&gt; [WITH [DURATION &lt;duration&gt;] [REPLICATION &lt;n&gt;] [SHARD DURATION &lt;shard_duration&gt;] [NAME &lt;retention-policy-name&gt;]]</span><br></pre></td></tr></table></figure><p><strong>Basic Setting</strong></p><ul><li><p>database_name: name of the database</p></li><li><p>duration: you can set the period of data retention(conversation) but it makes more sense to implement a retention policy.</p></li></ul><h2 id="Delete-a-database-drop-database"><a href="#Delete-a-database-drop-database" class="headerlink" title="Delete a database (drop database)"></a>Delete a database (drop database)</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP DATABASE &lt;database_name&gt;</span><br></pre></td></tr></table></figure><h1 id="Establish-a-retention-policy"><a href="#Establish-a-retention-policy" class="headerlink" title="Establish a retention policy"></a>Establish a retention policy</h1><p>InfluxDB incorporates a system of automatic deletion of data. It is the policy of Retention. Spent some time, data is automatically deleted from the base. This mechanism is very convenient because it for a good grasp of size of the base and we donât have to worry about the maintenance operation. Free to each set the lifetime of any particular measure. If you want to follow the temperature of its microprocessor, one less may be sufficient, instead the retention policy must be more flexible if we want to compare the temperature in a House form one year to the other. It will also think about the system upstream, you donât have to store a measurement of atmosphere temperature every 10 seconds! A measurement per minutes, 15 minutes, thatâs enough. Instead in an industrial process, we certainly want to go for the secondâ¦ or a lot less.</p><p>We therefore for 3 methods</p><ul><li><p>Create: to create a rule of conservation of data</p></li><li><p>Alter: to change a rule</p></li><li><p>Drop: to remove a rule</p></li></ul><h1 id="Create-a-retention-policy"><a href="#Create-a-retention-policy" class="headerlink" title="Create a retention policy"></a>Create a retention policy</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE RETENTION POLICY &lt;name_politic_retention&gt; ON &lt;name_database&gt; DURATION: &lt;duration&gt; REPLICATION: &lt;n&gt; [SHARD DURATION &lt;duration duration_shard&gt;] [DEFAULT]</span><br></pre></td></tr></table></figure><p><strong>Parameters</strong></p><ul><li><p>name_politic_retention: a short name without spaces of preference</p></li><li><p>name_database: the database on which applies the retention policy</p></li><li><p>duration: duration of data retention. Itâs a literal expression which must respect the convention InfluxDB</p></li><li><p>duration_shard: the duration of storage of the data in the buffer zone</p></li><li><p>n: number of replication(required), put 1 if no cluster installed</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE RETENTION POLICY <span class="string">'one_day_only'</span> WE <span class="string">'NOAA_water_database'</span> DURATION 1 d REPLICATION 1</span><br></pre></td></tr></table></figure><p>This policy keeps the records during a day(one_day_only) based NOAA_water_database. The data are stored in space shard 1 day. Replication 1 indicates that a copy of each item is copied in the cluster.</p><h1 id="Modify-retention-policy-alter-retention-policy"><a href="#Modify-retention-policy-alter-retention-policy" class="headerlink" title="Modify retention policy(alter retention policy)"></a>Modify retention policy(alter retention policy)</h1><p>This method allows to change an existing retention policy</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER ...</span><br></pre></td></tr></table></figure><h1 id="Destroyed-a-retention-policy-drop-retention-policy"><a href="#Destroyed-a-retention-policy-drop-retention-policy" class="headerlink" title="Destroyed a retention policy(drop retention policy)"></a>Destroyed a retention policy(drop retention policy)</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP RETENTION ...</span><br></pre></td></tr></table></figure><h1 id="Discover-the-InfluxDB-Shell"><a href="#Discover-the-InfluxDB-Shell" class="headerlink" title="Discover the InfluxDB Shell"></a>Discover the InfluxDB Shell</h1><p>Now we know some methods, we will provide to run some test</p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Usage of Node-Influx</title>
      <link href="/2017/06/30/Usage-of-Node-Influx/"/>
      <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>InfluxDB is a time series database, so it would make sense that the concept of time is moderately important when dealing with it.</p><p>By default, Influx will store all dates you give to it as a nanosecond precision timestamp, whereas in JavaScript, most of the time weâre dealing with millisecond precision timestamps, which we get from <code>Date.now()</code> or <code>myDate.getTime()</code>. This presents a bit of a problem for us JavaScripters, since nanosecond-precision timestamps are stored as 64-bit unsigned integers that JavaScript simply cannot represent accurately.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">node-influx git:(master) node</span><br><span class="line">&gt; <span class="number">1475985480231035677</span></span><br><span class="line"><span class="number">1475985480231035600</span></span><br></pre></td></tr></table></figure><p>This module tries to make dates as easy as possible for you to deal with, and out of the box everything should âjust workâ.</p><p>There are three places that dates can get passed around:</p><ul><li><p>Dates coming rom Influx queries, like <code>select * from my_series</code></p></li><li><p>Dates being interpolated <em>into</em> Influx queries</p></li><li><p>Dates being used when writing points on the line protocol, via <code>.writePoints()</code> or <code>.writeMeasurement()</code>.</p></li></ul><p>To deal with this, we introduce a new type called <code>NanoDate</code>. These dates behave just like the normal <code>Date</code> type, but have two additional methods: <code>.getNanoTime()</code> and <code>.getNanoISOString()</code>. They behave just like the normal <code>.getTime()</code> and <code>getISOString</code> methods, but they both return nanosecond-precision strings instead of millisecond-precision numbers and timestamps.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">expect(myNanoDate.getTime()).to.equal(<span class="number">1475985480231</span>)</span><br><span class="line">expect(myNanoDate.getNanoTime()).to.equal(<span class="string">'1475985480231035677'</span>)</span><br><span class="line">expect(myNanoDate.toISOString()).to.equal(<span class="string">'2016-10-09T03:58:00.231Z'</span>)</span><br><span class="line">expect(myNanoDate.toNanoISOString()).to.equal(<span class="string">'2016-10-09T03:58:00.231035677Z'</span>)</span><br></pre></td></tr></table></figure><p>All times returned from Influx queries are parsed to INanoDates. For example you can do something like the following:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">influx.query(<span class="string">'select * from perf'</span>).then(<span class="function"><span class="params">results</span> =&gt;</span> &#123;</span><br><span class="line">  result.forEach(<span class="function"><span class="params">row</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`Used <span class="subst">$&#123;row.cpu&#125;</span> at <span class="subst">$&#123;row.time.toNanoISOString()&#125;</span>`</span>))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>When writing data to Influx, all write methods accept INanoDates in all situation. This means if you select data from Influx and want to update a data point, you can pass the time right back into <code>write</code> method. (Remember, points within series are unique by their time) If you have a nanosecond timestamp from some external source, you can convert it to INanoDate using <code>toNanoDate</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; toNanoDate &#125; <span class="keyword">from</span> <span class="string">'influx'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> myNanoDate = toNanoDate(<span class="string">'1475985480231035600'</span>)</span><br><span class="line">expect(myNanoDate.getTime()).to.equal(<span class="number">1475985480231</span>)</span><br><span class="line">expect(myNanoDate.getNanoTime()).to.equal(<span class="string">'1475985480231035600'</span>)</span><br><span class="line">expect(myNanoDate.toNanoISOString()).to.equal(<span class="string">'2016-10-09T03:58:00.231035600Z'</span>)</span><br></pre></td></tr></table></figure><p>Finally, if you want to embed a iNanoDate into an Influx query, you should use <code>toNanoString</code> to do so:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">influx.query(<span class="string">`select * from perf where time &gt; "<span class="subst">$&#123;myNanoDate.toNanoISOString()&#125;</span>"`</span>)</span><br></pre></td></tr></table></figure><h1 id="Browser-Setup"><a href="#Browser-Setup" class="headerlink" title="Browser Setup"></a>Browser Setup</h1><p>For Node.js, <code>influx</code> can be installed and you can use it out of the box.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add influx@next</span><br></pre></td></tr></table></figure><p>You can tell Webpack to use this module by adding the following section in your <code>webpack.config.js</code>:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = path.resolve(__dirname, <span class="string">'node_modules/stream-http/index.js'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    alias: &#123; http, <span class="attr">https</span>: http &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><h2 id="Class-Summary"><a href="#Class-Summary" class="headerlink" title="Class Summary"></a>Class Summary</h2><table><thead><tr><th style="text-align:center">attr</th><th style="text-align:left">name</th></tr></thead><tbody><tr><td style="text-align:center">public</td><td style="text-align:left">ExponentialBackoff</td></tr><tr><td style="text-align:center">public</td><td style="text-align:left">Expression:<br></td></tr></tbody></table><p>Expression is used to build filtering expression, like those used in WHERE clauses<br>public | InfluxDB:<br><br>InfluxDB is the public interface to run queries against your database<br>public | Measurement:<br><br>Measurement creates a reference to a particular measurement<br>public | Pool:<br><br>The Pool maintains a list available Influx hosts and dispatches requests to them<br>public | Raw:<br><br>You can provide Raw values to Influx methods to prevent it from escaping your provided string.<br>public | RequestError:<br><br>An RequestError is thrown when a query generates errorful results in a 300&lt;= error &lt;=500<br>public | ResultError:<br><br>An ResultError is thrown when a query generates errorful results from Influx<br>public | ServiceNotAvailableError:<br><br>An ServiceNotAvailableError is returned as an error from requests that result in a &gt;500 error code</p><h3 id="interface-Summary"><a href="#interface-Summary" class="headerlink" title="interface Summary"></a>interface Summary</h3><table><thead><tr><th style="text-align:center">attr</th><th style="text-align:left">name</th></tr></thead><tbody><tr><td style="text-align:center">public</td><td style="text-align:left">IBackoffStrategy:<br></td></tr></tbody></table><p>The IBackoffStrategy dictates behavior to use when hosts in the connection pool start failing<br>public | INanoDate:<br><br>An INanoDate is a type of Date that holds a nanosecond-precision unix timestamp<br>public | IResults:<br><br>IResults are returned from the InfluxBD#query mehtod</p><h3 id="Function-Summary"><a href="#Function-Summary" class="headerlink" title="Function Summary"></a>Function Summary</h3><table><thead><tr><th style="text-align:center">attr</th><th style="text-align:left">name</th></tr></thead><tbody><tr><td style="text-align:center">public</td><td style="text-align:left">toNanoDate(timestamp: String): NanoDate:<br></td></tr></tbody></table><p>Covers a nanoseconds unix timestamp to a INanoDate for node-influx.</p><h3 id="Variable-Summary"><a href="#Variable-Summary" class="headerlink" title="Variable Summary"></a>Variable Summary</h3><table><thead><tr><th style="text-align:center">attr</th><th style="text-align:left">name</th></tr></thead><tbody><tr><td style="text-align:center">public</td><td style="text-align:left">Precision: Object</td></tr></tbody></table><p>&lt;string, string=ââ&gt;:<br>Precision is a map of available influx time precision&lt;/string,&gt;<br>public | escape: Object:<br><br>tagEscaper escapes tag keys, tag values and field keys.</p><h3 id="Typedef-Summary"><a href="#Typedef-Summary" class="headerlink" title="Typedef Summary"></a>Typedef Summary</h3><table><thead><tr><th style="text-align:center">attr</th><th style="text-align:left">name</th></tr></thead><tbody><tr><td style="text-align:center">public</td><td style="text-align:left">FieldType: Number:<br></td></tr></tbody></table><p>FieldType is an enumeration of influxDB field data types<br>public | IClusterConfig: Object:<br><br>A IClusterConfig can be provided into <code>new InfluxDB(config)</code> when you have a multiple influx nodes to connect to<br>public | IPingStats: Object:<br><br>IPingStats is returned from InfluxDB#ping<br>public | IPoint: Object<br><br>IPoint is passed to the clientâs write methods to store a point in InfluxDB<br>public | IPoolOptions: Object<br><br>Pool options can be passed into the database to configure the behavior of the connection Pool<br>public | IQueryOptions: Object<br><br>The IQueryOptions allows you to configure how queries are run against Influx<br>public | ISchemaOptions: Object<br><br>Schema options can be passed into the <code>new InfluxDB()</code> constructor to help define the shape of your data.<br>public | ISingleHostConfig: Object<br><br>A ISingleHostConfig can be provided into <code>new InfluxDB(config)</code> when you have a single Influx address to connect to<br>public | IWriteOptions: Object<br><br>IWriteOptions configure how points are written in the database.</p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Example of Node-Influx</title>
      <link href="/2017/06/30/Example-of-node-influx/"/>
      <content type="html"><![CDATA[<h1 id="Express-Response-Times-Example"><a href="#Express-Response-Times-Example" class="headerlink" title="Express Response Times Example"></a>Express Response Times Example</h1><p>In this example weâll create a server which has an index page that prints out âhello worldâ, and a page</p><p><code>http://localhost:3000/times</code> which prints out the last ten response times that influxDB gave us.</p><p>The end result should look something like this:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">curl -s localhost:3000</span><br><span class="line">Hello world</span><br><span class="line"></span><br><span class="line">curl -s localhost:3000/<span class="built_in">times</span> | jq</span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">"time"</span>: <span class="string">"2016-10-09T19:13:26.815Z"</span>,</span><br><span class="line">    <span class="string">"duration"</span>: 205,</span><br><span class="line">    <span class="string">"host"</span>: <span class="string">"ares.peet.io"</span>,</span><br><span class="line">    <span class="string">"path"</span>: <span class="string">"/"</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>Get started by installing and importing everything we need. This example requires Node 6.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install influx express</span><br></pre></td></tr></table></figure><p>Now create a new file <code>app.js</code> and start writing</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Influx = <span class="built_in">require</span>(<span class="string">'../../'</span>)</span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">const</span> os = <span class="built_in">require</span>(<span class="string">'os'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express()</span><br></pre></td></tr></table></figure><p>Create a new influx client. We tell it to use the <code>express_response_db</code> database by default, and give it some information about the schema weâre writing. It can use this to be smarter about what data formats it writes and do some basic validation for us.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> influx = <span class="keyword">new</span> Influx.InfluxBD(&#123;</span><br><span class="line">  host: <span class="string">'localhost'</span>,</span><br><span class="line">  database: <span class="string">'express_response_db'</span>,</span><br><span class="line">  schema: [</span><br><span class="line">    &#123;</span><br><span class="line">      measurement: <span class="string">'response_time'</span>,</span><br><span class="line">      fields: &#123;</span><br><span class="line">        path: Influx.FieldType.STRING,</span><br><span class="line">        duration: Influx.FieldType.INTEGER</span><br><span class="line">      &#125;,</span><br><span class="line">      tags: [</span><br><span class="line">        <span class="string">'host'</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Now we have a working influx client!</p><p>Weâll make sure the database exists and boot the app.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">influx.getDatabaseName()</span><br><span class="line">.then(<span class="function"><span class="params">names</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!names.includes(<span class="string">'express_response_db'</span>)) &#123;</span><br><span class="line">    <span class="keyword">return</span> influx.createDatabase(<span class="string">'express_response_db'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">.then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  http.createServer(app).listen(<span class="number">3000</span>, () =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Listening on port 3000'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">.catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.error(<span class="string">'Error creating Influx database'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Finally weâll define the middleware and routes weâll use. We have a generic middleware that records the time between when requests comes in, and the time we response to them. We also have another route called <code>/times</code> which prints out the last ten timings we recorded.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">app.use(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> start = <span class="built_in">Date</span>.now()</span><br><span class="line">  res.on(<span class="string">'finish'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> duration = <span class="built_in">Date</span>.now() - start</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`Request to <span class="subst">$&#123;req.path&#125;</span> took <span class="subst">$&#123;duration&#125;</span> ms`</span>)</span><br><span class="line">    influx.writePoints([</span><br><span class="line">      &#123;</span><br><span class="line">        measurement: <span class="string">'response_times'</span>,</span><br><span class="line">        tags: &#123; <span class="attr">host</span>: os.hostname() &#125;,</span><br><span class="line">        fields: &#123; duration, <span class="attr">path</span>: req.path &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`Error saving data to InfluxDB: <span class="subst">$&#123;err.stack&#125;</span>`</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> next()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, (req, res) =&gt; &#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> res.end(<span class="string">'Hello world'</span>), <span class="built_in">Math</span>.random() * <span class="number">500</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/times'</span>, (req, res) =&gt; &#123;</span><br><span class="line">  influx.query(<span class="string">`</span></span><br><span class="line"><span class="string">      select * from response_times</span></span><br><span class="line"><span class="string">      where host = <span class="subst">$&#123;Influx.<span class="built_in">escape</span>.stringLit(os.hostname())&#125;</span></span></span><br><span class="line"><span class="string">      order by time desc</span></span><br><span class="line"><span class="string">      limit 10</span></span><br><span class="line"><span class="string">  `</span>).then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">    res.json(result)</span><br><span class="line">  &#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    res.status(<span class="number">500</span>).send(err.stack)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Snippets of Koa Middlewares</title>
      <link href="/2017/06/29/snippets-of-koa-middlewares/"/>
      <content type="html"><![CDATA[<h1 id="koa-compress"><a href="#koa-compress" class="headerlink" title="koa-compress"></a>koa-compress</h1><p>Compress middleware for Koa</p><h2 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> compress = <span class="built_in">require</span>(<span class="string">'koa-compress'</span>)</span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">'koa'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line">app.use(compress(&#123;</span><br><span class="line">  filter: <span class="function">(<span class="params">content_type</span>) =&gt;</span> /text/i.test(content_type),</span><br><span class="line">  threshold: <span class="number">2048</span>,</span><br><span class="line">  flush: <span class="built_in">require</span>(<span class="string">'zlib'</span>).Z_SYNC_FLUSH,</span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure><h2 id="Options"><a href="#Options" class="headerlink" title="Options"></a>Options</h2><p>The options are passed to <code>zlib</code></p><blockquote><p>filter: An optional function that checks the response content type to decide whether to compress. By default, it uses <a href="https://github.com/expressjs/compressible" target="_blank" rel="noopener">compressible</a></p></blockquote><blockquote><p>threshold: Minimum response size in bytes to compress. Default 1024 byte or 1kb.</p></blockquote><h3 id="koa-morgan"><a href="#koa-morgan" class="headerlink" title="koa-morgan"></a>koa-morgan</h3><p>HTTP Request logger middleware for node.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> morgan = <span class="built_in">require</span>(<span class="string">'morgan'</span>)</span><br></pre></td></tr></table></figure><h4 id="morgan-format-options"><a href="#morgan-format-options" class="headerlink" title="morgan(format, options)"></a>morgan(format, options)</h4><p>Create a new morgan logger middleware function using the given <code>format</code> and <code>options</code>.</p><p>The <code>format</code> argument amay be a string of a predefined name, a string fo a format string, or a function that will produce a log entry.</p><p>The <code>format</code> function will be called with three arguments <code>tokens</code>, <code>req</code> and <code>res</code>, where <code>tokens</code> is object with all tokens, <code>req</code> is the HTTP request and <code>res</code> is the HTTP response. The function is expected to return a string that will be the log line, or <code>undefined</code>/<code>null</code> to skip logging.</p><h4 id="predefined-format-string"><a href="#predefined-format-string" class="headerlink" title="predefined format string"></a>predefined format string</h4><blockquote><p><code>combined</code>: Standard Apache combined log output</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:remote-addr - :remote-user [:date[clf]] <span class="string">":method :url HTTP/:http-version"</span> :status :res[content-length] <span class="string">":referrer"</span> <span class="string">":user-agent"</span></span><br></pre></td></tr></table></figure><blockquote><p><code>common</code>: Standard Apache common log output</p></blockquote><blockquote><p><code>dev</code></p></blockquote><blockquote><p><code>short</code></p></blockquote><blockquote><p><code>tiny</code></p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:method :url :status :res[content-length] - :response-time ms</span><br></pre></td></tr></table></figure><h4 id="write-logs-to-a-file"><a href="#write-logs-to-a-file" class="headerlink" title="write logs to a file"></a>write logs to a file</h4><p>Single file</p><p>Simple app that will log all request in the Apache combined format to the file <code>access.log</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">'koa'</span>)</span><br><span class="line"><span class="keyword">const</span> morgan = <span class="built_in">require</span>(<span class="string">'koa-morgan'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> accessLogStream = fs.createWriteStream(__dirname + <span class="string">'/access.log'</span>, &#123; <span class="attr">flags</span>: <span class="string">'a'</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line"></span><br><span class="line"><span class="comment">// setup the logger</span></span><br><span class="line"></span><br><span class="line">app.use(morgan(<span class="string">'combined'</span>, &#123; <span class="attr">stream</span>: accessLogStream &#125;))</span><br><span class="line"></span><br><span class="line">app.use(<span class="function">(<span class="params">ctx</span>) =&gt;</span> &#123;</span><br><span class="line">  ctx.body = <span class="string">'hello world'</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure><h3 id="koa-session"><a href="#koa-session" class="headerlink" title="koa-session"></a>koa-session</h3><p>Simple session middleware for koa. Default is cookie-based session and support external store.</p><p><em>Require Node 7.6 or greater for asycn/await support</em></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> session = <span class="built_in">require</span>(<span class="string">'koa-session'</span>)</span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">'koa'</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line"></span><br><span class="line">app.keys = [<span class="string">'some secret hurr'</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> CONFIG = &#123;</span><br><span class="line">  key: <span class="string">'koa:sess'</span>, <span class="comment">// (string) cookie key, default is koa:sess</span></span><br><span class="line">  maxAge: <span class="number">86400000</span>, <span class="comment">// (number) in ms, default is 1 day,</span></span><br><span class="line">  overWrite: <span class="literal">true</span>, <span class="comment">// (boolean) can overwrite or not, default true</span></span><br><span class="line">  httpOnly: <span class="literal">true</span>, <span class="comment">// (boolean) httpOnly or not, default true</span></span><br><span class="line">  signed: <span class="literal">true</span>, <span class="comment">// (boolean) signed or not, default true</span></span><br><span class="line">  rolling: <span class="literal">false</span>, <span class="comment">// (boolean) Force a session identifier cookie to be set on every response. The expiration is reset to the original maxAge.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.use(session(CONFIG, app)) <span class="comment">// or if you prefer to default config, you can use =&gt; app.use(session(app))</span></span><br><span class="line"></span><br><span class="line">app.use(<span class="function"><span class="params">ctx</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (ctx.path === <span class="string">'/favicon.ico'</span>) <span class="keyword">return</span></span><br><span class="line">  <span class="keyword">let</span> n = ctx.session.views || <span class="number">0</span></span><br><span class="line">  ctx.session.views = ++n</span><br><span class="line">  ctx.body = n + <span class="string">' views'</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'listening on port 3000'</span>)</span><br></pre></td></tr></table></figure><h4 id="Options-1"><a href="#Options-1" class="headerlink" title="Options"></a>Options</h4><p>The cookie name is controlled by the key option, which default to âkoa:sessâ. All other options are passed to <code>ctx.cookies.get()</code> and <code>ctx.cookies.set()</code> allowing you to control security, domain, path and signing among other setting.</p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Git Merge and Rebase</title>
      <link href="/2017/06/14/git-merge-and-rebase/"/>
      <content type="html"><![CDATA[<h1 id="Conceptual-Overview"><a href="#Conceptual-Overview" class="headerlink" title="Conceptual Overview"></a>Conceptual Overview</h1><p>The first thing to understand about <code>git rebase</code> is that it solves the same problem as <code>git merge</code>. Both of these commands are designed to integrate changes from one branch into another branch â they just do it in very different ways.</p><p>Consider what happens when you start working on a new feature in a dedicated branch, then another team member updates the <code>master</code> branch with new commits. The results in a forked history which should be familiar to anyone who has used Git as a collaboration tool.</p><p><img src="https://wac-cdn-a.atlassian.com/dam/jcr:01b0b04e-64f3-4659-af21-c4d86bc7cb0b/01.svg?cdnVersion=ey" alt=""></p><p>Now, letâs say that the new commits in <code>master</code> are relevant to the feature that youâre working on. To incorporate the new commits into your <code>feature</code> branch, you have two options: <code>mergin</code>or <code>rebasing</code>.</p><h1 id="The-Merge-Option"><a href="#The-Merge-Option" class="headerlink" title="The Merge Option"></a>The Merge Option</h1><p>The easiest option is to merge the <code>master</code> branch into the <code>feature</code> branch using something like the following:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git checkout feature</span><br><span class="line">git merge master</span><br></pre></td></tr></table></figure><p>Or you can condense this to a one-liner:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git merge master feature</span><br></pre></td></tr></table></figure><p>This creates a new <code>merge commit</code> in the <code>feature</code> branch that ties together the histories of the both branches, giving you a branch structure that looks like this:</p><p><img src="https://wac-cdn-a.atlassian.com/dam/jcr:e229fef6-2c2f-4a4f-b270-e1e1baa94055/02.svg?cdnVersion=ey" alt=""></p><p>Merging is nice because itâs a <code>non-destructive</code> operation. The existing branches are not changed in any way. This avoids all of the potential pitfalls of rebasing.</p><p>On the other hand, this also means that the <code>feature</code> branch will have an extraneous merge commit every time you need to incorporate upstream changes. If <code>master</code> is very active, this can pollute your <code>feature</code> branch history quite a bit. While itâs possible to migrate this issue with advanced <code>git log</code> options, it can make it hard to other developers to understand the history of the project.</p><h1 id="The-Rebase-Option"><a href="#The-Rebase-Option" class="headerlink" title="The Rebase Option"></a>The Rebase Option</h1><p>As an alternative to merge, you can rebase the <code>feature</code> branch onto <code>master</code> branch using the following commands:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git checkout feature</span><br><span class="line">git rebase master</span><br></pre></td></tr></table></figure><p>This moves the entire <code>feature</code> branch to begin on the top of the <code>master</code> branch, effectively incorporating all of the new commits in <code>master</code>. But, instead of using a merge commit, rebasing <code>re-writes</code> the project history by creating brand new commits for each commit in the original branch.</p><p><img src="https://wac-cdn-a.atlassian.com/dam/jcr:5b153a22-38be-40d0-aec8-5f2fffc771e5/03.svg?cdnVersion=ey" alt=""></p><p>The major benefit of rebasing is that you get a much cleaner project history. First, it eliminates the unnecessary merge commits required by <code>git merge</code>. Second, as you can see in the above diagram, rebasing also results in a perfectly linear project history â you can follow the top of <code>feature</code> all the way to the beginning of the project without any forks. This makes it easier to navigate your project with commands like <code>git log</code>.</p><h1 id="Interactive-Rebasing"><a href="#Interactive-Rebasing" class="headerlink" title="Interactive Rebasing"></a>Interactive Rebasing</h1><p>Interactive rebasing gives you the opportunity to alter commits as they are moved to the new branch. This is even more powerful than an automated rebase, since it offers complete control over the branchâs commit history. Typically, this is used to clean up a messy history before merging a feature branch into <code>master</code>.</p><p>To begin an interactive rebasing session, pass the <code>-i</code> option to the <code>git rebase</code> command.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git checkout feature</span><br><span class="line">git rebase -i master</span><br></pre></td></tr></table></figure><p>This will open a text editor listing all of the commits that are about to be moved:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pick 33d5b7a Message <span class="keyword">for</span> commit <span class="comment">#1</span></span><br><span class="line">pick 9480b3d Message <span class="keyword">for</span> commit <span class="comment">#2</span></span><br><span class="line">pick 5c67e61 Message <span class="keyword">for</span> commit <span class="comment">#3</span></span><br></pre></td></tr></table></figure><p>This listing defines exactly what the branch will look like after the rebase is performed. By changing the <code>pick</code> command and/or reordering the entries, you can make the branchâs history look like whatever you want.</p><p>For example, if the 2nd commit fixes a small problem in the 1st commit, you can condense them into a single comit with the <code>fixup</code> command:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pick 33d5b7a Message <span class="keyword">for</span> commit <span class="comment">#1</span></span><br><span class="line">fixup 9480b3d Message <span class="keyword">for</span> commit <span class="comment">#2</span></span><br><span class="line">pick 5c67e61 Message <span class="keyword">for</span> commit <span class="comment">#3</span></span><br></pre></td></tr></table></figure><p>When you save and close the file, Git will perform the rebase according to your instructions, resulting in project history that looks like the following:</p><p><img src="https://wac-cdn-a.atlassian.com/dam/jcr:fe6942b4-7a60-4464-9181-b67e59e50788/04.svg?cdnVersion=ey" alt=""></p><p>Eliminating insignificant commits like this makes your featureâs history much easier to understand. <strong>This is something that <code>git merge</code> simply cannot do</strong>.</p><h1 id="The-Golden-Rule-of-Rebasing"><a href="#The-Golden-Rule-of-Rebasing" class="headerlink" title="The Golden Rule of Rebasing"></a>The Golden Rule of Rebasing</h1><p>The Golden Rule of <code>git rebase</code> is to never use it on <em>public</em> branches.</p><p>For example, think about what would happen if you rebased <code>master</code> onto your <code>feature</code> branch.</p><p><img src="https://wac-cdn-a.atlassian.com/dam/jcr:1d22f018-b2c7-4096-9db1-c54940cf4f4e/05.svg?cdnVersion=ey" alt=""></p><p>The rebase moves all of the commits in <code>master</code> onto the tip of <code>feature</code>. The problem is that only happened in <em>your</em> repo. All of the other developers are still working with the origin master. Since rebasing results in brand new commits, Git will think that your <code>master</code> branchâs history has diverged from everybody elseâs.</p><p>The only way to synchronize the two <code>master</code> branches is to merge them back together, resulting in an extra merge commit <strong>and</strong> two sets of commits that contain the same changes.</p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Type Compatibility in TypeScript</title>
      <link href="/2017/06/12/Type-Compatibility-in-TypeScript/"/>
      <content type="html"><![CDATA[<p>Type Compaibility in TypeScript is based on <strong>Structural Subtyping</strong>. Structural Typing is a way of relating types based solely on their members. This is in contrast with nominal typing. Consider the following code:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">interface Named &#123;</span><br><span class="line">  name: string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  name: string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> p: Named</span><br><span class="line"><span class="comment">// OK, because of structural typing</span></span><br><span class="line">p = <span class="keyword">new</span> Person()</span><br></pre></td></tr></table></figure><p>In nominally-typed language like C# or Java, the equivalnet code would be error because the <code>Person</code> class does not explicitly describe itself as being an implementor of the <code>Named</code> interface.</p><p>TypeScriptâs structural type system was designed based on how JavaScript code is typically written. Because JavaScript widely uses anonymous objects like function expressions and object literals, itâs much more natural to represent the kinds of relationship found in JavaScript libraries with a structural type system instead of a nominal one.</p><p>The basic rule for TypeScriptâs structural type system is the <code>x</code> is compatible with <code>y</code> if <code>y</code> has at least the same members as <code>x</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">interface Named &#123;</span><br><span class="line">  name: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> x: Named;</span><br><span class="line"><span class="comment">// y's inferred type is &#123; name: string, location: string &#125;</span></span><br><span class="line"><span class="keyword">let</span> y = &#123; <span class="attr">name</span>: <span class="string">'Alice'</span>, <span class="attr">location</span>: <span class="string">'Seattle'</span> &#125;</span><br><span class="line">x = y</span><br></pre></td></tr></table></figure><p>To check whether <code>y</code> can be assigned to <code>x</code>, the compiler checks each property of <code>x</code> to find a corresponding compatible property in <code>y</code>. In this case, <code>y</code> must have a member called <code>name</code> that is a string, so the assignment is allowed.</p><p>The same rule for assignment is used when checking function call arguments</p><blockquote><p>The Type Compatibility in Variable Assignment and Function Arguments.</p></blockquote><h1 id="Comparing-Two-Functions"><a href="#Comparing-Two-Functions" class="headerlink" title="Comparing Two Functions"></a>Comparing Two Functions</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> x = <span class="function">(<span class="params">a: number</span>) =&gt;</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">let</span> y = <span class="function">(<span class="params">b: number, s: string</span>) =&gt;</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">y = x <span class="comment">// OK</span></span><br><span class="line">x = y <span class="comment">// Error</span></span><br></pre></td></tr></table></figure><p>The check if <code>x</code> is assignable to <code>y</code>, we first look at the parameter list. Each parameter in <code>x</code> must have a corresponding parameter in <code>y</code> with a compabile type.</p><p>So <code>x</code> is assignable to <code>y</code>, but <code>y</code> is not assignable to <code>x</code></p><p>Now letâs look at how return types are treated, using two functions that differs only by their return type:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> x = <span class="function"><span class="params">()</span> =&gt;</span> (&#123; <span class="attr">name</span>: <span class="string">'Alice'</span> &#125;)</span><br><span class="line"><span class="keyword">let</span> y = <span class="function"><span class="params">()</span> =&gt;</span> (&#123; <span class="attr">name</span>: <span class="string">'Alice'</span>, <span class="attr">location</span>: <span class="string">'Seattle'</span> &#125;)</span><br><span class="line"></span><br><span class="line">x = y <span class="comment">// OK</span></span><br><span class="line">y = x <span class="comment">// Error</span></span><br></pre></td></tr></table></figure><p>The type system enforces that the source functionâs return type be a subtype of the target typeâs return type.</p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Mannual of Ownership in Rust </title>
      <link href="/2017/06/09/mannual-of-ownership-in-rust/"/>
      <content type="html"><![CDATA[<p>Ownership is Rustâs most unique feature, and it enables Rust to make memory safety guarantees without needing a garbage collector. Therefore, itâs important to understand how ownership works in Rust. In this chapter weâll talk about ownership as well as several related features: borrowing, slices, and how Rust lays data out in memory.</p><h1 id="What-is-Ownership"><a href="#What-is-Ownership" class="headerlink" title="What is Ownership"></a>What is Ownership</h1><p>Rustâs central feature is <em>ownership</em>, although the feature is staightforward to explain, it has deep implications of the rest of the language.</p><p>All programs have to manage the way they use a computerâs memory while running. Some languages ahve garbage collecion that constantly looks for no longer used memory as the program runs. In other languages, the programmer must explicitly allocate and free the memory. Rust uses a third approach: <strong>memory is managed through a system of ownership with a set of rules that the compiler checks at compile time.</strong> No run-time costs are iccured for any of the ownership features.</p><p>Because ownership is a new concept for many programmers, it does take some time to get used to. The good news is that the more experienced you become with Rust and the rules of the ownership system, the more youâll be able to naturally develop code that is safe and efficient.</p><h1 id="Ownership-Rules"><a href="#Ownership-Rules" class="headerlink" title="Ownership Rules"></a>Ownership Rules</h1><p>First, letâs take a look at the ownership rules.</p><blockquote><ol><li>Each Value in Rust has a variable thatâs called its <em>owner</em>.</li></ol></blockquote><blockquote><ol><li>There can only be one owner at a time.</li></ol></blockquote><blockquote><ol><li>When the owner goes out of scope, the value will be dropped.</li></ol></blockquote><h1 id="Variable-Scope"><a href="#Variable-Scope" class="headerlink" title="Variable Scope"></a>Variable Scope</h1><p>A scope is the range within a program for which an item is valid.</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span> </span>() &#123;</span><br><span class="line">  <span class="keyword">let</span> s = <span class="string">"hello"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The variable <code>s</code> refers to a string literal, where the value of the string is hardcoded into the text of our program. The variable is valid from the point at which itâs declared until the end of the current <em>scope</em>.</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;                       <span class="comment">// s is not valid here</span></span><br><span class="line">  <span class="keyword">let</span> s = <span class="string">"hello"</span>;      <span class="comment">// s is valid here</span></span><br><span class="line">&#125;                       <span class="comment">// the scope is over, and s is no longer valid.</span></span><br></pre></td></tr></table></figure><ul><li><p>When <code>s</code> comes <em>into scope</em> it is valid</p></li><li><p>It remains so until it goes <em>out of scope</em></p></li></ul><p>At this point, the relationship between scopes and the valid variables are valid is similar to other programming languages. Now weâll build on top of this understanding by introducing the <code>String</code> type.</p><h1 id="The-String-Type"><a href="#The-String-Type" class="headerlink" title="The String Type"></a>The String Type</h1><p>To illustrate the rules of ownership, we need a data type that is complex.</p><p>Weâll use <code>String</code> as the example here and concentrate on the parts of <code>String</code> that relate to ownership. These aspects also apply to other complex data types provided by the standard library and that you create.</p><p>Weâve already seen string literals, where a string value is hardcoded into our program. String literals are conveient, but they arenât always suitable for every situation in which you want to use text. One reason is that theyâre immutable. Another is that not every string value can be known when we write our code. For these situations, Rust has a second string type, <code>String</code>. This type is allocated on the heap and as such is able to store an amount of text that is unknown to us at compile time. You can create a <code>String</code> from a string literal using the <code>from</code> function, like so:</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="built_in">String</span>::from(<span class="string">"hello"</span>)</span><br></pre></td></tr></table></figure><p>The double colon(<code>::</code>) is an operator that allows us to namespace this particular <code>from</code> function under the <code>String</code> type rather than using some sort of name like <code>string_from</code>.</p><p>This kind of string <em>can</em> be mutated:</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut</span> s = <span class="built_in">String</span>::from(<span class="symbol">'Hello</span>')</span><br><span class="line">s.push_str(<span class="string">", world!"</span>)</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">"&#123;&#125;"</span>, s);</span><br></pre></td></tr></table></figure><p>So why can <code>String</code> be mutated but literals cannot.</p><h1 id="Memory-and-Allocation"><a href="#Memory-and-Allocation" class="headerlink" title="Memory and Allocation"></a>Memory and Allocation</h1><p>In the case of a string literal, <em>we know the contents at compile</em> so the text is hardcoded directly in to the final executable, making string literals fast and efficient. But these properties only come from its immutability. Unfortunately, <em>we canât put a blob of memory into the binary for each piece of text whose size is unknown at compile time</em> and whose size might change while running the program.</p><p>With the <code>String</code> type, in order to support a mutable, growable piece of text, we need to allocate an amount of memory on the heap, unknown at compile time, to hold the contents. This means:</p><ul><li><p>The memory must be requested from the operating system at runtime.</p></li><li><p>We need a way of returning this memory to the operating system when weâre done with our <code>String</code></p></li></ul><p>That first part is done by us: when we call <code>String::from</code>, its implementation requests the memory if needs. This is pretty much universal in programming languages.</p><p>However, the second part is different. In languages with a <code>garbage collector(GC)</code>, the GC keeps track and cleans up memory that isnât being used anymore, and we, as the programmer, donât need to think about it. Without a GC, itâs the programmerâs responsibility to identify when memory is no longer being used and call code to explicitly return it, just as we did to request it. Doing this correctly has historically been a difficult programming problem. If we forget, weâll waste memory. If we do it too early, weâll have an invalid vairable. If we do it twice, thatâs a bug too. We need to pair exactly one <code>allocate</code> with exact one <code>free</code></p><p>Rust takes a different path: the memory is automatically returned once the variable that owns it goes out of scope.</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="keyword">let</span> s = <span class="built_in">String</span>::from(<span class="string">"Helloe"</span>); <span class="comment">// s is valid from this point</span></span><br><span class="line"></span><br><span class="line">&#125;  <span class="comment">// the scope is over</span></span><br></pre></td></tr></table></figure><p>These is a natural point at which we can return the memory our <code>String</code> needs to operating system: when <code>s</code> goes out of scope. When a variables goes out of scope, Rust calls a special function for us. This function is called <code>drop</code>, and itâs where the author of <code>String</code> can put the code to return the memory. Rust calls <code>drop</code> automatically at the closing <code>}</code>.</p><blockquote><p>Note: In C++, this pattern of deallocating resources at the end of an itemâs lifetime is sometimes called <em>Resource Acquisition Is Initialization(RAII)</em>. The <code>drop</code> function in Rust will be familiar to you if youâve used RAII patterns.</p></blockquote><p>This patterns has profound impact on the way Rust code is written. It may seem simple right now, but the behavior of code can be unexpected in more complicated situations when we want to have multiple variables use the data weâve allocated ont the heap.</p><h1 id="Ways-Variables-and-Data-Interact-Move"><a href="#Ways-Variables-and-Data-Interact-Move" class="headerlink" title="Ways Variables and Data Interact: Move"></a>Ways Variables and Data Interact: Move</h1><p>Multiple variables can interact with the same data in different ways in Rust. Letâs look at an example using an integer.</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> x = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">let</span> y = x;</span><br></pre></td></tr></table></figure><p>Here we got two independent variables <code>x</code> and <code>y</code>, this is because integers are simple values with a known, fixed size, and two <code>5</code> are pushed onto the stack.</p><p>Now letâs look at the <code>String</code> version.</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s1 = <span class="built_in">String</span>::from(<span class="string">"Hello"</span>);</span><br><span class="line"><span class="keyword">let</span> s2 = s1;</span><br></pre></td></tr></table></figure><p>This looks very similar to the previous code, so we might assume that the way it works would be the same: that is, the second line would make a copy of the value in <code>s1</code> and bind it to <code>s2</code>. But this isnât quite what happens.</p><p>To explain this more thoroughly, letâs look at what <code>String</code> looks like under the covers in the Figure.</p><p><img src="https://doc.rust-lang.org/book/second-edition/img/trpl04-01.svg" alt=""></p><p>A <code>String</code> is made up of three parts, shown on the left: a pointer to the memory that holds the contents of the string, a length, and a capacity. This group of data is stored on the stack. On the right is the memory on the heap that holds the contents.</p><p>The length is how much memory, in bytes, the contents of the <code>String</code> is currently using. The capacity is the total amount of memory, in bytes, that the <code>String</code> has received from the operating system. The difference between length and capacity matters, but not in this context, so far now, itâs fine to ignore the capacity.</p><p>When we assign <code>s1</code> to <code>s2</code>, the <code>String</code> data is copied, meaning we copy the pointer, the length and the capacity that are on the stack. We do not copy the data on the heap that the pointer refers to. In other words, the data representation in memory looks like the figure following.</p><p><img src="https://doc.rust-lang.org/book/second-edition/img/trpl04-02.svg" alt=""></p><p>Eariler, we said that when a variable goes out of scope, Rust automatically calls the <code>drop</code> function and cleans up the heap memory for the variable. But the fact is that both data pointers pointing to the same location. This is a problem: when <code>s2</code> and <code>s1</code> go out of scope, they will both try to free the same memory. This is known as a <em>double free</em> error. Freeing memory twice can lead to memory corruption, which can potentially lead to security vulnerabilities.</p><p>To ensure memory safety, thereâs one more detail to what happens in this situation in Rust. Instead of trying to copy the allocated memory, Rust considers <code>s1</code> to no longer be valid and therefore, Rust doesnât need to free anything when <code>s1</code> goes out of scope. Check out what happens when you try to use <code>s1</code> after <code>s2</code> is created.</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s1 = <span class="built_in">String</span>::from(<span class="string">"hello"</span>);</span><br><span class="line"><span class="keyword">let</span> s2 = s1;</span><br><span class="line"></span><br><span class="line"><span class="built_in">println!</span>(<span class="string">"&#123;&#125;"</span>, s1);</span><br></pre></td></tr></table></figure><p>Youâll get an error like this because Rust prevents you from using the invalidated reference:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">error[E0382]: use of moved value: `s1`</span><br><span class="line"> --&gt; src/main.rs:4:27</span><br><span class="line">  |</span><br><span class="line">3 |  <span class="built_in">let</span> s2 = s1;</span><br><span class="line">  |     -- value moved here</span><br><span class="line">4 |  println!(<span class="string">"&#123;&#125;"</span>, s1);</span><br><span class="line">  |                 ^^ value used here after move</span><br><span class="line">  |</span><br><span class="line">  = note: move occurs because `s1` has <span class="built_in">type</span> `std::string::String`,</span><br><span class="line"><span class="built_in">which</span> does not implement the `Copy` trait</span><br></pre></td></tr></table></figure><p>This action in Rust, similar to <code>shallow copy</code>, it copy pointer, length and capacity in stack, but Rust also invalidates the first variable.</p><p>We call it <code>move</code>.</p><p><img src="https://doc.rust-lang.org/book/second-edition/img/trpl04-04.svg" alt=""></p><p><code>s1</code> has been invalidated.</p><p>That solves our problem, with only <code>s2</code> valid, when it goes out of scope, it alone will freee the memory, and weâre done.</p><p>In addition, thereâs a design choice thatâs implied by this: Rust will never automatically create âdeepâ copies of your data. Therefore, any <em>automatic</em> copying can be assumed to be inexpensive in terms of runtime performance.</p><h1 id="Ways-Variables-and-Data-Interact-Clone"><a href="#Ways-Variables-and-Data-Interact-Clone" class="headerlink" title="Ways Variables and Data Interact: Clone"></a>Ways Variables and Data Interact: Clone</h1><p>If we do want to deeply copy the heap data of the <code>String</code>, not just the stack data, we can use a common method called <code>clone</code>.</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s1 = <span class="built_in">String</span>::from(<span class="string">"Hello"</span>);</span><br><span class="line"><span class="keyword">let</span> s2 = s1.clone();</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">"s1 = &#123;&#125;, s2 = &#123;&#125;"</span>, s1, s2);</span><br></pre></td></tr></table></figure><p>This works just fine, the heap data does get copied.</p><p>When you see a call to <code>clone</code>, you know that some arbitrary code is being executed and that code may be expensive. Itâs a visual indicator that something different is going on.</p><h1 id="Stack-Only-Data-Copy"><a href="#Stack-Only-Data-Copy" class="headerlink" title="Stack-Only Data: Copy"></a>Stack-Only Data: Copy</h1><p>Thereâs another wrinkle we havenât talked about yet. This code using integers.</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> x = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">let</span> y = x;</span><br><span class="line"></span><br><span class="line"><span class="built_in">println!</span>(<span class="string">"x = &#123;&#125;, y = &#123;&#125;"</span>, x, y);</span><br></pre></td></tr></table></figure><p>This code runs correctly because those types like integers that have a <strong>known size</strong> at compile time are stored entirely on the stack, so copied of the actual values are quick to make. That means thereâs no reason we would want to prevent <code>x</code> from being valid after we created the variable <code>y</code>. In other words, thereâs no difference between deep and shallow copying here, so calling <code>clone</code> wouldnât do anything differently from the usual shallow copying and we can leave it out.</p><p>Rust has a special annotation called the <code>Copy</code> trait that we can place on types like integers that are stored on stack.</p><p>If a type has the <code>Copy</code> trait, an older variable is still usable after the assignment. Rust wonât let us annotate a type with the <code>Copy</code> trait if the type, or any of its parts, has implemented the <code>Drop</code> trait. If the type needs something special to happen when the value goes out of scope and we add the <code>Copy</code> annotation to that type, weâll get a compile time error.</p><p>As a general rule, any group of simple scalar values can be <code>Copy</code>, and nothing that requires allocation or is some form of resource is <code>Copy</code>. Here are some of the types that are <code>Copy</code>:</p><ul><li><p>All the integer types</p></li><li><p>The boolean type</p></li><li><p>All the floating point types</p></li><li><p>Tuples, but only if they contain types a also <code>Copy</code>.</p></li></ul><h1 id="Ownership-and-Functions"><a href="#Ownership-and-Functions" class="headerlink" title="Ownership and Functions"></a>Ownership and Functions</h1><p><strong>The semantics for passing a value to a function are similar to assigning a value to a variable.</strong> Passing a variable to a function <strong>will move or copy</strong>, just like assignment.</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span> </span>() &#123;</span><br><span class="line">  <span class="keyword">let</span> s = <span class="built_in">String</span>::from(<span class="string">"Hello"</span>); <span class="comment">// s comes into scope</span></span><br><span class="line"></span><br><span class="line">  take_ownership(s); <span class="comment">// s's value moves into the function</span></span><br><span class="line">                     <span class="comment">// s is no longer valid here</span></span><br><span class="line">  <span class="keyword">let</span> x = <span class="number">5</span>;         <span class="comment">// x comes into scope</span></span><br><span class="line"></span><br><span class="line">  make_copy(x);      <span class="comment">// x would move into the function, but i32 is Copy, so it's okay to still use x afterward.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">take_ownership</span> </span>(some_string: <span class="built_in">String</span>) &#123; <span class="comment">// some_string comes into scope</span></span><br><span class="line">  <span class="built_in">println!</span>(<span class="string">"&#123;&#125;"</span>, some_string);</span><br><span class="line">&#125; <span class="comment">// here, some_string goes out of scope and `drop` is called. The backing memory is freed.</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">make_copy</span> </span>(some_integer: <span class="built_in">i32</span>) &#123; <span class="comment">//  some_integer comes into scope</span></span><br><span class="line">  <span class="built_in">println!</span>(<span class="string">"&#123;&#125;"</span>, some_integer);</span><br><span class="line">&#125; <span class="comment">// Here some_integer goes out of scope.</span></span><br></pre></td></tr></table></figure><p>If we tried to use <code>s</code> after the call to <code>take_ownership</code>, Rust would throw a compile time error. These static checks protect us from mistakes.</p><h1 id="Return-Values-and-Scope"><a href="#Return-Values-and-Scope" class="headerlink" title="Return Values and Scope"></a>Return Values and Scope</h1><p>Returning values can also transfer ownership.</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span> </span>() &#123;</span><br><span class="line">  <span class="keyword">let</span> s1 = give_ownership(); <span class="comment">// give_ownership moves its return value into s1</span></span><br><span class="line">  <span class="keyword">let</span> s2 = <span class="built_in">String</span>::from(<span class="string">"Hello"</span>); <span class="comment">// s2 comes into scope</span></span><br><span class="line">  <span class="keyword">let</span> s2 = take_and_give_back(s2); <span class="comment">// s2 is moved into take_and_give_back, which aslo move its returned value into s2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">give_ownership</span> </span>() -&gt; <span class="built_in">String</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> some_string = <span class="built_in">String</span>::from(<span class="string">"Hello"</span>); <span class="comment">// some_string comes into scope</span></span><br><span class="line">  some_string      <span class="comment">// some_string is returned and moves out to the calling function</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">take_and_give_back</span></span>(a_string: <span class="built_in">String</span>) -&gt; &#123; <span class="comment">// a_string comes into scope</span></span><br><span class="line">  a_string <span class="comment">// a_string is returned and moves out to the calling function</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Itâs possible to return mutiple values using a tuple.</p><h2 id="Reference-and-Borrowing"><a href="#Reference-and-Borrowing" class="headerlink" title="Reference and Borrowing"></a>Reference and Borrowing</h2><p>Here is how you would define and use a <code>calculate_length</code> function that has a <em>reference</em> to an object as a parameter instead of taking ownership of the value.</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span> </span>() &#123;</span><br><span class="line">  <span class="keyword">let</span> s1 = <span class="built_in">String</span>::from(<span class="string">"Hello"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> len = calculate_length(&amp;s1);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">println!</span>(<span class="string">"The length of '&#123;&#125;' is &#123;&#125;."</span>, s1, len);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">calculate_length</span></span>(s: &amp;<span class="built_in">String</span>) - <span class="built_in">usize</span> &#123;</span><br><span class="line">  s.len()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>First notice that all the tuple code in the variable declaration and the function return value is gone. Second, note that we pass <code>&amp;s1</code> into <code>calculate_length</code>, and in its definition, we take <code>&amp;String</code> rather than <code>String</code>.</p><p>These ampersands(&amp;) are <em>reference</em>, and they allow you to refer to some value without taking ownership of it.</p><p><img src="https://doc.rust-lang.org/book/second-edition/img/trpl04-05.svg" alt=""></p><p>In this figure, <code>&amp;String s</code> pointing to <code>String s1</code></p><p>Letâs take a closer look at the function call here:</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s1 = <span class="built_in">String</span>::from(<span class="string">"Hello"</span>)</span><br><span class="line"><span class="keyword">let</span> len = calculate_length(&amp;s1)</span><br></pre></td></tr></table></figure><p>The <code>&amp;s1</code> syntax lets us create a reference that <em>refer</em> to the value of <code>s1</code>, but does not own it.</p><p><strong>Because it does not own it, the value it points to will not be dropped when the reference goes out of scope.</strong></p><p>Likewise, the signature of the function uses <code>&amp;</code> to indicate that the type of the paramter <code>s</code> is a reference.</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">calculate_length</span></span>(s: &amp;<span class="built_in">String</span>) -&gt; <span class="built_in">usize</span> &#123; <span class="comment">// s is a reference to a String</span></span><br><span class="line">  s.len()</span><br><span class="line">&#125; <span class="comment">// Here, s goes out of the scope. But because it does not have ownership of what it refers to, no drop happens.</span></span><br></pre></td></tr></table></figure><p>The scope in which the variable <code>s</code> is valid is the same as any function parameterâs scope, but we donât drop what the reference points to when it goes out of scope because we donât have ownership.</p><p>Functions that have references as parameters instead of the actual values mean we wonât need to return the values in order to give back ownership, since we never had ownership.</p><p>We call having references as function paramters <code>borrowing</code>. As in real life, if a person owns something, you can borrow it from them, When youâre done, you have to give it back.</p><p>If we try to modify something weâre borrowing, it wonât work.</p><h2 id="Mutable-References"><a href="#Mutable-References" class="headerlink" title="Mutable References"></a>Mutable References</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span> </span>() &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="keyword">mut</span> s = <span class="built_in">String</span>::from(<span class="string">"Hello"</span>);</span><br><span class="line">  change(&amp;<span class="keyword">mut</span> s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">change</span></span>(some_string: &amp;<span class="keyword">mut</span> <span class="built_in">String</span>) &#123;</span><br><span class="line">  some_string.push_str(', world')</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>First, we had to change <code>s</code> to be <code>mut</code>. Then we had to create mutable reference with <code>&amp;mut s</code> and accept a mutable reference with <code>some_string: &amp;mut String</code>.</p><p>But mutable references have one big restriction: you can only mutable reference to a particular piece of data in a particular scope.</p><p>This restriction allows for mutation but in a very controlled fashion. Itâs something that new Rustaceans struggle with, because most languages let you mutate whenever youâd like. The benefit of having this restriction is that <em>Rust can prevent data races at compile time</em>.</p><p>A <code>data race</code> is a particular type of race condition in which these three behaviors occur:</p><ul><li><p>Two or more pointers access the same data at the same time.</p></li><li><p>At least one of the pointers is being used to write to the data.</p></li><li><p>Thereâs no mechanism being used to synchrnize access to the data.</p></li></ul><p>Data races cause undefined behavior and can be difficult to diagnose and fix when youâre trying to track them down at runtime. Rust prevents this problem from happening because it wonât even compile code with data race.</p><p>As always, we can use curly brackets to create a new scope, allowing for multiple mutable references, just not <em>simultaneous</em> ones:</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut</span> s = <span class="built_in">String</span>::from(<span class="string">"Hello"</span>);</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">let</span> r1 = &amp;<span class="keyword">mut</span> s;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> r2 = &amp;<span class="keyword">mut</span> s;</span><br></pre></td></tr></table></figure><p>A similar rule exists for combining mutable and immutable references. This code results in an error:</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut</span> s = <span class="built_in">String</span>::from(<span class="string">"Hello"</span>);</span><br><span class="line"><span class="keyword">let</span> r1 = &amp;s; <span class="comment">// no problem</span></span><br><span class="line"><span class="keyword">let</span> r2 = &amp;s; <span class="comment">// no problem</span></span><br><span class="line"><span class="keyword">let</span> r3 = &amp;<span class="keyword">mut</span> s; <span class="comment">//BIG PROBLEM, mutable borrow occurs</span></span><br></pre></td></tr></table></figure><p>We also cannot have mutable reference while we have an immutable one.</p><p>Users of an immutable reference donât expect the values to suddently change out from under them.</p><h2 id="Dangling-References"><a href="#Dangling-References" class="headerlink" title="Dangling References"></a>Dangling References</h2><p>In languages with pointers, itâs easy to erroneously to create a <em>dangling pointer</em>, a pointer that references a location in memory that may have been given to someone else, by freeing some memory while preserving a pointer to that memory. In Rust, by contrast, the compiler guarantees the references will never be dangling references: if we have a reference to some data, the compiler will ensure that the data will not go out of scope before reference to the data does.</p><h2 id="The-Rules-of-References"><a href="#The-Rules-of-References" class="headerlink" title="The Rules of References"></a>The Rules of References</h2><ul><li><p>At any given time, you can have <code>either</code> but not both of</p><ul><li><p>One mutable reference</p></li><li><p>Any number of immutable references</p></li></ul></li><li><p>Referecences must always be valid.</p></li></ul><h2 id="Slices"><a href="#Slices" class="headerlink" title="Slices"></a>Slices</h2><p>Another data type that doesnât have ownership is the <code>slice</code>. Slices let you reference a configuous sequence of elements in a collection rather tahn the whole collection.</p><h2 id="String-Slice"><a href="#String-Slice" class="headerlink" title="String Slice"></a>String Slice</h2><p>A <em>string slice</em> is a reference to part of a <code>String</code>, and looks like this:</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="built_in">String</span>::from(<span class="string">"Hello world"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> hello = &amp;s[<span class="number">0</span>..<span class="number">5</span>];</span><br><span class="line"><span class="keyword">let</span> world = &amp;s[<span class="number">6</span>..<span class="number">11</span>];</span><br></pre></td></tr></table></figure><p>This is similar to taking a reference to the whole <code>String</code>, but with the extra <code>[0..5]</code> but. Rather than a reference to the entire <code>String</code>, itâs a reference to an internal position in the <code>String</code> and the number of elements that it refers to.</p><p>We create slices with a range of <code>[start_index..end_index]</code>, but the slice data structure acutally <strong>stores the starting position and the length of the slice</strong>.</p><p>So in the case of <code>let world = &amp;s[6..11];</code>, <code>world</code> would be a slice that contains a pointer to the 6th byte of <code>s</code> and a length of value of 5.</p><p><img src="https://doc.rust-lang.org/book/second-edition/img/trpl04-06.svg" alt=""></p><p>With Rustâs <code>..</code> range syntax, if you want to start at the first index(0), you can drop the value before the two periods. In other words</p><p>By the same token, if your slice includes the last byte of the <code>String</code>, you can drop the trailing number.</p><p>You can also drop both values to take a slice of the entire string.</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">first_word</span> </span>(s: &amp;<span class="built_in">String</span>) -&gt; &amp;<span class="built_in">str</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> bytes = s.as_bytes();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i, &amp;item) <span class="keyword">in</span> bytes.iter().enumerate() &#123;</span><br><span class="line">    <span class="keyword">if</span> item == <span class="string">b' '</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> &amp;s[<span class="number">0</span>..i]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  &amp;s[..]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="String-Literals-Are-Slices"><a href="#String-Literals-Are-Slices" class="headerlink" title="String Literals Are Slices"></a>String Literals Are Slices</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="string">"Hello, World"</span>;</span><br></pre></td></tr></table></figure><p>The type of <code>s</code> here is <code>&amp;str</code>: itâs a slice pointing to the specific point of the binary. This is also why string literals are immutable; <code>&amp;str</code> is an immutable reference.</p><h2 id="String-Slices-as-Parameters"><a href="#String-Slices-as-Parameters" class="headerlink" title="String Slices as Parameters"></a>String Slices as Parameters</h2><p>Knowing that you can take slices of literals and <code>String</code>s leads us to one more improvement on <code>first_word</code>, and thatâs its signature:</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">first_word</span></span>(s: &amp;<span class="built_in">String</span>) -&gt; &amp;<span class="built_in">str</span> &#123;</span><br></pre></td></tr></table></figure><p>If we have a string slice, we can pass that directly. If we have a <code>String</code>, we can pass a slice of the entire <code>String</code>. Defining a function to take a string slcie instead of a reference to a String makes our API more general and useful without losing any functionality.</p><h2 id="Other-Slices"><a href="#Other-Slices" class="headerlink" title="Other Slices"></a>Other Slices</h2><p>String slices, as you might imagine, are specific to strings. But thereâs a more general slice type, too.</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"><span class="keyword">let</span> slice = &amp;a[<span class="number">1</span>..<span class="number">3</span>];</span><br></pre></td></tr></table></figure><p>This slice has the type <code>&amp;[i32]</code>. It works the same way as string slices do, by storing a reference to the first element and the length.</p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Basic Info of Web Worker</title>
      <link href="/2017/06/06/Basic-Info-of-Web-Worker/"/>
      <content type="html"><![CDATA[<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">var</span> worker = <span class="keyword">new</span> Worker (<span class="string">'worker.js'</span>)</span><br><span class="line">worker.postMessage() <span class="comment">// start the worker</span></span><br></pre></td></tr></table></figure><p>postMessage æ¹æ³å¯ä»¥æ¥åå­ç¬¦ä¸²æ JSON å¯¹è±¡</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line">worker.addEventListener(<span class="string">'message'</span>, (e) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'worker said: '</span>, e.data)</span><br><span class="line">&#125;, <span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line">worker.postMessage(<span class="string">'hello world'</span>)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// worker.js</span></span><br><span class="line">self.addEventListener(<span class="string">'message'</span>, (e) =&gt; &#123;</span><br><span class="line">  self.postMessage(e.data)</span><br><span class="line">&#125;, <span class="literal">false</span>)</span><br></pre></td></tr></table></figure><p>index.js ä¸­è°ç¨ postMessage() æ¶, worker.js éè¿ message æ¶é´å¤çæ¶æ¯, index.js çææä¿¡æ¯å¨ e.data ä¸.</p><p>index.js å worker.js ä¼ éçæ¶æ¯æ¯å¹å¼èä¸æ¯å±äº«(åºåå+ååºåå)</p><p>Example</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"sayHi()"</span>&gt;</span>SayHi<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"unknownCmd()"</span>&gt;</span>unknownCmd<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"stop()"</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">output</span> <span class="attr">id</span>=<span class="string">"result"</span>&gt;</span><span class="tag">&lt;/<span class="name">output</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sayHi</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  worker.postMessage(&#123;</span><br><span class="line">    cmd: <span class="string">'start'</span>,</span><br><span class="line">    msg: <span class="string">'Hi'</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">stop</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  worker.postMessage(&#123;</span><br><span class="line">    cmd: <span class="string">'stop'</span>,</span><br><span class="line">    msg: <span class="string">'Bye'</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unknownCmd</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  worker.postMessage(&#123;</span><br><span class="line">    cmd: <span class="string">'foobar'</span>,</span><br><span class="line">    msg: <span class="string">'???'</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> worker = <span class="keyword">new</span> Worker(<span class="string">'worker.js'</span>)</span><br><span class="line"></span><br><span class="line">worker.addEventListener(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">'result'</span>).textContent = e.data</span><br><span class="line">&#125;, <span class="literal">false</span>)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// worker.js</span></span><br><span class="line">self.addEventListener(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> data = e.data</span><br><span class="line">  <span class="keyword">switch</span> (data.cmd) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'start'</span>: &#123;</span><br><span class="line">      self.postMessage(<span class="string">'WORKER STARTED: '</span> + data.msg)</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'stop'</span>: &#123;</span><br><span class="line">      self.postMessage(<span class="string">'WORKER STOPPED: '</span> + data.msg + <span class="string">'. (buttons will no longer work)'</span>)</span><br><span class="line">      self.close()</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">default</span>: &#123;</span><br><span class="line">      self.postMessage(<span class="string">'Unknown command: '</span> + data.msg)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;, <span class="literal">false</span>)</span><br></pre></td></tr></table></figure><p>åæ­¢ worker çæ¹æ³ä¸¤ç§</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line">worker.terminate()</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// worker.js</span></span><br><span class="line">self.close()</span><br></pre></td></tr></table></figure><h1 id="Worker-ç¯å¢"><a href="#Worker-ç¯å¢" class="headerlink" title="Worker ç¯å¢"></a>Worker ç¯å¢</h1><h2 id="Worker-ä½ç¨å"><a href="#Worker-ä½ç¨å" class="headerlink" title="Worker ä½ç¨å"></a>Worker ä½ç¨å</h2><p>å¨ worker.js ä¸­, self å this é½æ¯æ worker çå¨å±ä½ç¨å</p><h1 id="éç¨äº-worker-çåè½"><a href="#éç¨äº-worker-çåè½" class="headerlink" title="éç¨äº worker çåè½"></a>éç¨äº worker çåè½</h1><p>ç±äºweb worker çå¤çº¿ç¨è¡ä¸º, æä»¥ä»ä»¬åªè½ä½¿ç¨ js åè½çå­é</p><ul><li><p>navigator å¯¹è±¡</p></li><li><p>location å¯¹è±¡</p></li><li><p>XMLHttpResponse</p></li><li><p>setTimeout() / clearTimeout() / setInterval() / clearInterval()</p></li><li><p>åºç¨ç¼å­</p></li><li><p>ä½¿ç¨ importScripts() æ¹æ³å¯¼å¥å¤é¨èæ¬</p></li><li><p>çæå¶ä» worker</p></li></ul><p>worker æ æ³ä½¿ç¨:</p><ul><li><p>DOM</p></li><li><p>window å¯¹è±¡</p></li><li><p>document å¯¹è±¡</p></li><li><p>parent å¯¹è±¡</p></li></ul><h1 id="å è½½å¤é¨èæ¬"><a href="#å è½½å¤é¨èæ¬" class="headerlink" title="å è½½å¤é¨èæ¬"></a>å è½½å¤é¨èæ¬</h1><p>worker å¯ä»¥éè¿ importScripts() å½æ°å°å¤é¨èæ¬æä»¶æåºå è½½å° worker ä¸­, è¯¥æ¹æ³éç¨é¶ä¸ªæå¤ä¸ªå­ç¬¦ä¸²è¡¨ç¤ºè¦å¯¼å¥çèµæºå.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// worker.js</span></span><br><span class="line">importScripts(<span class="string">'script1.js'</span>)</span><br><span class="line">importScripts(<span class="string">'script2.js'</span>)</span><br><span class="line"></span><br><span class="line">importScripts(<span class="string">'script3.js'</span>, <span class="string">'script4.js'</span>)</span><br></pre></td></tr></table></figure><h1 id="æ·»å å­-worker"><a href="#æ·»å å­-worker" class="headerlink" title="æ·»å å­ worker"></a>æ·»å å­ worker</h1><ul><li><p>subWorker å¿é¡»æç®¡å¨ä¸ç¦ç½é¡µç¸åçæ¥æºä¸­</p></li><li><p>subWorker ä¸­ç URI åºç¸å¯¹äº worker çä½ç½®æ¥è§£æ</p></li></ul><h1 id="å¤çéè¯¯"><a href="#å¤çéè¯¯" class="headerlink" title="å¤çéè¯¯"></a>å¤çéè¯¯</h1><p>æ§è¡ç worker åçéè¯¯æ¶, ä¼è§¦å ErrorEvent, åå«ä¸ä¸ªå±æ§: filename, lineno, message</p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Deep in Viewport</title>
      <link href="/2017/06/05/Deep-in-Viewport/"/>
      <content type="html"><![CDATA[<p><code>vw</code>(viewport width) and <code>vh</code>(viewport height) are legnth units that represent exactly 1% of the size of any given viewport, regardless of its measurements. <code>rem</code>(short for root em) is also similar in its functionality, although it deals specifically with font sizes, and derives its name from the value fo the font size of the root element â which should default to 16 pixels on most browsers.</p><p>There are also a few more viewport units available for use, such as <code>vmin</code> and <code>vmax</code> which refer respectively to 1% of the viewportâs smaller dimension, and 1% of its larger dimension.</p><p>Interestingly enough, browsers actually calculate the entire browser window when it comes to width, meaning they factor the scrollbar into this dimension. Should you attempt to set the width of an element to a value of 100vw, it would force a horizontal bar to appear, since youâd be lightly stretching your viewport.</p><h1 id="Device-Pixels-and-CSS-Pixels"><a href="#Device-Pixels-and-CSS-Pixels" class="headerlink" title="Device Pixels and CSS Pixels"></a>Device Pixels and CSS Pixels</h1><p>Device Pixels are the kind of pixels we intuitively assume to be ârightâ. These pixels give the formal resolution of whichever device youâre working on, and can be read out from <code>screen.width/height</code>.</p><p>If you give a certain element a <code>width: 128px</code>, and your monitor is 1024px wide, and you maximize your browser screen, the element would fit out on your monitor eight times.</p><p>If the user zooms, however, this calculation is going to change. If the user zooms to 200%, your element with <code>width: 128px</code> will fit only four times on this 1024px wide monitor.</p><p>Zooming as implemented in modern browsers consists of nothing more than âstretching upâ pixels. That is, the width of the elemtn is not changed from 128 to 256px, instead <em>the actual pixels</em> are doubled in size. Formally, the element still has width of 128 CSS pixels, even though it happens to take the space of 256px.</p><p>In other words, zooming to 200% makes one css pixels grow to four times the size of one device pixels(two times the width, two times the height)</p><p>A few images will clarify the concept. Here are four pixels on 100% zoom level. Here CSS px fully overlap with device px.</p><p><img src="https://www.quirksmode.org/mobile/pix/viewport/csspixels_100.gif" alt=""></p><p>Letâs zoom out. The CSS pixels start to shrink, meaning that one device px now overlaps several CSS px.</p><p><img src="https://www.quirksmode.org/mobile/pix/viewport/csspixels_out.gif" alt=""></p><p>If you zoom in, the opposite happens. The CSS px start to grow, and now one CSS px overlap several device px.</p><p><img src="https://www.quirksmode.org/mobile/pix/viewport/csspixels_in.gif" alt=""></p><p>The point is that you are only interested in CSS px. Itâs those px that dictate how your style sheet is rendered.</p><p>Device px are almost entirely useless to you.</p><blockquote><p>At zoom level 100% one CSS px is exactly equal to Device px.</p></blockquote><h1 id="Screen-Size"><a href="#Screen-Size" class="headerlink" title="Screen Size"></a>Screen Size</h1><p><code>screen.width</code> and <code>screen.height</code> means the total width width and height of the userâs screen. <strong>These dimensions are measured in device px because they never change: theyâre feature of the monitor and not of the browser.</strong></p><p><img src="https://www.quirksmode.org/mobile/pix/viewport/desktop_screen.jpg" alt=""></p><h1 id="Window-Size"><a href="#Window-Size" class="headerlink" title="Window Size"></a>Window Size</h1><p><code>window.innerWidth</code> and <code>window.innerHeight</code></p><p><img src="https://www.quirksmode.org/mobile/pix/viewport/desktop_inner.jpg" alt=""></p><p>Window Size is measured in CSS px.</p><h1 id="Scrolling-Offset"><a href="#Scrolling-Offset" class="headerlink" title="Scrolling Offset"></a>Scrolling Offset</h1><p><code>window.pageXOffset</code> and <code>window.pageYOffset</code> contains the horizontal and vertical scrolling offsets of the document. Thus you can find out how much the user has scrolled.</p><p><img src="https://www.quirksmode.org/mobile/pix/viewport/desktop_page.jpg" alt=""></p><p>These properties measured in CSS px.</p><h1 id="Viewport"><a href="#Viewport" class="headerlink" title="Viewport"></a>Viewport</h1><p>The function of the viewport is to constrain the element, which is the uppermost containing block of your site.</p><p>Suppose you have a liquid layout and one of your sidebar has <code>width: 10%</code>. Now the sidebar neatly grows and shrinks as your resize the browser window. How does it work.</p><p>Technically, what happens is that the sidebar gets 10% of the width of its parent. Letâs say the . Normally all block-level element take 100% of the width of their parent ().</p><p>So your sidebar get width of 10% of browser.</p><p>In theory, the width of the element is restricted by the width of the viewport. The element takes 100% of the width of that viewport.</p><p>The viewport, in turn, is exactly equal to the browser window: itâs been defined as such. The viewport is not an HTML construct, so you cannot influence it by CSS. It just has the width and height of the browser window â on desktop. On mobile itâs quite a bit more complicated.</p><p>White <code>width: 100%</code> works fine at 100% zoom, if we zoomed in the viewport has become smaller than the total width of the site, the content will spills out of the element, but that element has <code>overflow: visible</code>, which means that the spilled-out content will be show in any case.</p><p><img src="https://www.quirksmode.org/mobile/pix/viewport/desktop_100percent.jpg" alt=""></p><h1 id="Measuring-the-viewport"><a href="#Measuring-the-viewport" class="headerlink" title="Measuring the viewport"></a>Measuring the viewport</h1><p>The Viewport size can be found in <code>document.documentElement.clientHeight</code> and <code>document.documentElement.clientWidth</code></p><p><img src="https://www.quirksmode.org/mobile/pix/viewport/desktop_client.jpg" alt=""></p><p>If you know your DOM, you know that <code>document.documentElement</code> is in fact the <code>&lt;html&gt;</code> element: the root element of any HTML document. However, the viewport is one level higher, so to speak, itâs the element that contains the <code>&lt;html&gt;</code> element. That matters if you give the <code>&lt;html&gt;</code> element a <code>width</code>.</p><p><img src="https://www.quirksmode.org/mobile/pix/viewport/desktop_client_smallpage.jpg" alt=""></p><p>So <code>document.documentElement.clientWidth</code> and <code>document.documentElement.clientHeight</code> always give the viewport dimensions, regardless of the dimensions of the <code>&lt;html&gt;</code> element.</p><h1 id="Measuring-the-element"><a href="#Measuring-the-element" class="headerlink" title="Measuring the element"></a>Measuring the element</h1><p><code>document.documentElement.offsetWidth</code> and <code>document.documentElement.offsetHeight</code> will give size.</p><p><img src="https://www.quirksmode.org/mobile/pix/viewport/desktop_offset.jpg" alt=""></p><p><img src="https://www.quirksmode.org/mobile/pix/viewport/desktop_offset_smallpage.jpg" alt=""></p><h2 id="Event-coordinates"><a href="#Event-coordinates" class="headerlink" title="Event coordinates"></a>Event coordinates</h2><p>There are the event coordinates. When a mouse event occurs, no less than five property pairs are exposed to give you information abou the exact place of the event. For our discussion three of them are important:</p><ul><li><p><code>pageX/pageY</code> gives the coordinates relative to the <code>&lt;html&gt;</code> element in CSS px.</p></li><li><p><code>clientX/Y</code> gives the coordinates relative to the viewport in CSS px.</p></li><li><p><code>screenX/Y</code> gives the coordinate relative to the screen in DEVICE px.</p></li></ul><p><img src="https://www.quirksmode.org/mobile/pix/viewport/desktop_pageXY.jpg" alt=""></p><p>Youâll use <code>pageX/Y</code> 90% of the time. Usually you want to know the event position relative to the document.</p><p>The other 10% of the time youâll use <code>clientX/Y</code></p><p>You never ever need to know the event coordiantes relative to the screen.</p><h3 id="Media-queries"><a href="#Media-queries" class="headerlink" title="Media queries"></a>Media queries</h3><p>There are two relavant media queries: <code>width/height</code> and <code>device-width/device-height</code></p><ul><li><p><code>width/height</code> uses the same values as <code>document.Element.clientWidth/clientHeight</code>, namely the viewport, it works with CSS px.</p></li><li><p><code>device-width/device-height</code> uses the same values as <code>screen.width/height</code> with device px.</p></li></ul><p><img src="https://www.quirksmode.org/mobile/pix/viewport/desktop_mediaqueries.jpg" alt=""></p><h1 id="The-problem-of-mobile-browser"><a href="#The-problem-of-mobile-browser" class="headerlink" title="The problem of mobile browser"></a>The problem of mobile browser</h1><p>Letâs go back to our sidebar with <code>width:10%</code>, if mobile browsers would do exactly the same as desktop browser, theyâd make the element about 40px (if the device-width is 400px). and thatâs too narrow. Your liquid layout would look horribly squashed.</p><h1 id="Two-viewports"><a href="#Two-viewports" class="headerlink" title="Two viewports"></a>Two viewports</h1><p>The viewport is too narrow to serve as a basis for your CSS layout. The obvious solution is to make the viewport wider. That however requires it to be split into two: the visual viewport and the layout viewport.</p><p>A simple explanation at StackOverFlow:</p><blockquote><p>Imagine the layout viewport as being a large image which does not change size or shape. Now image you have a smaller frame through which you look at the large image. The small frame is surrounded by opaque material which obscures your view of all but a portion of the large image. The portion of the large image that you can see through the frame is the visual port. You can back away from the large image while holding your frame(zoom out) to see the entire image at once, or you can move closer(zoom in) to see only a portion. You can also change the orientation of the frame, but the size and shape of the large image (layout viewport) never changes.</p></blockquote><p>The visual viewport is the part of the page thatâs currently shown on-screen.</p><p>The user may scroll to change the part of the page he sees, or zoom to change the size of the visual viewport.</p><p><img src="https://www.quirksmode.org/mobile/pix/viewport/mobile_visualviewport.jpg" alt=""></p><p>However, the CSS layout, especially percentual widths, are calculated relative to the <strong>layout viewport</strong>, which is considerably wider than the visual viewport.</p><p>Thus the <code>&lt;html&gt;</code> element tabkes the width of the layout viewport initially, and your CSS is interpreted as if the screen were significantly wider than the phone screen. This makes sure that your siteâs layout behaves as it does on a desktop browser.</p><p>How wide is the layout viewport? That differs per browser.</p><ul><li><p>Safari uses 980px</p></li><li><p>Opera uses 850px</p></li><li><p>Android 800px</p></li><li><p>IE 974px</p></li></ul><h1 id="Understanding-the-layout-viewport"><a href="#Understanding-the-layout-viewport" class="headerlink" title="Understanding the layout viewport"></a>Understanding the layout viewport</h1><p>In order to understand the size of the layout viewport we have to take a look at what happens when the page if fully zoomed out. Many mobile browsers initially show any page in fully zoomed-out mode.</p><p>The point is: browser have chosen their dimensions of the layout viewport such that it completely covers the screen if fully zoomed-out mode(equal to the visual viewport)</p><p><img src="https://www.quirksmode.org/mobile/pix/viewport/mobile_viewportzoomedout.jpg" alt=""></p><p>Thus the width and the height of the layout viewport are equal to whatever can be shown on the screen in the maximally zoomed-out mode. When the user zooms in these dimensions stay the same.</p><p><img src="https://www.quirksmode.org/mobile/pix/viewport/mobile_layoutviewport.jpg" alt=""></p><p>The layout viewport width is always the same, if you rotate your phone, the visual viewport changes, but the browser adapts to this new orientation by zooming in slightly so that the layout viewport is again as wide as the visual viewport.</p><p>This has consequences for the layout viewportâs height, which is now substantially less than in portrait mode. But web developers donât care about the height, only about the width.</p><p><img src="https://www.quirksmode.org/mobile/pix/viewport/mobile_layoutviewport_la.jpg" alt=""></p><h1 id="Measuring-the-layout-viewport"><a href="#Measuring-the-layout-viewport" class="headerlink" title="Measuring the layout viewport"></a>Measuring the layout viewport</h1><p><code>document.documentElement.clientWidth</code> and <code>document.documentElement.clientHeight</code> contain the layout viewportâs dimensions.</p><p><img src="https://www.quirksmode.org/mobile/pix/viewport/mobile_client.jpg" alt=""></p><p>The orientation matters for the height, but not for the width.</p><h1 id="Measuring-the-visual-viewport"><a href="#Measuring-the-visual-viewport" class="headerlink" title="Measuring the visual viewport"></a>Measuring the visual viewport</h1><p>As to the visual viewport, it is measured by <code>window.innerWidth/innerHeight</code>. Obviously the measurements change when the user zooms out or in, since more or fewer CSS px fit into the screen.</p><p><img src="https://www.quirksmode.org/mobile/pix/viewport/mobile_inner.jpg" alt=""></p><h1 id="The-Screen"><a href="#The-Screen" class="headerlink" title="The Screen"></a>The Screen</h1><p>As on desktop, <code>screen.width/height</code> gives the screen size, in device pixels. As on the desktop, you never need this information as a web developer.</p><h1 id="Visual-viewport-position-relative-to-Layout-viewport"><a href="#Visual-viewport-position-relative-to-Layout-viewport" class="headerlink" title="Visual viewport position relative to Layout viewport"></a>Visual viewport position relative to Layout viewport</h1><p><img src="https://www.quirksmode.org/mobile/pix/viewport/mobile_page.jpg" alt=""></p><h1 id="html-element"><a href="#html-element" class="headerlink" title="html element"></a>html element</h1><p>Just as on desktop, <code>document.documentElemetn.offsetWidth/offsetHeight</code> gives the total size of the <code>&lt;html&gt;</code> element in CSS px.</p><h1 id="Meta-Viewport"><a href="#Meta-Viewport" class="headerlink" title="Meta Viewport"></a>Meta Viewport</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=320"</span>&gt;</span></span><br></pre></td></tr></table></figure><p>It is meant to resize the layout viewport.</p><p>Suppose you build a simple page and give your elemnet no <code>width</code>. Now they stretch up to take 100% of the width of the layout viewport. Most browsers zoom out to show the entire layout viewport on the screen, giving an effect like this</p><p><img src="https://www.quirksmode.org/mobile/pix/viewport/mq_none.jpg" alt=""></p><p>All user will immediately zoom in, which works, but most browsers keep the width of the elements intact, whcih makes the text hard to read.</p><p><img src="https://www.quirksmode.org/mobile/pix/viewport/mq_none_zoomed.jpg" alt=""></p><p>Now what you can try is setting <code>html {width: 320px}</code> then</p><p><img src="https://www.quirksmode.org/mobile/pix/viewport/mq_html300.jpg" alt=""></p><p>When you set</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=320"</span>&gt;</span></span><br></pre></td></tr></table></figure><p>You set the width of the layout viewport to 320px.</p><p><img src="https://www.quirksmode.org/mobile/pix/viewport/mq_yes.jpg" alt=""></p><p>Of course now we use</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width"</span>&gt;</span></span><br></pre></td></tr></table></figure><p>to adapt to various browsers.</p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Utils in Axios</title>
      <link href="/2017/06/05/utils-in-axios/"/>
      <content type="html"><![CDATA[<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// global toString</span></span><br><span class="line"><span class="keyword">var</span> toString = <span class="built_in">Object</span>.prototype.toString</span><br><span class="line"></span><br><span class="line"><span class="comment">// isArray</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isArray</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> toString.call(val) === <span class="string">'[object Array]'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// isArrayBuffer</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isArrayBuffer</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> toString.call(val) === <span class="string">'[object arrayBuffer]'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// isFormData</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isFormData</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="keyword">typeof</span> FormData !== <span class="string">'undefined'</span> &amp;&amp; (val <span class="keyword">instanceof</span> FormData))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// isString</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isString</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> val === <span class="string">'string'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// isNumber</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isNumber</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> val === <span class="string">'number'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// isUndefinded</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isUndefined</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> val === <span class="string">'undefined'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// isObject</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isObject</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> val !== <span class="literal">null</span> &amp;&amp; <span class="keyword">typeof</span> val === <span class="string">'object'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// isDate</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isDate</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> toString.call(val) === <span class="string">'[object Date]'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// isFile</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isFile</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> toString.call(val) === <span class="string">'[object File]'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// isBlob</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isBlob</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> toString.call(val) === <span class="string">'[object Blob]'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// isFunction</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isFunction</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> toString.call(val) === <span class="string">'[object Function]'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// isStream</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isStream</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> isObject(val) &amp;&amp; isFunction(val.pipe)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// isURLSearchParams</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isURLSearchParams</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> URLSearchParams !== <span class="string">'undefined'</span> &amp;&amp; val <span class="keyword">instanceof</span> URLSearchParams</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// trim</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">trim</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> str.replace(<span class="regexp">/^\s*/</span>, <span class="string">''</span>).replace(<span class="regexp">/\s*$/</span>, <span class="string">''</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// isStandardBrowserEnv</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isStandardBrowserEnv</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> navigator !== <span class="string">'undefined'</span> &amp;&amp; navigator.product === <span class="string">'ReactNative'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="keyword">typeof</span> <span class="built_in">window</span> !== <span class="string">'undefined'</span></span><br><span class="line">    &amp;&amp; <span class="keyword">typeof</span> <span class="built_in">document</span> !== <span class="string">'undefined'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Iterate over an Array or an Object invoking a function for each item</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">forEach</span> (<span class="params">obj, fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (obj === <span class="literal">null</span> || <span class="keyword">typeof</span> obj === <span class="string">'undefined'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> obj !== <span class="string">'object'</span> &amp;&amp; !isArray(obj)) &#123;</span><br><span class="line">    obj = [obj]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (isArray(obj)) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, l = obj.length; i &lt; l; i++) &#123;</span><br><span class="line">      fn.call(<span class="literal">null</span>, obj[i], i, obj)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">Object</span>.prototype.hasOwnProperty.call(obj, key)) &#123;</span><br><span class="line">        fn.call(<span class="literal">null</span>, obj[key], key, obj)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Concept of PWA</title>
      <link href="/2017/06/01/concept-of-PWA/"/>
      <content type="html"><![CDATA[<h1 id="Advantages-of-Progressive-Web-Apps"><a href="#Advantages-of-Progressive-Web-Apps" class="headerlink" title="Advantages of Progressive Web Apps:"></a>Advantages of Progressive Web Apps:</h1><ul><li><p>Reliable - Load instantly and never show the dinasaur.</p></li><li><p>Fast - Respond quickly to user interactions with silky smooth animations.</p></li><li><p>Enaging - Feel like a natural app on the device, with immersive user experience.</p></li></ul><h1 id="What-is-a-Progressive-Web-App"><a href="#What-is-a-Progressive-Web-App" class="headerlink" title="What is a Progressive Web App"></a>What is a Progressive Web App</h1><ul><li><p>Progressive - Works for every user, regardless of browser choice because itâs built with progressive enhancement as a core tenet.</p></li><li><p>Responsive - Fits any form factor: desktop, mobile, tablet, or whatever is next.</p></li><li><p>Connectively independent - Enhanced with service workers to work offline or on low-quality networks.</p></li><li><p>App-like - Feels like an app, because the app shell model seperates the application <em>functionality</em> from application <em>content</em>.</p></li><li><p>Fresh - Always up-to-date thanks to the service worker update process.</p></li><li><p>Safe - Served via HTTPS to prevent snooping and to ensure content hasnât been tampered with.</p></li><li><p>Discoverable - Is identifiable as an âapplicationâ thanks to <em>W3C manifest</em> and <em>service worker registration</em> scope, allowing search engines to find it.</p></li><li><p>Re-engagable - Makes Re-engagement easy through features like push notification.</p></li><li><p>Installable - Allows users to add apps they find most useful to their home screen without the hassle of an app store.</p></li><li><p>Linkable - Easily share the application via URL, doesnât require complex installation.</p></li></ul><h2 id="What-is-App-Shell"><a href="#What-is-App-Shell" class="headerlink" title="What is App Shell"></a>What is App Shell</h2><p>The appâs shell is the minimal HTML, CSS, JavaScript that is required to power the user interface of a progressive web app and is one of the components that ensures reliably good performance. Its first load should be extremely quick and immediately cached.</p><p>âChchedâ means that the shell files are loaded once over the network and then saved to the local device. Every subsequent time that the user opens the app, the shell files are loaded from the local deviceâs cache, which results in blazing-fast startup times.</p><p>App shell architecture seperates the core application infrastructure and UI from the data. All of the UI and infrastructure is cached locally using a <em>service worker</em> so that on subsequent loads, the PWA only needs to retrieve the necessary data, instead of having to load everything.</p><p>A service worker is a script that your browser runs in the background, seperate from a web page, opening the door to features that donât need a web page or user interaction.</p><p><img src="https://codelabs.developers.google.com/codelabs/your-first-pwapp/img/156b5e3cc8373d55.png" alt=""></p><p>The app shell is similar to the bundle of code that youâd publish to an app store when building a native app. It is the core components necessary to get your app off the ground, but likely doesnât contain the data.</p><p>Using the app shell architecture allows you to focus on speed, giving the PWA similar properties to native apps:</p><ul><li><p>instant loading</p></li><li><p>regular updates</p></li></ul><h2 id="Implement-App-Shell"><a href="#Implement-App-Shell" class="headerlink" title="Implement App Shell"></a>Implement App Shell</h2><h3 id="Create-the-HTML-for-the-App-Shell"><a href="#Create-the-HTML-for-the-App-Shell" class="headerlink" title="Create the HTML for the App Shell"></a>Create the HTML for the App Shell</h3><p>The Components consist of:</p><ul><li><p>Header with a title, and app/refresh button</p></li><li><p>Container for forecast cards</p></li><li><p>A forecast card template</p></li><li><p>A dialog for adding new cities</p></li><li><p>A loading indicator</p></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Weather PWA<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"styles/inline.css"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">header</span> <span class="attr">class</span>=<span class="string">"header"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">"header__title"</span>&gt;</span>Weather PWA<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"butRefresh"</span> <span class="attr">class</span>=<span class="string">"headerButton"</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"butAdd"</span> <span class="attr">class</span>=<span class="string">"headerButton"</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">main</span> <span class="attr">class</span>=<span class="string">"main"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"card cardTemplate weather-forecase"</span> <span class="attr">hidden</span>&gt;</span></span><br><span class="line">        ...</span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"dialog-container"</span>&gt;</span></span><br><span class="line">      ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"loader"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">svg</span> <span class="attr">viewBox</span>=<span class="string">"0 0 32 32"</span> <span class="attr">with</span>=<span class="string">"32"</span> <span class="attr">height</span>=<span class="string">"32"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">circle</span> <span class="attr">id</span>=<span class="string">"spinner"</span> <span class="attr">cx</span>=<span class="string">"16"</span> <span class="attr">cy</span>=<span class="string">"16"</span> <span class="attr">r</span>=<span class="string">"14"</span> <span class="attr">fill</span>=<span class="string">"none"</span>&gt;</span><span class="tag">&lt;/<span class="name">circle</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- insert link to app.js here --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Notice the loader is visible by default. This ensures that the user sees the loader immediately as the page loads, giving them a clear indication that the content is loading.</p><h3 id="Start-with-a-fast-load"><a href="#Start-with-a-fast-load" class="headerlink" title="Start with a fast load"></a>Start with a fast load</h3><h4 id="Differentiating-the-first-run"><a href="#Differentiating-the-first-run" class="headerlink" title="Differentiating the first run"></a>Differentiating the first run</h4><p>User preferences, like the list of cities a user has subscribed to, should be stored locally using IndexedBD or another fast storage mechanism. To simplify this code, here we use localStorage, which is not ideal for production apps because it is a blocking, synchronous storage mechanism that is potentially very slow on some device.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Save list of cities to lcoalStorage</span></span><br><span class="line">app.saveSelectedCities = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> selectedCities = <span class="built_in">JSON</span>.stringify(app.selectedCities)</span><br><span class="line">  localStorage.selectedCities = selectedCities</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Next, letâs add the startup code to check if the user has any saved cities and render those</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">app.selectedCities = lcoalStorage.selectedCities</span><br><span class="line"><span class="keyword">if</span> (app.selectedCities) &#123;</span><br><span class="line">  app.selectedCities = <span class="built_in">JSON</span>.parse(app.selectedCities)</span><br><span class="line">  app.selectedCities.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">city</span>) </span>&#123;</span><br><span class="line">    app.getForecast(city.key, city.label)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  app.updateForecastCard(initialWeatherForecast)</span><br><span class="line">  app.selectedCities = [</span><br><span class="line">    &#123;</span><br><span class="line">      key: initialWeatherForecast.key,</span><br><span class="line">      label: initialWeatherForecast.label,</span><br><span class="line">    &#125;,</span><br><span class="line">    app.saveSelectedCities()</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Use-service-workers-to-pre-cache-the-App-Shell"><a href="#Use-service-workers-to-pre-cache-the-App-Shell" class="headerlink" title="Use service workers to pre-cache the App Shell"></a>Use service workers to pre-cache the App Shell</h3><p>PWA has to be fast, and installable, which means that they work online, offline, and on intermittent, slow connections.</p><p>To achieve this, we need to cache our app shell using service worker, so that itâs always available quickly and reliably.</p><p>Features provided via service workers should be considered a progressive enhancement, and added only if supported by the browser.</p><h4 id="Register-the-service-worker-if-itâs-available"><a href="#Register-the-service-worker-if-itâs-available" class="headerlink" title="Register the service worker if itâs available"></a>Register the service worker if itâs available</h4><p>The first step to making the app work offline is to register a service worker, a script that allows background functionality without the need of an open web page or user interaction.</p><p>This takes two simple steps:</p><ul><li><p>Tell the browser to register the JavaScript file as the service worker</p></li><li><p>Create a JavaScript file containing the service worker</p></li></ul><p>First, we need to check if the browser supports service worker, and if it does, register the service worker. Add the following code to <code>app.js</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="string">'serviceWorker'</span> <span class="keyword">in</span> navigator) &#123;</span><br><span class="line">  navigator.serviceWorker</span><br><span class="line">  .register(<span class="string">'./service-worker.js'</span>)</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Service Worker Registered'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Cache-the-site-assets"><a href="#Cache-the-site-assets" class="headerlink" title="Cache the site assets"></a>Cache the site assets</h4><p>When the service worker is registered, an install event is triggered the first time the user visits the page.</p><p>In this event handler, we will cache all the assets that are needed for the application.</p><p>When the service worker is fired, it should open the <code>caches</code> object and populate it with the assets necessary to load the App Shell. Create a file called <code>service-worker.js</code> in your application root folder. This file must live in the application root because the scope for service worker is defined by the directory in which the file resides. Add this code to your new <code>service-worker.js</code> file.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> cacheName = <span class="string">'weatherPWA'</span></span><br><span class="line"><span class="keyword">var</span> filesToCache = []</span><br><span class="line"></span><br><span class="line">self.addEventListener(<span class="string">'install'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'[ServiceWorker] Install'</span>)</span><br><span class="line">  e.waitUntil(</span><br><span class="line">    caches.open(cacheName).then(<span class="function"><span class="keyword">function</span> (<span class="params">cache</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'[ServiceWorker] Caching app shell'</span>)</span><br><span class="line">      <span class="keyword">return</span> cache.addAll(filesToCache)</span><br><span class="line">    &#125;)</span><br><span class="line">  )</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>First, we need to open the cache with <code>caches.open()</code> and provide a cache name. Providing a cache name allows us to version files, or separate data from the app shell so that we can easily update one but not affect other.</p><p>Once the cache is open, we can then call <code>cache.addAll()</code>, which takes a list of URLs, then fetches them from the server and adds the response to the cache. Unfortunately, <code>cache.addAll()</code> is atomic, if any of the files fail, the entire cache step fails.</p><p>DevTools can debug service workers. Before reloading your page, open up DevTools, go the <code>Service Worker</code> pane on the <code>Application</code> panel.</p><p><img src="https://codelabs.developers.google.com/codelabs/your-first-pwapp/img/ed4633f91ec1389f.png" alt=""></p><p>When you see a blank page like this, it means that the currently open page doesnât have any registered service workers.</p><p>Now reload your page. The Service Worker pane should look like this.</p><p><img src="https://codelabs.developers.google.com/codelabs/your-first-pwapp/img/bf15c2f18d7f945c.png" alt=""></p><p>When you see information like this, it means the page has a service worker running.</p><p>Letâs add some logic on the <code>activate</code> event listener to update the cache.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">self.addEventListener(<span class="string">'activate'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'[ServiceWorker] Activate'</span>)</span><br><span class="line">  e.waitUntil(</span><br><span class="line">    caches.keys().then(<span class="function"><span class="keyword">function</span> (<span class="params">keyList</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.all(keyList.map(<span class="function"><span class="keyword">function</span> (<span class="params">key</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (key !== cacheName) &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">'[ServiceWorker] Removing old cache'</span>, key)</span><br><span class="line">          <span class="keyword">return</span> caches.delete(key)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;))</span><br><span class="line">    &#125;)</span><br><span class="line">  )</span><br><span class="line">  <span class="keyword">return</span> self.clients.claim()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>This code ensures that your service worker updates its cache whenever any of the app shell files change. In order for this to work, youâd need to increment the <code>cacheName</code> variable at the top of your service worker file.</p><p>When the app is complete, <code>self.clients.claim()</code> fixes a corner case in which the app wasnât returning the latest data. You can reproduce the corner case by commenting out the line below and then doing the following steps:</p><ul><li><p>load app for first time so that the initial City data is shown</p></li><li><p>press the refresh button on the app</p></li><li><p>go offline</p></li><li><p>reload the app</p></li></ul><p>You expect to see the newer data, but you actually see the initial data. This happens because the service worker is not yet activated. <code>self.clients.claim()</code> essentially lets you activate the service worker faster.</p><p>Finally, letâs update the list of files required for the app shell. In the array, we need to include all of the files our app needs, including images, js, css, etc.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> filesToCache = [</span><br><span class="line">  <span class="string">'/'</span>,</span><br><span class="line">  <span class="string">'/index.html'</span>,</span><br><span class="line">  <span class="string">'/scripts/app.js'</span>,</span><br><span class="line">  <span class="string">'/styles/inline.css'</span>,</span><br><span class="line">  <span class="string">'/images/clear.png'</span>,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><h4 id="Serve-the-app-shell-from-the-cache"><a href="#Serve-the-app-shell-from-the-cache" class="headerlink" title="Serve the app shell from the cache"></a>Serve the app shell from the cache</h4><p>Service workers provide the ability to intercept requests made from our PWA and handle them within the service worker. That means we can determine how we want to handle the request and potentially serve our own cached response.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">self.addEventListener(<span class="string">'fetch'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'[ServiceWorker] Fetch'</span>, e.request.url)</span><br><span class="line">  e.responseWith(</span><br><span class="line">    caches.match(e.request).then(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> response || fetch(e.request)</span><br><span class="line">    &#125;)</span><br><span class="line">  )</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Stepping from inside, out, <code>caches.match()</code> evaluates the web request that triggered the <code>fetch</code> event, and checks to see if itâs available in the cache. It then either responds with the cached version, or uses <code>fetch</code> to get a copy from the network. The <code>response</code> is passed back to the web page with <code>e.responseWith()</code></p><h3 id="Beware-of-the-edge-cases"><a href="#Beware-of-the-edge-cases" class="headerlink" title="Beware of the edge cases"></a>Beware of the edge cases</h3><p>This code must not be used in production because of the many unhandled edge cases</p><ul><li><p>Cache depends on updating the cache key for every change</p></li><li><p>Requires everything to be redownloaded for every change</p></li><li><p>Browser cache may prevent the service worker cache from updating</p></li><li><p>Beware of cache-first strategies in production</p></li></ul>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Simple Guide of Jest</title>
      <link href="/2017/05/31/Simple-Guide-of-Jest/"/>
      <content type="html"><![CDATA[<h1 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev jest</span><br></pre></td></tr></table></figure><h1 id="Simple-Case"><a href="#Simple-Case" class="headerlink" title="Simple Case"></a>Simple Case</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// sum.js</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span> (<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = sum</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// sum.test.js</span></span><br><span class="line"><span class="keyword">const</span> test = <span class="built_in">require</span>(<span class="string">'jest'</span>)</span><br><span class="line"><span class="keyword">const</span> expect = <span class="built_in">require</span>(<span class="string">'expect'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sum = <span class="built_in">require</span>(<span class="string">'./sum'</span>)</span><br><span class="line">test(<span class="string">'adds 1 + 2 to equals 3'</span>, () =&gt; &#123;</span><br><span class="line">  expect(sum(<span class="number">1</span>, <span class="number">2</span>).toBe(<span class="number">3</span>))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="With-Babel"><a href="#With-Babel" class="headerlink" title="With Babel"></a>With Babel</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev babel-jest</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// .babelrc</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"presets"</span>: [</span><br><span class="line">    [ <span class="string">"env"</span>, &#123;</span><br><span class="line">      <span class="attr">"targets"</span>: &#123;</span><br><span class="line">        <span class="attr">"node"</span>: <span class="string">"current"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>Jest will automatically define <code>NODE_ENV</code> as <code>test</code>. It will not use <code>development</code> section like Babel does by default when no <code>NODE_ENV</code> is set.</p></blockquote><blockquote><p><code>babel-jest</code> is automatically installed when installing Jest and will automatically transform files if a babel configuration exists in your project. To avoid this, you can explicitly reset the <code>transform</code> configuration option:</p></blockquote><p>In <code>package.json</code></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"jest"</span>: &#123;</span><br><span class="line">    <span class="attr">"transform"</span>: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Globals"><a href="#Globals" class="headerlink" title="Globals"></a>Globals</h2><p>In your test files, Jest puts each of its methods and objects into the global environment. You donât need to require or import anything to use them.</p><h3 id="Methods"><a href="#Methods" class="headerlink" title="Methods"></a>Methods</h3><ul><li>afterAll(fn): Runs a function after all the tests in this file have completed. If the function returns a promise, Jest waits for that promise to resolve before continuing. This is often useful if you want to clean up some global setup state that is shared across tests.</li></ul><p>If <code>afterAll</code> is inside a <code>describe</code> block, it runs at the end of the describe block.</p><ul><li>afterEach(fn): Runs a function after each test in this file. If the function returns a promise, Jest waits for the promise to resolve before continuing. This is often useful if you want to clean up some temprary state that is created by each test.</li></ul><p>If <code>afterEach</code> is inside a <code>describe</code> block, it only runs after the tests that are inside this describe block.</p><ul><li><p>beforeAll(fn): similar to <code>afterAll()</code></p></li><li><p>beforeEach(fn): similar to <code>afterEach()</code></p></li><li><p>describe(name, fn): create a block that groups together several related tests in one âtest suiteâ. For example, if you have a <code>myBeverage</code> object that is supposed to be delicious but not sour, you could test it with:</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> myBeverage = &#123;</span><br><span class="line">  delicious: <span class="literal">true</span>,</span><br><span class="line">  sour: <span class="literal">false</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'my beverage'</span>, () =&gt; &#123;</span><br><span class="line">  test(<span class="string">'is delicious'</span>, () =&gt; &#123;</span><br><span class="line">    expect(myBeverage.delicious).toBeTruthy()</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  test(<span class="string">'is not sour'</span>, () =&gt; &#123;</span><br><span class="line">    expect(myBeverage.sour).toBeFalsy()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>This isnât required - you can just write the <code>test</code> block directly at the top level.</p><ul><li>describe.only(name, fn): You can use <code>describe.only</code> if you want to run only one describe block</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">describe.only(<span class="string">'my beverage'</span>, () =&gt; &#123;</span><br><span class="line">  test(<span class="string">'is delicious'</span>, () =&gt; &#123;</span><br><span class="line">    expect(myBeverage.delicious).toBeTruthy()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'my other beverage'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="comment">// ...will be skipped</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>describe.skip(name, fn): you can use <code>describe.skip</code> if you do not want to run a particular describe block:</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">describe(<span class="string">'my beverage'</span>, () =&gt; &#123;</span><br><span class="line">  test(<span class="string">'is delicious'</span>, () =&gt; &#123;</span><br><span class="line">    expect(myBeverage.delicious).toBeTruthy()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">describe.skip(<span class="string">'my other beverage'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="comment">// ... will be skipped</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li><p>require.requireActual(moduleName): returns the actual module instead of a mock, bypassing all checks on whether the module should receive a mock implementation or not.</p></li><li><p>require.requireMock(moduleName): returns a mock module instead of the actual module, bypassing all checks on whether the module should be required normally or not.</p></li><li><p>test(name, fn): Also under the alias <code>it(name, fn)</code>, all you need in a test file is that the <code>test</code> method which runs a test. For example, letâs say thereâs a function <code>inchesOfRain()</code> that should be zero. Your whole test could be:</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">test(<span class="string">'did not rain'</span>, () =&gt; &#123;</span><br><span class="line">  expect(inchesOfRain()).toBe(<span class="number">0</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>The first argument is the test name; the second argument is a function that contains the expectations to test</p><p>If a promise is returned from <code>test</code>, Jest will wait for the promise to resolve before letting the test complete.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">test(<span class="string">'has lemon in it'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> fetchBeverageList().then(<span class="function"><span class="params">list</span> =&gt;</span> &#123;</span><br><span class="line">    expect(list).toContain(<span class="string">'lemon'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Even though the call to <code>test</code> will return right away, the test doesnât complete until the promise resolves as well.</p><ul><li><p>test.only(name, fn): similar to <code>describe.only()</code></p></li><li><p>test.skip(name, fn): similar to <code>describe.skip()</code></p></li></ul>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Webpack Code Splitting - Async</title>
      <link href="/2017/05/30/webpack-code-splitting-async/"/>
      <content type="html"><![CDATA[<p>Currently a âfunction-likeâ <code>import()</code> module loading syntax proposal is on the way into ECMAScript.</p><p>The ES6 Defines <code>import()</code> as method to load ES6 modules dynamically onruntime.</p><p>Webpack treats <code>import()</code> as a split-point and puts the requested module in a seperate chunk. <code>import()</code> takes the module name as argument and returns a <code>Promise</code>: <code>import(name) =&gt; Promise</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">determineDate</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">import</span>(<span class="string">'moment'</span>).then(<span class="function">(<span class="params">moment</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(moment().format())</span><br><span class="line">  &#125;).catch(<span class="function"><span class="params">e</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'failed'</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">determineDate()</span><br></pre></td></tr></table></figure><p>Note that the fully dynamic statement, such as <code>import(foo)</code> will fail because webpack requries at least some file location information. This is because <code>foo</code> could potentially be any path to any file in your system or project. The <code>import()</code> must contain at least some information about where the module is located. so bundling can be limited to a specific directory or set of files.</p><h1 id="Chunk-Name"><a href="#Chunk-Name" class="headerlink" title="Chunk Name"></a>Chunk Name</h1><p>Since webpack 2.4.0, chunk names for dynamic imports can be specified using a âmagic commentâ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>(<span class="comment">/* webpackChunkName: 'my-chunk-name' */</span> <span class="string">'module'</span>)</span><br></pre></td></tr></table></figure><p>Since webpack 2.6.0, the placeholder <code>[request]</code>, <code>[index]</code> are supported:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// will generate files like `i18n/namespace-i18n-bundle-en.json`</span></span><br><span class="line"><span class="keyword">import</span>(<span class="comment">/* webpackChunkName: 'i18n/[request]' */</span> <span class="string">`i18n/<span class="subst">$&#123;namespace&#125;</span>-i18n-bundle-<span class="subst">$&#123;language&#125;</span>.json`</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// will generate files `i18n-0`, `i18n-1`</span></span><br><span class="line"><span class="keyword">import</span>(<span class="comment">/* webpackChunkName: 'i18n-[index]' */</span> <span class="string">'`i18n/$&#123;namespace&#125;-i18n-bundle-$&#123;language&#125;.json`'</span>)</span><br></pre></td></tr></table></figure><h1 id="import-mode"><a href="#import-mode" class="headerlink" title="import mode"></a>import mode</h1><p>Since webpack 2.6.0, different modes for resolving dynamic imports can be specified:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>(<span class="comment">/* webpackMode: lazy */</span> <span class="string">`i18n/<span class="subst">$&#123;namespace&#125;</span>-i18n-<span class="subst">$&#123;language&#125;</span>.json`</span>)</span><br></pre></td></tr></table></figure><ul><li><p>lazy: The default behavior. Lazy generates a chunk per request. So everything is lazy loaded.</p></li><li><p>lazy-once: Only available for imports with expression. Generate a single chunk for all possible requests. So the first request causes a network request for all modules, all following requests are already fulfilled.</p></li><li><p>eager: Eager generates no chunk. All files are included in the current chunk. No network request is required to load the files. It still returns a Promise, but itâs already resolved.</p></li></ul><p>You can combine both options ( webpackChunkName and webpackMode ), itâs parsed a JSON5 object without curly brackets:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>(<span class="comment">/* webpackMode: 'lazy-once', webpackChunkName: 'all-i18n-data' */</span> <span class="string">`i18n/<span class="subst">$&#123;namespace&#125;</span>-i18n-<span class="subst">$&#123;lanaguage&#125;</span>.json`</span>)</span><br></pre></td></tr></table></figure><h1 id="Usage-with-Babel"><a href="#Usage-with-Babel" class="headerlink" title="Usage with Babel"></a>Usage with Babel</h1><p>If you want to use <code>import</code> with Babel, youâll need to install the <code>syntax-dynamic-import</code> plugin while itâs still Stage 3 to get around the parser error.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev babel-core babel-loader babel-plugin-syntax-dynamic-import babel-preset-es2015</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">determineDate</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">import</span>(<span class="string">'moment'</span>).then(<span class="function"><span class="params">moment</span> =&gt;</span> moment().format()).then(<span class="function"><span class="params">str</span> =&gt;</span> <span class="built_in">console</span>.log(str)).catch(<span class="function"><span class="params">e</span> =&gt;</span> <span class="built_in">console</span>.log(e))</span><br><span class="line">&#125;</span><br><span class="line">determineDate()</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: <span class="string">'./index'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">'app.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">        loader: <span class="string">'babel-loader'</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"presets"</span>: [[<span class="string">"es2015"</span>, &#123; <span class="attr">"modules"</span>: <span class="literal">false</span> &#125;]],</span><br><span class="line">  <span class="attr">"plugins"</span>: [<span class="string">"syntax-dynamic-import"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>Diabled default import in es6.</p></blockquote><p>Not using the <code>syntax-dynamic-import</code> plugin will fail the build with</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Module build failed: SyntaxError: <span class="string">'import'</span> and <span class="string">'export'</span> may only appear at the top level</span><br></pre></td></tr></table></figure><p>or</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Module build failed: SyntaxError: Unexpected token, expected \&#123;</span><br></pre></td></tr></table></figure><h1 id="Usage-with-Babel-and-async-await"><a href="#Usage-with-Babel-and-async-await" class="headerlink" title="Usage with Babel and async / await"></a>Usage with Babel and <code>async / await</code></h1><p>To use es7 <code>async</code>/<code>await</code> with <code>import()</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev babel-plugin-transform-async-to-generator babel-plugin-trasnform-regenerator babel-plugin-transform-runtime babel-plugin-syntax-async-functions</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">determineDate</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> moment = <span class="keyword">await</span> <span class="keyword">import</span>(<span class="string">'moment'</span>)</span><br><span class="line">  <span class="keyword">return</span> moment().format()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">determineDate().then(<span class="function"><span class="params">str</span> =&gt;</span> <span class="built_in">console</span>.log(str))</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"presets"</span>: [[<span class="string">"es2015"</span>, &#123; <span class="attr">"modules"</span>: <span class="literal">false</span> &#125;]],</span><br><span class="line">  <span class="attr">"plugins"</span>: [</span><br><span class="line">    <span class="string">"syntax-async-functions"</span>,</span><br><span class="line">    <span class="string">"syntax-dynamic-import"</span>,</span><br><span class="line">    <span class="string">"transform-async-to-generator"</span>,</span><br><span class="line">    <span class="string">"trasnform-regenerator"</span>,</span><br><span class="line">    <span class="string">"transform-runtime"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="import-imports-the-entire-module-namespace"><a href="#import-imports-the-entire-module-namespace" class="headerlink" title="import() imports the entire module namespace"></a><code>import()</code> imports the entire module namespace</h1><p>Note that the promise is resolved with the module namespace. Consider the following two examples:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Example 1: top-level import</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> Component <span class="keyword">from</span> <span class="string">'./component'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Example 2: Code Splitting With Import()</span></span><br><span class="line"><span class="keyword">import</span>(<span class="string">'./component'</span>).then(<span class="function"><span class="params">Component</span> =&gt;</span> <span class="comment">/* ... */</span>)</span><br></pre></td></tr></table></figure><p><code>Component</code> in both of the cases resolves to the same thing, meaning in the case of using <code>import()</code> with ES2015 moduels you have to explicitly access default and named exports:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">main</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Destructing Example</span></span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="attr">default</span>: Component &#125; = <span class="keyword">await</span> <span class="keyword">import</span> (<span class="string">'./component'</span>)</span><br><span class="line">  <span class="comment">// Inline example</span></span><br><span class="line">  render((<span class="keyword">await</span> <span class="keyword">import</span>(<span class="string">'./component'</span>)).default)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Mongodb Simple Guide</title>
      <link href="/2017/05/30/mongodb-simple-guide/"/>
      <content type="html"><![CDATA[<ul><li><p><code>yarn add mongoose</code></p></li><li><p><code>import mongoose from &#39;mongoose&#39;</code></p></li><li><p><code>const db = mongoose.conenct(MONGODB_URI)</code></p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mongoose <span class="keyword">from</span> <span class="string">'mongoose'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> db = mongoose.connect(MONGODB_URI)</span><br><span class="line"></span><br><span class="line">db.connection.on(<span class="string">'open'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'connected'</span>)</span><br><span class="line">&#125;)</span><br><span class="line">db.connection.on(<span class="string">'error'</span>, (err) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`db error: <span class="subst">$&#123;err&#125;</span>`</span>)</span><br><span class="line">  process.exit</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="Schema"><a href="#Schema" class="headerlink" title="Schema"></a>Schema</h1><p>Schema defines the skeleton of minimal unit</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mongoose <span class="keyword">from</span> <span class="string">'mongoose'</span></span><br><span class="line"><span class="keyword">const</span> TestSchema = <span class="keyword">new</span> mongoose.Schema(&#123;</span><br><span class="line">  name: &#123; <span class="attr">type</span>: <span class="built_in">String</span> &#125;,</span><br><span class="line">  age: &#123; <span class="attr">type</span>: <span class="built_in">Number</span>, <span class="attr">default</span>: <span class="number">0</span> &#125;,</span><br><span class="line">  time: &#123; <span class="attr">type</span>: <span class="built_in">Date</span>, <span class="attr">default</span>: <span class="built_in">Date</span>.now() &#125;,</span><br><span class="line">  email: &#123; <span class="attr">type</span>: <span class="built_in">String</span>, <span class="attr">default</span>: <span class="string">''</span> &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><blockquote><p>Primitive Types: String, Number, Boolean, null, Array, Document, Date</p></blockquote><h1 id="Model"><a href="#Model" class="headerlink" title="Model"></a>Model</h1><p>Instance of Schema, it has ability to operate db</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> db = mongoose.connect(MONGODB.URI)</span><br><span class="line"><span class="keyword">const</span> testModal = db.model(<span class="string">'test1'</span>, TestSchema)</span><br></pre></td></tr></table></figure><ul><li>test1: Name of Collection in the DB</li></ul><h1 id="Entity"><a href="#Entity" class="headerlink" title="Entity"></a>Entity</h1><p>Instance of Model, it has ability to operate db</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> TestEntity = <span class="keyword">new</span> TestModel(&#123;</span><br><span class="line">  name: <span class="string">'Lenka'</span>,</span><br><span class="line">  age: <span class="number">35</span>,</span><br><span class="line">  email: <span class="string">'lenka@gmail.com'</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(TestEntity.name) <span class="comment">// Lenka</span></span><br><span class="line"><span class="built_in">console</span>.log(TestEntity.age) <span class="comment">// 35</span></span><br></pre></td></tr></table></figure><h1 id="Collection"><a href="#Collection" class="headerlink" title="Collection"></a>Collection</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mongoose <span class="keyword">from</span> <span class="string">'mongoose'</span></span><br><span class="line"><span class="keyword">const</span> db = mongoose.connect(MONGODB.URI)</span><br><span class="line"><span class="keyword">const</span> TestSchema = <span class="keyword">new</span> mongoose.Schema(&#123;</span><br><span class="line">  name: &#123; <span class="attr">type</span>: <span class="built_in">String</span> &#125;,</span><br><span class="line">  age: &#123; <span class="attr">type</span>: <span class="built_in">Number</span>, <span class="attr">default</span>: <span class="number">0</span> &#125;,</span><br><span class="line">  email: &#123; <span class="attr">type</span>: <span class="built_in">String</span> &#125;,</span><br><span class="line">  time: &#123; <span class="attr">type</span>: <span class="built_in">Date</span>, <span class="attr">default</span>: <span class="built_in">Date</span>.now() &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> TestModel = db.model(<span class="string">'test1'</span>, TestSchema)</span><br><span class="line"><span class="keyword">const</span> TestEntity = <span class="keyword">new</span> TestModel(&#123;</span><br><span class="line">  name: <span class="string">'hello world'</span>,</span><br><span class="line">  age: <span class="number">12</span>,</span><br><span class="line">  email: <span class="string">'helloworld@gmail.com'</span>,</span><br><span class="line">&#125;)</span><br><span class="line">TestEntity.save(<span class="function">(<span class="params">err, doc</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'error: '</span> + err)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(doc)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="Find"><a href="#Find" class="headerlink" title="Find"></a>Find</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">obj.find(condition, field, callback)</span><br></pre></td></tr></table></figure><p>if <code>fields</code> is omited, or <code>null</code>, the docs will return all attributes</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Model.find(&#123; <span class="string">'age'</span>: <span class="number">25</span> &#125;, (err, docs) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="built_in">console</span>.log(err)</span><br><span class="line">  <span class="built_in">console</span>.log(docs)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">Model.find(&#123;&#125;, &#123; <span class="attr">name</span>: <span class="number">1</span>, <span class="attr">age</span>: <span class="number">1</span>, <span class="attr">_id</span>: <span class="number">0</span> &#125;, (err, docs) =&gt; &#123;</span><br><span class="line">  <span class="comment">// the specific attributes will be returned if corresponding fields are set to positive(here they are name and age), and _id is default to be displayed, if you want to omit it, you should set it to be 0.</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="findOne"><a href="#findOne" class="headerlink" title="findOne"></a>findOne</h1><p>Same as <code>find</code>, except it will return only one matched</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">TestModel.findOne(condition, fields, (err, doc) =&gt; &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="findById"><a href="#findById" class="headerlink" title="findById"></a>findById</h1><p>Same as <code>findOne</code>, but it only find by <code>_id</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">TestModel.findById(<span class="string">'obj._id'</span>, (err, doc) =&gt; &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="Create"><a href="#Create" class="headerlink" title="Create"></a>Create</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Model.create(&#123;&#125;, callback)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Model.create(&#123;</span><br><span class="line">  name: <span class="string">'test'</span>,</span><br><span class="line">  age: <span class="number">12</span>,</span><br><span class="line">&#125;, (err, doc) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="built_in">console</span>.log(err)</span><br><span class="line">  <span class="built_in">console</span>.log(doc)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">TestModel.create([</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">'test1'</span>, <span class="attr">age</span>: <span class="number">20</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">'test2'</span>, <span class="attr">age</span>: <span class="number">20</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">'test3'</span>, <span class="attr">age</span>: <span class="number">20</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">'test4'</span>, <span class="attr">age</span>: <span class="number">20</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">'test5'</span>, <span class="attr">age</span>: <span class="number">20</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">'test6'</span>, <span class="attr">age</span>: <span class="number">20</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">'test7'</span>, <span class="attr">age</span>: <span class="number">20</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">'test8'</span>, <span class="attr">age</span>: <span class="number">20</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">'test9'</span>, <span class="attr">age</span>: <span class="number">20</span> &#125;,</span><br><span class="line">])</span><br></pre></td></tr></table></figure><h1 id="Save"><a href="#Save" class="headerlink" title="Save"></a>Save</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Entity.save(&#123;&#125;, callback)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Entity = <span class="keyword">new</span> Model(&#123;</span><br><span class="line">  name: <span class="string">'entity_save'</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">Entity.save(<span class="function">(<span class="params">err, doc</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="built_in">console</span>.log(err)</span><br><span class="line">  <span class="built_in">console</span>.log(doc)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><blockquote><p>Model.create</p></blockquote><blockquote><p>Entity.save</p></blockquote><h1 id="Update"><a href="#Update" class="headerlink" title="Update"></a>Update</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">obj.update(&#123;&#125;, callback)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> conditions = &#123; <span class="attr">name</span>: <span class="string">'test_upate'</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> update = &#123; <span class="attr">$set</span>: &#123; <span class="attr">age</span>: <span class="number">16</span> &#125; &#125;</span><br><span class="line"></span><br><span class="line">TestModel.update(conditions, update, (err) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="built_in">console</span>.log(err)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'success'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="Remove"><a href="#Remove" class="headerlink" title="Remove"></a>Remove</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">obj.remove(&#123;&#125;, callback)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> conditions = &#123; <span class="attr">name</span>: <span class="string">'tim'</span> &#125;</span><br><span class="line"></span><br><span class="line">TestModel.remove(conditions, (err) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="built_in">console</span>.log(err)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'success'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="Advanced-Search"><a href="#Advanced-Search" class="headerlink" title="Advanced Search"></a>Advanced Search</h1><ul><li><p><code>$lt</code>: less than</p></li><li><p><code>$lte</code>: less than or equal to</p></li><li><p><code>$gt</code>: greater than</p></li><li><p><code>$gte</code>: greater than or equal to</p></li><li><p><code>$ne</code>: not equal to</p></li><li><p><code>$in</code>: belong to</p></li><li><p><code>$or</code>: or</p></li><li><p><code>$exists</code>: exist</p></li><li><p><code>$all</code></p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Model.find(&#123; <span class="string">"age"</span>: &#123; <span class="string">"$gt"</span>: <span class="number">18</span>, <span class="string">"$lt"</span>: <span class="number">50</span> &#125; &#125;, (err, docs) =&gt; &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">Model.find(&#123; <span class="string">"age"</span>: &#123; <span class="string">"$in"</span>: [<span class="number">20</span>, <span class="number">30</span>] &#125; &#125;, (err, docs) =&gt; &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">Model.find(&#123;</span><br><span class="line">  <span class="string">"$or"</span>: [</span><br><span class="line">    &#123; <span class="string">"name"</span>: <span class="string">"yaya"</span> &#125;,</span><br><span class="line">    &#123; <span class="string">"age"</span>: <span class="number">28</span> &#125;,</span><br><span class="line">  ]</span><br><span class="line">&#125;, (err, docs) =&gt; &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">Model.find(&#123;</span><br><span class="line">  name: <span class="string">"$exists"</span></span><br><span class="line">&#125;, (err, docs) =&gt; &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="Limit"><a href="#Limit" class="headerlink" title="Limit"></a>Limit</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">find(condition, &#123; <span class="attr">limit</span>: <span class="number">20</span> &#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, docs</span>) =&gt; </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Model.find(&#123;&#125;, <span class="literal">null</span>, &#123; <span class="attr">limit</span>: <span class="number">20</span> &#125;, (err, docs) =&gt; &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="Skip"><a href="#Skip" class="headerlink" title="Skip"></a>Skip</h1><p>Skim first n docs</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">find(&#123;&#125;, <span class="literal">null</span>, &#123; <span class="attr">skip</span>: <span class="number">4</span> &#125;, (err, docs) =&gt; &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>if total docs less than 4, it will output nothing</p><h1 id="Sort"><a href="#Sort" class="headerlink" title="Sort"></a>Sort</h1><p><code>-1</code>: descending, <code>1</code>: ascending</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Model.find(&#123;&#125;, <span class="literal">null</span>, &#123; <span class="attr">sort</span>: &#123; <span class="attr">age</span>: <span class="number">-1</span> &#125; &#125;, (err, docs) =&gt; &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="ObjectId"><a href="#ObjectId" class="headerlink" title="ObjectId"></a>ObjectId</h1><p>The default id <code>_id</code> could be any types in mongodb, and default to be <code>ObjectId</code></p><p>ObjectId, is a 12-types BSON String.</p><ul><li><p>4 byte: UNIX TimeStamp</p></li><li><p>3 byte: Represents the OS where mongodb running on</p></li><li><p>2 byte: Represents the process where this <code>_id</code> in on</p></li><li><p>3 byte: Rnadom Number</p></li></ul><h1 id="Schema-add-Attribute"><a href="#Schema-add-Attribute" class="headerlink" title="Schema add Attribute"></a>Schema add Attribute</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mongoose <span class="keyword">from</span> <span class="string">'mongoose'</span></span><br><span class="line"><span class="keyword">const</span> TestSchema = <span class="keyword">new</span> mongoose.Schema</span><br><span class="line">TestSchema.add(&#123;</span><br><span class="line">  name: <span class="string">'String'</span>,</span><br><span class="line">  email: <span class="string">'String'</span>,</span><br><span class="line">  age: <span class="string">'Number'</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="Schema-add-instance-method"><a href="#Schema-add-instance-method" class="headerlink" title="Schema add instance method"></a>Schema add instance method</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mongoose <span class="keyword">from</span> <span class="string">'mongoose'</span></span><br><span class="line"><span class="keyword">const</span> TextSchema = <span class="keyword">new</span> mongoose.Schema(&#123;</span><br><span class="line">  name: <span class="string">'String'</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">TestSchema.method(<span class="string">'test'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'hah'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> say = mongoose.model(<span class="string">'say'</span>, TestSchema)</span><br><span class="line"><span class="keyword">var</span> lenka = say()</span><br><span class="line">lenka.say() <span class="comment">// 'hah'</span></span><br></pre></td></tr></table></figure><h1 id="Schema-add-static-method"><a href="#Schema-add-static-method" class="headerlink" title="Schema add static method"></a>Schema add static method</h1><p><code>`</code>javascript import mongoose from âmongooseâ const db = mongoose.connect(MONGODB.URI) const TestSchema = new mongoose.Schema({ name: { type: String }, age: { type: Number }, })</p><p>TestSchema.static(âfindByNameâ, (name, cb) =&gt; { return this.find({name: name}, cb) })</p><p>const TestModel = db.model(âtestâ, TestSchema) TestModel.findByName(âtimâ, (err, docs) =&gt; { // â¦ })</p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>TypeScript With Node</title>
      <link href="/2017/05/30/start-in-typescript/"/>
      <content type="html"><![CDATA[<h1 id="Configuring-TypeScript-Compilation"><a href="#Configuring-TypeScript-Compilation" class="headerlink" title="Configuring TypeScript Compilation"></a>Configuring TypeScript Compilation</h1><p>TypeScript uses the file <code>tsconfig.json</code> to adjust project compile options</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">"compilerOptions": &#123;</span><br><span class="line">  "module": "commonjs",</span><br><span class="line">  "target": "es6",</span><br><span class="line">  "noImplicityAny": true,</span><br><span class="line">  "moduleResolution": "node",</span><br><span class="line">  "sourceMap": true,</span><br><span class="line">  "outDir": "dist",</span><br><span class="line">  "baseUrl": ".",</span><br><span class="line">  "paths": &#123;</span><br><span class="line">    "*": [</span><br><span class="line">      "node_modules/*",</span><br><span class="line">      <span class="string">"src/types/*"</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><table><thead><tr><th><code>compilerOptions</code></th><th>Description</th></tr></thead><tbody><tr><td>âmoduleâ: âcommonjsâ</td><td>The <strong>output</strong> module type (in your <code>.js</code> files). Node uses commonjs</td></tr><tr><td>âtargetâ: âes6â</td><td>The output language level. Node supports ES6</td></tr><tr><td>ânoImplicityAnyâ: true</td><td>Enables a stricter setting which throws errors when something has a default <code>any</code> value</td></tr><tr><td>âmoduleResolutionâ: ânodeâ</td><td>TypeScript attempts to mimic Nodeâs module resolution strategy</td></tr><tr><td>âsourceMapâ: true</td><td></td></tr><tr><td>âourDirâ: âdistâ</td><td>Location to output <code>.js</code> files after compilation</td></tr><tr><td>âbaseUrlâ: â.â</td><td>Part of configuring module resolution</td></tr><tr><td>âpathsâ: {â¦}</td><td>Part of configuring module resolution</td></tr></tbody></table><p>The rest of the file define the TypeScript project context. The project context is basically a set of options that determine which files are compiled when the compiler is invoked with a specific <code>tsconfig.json</code>.</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">"include": [</span><br><span class="line">  <span class="string">"src/**/*"</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><p><code>include</code> takes an array of glob pattern of files to include in the compilation.</p><h1 id="Type-Definition-d-ts-Files"><a href="#Type-Definition-d-ts-Files" class="headerlink" title="Type Definition (.d.ts) Files"></a>Type Definition (<code>.d.ts</code>) Files</h1><p>TypeScript uses <code>.d.ts</code> files to provide types for JavaScript libraries that were not written in TypeScript. This is great because once you have a <code>.d.ts</code> file, TypeScript can type check that library and provide you better help in your editor. The TypeScript community actively shares all the most up-to-date <code>.d.ts</code> files for popular libraries on a Github repository called <strong>DefinitelyTyped</strong>.</p><p>Because the <code>&quot;noImplicityAny&quot;: true</code>, we are required to have a <code>.d.ts</code> file for every library used. You could set <code>noImplicityAny</code> to <code>false</code> to silence errors about missing <code>.d.ts</code> files. Itâs a best practice to have a <code>.d.ts</code> file for every library(Even the <code>.d.ts</code> file is basically empty)</p><h1 id="Installing-d-ts-files-from-DefinitelyTyped"><a href="#Installing-d-ts-files-from-DefinitelyTyped" class="headerlink" title="Installing .d.ts files from DefinitelyTyped"></a>Installing <code>.d.ts</code> files from DefinitelyTyped</h1><p>For the most part, youâll find <code>d.ts</code> files for the libraries you are using on DefinitelyTyped. These <code>.d.ts</code> files can be easily installed into your project by using npm scope <code>@types</code>. For example, if we want the <code>.d.ts</code> file for jQuery, we can do so with <code>npm install --save-dev @types/jquery</code>.</p><p>Once <code>.d.ts</code> files have been installed using npm, you should see them in your <code>node_modules/@types</code> folder. The compiler will always look in this folder for <code>.d.ts</code> files when resolving JavaScript libraries.</p><h1 id="What-if-a-library-isnât-on-DefinitelyTyped"><a href="#What-if-a-library-isnât-on-DefinitelyTyped" class="headerlink" title="What if a library isnât on DefinitelyTyped?"></a>What if a library isnât on DefinitelyTyped?</h1><p>Setting up TypeScript to look for <code>.d.ts</code> files in another folder</p><p>The Compiler knows to look in <code>node_modules/@types</code> by default, but to help the compiler find our own <code>.d.ts</code> files we have to configure path mapping in our <code>tsconfig.json</code>. Path mapping can get pretty confusing, but the basic idea is that the TypeScript compiler will look in specific places, in a specific order when resolving modules, and we have the ability to tell the compiler exactly how to do it. In the <code>tsconfig.json</code> for this project youâll see the following:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">"baseUrl": ".",</span><br><span class="line">"paths": &#123;</span><br><span class="line">  "*": [</span><br><span class="line">    <span class="string">"src/types/*"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This tells the TypeScript compiler that in addition to looking in <code>node_module/@types</code> for every import (<code>*</code>) also look in our own <code>.d.ts</code> file location <code>&lt;baseUrl&gt; + src/types/*</code></p><p>First the compiler will look for a <code>.d.ts</code> file in <code>node_modules/@types</code> and then <code>src/types</code></p><h1 id="Summary-of-d-ts-management"><a href="#Summary-of-d-ts-management" class="headerlink" title="Summary of .d.ts management"></a>Summary of <code>.d.ts</code> management</h1><p>In general if you stick to the following steps you should have minimal <code>.d.ts</code> issues:</p><ul><li><p>After installing any npm package as a dependency or dev dependency, immediately try to install the <code>.d.ts</code> file via <code>@types</code></p></li><li><p>If the library has a <code>.d.ts</code> file on DefinitelyTyped, the install wil succeed and you are done, if the install fails because the package doesnât exist, generate <code>.d.ts</code> by yourself</p></li></ul><h1 id="Source-Map"><a href="#Source-Map" class="headerlink" title="Source Map"></a>Source Map</h1><p>In the <code>tsconfig.json</code></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">"compilerOptiosn": &#123;</span><br><span class="line">  "sourceMaps": true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>With this option enabled, next to every <code>.js</code> file that the TypeScript compiler outputs there will be a <code>.map.js</code> file as well. This <code>.map.js</code> file provides the information necessary to map back to the source <code>.ts</code> file while debugging.</p><h1 id="Using-Debugger-in-VS-Code"><a href="#Using-Debugger-in-VS-Code" class="headerlink" title="Using Debugger in VS Code"></a>Using Debugger in VS Code</h1><p>When debugging in VS Code, it looks for a top level <code>.vscode</code> folder with a <code>launch.json</code> file. In this file, you can tell VS Code exactly what you want to do:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"type"</span>: <span class="string">"node"</span>,</span><br><span class="line">  <span class="attr">"request"</span>: <span class="string">"launch"</span>,</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"Debug"</span>,</span><br><span class="line">  <span class="attr">"program"</span>: <span class="string">"$&#123;workspaceRoot&#125;/dist/server.js"</span>,</span><br><span class="line">  <span class="attr">"smartStep"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"outFiles"</span>: [</span><br><span class="line">    <span class="string">"../dist/**/*.js"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"protocal"</span>: <span class="string">"inspector"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This is mostly identical to the âNode.js: Launch Programâ template with a couple minor changes:</p><table><thead><tr><th><code>launch.json</code> Options</th><th>Description</th></tr></thead><tbody><tr><td>âprogramâ: â${workspaceRoot}/dist/server.jsâ</td><td>Modified to point to our entry point in <code>dist</code></td></tr><tr><td>âsmartStepâ: true</td><td>Wonât step into code that doesnât have a source map</td></tr><tr><td>âoutFilesâ: [â¦]</td><td>Specify where output files a dropped. Use with source map</td></tr><tr><td>âprotocalâ: âinspectorâ</td><td>Use the new Node Debug Protocal because weâre on the latest node</td></tr></tbody></table>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Drag, Upload and Progress</title>
      <link href="/2017/05/29/drag-upload-and-progress/"/>
      <content type="html"><![CDATA[<p>Dragging and dropping files from your desktop to a browser is one of the ultimate goals for web application integration, which consists of:</p><ul><li><p>enable file dragging and dropping onto a web page element</p></li><li><p>analyze dropped files in JavaScript</p></li><li><p>load and parse files on the client</p></li><li><p>asynchronously upload files to the server using XMLHttpRequest2</p></li><li><p>show a graphical progress bar while the upload occurs</p></li><li><p>use progressive enhancement to ensure your file upload from works in any browser</p></li></ul><h1 id="The-File-API"><a href="#The-File-API" class="headerlink" title="The File API"></a>The File API</h1><ul><li><p>FileList: represents an array of selected files</p></li><li><p>File: represents an individual file</p></li><li><p>FileReader: an interface which allows us to read file data on the client and use it within JavaScript</p></li></ul><h1 id="JavaScript-Events"><a href="#JavaScript-Events" class="headerlink" title="JavaScript Events"></a>JavaScript Events</h1><h2 id="Dragged-Object"><a href="#Dragged-Object" class="headerlink" title="Dragged Object"></a>Dragged Object</h2><ul><li><p>dragstart</p></li><li><p>drag</p></li><li><p>dragend</p></li></ul><h2 id="Target-Object"><a href="#Target-Object" class="headerlink" title="Target Object"></a>Target Object</h2><ul><li><p>dragenter</p></li><li><p>dragover</p></li><li><p>dragleave</p></li><li><p>drop</p></li></ul><h2 id="dataTransfer"><a href="#dataTransfer" class="headerlink" title="dataTransfer"></a>dataTransfer</h2><ul><li><p>dropEffect: copy | move | link | none</p></li><li><p>effectAllowed: copy | move | link | copyLink | copyMove | linkMove | none | all (default)</p></li><li><p>files</p></li><li><p>types</p></li><li><p>setDragImage(imgElement, x, y): set custom icon along dragging</p></li><li><p>setData(format, data)</p></li><li><p>getData(format)</p></li><li><p>clearData()</p></li></ul><h1 id="Notice"><a href="#Notice" class="headerlink" title="Notice"></a>Notice</h1><p>By default, brower will refuse all drag actions(and file will be opened in browser if files from desktop dragged into the browser), so <code>e.preventDefault()</code> should be added in <code>dropover</code> and <code>drop</code> event</p><p>Dragging Text will automatically set <code>e.dataTransfer.setData(&#39;text/plain&#39;, node.innerText)</code></p><p>Dragging File will add files to <code>e.dataTransfer.files</code></p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Simple Usage of flatMap</title>
      <link href="/2017/05/26/simple-usage-of-flatMap/"/>
      <content type="html"><![CDATA[<p><a href="http://2ality.com/2017/04/flatmap.html" target="_blank" rel="noopener">origin</a></p><p>Both <code>map()</code> and <code>flatMap()</code> take a function <code>f</code> as a parameter that controls how an input Array is translated to an output Array:</p><ul><li><p>With <code>map()</code>, each input Array element is translated to exactly one output element, aka, <code>f</code> returns a single value</p></li><li><p>With <code>flatMap()</code>, each input Array element is translated to zero or more output elements, aka, <code>f</code> returns an Array of values.</p></li></ul><p>An smiple implementation of <code>flatMap</code>:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">flatMap</span> (<span class="params">arr, mapFunc</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> result = []</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> [index, value] <span class="keyword">of</span> arr.entries()) &#123;</span><br><span class="line">    <span class="keyword">const</span> x = mapFunc(value, index, arr)</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(x)) &#123;</span><br><span class="line">      result.push(...x)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      result.push(x)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>flatMap</code> is simpler if <code>mapFunc</code> is only allowed to return Arrays, but we donât impose this restriction here, because non-Array values are occasionally useful.</p><h1 id="Filtering-and-mapping-at-the-same-time"><a href="#Filtering-and-mapping-at-the-same-time" class="headerlink" title="Filtering and mapping at the same time"></a>Filtering and mapping at the same time</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">processArray</span> (<span class="params">arr, processFunc</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> arr.map(<span class="function"><span class="params">x</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">value</span>: processFunc(x) &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">error</span>: e &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> results = processArray(myArray, myFunc)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> values = flatMap(results, result =&gt; result.value ? [result.value] : []) <span class="comment">// here we use [result.value] to avoid destructing value if it is an array.</span></span><br><span class="line"><span class="keyword">const</span> errors = flapMap(results, result =&gt; result.error ? result.error : [])</span><br></pre></td></tr></table></figure><h1 id="Mapping-to-multiple-values"><a href="#Mapping-to-multiple-values" class="headerlink" title="Mapping to multiple values"></a>Mapping to multiple values</h1><p>The Array method <code>map()</code> maps each input Array element to one output. But if we want to map it to multiple output elements?</p><p>That becomes necessary in the following example: The React component <code>TagList</code> is invoked with two attributes</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;TagList tags=&#123;[<span class="string">'foo'</span>, <span class="string">'bar'</span>, <span class="string">'baz'</span>]&#125; handleClick=&#123;x =&gt; <span class="built_in">console</span>.log(x)&#125; /&gt;</span><br></pre></td></tr></table></figure><p>The attributes are:</p><ul><li><p>An Array of tags, each tag being a string</p></li><li><p>A callback for handling clicks on tags</p></li></ul><p><code>TagList</code> is rendered as a series of links seperated by commas:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TagList</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; tags, handleClick &#125; = <span class="keyword">this</span>.props</span><br><span class="line">    <span class="keyword">return</span> flatMap(tags, (tag, index) =&gt; [</span><br><span class="line">      ...(index &gt; <span class="number">0</span> ? [<span class="string">', '</span>] : []),</span><br><span class="line">      &lt;a key=&#123;index&#125; href=<span class="string">""</span> onClick=&#123;e =&gt; handleClick(tag, e)&#125;&gt;</span><br><span class="line">        &#123;tag&#125;</span><br><span class="line">      &lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp">    ])</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>Here each tag (except the first) provide two elements in the rendered Array</p><h1 id="Arbitrary-Iterables"><a href="#Arbitrary-Iterables" class="headerlink" title="Arbitrary Iterables"></a>Arbitrary Iterables</h1><p><code>flatMap</code> can be generalized to work with arbitrary iterables</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">flatMapIter</span>(<span class="params">iterable, mapFunc</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> index = <span class="number">0</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> x <span class="keyword">of</span> iterable) &#123;</span><br><span class="line">    <span class="keyword">yield</span>* mapFunc(x, index)</span><br><span class="line">    index++</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>flatMapIter</code> function works with Arrays:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fillArray</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Array</span>(x).fill(x)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log([...flatMapIter([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>], fillArray)])</span><br></pre></td></tr></table></figure><h1 id="Implementing-flatMap-via-reduce"><a href="#Implementing-flatMap-via-reduce" class="headerlink" title="Implementing flatMap via reduce"></a>Implementing <code>flatMap</code> via <code>reduce</code></h1><p>You can use the Array method <code>reduce</code> to implement a simple version of <code>flatMap</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">flatMap</span> (<span class="params">arr, mapFunc</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> arr.reduce(</span><br><span class="line">    (prev, x) =&gt; prev.concat(mapFunc(x)),</span><br><span class="line">    [],</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Related-to-flatMap-flatten"><a href="#Related-to-flatMap-flatten" class="headerlink" title="Related to flatMap: flatten"></a>Related to <code>flatMap</code>: <code>flatten</code></h1><p><code>flatten</code> is an operation that concatenates all the elements of an Array</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; flatten([<span class="string">'a'</span>, [<span class="string">'b'</span>, <span class="string">'c'</span>], [<span class="string">'d'</span>]])</span><br><span class="line">[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>]</span><br></pre></td></tr></table></figure><p>It can be implemented as follows:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> flatten = <span class="function">(<span class="params">arr</span>) =&gt;</span> [].concat(...arr)</span><br></pre></td></tr></table></figure><p>So the following expressions are equivalent</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flatten(arr.map(func))</span><br><span class="line">flatMap(arr, x =&gt; x)</span><br></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>New Babel Preset - Env</title>
      <link href="/2017/05/21/new-babel-preset-env/"/>
      <content type="html"><![CDATA[<p><code>babel-preset-env</code> is a new preset which let you specify an environment and automatically enables the necessary plugins.</p><p>At the moment, several presets let you determine what features Babel should support:</p><ul><li><p><code>babel-preset-es2015</code>, <code>babel-preset-es2016</code>, etc: incrementally support various versions of ECMAScript. <code>babel-preset-es2015</code> transpiles whatâs new in ES6 to ES5, <code>babel-preset-es2016</code> transpiles whatâs new in ES7 to ES6.</p></li><li><p><code>babel-preset-latest</code>: supports all features that are either part of an ECMAScript version or at stage 4.</p></li></ul><p>The problem with these presets is that they often do too much. For example, most modern browsers support ES6 generator. Yet if you use <code>babel-preset-es2015</code>, generator functions will always be transpiled to complex ES5 code.</p><p><code>babel-preset-env</code> works like <code>babel-preset-latest</code>, but it lets you specify an environment and only transpiles features that are missing in that environment.</p><p>Note that you need to install and enable plugins and/or presets for experimental features(that are not part of <code>babel-preset-latest</code>)</p><p>On the plus side, you donât need <code>es2015</code> presets anymore.</p><h1 id="Browsers"><a href="#Browsers" class="headerlink" title="Browsers"></a>Browsers</h1><p>For browsers you have the option to specify either:</p><ul><li><p>Browsers via <code>browserslist</code> query syntax</p><ul><li><p>Support the last two versions of browsers and IE 7+</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"babel"</span>: &#123;</span><br><span class="line">  <span class="string">"presets"</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">"env"</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"targets"</span>: &#123;</span><br><span class="line">          <span class="string">"browsers"</span>: [<span class="string">"last 2 versions"</span>, <span class="string">"ie &gt;= 7"</span>]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Support browsers that have more than 5% market share</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"targets"</span>: &#123;</span><br><span class="line">  <span class="string">"browsers"</span>: <span class="string">"&gt; 5%"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Fixed versions of browsers:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"targets"</span>: &#123;</span><br><span class="line">  <span class="string">"chrome"</span>: <span class="number">56</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h1 id="Node-js"><a href="#Node-js" class="headerlink" title="Node.js"></a>Node.js</h1><p>If you compile your code for Node.js on the fly via Babel, <code>babel-preset-env</code> is especially useful, because it react to the currently running version of Node.js if you set the target <code>node</code> to <code>current</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"babel"</span>: &#123;</span><br><span class="line">  <span class="string">"presets"</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">"env"</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"target"</span>: &#123;</span><br><span class="line">          <span class="string">"targets"</span>: &#123;</span><br><span class="line">            <span class="string">"node"</span>: <span class="string">"current"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Additional-Options-for-babel-preset-env"><a href="#Additional-Options-for-babel-preset-env" class="headerlink" title="Additional Options for babel-preset-env"></a>Additional Options for <code>babel-preset-env</code></h1><h2 id="modules-string-default-âcommonjsâ"><a href="#modules-string-default-âcommonjsâ" class="headerlink" title="modules(string, default: âcommonjsâ)"></a>modules(string, default: âcommonjsâ)</h2><p>This options lets you configure to which module format ES6 modules are transpiled:</p><ul><li><p>Transpile to popular module formats: âamdâ, âcommonjsâ, âsystemjsâ, âumdâ</p></li><li><p>Donât transpile: false</p></li></ul><h2 id="include-exclude-Array-of-strings-default"><a href="#include-exclude-Array-of-strings-default" class="headerlink" title="include, exclude (Array of strings, default [])"></a>include, exclude (Array of strings, default [])</h2><ul><li><p>include: always enables certain plugins</p></li><li><p>exclude: prevents certain plugins from being enabled</p></li></ul><h2 id="useBuiltIns-boolean-default-false"><a href="#useBuiltIns-boolean-default-false" class="headerlink" title="useBuiltIns (boolean, default: false)"></a>useBuiltIns (boolean, default: false)</h2><p>Babel comes with a polyfill for new functionality in standard library. <code>babel-preset-env</code> can optionally import only those parts of the polyfill that are needed on the specified platforms:</p><p>There are two ways of using the polyfill:</p><ul><li><p><code>core-js</code> polyfills ES5, ES6+ as needed</p><ul><li><p>install polyfill: <code>yarn add core-js</code></p></li><li><p>activate polyfill: <code>import &#39;core-js&#39;</code></p></li></ul></li><li><p><code>babel-polyfill</code>: polyfills <code>core-js</code> and regenerator runtime(to emulate generators on ES5)</p><ul><li><p>install polyfill: <code>yarn add babel-polyfill</code></p></li><li><p>activate polyfill: <code>import &#39;babel-polyfill&#39;</code></p></li></ul></li></ul><p>Either of the two import statements is transpiled to an environment-specific sequence of more fine-grained imports:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"core-js/modules/es7.string.pad-start"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"core-js/modules/es7.string.pad-end"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"core-js/modules/web.timers"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"core-js/modules/web.immediate"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"core-js/modules/web.dom.iterable"</span>;</span><br></pre></td></tr></table></figure><h2 id="debug-boolean-default-false"><a href="#debug-boolean-default-false" class="headerlink" title="debug (boolean, default: false)"></a>debug (boolean, default: false)</h2><p>Logs the following information via <code>console.log()</code></p><ul><li><p>Targeted environments</p></li><li><p>Enabled transformers</p></li><li><p>Enabled plugins</p></li><li><p>Enabled polyfills</p></li></ul><h1 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h1><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"presets"</span>: [</span><br><span class="line">    [<span class="string">"env"</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"targets"</span>: &#123;</span><br><span class="line">          <span class="attr">"safari"</span>: <span class="number">10</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"modules"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"useBuiltIns"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"debug"</span>: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Babel-Polyfill or Babel-Runtime</title>
      <link href="/2017/05/21/babel-polyfill-or-babel-runtime/"/>
      <content type="html"><![CDATA[<p>The <code>babel-polyfill</code> and <code>babel-runtime</code> modules are sued to serve the same function in two different ways. Both modules ultimately serve to emulate an ES6 environment.</p><p>Both <code>babel-polyfill</code> and <code>babel-runtime</code> emulate an ES6 environment with two things:</p><ul><li><p>a slew of polyfills as provided by <code>core-js</code></p></li><li><p>complete generator runtime</p></li></ul><p><code>babel-polyfill</code> accomplishes this task by assigning methods on the global or on native type prototypes which means that once required, as far as the javascript runtime youâre using is concerned, ES6 methods and object simply exist. If you were to require <code>babel-polyfill</code> in a script run under <strong>node v0.1.0</strong> â a runtime which does not natively support the <code>Promise</code> API â your script would then have access to the <code>Promise</code> object. As far as you are concerned, youâre suddenly using an environment that support the <code>Promise</code> object.</p><p><code>babel-runtime</code> does something very similar, but in a way that does not pollute native object prototypes or the global namespace. Instead, <code>babel-runtime</code> is a module that you can list as a dependency of your application like any other module, which polyfills ES6 methods. In other words and continuing the example from above, while you may not have the <code>Promise</code> object available to you, you now have the same functionality available to you from <code>require(&#39;babel-runtime/core-js/promise&#39;)</code>. By itself, this is useful but inconvenient. Fortunately, <code>babel-runtime</code> is not intended to be used by itself. Rather, <code>babel-runtime</code> is intended to be paired with the transform â <code>babel-plugin-transform-runtime</code> â which will automatically rewrite your code such that you can write your code using the <code>Promise</code> API and it will be transformed to use the Promise-like object exported by <code>babel-runtime</code></p><p><code>babel-polyfill</code> offers you the conveniences of gloablly defined objects without having to transform your code further. However, as with anything that mutates a global, this can introduce collision between versions, etc.</p><p><code>babel-runtime</code>, on the other hand, will not suffer from collision as everything is name-spcaed. Since the module will be defined in your package.json, it can be versioned like everything else. The tradeoff, however, is that a transform can only do so much. The runtime remaps methods according to a definitions map. Anecdotally, this has covered each of my use-cases but there may be an obscure method or two which is not remapped. There are also certain cases where your intent is ambiguous. In such cases, the transform wonât know exactly what to do.</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>To summarize, with the general case for Babel 6, there are two main steps youâll need to perform:</p><ul><li>Provide your code with an emulated ES6 environment by either requiring <code>babel-polyfill</code> or requiring the <code>babel-runtime</code> module plus the <code>babel-plugin-transform-runtime</code> transform:</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// for babel-polyfill, either add:</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">'babel-polyfill'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// for babel-runtime, install the module, then use the babel-plugin-transform-runtime transform by including it in your .babelrc file.</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Deep in Runtime-Transform</title>
      <link href="/2017/05/21/Deep-in-Runtime-Transform/"/>
      <content type="html"><![CDATA[<p>This plugin is recommended in a <strong>library/tool</strong></p><blockquote><p>Note: Instance methods such as <code>&#39;foobar&#39;.includes(&#39;foo&#39;)</code> will not work since that would require modification of existing built-ins(Use <code>babel-polyfill</code> for that)</p></blockquote><p>Babel uses very small helpers for common functions such as <code>_extend</code>. By default this will be added to every file that requires it. This duplication is sometimes unnecessary, especially when your application is spread out over multiple files.</p><p>This is where the <code>transform-runtime</code> plugin comes in: all of the helpers will reference the module <code>babel-runtime</code> to avoid duplication across your compiled output. The runtime will be compiled into your build.</p><p>Another purpose of this transformer is to create a sandboxed environment for your code. If you use <code>babel-polyfill</code> and the built-ins it provides such as <code>Promise</code>, <code>Set</code> and <code>Map</code>, those will pollute the global scope. While this might be ok for an app or a command line tool, it becomes a problem if your code is a library which you intend to publish for other to use or if you canât exactly control the environment in which your code will run.</p><p>The transformer will alias these built-ins to <code>core-js</code> so you can use them seamlessly without having to require the polyfill.</p><h1 id="Prod-and-Dev"><a href="#Prod-and-Dev" class="headerlink" title="Prod and Dev"></a>Prod and Dev</h1><p>In most cases, you should install <code>babel-plugin-transform-runtime</code> as a development dependency, and <code>babel-runtime</code> as a production dependency.</p><h1 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h1><p>I prefer to use <code>.babelrc</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;plugins&quot;: [</span><br><span class="line">    [&quot;transform-runtime&quot;, &#123;</span><br><span class="line">      &quot;helpers&quot;: false,</span><br><span class="line">      &quot;polyfill&quot;: false,</span><br><span class="line">      &quot;regenerator&quot;: true,</span><br><span class="line">      &quot;moduleName&quot;: &quot;babel-runtime&quot;</span><br><span class="line">    &#125;]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>There the options are referred.</p><ul><li>helpers: boolean, default to <code>true</code></li></ul><p>Toggles whether or not inlined babel helpers (<code>classCallCheck</code>, <code>extends</code>, etc) are replaced with calls to <code>moduleName</code>.</p><ul><li>polyfill: boolean, default to be <code>true</code></li></ul><p>Toggles whether or not new built-ins(<code>Promise</code>, <code>Set</code>, <code>Map</code>, etc) are transformed to use a non-global polluting polyfill.</p><ul><li>renegerator: boolean, default to <code>true</code></li></ul><p>Toggles whether or not generator functions are transforms to use a regenerator runtime that does not pollute the global scope.</p><ul><li>moduleName: string, default to <code>babel-runtime</code></li></ul><p>Set the name/path of the module used when importing helpers.</p><p>Example:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"moduleName"</span>: <span class="string">"flavortown/runtime"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> extends <span class="keyword">from</span> <span class="string">'flavortown/runtime/helpers/extend'</span></span><br></pre></td></tr></table></figure><h1 id="Technical-Details"><a href="#Technical-Details" class="headerlink" title="Technical Details"></a>Technical Details</h1><p>The <code>runtime</code> transformer plugin does three things:</p><ul><li><p>Automatically requires <code>babel-runtime/renegerator</code> when you use generator/async functions;</p></li><li><p>Automatically requires <code>babel-runtime/core-js</code> and maps ES6 static methods and built-ins;</p></li><li><p>Removes the inline Babel helpers and uses the module <code>babel-runtime/helpers</code> instead.</p></li></ul><p>You can use built-ins such as <code>Promise</code>, <code>Set</code>, <code>Symbol</code>, etc., as well as use all the Babel features taht require a polyfill seamlessly, without global pollution, making it extremely suitable for libraries.</p><h2 id="Regenerator-aliasing"><a href="#Regenerator-aliasing" class="headerlink" title="Regenerator aliasing"></a>Regenerator aliasing</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> * <span class="title">foo</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>the following is generated</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> _marked = [foo].map(regeneratorRuntime.mark)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> regeneratorRuntime.wrap(<span class="function"><span class="keyword">function</span> <span class="title">foo$</span>(<span class="params">_context</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) <span class="keyword">switch</span> (_context_prev = _context.next) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'end'</span>:</span><br><span class="line">        <span class="keyword">return</span> _context.stop()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, _marked[<span class="number">0</span>], <span class="keyword">this</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This isnât ideal as then you have to include the regenerator runtime which pollutes the global scope.</p><p>Instead what the <code>runtime</code> transformer does it compile that to:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> _regenerator = <span class="built_in">require</span>(<span class="string">'babel-runtime/regenerator'</span>)</span><br><span class="line"><span class="keyword">var</span> _regenerator2 = _interopRequireDefault(_regenerator)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_interopRequireDefault</span> (<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> obj &amp;&amp; obj.__esModule ? obj : &#123; <span class="attr">default</span>: obj &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> _marked = [foo].map(_regenerator2.default.mark)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> regeneratorRuntime.wrap(<span class="function"><span class="keyword">function</span> <span class="title">foo$</span>(<span class="params">_context</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) <span class="keyword">switch</span> (_context_prev = _context.next) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'0'</span>:</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'end'</span>:</span><br><span class="line">        <span class="keyword">return</span> _context.stop()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, _marked[<span class="number">0</span>], <span class="keyword">this</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This means that you can use the regenerator runtime without polluting your current environment.</p><p>The same actions with Core-js Aliasing and Helper Aliasing.</p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>More Faster React Functional Component</title>
      <link href="/2017/05/21/More-Faster-React-Functional-Component/"/>
      <content type="html"><![CDATA[<p><a href="https://medium.com/missive-app/45-faster-react-functional-components-now-3509a668e69f" target="_blank" rel="noopener">origin</a></p><p>An basic <code>Avatar</code> Component:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Avatar</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;this.props.url&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">  &#125;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br></pre></td></tr></table></figure><p>And its functional component style is:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Avatar = <span class="function">(<span class="params">&#123; url &#125;</span>) =&gt;</span> &lt;img src=&#123;url&#125; /&gt;</span><br></pre></td></tr></table></figure><p>As you can see, itâs just a simple js function returning an element.</p><p>React still does a lot of stuff on functional components that, by nature, will never be used.</p><p>But we can skip React internals for these functional component.</p><p>They are just plain JavaScritp functions, which means we can call it in the render function.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &#123;Avatar(&#123; <span class="attr">url</span>: avatarUrl &#125;)&#125;</span><br><span class="line">    &lt;div&gt;&#123;commentBody&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;,</span><br><span class="line">  mountNode,</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>As we know, the traditional usage:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Avatar url=&#123;avatarUrl&#125; /&gt;</span><br></pre></td></tr></table></figure><p>will be compiled into</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">React.createElement(Avatar, &#123; <span class="attr">url</span>: avatarUrl &#125;)</span><br></pre></td></tr></table></figure><p>It will cost a lifecycle of a React Component.</p><p>But with direct calling of plain JavaScritp Function, all these consumption can be eliminated.</p><p>By the way, <code>transform-react-inline-elements</code> does the same as a bebel transform, so thereâs no need to change the source code.</p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Css Shorthand Collection</title>
      <link href="/2017/05/19/css-shorthand-collection/"/>
      <content type="html"><![CDATA[<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>:</span><br><span class="line">    <span class="built_in">url</span>(...) <span class="comment">/* image */</span></span><br><span class="line">    top center / <span class="number">200px</span> <span class="number">200px</span> <span class="comment">/* position / size */</span></span><br><span class="line">    no-repeat <span class="comment">/* repeat */</span></span><br><span class="line">    fixed <span class="comment">/* attachment */</span></span><br><span class="line">    padding-box <span class="comment">/* origin */</span></span><br><span class="line">    content-box <span class="comment">/* clip */</span></span><br><span class="line">    red; <span class="comment">/* color */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Usage of Grid in Css</title>
      <link href="/2017/05/18/usage-of-grid-in-css/"/>
      <content type="html"><![CDATA[<p><a href="https://css-tricks.com/snippets/css/complete-guide-grid/" target="_blank" rel="noopener">origin</a></p><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>CSS Grid Layout (aka âGridâ), is a two-dimensional grid-based layout system that aims to do nothing less than completely change the way we design grid-based user interfaces.</p><h1 id="Terminology"><a href="#Terminology" class="headerlink" title="Terminology"></a>Terminology</h1><h2 id="Grid-Container"><a href="#Grid-Container" class="headerlink" title="Grid Container"></a>Grid Container</h2><p>The element on which <code>display: grid</code> is applied. Itâs the direct parent of all the grid items. In this example <code>container</code> is the grid container.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item item-1"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item item-2"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item item-3"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Grid-Item"><a href="#Grid-Item" class="headerlink" title="Grid Item"></a>Grid Item</h2><p>The children (e.g. <strong>direct</strong> descendants) of the grid container. Here the <code>item</code> elements are grid items, but <code>sub-item</code> isnât.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"sub-item"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Grid-Line"><a href="#Grid-Line" class="headerlink" title="Grid Line"></a>Grid Line</h2><p>The dividing lines that make up the structure of the grid. They can be either vertical(<code>column grid line</code>) or horizontal(<code>row grid line</code>) and reside on either side of a row or column. Here the yellow line is an example of a column grid line.</p><p><img src="https://cdn.css-tricks.com/wp-content/uploads/2016/03/grid-line.png" alt=""></p><h2 id="Grid-Track"><a href="#Grid-Track" class="headerlink" title="Grid Track"></a>Grid Track</h2><p>The space between two adjacent grid lines. You can think of them like the columns or rows of the grid. Hereâs the grid track between second and third row grid lines.</p><p><img src="https://cdn.css-tricks.com/wp-content/uploads/2016/03/grid-track.png" alt=""></p><h2 id="Grid-Cell"><a href="#Grid-Cell" class="headerlink" title="Grid Cell"></a>Grid Cell</h2><p>The space between two adjacent row and two adjacent column lines. Itâs a single âunitâ of the grid. Hereâs the grid cell between row grid lines 1 and line2, and column grid lines 2 and 3.</p><h2 id="Grid-Area"><a href="#Grid-Area" class="headerlink" title="Grid Area"></a>Grid Area</h2><p>The total space surrounded by four grid lines. A grid area may be comprised of any number of grid cells. Hereâs the grid area between row and grid lines 1 and 3, and column grid lines 1 and 3.</p><p><img src="https://cdn.css-tricks.com/wp-content/uploads/2016/03/grid-area.png" alt=""></p><h1 id="Properties"><a href="#Properties" class="headerlink" title="Properties"></a>Properties</h1><h2 id="Container"><a href="#Container" class="headerlink" title="Container"></a>Container</h2><ul><li><p>display</p><ul><li><p>grid: generates a <strong>block-level</strong> grid</p></li><li><p>inline-grid: generates an inline level grid</p></li><li><p>subgrid: if your grid container is itself a grid item(i.e. nested grids), you can use this property to indicate that you want the sizes of its rows/columns to be taken from its parent rather than specifying its own.</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line"> <span class="attribute">display</span>: grid | inline-grid | subgrid;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><code>column</code>, <code>float</code>, <code>clear</code> and <code>vertical-align</code> have no effect on a grid container</p></blockquote></li></ul></li><li><p>grid-template-rows &amp; grid-template-columns</p><ul><li><p><track-size>: can be a length, a percentage, or a function of the free space in the grid(using the <code>fr</code> unit)</track-size></p></li><li><p><line-name>: an arbitrary name of your choosing</line-name></p></li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="attribute">grid-template-columns</span>: &lt;track-size&gt; | [&lt;line-name&gt;] &lt;track-size&gt;;</span><br><span class="line">  <span class="attribute">grid-template-rows</span>: &lt;track-size&gt; | &lt;line-name&gt; &lt;track-size&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>A line can have more than one name, seperated by spcae.</p></blockquote><p>You can use <code>repeat()</code> notation to streamline things:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="attribute">grid-template-columns</span>: <span class="built_in">repeat</span>(3, 20px [col-start]) <span class="number">5%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The <code>fr</code> unit allows you to set the size of a track as a fraction of the free space of the grid container.</p><p>The free space is calculated <strong>after</strong> any non-flexible items.</p></li><li><p>grid-template-areas:</p><ul><li><p><grid-area-name>: the name of a grid area specified with <code>grid-area</code></grid-area-name></p></li><li><p><code>.</code>: a period signifies an empty grid cell.</p></li><li><p>none: no grid areas are defined.</p></li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="attribute">grid-template-areas</span>: &lt;grid-area-name&gt; | . | none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.item-a</span> &#123;</span><br><span class="line">  <span class="attribute">grid-area</span>: header;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.item-b</span> &#123;</span><br><span class="line">  <span class="attribute">grid-area</span>: main;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.item-c</span> &#123;</span><br><span class="line">  <span class="attribute">grid-area</span>: sidebar;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.item-d</span> &#123;</span><br><span class="line">  <span class="attribute">grid-area</span>: footer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="attribute">grid-template-columns</span>: <span class="built_in">repeat</span>(4, 50px);</span><br><span class="line">  <span class="attribute">grid-template-rows</span>: auto;</span><br><span class="line">  <span class="attribute">grid-template-areas</span>:</span><br><span class="line">    <span class="string">'header header header header'</span></span><br><span class="line">    <span class="string">'main main . sidebar'</span></span><br><span class="line">    <span class="string">'footer footer footer footer'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.css-tricks.com/wp-content/uploads/2016/03/grid-template-areas.png" alt=""></p></li><li><p>grid-template: a shorthand for setting <code>grid-template-rows</code>, <code>grid-template-columns</code> and <code>grid-template-areas</code> in a single decalration.</p><ul><li><p>none: sets all three properties to their initial values</p></li><li><p>subgrid: sets <code>grid-template-rows</code>, <code>grid-template-columns</code> to <code>subgrid</code>, and <code>grid-template-areas</code> to its initial value.</p></li><li><p><grid-template-rows>/<grid-template-columns>: sets <code>grid-template-rows</code> and <code>grid-template-columns</code> to the specified values, respectively, and sets <code>grid-template-areas</code> to <code>none</code></grid-template-columns></grid-template-rows></p></li></ul></li><li><p>grid-column-gap &amp; grid-column-gap: Specifies the size of the grid lines. You can think of it like setting the width of the gutters between the columns/rows.</p><ul><li><line-size>: a length value</line-size></li></ul></li><li><p>grid-gap: a shorthand for <code>grid-row-gap</code> and <code>grid-column-gap</code></p></li><li><p>justify-items: Aligns the content inside a grid item along with the <em>row</em> axis</p><ul><li><p>start: aligns the content to the left end of the grid area</p></li><li><p>end: aligns the content to the right end of the grid area</p></li><li><p>center: aligns the content in the center of the grid area</p></li><li><p>stretch: fills the whole width of the grid area(this is the default)</p></li></ul><blockquote><p>This behavior can also be set on individual grid items via the <code>justify-self</code> property</p></blockquote></li><li><p>align-items: aligns the content inside a grid item along the <em>column</em> axis. This value applies to all grid items inside the container.</p><ul><li><p>start: aligns the content to the top of the grid area</p></li><li><p>end: aligns the content to the bottom of the grid area</p></li><li><p>center: aligns the content in the center of the grid area</p></li><li><p>stretch: fills the whole height of the grid area(this is the default)</p></li></ul><blockquote><p>This behavior can also be set on individual grid items via the <code>align-self</code> properties.</p></blockquote></li><li><p>justify-content: Sometimes the total size of your grid might be less than the size of its grid container. This could happen if all of your grid items are sized with non-flexible units like <code>px</code>. In this case you can set the alignment of the grid within the grid container. This property aligns the grid along the <em>row</em> axis.</p><ul><li><p>start: aligns the grid to the left end of the grid container</p></li><li><p>end</p></li><li><p>center</p></li><li><p>stretch: <strong>resize</strong> the grid items to allow the grid to fill the full width of the grid container.</p></li><li><p>space-around: places an even amount of space between each grid item, with half-sized spaces on the far ends.</p></li><li><p>space-between: places an event amount of space between each grid item, with no space at the far ends.</p></li><li><p>space-evenly: places an even amount of space between each grid item, including the far ends</p></li></ul></li><li><p>align-content:</p><ul><li><p>start</p></li><li><p>end</p></li><li><p>center</p></li><li><p>stretch</p></li><li><p>space-around</p></li><li><p>space-between</p></li><li><p>space-evenly</p></li></ul></li><li><p>grid-auto-columns &amp; grid-auto-rows:</p><ul><li><track-size>: can be a length, a percentage, or a fraction of the free space in the grid(using the <code>fr</code> unit)</track-size></li></ul><p>To illustrate how implicit grid tracks get created, think about this:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="attribute">grid-template-columns</span>: <span class="number">60px</span> <span class="number">60px</span>;</span><br><span class="line">  <span class="attribute">grid-template-rows</span>: <span class="number">90px</span> <span class="number">90px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This creates a 2 x 2 grid</p><p><img src="https://cdn.css-tricks.com/wp-content/uploads/2016/03/grid-auto.png" alt=""></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.item-a</span> &#123;</span><br><span class="line">  <span class="attribute">grid-row</span>: <span class="number">2</span>/<span class="number">3</span>;</span><br><span class="line">  <span class="attribute">grid-column</span>: <span class="number">1</span>/<span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.item-b</span> &#123;</span><br><span class="line">  <span class="attribute">grid-row</span>: <span class="number">2</span>/<span class="number">3</span>;</span><br><span class="line">  <span class="attribute">grid-column</span>: <span class="number">5</span>/<span class="number">6</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.css-tricks.com/wp-content/uploads/2016/03/implicit-tracks.png" alt=""></p><p>We told <code>.item-b</code> to start on column line 5 and end at column line 6, <em>but we never defined a column 5 or 6</em>.</p><p>Because we referenced lines that donât exist, implicit track with widths of 0 are created to fill in the gap.</p><p>We can use <code>grid-auto-column</code> and <code>grid-auto-row</code> to specify the widths of these implicit tracks:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="attribute">grid-auto-columns</span>: <span class="number">60px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.css-tricks.com/wp-content/uploads/2016/03/implicit-tracks-with-widths.png" alt=""></p></li><li><p>grid-auto-flow: If you have grid items that you donât explicitly place on the grid, the <em>auto-placement algorithm</em> kicks in to automatically place the items. This properties controls how the auto-placement algorithm works.</p><ul><li><p>row: tells the auto-placement algorithm to fill in each row in turn. adding new rows as necessary.</p></li><li><p>column: tells the auto-placement algorithm to fill in each column in turn, adding new columns as necessary.</p></li><li><p>dense: tells the auto-placement algorithm to attempt to fill in holes earlier in the grid if smaller items come up later.</p></li></ul><blockquote><p><code>dense</code> might cause your items to appear out of order</p></blockquote></li><li><p>grid: a shorthand for setting all of the following properties in a single declaration:</p><ul><li><code>grid-template-rows</code>, <code>grid-template-columns</code>, <code>grid-template-areas</code>, <code>grid-auto-rows</code>, <code>grid-auto-columns</code>, <code>grid-auto-flow</code></li></ul></li></ul><h2 id="Items"><a href="#Items" class="headerlink" title="Items"></a>Items</h2><ul><li><p>grid-column-start &amp; grid-column-end &amp; grid-row-start &amp; grid-row-end</p><ul><li><p>determines a grid itemâs location within the grid by referring to specific grid line.</p></li><li><line></line>: can be number to refer to a numbered grid line, or a name to refer to a named grid line</li><li><p>span</p><number>: the item will span across the provided number of grid tracks</number></li><li><p>span</p><name>: the item will span across until it hits the next line with the provided name</name></li><li><p>auto</p></li></ul></li><li><p>grid-column &amp; grid-row: shorthand for <code>grid-column-start</code> + <code>grid-column-end</code> and <code>grid-row-start</code> + <code>grid-row-end</code>, respectively.</p><ul><li><start-value> / <end-value><br></end-value></start-value></li></ul></li><li><p>grid-area: gives an item a name so that it can be referenced by a template created with the <code>grid-template-areas</code> property. Alternatively, this property can be used as an even shorter shorthand for <code>grid-row-start</code> + <code>grid-column-start</code> + <code>grid-row-end</code> + <code>grid-column-end</code>.</p><ul><li><name>: a name of your choosing</name></li><li><p><row-start> / <column-start> / <row-end> / <column-end><br></column-end></row-end></column-start></row-start></p></li></ul></li><li><p>justify-self: aligns the content inside a grid item along the row axis. This value applies to the content inside a single item.</p><ul><li><p>start</p></li><li><p>end</p></li><li><p>center</p></li><li><p>stretch</p></li></ul></li><li><p>align-self: aligns the content inside a grid item along the column axis. This value applies to the content inside a single grid item.</p><ul><li><p>start</p></li><li><p>end</p></li><li><p>center</p></li><li><p>stretch</p></li></ul></li></ul>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Simple Usage of Scp</title>
      <link href="/2017/05/17/simple-usage-of-scp/"/>
      <content type="html"><![CDATA[<p><a href="https://www.tecmint.com/scp-commands-examples/" target="_blank" rel="noopener">origin</a></p><h1 id="Basic-Syntax-of-SCP"><a href="#Basic-Syntax-of-SCP" class="headerlink" title="Basic Syntax of SCP"></a>Basic Syntax of SCP</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp source_file_name username@destination_host:destination_folder</span><br></pre></td></tr></table></figure><h1 id="Provider-the-detail-information-of-SCP-process-using-v-parameter"><a href="#Provider-the-detail-information-of-SCP-process-using-v-parameter" class="headerlink" title="Provider the detail information of SCP process using -v parameter"></a>Provider the detail information of SCP process using <code>-v</code> parameter</h1><p>Baisc SCP command without parameter will copy the files in background. User will see nothing unless the process is done or something error appears.</p><p>You can use <code>-v</code> parameter to print debug information into screen.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># verbose</span></span><br><span class="line">scp -v source_file_name username@destination_host:destination_folder</span><br></pre></td></tr></table></figure><h1 id="Provider-modification-times-access-times-and-modes-from-original-files"><a href="#Provider-modification-times-access-times-and-modes-from-original-files" class="headerlink" title="Provider modification times, access times, and modes from original files"></a>Provider modification times, access times, and modes from original files</h1><p>The <code>-p</code> (lowercase) parameter will help you on this. An estimated time and the connection speed will apear on the screen.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># process</span></span><br><span class="line">scp -p source_file_name username@destination_host:destination_folder</span><br></pre></td></tr></table></figure><h1 id="Make-file-transfer-faster-using-C-parameter"><a href="#Make-file-transfer-faster-using-C-parameter" class="headerlink" title="Make file transfer faster using -C parameter"></a>Make file transfer faster using <code>-C</code> parameter</h1><p>One of parameter that can faster your file transfer is <code>-C</code> parameter. The <code>-C</code> parameter will compress your file on the go. The unique thing is the compression is only happen in the network. When the file is arrived to the destination server, it will returning into the original size as before the compression happen.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Compression</span></span><br><span class="line">scp -Cpv source_file_name username@destination_host:destination_folder</span><br></pre></td></tr></table></figure><h1 id="Specify-specific-port-to-use-with-SCP"><a href="#Specify-specific-port-to-use-with-SCP" class="headerlink" title="Specify specific port to use with SCP"></a>Specify specific port to use with SCP</h1><p>Usually SCP is using port 22 as a default port. But for security reason, you may change the port into another port.</p><p>Use <code>-P</code> (uppercase) to specify the port.</p><p><code>`bashscp -P 2212 source_file_name username@destination_host:destination_folder</code></p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Rxjs API</title>
      <link href="/2017/05/08/Rxjs-API/"/>
      <content type="html"><![CDATA[<h1 id="Create"><a href="#Create" class="headerlink" title="Create"></a>Create</h1><p>You can create an Observable from scratch by using the <code>Create</code> operator. You pass this operator a function that accepts the observer as its parameter. Write this function so that it behaves as an Observable â by calling the observerâs <code>onNext</code>, <code>onError</code>, and <code>onCompleted</code> methods appropraitely.</p><p>A well-formed finite Observable must attempt to call either the observerâs <code>onCompleted</code> method exactly once or its <code>onError</code> method exactly once, and must not thereafter attempt to call any of the observerâs other methods.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> source = Rx.Observable.create(<span class="function"><span class="keyword">function</span>(<span class="params">observer</span>) </span>&#123;</span><br><span class="line">  observer.onNext(<span class="number">32</span>)</span><br><span class="line">  observer.onCompleted()</span><br><span class="line">  <span class="comment">// this is optional.</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'disposed'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> subscription = source.subscribe(</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Next: '</span> + x)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Error: '</span> + err)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Completed'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h1 id="Defer"><a href="#Defer" class="headerlink" title="Defer"></a>Defer</h1><p>Do not create the Observable until the observer subscribes, and create a fresh Observable for each observer.</p><p>The <code>Defer</code> operator waits until an observer subscribes to it, and then it generates an Observable, typically with an Observable factory function. It does this afresh for each subsciber, so although each subscriber may think it is subscribing to the same Observable, in fact each subscriber gets its own individual sequence.</p><p>In some circumstances, waiting until the last minute to generate the Observable can ensure that this Observable contains the freshest data.]</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> source = Rx.Observable.defer(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> Rx.Observable.return(<span class="number">42</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> subscription = source.subscribe(</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Next: '</span> + x)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Error: '</span> + err)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Completed'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h1 id="Empty-Never-Throw"><a href="#Empty-Never-Throw" class="headerlink" title="Empty/Never/Throw"></a>Empty/Never/Throw</h1><p><code>Empty</code> create an Observable that emits no items but terminates normally</p><p><code>Never</code> create an Observable that emits no items and does not terminates</p><p><code>Throw</code> create an Observable that emits no items and terminates with an error</p><p>The <code>Empty</code>, <code>Never</code>, <code>Throw</code> operators generate Observables with very specific and limited behavior. These are useful for testing purposes, and sometimes also for combining with other Observables or as parameters to operators that expect other Observables as parameters.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> source = Rx.Observable.empty()</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> source = Rx.Observable.never()</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> source = Rx.Observable.return(<span class="number">52</span>).selectMany(Rx.Observable.throw(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'error'</span>)))</span><br></pre></td></tr></table></figure><h1 id="From"><a href="#From" class="headerlink" title="From"></a>From</h1><p>Convert various other objects and data types into Observables.</p><p>When you work with Observables, it can be more convenient if all of the data you mean to work with can be represented as Observables, rather than as a mixture of Observables and other types. This allows you to use a single set of operators to govern the entire lifespan of the data stream.</p><p>Iterables, for example, can be thought of as a sort of synchronous Observable; Futures, as a sort of Observable that always emits only a single item. By explicitly converting such objects to Observables, you allow them to interact as peers with other Observale.</p><p>In RxJS, the <code>from</code> operator converts an <em>array-like</em> or <em>iterable</em> object into an Observable that emits the items in that array or iterable. A String, in this context, is treated as an array of characters.</p><p>The operator also takes three additional, optional parameters:</p><ul><li><p>a transforming function that takes an item from the array or iterable as input and produces an item to be emmited by the resulting Observable as output</p></li><li><p>a second argument to pass into</p></li></ul>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Detail of Node Cluster</title>
      <link href="/2017/05/02/detail-of-node-cluster/"/>
      <content type="html"><![CDATA[<h1 id="Cluster"><a href="#Cluster" class="headerlink" title="Cluster"></a>Cluster</h1><p>A single instance of Node.js runs in a single tread. To take advantage of multi-core systems the user will sometimes want to launch a cluster of Node.js processes to handle the load.</p><p>The cluster module allows you to easily create child processes that all share <strong>server port</strong>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> cluster = <span class="built_in">require</span>(<span class="string">'cluster'</span>)</span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">const</span> numCPUs = <span class="built_in">require</span>(<span class="string">'os'</span>).cpus().length</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (cluster.isMaster) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Master <span class="subst">$&#123;process.pid&#125;</span> is running`</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Fork workers</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; numCPUs; i++) &#123;</span><br><span class="line">    cluster.fork()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  cluster.on(<span class="string">'exit'</span>, (worker, code, signal) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`worker <span class="subst">$&#123;worker.process.pid&#125;</span> died`</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// Workers can share any TCP connection</span></span><br><span class="line">  <span class="comment">// In this case it is an HTTP Server</span></span><br><span class="line"></span><br><span class="line">  http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.writeHead(<span class="number">200</span>)</span><br><span class="line">    res.end(<span class="string">'hello world\n'</span>)</span><br><span class="line">  &#125;).listen(<span class="number">8000</span>)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Worker <span class="subst">$&#123;process.pid&#125;</span> started`</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Running Node.js will now share port 8000 between the workers.</p><h1 id="How-it-works"><a href="#How-it-works" class="headerlink" title="How it works"></a>How it works</h1><p>The workder processes are spawned using the <code>child_process.fort()</code> method, so that they can communicate with the parent via IPC and pass server handles back and forth.</p><p>The cluster module supports two methods of distributing incoming connections.</p><p>The first one (and the default one on all platform except Windows), is the <strong>round-robin</strong> approch, where the master process listens on a port, accepts new connections and distributes them across the workers in a round-robin fashion, with some built-in smarts to avoid overloading a worker process.</p><p>The second approach is where the master process <strong>creates the listen socket and sends it to interested workers</strong>. The workers then accept incoming connection directly.</p><p>The second approach should, in theory, give the best performance. In practice however, distribution tends to be <strong>very unbalanced due to operating system scheduler vagaries</strong>. Loads have been observed where over 70% of all connections ended up in just two process, out of a total of eight.</p><p>Because <code>server.listen()</code> hands off most of the worker to the master process, there are three case where the behavior between a normal Node.js process and a cluster worker differs:</p><blockquote><p><code>server.listen({fd: 7})</code> Because the message is passed to the master, file descriptor 7 <strong>in the parent</strong> will be listened on, and the handle passed to the worker, rather than listening to the workerâs idea of what the number 7 file descriptor reference. (the fd will be used up sooner)</p></blockquote><blockquote><p><code>server.listen(handle)</code> Listening on handles explicitly wil cause the worker to use the supplied handle, rather than talk to the master process. If the worker already has the handle, then itâs presumed that you know what you are doing.</p></blockquote><blockquote><p><code>server.listen(0)</code> Normally, this will cause servers to listen on a random port. However, in a cluster, each worker will receive the same ârandomâ port each time they do <code>listen(0)</code>. In essence, the port is random the first time, but predicatable thereafter. If you want to listen on a unique port, generate a port number based on the cluster worker ID.</p></blockquote><p>There is no routing logic in Node.js, or in your program, and no shared state between the workers. Therefore, it is important to design your program such that it does not rely on heavily on in-memory data object for things like sessions and login.</p><p>Because workers are all separate processes, they can be killed or re-spawned depending on your programâs needs, without affecting other workers. As long as there are some workers still alive, the server will continue to accept connections. If no workers are alive, existing connections will be dropped and new connections will be refused. Node.js does not automatically manage the number of worker for you, however. It is yoru responsibility to manage the worker pool for your applicationâs needs.</p><h1 id="Class-worker"><a href="#Class-worker" class="headerlink" title="Class: worker"></a>Class: worker</h1><p>A Worder Object contains all public information and method about a worker. In the master it can be obtained using <code>cluster.workers</code>. In a worker it can be obtained using <code>cluster.worker</code></p><h2 id="Event-âdisconnectâ"><a href="#Event-âdisconnectâ" class="headerlink" title="Event: âdisconnectâ"></a>Event: âdisconnectâ</h2><p>Similar to the <code>cluster.on(&#39;disconnect&#39;)</code> event, but specific to this worker.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cluster.fork().on(<span class="string">'disconnect'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="comment">// Worker has disconnected</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="Event-âerrorâ"><a href="#Event-âerrorâ" class="headerlink" title="Event: âerrorâ"></a>Event: âerrorâ</h2><p>This event is the same as the one provided by <code>child_process.fork()</code></p><p>In a worker you can alse use <code>process.on(&#39;error&#39;)</code></p><h2 id="Event-âexitâ"><a href="#Event-âexitâ" class="headerlink" title="Event: âexitâ"></a>Event: âexitâ</h2><blockquote><p><code>code</code></p></blockquote><blockquote><number> the exit code, if it exited Normally</number></blockquote><blockquote><p><code>signal</code></p></blockquote><blockquote><string> the name of the signal(e.g. <strong>SIGHUP</strong>) that caused the process to be killed.</string></blockquote><p>Similar to the <code>cluster.on(&#39;exit&#39;)</code> event, but specific to this worker</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> worker = cluster.fork()</span><br><span class="line">worker.on(<span class="string">'exit'</span>, (code, signal) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (signal) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`worker was killed by signal: <span class="subst">$&#123;signal&#125;</span>`</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (code !== <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`worker exited with error code: <span class="subst">$&#123;code&#125;</span>`</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'worker success'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="Event-âlisteningâ"><a href="#Event-âlisteningâ" class="headerlink" title="Event: âlisteningâ"></a>Event: âlisteningâ</h2><blockquote><p><code>address</code></p></blockquote><blockquote><p><object><br>  <p><br></p><br>  <p>Similar to the <code>cluster.on(âlisteningâ)</code> event, but specific to this worker.</p><br>  <pre></pre></object></p></blockquote><blockquote><p>  <code class="lang-javascript">cluster.fork().on(âlisteningâ, (address) =&gt; {<br>  // Worker is listening<br>})<br></code><br><br>  </p><p>It is not emitted in the worker</p><br>  <h4 id="event-message-">Event: âmessageâ</h4><br>  <blockquote><br>  <p><code>message</code> <object><br>  <p><br></p><br>  <p><code>handle</code> <undefined> | <object><br>  <p></p><br>  <p>Similar to the <code>cluster.on(âmessageâ)</code> event, but specific to this worker. In a worker you can also use <code>process.on(âmessageâ)</code></p><br>  <p>As an example, here is a cluster that keeps count of the number of requests in the master process using the message system:</p><br>  <pre><code class="lang-javascript">const cluster = require(âclusterâ)<br>const http = require(âhttpâ)</code></pre></object></undefined></p></object></p></blockquote><blockquote><p>if (cluster.isMaster) {</p></blockquote><blockquote><p>  let numReqs = 0</p></blockquote><blockquote><p>  setInterval(() =&gt; {<br>    console.log(<code>numReqs = ${numReqs}</code>)<br>  }, 1000)</p></blockquote><blockquote><p>  // Count requests<br>  function messageHandler(msg) {<br>    if (msg.cmd &amp;&amp; msg.cmd === ânotifyRequestâ) {<br>      numReqs++<br>    }<br>  }</p></blockquote><blockquote><p>  // Start workers and listen for messages containing notifyRequest</p></blockquote><blockquote><p>  const numCPUs = require(âosâ).cpus().length</p></blockquote><blockquote><p>  for (let i = 0; i &lt; numCPUs; i++) {<br>    cluster.fork()<br>  }</p></blockquote><blockquote><p>  for (const id in cluster.workers) {<br>    cluster.workers[id].on(âmessageâ, messageHandler)<br>  }</p></blockquote><blockquote><p>} else {<br>  // Worker processes have a http server<br>  http.Server((req, res) =&gt; {<br>    res.writeHead(200)<br>    res.end(âhello worldâ)<br>    process.send({ cmd: ânotifyRequestâ })<br>  }).listen(8000)<br>}<br><br>  </p><h4 id="event-online-">Event: âonlineâ</h4><br>  <p>Similar to the <code>cluster.on(âonlineâ)</code> event, but specific to this worker</p><br>  <pre><code class="lang-javascript">cluster.fork().on(âonlineâ, () =&gt; {<br>  // Worker is online<br>})<br></code></pre><br>  <p>It is not emitted in the worker</p><br>  <h4 id="worker-disconnect-">worker.disconnect()</h4><br>  <blockquote><p>Return: <worker> A reference to <code>worker</code></worker></p></blockquote><br>  <p>In a worker, this function will close all server, wait for the <code>close</code> event on those servers, and disconnect the IPC channel.</p><br>  <p>In the master, an internal message is sent to the worker causing it to call <code>.disconnect()</code> on itself</p><br>  <p>Cause <code>.exitedAfterDisconnect</code> to be set.</p><br>  <p>Note that after a server is closed, it will no longer accept new connections, but connections may be accepted by any other listening worker. Existing connections will be allowed to close as usual. When no more connections exist, see <code>server.close()</code>, the IPC channel to the worker will close allowing it to die gracefully.</p><br>  <p>Note that in a worker, <code>process.disconnect</code> exists, but it is not this function.</p><br>  <p>Because long living server connections may block workers from disconnecting, it may be useful to send a message, so application specific actions may be taken to close them. It also may be useful to implement a timeout, killing a worker if the <code>disconnect</code> event has not been emiited after some time.</p><br>  <pre><code class="lang-javascript">if (cluster.isMaster) {<br>  const worker = cluster.fork()<br>  let timeout<p></p></code></pre></blockquote><blockquote><p>  worker.on(âlisteningâ, (address) =&gt; {<br>    worker.send(âshutdownâ)<br>    worker.disconnect()<br>    timeout = setTimeout(() =&gt; {<br>      worker.kill()<br>    }, 2000);<br>  })</p></blockquote><blockquote><p>  worker.on(âdisconnectâ, () =&gt; {<br>    clearTimeout(timeout)<br>  })<br>} else if (cluster.isWorker){<br>  const net = require(ânetâ)<br>  const server = net.createServer((socket) =&gt; {<br>    // connections never end<br>  })<br>  server.listen(8000)</p></blockquote><blockquote><p>  process.on(âmessaageâ, (msg) =&gt; {<br>    if (msg === âshutdownâ) {<br>      // initiate graceful close of any connections to server<br>    }<br>  })<br>}<br><br>  </p><h4 id="worker-exitedafterdisconnect">worker.exitedAfterDisconnect</h4><br>  <blockquote><boolean><br></boolean></blockquote><br>  <p>Set by calling <code>.kill()</code> or <code>.disconnect()</code>. Until then, it is <code>undefined</code></p><br>  <p>The boolean <code>worker.exitedAfterDisconnect</code> lets you distinguish between voluntary and accidental exit, the master may choose not to respawn a worker based on this value.</p><br>  <pre><code class="lang-javascript">cluster.on(âexitâ, (worker, code, signal) =&gt; {<br>  if (worker.exitedAfterDisconnect === true) {<br>    console.log(âOh, it was just voluntary - no need to worryâ)<br>  }<br>})<p></p></code></pre></blockquote><blockquote><p>// kill worker<br>worker.kill()<br><br>  </p><h4 id="worker-id">worker.id</h4><br>  <blockquote><number><br></number></blockquote><br>  <p>Each new worker is given its own unique id, this id is stored in the <code>id</code></p><br>  <p>While a worker is alive, this is the key that indixes it in cluster.workers.</p><br>  <h4 id="worker-isconnected-">worker.isConnected()</h4><br>  <p>This function returns <code>true</code> if the worker is connected to its master via its IPC channel. <code>false</code> otherwise. A worker is connected to its master after itâs been created. It is disconnected after the <code>disconnect</code> event is emitted.</p><br>  <h4 id="worker-isdead-">worker.isDead()</h4><br>  <p>This function returns <code>true</code> if the workerâs process has terminated (either because of exiting or being signaled). Otherwise, it returns <code>false</code></p><br>  <h4 id="worker-kill-signal-sigterm-">worker.kill([signal=âSIGTERMâ])</h4><br>  <blockquote><p><code>signal</code> <string> Name of the kill signal to send to the worker process.</string></p></blockquote><br>  <p>This function will kill the worker. In the master it does this by disconnecting the <code>worker.process</code> and once disconnected, killing with <code>signal</code>. In the worker, it does it by disconnecting the channel and exiting with code <code>0</code></p><br>  <p>Causes <code>.exitedAfterDisconnect</code> ot be set</p><br>  <p>This method is aliased as <code>worker.destroy()</code> for backwords compatibility.</p><br>  <p>Note that ina worker, <code>process.kill()</code> exists, but it is not the function.</p><br>  <h4 id="worker-process">worker.process</h4><br>  <blockquote><childprocess><br></childprocess></blockquote><br>  <p>All Workers are created using <code>child_process.fork()</code>, the returned object from this function is stored as <code>.process</code>. In a worker, the global <code>process</code> is stored</p><br>  <p>Note that the workers will call <code>process.exit(0)</code> if the <code>disconnect</code> event occurs on <code>process</code> and <code>.exitedAfterDisconnect</code> is not <code>true</code>. This protects against accidental disconnection.</p><br>  <h4 id="worker-send-message-sendhandle-callback-">worker.send(message[, sendHandle, [callback]])</h4><br>  <blockquote><p><code>message</code> <object><br>  <p><br></p><br>  <p><code>sendHandle</code> <handle><br></handle></p><br>  <p><code>callback</code> <function><br></function></p><br>  <p>Send a message to a worker or master, optinally with a handle.</p><br>  <p>In the master this sends a message to a specific worker. It is identical to <code>ChildProcess.send()</code></p><br>  <p>In a worker this sends a message to the master. It is identical to <code>process.send()</code></p><br>  <p>This example will echo back all messages from the master</p><br>  <pre></pre></object></p></blockquote><blockquote><p>  <code class="lang-javascript">if (cluster.isMaster) {<br>  const worker = cluster.fork()<br>  worker.send(âhi thereâ)<br>} else if (cluster.isWorker) {<br>  process.on(âmessageâ, (msg) =&gt; {<br>    process.send(msg)<br>  })<br>}<br></code><br><br>  </p><h4 id="event-disconnect-">Event: âdisconnectâ</h4><br>  <blockquote><br>  <p><code>worker</code> &lt;cluster.worker&gt;<br>&lt;/cluster.worker&gt;</p><br></blockquote><br>  <p>Emitted after the worker IPC channel has disconnected. This can occur when a worker exits gracefully, is killed, or is disconnected manually(such as with worker.disconnected())</p><br>  <p>There may be a delay between the <code>disconnect</code> and <code>exit</code> events. These events can be used to detect if the process is stuck in a cleanup or if there are long-living connections.</p><br>  <pre><p></p></pre></blockquote><blockquote><p>  <code class="lang-javascript">cluster.on(âdisconnectâ, (worker) =&gt; {<br>  console.log(<code>The worker #${worker.id} has disconnected</code>)<br>})<br></code><br><br>  </p><h4 id="event-exit-">Event: âexitâ</h4><br>  <blockquote><br>  <p><code>worker</code> &lt;cluster.worker&gt;<br>&lt;/cluster.worker&gt;</p><br>  <p><code>code</code> <number> the exit code, if it exited normally</number></p><br>  <p><code>signal</code> <string> the name of the signal (e.g. âSIGHUPâ) that caused the process to be killed.</string></p><br></blockquote><br>  <p>When any of the workers die the cluster module will emit the âexitâ events</p><br>  <p>This can be used to restart the worker by calling <code>.fork()</code> again.</p><br>  <pre><p></p></pre></blockquote><blockquote><p>  <code class="lang-javascript">cluster.on(âexitâ, (worker, code, signal) =&gt; {<br>  console.log(âworker %d died (%s), restartingâ¦â, worker.process.pid, signal || code)<br>  cluster.fork()<br>})<br></code><br><br>  </p><h4 id="event-fork-">Event: âforkâ</h4><br>  <blockquote><br>  <p><code>worker</code> &lt;cluster.worker&gt;<br>&lt;/cluster.worker&gt;</p><br></blockquote><br>  <p>When a new worker is forked the cluster module will emit a <code>fork</code> event. This can be used to log worker activity, and create your own timeout.</p><br>  <pre><p></p></pre></blockquote><blockquote><p>  <code class="lang-javascript">const timeouts = []<br>function errorMsg () {<br>  console.error(âSomething must be wrong with the connectionâ¦â)<br>}</code></p></blockquote><blockquote><p>cluster.on(âforkâ, (worker) =&gt; {<br>  timeouts[worker.id] = setTimeout(errorMsg, 2000)<br>})</p></blockquote><blockquote><p>cluster.on(âlisteningâ, (worker, address) =&gt; {<br>  clearTimeout(timeouts[worker.id])<br>})</p></blockquote><blockquote><p>cluster.on(âexitâ, (worker, code, signal) =&gt; {<br>  clearTimeout(timeouts[worker.id])<br>})<br><br><br>  </p><h4 id="event-listening-">Event: âlisteningâ</h4><br>  <blockquote><br>  <p><code>worker</code> &lt;cluster.worker&gt;<br>&lt;/cluster.worker&gt;</p><br>  <p><code>address</code> <object><br>  <p><br></p><br>  <p>After calling <code>listen()</code> from  a worker. when the <code>listening</code> event it emitted on the server, a <code>listening</code> event will also be emitted on <code>cluster</code> in the master</p><br>  <p>The event handler is executed with two arguments, the <code>worker</code> contains the worker object and the <code>address</code> object contains the following connection properties: <code>address</code>, <code>port</code> and <code>addressType</code>. This is very useful if the worker is listening on more than one address.</p><br>  <pre></pre></object></p></blockquote><blockquote><p>  <code class="lang-javascript">cluster.on(âlisteningâ, (worker, address) =&gt; {<br>  console.log(<code>A worker is now connected to ${address.address}: ${address.port}</code>)<br>})<br></code><br><br>  </p><p>The <code>addressType</code> is one of:</p><br>  <ul><br>  <li><code>4</code>: (TCPv4)</li><br>  <li><code>6</code>: (TCPv6)</li><br>  <li><code>-1</code>: (unix domain socket)</li><br>  <li><code>âudp4â</code> or <code>âudp6â</code> (UDP v4 or v6)</li><br></ul><br>  <h4 id="event-message-">Event: âmessageâ</h4><br>  <blockquote><br>  <p><code>worker</code> &lt;cluster.worker&gt;<br>&lt;/cluster.worker&gt;</p><br>  <p><code>message</code> <object><br>  <p><br></p><br>  <p><code>handle</code> <undefined> | <object><br>  <p></p><br>  <p>Emitted when the cluster master receives a message from any worker.</p><br>  <h4 id="event-online-">Event: âonlineâ</h4><br>  <blockquote><p><code>worker</code> &lt;cluster.worker&gt;<br>&lt;/cluster.worker&gt;</p></blockquote><br>  <p>After forking a new worker, the worker should respond with an online message. When the master receives an online message it will emit this event. The difference between <code>fork</code> and <code>online</code> is that fork is emitted when the master forks a worker and <code>online</code> is emitted when the worker is running.</p><br>  <h4 id="event-setup-">Event: âsetupâ</h4><br>  <blockquote><p><code>settings</code> <object><br>  <p><br></p><br>  <p>Emitted every time <code>.setupMaster()</code> is called.</p><br>  <p>The <code>settings</code> object is the <code>cluster.settings</code> object at the time <code>.setupMaster()</code> was called and is advisory only. since multiple calls to <code>.setupMaster()</code> can be made in a single tick.</p><br>  <p>If accuracy is important, use <code>cluster.settings</code></p><br>  <h4 id="cluster-disconnect-callback-">cluster.disconnect([callback])</h4><br>  <p><code>callback</code> called when <strong>all</strong> workers are disconnected and handles are closed Calls <code>.disconnect()</code> on each worker in <code>cluster.workers</code></p><br>  <p>When they are disconnected all internal handles will be closed, allowing the master process to die gracefully if no other event is waiting.</p><br>  <p>The method takes an optional callback argument which will be called when finished.</p><br>  <p>This can only be called from the master process.</p><br>  <h4 id="cluster-fork-env-">cluster.fork([env])</h4><br>  <blockquote><br>  <p><code>env</code> <object> Key/Value pairs to add to worker process environment<p><br></p><p>return &lt;cluster.worker&gt;<br>&lt;/cluster.worker&gt;</p><p>Spawn a new worker process.</p><p>This can only be called from the master process.</p><h4 id="cluster-ismaster">cluster.isMaster</h4><blockquote><br>  <boolean><br></boolean><br></blockquote><p>True if the process is a master. This is determined by the <code>process.env.NODE_UNIQUE_ID</code>. If <code>process.env.NODE_UNIQUE_ID</code> is undefined, then <code>.isMaster</code> is <code>true</code></p><h4 id="cluster-isworker">cluster.isWorker</h4><blockquote><br>  <boolean><br></boolean><br></blockquote><p>True if the process is not a master (it is the negation of <code>cluster.isMaster</code>)</p><h4 id="cluster-schedulingpolicy">cluster.schedulingPolicy</h4><p>The scheduling policy, either <code>cluster.SCHED_RR</code> for round-robin or <code>cluster.SCHED_NONE</code> to leave it to the operating system. This is a global setting and effectively frozen once you spawn the first worker or call cluster <code>cluster.setupMaster()</code>, whatever comes first.</p><p><code>SCHED_RR</code> is the default on all operating systems except Windows. Windows will change to <code>SCHED_RR</code> once libuv is able to effectively distribute IOCP handles without incurring a large performance hit.</p><p><code>cluster.schedulingPolicy</code> can also be set through the <code>NODE_CLUSTER_SCHED_POLICY</code> environment variable. Valid values are <code>ârrâ</code> and <code>ânoneâ</code></p><h4 id="cluster-settings">cluster.settings</h4><blockquote><br>  <p><object><br>  <p><br></p><br>  <ul><br>  <li><code>execArgv</code></li><br>  <li><code>exec</code></li><br>  <li><code>args</code></li><br>  <li><code>silent</code></li><br>  <li><code>stdio</code></li><br>  <li><code>uid</code></li><br>  <li><code>gid</code></li><br></ul><br>  <h4 id="cluster-setupmaster-settings-">cluster.setupMaster([settings])</h4><br>  <blockquote><br>  <p><code>settings</code></p><br>  <ul><li><code>exec</code></li><li><code>args</code></li><li><code>silent</code></li><li><code>stdio</code></li></ul><br></blockquote><br>  <pre></pre></object></p></blockquote><blockquote><p>  <code class="lang-javascript">const cluster = require(âclusterâ)<br>cluster.setupMaster({<br>  exec: âworker.jsâ,<br>  args: [ââuseâ, âhttpsâ],<br>  silent: true,<br>})</code></p></blockquote><blockquote><p>cluster.fork() // https worker<br><br><br>  </p><h4 id="cluster-worker">cluster.worker</h4><br>  <blockquote><br>  <object><br>  <p>A reference to the current worker object. Not available in the master process.</p><br>  <pre></pre></object></blockquote></blockquote></object></p></blockquote><blockquote><p>  <code class="lang-javascript">const cluster = require(âclusterâ)</code></p></blockquote><blockquote><p>if (cluster.isMaster) {<br>  console.log(âI am masterâ)<br>  cluster.fork()<br>  cluster.fork()<br>} else if (cluster.isWorker) {<br>  console.log(<code>I am worker #${cluster.worker.id}</code>)<br>}<br><br><br>  </p><h4 id="cluster-workers">cluster.workers</h4><br>  <blockquote><br>  <object><br>  <p>A hash that stores the active worker objects, keyed by <code>id</code> field. Makes it easy to loop through all the workers. It is only available in the master process.</p><br>  <p>A worker is removed from <code>cluster.workers</code> after the worker has disconnected <strong>and</strong> exit. <strong>The order between two events cannot be determined in advance</strong>. However it is guaranteed that the removal from the cluster.workers list happens before last <code>disconnect</code> or <code>exit</code> event is emitted.</p><br>  <pre></pre></object></blockquote></blockquote></object></p></blockquote><blockquote><p>  <code class="lang-javascript">// Go through all workers<br>function eachWorker(callback) {<br>  for (const id in cluster.workers) {<br>    callback(cluster.worker[id])<br>  }<br>}</code></p></blockquote><blockquote><p>eachWorker((worker) =&gt; {<br>  worker.send(âbig announcement to all workersâ)<br>})<br><br><br>  </p><p>Should you wish to reference a worker over a communication channel, using the workerâs unique id is the easiest way to find the worker.</p><br>  <pre></pre></blockquote></object></undefined></p></object></p></blockquote><blockquote><p>  <code class="lang-javascript">socket.on(âdataâ, (id) =&gt; {<br>  const worker = cluster.workers[id]<br>})<br></code><br><br><br></p></blockquote><br><br></blockquote><br><p></p><br></blockquote><p></p><br></blockquote><br><p></p></blockquote><br><p></p><br><p></p><br><br><p></p><br><br><p></p><br><p></p><br><p></p><br><br><p></p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Api of Axios</title>
      <link href="/2017/04/29/api-of-axios/"/>
      <content type="html"><![CDATA[<h1 id="alias"><a href="#alias" class="headerlink" title="alias"></a>alias</h1><blockquote><p>axios.request(config) axios.get(url[, config]) axios.delete(url[, config]) axios.head(url[, config]) axios.options(url[, config]) axios.post(url[, data[, config]]) axios.put(url[, data[, config]]) axios.patch(url[, data[, config]])</p></blockquote><h1 id="Config-Options"><a href="#Config-Options" class="headerlink" title="Config Options"></a>Config Options</h1><p><code>url</code> is required, and <code>get</code> is the default method</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  url: <span class="string">'string'</span>,</span><br><span class="line">  method: <span class="string">'get'</span>,</span><br><span class="line">  baseUrl: <span class="string">'https://some-domain.com/api/'</span>, <span class="comment">// prepended to url unless url is absolute,</span></span><br><span class="line">  transformRequest: [<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">  &#125;],</span><br><span class="line">  transformResponse: [<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">  &#125;],</span><br><span class="line">  headers: &#123;</span><br><span class="line">    <span class="string">'X-Requested-With'</span>: <span class="string">'XMLHttpRequest'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  params: &#123; <span class="comment">// url params to be sent with the request, plain object or URLSearchParams Object</span></span><br><span class="line">    ID: <span class="number">12345</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  paramsSerializer: <span class="function"><span class="keyword">function</span> (<span class="params">params</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Qs.stringify(params, &#123; <span class="attr">arrayFormat</span>: <span class="string">'brackets'</span> &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  data: &#123; <span class="comment">// the data sent as request body, only applicable for request method 'PUT', 'POST', 'PATCH'. When no transformRequest is set, must be one of the following types: string, plain object, ArrayBuffer, ArrayBufferView, URLSearchParams, FormData(Browser only), File(browser only), Blob(browser only), Stream(Node only), Buffer(Node only)</span></span><br><span class="line">    firstName: <span class="string">'fred'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  timeout: <span class="number">1000</span>,</span><br><span class="line">  withCredentials: <span class="literal">false</span> <span class="comment">// default</span></span><br><span class="line">  adapter: <span class="function"><span class="keyword">function</span> (<span class="params">config</span>) </span>&#123; <span class="comment">// allows custom handling of requests which makes testing easier.</span></span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line">  auth: &#123;</span><br><span class="line">    username: <span class="string">'janedoe'</span>,</span><br><span class="line">    password: <span class="string">'...'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  responseType: <span class="string">'json'</span>, <span class="comment">// default</span></span><br><span class="line">  xsrfCookieName: <span class="string">'XSRF-TOKEN'</span>, <span class="comment">// defualt</span></span><br><span class="line">  onUploadProgress: <span class="function"><span class="keyword">function</span> (<span class="params">progressEvent</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line">  onDownloadProgress: <span class="function"><span class="keyword">function</span>(<span class="params">progressEvent</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line">  maxContentLength: <span class="number">2000</span>,</span><br><span class="line">  validateStatus: <span class="function"><span class="keyword">function</span> (<span class="params">status</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> status &gt;= <span class="number">200</span> &amp;&amp; status &lt; <span class="number">300</span> <span class="comment">// default</span></span><br><span class="line">  &#125;,</span><br><span class="line">  maxRedirects: <span class="number">5</span>, <span class="comment">// default</span></span><br><span class="line">  httpAgent: <span class="keyword">new</span> http.Agent(&#123; <span class="attr">keepAlive</span>: <span class="literal">true</span> &#125;),</span><br><span class="line">  httpsAgent: <span class="keyword">new</span> http.Agent(&#123; <span class="attr">keepAlive</span>: <span class="literal">true</span> &#125;),</span><br><span class="line">  proxy: &#123; <span class="comment">// defines the hostname and port of the proxy server</span></span><br><span class="line">    host: <span class="string">'127.0.0.1'</span>,</span><br><span class="line">    port: <span class="number">9000</span>,</span><br><span class="line">    auth: &#123;</span><br><span class="line">      username: <span class="string">'...'</span>,</span><br><span class="line">      password: <span class="string">'...'</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  cancelToken: <span class="keyword">new</span> CancelToken(<span class="function"><span class="keyword">function</span> (<span class="params">cancel</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="response-Schema"><a href="#response-Schema" class="headerlink" title="response Schema"></a>response Schema</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  data: &#123;&#125;,</span><br><span class="line">  status: <span class="number">200</span>,</span><br><span class="line">  statusText: <span class="string">'OK'</span>,</span><br><span class="line">  headers: &#123;&#125;,</span><br><span class="line">  config: &#123;&#125;,</span><br><span class="line">  request: &#123;&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="errors"><a href="#errors" class="headerlink" title="errors"></a>errors</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">axios.get(<span class="string">'/user/123'</span>)</span><br><span class="line">.catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err.response) &#123;</span><br><span class="line">    <span class="comment">// err.response.data</span></span><br><span class="line">    <span class="comment">// err.response.status</span></span><br><span class="line">    <span class="comment">// err.response.headers</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (res.request) &#123;</span><br><span class="line"></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="get"><a href="#get" class="headerlink" title="get"></a>get</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">axios.get(<span class="string">'/user?ID=12345'</span>)</span><br><span class="line">.then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res)</span><br><span class="line">&#125;)</span><br><span class="line">.catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">axios.get(<span class="string">'/user'</span>, &#123;</span><br><span class="line">  params: &#123;</span><br><span class="line">    ID: <span class="number">12345</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">.then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res)</span><br><span class="line">&#125;)</span><br><span class="line">.catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="post"><a href="#post" class="headerlink" title="post"></a>post</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">axios.post(<span class="string">'/user'</span>, &#123;</span><br><span class="line">  firstName: <span class="string">'Fred'</span>,</span><br><span class="line">  lastName: <span class="string">'Flintstrong'</span>,</span><br><span class="line">&#125;)</span><br><span class="line">.then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res)</span><br><span class="line">&#125;)</span><br><span class="line">.catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="concurrency"><a href="#concurrency" class="headerlink" title="concurrency"></a>concurrency</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUserAccount</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> axios.get(<span class="string">'/user/12345'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUserPermissions</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> axios.get(<span class="string">'/user/12345/permissions'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">axios.all([getUserAccount(), getUserPermissions()])</span><br><span class="line">.then(axios.spread(<span class="function"><span class="keyword">function</span> (<span class="params">acct, perms</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Both request are now complete</span></span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure><h1 id="config"><a href="#config" class="headerlink" title="config"></a>config</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">axios(&#123;</span><br><span class="line">  method: <span class="string">'post'</span>,</span><br><span class="line">  url: <span class="string">'/user/12345'</span>,</span><br><span class="line">  data: &#123;</span><br><span class="line">    firstName: <span class="string">'Fred'</span>,</span><br><span class="line">    lastName: <span class="string">'Flintstone'</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">axios(&#123;</span><br><span class="line">  method: <span class="string">'get'</span>,</span><br><span class="line">  url: <span class="string">'http://bit.ly/2mTM3n'</span>,</span><br><span class="line">  responseType: <span class="string">'stream'</span>,</span><br><span class="line">&#125;)</span><br><span class="line">.then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.data.pipe(fs.createWriteStream(<span class="string">'ada_lovelace.jpg'</span>))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>webpackDevServer Proxy</title>
      <link href="/2017/04/27/webpackDevServer-Proxy/"/>
      <content type="html"><![CDATA[<p><code>devServer.proxy</code>: <code>object</code></p><p>Proxying some URLs can be useful when you have a separate API backend development server and you want to send API requests on the same domain.</p><p>The dev-server makes use of the powerful <code>http-proxy-middleware</code> package.</p><p>With a backend on <code>localhost:3000</code>, you can use this to enable proxying:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">proxy: &#123;</span><br><span class="line">  &apos;/api&apos;: &apos;http://localhost:3000&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>A request to <code>/api/users</code> will now proxy to the request to <code>http://localhost:3000/api/users</code></p><p>If you donât want <code>/api</code> to be passed along, we need to rewrite the path</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">proxy: &#123;</span><br><span class="line">  &apos;/api&apos;: &#123;</span><br><span class="line">    target: &apos;http://localhost:3000&apos;,</span><br><span class="line">    pathRewrite: &#123;</span><br><span class="line">      &apos;^/api&apos;: &apos;&apos;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>A backend server running on HTTPS with an invalid certificate will not be accepted by default. If you want to, modify config like this:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">proxy: &#123;</span><br><span class="line">  &apos;/api&apos;: &#123;</span><br><span class="line">    target: &apos;https://other-server.example.com&apos;,</span><br><span class="line">    secure: false,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Notes in Migrating From React-Router-3 to React-Router-4</title>
      <link href="/2017/04/26/notes-in-migrating-from-React-Router-3-to-React-Router-4/"/>
      <content type="html"><![CDATA[<h1 id="HashRouter"><a href="#HashRouter" class="headerlink" title="HashRouter"></a>HashRouter</h1><p>Version 4 of React-Router seperate top level router element for the different history type. If youâre using version 4 you should be able to replace <code>&lt;Router hisotry={hashHistory}&gt;</code> with <code>&lt;HashRouter&gt;</code></p><h1 id="Multiple-Routes-at-same-URL"><a href="#Multiple-Routes-at-same-URL" class="headerlink" title="Multiple Routes at same URL"></a>Multiple Routes at same URL</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  BrowserRouter <span class="keyword">as</span> Router,</span><br><span class="line">  Route,</span><br><span class="line">  Link,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Each logical 'route' has two components, one for the sidebar and one for the main area. We want to render both of them in different places when the path matches the current URL.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">'/'</span>,</span><br><span class="line">    exact: <span class="literal">true</span>,</span><br><span class="line">    sidebar: <span class="function"><span class="params">()</span> =&gt;</span> &lt;div&gt;Home&lt;<span class="regexp">/div&gt;,</span></span><br><span class="line"><span class="regexp">    main: () =&gt; &lt;h2&gt;Home&lt;/</span>h2&gt;,</span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    path: <span class="string">'/bubblegum'</span>,</span><br><span class="line">    sidebar: <span class="function"><span class="params">()</span> =&gt;</span> &lt;div&gt;bubblegum&lt;<span class="regexp">/div&gt;,</span></span><br><span class="line"><span class="regexp">    main: () =&gt; &lt;h2&gt;BubbleGum&lt;/</span>div&gt;,</span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    path: <span class="string">'/shoelaces'</span>,</span><br><span class="line">    sidebar: <span class="function"><span class="params">()</span> =&gt;</span> &lt;div&gt;shoelaces&lt;<span class="regexp">/div&gt;,</span></span><br><span class="line"><span class="regexp">    main: () =&gt; &lt;h2&gt;ShoeLaces&lt;/</span>h2&gt;,</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sidebarExample = <span class="function"><span class="params">()</span> =&gt;</span> (</span><br><span class="line">  &lt;Router&gt;</span><br><span class="line">    &lt;div style=&#123;&#123; <span class="attr">display</span>: <span class="string">'flex'</span> &#125;&#125;&gt;</span><br><span class="line">      <span class="comment">// sidebar</span></span><br><span class="line">      &lt;div style=&#123;&#123;</span><br><span class="line">        padding: <span class="string">'10px'</span>,</span><br><span class="line">        width: <span class="string">'40%'</span>,</span><br><span class="line">        background: <span class="string">'#f0f0f0'</span>,</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;ul&gt;</span><br><span class="line">          &lt;li&gt;<span class="xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">'/'</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span><span class="xml"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line">          &lt;li&gt;<span class="xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">'/bubblegum'</span>&gt;</span>Bubblegum<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span><span class="xml"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line">          &lt;li&gt;<span class="xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">'/shoelaces'</span>&gt;</span>ShoeLaces<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span><span class="xml"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line">        &lt;<span class="regexp">/ul&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">        &#123;routes.map((route, index) =&gt; (</span></span><br><span class="line"><span class="regexp">          /</span><span class="regexp">/ You can render a &lt;Router&gt; in as many places as you want in your app, it will render along with any other &lt;Router&gt;s that also match the URL.</span></span><br><span class="line"><span class="regexp">          /</span><span class="regexp">/ So a sidebar or breadcrumbs or anything else that requires you to render multiple things in multiple places at the same URL is nothing more than multiple &lt;Routes&gt;s</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">          &lt;Route</span></span><br><span class="line"><span class="regexp">            key=&#123;index&#125;</span></span><br><span class="line"><span class="regexp">            path=&#123;route.path&#125;</span></span><br><span class="line"><span class="regexp">            exact=&#123;route.exact&#125;</span></span><br><span class="line"><span class="regexp">            component=&#123;route.sidebar&#125;</span></span><br><span class="line"><span class="regexp">          /</span>&gt;</span><br><span class="line">        ))&#125;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">      /</span><span class="regexp">/ main</span></span><br><span class="line"><span class="regexp">      &lt;div style=&#123;&#123; flex: 1, padding: '30px' &#125;&#125;&gt;</span></span><br><span class="line"><span class="regexp">        &#123;routes.map((route, index) =&gt; (</span></span><br><span class="line"><span class="regexp">          /</span><span class="regexp">/ Render more &lt;Route&gt;s with the same paths as above, but different components this time.</span></span><br><span class="line"><span class="regexp">          &lt;Route</span></span><br><span class="line"><span class="regexp">            key=&#123;index&#125;</span></span><br><span class="line"><span class="regexp">            path=&#123;route.path&#125;</span></span><br><span class="line"><span class="regexp">            exact=&#123;route.exact&#125;</span></span><br><span class="line"><span class="regexp">            component=&#123;route.main&#125;</span></span><br><span class="line"><span class="regexp">          /</span>&gt;</span><br><span class="line">        ))&#125;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  &lt;<span class="regexp">/Router&gt;</span></span><br><span class="line"><span class="regexp">)</span></span><br><span class="line"><span class="regexp">export default sidebarExample</span></span><br></pre></td></tr></table></figure><h1 id="Animated-Transitions"><a href="#Animated-Transitions" class="headerlink" title="Animated Transitions"></a>Animated Transitions</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> ReactCSSTransitionGroup <span class="keyword">from</span> <span class="string">'react-addons-css-transition-group'</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  BrowserRouter <span class="keyword">as</span> Router,</span><br><span class="line">  Route,</span><br><span class="line">  Link,</span><br><span class="line">  Redirect,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'react-rotuer-dom'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// you'll need this CSS somewhere</span></span><br><span class="line"><span class="comment">// .fade-enter &#123;</span></span><br><span class="line"><span class="comment">//   opacity: 0;</span></span><br><span class="line"><span class="comment">//   z-index: 1;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// .fade-enter.face-enter-active &#123;</span></span><br><span class="line"><span class="comment">//   opacity: 1;</span></span><br><span class="line"><span class="comment">//   transition: opacity 250ms ease-in;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> AnimationExample = <span class="function"><span class="params">()</span> =&gt;</span> (</span><br><span class="line">  &lt;Router&gt;</span><br><span class="line">    &lt;Route render=&#123;(&#123; location &#125;) =&gt; (</span><br><span class="line">      &lt;div style=&#123;style.fill&#125;&gt;</span><br><span class="line">        &lt;Route exact path=<span class="string">'/'</span> render=&#123;() =&gt; (</span><br><span class="line">          &lt;Redirect to=<span class="string">'/10/20/50'</span> /&gt;</span><br><span class="line">        )&#125;/&gt;</span><br><span class="line">        &lt;ul style=&#123;style.nav&#125;&gt;</span><br><span class="line">          &lt;NavLink to=<span class="string">'/10/90/50'</span>&gt;Red&lt;<span class="regexp">/NavLink&gt;</span></span><br><span class="line"><span class="regexp">          &lt;NavLink to='/</span><span class="number">120</span>/<span class="number">100</span>/<span class="number">40</span><span class="string">'&gt;Green&lt;/NavLink&gt;</span></span><br><span class="line"><span class="string">          &lt;NavLink to='</span>/<span class="number">200</span>/<span class="number">100</span>/<span class="number">40</span><span class="string">'&gt;Blue&lt;/NavLink&gt;</span></span><br><span class="line"><span class="string">          &lt;NavLink to='</span>/<span class="number">310</span>/<span class="number">100</span>/<span class="number">50</span><span class="string">'&gt;Pink&lt;/NavLink&gt;</span></span><br><span class="line"><span class="string">        &lt;/ul&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        &lt;div style=&#123;style.content&#125;&gt;</span></span><br><span class="line"><span class="string">          &lt;ReactCSSTransitionGroup</span></span><br><span class="line"><span class="string">            transitionName='</span>fade<span class="string">'</span></span><br><span class="line"><span class="string">            transitionEnterTimeout=&#123;300&#125;</span></span><br><span class="line"><span class="string">            transitionLeaveTimeout=&#123;300&#125;</span></span><br><span class="line"><span class="string">          &gt;</span></span><br><span class="line"><span class="string">            // no different than other usage of ReactCSSTransitionGroup, just make sure to pass `location` to `Route` so it can match the old location as it animate out</span></span><br><span class="line"><span class="string">            &lt;Route</span></span><br><span class="line"><span class="string">              location=&#123;loaction&#125;</span></span><br><span class="line"><span class="string">              key=&#123;location.key&#125;</span></span><br><span class="line"><span class="string">              path="/:h/:s/:l"</span></span><br><span class="line"><span class="string">              component=&#123;HSL&#125;</span></span><br><span class="line"><span class="string">            /&gt;</span></span><br><span class="line"><span class="string">          &lt;/ReactCSSTransitionGroup&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">    )&#125;/&gt;</span></span><br><span class="line"><span class="string">  &lt;/Router&gt;</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const NavLink = (props) =&gt; (</span></span><br><span class="line"><span class="string">  &lt;li&gt;&lt;Link &#123;...props&#125; style=&#123;&#123;color: '</span>inherit<span class="string">'&#125;&#125; /&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const HSL = (&#123; match: &#123; params &#125;&#125;) =&gt; (</span></span><br><span class="line"><span class="string">  &lt;div style=&#123;&#123;</span></span><br><span class="line"><span class="string">    ...style.fill,</span></span><br><span class="line"><span class="string">    ...style.hsl,</span></span><br><span class="line"><span class="string">    background: `hsl($&#123;params.h&#125;%, $&#123;params.s&#125;%, $&#123;params.l&#125;%)`</span></span><br><span class="line"><span class="string">  &#125;&#125;&gt;</span></span><br><span class="line"><span class="string">  &lt;/div&gt;</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export default AnimationExample</span></span><br></pre></td></tr></table></figure><h1 id="Route-Config"><a href="#Route-Config" class="headerlink" title="Route Config"></a>Route Config</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  BrowserRouter <span class="keyword">as</span> Router,</span><br><span class="line">  Route,</span><br><span class="line">  Link,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Some folks find value in a centralized route config. A route config is just data. React is great at mapping data into component, and &lt;Route&gt; is a component.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// first our route component</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Main = <span class="function"><span class="params">()</span> =&gt;</span> &lt;h2&gt;Main&lt;<span class="regexp">/h2&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const Sandwiches = () =&gt; &lt;h2&gt;Sandwiches&lt;/</span>h2&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Tacos = <span class="function">(<span class="params">&#123; routes &#125;</span>) =&gt;</span> (</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;h2&gt;Tacos&lt;<span class="regexp">/h2&gt;</span></span><br><span class="line"><span class="regexp">    &lt;ul&gt;</span></span><br><span class="line"><span class="regexp">      &lt;li&gt;&lt;Link to='/</span>tacos/bus<span class="string">'&gt;Bus&lt;/Link&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">      &lt;li&gt;&lt;Link to='</span>/tacos/cart<span class="string">'&gt;Cart&lt;/Link&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">    &lt;/ul&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &#123;routes.map((route, index) =&gt; (</span></span><br><span class="line"><span class="string">      &lt;RouteWithSubRoutes key=&#123;index&#125; &#123;...route&#125;/&gt;</span></span><br><span class="line"><span class="string">    ))&#125;</span></span><br><span class="line"><span class="string">  &lt;/div&gt;</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const Bus = () =&gt; &lt;div&gt;Bus&lt;/div&gt;</span></span><br><span class="line"><span class="string">const Cart = () =&gt; &lt;div&gt;Cart&lt;/div&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// then our route config</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const routes = [</span></span><br><span class="line"><span class="string">  &#123;</span></span><br><span class="line"><span class="string">    path: '</span>/sandwiches<span class="string">',</span></span><br><span class="line"><span class="string">    component: sandwiches,</span></span><br><span class="line"><span class="string">  &#125;, &#123;</span></span><br><span class="line"><span class="string">    path: '</span>/tacos<span class="string">',</span></span><br><span class="line"><span class="string">    component: Tacos,</span></span><br><span class="line"><span class="string">    routes: [</span></span><br><span class="line"><span class="string">      &#123;</span></span><br><span class="line"><span class="string">        path: '</span>/tacos/bus<span class="string">',</span></span><br><span class="line"><span class="string">        component: Bus,</span></span><br><span class="line"><span class="string">      &#125;, &#123;</span></span><br><span class="line"><span class="string">        path: '</span>/tacos/cart<span class="string">',</span></span><br><span class="line"><span class="string">        component: Cart,</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">    ],</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// wrap &lt;Route&gt; and use this everywhere instead, then when sub routes are added to any route it'</span>ll work</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> RouteWithSubRoutes = <span class="function">(<span class="params">route</span>) =&gt;</span> (</span><br><span class="line">  &lt;Route path=&#123;route.path&#125; render=&#123;props =&gt; (</span><br><span class="line">    <span class="comment">// pass the sub-routes down to keep nesting</span></span><br><span class="line">    &lt;route.component &#123;...props&#125; routes=&#123;route.routes&#125; /&gt;</span><br><span class="line">  )&#125;/&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> RouteConfigExample = <span class="function"><span class="params">()</span> =&gt;</span> (</span><br><span class="line">  &lt;Router&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;ul&gt;</span><br><span class="line">        &lt;li&gt;<span class="xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">'/tacos'</span>&gt;</span>Tacos<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span><span class="xml"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line">        &lt;li&gt;<span class="xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">'/sandwiches'</span>&gt;</span>Sandwiches<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span><span class="xml"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line">      &lt;<span class="regexp">/ul&gt;</span></span><br><span class="line"><span class="regexp">      &#123;routes.map((route, index) =&gt; (</span></span><br><span class="line"><span class="regexp">        &lt;RouteWithSubRoutes key=&#123;index&#125; &#123;...route&#125; /</span>&gt;</span><br><span class="line">      ))&#125;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>Router&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> RouteConfigExample</span><br></pre></td></tr></table></figure><h1 id="Redux-Integration"><a href="#Redux-Integration" class="headerlink" title="Redux Integration"></a>Redux Integration</h1><p>Generally, React Router and Redux work just fine together. Occasionally though, an app have a component that doesnât update when the location changes (child route or active nav links donât update)</p><p>This happens if:</p><blockquote><p>The component is connected to redux via <code>connect()(Comp)</code> The component is <em>not</em> a âroute componentâ, meaning it is not rendered like so: <code>&lt;Route component={SomeConnectedThing}/&gt;</code></p></blockquote><p>The problem is that Redux implements <code>shouldComponentUpdate</code> and thereâs no indication that anything has changed if it isnât receiving props from the router. This is straightforward to fix. Find where you connect your component and wrap it in <code>withRouter</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; withRouter &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> withRouter(connect(mapStateToProps)(Comp))</span><br></pre></td></tr></table></figure><h1 id="Code-Splitting"><a href="#Code-Splitting" class="headerlink" title="Code Splitting"></a>Code Splitting</h1><p>One great feature of the web is that we donât have to make our visitors download the entire app before they can use it. You can think of code spliting as incrementally downloading the app. While there are other tools for the job, react-router use <code>webpack</code> and the <code>bundle loader</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> loadSomething <span class="keyword">from</span> <span class="string">'bundle-loader?lazy!./Something'</span></span><br><span class="line"></span><br><span class="line">&lt;Bundle load=&#123;loadSomething&#125;&gt;</span><br><span class="line">  &#123;(mod) =&gt; (</span><br><span class="line">    <span class="comment">// do something w/ the module</span></span><br><span class="line">  )&#125;</span><br><span class="line">&lt;<span class="regexp">/Bundle&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;Bundle load=&#123;loadSomething&#125;&gt;</span></span><br><span class="line"><span class="regexp">  &#123;</span></span><br><span class="line"><span class="regexp">    (Comp) =&gt; Comp</span></span><br><span class="line"><span class="regexp">    ? &lt;Comp/</span>&gt;</span><br><span class="line">    : <span class="xml"><span class="tag">&lt;<span class="name">Loading</span>/&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&lt;<span class="regexp">/Bundle&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">import React, &#123; Component &#125; from 'react'</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">class Bundle extends Component &#123;</span></span><br><span class="line"><span class="regexp">  state = &#123;</span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/ short for 'module' but that's a keyword in js. so 'mod'</span></span><br><span class="line"><span class="regexp">    mod: null,</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  componentWillMount () &#123;</span></span><br><span class="line"><span class="regexp">    this.load(this.props)</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  componentWillReceiveProps (nextProps) &#123;</span></span><br><span class="line"><span class="regexp">    if (nextProps.load !== this.props.load) &#123;</span></span><br><span class="line"><span class="regexp">      this.load(nextProps)</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  load (props) &#123;</span></span><br><span class="line"><span class="regexp">    this.setState(&#123;</span></span><br><span class="line"><span class="regexp">      mod: null,</span></span><br><span class="line"><span class="regexp">    &#125;)</span></span><br><span class="line"><span class="regexp">    props.load((mod) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">      this.setState(&#123;</span></span><br><span class="line"><span class="regexp">        /</span><span class="regexp">/ handle both es imports and cjs</span></span><br><span class="line"><span class="regexp">        mod: mod.default ? mod.default : mod</span></span><br><span class="line"><span class="regexp">      &#125;)</span></span><br><span class="line"><span class="regexp">    &#125;)</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  render () &#123;</span></span><br><span class="line"><span class="regexp">    return this.props.children(this.state.mod)</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Bundle</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;Bundle load=&#123;() =&gt; import('./</span>something<span class="string">')&#125;&gt;</span></span><br><span class="line"><span class="string">  &#123;(mod) =&gt; ()&#125;</span></span><br><span class="line"><span class="string">&lt;/Bundle&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> loadAbout <span class="keyword">from</span> <span class="string">'bundle-load?lazy!./loadAbout'</span></span><br><span class="line"><span class="keyword">import</span> loadDashboard <span class="keyword">from</span> <span class="string">'bundle-loader?lazy!./loadDashboard'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// components load their module for initial visit</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> About = <span class="function"><span class="params">()</span> =&gt;</span> (</span><br><span class="line">  &lt;Bundle load=&#123;loadAbout&#125;&gt;</span><br><span class="line">    &#123;(About) =&gt; <span class="xml"><span class="tag">&lt;<span class="name">About</span> /&gt;</span>&#125;</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">Bundle</span>&gt;</span></span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Dashboard = <span class="function"><span class="params">()</span> =&gt;</span> (</span><br><span class="line">  &lt;Bundle load=&#123;loadDashboard&#125;&gt;</span><br><span class="line">    &#123;(Dashboard) =&gt; <span class="xml"><span class="tag">&lt;<span class="name">Dashboard</span> /&gt;</span>&#125;</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">Bundle</span>&gt;</span></span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  componentDidMount () &#123;</span><br><span class="line">    <span class="comment">// preload the rest</span></span><br><span class="line">    loadAbout( <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125; )</span><br><span class="line">    loadDashboard( <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125; )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;h1&gt;Welcome&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">        &lt;Route path='/</span>about<span class="string">' component=&#123;About&#125; /&gt;</span></span><br><span class="line"><span class="string">        &lt;Route path='</span>/dashbaord<span class="string">' component=&#123;Dashboard&#125; /&gt;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">    )</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ReactDOM.render(&lt;App /&gt;, document.preloadTheRestOfTheApp)</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Learning D3</title>
      <link href="/2017/04/25/learning-d3/"/>
      <content type="html"><![CDATA[<h1 id="d3-array"><a href="#d3-array" class="headerlink" title="d3-array"></a>d3-array</h1><h2 id="array-methods-built-in-to-JavaScript"><a href="#array-methods-built-in-to-JavaScript" class="headerlink" title="array methods built-in to JavaScript"></a>array methods built-in to JavaScript</h2><ul><li>array.pop =&gt; popped element</li><li>array.push =&gt; array.length</li><li>array.reverse =&gt; change the array</li><li>array.shift =&gt; shifted element</li><li>array.unshift =&gt; array.length</li><li>array.sort =&gt; change the array</li><li><p>array.splice =&gt; change the array</p></li><li><p>array.concat =&gt; new Array</p></li><li><p>array.join =&gt; new String</p></li><li><p>array.slice =&gt; new Array</p></li><li><p>array.indexOf =&gt; number</p></li><li><p>array.lastIndexOf =&gt; number</p></li><li><p>array.fitler =&gt; new Array</p></li><li><p>array.forEach =&gt; undefined</p></li><li><p>array.every =&gt; boolean</p></li><li><p>array.map =&gt; new Array</p></li><li><p>array.some =&gt; boolean</p></li><li><p>array.reduce =&gt;</p></li><li>array.reduceRight =&gt;</li></ul><blockquote><p>yarn add d3-array</p></blockquote><h2 id="Statistics"><a href="#Statistics" class="headerlink" title="Statistics"></a>Statistics</h2><ul><li><p><code>d3.min(array[, accessor])</code></p><ul><li>Mininum value using natural order</li><li>Return undefined if the array is empty</li><li>An optional <em>accessor</em> function may be specified, which is equivalent to calling <em>array.map(accessor)</em> before computing the minumum value.</li></ul></li><li><p><code>d3.max(array[, accessor])</code></p><ul><li>Return maximum value</li><li>Return undefined. if the array is empty</li></ul></li><li><p><code>d3.extent(array[, accessor])</code></p><ul><li>Return <em>minumum</em> and <em>maximum</em> value in the given array.</li><li>Return <code>[undefined, undefined]</code> if the array is empty</li></ul></li><li><p><code>d3.sum(array[, accessor])</code></p><ul><li>Return the sum of the given array of numbers.</li><li>Return 0 if the array is empty.</li><li>ignores <em>undefined</em> and <em>NaN</em> values.</li></ul></li><li><p><code>d3.mean(array[, accessor])</code></p><ul><li>Return the mean of the given array of numbers.</li><li>Return undefined if the array is empty.</li><li>Ignore <em>undefined</em> and <em>NaN</em>.</li></ul></li><li><p><code>d3.median(array[, accessor])</code> -</p></li></ul><p>-</p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Node-Inspector&#39;s Crash</title>
      <link href="/2017/04/25/node-inspector-s-crash/"/>
      <content type="html"><![CDATA[<p>I had encountered a problem using <code>node-inspector</code> with info</p><blockquote><p>cb(error, NM[0].ref); Cannot read property ârefâ of undefined</p></blockquote><p>And one method to resolve it is to modify the packagge</p><blockquote><p>Same issue with node v6.5.0 can be solved like this :</p></blockquote><blockquote><p>Edit â¦\node_modules\node-inspector\lib\InjectorClient.js file at line 111 if(NM.length &gt; 0) cb(error, NM[0].ref);</p></blockquote><blockquote><p>It works</p></blockquote><p>which is hack, and another method is without side-effect</p><blockquote><p>use the local node-inspector</p></blockquote><p>hope it helps</p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Usage of Chai</title>
      <link href="/2017/04/21/Usage-of-Chai/"/>
      <content type="html"><![CDATA[<h1 id="Chains"><a href="#Chains" class="headerlink" title="Chains"></a>Chains</h1><ul><li>to</li><li>be</li><li>been</li><li>is</li><li>that</li><li>which</li><li>and</li><li>has</li><li>have</li><li>with</li><li>at</li><li>of</li><li>same</li></ul><h1 id="not"><a href="#not" class="headerlink" title="not"></a>not</h1><blockquote><p>negative any of assertions following in the Chains</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect(foo).to.not.equal(<span class="string">'bar'</span>)</span><br></pre></td></tr></table></figure><h1 id="deep"><a href="#deep" class="headerlink" title="deep"></a>deep</h1><blockquote><p>set the <code>deep</code> flag, later used by the <code>equal</code> and <code>property</code> assertions</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect(foo).to.deep.equal(&#123;<span class="attr">bar</span>: <span class="string">'bar'</span>&#125;)</span><br></pre></td></tr></table></figure><h1 id="any"><a href="#any" class="headerlink" title="any"></a>any</h1><blockquote><p>set the <code>any</code> flag, (opposite of the <code>all</code> flag), later used in the <code>keys</code> assertion</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect(foo).to.have.any.keys(<span class="string">'bar'</span>, <span class="string">'foo'</span>)</span><br></pre></td></tr></table></figure><h1 id="all"><a href="#all" class="headerlink" title="all"></a>all</h1><blockquote><p>set the <code>all</code> flag, (opposite of the <code>any</code> flag), later used by the <code>keys</code> assertions</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect(foo).to.have.all.keys(<span class="string">'bar'</span>, <span class="string">'foo'</span>)</span><br></pre></td></tr></table></figure><h1 id="a-type"><a href="#a-type" class="headerlink" title="a(type)"></a>a(type)</h1><ul><li>@param {String} type</li><li>@param {String} message [optional]</li></ul><blockquote><p>The <code>a</code> and <code>an</code> assertion are aliases that can be used either as language chains or to assert a valueâs type</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// typeof</span></span><br><span class="line">expect(<span class="string">'test'</span>).to.be.a(<span class="string">'string'</span>)</span><br><span class="line"><span class="comment">// language chain</span></span><br><span class="line">expect(foo).to.be.an.instanceof(Foo)</span><br></pre></td></tr></table></figure><h1 id="include-value"><a href="#include-value" class="headerlink" title="include(value)"></a>include(value)</h1><ul><li>@param {Object | String | Number} obj</li><li>@param {String} message [optional]</li></ul><blockquote><p>The <code>include</code> and <code>contain</code> assertion can be used as either property based language chains or methods to assert the inclusion of an object in an array or a substring in a string.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">expect([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]).to.include(<span class="number">2</span>)</span><br><span class="line">expect(<span class="string">'foobar'</span>).to.contain(<span class="string">'foo'</span>)</span><br><span class="line">expect(&#123; <span class="attr">foo</span>: <span class="string">'foo'</span>, <span class="attr">bar</span>: <span class="string">'bar'</span> &#125;).to.include.keys(<span class="string">'foo'</span>)</span><br></pre></td></tr></table></figure><h1 id="ok"><a href="#ok" class="headerlink" title="ok"></a>ok</h1><blockquote><p>Assert that the target is truthy</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">expect(<span class="string">'everything'</span>).to.be.ok</span><br><span class="line">expect(<span class="literal">undefined</span>).to.not.be.ok</span><br></pre></td></tr></table></figure><h1 id="true"><a href="#true" class="headerlink" title="true"></a>true</h1><blockquote><p>Assert that the target is <code>true</code></p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">expect(<span class="literal">true</span>).to.be.true</span><br><span class="line">expect(<span class="number">1</span>).to.be.true</span><br></pre></td></tr></table></figure><h1 id="false"><a href="#false" class="headerlink" title="false"></a>false</h1><blockquote><p>Assert that the target is <code>false</code></p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">expect(<span class="literal">false</span>).to.be.false</span><br><span class="line">expect(<span class="number">0</span>).to.be.false</span><br></pre></td></tr></table></figure><h1 id="null"><a href="#null" class="headerlink" title="null"></a>null</h1><blockquote><p>Assert that the target to be <code>null</code></p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect(<span class="literal">null</span>).to.be.null</span><br></pre></td></tr></table></figure><h1 id="undefined"><a href="#undefined" class="headerlink" title="undefined"></a>undefined</h1><blockquote><p>Assert that the target is <code>undefined</code></p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect(<span class="literal">undefined</span>).to.be.undefined</span><br></pre></td></tr></table></figure><h1 id="NaN"><a href="#NaN" class="headerlink" title="NaN"></a>NaN</h1><blockquote><p>Assert that the target is <code>NaN</code></p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect(<span class="string">'foo'</span>).to.be.NaN</span><br></pre></td></tr></table></figure><h1 id="exist"><a href="#exist" class="headerlink" title="exist"></a>exist</h1><blockquote><p>Assert that the target is neither <code>null</code> nor <code>undefined</code></p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect(<span class="string">'foo'</span>).to.be.exist</span><br></pre></td></tr></table></figure><h1 id="empty"><a href="#empty" class="headerlink" title="empty"></a>empty</h1><blockquote><p>Assert that the targetâs length is 0. For Array and String, it will check the length of propertes. For Object, it will check the length of enumerable keys</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect([]).to.be.empty</span><br></pre></td></tr></table></figure><h1 id="arguments"><a href="#arguments" class="headerlink" title="arguments"></a>arguments</h1><blockquote><p>Assert that the target is an arguments object</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  expect(<span class="built_in">arguments</span>).to.be.arguments</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="equal-value"><a href="#equal-value" class="headerlink" title="equal(value)"></a>equal(value)</h1><ul><li>@param {Mixed} value</li><li>@param {String} message [optional]</li></ul><blockquote><p>Assert that the target is strictly equal(===) to <code>value</code>. Alternately, if the <code>.deep</code> flag is set, assert that the target is deeply equal to <code>value</code></p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">expect(<span class="string">'hello'</span>).to.equal(<span class="string">'hello'</span>)</span><br><span class="line">expect(&#123;<span class="attr">foo</span>: <span class="string">'foo'</span>&#125;).to.deep.equal(&#123;<span class="attr">foo</span>: <span class="string">'foo'</span>&#125;)</span><br></pre></td></tr></table></figure><h1 id="eql-value"><a href="#eql-value" class="headerlink" title="eql(value)"></a>eql(value)</h1><ul><li>@param {Mixed} value</li><li>@param {String} message [optional]</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect(&#123;<span class="attr">foo</span>: <span class="string">'foo'</span>&#125;).to.eql(&#123;<span class="attr">foo</span>: <span class="string">'foo'</span>&#125;)</span><br></pre></td></tr></table></figure><h1 id="above-value"><a href="#above-value" class="headerlink" title="above(value)"></a>above(value)</h1><ul><li>@param {Number} value</li><li>@param {String} message [optional]</li></ul><blockquote><p>Assert that the target is greater than <code>value</code></p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect(<span class="number">10</span>).to.be.above(<span class="number">5</span>)</span><br></pre></td></tr></table></figure><blockquote><p>Can also be used in conjunction with <code>length</code> to assert a minimum length.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect(<span class="string">'foo'</span>).to.have.length.above(<span class="number">2</span>)</span><br></pre></td></tr></table></figure><h1 id="least-value"><a href="#least-value" class="headerlink" title="least(value)"></a>least(value)</h1><ul><li>@param {Number} value</li><li>@param {String} message [optional]</li></ul><blockquote><p>Assert that the target is greater than or equal to <code>value</code></p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect(<span class="number">10</span>).to.be.at.least(<span class="number">10</span>)</span><br></pre></td></tr></table></figure><blockquote><p>used for length too</p></blockquote><h1 id="below-value"><a href="#below-value" class="headerlink" title="below(value)"></a>below(value)</h1><ul><li>@param {Number} value</li><li>@param {String} message [optinal]</li></ul><blockquote><p>Assert that the target is less than <code>value</code></p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect(<span class="number">5</span>).to.be.below(<span class="number">10</span>)</span><br></pre></td></tr></table></figure><blockquote><p>used for length too</p></blockquote><h1 id="most-value"><a href="#most-value" class="headerlink" title="most(value)"></a>most(value)</h1><ul><li>@param {Number} value</li><li>@param {String} message [optinal]</li></ul><blockquote><p>Assert that the target is less than or equal to <code>value</code></p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect(<span class="number">5</span>).to.be.at.most(<span class="number">5</span>)</span><br></pre></td></tr></table></figure><blockquote><p>used for length o</p></blockquote><h1 id="within-start-finish"><a href="#within-start-finish" class="headerlink" title="within(start, finish)"></a>within(start, finish)</h1><ul><li>@param {Number} start lowerbound inclusive</li><li>@param {Number} finish upperbound inclusive</li><li>@param {String} message [optional]</li></ul><blockquote><p>Assert that the target is within a range</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect(<span class="number">28</span>).to.be.within(<span class="number">2</span>, <span class="number">30</span>)</span><br></pre></td></tr></table></figure><blockquote><p>used for length too</p></blockquote><h1 id="instanceof-constructor"><a href="#instanceof-constructor" class="headerlink" title="instanceof(constructor)"></a>instanceof(constructor)</h1><ul><li>@param {Constructor} constructor</li><li>@param {String} message [optional]</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Tea = <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> Chai = <span class="keyword">new</span> Tea(<span class="string">'chai'</span>)</span><br><span class="line"></span><br><span class="line">expect(Chai).to.be.an.instanceof(Tea)</span><br><span class="line">expect([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]).to.be.an.instanceof(<span class="built_in">Array</span>)</span><br></pre></td></tr></table></figure><h1 id="property-name-value"><a href="#property-name-value" class="headerlink" title="property(name[, value])"></a>property(name[, value])</h1><ul><li>@param {String} name</li><li>@param {Mixed} value [optional]</li><li>@param {String} message [optional]</li></ul><blockquote><p>Assert that the target has a property <code>name</code>, optionally asserting that the value of that property is strictly equal to <code>value</code>. If the <code>deep</code> flag is set, you can use dot- and bracket-notation for deep reference into objects and arrays.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">expect(obj).to.have.property(<span class="string">'foo'</span>)</span><br><span class="line">expect(obj).to.have.property(<span class="string">'foo'</span>, <span class="string">'bar'</span>)</span><br></pre></td></tr></table></figure><h2 id="to-be-continued"><a href="#to-be-continued" class="headerlink" title="to be continued"></a>to be continued</h2>]]></content>
      
      
    </entry>
    
    <entry>
      <title>AVA Usage</title>
      <link href="/2017/04/20/AVA-Usage/"/>
      <content type="html"><![CDATA[<h1 id="æµè¯è¯­æ³"><a href="#æµè¯è¯­æ³" class="headerlink" title="æµè¯è¯­æ³"></a>æµè¯è¯­æ³</h1><p><code>`</code> import test from âavaâ</p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Usage</title>
      <link href="/2017/04/20/Usage/"/>
      <content type="html"><![CDATA[]]></content>
      
      
    </entry>
    
    <entry>
      <title>ç¨ Javascript å®ç°éä¸­ç²è´´</title>
      <link href="/2017/04/17/%E7%94%A8-javascript-%E5%AE%9E%E7%8E%B0%E9%80%89%E4%B8%AD%E7%B2%98%E8%B4%B4/"/>
      <content type="html"><![CDATA[<p>ä¸ºäºå¯¹ä»åä½æè ¢çæ¯æ¥å·¥ä½æ»ç»çè¦æ±, åäºä¸ä¸ªå°èæ¬æ¥å¯¼åºä»»å¡ç®¡çå¨éçåå®¹å°åªè´´æ¿, äºæ¯æ¥è§¦äºä¸ä¸çº¯ javascript å®ç°å¤å¶å°åªè´´æ¿åè½</p><p>ä»£ç åè¡è´´åº</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="meta">    'use strict'</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">'your_url'</span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> issueList = <span class="built_in">document</span>.querySelectorAll(<span class="string">'.issue-list li'</span>);</span><br><span class="line">        <span class="keyword">var</span> taskList = [];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>, len = issueList.length; i &lt; len; i++)&#123;</span><br><span class="line">            <span class="keyword">var</span> key = issueList[i].getAttribute(<span class="string">'data-key'</span>);</span><br><span class="line">            <span class="keyword">var</span> title = issueList[i].getAttribute(<span class="string">'title'</span>);</span><br><span class="line">            <span class="keyword">var</span> task = <span class="string">'å·²å®æ: '</span>+key+<span class="string">'-'</span>+title;</span><br><span class="line">            taskList.push(task);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> text = taskList.join(<span class="string">'\n'</span>);</span><br><span class="line">        <span class="keyword">var</span> clipboard = <span class="built_in">document</span>.createElement(<span class="string">'textarea'</span>);</span><br><span class="line">        clipboard.style.width = <span class="string">'100%'</span>;</span><br><span class="line">        clipboard.style.height = <span class="string">'300px'</span>;</span><br><span class="line">        clipboard.value = text;</span><br><span class="line">        <span class="keyword">var</span> listPanel = <span class="built_in">document</span>.getElementsByClassName(<span class="string">'list-panel'</span>)[<span class="number">0</span>];</span><br><span class="line">        listPanel.appendChild(clipboard);</span><br><span class="line">        <span class="keyword">var</span> today = <span class="built_in">document</span>.createElement(<span class="string">'button'</span>);</span><br><span class="line">        today.style.width = <span class="string">'100%'</span>;</span><br><span class="line">        today.innerText = <span class="string">'Today'</span>;</span><br><span class="line">        listPanel.appendChild(today);</span><br><span class="line">        today.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="built_in">window</span>.location.href = <span class="string">'url_to_today'</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">var</span> button = <span class="built_in">document</span>.createElement(<span class="string">'button'</span>);</span><br><span class="line">        button.style.width = <span class="string">'100%'</span>;</span><br><span class="line">        button.innerText = <span class="string">'copy to clipboard'</span>;</span><br><span class="line">        listPanel.appendChild(button);</span><br><span class="line">        button.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          clipboard.select();</span><br><span class="line">          <span class="built_in">document</span>.execCommand(<span class="string">'copy'</span>);</span><br><span class="line">          clipboard.blur();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> Javascript </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Baisc Usage of Redux-Observable</title>
      <link href="/2017/03/20/baisc-usage-of-redux-observable/"/>
      <content type="html"><![CDATA[<h2 id="First-of-All"><a href="#First-of-All" class="headerlink" title="First of All"></a>First of All</h2><h3 id="createEpicMiddleware-rootEpic"><a href="#createEpicMiddleware-rootEpic" class="headerlink" title="createEpicMiddleware(rootEpic)"></a><code>createEpicMiddleware(rootEpic)</code></h3><p><code>createEpicMiddleware</code> is used to create an instance of the actual redux-observable middleware, and you should provide a single, root Epic</p><h4 id="Arguments"><a href="#Arguments" class="headerlink" title="Arguments"></a>Arguments</h4><ol><li><code>rootEpic: Epic</code>: The root Epic<p></p></li><li><code>[options: Object]</code>: The optional configuration.</li></ol><ul><li><p><code>dependencies</code>: If given, it will be injected as the 3rd argument to all Epics,</p></li><li><p><code>adapter</code>: An adapter object which can transform the input/output streams provided to your epics, Usually used to adapt a stream library other than RxJS v5, like adapter-rxjs-v4 or adapter-most Options:</p><pre><code>*   `input: ActionsObservable =&amp;gt; Any`: Transforms the input stream of actions, `ActionsObservable` that is passed to your root Epic(transformation takes place before it is passed to the root Epix)*   `output: any =&amp;gt; Observable`: Transforms the return value of root Epic(transform takes place after the root epic returned it)</code></pre></li></ul><h4 id="Returns"><a href="#Returns" class="headerlink" title="Returns"></a>Returns</h4><p></p><p><code>MiddlewareAPI</code>: An instance of the redux-observable middleware</p><h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><pre><code>import { createStore, applyMiddleware, compose } from &apos;redux&apos;import { createEpicMiddleware } from &apos;redux-observable&apos;import { rootEpic, rootRotuer } from &apos;./modules/root&apos;const epicMiddleware = createEpicMiddleware(rootEpic)export default function configureStore () {  const store = createStore(    rootRotuer,    applyMiddleware(epicMiddleware)  )  return store}`&lt;/pre&gt;### `combineEpics(...epic)``combineEpics` allows you to take multiple epics and combine them into a single one#### Arguments`...epics: Epic[]`: The epics to combine#### Return`(Epic)`: An Epic that merges the output of every Epic provided and passes along the `ActionObservable` and redux store as arguments### Example&lt;pre&gt;`import { combineEpics } from &apos;redux-observable&apos;import pingEpic from &apos;./ping&apos;import fetchUserEpic from &apos;./fetchUser&apos;export default combineEpics(  pingEpic,  fetchUser)`&lt;/pre&gt;### `EpicMiddleware`An instance of the redux-observable middlewareTo create it, pass your root Epic to `createEpicMiddleware``replaceEpic(nextEpic)`: Replaces the epic currently by the middleware, it is an advanced API. You might need this if your app implement code splitting and you want to load some of the epics dynamically or you&apos;re using hot reloading.### Create Epic&lt;pre&gt;`const pingEpic = action$ =&amp;gt; action$.ofType(&apos;PING&apos;).mapTo({type: &apos;PONG&apos;})`&lt;/pre&gt;### Cancellation&lt;pre&gt;`import { ajax } from &apos;rxjs/observable/dom/ajax&apos;const fetchUserEpic = action$ =&amp;gt; action$.ofType(&apos;FETCH_USER&apos;).mergeMap(  action =&amp;gt; ajax.getJSON(`/api/user/${action.payload}`)    .map(res =&amp;gt; fetchUserFulfilled(res))    .takeUntil(action$.ofType(&apos;FETCH_USER_CANCELLED&apos;)))`&lt;/pre&gt;### Handling Error&lt;pre&gt;`import { ajax } from &apos;rxjs/observable/dom/ajax&apos;const fetchUserEpic = action$ =&amp;gt; action.ofType(&apos;FETCH_USER&apos;).mergeMap(  action =&amp;gt; ajax.getJSON(`/api/users/${action.payload}`)  .map(res =&amp;gt; fetchUserFulfilled(res))  .catch(err =&amp;gt; Observable.of({    type: &apos;FETCH_USER_REJECTED&apos;,    payload: err.xhr.response,    error: true,  })))`&lt;/pre&gt;### dependencies Injecting&lt;pre&gt;`import { createEpicMiddleware, combineEpics } from &apos;redux-observable&apos;import { ajax } from &apos;rxjs/observable/dom/ajax&apos;import rootEpic from &apos;./somewhere&apos;const epicMiddleware = createEpicMiddleware(rootEpic, {  dependencies: { getJSON: ajax.getJSON }})const fetchUserEpic= (action$, store, { getJSON }) =&amp;gt; action$.ofType(&apos;FETCH_USER&apos;).mergeMap(  (action) =&amp;gt; getJSON(`/api/users/${action.payload}`)    .map(res =&amp;gt; ({      type: &apos;FETCH_USER_REJECTED&apos;,      payload: res    })))`&lt;/pre&gt;### Adding New Epics Asynchronously/Lazily&lt;pre&gt;`import { BehaviorSubject } from &apos;rxjs/BehaviorSubject&apos;import { combineEpics } from &apos;redux-observable&apos;const epic$ = new BehaviorSubject(combineEpics(epic1, epic2))const rootEpic = (action$, store) =&amp;gt; epic$.mergeMap(epic =&amp;gt; epic(action$, store))// sometime later ... add another Epic, keeping the state of the old ones...epic$.next(asyncEpic1)// and again later add anotherepic$.next(asyncEpic2)</code></pre>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RxJS </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Functor å½å­</title>
      <link href="/2017/02/27/functor-e5-87-bd-e5-ad-90/"/>
      <content type="html"><![CDATA[<pre><code>class Functor {  constructor (val) {    this.__val = val  }  map (fn) {    return new Functor(fn(__this.value))  }}</code></pre><p>å³å°èç´ <code>Functor@val</code> éè¿ fn æ å°ä¸ºèç´ <code>Function@fn(val)</code></p><p>Functor æ¬èº«å·æ map æ¹æ³, éè¿åç§å½æ°ä½ä¸ºè¿ç®ç¬¦, æ å°ææ°çFunctor</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> FP </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Throttle å½æ°</title>
      <link href="/2017/02/22/throttle-e5-87-bd-e6-95-b0/"/>
      <content type="html"><![CDATA[<pre><code>function throttle (fn, threshold, scope) {  threshold || threshold = 250  var last, timer  return function () {    var ctx = scope || this    var now = +new Date()    var args = arguments    if (last &amp;amp;&amp;amp; now - last - threshold &amp;lt; 0) {      // hold on it      clearTimeout(timer)      timer = setTimeout(function () {        last = now        fn.apply(ctx, args)      }, threshold)    } else {      last = now      fn.apply(ctx, args)    }  }}`&lt;/pre&gt;&lt;pre&gt;`Elm.addEventListener(&apos;click&apos;, throttle(function(event){  // ...}, 1000))</code></pre><p>åè®¾ç¬¬ä¸æ¬¡æ§è¡ throttle(fn0), fn0ä¼ç«å³æ§è¡, å¹¶è®°å½ throttle å¼å¯çæ¶é´last</p><p>ç¬¬äºæ¬¡æ§è¡, åè®¾ä¸º throttle(fn1), å¦æè·ç¦» now æªè¶åºæ¶é threshold, åå¼å¯å®æ¶å¨, threshold åæ§è¡ fn1, å¹¶è®¾ç½® last</p><p>å¦æå¨å¼å¯å®æ¶å¨å, threshold æ¶éåæ§è¡ throttle(fn2) åç¨äºæ§è¡ fn1 çå®æ¶å¨ä¼è¢«æ¸ç©º, å¼å¯ fn2 çå®æ¶å¨, å¹¶è®¾ç½® last</p><p>ç®èè¨ä¹, æ§è¡ throttle çæ¶å, å¦æä¸ä¸æ¬¡çå®æ¶å¨æªè¢«æ§è¡, åä¼è¢«æ¸é¤, å¹¶éæ°å¼å§è®¡æ¶</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Debounce å½æ°</title>
      <link href="/2017/02/22/debounce-e5-87-bd-e6-95-b0/"/>
      <content type="html"><![CDATA[<pre><code>function debounce (fn, delay) {  var timer = null  return function () {    var context = this, args = arguments    clearTimeout(timer)    timer = setTimeout(function () {      fn.apply(context, args)    }, delay)  }}`&lt;/pre&gt;Example:&lt;pre&gt;`Elm.addEventListener(&apos;click&apos;, debounce(function(event){  ...}, 250))</code></pre><p>å¯ä»¥çåº, ä¼ å¥ debounce çææå½æ°å±äº«è®¡æ¶å¨ timer, å æ­¤å¦æå¨ delay æ¶é´ååæ¬¡è°ç¨ debounce(fn), å³ä¸ä¸æ¬¡ fn ä¸ºæ§è¡èæ°ç fn ä¼ å¥æ¶, ä¸ä¸æ¬¡ç fn ç timer ä¼æ¸ç©º, å¯¹æ°ä¼ å¥ç fn è¿è¡è®¡æ¶</p><p>å¶ç»æå³æ¯,</p><p>å¨ delay æ¶éåå¤æ°æ¬¡è°ç¨ debounce ä¼å·æ°è®¡æ¶å¨</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>React-Router ä¸­ Props çä¼ é</title>
      <link href="/2017/02/07/react-router-e4-b8-ad-props-e7-9a-84-e4-bc-a0-e9-80-92/"/>
      <content type="html"><![CDATA[<p>åæ¬å</p><pre><code>{children}`&lt;/pre&gt;çå°æ¹æ¹åä¸º&lt;pre&gt;`{children &amp;amp;&amp;amp; React.cloneElement(children, {  prop, // éè¦ä¼ å¥ç props})}</code></pre><p>å³å¯</p><p><a href="https://github.com/ReactTraining/react-router/blob/master/examples/passing-props-to-children/app.js" target="_blank" rel="noopener">å®æ¹æ¡ä¾</a></p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> React-Router </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Babel-Polyfill å¥é¨</title>
      <link href="/2017/02/04/babel-polyfill-e5-85-a5-e9-97-a8/"/>
      <content type="html"><![CDATA[<pre><code>yarn add babel-polyfillimport &apos;babel-polyfill&apos;`&lt;/pre&gt;babel-polyfill æä¾äºå¨å±è®¿é® API, å¦ Promise, Set ä»¥å Map, ä½æ¯ polyfill æä¾ç api å¯è½ä¼æ±¡æå°å¨å±ä½ç¨å, ç¹å«å¨ä½ æä»£ç å¯¼æ¥ä¸ºç¬¬ä¸æ¹åºç»å¶ä»äººç¨æ¶, æèä½ æ æ³æ§å¶ä»£ç è¿è¡ç¯å¢æ¶, é½å¯è½å­å¨é®é¢`babel` æä¾äº `transform-runtime` æä»¶æ¥è§£å³æ­¤é®é¢, `transform-runtime` æä¾ä¸ä¸ªæ²çæºå¶æ¥ç»ç»å¨å±åéçæ±¡æ&gt; éè¦æ³¨æ, transform-runtime ä¾èµäº babel-runtime&lt;pre&gt;`# transform-runtime åªåºç¨äºå¼åç¯å¢yarn add --dev babel-plugin-transform-runtime # å¶ä¾èµå babel-runtime éè¦æåå°çäº§ç¯å¢yarn add babel-runtime`&lt;/pre&gt;&lt;pre&gt;`// .babelrc{  &quot;plugins&quot;: [&quot;transform-runtime&quot;]}or{  &quot;plugins&quot;: [    [&quot;transform&quot;, {      &quot;helpers&quot;: false,      &quot;polyfill&quot;: false,      &quot;regenerator&quot;: true,      &quot;moduleName&quot;: &quot;babel-runtime&quot;,      }]  ]}</code></pre>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> babel </tag>
            
            <tag> babel-polyfill </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>è§£å³ CommonsChunkPlugin ç Hash ååé®é¢</title>
      <link href="/2017/02/01/e8-a7-a3-e5-86-b3-commonschunkplugin-e7-9a-84-hash-e5-8f-98-e5-8c-96-e9-97-ae-e9-a2-98/"/>
      <content type="html"><![CDATA[<h3 id="åæ"><a href="#åæ" class="headerlink" title="åæ:"></a>åæ:</h3><blockquote><p>Manifest File<br>  But, if we change application code and run webpack again, we see that the hash for the vendor file changes. Even though we achieved separate bundles for vendor and main bundles, we see that the vendor bundle changes when the application code changes. This means that we still donât reap the benefits of browser caching because the hash for vendor file changes on every build and the browser will have to reload the file.</p><p>  The issue here is that on every build, webpack generates some webpack runtime code, which helps webpack do itâs job. When there is a single bundle, the runtime code resides in it. But when multiple bundles are generated, the runtime code is extracted into the common module, here the vendor file.</p></blockquote><p>To prevent this, we need extract out the runtime into a separate manifest file. Even though we are creating another bundle, the overhead is offset by the long term caching benefits that we obtain on the vendor file.</p><h3 id="éç¿»è¯"><a href="#éç¿»è¯" class="headerlink" title="éç¿»è¯:"></a>éç¿»è¯:</h3><p>æ¯æ¬¡æåæ¶ vendor æä»¶ç hash ä¹ä¼ååçåå å¨äº, webpack æåæ¶å¿å®ä¼äº§ç runtime code.</p><p>å½æä»¬éè¦æååº vendor.js çæ¶å, å°½ç®¡å¬å±ä»£ç æ²¡æåå, ä½æ¯ webpack ä¼çææ°ç runtime code å¹¶æ³¨å¥ vendor.js, å¯¼è´å¶ hash åå.</p><h3 id="è§£å³æ¹æ³"><a href="#è§£å³æ¹æ³" class="headerlink" title="è§£å³æ¹æ³:"></a>è§£å³æ¹æ³:</h3><p>å° vendor.js ä¸­ç runtime code åç¬æååºæ¥, è¿æ ·åªæ bundle.js å runtime code ç hash ä¼åå, vendor.js çä»£ç ä¸ä¼åå.</p><h3 id="å·ä½åæ³"><a href="#å·ä½åæ³" class="headerlink" title="å·ä½åæ³:"></a>å·ä½åæ³:</h3><pre><code>new webpack.optimize.CommonsChunkPlugin({  name: [&apos;vendor&apos;, &apos;manifest&apos;],}</code></pre><p>è¿æ ·å°±å¯ä»¥æ runtime code æåè¿ manifest.js, æ­¤åè¯¥ç±»æä½ä¸ä¼æ¹å vendor.js ç hash äº</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webpack </tag>
            
            <tag> webpack2 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Webpack 2 Config æä»¶å¥é¨</title>
      <link href="/2017/01/29/webpack-2-config-e6-96-87-e4-bb-b6-e5-85-a5-e9-97-a8/"/>
      <content type="html"><![CDATA[<p>webpack 2 config æä»¶å¥é¨</p><h3 id="webpack-config-js-çåºæ¬ç»æ"><a href="#webpack-config-js-çåºæ¬ç»æ" class="headerlink" title="webpack.config.js çåºæ¬ç»æ"></a>webpack.config.js çåºæ¬ç»æ</h3><pre><code>var path = require(&apos;path&apos;)module.exports = {  entry:  {    home: &apos;./home.js&apos;,    about: &apos;./about.js&apos;,    contact: &apos;./contact.js&apos;,  }, // å¥å£æä»¶  // string | [string] | object {&amp;lt;key&amp;gt;: string | [string] }  // ä¸ä¸ªé¡µé¢æ­éä¸ä¸ªå¥å£æä»¶  output: {    // output åå«ä¸ç³»åå³äºæååæä»¶çéç½®    // output.chunkFilename: string, è¿ä¸ªåæ°ç¡®å®äºå è½½ chunk çåç§°    // output.crossOriginLoading: boolean | string, åªå¨ target åæ°æå®ä¸º web çæ¶åä½¿ç¨, å ä¸ºæ­¤æ¶éè¿ jsonp å è½½æ¨¡å    // crossOriginLoading: false(default) , ç¦æ­¢è·¨åå è½½    // crossOriginLoading: &apos;anonymous&apos;, åè®¸æ  credential çè·¨åå è½½    // crossOriginLoading: &apos;use-credentials&apos;, åè®¸æ credential çè·¨åå è½½    //     // output.devtoolFallbackModuleFilenameTemplate: string | function(info)    // output.hotUpdateChunkFilename: string, æå®ç­å·æ°ç chunk çåç§°, ä»æ¯æ id å hash å ä½ç¬¦    // hotUpdateChunkFilename: &apos;[id].[hash].hot-update.js&apos;    // output.sourceMapFilename: string, ä»å½ devtool ä½¿ç¨ source map æ¶çæ, é»è®¤ä¸º[ file].map, å¯éå ä½ç¬¦æ[name], [id], [hash], [chunkhash]    path: path.resolve(__dirname, &apos;dist&apos;), // æååæä»¶å­å¨è·¯å¾, å¿é¡»æ¯ç»å¯¹è·¯å¾, å¯ä»¥ç¨ path æ¨¡åçæ    publicPath: /assert/, // è§£ææä»¶ä¸­ç¸å¯¹è·¯å¾æ¶ä¾èµçæ ¹ç®å½    // è¯¥å­æ®µè®¾å®äºè¾åºæä»¶ç public Url    //     // é»è®¤ç, ç¸å¯¹è·¯å¾ä¼åºäº html æä»¶ä½ç½®æ&amp;lt;base&amp;gt;æ ç­¾è¿è¡è§£æ, æ·»å  publicPath å, åä¸ª loaders ä¼å¨æ¯ä¸ªç¸å¯¹è·¯å¾åæ·»å  publicPath, å³ç¸å¯¹è·¯å¾åºäº publicPath è¿è¡è§£æ    // è¯¥å¼ä¸è¬ä»¥&apos;/&apos;ç»å°¾    // é»è®¤å¼ä¸º&apos;&apos;    // simple rule: è¯¥åæ°çå¼ä¸ºhtml é¡µé¢å° output.path çç¸å¯¹å¼    // path: path.resolve(__dirname, &apos;public/assets&apos;),    // publicPath: &apos;https://cdn.example.com/assets/&apos;,    // publicPath ä¹ä¼å¯¹ webpack-dev-server çæ    // publicPath: &apos;https://cdn.example.com/assets/&apos; cdn, å¹¶ä¸åºè¯¥ä½¿ç¨ https    // publicPath: &apos;//cdn.example.com/assets/&apos;, cdn, ä½¿ç¨ç¸ååè®®    // publicPath: &apos;/assets/&apos;, ç¸å¯¹äºæå¡å¨æ ¹è·¯å¾    // publicPath: &apos;assets/&apos;, ç¸å¯¹äº html é¡µé¢    // publicPath: &apos;../assets/&apos;, ç¸å¯¹äº html é¡µé¢    // publicPath: &apos;&apos;, ç¸å¯¹äº html é¡µé¢(åä¸è·¯å¾)    filename: &apos;bundle.js&apos;, // æååçæä»¶åç§°    // å¯¹äºåä¸å¥å£æä»¶, filename å¯ä»¥ä¸ºéæåç§°&apos;bundle.js&apos;    // å¯¹äºå¤å¥å£æä»¶, å¯ä»¥ä½¿ç¨åæ°çæç¹å®åç§°    // [name], [id], [hash], [chunkhash]    // å¯ä»¥ä¸ºæä»¶æ·»å è·¯å¾: &apos;js/[name]/bundle.js&apos;    library: &apos;MyLibrary&apos;, // è¾åºåºçåç§°    libraryTarget: &apos;umd&apos;, // è¾åºåºçç±»å  },  module: {    // module.noParse: RegExp | [RegExp], ç¬¦åæ­£åçå­æ®µè¢« import, require, define åä¸ä¼è¢«å¤ç, å¯ä»¥æé«æåéåº¦    // noParse: /jquery|lodash/    //    rules: [      // æ¨¡ååºç¨è§å(loaders, parser çè®¾å®ç­)      // module.rules: array      // ä¸æ¡ Rule å¯ä»¥åä¸ºä¸é¨å, Conditions, Results, Nested Rules      // Conditions, æä¸¤ä¸ªè¾å¥å¼,       // 1\. The resource: æä»¶å¼ç¨çç»å¯¹è·¯å¾ç»è¿ resolve è§åè§£æåçç»æ      // 2\. The issuer: å¼ç¨ resource çæ¨¡åå°æä»¶çç»å¯¹è·¯å¾      // æ¯å¦, &apos;app.js&apos; ä¸­ &apos;import ./style.css&apos;, resource æ¯ &apos;/path/to/style.css&apos;, issuer æ¯ &apos;/path/to/app.js&apos;      // å¨ rule ä¸­, test, include, exclude å resource ä½ç¨äºresource, è issuer æè°±ç¨äº issuer      // Results      // Rule Results ä»å¨ Rule Conditions æ»¡è¶³æ¶èµ·ä½ç¨      // Rule Results æäºç§è¾åºå¼      // Applied Loaders: ä¸ä¸ªæ°ç», å¶åç´ æ¯åºç¨äº resource ç loaders      // Parser options: ä¸ä¸ª options å¯¹è±¡, ä½ä¸ºå½å module ç parser      // loader, options, use ç¨äº loaders,      // query, loaders ç¨äºæé«å¼å®¹æ§      // enforce å±æ§æå® loader ç±»å, å¯éå¼æ: normal, pre, post      // parser å±æ§å½±å parser options      // Nested Rules      // å¨ rules å oneOf å±æ§ä¸­å¯ä»¥æå® nested rules      // Rule.enforce: &apos;pre&apos; | &apos;post&apos;, æå® loader çç±»å, é»è®¤ä¸º normal      // è¿æä¸ç§ inline loader åºç¨äº inline import/require,       // ææ loaders æç§ post, inline, normal, pre æåºå¹¶ä¾æ¬¡æ§è¡      // ææ normal loaders å¯ä»¥éè¿å¨ request ä¸­æ·»å åç¼ &apos;!&apos; è¿è¡å¿½ç¥      // ææ normal å pre loaders å¯ä»¥éè¿å¨ request ä¸­æ·»å åç¼ &apos;-!&apos; è¿è¡å¿½ç¥      // ææ normal, post å pre loaders å¯ä»¥éè¿å¨ request åæ·»å  &apos;!!&apos; è¿è¡å¿½ç¥      // Rule.exclude      // Rule.exclude æ¯ Rule.resource.exclude çç¼©å      //       // Rule.include      // Rule.include æ¯ Rule.resource.include çç¼©å      //      // Rule.issuer      //      // Rule.loader      // Rule.loader æ¯ Rule.use: [{loader}] çå«å      //       // Rule.loaders      // Rule.loaders æ¯ Rule.use çå«å, ä»çå­å¨ä»ä¸ºäºå¼å®¹ webpack1, åºä½¿ç¨ Rule.use      //       // Rule.oneOf      // ä¸ä¸ªæ°ç», å¶åç´ ä¸ºä¸ç³»å rules, ä»ç¬¬ä¸ä¸ªç¬¦åæ¡ä»¶ç rule ä¼èµ·ä½ç¨      //       // Rule.options/ Rule.query      // Rule.options å Rule.query é½æ¯ Rule.use: [{options}] çç¼©å      // Rule.query çå­å¨ä»ä¸ºäºå¼å®¹ webpack1, åºä½¿ç¨ Rule.options      //       // Rule.parser      // ä¸ä¸ª parser options çå¯¹è±¡, ææè¦ä½¿ç¨ç parser options é½éä¸­å¨æ­¤      // æ¯ä¸ªä¸åç parser options é½ä¼åå»ºå¯¹åº parser, å¹¶ä¸ plugins å¯ä»¥æ ¹æ® parser options åºç¨.  å½ parser options ä¸­æ²¡æè®¾ç½®æè®¾ç½®ä¸º true æ¶, å¤§é¨å plugins é»è®¤åªåºç¨ä»ä»¬èªå·±ç parser plugins      // parser: {      // amd: false, // disable AMD      // commonjs: false, // disable CommonJS      // harmony: false, // disable ES6 Harmony import/exports      // requireInclude: false, // disable require.include      // requreEnsure: false, // disable require.ensure      // }      // Rule.resource      // Rule.rules, ä¸ä¸ª Rules ç»æ çæ°ç»      // Rule.test, Rule.resource.test çç¼©å      // Rule.use, ä¸ç³»ååºç¨äº modules ç UseEntries, æ¯ä¸ä¸ª entry æå®ä¸ä¸ª loader      // use: [&apos;style-loader&apos;] æ¯ use: [{loader: &apos;style-loader&apos;}] çç¼©å      // å¯ä»¥é¾å¼ä¼ å¥å¤ä¸ª loaders, ä»å³åå·¦ä¾æ¬¡æ§è¡      // use: [      //   {loader: &apos;style-loader&apos;},      //   {loader: &apos;css-loader&apos;, options: { importLoader: 1}},      //   {loader: &apos;less-loader&apos;, options: { noIeCompat: true}},      // ]      // Condition      // Condition å¯ä»¥ä¸ºä»¥ä¸ä¹ä¸:      // String: æ¯å¦ exclude: &apos;node_modules&apos;      // RegExp: æ¯å¦ test: /\.js$/, exclude: /node_modules/      // function: è¿å true æ false      // Condition Array: è³å°æä¸ä¸ªæ»¡è¶³æ¶å»è®¤ä¸ºæ»¡è¶³ condition      // Object: ææå±æ§é½æ»¡è¶³æ¶å¯è®¤ä¸ºæ»¡è¶³      //       // {test: Condition}, {include: Condition}, {exclude: Condition}, {and: [Condition]}, {or: [Condition]}, {not: Condition}      //       // UseEntry: object      // è¯¥å±æ§å¿é¡»æä¸ä¸ªå­ç¬¦ä¸² loader.      // è¯¥å±æ§ç¸å¯¹ context çå¼è§£æ loader      // è¯¥å±æ§æ¥æ options å±æ§, è¯¥å±æ§ä¸º string æ object, è¯¥å±æ§ä¼ä½ä¸º loader options è¢«ä¼ ç» loader      // èèå°å¼å®¹æ§, ç®åä»æ¯æ query ä½ä¸º options çå«å      //       {        test: /\.jsx?$/, // éè¿æ­£åè¡¨è¾¾å¼éæ©è¦å¤ççæä»¶        include: [ // éå®æä»¶èå´          path.resolve(__dirname, &apos;app&apos;)        ],        exclude: [ // æé¤æä»¶èå´          path.resolve(__dirname, &apos;demo&apos;)        ]        // æä½³å®è·µ        // test ä¸­ä½¿ç¨æ­£åè¡¨è¾¾å¼        // include å exclude ä¸­ä½¿ç¨ç»å¯¹è·¯å¾        // ä¼åä½¿ç¨ include èä¸æ¯ exclude        issuer: { test, include, exclude },        // issuer çåºç¨èå´        enforce: &apos;pre&apos;,        enforce: &apos;post&apos;,        loader: &apos;babel-loader&apos;,        // ä½¿ç¨ babel-loader å¤çç¬¦åæ¡ä»¶çæä»¶        // webpack2 ä¸­ -loader ä¸åå¯ä»¥çç¥        options: {          presets: [&apos;es2015&apos;]        }        // babel-loader çéç½®      },      {        test: /\.html$/,        use: [          // åºç¨å¤ä¸ª loader åç¸å³éç½®          &apos;htmllint-loader&apos;,          {            loader: &apos;html-loader&apos;,            options: {              // ...            }          }        ]      },      {         oneOf: [ /* rules */ ],         // ä»åºç¨ rules æ°ç»ä¸­çä¸æ¡è§å      },      {        rules: [ /* rules */ ],        // åºç¨ææ rules      },      {        resource: { and: [ /* conditions */ ]}        // å½ææ conditions é½æ»¡è¶³æ¶æè®¤ä¸ºç¬¦åæ¡ä»¶      },      { resource: { or: [ /* conditions */ ]}, },      { resource: [ /* conditions */] },      // å½æä¸ condition æ»¡è¶³æ¶å³å¯è®¤ä¸ºç¬¦åæ¡ä»¶      {        resource: { not: /* condition */ }        // å½æä¸ condition ä¸æ»¡è¶³æ¶å¯è®¤ä¸ºç¬¦åæ¡ä»¶      }    ],    // rules ç»æ  },  resolve: {    // è§£ææ¨¡å request æ¶çéç½®    // (ä¸ä¼åºç¨äºè§£æ loader )    modules: [      &apos;node_modules&apos;,      path.resolve(__dirname, &apos;app&apos;)    ],    // è§£æ modules æ¶çè·¯å¾    extensions: [&apos;.js&apos;, &apos;.json&apos;, &apos;.jsx&apos;, &apos;.css&apos;],    // å¯ä»¥çç¥çæ©å±å    alias: {      // æ¨¡åå«å      // ä¸º import æ require åå»ºå«å      // Utilities: path.resolve(__dirname, &apos;src/utilities&apos;)      // import Utility from &apos;../../utilities/utility&apos; å¯ä»¥ç¼©åä¸º       // import Utility from &apos;Utilities/utility&apos;      // æ«å°¾æ·»å $å¯ä»¥è¿è¡ç²¾ç¡®å¹é, ç±»ä¼¼æ­£å      //       &apos;module&apos;: &apos;new-module&apos;,      // å«å module å¯ä»¥è¡¨ç¤º new-module, åæ¬æä»¶ä¸è·¯å¾, æ¯å¦ module/path/file ä¼è¢«è§£æä¸º new-module/path/file      &apos;only-module$&apos;: &apos;new-module&apos;,      // å«å only-module(å¤äºå°¾é¨) ä¼è¢«è§£ææ new-module, å æ­¤ module/path/file ä¸ä¼è¢«è§£æ    },    // aliasFields: string    // æå®ä¸ä¸ª field, æ¯å¦ browser, æ¥æ§è¡ç¹å®ç alias    // aliasFields: [&apos;browser&apos;]    //     // resolve.descriptionFiles: array    // ç¨äºæè¿°ç JSON æä»¶, é»è®¤ä¸º    // descriptionFiles: [&apos;package.json&apos;]    //     // resolve.enforceExtension: boolean    // å¦æä¸º true, webpack ä¸ä¼å¤çæ²¡ææ©å±åçæä»¶, é»è®¤ä¸º false, ååè®¸ require(&apos;./foo&apos;) è¿ç§åæ³    //    //resolve.enforceModuleExtension: boolean    //é»è®¤ä¸º false, æ¯å¦åè®¸ modules(loaders) çç¥æ©å±å    //    //resolve.extensions: array, èªå¨è§£ææå®çæ©å±å    //é»è®¤ä¸º    // extensions: [&apos;.js&apos;, &apos;.json&apos;]    // å æ­¤å¯ä»¥ä½¿ç¨ import File from (&apos;../path/to/file&apos;) è¿ç§åæ³    //     // resolve.mainFields: array    // å½ import ä¸ä¸ªåæ¶, æ¯å¦ import * as D3 from &apos;d3&apos;, è¿ä¸ªè®¾ç½®å³å®package.jsonä¸­çåªä¸ª field å¯¹åºçåçä¼è¢«æ£ç´¢, é»è®¤å¼åºäº target çå¼    // å½ target æå®ä¸º webworker, web æä¸æå®    // mainFields: [&apos;browser&apos;, &apos;module&apos;, &apos;main&apos;]    // å¯¹äºå¶ä» target,     // mainFields [&apos;module&apos;, &apos;main&apos;]    // ä¾å¦, D3ç package åæ¬è¿äº fields    // {    // ...    // main: &apos;build/d3.Node.js&apos;,    // browser: &apos;build/d3.js&apos;,    // module: &apos;index&apos;    // ...    // }    //     // resolve.mainFiles: array    // è¿éç filename ä¼å¨è§£æè·¯å¾çæ¶åç¨å°, é»è®¤ä¸º    // mainFiles: [&apos;index&apos;]    //     // resolve.modules: array    // éå® webpack æç´¢ä¸è§£æçèå´    // å¯ä»¥ä½¿ç¨ç»å¯¹è·¯å¾å¶ç¸å¯¹è·¯å¾, ä½æ¯ä»ä»¬çè¡ä¸ºæå°è®¸ä¸å.    // ç¸å¯¹è·¯å¾çæ£ç´¢æ¹å¼ä¸ Node æ£ç´¢ module ç¸è¿, é¦åæ£ç´¢å½åè·¯å¾åç¶è·¯å¾    // ç»å¯¹è·¯å¾ååªä¼æ£ç´¢ç»å®è·¯å¾    // é»è®¤å¼ä¸º modules: [&apos;node_modules&apos;]    //    // å¦æè¦æ·»å è·¯å¾, åºå½æ·»å å¨ node_modules åé¢    // modules: [path.resolve(__dirname, &apos;src&apos;), &apos;node_modules&apos;]    //     // resolve.unsafeCache: regex | array | boolean    // é»è®¤ä¸º true, å³åè®¸æ¨¡åç¼å­, å³ä½¿è¿ç§è¡ä¸ºæ¯ä¸å®å¨ç    //   },  performance: {    // æ­¤éç½®å³å® webpack çéç¥åè½    // ä¸»è¦ç¨äºå¯¹æä»¶å°ºå¯¸çæ§å¶    hints: &apos;warning&apos;, // enum    // hints: boolean | &apos;error&apos; | &apos;warning&apos;    // è®¾å® webpack ä½æ¶æ¾ç¤ºéç¥    // é»è®¤ä¸º warning    maxAssetSize: 200000, // int (in bytes)    // maxAssetSize: int, è¿ä¸ªéé¡¹éå¶äºåä¸ª asset çå°ºå¯¸, é»è®¤ä¸º250000    maxEntrypointSize: 400000, // int (in bytes)    // maxEntrypointSize: int, éå¶åå§å è½½æ¶åä¸ª entry çæå¤§è¯·æ±æ°, é»è®¤ä¸º250000    assetFilter: function (assetFilename) {      return assetFilename.endsWith(&apos;.css&apos;) || assetFilename.endsWith(&apos;.js&apos;)    }    // assetFilter: function, è¿ä¸ªå±æ§åè®¸ webpack æ§å¶ä½¿ç¨åªäºæä»¶æ¥è®¡ç® performance hint, é»è®¤ä¸º    // function (assertFilename) {    //   return !(/\.map$/.test(assetFilename))    // }    //    // å¯ä»¥èªå·±è®¾å® filter function    // assetFilter: function(assetFilename) {    //   return assetFilename.endsWith(&apos;.js&apos;)    // }  },  devtool: &apos;source-map&apos;, // enum, string | false  // å¯ä»¥æé« debug çä¾¿å©æ§, ä½æ¯ä¼å½±åæåéåº¦  // é¢åå¼åæ: eval, inline-source-map, eval-source-map, cheap-module-eval-source-map  // é¢åçäº§æ: source-map, hidden-source-map, cheap-source-map, nosources-source-map  context: __dirname, // ä½¿ç¨ç»å¯¹è·¯å¾  // webpack çæ ¹è·¯å¾, loaders çéç½®æä»¶(.babelrc, postcss.config.js)å entry é½æ¯åºäº context æ¥è§£æç  // è¯¥å±æ§å¼é»è®¤ä¸ºå½åç®å½, ä½æ¯å¼ºçå»ºè®®ä¹¦åè¿ä¸å­æ®µ, å¯ä»¥ä½¿ä½ çéç½®æä»¶ç¬ç«äºå½åå·¥ä½ç®å½  target: &apos;web&apos;, // enum  // æåæä»¶è¿è¡ç¯å¢  // webpack å¯ä»¥éå¯¹å¤ä¸ª environment æ target ç¼è¯  // target: string, (async-node|electron|electron-renderer|node|node-webkit|web|webworker)  externals: [&apos;react&apos;, /^@angular\//],  // ä¸å¿æåçåå®¹  // externals: string| RegExp | function | array | object  // ä¾å¦è¦ä½¿ç¨ jquery ç cdn, åå¯ä»¥è¿æ ·éç½®  // externals: {  //   jquery: &apos;jQuery&apos;  // }  // import $ from &apos;jquery&apos;  //   // externals: {  //   substract: [&apos;./math&apos;, &apos;substract&apos;]  // }  // ä¼å½¢æä¸ä¸ªè´è´£ç»æ, ./math æ¯ç¶æ¨¡å, èä½ ç bundle ä»è¯·æ±å¶å­æ¨¡å substract  //   // externals: {  //   react: &apos;react&apos;,  //   lodash: {  //     commonjs: &apos;lodash&apos;,  //     amd: &apos;lodash&apos;,  //     root: &apos;_&apos;  //   }  // }  //   watch: boolean  // webpack å¯ä»¥çæ§æä»¶å¹¶å¨ä»ä»¬ååæ¶è¿è¡éæ°ç¼è¯  // é»è®¤ä¸º false  watchOptions: object,   // éç½® watch çæ¨¡å¼  // {  //   aggregateTimeout: number, ä»ç¬¬ä¸æ¬¡æ£æµå°æä»¶ååå°è¿è¡éæ°ç¼è¯çå»¶è¿æ¶é´, è¿ä¸ªæ®µæ¶é´åçå¶ä»ååä¼è¢«æ´åè¿æ­¤æ¬¡ç¼è¯  //   ignored: string | RegExp, å¿½è§æäºæä»¶çåå, åè½» CPU è´æ  //   poll: boolean | number, æ¯é1000ms è¿è¡ä¸æ¬¡æ£æµ  // }  stats: {    // å¾è¡¥å  },  devServer: {    // è¿ä¸é¨åçè®¾ç½®ä¼è¢« webpack-dev-server éç¨    contentBase: path.resolve(__dirname, &apos;dist&apos;), // æå® serve ç®å½ä¸º dist    compress: true, // å¼å¯ gzip åç¼©    port: 9000, // æå®ç«¯å£    // å½ devServer å¯å¨æ¶, æ§å¶å°ä¼æå°    // http://localhost:9000    // webpack result is served from /build/    // content is served from dist/    // è¿å è¡æåºäº server çä½ç½®å served åå®¹    // å¦æä½ ä½¿ç¨äº Node.js API, é£ä¹è¿é¨åä¼è¢«å¿½ç¥    //     // devServer.filename: string, è¿ä¸ªéé¡¹å¯ä»¥åå° lazy mode ä¸çç¼è¯æ¬¡æ°    // é»è®¤ç, å¨ lazy mode ä¸, æ¯ä¸ä¸ªè¯·æ±ä¼è¿è¡ä¸æ¬¡æ°çç¼è¯     // æ·»å  filename å, devServer ä»å¨è¯·æ± filename æ¶è¿è¡ç¼è¯, æ¯å¦    // lazy: true,    // filename: bundle.js    // æ­¤æ¶, devServer ä»å¨è¯·æ±/ bundle.js æ¶è¿è¡ç¼è¯    // filename ä»å¨ lazy mode ä¸­èµ·ä½ç¨    // devServer.headers: object, å¨ææ request ä¸­æ·»å è¯·æ±å¤´    // headers: {    //   &apos;X-Custom-Foo&apos;: &apos;bar&apos;    // }    //     // devServer.historyApiFallback: boolean, object    // å½ä½¿ç¨ Html5 History Api æ¶, index.html å¯è½å¾å°404ååº    //     // devServer.hot: boolean, å¼å¯ webpack æ¨¡åç­æ¿æ¢    //     // devServer.host - CLI only    // æå® host    //     // devServer.https: boolean | object, devServer é»è®¤false, å³ä½¿ç¨ http    //     // devServer.inline - CLI only    // åæ¢ devServer çæ¨¡å¼, é»è®¤ä½¿ç¨ inline æ¨¡å¼, å³èæ¬ä¼ç´æ¥æ³¨å¥å°ä½ ç bundle ä»¥å®ç°éè½½, è®¾ç½® devServer.inline: false å¯ä»¥å¯ç¨ iframe æ¨¡å¼    //     //   },  plugins: [    // å¾è¡¥å  ]}</code></pre>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webpack </tag>
            
            <tag> webpack2 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Webpack 2 èµ·æ­¥</title>
      <link href="/2017/01/29/webpack-2-e8-b5-b7-e6-ad-a5/"/>
      <content type="html"><![CDATA[<p>è½ç¶å webpack1 ä¸æ ·, è¿æ¯è¿ä¸é</p><h3 id="åå»ºä¸ä¸ª-bundle"><a href="#åå»ºä¸ä¸ª-bundle" class="headerlink" title="åå»ºä¸ä¸ª bundle"></a>åå»ºä¸ä¸ª bundle</h3><pre><code>mkdir webpack-demo &amp;amp;&amp;amp; webpack-demonpm init -yyarn add --dev webpack@betayarn add lodash`&lt;/pre&gt;#### åå»º app/index.js&lt;pre&gt;`// app/index.jsimport _ from &apos;lodash&apos;function component () {  let element = document.createElement(&apos;div&apos;);// use lodash  element.innerHtml = _.join([&apos;Hello&apos;, &apos;webpack&apos;], &apos; &apos;)  return element}document.body.appendChild(component())`&lt;/pre&gt;#### åå»º index.html&lt;pre&gt;`&amp;lt;html&amp;gt;  &amp;lt;head&amp;gt;    &amp;lt;title&amp;gt;webpack 2 demo&amp;lt;/title&amp;gt;  &amp;lt;/head&amp;gt;  &amp;lt;body&amp;gt;    &amp;lt;script src=&quot;public/bundle.js&quot;&amp;gt;&amp;gt;/script&amp;gt;  &amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;`&lt;/pre&gt;#### åå»ºæååæä»¶&lt;pre&gt;`./node_modules/.bin/webpack app/index.js public/bundle.js`&lt;/pre&gt;webpack ä¼èªå¨å¤çåçä¾èµå³ç³»### æ·»å éç½®æä»¶&lt;pre&gt;`var path = require(&apos;path&apos;)module.exports = {  entry: &apos;./app/index.js&apos;,  output: {    path: path.resolve(__dirname, &apos;public&apos;),    filename: &apos;bundle.js&apos;  }}`&lt;/pre&gt;éè¿ webpack å½ä»¤è¡è¿è¡æå&lt;pre&gt;`webpack --config webpack.config.js`&lt;/pre&gt;`webpack` ä¼é»è®¤æ§è¡åä¸º `webpack.config.js` çéç½®æä»¶, å æ­¤ä»è¾å¥`webpack` å³å¯è¿è¡æå### éè¿ yarn æ§è¡æåå¨ `yarn init` çæç `package.json` ä¸­æ·»å &lt;pre&gt;`{  ...  &quot;scripts&quot;: {    &quot;build&quot;: &quot;webpack&quot;  }  ...}</code></pre><p>å³å¯å°<code>webpack</code>æä»¤æ·»å è¿ yarn çå¿«æ·æ¹å¼, æ­¤æ¶æ§è¡ <code>yarn build</code> å³å¯æå</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webpack </tag>
            
            <tag> webpack2 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Stacking Context æå åç¹æ§</title>
      <link href="/2017/01/18/stacking-context-e6-88-90-e5-9b-a0-e5-8f-8a-e7-89-b9-e6-80-a7/"/>
      <content type="html"><![CDATA[<h3 id="ä¼å½¢æStacking-Context-çåç´ "><a href="#ä¼å½¢æStacking-Context-çåç´ " class="headerlink" title="ä¼å½¢æStacking Context çåç´ "></a>ä¼å½¢æStacking Context çåç´ </h3><ul><li>root åç´ ( html )<p></p></li><li><p>position ä¸æ¯ static ä¸ z-index ä¸æ¯ auto çåç´ </p></li><li><p>flex item ä¸ z-index ä¸æ¯ auto çåç´ </p></li><li><p>opacity å°äº 1 çåç´ </p></li><li><p>transform ä¸æ¯ none çåç´ </p></li><li><p>mix-blend-mode ä¸æ¯ normal çåç´ </p></li><li><p>filter ä¸æ¯ none çåç´ </p></li><li><p>isolation ä¸º isolate çåç´ </p></li><li><p>mobile webkit å chrome 22+ ä¸ç fixed åç´ </p></li><li><p>å¨ will-change å±æ§ä¸æå®å¼ä¸ºä¸è¿°ä»»æå±æ§çåç´ </p></li><li><p>æå® -webkit-overflow-scrolling ä¸º touch çåç´ </p></li></ul><h3 id="Stacking-Context-çç¹æ§"><a href="#Stacking-Context-çç¹æ§" class="headerlink" title="Stacking Context çç¹æ§"></a>Stacking Context çç¹æ§</h3><ul><li><p>stacking context å¯ä»¥åµå¥</p></li><li><p>æ¯ä¸ª Stacking context ç¸å¯¹äºåå¼åç´ é½æ¯å®å¨ç¬ç«ç, å¶åé¨è§åä¸ä¼å½±åå°å¤é¨</p></li><li><p>æ¯ä¸ª stacking context åç´ é½ä¼è¢«ç¶çº§ stacking context è§ä¸ºä¸ä¸ª stacking è§å</p></li></ul><p></p><p>ä¸ºå·²ç»å®ä½çåç´ ( absolute æ relative) æå® z-index å¯ä»¥æ¹åå¶ parent stacking context ä¸­ z çåç§»é</p><p>ä¸ä¸ªå¼å¾æ³¨æçå: å¦æä¸ä¸ªåç´ ä¸æ¯éè¿absolute æ relative å®ç° stacking context, é£ä¹ä»ç z-index ä¸º 0 , ä»é«äº auto, ä¸æ æ³æ¹å.</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Web åæ æ´ç</title>
      <link href="/2016/12/08/web-e5-9d-90-e6-a0-87-e6-95-b4-e7-90-86/"/>
      <content type="html"><![CDATA[<h3 id="åæ åç±»"><a href="#åæ åç±»" class="headerlink" title="åæ åç±»"></a>åæ åç±»</h3><ol><li>ææ¡£åæ <p></p></li><li>çªå£åæ </li></ol><h3 id="scroll"><a href="#scroll" class="headerlink" title="scroll"></a>scroll</h3><p>Element.scrollTop: è®¾ç½®æè·å¾ä¸ä¸ªåç´ è·ç¦»ä»å®¹å¨é¡¶é¨çåç´ è·ç¦», å½ä¸ä¸ªåç´ çå®¹å¨æ²¡æäº§çåç´æ¹åçæ»å¨æ¡, åä»ç scrollTop çå¼é»è®¤ä¸º0</p><p>è·å¾æ»å¨è·ç¦»<br>var intElementScrollTop = someElement.scrollTop;</p><p>scrollTopå¯ä»¥è¢«è®¾ç½®ä¸ºä»»ä½æ´æ°, ä½æ¯ä¸ä¸æåµä¼æ¥é:<br>1. å¦æä¸ä¸ªåç´ ä¸è½è¢«æ»å¨(æ²¡ææº¢åºå®¹å¨ææ¬èº«ä¸å¯æ»å¨)çæ¶åè®¾ç½®å¶ scrollTop ä¸º 0;</p><ol><li><p>è®¾ç½® scrollTop çå¼å°äº 0, scrollTop è¢«è®¾ä¸º 0</p></li><li><p>å¦æè®¾ç½®äºè¶åºè¿ä¸ªå®¹å¨å¯ä»¥æ»å¨çå¼, scrollTop ä¼è¢«è®¾ä¸ºæå¤§å¼</p></li></ol><blockquote><p></p><p>å¶å®å°±æ¯æº¢åºè·ç¦»</p></blockquote><p><img src="https://developer.mozilla.org/@api/deki/files/842/=ScrollTop.png" alt=""></p><p>Element.scrollHeight: è®¡éåç´ åå®¹é«åº¦çåªè¯»å±æ§, åæ¬ overflow æ ·å¼å±æ§å¯¼è´çè§å¾ä¸­ä¸å¯è§åå®¹</p><p>æ²¡æåç´æ»å¨æ¡çæåµä¸, scrollHeight å¼ä¸åç´ è§å¾å¡«åææåå®¹æéè¦çæå°å¼ clientHeight ç¸å, åæ¬åç´ ç padding, ä½ä¸åæ¬ margin</p><blockquote><p>å¶å®å°±æ¯æº¢åºåç´ çæ¬èº«é«åº¦</p></blockquote><p>!()[<a href="https://developer.mozilla.org/@api/deki/files/840/=ScrollHeight.png]" target="_blank" rel="noopener">https://developer.mozilla.org/@api/deki/files/840/=ScrollHeight.png]</a></p><h4 id="å¤æ­åç´ æ¯å¦æ»å¨å°åºé¨"><a href="#å¤æ­åç´ æ¯å¦æ»å¨å°åºé¨" class="headerlink" title="å¤æ­åç´ æ¯å¦æ»å¨å°åºé¨"></a>å¤æ­åç´ æ¯å¦æ»å¨å°åºé¨</h4><p><code>element.scrollHeight - element.scrollTop === element.clientHeight</code></p><h3 id="clientTop"><a href="#clientTop" class="headerlink" title="clientTop"></a>clientTop</h3><p>Element.clientTop: ä¸ä¸ªåç´ é¡¶é¨è¾¹æ¡çå®½åº¦, ä¸åæ¬é¡¶é¨å¤è¾¹è·æåè¾¹è·, åªè¯»å±æ§</p><p>clientHeight å¯ä»¥éè¿ CSS height + CSS padding - æ°´å¹³æ»å¨æ¡é«åº¦ æ¥è®¡ç®</p><blockquote><p>å¶å®å°±æ¯å¯è§åºåé«åº¦</p></blockquote><p>mouseEvent.clientX: åªè¯»å±æ§, äºä»¶åçæ¶åºç¨å®¢æ·ç«¯åºåçæ°´å¹³åæ , ä¸é¡µé¢æ å³</p><p>mouseEvent.x æ¯ mouseEvent.clientX çå«å</p><h3 id="window"><a href="#window" class="headerlink" title="window"></a>window</h3><p>window.innerHeight: æµè§å¨çªå£çè§å£( viewport ) é«åº¦, å¦æå­å¨æ»å¨æ¡, åè¦åæ¬å¨å, åªè¯»å±æ§</p><p>window.outerHeight: æ´ä¸ªæµè§å¨çªå£çé«åº¦</p><p><img src="https://developer.mozilla.org/@api/deki/files/213/=FirefoxInnerVsOuterHeight2.png" alt=""></p><h3 id="offset"><a href="#offset" class="headerlink" title="offset"></a>offset</h3><p>mouseEvent.offsetX: read-only property provides the offset in the X coordinate of the mouse pointer between that event and the padding edge of the target node</p><h3 id="page"><a href="#page" class="headerlink" title="page"></a>page</h3><p>event.PageX: read-only property returns the horizontal coordinate of the event relative to the whole document</p><blockquote><p>ææ¡£åæ </p></blockquote><h3 id="screen"><a href="#screen" class="headerlink" title="screen"></a>screen</h3><p>mouseEvent.screenX: read-only property provides the horizontal coordinate of the mouse pointer in the global(screen) coordinate.</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS3 </tag>
            
            <tag> Javascript </tag>
            
            <tag> HTML5 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Simple CheetSheet of Flex</title>
      <link href="/2016/12/07/simple-cheetsheet-of-flex/"/>
      <content type="html"><![CDATA[<h3 id="Flex"><a href="#Flex" class="headerlink" title="Flex"></a>Flex</h3><h5 id="Parent"><a href="#Parent" class="headerlink" title="Parent"></a>Parent</h5><ol><li>display: flex<p></p></li><li><p>flex-direction: row | row-reverse | column | column-reverse</p></li><li><p>flex-wrap: nowrap | wrap | wrap-reverse</p></li><li><p>flex-flow: &lt;flex-direction&gt; || &lt;flex-wrap&gt;</p></li><li><p>justify-content: flex-start | flex-end | center | space-between | space-around</p></li><li><p>align-items: flex-start | flex-end | center | stretch | baseline (single row)</p></li><li><p>align-content: flex-start | flex-end | center | stretch | space-between | space-around (multi-row)</p></li></ol><h5 id="Children-flex-item"><a href="#Children-flex-item" class="headerlink" title="Children(flex-item)"></a>Children(flex-item)</h5><ol><li><p>order: &lt;integer&gt;</p></li><li><p>flex-grow: &lt;number&gt;(0 default)</p></li><li><p>flex-shrink: &lt;number&gt;(0 default)</p></li><li><p>flex-basis: &lt;length&gt; | auto (auto default)</p></li></ol><p><img src="http://cdn2.w3cplus.com/cdn/farfuture/PKTu2Zlf4mWNkTFEVF0N7Qn1WFDXbKwRVp0Fv5w5jjI/mtime:1431011912/sites/default/files/blogs/2015/1505/rel-vs-abs-flex.svg" alt=""></p><ol><li><p>flex: none || &lt;flex-grow&gt;&lt;flex-shrink&gt;&lt;flex-basis&gt;</p></li><li><p>align-self: auto | flex-start | flex-end | center | stretch | baseline</p></li></ol><p></p><p><strong>notice:</strong> <code>float</code>, <code>clear</code>, <code>vertical-align</code> are unavailable in flex item</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS3 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Usage of Redux-Action</title>
      <link href="/2016/11/06/usage-of-redux-action-2/"/>
      <content type="html"><![CDATA[<h3 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h3><p><code>createAction(type, payloadCreator = Identity, ?metaCreator)</code></p><pre><code>import { createAction } from &apos;redux-action&apos;`&lt;/pre&gt;Wraps an action creator so that its return value is the payload of a Flux Standard Action. If no payload creator is passed, or if it&apos;s not a function, the identity function is used.### Example&lt;pre&gt;`let increment = createAction(&apos;INCREMENT&apos;, amount =&amp;gt; amount);// same as increment = createAction(&apos;INCREMENT&apos;);expect(increment(42)).to.deep.equal({  type:&apos;INCREMENT&apos;,  payload: 42,});`&lt;/pre&gt;If the payload is an instance of an Error Object, redux-actions will automatically set `action.error` to true.### Example&lt;pre&gt;`const increment = createAction(&apos;INCREMENT&apos;);const error = new TypeError(&apos;not a number&apos;);expect(increment(error)).to.deep.equal({  type: &apos;INCREMENT&apos;,  payload: error,  error: true,})`&lt;/pre&gt;`createAction` also return its `type` when used as type in `handleAction` or `handleActions`### Example&lt;pre&gt;`const increment = createAction(&apos;INCREMENT&apos;)// as parameter in handleAction:handleAction(increment, {  next(state, action){...},  throw(state, action) {...},});const reducer = handleActions({  [increment]: (state, action) =&amp;gt; ({    counter: state.counter + action.payload  })})`&lt;/pre&gt;### createActions(?actionsMap, ?...identityActions)&lt;pre&gt;`import { createActions } from from &apos;redux-actions&apos;`&lt;/pre&gt;Returns an object mapping action types to action creator. The keys of this object are camel-cased from the keys in `actionsMap` and the string literals of `identityActions` the values are the action creators.### combineActions(...actionTypes)Combine any number of action types or action creators, `actionTypes` is a list of positional arguments which can be action type strings, symbols, or action creators.This allows you to reduce multiple distinct actions with the same reducers.&lt;pre&gt;`const { increment, decrement } = createActions({  INCREMENT: amount =&amp;gt; ({amount}),  DECREMENT: amount =&amp;gt; ({amount: -amount}),}) const reducer = handleAction(combineActions(increment, decrement), {  next: (state, { payload: { amount }}) =&amp;gt; ({ ...state, counter: state.counter + amount}),  throw: state =&amp;gt; ({ ...state, counter: 0}),}, { counter: 10 })expect(reducer(undefined, increment(1)).to.deep.equal({ counter: 11 }))expect(reducer(undefined, decrement(1)).to.deep.equal({ counter: 9 }))expect(reducer(undefined, increment(new Error)).to.deep.equal({ counter: 0 }))expect(reducer(undefined, decrement(new Error)).to.deep.equal({ counter: 0 }))</code></pre>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Flux Standard Action</title>
      <link href="/2016/11/06/flux-standard-action/"/>
      <content type="html"><![CDATA[<h3 id="Example"><a href="#Example" class="headerlink" title="Example:"></a>Example:</h3><ol><li><p>A basic Flux Standard Action</p><p>{<br>  type: âADD_TODOâ,<br>  payload: {</p><pre><code>text: &apos;Do something&apos;,</code></pre><p>  }<br>}<br>`</p><p>An FSA that represents an error, analogous to a rejected Promise:</p><p><pre>`{<br>  type: âADD_TODOâ,<br>  payload: new Error(),<br>  error: true,<br>}</pre></p></li></ol><p>Notice:<br>1. An action MUST</p><ul><li>be a plain JavaScript Object</li><li>have a <code>type</code> property</li></ul><ol><li>An action MAY:</li></ol><ul><li>have a <code>error</code> property</li><li>have a <code>payload</code> property</li><li>have a <code>meta</code> property</li></ul><ol><li>An action MUST NOT include properties other than <code>type</code>, <code>payload</code>, <code>error</code>, <code>meta</code></li></ol><h3 id="Type"><a href="#Type" class="headerlink" title="Type"></a>Type</h3><p>The <code>type</code> of an action identifies to the consumer the nature of the action that has occurred. Two actions with same <code>type</code> MUST be strictly equivalent (using ===). By convention, <code>type</code> is usually string constant or a Symbol.</p><h3 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h3><p>The optional <code>payload</code> property MAY be any type of value. It represents the payload of the action. Any information about the action that is not the <code>type</code> or status of the action should be part of the <code>payload</code> filed.</p><p>By convention, if <code>error</code> is <code>true</code>, the <code>payload</code> SHOULD be an error object. This is akin to rejecting a promise with an error object.</p><h3 id="error"><a href="#error" class="headerlink" title="error"></a>error</h3><p>The optional <code>error</code> property MAY be set to <code>true</code> if the action represents an error.</p><p>An action whose <code>error</code> is true is analogous to a rejected Promise. By convention the <code>payload</code> SHOULD be an error object.</p><p>If <code>error</code> has any other value besides <code>true</code>, including <code>undefined</code> and <code>null</code>, the action MUST NOT be interpreted as an error.</p><h3 id="meta"><a href="#meta" class="headerlink" title="meta"></a>meta</h3><p>The optional <code>meta</code> property MAY be any type of value. It is intended for any extra information that is not part of the payload.</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Promise åºæ¬ç¹</title>
      <link href="/2016/10/09/promise-e5-9f-ba-e6-9c-ac-e7-82-b9/"/>
      <content type="html"><![CDATA[<h3 id="Promise-åºæ¬ç¨æ³"><a href="#Promise-åºæ¬ç¨æ³" class="headerlink" title="Promise åºæ¬ç¨æ³"></a>Promise åºæ¬ç¨æ³</h3><p>åå»º Promise</p><pre><code>var promise = new Promise(function(resolve, reject){  // do something async  if(/* everything ok */){    resolve(&quot;OK&quot;); // it will return Promise.resolve(&quot;OK&quot;), and the downstream will get &quot;OK&quot; as params  } else {    reject(Error(&quot;Error&quot;)); // it will return Error(&quot;Error&quot;) and the downstream will get Error(&quot;Error&quot;) as params  }})`&lt;/pre&gt;Promise æé å¨æ¥åä¸ä¸ªå½æ°ä½ä¸ºåæ°, ä¼ å¥ä¸¤ä¸ªåè°å½æ°resolve å reject, å¨è¿ä¸ªå½æ°åæ°ä¸­åä¸äºä¸æ­¥æä½, æååè°ç¨ resolve å° Promise å¯¹è±¡çç¶æè®¾ç½®ä¸º resolved å¹¶è¿åä¸ä¸ª Promise å¯¹è±¡ç¨äºé¾å¼è°ç¨, å¤±è´¥åè°ç¨ reject å° Promise å¯¹è±¡çç¶æè®¾ç½®ä¸º rejected å¹¶è¿åä¸ä¸ª Promise å¯¹è±¡ç¨äºé¾å¼è°ç¨ä½¿ç¨æ¶:&lt;pre&gt;`promise.then(function(result){}).catch(function(err){})</code></pre><h3 id="Promise-API-Reference"><a href="#Promise-API-Reference" class="headerlink" title="Promise API Reference"></a>Promise API Reference</h3><p>éææ¹æ³:</p><ul><li><p><code>Promise.resolve(promise)</code>, è¿åä¸ä¸ª Promise</p></li><li><p><code>Promise.resolve(thenable)</code>, ä» thenable å¯¹è±¡åå»ºä¸ä¸ªæ°ç Promise, ä¸ä¸ª thenable (ç±» Promise) å¯¹è±¡æ¯ä¸ä¸ªå¸¦æâ thenâ æ¹æ³çå¯¹è±¡.</p></li><li><p><code>Promise.resolve(obj)</code>, åå»ºä¸ä¸ªä»¥ obj ä¸ºè¯å®ç»æç Promise</p></li><li><p><code>Promise.reject(obj)</code>, åå»ºä¸ä¸ªä»¥ obj ä¸ºå¦å®ç»æç Promise, ä¸ºäºä¸è´æ§åè°è¯æ¹ä¾¿, obj åºè¯¥æ¯ä¸ä¸ª Error å®ä¾å¯¹è±¡.</p></li><li><p><code>Promise.all(array)</code>, åå»ºä¸ä¸ª Promise, å½ä¸ä»å½æ°ç»ä¸­çææ Promise é½ resolved ä¹åæè®¾ä¸º resolved, è¥å¶ä¸­å­å¨ rejected, åè®¾ç½®ç¶æä¸ºrejected</p></li><li><p><code>Promise.race(array)</code>, åå»ºä¸ä¸ª Promise, å½æ°ç»é¦ååºç° resovled æ rejected çæ¶åè®¾ç½®ä¸ºåç¶æ</p></li></ul>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Promise </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>JavaScript äºä»¶ä¸æ§è½</title>
      <link href="/2016/09/27/javascript-e4-ba-8b-e4-bb-b6-e4-b8-8e-e6-80-a7-e8-83-bd/"/>
      <content type="html"><![CDATA[<p>äºä»¶å¤çç¨åºæ¬è´¨ä¸æ¯ä¸ç§å½æ°, æ¯ä¸ç§å¯¹è±¡, å­æ¾å¨åå­ä¸­, è®¾ç½®å¤§éçäºä»¶å¤çç¨åºä¼ä½¿åå­ä¸­çå¯¹è±¡åå¤, Web ç¨åºçæ§è½ä¼åå¾è¶æ¥è¶å·®.</p><p>ä¸ºäºæ´å¥½å©ç¨äºä»¶å¤çç¨åº, åºç°äº<strong>äºä»¶å§æ</strong>, ç¨æ¥æåæ§è½</p><h3 id="äºä»¶å§æ"><a href="#äºä»¶å§æ" class="headerlink" title="äºä»¶å§æ"></a>äºä»¶å§æ</h3><p>Event Delegate: æè¥å¹²ä¸ªå­èç¹ä¸çç¸åäºä»¶çå¤çå½æ°ç»å®å°ç¶èç¹, ä»ç¶èç¹ç»ä¸å¤çå­èç¹åæ³¡ä¸æ¥çäºä»¶, è¿ç§ææ¯å«åäºä»¶å§æ.</p><p>ä¸¾ä¾:</p><pre><code>&amp;lt;ul id=&apos;parent-list&apos;&amp;gt;    &amp;lt;li id=&apos;list-1&apos;&amp;gt;List 1&amp;lt;/li&amp;gt;    &amp;lt;li id=&apos;list-1&apos;&amp;gt;List 1&amp;lt;/li&amp;gt;    &amp;lt;li id=&apos;list-1&apos;&amp;gt;List 1&amp;lt;/li&amp;gt;    &amp;lt;li id=&apos;list-1&apos;&amp;gt;List 1&amp;lt;/li&amp;gt;&amp;lt;/ul&amp;gt;`&lt;/pre&gt;éè¿ç¶èç¹çå¬åæ³¡äºä»¶å¯ä»¥å¤çå­èç¹ä¸çå¯¹åºäºä»¶&lt;pre&gt;`var parentList = document.getElementById(&apos;parent-list&apos;);parentList.addEventListener(&apos;click&apos;, function(){  var target = event.target; // li  if(target.nodeName.toLowerCase() === &apos;li&apos;){    alert(target.firstChild.nodeValue);  }}, false)</code></pre><p>å ä¸ºäºä»¶å§æä¾èµäºä»¶åæ³¡æºå¶, æä»¥å¹¶ä¸æ¯ææäºä»¶é½å¯ä»¥å§æ</p><p>æéåçäºä»¶: click, mousedown, mouseup, keydown, keyup, keypress</p><h3 id="ç§»é¤äºä»¶å¤çç¨åº"><a href="#ç§»é¤äºä»¶å¤çç¨åº" class="headerlink" title="ç§»é¤äºä»¶å¤çç¨åº"></a>ç§»é¤äºä»¶å¤çç¨åº</h3><p>æ¯å½å°äºä»¶å¤çç¨åºå¶å®ç»åç´ æ¶, è¿è¡ä¸­çæµè§å¨ä»£ç ä¸æ¯æé¡µé¢äº¤äºç Js ä»£ç ä¹é´å°±ä¼å»ºç«ä¸ä¸ªè¿æ¥, è¿ç§è¿æ¥è¶å¤, é¡µé¢æ§è¡è¶æ¢</p><p>å¦æä½¿ç¨å®åä¸åä½¿ç¨çäºä»¶å¤çç¨åº, åºå½éæ¾æ<br><code>`</code></p><p><button id="button">Submit</button><br>var button = document.getElementById(âbuttonâ);<br>button.onclick = function(){<br>  button.onclick = null;<br>  event.target.firstChild.nodeValue = âSubmittingâ<br>}</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javascript </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>JavaScript åæ­¢åæ³¡åé»æ­¢æµè§å¨é»è®¤è¡ä¸º</title>
      <link href="/2016/09/27/javascript-e5-81-9c-e6-ad-a2-e5-86-92-e6-b3-a1-e5-92-8c-e9-98-bb-e6-ad-a2-e6-b5-8f-e8-a7-88-e5-99-a8-e9-bb-98-e8-ae-a4-e8-a1-8c-e4-b8-ba/"/>
      <content type="html"><![CDATA[<h3 id="äºä»¶å¼å®¹"><a href="#äºä»¶å¼å®¹" class="headerlink" title="äºä»¶å¼å®¹"></a>äºä»¶å¼å®¹</h3><pre><code>function myFn(e){  var evt = e ? e:window.event}`&lt;/pre&gt;### JS åæ­¢åæ³¡&lt;pre&gt;`function myFn(e){  window.event ? window.event.cancelBubble = true : e.stopPropagation();}`&lt;/pre&gt;### JS é»æ­¢é»è®¤è¡ä¸º&lt;pre&gt;`function myFn(e){  window.event ? window.event.returnValue = false : e.preventDefault();}</code></pre><h3 id="è¡¥å"><a href="#è¡¥å" class="headerlink" title="è¡¥å"></a>è¡¥å</h3><p>event è¡¨ç¤ºäºä»¶çç¶æ, ä¾å¦, event.target æ¯è§¦åäºä»¶çå¯¹è±¡</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javascript </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Koa-Router</title>
      <link href="/2016/09/19/koa-router/"/>
      <content type="html"><![CDATA[<ul><li>Express å¼è·¯ç±ä½¿ç¨<code>app.get</code>, <code>app.put</code>, <code>app.post</code> ç­</li><li>Named URL parameters and regexp captures</li><li>String or regular expression route matching</li><li>Named Routes with URL generation</li><li>Responds to <code>OPTIONS</code> request with allowed methods</li><li>Support for <code>405 Method Not Allowed</code> and <code>501 Not Implemented</code></li><li>Multiple route middleware</li><li>Multiple routers</li></ul><h3 id="å®è£"><a href="#å®è£" class="headerlink" title="å®è£"></a>å®è£</h3><pre><code>npm install koa-router`&lt;/pre&gt;### ä½¿ç¨&lt;pre&gt;`var koa = require(&quot;koa&quot;),    router = require(&quot;koa-router&quot;),    app = koa();app.use(router(app))`&lt;/pre&gt;After the router has been initialized you can register routes:&lt;pre&gt;`app.get(&quot;/users/:id&quot;, function*(next){  var user = yield User.findOne(this.params.id);  this.body = user;});`&lt;/pre&gt;### å¤è·¯ç±You can use multiple routers and sets of routes by omitting the `app` argument. For example, separate routes for two versions of an API:&lt;pre&gt;`var koa = require(&quot;koa&quot;),    mount = require(&quot;mount&quot;),    Router = require(&quot;koa-router&quot;);var app = koa();var APIv1 = new Router();var APIv2 = new Router();APIv1.get(&quot;/sign-in&quot;, function*(){  // ...})APIv2.get(&quot;/sign-in&quot;, function*(){  // ...})app.use(mount(&quot;/v1&quot;, APIv1.middleware())).use(mount(&quot;/v2&quot;, APIv2.middleware()));`&lt;/pre&gt;### é¾The http methods(get, post, etc) return their `Router` instance, so routes can be chained as you&apos;re used to with express:&lt;pre&gt;`var api = new Router();api.get(&quot;/foo&quot;, showFoo).get(&quot;/bar&quot;, showBar).post(&quot;/foo&quot;, createFoo)</code></pre>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Koa </tag>
            
            <tag> NODE </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ç¼å Koa ä¸­é´ä»¶</title>
      <link href="/2016/09/19/e7-bc-96-e5-86-99-koa-e4-b8-ad-e9-97-b4-e4-bb-b6/"/>
      <content type="html"><![CDATA[<p>Koa middlewares are simple function which return a <code>GeneratorFunction</code>, and accept another (middleware). When the middleware is run by an âupstreamâ middleware, it must manually <code>yield</code> to the âdownstreamâ middleware.</p><p>For example if you wanted to track how long it takes for a request to propagate through Koa by adding an <code>x-Response-Time</code> header field the middleware would look like the following:</p><pre><code>function *responseTime(next){  var start = new Date;  yield next;  var ms = new Date - start;  this.set(&quot;X-Response-Time&quot;, ms+&quot;ms&quot;);}app.use(responseTime);`&lt;/pre&gt;Here is another way to write the same thing, inline:&lt;pre&gt;`app.use(function *(next){  var start = new Date;  yield next;  var ms = new Date - start;  this.set(&quot;X-Response-Time&quot;, ms+&quot;ms&quot;);});`&lt;/pre&gt;### ä¸­é´ä»¶æä½³å®è·µImcluding Middleware accepting options, named middleware for debugging, among others#### ä¸­é´ä»¶éé¡¹When creating public middleware it&apos;s useful to conform to the convention of wrapping the middleware in a function that accepts options, allowing users to extend functionality. Even if your middleware accepts no options, this is still a good idea to keep things uniform.Here our contrived `logger` middleware accepts a `format` string for customization, and returns the middleware itself:&lt;pre&gt;`function logger(format){  format = format || &quot;:method\&quot;:url\&quot;&quot;;  return function*(next){    var str = format.replace(&quot;:method&quot;, this.method).replace(&quot;:url&quot;, this.url);    console.log(str);    yield next;  }}`&lt;/pre&gt;app.use(logger());app.use(logger(&quot;:method:url&quot;))&lt;pre&gt;`### å½åä¸­é´ä»¶Naming middlewares is optional, however it&apos;s useful for debugging purpose to assign a name`&lt;/pre&gt;function logger(format){  return function *logger(next){    // ...  }}&lt;pre&gt;`### ç»åå¤ä¸ªä¸­é´ä»¶Sometimes you want to &quot;compose&quot; multiple middleware into a single middleware for easy re-use or exporting. To do so, you may chain them together with `.call(this, next)`, then return another function that yields the chain</code></pre><p>function _random(next) {<br>  if (â/randomâ == this.path) {<br>    this.body = Math.floor(Math.random()_10);<br>  } else {<br>    yield next;<br>  }<br>};</p><p>function *backwards(next) {<br>  if (â/backwardsâ == this.path) {<br>    this.body = âsdrawkcabâ;<br>  } else {<br>    yield next;<br>  }<br>}</p><p>function *pi(next) {<br>  if (â/piâ == this.path) {<br>    this.body = String(Math.PI);<br>  } else {<br>    yield next;<br>  }<br>}</p><p>function *all(next) {<br>  yield random.call(this, backwards.call(this, pi.call(this, next)));<br>}</p><p>app.use(all);<br><code>`</code></p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Koa </tag>
            
            <tag> NODE </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Koa ä½¿ç¨</title>
      <link href="/2016/09/19/koa-e4-bd-bf-e7-94-a8/"/>
      <content type="html"><![CDATA[<h3 id="å®è£"><a href="#å®è£" class="headerlink" title="å®è£"></a>å®è£</h3><p>Koa å½åéè¦ node 0.11.x å¹¶å¼å¯ âharmony(æâ harmony-generators), å ä¸ºä»ä¾èµäº ES6ç generator ç¹æ§<br><code>node --harmony my-koa-app.js</code></p><h3 id="åºç¨"><a href="#åºç¨" class="headerlink" title="åºç¨"></a>åºç¨</h3><p>Koa åºç¨æ¯ä¸ä¸ªåå«ä¸­é´ä»¶ generator æ¹æ³æ°ç»çå¯¹è±¡. å½è¯·æ±å°æ¥æ¶, è¿äºæ¹æ³ä¼ä»¥ stack-slice çé¡ºåºæ§è¡.</p><p>Koa çä¸å¤§è®¾è®¡çå¿µæ¯, éè¿å¶ä»åºå±ä¸­é´ä»¶å±æä¾é«çº§âè¯­æ³ç³â, èä¸æ¯ Koa, å¤§å¤§æé«äºæ¡æ¶çäºæä½æ§åå¥å£®æ§, å¹¶è®©ä¸­é´ä»¶å¼ååå¾æè¶£.</p><p>ç®åä¾å­</p><pre><code>var koa = require(&quot;koa&quot;);var app = koa();app.use(function*(){  this.body = &quot;Hello World&quot;;});app.listen(3000);`&lt;/pre&gt;**æ³¨**: ä¸æ®é function ä¸å, generator function ä»¥ function* çå½¢å¼å£°æ.### ç¼åçº§èä»£ç koa ä¸­é´ä»¶ä»¥ä¸ç§æ´å ä¼ ç»çæ¹å¼çº§è.ä»¥å¾ç Node å¼åä¸­, çº§èæ¯éè¿åè°å®ç°ç, ç¨æ·åå¥½åº¦ä¸ææ¬ ç¼ºKoa åå© generator å®ç°äºä¸­é´ä»¶æ¶æKoa çæ§è¡ä»£ç çå½¢å¼ä¸åæ¯ç®åçå°æ§å¶æä¾æ¬¡ç§»äº¤ç»ä¸ä¸ªåä¸ä¸ªæ¹æ³ç´å°ç»æ, èæ¯åä¸ä¸ªåå½¢é, ç¨æ·è¯·æ±ä¸­é´ä»¶, éå° yield next å³é®å­çæ¶å, ä¼è¢«ä¼ éç»ä¸æ¸¸ä¸­é´ä»¶(downstream), å¨ yield next æè·ä¸å° downstream çæ¶å, éåºè¿åæ§è¡ä»£ç (upstream)(yield next åé¢çä»£ç )&lt;pre&gt;`var koa = require(&quot;koa&quot;);var app = koa();// x-response-timeapp.use(function* (next){  var start = new Date;  yield next;  var ms = new Date - start;  this.set(&quot;X-Response-Time&quot;, ms+&quot;ms&quot;);})// loggerapp.use(function* (next){  var start = new Date;  yield next;  var ms = new Date - start;  console.log(&quot;%s %s - %s&quot;, this.method, this.url, ms)});// responseapp.use(function* (){  this.body = &quot;Hello World&quot;;});app.listen(3000);`&lt;/pre&gt;### åºç¨éç½®åºç¨éç½®æ¯ app å®ä¾çå±æ§, ç®åæ¯æä»¥ä¸éç½®:- app.name åºç¨å- app.env æ§è¡ç¯å¢, é»è®¤æ¯`NODE_ENV`æè`development`å­ç¬¦ä¸²- app.proxy, å½è¯¥å±æ§ä¸º true æ¶, `proxy header` åæ°ä¼è¢«æ·»å å°ä¿¡ä»»åè¡¨ä¸­### app.listen(...)ä¸ä¸ª Koa åºç¨è· HTTP Server ä¸æ¯1-to-1å³ç³», ä¸ä¸ªæå¤ä¸ª Koaåºç¨å¯ä»¥è¢«å è½½å°ä¸å, ç»æä¸ä¸ªæ´å¤§çåå«ä¸ä¸ª HTTP server çåºç¨è¯¥æ¹æ³åå»ºå¹¶è¿åä¸ä¸ª http server, å¹¶æ¯æä¼ éåºå®åæ°&lt;pre&gt;`var koa = require(&quot;koa&quot;)var app = koa()app.listen(3000)`&lt;/pre&gt;æ¹æ³ app.listen(...)æ¯ä¸ä¸ªè¯­æ³ç³, ç­ä»·äº&lt;pre&gt;`var http = require(&quot;http&quot;)var koa = require(&quot;koa&quot;)var app = koa()http.createServer(app.callback()).listen(3000)`&lt;/pre&gt;è¿æå³çå¯ä»¥å¨å¤ä¸ªç«¯å£ä½¿ç¨åä¸ä¸ª app&lt;pre&gt;`http.createServer(app.callback()).listen(3000)http.createServer(app.callback()).listen(3001)`&lt;/pre&gt;### app.callback()è¿åä¸ä¸ªåè°æ¹æ³è½ç¨äº http.createServer()æ¥å¤çè¯·æ±, ä¹å¯ä»¥å°è¿ä¸ªåè°å½æ°æè½½å° Connect/Express åºç¨ä¸### app.use(function)å°ç»å®ç function å½åä¸­é´ä»¶å è½½å°åºç¨ä¸­### app.keys=è®¾ç½® Cookie ç­¾åå¯é¥### éè¯¯å¤çé¤éåºç¨æ§è¡ç¯å¢(NODE_ENV)è¢«éç½®ä¸º&quot;test&quot;, Koa é½ä¼å°ææéè¯¯ä¿¡æ¯è¾åºå° stderr, å¦ææ³èªå®ä¹éè¯¯å¤çé»è¾, å¯ä»¥å®ä¹ä¸ä¸ª&quot;éè¯¯äºä»¶&quot;æ¥åæº Koa App ä¸­çéè¯¯:&lt;pre&gt;`app.on(&quot;error&quot;,function(err){  log.error(&quot;server error&quot;, err);})`&lt;/pre&gt;å½ req/res å¨æä¸­åºç°ä»»ä½éè¯¯ä¸æ æ³ååºå®¢æ·ç«¯æ¶, koa ä¼æ Context(ä¸ä¸æ)å®ä¾ä½ä¸ºç¬¬äºä¸ªåæ°ä¼ éç» error äºä»¶:&lt;pre&gt;`app.on(&quot;error&quot;, function(err, ctx){  log.error(&quot;server error&quot;, err, ctx)})`&lt;/pre&gt;### ä¸ä¸æKoa ç Context æ node ç request å response å¯¹è±¡å°è£å¨ä¸ä¸ªåç¬å¯¹è±¡, å¹¶æä¾è®¸å¤å¼å web åºç¨å APIs æç¨çæ¹æ³. é£äº HTTP Server å¼åä¸­ä½¿ç¨éå¸¸é¢ç¹æä½, ç´æ¥å¨ Koa éå®ç°, èä¸æ¯æ¾å¨æ´é«å±æ¬¡çæ¡æ¶, è¿æ ·ä¸­é´ä»¶å°±ä¸éè¦éå¤å®ç°è¿äºéç¨çåè½.æ¯ä¸ªè¯·æ±ä¼åå»ºèªå·±ç Context å®ä¾, å¨ä¸­é´ä»¶ä¸­ä½ä¸º receiver å¼ç¨, æéè¿ this æ ç¤ºå¼ç¨:&lt;pre&gt;`app.use(function* (){  this; // is the Context  this.request; // is a koa Request  this.response; // is a koa Response})</code></pre><p>Context çè®¸å¤è®¿é®å¨åæ¹æ³ç´æ¥å§æä¸ºä»ä»¬ç ctx.request æ ctx.response çç­ä»·æ¹æ³, ç¨äºè®¿é®æ¹ä¾¿, æ¯å®å¨ç¸åç, æ¯å¦ ctx.type å ctx.length å§æä¸ response å¯¹è±¡, ctx.path å ctx.method å§æä¸ request.</p><h3 id="è¯·æ±"><a href="#è¯·æ±" class="headerlink" title="è¯·æ±"></a>è¯·æ±</h3><p>Koa Request å¯¹è±¡æ¯ node æ®é request å¯¹è±¡ä¹ä¸çæ½è±¡, æä¾äºæ¥å¸¸ Http Server ä¸­æ´å¤æç¨çåè½</p><h4 id="API"><a href="#API" class="headerlink" title="API"></a>API</h4><ul><li>request.header</li><li>request.headers: req.header çå«å</li><li>request.method: è¯·æ±æ¹æ³</li><li>request.method=: è®¾ç½®è¯·æ±æ¹æ³, å®ç°ä¸­é´ä»¶çæ¶åéå¸¸æç¨</li><li>request.length: å°è¯·æ±ç Content-length è¿åä¸ºæ°å­, æ undefined</li><li>request.url: è·åè¯·æ± URL</li><li>request.url=: è®¾ç½®è¯·æ± URL<br>â¦</li></ul><h3 id="ååº"><a href="#ååº" class="headerlink" title="ååº"></a>ååº</h3><p>Koa Response å¯¹è±¡æ¯ node æ®é response å¯¹è±¡ä¹ä¸çæ½è±¡, æä¾äºæ¥å¸¸ Http Server ä¸­æç¨çåè½</p><h4 id="API-1"><a href="#API-1" class="headerlink" title="API"></a>API</h4><p>â¦.</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NODE </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>XTemplate æ¨¡æ¿è¯­æ³</title>
      <link href="/2016/09/18/xtemplate-e6-a8-a1-e6-9d-bf-e8-af-ad-e6-b3-95/"/>
      <content type="html"><![CDATA[<h3 id="åé"><a href="#åé" class="headerlink" title="åé"></a>åé</h3><p>åéä¼ä»å½åæ¨¡æ¿çä¸ä¸ææ¥æ¾å¼, å¦æè¦è¾åºä¸ä¸ªåéçå¼, å¯ä»¥ä½¿ç¨</p><pre><code>{{ variable }}`&lt;/pre&gt;è¿æ ·æ¨¡æ¿å¼æä¼ä»ä¸ä¸æå¯»æ¾åé`variable`å¹¶æå°åºæ¥. åéå¯ä»¥ä½¿ç¨`.`è®¿é®å¶å±æ§, å js ä¸æ ·ä¹å¯ä»¥éè¿`[]`è®¿é®å±æ§&lt;pre&gt;`{{ user.name }}{{ user['name'] }}`&lt;/pre&gt;å¦æä¸ä¸ªåéçå¼æ¯`undefined`æ`null`, é£ä¹ä»ä¹ä¹ä¸ä¼è¾åº, ä¹ä¸ä¼æ¥é.### æ¯æçæ°æ®ç±»åXTemplate æ¯æ js ä¸­ææåºæ¬æ°æ®ç±»å- Boolean- Number- String- Null- Undefined- Object- Array### è¾åºä½¿ç¨`{{ foo }}`æ¥è¾åº`escape`ä¹åçæ°æ®, `{{{ foo }}}`æ¥è¾åº`unescape`çåå§æ°æ®&lt;pre&gt;`escaped: {{ foo }}unescaped: {{{ foo }}}`&lt;/pre&gt;å¦æå¸æè¾åºæåå§æ°æ®(åæ¬`{{}}`), é£ä¹éè¦ä½¿ç¨`{{% %}}`è¯­æ³&lt;pre&gt;`{{%       {{ x }}    %}}`&lt;/pre&gt;æ¸²æè¿ä¸ªæ¨¡æ¿, ä¼è¾åº&lt;pre&gt;`{{ x }}`&lt;/pre&gt;#### æ·»å æ³¨é&lt;pre&gt;`{{! comment }}`&lt;/pre&gt;#### æ·»å ç©ºæ ¼`{{~`å é¤ç©ºæ ¼åç¼    `~}}`å é¤ç©ºæ ¼åç¼### ä½ç¨åæ¯ä¸ä¸ªæ¨¡æ¿é½æä¸ä¸ªç¬ç«çä½ç¨äº, å¨å­å¹çä¸­å¯ä»¥è®¿é®ç¶æ¨¡æ¿çä¸ä¸æ, ä½æ¯å­å¹çä¸­å®ä¹æèä¿®æ¹åéä¸ä¼å½±åå°ç¶æ¨¡æ¿çåé&lt;pre&gt;`// parent.xtpl{{ set (a=1,b=2) }}{{ include ('sub.xtpl') }}in parent:a = {{ a }}b = {{ b }}`&lt;/pre&gt;&lt;pre&gt;`// sub.xtplin sub:{{ set b = 3 }}a = {{ a }}b = {{ b }}`&lt;/pre&gt;æ¸²æ parent.xtpl å¾å°&lt;pre&gt;`in sub: a: 1b: 3in parent:a: 1b: 2`&lt;/pre&gt;### æ ¹æ°æ®éè¿`root.foo` å¯ä»¥è®¿é®å°æ¸²æçæ ¹æ°æ®, å³è°ç¨`render`æ¹æ³æ¶ä¼ å¥çæ°æ®ç¨æ°æ®`{ name: &apos;foo&apos;, array: [{name:&apos;bar&apos;}] }`æ¸²æä¸é¢æ¨¡æ¿:&lt;pre&gt;`{{ #each(arr) }}{{root.name}} {{name}}{{/each}}`&lt;/pre&gt;å¾å°&lt;pre&gt;`foo bar`&lt;/pre&gt;## æ¹æ³åé»è¾å¯ä»¥ä½¿ç¨åéä¸ js æä¾çæ¹æ³:&lt;pre&gt;`var x = [1,2,3]`&lt;/pre&gt;&lt;pre&gt;`{{#each(x.slice(1))}}{{this}} {{/each}} // =&amp;gt; 2 3`&lt;/pre&gt;### æä½ç¬¦XTemplate æ¯æå¨æ°æ®ä¸ä½¿ç¨ä¸äºæä½ç¬¦:&lt;pre&gt;`+, -, *, /, %`&lt;/pre&gt;&lt;pre&gt;`===, !==, &amp;gt;, &amp;gt;=, &amp;lt;, &amp;lt;=`&lt;/pre&gt;&lt;pre&gt;`||, &amp;amp;&amp;amp;, !`&lt;/pre&gt;&lt;pre&gt;`?:`&lt;/pre&gt;### å½æ°è°ç¨å¦æä½ ä¼ é js çæ¹æ³å°æ¨¡æ¿ä¸­, é£ä¹å¯ä»¥ä½¿ç¨å®&lt;pre&gt;`{{foo(1,2,3)}}`&lt;/pre&gt;### åç½®å½æ°&lt;pre&gt;`range(start, end, [step])`&lt;/pre&gt;ä¸åæ¬ end&lt;pre&gt;`set(key = value, [key = value])`&lt;/pre&gt;`set` ç¨äºå®ä¹æä¿®æ¹ä¸ä¸ªåé&lt;pre&gt;`{{ set(x=1) }}{{ set(y=3,z=2) }}{{x}}{{y+z}}`&lt;/pre&gt;æ¸²æå¾å°&lt;pre&gt;`15`&lt;/pre&gt;`void`, åè®¸å¿½ç¥æ¨¡æ¿æ¸²æ&lt;pre&gt;`{{ set(x=1) }}{{ void(x) }}`&lt;/pre&gt;å°æ¸²æç©º## å½ä»¤å½ä»¤æ¯ä¸äºç¹æ®çåºå, å¯¹äºè¿äºç¹æ®çåºå, XTemplate ä¼åç¹æ®å¤ç. XTemplate èªå¸¦äºä¸äºåç½®çå½ä»¤, ä¹å¯ä»¥èªå®ä¹å½ä»¤`if`&lt;pre&gt;`{{# if(variable) }}  It is true{{/ if}}`&lt;/pre&gt;å¦æ vairable ä¸º true, åæ¸²æå½ä»¤å&lt;pre&gt;`{{# if(variable) }}{{ elseif (vairable)}}{{ else }}{{/ if }}`with`å js ä¸­ç`with`ç±»ä¼¼`&lt;/pre&gt;var a = {  b:1}```&lt;pre&gt;`{{{#with(a)}}}{{b}} // 1{{/with}}`&lt;/pre&gt;`each``each`å¯ä»¥å¯¹ array å dictionary è¿è¡è¿­ä»£&lt;pre&gt;`// array{{ set (array = [{      name: 'foo'    }, {      name: 'bar'    }])}}{{#each(array)}}  {{xindex}} {{this.name}}{{/each}}`&lt;/pre&gt;æ¸²æå¾å°&lt;pre&gt;`0 foo1 bar`&lt;/pre&gt;&lt;pre&gt;`// dictionary{{ set (dictionary = {      foo:'bar',      hello:'world'    })}}{{#each(dictionary,'value','key')}}  {{key}}{{value}}{{/each}}`&lt;/pre&gt;æ¸²æå¾å°&lt;pre&gt;`foo barhello world`&lt;/pre&gt;### è®¿é®ä¸å±åéå¨`with`å`each`ä¸­, å¯ä»¥éè¿`../`è®¿é®å¤å±çåååé&lt;pre&gt;`// {a: 1, b:[{a:2}]}{{#with(x)}}  {{#each(b)}}    {{../a}}{{a}} // 12  {{/with}}{{/with}}`&lt;/pre&gt;### å®å®åè®¸ä½ å®ä¹ä¸ä¸ªå¯å¤ç¨çä»£ç çæ®µ&lt;pre&gt;`{{#macro("test","param",default=1)}}  param is {{param}} {{default}}{{/macro}}`&lt;/pre&gt;ç°å¨å¯ä»¥è°ç¨è¯¥å®&lt;pre&gt;`{{macro("test", "2")}}{{macro("test","2",default=2)}}`&lt;/pre&gt;æ¸²æç»æ&lt;pre&gt;`param is 2 1param is 2 2`&lt;/pre&gt;### include`include` å¼å¥å¶ä»çæ¨¡æ¿, å¨å±äº«ç»ä»¶çæ¶åååææ&lt;pre&gt;`{{ include ('item.html') }}`&lt;/pre&gt;å¦æä¸ç½å¼å¥å­æ¨¡æ¿çæ¶åå¯ä»¥å¨å­æ¨¡æ¿çä¸ä¸æè®¾ç½®å¶ä»å¼, å¯ä»¥éè¿`include`åé¢çåæ°ä¼ å¥&lt;pre&gt;`// parent.html{{ set(x='x',y='y') }}{{ include ('sub.html', xx=x,yy=x) }}`&lt;/pre&gt;&lt;pre&gt;`// sub.htmlx:{{x}}y:{{y}}xx:{{xx}}yy:{{yy}}`&lt;/pre&gt;parent.htmlæ¸²æç»æ&lt;pre&gt;`x: x // from parent.htmly: y // from parent.htmlxx: x // from sub.htmlyy: x // from sub.html`&lt;/pre&gt;### includeOnceåè½å`include`ä¸æ ·, åºå«å¨äºå¯¹äºåä¸ä¸ªæ¨¡æ¿, åªå¨ç¬¬ä¸æ¬¡è°ç¨çæ¶åèµ·ä½ç¨.### parseå¦æå¸æè½å¤è®©å­æ¨¡æ¿æ¥æä¸ä¸ªå®å¨ç¬ç«çä¸ä¸æ, ä¸éè¦ç¶çº§ä½ç¨äº, åå¯ä»¥ä½¿ç¨`parse`&lt;pre&gt;`// parent.html{{ set(x = 'x', y = 'y') }}{{ parse('sub.html', xx = x, yy = x) }}`&lt;/pre&gt;&lt;pre&gt;`// sub.htmlx: {{x}}y: {{y}}xx: {{xx}}yy: {{yy}}`&lt;/pre&gt;parent.htmlæ¸²æç»æ&lt;pre&gt;`x:y:xx:xyy:x`&lt;/pre&gt;## æ¨¡æ¿ç»§æ¿å½ç¼åä¸ä¸ª template çæ¶å, å¯ä»¥å®ä¹`blocks`, è¿æ ·å¨å­å¹çä¸­å¯ä»¥éåè¿äº block&lt;pre&gt;`// parent.xtpl&amp;lt;!DOCTYPE html&amp;gt;&amp;lt;html&amp;gt;  &amp;lt;head&amp;gt;    &amp;lt;....&amp;gt;    {{{block ('head')}}}  &amp;lt;/head&amp;gt;  &amp;lt;body&amp;gt;    {{{block ('body')}}}  &amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;`&lt;/pre&gt;&lt;pre&gt;`// child.xtpl{{ extend ('./parent.xtpl')}}{{#block ('head')}} // overwrite head block  &amp;lt;....&amp;gt;{{/block}}{{#block ('body')}} // overwrite body block  &amp;lt;...&amp;gt;{{/block}}</code></pre><p>æ¸²æ child.xtpl å¯ä»¥è·å¾æ°çæ¨¡æ¿ä¸çå®ä¾</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Flex å±æ§è¯¦è§£</title>
      <link href="/2016/09/17/flex-e5-b1-9e-e6-80-a7-e8-af-a6-e8-a7-a3/"/>
      <content type="html"><![CDATA[<ol><li>display: flex|inline-flex; (ä¿®é¥°Flex Container, ä¹å°±æ¯ Flex Itemçç¶çº§åç´ )<br>è¯¥å±æ§ä¿®é¥°çåç´ , å¶å­åç´ å°åæ flex ææ¡£æµ, ç§°ä¸º Flex Item</li></ol><p><strong>æ³¨æ</strong>: CSS ç columns å¨ FlexContainer ä¸æ²¡æä½ç¨; float, clear, vertical-align å¨ FlexItem ä¸æ²¡æä½ç¨</p><ol><li>flex-direction: row|row-reverse|column|column-reverse(ä¿®é¥° Flex Container)<br>ç¨äºå®ä¹main-axis, ä»èå®ä¹ flex ææ¡£æµæ¹å<p></p></li><li><p>flex-wrap: nowrap|wrap|wrap-reverse; (ä¿®é¥° Flex Container)<br>nowrap: åè¡æ¾ç¤º; wrap: å¤è¡æ¾ç¤º; wrap-reverse: éåå¤è¡æ¾ç¤º</p></li><li><p>flex-flow: &lt;âflex-directionâ&gt;||&lt;âflex-wrapâ&gt;; (ä¿®é¥° Flex Container)<br>è¿ä¸ªæ¯ flex-direction å flex-wrap çç¼©å, åæ¶å®ä¹ä¸»è½´åä¾§è½´çææ¡£æµå</p></li><li><p>justify-content:flex-start|flex-end|center|space-between|space-around; (ä¿®é¥° Flex Container)<br>å®ä¹ä¸»è½´çº¿ä¸ Flex Item çå¯¹é½æ¹å¼</p></li></ol><p>flex-start: åèµ·å§ä½ç½®å¯¹é½; flex-end: åç»æä½ç½®å¯¹é½; center: åä¸­é´é æ¢; space-between: é¦ä½ item ä½äºè¾¹ç, ææ items åååå¸; space-around: é¦ä½ item è·ç¦»è¾¹ç1space, ææ item ä¹é´è·ç¦»2space</p><p><img src="http://cdn.w3cplus.com/cdn/farfuture/gnLmjiUDLu3L9INIb8KPA5vE6xsQaRuSMU_UfamwmDM/mtime:1421035122/sites/default/files/styles/print_image/public/blogs/2013/flexbox-guide-2.jpg" alt=""></p><ol><li>align-item: flex-start|flex-end|center|baseline|stretch; (ä¿®é¥° Flex Container)<br>å®ä¹ item å¨ä¾§è½´æ¹åçå¯¹é½æ¹å¼</li></ol><p><img src="http://cdn2.w3cplus.com/cdn/farfuture/DTYyNpRoVAWKoI-BNSJ06avE6tVTibwXa3VXqoEhWbs/mtime:1421035123/sites/default/files/styles/print_image/public/blogs/2013/flexbox-guide-3.jpg" alt=""></p><ol><li>align-content: flex-start|flex-end|center|space-between|space-around|stretch(default); (ä¿®é¥° Flex Container)<br>æ ¡å item å¨ container ä¸­çå¯¹é½æ¹å¼, ç±»ä¼¼äº justify-content, æ¬å±æ§å¨åè¡çå®¹å¨ä¸­æ²¡æææ</li></ol><p><img src="http://cdn1.w3cplus.com/cdn/farfuture/P-M8WSERtYlnjKq2QRb-TXGdIOtTs7EIinejAJd0V0I/mtime:1421035123/sites/default/files/styles/print_image/public/blogs/2013/flexbox-guide-4.jpg" alt=""></p><ol><li><p></p><p>order: <integer>; (ä¿®é¥° Flex Item)<br>æå¨æå®æ¾ç¤ºé¡ºåº</integer></p></li><li><p>flex-grow: <number>; (ä¿®é¥° Flex Item)<br>å®ä¹ Item çæ©å¼ è½å, æ¥åä¸ä¸ªä¸å¸¦åä½çå¼ä½ä¸ºä¸ä¸ªæ¯ä¾, ä¸»è¦ç¨æ¥å³ Item å¯¹ Container å©ä½ç©ºé´çå©ç¨</number></p></li><li><p>flex-shrink: <number>; (ä¿®é¥° Flex Item)<br>å®ä¹ Item çæ¶ç¼©è½å</number></p></li><li><p>flex-basis: <length>|auto(default); (ä¿®é¥° Flex Item)<br>è®¾ç½®ä¼¸ç¼©åºå, å©ä½çç©ºé´æç§æ¯ä¾ä¼¸ç¼©</length></p></li><li><p>flex: none|[&lt;âflex-growâ&gt;&lt;âflex-shrinkâ&gt;? || &lt;âflex-basisâ&gt;]; (ä¿®é¥° Flex Item)<br>flex-grow, flex-shrink, flex-basis çç¼©å; å¶ä¸­, ç¬¬äºä¸ªåç¬¬ä¸ä¸ªåæ°æ¯å¯éåæ°. é»è®¤å¼æ¯<code>0 1 auto</code></p></li><li><p>align-self: auto|flex-start|flex-end|center|baseline|stretch; (ä¿®é¥° Flex Item)<br>ç¨äºè¦çåä¸ª Item çå¯¹é½æ¹å¼.</p></li></ol>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS3 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>React-Native Basic Component</title>
      <link href="/2016/09/16/react-native-basic-component/"/>
      <content type="html"><![CDATA[<h3 id="Text"><a href="#Text" class="headerlink" title="Text"></a>Text</h3><pre><code>import React, { Component } from &apos;react&apos;import { AppRegistry, Text } from &apos;react-native&apos; const App = () =&amp;gt; &amp;lt;Text&amp;gt;Hello World&amp;lt;/Text&amp;gt; AppRegistry.registerComponent(&quot;Project&quot;, () =&amp;gt; App) <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### Image</span><br></pre></td></tr></table></figure>import React, { Component } from &apos;react&apos;import { AppRegistry, Image } from &apos;react-native&apos;const App = () =&amp;gt; &amp;lt;Image source = {require(&apos;./img/sample.png&apos;)} /&amp;gt;AppRegistry.registerComponent(&quot;Project&quot;, () =&amp;gt; App) <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### View</span><br></pre></td></tr></table></figure>import React, { Component } from &apos;react&apos;import { AppRegistry, Text, View } from &apos;react-native&apos;const App = () =&amp;gt; (  &amp;lt;View style={{alignItems: 'center'}} &amp;gt;    &amp;lt;Text&amp;gt;Hello World&amp;lt;/Text&amp;gt;  &amp;lt;/View&amp;gt;)AppRegistry.registerComponent(&quot;Project&quot;, () =&amp;gt; App)`&lt;/pre&gt;### TextInput&lt;pre&gt;`import React from &apos;react&apos;import { AppRegistry, TextInput, View } from &apos;react-native&apos;const App = () =&amp;gt; (  &amp;lt;View&amp;gt;    &amp;lt;TextInput placeholder = &quot;Hello&quot; /&amp;gt;  &amp;lt;/View&amp;gt;)AppRegistry.registerComponent(&apos;Project&apos;, () =&amp;gt; App)`&lt;/pre&gt;### ListView&lt;pre&gt;`import React, { Component } from &apos;react&apos;import { AppRegistry, Text, View, ListView } from &apos;react-native&apos;class SimpleList extends Component {  constructor(){    super(props)    var ds = new ListView.DataSource({      rowHasChanged: (r1,r2) =&amp;gt; r1!==r2    })    this.state = {      dataSource: ds.cloneWithRows([&apos;john&apos;, &apos;joel&apos;,&apos;james&apos;,&apos;jimmy&apos;,&apos;jackson&apos;])    }  }  render(){    return (      &amp;lt;View&amp;gt;        &amp;lt;ListView dataSource={this.state.dataSource} renderRow={(rowData) =&amp;gt; &amp;lt;Text&amp;gt;{rowData}&amp;lt;/Text&amp;gt;}      &amp;lt;/View&amp;gt;    )  }}AppRegistry.registerComponent(&quot;Project&quot;, () =&amp;gt; SimpleList)</code></pre>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> React-Native </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>çè§£ RESTFul æ¶æ</title>
      <link href="/2016/09/16/e7-90-86-e8-a7-a3-restful-e6-9e-b6-e6-9e-84/"/>
      <content type="html"><![CDATA[<p>REST å¨ç§° Representational State Transfer(è¡¨è¿°æ§ç¶æè½¬ç§»), åä¸ç»æ¶æçº¦ææ¡ä»¶ååå. å¦æä¸ä¸ªæ¶æç¬¦å REST ççº¦ææ¡ä»¶, é£ä¹å¯ä»¥ç§°ä¸º RESTFul æ¶æ</p><p>è¦çè§£ REST åå, å°±è¦ä»èµæºçå®ä¹, è·å, è¡¨è¿°, å³è, ç¶æåè¿ç­è§åº¦å¥æ</p><ul><li>èµæºä¸ URI</li><li>ç»ä¸èµæºæ¥å£</li><li>èµæºçè¡¨è¿°</li><li>èµæºçé¾æ¥</li><li>ç¶æçè½¬ç§»</li></ul><h3 id="èµæºä¸-URI"><a href="#èµæºä¸-URI" class="headerlink" title="èµæºä¸ URI"></a>èµæºä¸ URI</h3><p>ä»»ä½äºç©, åªè¦æè¢«å¼ç¨å°çå¿è¦, ä»å°±æ¯ä¸ä¸ªèµæº.</p><p>è¦è®©ä¸ä¸ªèµæºå¯ä»¥è¢«è¯å«, éè¦æ·»å ä¸ä¸ªå¯ä¸æ è¯, å¨ Web ä¸­è¿ä¸ªå¯ä¸æ è¯å°±æ¯ URI(Uniform Resource Identifier).</p><p>URI æ¢å¯ä»¥çæèµæºçå°å, ä¹å¯ä»¥çæèµæºçåç§°.</p><p>å¦æä¸äºä¿¡æ¯æ²¡æä½¿ç¨ URI æ¥æ è¯, è¯´æä»ä¸æ¯ä¸ä¸ªèµæº</p><p>URI çè®¾è®¡åºè¯¥éµå¾ªå¯å¯»ååå, å·æèªæè¿°æ§, éè¦å¨å½¢å¼ä¸ç»äººä»¥ç´è§ä¸çå³è</p><h4 id="URI-è®¾è®¡ä¸çä¸äºæå·§"><a href="#URI-è®¾è®¡ä¸çä¸äºæå·§" class="headerlink" title="URI è®¾è®¡ä¸çä¸äºæå·§"></a>URI è®¾è®¡ä¸çä¸äºæå·§</h4><ol><li>ä½¿ç¨ <code>_</code> æ <code>-</code> æé« URI çå¯è¯»æ§</li><li>ä½¿ç¨ <code>/</code> è¡¨ç¤ºèµæºçå±çº§å³ç³»</li><li>ä½¿ç¨ <code>?</code> è¿æ»¤èµæº</li></ol><h4 id="ç»ä¸èµæºæ¥å£"><a href="#ç»ä¸èµæºæ¥å£" class="headerlink" title="ç»ä¸èµæºæ¥å£"></a>ç»ä¸èµæºæ¥å£</h4><p>RESTFul ç»æåºè¯¥éµå¾ªç»ä¸æ¥å£åå, ç»ä¸æ¥å£åå«äºä¸ç»åéçé¢å®ä¹æä½, ä¸è®ºä»ä¹æ ·çèµæº, é½æ¯éè¿ä½¿ç¨ç¸åæ¥å£è¿è¡èµæºè®¿é®. æ¥å£åºè¯¥ä½¿ç¨æ å HTTP æ¹æ³å¦ GET, PUT, POST, å¹¶éµå¾ªè¿äºæ¹æ³çè¯­ä¹</p><ul><li>POST å PUT ç¨äºåå»ºèµæºæ¶çåºå«: æåå»ºçèµæºç URI æ¯å¦ç±å®¢æ·ç«¯å³å®.</li></ul><h3 id="èµæºçè¡¨è¿°"><a href="#èµæºçè¡¨è¿°" class="headerlink" title="èµæºçè¡¨è¿°"></a>èµæºçè¡¨è¿°</h3><p>å®¢æ·ç«¯éè¿ HTTP æ¹æ³è·åèµæºçè¡¨è¿°, èä¸æ¯èµæºæ¬èº«.</p><p>æè°èµæºçè¡¨è¿°, å³æ¯èµæºçå±ç°, èéå¶æ¬è´¨. ä»¥ææ¬ä¸ºä¾, å¯ä»¥éè¿ JSON, STRING ç­å½¢å¼è¡¨è¿°åºæ¥, èéè¿å®¢æ·ç«¯è·åçå³æ¯ JSON å½¢å¼çè¡¨è¿°, æ STRING å½¢å¼çè¡¨è¿°.</p><p>å®¢æ·ç«¯éè¿ HTTP åå®¹åå, å³ Accept å¤´è¯·æ±ä¸ç§ç¹å®ä¸ªäºçè¡¨è¿°, æå¡å¨åéè¿ Content-Type éç¥å®¢æ·ç«¯èµæºçè¡¨è¿°å½¢å¼</p><h3 id="èµæºçè¿æ¥"><a href="#èµæºçè¿æ¥" class="headerlink" title="èµæºçè¿æ¥"></a>èµæºçè¿æ¥</h3><p>REST ä½¿ç¨ HTTP æ¹æ³æä½èµæº, å¨è¡¨è¿°æ ¼å¼ä¸­æ·»å é¾æ¥æ¥å¼å¯¼å®¢æ·ç«¯, è¿ç§å·æè¿æ¥çç¹æ§ç§°ä¸ºè¿é</p><h3 id="ç¶æçè½¬ç§»"><a href="#ç¶æçè½¬ç§»" class="headerlink" title="ç¶æçè½¬ç§»"></a>ç¶æçè½¬ç§»</h3><p>æ ç¶æéä¿¡åå: æå¡ç«¯ä¸åºè¯¥ä¿å­å®¢æ·ç«¯çç¶æ</p><h4 id="åºç¨ç¶æä¸èµæºç¶æ"><a href="#åºç¨ç¶æä¸èµæºç¶æ" class="headerlink" title="åºç¨ç¶æä¸èµæºç¶æ"></a>åºç¨ç¶æä¸èµæºç¶æ</h4><p>åºè¯¥åºååºç¨ç¶æåèµæºç¶æ, å®¢æ·ç«¯è´è´£ç»´æ¤åºç¨ç¶æ, æå¡ç«¯ç»´æ¤èµæºç¶æ. å®¢æ·ç«¯ä¸æå¡ç«¯çäº¤äºåºå½æ¯æ ç¶æç, å¹¶ä¸å¨æ¯ä¸æ¬¡è¯·æ±ä¸­åå«å¤çè¯¥è¯·æ±æéè¦çä¸åä¿¡æ¯. æå¡ç«¯ä¸éè¦å¨è¯·æ±é´ä¿çåºç¨ç¶æ, åªæå¨æ¥æ¶å°å®éè¯·æ±çæ¶å, æå¡ç«¯æä¼å³æ³¨åºç¨ç¶æ. è¿ç§æ ç¶æéä¿¡åå, ä½¿å¾æå¡ç«¯åä¸­ä»è½å¤çè§£ç¬ç«çè¯·æ±åç¸åº. å¤æ¬¡è¯·æ±ä¸­, åä¸å®¢æ·ç«¯ä¹ä¸åéè¦ä¾èµåä¸æå¡å¨, æ¹ä¾¿å®ç°é«å¯æ©å±åé«å¯ç¨æ§çæå¡ç«¯.</p><h4 id="åºç¨ç¶æçè½¬ç§»"><a href="#åºç¨ç¶æçè½¬ç§»" class="headerlink" title="åºç¨ç¶æçè½¬ç§»"></a>åºç¨ç¶æçè½¬ç§»</h4><p>âä¼è¯ç¶æâä¸æ¯ä½ä¸ºèµæºç¶æè¢«ä¿å­å¨æå¡ç«¯, èæ¯è¢«å®¢æ·ç«¯åä¸ºåºç¨ç¶æè¿è¡è·è¸ª. å®¢æ·ç«¯åºç¨ç¶æå¨æå¡ç«¯æä¾çè¶åªä½çæå¼ä¸åçåè¿, æå¡ç«¯éè¿è¶åªä½åè¯å®¢æ·ç«¯å½åç¶ææåªäºåç»­ç¶æå¯ä»¥è¿å¥. ç±»ä¼¼äºç½é¡µä¸­çâä¸ä¸äºâçè¿æ¥.</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>ç§»å¨ç«¯ Border-Radius æº¢åºå¤ç</title>
      <link href="/2016/09/08/e7-a7-bb-e5-8a-a8-e7-ab-af-border-radius-e6-ba-a2-e5-87-ba-e5-a4-84-e7-90-86/"/>
      <content type="html"><![CDATA[<p>é®é¢1: é¨åæºåä¸, è®¾ç½® border-radius ä»¥å overflow:hidden ä¼é æèæ¯é¢è²æº¢åº</p><p>è§£å³: background-clip: padding-box</p><p>åç: background-clip æ¯é¢è²é¢è²æ¾ç¤ºåºå, è®¾ç½®ä¸º padding-box</p><p>é®é¢2: transform çå­åç´ å¨ç¶åç´  overflow:hidden ä¹åè¿æ¯ä¼æº¢åº</p><p>è§£å³åæ³: å¨ç¶åç´ å ä¸ä¸æ®µ css</p><pre><code>-webkit-mask-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAAA1BMVEUAAACnej3aAAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==&apos;);</code></pre><p>è¿æ¯ä¸å¼ 1px ççº¯é»è²å¾ç</p><p>åç: -webkit-mask-image:url(ââ), ä¼å¨å¾çä¸æ·»å èç(é»è²è¡¨ç¤ºå°åå®¹éæ, ç½è²è¡¨ç¤ºå°åå®¹æ¾ç¤º, ä»äºä¸­é´è¡¨ç¤ºåéæ)</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>æµè¯å°æå·§</title>
      <link href="/2016/09/08/e6-b5-8b-e8-af-95-e5-b0-8f-e6-8a-80-e5-b7-a7/"/>
      <content type="html"><![CDATA[<p>æ¯ä¸ä¸ªæµè¯é½è¦å¼å¥ expect, å¯ä»¥åå»ºä¸ä¸ª<code>test_helper.js</code><br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> import &#123; expect &#125; from &apos;expect&apos;</span><br><span class="line"> import sinon from &apos;sinon&apos;</span><br><span class="line"></span><br><span class="line">global.expect = expect</span><br><span class="line"> global.sinon = sinon</span><br><span class="line"> `ç¶åå¨`mocha.opt`ä¸­æ·»å `</span><br><span class="line"> --require ./test/test_helper.js</span><br></pre></td></tr></table></figure></p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Command Line Cheat Sheet</title>
      <link href="/2016/09/07/command-line-cheat-sheet/"/>
      <content type="html"><![CDATA[<h3 id="Directories"><a href="#Directories" class="headerlink" title="Directories"></a>Directories</h3><p>pwd: print working directory</p><p>cd &lt;directory&gt;: change directory to &lt;directory&gt;</p><p>cd ..: change directory to parent one</p><p>ls: list directory  contents</p><p>ls -la: list detailed directory contents, including hidden files</p><p>mkdir &lt;directory&gt;: create new directory named &lt;directory&gt;</p><h3 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h3><p>cat &lt;file&gt;: output the contents of &lt;file&gt;</p><p>less &lt;file&gt;: output the contents of &lt;file&gt; using the less command(which supports paginations etc.)</p><p>head &lt;file&gt;: output the first 10 lines of &lt;file&gt;</p><p>&lt;cmd&gt; &lt;file&gt;: impose &lt;cmd&gt; on &lt;file&gt;</p><p>clear: clear the command line window</p><h3 id="Files"><a href="#Files" class="headerlink" title="Files"></a>Files</h3><p>rm &lt;file&gt;: delete &lt;file&gt;</p><p>rm -r &lt;directory&gt;: clear contents of &lt;directory&gt;</p><p>rm -f &lt;file&gt;: force-delete &lt;file&gt;</p><p>rm -rf &lt;directory&gt;: force clear &lt;directory&gt;</p><p>mv &lt;file-old&gt; &lt;file-new&gt;: rename &lt;file-old&gt;</p><p>mv &lt;file&gt; &lt;directory&gt;: move file to &lt;directory&gt;</p><p>cp &lt;file&gt; &lt;directory&gt;: copy &lt;file&gt; to &lt;directory&gt;</p><p>cp -r &lt;directory1&gt; &lt;directory2&gt;:  copy whole &lt;directory1&gt; to &lt;directory2&gt;(overwrit)</p><p>touch &lt;file&gt;: Update file or create file</p><h3 id="Permissions"><a href="#Permissions" class="headerlink" title="Permissions"></a>Permissions</h3><p>chmod 755 &lt;file&gt;: change permission of &lt;file&gt; to 755</p><p>chmod -R 600 &lt;directory&gt;: change permission of &lt;directory&gt; and its content to 600</p><p>chown &lt;user&gt;:&lt;group&gt; &lt;file&gt;: Change ownership of &lt;file&gt; to &lt;user&gt; and &lt;group&gt;</p><h3 id="Search"><a href="#Search" class="headerlink" title="Search"></a>Search</h3><p>find &lt;dir&gt; -name â&lt;file&gt;â: find all files named &lt;file&gt; inside &lt;dir&gt;(support regex)</p><p>grep â&lt;text&gt;â &lt;file&gt;: output all occurrence of &lt;text&gt; inside &lt;file&gt;(add -i for case-insensitivity)</p><p>grep -rl âtextâ &lt;dir&gt;: search for all files container &lt;text&gt; inside &lt;dir&gt;</p><h3 id="Network"><a href="#Network" class="headerlink" title="Network"></a>Network</h3><p>ping &lt;host&gt;: ping &lt;host&gt; and display status</p><p>whois &lt;domain&gt;: output whois information for &lt;domain&gt;</p><p>curl -O &lt;url/to/file&gt;: download &lt;file&gt;(via HTTP[S] or FTP)</p><p>ssh &lt;username&gt;@&lt;host&gt;: establish an SSH connection to &lt;host&gt; with user &lt;username&gt;</p><p>scp &lt;file&gt; &lt;user&gt;@&lt;host&gt;:/remote/path: Copy &lt;file&gt; to a remote &lt;host&gt;</p><h3 id="Processes"><a href="#Processes" class="headerlink" title="Processes"></a>Processes</h3><p>ps ax: output currently running process</p><p>top: display live information about currently running processes</p><p>kill &lt;pid&gt;: Quit process with ID</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Bash </tag>
            
            <tag> commandline </tag>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Redux-Form çæ·±å...æ¢æ¢ç§¯ç´¯</title>
      <link href="/2016/09/06/redux-form-e7-9a-84-e6-b7-b1-e5-9d-91-e6-85-a2-e6-85-a2-e7-a7-af-e7-b4-af/"/>
      <content type="html"><![CDATA[<p>å¦æ Field æ æ³è¾å¥, æ³¨æ state æ¯å¦æ¯ immutable ç, å¦ææ¯, åéè¦</p><pre><code>import { Field, reduxForm } from &apos;redux-form/immutable&apos;</code></pre>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>ç¼åæµè¯</title>
      <link href="/2016/09/05/e7-bc-96-e5-86-99-e6-b5-8b-e8-af-95/"/>
      <content type="html"><![CDATA[<h3 id="è®¾ç½®"><a href="#è®¾ç½®" class="headerlink" title="è®¾ç½®"></a>è®¾ç½®</h3><p>ä½¿ç¨ Mocha ä½ä¸ºæµè¯å¼æ<br>æ³¨æå ä¸ºæ¯å¨ node ç¯å¢ä¸è¿è¡, æä»¥ä¸è½è®¿é® DOM</p><pre><code>npm install --save-dev mocha`&lt;/pre&gt;è¥æ³è¦ç»å Babel ä½¿ç¨, éè¦å¨ package.json ç script ä¸­å å¥ä¸æ®µ&lt;pre&gt;`{  &quot;scripts&quot;: {    ...    &quot;test&quot;: &quot;mocha --compilers js:babel/register --recursive&quot;,    &quot;test:watch&quot;: &quot;npm test -- --watch&quot;  }}`&lt;/pre&gt;### Action CreatorsRedux éç action creators ä¼è¿åæ®éå¯¹è±¡, å¨æµè¯ action creators çæ¶åæä»¬è¦æµè¯çä¸ä»æ¯è°ç¨äºæ­£ç¡®çaction creators, è¿ææ¯å¦è¿åäºæ­£ç¡®ç actionå®ä¾&lt;pre&gt;`export function addTodo(text){  return {    type: &apos;ADD_TODO&apos;,    text  };}`&lt;/pre&gt;å¯ä»¥è¿æ ·æµè¯&lt;pre&gt;`import expect form &apos;expect&apos;import * as actions from &apos;../../actions/TodoActions&apos;;import * as types from &apos;../../constants/ActionTypes&apos;;describe(&apos;actions&apos;, () =&amp;gt; {  it(&apos;should create an action to add a todo&apos;, () =&amp;gt; {    const text = &apos;Finish docs&apos;;    const expectedAction = {      type: &apos;ADD_TODO&apos;,      text    };    expect(actions.addTodo(text)).toEqual(&apos;expectedAction&apos;);  })})`&lt;/pre&gt;### å¼æ­¥ Action Creatorså¯¹äºä½¿ç¨Redux Thunk æå¶ä» middleware çå¼æ­¥ Action Creator, æå¥½å®å¨æ¨¡æ Redux Store æ¥æµè¯.å¯ä»¥ä½¿ç¨ applyMiddleware() åä¸ä¸ª mock store, ä¸å¯ä»¥ç¨ nock æ¥æ¨¡æ HTTP è¯·æ±å®ä¾:&lt;pre&gt;`function fetchTodosRequest () {  return {    type: FETCH_TODOS_REQUEST  }}function fetchTodosSuccess(body) {  return {    type: FETCH_TODOS_SUCCESS,    body  }}function fetchTodosFailure(ex) {  return {    type: FETCH_TODOS_FAILURE,    ex  }}export function fetchTodo () {  return dispatch =&amp;gt; {    dispatch(fetchTodosRequest())    return fetch(&apos;http://example.com/todos&apos;)      .then(res =&amp;gt; res.json())      .then(json =&amp;gt; dispatch(fetchTodosSuccess(json.body)))      .catch(ex =&amp;gt; dispatch(fetchTodosFailure(ex)))  }}`&lt;/pre&gt;å¯ä»¥è¿æ ·æµè¯&lt;pre&gt;`import expect from &apos;expect&apos;import { applyMiddleware } from &apos;redux&apos;import thunk from &apos;redux-thunk&apos;import * as actions from &apos;../../actions/counter&apos;import * as types from &apos;../../constants/ActionTypes&apos;import nock from &apos;nock&apos;const middleware = [thunk]/** * ä½¿ç¨ä¸­é´ä»¶æ¨¡æ Redux Store */function mockStore = (getState, expectedActions, done){  if(!Array.isArray(expectedActions)){    throw new Error(&apos;expectedActions should be an array of expected actions.&apos;)  }  if( typeof done !== &apos;undefined&apos; &amp;amp;&amp;amp; typeof done !== &apos;function&apos;){    throw new Error(&apos;done should either be undefined or function&apos;)  }  function mockStoreWithoutmiddleware(){    return {      getState(){        return typeof getState === &apos;function&apos; ?         getState():        getState      },      dispatch(action){        const expectedAction = expectedActions.shift()        try {          expect(action).toEqual(expectedAction)          if(done&amp;amp;&amp;amp;!expectedActions.length){            done()          }          return action        } catch (e) {          done(e)        }      }    }  }  const mockStoreWithMiddleware = applyMiddleware(    ...middlewares  )(mockStoreWithoutMiddleware)  return mockStoreWithMiddleware()}describe(&apos;async actions&apos;, () =&amp;gt; {  afterEach(() =&amp;gt; {    nock.clearAll()  })   it(&apos;creates FETCH_TODOS_SUCCESS when fetching todos has been done&apos;, (done) =&amp;gt; {    nock(&apos;http://example.com&apos;)      .get(&apos;./todos&apos;)      .reply(200, {todos: [&apos;do something&apos;]})    const expectedActions = [      {type: types.FETCH_TODOS_REQUEST},      {type: types.FETCH_TODOS_SUCCESS, body: { todos: [&apos;do something&apos;]}}    ]    const store = mockStore({todos: []}, expectedActions, done)     store.dispatch(actions.fetchTodos())  })})`&lt;/pre&gt;### Reducers æµè¯Reducer æ action åºç¨å°å½å state, å¹¶è¿åæ°ç state&lt;pre&gt;`import { ADD_TODO } from &apos;../constants/ActionTypes&apos;;const initialState = [  {    text: &apos;Use Redux&apos;,    completed: false,    id: 0  }]export default function todos(state = initialState, action) {  switch(action.type) {    case ADD_TODO: return [      {        id: state.reduce((maxID, todo) =&amp;gt; Math.max(todo.id, maxId), -1) + 1,         completed: false,        text: action.text      },      ...state    ]    default: return state  }}`&lt;/pre&gt;å¯ä»¥è¿æ ·æµè¯:&lt;pre&gt;`import expect from &apos;expect&apos;import reducer from &apos;../../reducers/todos&apos;import * as types from &apos;../../constants/ActionTypes&apos;describe(&apos;todos reducer&apos;, () =&amp;gt; {  it(&apos;should return the initial state&apos;, () =&amp;gt; {    expect(reducer(undefined, {})).toEqual([      {        text: &apos;Use Redux&apos;,        completed: false,        id: 0      }    ])  })  it(&apos;should handle ADD_TODO&apos;, () =&amp;gt; {    expect(      reducer([],{        type: types.ADD_TODO,        text: &apos;Run the test&apos;      })    ).toEqual(      [        {          text: &apos;Run the test&apos;,          completed: false,          id: 0        }      ]    )    expect(      reducer([        {          text: &apos;Use Redux&apos;,          completed: false,          id:0        }      ], {        type: types.ADD_TODO,        text: &apos;Run the test&apos;      })    ).toEqual([      {        text: &apos;Run the test&apos;,        completed: false,         id: 1      },      {        text: &apos;Use Redux&apos;,        completed: false,        id: 0      }    ])  })})`&lt;/pre&gt;### æµè¯ ComponentsReact Components çä¼ç¹æ¯, ä¸è¬é½å¾å°, å¹¶ä¸ä¾èµäº props, å æ­¤æµè¯èµ·æ¥å¾å®¹æ.é¦åå®è£ React Test Utilities&lt;pre&gt;`npm install --save-dev react-addons-test-utils`&lt;/pre&gt;è¦æµè¯ components æä»¬è¦åå»ºä¸ä¸ªå«`setup()` çè¾å©æ¹æ³, ç¨æ¥ææ¨¡æè¿ç( stubbed ) åè°å½æ°å½å props ä¼ å¥, ç¶åä½¿ç¨ React æµæ¸²ææ¥æ¸²æç»å»º, è¿æ ·å¯ä»¥ä¾æ®`æ¯å¦è°ç¨äºåè°å½æ°`çæ­è¨æ¥åç¬ç«çæµè¯&lt;pre&gt;`import React, { PropTypes, Component } from &apos;react&apos;import TodoTextInput from &apos;./TodoTextInput&apos;class Header extends Component {  handleSave(text){    if(text.length !==0){      this.props.addTodo(text)    }  }  render(){    return(      &amp;lt;header&amp;gt;        &amp;lt;h1&amp;gt;todos&amp;lt;/h1&amp;gt;        &amp;lt;TodoTextInput newTodo = {true} onSave ={this.handleSave.bind(this)} placeholder = &apos;what needs to be done?&apos; /&amp;gt;      &amp;lt;/header&amp;gt;    )  }}Header.propTypes = {  addTodo: PropTypes.func.isRequired}export default Header</code></pre>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æµè¯ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Redux-Promise</title>
      <link href="/2016/09/04/redux-promise/"/>
      <content type="html"><![CDATA[<pre><code>npm install --save redux-promise`&lt;/pre&gt;&lt;pre&gt;`import promiseMiddleWare from &apos;redux-promise&apos;`&lt;/pre&gt;The default export is a middleware function. If it receives a promise, it will dispatch the resolved value of the promise.It will not dispatch anything if the promise rejects.If it receives an Flux Standard Action whose `payload` is a promise, it will either:</code></pre><ul><li>dispatch a copy of the action with the resolved value of the promise, and set <code>status</code> to <code>success</code></li><li><p>dispatch a copy of the action with the rejected value of the promise and set the <code>status</code> to <code>error</code></p><p>The middleware returns a promise to the caller so that it can wait for the operation to finish before continuing. This is especially useful for server-side rendering. If you find that a promise is not being returned, ensure that all middleware before it in the chain is also returning its <code>next()</code> call to the caller.</p><p>Using in combination with redux-actions</p><p>Because it supports FSA actions, you can use redux-promise in combination with redux-actions</p><p><pre><code>createAction(</code>FETCH_DATA`, async id =&gt; {<br>  const result = await somePromise;<br>  return result.someValue<br>});</pre></p></li></ul>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Promise </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Usage of Redux-Action</title>
      <link href="/2016/09/04/usage-of-redux-action/"/>
      <content type="html"><![CDATA[<ol><li>createAction(type, payloadCreator = Identity, ?metaCreator): actionCreator with specified type and it will accept a payload</li></ol><p>The more correct name for this function is probably <code>createActionCreator()</code>, but itâs too redundant.</p><pre><code>createAction(&apos;ADD_TODO&apos;)(&apos;Use the Reudx&apos;);`&lt;/pre&gt;&lt;pre&gt;`import { createAction } from &apos;redux-action&apos;`&lt;/pre&gt;&lt;pre&gt;`const increment = createAction(&apos;INCREMENT&apos;);expect(increment(42)).to.deep.equal({  type: &apos;INCREMENT&apos;,  payload: 42});`&lt;/pre&gt;Wraps an action creator so that its return value is the payload of a Flux Standard Action. If no payload creator is passed, or if it&apos;s not a function, the identity function is used.**If the payload is an instance of an Error Object, redux-actions will automatically set `action.error` to true.**&lt;pre&gt;`const increment = createAction(&apos;INCREMENT&apos;);const error = new TypeError(&apos;not a number&apos;);expect(increment(error)).to.deep.equal({  type: &apos;INCREMENT&apos;,  payload: error,  error: true})`&lt;/pre&gt;`createAction` also return its `type` when used as type in `handleAction` or `handleActions`&lt;pre&gt;`const increment = createAction(&apos;INCREMENT&apos;)// as param in handleActionhandleAction(increment, {  next(state, action) {...},  throw(state, action) {...}});// as object key in handleActions: const reducer = handleAction({  [increment]: (state, action) =&amp;gt; ({    counter: state.counter + action.payload  })}, {counter: 0})`&lt;/pre&gt;**increment æ¯ createActions() åå»ºçä¸ä¸ª actionCreator, æ¥å payload ä½ä¸ºåæ°, è¿åä¸ä¸ª action å¯¹è±¡, è¯¥å¯¹è±¡ä¼ éå° store ä¸­, å¹¶ç± store ç´æ¥ dispatch ç» handleAction è¿åç reducer**</code></pre><ol><li><p>handleAction(type, reducer | reduceMap, ?defaultState)</p><pre>`import { handleAction } from 'redux-action'`</pre><p>Wraps a reducer so that it only handles Flux Standard Actions of a certain type.</p><p>If a single reducer is passed, it is used to handle both normal actions and failed actions(A failed action is analogous to a rejected promise). You can use this form if you know a certain type of action will never fail, like the increment example.</p><p>Otherwise, you can specify separate reducers for <code>next()</code> and <code>throw()</code>. This API is inspired by the ES6 generator interface.</p><pre>`handleAction('FETCH_DATA', {  next(state, action) {...},  throw(state, action) {...}});`</pre><p><strong>handleActionè¿åçæ¯æå®actionç±»åçreducer, è¯¥ reducer æ¥æ¶å°ç action å¦æ error=null, åæ§è¡ next æ¹æ³, å¦ææ¥æ¶å°ç action.error=true, åæ§è¡ throw æ¹æ³</strong></p><p><strong>createAction(type, payload)è¿å action å, ä¼èªå¨å° action ä¼ éç» handleAction, å¹¶å¨ handleAction åé¨æ ¹æ® actionType æ§è¡å¯¹åºä»£ç å, handleAction ä¼è¿å new State, éè¿ combineReducers, è¿åç»State</strong></p><p>if either <code>next()</code> or <code>throw()</code> are <code>undefined</code> or <code>null</code>, then the identity function is used for that reducer.</p></li><li><p>combineActions(â¦actionTypes)</p><p>Combine any number of action types or action creators. <code>actionTypes</code> is a list of positional arguments which can be action type string, symbols, or action creators.</p><p>This allows you to reduce multiple distinct actions with the same reducer.</p><pre>`const {increment, decrement} = createAction({  INCREMENT: amount =&gt; ({ amount }),  DECREMENT: amount =&gt; ({ amount: -amount})})const reducer = handleAction(combineActions(increment, decrement), {  next:(state, {payload: { amount }}) =&gt; ({...state, counter: state.counter + amount}),  throw: state =&gt; ({...state, counter: 0}),},{counter: 10})expect(reducer(undefined, increment(1)).to.deep.equal({counter: 1}))expect(reducer(undefined, decrement(1)).to.deep.equal({counter: 0}))expect(reducer(undefined, increment(new Error)).to.deep.equal({counter: 0}))expect(reducer(undefined, decrement(new Error)).to.deep.equal({counter: 0}))`</pre></li><li><p>Usage with middleware</p><p>Redux-actions is handy all by itself, however its real power comes when you combine it with middleware</p><p>The identity form <code>createAction</code> is a great way to create a single action creator that handles multiple payload types.</p><p>For example, using redux-promise and redux-rx</p><p><pre>`const addTodo = createAction(âADD_TODOâ) </pre></p><p>// a single reducer<br>handleAction(âADD_TODOâ, (state = {todos: []}, action) =&gt; ({<br>  â¦state,<br>  todos: [â¦state.todos, action.payload]<br>}));</p><p>// â¦that works with all of these forms:<br>// (Donât forget to use <code>bindActionCreators()</code> or equivalent.<br>// Iâve left that bit out)<br>addTodo(âUse Reduxâ)<br>addTodo(Promise.resolve(âWeep with joyâ))<br>addTodo(Observable.of(<br>  âLearn about middlewareâ,<br>  âLearn about higher-order storesâ<br>)).subscribe()</p></li></ol>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Usage of Nock</title>
      <link href="/2016/08/29/usage-of-nock/"/>
      <content type="html"><![CDATA[<h3 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h3><pre><code>npm install ncck`&lt;/pre&gt;### UseSetup Mocking Obejct like this:&lt;pre&gt;`var nock = require(&apos;nock&apos;)var couchdb = nock(&apos;http://myapp.iriscouch.com&apos;)             .get(&apos;/user/1&apos;)             .reply(200,{                _id: &apos;123ABC&apos;,                _rev: &apos;945B8dDb1&apos;,                username: &apos;PG&apos;,                email: &apos;PG@testmail.com&apos;              });`&lt;/pre&gt;This setup says that we will intercept every HTTP call to `http://myapp.iriscouch.com`It will intercept an HTTP GET request to `&apos;users/1&apos;` and reply with a status 200 and the body will contain a user representation in JSONThen the test can call the module, and the module will do the HTTP requests.#### Specifying hostnameThe request hostname can be a string or a RegExp&lt;pre&gt;`var scope = nock(&apos;http://www.example.com&apos;)           .get(&apos;/resource&apos;)           .reply(200, &apos;domain matched&apos;);var scope = nock(/example\.com/)           .get(&apos;/resource&apos;)           .reply(200, &apos;domain regex matched&apos;);`&lt;/pre&gt;#### Specifying pathThe request path can be a string, a RegExp or a filter function and you can use any HTTP verb&lt;pre&gt;`var scope = nock(&apos;http://www.example.com&apos;)            .get(&apos;/resource&apos;)            .replay(200, &apos;path matched&apos;);var scope = nock(&apos;http://www.example.com&apos;)            .get(/resource$/)            .reply(200, &apos;path using regex matched&apos;);var scope = nock(&apos;http://www.example.com&apos;)            .get(function(uri){              return uri.indexOf(&apos;cats&apos;) &amp;gt;= 0;             })             .reply(200, &apos;path using function matched&apos;);`&lt;/pre&gt;#### Specifying Request Bodyargument to the `get`, `post`, `put` or `delete` specifications like this:&lt;pre&gt;`var scope = nock(&apos;http://www.example.com&apos;)            .post(&apos;/users&apos;, {              username: &apos;PG&apos;,              email: &apos;example@mail.com&apos;             })             .reply(201, {              ok: true,              id: &apos;123ABC&apos;,              rev: &apos;946B7D1C&apos;             });`&lt;/pre&gt;The request body can be a string, a regexp, a jSON object or a function&lt;pre&gt;`var scope = nock(&apos;http://www.example.com&apos;)            .post(&apos;/users&apos;, /email=.?@gmail.com/gi)            .reply(201, {              ok: true,               id: &apos;123ABC&apos;,              rev: &apos;946B7D1C&apos;             });var scope = nock(&apos;http://www.example.com&apos;)            .post(&apos;/users&apos;, {              username: &apos;PG&apos;,              password: &apos;/a.+&apos;/,              email: &apos;preasfd@gmail.com&apos;             })             .reply(201, {                ok: true,                 id: &apos;123ABC&apos;,                rev: &apos;946B7D1C&apos;              })`&lt;/pre&gt;#### Specifying RepliesYou can specify the return status code for a path on the first argument of reply like this:&lt;pre&gt;`.reply(404)`&lt;/pre&gt;Or specify the reply body as a string:&lt;pre&gt;`.reply(200, &apos;Hello from google&apos;)`&lt;/pre&gt;or as a JSON-encoded object:&lt;pre&gt;`.reply(200, {  username: &apos;PG&apos;,  email: &apos;asdf@gmail.com&apos;,  _id: &apos;awefrf&apos;})`&lt;/pre&gt;or even as a file:&lt;pre&gt;`.replyWithFile(200, __dirname+&apos;/replies/user.json&apos;)`&lt;/pre&gt;An asynchronous function that gets an error-first callback as last argument also works:&lt;pre&gt;`.reply(201, function(uri, requestBody, cb){  fs.readFile(&apos;cat-poem.txt&apos;, cb); // Error-first callback});</code></pre>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æµè¯ </tag>
            
            <tag> Nock </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>æµè¯ç¯å¢æ­å»º(Mocha + Chai + Sinon)</title>
      <link href="/2016/08/28/e6-b5-8b-e8-af-95-e7-8e-af-e5-a2-83-e6-90-ad-e5-bb-bamocha-chai-sinon/"/>
      <content type="html"><![CDATA[<ul><li>Mocha: ç¨äºè¿è¡æµè¯ç¨ä¾</li><li>Chai: Mocha ç¨çæ­è¨åº</li><li>Sinon: ç¨äºåå»ºä¸äº mocks/stubs/spys</li></ul><p>AriBnB åå»ºäºä¸ä¸ªä¸é¨éå¯¹ React ä»£ç æµè¯çå¼æºç¨åº: Enzyme</p><h3 id="Mocha-å®è£åç¯å¢éç½®"><a href="#Mocha-å®è£åç¯å¢éç½®" class="headerlink" title="Mocha å®è£åç¯å¢éç½®"></a>Mocha å®è£åç¯å¢éç½®</h3><pre><code>npm install --save-dev mocha chai sinon`&lt;/pre&gt;å®è£æ¯æ ES6 è¯­æ³çæä»¶&lt;pre&gt;`npm install --save-dev babel-register`&lt;/pre&gt;### ç®åæµè¯ç¨ä¾Mocha é»è®¤ä¼å»å½åç®å½ä¸å¯»æ¾ test ç®å½, ç¶åå¨å¶ä¸­å»æ¾åç¼ä¸º js çæä»¶.å¦æéè¦ä¿®æ¹è¿ä¸ªç®å½, å¯ä»¥ç¨ Mocha çåæ°è®¾ç½®.&lt;pre&gt;`// index.spec.jsimport { expect } from &apos;chai&apos;;describe(&apos;hello react spac&apos;, () =&amp;gt; {  it(&apos;works!&apos;, ()=&amp;gt;{    expect(true).to.be.true;  });});`&lt;/pre&gt;å½ä»¤è¡&lt;pre&gt;`mocha --compilers js:babel-register`&lt;/pre&gt;å¦æä¸æ·»å `--compilers js:babel-register`, é£ä¹ mocha ä¼æç§é»è®¤çæ¹å¼æ§è¡, ä¹å°±æ¯`è¯»å spec æä»¶ -&amp;gt; è¿è¡æµè¯ç¨ä¾`. ä½¿ç¨äº`--compilers js:babel-register` ä¹å, æ§è¡é¡ºåºä¸º`è¯»å spec æä»¶ -&amp;gt; å° ES6 ä»£ç æ¿æ¢ ES5 ä»£ç  -&amp;gt; è¿è¡æµè¯ç¨ä¾`#### åå»ºæµè¯å·¥å·åº test_helper.jsæ³¨ææ¯ä¸ªæµè¯æä»¶ä¸­é½è¦å¼å¥ expect, æå¥½ç¨ä¸ä¸ªåºæ¥è¿è¡ç®¡ç. åå»ºä¸ä¸ªæ°çæä»¶`/test/test_helper.js`&lt;pre&gt;`// test/test_helper.jsimport { expect } from &apos;chai&apos;import sinon from &apos;sinon&apos;global.expect = expect;global.sinon = sinon;`&lt;/pre&gt;è¿éåªæ·»å äº chai ç expect ä»¥åå¼å¥äº sinonç°å¨å¯ä»¥å°`index.spec.js` çç¬¬ä¸è¡å é¤, å¹¶è¿è¡&lt;pre&gt;`mocha --compilers js:babel-register --require ./test/test_helper.js --recursive`&lt;/pre&gt;æèå¨ package.json ä¸­åå»º scripts&lt;pre&gt;`&quot;test&quot;::&quot;mocha --compilers js:babel-register --requrie ./test/test_helper.js --recursive&quot;,&quot;test:watch&quot;: &quot;npm test -- --watch&quot;</code></pre>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æµè¯ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Git Cheat Sheet</title>
      <link href="/2016/08/27/git-cheat-sheet/"/>
      <content type="html"><![CDATA[<ul><li>ååºå½åéç½®: <code>git config --list</code></li><li>ååº repository éç½®: <code>git config --local --list</code></li><li>ååºå¨å±éç½®: <code>git config --global --list</code></li><li><p>è®¾ç½® git è¾åºå½©è²: <code>git config --global color.ui auto</code></p></li><li><p>æ¾ç¤ºä¸ä¸æ¬¡æäº¤çæ¬çä¸å: <code>git diff</code></p></li><li><p>æäº¤åå²: <code>git log</code></p></li><li><p>æ¾ç¤ºæææäº¤åå²: <code>git log --oneline</code></p></li><li><p>ååºææåæ¯: <code>git branch</code></p></li><li><p>ååºè¿ç¨åæ¯: <code>git branch -r</code></p></li><li><p>åæ¢åæ¯: <code>git checkout &amp;lt;branch&amp;gt;</code></p></li><li><p>ç»å½åçæ¬æ·»å  tag: <code>git tag &amp;lt;tag-name&amp;gt;</code></p></li><li><p>ååºå½åéç½®çè¿ç¨ç«¯: <code>git remote -v</code></p></li><li><p>æ·»å è¿ç¨ç«¯: <code>git remote add &amp;lt;remote-name&amp;gt; &amp;lt;url&amp;gt;</code></p></li><li>ä¸è½½è¿ç¨ç«¯ä½ä¸ merge: <code>git fetch &amp;lt;remote&amp;gt;</code></li><li><p>ä¸è½½è¿ç¨ç«¯å¹¶èªå¨ merge: <code>git pull</code></p></li><li><p>å é¤è¿ç¨ç«¯åæ¯: <code>git push &amp;lt;remote&amp;gt; --delete &amp;lt;branch&amp;gt;</code></p></li><li><p>åå¸æ ç­¾: <code>git push --tags</code></p></li><li><p>åæ»å°ä¸ä¸ª commit: <code>git reset --hard HEAD</code></p></li><li><p>åæ»å°æä¸ªçæ¬: <code>git reset --hard &amp;lt;commit&amp;gt;</code></p></li><li>æ¸é¤ staged: <code>git reset HEAD</code></li></ul>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>JS ç Date</title>
      <link href="/2016/08/27/js-e7-9a-84-date/"/>
      <content type="html"><![CDATA[<pre><code>&amp;gt; var myDate = new Date()undefined&amp;gt; myDate.getYear()116&amp;gt; myDate.getFullYear()2016&amp;gt; myDate.getMonth() // 0 - 117&amp;gt; myDate.getDate() // 1 - 3128&amp;gt; myDate.getDay() // 0 - 6, è¥¿æ¹ä»¥å¨æ¥ä¸ºä¸å¨å¼å§, æä»¥0æ¯å¨æ¥0&amp;gt; myDate.getTime() // ä»1970.1.1å¼å§çæ¯«ç§æ°1472313859531&amp;gt; myDate.getHours()0&amp;gt; myDate.getMinutes()4&amp;gt; myDate.getSeconds()19&amp;gt; myDate.getMilliseconds()531&amp;gt; myDate.toLocaleDateString()&apos;2016-08-28&apos;&amp;gt; myDate.toLocaleString()&apos;2016-08-28 00:04:19&apos;</code></pre>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javascript </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>å¢å¼ºé¡µé¢æ¸²ææ§è½</title>
      <link href="/2016/08/26/e5-a2-9e-e5-bc-ba-e9-a1-b5-e9-9d-a2-e6-b8-b2-e6-9f-93-e6-80-a7-e8-83-bd/"/>
      <content type="html"><![CDATA[<h3 id="3D-transform-å¯ç¨-GPU-å é"><a href="#3D-transform-å¯ç¨-GPU-å é" class="headerlink" title="3D transform å¯ç¨ GPU å é"></a>3D transform å¯ç¨ GPU å é</h3><p>ä¾å¦ transform3D, scaleZ ç­å¯ä»¥å¼å¯æµè§å¨ç¡¬ä»¶å é</p><p>å®éä¸å¹¶ä¸éè¦ Z è½´çå¨ç»</p><h3 id="will-change"><a href="#will-change" class="headerlink" title="will-change"></a>will-change</h3><p>å½æä»¬çæäºè¡ä¸ºè§¦åé¡µé¢è¿è¡å¤§é¢ç§¯ç»å¶çæ¶å, æµè§å¨å¾å¾æ¯æ²¡æåå¤ç, åªè½è¢«å¨ä½¿ç¨ CPU å»è®¡ç®ä¸éç». è<code>will-change</code>ä¼å¨çæ­£è¡ä¸ºè§¦åä¹åéç¥æµè§å¨, ä»¥å¼å¯ GPU åå¤éç».</p><p>è¯¥å±æ§è¯­æ³:</p><pre><code>will-change: auto;will-change: scroll-position;will-change: contents;will-change: trasnform; // or somewill-change: opacity; // or somewill-change: left,top; // or somewill-change:inherit;will-change:initial;will-change: unset;`&lt;/pre&gt;å¶ä¸­ auto æ¯ç¨æ¥éç½®çscroll-position æ¯éç¥æ»å¨contents æ¯éç¥åå®¹å¨ç»### æ³¨æäºé¡¹`will-change` è½ç¶å¯ä»¥å é, ä½ä¸å®è¦éåº¦ä½¿ç¨. é¢ç¹ä½¿ç¨ GPU æ¾ç¶ä¼å¯¼è´æ§è½(çµé)æ¶èä¸è¦ç´æ¥åå¨é»è®¤ç¶æä¸­, å ä¸º`will-change`ä¼ä¸ç´æç:&lt;pre&gt;`.will-change{  will-change: transform;  transition: transform .3s;}.will-change:hover{  transform: scale(1.5);}`&lt;/pre&gt;å¯ä»¥è®©ç¶åç´  hover çæ¶åå£°æ`will-change`, è¿æ ·, ç§»åºçæ¶ååèªå¨`remove`, è§¦åè¿ååºæ¬ä¸æ¯ææåç´ èå´&lt;pre&gt;`.will-change-parent:hover .will-change{  will-change:transform;}.will-change{  transition:transform .3s}.will-change:hover{  transform:scale(1.5)}</code></pre><p>å¦æä½¿ç¨ JS æ·»å <code>will-change</code>ä¸å®è¦åæ¶ remove</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS3 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Clip-Path, Polygon å¾å½¢æå»º</title>
      <link href="/2016/08/26/clip-path-polygon-e5-9b-be-e5-bd-a2-e6-9e-84-e5-bb-ba/"/>
      <content type="html"><![CDATA[<p>clip-path çåèº«æ¯ SVG, æ¯æäºç»´åæ </p><p>polygon çä½ç¨æ¯æ ¹æ®äºç»´ç¹åæ , ä¾æ¬¡è¿çº¿, æåé­åå½¢æé®ç½©åºå</p><p>clip-path:polygon çæä¸è§å½¢çè¿ç¨éå¸¸ç®å</p><pre><code>.path{  clip-path: polygon(5px, 10px, 16px, 3px, 16px, 17px);}</code></pre><p>polygon å¯¹ç¹çæ°ç®æ²¡æéå¶, æä»¥å¯ä»¥çæåç§å ä½å¾æ¡</p><p>clip-path è¿å¯ä»¥ç¨ transition è¿æ¸¡æè animation å¨ç», å¾å¥½çå¼¥è¡¥äº CSS3 ç transform åæ¢çä¸è¶³</p><p>polygon å¨ç»æä¸ä¸ªéè¦åæ, é£å°±æ¯åæ çæ°ç®å¨ååååå¿é¡»ä¸æ ·. è¿æ ·å°±æµè§å¨å°±è½å®ç°è¿ç»­å¨ç».</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS3 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Node.js ä¹ Path æ¨¡å</title>
      <link href="/2016/08/26/node-js-e4-b9-8b-path-e6-a8-a1-e5-9d-97/"/>
      <content type="html"><![CDATA[<p>pathæ¨¡åç¨äºè§èåè·¯å¾è¿æ¥åè§£æè·¯å¾.</p><p>pathçåè½åæ¬ä¸ä»éäº:</p><ul><li>è§èåè·¯å¾</li><li>è¿æ¥è·¯å¾</li><li>è·¯å¾è§£æ</li><li>æ¥æ¾ä¸¤ä¸ªç»å¯¹è·¯å¾çç¸å¯¹å³ç³»</li><li>æåè·¯å¾çç»æé¨å</li></ul><h3 id="è§èåè·¯å¾-path-normalize-p"><a href="#è§èåè·¯å¾-path-normalize-p" class="headerlink" title="è§èåè·¯å¾ path.normalize(p)"></a>è§èåè·¯å¾ path.normalize(p)</h3><p>path æ¨¡åä¸­ç normalize(p) ç¨æ¥è§èåè·¯å¾, å¯ç¨äºå¤çè·¯å¾ä¸­ç <code>//</code>, <code>..</code>, <code>.</code>ç­.</p><pre><code>var path = require(&apos;path&apos;);path.normalize(&apos;./foo/bar//baz/asfd/que/..&apos;);// å¤çå&apos;foo/bar/baz/asfd&apos;`&lt;/pre&gt;### è¿æ¥è·¯å¾ path.join([path1][, path2][, ...])å°ä»»æä¸ªè·¯å¾å­ç¬¦ä¸²è¿æ¥, åæ¶ä¹ä¼å¯¹è·¯å¾è¿è¡è§èå&lt;pre&gt;`var path = require(&apos;path&apos;);//åæ³çå­ç¬¦ä¸²è¿æ¥path.join(&apos;./foo&apos;, &apos;bar&apos;, &apos;baz/asdf&apos;, &apos;quux&apos;, &apos;..&apos;)// è¿æ¥å&apos;foo/bar/baz/asfd&apos;// ä¸åæ³çå­ç¬¦ä¸²å°æåºå¼å¸¸path.join(&apos;foo&apos;,{}, bar) =&amp;gt; TypeError: Arguments to path.join must be strings`&lt;/pre&gt;### è·¯å¾è§£æ path.resolve([from...], to)path.resolve æ¹æ³å¯ä»¥å°å¤ä¸ªè·¯å¾è§£æä¸ºä¸ä¸ªè§èåçç»å¯¹è·¯å¾, å¶å¤çæ¹æ³ç±»ä¼¼äºå¯¹è¿äºè·¯å¾éä¸è¿è¡ cd æä½, ä¸ cd æä½ä¸åçæ¯, è¿å¼èµ·è·¯å¾å¯ä»¥æ¯æä»¶, èä¸å¯ä¸å¿å®éå­å¨, ä»æ¯å­ç¬¦ä¸²æä½&lt;pre&gt;`path.resolve(&apos;foo/bar&apos;,&apos;/tmp/file/&apos;,&apos;..&apos;,&apos;a/../subfile&apos;)`&lt;/pre&gt;ç¸å½äº&lt;pre&gt;`cd foo/barcd /temp/file/cd ..cd a/../subfile`&lt;/pre&gt;å¦æè§£æçä¸æ¯ç»å¯¹è·¯å¾, path.resolve() ä¼å°å½åå·¥ä½ç®å½å å°è§£æç»æå&lt;pre&gt;`path.resolve(&apos;wooroot&apos;,&apos;bar&apos;,&apos;./baz&apos;)// å½åå·¥ä½è·¯å¾æ¯/home/node, åè¾åºç»ææ¯&apos;/home/node/wooroot/bar/baz&apos;`&lt;/pre&gt;### æ¥æ¾ä¸¤ä¸ªç»å¯¹è·¯å¾ä¹é´çç¸å¯¹å³ç³» path.relative(from, to)&lt;pre&gt;`path.relative(&apos;/Users/node/demo&apos;, &apos;/Users/node&apos;) =&amp;gt; &apos;..&apos;</code></pre><h3 id="æåè·¯å¾çç»æé¨å-path-dirname-p-path-basename-p-ext-path-extname-p"><a href="#æåè·¯å¾çç»æé¨å-path-dirname-p-path-basename-p-ext-path-extname-p" class="headerlink" title="æåè·¯å¾çç»æé¨å path.dirname(p), path.basename(p[,ext]), path.extname(p)"></a>æåè·¯å¾çç»æé¨å path.dirname(p), path.basename(p[,ext]), path.extname(p)</h3><p>path.dirname =&gt; æä»¶è·¯å¾ä¸­çç®å½é¨å<br>path.basename =&gt; æä»¶è·¯å¾ä¸­çæä»¶é¨å<br>path.extname =&gt; æä»¶è·¯å¾ä¸­çæä»¶æ©å±å</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NODE </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>React-Router Documents</title>
      <link href="/2016/08/26/react-router-documents/"/>
      <content type="html"><![CDATA[<p>å®è£</p><pre><code>npm install history react-router@latest`&lt;/pre&gt;react-router ä¾èµ history æ¨¡å&lt;pre&gt;`import {Router, Route, Link} from &apos;react-router&apos;å¯ä»¥ä» lib ç®å½ require éè¦çé¨å`&lt;/pre&gt;import { Router } from &apos;react-router/lib/Router&apos;&lt;pre&gt;`import React from &apos;react&apos;import { Router, Route, Link } from &apos;react-router&apos;const App = React.createClass({/*..*/})const About = React.createClass({/*...*/})const Users = React.createClass({  render(){    return(      &amp;lt;div&amp;gt;        &amp;lt;h1&amp;gt;Users&amp;lt;/h1&amp;gt;        &amp;lt;div className = &quot;master&quot;&amp;gt;          &amp;lt;ul&amp;gt;            {/* å¨æ¬åºç¨ä¸­ç¨ Link å»é¾æ¥è·¯ç±*/}            {this.state.users.map(user =&amp;gt; (              &amp;lt;li key={user.id}&amp;gt;&amp;lt;Link to={`/user/${user.id}`}&amp;gt;{user.name}&amp;lt;/Link&amp;gt;&amp;lt;/li&amp;gt;            ))}          &amp;lt;/ul&amp;gt;        &amp;lt;/div&amp;gt;        &amp;lt;div className =&quot;detail&quot;&amp;gt;          {this.props.children}        &amp;lt;/div&amp;gt;      &amp;lt;/div&amp;gt;    )  }})const User = React.createClass({  componentDidMount(){    this.setState({      // è·¯ç±åºè¯¥éè¿æç¨çä¿¡æ¯æ¥åç°, æ¯å¦ URL çåæ°      user: findUserById(this.props.params.userId)    })  },  render(){    return(      &amp;lt;div&amp;gt;        &amp;lt;h2&amp;gt;{this.state.user.name}&amp;lt;/h2&amp;gt;        {/* ç­ç­ */}      &amp;lt;/div&amp;gt;    )  }})/** * è·¯ç±éç½®è¯´æ(ä¸ç¨å è½½æ´ä¸ªéç½®, åªéè¦å è½½ä¸ä¸ªæ³è¦çè·è·¯ç±, ä¹å¯ä»¥å»¶è¿å è½½è¿ä¸ªéç½®) */React.render(  (&amp;lt;Router&amp;gt;    &amp;lt;Route path = &quot;/&quot; component = {App}&amp;gt;      &amp;lt;Route path = &quot;about&quot; component = {About}/&amp;gt;        &amp;lt;Route path = &quot;users&quot; component = {Users}&amp;gt;          &amp;lt;Route path = &quot;/user/:userId&quot; component = {User}/&amp;gt;        &amp;lt;/Route&amp;gt;        &amp;lt;Route path = &quot;*&quot; component = {NoMatch}/&amp;gt;    &amp;lt;/Route&amp;gt;  &amp;lt;/Router&amp;gt;),  document.body)`&lt;/pre&gt;&lt;pre&gt;`import React from &apos;react&apos;import { render } from &apos;react-dom&apos;import { Router, Route, Link } from &apos;react-router&apos;const App = React.createClass({  render(){    return (      &amp;lt;div&amp;gt;        &amp;lt;h1&amp;gt;App&amp;lt;/h1&amp;gt;        {/* æ &amp;lt;a&amp;gt; åæ &amp;lt;Link&amp;gt; */}        &amp;lt;ul&amp;gt;          &amp;lt;li&amp;gt;&amp;lt;Link to=&quot;/about&quot;&amp;gt;&amp;lt;/Link&amp;gt;&amp;lt;/li&amp;gt;          &amp;lt;li&amp;gt;&amp;lt;Link to=&quot;/inbox&quot;&amp;gt;&amp;lt;/Link&amp;gt;&amp;lt;/li&amp;gt;        &amp;lt;/ul&amp;gt;        {/*          æ¥çç¨` this.props.children` æ¿æ¢`&amp;lt;Child&amp;gt;`, this.props.children å°±æ¯ App çå­ç»ä»¶ Inbox å About        */}       {this.props.children}      &amp;lt;/div&amp;gt;    )  }})React.render((  &amp;lt;Router&amp;gt;    &amp;lt;Route path = &quot;/&quot; component = {App}&amp;gt;      &amp;lt;Route path=&quot;about&quot; component = {About}      &amp;lt;Route path=&quot;inbox&quot; component = {Inbox}    &amp;lt;/Route&amp;gt;  &amp;lt;/Router&amp;gt;))`&lt;/pre&gt;&lt;pre&gt;`const Message = React.createClass({  render(){    return(      &amp;lt;h3&amp;gt;Message&amp;lt;/h3&amp;gt;    )  }})const Inbox = React.createClass({  render(){    return(      &amp;lt;div&amp;gt;        &amp;lt;h2&amp;gt;Inbox&amp;lt;/h2&amp;gt;        {this.props.children||&apos;Welcome to your inbox&apos;}      &amp;lt;/div&amp;gt;    )  }})React.render((  &amp;lt;Router&amp;gt;    &amp;lt;Route path=&quot;/&quot; component = {App}&amp;gt;      &amp;lt;Route path =&quot;about&quot; component = {About} /&amp;gt;      &amp;lt;Route path =&quot;inbox&quot; component = {Inbox}&amp;gt;        &amp;lt;Route path=&quot;message/:id&quot; component={Message}/&amp;gt;      &amp;lt;/Route&amp;gt;        &amp;lt;/Route&amp;gt;  &amp;lt;/Router&amp;gt;),document.body)`&lt;/pre&gt;è®¿é® URL = inbox/message/Jkei ä¼å¹éä¸ä¸ªæ°è·¯ç±, å¶æå App =&gt; Inbox =&gt; Message&lt;pre&gt;`&amp;lt;App&amp;gt;  &amp;lt;Inbox&amp;gt;    &amp;lt;Message params = {id: &quot;Jkei&quot;} /&amp;gt;  &amp;lt;/Inbox&amp;gt;&amp;lt;/App&amp;gt;`&lt;/pre&gt;### è·å URL åæ°ä¸ºäºä»æå¡å¨è·å message æ°æ®, æä»¬é¦åéè¦ç¥éä»çä¿¡æ¯, å½æ¸²æç»ä»¶çæ¶å, React Router èªå¨å Route ç»ä»¶æ³¨å¥ä¸äºæç¨çä¿¡æ¯, å°¤å¶æ¯è·¯å¾ä¸­å¨æé¨åçåæ°, æ¯å¦ä¸ä¾ä¸­ç`:id`&lt;pre&gt;`const Message = React.createClass({  componentDidMount(){    const id = this.props.params.id    fetchMessgae(id,function(err,message){      this.setState({message:message})    })  }})`&lt;/pre&gt;### è·¯ç±éç½®è·¯ç±éç½®æ¯ä¸ç»æä»¤, ç¨æ¥åè¯ router å¦ä½å¹é URL, ä»¥åå¹éåçå¨ä½.&lt;pre&gt;`import React from &apos;react&apos;import {Router, Route, Link} from &apos;react-router&apos;const App = React.createClass({  render(){    return(      &amp;lt;div&amp;gt;        &amp;lt;h1&amp;gt;App&amp;lt;/h1&amp;gt;        &amp;lt;ul&amp;gt;          &amp;lt;li&amp;gt;&amp;lt;Link to=&quot;/about&quot;&amp;gt;About&amp;lt;/Link&amp;gt;&amp;lt;/li&amp;gt;          &amp;lt;li&amp;gt;&amp;lt;Link to=&quot;/inbox&quot;&amp;gt;Inbox&amp;lt;/Link&amp;gt;&amp;lt;/li&amp;gt;        &amp;lt;/ul&amp;gt;        {this.props.children}      &amp;lt;/div&amp;gt;    )  }})const About = React.createClass({  render(){    return &amp;lt;h3&amp;gt;About&amp;lt;/h3&amp;gt;  }})const Inbox = React.createClass({  render(){    return(      &amp;lt;div&amp;gt;        &amp;lt;h2&amp;gt;Inbox&amp;lt;/h2&amp;gt;        {this.props.children || &apos;Welcome to your Inbox&apos;}      &amp;lt;/div&amp;gt;    )  }})const Message = React.createClass({  render(){    return &amp;lt;h3&amp;gt;Message {this.props.params.id}&amp;lt;/h3&amp;gt;  }})React.render((  &amp;lt;Router&amp;gt;    &amp;lt;Route path = &quot;/&quot; component = {App}&amp;gt;      &amp;lt;Route path = &quot;about&quot; component = {About} /&amp;gt;      &amp;lt;Route path = &quot;inbox&quot; component = {Inbox}&amp;gt;        &amp;lt;Route path = &quot;message/:id&quot; component = {Message} /&amp;gt;      &amp;lt;/Route&amp;gt;    &amp;lt;/Route&amp;gt;  &amp;lt;/Router&amp;gt;),document.body)`&lt;/pre&gt;### æ·»å é¦é¡µå½ URL ä¸º &quot;/&quot; çæ¶å, æ¸²æç App ç»ä»¶ç render ä¸­ç this.props.children è¿æ¯ undefined, è¿ç§æåµæä»¬å¯ä»¥ä½¿ç¨`IndexRoute`æ¥è®¾ç½®ä¸ä¸ªé»è®¤é¡µ&lt;pre&gt;`import {IndexRoute} from &apos;react-router&apos;const Dashboard = React.createClass({  render(){    return &amp;lt;div&amp;gt;Welcome to the App!&amp;lt;/div&amp;gt;  }})React.render((  &amp;lt;Router&amp;gt;    {/* å½ URL ä¸º / çæ¶åæ¸²æ Dashboard*/}    &amp;lt;IndexRoute component = {Dashboard} /&amp;gt;    &amp;lt;Route path=&quot;about&quot; component = {About} /&amp;gt;  &amp;lt;/Router&amp;gt;),document.body)`&lt;/pre&gt;ç°å¨ç Sitemap å¦ä¸:&lt;table&gt;&lt;thead&gt;&lt;tr&gt;  &lt;th&gt;URL&lt;/th&gt;  &lt;th&gt;Component&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;  &lt;td&gt;/&lt;/td&gt;  &lt;td&gt;App =&gt; Dashboard&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;  &lt;td&gt;/about&lt;/td&gt;  &lt;td&gt;App =&gt; About&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;### å° UI äº URL è§£è¦å¦ææä»¬å¯ä»¥å° `/inbox` ä» `/inbox/message:id` ä¸­å»é¤, å¹¶ä¸è¿è½å¤è®© Message åµå¥å¨ App-&gt;Inbox ä¸­æ¸²æ, é£ä¼éå¸¸èµ, ç»å¯¹è·¯å¾å¯ä»¥åå°è¿ä¸ç¹&lt;pre&gt;`React.render((  &amp;lt;Router&amp;gt;    &amp;lt;Route path = &quot;/&quot; component = {App}&amp;gt;      &amp;lt;IndexRoute component = {Dashboard} /&amp;gt;      &amp;lt;Route path = &quot;inbox&quot; component = {Inbox} &amp;gt;        &amp;lt;Route path = &quot;/message:id&quot; component = {Message} /&amp;gt;      &amp;lt;/Route&amp;gt;    &amp;lt;/Route&amp;gt;  &amp;lt;/Router&amp;gt;),document.body)`&lt;/pre&gt;å¨å¤å±åµå¥è·¯ç±ä¸­ä½¿ç¨æè§å¯¹è·¯å¾å¯ä»¥æé«é»è¾æ§.Simtemap å¦ä¸:&lt;table&gt;&lt;thead&gt;&lt;tr&gt;  &lt;th&gt;URL&lt;/th&gt;  &lt;th&gt;Component&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;  &lt;td&gt;/&lt;/td&gt;  &lt;td&gt;App =&gt; Dashboard&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;  &lt;td&gt;/message/:id&lt;/td&gt;  &lt;td&gt;App =&gt; Inbox =&gt; Message&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;æé, ç»å¯¹è·¯å¾å¯è½å¨å¨æè·¯ç±ä¸­æ æ³ä½¿ç¨åæ¶, ä¸è¿°éç½®å­å¨ä¸ä¸ªé®é¢, å½ç¨æ·è®¿é®/inbox/message/6çæ¶ååæ æ³è®¿é®ä½¿ç¨&amp;lt;Redirect&gt;ä¿®æ­£&lt;pre&gt;`&amp;lt;Route path = &quot;indox&quot; component = {Indox} &amp;gt;  &amp;lt;Route path = &quot;/message/:id&quot; component = {Message} /&amp;gt;  &amp;lt;Redirect from = &quot;message/:id&quot; to = &quot;/message/:id&quot; /&amp;gt;&amp;lt;/Route&amp;gt;`&lt;/pre&gt;### è¿å¥åç¦»å¼ç HookRoute å¯ä»¥å®ä¹ `onEnter` å `onLeave` ä¸¤ä¸ª Hook, è¿äº hook ä¼å¨é¡µé¢è·³è½¬ç¡®è®¤æ¶è§¦åä¸æ¬¡,å¨è·¯ç±è·³è½¬è¿ç¨ä¸­, `onLeave` hook ä¼å¨ç±ææå°ç¦»å¼çè·¯ç±ä¸­è§¦å, ä»æä¸å±çèªè·¯ç±å¼å§ç´å°æå¤å±çç¶è·¯ç±ç»æ, è`onEnter` hook åä»èªå¤å±çç¶è·¯ç±å¼å§ç´å°æä¸å±çå­è·¯ç±ç»ææ¯å¦ä» /message/5 -&gt; /about ä¾æ¬¡è§¦å- /message/:id ç onLeave- /inbox ç onLeave- /about ç onEnter### è·¯ç±å¹éåçè·¯ç±æ¥æä¸ä¸ªå±æ§æ¥å³å®æ¯å¦å¹éä¸ä¸ª URL- åµå¥å³ç³»- è·¯å¾è¯­æ³- ä¼åçº§#### åµå¥å³ç³»å½ä¸ä¸ªç»å®ç URL è¢«è°ç¨æ¶, æ´ä¸ªéå(å½ä¸­çé¨å)é½ä¼è¢«æ¸²æ, åµå¥è·¯ç±è¢«æè¿°æä¸ç§æ å½¢ç»æ, React Router ä¼æ·±åº¦ä¼åéåæ´ä¸ªè·¯ç±éç½®æ¥å¯»æ¾ä¸ä¸ªä¸ç»å®ç URL å¹éçè·¯ç±#### è·¯å¾è¯­æ³è·¯ç±è·¯å¾æ¯å¹éä¸ä¸ª(æä¸é¨å) URL çä¸ä¸ªå­ç¬¦ä¸²æ¨¡å¼, å¤§é¨åçè·¯ç±è·¯å¾é½å¯ä»¥æç§å­é¢éçè§£, é¤äºä¸ä¸å ä¸ªç¹æ®å­ç¬¦:- `:paramName` - å¹éä¸æ®µä½äº`/`,`?`, `#`ä¹åç URL, å½ä¸­çé¨åä½ä¸ºä¸ä¸ªåæ°- `()` - åé¨çåå®¹è¢«è®¤ä¸ºæ¯å¯éç- `*` - å¹éä»»æå­ç¬¦(éè´ªå©ª)ç´å°å½ä¸­ä¸ä¸ä¸ªå­ç¬¦ææ´ä¸ª URL çæ«å°¾, å¹¶åå»ºä¸ä¸ª splat åæ°&lt;pre&gt;`&amp;lt;Route path = &apos;/hello/:name&apos; /&amp;gt; // å¹é /hello/michael å /hello/john&amp;lt;Route path = &apos;/hello/(:name)&apos;/&amp;gt; // å¹é /hello, /hello/michael, /hello/john&amp;lt;Route path = &apos;/files/*.*&apos; /&amp;gt; // å¹é files/hello.js, files/hello.jpg`&lt;/pre&gt;ä½¿ç¨ç»å¯¹è·¯å¾å¯ä»¥ä½¿è·¯ç±å¿½ç¥åµå¥å³ç³»#### ä¼åçº§åå¼è·¯ç±çåä¸ä¸ªä¼åçº§é«### HistoriesReact Router æ¯å»ºç«å¨ history ä¹ä¸ç, ä¸ä¸ª history ç¥éå¦ä½å»çå¬æµè§å¨å°ååå, å¹¶è§£æè¿ä¸ª URL è½¬åä¸º location å¯¹è±¡, ç¶å router ä½¿ç¨å®å¹éå°è·¯ç±. æåæ­£ç¡®æ¸²æç»ä»¶å¸¸ç¨ç history æä¸ç§å½¢å¼- createHashHistory- createBrowserHistory- createMemoryHistoryä» history åºä¸­è·åä»ä»¬&lt;pre&gt;`import createBrowserHistory from &apos;history/lib/createBrowserHistory&apos;`&lt;/pre&gt;#### createHashHistoryè¿æ¯ä¸ä¸ªä½ ä¼è·å¾çé»è®¤ history, å¦æä¸æå®æä¸ª history (å³&amp;lt;Router&gt;{...}&amp;lt;/Router&gt;) ä»ç¨å°çæ¯ URL ä¸­ç hash(#) é¨åå»åå»ºå½¢å¦ example.com/#/some/path çè·¯ç±HashHistory æ¯é»è®¤ç, å¯ä»¥å¨æå¡å¨ä¸­ä¸ä½ä»»ä½éç½®å°±å¯ä»¥è¿è¡, å¹¶ä¸å¨å¨é¨æµè§å¨ä¸­é½å¯ä»¥ä½¿ç¨, ä½æ¯ä¸æ¨èå®éçäº§ä¸­ä½¿ç¨å®, å ä¸ºæ¯ä¸ä¸ª web åºç¨é½åºè¯¥æç®çå°å»ä½¿ç¨ createBrowserHistory#### å`?_k=ckuvup` æ²¡ç¨çå¨ URL ä¸­æ¯ä»ä¹?å½ä¸ä¸ª history éè¿åºç¨ç¨åºç`pushState`æ`replaceState`è·³è½¬æ¶, ä»å¯ä»¥å¨æ°ç location ä¸­å­å¨&quot;lcoation state&quot; èä¸ç°å®å¨ URL ä¸­, å°±åå¨ä¸ä¸ª HTML ä¸­ post çè¡¨åæ°æ®å¨ DOM API ä¸­, è¿äº hash history éè¿ window.location.hash = newHash å¾ç®åå°è¢«ç¨äº, ä¸ä¸ç¨å­å¨ä»ä»¬ç location state, ä½æ¯æä»¬å¸æå¨é¨ç history é½è½å¤ä½¿ç¨ location state, å æ­¤è¦ä¸ºæ¯ä¸ª location æ·»å ä¸ä¸ªå¯ä¸ç key, å¹¶æä»ä»¬çç¶æå­å¨å¨ session storage ä¸­, å½è®¿å®¢ç¹å»åè¿æåéçæ¶å, å¯ä»¥æ¢å¤è¿äº location state.#### createBrowserHistoryè¿æ¯ react-router åå»ºæµè§å¨åºç¨æ¨èç History, ä½¿ç¨ History API å¨æµè§å¨ä¸­è¢«åå»ºç¨äºå¤ç URL, æ°å»ºä¸ä¸ªåè¿æ ·çå®ç URL: example.com/some/path##### æå¡å¨éç½®é¦åæå¡å¨åºè¯¥è½å¤å¤ç URL è¯·æ±, å¤çåºç¨å¯å¨æåç`/`è¿æ ·çè¯·æ±åºè¯¥æ²¡é®é¢,ä½æ¯å½ç¨æ·æ¥åè·³è½¬å¹¶å¨`/ accounts/23`å·æ°æ¶, æå¡å¨ä¼åå°æ¥èª`/account/23`çè¯·æ±, è¿æ¶ä½ å°±éè¦å¤çè¿ä¸ª URL å¹¶å¨ååºä¸­åå« JS ç¨åºä»£ç ä¸ä¸ª express çåºç¨çèµ·æ¥å¯è½æ¯è¿æ ·ç:&lt;pre&gt;`const express = require(&apos;express&apos;)const path = require(&apos;path&apos;)const port = process.env.PORT || 8080const app = express()// éå¸¸ç¨äºå è½½éæèµæºapp.use(express.static(__dirname + &apos;/public&apos;))// å¨ä½ åºç¨ JS æä»¶ä¸­åå«ä¸ä¸ª script æ ç­¾ç index.html ä¸­å¤çä»»ä½ä¸ä¸ª routeapp.get(&apos;*&apos;,function(request, response){  response.sendFile(path.resolve(__dirname, &apos;public&apos;, &apos;index.html&apos;)})app.listen(port)console.log(&apos;server started on port&apos; + port)`&lt;/pre&gt;å½æå¡å¨æ¾ä¸å°å¶ä»æä»¶çæ¶å, æå¡å¨çæéææä»¶åæä½ index.html æä»¶.### å®ä¾å±ç¤º&lt;pre&gt;`import React from &apos;react&apos;import createBrowserHistory from &apos;history/createBrowserHistory&apos;import { Router, Route, IndexRoute } from &apos;react-router&apos;import App from &apos;../componnents/App&apos;import Home from &apos;../componnents/Home&apos;import About from &apos;../componnents/About&apos;import Features from &apos;../componnents/Features&apos;React.render(  &amp;lt;Router history = {createBrowserHistory()} &amp;gt;    &amp;lt;Route path = &apos;/&apos; component = {App} &amp;gt;      &amp;lt;IndexRoute component = {Home} /&amp;gt;      &amp;lt;Route path = &apos;about&apos; component = {About} /&amp;gt;      &amp;lt;Route path = &apos;features&apos; component = {Features} /&amp;gt;    &amp;lt;/Route&amp;gt;  &amp;lt;/Router&amp;gt;, document.body)`&lt;/pre&gt;### é»è®¤è·¯ç±(IndexRoute)ä¸ IndexLinkå¦æè®¾ç½®äº IndexRoute =&gt; Home, å°±è¦è®¾ç½®è·³è½¬å° Home çè·¯ç±&apos;/&apos;, å³`&amp;lt;Link to=&apos;/&apos;&amp;gt;Home&amp;lt;/Link&amp;gt;`, ä»ä¼ä¸ç´å¤äºæ¿æ´»ç¶æ(å ä¸ºææå­è·¯ç±é½ç»è¿&apos;/&apos;), æä»¬ä»å¸æå¨ Home è¢«æ¸²æåæ¿æ´»å¹¶è¿æ¥å°ä», å³éè¦å¨ Home è·¯ç±è¢«æ¸²æåææ¿æ´»æå&apos;/&apos; çé¾æ¥, è¯·ä½¿ç¨`&amp;lt;IndexLink to=&apos;/&apos;&amp;gt;Home&amp;lt;/IndexLink&amp;gt;`### å¨æè·¯ç±React Router éç¨äºå°åç½ç«, ä¹å¯ä»¥æ¯æå¤§åç½ç«å¯¹äºå¤§ååºç¨èè¨, ä¸ä¸ªé¦å½å¶å²çé®é¢å°±æ¯æéè¦å è½½ç JS çå¤§å°, ç¨åºåºå½åªå è½½å½åæ¸²æé¡µéè¦çç JS, æäºå¼åèç§°ä¹ä¸º&quot;ä»£ç æå&quot;, å¨ç¨æ·æµè§è¿ç¨ä¸­æéå è½½å¯¹äºåºå±ç»èçä¿®æ¹ä¸åºè¯¥éè¦ä»ä¸é¢æ¯ä¸å±çº§é½è¿è¡ä¿®æ¹, ä¸¾ä¸ªä¾å­, ä¸ºä¸ä¸ªç§çæµè§é¡µæ·»å ä¸ä¸ªè·¯å¾ä¸åºè¯¥å½±åå°é¦é¡µå è½½ç JS å¤§å°, ä¹ä¸è½å ä¸ºå¤ä¸ªå¢éå±ç¨ä¸ä¸ªå¤§åè·¯ç±éç½®æä»¶äºé æåå¹¶æ¶çå²çª.è·¯ç±æ¯ä¸ªéå¸¸éååä»£ç æåçå°æ¹: ä»çè´£ä»»å°±æ¯éç½®å¥½æ¯ä¸ª viewReact Routerzhogn çè·¯å¾å¹éåç»ä»¶å è½½é½æ¯å¼æ­¥å®æç, ä¸ä»åè®¸ä½ å»¶è¿å è½½ç»ä»¶, **å¹¶ä¸å¯ä»¥å»¶è¿å è½½è·¯ç±éç½®**. å¨é¦æ¬¡å è½½åä¸­ä½ åªéè¦æä¸ä¸ªè·¯å¾å®ä¹, è·¯ç±ä¼èªå¨è§£æå©ä¸çè·¯å¾Route å¯ä»¥å®ä¹`getChildRoutes`, `getIndexRoute`, å`getComponents` è¿å ä¸ªå½æ°, ä»ä»¬é½æ¯å¼æ­¥æ§è¡ç, å¹¶ä¸åªæéè¦æ¶è¢«è°ç¨, è¿ç§æ¹å¼æä¸º&quot;éæ¸å¹é&quot;React Router ä¼éæ¸å°å¹é URL å¹¶ä¸åªå è½½è¯¥ URL å¯¹åºé¡µé¢æéè¦è·¯å¾éç½®åç»ä»¶å¦æéå webpack ä»£ç æåå·¥å·ä½¿ç¨çè¯, ä¸ä¸ªåæ¬ç¹ççæ¶æå°±ä¼åå¾ç®æ&lt;pre&gt;`const CourseRoute = {  path: &apos;course/:courseId&apos;,  /* å½ get routes/indexRoute/Component çæ¶å require ç¸åºçèµæº  getChildRoutes(location, callback){    require.ensure([],function(require){      callback(null, [        require(&apos;./routes/Announcements&apos;),        require(&apos;./routes/Assignments&apos;),        require(&apos;./routes/Grades&apos;)      ])    })  },  getIndexRoute(location, callback){    require.ensure([], function(require){      callback(null, require(&apos;./components/Index&apos;))    })  },  getComponents(location, callback){    require.ensure([],function(require){      callback(null, requrie(&apos;./components/Course&apos;))    })  }}`&lt;/pre&gt;### è·³è½¬åç¡®è®¤React Router æä¾ä¸ä¸ª`routerWillLeave` çå½å¨æé©å­, è¿ä½¿å¾ React å¯ä»¥æ¦æªæ­£å¨åççè·³è½¬, æèå¨ç¦»å¼ Route åæç¤ºç¨æ·`routerWillLeave` è¿åå¼æä¸ä¸ä¸¤ç§:1\. `return false` åæ¶æ­¤æ¬¡è·³è½¬2\. `return` è¿åæç¤ºä¿¡æ¯, å¨ç¦»å¼ route åæç¤ºç¨æ·è¿è¡ç¡®è®¤å¨ Route ç»ä»¶ä¸­å¼å¥`Lifecycle` mixin æ¥å®è£è¿ä¸ªé©å­&lt;pre&gt;`import { Lifecycle } from &apos;react-router&apos;const Home = React.createClass({  mixins: [Lifecycle],  routerWillLeave(nextLocation){    if(!this.state.isSaved){      return &apos;Your work is not saved!&apos;    }  }})`&lt;/pre&gt;### æå¡ç«¯æ¸²ææå¡ç«¯æ¸²æä¸å®¢æ·ç«¯æ¸²ææäºè®¸ä¸å, éè¦- åçéè¯¯çæ¶ååéä¸ä¸ª`500`ååº- éè¦éå®åæ¶åéä¸ä¸ª`30x`ååº- éè¦å¨æ¸²æä¹åè·å¾æ°æ®(ç¨ router å®æ)### ç»ä»¶çå½å¨æè·¯ç±éç½®å¦ä¸:&lt;pre&gt;`&amp;lt;Route path = &apos;/&apos; component = {App} &amp;gt;  &amp;lt;IndexRoute component = {Home} /&amp;gt;  &amp;lt;Route path = &apos;invoices/:invoiceId&apos; component = {Invoice}/&amp;gt;  &amp;lt;Route path = &apos;accounts/:accountId&apos; component = {Account}/&amp;gt;&amp;lt;/Route&amp;gt;`&lt;/pre&gt;#### è·¯ç±åæ¢æ¶, ç»ä»¶çå½å¨æçåå</code></pre><ol><li>å½ç¨æ·æå¼â/â é¡µé¢<br><table><br><thead><br><tr><br>  <th>Component</th><br>  <th>LifeCycle</th><br></tr><br></thead><br><tbody><br><tr><br>  <td>App</td><br>  <td>componentDidMount</td><br></tr><br><tr><br>  <td>Home</td><br>  <td>componentDidMount</td><br></tr><br><tr><br>  <td>Invoice</td><br>  <td>N/A</td><br></tr><br><tr><br>  <td>Account</td><br>  <td>N/A</td><br></tr><br></tbody><br></table><p></p></li><li><p>å½ç¨æ·ä»â/â è·³è½¬å° â/invoices/123â</p><table><br><thead><br><tr><br>  <th>Component</th><br>  <th>LifeCycle</th><br></tr><br></thead><br><tbody><br><tr><br>  <td>App</td><br>  <td>componentWillReceiveProps, componentDidUpdate</td><br></tr><br><tr><br>  <td>Home</td><br>  <td>componentWillUnmount</td><br></tr><br><tr><br>  <td>Invoice</td><br>  <td>componentDidMount</td><br></tr><br><tr><br>  <td>Account</td><br>  <td>N/A</td><br></tr><br></tbody><br></table><h4 id="è·åæ°æ®"><a href="#è·åæ°æ®" class="headerlink" title="è·åæ°æ®"></a>è·åæ°æ®</h4><p></p><p>æç®åçéè¿ router è·åæ°æ®çæ¹æ³æ¯éè¿ç»ä»¶çå½å¨æ Hook æ¥å®ç°.</p><p>å¨ Invoice ä¸­æ·»å ä¸ä¸ªç®åçæ°æ®è·ååè½</p><p><pre>`let Invoice = React.createClass({<br>  getInitialState(){</pre></p><pre><code>return{  invoice: null}</code></pre><p>  },</p><p>  componentDidMount(){</p><pre><code>this.setState({  this.fetchInvoice()})</code></pre><p>  },</p><p>  componentDidUpdate(prevProps){</p><pre><code>let oldId = prevProps.params.invoiceIdlet newId= this.props.params.invoiceIdif(newId !== oldId){  this.fetchInvoice()}</code></pre><p>  },</p><p>  componentWillUnmount(){</p><pre><code>this.ignorelastFetch = true</code></pre><p>  },</p><p>  fetchInvoice(){</p><pre><code>let url = `/api/invoices/${this.props.params.invoiceId}`this.request = fetch(url, (err, data) =&amp;gt; {  if(!this.ingoreFetch){    this.setState({invoice: data.invoice})  }})</code></pre><p>  },</p><p>  render(){</p><pre><code>return &amp;lt;InvoiceView invoice = {this.state.invoice} /&amp;gt;</code></pre><p>  }<br>})</p></li></ol>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> React </tag>
            
            <tag> React-Router </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>H5 ç§»å¨ç«¯æ³¨æç¹</title>
      <link href="/2016/08/25/h5-e7-a7-bb-e5-8a-a8-e7-ab-af-e6-b3-a8-e6-84-8f-e7-82-b9/"/>
      <content type="html"><![CDATA[<ol><li>ä½¿ç¨ rem ä½ä¸ºåä½</li></ol><p>ç»ææºè¿æ¯ 100px çå­ä½å¤§å°, å¯¹äº320px çææºå¹éæ¯100px, å¶ä»ææºé½æ¯ææ¯ä¾åé, å æ­¤è®¾è®¡ç¨¿ä¸å¤å°åç´ çè¯, rem = è®¾è®¡ç¨¿åç´ /100</p><ol><li>ç¦ç¨ a, button, input, opigroup, select, textare ç­æ ç­¾èæ¯åæ</li></ol><p>å¨ç§»å¨ç«¯ä½¿ç¨ a æ ç­¾ä½ä¸ºæé®ææå­é¾æ¥çæ¶å, ç¹å»æé®ä¼åºç°ä¸ä¸ªæè²èæ¯, éè¦å¨ css ä¸­å å¥</p><pre><code>a, button, input, textarea, optgroud, select{  -webkit-tap-highlight-color: rgba(0,0,0,0)}`&lt;/pre&gt;</code></pre><ol><li><p>meta åºç¡ç¥è¯</p><p>é¡µé¢çªå£èªå¨è°æ´å°è®¾å«å®½åº¦, å¹¶ç¦æ­¢ç¨æ·ç¼©æ¾é¡µé¢</p><pre>`&lt;meta name="viewport" content="width=device-width,initial-width:1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=0"/&gt;`</pre><p>å¿½ç¥é¡µé¢ä¸­çæ°å­è¯å«ä¸ºææºå·</p><pre>`&lt;meta name="format-detection" content="telephone=no"/&gt;`</pre><p>å¿½ç¥ Android å¹³å°å¯¹é®ç®±å°åçè¯å«</p><pre>`&lt;meta name="format-detection" content="email=no"/&gt;`</pre><p>å½ç½ç«æ·»å å°ä¸»å±æ¶å¯éèå°åæ , ä»éå¯¹ ios ç safari</p><pre>`&lt;meta name="apple-mobile-web-app-capable" content="yes"/&gt;`</pre></li><li><p>ç§»å¨ç«¯å®ä¹å­ä½</p><pre>`body{  font-family:"Helvetica Neue", Helvetica, sans-serif;}`</pre></li><li><p>è®¾ç½®æ¨æçµè¯</p><pre>`&lt;a href="tel:1242432423"&gt;1242432423&lt;/a&gt;`</pre></li><li><p>è®¾ç½®åéç­ä¿¡</p><pre>`&lt;a href="sms:123124325434"&gt;123124325434&lt;/a&gt;`</pre></li><li><p>è®¾ç½®åéé®ç®±</p><p><pre>`&lt;a href=âmailto:<a href="mailto:131321@21312.com" target="_blank" rel="noopener">131321@21312.com</a>â&gt;åéé®ä»¶&lt;/a&gt;</pre></p></li></ol><p>8, calc è¯­æ³, å¼å®¹ IE9+, FF4.0, Chrome19+, Safari6+</p>]]></content>
      
      <categories>
          
          <category> Uncategorized </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HTML5 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>React æ§è½ä¼å Tip</title>
      <link href="/2016/08/25/react-e6-80-a7-e8-83-bd-e4-bc-98-e5-8c-96-tip/"/>
      <content type="html"><![CDATA[<ol><li>æç¨ setState, å ä¸ºä»å®¹æå¯¼è´éå¤æ¸²æ, è¯·å°æ°æ®é½äº¤ç» redux ç®¡ç, åéè¿ props ä¼ å¥. è®°å¾ä½¿ç¨ shouldComponentUpdate æ¯è¾ä»¥ç¡®å®æ¯å¦éè¦éæ°æ¸²æ<p></p></li><li><p>è¯·å°æ¹æ³ç bind ä¸å¾ç½®äº constructor ä¸­, å¯ä»¥é¿åéå¤ç»å®, å¤ä¸ªå®ä¾çæé å½æ°æ¯å±äº«ç.</p></li><li><p>åªä¼ é component éè¦ç props, ä¼ éçå¤ªå¤, æèä¼ éçå¤ªæ·±, é½ä¼å é shouldComponentUpdate éé¢çæ°æ®å¤æ¦</p></li><li><p>è·¯ç±æ§å¶ä¸æå, å½é¡¹ç®åå¾æ´å¤§è§æ¨¡ä¸å¤æçæ¶å, æä»¬éè¦è®¾è®¡æ SPA, è¿æ¶è·¯ç±ç®¡çå°±åå¾éå¸¸éè¦, è¿ä½¿å¾ç¹å® url åæ°å¯ä»¥å¯¹åºç¹å®é¡µé¢</p></li></ol><p></p><p>å¶ä»å¸¸è§:<br>1. ä½¿ç¨ immutable å¤ç props, state, store<br>2. ä½¿ç¨ pure-render-decorator ä¸ immutablejs æ­éä½¿ç¨<br>3. æç¨ setState<br>4. ä»ä¼ å¿è¦ç props<br>5. å°æ¹æ³ç bind ç½®äº constructor</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> React </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>applyMiddleware ä¸ Enhancer</title>
      <link href="/2016/08/25/applymiddleware-e4-b8-8e-enhancer/"/>
      <content type="html"><![CDATA[<pre><code>import { createStore, applyMiddleware, compose } from &apos;redux&apos;const store = createStore(  reducer,  preloadedState, // &amp;lt;----- å¯éï¼ååç«¯åæçæ°æ®åæ­¥  compose( // &amp;lt;------------ è¿è®°å¾åï¼compose æ¯ä»å³å°å·¦çå¦ï¼    applyMiddleware( // &amp;lt;-- è¿è´§ä¹æ¯ Store Enhancer å¦ï¼ä½è¿æ¯å³ä¹ä¸­é´ä»¶çå¢å¼ºå¨ï¼å¿é¡»ç½®äº compose æ§è¡é¾çæå      middleware1,      middleware2,      middleware3    ),    enhancer3,    enhancer2,    enhancer1  ))</code></pre>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redux </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Redux APIs</title>
      <link href="/2016/08/24/redux-apis/"/>
      <content type="html"><![CDATA[<h3 id="Compose-â¦funcs"><a href="#Compose-â¦funcs" class="headerlink" title="Compose(â¦funcs)"></a>Compose(â¦funcs)</h3><pre><code>/** * compose(f,h,g)(...args) =&amp;gt; f(g(h(...args))) * ä½¿ç¨äº reduceRight, ä»å³å¼å§æ§è¡ * @param {å¤ä¸ªå½æ°, éå·éå¼} * @return {å½æ°} */export default function compose(...funcs){  if(funcs.length === 0){    return arg =&amp;gt; arg  }  if(funcs.length === 1){    return funcs[0]  }  const last = funcs[funcs.length - 1]  const rest = funcs.slice(0,-1)  return (...args) =&amp;gt; rest.reduceRight((composed, f) =&amp;gt; f(composed), last(...args))}`&lt;/pre&gt;å³é®å¨äº reduceRight å¯ä»¥ä¼ å¥åå¼### createStore(reducer, [initialState])&lt;pre&gt;`import isPlainObject from &apos;lodash/isPlainObject&apos;import $$observable from &apos;symbol-observable&apos;export var ActionTypes = {  INIT: &apos;@@redux/INIT&apos;}export default function createStore(reducer, preloadState, enhancer){  var currentReducer = reducer  var currentState = preloadState  var currentListeners = []  var nextListeners = currentListeners  var isDispatching = false}function ensureCanMutateNextListeners(){  if(nextListeners === currentListeners){    nextListeners = currentListeners.slice()  }}function getState(){  return currentState}function subscribe(listener){  if(typeof listener !== &apos;function&apos;){    throw new Error(&apos;Expected listener to be a function&apos;)  }  var isSubscribed = true  ensureCanmutateNextListener()  nextListeners.push(listener)  return function ubsubscribe(){    if(!isSubscribe){      return    }    isSubscribe = false    ensureCanMutateNextListeners()    var index = nextListeners.indexOf(listener)    nextListeners.splice(index,1)  }}function dispatch(action){  if(isPlainObecjt(action)){    throw new Error(&apos;Action must be plain objects &apos; + &apos;Use custom middleware for async action&apos;)  }  if(typeof action.type === &apos;undefined&apos;){    throw new Error(&apos;Actions may not have an undefined &quot;type&quot; property. &apos; + &apos;Have you misspelled a constant?&apos;)  }  if(isDispatching){    throw new Error(&apos;Reducers may not dispatch actions.&apos;)  }  try{    isDispatching = true    currentState = currentReducer(currentState, action)  } finally {    isDispatching = false  }  var listeners = currentListeners = nextListeners  for(var i = 0; i&amp;lt; listeners.length, i++){    listeners[i]()  }  return action}function replaceReducer(nextReducer){  if(typeof nextReducer !== &apos;function&apos;){    throw new Error(&apos;Expected the nextReducer to be a function&apos;)  }  currentReducer = nextReducer  dispatch({type:ActionTYpes.INIT})}### combineReudcers(reducers)`&lt;/pre&gt;import { combineReducers } from &apos;redux&apos;import counterReducer from &apos;./counterReducer&apos;import todosReducer from &apos;./todosReducer&apos;const rootReducer = combineReducers({  counter: counterReducer,   // &amp;lt;--- é®åæ¯ state ä¸­çå±æ§, é®å¼æ¯å¯¹åº reducer å½æ°å  todos: todosReducer})export default rootReducer&lt;pre&gt;`å¦ææé«éæ±`&lt;/pre&gt;state  âââ counter: 0  âââ todo        âââ optTime: []        âââ todoList: [] # è¿å¶å®å°±æ¯åæ¥ç todosï¼&lt;pre&gt;`å¯¹åºç reducers æ¯:`&lt;/pre&gt;reducers/   âââ index.js &amp;lt;-------------- combineReducers (çæ rootReducer)   âââ counterReducer.js   âââ todoReducers/ &amp;lt;--------- combineReducers           âââ index.js           âââ optTimeReducer.js           âââ todoListReducer.js&lt;pre&gt;``&lt;/pre&gt;/*  reducers/index.js */import { combineReducers } from &apos;redux&apos;import counterReducer from &apos;./counterReducer&apos;import todosReducers from &apos;./todosReducer&apos;const rootReducer = combineReducers({  counter: counterReducer,  todos: todosReducers})export default rootReducer=================================================/* reducers/todosReducers/index.js */import { combineReducers } from &apos;redux&apos;import optTimeReducer from &apos;./optTimeReducer&apos;import todoListReducer from &apos;./todoListReducer&apos;const todosReducers = combineReducers({  optTime: optTimeReducer,  todoList: todoListReducer})export default todosReducers&lt;pre&gt;`æ è®º dispatch åªä¸ª action é½ä¼æµé**ææ** reducer, ä½æ¯ç±äº reducer æ¯çº¯å½æ°, æçè¿æ¯ä¼æé«.### BindActionCreator### applyMiddlware(...middlewares)åè¦çè§£ Middleware, enhancerRedux å¼å¥ä¸­é´ä»¶æºå¶æ¯ä¸ºäºå¨ dispatch ååè¿è¡å¤ç`&lt;/pre&gt;const printStateMiddleware = ({getState}) =&gt; next =&gt; action =&gt; {  console.log(&apos;...&apos;)  let returnValue = next(action)  console.log(&apos;...&apos;)  return returnValue}&lt;pre&gt;`å®éä¸æåå±`&lt;/pre&gt;function printStateMiddleware(middlewareAPI){ //ä¸­é´ä»¶åå¯ä»¥ä½¿ç¨ç API, å¦ getState ä¸ dispatch   return function(dispatch){ // ä¼ å¥å dispatch çå¼ç¨    return function(action){      console.log(...)      var returnValue = dispatch(action)  //  æ§è¡ dispatch è¡ä¸º, dispatch(action) è¿åçè¿æ¯ action      console.log(...)      return returnValue // ä¼ ç»ä¸ä¸ä¸ªä¸­é´ä»¶ç action    }   }}&lt;pre&gt;`### Store Enhancerè¯´ç½äº Store Enhancer æ¯å¯¹çæ store ç API çæ¹é , ä¸ middleware çæå¤§åºå«æ¯ middlewere ä¸ä¿®æ¹ store ç APIæ¹é  store ç API å°±è¦ä» createStore å¥å£Redux ç applyMiddleware å°±æ¯ä¸ä¸ª Enhancer`&lt;/pre&gt;import compose from &apos;./compose&apos; // ä½ç¨å°±æ¯å±å±åè£¹// ä¼ å¥ä¸­é´ä»¶export default function applyMiddleware(...middlewares){  // ä¼ å¥ createStore  return function(createStore){    // è¿åä¸ä¸ªå½æ°ç­¾åå createStore ä¸æ ·çå½æ°, å³è¿åä¸ä¸ªå¢å¼ºçç createStore    return function(reducer, preloadState, enhancer){      // ç¨å createStore åçæä¸ä¸ª store, åå« getState, dispatch, subscribe, replaceReducer åä¸ª API      var store = creataStore(reducer, preloadState, enhancer)&lt;pre&gt;`  var dispatch = store.dispatch //  çææåå dispatchçå¼ç¨  var chain = [] // å­å¨ä¸­é´ä»¶çæ°ç»  //æä¾ç»ä¸­é´ä»¶ç API å¶å®å°±æ¯ store ç API  var middlewareAPI = {    getState: store.getStore,    dispatch: (action) =&amp;gt; dispatch(action)  }  // ç»ä¸­é´ä»¶æ·»å  API  chain = middlewares.map(middleware =&amp;gt; middleware(middlewareAPI))  // ä¸²èä¸­é´ä»¶, æ·»å ä¸­é´ä»¶çèµ·ç¹ store.dispatch, è¿åç»è¿ä¿®é¥°ç dispatch  dispatch = compose(...middlewares)(store.dispatch)  return{    ...store, // store ä¸­ä¿ççå API     dispatch  // ç¨æ°ç dispatch è¦çå dispatch     }}</code></pre><p>}<br>}<br><code>`</code><br><a href="https://cnodejs.org/topic/57bd23ee1d27b9113348a546" target="_blank" rel="noopener">åè</a></p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redux </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Middleware</title>
      <link href="/2016/08/23/middleware/"/>
      <content type="html"><![CDATA[<p>You can include custom middleware functions to the dispatch method of your store.</p><p>The dispatch function is responsible for sending actions to one or more reducer functions for state changes. The composed specialized functions around the original dispatch method creates the new middleware capable dispatch method.</p><p>Source code for applyMiddleware(from Redux 1.0.1)</p><pre><code>export default function applyMiddleware(...middlewares) {  return (next) =&amp;gt;     (reducer, initialState) =&amp;gt; {      var store = next(reducer, initialState);      var dispatch = store.dispatch;      var chain = [];      var middlewareAPI = {        getState: store.getState,        dispatch: (action) =&amp;gt; dispatch(action)      };      chain = middlewares.map(middleware =&amp;gt; middleware(middlewareAPI));      return {        ...store,        dispatch      }    }}`&lt;/pre&gt;Composing FunctionsFunctional programming is very literal and very mathematical. In the case of composing functions with math you can express two or more functions like this:&lt;pre&gt;`given:f(x) = x^2 + 3x + 1g(x) = 2xthen:(f Â· g)(x) = f(g(x)) = f(2x) = 4x^2 + 6x + 1`&lt;/pre&gt;It is no coincidence that you can compose two or more functions in a similar fashion. Here is a very simple example of a function that composes two functions to return a new specialized function:&lt;pre&gt;`var greet = function(x) { return `Hello, ${x}`}var emote = function(x) { return `${x} :)`}var compose = function(f,g){  return function(x){    return f(g(x))  }}`&lt;/pre&gt;This was just to illustrate the basic concept. We will look at a more generic way to solve that issue by examining the Redux Code.### CurryingAnother powerful functional programming concepts is the idea of currying or partially applying argument values to a function. By currying we can create a new specialized function that has partial information supplied to it. Here is the canonical example of currying where we have an add function that curries the first operand parameter to create a specialized add function&lt;pre&gt;`var curriedAdd = function(a){  return function(b){    return a + b;  }}var addTen = curriedAdd(10);addTen(10); // 20`&lt;/pre&gt;By currying and composing your functions you can create powerful new functions that create a pipeline for data processing.### Redux Dispatch FunctionA Store in Redux have a dispatch method which is only concerned with the main execution task you are interested in. You dispatch actions to your reducer functions to update state of the application. Redux reducers function takes a state and action parameter and return a new resultant state.&lt;pre&gt;`reducer:: state -&amp;gt; action -&amp;gt; state`&lt;/pre&gt;You might dispatch an action that simply sends a message to remove an item in a list which could look like this:&lt;pre&gt;`{type: types.DELETE_ITEM, id: 10}`&lt;/pre&gt;The store will dispatch this action object to all of it&apos;s reducer functions which could affect state. However the reducer functions are only concerned with executing logic around this deletion. They typically don&apos;t care who did it, how long it took, or logging the before and after effects of the state changes. This is where middleware can help us to address non-core concerns.### Redux middlewareRedux middleware is designed by creating functions that can be composed together before the main dispatch method is invoked.Let&apos;s creating a very simple logger middleware function that can echo the state of your application before and after running your main dispatch function. Redux middleware functions have this signiture:&lt;pre&gt;`middleware:: next -&amp;gt; action -&amp;gt; retVal`&lt;/pre&gt;It might look something like this:&lt;pre&gt;`export default function createLogger({getState}){  return (next) =&amp;gt;     (action) =&amp;gt; {      const console = window.console;      const prevState = getState();      const returnValue = next(action);      const nextState = getState();      const actionType = String(action.type);      const message = `action ${actionType}`;      console.log(`%c prev state`, `color: #9e9e9e`, prevState);      console.log(`%c action`, `color: #03A9F4`, action);      console.log(`%c next state`, `color:#4CAF50`, nextState)    };}`&lt;/pre&gt;Notice that createLogger accepts the getState method which is injected by applyMiddleware.js and used inside closure to read the current state. This will return a new function with the `next` parameter which is used to compose the next chained middleware function or the main dispatch function.This function returns a curried function that accepts the action object which can be read or modified before sending it to the next middleware function in the chain. Finally the main dispatch function is invoked with the action object.</code></pre><ul><li>First it captures the previous state</li><li>The action is dispatched to the next middleware function</li><li>All downstream middleware functions in the chain are invoked</li><li>The reducer functions in the store are called with the action payload</li><li><p>The logger middleware the gets the resulting next state</p><h3 id="Dissecting-applyMiddleware-js"><a href="#Dissecting-applyMiddleware-js" class="headerlink" title="Dissecting applyMiddleware.js"></a>Dissecting applyMiddleware.js</h3><pre>`export default function applyMiddleware(...middlewares){  return (next) =&gt;     (reducer, initialState) =&gt; {      var store = next(reducer, initialState);      var dispatch = store.dispatch;      var chain = [];      var middlewareAPI = {        getState: store.getState,        dispatch: (action) =&gt; dispatch(action)      };      chain = middlewares.map(middleware =&gt; middleware(middlewareAPI));      dispatch = compose(...chain, store.dispatch);      return{        ...store,        dispatch      };    };}`</pre><p>The applyMiddleware function probably could have been named a little better, such as applyMiddlewareToStore.</p><p>The applyMiddleware function returns a function that takes a mysterious next argument:</p><pre>`return (next) =&gt; (reducer, initialState) =&gt; {...}`</pre><p>The next argument will be a function that is used to create a store. By default you should look at the implementation for createStore. The final returned function will be like createStore and replace the dispatch function with itâs associated middlewares.</p><p>Next we assign the store implementation to the function responsible for creating the new store. Then we create a variable to the storeâs original dispatch function. Finally we setup an array to hold the middleware chain we will be creating.</p><pre>`var store = next(reducer, initialState)var dispatch = store.dispatchvar chain = [];`</pre><p>This next bit of code injects the getState function and the original dispatch function from the store into each middleware function which you can optionally use in your middleware(the applyMiddleware function pass getState and dispatch to middlewares in it).</p><p>The resultant middleware is stored in the chain array</p><pre>`var middlewareAPI = {  getState: store.getState,  dispatch: (action) =&gt; dispatch(action)}chain = middlewares.map(middleware =&gt; middleware({middlewareAPI}))`</pre><p>Now we create our replacement dispatch function with the information about hte middleware chain:</p><pre>`dispatch = compose(...chain, store.dispatch);`</pre><p>The magic to composing our middleware chain lies in this utility function supplied by Redux. Here is the implementation</p><pre>`export default function compose(...funcs){  return funcs.reduceRight((compsed,f) =&gt; f(composed))}`</pre><p>The composing function will literally express your functions as a composition injecting each middleware as an argument to the next middleware in the chain. Order is important here when assembling your middleware function. Finally, the original store dispatch method is composed. This new looks like:</p><pre>`middlewareI(middlewareJ(middlewareK(store.dispatch)))(action)`</pre><p>The final thing to do is return the new store object with the overriden function:</p><pre>`return {  ...store,  dispatch}`</pre><p>Letâs add our logger middleware we started above into a custom store with the enhanced dispatch function.</p><pre>`import { createStore, applyMiddlware } from 'redux'import loggerMiddleware from 'logger'import rootReducer from './reducers'const createStoreWithMiddleware = applyMiddleware(loggerMiddleware)(createStore)export default function configureStore(initialState){  return createStoreWithMiddleware(rootReducer, initialState);}const store = configureStore()`</pre><h3 id="Asynchronous-Middleware"><a href="#Asynchronous-Middleware" class="headerlink" title="Asynchronous Middleware"></a>Asynchronous Middleware</h3><p>Once you get comfortable with the basics of Redux middleware you will likely want to work with asynchronous actions that involve some sort of asynchronous execution. In particular look at âredux-thunkâ for more details. Letâs say you have an action creator that has some async functionality to get stock quote information:</p><pre>`function fetchQuote(symbol){  requestQuote(symbol);  return fetch('......')         .then(req =&gt; req.json())         .then(json =&gt; showCurrentQuote(symbol, json));}`</pre><p>There is no obvious way here to dispatch an action that would be returned from the fetch which is Promise based. Plus we do not have a handle to the dispatch function. Therefore we can use the redux-thunk middleware to defer execution of these operations. By wrapping the execution in a function you can delay this execution:</p><pre>`function fetchQuote(symbol){  return dispatch =&gt; {    dispatch(requestQuote(symbol));    return fetch('......').then(req=&gt;req.json).then(json =&gt; dispatch(showCurrentQuote(symbol,json))  }}`</pre><p>Remember that the applyMiddleware function will inject the <code>dispatch</code> and the <code>getStat</code> function as parameters int o the redux-thunk middleware. Now you can dispatch the resultant action objects to your store which conatains reducers. Here is the middleware function for redux-thunk that does this for you.</p><p><pre>`export default function thunkMiddleware({dispatch,getState}){<br>  return (next) =&gt; </pre></p><pre><code>action =&amp;gt; {  typeof action === &apos;function&apos;? action(dispatch, getState):next(action)}</code></pre><p>}</p></li></ul><p>If the action is a function it will be called with the dispatch and getState function..</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redux </tag>
            
            <tag> React </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Connect ç¸å³</title>
      <link href="/2016/08/22/connect-e7-9b-b8-e5-85-b3/"/>
      <content type="html"><![CDATA[<h1 id="é¢å¤ç¥è¯"><a href="#é¢å¤ç¥è¯" class="headerlink" title="é¢å¤ç¥è¯"></a>é¢å¤ç¥è¯</h1><p>åé¡¾ä¸ä¸ Redux åºæ¬ç¨æ³</p><pre><code>const reducer = (state = {count: 0}, action ) =&amp;gt; {  switch(action.type){  case &quot;INCRESE&quot;: return {count: state.count + 1}  case &quot;DECRESE&quot;: return {count: state.count - 1}  default: return state;  }}const actions = {  increase: () =&amp;gt; { type: &apos;INCREASE&apos;},  decrease: () =&amp;gt; { type: &apos;DECREASE&apos;}}const store = createStore(reducer);store.subscribe(()=&amp;gt;{  console.log(store.getState())});store.dispatch(action.increase());`&lt;/pre&gt;éè¿ reducer åå»ºä¸ä¸ª store, æ¯å½æä»¬å¨ store ä¸ dispatch ä¸ä¸ª action, store åçæ°æ®å°±ä¼éè¿ reducer åå.æä»¬å½ç¶å¯ä»¥ç´æ¥å¨ React ä¸­ä½¿ç¨ Redux, å¨æå¤å±å®¹å¨ä¸­åå§å store, ç¶åå° state ä¸çå±æ§ä½ä¸º props å±å±ä¼ ä¸å»&lt;pre&gt;`class App extends Component{  componentWillMount(){    store.subscribe((state) =&amp;gt; this.setState(state))  }  render(){    return &amp;lt;Comp state={this.state} onIncrease = {()=&amp;gt;store.dispatch(actions.increase())} onDecrease = {()=&amp;gt; store.dispatch(actions.decrease())}  } /&amp;gt;}`&lt;/pre&gt;ä½è¿ä¸æ¯æä½³æ¹å¼, æä½³æ¹å¼æ¯ä½¿ç¨ react-redux æä¾ç Provider å connect æ¹æ³### ä½¿ç¨ React-reduxé¦åå¨æå¤å±å®¹å¨ä¸­, æææåå®¹åè£¹å¨ Provider ç»ä»¶ä¸­, å°ä¹ååå»ºç store ä½ä¸º prop ä¼ éç» Provider&lt;pre&gt;`const App = () =&amp;gt; {  return(    &amp;lt;Provider store = {store}&amp;gt;      &amp;lt;Comp /&amp;gt;    &amp;lt;/Provider&amp;gt;  )}`&lt;/pre&gt;Provider ä¸­çä»»ä½ä¸ä¸ªç»ä»¶(æ¯å¦è¿éç Comp) å¦æéè¦ä½¿ç¨ state ä¸­çæ°æ®, å°±å¿é¡»æ¯ `è¢« connect è¿ç`ç»ä»¶, ä½¿ç¨ connect æ¹æ³å¯¹ä½ ç¼åçç»ä»¶(MyComp)è¿è¡åè£åçäº§ç©.&lt;pre&gt;`class MyComp extends Component {  // content...}const Comp = connect(...args)(MyComp);`&lt;/pre&gt;å¯è§ connect æ¯éä¸­ä¹é### connect è¯¦è§£ç©¶ç« connect åäºä»ä¹é¦åçä¸ä¸å½æ°çç­¾å:&lt;pre&gt;`connect([mapStatToProps], [mapDispatchToProps], [mergeProps], [options])`&lt;/pre&gt;connect() å½æ°æ¥ååä¸ªåæ°, åå«æ¯&lt;pre&gt;`mapStatToProps, mapDispatchToProps, mergeProps, options`&lt;/pre&gt;&lt;pre&gt;`mapStatToProps(state, ownProps): stateProps`&lt;/pre&gt;è¿ä¸ªå½æ°åè®¸æä»¬å° store ä¸­çæ°æ®ä½ä¸º props ç»å®å°ç»ä»¶ä¸&lt;pre&gt;`const mapStatToProps = (state) =&amp;gt; {  return {    count: state.count  }}`&lt;/pre&gt;è¿ä¸ªå½æ°çç¬¬ä¸ä¸ªåæ°å°±æ¯ Redux ç store, æä»¬ä»ä¸­æå count å±æ§, å ä¸ºè¿åäºå·æ count å±æ§çå¯¹è±¡, æä»¥ MyComp ä¼æåä¸º count ç props å­æ®µ&lt;pre&gt;`class MyComp extends Component{  render(){    return &amp;lt;div&amp;gt;Count: {this.props.count}&amp;lt;/div&amp;gt;  }}const Comp = connect(...args)(MyComp);`&lt;/pre&gt;å½ç¶ä½ ä¸å¿å° state åå°ä¸å¨ä¼ éç»ç»ä»¶, å¯ä»¥æ ¹æ® state ä¸­çæ°æ®, å¨æçè¾åºç»ä»¶éè¦ç(æå°)å±æ§&lt;pre&gt;`const mapStateToProps = (state) =&amp;gt; {  return {    greaterThanFive: state.count &amp;gt; 5  }}`&lt;/pre&gt;ç¬¬äºä¸ªåæ° ownProps, æ¯ MyComp èªå·±ç props, ææ¶å ownProps ä¹ä¼å¯¹å¶äº§çå½±å, æ¯å¦å½ä½ å¨ store ä¸­ç»´æ¤ä¸ä¸ªç¨æ·åè¡¨, èä½ çç»ä»¶ MyComp åªå³å¿ä¸ä¸ªç¨æ·(éè¿ props ä¸­ç userIdä½ç°)&lt;pre&gt;`const mapStateToProps = (state, ownProps) =&amp;gt; {  // state æ¯{ userList:[{id:0,name;&apos;çäº&apos;}]}  return {    user: _.find(state.userList, {id:ownProps.userId})  }}class MyComp extends Component{  static PropTypes = {    userId: PropTypes.string.isRequired,    user: PropTypes.object  };  render(){    return &amp;lt;div&amp;gt;UserName: {this.props.user.name}&amp;lt;/div&amp;gt;  }}const Comp = connect(mapStateToProps)(MyComp)`&lt;/pre&gt;å½ state åå, æè ownProps ååæ¶, mapStateToProps é½ä¼è¢«è°ç¨, è®¡ç®åºä¸ä¸ªæ°ç stateProps , å¨ä¸ ownProps merge å, æ´æ°ç» MyCompè¿å°±æ¯å° Redux store ä¸­çæ°æ®è¿æ¥å°ç»ä»¶çåºæ¬æ¹æ³mapDispatchToProps(dispatch, ownProps): dispatchPropsconnect çç¬¬äºä¸ªåæ°æ¯ mapDispatchToProps, åè½æ¯å° action ä½ä¸º props ç»å®å° MyComp ä¸&lt;pre&gt;`const mapDispatchToProps = (dispatch, ownProps) =&amp;gt; {  return {    increase: (...args) =&amp;gt; dispatch(actions.increase(...args)),    decrease: (...args) =&amp;gt; dispatch(actions.decrease(...args))  }}class MyComp extends Component{  render(){    const {count, increase, decrease} = this.props    return (      &amp;lt;div&amp;gt;        &amp;lt;div&amp;gt;Count:{count}&amp;lt;/div&amp;gt;        &amp;lt;button onClick={increase}&amp;gt;+&amp;lt;/button&amp;gt;        &amp;lt;button onClick={decrease}&amp;gt;-&amp;lt;/button&amp;gt;      &amp;lt;/div&amp;gt;    )  }}const Comp = connect(mapStateToProps, mapDispatchToProps)(MyComp)`&lt;/pre&gt;ç±äº mapDispatchToProps æ¹æ³è¿åäºå·æ increase å±æ§å decrease å±æ§çå¯¹è±¡, è¿ä¸¤ä¸ªå±æ§ä¹ä¼æä¸º MyComp ç propså¦ä¸æç¤º, è°ç¨ actions.increase()åªè½å¾å°ä¸ä¸ª action å¯¹è±¡{type:&apos;INCREASE&apos;}, è¦è§¦åè¿ä¸ª action å¿é¡»è¦éè¿ dispatch è°ç¨, dispatch æ­£å¼ mapDispatchToProps çç¬¬ä¸ä¸ªåæ°, ä½æ¯ä¸ºäºä¸è®© MyComp ç»ä»¶æç¥å° dispatch çå­å¨, æä»¬éè¦å° increase å decrease æ¹æ³åè£ä¸ä¸, ä½¿ä¹æä¸ºç´æ¥å¯ä»¥è¢«è°ç¨çå½æ°(å³è§¦åè¯¥æ¹æ³å°±ä¼è§¦å dispatch)Redux æ¬èº«æä¾äº bindActionCreator å½æ°, æ¥å° action åè£æå¯ä»¥ç´æ¥è¢«è°ç¨çå½æ°&lt;pre&gt;`import {bindActionCreator} from &apos;redux&apos;const mapDispatchToProps = (dispatch,ownProps) =&amp;gt; {  return bindActionCreator({    increase: actions.increase,    decrease: actions.decrease  })}</code></pre><p>åæ ·å½ ownProps ååæ¶, è¯¥å½æ°ä¹ä¼è¢«è°ç¨, çæä¸ä¸ªæ°ç dispatchProps( å¨ä¸ stateProps å ownPorps merge å), æ´æ°ç» MyComp. æ³¨æ action çååä¸ä¼å¼èµ·ä¸è¿°è¿ç¨, é»è®¤ action å¨ç»ä»¶ççå½å¨æä¸­æ¯åºå®ç</p><p>[mergeProps(stateProps, dispatchProps, ownProps): props]</p><p>ä¹åè¯´è¿ä¸ç®¡æ¯ stateProps è¿æ¯ dispatchProps, é½éè¦å ownProps merge ä¹åæä¼è¢«èµç» MyComp, connect çç¬¬ä¸ä¸ªåæ°å°±æ¯æ¥åè¿ä¸ªäºæç, éå¸¸æåµä¸ä¸éè¦ä¼ è¿ä¸ªåæ°, connect ä¼ä½¿ç¨ Object.assign æ¹æ³ä»£æ¿è¯¥æ¹æ³.</p><h3 id="å¶ä»"><a href="#å¶ä»" class="headerlink" title="å¶ä»"></a>å¶ä»</h3><p>æåè¿æä¸ä¸ª options åæ°, æ¯è¾ç®å, ä¸è¬ä¹ä¸ä¼ç¨å°.</p><p><a href="http://taobaofed.org/blog/2016/08/18/react-redux-connect/" target="_blank" rel="noopener">åè</a></p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redux </tag>
            
            <tag> React </tag>
            
            <tag> React-Redux </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Configuring ESLint</title>
      <link href="/2016/08/22/configuring-eslint/"/>
      <content type="html"><![CDATA[<ol><li>Configuration Comments - use JS comments to embed configuration information directly into a file.<p></p></li><li>Configuration Files - use a JS, JSON, or YAML file to specify configuration information for an entire directory and all of its subdirectories. This can be in the form of an <code>.eslintrc</code> file or an <code>eslintConfig</code> field in a <code>package.json</code> file, both of which ESLint will look for and reed automatically, or you can specify a configuration file on the command line.</li></ol><h3 id="Specifying-Parser-Options"><a href="#Specifying-Parser-Options" class="headerlink" title="Specifying Parser Options"></a>Specifying Parser Options</h3><p></p><p>ESLint allows you to specify the JS language options you want to support. By Default, ESLint support only ES5 syntax. You can override that setting to enable support for ES6 and 7 as well as JSX by using parser options.</p><p>Parser options are set in your <code>.eslintrc</code> file by using the <code>parserOptions</code> property. The available options are:</p><ul><li><code>ecmaVersion</code> - set to 3, 5(default), 6 or 7 to specify the version of ECMAScript you want to use.</li><li><code>sourceType</code> - set to <code>&quot;script&quot;</code> (default) or <code>&quot;module&quot;</code> if your code is in ECMAScript modules.</li><li><p><code>emcaFeatures</code> - an object indicating which additional language features youâd like to use:</p><pre><code>*   `globalReturn` - allow `return` statements in the global scope.</code></pre><ul><li><code>impliedStrict</code> - enable global <code>strict mode</code> (if <code>ecmaVersion</code> is 5 or greater)</li><li><code>jsx</code>: enable <code>JSX</code></li><li><code>experimentalObjectRestSpread</code> - enable support for the experimental <code>object rest/spread properties</code></li></ul></li></ul><p>An example:</p><pre><code>{  &quot;parserOptions&quot;:{    &quot;emcaVersion&quot;: 6,    &quot;sourceType&quot;: &quot;module&quot;,    &quot;ecmaFeatures&quot;: {      &quot;jsx&quot;: true    }  },  &quot;rules&quot;:{    &quot;semi&quot;: 2  }}`&lt;/pre&gt;### Specifying ParserBy Default, ESLint uses `Espree` as its parser. You can optionally specify that a different parser should be used in your configuration file so long as the parser meets the following requirements:</code></pre><ul><li>It must be an npm module installled locally;</li><li>It must have an Esprima-compatible interface</li><li><p>It must produce Esprima-compatible AST and token objects.</p><h3 id="Specifying-ENV"><a href="#Specifying-ENV" class="headerlink" title="Specifying ENV"></a>Specifying ENV</h3></li><li><p>browser</p></li><li>node</li><li>commonjs</li><li>es6</li><li><p>mocha</p><pre>`{  "env":{    "browser": true,    "node": true  }}### Configuring RulesESLint comes with a large number of rules, you can modify which rules your project use either using configuration comments or configuration files. To change a rules setting, you must set the rule ID equal to one of these values: - `"off"` or `0` to turn rule off.- `"warn"` or `1` to turn the rule as a warning(doesn't affect exit code)- `"error"` or `2` to turn the rule on as an error(exit code is 1 when triggered)### Demo`</pre><p>npm install -g eslint</p><p><pre>`</pre></p></li></ul><p>eslint âinit<br><code>`</code><br>çæ<code>.eslintrc.js</code></p><p>ä½æ¯è¿ä¸ªæä»¶æå¥½æå¨çæ</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ESLint </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>JS å¼åå·¥å·</title>
      <link href="/2016/08/21/js-e5-bc-80-e5-8f-91-e5-b7-a5-e5-85-b7/"/>
      <content type="html"><![CDATA[<p>å¼åå·¥å·æ¯è®©å¼åäººåå·¥ä½æ´è½»æ¾çä¸äºè½¯ä»¶, ä¼ ç»ä¸åæ¬éæå¼åç¯å¢, ä»£ç æ£æ¥å·¥å·, ç¼è¯å¨, è°è¯å·¥å·åæ§è½æµè¯å·¥å·</p><p>ä½æ¯ JS æ¯ä¸ç§å¨æè¯­è¨, ä¼´éä»å¨ææ¬è´¨èæ¥çæ¯å¯¹æ´å¤è¿è¡æ¶å¼åèå·¥å·çéæ±.</p><h4 id="Quick-List"><a href="#Quick-List" class="headerlink" title="Quick List"></a>Quick List</h4><ul><li>Atom &amp; Atom-ternjs</li><li>Chrome DevTools</li><li>PageSpeed Insights</li><li>BrowserSycn</li><li>TraceGL</li><li>ironNode</li><li>ESLint</li><li>Babel</li><li>React</li><li>Webpack + Hot Module Replacement</li><li>Redux + Redux DevTools</li></ul><p>å³äºå·¥å·, ä¸»è¦æ¯ç¼è¾å¨åè¿è¡æ¶ç¯å¢(æ¯å¦æµè§å¨)</p><p>ä¸»è¦ç¨ Atom, éè¦ atom-ternjs æ¥å¼å¯ JavaScript æºè½è¯å«</p><p>å¾å¤å¾æ£ç <a href="https://medium.com/@satya164/supercharged-javascript-development-in-atom-ea034e22eabc#.a2b8sthbw" target="_blank" rel="noopener">Atom æä»¶</a></p><p>è°è¯å¨: Chrome DevTools, æ³¨æå¶ flame charts å dominators view åè½</p><p>æ§è½å®¡æ¥: <a href="https://www.youtube.com/watch?list=PLOU2XLYxmsILKwwASNS0xgfcmakbK_8JZ&amp;v=bDUDuQy3R7Y" target="_blank" rel="noopener">PageSpeed Insights</a></p><p>BrowserSyncæ¯ä¸æ¬¾æµè¯ååºå¼å¸å±éå¸¸å¥½ç¨çå·¥å·, å¯ä»¥ä¸æ¬¡æ¨¡æå¤ç§æµè§å¨(çµè, å¹³æ¿, ææº)<br>å¯ä»¥çè§æä»¶, å¹¶å¨æä»¶ä¿®æ¹çæ¶åèªå¨éè½½åæ­¥å·æ°æµè§å¨, åæ»å¨, ç¹å», è¡¨åäº¤äºç­å¨ä½ä¹ä¼è·¨è®¾å«åæ­¥.</p><p><a href="https://www.youtube.com/watch?v=heNWfzc7ufQ" target="_blank" rel="noopener">è§é¢é¾æ¥</a></p><p>TraceGL æ¯ä¸ç§è¿è¡æ¶è°è¯å·¥å·, å¯ä»¥è®©ä½ å¨è½¯ä»¶ä¸­çæ¹æ³å®æ¶è°ç¨æ¶è§å¯ä»ä»¬, èä¸æ¯æå¨éæ­¥è·è¸ªä»£ç </p><p><a href="https://www.youtube.com/watch?v=heNWfzc7ufQ" target="_blank" rel="noopener">è§é¢é¾æ¥</a></p><p>ä»£ç æ£æ¥: ESLint å¯éç½®æ§ç¹å«å¼º, æ¯ä¸ä¸ªéé¡¹é½å¯ä»¥è®¾ç½®å¼å¯æç¦ç¨, çè³ç»ä»ä»¬æ·»å åæ°. å¯ä»¥åå»ºèªå·±çè§å, æ¯ææä»¶</p><p>Babel æ¯ä¸ç§ç¼è¯å¨, å¯ä»¥è®©ç°å¨ç JS ä»£ç ä½¿ç¨ ES6+ å°æªæ¯æçç¹æ§, JSX ç­, å·¥ä½åçæ¯è®²ä»£ç è½¬æ¢ä¸ºç­ä»·ç ES5.</p><p><a href="https://medium.com/javascript-scene/how-to-use-es6-for-isomorphic-javascript-apps-2a9c3abe5ea2" target="_blank" rel="noopener">æç« é¾æ¥</a></p><p>Webpack ä¼å°æ¨¡ååä»¥æ¥æåæéå¯¹æµè§å¨çéæèµæº, ä»æ¯æå¤§éæè¶£çç¹æ§, æ¯å¦æ¨¡åç­ææ, å¯ä»¥è®©å½åæµè§å¨ä¸­çä»£ç å¨ä½ ä¿®æ¹æä»¶çæ¶åèªå¨æ´æ°, èä¸ç¨å·æ°é¡µé¢. æ¨¡åç­ææ</p><p><a href="https://github.com/cloverfield-tools/universal-react-boilerplate" target="_blank" rel="noopener">åèèµæ</a></p><p>React: ä¸ç®å¼åèå·¥å·</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javascript </tag>
            
            <tag> DevTools </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>é¨ç½²React + Redux ç Web å¼åç¯å¢</title>
      <link href="/2016/08/20/e9-83-a8-e7-bd-b2react-redux-e7-9a-84-web-e5-bc-80-e5-8f-91-e7-8e-af-e5-a2-83/"/>
      <content type="html"><![CDATA[<p>å¥½çé¨ç½²éè¦åå°ä¸¤ç¹:<br>1. æ§è½ä¼å: åæ¬ä»£ç æ§è¡éåº¦, é¡µé¢è½½å¥éåº¦<br>2. èªå¨å: åå°éå¤å·¥ä½</p><p>ä½¿ç¨ React+Redux çæ¶åå¾å¾ä¼ç¨å°å¶è°è¯å·¥å· Redux DevTools, å¨æå¨éç½® DevTools æ¶éè¦éå¯¹ Store å Component è¿è¡ä¸äºéç½®, ç¶èè¿äºé½æ¯ä¸ºäºæ¹ä¾¿è°è¯ç, çäº§ç¯å¢ä¸æä»¬ä¸å¸æå å¥è¿äºä¸è¥¿, æä»¥å»ºè®®ä»ä»£ç ä¸éç¦» development å production ç¯å¢:</p><pre><code>containers/  Root.js  Root.dev.js  Root.prod.js  ...store/  index.js  store.dev.js  store.prod.js`&lt;/pre&gt;åæ¶éç¨åç¬çå¥å£æä»¶, æ¯å¦ä¸é¢ç containers/Root.js, æéè¦å è½½ä¸åç¯å¢çä»£ç &lt;pre&gt;`if (process.env.NODE_ENV === &apos;production&apos;){  module.exports = require(&apos;./Root.prod&apos;);} else {  module.exports = require(&apos;./Root.dev&apos;);}`&lt;/pre&gt;æä¸ä¸ªç»èéè¦æ³¨æ: ES6 è¯­æ³ä¸æ¯æå¨ if ä¸­ä¹¦å import è¯­å¥, æä»¥è¿ééç¨äº CommonJS çæ¨¡åå¼å¥æ¹æ³ require.å¦ä¸ä¸ªéè¦æ³¨æçå°æ¹æ¯æéè¦ import, å¦åå¯è½å¨æåçæ¶åå¼å¥ä¸å¿è¦çä»£ç ä½¿ç¨ webpack è¿è¡æåå·¥ä½&lt;pre&gt;`webpack --config webpack.config.prod.js --progress`&lt;/pre&gt;æ³¨æè¦ä¸ºä¸åçç¯å¢åå¤ä¸åç webpack éç½®æä»¶. æ¯å¦ `webpack.config.dev.js` å `webpack.config.prod.js` . çä¸ä¸æ¯è¾å³é®çéç½®éé¡¹### devtoolså¯ç¨ source-map, è¿æ · webpack ä¼çæä¸¤ä¸ªå- bundle.js- bundle.js.mapæç¨äºå®ä½æºç ç source map åç¦»åºå», åå° bundle.js çä½ç§¯source-map åªä¼å¨æµè§å¨ devtools æ¿æ´»æ¶å è½½, å¹¶ä¸ä¼å½±åæ­£å¸¸é¡µé¢çé¥¿å è½½éåº¦.### plugins&lt;pre&gt;`plugins:[  new webpack.optimize.UglifyJsPlugin({    compress:{      warning: false    }  }),  new webpack.optimize.DedupePlugin(),  new webpack.optimize.OccurenceOrderPlugin()]`&lt;/pre&gt;### ä¸è¦å¿½è§ NODE_ENVNODE_ENV å¶å®å°±æ¯ä¸ä¸ªç¯å¢åé, å¨ Node ä¸­ å¯ä»¥éè¿`process.env.NODE_ENV`è·å, ç®åå¤§å®¶æ±ªæ±ªç¨è¿ä¸ªåéåºåå½åæ¯ development è¿æ¯ production.éè¿ webpack ç DefinePlugin è®¾ç½®ç¯å¢åé:&lt;pre&gt;`plugins:[  ...  new webpack.DefinePlugin({    &apos;process.env.NODE_ENV&apos;: JSON.stingify(&apos;production&apos;)  })]### æ·»å  hashåç«¯å¬è®¤ç Best Practice å°±æ¯ç»èµæºæä¸ hash æ ç­¾, è¿å¯¹ç¼å­éæèµæºå¾æç¨1\. ç» bundle.js æ·»å  hash æ ç­¾`&lt;/pre&gt;output{  path: ...  filename: &apos;bundle.[hash].js&apos;}&lt;pre&gt;`ä½¿ç¨ html-webpack-plugin è¿ä¸ªæä»¶èªå¨çæå¸¦æ`&lt;/pre&gt;&amp;lt;script src=&apos;bundle.[hash].js&gt;&amp;lt;/script&gt;&apos;ç html æä»¶&lt;pre&gt;`éç½®å¦ä¸:`&lt;/pre&gt;plugins:[  ...  new HtmlWebpackPlugin({    title:&apos;html title&apos;,    template:&apos;./template.html&apos;,    favicon: &apos;./static/images/logo.ico&apos;  })]&lt;pre&gt;`éç½® template.html`&lt;/pre&gt;&lt;!DOCTYPE html&gt;&amp;lt;html&gt;&amp;lt;head&gt;  &lt;meta charset=&quot;utf-8&quot;&gt;  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1.0&quot;&gt;&amp;lt;/head&gt;&amp;lt;body&gt;&lt;div id=&quot;react-container&quot;&gt;&lt;/div&gt;&amp;lt;/body&gt;&amp;lt;/html&gt;&lt;pre&gt;`å¦æéè¦å¨ React Component ä¸­æ·»å å¾ç, å»ºè®®éç¨`&lt;/pre&gt;import LOGO.png from &apos;./static/images/logo.png&apos;&amp;lt;img src={LOGO.png} alt=&quot;&quot; /&gt;&lt;pre&gt;`ä½¿ç¨ import æ require å¯ä»¥è®© webpack å¯¹å¾çè¿è¡æåä½¿ç¨ file-loader å¯ä»¥å¯¹å¾çæ·»å  hash æ ç­¾ç¶åè¿åç¸åºç URL</code></pre><p>module:{<br>  loaders:[<br>    {<br>      test: /&#46;(png|jpg),<br>      loader:âfile?name=[hash].[ext]â<br>    }<br>  ]<br>}<br><code>`</code></p><h3 id="å¼å¥-CSS"><a href="#å¼å¥-CSS" class="headerlink" title="å¼å¥ CSS"></a>å¼å¥ CSS</h3><p>å¯ä»¥ç´æ¥å¨ js æä»¶ä¸­ <code>require(&#39;./foo.css&#39;)</code>, ç¶åä½¿ç¨ style-loader å css-loader è¿è¡å¤ç, æç»æææ¯å° css åµå¥å° HTML ç style æ ç­¾ä¸­, è¿æ ·å°±ä¸éè¦ä½¿ç¨ hash</p><p>CSS è¾å¤§çè¯, å¯ä»¥èèä½¿ç¨ extract-text-webpack-plugin æä»¶å° CSS åå¹¶åç¬ç«ä¸ºä¸ä¸ªæä»¶, å¹¶èªå®å¨é¡µé¢å è½½çæ¶åæ·»å  link æ ç­¾</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redux </tag>
            
            <tag> React </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Webpack å¸¸ç¨ Plugin å Loader</title>
      <link href="/2016/08/19/webpack-e5-b8-b8-e7-94-a8-plugin-e5-92-8c-loader/"/>
      <content type="html"><![CDATA[<h3 id="å¸¸ç¨Loader"><a href="#å¸¸ç¨Loader" class="headerlink" title="å¸¸ç¨Loader"></a>å¸¸ç¨Loader</h3><p>html ç¸å³</p><pre><code>html-loader`&lt;/pre&gt;css ç¸å³&lt;pre&gt;`style-loadercss-loaderautoprefixer-loadersass-loader`&lt;/pre&gt;js ç¸å³&lt;pre&gt;`babel-loaderbabel-corebabel-preset-es2015babel-preset-reactbabel-preset-stage3eslint-loader`&lt;/pre&gt;### å¸¸ç¨æä»¶Plugin#### config ç±»&lt;pre&gt;`NormalModuleReplacementPluginContextReplacementPluginIgnorePluginPrefetchPlugin`&lt;/pre&gt;#### Optimize&lt;pre&gt;`DedupePluginLimitChunkCountPluginOccurenceOrderPluginUglifyJsPluginCommonsChunkPlugin`&lt;/pre&gt;#### å¶ä»&lt;pre&gt;`HotModuleReplacementPluginNoErrorPluginProgressPluginHtmlWebpackPlugin</code></pre>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ImmutableJS Introduction</title>
      <link href="/2016/08/19/immutablejs-introduction/"/>
      <content type="html"><![CDATA[<p>Immutable data cannot be changed once created, leading to much simpler application development, no defensive copying, and enabling advanced memoization and change detection techniques with simple logic. Persistent data presetns a mutative API which does not update the data in-place, but instead always yields new updated data.</p><p>Immutable.js provides many Persistent Immutable data structures including: <code>List</code>, <code>Stack</code>, <code>Map</code>, <code>OrderedMap</code>, <code>Set</code>, <code>OrderedSet</code> and <code>Record</code>.</p><p>These data structures are highly efficient on modern JavaScript VMs by using structural sharing via âhash maps triesâ and âvector triesâ as popularized by Clojure and Scala, minimizing the need to copy or cache data.</p><p>Immutable also provides a lazy <code>Seq</code>, allowing efficient chaining of collection methods like <code>map</code> and <code>filter</code> without creating intermediate representations. Create some <code>Seq</code> with <code>Range</code> and <code>Repeat</code>.</p><h3 id="Getting-Started"><a href="#Getting-Started" class="headerlink" title="Getting Started"></a>Getting Started</h3><p><code>npm install Immutable</code></p><p><code>var Immutable = require(&#39;immutable&#39;);  var map1 = Immutable.Map({a:1,b:2,c:3});  var map2 = map1.set(&#39;b&#39;,50);  map1.get(&#39;b&#39;); //2  map2.get(&#39;b&#39;); //50</code></p><h3 id="The-case-for-Immutability"><a href="#The-case-for-Immutability" class="headerlink" title="The case for Immutability"></a>The case for Immutability</h3><p>Much of what makes application development difficult is tracking mutation and maintaining state. Development with immutable data encourages you to think differently about how data flows through your application.</p><p>Subscribing to data event throughout your application.</p><p>Immutable data never change.</p><p>Immutable collections should be treated as <em>value</em> rather than <em>object</em>. While objects represents some thing which could change over time, a value represents the state of that thing at a particular instance of time. This principle is most important to understanding the appropriate use of immutable data. In order to treat Immutable.js collections as values, itâs important to use the <strong>Immutable.is()</strong> function or <strong>.equals()</strong> method to determine value equality instead of <code>===</code> operator which determines object reference identity.</p><p><code>var map1 = Immutable.Map({a:1,b:2,c:3});  var map2 = map1.set(&#39;b&#39;,2);  assert(map1.equals(map2) === true);  var map3 = map1.set(&#39;b&#39;,50);  assert(map1.equals(map3) === false);</code></p><p><strong>Note</strong>: As a performance optimization <strong>Immutable</strong> attempts to return the existing collection when an operation would result in an identical collection, allowing for using <code>===</code> reference equality to determine if something definitely has not changed. This can be extremely useful when used within memoization function which would prefer to re-run the function if a deeper equality check could potentially be more costly. The <code>===</code> equality check is also used internally by <strong>Immutable.js</strong> and <code>equals()</code> as a performance as a performance optimization.</p><p>If an object is immutable, it can <strong>be âcopiedâ simply by marking another reference</strong> to it instead of copying the entire object. Because a reference is much smaller than the object itself, this results in memory savings and a potential boost in execution speed for programs which rely on copies(such as an undo-stack).</p><p><code>var map1 = Immutable.Map({&#39;a&#39;:1,&#39;b&#39;:2,&#39;c&#39;:3});  var clone = map1;</code></p><h3 id="JavaScript-first-API"><a href="#JavaScript-first-API" class="headerlink" title="JavaScript-first API"></a>JavaScript-first API</h3><p>While <code>immutable</code> is inspired by Clojure, Scala, Haskell and other functional programming environments, itâs designed to bring these powerful concepts to JavaScript, and therefore has an Object-Oriented API that closely mirrors that of <strong>ES6 Array, Map, and Set</strong>.</p><p>The difference for the immutable collections is that methods which would mutate the collection, like <code>push</code>, <code>set</code>, <code>unshift</code>, or <code>splice</code> instead of return a new immutable collection. Methods which return new array like <code>slice</code> or <code>concat</code> instead return new immutable collections.</p><p><code>var list1 = Immutable.List.of(1,2);  var list2 = list1.push(3,4,5);  var list3 = list2.unshift(0);  var list4 = list1.concat(list2,list3);  assert(list1.size === 2);  assert(list2.size === 5);  assert(list3.size === 6);  assert(list4.size === 13);  assert(list4.get(0) === 1);</code></p><p>Almost all of the methods on <strong>Array</strong> will be found in similar form on <strong>Immutable.List</strong>, those of <strong>Map</strong> found on <strong>Immutable.Map</strong> and those of <strong>Set</strong> found on<strong>Immutable.Set</strong>, including collection operation like <strong>forEach()</strong>, and <strong>map()</strong>.</p><p><code>var alpha = Immutable.Map({a:1,b:2,c:3,d:4});  alpha.map((v,k) =&amp;gt; k.toUpperCase()).join();  // &#39;A,B,C,D&#39;</code></p><h3 id="Accepts-raw-JavaScript-objects"><a href="#Accepts-raw-JavaScript-objects" class="headerlink" title="Accepts raw JavaScript objects"></a>Accepts raw JavaScript objects</h3><p>  âimmutableâ accepts plain JavaScript Arrays and Objects anywhere a mehtod expects an <strong>Iterable</strong> with no performance penalty.</p><p><code>var map1 = Immutable.Map({a:1,b:2,c:3,d:4});  var map2 = Immutable.Map({c:10,a:20,t:30});  var obj = {d:100,o:200,g:300};  var map3 = map1.merge(map2,obj);  // Map {a:20,b2,c:10,d:100,t:30,o:200,g:300}</code></p><p><strong>Immutable</strong> can treat any JavaScript Array or Object as an Iterable. You can take advantage of this in order to get sophisticated collection methods on JavaScript Objects, which otherwise have a very sparse native API.</p><p><code>var myObject = {a:1,b:2,c:3};  Immutable.Seq(myObject).map(x=&amp;gt;x*x).toObject();  // {a:1,b:4,c:9};</code></p><p>Keep in Mind, when using JS objects to construct Immutable Maps, that JS Object properties are always <strong>strings</strong>, even if written in a quote-less shorthand, while Immutable Map accept keys of any type.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">  var obj = &#123;1: &amp;#039;one&amp;#039;&#125;;</span><br><span class="line">  Object.keys(obj); // [&amp;#039;1&amp;#039;]</span><br><span class="line">  obj[1]; // &amp;#039;one&amp;#039;</span><br><span class="line">  obj[&amp;#039;1&amp;#039;]; // &amp;#039;one&amp;#039;</span><br><span class="line"></span><br><span class="line">var map = Immutable.fromJS(obj);</span><br><span class="line">  map.get(&amp;#039;1&amp;#039;); // &amp;#039;one&amp;#039;</span><br><span class="line">  map.get(1); // undefined</span><br></pre></td></tr></table></figure><p>Property access for JS Object first converts the key to a string, but since Immutable Map keys can be of any type the argument to <code>get()</code> is not altered.<br>  Namely Immutable Map will treat â1â and 1 differently.</p><h3 id="Converts-Back-to-Raw-JS-Obejcts"><a href="#Converts-Back-to-Raw-JS-Obejcts" class="headerlink" title="Converts Back to Raw JS Obejcts"></a>Converts Back to Raw JS Obejcts</h3><p>  All <strong>Immutable</strong> Iterable can be converted to plain JS Arrays and Objects shallowly with <code>toArray()</code> and <code>toObject()</code> or deeply with <code>toJS()</code>. All Immutable Iterables also implement <code>toJSON()</code> allowing them to be passed to <code>JSON.stringify()</code> directly.</p><p><code>var deep = Immutable.Map({a:1,b:2,c:Immutable.List.of(3,4,5)});  deep.toObject() // {a:1,b:2,c:List [3,4,5]}  deep.toArray() // [1,2,List [3,4,5]]  deep.toJS() // {a:1,b:2,c:[3,4,5]}  JSON.stringify(deep) // &#39;{&quot;a&quot;:1,&quot;b&quot;,&quot;c&quot;:[3,4,5]}&#39;</code></p><h3 id="Embraces-ES6"><a href="#Embraces-ES6" class="headerlink" title="Embraces ES6"></a>Embraces ES6</h3><p>  <code>Immutable</code> takes advantage of features added to JS ES6, the latest standard version of ECMAScript, including <code>Interators</code>,<code>Arrow Function</code>, <code>Classes</code>, and <code>Modules</code>.</p><h3 id="Nested-Structures"><a href="#Nested-Structures" class="headerlink" title="Nested Structures"></a>Nested Structures</h3><p>The collections in <code>immutable</code> are intended to be nested, allowing for deep trees of data, similar to JSON</p><p><code>var nested = Immutable.fromJS({a:{b:{c:[3,4,5]}}})  // Map{ a: Map { b: Map { c: List [3,4,5]}}}</code><br>  A few power-tool allow for reading and operating on nested data. The most useful are <code>mergeDeep</code>, <code>getIn</code>, <code>setIn</code> and <code>updateIn</code> found on <code>List</code>, <code>Map</code> and <code>OrderedMap</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">  var nested2 = nested.mergeDeep(&#123;a:&#123;b:&#123;d:6&#125;&#125;&#125;)</span><br><span class="line">  // Map &#123;a: Map &#123; b: &#123; c: List [3,4,5], d: 6&#125;&#125;&#125;</span><br><span class="line"></span><br><span class="line">nested2.getIn([&amp;#039;a&amp;#039;,&amp;#039;b&amp;#039;,&amp;#039;d&amp;#039;]); //6</span><br><span class="line"></span><br><span class="line">var nested3 = nested2.updateIn([&amp;#039;a&amp;#039;,&amp;#039;b&amp;#039;,&amp;#039;d&amp;#039;], value =&amp;gt; value + 1); d =&amp;gt; 7</span><br><span class="line"></span><br><span class="line">var nest4 = nested3.updateIn([&amp;#039;a&amp;#039;,&amp;#039;b&amp;#039;,&amp;#039;c&amp;#039;], list =&amp;gt; list.push(6)); c =&amp;gt; List [3,4,5,6]</span><br></pre></td></tr></table></figure><h3 id="Lazy-Seq"><a href="#Lazy-Seq" class="headerlink" title="Lazy Seq"></a>Lazy Seq</h3><p>  <strong>Seq</strong> describes a lazy operation, allowing them to efficiently chain use all the Iterable methods.(such as map and filter)</p><p><strong>Seq is immutable</strong> â Once a Seq is created it cannot be changed, appended to, rerranged or otherwise modified. Instead, any mutative method called on a Seq will return a new Seq.</p><p><strong>Seq is lazy</strong> â Seq does as little work as necessary to respond to any method call.</p><p>Once the Seq is used, it performs only the work necessary.</p><p>Any collection can be converted to a lazy Seq with <code>toSeq()</code>.</p><p><code>var seq = Immutable.Map({a:1,b:2,c:3}).toSeq();</code></p><p>Seq allow for the efficient chaining of sequence operations, especially when converting to a different concrete type(such as to a JS Object)</p><p><code>seq.flip().map(k =&amp;gt; k.toUpperCase()).flip().toObject();  // Map {A: 1, B:2, C:3}</code></p><h3 id="Equality-treats-Collection-as-Data"><a href="#Equality-treats-Collection-as-Data" class="headerlink" title="Equality treats Collection as Data"></a>Equality treats Collection as Data</h3><p><strong>Immutable</strong> provides equality which treats immutable data structures as pure data, performing a deep equality check if necessary.</p><p><code>var map1 = Immutable.Map({a:1,b:1,c:1});  var map2 = Immutable.Map({a:1,b:1,c:1});  assert(map1 !== map2) // two different instance, not same address  assert(Immutable.is(map1,map2)); // have equivalent values  assert(map1.equals(map2)); // alternatively use the equals methods.</code></p><p><strong>Immutable.is()</strong> uses the same measure of equality as <strong>Object.is</strong> including if both are immutable and all keys and values are equal using the same measure of equality.</p><h3 id="Batching-Mutations"><a href="#Batching-Mutations" class="headerlink" title="Batching Mutations"></a>Batching Mutations</h3><p>  Applying a mutation to create a new immutable object results in some overhead, which can add up to a minor performance penalty. If you need to apply a series of mutations locally before returning, <strong>Immutable</strong> gives you the ability to create a temporary mutable(transient) copy of a collection and apply a batch of mutations in a performance manner by using <code>withMutations</code>. In fact, this is exactly how <code>Immutable</code> applies complex mutations itself.</p><p>As an example, building <code>list2</code> results in the creation of 1 , not 3, new immutable Lists<br>  <code>var list1 = Immutable.List.of(1,2,3);  var list2 = list1.withMutations(function(list){    list.push(4).push(5).push(6)  });  assert(list1.size === 3);  assert(list2.size === 6);</code></p><p><strong>Note</strong>: <strong>Immutable</strong> also provides <code>asMutable</code> and <code>asImmutable</code>, but only encourages their use when <code>withMutations</code> will not suffice. Use caution to not return a mutable copy could result in undesired behavior.</p><p><strong>important</strong>: Only a select few method can be used in <code>withMutations</code> including <code>set</code>, <code>push</code>, <code>pop</code>. These methods can be applied directly against a persistent data-structure where other methods like <code>map</code>,<code>filter</code>,<code>sort</code>and <code>splice</code> will always return new immutable data-structure and never mutate a mutable collection.</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redux </tag>
            
            <tag> Immutable </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Redux æ­é React</title>
      <link href="/2016/08/16/redux-e6-90-ad-e9-85-8d-react/"/>
      <content type="html"><![CDATA[<p>ç¬¬ä¸æ­¥æ¯åå§å react ç»ä»¶</p><pre><code>getInitialState(){  return{    item: store.getState()  }}`&lt;/pre&gt;ç¬¬äºæ­¥æ¯å¨ç»ä»¶ render åè°ç¨ subscribe å½æ°, æ¯æ¬¡ redux åç dispatch çæ¶åé½è¦è°ç¨ react ç setState&lt;pre&gt;`componentDidMount(){  var unsubscribe = store.subscribe(this.onChange)}onChange(){  this.setState({    item: store.getState()  })}</code></pre><p>React ä¼æ ¹æ® State çååéæ° render ç»ä»¶<br>this.state.item.todos.map()</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redux </tag>
            
            <tag> React </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>CommonChunks æä»¶</title>
      <link href="/2016/08/16/commonchunks-e6-8f-92-e4-bb-b6/"/>
      <content type="html"><![CDATA[<p>ä½ç¨å°±æ¯æåä»£ç ä¸­çå¬å±æ¨¡å, ç¶åå°å¬å±æ¨¡åæåå°ä¸ä¸ªç¬ç«çæä»¶ä¸­, ä»¥ä¾¿å¨å¶ä»çå¥å£åæ¨¡åä¸­ä½¿ç¨.</p><pre><code>// in main.jsvar a = require(&apos;./a&apos;);a.sayHello();var b = require(&apos;./b&apos;);b.sayHello();var c = require(&apos;./c&apos;);c.sayHello()`&lt;/pre&gt;&lt;pre&gt;`// in main2.jsvar a = require(&apos;./a&apos;);a.sayHello();var b = require(&apos;./b&apos;);b.sayHello();`&lt;/pre&gt;a, b, c åä¹åä¸æ ·, åªæä¸ä¸ª sayHello æ¹æ³.æååçå°`bundle.main.js` å`bundle.main2.js` ä¸­åå«åå«äº a, b, c ä¸ä¸ªæ¨¡å, å¶ä¸­ a, b æ¯è¦ä½¿ç¨`CommonChunksLoader` æååºæ¥çå¬å±æ¨¡å.### éç½® CommonChunksLoader&lt;pre&gt;`var webpack = require(&apos;webpack&apos;);module.exports = {  entry:{    main1: &apos;./main&apos;,    main2: &apos;./main2&apos;  },  output:{    filename: &apos;bundle.[name].js&apos;  },  plugins:[    new webpack.optimize.CommonsChunkPlugin(&apos;common.js&apos;,[&apos;main1&apos;,&apos;main2&apos;])  ]} ;`&lt;/pre&gt;ç¬¬ä¸è¡ä¸­, æ·»å  webpack å¼ç¨, ç¶åæ·»å `plugins` éé¡¹, å¼ç¨`webpack.optimize.CommonsChunkPlugin` æ¥æåå¬å±æ¨¡å, åæ°`common.js` è¡¨ç¤ºå¬å±æ¨¡åçæä»¶å, åé¢çæ°ç»è¡¨ç¤ºä¾èµè¿ä¸ªæ¨¡åçå¥å£æä»¶.éæ°æåå, çæä¸ä¸ªæä»¶&lt;pre&gt;`bundle.main1.js,bundle.main2.jscommon.js</code></pre><p>å¶ä¸­ <code>bundle.main1.js</code> åªåå«äº<code>c</code>æ¨¡å, <code>bundle.main2.js</code>åæ²¡åå«ä»»ä½æ¨¡å.</p><p>å½ç¶, çæäº<code>common.js</code> è¿éè¦å¨ html ä¸­è¿è¡å¼ç¨, èä¸è¦åäº main1, main2</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Webpack åå¸éç½®</title>
      <link href="/2016/08/16/webpack-e5-8f-91-e5-b8-83-e9-85-8d-e7-bd-ae/"/>
      <content type="html"><![CDATA[<h3 id="åæä»¶æ¨¡å¼"><a href="#åæä»¶æ¨¡å¼" class="headerlink" title="åæä»¶æ¨¡å¼"></a>åæä»¶æ¨¡å¼</h3><pre><code>// æ°å»º webpack.production.config.js// in package.json&quot;deploy&quot;:&quot;NODE_EVN=production webpack -p -config webpack.production.config.js&quot;// in web.production.config.js// åå¼åç¯å¢ä¸åä¹å¤å¨äºå¥å£ååºå£. ç¸åºçå¨ HTML å JS æºä¹è¦è¿è¡ä¿®æ¹var path = require(&apos;path&apos;)var node_modules_dir = path.resolve(__dirname, &apos;node_modules&apos;)module.exports = {  entry:[    &apos;babel-polyfill&apos;,    path.resolve(__dirname, &apos;app/main.js&apos;)  ],  output:{    path: path.resolve(__dirname, &apos;build&apos;),    filename: &apos;app.js&apos;  },  module:{    loaders:[      {        ...      }    ]  }}`&lt;/pre&gt;### å¤æä»¶æ¨¡å¼åºæå¥½ä¸è¦æå, å ä¸ºä¸è¬åºé½ä¸ä¼æ¹å¨, æä»¥ load ä¸æ¬¡å°±å¤äº.å¯¹åºè¿è¡åç¦»&lt;pre&gt;`// in webpack.production.config.jsvar path = require(&apos;path&apos;)var webpack = require(&apos;webpack&apos;)var node_modules_dir = path.resolve(__dirname, &apos;node_modules&apos;)module.exports = {  entry:{    app: [path.resolve(__dirname, &apos;app/main.js&apos;)],    react: [&apos;babel-polyfill&apos;,&apos;react&apos;,&apos;react-dom&apos;]  },  output:{    path: path.resolve(__dirname, &apos;build&apos;),    filename: &apos;app.js&apos;  },  module:{    loaders:[      ...    ]  },  plugins:[    new webpack.optimize.CommonsChunkPlugin(&apos;react&apos;,&apos;react.js&apos;)  ]}</code></pre>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Webpack éç½® React/babel</title>
      <link href="/2016/08/16/webpack-e9-85-8d-e7-bd-ae-reactbabel/"/>
      <content type="html"><![CDATA[<h3 id="å®è£-react"><a href="#å®è£-react" class="headerlink" title="å®è£ react"></a>å®è£ react</h3><pre><code>npm install --save react react-dom`&lt;/pre&gt;### å®è£ babel-loader&lt;pre&gt;`npm install --save-dev babel-loader babel-core babel-preset-es2015 babel-preset-react babel-preset-stage-2 // æ¯æ ES2015, JSX, ES7`&lt;/pre&gt;&lt;pre&gt;`npm install --save polyfill`&lt;/pre&gt;&lt;pre&gt;`npm install --save babel-runtimenpm install --save-dev babel-plugin-transform-runtime// åå°æåæ¶åçéå¤ä»£ç `&lt;/pre&gt;### éç½® babel&lt;pre&gt;`// å¨å¥å£æ·»å  polyfillentry:[  &apos;babel-polyfill&apos;,  &apos;webpack/hot/dev-server&apos;,  &apos;webpack-dev-server/client?http://localhost:8080&apos;]`&lt;/pre&gt;æ·»å `.babalrc`&lt;pre&gt;`{  &quot;presets&quot;:[    &quot;es2015&quot;,    &quot;react&quot;,    &quot;stage-2&quot;  ],  &quot;plugins&quot;:[    &quot;transform-runtime&quot;  ]}</code></pre>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Webpack Dev Server</title>
      <link href="/2016/08/15/webpack-dev-server/"/>
      <content type="html"><![CDATA[<p>The webpack-dev-server is a little node.js Express server, which uses the <code>webpack-dev-middleware</code> to serve a webpack bundle. It also has a little runtime which is connected to the server via <code>Socket.IO</code>.</p><p>Letâs say you have the following config file(<code>webpack.config.js</code>)</p><pre><code>var path = require(&apos;path&apos;);module.exports = {  entry:{    app:[&apos;./app/main.js&apos;]  },  output:{    path: path.resolve(__dirname, &apos;build&apos;),    publicPath:&apos;/assets/&apos;,    filename: &apos;bundle.js&apos;  },}`&lt;/pre&gt;You have an `app` folder with your initial entry point that webpack will bundle into a `bundle.js` file in the `build` folder.### Content BaseThe webpack-dev-server will serve the files in the **current directory**, unless you configure a specific content base.&lt;pre&gt;`webpack-dev-server --content-base build/`&lt;/pre&gt;it will serve you `build` folder.This modified bundle is served from memory at the relative path specified in `publicPath`. Namely your bundle will be available as `localhost:8080/assets/bundle.js`### Automatic RefreshThe webpack-dev-server supports multiple modes to automatic refresh pages:</code></pre><ul><li>Iframe mode(page is embedded in an iframe and reload on change)</li><li><p>Inline mode(as a small webpack-dev-server client entry is added to the bundle which refresh the page on change)</p><h4 id="Inline-Mode"><a href="#Inline-Mode" class="headerlink" title="Inline Mode"></a>Inline Mode</h4><p>To use the inline mode, specify <code>--inline</code> on the command line(you cannot specify it in configuration).</p><h3 id="éç½®-webpack-dev-server-èªå¨å·æ°"><a href="#éç½®-webpack-dev-server-èªå¨å·æ°" class="headerlink" title="éç½® webpack-dev-server èªå¨å·æ°"></a>éç½® webpack-dev-server èªå¨å·æ°</h3><pre>`// webpack.config.jsentry: [    'webpack/hot/dev-server',    'webpack-dev-server/client?http://localhost:8080',    path.resolve(__dirname, 'app/main.js')  ],  devServer:{    historyApiFallback: true,    hot:true,    inline:true,    progress: true  }`</pre><p><pre>`//package.json</pre></p></li></ul><p>âdevâ: âwebpack-dev-server âprogress âcolors âinline âhot âcontent-base build/â,<br>    âbuildâ: âwebpackâ<br><code>`</code></p><p>æ­¤æ¶è®¿é® localhost:8080 ç¸å½äºè®¿é® build/, æä»¥å¯ä»¥çç¥ index.html</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>React Ajax</title>
      <link href="/2016/08/02/react-ajax/"/>
      <content type="html"><![CDATA[<p>ç»ä»¶çæ°æ®æ¥æº, éå¸¸æ¯éè¿ AJAX è¯·æ±ä»æå¡å¨è·å, å¯ä»¥ä½¿ç¨ <code>componentDidMount</code> æ¹æ³è®¾ç½® AJAX è¯·æ±, ç­å°è¯·æ±æå, åç¨<code>this.setState()</code>æ¹æ³éæ°æ¸²æ UI.</p><pre><code>var UserGist = React.createClass({  getInitialState(){    return {      userName: &apos;&apos;,      lastGistUrl: &apos;&apos;    }  },  componentDidMounted(){    $.get(this.props.source, function(result){      var lastGist = result[0];      if(this.isMouted()){        this.setState({          userName: lastGist.owner.login,          lastGistUrl: lastGist.html_url        });      }    }.bind(this));  },  render(){    return (      &amp;lt;div&amp;gt;        {this.state.userName}&apos;s last Gist is         &amp;lt;a href={this.state.lastGistUrl}&amp;gt;here&amp;lt;/a&amp;gt;      &amp;lt;/div&amp;gt;    );  }});React.render(  &amp;lt;UserGist source= &apos;....&apos; /&amp;gt;, document.body)</code></pre>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> React </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>React è¡¨å</title>
      <link href="/2016/08/02/react-e8-a1-a8-e5-8d-95/"/>
      <content type="html"><![CDATA[<p>ç¨æ·å¨è¡¨åè¾å¥çåå®¹, å±äºç¨æ·ä¸ç»ä»¶çäºå¨, è¦ç¨<code>this.setState()</code>ä¿®æ¹</p><pre><code>var Input = React.crèå¥¥ç¹Class({  getInitialState(){    return {      value: &apos;Hello&apos;    };  },  handleChange(event){    this.setState({      value: event.target.value;    })  },  render(){    return(      &amp;lt;div&amp;gt;&amp;lt;input type=&apos;text&apos; onChange={this.handleChange} value = {this.state.value} /&amp;gt;&amp;lt;p&amp;gt;{this.state.value}&amp;lt;/p&amp;gt;&amp;lt;/div&amp;gt;    );  }});ReactDOM.render(  &amp;lt;Input /&amp;gt;, document.body);</code></pre>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> React </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>PropTypes ä¸ getDefaultProps</title>
      <link href="/2016/08/02/proptypes-e4-b8-8e-getdefaultprops/"/>
      <content type="html"><![CDATA[<p>ç»ä»¶çå±æ§å¯ä»¥æ¥åä»»æå¼. ææ¶åæä»¬éè¦ä¸ç§æºå¶, éªè¯å«äººä½¿ç¨ç»ä»¶æ¶, æä¾çåæ°æ¯å¦ç¬¦åè¦æ±.</p><p>ç»ä»¶ç±»ç PropTypes å±æ§, å°±æ¯ç¨æ¥éªè¯ç»ä»¶å®ä¾çå±æ§æ¯å¦ç¬¦åè¦æ±ç.</p><pre><code>var MyTitle = React.createClass({  propTypes: {    title: React.PropTypes.string.isRequried,  },  render() {    return &amp;lt;h1&amp;gt; {this.props.title} &amp;lt;/h1&amp;gt;;  }});`&lt;/pre&gt;ä¸é¢ç `MyTitle` ç»ä»¶æä¸ä¸ª `title` å±æ§, `PropTypes` åè¯ React, è¿ä¸ª `title` å±æ§æ¯å¿é¡»ç, èä¸æ°æ®ç±»åæ¯å­ç¬¦ä¸².å¦æå¨å®ä¾åçæ¶åè®¾ç½® `title=123`, æ§å¶å°ä¼æ¾ç¤ºä¸è¡éè¯¯ä¿¡æ¯&lt;pre&gt;`Warning: Failed propType: Invalid prop `title` of type `number` supplied to `MyTitle`, expected `string`.`&lt;/pre&gt;æ­¤å¤, `getDefaultProps` å¯ä»¥ç¨æ¥è®¾ç½®ç»ä»¶å±æ§çé»è®¤å¼&lt;pre&gt;`var MyTitle = React.createClass({  getDefaultProps() {    return {      title: &apos;Hello World&apos;    };  },  render(){    return &amp;lt;h1&amp;gt;{this.props.title}&amp;lt;/h1&amp;gt;;  }})ReactDOM.render(&amp;lt;MyTitle /&amp;gt;, document.body); // &apos;Hello World&apos;</code></pre>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> React </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>è·¨åèµæºå±äº« CORS</title>
      <link href="/2016/08/02/e8-b7-a8-e5-9f-9f-e8-b5-84-e6-ba-90-e5-85-b1-e4-ba-ab-cors/"/>
      <content type="html"><![CDATA[<p>CORS æ¯ä¸ä¸ª W3C æ å, å¨ç§°æ¯âè·¨åèµæºå±äº«â(cross-origin resource sharing)</p><p>ä»åè®¸æµè§å¨åè·¨åæå¡å¨ååº <code>XMLHttpRequest</code>, ä»èåæäº AJAX åªè½åæºä½¿ç¨çéå¶</p><h3 id="ç®ä»"><a href="#ç®ä»" class="headerlink" title="ç®ä»"></a>ç®ä»</h3><p>CORS éè¦æµè§å¨åæå¡å¨åæ¶æ¯æ. ç®åæææµè§å¨é½æ¯æè¯¥åè½, IE æµè§å¨ä¸è½ä½äº IE10.</p><p>æ´ä¸ª CORS éä¿¡è¿ç¨, é½æ¯æµè§å¨èªå¨å®æ, ä¸éè¦ç¨æ·åä¸, å¯¹äºå¼åèèè¨, CORS éä¿¡ä¸åæºç AJAX éä¿¡æ²¡æå·®å«, ä»£ç å®å¨ä¸æ ·. æµè§å¨ä¸æ¦åç° AJAX è·¨åè¯·æ±, å°±ä¼èªå¨æ·»å ä¸äºéå çå¤´ä¿¡æ¯. ææ¶è¿ä¼å¤åºä¸æ¬¡éå çè¯·æ±, ä½æ¯ç¨æ·ä¸ä¼ææè§.</p><p>å æ­¤, å®ç° CORS çå³é®æ¯æå¡å¨, åªè¦æå¡å¨å®ç°äº CORS æ¥å£, å°±å¯ä»¥è·¨åéä¿¡</p><h3 id="ä¸¤ç§è¯·æ±"><a href="#ä¸¤ç§è¯·æ±" class="headerlink" title="ä¸¤ç§è¯·æ±"></a>ä¸¤ç§è¯·æ±</h3><p>CORS è¯·æ±åä¸¤ç±»: ç®åè¯·æ±(simple request)åéç®åè¯·æ±(not-so-simple request)</p><p>åªè¦åæ¶æ»¡è¶³ä»¥ä¸ä¸¤å¤§æ¡ä»¶, å°±å±äºç®åè¯·æ±:</p><ol><li>è¯·æ±æ¹æ³æ¯: HEAD, GET æè POST</li><li>HTTP å¤´ä¿¡æ¯ä¸è¶åºä»¥ä¸å ç§å­æ®µ: Accept, Accept-Language, Content-Language, Last-Event-ID, Content-Type(åªéäºä¸ä¸ªå¼: application/x-www-form-urlencoded, multipart/form-data, text/plain)</li></ol><p>å¡æ¯ä¸è½åæ¶æ»¡è¶³ä¸é¢ä¸¤ä¸ªæ¡ä»¶ç, å°±å±äºéç®åè¯·æ±.</p><h3 id="ç®åè¯·æ±"><a href="#ç®åè¯·æ±" class="headerlink" title="ç®åè¯·æ±"></a>ç®åè¯·æ±</h3><h4 id="åºæ¬æµç¨"><a href="#åºæ¬æµç¨" class="headerlink" title="åºæ¬æµç¨"></a>åºæ¬æµç¨</h4><p>å¯¹äºç®åè¯·æ±, æµè§å¨ç´æ¥ååº CORS è¯·æ±, å·ä½æ¥è¯´, å°±æ¯å¨å¤´ä¿¡æ¯ä¸­å¢å ä¸ä¸ª<code>Origin</code>å­æ®µ</p><pre><code>GET /cors HTTP/1.1Origin: http://api.bob.comHost: api.alice.comAccept-Language: en-USConnection: keep-aliveUser-Agent: Mozilla/5.0...`&lt;/pre&gt;ä¸é¢çå¤´ä¿¡æ¯ä¸­, `Origin`å­æ®µç¨æ¥è¯´æ, æ¬æ¬¡è¯·æ±æ¥æ­¤åªä¸ªæº(åè®®+åå+ç«¯å£), æå¡å¨æ ¹æ®è¿ä¸ªå¼, å³å®æ¯å¦åææ­¤æ¬¡è¯·æ±.å¦æ`Origin`æå®çæº, ä¸å¨è®¸å¯èå´å, æå¡å¨ä¼è¿åä¸ä¸ªæ­£å¸¸ç HTTP ååº. **æµè§å¨**åç°è¿ä¸ªååºçå¤´ä¿¡æ¯ä¸­æ²¡æåå«`Access-Control-Allow-Origin`å­æ®µ, å°±ç¥éåºéäº, ä»èæåºä¸ä¸ªéè¯¯, è¢«`XMLHttpRequest`ç`onerror`åè°å½æ°æè·. æ³¨æ, è¿ç§éè¯¯æ æ³éè¿ç¶æç è¯å«, å ä¸º HTTP ååºçç¶æç å¯è½æ¯200.å¦æ`Origin`æå®çååå¨è®¸å¯èå´å, æå¡å¨è¿åçç¸åº, ä¼å¤åºå ä¸ªå¤´ä¿¡æ¯å­æ®µ&lt;pre&gt;`Access-Control-Allow-Origin: http://api.bob.comAccess-Control-Allow-Credentials: trueAccess-Control-Expose-Headers: FooBarContent-Type: text/html; charset=utf-8`&lt;/pre&gt;ä¸é¢çå¤´ä¿¡æ¯ä¸­, æä¸ä¸ªä¸ CORS è¯·æ±ç¸å³çå­æ®µ, é½ä»¥ `Access-Control-` å¼å¤´##### Access-Control-Allow-Originè¿ä¸ªå­æ®µæ¯å¿é¡»ç, ä»çå¼è¦ä¹æ¯è¯·æ±æ¶ `Origin` çå¼, è¦ä¹æ¯ä¸ä¸ª `*`, è¡¨ç¤ºæ¥æ¶ä»»æååçè¯·æ±##### Access-Control-Allow-Credentialsè¯¥å­æ®µæ¯å¯éç, æ¯ä¸ä¸ªå¸å°å¼, è¡¨ç¤ºæ¯å¦åè®¸åé Cookie. é»è®¤æåµä¸, Cookie ä¸åæ¬å¨ CORS è¯·æ±ä¹ä¸­.è®¾ä¸º `true` è¡¨ç¤ºæå¡å¨æç¡®è®¸å¯, Cookie å¯ä»¥åæ¬å¨è¯·æ±ä¹ä¸­, ä¸èµ·åç»æå¡å¨è¿ä¸ªå¼ä¹åªè½è®¾ä¸º`true`, å¦ææå¡å¨ä¸éè¦æµè§å¨åé Cookie, å é¤å­æ®µå³å¯##### Access-Control-Expose-Headersè¯¥å­æ®µå¯é, CORS è¯·æ±æ¶, `XMLHttpRequest` å¯¹è±¡ç `getResponseHeader()` æ¹æ³åªè½æ¿å°6ä¸ªåºæ¬å­æ®µ- Cache-Control- Content-Language- Content-Type- Expires- Last-Modified-Pragmaå¦ææ³è¦æ¿å°å¶ä»å­æ®µ, å¿é¡»å¨ `Access-Control-Expose-Headers` éé¢æå®ä¸é¢çä¾å­ä¸­, `getResponseHeader(&apos;FooBar&apos;)` å¯ä»¥è¿å `FooBar` å­æ®µçå¼#### withCredentials å±æ§CORS è¯·æ±é»è®¤ä¸åé Cookie å HTTP è®¤è¯ä¿¡æ¯, å¦æè¦æ Cookie åéç»æå¡å¨, ä¸æ¹é¢è¦æå¡å¨åæ, æå® `Access-Control-Allow-Credentials` å­æ®µ&lt;pre&gt;`Access-Control-Allow-Credientials: true`&lt;/pre&gt;å¦ä¸æ¹é¢, å¼åèéè¦å¨ AJAX è¯·æ±ä¸­æå¼`withCredientials`å±æ§&lt;pre&gt;`var xhr = new XMLHttpRequest();xhr.withCredientials = true;`&lt;/pre&gt;å¦åå³ä½¿æå¡å¨åæåé Cookie, æµè§å¨ä¹ä¸ä¼åéè¦æ³¨æ, å¦æè¦åé Cookie, `Access-Control-Allow-Origin` ä¸è½è®¾ç½®ä¸º `*`, å¿é¡»æå®æç¡®ç, ä¸è¯·æ±ç½é¡µä¸è´çåå. åæ¶ Cookie ä¾ç¶éµå¾ªåæºæ¿ç­, åªæç¨æå¡å¨ååè®¾ç½®ç Cookie æä¼ä¸ä¼ , å¶ä»ååç Cookie ä¸ä¼ä¸ä¼ .### éç®åè¯·æ±#### é¢æ£è¯·æ±éç®åè¯·æ±æ¯é£ç§å¯¹æå¡å¨æç¹æ®è¦æ±çè¯·æ±, æ¯å¦è¯·æ±æ¹æ³æ¯ `PUT`, æ `DELETE`, æè `Content-Type` å­æ®µç±»åæ¯ `application/json`éç®åè¯·æ±ç CORS è¯·æ±, ä¼å¨æ­£æ¯éä¿¡é±, å¢å ä¸æ¬¡ HTTP æ¥è¯¢è¯·æ±, ç§°ä¸º &quot;é¢æ£è¯·æ±&quot; (preflight)æµè§å¨åè¯¢é®æå¡å¨, å½åç½é¡µæå¨çååæ¯å¦å¨æå¡å¨çè®¸å¯ååä¸­, ä»¥åå¯ä»¥ä½¿ç¨åªäº HTTP å¨è¯åå¤´ä¿¡æ¯å­æ®µ, åªæå¾å°è¯å®çç­å¤, æµè§å¨æä¼ååºæ­£å¼ç `XMLHttpRequest` è¯·æ±, å¦åå°±æ¥éä¸é¢æ¯ä¸æ®µæµè§å¨ç JavaScript èæ¬&lt;pre&gt;`var url = &apos;http://api.alice.com/cors&apos;var xhr = new XMLHttpRequest();xhr.open(&apos;PUT&apos;, url, true);xhr.setRequestHeader(&apos;X-Custom-Header&apos;, &apos;value&apos;);xhr.send()`&lt;/pre&gt;ä¸é¢ä»£ç ä¸­, HTTP è¯·æ±çæ¹æ³æ¯ `PUT`, å¹¶ä¸åéä¸ä¸ªèªå®ä¹å¤´ä¿¡æ¯ `X-Custom-Header`æµè§å¨åç°è¿æ¯ä¸ä¸ªéç®åè¯·æ±, å°±èªå¨ååºä¸ä¸ª &quot;é¢æ£&quot; è¯·æ±, è¦æ±æå¡å¨ç¡®è®¤å¯ä»¥è¿æ ·è¯·æ±. ä¸é¢æ¯è¿ä¸ª &quot;é¢æ£&quot; è¯·æ±ç HTTP å¤´ä¿¡æ¯&lt;pre&gt;`OPTIONS /cors HTTP/1.1Origin: http://api.bob.comAccess-Control-Request-Method: PUTAccess-Control-Request-Headers: X-Custom-HeaderHost: api.alice.comConnection: keep-aliveUser-Agent: Molliza/5.0...`&lt;/pre&gt;&quot;é¢æ£&quot; è¯·æ±ç¨çè¯·æ±æ¹æ³æ¯ `OPTIONS`, è¡¨ç¤ºè¿ä¸ªè¯·æ±æ¯ç¨æ¥è¯¢é®ç, å¤´ä¿¡æ¯éé¢, å³é®å­æ®µæ¯ `Origin`, &quot;é¢æ£&quot; ç§¦ç§çå¤´ä¿¡æ¯åæ¬ä¸¤ä¸ªç¹æ®å­æ®µ- Access-Control-Request-Method  è¿ä¸ªå­æ®µæ¯å¿é¡»ç, ç¨æ¥ååºè¯·æ±æ¹æ³</code></pre><ul><li><p>Access-Control-Request-Headers<br>è¯¥å­æ®µæ¯ä¸ä¸ªéå·åéçå­ç¬¦ä¸², æ°¸å®éæå®æµè§å¨ CORS è¯·æ±ä¼æ ¼å¤åéçå¤´ä¿¡æ¯å­æ®µ</p><h5 id="é¢æ£è¯·æ±çååº"><a href="#é¢æ£è¯·æ±çååº" class="headerlink" title="é¢æ£è¯·æ±çååº"></a>é¢æ£è¯·æ±çååº</h5><p>æå¡å¨åå¾âé¢æ£âè¯·æ±å, æ£æ¥<code>Origin</code>, <code>Access-Control-Request-Method</code> å <code>Access-Control-Request-Header</code> å­å¼¹å, ç¡®è®¤åè®¸è·¨æºè¯·æ±, å°±å¯ä»¥ååºååº</p><pre>`HTTP/1.1 200 OKDate: Mon, 01 Dec 2008 01:15:39 GMTServer: Apache/2.0.61 (Unix)Access-Control-Allow-Origin: http://api.bob.comAccess-Control-Allow-Methods: GET, POST, PUTAccess-Control-Allow-Headers: X-Custom-HeaderContent-Type: text/html; charset=utf-8Content-Encoding: gzipContent-Length: 0Keep-Alive: timeout=2, max=100Connection: Keep-AliveContent-Type: text/plain`</pre><p>ä¸é¢ HTTP ååºä¸­, å³é®çæ¯ <code>Access-Control-Allow-Origin</code> å­æ®µ, è¡¨ç¤º <code>http://api.bob.com</code> å¯ä»¥è¯·æ±æ°æ®, è¯¥å­æ®µä¹å¯ä»¥è®¾ç½®ä¸º<code>*</code>, è¡¨ç¤ºåæè·¨æºè¯·æ±.</p><p>å¦ææµè§å¨å¦å®äºâé¢æ£âè¯·æ±, è¿åä¸ä¸ªæ­£å¸¸ç HTTP ååº, ä½æ¯æ²¡æä»»ä½ CORS ç¸å³çå¤´ä¿¡æ¯å­æ®µ, è¿æ¶åæµè§å¨ä¼è®¤ä¸ºæå¡å¨ä¸åæé¢æ£è¯·æ±, ä»èè§¦åä¸ä¸ªéè¯¯, è¢« <code>XMLHttpRequest</code> å¯¹è±¡ç <code>onerror</code> åè°å½æ°æè·, æ§å¶å°ä¼æå°å¦ä¸æ¥éä¿¡æ¯</p><pre>`XMLHttpRequest cannot load http://api.alice.com.Origin http://api.bob.com is not allowed by Access-Control-Allow-Origin.`</pre><p>æå¡å¨ååºå¶ä» CORES ç¸å³å­æ®µå¦ä¸:</p><pre>`Access-Control-Allow-Methods: GET, POST, PUTAccess-Control-Allow-Headers: X-Custom-HeaderAccess-Control-Allow-Credentials: trueAccess-Control-Max-Age: 1728000`</pre><h5 id="Access-Control-Allow-Method"><a href="#Access-Control-Allow-Method" class="headerlink" title="Access-Control-Allow-Method"></a>Access-Control-Allow-Method</h5><p>è¯¥å­æ®µæ¯å¿é¡»ç, ä»çå¼æ¯éå·åéçä¸ä¸ªå­ç¬¦ä¸², è¡¨ææå¡å¨æ¯æçè·¨åè¯·æ±æ¹å¼</p><h5 id="Access-Control-Allow-Headers"><a href="#Access-Control-Allow-Headers" class="headerlink" title="Access-Control-Allow-Headers"></a>Access-Control-Allow-Headers</h5><p>å¦ææµè§å¨åå«<code>Access-Control-Request-Headers</code>, å <code>Access-Control-Allow-Headers</code> ä¹æ¯å¿é¡»ç, å¶å¼ä¹æ¯ä¸ä¸ªéå·åéçå­ç¬¦ä¸²</p><h5 id="Access-Control-Allow-Credentials"><a href="#Access-Control-Allow-Credentials" class="headerlink" title="Access-Control-Allow-Credentials"></a>Access-Control-Allow-Credentials</h5><p>è¯¥å­æ®µä¸ç®åè¯·æ±æ¶çå«ä¹ç¸å</p><h5 id="Access-Control-Max-Age"><a href="#Access-Control-Max-Age" class="headerlink" title="Access-Control-Max-Age"></a>Access-Control-Max-Age</h5><p>è¯¥å­æ®µå¯é, æ°¸å®éæå®æ¬æ¬¡é¢æ£è¯·æ±çæææ(s), æææååèµ·è·¨åè¯·æ±ä¸éè¦é¢æ£è¯·æ±.</p><h4 id="æµè§å¨çæ­£å¸¸è¯·æ±ä¸ååº"><a href="#æµè§å¨çæ­£å¸¸è¯·æ±ä¸ååº" class="headerlink" title="æµè§å¨çæ­£å¸¸è¯·æ±ä¸ååº"></a>æµè§å¨çæ­£å¸¸è¯·æ±ä¸ååº</h4><p>ä¸æ¦æå¡å¨éè¿âé¢æ£âè¯·æ±, ä»¥åæ¯æ¬¡æµè§å¨æ­£å¸¸ç CORS è¯·æ±, é½ä¼åç®åè¯·æ±ä¸æ ·, æä¸ä¸ª<code>Origin</code> å¤´ä¿¡æ¯å­æ®µ, æå¡å¨çååºä¹ä¼æä¸ä¸ª<code>Access-Control-Allow-Origin</code>å¤´ä¿¡æ¯å­æ®µ</p><p>âé¢æ£âè¯·æ±ä¹å, æµè§å¨çæ­£å¸¸ CORS è¯·æ±</p><pre>`PUT /cors HTTP/1.1Origin: http://api.bob.comHost: api.alice.comX-Custom-Header: valueAccess-Language: en-USConnection: keep-aliveUser-Agent: Mozilla/5.0...`</pre><p>å¶ä¸­<code>Origin</code>å­æ®µæ¯æµè§å¨èªå¨æ·»å ç</p><p>æå¡å¨çæ­£å¸¸ååº</p><p><pre>`Access-Control-Allow-Origin: <a href="http://api.bob.com" target="_blank" rel="noopener">http://api.bob.com</a><br>Content-Type: text/html; charset=utf-8</pre></p></li></ul>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AJAX </tag>
            
            <tag> CORS </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>æµè§å¨åæºæ¿ç­åå¶è§é¿æ¹æ³</title>
      <link href="/2016/08/02/e6-b5-8f-e8-a7-88-e5-99-a8-e5-90-8c-e6-ba-90-e6-94-bf-e7-ad-96-e5-8f-8a-e5-85-b6-e8-a7-84-e9-81-bf-e6-96-b9-e6-b3-95/"/>
      <content type="html"><![CDATA[<p>æµè§å¨å®å¨çåºç³æ¯âåæºæ¿ç­â(same-origin policy).</p><h3 id="æ¦è¿°"><a href="#æ¦è¿°" class="headerlink" title="æ¦è¿°"></a>æ¦è¿°</h3><p>æè°âåæºâ, æ¯æä¸ä¸ªâç¸åâ.</p><ul><li>åè®®ç¸å: <code>http:\\</code></li><li>ååç¸å: <code>www.example.com</code> ä¸ <code>example.com</code> ä¸å</li><li>ç«¯å£ç¸å</li></ul><h3 id="ç®ç"><a href="#ç®ç" class="headerlink" title="ç®ç"></a>ç®ç</h3><p>åæºæ¿ç­çç®çæ¯ä¸ºäºä¿è¯ç¨æ·ä¿¡æ¯å®å¨, é²æ­¢æ¶æçç½ç»çªåæ°æ®</p><h3 id="éå¶èå´"><a href="#éå¶èå´" class="headerlink" title="éå¶èå´"></a>éå¶èå´</h3><p>å¦æéåæº, å±æä¸ç§è¡ä¸ºåå°éå¶</p><ul><li>Cookie, LocalStorage å IndexDB æ æ³è¯»å</li><li>DOM æ æ³è·å¾</li><li>AJAX è¯·æ±æ æ³åé</li></ul><h3 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h3><p>Cookie æ¯æå¡å¨åå¥æµè§å¨çä¸å°æ®µä¿¡æ¯, åªæåæºçç½ç«æè½å±äº«. ä½æ¯ä¸¤ä¸ªç½é¡µä¸çº§ååç¸å, åªæäºçº§ååä¸å, æµè§å¨åè®¸éè¿è®¾ç½® <code>document.domain</code> å±äº« Cookie.</p><p>ä¸¾ä¾æ¥è¯´, A ç½é¡µæ¯ <code>http://w1.example.com/a.html</code>, B ç½é¡µæ¯ <code>http://w2.example.com/b.html</code>, é£ä¹åªè¦è®¾ç½®ç¸åç <code>document.domain</code>, è¿ä¸¤ä¸ªç½é¡µå¯ä»¥å±äº« Cookie.</p><pre><code>document.domain = &apos;example.com&apos;;`&lt;/pre&gt;ç°å¨ A ç½é¡µéè¿èæ¬è®¾ç½®ä¸ä¸ª Cookie&lt;pre&gt;`document.cookie = &apos;test1=hello&apos;;`&lt;/pre&gt;B ç½é¡µå°±å¯ä»¥è¯»åè¿ä¸ª Cookie&lt;pre&gt;`var allCookie = document.cookie;`&lt;/pre&gt;æ³¨æ, è¿ç§æ¹æ³åªéç¨äº Cookie å iframe çªå£, LocalStorage å IndexDB æ æ³éè¿è¿ç§æ¹æ³, è§é¿åæºæ¿ç­.å¦å¤, æå¡å¨ä¹å¯ä»¥å¨è®¾ç½® Cookie çæ¶åæå® Cookie æå±ååä¸ºä¸çº§åå, æ¯å¦ `.example.com`&lt;pre&gt;`Set-Cookie: key=value; domain=.example.com; path=/`&lt;/pre&gt;è¿æ ·çè¯, äºçº§åååä¸çº§ååä¸ç¨åä»»ä½è®¾ç½®å°±å¯ä»¥è¯»åè¿ä¸ª Cookie### iframeå¦æä¸¤ä¸ªç½é¡µä¸åæº, å°±æ æ³æ¿å°å¯¹æ¹ç DOM, å¸åçä¾å­å°±æ¯`iframe`çªå£å`window.open` æ¹æ³æå¼ççªå£, ä»ä»¬ä¸ç¶çªå£æ æ³éä¿¡.å¦æä¸¤ä¸ªçªå£ä¸çº§ååç¸å, åªæ¯äºçº§ååä¸å, é£ä¹è®¾ç½®`document.domain`ä¹å¯ä»¥è§é¿åæºæ¿ç­, å®ç° DOM è·å.### å®å¨ä¸åæºçç½ç«#### çæ®µè¯å«ç¬¦(fragment identifier)çæ®µè¯å«ç¬¦å¼å¾æ¯ URL ä¸­`#` åçé¨å, ä¹å°±æ¯ hash.å¦æåªæ¯æ¹åçæ®µè¯å«ç¬¦, é¡µé¢ä¸ä¼éæ°å·æ°ç¶çªå£å¯ä»¥æä¿¡æ¯åå¥å­çªå£ççæ®µè¯å«ç¬¦&lt;pre&gt;`var src = originURL + &apos;#&apos; + data;document.getElementById(&apos;myFrame&apos;).src = src;`&lt;/pre&gt;å­çªå£éè¿çå¬ `hashchange` äºä»¶å¾å°éç¥&lt;pre&gt;`window.onhashchange = checkMessage;function checkMessage(){  var message = window.location.hash;  // ...}`&lt;/pre&gt;åæ ·å­çªå£ä¹å¯ä»¥æ¹åç¶çªå£ççæ®µè¯å«ç¬¦&lt;pre&gt;`parent.location.href = target + &quot;#&quot; + hash;`&lt;/pre&gt;#### window.nameæµè§å¨çªå£æ `window.name` å±æ§, è¿ä¸ªå±æ§çæå¤§ç¹ç¹æ¯, æ è®ºæ¯å¦åæº, åªè¦å¨åä¸ä¸ªçªå£é, åä¸ä¸ªç½é¡µè®¾ç½®è¿ä¸ªå±æ§å, åä¸ä¸ªç½é¡µå¯ä»¥è¯»åä»ç¶çªå£åæå¼ä¸ä¸ªå­çªå£, è½½å¥ä¸ä¸ªä¸åæºçç½ç«, è¯¥ç½é¡µå°åå¥ `widnow.name` å±æ§&lt;pre&gt;`window.name = data;`&lt;/pre&gt;æ¥ç, å­çªå£è·³åä¸ä¸ªä¸ä¸»çªå£ååçç½å&lt;pre&gt;`location = &apos;http:parent.url.com/xxx.html&apos;`&lt;/pre&gt;ç¶åä¸»çªå£å°±å¯ä»¥è¯»åå­çªå£ç `window.name` å±æ§äº&lt;pre&gt;`var data = document.getElementById(&apos;myFrame&apos;).contentWindow.name;`&lt;/pre&gt;è¿ç§æ¹æ³çä¼ç¹æ¯ `window.name` å®¹éå¤§, ç¼ºç¹æ¯å¿é¡»çå¬å­çªå£ç `window.name` å±æ§çåå, å½±åæ§è½.#### window.postMessageä»¥ä¸ä¿¡æ¯é½å±äºç ´è§£, HTML5 ä¸ºäºè§£å³è¿ä¸ªé®é¢, å¼å¥ä¸ä¸ªå¨æ°ç API: è·¨ææ¡£éä¿¡ API(Cross-document messaging)è¿ä¸ª API ä¸º `window` å¯¹è±¡æ°å¢ä¸ä¸ª `window.postMessage` æ¹æ³, åè®¸è·¨çªå£éä¿¡, ä¸è®ºä¸¤ä¸ªçªå£æ¯å¦åæº.ä¸¾ä¾æ¥è¯´, ç¶çªå£ `http://aaa.com` åå­çªå£ `http://bbb.com` åæ¶æ¯, è°ç¨ `postMessage` æ¹æ³å°±å¯ä»¥äº&lt;pre&gt;`var popup = window.open(&apos;http://bbb.com&apos;, &apos;title&apos;);popup.postMessage(&apos;Hello World&apos;, &apos;http://bbb.com&apos;);`&lt;/pre&gt;`postMessage` æ¹æ³çç¬¬ä¸ä¸ªåæ°æ¯è¦ä¼ éç Message, ç¬¬äºä¸ªåæ°æ¯æ¥åä¿¡æ¯ççªå£çæº(origin), å³`åè®®+åå+ç«¯å£`, ä¹å¯ä»¥è®¾ç½®ä¸º`*`, è¡¨ç¤ºä¸éå¶åå, åææçªå£åé.å­çªå£åç¶çªå£åéæ¶æ¯çåæ³ç±»ä¼¼&lt;pre&gt;`window.opener.postMessage(&apos;Hello World&apos;, &apos;http://aaa.com&apos;);`&lt;/pre&gt;éè¿`message`äºä»¶çå¬å¯¹è±¡æ¶æ¯&lt;pre&gt;`window.addEventListener(&apos;message&apos;, function(e){console.log(e.data);}, false);`&lt;/pre&gt;`message` äºä»¶çäºä»¶å¯¹è±¡ `event` , æä¾ä¸ä¸ä¸ä¸ªå±æ§</code></pre><ul><li><code>event.source</code>: åéä¿¡æ¯ççªå£, å­çªå£éè¿ <code>event.source</code> å¼ç¨ç¶çªå£ç¶ååéæ¶æ¯<pre>`window.addEventListener('message', receiveMessage);function receiveMessage(event){event.source.postMessage('Hello Opener', '*');}`</pre></li><li>âevent.originâ: åéä¿¡æ¯çç½å(â<a href="http://aaa.com&#39;)" target="_blank" rel="noopener">http://aaa.com&#39;)</a>, å¯ä»¥è¿æ»¤ä¸æ¯æå®æ¥æºçä¿¡æ¯<pre>`window.addEventListener('message', receiveMessage);function receiveMessage(event){if (event.origin != 'http://aaa.com') return;if (event.data === 'Hello World') {  event.source.postMessage('Hello', event.origin);} else {  console.log(event.data);}}`</pre></li><li><p>âevent.dataâ: ä¿¡æ¯åå®¹</p><p></p><h4 id="LocalStorage"><a href="#LocalStorage" class="headerlink" title="LocalStorage"></a>LocalStorage</h4><p></p><p>éè¿ <code>window.postMessage</code> è¯»åå¶ä»çªå£ç <code>LocalStorage</code> ä¹æ¯å¯è½ç</p><p>ä¾: ä¸»çªå£åå¥ <code>iframe</code> å­çªå£ç <code>localStorage</code></p><pre>`window.onmessage = function(event){  if(event.origin !== 'http://bbb.com') return;  var payload = JSON.parse(event.data);  localStorage.setItem(payload.key, JSON.stringify(payload.data));};`</pre><p>ä¸é¢ä»£ç ä¸­, å­çªå£å°ç¶çªå£åéçæ¶æ¯åå¥èªå·±ç <code>localStorage</code></p><p>ç¶çªå£åéæ¶æ¯çä»£ç å¦ä¸:</p><pre>`var win = document.getElementByTagName('iframe')[0].contentWindow;var obj = { name: 'Jack' };win.postMessage(JSON.stringify({key: 'storage', data: obj}), 'http://bbb.com');`</pre><p>å å¼ºçå­çªå£æ¥æ¶æ¶æ¯çä»£ç </p><pre>`window.onmessage = function(e) {  if (e.origin !== 'http://bbb.com') return;  var payload = JSON.parse(e.data);  switch(payload.method) {    case 'set': localStorage.setItem(payload.key, JSON.stringify(parload.data));                break;    case 'get': var parent = window.parent;                var data = localStorage.getItem(payload.key);                parent.postMessage(data, 'http://aaa.com');                break;    case 'remove': localStorage.removeItem(payload.key);                   break;  }};`</pre><p>å å¼ºççç¶çªå£æ¶æ¯åéä»£ç </p><pre>`var win = document.getElementByTagName('iframe')[0].contentWindow;var obj = { name: 'Jack' };// å­å¥å¯¹è±¡win.postMessage(JSON.stringify(key: 'storage', method: 'set', data: obj), 'http://bbb.com');// è¯»åå¯¹è±¡win.postMessage(JSON.stringify(key: 'storage', method: 'get',), '*');window.onmessage = function(e){  if(e.origin !== 'http://bbb.com') return;  // 'Jack'  console.log(JSON.parse(e.data).name);};`</pre><h3 id="AJAX"><a href="#AJAX" class="headerlink" title="AJAX"></a>AJAX</h3><p>åæºæ¿ç­è§å®, AJAX è¯·æ±åªè½åç»åæºçç½å, å¦åä¼æ¥é</p><p>é¤äºåè®¾æå¡å¨ä»£ç, æä¸ä¸­æ¹æ³è§é¿è¿ä¸ªéå¶</p><h4 id="JSONP"><a href="#JSONP" class="headerlink" title="JSONP"></a>JSONP</h4><p>JSONP æ¯æå¡å¨ä¸å®¢æ·ç«¯è·¨æºéä¿¡çå¸¸ç¨æ¹æ³, æå¤§ç¹ç¹æ¯ç®åå®ç¨, èå¼æµè§å¨å¨é¨æ¯æ, æå¡å¨æ¹é éå¸¸å°.</p><p>åºæ¬ææ³æ¯, ç½é¡µéè¿æ·»å ä¸ä¸ª<code>&amp;lt;script&amp;gt;</code>åç´ , åæå¡å¨è¯·æ± JSON æ°æ®,å¨ä½ç§åæ³ä¸ååæºæ¿ç­éå¶. æå¡å¨æ¥æ¶è¯·æ±å, å°æ°æ®æ¾å¨ä¸ä¸ªæå®åå­çåè°å½æ°éä¼ åæ¥.</p><p>é¦å, ç½é¡µå¨ææå¥<code>&amp;lt;script&amp;gt;</code>åç´ , ç±å®åè·¨æºç½åååºè¯·æ±.</p><pre>`function addScriptTag(src) {  var script = document.createElement('script');  script.setAttribute('type', 'text/javascript');  script.src = src;  document.body.appendChild(script);}window.onload = function(){  addScritpTag('http://example.com/ip?callback=foo');}function foo(data){  console.log("Your public IP address is: " + data.ip);};`</pre><p>ä¸é¢çä»£ç éè¿å¨ææ·»å <code>&amp;lt;script&amp;gt;</code>åç´ , åæå¡å¨<code>example.com</code>ååºè¯·æ±. æ³¨æ, è¯¥è¯·æ±çæ¥è¯¢å­ç¬¦ä¸²æä¸ä¸ª<code>callback</code> åæ°, ç¨æ¥æå®åè°å½æ°çåå­, è¿å¯¹ JSONP æ¯å¿é¡»ç.</p><p>æå¡å¨æ¥æ¶å°è¿ä¸ªè¯·æ±å, ä¼å°æ°æ®æ¾å¨åè°å½æ°çåæ°ä½ç½®è¿å.</p><pre>`foo({  'ip': '8.8.8.8'});`</pre><p>ç±äº<code>&amp;lt;script&amp;gt;</code>åç´ è¯·æ±çèæ¬, ç´æ¥ä½ä¸ºä»£ç è¿è¡, è¿æ¶åªè¦æµè§å¨å®ä¹äº<code>foo</code>å½æ°, è¯¥å½æ°å°±ä¼ç«å³è°ç¨. ä½ä¸ºåæ°ç JSON æ°æ®ä¼è¢«è§ä¸º JavaScript å¯¹è±¡, èä¸æ¯å­ç¬¦ä¸², å æ­¤é¿åäºä½¿ç¨<code>JSON.parse</code>çæ­¥éª¤</p><h4 id="WebSocket"><a href="#WebSocket" class="headerlink" title="WebSocket"></a>WebSocket</h4><p>WebSocket æ¯ä¸ç§éä¿¡åè®®, ä½¿ç¨<code>ws://</code>(éå å¯)å<code>wss://</code>(å å¯)ä½ä¸ºåè®®åç¼.</p><p>è¯¥åè®®ä¸å®è¡åæºæ¿ç­, åªè¦æå¡å¨æ¯æ, å°±å¯ä»¥ä¸ä»è¿è¡å¤¸æºéä¿¡.</p><p>ä¸é¢æ¯ä¸ä¸ªä¾å­, æµè§å¨ååºç WebSocket è¯·æ±çå¤´ä¿¡æ¯:</p><p><pre>`GET /chat HTTP/1.1<br>Host: server.example.com<br>Upgrade: websocket<br>Connection: Upgrade<br>Sec-WebSocket-Key: x3JJHMbDL1EzLkh9GBhXDw==<br>Sec-WebSocket-Protocol: chat, superchat<br>Sec-WebSocket-Version: 13<br>Origin: <a href="http://example.com" target="_blank" rel="noopener">http://example.com</a></pre></p></li></ul><p>ä¸é¢ä»£ç ä¸­, æä¸ä¸ªå­æ®µæ¯<code>Origin</code>, è¡¨ç¤ºè¯¥è¯·æ±çè¯·æ±æº(origin)</p><p>æ­£å¼å ä¸ºæäº<code>Origin</code>è¿ä¸ªå­æ®µ, æä»¥ WebSocket ææ²¡æå®è¡åæºæ¿ç­, å ä¸ºæå¡å¨å¯ä»¥æ ¹æ®è¿ä¸ªå­æ®µå¤æ­æ¯å¦è®¸å¯æ­¤æ¬¡éä¿¡</p><h4 id="CORS"><a href="#CORS" class="headerlink" title="CORS"></a>CORS</h4><p>CORS æ¯è·¨æºèµæºåäº«(Corss-Origin Resource Sharing) çç¼©å, æ¯ W3C æ å, æ¯è·¨æº AJAX è¯·æ±çæ ¹æ¬è§£å³åæ³. ç¸æ¯ JSONP åªè½å<code>GET</code>è¯·æ±, CORS åè®¸ä»»ä½ç±»åçè¯·æ±.</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AJAX </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Node.js URL æ¨¡åçä½¿ç¨</title>
      <link href="/2016/08/01/node-js-url-e6-a8-a1-e5-9d-97-e7-9a-84-e4-bd-bf-e7-94-a8/"/>
      <content type="html"><![CDATA[<p>Node.js ä¸­ç URL æ¨¡å, ç¨äºå° URL å­ç¬¦ä¸²è§£æä¸ºå¯¹è±¡æå°å¯¹è±¡æ ¼å¼åä¸º URL å­ç¬¦ä¸², è¯¥æ¨¡åæ¯è¾ç®å, å±åæ¬3ä¸ªæ¹æ³:</p><h3 id="URL-åé¨åè¯´æ"><a href="#URL-åé¨åè¯´æ" class="headerlink" title="URL åé¨åè¯´æ"></a>URL åé¨åè¯´æ</h3><p>å¯¹äºä¸ä¸ª URL å­ç¬¦ä¸², å¶ç»æé¨åä¼ææä¸å. å¶ä¸­æäºé¨ååªæå¨ URL å­ç¬¦ä¸²ä¸­å­å¨æ¶, å¯¹åºå­æ®µè¿æä¼åºç°å¨è§£æåçå¯¹è±¡ä¸­. ä»¥ä¸æ¯ä¸ä¸ª URL ä¾å­</p><pre><code>http://user:pass@host.com:8080/path/to/file?query=string#hash`&lt;/pre&gt;è§£æåçå­æ®µå¦ä¸:- `href`: è§£æåçå®æ´åå§ URL, åè®®ååä¸»æºåå·²ç»è½¬ä¸ºå°å- `protocol`: è¯·æ±åè®®, å°å, ä¾å¦`http:`- `slashes`: åè®®ç`:`åé¢æ¯å¦æ`\`, è¿å`true`æ`false`- `host`: URL ä¸»æºå, åæ¬ç«¯å£ä¿¡æ¯, å°å, ä¾å¦`host.com:8080`- `auth`: URL ä¸­çè®¤è¯ä¿¡æ¯, ä¾å¦`user:pass`- `hostname`: ä¸»æºå, å°å, ä¾å¦`host.com`- `port`: ä¸»æºçç«¯å£å·, ä¾å¦`8080`- `pathname`: URL ä¸­çè·¯å¾, ä¾å¦`/path/to/file`- `search`: æ¥è¯¢å¯¹è±¡, å³: `queryString`, åæ¬ä¹åç`?`, ä¾å¦`?query=string`; å¦æ `parseQueryString = true`, åè¿å`{&apos;query&apos;:&apos;string&apos;}`- `query`: ä¾å¦`query=string`- `hash`: éç¹é¨å, å³`#`ä¹åçé¨å, ä¾å¦`#hash`### å° URL å­ç¬¦ä¸²è½¬æ¢ä¸ºå¯¹è±¡: url.parse(urlStr[, parseQueryString[, slashesDenoteHost]])`url.parse()`æ¹æ³ç¨äºè§£æ URL å¯¹è±¡, è§£æåèæ¹ç¬¬ä¸ä¸ª JSON å¯¹è±¡. ä¾å¦:&lt;pre&gt;`&amp;gt; var url = &apos;http://user:pass@host.com:8080/path/to/file?query=string#hash&apos;undefined&amp;gt; url&apos;http://user:pass@host.com:8080/path/to/file?query=string#hash&apos;&amp;gt; var urlModule = require(&apos;url&apos;);undefined&amp;gt; urlModule.parse(url)Url {  protocol: &apos;http:&apos;,  slashes: true,  auth: &apos;user:pass&apos;,  host: &apos;host.com:8080&apos;,  port: &apos;8080&apos;,  hostname: &apos;host.com&apos;,  hash: &apos;#hash&apos;,  search: &apos;?query=string&apos;,  query: &apos;query=string&apos;,  pathname: &apos;/path/to/file&apos;,  path: &apos;/path/to/file?query=string&apos;,  href: &apos;http://user:pass@host.com:8080/path/to/file?query=string#hash&apos; }`&lt;/pre&gt;ç¬¬äºä¸ªå¯éåæ°è®¾ç½®ä¸º`true`çæ¶å, ä¼ä½¿ç¨`queryString`æ¨¡åæ¥è§£æ URL ä¸­ç`query` é¨å, é»è®¤ä¸º`false`.ç¬¬ä¸ä¸ªåæ°ä¸º`true`çæ¶å, ä¼æè¯¸å¦`//foo/bar`è¿æ ·ç URL è§£æä¸º `{host: &apos;foo&apos;, pathname: &apos;/bar&apos;}`, èä¸æ¯ `{pathname: &apos;//foo/bar&apos;}`. é»è®¤ä¸º`false`### å°å¯¹è±¡æ ¼å¼åä¸º URL å­ç¬¦ä¸²: url.format(urlObj)`url.resolve()`ç¨äºæ ¼å¼åURLå¯¹è±¡, è¾å¥ä¸ä¸ª URL å¯¹è±¡, è¿åæ ¼å¼ååç URL å­ç¬¦ä¸², ä¾å¦:&lt;pre&gt;`&amp;gt; var url = require(&apos;url&apos;);undefined&amp;gt; var urlObj = {... protocol: &apos;http:&apos;,... slashes: true,... hostname: &apos;host.com&apos;,... port: 8080,... hash: &apos;#hash&apos;,... search: &apos;?query=string&apos;,... pathname: &apos;/path/to/file&apos;... }undefined&amp;gt; var result = url.format(urlObj)undefined&amp;gt; result&apos;http://host.com:8080/path/to/file?query=string#hash&apos;`&lt;/pre&gt;### URL è·¯å¾å¤ç`url.resolve()`æ¹æ³ç¨äºå¤ç URL è·¯å¾, ä¹å¯ä»¥ç¨äºå¤çéç¹. ä¾å¦&lt;pre&gt;`url.resolve(&apos;/one/two/three&apos;, &apos;four&apos;)         // &apos;/one/two/four&apos;url.resolve(&apos;http://example.com/&apos;, &apos;/one&apos;)    // &apos;http://example.com/one&apos;url.resolve(&apos;http://example.com/one&apos;, &apos;/two&apos;) // &apos;http://example.com/two&apos;</code></pre><p>åæ°æ¼æ¥, å¦æä¹é´æ²¡æ<code>/</code>, ååæ°äºæ¿æ¢åæ°ä¸æ«å°¾çæä»¶å.</p><p>æ³¨æåºåè·¯å¾åæä»¶å.</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Node.js </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Promise in ES6</title>
      <link href="/2016/07/31/promise-in-es6/"/>
      <content type="html"><![CDATA[<p>å¨ JavaScript ä¸çä¸­, ææä»£ç é½æ¯åçº¿ç¨æ§è¡ç</p><p>å¼æ­¥æ§è¡å¯ä»¥å¯ä»¥ç¨åè°å½æ°å®ç°</p><pre><code>function callback() {  console.log(&apos;Done&apos;);}console.log(&apos;before setTimeout()&apos;);setTimeout(callback, 1000);console.log(&apos;after setTimeout()&apos;);`&lt;/pre&gt;åçä¸ä¸ªç®åç Promise ä¾å­: çæ0-2ä¹é´çéæºæ°, å¦æå°äº1, åç­å¾ä¸æ®µæ¶é´åè¿åæå, å¦åè¿åå¤±è´¥&lt;pre&gt;`function test(resolve, reject){  var timeOut = Math.random() * 2;  log(&apos;set timeout to: &apos; + timeOut + &apos; seconds.&apos;);  setTimeout(function(){    if(timeOut &amp;lt; 1) {      log(&apos;call resolve()...&apos;);      resolve(&apos;200 ok&apos;);    } else {      log(&apos;call reject()...&apos;);      reject(&apos;timeout in &apos; + timeOut + &apos; seconds&apos;);    }  }, timeOut * 1000)}`&lt;/pre&gt;è¿ä¸ª`test()`å½æ°æä¸¤ä¸ªåæ°, è¿ä¸¤ä¸ªåæ°é½æ¯å½æ°, å¦ææ§è¡æå, æä»¬å°è°ç¨`resolve(&apos;200 ok)&apos;`, å¦ææ§è¡å¤±è´¥, æä»¬å°è°ç¨`reject(&apos;timeout in &apos; + timeOut + &apos; seconds.&apos;)`. å¯ä»¥çåº, `test()`å½æ°åªå³å¿èªå·±çé»è¾, å¹¶ä¸å³å¿å·ä½ç`resolve` å`reject` å°å¦ä½å¤ç.æäºæ§è¡å½æ°, æä»¬å°±å¯ä»¥ç¨ä¸ä¸ª Promise å¯¹è±¡æ¥æ§è¡ä», å¹¶å¨å°æ¥æä¸ªæ¶å»è·å¾æåæå¤±è´¥çç»æ&lt;pre&gt;`var p1 = new Promsie(test);var p2 = p1.then(function(result){  console.log(&apos;æå: &apos; + result);});var p3 = p2.catch(function(err){  console.log(&apos;å¤±è´¥: &apos; + err);});`&lt;/pre&gt;åé`p1`æ¯ä¸ä¸ª Promise å¯¹è±¡, ä»è´è´£æ§è¡æ§è¡`test`å½æ°, ç±äº`test`å½æ°å¨åé¨æ¯å¼æ­¥æ§è¡ç, å½`test`å½æ°æ§è¡å°`resolve(&apos;ok 200&apos;)`æ¶, åè¯ Promsie å¯¹è±¡æ§è¡&lt;pre&gt;`.then(function(result){ // result æ¯éè¿ test ä¼ éç» resolve çåæ°  console.log(&apos;æå: &apos; + result);});`&lt;/pre&gt;å½`test`æ§è¡å°`reject`çæ¶å, åè¯ Promise å¯¹è±¡æ§è¡&lt;pre&gt;`.catch(function(err){ // err æ¯ test ä¼ éç» reject çåæ°  console.log(&apos;å¤±è´¥: &apos;+ err);});`&lt;/pre&gt;Promise å¯¹è±¡å¯ä»¥ä¸²èèµ·æ¥(å ä¸ºé½è¿åä¸ä¸ª Promise å¯¹è±¡)&lt;pre&gt;`new Promise(test).then(function(result){console.log(result)}).catch(function(err){console.log(err)});`&lt;/pre&gt;å¯è§, Promise æå¤§çå¥½å¤, æ¯å¨å¼æ­¥æ§è¡çæµç¨ä¸­, ææ§è¡ä»£ç åå¤çç»æä»£ç æ¸æ°å°åç¦»äº.Promise è¿å¯ä»¥åæ´å¤çäºæ, æ¯å¦æè¥å¹²ä¸ªå¼æ­¥ä»»å¡, éè¦ååä»»å¡1, å¦ææååååä»»å¡2, ä»»ä½ä»»å¡å¤±è´¥åä¸åç»§ç»­å¹¶æ§è¡éè¯¯å¤çå½æ°è¦ä¸²è¡æ§è¡è¿æ ·çå¼æ­¥ä»»å¡, åªéè¦é¾å¼è°ç¨&lt;pre&gt;`job1.then(job2).then(job3).catch(handleError);`&lt;/pre&gt;å¶ä¸­ job1, job2, job3 é½æ¯(æè¿å) Promise å¯¹è±¡&lt;pre&gt;`function job2(input){  return new Promise(function(resolve, reject){      ....    })}`&lt;/pre&gt;### å¹¶è¡æ§è¡å¼æ­¥ä»»å¡è¯æ³ä¸ä¸ªé¡µé¢èå¤©ä»»å¡, æä»¬éè¦ä»ä¸¤ä¸ªä¸åç URL åå«è·åç¨æ·çä¸ªäººä¿¡æ¯åå¥½ååè¡¨, è¿ä¸¤ä¸ªä»»å¡æ¯å¯ä»¥å¹¶è¡æ§è¡ç, ç¨`Promise.all()`å®ç°å¦ä¸:&lt;pre&gt;`var p1 = new Promise(function(resolve, reject){  setTimeout(resolve, 500, &apos;P1&apos;);});var p2 = new Promise(function(resolve, reject) {  setTimeout(resolve, 600, &apos;P2&apos;);});// åæ¶æ§è¡p1 å p2, å¹¶å¨ä»ä»¬é½æ§è¡å®æ¯åæ§è¡ thenPromise.all([p1,p2]).then(function(results){  console.log(results); // è·å¾ä¸ä¸ª Array: [&apos;P1&apos;, &apos;P2&apos;]});`&lt;/pre&gt;ææ¶å¤ä¸ªå¼æ­¥ä»»å¡æ¯ä¸ºäºå®¹é, æ¯å¦åæ¶åä¸¤ä¸ª URL è¯»å, åªéè¦è·å¾åè¿åçç»æ, è¿ç§æåµä¸ç¨`Promise.race()`å®ç°:&lt;pre&gt;`var p1 = new Promise(function(resolve, reject){  setTimeout(resolve, 500, &apos;P1&apos;);});var p2 = new Promise(function(resolve, reject){  setTimeout(resolve, 600, &apos;P2&apos;);});Promise.race([p1,p2]).then(function(result){  console.log(result); // &apos;P1&apos;});</code></pre>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javascript </tag>
            
            <tag> ES6 </tag>
            
            <tag> Promise </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>CO Module</title>
      <link href="/2016/07/31/co-module/"/>
      <content type="html"><![CDATA[<h3 id="Co-v4"><a href="#Co-v4" class="headerlink" title="Co v4"></a>Co v4</h3><p><a href="mailto:`co@4.0.0" target="_blank" rel="noopener">`co@4.0.0</a><code>has been released, which now relies on promises. It is a stepping stone towards the [aysnc/await proposal](https://github.com/lukehoban/ecmascript-asyncawait). The primary API change is how</code>co()<code>is invoked. Before,</code>co<code>returned a &quot;thunk&quot;, which you then called with a callback and optional arguments. Now,</code>co()` return s a promise.</p><pre><code>co(function* (){  var result = yield Promise.resolve(true);  return result;}).then(function (value) {  console.log(value);}, function(err) {  console.error(err.stack);});`&lt;/pre&gt;If you want to convert a `co`-generator-function into a regular function that returns a promise, you now use `co.wrap(fn*)`.&lt;pre&gt;`var fn = co.wrap(function*(val) {  return yield Promise.resolve(val);});fn(true).then(function(val){})`&lt;/pre&gt;### Platform Compatibility`co@4+` requires a `Promise` implementation. For version of node `&amp;lt; 0.11` and for many older browsers, you should/must include your own `Promise` polyfill.Node v4+ is supported out of the box, you can use `co` without flags or polyfills.### Installation&lt;pre&gt;`$ npm install co`&lt;/pre&gt;### Examples&lt;pre&gt;`var co = require(&apos;co&apos;);co(function*(){  // yield any promise  var result = yield Promise.resolve(true);}).catch(onerror);co(function*(){  // resolve multiple promises in parallel  var a = Promise.resolve(1);  var b = Promise.resolve(2);  var c = Promise.resolve(3);  var res = yield[a, b, c];  console.log(res);  // =&amp;gt; [1,2,3]}).catch(onerror);// errors can be try/catchedco(function*() {  try{    yield Promise.reject(new Error(&apos;boom&apos;));  } catch (err) {    console.error(err.message); // &apos;boom&apos;  }});function onerror(err){  // log any uncaught errors  // co will not throw any errors you do not handle  // HANDLE ALL YOUR ERRORS  console.error(err.stack);}</code></pre>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javascript </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>JavaScript Generator</title>
      <link href="/2016/07/31/javascript-generator/"/>
      <content type="html"><![CDATA[<p>ä½ç¨è¿­ä»£å¨</p><pre><code>function* argumentsGenerator() {  for (let i = 0; i &amp;lt; arguments.length; i++) {    yield arguments[i];  }}`&lt;/pre&gt;æä»¬å¸æè¿­ä»£ä¼ å¥çæ¯ä¸ªå®å&lt;pre&gt;`var argumentsIterator = argumentsGenerator(&apos;a&apos;,&apos;b&apos;,&apos;c&apos;,&apos;d&apos;);// Prints &quot;a,b,c,d&quot;console.log(  argumentsIterator.next().value,  argumentsIterator.next().value,  argumentsIterator.next().value,  argumentsIterator.next().value)`&lt;/pre&gt;æä»¬å¯ä»¥ç®åççè§£- Generator å¶å®æ¯çæ Iterator çæ¹æ³, argumentsGenerator è¢«ç§°ä¸º GeneratorFunction, ä¹æä¸äºäººæ GeneratorFunction çè¿åå¼ç§°ä¸ºä¸ä¸ª Generator- yield å¯ä»¥ä¸­æ­ GeneratorFunction çè¿è¡, èå¨ next() æ¶æ¢å¤è¿è¡- è¿åç Iterator ä¸, æ next æåæ¹æ³, è½å¤è¿åè¿­ä»£å¼. å¶ä¸­ value å±æ§åå«äºå®éè¿åå¼, done å±æ§ä¸ºå¸å°å¼, æ è®°è¿­ä»£å¨æ¯å¦å®æè¿­ä»£, è¦æ³¨æçæ¯, å¨ done: true åç»§ç»­è¿è¡ next æ¹æ³ä¼äº§çå¼å¸¸.å®æ´ç ES å®ç°ä¸­, for-of å¾ªç¯æ­£å¼ä¸ºäºå¿«éè¿­ä»£ä¸ä¸ª Iterator&lt;pre&gt;`for (let value of argumetnsIterator) {  console.log(value);}`&lt;/pre&gt;å¯ä»¥å©ç¨ yield* è¯­æ³, å° yield æä½ä»£çå°å¦ä¸ä¸ª Generator&lt;pre&gt;`let delegatedIterator = (function*() {  yield &apos;Hello!&apos;;  yield &apos;Bye!&apos;;})();let delegatingIterator = (function*() {  yield &apos;Greetings!&apos;;  yield* delegatedIterator;  yield &apos;Ok, bye!&apos;;})();// Prints &quot;Greetings!&quot;, &quot;Hello&quot;, &quot;Bye!&quot;, &quot;Ok, bye!&quot;for (let value of delegatingIterator) {  console.log(value);}</code></pre><h3 id="ç¨ä½æµç¨æ§å¶"><a href="#ç¨ä½æµç¨æ§å¶" class="headerlink" title="ç¨ä½æµç¨æ§å¶"></a>ç¨ä½æµç¨æ§å¶</h3><p>co å·²ç»å°æ­¤ç¹æ§å°è£çéå¸¸å®ç¾</p><p>Generator ä¹æä»¥å¯ä»¥ç¨æ¥æ§å¶ä»£ç æµç¨, å°±æ¯éè¿ yield æ¥å°ä¸¤ä¸ªæå¤ä¸ª Generator çæ§è¡è·¯å¾ç¸äºåæ¢, è¿ç§åæ¢æ¯è¯­å¥çº§å«ç, èä¸æ¯å½æ°çº§è°ç¨. å¶æ¬è´¨æ¯ CPS åæ¢.</p><p>è¿éè¡¥å yield çè¥å¹²è¡ä¸º:</p><ul><li>next æ¹æ³æ¥æ¶ä¸ä¸ªåæ°, ä¼ å¥çåæ°æ¯ yield è¡¨è¾¾å¼çè¿åå¼: å³ yield æ¢å¯ä»¥äº§çæ°å¼,  ä¹å¯ä»¥æ¥æ¶æ°å¼</li><li>throw æ¹æ³ä¼æåºä¸ä¸ªå¼å¸¸, å¹¶ç»æ­¢è¿­ä»£</li><li>GeneratorFunction ç return è¯­å¥ç¸å½äºä¸ä¸ª yield</li></ul><h4 id="å°å¼æ­¥âåä¸ºâåæ­¥"><a href="#å°å¼æ­¥âåä¸ºâåæ­¥" class="headerlink" title="å°å¼æ­¥âåä¸ºâåæ­¥"></a>å°å¼æ­¥âåä¸ºâåæ­¥</h4><p>åè®¾æä»¬å¸ææå¦ä¸è¯­æ³:</p><ul><li>suspend ä¼ å¥ä¸ä¸ª GeneratorFunction</li><li>suspend è¿åä¸ä¸ªç®åå½æ°, æ¥æ¶ä¸ä¸ª node é£æ ¼çåè°å½æ°</li><li>ææçå¼æ­¥è°ç¨é½éè¿ yield, çèµ·æ¥ååæ­¥è°ç¨</li><li>ç»å®ä¸ä¸ªç¹æ®çåè°, è®©ä¿è¯å¼æ­¥è°ç¨çè¿åå¼ä½ä¸º yield çè¿åå¼, å¹¶è®©èæ¬ç»§ç»­</li><li>GeneratorFunction çè¿åå¼åæ§è¡è¿ç¨çéè¯¯é½ä¼ä¼ å¥å¨å±çåè°å½æ°</li></ul>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javascript </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Generator 101</title>
      <link href="/2016/07/30/generator-101/"/>
      <content type="html"><![CDATA[<pre><code>function * HelloGen(){  yield 100;  yield 400;}var gen = HelloGen();console.log(gen.next()); // {value: 100, done: false}console.log(gen.next()); // {value: 400, done: false}console.log(gen.next()); // {value: undefined, done: true}`&lt;/pre&gt;&lt;pre&gt;`function * HelloGen2() {  var a = yield 100;  var b = yield a + 100;  console.log(b);}var gen2 = HelloGen2();console.log(gen2.next()); // {value: 100, done: false}console.log(gen2.nect(500)); // {value: 600, done: false}console.log(gen2.next(1000)); // {value: undefined, done: done}// prints 1000`&lt;/pre&gt;### Preventing Callback HellSo, how can generators be used to avoid callback hell? First, you need to understand a simple technique that we will be using heavily with generators to write code without callbacks.#### Understanding ThunksA thunk is a partially evaluated function which accepts a single callback as the argument. Within generators, we&apos;ll be yielding thunks to write without callbacks. A simple thunk is shown below.&lt;pre&gt;`function(callback) {  fs.readFile(&apos;myfile.md&apos;, &apos;utf8&apos;, callback)}`&lt;/pre&gt;Thunks can also be created dynamically as shown below:&lt;pre&gt;`function readFile(filename) {  return function(callback) {    fs.readFile(filename, &apos;utf8&apos;, callback);  };}`&lt;/pre&gt;#### Using `co``co` is a nice module which helps to use thunks and generators together to create Node.js applications without callbacks.A simple application which uses `co` and the `readFile()` thunk.&lt;pre&gt;`var co = require(&apos;co&apos;);co(function* (){  var file1 = yield readFile(&apos;file1.md&apos;);  var file2 = yield readFile(&apos;file2.md&apos;);  console.log(file1);  console.log(file2);})();`&lt;/pre&gt;As you can see, we are no longer using callbacks. This gives us a simple way to write large modular Node apps easily.###### How `co` Works Internally</code></pre><ol><li>First, it calls <code>next(null)</code> and gets a thunk.</li><li>Then, it evaluate the thunk and saves the result.</li><li>Then, it calls <code>next(savedResult)</code>(in this case, saveResult == readFile(âfile1.mdâ), and next(savedResult) pass the content to var file1)</li><li><p>Repeat these steps until <code>next()</code> return <code>{done: true}</code></p><p>A minimal version of <code>co</code> written to show how it works internally.</p><p><code>`</code><br>function co(generator){<br>  var gen = generator();</p><p>function nextItem(err, result) {</p><pre><code>var item = gen.next(result);</code></pre><p><pre>`if (!item.done) {<br>  item.value(nextItem); // item.value is a thunk, because yield a thunk<br>}</pre></p></li></ol><p>}</p><p>nextItem();<br>}</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javascript </tag>
            
            <tag> Thunk </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>__Proto__ä¸ Prototype</title>
      <link href="/2016/07/30/proto-e4-b8-8e-prototype/"/>
      <content type="html"><![CDATA[<p>ç®èè¨ä¹,</p><pre><code>x.__proto__ === x.constructor.prototype`&lt;/pre&gt;å¨ JS ä¸çé, ä¸ç©çå¯¹è±¡Function æ¯å¯¹è±¡, Function.prototype ä¹æ¯å¯¹è±¡, å æ­¤ä»ä»¬å·æå¯¹è±¡çå±æ§: **proto**å±æ§&lt;pre&gt;`Function.__proto__ === Function.prototype; // Function çæé å½æ°è¿æ¯ FunctionFunction.prototype.__proto__ === Object.prototye; Function.prototype çæé å½æ°æ¯ Object()`&lt;/pre&gt;è Object çæé å½æ°ä¹æ¯ Function, æä»¥&lt;pre&gt;`Object.__proto__ === Function.prototype</code></pre>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javascript </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>å½»åºçè§£ Thunk å½æ°</title>
      <link href="/2016/07/30/e5-bd-bb-e5-ba-95-e7-90-86-e8-a7-a3-thunk-e5-87-bd-e6-95-b0/"/>
      <content type="html"><![CDATA[<h3 id="çæå¨å½æ°"><a href="#çæå¨å½æ°" class="headerlink" title="çæå¨å½æ°"></a>çæå¨å½æ°</h3><p>çæå¨(Generator)å½æ°åæ:</p><pre><code>function* func () {}`&lt;/pre&gt;å¶æ¬è´¨ä¹æ¯ä¸ä¸ªå½æ°, æä»¥ä»å·å¤æ®éå½æ°æå·æçææç¹æ§, é¤æ­¤ä»¥å¤, ä»è¿å·æä»¥ä¸ç¹æ§</code></pre><ol><li>æ§è¡çæå¨å½æ°åè¿åä¸ä¸ªè¿­ä»£å¨(Iterator)</li><li>çæå¨å½æ°åé¨å¯ä»¥ä½¿ç¨ yield æ yield*, å½æ°æ§è¡å° yield çæ¶åä¼æåæ§è¡, å¹¶è¿å yield åé¢è¡¨è¾¾å¼çå¼, éè¿è¿­ä»£å¨ç next() æ¹æ³è¿åä¸ä¸ªå¯¹è±¡, è¯¥å¯¹è±¡ç± value å done å±æ§ç»æ, å¶ä¸­, value å±æ§å¼ä¸º yield åé¢è¡¨è¾¾å¼çå¼, done å±æ§è¡¨ç¤ºçæå¨çæ§è¡ç¶æ</li><li>è¿­ä»£å¨ next() æ¹æ³çåæ°æ¯yield è¡¨è¾¾å¼çå¼</li><li><p>å½ next æåæåä¸ä¸ª yield çæ¶å, åæ¬¡æ§è¡ next() æ¹æ³, è¿åçå¯¹è±¡ä¸­ done: true, è value çå¼ä¸º return åé¢çè¡¨è¾¾å¼(é»è®¤ä¸º undefined)</p><h4 id="ä¾ä¸"><a href="#ä¾ä¸" class="headerlink" title="ä¾ä¸"></a>ä¾ä¸</h4><pre>`function test() {  return 'b';}function* func() {  var a = yield 'a';  console.log('gen', a); // 'gen: undefined' - (å¦æ next æ¹æ³ä¸å¸¦åæ°, yield è¡¨è¾¾å¼è¿å undefined)  var b = yield test();  console.log('gen': b); // 'gen: undefined'}var func1 = func();var a = func1.next();console.log('next: ' a); // 'next: {value: 'a', done: false}'var b = func1.next();console.log('next: ' b); // 'next: {value: 'b', done: false}'var c = func1.next();console.log('next: ' c); // 'next: {value: undefined, done: true}'`</pre><h3 id="å³äº-yield"><a href="#å³äº-yield" class="headerlink" title="å³äº yield*"></a>å³äº yield*</h3><p>yield æåæ§è¡å¹¶è¿ååé¢è¡¨è¾¾å¼çå¼, è yield* åå°å½æ°å§æå°å¦ä¸ä¸ªè¿­ä»£å¨æå¯è¿­ä»£å¯¹è±¡</p><h4 id="arguments"><a href="#arguments" class="headerlink" title="arguments"></a>arguments</h4><pre>`&gt; function* genFunc(){... yield arguments;... yield* arguments;... }undefined&gt; var gen = genFunc(1,2);undefined&gt; gen.next(){ value: { '0': 1, '1': 2 }, done: false }&gt; gen.next(){ value: 1, done: false }&gt; gen.next(){ value: 2, done: false }&gt; gen.next(){ value: undefined, done: true }`</pre><h4 id="Generator"><a href="#Generator" class="headerlink" title="Generator"></a>Generator</h4><pre>`&gt; function * gen1(){... yield 2;... yield 3;... }undefined&gt; function * gen2(){... yield 1;... yield* gen1();... yield 4;... }undefined&gt; var g2 = gen2();undefined&gt; g2.next(){ value: 1, done: false }&gt; g2.next(){ value: 2, done: false }&gt; g2.next(){ value: 3, done: false }&gt; g2.next(){ value: 4, done: false }&gt; g2.next(){ value: undefined, done: true }`</pre><h3 id="Thunk-å½æ°"><a href="#Thunk-å½æ°" class="headerlink" title="Thunk å½æ°"></a>Thunk å½æ°</h3><p>å¨ co çåºç¨ä¸­, ä¸ºäºè½ååæ­¥ä»£ç é£æ ·ä¹¦åå¼æ­¥ä»£ç , æ¯è¾å¤çä½¿ç¨æ¹å¼æ¯ä½¿ç¨ thunk å½æ°(ä½ä¸æ¯å¯ä¸æ¹å¼, è¿å¯ä»¥æ¯ Promise), æ¯å¦è¯»åæä»¶åå®¹çå¼æ­¥å½æ° fs.readFile() æ¹æ³, è½¬åä¸º thunk å½æ°çæ¹å¼å¦ä¸</p><pre>`function readFile(path, encoding){  return function(cb){    fs.readFile(path, encoding, cb);  }}`</pre><p>Thunkå½æ°å·å¤ä»¥ä¸ä¸¤ä¸ªè¦ç´ <br>1. æä¸åªæä¸ä¸ªåæ°æ¯ callback çå½æ°<br>2. callback çç¬¬ä¸ä¸ªåæ°æ¯ error</p><p>ä½¿ç¨ thunk å½æ°, åæ¶ç»å co æä»¬å°±å¯ä»¥åä¹¦ååæ­¥ä»£ç ä¸æ ·ä¹¦åå¼æ­¥ä»£ç </p><pre>`var co = require('co');var fs = require('fs');var Promise = require('es6-promise').Promise;function readFile(path, encoding){  return function(cb) { // thunk function    fs.readFile(path, encoding, cd);  };}co(function* () { // å¤é¨ä¸å¯è§, ä½å¨ co åé¨å¶å®å·²ç»è½¬åæpromise.then().catch()...é¾å¼è°ç¨çè¡é©¶  var a = yield readFile('a.txt', {encoding: 'utf-8'});  console.log(a); // a  var b = yield readFile('b.txt', {encoding: 'utf-8'});  console.log(b); // b  return yield Promise.resolve(a+b);}).then(function(val){  console.log(val) // ab}).catch(function(error){  console.log(error);})`</pre><p>æä¸ä¸ªæ¡æ¶ thunkify å¯ä»¥å¸®æä»¬è½»æ¾å®ç°ä»¥ä¸æ­¥éª¤</p><pre>`var co = require('co');var thunkify = require('thunkify');var fs = requrie('fs');var Promise = require('es6-promise').Promise;var readFile = thunkify(fs.readFile);co(function* () { // å¤é¨ä¸å¯è§ï¼ ä½å¨ co åé¨å·²ç»è½¬åä¸º promise çé¾å¼è°ç¨  var a = yield readFile('a.txt', {encoding: 'utf-8'});  console.log(a); // a  var b = yield readFile('b.txt', {encoding: 'utf-8'});  console.log(b); // b  return yield Promise.resolve(a+b);}).then(function(val){  console.log(val); // ab}).catch(function(err){  console.log(err);})`</pre><p>å¯¹äº thunkify æ¡æ¶ççè§£æ³¨éå¦ä¸ï¼</p><p><pre>`/**</pre></p><ul><li>Module dependencies<br>*/<br>var assert = require(âassertâ);</li></ul><p>/**</p><ul><li>Expose <code>thunkify()</code>.<br>*/</li></ul><p>module.exports = thunkify;</p><p>function thunkify(fn) {<br>  assert(âfunctionâ == typeof fn, âfunction requiredâ);</p><p>  // è¿åä¸ä¸ªåå« thunk å½æ°çå½æ°, è¿åç thunk å½æ°ç¨äºæ§è¡yield, èå¤å±çè¿ä¸ªå½æ°ç¨äºç» thunk å½æ°ä¼ éå¶ä»åæ°<br>  return function() {</p><pre><code>var args = new Array(arguments.length);// ç¼å­ä¸ä¸æç¯å¢, ç» fn æä¾æ§è¡ç¯å¢var ctx = this;// å°åæ°ç±»æ°ç»å¯¹è±¡è½¬ä¸ºæ°ç»(å®ç°æ¹å¼ç¥èè¿, å¯ä»¥ç´æ¥ç¨Array.from)for (var i = 0; i &amp;lt; args.length; ++i){  args[i] = argumetns[i];}// çæ­£ç thunk å½æ°(æä¸åªæä¸ä¸ªåæ°, å¹¶ä¸åæ°æ¯ç¬¬ä¸ä¸ªåæ°ä¸º err ç callback)return function(done) { // è¿å thunk å½æ°  var called;  // å°åè°å½æ°ååè£¹ä¸å±, é¿åéå¤è°ç¨, åæ¶, å°åè£¹äºççæ­£çåè°å½æ° push è¿åæ°æ°ç»(å³å°åè°å½æ° done ä½ä¸ºæåä¸ä¸ªåæ°ä¼ éç» fn)  args.push(function(){  // å°åè°å½æ° done å å°åæ°åè¡¨å°¾é¨, å½¢æ fn éè¦ç [arg1, ..., done]    if (called) return;    called = true;    done.apply(null, arguments); // æ§è¡åè°å½æ°  });  try {    // å¨ ctx ç¯å¢æ§è¡ fn    // å¹¶å°æ§è¡ thunkify ä¹åè¿åçå½æ°çåæ°(å« done åè°) ä¼ å¥, ç±»ä¼¼äºæ§è¡:    // fs.readFile(path, {encoding: &apos;utf-8&apos;}, done)    fn.apply(ctx,args); // ç±»ä¼¼ fn(arg1, .., done)  } catch(err) {    done(err);  }}</code></pre><p>  }<br>}</p></li></ol>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javascript </tag>
            
            <tag> ES6 </tag>
            
            <tag> Thunk </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>CSS å¨ç»ä¹ç¡¬ä»¶å é</title>
      <link href="/2016/07/27/css-e5-8a-a8-e7-94-bb-e4-b9-8b-e7-a1-ac-e4-bb-b6-e5-8a-a0-e9-80-9f/"/>
      <content type="html"><![CDATA[<h3 id="è§¦åç¡¬ä»¶å éç-CSS-å±æ§"><a href="#è§¦åç¡¬ä»¶å éç-CSS-å±æ§" class="headerlink" title="è§¦åç¡¬ä»¶å éç CSS å±æ§"></a>è§¦åç¡¬ä»¶å éç CSS å±æ§</h3><ul><li>transform</li><li>opacity</li><li>filter</li></ul><h3 id="ç¡¬ä»¶å éçå·¥ä½åç"><a href="#ç¡¬ä»¶å éçå·¥ä½åç" class="headerlink" title="ç¡¬ä»¶å éçå·¥ä½åç"></a>ç¡¬ä»¶å éçå·¥ä½åç</h3><p>æµè§å¨è§£æå¾å° DOM æ å, ä¸ CSS å½¢ææ¸²ææ , æ¸²ææ ä¸æå¤§éçæ¸²æåç´ , æ¯ä¸ä¸ªæ¸²æåç´ é½è¢«åå°ä¸ä¸ªå¾å±ä¸­, æ¯ä¸ªå¾å±è¢«å è½½å° GPU å½¢ææ¸²ææç.</p><p>ç¶è, transform ç­ CSS å±æ§ä¸ä¼è§¦å GPU ç repaint, è¿äºä½¿ç¨ transform å±æ§çå¾å±é½ä¼æç¬ç«åæå¨è¿è¡å¤ç.</p><p>æ¯å¦æä¸ªåç´ å·æ transform å±æ§, é£ä¹ä¼ä¸ºä»åå»ºä¸ä¸ªæ°çå¤åå¾å±, å¯ä»¥è¢« GPU ç´æ¥ç¨æ¥æ§è¡ transform æä½.</p><p>ä¸è¬æµè§å¨ä¼å¨ä»¥ä¸å ç§æåµä¸åå»ºä¸ä¸ªç¬ç«çå¤åå¾å±: </p><ul><li>3D æ transform</li><li><code>&amp;lt;video</code> å<code>&amp;lt;canvas&amp;gt;</code>æ ç­¾</li><li>CSS Filters</li><li>åç´ è¦çæ¶(æ¯å¦ z-index)</li></ul><p>3D å 2D çtransform åºå«å¨äº, æµè§å¨å¨é¡µé¢æ¸²æåä¸º 3D å¨ç»åå»ºç¬ç«çå¤åå¾å±, èå¨<strong>è¿è¡æé´</strong>ä¸º 2D å¨ç»åå»ºç¬ç«å¤åå¾å±. 2D transform å¨å¨ç»å¼å§åç»æçæ¶åä¾æ§åºç°äºåå§ååå é¤ç repaint.</p><h3 id="å¼ºå¶ä½¿ç¨-GPU-æ¸²æ"><a href="#å¼ºå¶ä½¿ç¨-GPU-æ¸²æ" class="headerlink" title="å¼ºå¶ä½¿ç¨ GPU æ¸²æ"></a>å¼ºå¶ä½¿ç¨ GPU æ¸²æ</h3><p>ä¸ºäºé¿å 2D transform å¨ç»çä¸¤æ¬¡ repaint, æä»¬å¯ä»¥ç¡¬ç¼ç ä¸äºæ ·å¼æ¥è§£å³è¿ä¸ªé®é¢</p><pre><code>.solution1{  transform: translateZ(0);}.solution2{  transform: rotateZ(360deg)}</code></pre><p>è¿æ®µä»£ç è®©æµè§å¨æ§è¡3Dtransform, è¿èåå»ºä¸ä¸ªç¬ç«çå¤åæ¶å±</p><h3 id="ç¡¬ä»¶å éç¼ºç¹"><a href="#ç¡¬ä»¶å éç¼ºç¹" class="headerlink" title="ç¡¬ä»¶å éç¼ºç¹"></a>ç¡¬ä»¶å éç¼ºç¹</h3><ol><li>åå­, å¦æ GPU å è½½äºå¤§éæç, å®¹æåçåå­é®é¢</li><li>ä½¿ç¨ GUP æ¸²æä¼å½±åå­ä½çæé¯é½¿ææ, å ä¸º GPU å CPU æ¸²ææºå¶ä¸å. å³ä½¿æç»ç¡¬ä»¶å éåæ­¢äº, ææ¬è¿æ¯ä¼å¨å¨ç»æé´æ¾å¾æ¨¡ç³.</li></ol>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS3 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>çæå¨ Function*</title>
      <link href="/2016/07/26/e7-94-9f-e6-88-90-e5-99-a8-function/"/>
      <content type="html"><![CDATA[<p>function* å£°æå®ä¹ä¸ä¸ª generator( çæå¨), è¿åä¸ä¸ª Generator å¯¹è±¡</p><p>è¯­æ³</p><pre><code>function* name([param[, param[, ...param]]]){ statements }`&lt;/pre&gt;### æè¿°Generator æ¯ä¸ç§å¯ä»¥ä»ä¸­éåºå¹¶å¨ä¹åéæ°è¿å¥çå½æ°, å¶ç¯å¢(ç»å®çåé)ä¼å¨æ¯æ¬¡æ§è¡åè¢«ä¿å­, ä¸æ¬¡è¿å¥æ¶å¯ä»¥ç»§ç»­ä½¿ç¨è°ç¨ä¸ä¸ª Generator å¹¶ä¸é©¬ä¸æ§è¡å®çä¸»ä½, èæ¯è¿åä¸ä¸ª è¿­ä»£å¨å¯¹è±¡, è¿ä¸ªè¿­ä»£å¨ç next() æ¹æ³è¢«è°ç¨çæ¶å, Generator çä¸»ä½ä¼è¢«æ§è¡è³ä¸ä¸ä¸ª yield è¡¨è¾¾å¼, è¯¥è¡¨è¾¾å¼å®ä¹äºè¿­ä»£å¨çè¿åå¼### ç¤ºä¾&lt;pre&gt;`function* idMaker(){  var index = 0;  while(index &amp;lt; 3){    yield index++;  }}var gen = idMaker(); //è¿åä¸ä¸ªè¿­ä»£å¨å¯¹è±¡console.log(gen().next().value); // 0console.log(gen().next().value); // 1console.log(gen().next().value); // 2console.log(gen().next().value); // undefined</code></pre><p>è°¨æä½¿ç¨, å ä¸ºå¶åé¨åéä¿æåå, è¦æ¯æ¬¡è¾åºçç¸äºå½±å</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javascript </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Webpack æ</title>
      <link href="/2016/07/25/webpack-e6-9d-82/"/>
      <content type="html"><![CDATA[<h3 id="loaders"><a href="#loaders" class="headerlink" title="loaders"></a>loaders</h3><p>å¨ React éä¼ç¨å° JSX, ES6, js, ç»ä¸ä½¿ç¨ .js ä½ä¸ºåç¼, ä¾¿äº babel éç½®</p><pre><code>npm install --save babel-loader//{  test: /\.js?$/,  exclude: /node_modules/,  loader: &apos;babel&apos;,  query:{    presets: [&apos;es2015&apos;, &apos;react&apos;]  }}`&lt;/pre&gt;CSS, SCSS, ICONFONT å­ä½æä»¶&lt;pre&gt;`npm install --save style-loader css-loader sass-loader node-sass url-loader, file-loader//{  test: /\.scss$/,  loader: &apos;style!css!sass&apos;},{  test: /\.(png|jpg)$/,  loader: &apos;url?limit-8192&apos;}</code></pre><h3 id="plugins"><a href="#plugins" class="headerlink" title="plugins"></a>plugins</h3><h4 id="html-webpack-plugin-ä¼ç±-entry-å¾éç½®å°å¥å£æä»¶æå±ç-html-æä»¶ä½ä¸ºæ¨¡æ¿-éæ°çæä¸ä¸ª-html-æä»¶-å¶ä¸­çéæèµæºé½å·²ç»æ ¹æ®éç½®æåå¥½"><a href="#html-webpack-plugin-ä¼ç±-entry-å¾éç½®å°å¥å£æä»¶æå±ç-html-æä»¶ä½ä¸ºæ¨¡æ¿-éæ°çæä¸ä¸ª-html-æä»¶-å¶ä¸­çéæèµæºé½å·²ç»æ ¹æ®éç½®æåå¥½" class="headerlink" title="html-webpack-plugin ä¼ç± entry å¾éç½®å°å¥å£æä»¶æå±ç html æä»¶ä½ä¸ºæ¨¡æ¿, éæ°çæä¸ä¸ª html æä»¶, å¶ä¸­çéæèµæºé½å·²ç»æ ¹æ®éç½®æåå¥½"></a>html-webpack-plugin ä¼ç± entry å¾éç½®å°å¥å£æä»¶æå±ç html æä»¶ä½ä¸ºæ¨¡æ¿, éæ°çæä¸ä¸ª html æä»¶, å¶ä¸­çéæèµæºé½å·²ç»æ ¹æ®éç½®æåå¥½</h4><p>ä½¿ç¨ webpack å, å¯¹æä»¶ççæ¬ hash ä¼åå¾éå¸¸ç®å, å¨åºå£æä»¶ filename ä¸­æ·»å [hash]å³å¯; å°±ç®åèè¨, æ¸æ¥èµæºç¼å­çæå¥½æ¹æ³æ¯æä»¶å hash, ç±äºæ¯æ¬¡æ¹å¨åçæçæä»¶åé½ä¸ä¸æ ·, ä¸çº¿å¹¶ä¸ä¼è¦çä¹åççæ¬, åªæ¯å¤äºä¸ä¸ªçæ¬çæä»¶, é¡µé¢å³ä½¿åæ­¥ææ¶é´å·®, è¦ä¹è®¿é®æ§çé¡µé¢, è¦ä¹è®¿é®æ°çé¡µé¢, ä¸ä¼å­å¨å²çª. è¿æ ·æå¡å¨å°±å¯ä»¥æ¾å¿çå¯¹éæèµæºå¼å¯æ°¸ä¹å¼ºç¼å­, å¹¶ä¸æå©äºåæ», è³äºéæèµæºäº§ççç§¯å, å¯ä»¥äº¤ç±è¿ç»´å¤ç.</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>JavaScript æé«æ§è½</title>
      <link href="/2016/07/25/javascript-e6-8f-90-e9-ab-98-e6-80-a7-e8-83-bd/"/>
      <content type="html"><![CDATA[<h3 id="éå¯¹-js-æä»¶çå è½½ä½ç½®"><a href="#éå¯¹-js-æä»¶çå è½½ä½ç½®" class="headerlink" title="éå¯¹ js æä»¶çå è½½ä½ç½®"></a>éå¯¹ js æä»¶çå è½½ä½ç½®</h3><p>å¨ HTML æä»¶ä¸­, &lt;script&gt;æ ç­¾æ¯å¯ä»¥å è½½&lt;head&gt;æ&lt;body&gt;åºåç, ç±äº JavaScript æ§è¡å UI æ¸²æçæ¯åçº¿ç¨ç, å¦æå è½½ä¸é¡ºçå¯è½å¯¼è´å µå¡, é æé¡µé¢ç©ºç½æå¡é¡¿.<br>1. å¦æ js æä»¶æ²¡æç¹æ®è¦æ±è´å½éè¦å¨é¡µé¢æ¸²æä¹åå è½½, é£ä¹åºå½å° &lt;script&gt;æ¾å¨&lt;/body&gt;ä¹å<br>2. å¦æè¿äº js æä»¶ææç¡®éæ±åäº body æ§è¡, é£ä¹å°±å¨ç¬¬ä¸ä¸ª js æèé¡µé¢ä¸åæ¾ä¸ä¸ªè½½å¥å¨ç»</p><h3 id="éå¯¹-js-æä»¶çåå¹¶"><a href="#éå¯¹-js-æä»¶çåå¹¶" class="headerlink" title="éå¯¹ js æä»¶çåå¹¶"></a>éå¯¹ js æä»¶çåå¹¶</h3><h3 id="æ´å¿«éçæ°æ®è®¿é®"><a href="#æ´å¿«éçæ°æ®è®¿é®" class="headerlink" title="æ´å¿«éçæ°æ®è®¿é®"></a>æ´å¿«éçæ°æ®è®¿é®</h3><p>å¯¹äºæµè§å¨èè¨, ä¸ä¸ªæ è¯ç¬¦æå¤çä½ç½®çº¦æ·±, å»è¯»åä»çéåº¦ä¹è¶æ¢.</p><p>å¦ææä»¬éè¦å¨å½åå½æ°åå¤æ¬¡ç¨å°æä¸ä¸ªå¼, åºå½ç¨ä¸ä¸ªå±é¨åéå°å¶ä¿å­</p><h3 id="DOM-æä½çä¼å"><a href="#DOM-æä½çä¼å" class="headerlink" title="DOM æä½çä¼å"></a>DOM æä½çä¼å</h3><p>DOM æä½è¿æ¯ JavaScript çæ§è¡æ´èæ§è½, åºå½å°½éåå°è¯¥æä½å¯¹æ§è½çæ¶è.</p><pre><code>function innerLi_s(){  var i = 0;  for(;i&amp;lt;20;i++){    document.getElementById(&apos;Num&apos;).innerHTML += &apos;A&apos;; //è¿è¡20æ­¤å¾ªç¯, æ¯æ¬¡å¾ªç¯é½è¿è¡2æ¬¡DOM åç´ çè®¿é®, ä¸æ¬¡è¯»å innerHTML, ä¸æ¬¡åå¥ innerHTML  }}// æ¹åä¸ºfunction innerLi_s(){  var content = &apos;&apos;;  var i = 0;  for(;i&amp;lt;20;i++){    content += &apos;A&apos; //è¿éåªå¯¹ js çåéå¾ªç¯20æ¬¡  };  document.getElementById(&apos;Num&apos;).innerHTML += content; //è¿éåªè¿è¡2æ¬¡ DOM æä½}</code></pre><h3 id="åå°-DOM-çéç»éæç"><a href="#åå°-DOM-çéç»éæç" class="headerlink" title="åå° DOM çéç»éæç"></a>åå° DOM çéç»éæç</h3><p>åç´ çå¸å±çæ¹åæåå®¹çå¢å æ¹ææµè§å¨å°ºå¯¸çååé½ä¼å¯¼è´éæ, èå­ä½é¢è²æèæ¯è²çä¿®æ¹ä¼å¯¼è´éç».</p><p>åå¹¶åä¸å¯¹è±¡çæä½, æ¯å¦ background çåä¸ªå±æ§çä¿®æ¹å¯ä»¥åå¹¶ä¸ºä¸ä¸ª</p><h3 id="å¾ªç¯çä¼å"><a href="#å¾ªç¯çä¼å" class="headerlink" title="å¾ªç¯çä¼å"></a>å¾ªç¯çä¼å</h3><p>ä¿å­ arr.length, é¿åå¤æ¬¡è®¿é®</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javascript </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>CommonJS è§è</title>
      <link href="/2016/07/25/commonjs-e8-a7-84-e8-8c-83/"/>
      <content type="html"><![CDATA[<p>æ¦è¿°<br>CommonJS æ¯æå¡å¨ç«¯æ¨¡åçè§è, Node.js éç¨äºè¿ä¸ªè§è</p><p>æ ¹æ® CommonJS è§è, ä¸ä¸ªåç¬çæä»¶å°±æ¯ä¸ä¸ªæ¨¡å</p><p>å è½½æ¨¡åä½¿ç¨ require æ¹æ³, è¯¥æ¹æ³è¯»åä¸ä¸ªæä»¶å¹¶æ§è¡, æåè¿åæä»¶åé¨ç exports å¯¹è±¡.</p><pre><code>// example.jsconsole.log(&apos;evaluating example.js&apos;);var invisible = function(){  console.log(&apos;invisible&apos;);}exports.message = &apos;h1&apos;;exports.say = function(){  console.log(message)}`&lt;/pre&gt;ä½¿ç¨ require æ¹æ³, å è½½ example.js æ¨¡å&lt;pre&gt;`var example = require(&apos;./example.js&apos;);`&lt;/pre&gt;è¿æ¶åé example å°±å¯¹åºæ¨¡åä¸­ exports å¯¹è±¡, å¯ä»¥éè¿è¿ä¸ªå¯¹è±¡åºç¨æ¨¡åä¸­æä¾çåç§æ¹æ³.&lt;pre&gt;`{  message: &apos;h1&apos;,  say: [Function]}`&lt;/pre&gt;require æ¹æ³é»è®¤è¯»å js æä»¶, æä»¥å¯ä»¥çç¥ .js æ©å±å&lt;pre&gt;`var example = require(&apos;./example&apos;)`&lt;/pre&gt;js æä»¶ååéè¦å ä¸è·¯å¾, å¯ä»¥æ¯ç¸å¯¹è·¯å¾, ä¹å¯ä»¥æ¯ç»å¯¹è·¯å¾. å¦æçç¥è·¯å¾, node.js ä¼è®¤ä¸ºæ·»å ä¸ä¸ªæ ¸å¿æ¨¡å, æèå·²ç»å®è£å¨æ¬å° node_modules ç®å½ä¸­çæ¨¡å. å¦æå è½½çæ¯ä¸ä¸ªç®å½, node.js ä¼é¦åå¯»æ¾è¯¥ç®å½ä¸­ç package.json æä»¶, å è½½è¯¥æä»¶ main å±æ§æå®çæ¨¡å, å¦åå°±å¯»æ¾è¯¥ç®å½ä¸ç index.js æä»¶å®ä¹ä¸ä¸ªæç®åçæ¨¡å&lt;pre&gt;`exports.add = function(a,b){return a+b};`&lt;/pre&gt;//add.jsä¸º exports å¯¹è±¡æ·»å ä¸ä¸ª add æ¹æ³,&lt;pre&gt;`var addition = require(&apos;./add&apos;);addition.add(1,2); //3`&lt;/pre&gt;ç¨å¤æçä¾å­&lt;pre&gt;`//foobar.jsfunction foobar(){  this.foo = function(){    console.log(&apos;hello foo&apos;)  };  this.bar = function(){    console.log(&apos;hello bar&apos;)  };}exports.foobar = foobar;`&lt;/pre&gt;è°ç¨&lt;pre&gt;`var foobar = require(&apos;./foobar&apos;).foobar, test = new foobar();test.bar(); //&apos;hello bar&apos;`&lt;/pre&gt;ææ¶ä¸éè¦ exports è¿åä¸ä¸ªå¯¹è±¡, èä»éè¦è¿åä¸ä¸ªå½æ°, å°±åæ module.exports&lt;pre&gt;`module.exports = function(){  console.log(&apos;hello world&apos;)}`&lt;/pre&gt;### AMD è§èä¸ CommonJS è§èçå¼å®¹æ§CommonJS è§èå è½½æ¨¡åæ¯åæ­¥ç, ä¹å°±æ¯è¯´, åªæå è½½å®æ, æè½æ§è¡åé¢çæä½. AMD è§èåæ¯éåæ­¥å è½½æ¨¡å, åè®¸æå®åè°å½æ°. ç±äº Node.js ä¸»è¦ç¨äºæå¡å¨ç¼ç¨, æ¨¡åæä»¶ä¸è¬é½å·²ç»å­å¨äºæ¬å°ç¡¬ç, æä»¥å è½½èµ·æ¥æ¯è¾å¿«, ä¸éè¦èèéåæ­¥å è½½çæ¹å¼, æä»¥ CommonJS çè§èæ¯è¾éç¨. ä½æ¯, å¦ææ¯æµè§å¨ç¯å¢, è¦ä»æå¡å¨ç«¯å è½½æ¨¡å, è¿æ¶å°±å¿é¡»éç¨éåæ­¥æ¨¡å¼, å æ­¤æµè§å¨ç«¯ä¸è¬éç¨ AMD è§è.AMD è§èéç¨ define æ¹æ³å®ä¹æ¨¡å&lt;pre&gt;`define([&apos;package/lib&apos;, function(lib){  function foo(){    lib.log(&apos;hello world!&apos;);  }  return {    foo:foo  };}])`&lt;/pre&gt;AMD è§èåè®¸è¾åºçæ¨¡åå¼å®¹ CommonJS è§è,å¨è¿æ¶ define æ¹æ³éè¦åæå¦ä¸æ ¼å¼&lt;pre&gt;`define(function(require, exports, module)  var someModule = require(&apos;someModule&apos;);  var anotherModule = require(&apos;anotherModule&apos;);  someModule.doTheAwesoem();  anotherModule.doMoreAwesome();  exports.asplode = function(){    someModule.doTheAwesoem();    anotherModule.doMoreAwesome();  };);</code></pre>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javascript </tag>
            
            <tag> CommonJS </tag>
            
            <tag> Node.js </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Webpack å¼ååé¨ç½²</title>
      <link href="/2016/07/22/webpack-e5-bc-80-e5-8f-91-e5-92-8c-e9-83-a8-e7-bd-b2/"/>
      <content type="html"><![CDATA[<p>Thanks to <a href="https://github.com/vikingmute/webpack-for-fools/blob/master/entries/chapter-2.md" target="_blank" rel="noopener">Webpack å»çæå</a></p><h3 id="å¯ç¨-Source-Map"><a href="#å¯ç¨-Source-Map" class="headerlink" title="å¯ç¨ Source Map"></a>å¯ç¨ Source Map</h3><p>å¨ webpack.config.js ä¸­æ·»å å­æ®µ</p><pre><code>devtool: &apos;eval-source-map&apos;,`&lt;/pre&gt;è¿æ ·åºéåä¼éç¨ sourceMap ç´æ¥æ¾ç¤ºåºéä½ç½®### éç½® webpack-dev-serverå¨ webpack.config.js ä¸­æ·»å å­æ®µ&lt;pre&gt;`devServer: {  historyApiFallback: true,  hot: true,  inline: true,  progress: true,}`&lt;/pre&gt;### ä½¿ç¨ preLoaders å postLoaderspreLoaders å¨ loaders ä¹åæ§è¡, æ»ä½é¡ºåºæ¯ preLoader -&gt; loaders -&gt; postLoaders#### å®è£ jshint&lt;pre&gt;`npm install --save-dev jshint-loader`&lt;/pre&gt;å¨ config ä¸­éç½®&lt;pre&gt;`module:{  preloaders:[    {      test: /\.jsx$/,      loader:&apos;jshint-loader&apos;    }  ]}jshint:{  &apos;esnext&apos;:true}`&lt;/pre&gt;### é¨ç½²ä¸çº¿é¡¹ç®å¼åå®æåéè¦é¨ç½²ä¸çº¿, æ­¤æ¶åºè¯¥åå»ºä¸ä¸ªæ°ç config, å ä¸ºé¨ç½²ä¸çº¿ä½¿ç¨ç webpack ä¸éè¦ dev-tools, dev-server, jshint ç­å¤å¶ç°æç config æä»¶, å½åä¸º webpack.production.config.js, å°éé¢ä¸å¼åæå³çä¸è¥¿å é¤, å¨ package.json ä¸­æ·»å &lt;pre&gt;`&quot;scripts&quot;:{  &quot;build&quot;: &quot;webpack --progress --profile  --colors --config webpack.production.config.js&quot;},`&lt;/pre&gt;ä¸çº¿çæ¶åè¿è¡&lt;pre&gt;`npm run build`&lt;/pre&gt;### åç¦»ç¬¬ä¸æ¹åºå¦æç¬¬ä¸æ¹åºå¾å¤, ä¼å¯¼è´æå bundle æä»¶å¾å¤§, åæ¢å è½½éåº¦, å æ­¤éè¦æç¬¬ä¸æ¹åºå app æ¬èº«çä»£ç åå¼#### ä¿®æ¹ entry å¥å£æä»¶&lt;pre&gt;`entry:{  app: path.resolve(APP_PATH, &apos;index.js&apos;),  //æ·»å è¦æåå¨ vendors éé¢çåº  vendors: [&apos;jquery&apos;, [moment]]},`&lt;/pre&gt;#### æ·»å  CommonsChunkPlugin&lt;pre&gt;`plugins: [  //ä½¿ç¨ uglifyJs åç¼© js ä»£ç   new webpack.optimize.UglifyJsPlugin({minimize: true}),  //æå¥å£æä»¶éçæ°ç»æåæ vendors.js  new webpack.optimize.CommonsChunkPlugin(&apos;vendors&apos;,&apos;vendors.js&apos;),  new HtmlWebpackPlugin({title: &apos;Welcome&apos;})]`&lt;/pre&gt;è¿è¡ build åä¼çæ vendor.js### çæå¤é¡µé¢åè®¾éæ±æ¯çæä¸¤ä¸ªé¡µé¢, ä¸ä¸ªå« index.html, éè¦å¼ç¨ app.js å vendors.js ä¸¤ä¸ªæä»¶; å¦ä¸ä¸ªæ¯ mobile.html, éè¦åºç¨ mobie.js å vendor.js è¿ä¸¤ä¸ªæä»¶é¦åæ°å»ºä¸ä¸ªå« mobile.js çæä»¶å¥å£, æ¯ app.js ç®åä¸äº&lt;pre&gt;`import &apos;./main.scss&apos;;import $ from &apos;jquery&apos;;import &apos;imports?jQuery=jQuery!./plugin.js&apos;;$(document).ready(function(){  let app = document.createElement(&apos;div&apos;);  app.innerHTML = &apos;&amp;lt;h1&amp;gt;Hello World&amp;lt;/h1&amp;gt;&apos;;  document.body.appendChild(app);  $(&apos;h1&apos;).greenify();});`&lt;/pre&gt;å¨ config ä¿®æ¹å¥å£æä»¶åè¾åºéç½®&lt;pre&gt;`entry:{  // ä¸ä¸ªå¥å£æä»¶: app, mobile, vendors  app: path.resolve(APP_PATH, &apos;index.js&apos;),  mobile: path.resolve(APP_PATH, &apos;mobile.js&apos;),  vendors: [&apos;jquery&apos;,&apos;moment&apos;]},output:{   path: DIST_PATH,   filename: &apos;[name].js&apos;},`&lt;/pre&gt;ä¸º html-webpack-plugin è®¾ç½®æ¨¡æ¿, å¹¶ä¿å­äº templates&lt;pre&gt;`// index.html&amp;lt;!DOCTYPE html&amp;gt;&amp;lt;html&amp;gt;  &amp;lt;head&amp;gt;    &amp;lt;title&amp;gt;{%= o.htmlWebpackPlugin.options.title %}&amp;lt;/title&amp;gt;  &amp;lt;/head&amp;gt;  &amp;lt;body&amp;gt;    &amp;lt;h3&amp;gt;Welcome to Index&amp;lt;/h3&amp;gt;  &amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;//mobile.html&amp;lt;!DOCTYPE html&amp;gt;&amp;lt;html&amp;gt;  &amp;lt;head&amp;gt;    &amp;lt;title&amp;gt;{%= o.HtmlWebpackPlugin.options.title %}&amp;lt;/title&amp;gt;  &amp;lt;/head&amp;gt;  &amp;lt;body&amp;gt;    &amp;lt;h3&amp;gt;Welcome to Mobile&amp;lt;/h3&amp;gt;  &amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;`&lt;/pre&gt;ç»§ç»­éç½® config.js, è®© HtmlWebpackPlugin å¯ä»¥çæå¤ä¸ªæä»¶&lt;pre&gt;`//Templates çæä»¶å¤¹è·¯å¾var TEM_PATH = path.resolve(ROOT_PATE, &apos;templates&apos;);...plugins:[  //åå»ºä¸¤ä¸ª HtmlWebpackPlugin çå®ä¾, çæä¸¤ä¸ªé¡µé¢  new HtmlWebpackPlugin({    title: &apos;Hello World App&apos;,    template: path.resolve(TEM_PATH, &apos;index.html&apos;),    filename: &apos;index.html&apos;    //chunks è¿ä¸ªåæ°åè¯æä»¶è¦å¼ç¨ chunks ä¸­çé£å ä¸ªå¥å£    chunks: [&apos;app&apos;,&apos;vendors&apos;],    //scripts è¦æå¥çä½ç½®    inject: &apos;body&apos;  }),  new HtmlWebpackPlugin({    title: &apos;Hello Mobile App&apos;,    template: path.resolve(TEM_PATH, &apos;mobile.html&apos;),    filename: &apos;mobile.html&apos;,    chunks: [&apos;mobile&apos;,&apos;vendors&apos;],    inject: &apos;body&apos;  })]</code></pre><h3 id="çæ-hash-åç§°ç-script-æ¥é²æ­¢ç¼å­"><a href="#çæ-hash-åç§°ç-script-æ¥é²æ­¢ç¼å­" class="headerlink" title="çæ hash åç§°ç script æ¥é²æ­¢ç¼å­"></a>çæ hash åç§°ç script æ¥é²æ­¢ç¼å­</h3><p>webpack åºäº md5 å¯ä»¥çæ hash åç§°<br><code>`</code><br>output:{<br>  path: DIST_Path,<br>  filename: â[name].[hash].jsâ<br>},</p>]]></content>
      
      <categories>
          
          <category> workNote </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Webpackç®ææå</title>
      <link href="/2016/07/21/webpack-e7-ae-80-e6-98-8e-e6-8c-87-e5-8d-97/"/>
      <content type="html"><![CDATA[<p>Thanks to <a href="https://github.com/vikingmute/webpack-for-fools/blob/master/entries/chapter-1.md" target="_blank" rel="noopener">Webpack å»çå¼æå</a></p><h3 id="å®è£"><a href="#å®è£" class="headerlink" title="å®è£"></a>å®è£</h3><pre><code>npm install -g webpack`&lt;/pre&gt;### å»ºç«é¡¹ç®&lt;pre&gt;`mkdir webpackcd webpacknpm inittouch .gitignore`&lt;/pre&gt;#### é¡¹ç®ç»æ&lt;pre&gt;`project||---app|    ||    |---index.js|    |---sub.js||---package.json||---webpack.config.js`&lt;/pre&gt;&lt;pre&gt;`//sub.jsfunction generateText(){  var element = document.createElement(&apos;h2&apos;);  element.innerHTML = &quot;Hello, I&apos;m h2&quot;;  return element;}module.exports = generateText;`&lt;/pre&gt;&lt;pre&gt;`//index.jsvar sub = require(&apos;./sub&apos;);var app = document.createElement(&apos;div&apos;);app.innerHTML = &quot;&amp;lt;h1&amp;gt;Hello, I&apos;m h1&quot;;app.appendChild(sub())`&lt;/pre&gt;### éç½® Webpackç®çæ¯å°ä¸¤ä¸ª js æ ¹æ®ä¾èµå³ç³»åå¹¶, ç¶åå¨ dist ç®å½åå»ºä¸ä¸ª index.html å¹¶å¼ç¨åå¹¶åç js.è¿éå®è£ä¸ä¸ª plugin, å¯ä»¥å¿«éçæ HTML&lt;pre&gt;`npm install --save-dev html-webpack-plugin`&lt;/pre&gt;ä¿®æ¹ webpack.config.js&lt;pre&gt;`var path = require(&apos;path&apos;);var HtmlWebpackPlugin = require(&apos;html-webpack-plugin&apos;);//å®ä¹æä»¶å¤¹è·¯å¾var ROOT_PATH = path.resolve(__dirname);var APP_PATH = path.resolve(ROOT_PATH, &apos;app&apos;);var DIST_PATH = path.resolve(ROOT_PATH, &apos;dist&apos;);module.exports = {  //é¡¹ç®æä»¶å¤¹, å¯ä»¥ç´æ¥ç¨æä»¶å¤¹å, é»è®¤å¯»æ¾ index.js  entry: APP_PATH,  output: {    path: DIST_PATH,    filename: &apos;bundle.js&apos;  },  //æ·»å æä»¶, èªå¨çæ html  plugins: [    new HtmlWebpackPlugin({title: &apos;Hello World App&apos;})  ]};`&lt;/pre&gt;ç¶åå¨é¡¹ç®ç®å½è¿è¡&lt;pre&gt;`webpack`&lt;/pre&gt;å¯ä»¥çå° html å·²ç»å¼ç¨äº bundle.js### éç½® webpack-dev-serverç¨äºèªå¨å·æ°æµè§å¨å®è£webpack-dev-server&lt;pre&gt;`npm install -g webpack-dev-server`&lt;/pre&gt;ä¿®æ¹ webpack.config.js&lt;pre&gt;`module.exports = {  ...  devServer: {    historyApiFallback: true,    hot: true,        inline: true,    progress: true,  },  ...}`&lt;/pre&gt;ä¿®æ¹ package.json&lt;pre&gt;`...&quot;scripts&quot;: {  &quot;start&quot;: &quot;webpack-dev-server --hot --inline&quot;},...`&lt;/pre&gt;å¨é¡¹ç®ç®å½æ§è¡&lt;pre&gt;`npm start`&lt;/pre&gt;ç»å½ http://localhost:8080### æ·»å  CSS æ ·å¼css-loader ä¼éå css æä»¶, style-loader ä¼ææ ·å¼æå¥å°&amp;lt;style&amp;gt;&lt;pre&gt;`npm install -save-dev css-loader style-laoder`&lt;/pre&gt;ä¿®æ¹ webpack.config.js&lt;pre&gt;`...module:{  loaders: [    {      test: /\.css$/,      loaders: [&apos;style&apos;,&apos;css&apos;],      include: APP_PATH    }  ]}...`&lt;/pre&gt;æ³¨æ loaders çä¹¦åæ¹å¼, ä»å³åå·¦æ§è¡æ·»å æ ·å¼æä»¶ app/main.css&lt;pre&gt;`h1 {  color: red;}`&lt;/pre&gt;å¨å¥å£æä»¶&quot;index.js&quot; ä¸­å¼ç¨&lt;pre&gt;`require(&apos;./main.css&apos;)`&lt;/pre&gt;### ä½¿ç¨ sassè¿ééè¦ sass-loader å node-sass ä¸èµ·è§£ææä»¶&lt;pre&gt;`npm install --save-dev sass-loader node-sass`&lt;/pre&gt;ä¿®æ¹ webpack.config.js&lt;pre&gt;`//åå é¤ css è§å{  test: /\.scss$/,  loaders: [&apos;style&apos;,&apos;css&apos;,&apos;sass&apos;],  include: APP_PATH},`&lt;/pre&gt;æ·»å ä¸¤ä¸ª sass æä»¶ app/variables.scss å app/main.scss&lt;pre&gt;`//variables.scss$red: red;`&lt;/pre&gt;&lt;pre&gt;`//main.scss@import &apos;./variables.scss&apos;;h1{  color: $red;}`&lt;/pre&gt;å¨å¥å£æä»¶ index.js ä¸­å¼ç¨&lt;pre&gt;`require(&apos;./main.scss&apos;);`&lt;/pre&gt;### å¤çå¾ç&lt;pre&gt;`npm install --save-dev url-loader`&lt;/pre&gt;éç½®webpack.config.js&lt;pre&gt;`{  test: /\.(png|jpg)$/,  loader: &apos;url?limit=8192&apos;}`&lt;/pre&gt;æ³¨æ, Limitåæ°å¶å®äºå°äº 8M çå¾çä¼è¢«è½¬ä¸º base64 ç¼ç , å¯ä»¥åè½»ç½ç»è¯·æ±.&lt;pre&gt;`@import &apos;./variabels.scss&apos;h1 {  color: $red;  background-image: url(&apos;./imgs/avatar.jpg&apos;);}`&lt;/pre&gt;### æ·»å ç¬¬ä¸æ¹åº&lt;pre&gt;`npm install --save-dev jquery moment`&lt;/pre&gt;ä¿®æ¹ index.js&lt;pre&gt;`var sub = require(&apos;./sub&apos;);require(&apos;./main.scss&apos;);var $ = require(&apos;jquery&apos;);var moment = require(&apos;moment&apos;);var app = document.createElement(&apos;div&apos;);app.innerHTML = &apos;&amp;lt;h1&amp;gt;Hello, h1&apos;;document.body.append(app);app.appendChild(sub());$(&apos;body&apos;).append(&apos;&amp;lt;p&amp;gt;Inserted By Jquery. Now is &apos; + moment().format() + &apos;&amp;lt;/p&amp;gt;&apos;);`&lt;/pre&gt;### æ·»å  ES6 æ¯æå®è£ loader&lt;pre&gt;`npm install -save-dev babel-loader babel-preset-es2015`&lt;/pre&gt;éç½® webpack.config.js&lt;pre&gt;`...{  test: /\.jsx$/,  loaders: babel,  include: APP_PATH,  query:{    presets: [&apos;es2015&apos;]  }}...`&lt;/pre&gt;es2015 è¿ä¸ªåæ°æ¯ babel ç plugin, å¯ä»¥æ¯æææ°ç ES6 çç¹æ§ç°å¨å¯ä»¥ js æä»¶æ¹ä¸º ES6 é£æ ¼&lt;pre&gt;`//sub.jsexport default function(){  var element = document.createElement(&apos;h2&apos;);  element.innerHTML = &apos;This is h2&apos;;  return element;}`&lt;/pre&gt;&lt;pre&gt;`//index.jsimport &apos;./main.scss&apos;;import generateText from &apos;./sub&apos;;import $ from &apos;jquery&apos;;import moment from &apos;moment&apos;;let app = document.createElement(&apos;div&apos;);const myPromise = Promise.resolve(42);myPromise.then((number) =&amp;gt; {  $(&apos;body&apos;).append(&apos;&amp;lt;p&amp;gt;Promise result is &apos; + number + &apos;now is &apos; + moment().format() + &apos;&amp;lt;/p&amp;gt;&apos;);});app.innerHTML = &apos;&amp;lt;h1&amp;gt;This is h1&apos;;document.body.appendChild(app);app.appendChild(generateText());</code></pre>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Webpack.config.js</title>
      <link href="/2016/07/21/webpack-config-js/"/>
      <content type="html"><![CDATA[<h3 id="entry"><a href="#entry" class="headerlink" title="entry"></a>entry</h3><p>The entry point for the bundle.</p><p>If you pass a string: The string is resolved to a module which is loaded upon startup.</p><p>If you pass an array: All modules are loaded upon startup. The last one is exported.</p><pre><code>entry:[&apos;./entry1&apos;,&apos;./entry2&apos;]`&lt;/pre&gt;If you pass an object: Multiple entry bundles are created. The key is the chunk name. The value can be a string or an array&lt;pre&gt;`{  entry:{    page1: &apos;./pages1&apos;,    page2: [&apos;./entry1&apos;,&apos;./entry2&apos;]  },  output: {    // Make sure to use [name] or [id] in output.filename    // when using multiple entry points    filename: &apos;[name].bundle.js&apos;,    chunkFilename: &apos;[id].bundle.js&apos;  }}`&lt;/pre&gt;### Output`output` options tell webpack how to write the compiled files to disk.Note, that while there can be multiple &apos;entry&apos; points, only &apos;output&apos; configuration is specified.If you use hashing(`[hash]` or `[chunkhash]`) make sure to have a consistent ordering of modules. Use the `OccurenceOrderPlugin` or `recordsPath`#### output.filenameSpecifies the name of each output file on disk. You must **not** specify an absolute path here! The `output.path` option determines the location on disk the files are written to, `filename` is used solely for naming the individual files.##### single entry&lt;pre&gt;`{  entry: &apos;./src/app.js&apos;,  output: {    filename: &apos;bundle.js&apos;,    path: &apos;./build&apos;  }}`&lt;/pre&gt;##### multiple entriesIf you configuration creates more than a single &quot;chunk&quot;(as with multiple entry points or when using plugins like CommonsChunkPlugin), you should use substitutions below to ensure that each file has a unique name.`[name]` is replaced by the name of the chunk`[hash]` is replaced by the hash of the compilation.`[chunkhash]` is replaced by the hash of the chunk.&lt;pre&gt;`{  entry:{    app: &apos;./src/app.js&apos;,    search: &apos;./src/search.js&apos;  },  output:{    filename: [name].js,    path: __dirname + &apos;/built&apos;  }}</code></pre><h4 id="output-path"><a href="#output-path" class="headerlink" title="output.path"></a>output.path</h4><p>The output directory as <strong>absolute path</strong>(required).</p><h3 id="Module-loaders"><a href="#Module-loaders" class="headerlink" title="Module.loaders"></a>Module.loaders</h3><p>An array of automatically applied loaders.</p><p>Each item can have there properties: </p><ul><li><code>test</code>: A condition that must be met</li><li><code>exclude</code>: A condition that must not be met</li><li><code>include</code>: A condition that must be met</li><li><code>loader</code>: A string of â!â separated loaders</li><li>âloadersâ: An array of loaders as string</li></ul><h3 id="resolve"><a href="#resolve" class="headerlink" title="resolve"></a>resolve</h3>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Webpack</title>
      <link href="/2016/07/21/webpack-2/"/>
      <content type="html"><![CDATA[<h3 id="Use-webpack-in-a-project"><a href="#Use-webpack-in-a-project" class="headerlink" title="Use webpack in a project"></a>Use webpack in a project</h3><p>Itâs best to have webpack <strong>as a dependency</strong> in your project, through this you can choose a local webpack version and will not be forced to use the single global one.<br>Add a <code>package.json</code> configuration file or <code>npm</code> with:</p><pre><code>$ npm init`&lt;/pre&gt;The answers to the question are not so important if you don&apos;t want to publish your project to npm.Install and add `webpack` to the `package.json` with:&lt;pre&gt;`$ npm install --save-dev webpack`&lt;/pre&gt;### Create a modular JavaScript ProjectLet&apos;s create some modules in JavaScript, using the CommonJS syntax:#### cat.js&lt;pre&gt;`var cats = [&apos;dave&apos;,&apos;henry&apos;,&apos;martha&apos;];module.exports = cats;`&lt;/pre&gt;#### app.js(Entry Point)&lt;pre&gt;`var cats = require(&apos;cats.js&apos;);console.log(cats);`&lt;/pre&gt;The **Entry Point** is where your application will start, and where webpack will start tracking dependencies between modules.Give webpack the entry point(app.js) and specify an output file(app.bundle.js):&lt;pre&gt;`webpack ./app.js app.bundle.js`&lt;/pre&gt;webpack will read and analyze the entry point and its dependencies(including transitive dependencies). Then it will bundle them into `app.bundle.js`.Now your bundle is ready to run. Run `node app.bundle.js` and marvel in your abundance of cats.To gain full access to webpack&apos;s flexibility, we need to create a &quot;configuration file&quot;### Project StructureWe will put the source files in **src**, and bundled files in **dist**.The final project structure will look like this:![](https://raw.githubusercontent.com/dtinth/webpack-docs-images/2459637650502958669ea6b11bf49dc0b3b083ae/usage/project-structure.png)</code></pre><ol><li><p>Create <code>webpack.config.js</code></p><pre>`module.exports = {  entry: './src/app.js',  output: {    path: './dist',    filename: '[name].bundle.js'  }};`</pre><p>A webpack configuration file is a CommonJS-Style module. So you can run any kind of code here, as long as a configuration object is exported out of its module.</p></li><li><p>Using loaders<br>Webpack only supports JavaScript modules natively, but most people will be using a transpiler for ES2015, CoffeeScript, TypeScript, etc. They can be used in webpack by using <strong>loaders</strong>.<br>Loaders are special modules webpack uses to âloadâ other modules(written in another language) into JavaScript(that webpack understands).</p><p>using <code>babel-loader</code><br>1. Install Babel and the presets:</p><pre>`npm install --save-dev babel-loader`</pre></li><li><p>Configure Babel to use there presets by add <code>.babelrc</code></p><pre>`{'presets':['es2015']}`</pre></li><li><p>Modify <code>webpack.config.js</code> to process all <code>.js</code> files using <code>babel-loader</code>.</p><pre>`module.exports = {  entry: './src/app.js',  output: {    path: './dist',    filename: '[name].bundle.js'  },  module: {    loaders: [      {test: /\.js$/,exclude: /node_modules/, loader: 'babel-loader',}    ]  }}`</pre><p>We are excluding <code>node_modules</code> here because otherwise all external libraries will also go through Babel, slowing down compilation.<br>4. Install the libraries you want to use</p><pre>`npm install --save jquery babel-polyfill`</pre><p>We are using <code>--save</code> instead of <code>--save-dev</code> this time, as there libraries will be used in runtime. <code>-dev</code> means the libraries only used during development.</p></li><li><p>Edit <code>src/app.js</code></p><p><pre>`import âbabel-polyfillâ;<br> import cats from â./catsâ;<br> import $ from âjqueryâ;</pre></p><p> $(â&lt;h1&gt;Cats&lt;/h1&gt;â).appendTo(âbodyâ);<br> const ul = $(â&lt;ul&gt;&lt;/ul&gt;â).appendTo(âbodyâ);<br> for (const cat of cats) {</p><pre><code>$(&apos;&amp;lt;li&amp;gt;&amp;lt;/li&amp;gt;&apos;).text(cat).appendTo(ul);</code></pre><p> }</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">    6\. Using Plugins</span><br><span class="line">    An example would be minifying your file so that the client can load if faster. This can be done with **plugins**. We&apos;ll add the uglify plugin to our configuration:</span><br><span class="line"></span><br><span class="line">const webwebpack = require(&apos;webpack&apos;);</span><br><span class="line">module.exports = &#123;</span><br><span class="line">  entry: &apos;./src/app.js&apos;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: &apos;./dist&apos;,</span><br><span class="line">    filename: &apos;[name].bundle.js&apos;</span><br><span class="line">  &#125;,</span><br><span class="line">  module: &#123;</span><br><span class="line">    loaders: [</span><br><span class="line">      &#123;test: /&amp;#46;jsx?$/, exclude: /node_modules/,loader: &apos;babel-loader&apos;&#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">plugins: [</span><br><span class="line">    new webpack.optimize.UglifyJsPlugin(&#123;</span><br><span class="line">      compress: &#123;</span><br><span class="line">        warning:false,</span><br><span class="line">      &#125;,</span><br><span class="line">      output: &#123;</span><br><span class="line">        comments: false,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#125;),</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p>The Uglify plugin is included with webpack so you donât need to add additional modules, but this may not always be the case.</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Refs to Components</title>
      <link href="/2016/07/21/refs-to-components/"/>
      <content type="html"><![CDATA[<p>The DOM returned from render() is virtual, so called Virtual DOM, and we can get any factual input(value) from a virtual object, such as access to value from a <input> component.</p><h3 id="The-ref-returned-from-ReactDOM-render"><a href="#The-ref-returned-from-ReactDOM-render" class="headerlink" title="The ref returned from ReactDOM.render"></a>The ref returned from ReactDOM.render</h3><p>ReactDOM.render() will return a reference to your componentâs <strong>backing instance</strong>(or null for stateless components)</p><p><code>var myComponent = ReactDOM.render(&amp;lt;MyComponent /&amp;gt;, myContainer)</code></p><p>However, that the JSX doesnât return a component. Itâs just a <strong>ReactElement</strong>: a lightweight representation that tells React what the mounted component should look like.</p><pre><code>var myComponentElement = &amp;lt;MyComponent title = &apos;title&apos;/&amp;gt;; //This is just a ReactElement`&lt;/pre&gt;&lt;pre&gt;`var myComponentInstance = ReactDOM.render(myComponent, myContainer); //a Virtual DOM`&lt;/pre&gt;### The ref Callback AttributeReact supports a special attribute that you can attach to any component. The &apos;ref&apos; attribute ca be a callback function, and this callback will be executed **immediately after the component is mounted**. The referenced component will be passed in as a parameter, and the callback function may use the component immediately, or save the reference for future use.It&apos;s as simple as adding a `ref` attribute to anything returned from render:&lt;pre&gt;`render: function(){  return (    &amp;lt;TextInput ref={function(input){      if(input != nill){        input.focus();      }    }} /&amp;gt;  );},`&lt;/pre&gt;or use ES6 arrow funciton:&lt;pre&gt;`render: function(){  return &amp;lt;TextInput ref={(c) =&amp;gt; this._input = c} /&amp;gt;;},componentDidMount: function{  this._input.focus();}`&lt;/pre&gt;### The ref String AttributeReact also supports using a string as a ref prop on any component.Add `ref` attribute to component so you can access to them via `this.refs`</code></pre><ol><li><p>Assign a <code>ref</code> attribute to anything returned from <code>render</code> such as:</p><pre>`&lt;input ref='myInput'&gt;`</pre></li><li><p>In some other code, access the <strong>backing instance</strong> via <code>this.refs</code> as in</p><pre>`var input = this.refs.myInput;var inputValue = input.value;`</pre><h3 id="A-Complete-Example"><a href="#A-Complete-Example" class="headerlink" title="A Complete Example"></a>A Complete Example</h3><p><pre>`var MyComponent = React.createClass({<br>  handleClick: function(){</pre></p><pre><code>if(this.myTextInput != null){  this.myTextInput.focus()}</code></pre><p>  },<br>  render: function(){</p><pre><code>return(  &amp;lt;div&amp;gt;    &amp;lt;input type=&apos;text&apos; ref={(ref) =&amp;gt; this.myTextInput = ref} /&amp;gt;    &amp;lt;input type=&apos;button&apos; value=&apos;Focus the text input&apos; onClick = {this.handleClick} /&amp;gt;  &amp;lt;/div&amp;gt;);</code></pre><p>  }<br>});</p><p>ReactDOM.render(&lt;MyComponent /&gt;, document.getElementById(âexampleâ));</p></li></ol><p>Note: <code>ref</code> will be destroyed as component unmounted.</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
          <category> workNote </category>
          
      </categories>
      
      
        <tags>
            
            <tag> React </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Component API</title>
      <link href="/2016/07/21/component-api/"/>
      <content type="html"><![CDATA[<h3 id="setState-nextState-obj-callback-function"><a href="#setState-nextState-obj-callback-function" class="headerlink" title="setState(nextState(obj)[, callback(function)])"></a>setState(nextState(obj)[, callback(function)])</h3><p>è®¾ç½® nextState çæä¸ªé®å¼, ç¶åä¸ä¸æ¬¡ EventLoop çæ¶å this.state ä¼è¢«æ´æ°<br><strong>æ³¨æ</strong>, setState æ¹æ³ä¸­çåè°å½æ°å¨ç»ä»¶éæ°æ¸²æåæè¢«è°ç¨</p><h3 id="replaceState-nextState-obj-callback-function"><a href="#replaceState-nextState-obj-callback-function" class="headerlink" title="replaceState(nextState(obj)[, callback(function)])"></a>replaceState(nextState(obj)[, callback(function)])</h3><p>ç±»ä¼¼äº setState(), ä½æ¯ä¼å é¤å·²å­å¨ç state é®, ç¸å½äºéæ°åå§åState</p><h3 id="forceUpdate-callback-function"><a href="#forceUpdate-callback-function" class="headerlink" title="forceUpdate([callback(function)])"></a>forceUpdate([callback(function)])</h3><p>å¼ºå¶æ¸²æç»ä»¶<br><strong>æ³¨æ</strong>è¯¥æ¹æ³çåè°å½æ°ä¹æ¯å¨ç»ä»¶éæ°æ¸²æå®æåè°ç¨</p><h3 id="getDOMNode"><a href="#getDOMNode" class="headerlink" title="getDOMNode()"></a>getDOMNode()</h3><p>è¿åç»ä»¶æå¤ç DOM åç´ </p><h3 id="isMounted"><a href="#isMounted" class="headerlink" title="isMounted()"></a>isMounted()</h3><p>è¿åä¸ä¸ª Boolean å¼, å¦æç»ä»¶å è½½å°äº DOM, isMount() è¿å true.</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
          <category> workNote </category>
          
      </categories>
      
      
        <tags>
            
            <tag> React </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>React é¡¶å± API</title>
      <link href="/2016/07/21/react-e9-a1-b6-e5-b1-82-api/"/>
      <content type="html"><![CDATA[<h3 id="React-createClass-obj"><a href="#React-createClass-obj" class="headerlink" title="React.createClass(obj)"></a>React.createClass(obj)</h3><p>åå»ºä¸ä¸ª ReactClass(ç»ä»¶ç±»), åæ°æ¯ä¸ä¸ªå¯¹è±¡ä¸å¿é¡»æ render å±æ§. è¯¥æ¹æ³å¿é¡»è¿åä¸ä¸ªå°é­çå®¹å¨æ null/false(è¡¨ç¤ºä¸æ¸²æ)</p><p>å¨è¯¥æ¹æ³ä¸­, ææç this é½ä¼å¨æç»è°ç¨çæ¶åç»å®å°åå»ºçç»ä»¶çæé å¨ä¸.</p><h3 id="React-createElement-TYPE-string-ReactClass-PROPS-CHILDREN-ReactElement"><a href="#React-createElement-TYPE-string-ReactClass-PROPS-CHILDREN-ReactElement" class="headerlink" title="React.createElement(TYPE(string|ReactClass)[, PROPS[, CHILDREN(ReactElement)]])"></a>React.createElement(TYPE(string|ReactClass)[, PROPS[, CHILDREN(ReactElement)]])</h3><p>åå»ºä¸ä¸ªæå®ç±»åç React åç´ (è¦åºå ReactClass(éæ§) å ReactElement( ä¸ªæ§) å Virtual DOM(å®ä¾), éè¿ ReactClass åå»º ReactElement, ç¶åå®ä¾åæ Virtual DOM: æ¯å¦ ButtonComponent æ¯ Class, è&lt;ButtonCompoennt /&gt;åæ¯ Element, æåéè¿ ReactDOM.render() çæVirtual DOM)<br>ç¬¬ä¸ä¸ªåæ° Children å¯ä»¥æ¯äººä¸ä¸ªä¹¦ç React åç´ </p><pre><code>React.createElement(&apos;div&apos;, null,   React.createElement(&apos;p&apos;, null,     React.createElement(Component, {a:1})  ))`&lt;/pre&gt;### React.cloneElement(TYPE(ReactElement)[, PROPS(object)[, CHILDREN(ReactElement)]])åéå¹¶è¿åä¸ä¸ªæ°ç ReactElement(åé¨å­åç´ ä¹ä¼éä¹åé), æ°è¿åçåç´ ä¼ä¿çå°±åç´ ç props, ref, key, ä¹ä¼éææ°ç props( å¦æç¬¬äºä¸ªåæ°ä¸ä¸º null)&lt;pre&gt;`var Hello = React.createClass({  render: function(){    var span = &amp;lt;span a = &apos;1&apos;&amp;gt;Span&amp;lt;/span&amp;gt;;    var newSpan = React.cloneElement(span,{b:&apos;2&apos;}, &amp;lt;em&amp;gt;EM&amp;lt;/em&amp;gt;);    console.log(newSpan.props);    return &amp;lt;div&amp;gt;Hello {span},{newSpan}&amp;lt;/div&amp;gt;;  }});`&lt;/pre&gt;æ³¨æ createElementçç¬¬ä¸ä¸ªåæ°å¿é¡»æ¯å­ç¬¦ä¸²æè ReactClass, è cloneElement çç¬¬ä¸ä¸ªåæ°åªè½æ¯ ReactClass### React.createFactory(TYPE(string|ReactElement))è¿åä¸ä¸ªæç§ç±»åç ReactElement å·¥åå½æ°, å¯ä»¥å©ç¨è¿åçå½æ°æ¥åå»ºä¸ä¸ª ReactElement( éç½® props å children)&lt;pre&gt;`var Component = React.createClass({  render:function(){    return this.props.a == 1? &amp;lt;p&amp;gt;123&amp;lt;/p&amp;gt; : null;  }});var p = React.createFactory(Component),    ReactElementP = p{{a:1}},    div = React.createFactory(&apos;div&apos;),    ReactElementDiv = div(null, ReactElementP);React.render(  ReactElementDiv, document.body);`&lt;/pre&gt;### React.render(REACTELEMENT(ReactElement), CONTAINER(DOMElement)[, CALLBACK(function)])æ¸²æä¸ä¸ª ReactElement å° container æå®ç DOM ä¸­, å¹¶è¿åä¸ä¸ªå°è¯¥ç»ä»¶çå¼ç¨. å¦ææä¾äºå¯éçåè°å½æ°, åè¯¥å½æ°ä¼å¨ç»ä»¶æ¸²æææ´æ°ä¹åè°ç¨å¦ææä»¬å¸æå¨ç»ä»¶å¤é¨å¯ä»¥è·å¾ç»ä»¶åé¨(è½éè¿ this è®¿é®)çä¸è¥¿, å¯ä»¥å° React.render çè¿åå¼èµäºä¸ä¸ªåé, å¨åç»­çè°ç¨ä¸­è®¿é®åéå³å¯.### React.unmountComponentAtNode(CONTAINER(DOMElement)ä» container æå®ç DOM ä¸­ç§»é¤å·²ç»å è½½ç ReactElement, æ¸æ¥ç¸åºçäºä»¶å¤çå¨å state, å¦æå¨ container ä¸­æ²¡æå­å¨çç»ä»¶, åä¸ä½å¤çå¦æç»ä»¶æ¸é¤æå, åè¿å true### React.renderToString(REACTELEMENT(ReactElement))React ä¸ºæå¡ç«¯æä¾çä¸ä¸ªæ¹æ³, å¯ä»¥ç´æ¥è¾åº ReactElement ä¸º HTML å­ç¬¦ä¸², å°è¿äºæ è®°åé(æ¯å¦ res.write(HTMLString))ç»å®¢æ·ç«¯, å¯ä»¥è·å¾æ´å¿«çé¡µé¢å è½½éåº¦, å¹¶æå©äºæç´¢å¼æçæå&lt;pre&gt;`var com = &amp;lt;Component /&amp;gt;comHTML = React.renderToString(com) //HTMLString`&lt;/pre&gt;### React.renderToStaticMarkupç±»ä¼¼äº React.renderToString, ä½åªçæçº¯ç²¹ç HTML æ è®°å­ç¬¦ä¸², ä¸ä¼åå«ç±»ä¼¼ dta-reactid ä¹ç±»ç React å±æ§, ä»èèçº¦å­èæ°### React.initializeTouchs(ShouldUserTouch(boolean))å¼å¯æå³é­ React çè§¦æ¸äºä»¶æºå¶, ä¼ å¥åæ° true ä½¿ React ååº Touch äºä»¶### React.Chilren#### React.Children.map(obj children, function[, object context])éåå­åç´ , æ å°ä¸ºä¸ä¸ªæ°çå­åç´ éå&lt;pre&gt;`var Component = React.createClass({  render: function(){    return (      &amp;lt;ul&amp;gt;        {React.Children.map{          this.props.children, function(){            return &amp;lt;li&amp;gt;{child}&amp;lt;/li&amp;gt;            }          }        }      &amp;lt;/ul&amp;gt;    )  }})</code></pre><h4 id="React-Children-forEach-obj-children-function-obj-context"><a href="#React-Children-forEach-obj-children-function-obj-context" class="headerlink" title="React.Children.forEach(obj children, function[, obj context])"></a>React.Children.forEach(obj children, function[, obj context])</h4><p>éåå­åç´ , å¯¹æ¯ä¸ªå­åç´ æ§è¡åè°, ä½ä¸ä¼è¿åä¸ä¸ªæ°çéå</p><h4 id="React-Children-count-obj-children"><a href="#React-Children-count-obj-children" class="headerlink" title="React.Children.count(obj children)"></a>React.Children.count(obj children)</h4><p>è¿åå­åç´ æ»ä¸ªæ°</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
          <category> workNote </category>
          
      </categories>
      
      
        <tags>
            
            <tag> React </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Updating With React.render</title>
      <link href="/2016/07/20/updating-with-react-render/"/>
      <content type="html"><![CDATA[<h3 id="What-does-React-render-do"><a href="#What-does-React-render-do" class="headerlink" title="What does React.render do"></a>What does React.render do</h3><ol><li>First, validate the inputs</li><li>If there was no previous component, render as a new component</li><li>Otherwise, compare the next component to the previous component using <strong>âshouldCUpdateComponentâ</strong></li><li>If <strong>âshouldUpdateComponentâ</strong> is true, update the component using ReactComponent.updateComponent. Otherwise, unmount and continue to render as a new component</li></ol><p><code>React.render</code> gives you a declarative way to use Reactâs update flow at the top level, similar to how re-rendering works inside a component. Many times, however, you can create a wrapper component so that you only have a single <code>React.render</code> call. This allows you to keep the logic inside components, which may be cleaner.</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
          <category> workNote </category>
          
      </categories>
      
      
        <tags>
            
            <tag> React </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>React ç»ä»¶çå½å¨æ</title>
      <link href="/2016/07/20/react-e7-bb-84-e4-bb-b6-e7-94-9f-e5-91-bd-e5-91-a8-e6-9c-9f/"/>
      <content type="html"><![CDATA[<h3 id="Mounting-ç»ä»¶åå§åç¸å³"><a href="#Mounting-ç»ä»¶åå§åç¸å³" class="headerlink" title="Mounting/ç»ä»¶åå§åç¸å³"></a>Mounting/ç»ä»¶åå§åç¸å³</h3><p>componentWillMount<br>componentDidMount</p><h3 id="Updating-ç»ä»¶æ´æ°ç¸å³"><a href="#Updating-ç»ä»¶æ´æ°ç¸å³" class="headerlink" title="Updating/ç»ä»¶æ´æ°ç¸å³"></a>Updating/ç»ä»¶æ´æ°ç¸å³</h3><p>componentWillReceiveProps<br>shouldComponentUpdate<br>componentWillUpdate<br>componentDidUpdate</p><h3 id="Unmounting-ç»ä»¶ç§»é¤ç¸å³"><a href="#Unmounting-ç»ä»¶ç§»é¤ç¸å³" class="headerlink" title="Unmounting/ç»ä»¶ç§»é¤ç¸å³"></a>Unmounting/ç»ä»¶ç§»é¤ç¸å³</h3><p>componentWillUnmount</p><h3 id="Initial-ç¸å³"><a href="#Initial-ç¸å³" class="headerlink" title="Initial ç¸å³"></a>Initial ç¸å³</h3><p>getDefaultProps<br>getInitialState</p><h4 id="componentWillMount"><a href="#componentWillMount" class="headerlink" title="componentWillMount"></a>componentWillMount</h4><p>å¨ç»ä»¶åå§ååæ§è¡, ä½ä»æ§è¡ä¸æ¬¡, å³ä½¿å¤æ¬¡éå¤æ¸²æè¯¥ç»ä»¶,æèæ¹åç»ä»¶ç state<br>å¦æå¸æè¯¥åè°è½æ§è¡å¤æ¬¡, å¯ä»¥ä½¿ç¨ React.unmountComponentAtNode ç§»é¤å·²æçç»ä»¶, ç¶åéæ° render</p><h4 id="componentDidMount"><a href="#componentDidMount" class="headerlink" title="componentDidMount"></a>componentDidMount</h4><p>å¨ç»ä»¶åå§åå®ææ¶è§¦å, åæ ·åªè½è§¦åä¸æ¬¡</p><h4 id="componentWillReceiveProps"><a href="#componentWillReceiveProps" class="headerlink" title="componentWillReceiveProps"></a>componentWillReceiveProps</h4><p>å¨ç»ä»¶æ¥æ¶å°æ°ç props çæ¶é´ç¹ä¹åè°ç¨, æ³¨æåå§åçæ¶åä¸ä¼è§¦å(æ­¤æ¶åå§å props, èä¸æ¯è·å¾æ°ç props), ä½æ¯å¦æç»ä»¶éå¤æ¸²æ(æ²¡æç§»é¤), åä¼è§¦åæ­¤äºä»¶</p><h4 id="shouldComponentUpdate"><a href="#shouldComponentUpdate" class="headerlink" title="shouldComponentUpdate"></a>shouldComponentUpdate</h4><p>ç»ä»¶æ¥æ¶å°æ°ç props æ state çæ¶å(æ­¤æ¶è¿æ²¡è¿è¡ä¸ä¸æ¬¡ render) ä¼ç«å³è°ç¨, ç¶åéè¿è¿åå¸å°å¼å³å®æ¯å¦è¦éæ°æ¸²æå½åç»ä»¶<br>è¯¥æ¥å£æ¥æ¶ä¸¤ä¸ªåæ°, ç¬¬ä¸ä¸ªåæ°è¡¨ç¤ºæ°çprops, ç¬¬äºä¸ªè¡¨ç¤ºæ°ç state</p><pre><code>shouldComponentUpdate:function(){return true} //éæ°æ¸²æç»ä»¶</code></pre><h4 id="componentWillUpdate"><a href="#componentWillUpdate" class="headerlink" title="componentWillUpdate"></a>componentWillUpdate</h4><p>shouldComponentUpdate è¿å true çæ¶åè°ç¨, æ­¤æ¶ props å state é½æ¯æ´æ°åçå¼, èç»ä»¶å°æªéæ°æ¸²æ</p><h4 id="componentDidUpdate"><a href="#componentDidUpdate" class="headerlink" title="componentDidUpdate"></a>componentDidUpdate</h4><p>éæ°æ¸²æåæä¼è§¦å</p><h4 id="componentWillUnmount"><a href="#componentWillUnmount" class="headerlink" title="componentWillUnmount"></a>componentWillUnmount</h4><p>ç»ä»¶è¢«ç§»é¤ä¹åè§¦å, ç¨äºåä¸äºå¿è¦çæ¸ç, æ¯å¦æ æçå®æ¶å¨ç­</p><h4 id="getDefaultProps"><a href="#getDefaultProps" class="headerlink" title="getDefaultProps"></a>getDefaultProps</h4><p>è¯¥æ¹æ³æ¯æåè§¦åç, å¯ä»¥å¨è¯¥æ¹æ³ä¸­ return ä¸ä¸ªå¯¹è±¡ä½ä¸ºç»ä»¶çé»è®¤ Props(å½ç¶å¦ææä»ç¶ç»ä»¶ä¼ æ¥ç props, åä»¥ä¼ è¿æ¥çä¸ºä¸»)<br>åªå¨ç»ä»¶åå§åçæ¶åæ§è¡ä¸æ¬¡</p><h4 id="getInitialState"><a href="#getInitialState" class="headerlink" title="getInitialState"></a>getInitialState</h4>]]></content>
      
      <categories>
          
          <category> note </category>
          
          <category> workNote </category>
          
      </categories>
      
      
        <tags>
            
            <tag> React </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Webpack</title>
      <link href="/2016/07/20/webpack/"/>
      <content type="html"><![CDATA[<p>Webpack æ¯ä¸æ¬¾æ¨¡åå è½½å¼æåå·¥å·, è½æåç§èµæº, ä¾å¦ JS(X), coffee, css(sass/less), å¾çç­é½ä½ä¸ºæ¨¡åæ¥ä½¿ç¨åå¤ç</p><p>å¯ä»¥ç´æ¥ä½¿ç¨ require çå½¢å¼æ¥å¼å¥åæ¨¡å, å³æ¶ä»ä»¬å¯è½éè¦ç»è¿ç¼è¯, webpack ä¸æåç§å¥å¨çå è½½å¨(loader)ä¼å¤çè¿äºäºæ.</p><h3 id="Webpack-ä¼å¿"><a href="#Webpack-ä¼å¿" class="headerlink" title="Webpack ä¼å¿"></a>Webpack ä¼å¿</h3><ol><li>webpack æ¯ä¸ commonJS çå½¢å¼æ¥ä¹¦åèæ¬ç, ä½å¯¹ AMD/CMD çæ¯æä¹å¾å¨é¢, æ¹ä¾¿å°±é¡¹ç®è¿è¡ä»£ç è¿ç§»</li><li>è½è¢«æ¨¡ååçä¸ä»æ¯ JS äº</li><li>å¼åä¾¿æ·, è½æ¿ä»£é¨å grunt/gulp å·¥ä½, æ¯å¦æå, åç¼©æ··æ·, å¾çè½¬ base64ç­</li><li>æ©å±æ§å¼º, æä»¶æºå¶å®å, ç¹å«æ¯æ React ç­ææ(react-hot-loader).</li></ol><h3 id="å®è£ä¸éç½®"><a href="#å®è£ä¸éç½®" class="headerlink" title="å®è£ä¸éç½®"></a>å®è£ä¸éç½®</h3><p>å¸¸è§ä½¿ç¨ npm å®è£<br><code>$npm install -g webpack</code><br>å¦ææ¯å¸¸è§é¡¹ç®, è¿æ¯æä¾èµåå¥ package.json æ´å¥½</p><pre><code>$npm init$npm install --save-dev webpack`&lt;/pre&gt;### éç½®æ¯ä¸ªé¡¹ç®ä¸é½å¿é¡»éç½®ä¸ä¸ª webpack.config.js, ä»çä½ç¨å¦åå¸¸è§ç gulpfile.js, å°±æ¯ä¸ä¸ªéç½®é¡¹, åè¯ webpack éè¦åä»ä¹æ¯å¦:&lt;pre&gt;`var webpack = require(&apos;webpack&apos;);var commonsPlugin = new webpack.optimize.CommonsChunkPlugin(&apos;common.js&apos;);module.exports = {  //æä»¶é¡¹  plugins: [commonsPlugin],  //é¡µé¢å¥å£æä»¶éç½®  entry:{    index: &apos;./src/js/page/entry1.js&apos;  },  //æä»¶è¾åºéç½®  output:{    path: &apos;dist/js/page&apos;,    filename: &apos;[name].js&apos;  },  module:{    //å è½½å¨éç½®    loaders:[      {test: /\.css$/, loader: &apos;style-loader!css-loader&apos;},      {test: /\.js$/, loader: &apos;jsx-loader?harmony&apos;},      {test: /\.scss$/, loader: &apos;style!css!sass?sourceMap&apos;},      {test: /\.(png|jpg)$/, loader: &apos;url-loader?limit-8192&apos;}    ]  },};`&lt;/pre&gt;#### plugins æä»¶é¡¹è¿éä½¿ç¨äºä¸ä¸ª CommonsChunkPlugin çæä»¶, ç¨äºæåå¤ä¸ªå¥å£æä»¶çå¬å±é¨å, ç¶åçæä¸ä¸ª common.js æ¥è®¿æ¹ä¾¿å¤é¡µé¢ä¹é´çå¤ç¨#### entry æ¯é¡µé¢å¥å£æä»¶éç½®, output æ¯è¾åºéç½®å³å®å¥å£æä»¶è¦çæä»ä¹åå­çæä»¶, å­æ¾å°åªé&lt;pre&gt;`{  entry: {    page1: &apos;./page1&apos;,    //æ¯ææ°ç», å°å è½½æ°ç»ä¸­çæææ¨¡å, ä½ä¸æåä¸ä¸ªæ¨¡åä¸ºè¾åº    page2: [&apos;./entry1&apos;,&apos;./entry2&apos;]  },  output:{    path:&apos;dist/js/page&apos;,    filename: &apos;[name].bundle.js&apos;  }}`&lt;/pre&gt;è¿æ®µä»£ç æç»ä¼çæä¸ä¸ªpage1.bundle.js, åä¸ä¸ªpage2.bundle.js, å¹¶å­æ¾å°./dist/pageä¸#### module.loaders æ¯æå³é®çéç½®åè¯ webpack æ¯ä¸ç§æä»¶é½è¦ç¨ä»ä¹å è½½å¨æ¥å¤çå¤ä¸ª loader ä¹é´ç¨&apos;!&apos;è¿æ¥ææå è½½å¨é½è¦éè¿ npm æ¥å è½½éç½®ä¿¡æ¯çåæ°&apos;?limit=8192&apos;è¡¨ç¤ºå°ææå°äº8kbçå¾çé½è½¬ä¸º base64æ ¼å¼, è¶è¿8kb çå¾çç¨ url-loader æ¥å¤ç### è¿è¡ webpack`$webpack --display-error-details`åé¢çåæ°&apos;--display-error-details&apos; æ¯æ¨èå ä¸ç, æ¹ä¾¿åºéçæ¶åè½æ¥éæ´è¯¦ç»çä¿¡æ¯å¶ä»ä¸»è¦åæ°æ&lt;pre&gt;`$webpack --config XXX.js //ä½¿ç¨å¦ä¸ä»½éç½®æä»¶$webpack --watch //çå¬åå¨å¹¶èªå¨æå$webpack -p //åç¼©æ··æ·èæ¬, è¿ä¸ªå¾éè¦$webpack -d //çæ map éå°æä»¶, åç¥åªäºæ¨¡åè¢«æç»æåå°åªé`&lt;/pre&gt;### æ¨¡åå¼å¥#### HTMLç´æ¥å¨é¡µé¢&amp;lt;body&amp;gt;ä¸­å¼å¥ webpack æç»çæçé¡µé¢èæ¬å³å¯&lt;pre&gt;`&amp;lt;body&amp;gt;  &amp;lt;script scr = &apos;dist/js/page/common.js&apos;&amp;gt;&amp;lt;/script&amp;gt;  &amp;lt;script scr = &apos;dist/js/page/index.js&apos;&amp;gt;&amp;lt;/script&amp;gt;&amp;lt;/body&amp;gt;`&lt;/pre&gt;å¯ä»¥çå°è¿æ ·å¼é½ä¸éè¦, èæ¬æ§è¡çæ¶åä¼å¨æçæ&amp;lt;style&amp;gt;å¹¶æ³¨å¥ head#### JSåèæ¬æ¨¡åå¯ä»¥ç´æ¥ç¨ commonJS æ¥ä¹¦å, å¹¶å¯ä»¥ç´æ¥å¼å¥æªç»ç¼è¯çæ¨¡å, æ¯å¦ JSX, Sass, coffee ç­(åªè¦å¨ webpack.config.js ä¸­éç½®å¥½å è½½å¨)çä¸ä¸ç¼è¯åçé¡µé¢å¥å£æä»¶(index.js)&lt;pre&gt;`require(&apos;../../css/reset.scss&apos;); //å è½½ Reset æ¨¡årequire(&apos;../../css/allComponent.scss&apos;); //å è½½ç»ä»¶æ¨¡åvar React = require(&apos;react&apos;);var AppWrap = require(&apos;redux&apos;).createRedux;var Provider = require(&apos;redux/react&apos;).Provider;var stores = require(&apos;AppStore&apos;);var redux = createRedux(stores);var App = React.createClass({  render: function(){    return (      &amp;lt;Provider redux = {redux}&amp;gt;        {function() {return &amp;lt;AppWrap /&amp;gt;;}}      &amp;lt;/Provider&amp;gt;    );  }});ReactDOM.render(  &amp;lt;App /&amp;gt;,document.body);</code></pre><p>åç»­çé½ç± webpack å¤ç</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
          <category> workNote </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Array.from()</title>
      <link href="/2016/07/20/array-from/"/>
      <content type="html"><![CDATA[<p>Array.from() æ¹æ³å¯ä»¥å°ä¸ä¸ªç±»æ°ç»å¯¹è±¡æå¯éåå¯¹è±¡è½¬åä¸ºçæ­£çæ°ç».<br>å¨ ES6 ä¸­, Class è¯­æ³åè®¸æä»¬ä¸ºåç½®ç±»å(æ¯å¦ Array) åèªå®ä¹ç±»æ°å»ºå­ç±»(æ¯å¦å« subArray), è¿äºå­ç±»ä¹ä¼ç»§æ¿ç¶ç±»çéææ¹æ³, æ¯å¦ subArray.from(), è°ç¨è¯¥æ¹æ³åä¼è¿åå­ç±» subArray ä¸ä¸ªå®ä¾, èä¸æ¯ Array çå®ä¾.</p><h3 id="è¯­æ³"><a href="#è¯­æ³" class="headerlink" title="è¯­æ³"></a>è¯­æ³</h3><pre><code>Array.from(arrayLike[, mapFn[, thisArg]])`&lt;/pre&gt;### åæ°#### arrayLikeæ³è¦è½¬æ¢æçå®æ°ç»çç±»æ°ç»å¯¹è±¡æå¯éåå¯¹è±¡#### manFnå¯éåæ°, å¦æå¶å®äºè¯¥åæ°, åæåçæçæ°ç»ä¼ç»è¿ map æä½#### this.Argå¯éåæ°, æ§è¡ mapFn æ¶ç this çå¼### æè¿°å¯ä»¥ä½¿ç¨ Array.from()å°ä¸é¢çä¸¤ç§å¯¹è±¡è½¬æ¢ææ°ç»- ç±»æ°ç»å¯¹è±¡(æ¥æ length å±æ§åè¥å¹²ç´¢å¼å±æ§çä»»æå¯¹è±¡)- å¯éåå¯¹è±¡(å¯ä»¥è¿­ä»£åºå¶ä»å¯¹è±¡, æ¯å¦æ Map å Set)Array.from(obj,mapFn,thisArg) ç¸å½äº Array.from(obj).map(mapFn,thisArg)### åºç¨&lt;pre&gt;`var obj = {length:5}; // return {length:5}var arr =Array.from(obj); // namely Array.from({length:5}), return [undefined * 5]Array.isArray(arr); //return truevar arr1 = Array.from(obj,(v,k) =&amp;gt; k); //return [0,1,2,3,4]</code></pre>]]></content>
      
      <categories>
          
          <category> note </category>
          
          <category> workNote </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javascript </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>package.json å±æ§</title>
      <link href="/2016/07/20/package-json-e5-b1-9e-e6-80-a7/"/>
      <content type="html"><![CDATA[<h3 id="name"><a href="#name" class="headerlink" title="name"></a>name</h3><p>package.json ä¸­æéè¦çå±æ§æ¯ name å version. è¿ä¸¤ä¸ªå±æ§æ¯å¿é¡»è¦æç, å¦åæ¨¡åæ æ³è¢«å®è£. è¿ä¸¤ä¸ªå±æ§ä¸èµ·å½¢æäºä¸ä¸ª npm æ¨¡åçå¯ä¸æ è¯ç¬¦.<br>æ¨¡åä¸­åå®¹ååçåæ¶, æ¨¡åçæ¬ä¹åºè¯¥ä¸èµ·åå.<br>name å±æ§å°±æ¯ä½ çæ¨¡ååç§°, ä¸é¢æ¯ä¸äºå½åè§å:</p><ul><li>name å¿é¡»å°äºç­äº214å­è, åæ¬åç¼åç§°å¨å(å¦../..module)</li><li>name ä¸è½ä»¥â_âæâ.âå¼å¤´</li><li>ä¸è½æå¤§åå­æ¯</li><li>name ä¼æä¸º url çä¸é¨å, ä¸è½æ url éæ³å­ç¬¦</li><li>ä¸è¦ä½¿ç¨å node æ ¸å¿æ¨¡åä¸æ ·çåç§°</li><li>name ä¸­ä¸è¦æ âjsâ å ânodeâ</li></ul><h3 id="version"><a href="#version" class="headerlink" title="version"></a>version</h3><p>version å¿é¡»å¯ä»¥è¢« npm ä¾èµçä¸ä¸ª node-server æ¨¡åè§£æ</p><h3 id="description"><a href="#description" class="headerlink" title="description"></a>description</h3><p>ä¸ä¸ªæè¿°, æ¹ä¾¿å«äººäºè§£ä½ çæ¨¡åçä½ç¨, æç´¢çæ¶åä¹æç¨</p><h3 id="keywords"><a href="#keywords" class="headerlink" title="keywords"></a>keywords</h3><p>ä¸ä¸ªå­ç¬¦ä¸²æ°ç», æ¹ä¾¿å«äººæå°æ¬æ¨¡å</p><h3 id="homepage"><a href="#homepage" class="headerlink" title="homepage"></a>homepage</h3><p>é¡¹ç®ä¸»é¡µ url<br>æ³¨æ: è¿ä¸ªé¡¹ç®ä¸»é¡µ url å url å±æ§ä¸å, npm æ³¨åå·¥å·ä¼è®¤ä¸ºä½ æé¡¹ç®åå¸å°å¶ä»å°æ¹äº, è·åæ¨¡åçæ¶åä¸æ¯ä»å®æ¹ä»åºåå», èæ¯å» url éç½®çå°å</p><h3 id="bugs"><a href="#bugs" class="headerlink" title="bugs"></a>bugs</h3><p>å¡«åä¸ä¸ªæäº¤ bug çå°åæé®ç®±</p><pre><code>{ &apos;url&apos;: &apos;https://www.ezcook.de/project/issue&apos;, &apos;email&apos;: &apos;project@ezcook.de&apos;}`&lt;/pre&gt;å¦æåªå¡«åä¸ä¸ª, å¯ä»¥è¿åå­ç¬¦ä¸²èä¸æ¯å¯¹è±¡### licenseä¸ºæ¨¡åå¶å®ä¸ä¸ªåè®®, éç¥ç¨æ·å¯ä»¥ä½¿ç¨çæé, æå¸¸è§çæ¯ BSD-3-Clause æ MIT&lt;pre&gt;`{&apos;license&apos;: &apos;MIT&apos;}`&lt;/pre&gt;### author, contributors### filesfiles å±æ§çå¼æ¯ä¸ä¸ªæ°ç», åå®¹æ¯æ¨¡åä¸æä»¶åææä»¶å¤¹å, å¦ææ¯æä»¶å¤¹å, åæä»¶å¤¹ä¸æææä»¶ä¹ä¼è¢«åå«.å¯ä»¥å¨æ¨¡åæ ¹ç®å½ä¸åå»ºä¸ä¸ª &apos;.npmignore&apos; æä»¶, åå¨è¿ä¸ªæä»¶éçæä»¶ä¼è¢«æé¤å¨ file å±æ§### mainmain å±æ§æå®ç¨åºçä¸»å¥å£æä»¶, æ¯å¦è¿ä¸ªæ¨¡å(æä»¶å¤¹)å½åä¸º&apos;foo&apos;, package.jsonä¸­&apos; main&apos; å±æ§æå®ä¸º&apos;test.js&apos;, åéè¿ require(foo)æ¥ä½¿ç¨æ¨¡åçæ¶åä¼æ»´åç¨ test.js èæ¬.ä»åºè¯¥æåæ¨¡åæ ¹ç®å½ä¸å¾ä¸ä¸ªæä»¶, é»è®¤ä¸º index.js### binå¾å¤æ¨¡åæä¸ä¸ªæå¤ä¸ªéè¦éç½®å° PATH è·¯å¾ä¸çå¯æ§è¡æ¨¡å...### manå¶å®ä¸ä¸ªæéè¿æ°ç»æå®ä¸äºæä»¶å¤¹è®© linux ä¸ç man æä»¤æ¥æ¾ææ¡£å°å### directories### repositoryæå®ä¸ä¸ªä»£ç å­æ¾çå°å&lt;pre&gt;`&apos;repository&apos;:{  &apos;type&apos;:&apos;git&apos;,  &apos;url&apos;:&apos;https://github.com/...&apos;}</code></pre><p>å¦ææ¯ Github, å¯ä»¥ç¨ç¼©åå®æ<br>ârepositoryâ:âgist:â¦â`</p><h3 id="scripts"><a href="#scripts" class="headerlink" title="scripts"></a>scripts</h3><p>scripts å±æ§æ¯ä¸ä¸ªå¯¹è±¡, éé¢å¶å®äºé¡¹ç®ççå½å¨æåä¸ªç¯èéè¦æ§è¡çå½ä»¤, key æ¯çå½å¨æä¸­çæ¶é´, value æ¯è¦æ§è¡çå½ä»¤<br>å·ä½åå®¹æ install, start, stop ç­, è¯¦æè§<a href="https://docs.npmjs.com/misc/scripts" target="_blank" rel="noopener">npm/scripts</a></p><h3 id="config"><a href="#config" class="headerlink" title="config"></a>config</h3><p>ç¨æ¥è®¾ç½®ä¸äºé¡¹ç®ä¸æä¹ååçé¡¹ç®éç½®, å¦ port ç­</p><h3 id="dependencies"><a href="#dependencies" class="headerlink" title="dependencies"></a>dependencies</h3><p>dependencies å±æ§æ¯ä¸ä¸ªå¯¹è±¡, éç½®ä¾èµæ¨¡åçæ¨¡ååè¡¨, key æ¯æ¨¡ååç§°, vlaue æ¯çæ¬èå´, çæ¬èå´æ¯ä¸ä¸ªå­ç¬¦, å¯ä»¥è¢«ä¸ä¸ªæå¤ä¸ªç©ºæ ¼åé.<br>æ¯å¦<br><code>`</code><br>âdependenciesâ:<br>{<br>  âfooâ:â1.0.0 - 2.0.0â<br>  âfoo1â:â&gt;=1.0.0â<br>}</p><h3 id="devDependencies"><a href="#devDependencies" class="headerlink" title="devDependencies"></a>devDependencies</h3><p>å¦ææäººæ³ä¸è½½å¹¶ä½¿ç¨ä½ çæ¨¡å, ä¹è®¸ä»ä»¬å¹¶ä¸å¸ææéè¦ä¸è½½ä¸äºä½ å¨å¼åè¿ç¨ä¸­é¢å¤çæµè¯æææ¡£æ¡æ¶<br>è¿ç§æåµä¸æå¥½æè¿äºä¾èµæ·»å å° devDependencies ä¸­, è¿äºæ¨¡åä¼å¨ npm link æè npm install çæ¶åè¢«å®è£, ä¹å¯ä»¥åå¶ä» npm éç½®ä¸æ ·è¢«ç®¡ç</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
          <category> workNote </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NPM </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ä½¿ç¨ Npm åå»ºæ°å·¥ç¨</title>
      <link href="/2016/07/20/e4-bd-bf-e7-94-a8-npm-e5-88-9b-e5-bb-ba-e6-96-b0-e5-b7-a5-e7-a8-8b/"/>
      <content type="html"><![CDATA[<p>åå»ºä¸ä¸ªå·¥ç¨ç®å½, å¹¶ cd å°ç®å½ä¸­, è¿è¡<br><code>$npm init</code><br>è¿ä¸ªå·¥å·å°å¼å¯¼ä½ åå»ºä¸ä¸ª package.json æä»¶, ä»åªè¦çäºå¤§å¤æ°ä¸è¬çé¡¹ç®, å¹¶å°½éè®©é»è®¤åå®¹å¨é¢.<br>è¿è¡<code>npm help json</code> è·å package.json ä¸­çåä¸ªå­æ®µçææ¡£åå¶å®ä¹<br>åé¢å¯ä»¥ç¨<br><code>npm install &amp;lt;pkg&amp;gt; --save</code><br>æ¥å®è£ä¸ä¸ªåå¹¶å°å¶å­å¨ä¸º package.json æä»¶ä¸­çä¸ä¸ªä¾èµæ¨¡å<br>ä»»ä½æ¶é´æä¸^C éåº.<br>ç®åæ¥è¯´:<br><code>npm init</code> åå»ºæä¿®æ¹ä¸ä¸ªé¡¹ç®ä¸­ç package.json æä»¶<br>é»è®¤åç§°(æ¾ç¤ºå¨æ¬å·ä¸­)æ¯å½åæä»¶å¤¹çåå­, å¦æå¯¹äºæç¤ºä¸è¾å¥ä»»ä½å­ç¬¦å¹¶æä¸ Enter é®, npm ä¼å°é»è®¤åç§°å½åé¡¹ç®åç§°.<br>å¨å®ææç¤ºåå®¹å, npm init å°ä¼ç»ä½ ä¸ä¸ªå³å°åå»ºç package.json æä»¶çé¢è§, å¯¹äºæä»¬æ¥è¯´, ä»çèµ·æ¥æ¯è¿æ ·ç</p><pre><code>{&quot;name&quot;:&quot;project-name&quot;,&quot;version&quot;:&quot;0.0.0&quot;,&quot;description&quot;:&quot;...&quot;,&quot;main&quot;:&quot;index.js&quot;,&quot;scripts&quot;:{  &quot;test&quot;:&quot;echo \&quot;Error:no test specified\&quot; &amp;amp;&amp;amp; exit 1&quot;},&quot;keywords&quot;:[&quot;npm&quot;,&quot;example&quot;],&quot;author&quot;:&quot;YourName&quot;,&quot;license&quot;:&quot;MIT&quot;}`&lt;/pre&gt;æä¸ Enter è¿è¡ç¡®è®¤, ä½ å¯ä»¥å¨åé¢éæ¶ä¿®æ¹, éè¿ç¼è¾ package.json æåæ¬¡è¿è¡ npm init.npm init æ°¸è¿ä¹ä¸ä¼ç§»é¤ä½ æ¾å¨ package.json ä¸­çä¿¡æ¯, ä»ä»æ ¹æ®éæ±è¿è¡è°æ´.### package.jsonä¸ä¸ªé¡¹ç®ç package.json æä»¶æä»»ä¸åè§è²- ä»ä¸º npm æä¾ä¸åä¿¡æ¯- ä»åè¯ Node ææ ·å¤çä¸ä¸ªå- ä»ä¸ºäººä»¬æ¥çé¡¹ç®æä¾ä¸ä¸ªè¿å¥ç¹### åå»ºä¸ä¸ªåè¿å¥ç¹ç°å¨åå»ºä¸ä¸ªéå¸¸ç®åçèæ¬å¹¶å°å®å­ä¸º index.js&lt;pre&gt;`//index.jsconsole.log(&quot;Hello, npm&quot;);`&lt;/pre&gt;æä»¬å¯ä»¥ç´æ¥è¿è¡èæ¬&lt;pre&gt;`$node index.jsHello, npm`&lt;/pre&gt;æä»¬å¯ä»¥éè¿ä½¿ç¨ require, å¨å¶ä»ç Node åºç¨ä¸­åºç¨è¿æ®µèæ¬. é¦åè¿å¥ Node REPL, ä¸ä¸ªäº¤äºçå½ä»¤è¡ç¯å¢:&lt;pre&gt;`$node&amp;gt; require(&apos;./index.js&apos;)Hello, npm{}`&lt;/pre&gt;({}æ¯ require çè¿åå¼, å¨è¿ä¸ªä¾å­ä¸­, ä»æ¯ index.js ç exports å¯¹è±¡)Node åè®¸æä»¬çç¥.js æ©å±å, å æ­¤æä»¬å¯ä»¥ç®åä¸º require(&apos;,/index&apos;).å¦ææä»¬å¨åä¸ä¸ª REPL ä¼è¯ä¸­åæ¬¡è¿è¡ require, æä»¬å°å¾å°ç¸åçè¿åå¼, ä½æ¯ä¸ä¼å¾å° console.log è¾åº, å ä¸º require ä¸ä¼å¨åä¸ä¸ªèæ¬ä¸­è¿è¡ä¸¤æ¬¡../å¨./index ä¸­å¾éè¦, å ä¸ºä»åè¯ Node è¿ä¸ªè·¯å¾æ¯å½åæä»¶å¤¹çç¸å¯¹è·¯å¾. å¦ææä»¬ä¸æ¾ç¤ºç»åºç»å¯¹è·¯å¾æç¸å¯¹è·¯å¾, èæ¯ç´æ¥ç» index, Node ä¼å¨ä¸ç³»åæä»¶å¤¹ä¸­å¯»æ¾å¹éçæ¨¡å.åé¡¾ä¸ä¸, å¨ package.json æä»¶å¤¹ä¸­, &apos;main&apos;:&apos;index.js&apos; çä½ç¨æ¯ä»ä¹?å½ä½  require ä¸ä¸ªåå«æå main èæ¬(&apos;main&apos;:&apos;index.js&apos;)ç package.json æä»¶çæä»¶å¤¹æ¶, Node ä¼è®¤ä¸ºä½ æ¯å¨ require è¿ä¸ªèæ¬(&apos;index.js&apos;), æä»¥åé¢çä»£ç å¯ä»¥ç®åä¸º&lt;pre&gt;`require(./)`&lt;/pre&gt;ç°å¨æä»¬å¯ä»¥ä½¿ç¨ package.json æ¥å®æä¸é¢çå·¥ä½, å ä¸ºæä»¬çèæ¬å½åä¸º index.js, ä»æ¯ä¸ä¸ªæä»¶å¤¹çé»è®¤èæ¬### ç¬¬ä¸ä¸ªä¾èµæ¨¡åä½¿ç¨ä¸é¢çå½ä»¤æ¥å¿«éæç´¢ npm registry`$npm search color`å¦ææ³è¦è·å¾æ´å¤çä¿¡æ¯, å¯ä»¥è·³è½¬å° npmjs.org, å¨&quot;æå¤ä¾èµ&quot;çåè¡¨ä¸­å¯ä»¥æ¥çæµè¡çåºå®è£ä¾èµæ¨¡å`$npm install --save colors`è¿æ¡æä»¤ä¼å¨æ¬å°æä»¶å¤¹ä¸­åå»ºä¸ä¸ªåä¸º node_modules çæä»¶å¤¹å¹¶å° colors ä¸è½½å°å¶ä¸­. `--save`å°ä¾èµæ¨¡åèªå¨å å¥å° package.json æä»¶ä¸­.&lt;pre&gt;`&quot;dependencies&quot;{  &quot;colors&quot;:&quot;~0.6.0-1&quot;}`&lt;/pre&gt;ç°å¨æä»¬æ¥éå index.js æ¥ä½¿ç¨æä»¬çæ°åº. colors æ©å±äº String çååå æ­¤æä»¬å¯ä»¥éå¸¸ç®æ´çè¡¨è¾¾å¸¦æé¢è²çææ¬:&lt;pre&gt;`var colors = require(&apos;colors&apos;);console.log(&apos;Hello, &apos;.red,&apos;npm&apos;.green);</code></pre><p>è¿è¡ index.js æä»¶, ä½ å°å¨åæ¥çè¾åºä¸­è·å¾ä¸ä¸ªå½©è²å­ç¬¦ä¸²</p><h3 id="node-modules-çå±çº§"><a href="#node-modules-çå±çº§" class="headerlink" title="node_modules çå±çº§"></a>node_modules çå±çº§</h3><p>å½ä¸æ¾ç¤ºæå®ç¸å¯¹è·¯å¾æç»å¯¹è·¯å¾æ¶, Node é¦åæ¥æ¾æ¬å°ç ndoe_modules æä»¶å¤¹, å½ä½ ä½¿ç¨ npm install æä»¤çæ¶åè¿ä¸ªæä»¶å¤¹è¢«èªå¨åå»º. å½ Node åç° node_modules ä¸æä¸ä¸ªå«å colors å­ç®å½æ¶, Node å°ä»å½å require çç®æ .<br><strong>æ¥ç node_modules/colors/package.json, å¯ä»¥æ¾å°âmainâ:âcolorsâ , å æ­¤ require colorsè¿ä¸ªæä»¶å¤¹æ¶ Node ä¼è®¤ä¸º require äº colors.js è¿ä¸ªèæ¬</strong><br>ç¶åä» require å½æ°ä¸­è¿åèæ¬ä¸­ç exports å¯¹è±¡.<br>å¦ææ¾ä¸å° colors ç®å½, åä¼ä¸ç´æç´¢å°ç³»ç»çæ ¹ç®å½.</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
          <category> workNote </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NPM </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Display:table-Cell</title>
      <link href="/2016/07/20/displaytable-cell/"/>
      <content type="html"><![CDATA[<h3 id="display-table-cell-å±æ§ç®è¿°"><a href="#display-table-cell-å±æ§ç®è¿°" class="headerlink" title="display:table-cell å±æ§ç®è¿°"></a>display:table-cell å±æ§ç®è¿°</h3><p><code>display:table-cell</code> å±æ§è®©æ ç­¾åç´ é¥ä¸è¡¨æ ¼ååæ ¼çå½¢å¼åç°, ç±»ä¼¼äº td æ ç­¾.<br><code>table-cell</code>ä¸<code>float</code>, <code>position:absolute</code> ä¸å¼å®¹.<br><code>table-cell</code>åç´ å¯ä»¥è®¾ç½® width, height, padding, ä½æ¯ä¸è½è®¾ç½® margin, å td æ ç­¾ä¸è´.</p><h3 id="display-table-cell-ä¸å¤§å°ä¸åºå®åç´ çåç´å±ä¸­"><a href="#display-table-cell-ä¸å¤§å°ä¸åºå®åç´ çåç´å±ä¸­" class="headerlink" title="display:table-cell ä¸å¤§å°ä¸åºå®åç´ çåç´å±ä¸­"></a>display:table-cell ä¸å¤§å°ä¸åºå®åç´ çåç´å±ä¸­</h3><h3 id="display-table-cell-ä¸ä¸¤æ èªéåºå¸å±"><a href="#display-table-cell-ä¸ä¸¤æ èªéåºå¸å±" class="headerlink" title="display:table-cell ä¸ä¸¤æ èªéåºå¸å±"></a>display:table-cell ä¸ä¸¤æ èªéåºå¸å±</h3><h3 id="display-table-cell-ç­é«å¸å±"><a href="#display-table-cell-ç­é«å¸å±" class="headerlink" title="display:table-cell ç­é«å¸å±"></a>display:table-cell ç­é«å¸å±</h3><p>table è¡¨æ ¼ä¸­çååæ ¼æå¤§çç¹ç¹ä¹ä¸å°±æ¯åä¸è¡åè¡¨åç´ é½æ¯ç»é«ç, æä»¥ç­é«å¸å±å¯ä»¥åå© table-cell å®ç°.<br><strong>å¿åè¡¨æ ¼åç´ åå»ºè§å</strong>:CSS2ä¸­åå»ºè¡¨æ ¼åç´ , å¶ä¾èµåç´ (æ¯å¦ tr ä¹äº td, table ä¹äº tr) ä¼è¢«æ¨¡æåºæ¥, ä»èä½¿å¾è¡¨æ ¼æ¨¡åè½å¤æ­£å¸¸å·¥ä½. ææçè¡¨æ ¼åç´ é½ä¼èªå¨å¨èªèº«å¨å´çæéè¦çå¿å table å¯¹è±¡, ä½¿å¶ç¬¦å table/inline-table, table-row, table-cell çä¸å±åµå¥å³ç³».<br>è¦å®ç°ç­é«å¸å±, ææç table-cell åç´ ä¸å®è¦çä¸ä¸ªç¨æ¥åè£¹çæ ç­¾, CSS ä»£ç å¦ä¸:<br><code>`</code><br>.list_row{display:table-row}<br>.list_cell{display:table-cell;width:30%,padding:1.6%; background-color:#F5F5F5;}<br>.list_center{background-color:#F0F3F9;}//ç¨äºåæè¾¹ç cell åºå</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
          <category> workNote </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS3 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>JavaScript çé­å</title>
      <link href="/2016/07/19/javascript-e7-9a-84-e9-97-ad-e5-8c-85/"/>
      <content type="html"><![CDATA[<p>éå¸¸æåµä¸, æ±åå½æ°çå®ä¹æ¯è¿æ ·ç</p><pre><code>function sum(arr){  return arr.reduce(function(x,y){    return x+y;  });}sum([1,2,3,4,5]); //15`&lt;/pre&gt;ä½æ¯, å¦æä¸éè¦ç«å»æ±å, èæ¯å¨åé¢çä»£ç ä¸­æ ¹æ®éè¦è¿è¡è®¡ç®, å¯ä»¥éæ©è¿åä¸ä¸ªä¿å­äºåæ°çæ±åå½æ°&lt;pre&gt;`function lazy_sum(arr){  var sum = function(){    return arr.reduce(function(x,y){      return x+y;    });  }  return sum;}`&lt;/pre&gt;å½æä»¬è°ç¨`f = lazy_sum()`æ¶ä¼è¿åä¿å­äºåæ° arr ç sum å½æ°, ç´å°éè¿ f()è°ç¨ sum å½æ°åé½ä¸ä¼è¿è¡æ±åè¿ç®, å¯ä»¥èçº¦èµæº.**éè¦æ³¨æçä¸ç¹**æ¯æ¯ä¸æ¬¡è°ç¨ lazy_sum() é½ä¼è¿åä¸ä¸ªæ°çå½æ°, å½¼æ­¤ç¸äºç¬ç«, åèªå ç¨åå­ç©ºé´åæ¶è¦æ³¨æ, å°½ç®¡æ¯æ¬¡çæå¹¶è¿åçé½æ¯æ°ç sum å½æ°, ä½æ¯ lazy_sum() çå±é¨åéæ¯éç¨ç, å¯åè**ç±»æ¹æ³**ä¸**å®ä¾**çå³ç³», è¿æ¯ä½¿ç¨é­åçç®çä¹ä¸**æ´è¦æ³¨æ**:&lt;pre&gt;`function count(){  var arr = [];  for(var i = 1; i&amp;lt;=3; i++){    arr.push(function(){        return i*i;      });  }  return arr;}var results = count();var f1 = results[0];var f2 = results[1];var f3 = results[2];</code></pre><p>å¨è¿ä¸ªä¾å­ä¸­, f1(), f2(), f3()çè¿åå¼é½æ¯16, åå å¨äº:<br>æ¯ä¸æ¬¡å¾ªç¯é½å arr æ¨å¥ä¸ä¸ª(function(){})(i), ä½é½æ²¡æè®¡ç®, ä¸æ¬¡å¾ªç¯å i åæäº4, æä»¥f1, f2, f3çå½æ°æ¥åçå±é¨åéçå¼é½æ¯4.<br>ç±æ­¤å¯ç¥é­åä¿ççæ¯åé, èä¸æ¯åéçå¼.<br>å¦æä¸å®è¦å¼ç¨å¾ªç¯åé, è®°å¾åå»ºä¸ä¸ªåéç¨äºä¿å­ç°åº</p><p><strong>é­åå¯ä»¥ç¨äºå®ç°è£é¥°å¨</strong></p>]]></content>
      
      <categories>
          
          <category> note </category>
          
          <category> workNote </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javascript </tag>
            
            <tag> Closure </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>åç«¯å·¥ä½æµ</title>
      <link href="/2016/07/19/e5-89-8d-e7-ab-af-e5-b7-a5-e4-bd-9c-e6-b5-81/"/>
      <content type="html"><![CDATA[<p>ä¸»è¦æä½åå«:</p><p>CSS åç¼è¡¥å¨, LESS/SASS ç¼è¯, CSS åç¼©, JS åå¹¶åç¼© ,å¾çåç¼©, é¨ç½²åå¸</p><h3 id="æµç¨åè§£"><a href="#æµç¨åè§£" class="headerlink" title="æµç¨åè§£"></a>æµç¨åè§£</h3><p>ä¸»è¦åä¸º</p><p>å¼åè¿ç¨</p><p>å</p><p>é¨ç½²è¿ç¨</p><h4 id="å¼åè¿ç¨"><a href="#å¼åè¿ç¨" class="headerlink" title="å¼åè¿ç¨"></a>å¼åè¿ç¨</h4><p>è¦æ±æ¯ä¸æ¬¡ç¼è¾é½è½å¨é¡µé¢ä¸å³æ¶ç¸åº</p><h4 id="é¨ç½²è¿ç¨"><a href="#é¨ç½²è¿ç¨" class="headerlink" title="é¨ç½²è¿ç¨"></a>é¨ç½²è¿ç¨</h4><ul><li>CSS Autoprefixer</li><li>Less/Sass =&gt; CSS</li><li>CSS åç¼©åå¹¶</li><li>CSS Sprite</li><li>Retina @2x &amp; @3x èªå¨çæéé</li><li>imagemin å¾çåç¼©</li><li>JS åå¹¶åç¼©</li></ul><h3 id="é¡¹ç®ç®å½ç»æ"><a href="#é¡¹ç®ç®å½ç»æ" class="headerlink" title="é¡¹ç®ç®å½ç»æ"></a>é¡¹ç®ç®å½ç»æ</h3><p>project                  //é¡¹ç®ç®å½<br>|<strong><strong>dev                 //å¼åç®å½<br>| |</strong></strong>html<br>| |<strong><strong>images<br>| |</strong></strong>scripts<br>| |<strong><strong>slice             //åæçéªç¢§å¾<br>| |</strong></strong>styles<br>|<strong><strong>dist                //çäº§ç®å½<br>| |</strong></strong>html<br>| |<strong><strong>images<br>| |</strong></strong>scripts<br>| |<strong><strong>sprite            //ä»ä» src å¤å¶<br>| |</strong></strong>styles<br>|<strong><strong>gulpfile.js<br>|</strong></strong>src                 //æºæä»¶ç®å½<br>| |<strong><strong>html<br>| |</strong></strong>images<br>| |<strong><strong>scripts<br>| |</strong></strong>slice             //éªç¢§å¾ç´ æ<br>| |____styles</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
          <category> workNote </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Gulp </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Mac OS ä¸ å®ç° Tree æä»¤</title>
      <link href="/2016/07/19/macos-e4-b8-8b-e5-ae-9e-e7-8e-b0tree-e6-8c-87-e4-bb-a4/"/>
      <content type="html"><![CDATA[<p>åå®è£ zsh<br>è¿å¥<code>~/.zshrc</code>, æ·»å <br><code>alias tree=&quot;find . -print | sed -e &#39;s;[^/]*/;|____;g;s;____|; |;g&#39;&quot;</code><br>åå°ç®å½, æ§è¡<br><code>source .zshrc</code> ä»¤ä¿®æ¹ç«å³çæ<br>å¯ä»¥ä½¿ç¨<code>tree</code>æä»¤çæææ¡£æ </p>]]></content>
      
      <categories>
          
          <category> note </category>
          
          <category> workNote </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Bash </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>RegExp in JS</title>
      <link href="/2016/07/19/regexp-in-js/"/>
      <content type="html"><![CDATA[<h3 id="Literal"><a href="#Literal" class="headerlink" title="Literal"></a>Literal</h3><p><code>/patter/attributes</code></p><h3 id="new-RegExp"><a href="#new-RegExp" class="headerlink" title="new RegExp"></a>new RegExp</h3><p><code>new RegExp(pattern, attribtues)</code></p><h3 id="pattern"><a href="#pattern" class="headerlink" title="pattern"></a>pattern</h3><h3 id="RegExp-Attribtues"><a href="#RegExp-Attribtues" class="headerlink" title="RegExp Attribtues"></a>RegExp Attribtues</h3><ul><li>g: global</li><li>i: ignoreCase</li><li>m: multi-lines</li><li>source: literal text</li><li>lastIndex: mark the index where to start next match</li></ul><h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><pre><code>var re = new RegExp(&apos;^[0-9]+$&apos;,&apos;g&apos;);console.log(re.source); //^[0-9]+$`&lt;/pre&gt;&lt;pre&gt;`var re = new RegExp(&apos;\\d{3}&apos;,&apos;g&apos;);var str = &apos;123a456b&apos;;console.log(re.lastIndex); // 0re.exec(str); //return [&apos;123&apos;]console.log(re.lastIndex); // 3re.exec(str); // [&apos;456&apos;]console.log(re.lastIndex); //7re.exec(str);console.log(re.lastIndex) // 0, reset to 0 if exceed.re.lastIndex = 3; //Set Start Indexre.exec(str); // [&apos;456&apos;]</code></pre><h3 id="RegExp-Methods"><a href="#RegExp-Methods" class="headerlink" title="RegExp Methods"></a>RegExp Methods</h3><p>re.compile(re) //execute RegExp in scripts<br>re.exec(str) //return an Array including String, or null.<br>re.test(str) =&gt; true/false</p><h3 id="String-Methods"><a href="#String-Methods" class="headerlink" title="String Methods"></a>String Methods</h3><p>str.search(re,subStr)<br>str.match(re) =&gt; Array including String<br>str.replace(re,str) =&gt; new String<br>str.split(re)</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
          <category> workNote </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javascript </tag>
            
            <tag> RegExp </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Shell æä»¤</title>
      <link href="/2016/07/19/shell-e6-8c-87-e4-bb-a4/"/>
      <content type="html"><![CDATA[<p>Shell å¨è®¡ç®æºç§å­¦ä¸­æ¯æâæä¾ç¨æ·ä½¿ç¨çé¢âçè½¯ä»¶, éå¸¸æçæ¯å½ä»¤è¡çé¢çè§£æå¨, ä¸è¬æ¥è¯´, è¿ä¸ªè¯æçæ¯æä½ç³»ç»ä¸­æä¾è®¿é®åæ ¸ææä¾æå¡çç¨åº. Shell ä¹ç¨äºæ³æä¸ºææç¨æ·æä¾æä½çé¢çç¨åº, ä¹å°±æ¯ç¨åºåç¨æ·äº¤äºçå±é¢. å æ­¤ä¸ä¹ç¸å¯¹çæ¯ç¨åºåæ ¸(Core), åæ ¸ä¸æä¾åç¨æ·çäº¤äºåè½.</p><h3 id="bash-Bourne-Again-Shell-æ¯-Linux-æ åçé»è®¤-shell-æ¯æ-POSIX-æ å-å®å¨å¼å®¹-sh"><a href="#bash-Bourne-Again-Shell-æ¯-Linux-æ åçé»è®¤-shell-æ¯æ-POSIX-æ å-å®å¨å¼å®¹-sh" class="headerlink" title="bash (Bourne Again Shell) æ¯ Linux æ åçé»è®¤ shell, æ¯æ POSIX æ å, å®å¨å¼å®¹ sh."></a>bash (Bourne Again Shell) æ¯ Linux æ åçé»è®¤ shell, æ¯æ POSIX æ å, å®å¨å¼å®¹ sh.</h3><p>è¿å¥ shell: ä¸è¬ Linux ç³»ç»ä¸­, æ¡é¢(GUI)ç¶æä¸ä½¿ç¨å¿«æ·é® Ctrl+Alt+T è½æå¼ä¸ä¸ªèæç»ç«¯, è¾å¥ shell å½ä»¤å¹¶æ§è¡.<br>éåº shell: å¨ shell ä¸­è¾å¥ exit ç¶ååè½¦<br>é»è®¤æç¤ºç¬¦: æ®éç¨æ·$, æ ¹ç¨æ·#<br>æ¥ç shell çæ¬: <code>echo $SHELL</code><br>æ¥çå½ä»¤çè¾å©ä¿¡æ¯:<br><code>--help</code>, <code>--version</code></p><h3 id="ç®å½æä»¶æä»¤"><a href="#ç®å½æä»¶æä»¤" class="headerlink" title="ç®å½æä»¶æä»¤"></a>ç®å½æä»¶æä»¤</h3><p>pwd: æ¥çå½åç®å½<br>echo $HOME æè echo ~: æ¥çä¸»ç®å½</p><p>ls: ååºæä»¶æç®å½ä¸çæä»¶å</p><ul><li>-a(all): æ¾ç¤ºæææä»¶, åæ¬éèæä»¶</li><li>-l(long): æ¾ç¤ºè¯¦ç»ä¿¡æ¯(long è¡¨ç¤ºé¿æ ¼å¼æ¾ç¤º)</li><li>-d(detail): æ¾ç¤ºç®å½å±æ§</li><li>-h(human): äººæ§åæ¾ç¤ºæä»¶å¤§å°</li><li>-i(inode): æ¾ç¤º inode</li><li>-ll(ls -l): æ¾ç¤ºç®å½ä¸æä»¶çé¿ä¿¡æ¯</li></ul><p>cd: æ¹åç®å½</p><ul><li>~ è¿å¥å½åç¨æ·çæ ¹ç®å½</li><li>åä¸</li><li>-è¿å¥ä¸æ¬¡ç®å½</li><li>.. è¿å¥ä¸ä¸çº§ç®å½</li><li>. è¿å¥å½åç®å½</li></ul><p>mkdir: åå»ºç®å½(æä»¶å¤¹)</p><ul><li>-p éå½åå»º<br>e.g. mkdir b/a =&gt;fail, mkdirä¸è½åå»ºå¤çº§ç®å½<br>mkdir -p b/a åæ¶åå»º b å a</li></ul><p>rmdir: å é¤ç©ºç®å½</p><p>rm: å é¤ç®å½åæä»¶</p><ul><li>-rå¼ºå¶å é¤ç®å½</li><li>-få¼ºå¶</li><li>ä¸è¬ç¨ rm -rf ..</li></ul><p>touch: ä¿®æ¹æä»¶æ¶é´æèåå»ºæä»¶</p><p>chmod: è®¾ç½®ç®å½ææä»¶çè®¿é®æé</p><ul><li>chmod[éé¡¹][æä½å¯¹è±¡][æä½ç¬¦][æé][æä»¶å]</li><li>æä½ç¬¦å·<ul><li><ul><li>æ·»å æä¸ªæé</li></ul></li><li>-åæ¶æä¸ªæé</li><li>=èµäºç»å®æéå¹¶åæ¶å¶ä»æé</li></ul></li><li>æ°å­è®¾å®æ³<ul><li>chmod abc æä»¶å</li><li>å¶ä¸­ abc åä¸ºä¸ä¸ªæ°å­, åå«è¡¨ç¤º user, group, other çæé</li><li>rä¸º4, wä¸º2, xä¸º1, -ä¸º0(äºè¿å¶ä½)</li><li>rwx = 7; rw- = 6; r-x = 5</li></ul></li><li>è®¿é®æéç»(æ¯ä¸ä¸ªæä»¶æç®å½çè®¿é®æéé½æä¸ç»)<br>å¨ Linux ä¸­æ¯æç§ç¨æ·åç»æ¥è®¾å®æéç<ul><li>ææèæé: å°±æ¯æä»¶æèç®å½çåå»ºè, ä¸è¬æ¥è¯´å root ç¨æ·æéç¸å½. æä»¶è¢«åå»ºæ¶, æä»¶ææèèªå¨æ¥æå¯¹è¯¥æä»¶çè¯»ååå¯æ§è¡æé.</li><li>åç»æé: å°±æ¯ææèæå¨çç¨æ·ç»çå¶ä»æåçæé</li><li>å¶ä»ç¨æ·æé</li></ul></li><li>è®¿é®æé(è¯»å, åå¥, æ§è¡)<ul><li>r: è¯»åæä»¶åå®¹çæé, æèæµè§ç®å½çæé</li><li>w: æ°å¢,ä¿®æ¹æä»¶åå®¹çæé, æèå é¤, ç§»å¨ç®å½åæä»¶çæé</li><li>x: æ§è¡æä»¶çæé, æèè¿å¥ç®å½çæé</li></ul></li><li>ç¨ -ll ä¹å°±æ¯ -ls læ¾ç¤ºæä»¶æç®å½çè¯¦ç»ä¿¡æ¯, æå·¦çä¸åä¸ºæä»¶çè®¿é®æé, ä¾å¦:<br><code>-rw-r--r-- 1 root root 483997 Jul 15 18:31 sobsrc.tgz</code><br>è¿éæ10ä¸ªä½ç½®, ç¬¬ä¸ä¸ªå¶å®æä»¶çç±»å, éå¸¸æä¹ä¸, ä¸ä¸ªç®å½ä¹æ¯ä¸ä¸ªæä»¶, å¦æç¬¬ä¸ä¸ªå­ç¬¦æ¯-, è¡¨ç¤ºæ¯ä¸ä¸ªéç®å½æä»¶, å¦ææ¯ d, è¡¨ç¤ºæ¯ä¸ä¸ªç®å½</li></ul><table><br><thead><br><tr><br>  <th>-</th><br>  <th>rw-</th><br>  <th>râ</th><br>  <th>râ</th><br></tr><br></thead><br><tbody><br><tr><br>  <td>éç®å½çæä»¶</td><br>  <td>ææèæé</td><br>  <td>ç»ç¨æ·</td><br>  <td>å¶ä»ç¨æ·</td><br></tr><br><tr><br>  <td>æ®éæä»¶</td><br>  <td>å¯è¯»å</td><br>  <td>åªè¯»</td><br>  <td>åªè¯»</td><br></tr><br></tbody><br></table><p>chown: æ¹åç®å½çææè<br>cp: å¤å¶ç®å½ææä»¶</p><ul><li>-r å¤å¶ç®å½</li><li>-p è¿å¸¦æä»¶å±æ§å¤å¶</li><li>-d è¥æºæä»¶æ¯é¾æ¥æä»¶, åå¤å¶é¾æ¥å±æ§</li><li>-a ç¸å½äº -pdr</li><li>cp[ç°è±¡][åæä»¶æç®å½][ç®æ ç®å½]</li></ul><p>mv: åªåææ¹å(move)</p><ul><li>mv a ../a å°å½åç®å½ä¸ç a å¤å¶åªåå°ä¸ä¸çº§ç a ç®å½ä¸­</li><li>mv abc.txt de.txt å¦æåæä»¶åç®æ æä»¶å¨åä¸ç®å½ä¸, åä¸ºæ¹å, å¦åæ¯åªå</li></ul><h3 id="æä»¶åå®¹å½ä»¤"><a href="#æä»¶åå®¹å½ä»¤" class="headerlink" title="æä»¶åå®¹å½ä»¤"></a>æä»¶åå®¹å½ä»¤</h3><p>diff: æ¯è¾ä¸¤ä¸ªæä»¶çå·®å¼<br>patch: ä¿®è¡¥æä»¶(ç»æä»¶æè¡¥ä¸)<br>cat: è¾åºæä»¶åå®¹<br>more: éå±æ¾ç¤ºæä»¶åå®¹<br>less: éé¡µæ¾ç¤ºæä»¶åå®¹<br>head: æ¾ç¤ºæä»¶å¼å¤´è¥å¹²è¡åå®¹<br>tail: æ¾ç¤ºæä»¶æåè¥å¹²è¡åå®¹<br>od: æ¥çç¹æ®æ ¼å¼çæä»¶åå®¹</p><h3 id="å¸¸è§ç®å½"><a href="#å¸¸è§ç®å½" class="headerlink" title="å¸¸è§ç®å½"></a>å¸¸è§ç®å½</h3><p>/ æ ¹ç®å½<br>/bin å­æ¾å¿è¦çå½ä»¤<br>/boot å­æ¾åæ ¸ä»¥åå¯å¨æéè¦çæä»¶<br>/dev å­æ¾è®¾å¤æä»¶<br>/etc å­æ¾ç³»ç»çéç½®æä»¶<br>/home ç¨æ·æä»¶çä¸»ç®å½<br>/lib å­æ¾å¿è¦çè¿è¡åº<br>/mnt å­æ¾ä¸´æ¶çæ å°æä»¶ç³»ç»<br>/proc å­æ¾å­å¨è¿ç¨åç³»ç»ä¿¡æ¯<br>/root è¶çº§ç¨æ·çä¸»ç®å½<br>/sbin å­æ¾ç³»ç»ç®¡çç¨åº<br>/tmp å­æ¾ä¸´æ¶æä»¶<br>/usr åå«äºä¸è¬ä¸éè¦ä¿®æ¹çåºç¨ç¨åº, å½ä»¤ç¨åºæä»¶, ç¨åºåº,æåç­<br>/usr/bin ç³»ç»å½ä»¤(æ®éç¨æ· home)<br>/usr/sbin ç³»ç»å½ä»¤(è¶çº§ç¨æ· root)<br>/var åå«ç³»ç»äº§ççç»å¸¸ååçæä»¶</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
          <category> workNote </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Bash </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Mac OS ä¸åç«¯å¼åç¯å¢éç½®</title>
      <link href="/2016/07/19/mac-os-e4-b8-8b-e5-89-8d-e7-ab-af-e5-bc-80-e5-8f-91-e7-8e-af-e5-a2-83-e9-85-8d-e7-bd-ae/"/>
      <content type="html"><![CDATA[<h3 id="å®è£-homebrew"><a href="#å®è£-homebrew" class="headerlink" title="å®è£ homebrew"></a>å®è£ homebrew</h3><p>ç»ç«¯ä¸æ§è¡<br><code>ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;</code></p><h3 id="éç½®-iterm2"><a href="#éç½®-iterm2" class="headerlink" title="éç½® iterm2"></a>éç½® iterm2</h3><p>ä¸è½½åä¸è½½éè² solarized, ç¶åä¸è½½ zsh å oh-my-zsh, æ·»å æä»¶ git, osx, ruby, autojump</p><h3 id="å®è£-Nginx"><a href="#å®è£-Nginx" class="headerlink" title="å®è£ Nginx"></a>å®è£ Nginx</h3><p>ç»ç«¯ä¸æ§è¡<br><code>brew install nginx</code><br>å®è£å®æåç¨æµè§å¨æå¡ <a href="http://localhost:8080" target="_blank" rel="noopener">http://localhost:8080</a>, å¦æé¡µé¢æ¾ç¤ºæ­£å¸¸,åè¡¨ç¤ºå®è£å®æ<br>nginx æä¸ä¸å ä¸ªæä½</p><pre><code>  #æå¼ nginx  nginx  #nginx -s éæ°å è½½éç½®|éå¯|åæ­¢|éåº  nginx -s reload|reopen|stop|quit  #æµè¯éç½®æ¯å¦æè¯­æ³éè¯¯  nginx -t`&lt;/pre&gt;Note: å¦ææ§è¡ä¸æå, è¯·ä½¿ç¨ sudo ææé»è®¤è®¿é®ç®å½æ¯`/usr/local/Cellar/nginx/1.10.0/html`nginx çéç½®æä»¶ä½ç½®ä¸º:`/usr/local/etc/nginx/nginx.conf`#### éç½® nginxé¦åå¤ä»½ä¸ä¸ nginx.conf ==&gt; nginx.conf.defaultä¿®æ¹server é¨åä¸º:&lt;pre&gt;`server  {    listen    8080;    server_name localhost;    location /{      root /Users/YourId/Documents; //é¡¹ç®ç®å½      #index index.html index.htm;    }  }`&lt;/pre&gt;éç½®å®æåå¯å¨ nginx å³å¯è®¿é®### å®è£ mySQLç»ç«¯æ§è¡`brew install mysql` å®è£å®æåé»è®¤æ²¡æå¯ç , ä¿®æ¹å¯ç  ``` mysql -uroot -p Enter password: mysql&gt;use mysql; mysql&gt; UPDATE user SET password=password(&quot;ä¿®æ¹çå¯ç &quot;) WHERE user=&apos;root&apos;;mysql çæä½å½ä»¤&lt;pre&gt;`  #å¼å¯  mysql.server start  #ç»æ  mysql.server stop</code></pre><p>éç½®æä»¶ä½äº<br><code>/usr/local/Cellar/mysql/5.6.28/my.cnf</code></p>]]></content>
      
      <categories>
          
          <category> note </category>
          
          <category> workNote </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HTML5 </tag>
            
            <tag> MySQL </tag>
            
            <tag> Nginx </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Component Children</title>
      <link href="/2016/07/18/component-children/"/>
      <content type="html"><![CDATA[<p><code>this.props.children</code></p><p>Children allow you to pass components as data to other components, just like any other prop you use. The special thing about children is that React provides support through its <em>ReactElement API</em> and JSX. XML children translate perfectly to React children.</p><pre><code>var MyDiv = React.createClass({  render: function(){      return &amp;lt;div&amp;gt;{this.props.children}&amp;lt;/div&amp;gt;}});ReactDOM.render(  &amp;lt;MyDiv&amp;gt;      &amp;lt;span&amp;gt;Hello&amp;lt;/span&amp;gt;      &amp;lt;span&amp;gt;World&amp;lt;/span&amp;gt;  &amp;lt;/MyDiv&amp;gt;,  node  );`&lt;/pre&gt;### this.props.childrenIf you look at the **JSX** transform, you&apos;ll find that XML children are appended as arguments to the _React.createElement_ call. Most often, your component will render content and include the children in the _render_ output. This is a great way to create UI components, like cards, headers, and buttons.Occasionally, you may want to interact with the children, maybe mutating or separating them. Be careful here and remember to treat **this.props.children** as an **opaque data structure**. Instead of working with **this.props.children** directly, use the **React.Children** utilities to work with children.&lt;pre&gt;`var ListComponent = React.createClasss({  render: function(){      var children = React.Children.map(        this.props.children,        function(child){            return &amp;lt;li&amp;gt;{child}&amp;lt;li&amp;gt;        }    );    return &amp;lt;ul&amp;gt;{children}&amp;lt;/ul&amp;gt;;  }  });  var middleChildren = [  &amp;lt;strong key=&apos;2&apos;&amp;gt;Child 2&amp;lt;/strong&amp;gt;,  &amp;lt;a href=&apos;#&apos; key=&apos;3&apos;&amp;gt;Child 3&amp;lt;/a&amp;gt;  ];  ReactDOM.render(  &amp;lt;ListComponent&amp;gt;    &amp;lt;span&amp;gt;Child 1&amp;lt;/span&amp;gt;    {middleChildren}    &amp;lt;em&amp;gt;Child 4&amp;lt;/em&amp;gt;  &amp;lt;/ListComponent&amp;gt;,  document.body);</code></pre>]]></content>
      
      <categories>
          
          <category> note </category>
          
          <category> workNote </category>
          
      </categories>
      
      
        <tags>
            
            <tag> React </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Node</title>
      <link href="/2016/07/18/node/"/>
      <content type="html"><![CDATA[<p>A <strong>Node</strong> is an interface from which a number of DOM types, and allows these various types to be treated similarly.</p><h3 id="Properties"><a href="#Properties" class="headerlink" title="Properties"></a>Properties</h3><ul><li>Node.baseURI: return a DOMStirng representing the base URL</li><li>Node.childNodes: return a live NodeList containing all the children of this node. NodeList being live means that if the children of the Node change, the NodeList will update automatically.</li><li>Node.firstChild: return a Node representing the first direct child Node of this Node, or Null if the node has no child.</li><li>Node.lastChild: Return a Node representing the last direct child Node of this Node, or Null if the node has no child.</li><li>Node.nextSibling: return a Node representing the next Node in the tree, or null if there is no one.</li><li>Node.previousSibling</li><li>Node.nodeName: return a DOMString containing the name of the node. The structure of the name will differ with the name type. E.g. An HTMLElement will contain the name of the corresponding tag, like âaudioâ, for an HTMLAudioElement, a Text node will have the â#textâ string, or a Document node will have the â#documentâ string.</li><li>Node.nodeType: return an unsigned short representing the type of the node. Possible values are:</li></ul><table><br><thead><br><tr><br>  <th align="left">Name</th><br>  <th align="left">Value</th><br></tr><br></thead><br><tbody><br><tr><br>  <td align="left">Element_Node</td><br>  <td align="left">1</td><br></tr><br><tr><br>  <td align="left">Attribute_Node</td><br>  <td align="left">2</td><br></tr><br><tr><br>  <td align="left">Text_Node</td><br>  <td align="left">3</td><br></tr><br><tr><br>  <td align="left">â¦</td><br>  <td align="left">â¦</td><br></tr><br><tr><br>  <td align="left">Document_Node</td><br>  <td align="left">9</td><br></tr><br><tr><br>  <td align="left">Document_Type_Node</td><br>  <td align="left">10</td><br></tr><br><tr><br>  <td align="left">Notation_Node</td><br>  <td align="left">12</td><br></tr><br></tbody><br></table><ul><li>Node.nodeValue: return a DOMString representing the value of an object. For most node types, this returns <strong>null</strong>, and any set operation is ignored.<br>For Nodes of type TEXT_NODE(Text objects), COMMENT_NODE(Comment objects), and PROGRESSING_INSTRUCTION_NODE(ProgressingInstruction objects), the value corresponds to the text data contained in the obejct.</li><li>Node.parentNode: return a Node that is the parent of this node, if there is no such node, like if this node is the top of the tree or if doesnât participate in a tree, this property returns <strong>Null</strong>.</li><li>Node.parentElement: returns an Element that is the parent of this node. If the node has no parent, or if that parent is not an Element, this property returns <strong>Null</strong>.</li><li>Node.rootNode: return a Node representing the topmost Node in this tree or the current node if itâs the topmost node in the tree.</li><li>Node.textContent: is a DOMString representing the textual content of an element and all its descendants.</li></ul><h3 id="Methods"><a href="#Methods" class="headerlink" title="Methods"></a>Methods</h3><ul><li>Node.appendChild()</li><li>Node.cloneNode(): Clone a Node and optionally all of its contents. By default, it clones the content of the node.</li><li>Node.hasChildNodes(): return a <strong>boolean</strong> indicating if the element has any child nodes, or not.</li><li>Node.insertBefore(newNode, beforeItsChild)</li><li>Node.isEqualNode(): return a <strong>boolean</strong> which indicating whether or not two nodes are of the <strong>same type</strong> and all their defining data points match.</li><li>Node.isSameNode(): return a <strong>boolean</strong> value indicating whether or not the two nodes are the same(that is they reference the same object).</li><li>Node.removeChild()</li><li><p>Node.replace(newNode, replaceItsChild)</p><pre><code>*   Note: replaceNode will not generate new one.&lt;/p&gt;</code></pre><ul><li><p>E.g.</p><p><code>ul&amp;gt;li*3</code></p><p><code>ul.replace(li[2],li[0])</code></p><p>it will act as:<br>remove li[2], put it li[0], remove li[0], so the result looks like</p><p>ul<br>âli[2]<br>âli[1]<br>`</p></li></ul><h3 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h3><h4 id="Browser-All-Child-Nodes"><a href="#Browser-All-Child-Nodes" class="headerlink" title="Browser All Child Nodes"></a>Browser All Child Nodes</h4><p></p><p>The following function recursively cycles all child nodes of a node and executes a callback function upon them(and upon the parent node itself).</p><pre>`function DOMComb(oParent, oCallBack){  if(oParent.hasChildNodes()){    for(var oNode = oParent.firstChild; oNode; oNode = oNode.nextSibling){      DOMComb(oNode, oCallBack);    }  }  oCallBack.call(oParent);}`</pre><h4 id="Remove-all-children-nested-within-a-node"><a href="#Remove-all-children-nested-within-a-node" class="headerlink" title="Remove all children nested within a node"></a>Remove all children nested within a node</h4><p><pre>`Element.prototype.removeAll = function(){<br>  while(this.firstChild){</pre></p><pre><code>this.removeAll(this.firstChild);</code></pre><p>  }<br>  return this;<br>};</p></li></ul>]]></content>
      
      <categories>
          
          <category> note </category>
          
          <category> workNote </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HTML5 </tag>
            
            <tag> DOM </tag>
            
            <tag> NODE </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>innerHTML and textContext and NodeValue</title>
      <link href="/2016/07/18/innerhtml-and-textcontext-and-nodevalue/"/>
      <content type="html"><![CDATA[<p>Summary: </p><ul><li><strong>nodeValue</strong> is a little more confusing to use, but faster than innerHTML</li><li><strong>innerHTML</strong> parses content as HTML and takes longer(output <code>text/html</code>)</li><li><strong>textContent</strong> uses straight text, does not parse HTML, and is faster(output <code>text/plain</code>)</li><li><strong>innerText</strong> takes styles into consideration. It wonât get hidden text for instance.</li></ul><h3 id="node-textContent"><a href="#node-textContent" class="headerlink" title="node.textContent"></a>node.textContent</h3><p>The <strong>Node.textContent</strong> property represents the text content of a node and it descendants.</p><h4 id="Syntax"><a href="#Syntax" class="headerlink" title="Syntax"></a>Syntax</h4><p><code>example.textContent =&quot;&amp;lt;a href=&#39;...&#39;&amp;gt;textContent&amp;lt;/a&amp;gt;&quot;</code><br>will output <code>&amp;lt;a href=&#39;...&#39;&amp;gt;textContent&amp;lt;/a&amp;gt;</code></p><h4 id="Differences-from-innerText"><a href="#Differences-from-innerText" class="headerlink" title="Differences from innerText"></a>Differences from innerText</h4><ul><li>textContent gets the content of all elements, including <script> and <style> elements, but innerText doesnât.</li><li>innerText is aware of style and will not return the text of hidden elements, whereas textContent will.</li><li>As innerText is aware of CSS styling, it will trigger a reflow, whereas textContent will not.</li></ul><h4 id="Differences-from-innerHTML"><a href="#Differences-from-innerHTML" class="headerlink" title="Differences from innerHTML"></a>Differences from innerHTML</h4><p>innerHTML returns the HTML as its name indicates. Quite often, in order to retrieve or write text within an element, people use innerHTML. textContent should be used instead (to write or retrieve text). Because the text is not parsed as HTML, itâs likely to have better performance.</p><h3 id="node-nodeValue"><a href="#node-nodeValue" class="headerlink" title="node.nodeValue"></a>node.nodeValue</h3><p>The <strong>node.nodeValue</strong> property returns or sets the value of the current node.</p><h4 id="Syntax-1"><a href="#Syntax-1" class="headerlink" title="Syntax"></a>Syntax</h4><p><code>value = node.nodeValue</code></p><p>value is a string containing the value of the current node, if any.</p></script></li></ul>]]></content>
      
      <categories>
          
          <category> note </category>
          
          <category> workNote </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HTML5 </tag>
            
            <tag> DOM </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>&lt;Script&gt; å°ç¥è¯</title>
      <link href="/2016/07/18/script-e5-b0-8f-e7-9f-a5-e8-af-86/"/>
      <content type="html"><![CDATA[<h3 id="lt-script-gt-æç§åºç°é¡ºåºè¢«æ§è¡"><a href="#lt-script-gt-æç§åºç°é¡ºåºè¢«æ§è¡" class="headerlink" title="&lt;script&gt; æç§åºç°é¡ºåºè¢«æ§è¡"></a>&lt;script&gt; æç§åºç°é¡ºåºè¢«æ§è¡</h3><ul><li>åå è½½çèæ¬å¯ä»¥ä¾èµåå è½½çèæ¬, ä½æ¯åå è½½çèæ¬å µå¡, æ´ä¸ªç½é¡µçå è½½ä¼å µå¡.</li><li>å½ä¸ä¸ªèæ¬è¢«æ§è¡æ¶, å¯ä»¥è®¿é®åé¢ç HTML åç´ , ä½ä¸è½è®¿é®åé¢çåç´ .</li><li>é¡µé¢åç´ å¨ä»ä¹åçææèæ¬é½å è½½å®ä¹åæ¯ä¸ä¼æ§è¡æ¸²æç.</li></ul><h3 id="async-å-defer"><a href="#async-å-defer" class="headerlink" title="async å defer"></a><code>async</code> å <code>defer</code></h3><p>HTML5 æ·»å äºä¸¤ä¸ªå·¥å·ç¨äºæ§å¶èæ¬çæ§è¡</p><ul><li><code>async</code> è¡¨ç¤ºâä¸ç¨é©¬ä¸æ§è¡â. å®ä¹ä¸ä¸ªé¡µé¢éè¦çåéæå½æ°å¨<code>async</code>ä¸­æ¯ä¸è¡ç, å ä¸ºä½ æ²¡æ³ç¥éä»ä¹æ¶å<code>async</code>ä»£ç ä¼æ§è¡</li><li><code>defer</code> è¡¨ç¤ºâç­å¾é¡µé¢è§£æå®æä¹åæ§è¡â, å¤§è´ç­ä»·äºæèæ¬ç»å®å°<code>window.onload</code>äºä»¶. å½è¿ä¸ªä»£ç è¢«æ§è¡, DOM ä¸­çä¸ååç´ é½å¯ä»¥è®¿é®, ä¸åäº<code>async</code>, ææå äº<code>defer</code>çèæ¬ä¼æç§ä»ä»¬åºç°å¨ HTML ä¸­çé¡ºåºæ§è¡, åªæ¯æ¨è¿å°é¡µé¢è§£æåæé¡ºåºæ§è¡.</li></ul><h3 id="type-å±æ§"><a href="#type-å±æ§" class="headerlink" title="type å±æ§"></a>type å±æ§</h3><p>è®¾å®è§£éå¨<br>è¥è¦ä¿®æ¹ type çé»è®¤å±æ§(é»è®¤ä¸º javascript), å¯ä»¥éè¿ä¸ä¸ª<meta>æ è®°å®ç°:<br><code>&amp;lt;meta http-equiv = &quot;Content-Script-Type&quot; content = &quot;text/vbscript&quot;</code></p><h3 id="integrity-å±æ§"><a href="#integrity-å±æ§" class="headerlink" title="integrity å±æ§"></a>integrity å±æ§</h3><p><code>integrity</code>å±æ§æ¯å­èµæºå®æ´æ§æ°è§èçä¸é¨å, ä»åè®¸ä½ ä¸ºèæ¬æä»¶å°åå«çåå®¹æä¾ä¸ä¸ª hash, è¿æå³çå¯ä»¥é²æ­¢å¨ä¼ è¾çæ¶ååå®¹ä¸¢å¤±æè¢«æ¶æä¿®æ¹. å°±ç®ä½¿ç¨äº SSL, è¿ä¸ªè§èä¹æ¯ææä¹ç, å ä¸ºææ¶åä½ è¦å è½½çèµæºæ¯ä½ æ æ³æ§å¶çç«å¤èµæº.<br>å¦æä½ éæ©ä½¿ç¨ä», å°±è¦å¨&lt;script&gt;æ è®°éæ·»å ä¸ä¸ª hash ç±»åä»¥å hash å¼, å°ä»ä»¬ä»¥è¿å­ç¬¦åé<br><code>&amp;lt;script src=&quot;...&quot; integrity = &quot;hash-value&quot;&amp;gt;&amp;lt;/script&amp;gt;</code></p><h3 id="document-currentScript"><a href="#document-currentScript" class="headerlink" title="document.currentScript"></a>document.currentScript</h3><p>IE ä¸æ¯æçä¸ä¸ªæ°ä¸è¥¿å« <code>document.currentScript</code>, ä»æåå½åæ­£å¨æ§è¡çèæ¬, å¦æä½ è¦ä»ä½ åµå¥ç&lt;script&gt;ä¸­æ¿ä¸äºå±æ§ç¨</p><h3 id="lt-script-gt-å-innerHTML"><a href="#lt-script-gt-å-innerHTML" class="headerlink" title="&lt;script&gt;å innerHTML"></a>&lt;script&gt;å innerHTML</h3><p>éè¿ DOM å¨ææ·»å å°é¡µé¢ä¸ç &lt;script&gt; ä¼è¢«æµè§å¨æ§è¡</p><pre><code>var myScript = document.createElement(&quot;script&quot;);myScript.textContent = &quot;alert(&apos;hello&apos;)&quot;;document.head.appendChild(myScript);</code></pre><p>ç¶è, éè¿<code>innerHTML</code>å¨ææ·»å å°å° HTML ç &lt;script&gt; åä¸ä¼è¢«æ§è¡<br><code>document.head.innerHTML += &quot;&amp;lt;script&amp;gt;alert(&#39;Hello&#39;)&amp;lt;/script&amp;gt;&quot;</code><br>Note: ä½æ¯ä»ä¼æ¾ç¤ºå¨ HTML é(å°½ç®¡ä¸ä¼æ§è¡)</p>]]></content>
      
      <categories>
          
          <category> Uncategorized </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Event</title>
      <link href="/2016/07/18/event/"/>
      <content type="html"><![CDATA[<p>In computing, an <strong>event</strong> is an action or occurrence recognized by software that may be handled by the software. Computer events can be generated or triggered by the system, by the user or in other ways. Typically, events are handled synchronously with the program flow, that is, the software may have one or more dedicated places where events are handled, frequently an event loop. A source of events includes the user, who may interact with the software by way of, for example, keystroke on the keyboard. Another source is a hardware device such as a timer. Software can be trigger its own set of events into the event loop, e.g. to communicate the completion of a task. Software that changes its behavior in response to events is said to be event-driven, often with the goal of being inactive.</p><h3 id="Event-handler"><a href="#Event-handler" class="headerlink" title="Event handler"></a>Event handler</h3><p>In computer programming, an <em>event handler</em> is a <strong>callback</strong> subroutine that handles inputs received in a program(called a <em>listener</em> in Java and JavaScript). Each <em>event</em> is a piece of application-level information from the underlying framework, typically the GUI Toolkit. GUI events including key presses, mouse movement, action selections, and timer expiring.</p>]]></content>
      
      <categories>
          
          <category> workNote </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HTML5 </tag>
            
            <tag> DOM </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>DOM Events</title>
      <link href="/2016/07/18/dom-events/"/>
      <content type="html"><![CDATA[<p><strong>DOM(Document Object Model) events</strong> allow <em>event-driven programming</em> language like JavaScript, JScript, ECMAScript, VBScript and Java to register various <strong>event handler/listener</strong> on the element nodes inside a DOM tree, e.g. HTML, XHTML, XUL, and SVG documents.</p><h3 id="Events"><a href="#Events" class="headerlink" title="Events"></a>Events</h3><h4 id="HTML-Events"><a href="#HTML-Events" class="headerlink" title="HTML Events"></a>HTML Events</h4><p>There is a huge collection of events that can be generated by most element nodes:</p><ul><li>Mouse events;</li><li>Keyboard events;</li><li>HTML frame/object events;</li><li>HTML form events;</li><li>User interface events;</li><li>Mutation events(notification of any changes to the structure of a document);</li><li>Progress events(used by XMLHttpResponse, File API, â¦)</li></ul><p>Mouse:<br>click, dblclick, mousedown, mouseover, mousemove, mouseout, dragstart, drag, dragenter, dragleave, dragover, drop, dragend</p><ul><li>Click: The sequence of click: mousedown, mouseup, click</li><li>Mouseover: Fires when the pointing device is moved onto an element</li><li>Mouseover: Fires when the pointing device is moved while it is over an element</li><li>Dragstart: Fired on an element when a drag is started</li><li>Dragend: The source of the drag will receive a dragend event when the drag operation is complete, whether it was sucessful or not,</li></ul><p>Keyboard:<br>keydown, keypress, keyup</p><p>HTML frame/object:<br>load, unload, abort, error, resize, scroll</p><ul><li>Load: Fires when the <em>user agent</em> finishes loading all content within a document, including window, frames, objects, and images.</li><li>Unlaod: Fires when the <em>user agent</em> removes all content from a window or frame.</li><li>Abort: Fires when an object/image is stopped from loading before completely loaded.</li><li>Error: Fires when an object/image/frame/ cannot be loaded properly.</li><li>Resize: Fires when a document view is resized.</li><li>Scroll: Fires when an element or document view is scrolled</li></ul><p>HTML form:<br>select, change, submit, reset, focus, blur</p><ul><li>Select: Fires when a user selects some text in a <em>text field</em>, including input and textarea.</li><li>Change: Fires <strong>when a control loses the input focus</strong> and <strong>its value has been modified since gaining focus</strong>.</li><li>Submit: Fires when a form is submitted.</li><li>Reset: Fires when a form is reset.</li><li>Focus: Fires when an element receives focus either via the pointing device or by tab navigation.</li><li>Blur: Fires when an element loses focus.</li></ul><p>User Interface:<br>focusin, focusout, DOMActivate</p><p>Mutation:<br>DOMSubtreeModified, DOMNodeInserted, DOMNodeRemoved, DOMNodeRemovedFromDocument, DOMNodeInsertedIntoDocument, DOMAttrModified, DOMCharacterDataModified</p><p>Progress:<br>loadstart, progress, error, abort, load, loadnd</p><h4 id="Touch-Events"><a href="#Touch-Events" class="headerlink" title="Touch Events"></a>Touch Events</h4><p>Web broswer running on touch-enabled devices will generate additional events</p><p>Touch:<br>touchstart, touchend, touchmove, touchenter, touchleave, touchcancel</p><ul><li>Touchstart: Fires when a finger is placed on the touch surface/screen.</li><li>Touchend: Fires when a finger is removed from the touch surface/screen.</li><li>Touchenter: Fires when a touch point moves onto the interactive area defined by a DOM Element</li><li>Touchcancel: A <strong>user-agent</strong> must dispatch this event type to indicate when a TouchPoint has been disrupted in an implementation-specific manner, such as by moving outside the bounds of the UA window.</li></ul><p>In the W3C draft recommendation, a <code>TouchEvent</code> delivers a <code>TouchList</code> of <code>Touch</code> location, the modifier keys that were active, a <code>TouchList</code> of <code>Touch</code> locations within the targeted DOM element, and a <code>TouchList</code> of <code>Touch</code> lcoations that have changed since the previous <code>TouchEvent</code>.</p><h4 id="Internet-Explorer-specific-events"><a href="#Internet-Explorer-specific-events" class="headerlink" title="Internet Explorer-specific events"></a>Internet Explorer-specific events</h4><p>In addition to the common/W3C events, two major types of events are added by <em>Internet Explorer</em>. Some of the events have been implemented as <em>de facto standards</em> by other browsers.</p><p>Clipbord:<br>cut, copy, paste, beforecut, beforecopy, beforepaste</p><p>Data binding:<br>afterupdate, beforeupdate, cellchange, dataavailable, datasetchagned, datasetcomplete, errorudpate, rowenter, rowexit, rowsdelete, rowinserted</p><ul><li>Afterupdate: Fires immediately after a databound object has been updated.</li><li>Beforeupdate: Fires before a data source has changed.</li><li>Cellchange: Fires when a data source has change.</li><li>Dataavailable: Fires when new data from a data source become available.</li><li>Rowenter: Fires whena new row of data from the data source is available.</li></ul><p>Mouse:<br>contextmenu, selectstart</p><ul><li>Contentmenu: Fires when the context menu is shown.</li><li>Selectstart: Fires when the user starts to select text.</li></ul><p>Keyboard:<br>help</p><ul><li>Help: Fires when the user initiates help.</li></ul><p>HTML frame/object:<br>beforeunload, stop</p><ul><li>Beforeunload: Fires before a document is unloaded.</li><li>Stop: Fires when the user stop loading the object. (unlike abort, stop event can be attached to document).</li></ul>]]></content>
      
      <categories>
          
          <category> workNote </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HTML5 </tag>
            
            <tag> DOM </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>çè§£ä¼ªåç´ :Before å :After</title>
      <link href="/2016/07/18/e7-90-86-e8-a7-a3-e4-bc-aa-e5-85-83-e7-b4-a0before-e5-92-8c-after/"/>
      <content type="html"><![CDATA[<p><img src="http://jbcdn2.b0.upaiyun.com/2013/10/syntax1.jpg" alt=""></p><p>æ¬ç¯ä¸­çâä¼ªåç´ âç¹æâ:beforeâåâ:afterâ</p><h3 id="è¯­æ³åæµè§å¨æ¯æ"><a href="#è¯­æ³åæµè§å¨æ¯æ" class="headerlink" title="è¯­æ³åæµè§å¨æ¯æ"></a>è¯­æ³åæµè§å¨æ¯æ</h3><p>æ©èµ·çä¼ªåç´ æ¯ä½¿ç¨ä¸ä¸ªåå·å£°æçâ:â, å¨ CSS3ä¸­ä¿®è®¢åä¼ªåç´ çå£°æä½¿ç¨ä¸¤ä¸ªåå·â::â, ä½æ¯ä¸ºäºç®åçå¼å®¹æ§èè(IE8), å»ºè®®ä½¿ç¨â:âå£°æ.</p><p>ä¼ªåç´ ä¼å¨åå®¹åç´ çååæå¥é¢å¤çåç´ , ææ¯ä¸ç­åäº</p><pre><code>&amp;lt;p&amp;gt;&amp;lt;span&amp;gt;:before&amp;lt;/span&amp;gt;This is the main content.&amp;lt;span&amp;gt;:after&amp;lt;/span&amp;gt;</code></pre><p><img src="http://jbcdn2.b0.upaiyun.com/2013/10/quotationmark-11.jpg" alt=""></p><p>å½ç¶, è¿äºåç´ æ æ³å¨ææ¡£çæºç ä¸­æ¾å°</p>]]></content>
      
      <categories>
          
          <category> workNote </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS3 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>7 Ways You Can Design Your Home Office for Maximum Productivity</title>
      <link href="/2016/07/16/7-ways-you-can-design-your-home-office-for-maximum-productivity/"/>
      <content type="html"><![CDATA[<h3 id="1-Keep-Your-Personal-Life-in-a-Separate-Room"><a href="#1-Keep-Your-Personal-Life-in-a-Separate-Room" class="headerlink" title="1. Keep Your Personal Life in a Separate Room"></a>1. Keep Your Personal Life in a Separate Room</h3><p>You should never work in your comfort zone. For example: the kitchen is for eating, the common space is for socializing, the bedroom is for sleeping and so the office is for <strong>working</strong>.<br>You need to establish those boundaries early on, because they can quickly become bad habits.</p><h3 id="2-Establish-Boundaries-with-Your-Housemates"><a href="#2-Establish-Boundaries-with-Your-Housemates" class="headerlink" title="2. Establish Boundaries with Your Housemates"></a>2. Establish Boundaries with Your Housemates</h3><p>Housemates need to understand that there are boundaries, that you can not be distracted or take on responsibilities such as housework or babysitting children.</p><h3 id="3-Donât-Buy-Too-Much-Equipments"><a href="#3-Donât-Buy-Too-Much-Equipments" class="headerlink" title="3. Donât Buy Too Much Equipments"></a>3. Donât Buy Too Much Equipments</h3><h3 id="4-Donât-Commit-to-Your-Home-Office-Design-Too-Much"><a href="#4-Donât-Commit-to-Your-Home-Office-Design-Too-Much" class="headerlink" title="4. Donât Commit to Your Home Office Design Too Much"></a>4. Donât Commit to Your Home Office Design Too Much</h3><p>Itâs important to remember that an outside world does in fact exist.</p><h3 id="5-Get-Natural-Light-and-Green-Plants"><a href="#5-Get-Natural-Light-and-Green-Plants" class="headerlink" title="5. Get Natural Light and Green Plants"></a>5. Get Natural Light and Green Plants</h3><h3 id="6-Treat-Working-Hours-as-If-You-Were-at-Work"><a href="#6-Treat-Working-Hours-as-If-You-Were-at-Work" class="headerlink" title="6.Treat Working Hours as If You Were at Work"></a>6.Treat Working Hours as If You Were at Work</h3><h3 id="7-Tweak-Your-Comfort-Level"><a href="#7-Tweak-Your-Comfort-Level" class="headerlink" title="7. Tweak Your Comfort Level"></a>7. Tweak Your Comfort Level</h3><p>Ensure the environment wonât distract you. For example, music, seat, temperature, make sure everything can keep you attention to your work.</p>]]></content>
      
      <categories>
          
          <category> Soup </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Gulp è½å¤è§£å³åªäºé®é¢</title>
      <link href="/2016/07/15/gulp-e8-83-bd-e5-a4-9f-e8-a7-a3-e5-86-b3-e9-82-a3-e4-ba-9b-e9-97-ae-e9-a2-98/"/>
      <content type="html"><![CDATA[<p>éå¸¸ä¸ä¸ªåç«¯æå»ºæµç¨åæ¬:</p><ul><li>æä»¶æ¸ç: gulp-clear</li><li>æä»¶æ·è´: gulp-copy</li><li>æä»¶è½¬æ¢: gulp-webpack</li><li>æä»¶åå¹¶: gulp-concat</li><li>æä»¶åç¼©: gulp-minify</li><li>æä»¶æå¡: gulp-connect</li><li>æä»¶çæ§: gulp-watch</li><li>css ç¸å³:<ul><li>less, sass è½¬æ¢(gulp-less, gulp-sass)</li><li>css èªå¨æ·»å åç¼(gulp-autoprefixer)</li></ul></li><li>js ç¸å³:<ul><li>jslint(gulp-jshint)</li></ul></li><li>html è½¬æ¢<ul><li>html æ¨¡æ¿(gulp-jade, gulp-ejs)</li><li>html prettify</li><li>html validator</li><li>html min</li></ul></li></ul><p>Gulp éè¿å®ä¹<code>gulpfile.js</code>éç½®æä»¶çæ¹å¼å®ä¹æµç¨, gulp.js ä¼éè¿è°ç¨ Node.js æ¥æ§è¡æµç¨.</p><h3 id="å¼å¥æä»¶"><a href="#å¼å¥æä»¶" class="headerlink" title="å¼å¥æä»¶"></a>å¼å¥æä»¶</h3><pre><code>var gulp = require(&quot;gulp&quot;), ...`&lt;/pre&gt;### è®¾å®è·¯å¾&lt;pre&gt;`var paths = {  styles:{    src: &quot;src/styles/**/*.less&quot;,    dest: &quot;assets/styles/&quot;  },  scripts:{    src: &quot;src/scripts/**/*.js&quot;,    dest: &quot;assets/scripts/&quot;  }};`&lt;/pre&gt;### è®¾å®ä»»å¡&lt;pre&gt;`gulp.task(&quot;taskName&quot;, function(){  gulp.src(paths.styles.src)      .pipe(task())      .pipe(gulp.dest(paths.styles.dest));});`&lt;/pre&gt;ä¸ä¸ª gulpfile.js æä»¶åªæ¯ä¸ä¸ª Node ç¨åº, å¨ gulpfile ä¸­å¯ä»¥ä½¿ç¨ä»»ä½ npm ä¸­çæ¨¡åæèå¶ä» Node.jså¹¶éææçä»»å¡é½æ¯åºäºæµ, ä¾å¦å é¤æä»¶&lt;pre&gt;`function clean(){  //del ä¹å¯ä»¥å gulp.src ä¸æ ·åºäºæ¨¡å¼å¹éçæä»¶è·¯å¾å®ä¹æ¹å¼  return del([&quot;assets&quot;]);}`&lt;/pre&gt;å¦æè¦æ§å¶ task é¡ºåº, å¯ä»¥éè¿åè°å½æ°å®ç°gulp.task(taskName, function(fn){})ç°å¨æ°å¢å äºä¸²è¡åå¹¶è¡ API- gulp.parallel: å¹¶è¡æ§è¡- gulp.series: ä¸²è¡æ§è¡e.g.&lt;pre&gt;`gulp.task(&quot;one&quot;, function(done){  //do stuff  done(); //åè°å½æ°})gulp.task(&quot;two&quot;, function(done){  //do stuff  done();});//å¹¶è¡æ§è¡ä»»å¡, æ§è¡å®åå¯ä»¥æ·»å åè°å½æ°gulp.task(&quot;parallelTask&quot;, gulp.parallel(&quot;one&quot;, &quot;two&quot;, function(done){  done();}));//ä¸²è¡ä»»å¡gulp.task(&quot;seriesTask&quot;, gulp.series(&quot;one&quot;, &quot;two&quot;, function(done){  done();}));`&lt;/pre&gt;### åç«¯å¸¸ç¨æä»¶</code></pre><ul><li>gulp-sass: ç¼è¯ SASS</li><li>browser-sync: ä¿æå¤æµè§å¨, å¤è®¾å¤åæ­¥</li><li>gulp-imagemin: åå¶ png/jpg/git/svg å¾ç</li><li>gulp-minify-css: åç¼© CSS</li><li>gulp-rename</li><li>gulp-concat: åå¹¶ JS</li><li>gulp-uglify: åç¼© JS</li><li>gulp-autoprefixer: æ·»å åç¼</li><li>gulp-css-spriter: çæéªç¢§å¾</li><li>gulp-htmlmin</li><li><p>gulp-server-livereload</p><h3 id="æ¥ælive-reloadingçæå¡å¨"><a href="#æ¥ælive-reloadingçæå¡å¨" class="headerlink" title="æ¥ælive-reloadingçæå¡å¨"></a>æ¥ælive-reloadingçæå¡å¨</h3><p>ä½¿ç¨ BrowserSync å gulp, ä½ å¯ä»¥è½»æ¾åå»ºä¸ä¸ªå¼åæå¡å¨, ç¶ååä¸ä¸ªWiFi ä¸­çä»»ä½è®¾å¤é½å¯ä»¥æ¹ä¾¿è®¿é®.<br>BrowserSync åæ¶éæäº live-reload, æä»¥ä¸éè¦åå¦å¤çéç½®.</p><p>é¦åå®è£æ¨¡å<br><code>npm install brower-sync --save-dev</code><br>åè®¾ç®åç®å½ç»æä¸º</p><pre>`gulpfile.jsapp/    styles/            main.css        scripts/            main.js        index.html`</pre><p>éç½® gulpfile.js, å° app ç®å½ä¸­çæä»¶å å¥å°æå¡å¨ä¸­, å¹¶ä¸ææçæµè§å¨ä¼å¨æä»¶åçåååèªå¨å·æ°</p><pre>`var gulp = requrie("gulp");var browserSync = require("browser-sync").create();var reload = browerSync.reload;//çè§æä»¶æ¹å¨å¹¶éæ°è½½å¥gulp.task("browser-sync", function(){    browserSync.init({            server:{                    baseDir: 'app'                }        });        gulp.watch(['*.html', 'styles/**/*.css', 'scripts/**/*.js'], {cwd: 'app'}, browserSync.reload);});`</pre><h3 id="CSS-é¢å¤ç"><a href="#CSS-é¢å¤ç" class="headerlink" title="CSS é¢å¤ç"></a>CSS é¢å¤ç</h3><p>æå®æµè§å¨æ éå·æ°å³å¯éè½½ CSS<br>åè®¾ç®å½å¦ä¸</p><p><pre>`var gulp = require(âgulpâ);<br>var sass = require(âgulp-ruby-sassâ);<br>var browserSync = require(âbrowser-syncâ).create();</pre></p><p>gulp.task(âsassâ, function(){</p><pre><code>return sass(&quot;styles/**/*.scss&quot;)             .pipe(gulp.dest(&quot;app/css&quot;)                     .pipe(reload({stream:true}));</code></pre><p>{);<br>/*<br>gulp.task(âsassâ, function(){</p><pre><code>gulp.src(&quot;styles/**/*.scss&quot;)    .pipe(sass({outputstyle: &apos;compressed&apos;}).on(&apos;error&apos;,sass.logError))    .pipe(gulp.dest(&quot;app/css&quot;);</code></pre><p>});<br>*/<br>gulp.task(âbrowser-syncâ, [âsassâ], function(){</p><pre><code>browserSync({        server: {                baseDir: &quot;app&quot;;            }    });    gulp.watch(&quot;app/styles/**/*.scss&quot;, [&quot;sass&quot;], browserSync.reload);</code></pre><p>});</p></li></ul><p>è®¾ç½®<code>tunnel: true</code> æ¥ä½¿ç¨ä¸ä¸ªå¬å¼ç URL æ¥è®¿é®æ¬å°ç«ç¹</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Gulp </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>é«æ§è½ CSS</title>
      <link href="/2016/07/15/e9-ab-98-e6-80-a7-e8-83-bd-css/"/>
      <content type="html"><![CDATA[<h3 id="HTML-å-CSS-æ¬èº«çæ§è½é®é¢å¹¶ä¸çªåº-å¨æé«å¯è¯»æ§åå¯ç»´æ¤æ§çåæä¸-å¦æè½è®©ä»£ç è¿è¡åè§£æçéåº¦æ´å¿«-åæ¯é¦ä¸æ·»è±"><a href="#HTML-å-CSS-æ¬èº«çæ§è½é®é¢å¹¶ä¸çªåº-å¨æé«å¯è¯»æ§åå¯ç»´æ¤æ§çåæä¸-å¦æè½è®©ä»£ç è¿è¡åè§£æçéåº¦æ´å¿«-åæ¯é¦ä¸æ·»è±" class="headerlink" title="HTML å CSS æ¬èº«çæ§è½é®é¢å¹¶ä¸çªåº, å¨æé«å¯è¯»æ§åå¯ç»´æ¤æ§çåæä¸, å¦æè½è®©ä»£ç è¿è¡åè§£æçéåº¦æ´å¿«, åæ¯é¦ä¸æ·»è±."></a>HTML å CSS æ¬èº«çæ§è½é®é¢å¹¶ä¸çªåº, å¨æé«å¯è¯»æ§åå¯ç»´æ¤æ§çåæä¸, å¦æè½è®©ä»£ç è¿è¡åè§£æçéåº¦æ´å¿«, åæ¯é¦ä¸æ·»è±.</h3><h4 id="ä½¿ç¨é«æç-CSS-éæ©å¨"><a href="#ä½¿ç¨é«æç-CSS-éæ©å¨" class="headerlink" title="ä½¿ç¨é«æç CSS éæ©å¨"></a>ä½¿ç¨é«æç CSS éæ©å¨</h4><p>é¦åè¦ç¥éæµè§å¨å¦ä½è§£æ CSS<br>ä»¥ .nav ul.list li div{} ä¸ºä¾<br>æµè§å¨éå div, ç¶åä»éåç»æä¸­å¯»æ¾ç¶éä¸º li çå¯¹è±¡, ä¾æ¬¡è¿è¡éæ©å¨æç´¢. æä»¥å¦æéæ©å¨å±çº§è¿å¤, ä¼å¯¼è´æ§è½ä½ä¸.<br>è§£å³æ¹æ³: ä»¤ç¬¬ä¸æ¬¡å¹éæ¶çæ°éæå°, å¹¶è®©æ´ä½çå¹éæ¥æ¾æ¬¡æ°æ´å°.<br>å·ä½åæ³:</p><ul><li>é¿åä½¿ç¨ééç¬¦</li><li>é¿åä½¿ç¨æ ç­¾éæ©å¨ååä¸ªå±æ§éæ©å¨ä½ä¸ºå³é®éæ©å¨</li><li>ä¸è¦å¨ id éæ©å¨åå æ ç­¾å</li><li>ä¸è¦è®¾å®è¿å¤å±çº§, éä½ CSS å DOM ç»æçè¦ååº¦</li></ul><h4 id="CSS-ç¸å³çå¾çå¤ç"><a href="#CSS-ç¸å³çå¾çå¤ç" class="headerlink" title="CSS ç¸å³çå¾çå¤ç"></a>CSS ç¸å³çå¾çå¤ç</h4><ul><li>ä¸ç»å¾çè®¾ç½®å°ºå¯¸: ææ¶ååä¸å¼ å¾ä¼å¨é¡µé¢ä¸åä½æå¤æ¬¡ä½¿ç¨, æ¯å¦ç¼©ç¥å¾, æ­£å¸¸å¾, å¤§å¾ç­. å¦æå¾ççåå§å°ºå¯¸ä¸å®ééæ±ä¸å, å¨ä½¿ç¨æ¶éè¿ç¼©æ¾ä¼ç» CPU å¸¦æ¥é¢å¤çè®¡ç®è¿ç¨, å¢å äºå¾çå¨æµè§å¨ä¸­çæ¸²ææ¶é´. ç½ç»ä¼ è¾è¿ç¨ä¹ä¼å ç¨æ´å¤å¸¦å®½, å¢å ä¸è½½æ¶é´. æä½³åæ³æ¯ä¸ºéè¦çé¨ååç¬åä¸å¥å¾ç, åå§é¡µé¢å è½½æ¶å°±è½æ´å¿«æ¾ç¤º.</li><li><p>ä½¿ç¨éªç¢§å¾, å©ç¨ css è¿è¡èæ¯å®ä½, å¥½å¤æ¯åå°è¯·æ±æ¬¡æ°, æé«å¾ççæ´ä½çå è½½éåº¦; ç¼ºç¹æ¯éè¦ç²¾ç¡®è®¡ç®ä½ç½®(ç°å¨æä¸äºå·¥å·å¯ç¨), ç»´æ¤è¿ç¨å¤æ, è¦æ¢å¾çæ¯è¾å¤æ</p><pre><code>*   å¨åæä½¿ç¨ CSS Sprite ææ¯, å ä¸ºå¨å¼åçæ¶åä¼æ¯è¾é¢ç¹ä¿®æ¹å¾ç</code></pre><ul><li>åçç»ç»å¾ç</li><li>æ§å¶éªç¢§å¾çå°ºå¯¸, æ¨èé¿å®½ç¸ä¹ä¸è¶è¿2500, å¤§å°ä¸è¶è¿200kb</li><li>åçæ§å¶èæ¯å¾ååä¹é´çè·ç¦»åèæ¯å¾çä½ç½®</li><li>åå©ç¸å³å·¥å·</li></ul></li></ul><h4 id="åå°-CSS-ä»£ç é"><a href="#åå°-CSS-ä»£ç é" class="headerlink" title="åå° CSS ä»£ç é"></a>åå° CSS ä»£ç é</h4><ul><li>å®ä¹ç®æ´ç CSS è§å</li><li>åå¹¶ç¸åçå®ä¹</li><li>å é¤æ æçå®ä¹</li></ul><h4 id="å¶ä»éå¾"><a href="#å¶ä»éå¾" class="headerlink" title="å¶ä»éå¾"></a>å¶ä»éå¾</h4><ul><li>é¿åä½¿ç¨@ import</li><li>é¿åä½¿ç¨ IE æµè§å¨ç¬æçæ ·å¼</li><li>é¿åä½¿ç¨ CSS è¡¨è¾¾å¼: å¨æè®¾ç½® CSS å±æ§, å¯ä»¥éè¿ js ä¿®æ¹</li></ul><h3 id="å¼å®¹æ§æ¥è¯¢"><a href="#å¼å®¹æ§æ¥è¯¢" class="headerlink" title="å¼å®¹æ§æ¥è¯¢"></a>å¼å®¹æ§æ¥è¯¢</h3><ul><li>caniuse.com</li><li>css3 click chart</li><li>css contents and browsers compatibility</li></ul>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS3 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>BFC åºæ¬æ¦å¿µ</title>
      <link href="/2016/07/15/bfc-e5-9f-ba-e6-9c-ac-e6-a6-82-e5-bf-b5/"/>
      <content type="html"><![CDATA[<h3 id="Box-CSS-å¸å±çåºæ¬åä½"><a href="#Box-CSS-å¸å±çåºæ¬åä½" class="headerlink" title="Box: CSS å¸å±çåºæ¬åä½"></a>Box: CSS å¸å±çåºæ¬åä½</h3><p>Box æ¯ CSS å¸å±çå¯¹è±¡, ååºæ¬åä½, ç´è§ç¹æ¥è¯´, å°±æ¯ä¸ä¸ªé¡µé¢æ¯ç±å¾å¤ä¸ª Box ç»æç. åç´ çç±»åå display å±æ§, å³å®äºè¿ä¸ª Box çç±»å. ä¸åç±»åç Box, ä¼åä¸ä¸åç Formatting Context(ä¸ä¸ªå³å®å¦ä½æ¸²æææ¡£çå®¹å¨), å æ­¤ Box åçåç´ ä¼ä»¥ä¸åæ¹å¼æ¸²æ.<br>çå­çç±»å:</p><ul><li>block-level: <code>display:block</code>ç block, list-item, table åç´ ä¼å½¢æ block-level box, å¹¶åä¸ Block formatting context.</li><li>inline-level box: <code>display:inline</code>ç inline-block, inline-table åç´ ä¼å½¢æ inline-level box, å¹¶åä¸ inline formatting context;</li><li>run-in box: CSS3ææ, ç¥;</li></ul><h3 id="Formatting-Context"><a href="#Formatting-Context" class="headerlink" title="Formatting Context"></a>Formatting Context</h3><p>Formatting Context æ¯ W3C CSS2.1è§èä¸­çä¸ä¸ªæ¦å¿µ, æ¯é¡µé¢ä¸­çä¸åæ¸²æåºå, å¹¶æä¸å¥æ¸²æè§å, å³å®äºå¶å­åç´ å¦ä½å®ä½, ä»¥åå¶ä»åç´ çå³ç³»åç¸äºä½ç¨. æå¸¸è§çç Formatting Context æ Block Formatting Context(BFC) å Inline Formatting Context(IFC).<br>CSS2.1ä¸­åªæ BFC å IFC, å¨ CSS3ä¸­æ·»å äº GFC å FFC</p><h3 id="BFC-çå®ä¹"><a href="#BFC-çå®ä¹" class="headerlink" title="BFC çå®ä¹"></a>BFC çå®ä¹</h3><p>BFC ç´è¯ä¸ºâåçº§æ ¼å¼ä¸ä¸æâ, æ¯ä¸ä¸ªç¬ç«çæ¸²æåºå, åªæ Block-level Box å¯ä»¥åä¸, ä»è§å®äºåé¨ç Block-level Box å¦ä½å¸å±, å¹¶ä¸ä¸è¿ä¸ªåºåå¤é¨æ¯«ä¸ç¸å¹².</p><h4 id="BFC-å¸å±è§å"><a href="#BFC-å¸å±è§å" class="headerlink" title="BFC å¸å±è§å"></a>BFC å¸å±è§å</h4><ul><li>åé¨ç Box ä¼å¨åç´æ¹åä¾æ¬¡æå</li><li>Box åç´æ¹åçè·ç¦»ç± margin å³å®, å±äºåä¸ä¸ª BFC çä¸¤ä¸ªç¸é»ç Box ç margin ä¼åçåå¡</li><li>BFC åé¨ä¸ä¼åç float box éå </li><li>BFC å°±æ¯é¡µé¢ä¸çä¸ä¸ªéç¦»çç¬ç«å®¹å¨, å®¹å¨åçå­åç´ ä¸ä¼å½±åå°å¤é¨çåç´ , åä¹äº¦ç¶</li><li>è®¡ç® BFC é«åº¦çæ¶å, <strong>æµ®å¨åç´ ä¹åä¸è®¡ç®</strong>(ä½¿ç¨ border æ¶é¤ç¶åç´ åå¡çåç)</li><li>BFC åé¨æ¯ä¸ä¸ª Box çå·¦å¤è¾¹ç¼(margin-left)ä¼ç¢°è§¦å®¹å¨çå·¦è¾¹ç¼(border-left)(å¦ææ¯ä»å³åå·¦çæ ¼å¼, åæ¯ç¢°è§¦å³è¾¹ç¼)</li></ul><h4 id="BFC-çéä¿çè§£"><a href="#BFC-çéä¿çè§£" class="headerlink" title="BFC çéä¿çè§£"></a>BFC çéä¿çè§£</h4><p>BFC å®¹å¨æ¯ä¸ä¸ªç¬ç«çç®±å­, éé¢çåç´ çå¸å±ä¸åå¤é¨åç´ å½±å.<br>æä»¬å¾å¾å©ç¨è¿ä¸ªç¹æ§æ¥æ¶é¤æµ®å¨åç´ å¯¹å¶ä»éæµ®å¨çåå¼åç´ åå¶å­åç´ å¸¦æ¥çå½±å.<br>å¹¶ä¸å¨ä¸ä¸ª BFC å®¹å¨ä¸­, åçåè¡çé½ä¼æ²¿å¶ç¶åç´ çè¾¹æ¡æå</p><h4 id="BFC-æå "><a href="#BFC-æå " class="headerlink" title="BFC æå "></a>BFC æå </h4><ul><li>float å±æ§ä¸ä¸º None;</li><li>position ä¸º Absolute æ Fixed</li><li>display ä¸º inline-block, table-cell, table-caption, flex, inline-flex</li><li>overflow ä¸æ¯ visible</li></ul><h4 id="BFC-çä½ç¨ä¸åç"><a href="#BFC-çä½ç¨ä¸åç" class="headerlink" title="BFC çä½ç¨ä¸åç"></a>BFC çä½ç¨ä¸åç</h4><h5 id="èªéåºä¸¤æ å¸å±"><a href="#èªéåºä¸¤æ å¸å±" class="headerlink" title="èªéåºä¸¤æ å¸å±"></a>èªéåºä¸¤æ å¸å±</h5>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS3 </tag>
            
            <tag> Trick </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>CSS å¤è¾¹è·åå¹¶</title>
      <link href="/2016/07/14/css-e5-a4-96-e8-be-b9-e8-b7-9d-e5-90-88-e5-b9-b6/"/>
      <content type="html"><![CDATA[<p><strong>å¤è¾¹è·åå¹¶çæææ¯ä¸¤ä¸ªåç´æåçåçå¤è¾¹è·å¯è½åç(åå¡)åå¹¶, ä»ä¿çè¾å¤§çè¾¹è·.</strong></p><h2 id="æåµä¸"><a href="#æåµä¸" class="headerlink" title="æåµä¸:"></a>æåµä¸:</h2><p>ä¸¤åç´ ä¸ä¸æå<br><img src="http://www.w3school.com.cn/i/ct_css_margin_collapsing_example_1.gif" alt=""></p><h2 id="æåµäº"><a href="#æåµäº" class="headerlink" title="æåµäº:"></a>æåµäº:</h2><p>ä¸¤åç´ æ¯ç¶å­å³ç³», è¥æ­¤æ¶ç¶åç´ æ²¡æè®¾å® border, margin(æèå®½åº¦ä¸º0), ä»ä»¬çä¸ä¸è¾¹è·ä¹ä¼åçåå¹¶.<br><img src="http://www.w3school.com.cn/i/ct_css_margin_collapsing_example_2.gif" alt=""></p><h2 id="æåµä¸"><a href="#æåµä¸" class="headerlink" title="æåµä¸:"></a>æåµä¸:</h2><p>èªèº«æ¯ä¸ä¸ªæä¸ä¸å¤è¾¹è·çç©ºåç´ , å¦ææ²¡æ border å margin, èªèº«çä¸ä¸å¤è¾¹è·ä¹ä¼åå¹¶<br><img src="http://www.w3school.com.cn/i/ct_css_margin_collapsing_example_3.gif" alt=""></p><h3 id="å¦æè¿ä¸ªç©ºåç´ è¿ä¸å¦ä¸ä¸ªåç´ åç´æå-ä¼ç»§ç»­åçåå¹¶"><a href="#å¦æè¿ä¸ªç©ºåç´ è¿ä¸å¦ä¸ä¸ªåç´ åç´æå-ä¼ç»§ç»­åçåå¹¶" class="headerlink" title="å¦æè¿ä¸ªç©ºåç´ è¿ä¸å¦ä¸ä¸ªåç´ åç´æå, ä¼ç»§ç»­åçåå¹¶"></a>å¦æè¿ä¸ªç©ºåç´ è¿ä¸å¦ä¸ä¸ªåç´ åç´æå, ä¼ç»§ç»­åçåå¹¶</h3><p><img src="http://www.w3school.com.cn/i/ct_css_margin_collapsing_example_4.gif" alt=""></p><h3 id="å¯¹è±¡"><a href="#å¯¹è±¡" class="headerlink" title="å¯¹è±¡"></a>å¯¹è±¡</h3><p>åªææ®éææ¡£æµä¸­çååç´ ä¼åçå¤è¾¹è·åå¹¶, å¦ææ¯æµ®å¨å, æèæ¯ç»å¯¹å®ä½å, ä»çå¤è¾¹è·æ¯ä¸ä¼åå¹¶ç.</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS3 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Mix-Blend-Modeä¹ Multiply, Screen, Difference</title>
      <link href="/2016/06/28/mix-blend-mode-e4-b9-8b-multiply-screen-difference/"/>
      <content type="html"><![CDATA[<p>è¯­æ³</p><pre><code>mix-blend-mode: &amp;lt;mode&amp;gt;</code></pre><p>normal: é»è®¤å¼, æ­£å¸¸</p><p>multiply: æ­£çå åº - æ¥çå¯¹åºåç´ çé¢è²ä¿¡æ¯, å¹¶å°åºè²åæ··åè²å¤å, ç»æè²æ»æ¯æ¯è¾æçé¢è², ä»»ä½é¢è²ä¸é»è²æ­£çå åºé½äº§çé»è², ä»»ä½é¢è²ä¸ç½è²æ­£çå åºé½ä¿æä¸å. æ­£çå°±æ¯å¸¸è§çå¹»ç¯ç, æ­£çå åºçææå°±æ¯æåºè²åæ··åè²çå¾åé½åæå¹»ç¯ç, æä»ä»¬å æ¾å¨ä¸èµ·, åè¿äº®å¤æ¾ç¤ºçææ, ç±äºä¸¤å¼ å¹»ç¯çé½æåå®¹, æä»¥éå èµ·æ¥çå¾åæ¯åå¼ è¦æ</p><p>screen: æ»¤è² - æ»¤è²åçåæ¾ç¤ºå¨æååçç¸å, å°ä¸¤å¯å¹»ç¯çåå«æ¾å¨ä¸åæå½±ä»ªä¸, æååä¸ä¸ªå±å¹, ç±äºåçº¿çå å æåº, å¾å°çæ¯ä¸ä¸ªæ´æäº®çå¾å. åºè²çåç¸ä¸æ··åè²çåç¸ç¸ä¹, å¾å°çç»æé¤ä»¥255åååç¸.</p><p>overlay: å å </p><p>lighten: åé</p><p>darken: åæ</p><p>color-dodge: é¢è²åæ·¡</p><p>color-blur: é¢è²å æ·±</p><p>hard-light: å¼ºå</p><p>soft-light: æå</p><p>difference: å·®å¼ - æ··åè²ä¸åºè²ç¸åååç»å¯¹å¼</p><p>exclusion: æé¤</p><p>hue: è²ç¸</p><p>saturation: é¥±ååº¦</p><p>color: é¢è²</p><p>luminosity: äº®åº¦</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS3 </tag>
            
            <tag> Trick </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Gulp èªå¨åé¨ç½²å¿«éå¥é¨</title>
      <link href="/2016/06/27/gulp-e8-87-aa-e5-8a-a8-e5-8c-96-e9-83-a8-e7-bd-b2-e5-bf-ab-e9-80-9f-e5-85-a5-e9-97-a8/"/>
      <content type="html"><![CDATA[<ol><li><code>$ npm install âg gulp</code>å¨å±å®è£</li></ol><ul><li>å®è£åä¿è¯å·²ç»å®è£äº ruby</li></ul><ol><li><code>$ npm install âsave-dev- gulp</code>ä½ä¸ºé¡¹ç®çå¼åä¾èµ( devDependence)å®è£å°é¡¹ç®ç®å½<p></p></li><li><p>å¨é¡¹ç®æ ¹ç®å½ä¸åå»ºä¸ä¸ªåä¸º<code>gulpfile.js</code>çæä»¶:</p><pre><code>//å¼ç¨ gulp plugin</code></pre><p>var gulp = require(âgulpâ);<br>//å»ºç« gulp task<br>gulp.task(âdefaultâ, function(){<br> //ä»»å¡ä»£ç <br>})<br><code>&lt;/pre&gt;å¨é¡¹ç®æ ¹ç®å½è¿è¡ gulp æ¶, gulp ä¼ç´æ¥è¯»å</code>gulpfile.js`ä¸­å®ä¹çä»»å¡å¹¶æ§è¡.</p></li></ol><ul><li>gulp å¯ä»¥å°æ¯ä¸ä¸ªä½ è¦æ§è¡çå·¥ä½å½å, èé»è®¤è¿è¡çtask åä¸º<code>default</code></li></ul><ol><li>$ gulp`è¿è¡ gulp, è¿è¡é»è®¤çåä¸ºâ defaultâ çä»»å¡( task)</li></ol><ul><li><code>gulp &amp;lt;task&amp;gt; &amp;lt;othertask&amp;gt;</code>è¿è¡æå® task</li></ul><ol><li>gulp åºæ¬ API</li></ol><ul><li><p><code>gulp.src(globs[, options])</code></p><pre><code>*   `glob`åè [node-glob è¯­æ³](https://github.com/isaacs/node-glob), ä¹å¯ä»¥ç´æ¥åæä»¶çè·¯å¾</code></pre><ul><li><code>options</code>:ç¥</li></ul></li><li><p><code>gulp.dest(path[,options])</code></p><pre><code>*   è½è¢«`pipe`è¿æ¥, å¹¶è½åæä»¶å°æä»¶å¤¹, å¦ææä»¶å¤¹ä¸å­å¨, åèªå¨åå»ºæä»¶å¤¹.</code></pre><ul><li><code>path</code>: String æ Function, å¯ä»¥ç´æ¥åè¾åºç®å½, ä¹å¯ä»¥ä¼ å¥ä¸ä¸ªè¿åè·¯å¾çå½æ°</li><li><code>options</code>:ç¥</li></ul></li><li><p><code>gulp.task(name[, deps], fn)</code></p><pre><code>*   &lt;pre&gt;`gulp.task(&apos;script&apos;,function(){</code></pre><p> //å¾æ§è¡<br>})<br>`</p><ul><li><code>name</code>: èµäºä»»å¡åç§°</li><li><p><code>deps</code>: ä»»å¡åè¡¨æ°ç», è¿äºä»»å¡ä¼å¨å½åä»»å¡è¿è¡ä¹åå®æ</p><pre><code>    *   task é»è®¤ä»¥æå¤§å¹¶åæ°æ§è¡, ä¹å°±æ¯è¯´ gulp ä¼ä¸æ¬¡æ§æ§è¡ææ task å¹¶ä¸åä»»ä½ç­å¾, å¦æè¦ä»¥ç¹å®é¡ºåºæ§è¡, éè¦:            *   ç»åºä¸ä¸ªæç¤º, åç¥ task ä»ä¹æ¶åæ§è¡å®æ¯*   åç»åºä¸ä¸ªæç¤º, åç¥ task ä¾èµå¦ä¸ä¸ª task çå®æ*   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">var gulp = require(&apos;gulp&apos;);</span><br><span class="line">//è¿åä¸ä¸ª callback, å æ­¤ç³»ç»å¯ä»¥ç¥éä»ä»ä¹æ¶åå®æ</span><br><span class="line">gulp.task(&apos;one&apos;, function(cb)&#123;</span><br><span class="line">//æ§è¡ä¸äºä»»å¡</span><br><span class="line"> cb(err); //å¦æ err ä¸æ¯ null æè undefined, åä¼åæ­¢æ§è¡, è¿æ ·ä»£è¡¨æ§è¡å¤±è´¥.</span><br><span class="line">&#125;);</span><br><span class="line">//å®ä¹ä¸ä¸ªæä»¥æ¥ç task å¿é¡»å¨è¿ä¸ª task æ§è¡ä¹åå®æ</span><br><span class="line">gulp.task(&apos;two&apos;, [&apos;one&apos;], function()&#123;</span><br><span class="line"> //&apos;one&apos;å®æåè¦æ§è¡çä»»å¡</span><br><span class="line">&#125;)</span><br><span class="line">gulp.task(&apos;default&apos;, [&apos;one&apos;, &apos;two&apos;]);</span><br></pre></td></tr></table></figure></code></pre></li><li><p><code>fn</code>:è¦æ§è¡çæä½</p></li></ul></li><li><p><code>gulp.watch(glob [, opts], tasks)</code></p><pre><code>*   çå¬æä»¶, å¹¶å¯ä»¥å¨æä»¶åçæ¹å¨çæ¶ååä¸äºäºæ, ä»æ»ä¼è¿åä¸ä¸ª EventEmiiter æ¥åå°`change`äºä»¶.</code></pre><ul><li><code>glob</code>: æå®å·ä½çå¬åªäºæä»¶çåå¨</li><li><p><code>tasks</code>: éè¦å¨æä»¶åå¨åæ§è¡çä»»å¡</p><pre><code>*   &lt;pre&gt;`var watcher = gulp.watch(&apos;js/**/*.js&apos;, [&apos;uglify&apos;, &apos;reload&apos;]);</code></pre><p>watcher.on(âchangeâ, function(event){<br>console.log(âFileâ+event.path+â was â+event.type+â, running tasksâ¦â);<br>});<br>`</p></li></ul></li></ul><ol><li>å·¥ä½æµç¨</li></ol><ul><li><p>è®¾å®ä»»å¡</p><pre><code>*   gulp å¯ä»¥å¯¹ä¸åç task å½å, è default æ¯é»è®¤çäººç©åç§°, å¦ææ§è¡ gulp çæ¶åæ²¡ææå®ä»»å¡åç§°, åä¼æ§è¡`default` ä»»å¡.</code></pre><ul><li><pre>`//è½½å¥ gulp pluginvar gulp = require('gulp');//å®ä¹åç§°ä¸º default ç gulp ä»»å¡gulp.task('default', function(){console.log('Hello Gulp Default Task');});//å®ä¹åç§°ä¸º other ç gulp ä»»å¡gulp.task('other', function(){console.log('Hello Gulp Other Task');})`</pre></li></ul></li><li><p>æ§è¡æå®ç gulp ä»»å¡</p><pre><code>*   &lt;pre&gt;`$ gulp</code></pre><p>`</p><pre><code>*   æ§è¡é»è®¤ç default ä»»å¡</code></pre><ul><li><pre>`$ gulp other`</pre><pre><code>*   æ§è¡ä»»å¡`other`</code></pre></li><li><pre>`$ gulp.task('default', ['other', 'script']);`</pre><pre><code>*   å¨ default ä»»å¡ä¸­è®¾å®è¦æ§è¡çä»»å¡éåå¯ä»¥æ§è¡å¤ä¸ªä»»å¡</code></pre></li></ul></li><li><p>çå¬</p><pre><code>*   æ¯å¦æä»¬ä½¿ç¨`gulp-uglify`æå°å JS æ¶, å¸æå¯ä»¥å¨æ¯æ¬¡æ¹å¨ JS çæ¶åèªå¨æ§è¡ gulp æå°åå¨ä½        *   &lt;pre&gt;`var gulp = require(&apos;gulp&apos;),</code></pre><p>gulpUglify = require(âgulp-uglifyâ);<br>gulp.task(âscriptâ, function(){<br>gulp.src(âjavascript/original/*.jsâ) //æå®è¦å¤ççåå§ JS ç®å½<br>.pipe(gulpUglify()) //æ§è¡æå°å<br>.pipe(gulp.dest(âjavascript/minifyâ)); //æå°ååé¨ç½²å° JS ç®å½<br>})<br>`</p><ul><li><p>æ·»å çå¬</p><pre><code>*   &lt;pre&gt;`gul.task(&apos;watch&apos;, function(){</code></pre><p>gulp.watch(âjavascript/original/*.jsâ, [âscriptâ]);<br>})<br>`</p><ul><li><pre>`$ gulp watch //æ§è¡çå¬`</pre><pre><code>*   æ§è¡çå¬å, æ¯æ¬¡æ¹å¨ javascript/origin/*.js ä¸­ææ JS æä»¶æ¶é½ä¼éæ°æ§è¡ script ä»»å¡.</code></pre><ul><li>å¯ä»¥ç¨<code>**</code>çå¬æææä»¶</li><li>å¯ä»¥å°<code>watch</code>æ·»å å°ä»»å¡åè¡¨, è¿æ ·åªéè¦æä»¤<code>gulp</code>å°±å¯ä»¥æ§è¡çå¬</li></ul></li></ul></li></ul></li><li><p>ä¾å¤å¤ç</p><pre><code>*   ç»åä¾å¤éè¯¯è®°å½ä»»å¡        *   ç±äºä¾å¤éè¯¯å¯è½ä¼å¨å¾å¤å°æ¹åºç°, æå¥½æ¯å®ä¹ä¸ºå¯è°ç¨çå½æ°*   &lt;pre&gt;`function errorLog(error){</code></pre><p>console.error(error);<br>this.emit(âendâ);<br>}<br>gulp.task(âscriptâ, function(){<br>gulp.src(ââ¦â)<br>.on(âerrorâ,errorLog)<br>.pipe(gulpUglify())<br> .pipe(gulp.dest(ââ¦â));<br>});<br>`</p></li></ul><ol><li>å¸¸ç¨æä»¶</li></ol><ul><li><p>gulp-uglify</p><pre><code>*   `$ npm install âsave-dev gulp-uglify`</code></pre><ul><li>å°è¦æå°åç JS æä»¶æ¾å¨ javascript/original ä¸</li><li>å°æå°ååç JS æä»¶æ¾å¨ javascript/minify ä¸</li><li><pre>`var gulp = require('gulp'),gulpUgligy = require('gulp-uglify');gulp.task('script', function(){gulp.src('javascript/original/*js').pipe(gulpUglify()).pipe(gulp.dest('javascript/minify'));})`</pre></li></ul></li><li><p>gulp-sass</p><pre><code>*   `$ npm install âsave-dev gulp-sass`        *   å°è¦ç¼è¯ç Scss æä»¶æ¾å¨ scss ç®å½ä¸*   å°ç¼è¯åç CSS æä»¶æ¾å¨ css ç®å½ä¸*   &lt;pre&gt;`var gulp = require(&apos;gulp&apos;),</code></pre><p>gulpSass = required(âgulp-sassâ);<br>gulp.task(âstylesâ,function(){<br>gulp.src(âscss/*.scssâ)<br>.pipe(gulpSass())<br>.pipe(gulp.dest(âcssâ));<br>})<br>`</p><pre><code>*   å gulpSass()ä¼ å¥åæ°`{outputStyle:&apos;compressed&apos;}`è¾åºåç¼©åç CSS æä»¶</code></pre></li><li><p>gulp-imagemin</p><pre><code>*   åç¼©å¾ç, æ¯ææ ¼å¼æ gif, jpg, png, svg</code></pre><ul><li><code>$ npm install --save-dev gulp-imagemin</code></li><li>æå® images/originä¸ææå¾çé½åç¼©, å¹¶æåç¼©åçå¾çæ¾å°images ä¸­</li><li><pre>`var gulp = require('gulp'),gulpImagemin = require('gulp-imagemin');gulp.task('image', function(){gulp.src('images/original/**').pipe(gulpImagemin()).pipe(gulp.dest('images'));})`</pre></li></ul></li><li><p>gulp-plumber</p><pre><code>*   `$ npm install âsave-dev gulp-plumber`</code></pre><ul><li><code>pipe(gulpPlumber())</code>ä¸å®è¦å¨ç¼è¯ scss åæå°å js ä¹åå°±å å¥(æ³¨æé¡ºåº)</li><li><pre>`var gulp = require('gulp'),gulpUglify = require('gulp-uglify');gulp.watch('watch', function(){gulp.watch('javascript/original/*.js', ['script']);});gulp.task('script', function(){gulp.src('javascript/original/*.js').pipe(gulpPlumber()).pipe(gulpUglify()).pipe(gulp.dest('javascript/minify'));});`</pre></li><li>gulp-autoprefixer</li><li>gulp-minify-css</li><li>gulp-clean</li><li>gulp-livereload</li></ul></li></ul><ol><li>å·¥ä½èä¾</li></ol><ul><li><p>æç¡®ä»»å¡</p><pre><code>*   æ£æ¥ JS</code></pre><ul><li>ç¼è¯ Scss</li><li>åå¹¶ JS</li><li>åç¼©å¹¶éå½ååå¹¶åç JS</li></ul></li><li><p>å®è£ä¾èµ</p><pre><code>*   `$ npm install gulp-jshint gulp-sass gulp-concat gulp-uglify gulp-rename âsave-dev`</code></pre><ul><li><p></p><p>æ°å»º<code>gulpfile.js</code></p><pre><code>*   &lt;pre&gt;`//å¼å¥ gulp åæä»¶</code></pre><p>var gulp = require(âgulpâ),<br>gulpJshint = require(âgulp-jshintâ),<br>gulpSass = require(âgulp-sassâ),<br>gulpConcat = require(âgulp-concatâ),<br>gulpUglify = require(âgulp-uglifyâ),<br>gulpRename(âgulp-renameâ);<br>//æ£æ¥ JS, è¯¥ä»»å¡ä¼æ£æ¥ js/ä¸ç js æä»¶ææ²¡ææ¥éæè­¦å<br>gulp.task(âlintâ,function(){<br>gulp.src(â./js/<em>.jsâ)<br>.pipe(gulpJshint())<br>.pipe(gulpJshint.reporter(âdefaultâ));<br>});<br>//ç¼è¯ Scss, è¯¥ä»»å¡ä¼ç¼è¯ scss/ä¸ç scss æä»¶, å¹¶æç¼è¯åç css æä»¶ä¿å­å° /css ä¸­<br>gulp.task(âsassâ, function(){<br>gulp.src(â./scss/</em>.scssâ)<br>.pipe(gulpSass())<br>.pipe(gulp.dest(â./cssâ));<br>});<br>//åå¹¶, åç¼© JS æä»¶, è¯¥ä»»å¡ä¼åå¹¶ js/ä¸çææ js æä»¶, å¹¶è¾åºå° dist/ç®å½, ç¶åéå½åä¸º.min.js, å¹¶åç¼©åè¾åºå° dist/ä¸<br>gulp.task(âscriptsâ, function(){<br>gulp.src(â./js/<em>.jsâ)<br>.pipe(gulpConcat(âall.jsâ))<br>.pipe(gulp.dest(â./distâ))<br>.pipe(gulpRename(âall.min.jsâ)).<br>pipe(gulpUglify())<br>.pipe(gulp.dest(â./distâ));<br>});<br>//é»è®¤ä»»å¡, é»è®¤ä»»å¡åºäºå¶ä»ä»»å¡, ä½¿ç¨.run()æ¹æ³å³èåè¿è¡æä»¬ä¹åå®ä¹çæ¹æ³, ä½¿ç¨.watch()æ¹æ³çå¬æå®ç®å½çæä»¶<br>gulp.task(âdefaultâ, function(){<br>gulp.run(âlintâ, âsassâ, âscriptsâ);<br>//çå¬æä»¶<br>gulp.watch(â./js/</em>.jsâ, function(){<br>gulp.run(âlintâ,âsassâ,âscriptsâ);<br>});<br>});</p></li></ul></li></ul>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Gulp </tag>
            
            <tag> automatic </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>JS è·å Input File Name</title>
      <link href="/2016/06/24/js-e8-8e-b7-e5-8f-96-input-file-name/"/>
      <content type="html"><![CDATA[<p>è·å¾æä»¶è·¯å¾: <code>var filePath = document.getElementById(&quot;file&quot;).value</code></p><p>æªåæä»¶å:</p><ul><li><p>ä¿çåç¼:</p><pre><code>*   `var fileName = filePath.split(&apos;\\&apos;).pop()`</code></pre><ul><li><code>var fileName = filePath.substring(filePath.lastIndexOf(&#39;\\&#39;)+1)</code></li></ul></li><li><p>ä¸ä¿çåç¼:</p><pre><code>*   `var fileName = filePath.split(/\.|\\/).slice(-2,-1)[0]`</code></pre><ul><li><code>var fileName = filePath.substring(filePath.lastIndexOf(&quot;\\&quot;)+1,filePath.lastIndexPathOf(&quot;\.&quot;))</code></li></ul></li></ul>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javascript </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Distinction Between &#39;Nth-Child&#39; and &#39;Nth-of-Type&#39;</title>
      <link href="/2016/06/23/distinction-between-nth-child-and-nth-of-type/"/>
      <content type="html"><![CDATA[<p>In HTML</p><pre><code>&amp;lt;p&amp;gt;0&amp;lt;/p&amp;gt;&amp;lt;div&amp;gt;1&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;2&amp;lt;/div&amp;gt;&amp;lt;p&amp;gt;3&amp;lt;/p&amp;gt;&amp;lt;div&amp;gt;4&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;5&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;6&amp;lt;/div&amp;gt;</code></pre><p>The Selector <code>div:nth-child(3)</code> will choose the 3rd element from all elements in the level where div is, then check if the 3rd element is a âdivâ. In this case, the 3rd element is a âdivâ, so it works(<code>&amp;lt;div&amp;gt;2&amp;lt;/div&amp;gt;</code>), but Selector <code>div:nth-child(4)</code> will select the 4st element which is âpâ (<code>&amp;lt;p&amp;gt;3&amp;lt;/p&amp;gt;</code>), itâs not a âdivâ, so it doesnât work.</p><p>However, the Selector <code>div:nth-of-type(3)</code> will choose the 3rd âdivâ from all âdivâs in the level where div is, so it choose the <code>&amp;lt;div&amp;gt;4&amp;lt;/div&amp;gt;</code>.</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS3 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>CSS3: Border-Image</title>
      <link href="/2016/06/23/css3-border-image/"/>
      <content type="html"><![CDATA[<h2 id="åºæ¬è¯­æ³"><a href="#åºæ¬è¯­æ³" class="headerlink" title="åºæ¬è¯­æ³"></a>åºæ¬è¯­æ³</h2><pre><code>border-image: none|&amp;lt;image&amp;gt;[&amp;lt;slice&amp;gt;|&amp;lt;width&amp;gt;|&amp;lt;repeat&amp;gt;]</code></pre><ul><li><code>border-image-source: url(&quot;â¦&quot;);</code></li><li><p><code>border-image-slice:[&amp;lt;number&amp;gt;|&amp;lt;percentage]</code></p><pre><code>*   ç¨äºåè§£å¼å¥çå¾ç, px æ¯é»è®¤åä½, å¦æç¨ number åä¸å®ä¸è½å ä¸ px</code></pre><ul><li>percentage æ¯ç¸å¯¹äºå¼å¥ç image èè¨ç, ä¾å¦ image çå¤§å°ä¸º300 x 240, è¥è®¾å® slice: 25%, 30%, 15%, 20%, <strong>ç­äºæªåäºå¾çå¤ä¾§ç60px, 90px, 36px, 60px çé¨åä½ä¸ºè¾¹æ¡</strong></li><li><img src="http://cdn1.w3cplus.com/cdn/farfuture/Z78eIzBXIkFO02LKoPUpOhn7DIjZdlGOqeeIiANZiNA/mtime:1341237495/sites/default/files/border-image-slice.jpg" alt="ç¤ºä¾å¾"></li><li>å®éä¸ CSS3 å°è¯¥å¾çååæ9ä¸ªé¨å, åæ ¹æ® width å repeat è¿è¡å¤çåæ¼æ¥æè¾¹æ¡</li><li>åä¸ªè§ä¸ä¼åå° repeat çå½±åèäº§çåå½¢, åä¸ªè¾¹ä¼åå° repeat çå½±åèåå½¢.</li></ul></li><li><p><code>border-image-width: [&amp;lt;length&amp;gt;|&amp;lt;percentage&amp;gt;|&amp;lt;number&amp;gt;|auto]</code></p><pre><code>*   border-image-width å°±æ¯ border-width, ç¨äºè®¾ç½®è¾¹æ¡å®½åº¦</code></pre><ul><li>å¦æ slice æªåçå®½åº¦æ­£å¥½ç­äº width, é£ä¹ä¸ä¼åçåå½¢</li></ul></li><li><p><code>border-image-repeat: [stretch|repeat|round]</code></p><pre><code>*   æå®åæ¡è¾¹çæåæ¹å¼</code></pre><ul><li>æå¤æ¥åä¸¤ä¸ªåæ°, ç¬¬ä¸ä¸ªæ°´å¹³æ¹å, ç¬¬äºä¸ªåç´æ¹å</li><li>round -&gt; å¹³éº</li><li>round ä¼åç¼©æä¼¸å± sliced-block, ä¿è¯å¹³éºè¿ç¨ä¸­å¶å®æ´æ§</li><li><img src="http://cdn2.w3cplus.com/cdn/farfuture/Fnx2B9-7WSVP5CmFE9QNNOMbawlHVGYZ3O1cFF5gQSw/mtime:1341237495/sites/default/files/border-image-round-HV.png" alt=""></li><li>repeat -&gt; éå¤</li><li>repeat ä¸ä¼æ¹å sliced-block çå®æ´æ§, ä»ä¸­é´å¼å§åä¸¤è¾¹æå</li><li><img src="http://cdn2.w3cplus.com/cdn/farfuture/2-H9Gx7nr6n9NkwQJB0vnOBtrdlI4iRphA7unyN6zto/mtime:1341237494/sites/default/files/border-image-repeat-HV.png" alt=""></li><li>stretch</li><li>æä¼¸</li></ul></li></ul>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS3 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>CSS3: Filter</title>
      <link href="/2016/06/23/css3-filter/"/>
      <content type="html"><![CDATA[<p>è±è¯­åæ: <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/filter" target="_blank" rel="noopener">MDN:filter</a></p><h2 id="æ»ç»"><a href="#æ»ç»" class="headerlink" title="æ»ç»"></a>æ»ç»</h2><p><strong>Filter</strong> å±æ§ç¨äºå®ç°âæ¨¡ç³â, âéåâ, âé¢è²æ¿æ¢âç­å¾åæ¸²æææ.</p><p><strong>Filter</strong> éå¸¸ç¨äºè°æ´å¾å, èæ¯, è¾¹æ¡çåç°.</p><h3 id="è¯­æ³"><a href="#è¯­æ³" class="headerlink" title="è¯­æ³"></a>è¯­æ³</h3><pre><code>filter: url(&quot;filter.svg#filter-id&quot;);filter:blur(5px);filter:brightness(.4);filter:contrast(200%);filter:drop-shadow(16px 16px 20px blue);filter:grayscale(50%);filter:hue-rotate(90deg);filter:invert(75%);filter:opacity(25%);filter:saturate(30%);filter:sepia(60%);/*Apply multiple filters*/filter: contrast(75%) brightness(3%);/*Global Values*/filter: inherit;filter:initial;filter:unset;`&lt;/pre&gt;### è®¾ç½®ä¸ç§å½æ°&lt;pre&gt;`filter: &amp;lt;filter-function&amp;gt; [&amp;lt;filter-function&amp;gt;]* | none`&lt;/pre&gt;### ç» SVG åç´  &lt;filter&gt; å¼ç¨æ»¤é&lt;pre&gt;`filter: url(svg-url#element-id)`&lt;/pre&gt;### å®ä¾&lt;pre&gt;`.mydiv{filter:grayscale(50%)}/*gray all images by 50% and blur by 10px*/img{  filter: grayscale(.5) blur(10px);}`&lt;/pre&gt;#### éè¿ url å½æ°å¼å¥ä¸ä¸ª SVG èµæº&lt;pre&gt;`.target{filter:url(#c1):}.mydiv{filter:url(commonfilters.xml#large-blur)}`&lt;/pre&gt;### å½æ°åæ°å¯ä»¥ä¼ å¥ç¾åæ°æå°æ°, 34%å.34ææç¸å&lt;pre&gt;`url(): æ¥åä¸ä¸ª XML æä»¶, è¯¥æä»¶è®¾ç½®ä¸ä¸ª SVG æ»¤é, å¹¶éè¿éç¹ç¡®å®ä¸ä¸ªå·ä½çæ»¤éåç´ filter: url(resource.svg#c1)`&lt;/pre&gt;&lt;pre&gt;`blur(): æ¥æ¶ radius å¼ä¸ºå¾åè®¾ç½®é«æ¯æ¨¡ç³, radius ä¸ºæ åå·®(px), é»è®¤ä¸º0, ä¸æ¥æ¶ç¾åæ¯`&lt;/pre&gt;&lt;pre&gt;`brightness(): ç»å¾çåºç¨ä¸ç§çº¿æ§æ©ç½, ä½¿å¶çèµ·æ¥æ´äº®ææ´æ, 0%å¯¹åºå¨é», 100%å¯¹åºåå¾, è¶è¿100%æ´äº®, é»è®¤ä¸º1;`&lt;/pre&gt;&lt;pre&gt;`contrast(): è°æ´å¾åå¯¹æ¯åº¦, 0å¯¹åºå¨é», 1å¯¹åºåå¾, å¤§äº1ååºç¨æ´ä½çå¯¹æ¯åº¦`&lt;/pre&gt;&lt;pre&gt;`drop-shadow(): ç»å¾åè®¾ç½®ä¸ä¸ªé´å½±ææ, é´å½±æ¯åæå¨å¾åä¸æ¹ç, å¯ä»¥è®¾ç½®æ¨¡ç³åº¦, å¯ä»¥ç¨ç¹å®é¢è²ç»åºé®ç½©å¾çåç§»çæ¬. å½æ°è½æ¥å&amp;lt;shadow&amp;gt;(å¨ CSS3 èæ¯ä¸­å®ä¹)ç±»åçå¼, é¤äº inset å³é®å­ä¸å¯ä½¿ç¨, ä¸ box-shadow å±æ§å¾ç¸ä¼¼.ä¸è¿éè¿æ»¤é, ä¸äºæµè§å¨ä¼æä¾ç¡¬ä»¶å éåæ°å¦ä¸:&amp;lt;offset-x&amp;gt;å&amp;lt;offset-y&amp;gt; (ä¸å¯çç¥)&amp;lt;blur-radius&amp;gt;(å¯é)&amp;lt;spread-radius&amp;gt;(å¯é)&amp;lt;color&amp;gt;(å¯é)`&lt;/pre&gt;&lt;pre&gt;`grayscale(): å°å¾åè½¬ä¸ºç°åº¦å¾å, 1å¯¹åºå®å¨ç°åº¦å¾å, 0å¯¹åºåå¾`&lt;/pre&gt;&lt;pre&gt;`hue-rotate(): ç»å¾ååºç¨è²ç¸æè½¬, &quot;angle&quot; è®¾å®å¾åä¼è¢«è°æ´çè²ç¯è§åº¦, é»è®¤ä¸º0, å¯¹åºæ åå.`&lt;/pre&gt;&lt;pre&gt;`invert(): ç¿»è½¬è¾å¥å¾å, å³åç¸, 1å¯¹åºå®å¨åç¸, 0å¯¹åºåå¾`&lt;/pre&gt;&lt;pre&gt;`opacity(): è½¬æ¢å¾åçéæç¨åº¦, 0å¯¹åºå®å¨éæ, 1å¯¹åºåå¾å CSS3 ç opacity åè½ç¸ä¼¼, ä½æ¯ä¸äºæµè§å¨ä¼æä¾ç¡¬ä»¶å é`&lt;/pre&gt;&lt;pre&gt;`saturate(): ä¿®æ¹å¾åé¥±ååº¦, 0å¯¹åºå®å¨ä¸é¥±å, 1å¯¹åºåå¾`&lt;/pre&gt;&lt;pre&gt;`sepia(): å°å¾åè½¬ä¸ºæ·±è¤è², 1å¯¹åºå®å¨æ·±è¤è², 0å¯¹åºåå¾</code></pre><p>å¤åå½æ°</p><p><code>filter: contrast(175%) brightness(3%);</code></p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS3 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Box-Shadowå°ç¨æ³</title>
      <link href="/2016/06/23/box-shadow-e5-b0-8f-e7-94-a8-e6-b3-95/"/>
      <content type="html"><![CDATA[<h2 id="box-shadow-å¸¸è§ç¨æ³"><a href="#box-shadow-å¸¸è§ç¨æ³" class="headerlink" title="box-shadow å¸¸è§ç¨æ³"></a>box-shadow å¸¸è§ç¨æ³</h2><h3 id="åºç¡è¯­æ³"><a href="#åºç¡è¯­æ³" class="headerlink" title="åºç¡è¯­æ³"></a>åºç¡è¯­æ³</h3><p><code>box-shadow</code> å±æ§åè¾¹æ¡æ·»å ä¸ä¸ªæå¤ä¸ªé´å½±;</p><p><code>box-shadow: (inset) x-offset, y-offset, blur, spread color;</code></p><h3 id="æ¨¡æå¤è¾¹æ¡"><a href="#æ¨¡æå¤è¾¹æ¡" class="headerlink" title="æ¨¡æå¤è¾¹æ¡"></a>æ¨¡æå¤è¾¹æ¡</h3><pre><code>div{  width: 100px;  height: 100px;  margin: 100px;  border:5px solid ;  box-shadow: inset 0 0 0 5px #ccc,    0 0 0 5px #333;}`&lt;/pre&gt;è¦æ³¨æ: box-shadow æ¯ç«ä¸æ¯å®éè¾¹æ¡, ä¸å æ®å®éç©ºé´, ä¹ä¸å±äº `box-sizing`èå´### æ¨¡æåéæé®ç½©å±&lt;pre&gt;`#foo{  width:200px;  height:200px;  background:#FFF;  box-shadow:0 0 0 1920px rgba(0,0,0,.5);}`&lt;/pre&gt;### å¤é box-shadow ç»å¶ç®å¾æ¡&lt;pre&gt;`&amp;lt;div class=&quot;bg&quot;&amp;gt;  &amp;lt;div class=&quot;cloud&quot;&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;.bg{  width: 100%;  height: 100px;  padding: 10px;  background-color: #00bcd4;}.cloud{  width: 50px;  height: 50px;  margin: 20px auto;  background-color: #FFF;  border-radius:50%;  box-shadow:80px 10px 0 10px #FFF,    50px 0 0 20px #FFF, 10px -10px #FFF, -10px 10px 0 10px #FFF;}`&lt;/pre&gt;### å¤é shadow å®ç°ç«ä½æ&lt;pre&gt;`&amp;lt;div&amp;gt;Solid&amp;lt;/div&amp;gt;div{  width: 200px;  line-height: 68px;  font-size: 48px;  text-align: center;  color:rgba(0,0,0,.3);  text-shadow: 1px 1px 0 rgba(0,0,0,.55),    2px 1.5px 0 rgba(0,0,0,.25),    3px 2px 0 rgba(0,0,0,.2),    4px 2.5px 0 rgba(0,0,0,.15),    5px 3px 0 rgba(0,0,0,.1);}</code></pre>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS3 </tag>
            
            <tag> Trick </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ä¼å HTML ç»æ</title>
      <link href="/2016/06/22/e4-bc-98-e5-8c-96-html-e7-bb-93-e6-9e-84/"/>
      <content type="html"><![CDATA[<h3 id="è¯­ä¹åå½å"><a href="#è¯­ä¹åå½å" class="headerlink" title="è¯­ä¹åå½å"></a>è¯­ä¹åå½å</h3><ul><li>è¯­ä¹åç HTML è½å¤ç´æ¥è¡¨ç¤ºåºæä¸ª Tag çä¸å¡åè½;</li><li>è¯­ä¹åç CSS å¯ä»¥æé«æ ·å¼çæ½è±¡ç¨åº¦, æ¹ä¾¿å¤ç¨;</li></ul><h3 id="æ¨¡åå"><a href="#æ¨¡åå" class="headerlink" title="æ¨¡åå"></a>æ¨¡åå</h3><ul><li>æé«ä»£ç å¤ç¨ç¨åº¦;</li><li>ä½¿ä¸å¡é»è¾æ´å æ¸æ°;</li></ul><h3 id="éæ©ä¸ä¸ªå¥½çå½åçº¦å®"><a href="#éæ©ä¸ä¸ªå¥½çå½åçº¦å®" class="headerlink" title="éæ©ä¸ä¸ªå¥½çå½åçº¦å®"></a>éæ©ä¸ä¸ªå¥½çå½åçº¦å®</h3><h3 id="éµå¾ªåä¸èè´£åå"><a href="#éµå¾ªåä¸èè´£åå" class="headerlink" title="éµå¾ªåä¸èè´£åå"></a>éµå¾ªåä¸èè´£åå</h3><p>SRP ååå³æ¯ä¸ªæ¨¡åæèç±»åºå½åªæ¿æç³»ç»ä¸­çæä¸ä¸ªåä¸åè½, å¹¶ä¸è¯¥åè½åºå½å®æ´å°è£èµ·æ¥. æ¯å¦ CSS ç»ç»ç»æä¸­ç Carousel, NavigationBar ç­, è¦åæç¬ç«ç CSS Component.</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS3 </tag>
            
            <tag> HTML5 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Notes on &#39;POST&#39; and &#39;GET&#39; in Form</title>
      <link href="/2016/06/22/notes-on-post-and-get-in-form/"/>
      <content type="html"><![CDATA[<p>The âmethodâ attribute in form element specifies how to send form-data(the form-data is sent to the page specified in the âactionâ attribute).</p><p>The form-data can be sent as <strong>URL variables</strong>(with <code>method=&#39;get&#39;</code>) or as <strong>HTTP Post transaction</strong>(with <code>method=&#39;post&#39;</code>).</p><h4 id="Notes-on-GET"><a href="#Notes-on-GET" class="headerlink" title="Notes on GET:"></a>Notes on GET:</h4><ul><li>Appends form-data into the URL in name-value pairs;</li><li>The length of a URL is limited(about 3000 characters);</li><li>Never use GET to send sensitive data cause they will be visible in the URL;</li><li>Useful for form submissions where a user want to bookmark the result;</li><li>GET is better than non-secure data, like query string in Google.</li></ul><h4 id="Notes-on-POST"><a href="#Notes-on-POST" class="headerlink" title="Notes on POST:"></a>Notes on POST:</h4><ul><li>Appends form-data inside the body of HTTP request(both in head-line and body);</li><li>Has no size limitation;</li><li>Form submissions with POST cannot be bookmarked.</li></ul>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HTML5 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>æ»å¨è§å·®ææ</title>
      <link href="/2016/06/20/e6-bb-9a-e5-8a-a8-e8-a7-86-e5-b7-ae-e6-95-88-e6-9e-9c/"/>
      <content type="html"><![CDATA[<p><head></head></p><p><style><br>.container{<br>  overflow-y:scroll;<br>  overflow-x:hidden;<br>  perspective:1px;<br>  transform-style:preserve-3d;<br>  color:yellow;<br>  text-align:center;<br>}<br>.bg{<br>  width: 100vw;<br>  height: 40vh;<br>  position:relative;<br>}<br>h1{<br>  padding:100px;<br>}<br>.bg:before{<br>  position:absolute;<br>  top: 0;<br>  left: 0;<br>  right: 0;<br>  bottom: 0;<br>  content:ââ;<br>  display:block;<br>  background: url(â<a href="http://7xu8mu.com1.z0.glb.clouddn.com/katong_1.jpg&quot;)">http://7xu8mu.com1.z0.glb.clouddn.com/katong_1.jpg&quot;)</a>;<br>  background-size:cover;<br>  z-index: -1;<br>  transform:translateZ(-1px) scale(2);<br>}<br></style><br></p><body><br><br><div class="container"><br>  <div class="bg"><br><br># Hello World<br><br>        åçæ¯å°å¾çæ¾å¨bg:before, ç¶åä¸º container è®¾ç½® perspective:1px å preserve-3d, å¹¶èè overflow:auto(è¦é¿å x-index åä½¿ç¨ overflow-y:scroll), ç¶åå° bg:before å Z è½´ç§»å¨-1px, å½¢æååç©ºé´<br>  </div><br></div><br><br>    /<em>HTML</em>/<br>    div.container<br>        div.bg<br>            h1{â¦}<br>            p{â¦}<br>    /<em>CSS</em>/<br>    .container{<br>      overflow-y:scroll;<br>      overflow-x:hidden;<br>      perspective:1px;<br>      transform-style:preserve-3d;<br>      color:yellow;<br>      text-align:center;<br>    }<br>    .bg{<br>      width: 100vw;<br>      height: 40vh;<br>      position:relative;<br>    }<br>    h1{<br>      padding:100px;<br>    }<br>    .bg:before{<br>      position:absolute;<br>      top: 0;<br>      left: 0;<br>      right: 0;<br>      bottom: 0;<br>      content:ââ;<br>      display:block;<br>      background: url(â<a href="http://7xu8mu.com1.z0.glb.clouddn.com/katong_1.jpg&quot;)" target="_blank" rel="noopener">http://7xu8mu.com1.z0.glb.clouddn.com/katong_1.jpg&quot;)</a>;<br>      background-size:cover;<br>      z-index: -1;<br>      transform:translateZ(-1px) scale(2);<br>    }<br><br></body>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS3 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Card Style - 1</title>
      <link href="/2016/06/20/card-style-1/"/>
      <content type="html"><![CDATA[<p><head></head></p><style>        _,_:before,*:after{            box-sizing: border-box;        }        .wrapper{            padding-top: 40px;            padding-bottom: 40px;        }        .wrapper:focus{            outline:0;        }        .clash-card{            background-color: #fff;            width: 300px;            display: inline-block;            margin:auto;            border-radius: 20px;            position:relative;            text-align: center;            box-shadow: -1px 15px 30px -12px black;            z-index: 9999;        }        .clash-card__image{            position: relative;            height: 230px;            margin-bottom: 35px;            border-top-left-radius: 20px;            border-top-right-radius: 20px;        }        .clash-card__image--barbarian{            background: url("http://7xu8mu.com1.z0.glb.clouddn.com/wp-content/uploads/barbarian-bg.jpg")        }        .clash-card__image--barbarian img{            width: 400px;            position: absolute;            top: -65px;            left: -70px;        }        .clash-card__level{            text-transform: uppercase;            font-size: 12px;            font-weight: 700;            margin-bottom: 3px;        }        .clash-card__level--barbarian{            color:#EC9B3B;        }        .clash-card__unit-name{            font-size: 26px;            color:#000;            font-weight: 900;            margin-bottom: 5px;        }        .clash-card__unit-description{            padding: 20px;            margin-bottom: 10px;        }        .clash-card__unit-stats--barbarian{            background: #EC9B3B;        }        .clash-card__unit-stats--barbarian .one-third{            border-right: 1px solid #BD7C2F;        }        .clash-card__unit-stats{            color:#fff;            font-weight: 700;            border-bottom-left-radius: 15px;            border-bottom-right-radius: 15px;            overflow: hidden;        }        .clash-card__unit-stats .one-third{            width: 33.33%;            float: left;            padding: 20px 15px;        }        .clash-card__unit-stats sup{            position: absolute;        }        .clash-card__unit-stats .stat{            position: relative;            font-size: 20px;            margin-bottom: 10px;        }        .clash-card__unit-stats .stat-value{            text-transform: uppercase;            font-weight: 400;            font-size: 12px;        }        .clash-card__unit-stats .no-border{            border-right: none;        }        .clearfix:after{            content:"";            clear:both;            visibility: hidden;            height: 0;            font-size: 0;        }    </style><body>    <div class="wrapper">        <div class="clash-card barbarian">            <div class="clash-card__image clash-card__image--barbarian">                ![barbarian](http://7xu8mu.com1.z0.glb.clouddn.com/wp-content/uploads/barbarian.png)            </div>            <div class="clash-card__level clash-card__level--barbarian">Level 5</div>            <div class="clash-card__unit-name">The Barbarian</div>            <div class="clash-card__unit-description">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Itaque, optio! Provident iure architecto atque sequi alias! Tempore alias doloremque tempora, quod enim nulla quia, saepe accusantium eius minus quisquam architecto.</div>            <div class="clash-card__unit-stats clash-card__unit-stats--barbarian clearfix">                <div class="one-third">                    <div class="stat">20<sup>s</sup></div>                    <div class="stat-value">Training</div>                </div>                <div class="one-third">                    <div class="stat">16</div>                    <div class="stat-value">Speed</div>                </div>                <div class="one-third no-border">                    <div class="stat">150</div>                    <div class="stat-value">Cost</div>                </div>            </div>        </div>    </div><pre>`    /*HTML*/    div.wrapper        div.clash-card.barbarian            div.clash-card__image.clash-card_image--barbarian                img.src            div.cash-card__level.clash-card__level--barbarian{Level 5}            div.clash-card__unit-name{The Barbarian}            div.clash-card__unit-description{...}            div.clash-card__unit-stats.clash-card__unit-stats--barbarian.clearfix                div.one-third                    div.stat{20s}                    div.stat-value{Training}                div.one-third                    div.stat{16}                    div.stat-value{Speed}                div.one-third.no-border                    div.stat{150}                    div.stat-value{Cost}    /*CSS*/    <style>        *,*:before,*:after{            box-sizing: border-box;        }        .wrapper{            padding-top: 40px;            padding-bottom: 40px;        }        .wrapper:focus{            outline:0;        }        .clash-card{            background-color: #fff;            width: 300px;            display: inline-block;            margin:auto;            border-radius: 20px;            position:relative;            text-align: center;            box-shadow: -1px 15px 30px -12px black;            z-index: 9999;        }        .clash-card__image{            position: relative;            height: 230px;            margin-bottom: 35px;            border-top-left-radius: 20px;            border-top-right-radius: 20px;        }        .clash-card__image--barbarian{            background: url("http://7xu8mu.com1.z0.glb.clouddn.com/wp-content/uploads/barbarian-bg.jpg")        }        .clash-card__image--barbarian img{            width: 400px;            position: absolute;            top: -65px;            left: -70px;        }        .clash-card__level{            text-transform: uppercase;            font-size: 12px;            font-weight: 700;            margin-bottom: 3px;        }        .clash-card__level--barbarian{            color:#EC9B3B;        }        .clash-card__unit-name{            font-size: 26px;            color:#000;            font-weight: 900;            margin-bottom: 5px;        }        .clash-card__unit-description{            padding: 20px;            margin-bottom: 10px;        }        .clash-card__unit-stats--barbarian{            background: #EC9B3B;        }        .clash-card__unit-stats--barbarian .one-third{            border-right: 1px solid #BD7C2F;        }        .clash-card__unit-stats{            color:#fff;            font-weight: 700;            border-bottom-left-radius: 15px;            border-bottom-right-radius: 15px;            overflow: hidden;        }        .clash-card__unit-stats .one-third{            width: 33.33%;            float: left;            padding: 20px 15px;        }        .clash-card__unit-stats sup{            position: absolute;        }        .clash-card__unit-stats .stat{            position: relative;            font-size: 20px;            margin-bottom: 10px;        }        .clash-card__unit-stats .stat-value{            text-transform: uppercase;            font-weight: 400;            font-size: 12px;        }        .clash-card__unit-stats .no-border{            border-right: none;        }        .clearfix:after{            content:"";            clear:both;            visibility: hidden;            height: 0;            font-size: 0;        }    </style><p>`<br></p></pre><p></p><p></p></body><p></p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS3 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Accordion With jQuery</title>
      <link href="/2016/06/20/accordion-with-jquery/"/>
      <content type="html"><![CDATA[<p><head></head></p><p><style><br>.accordion{<br>  margin:50px auto;<br>  width: 380px;<br>  cursor:pointer;<br>}<br>.accordion .item{<br>  height:100px;<br>}<br>.accordion .item h3{<br>  display:inline-block;<br>  vertical-align:middle;<br>  height: 100%;<br>  padding-left: 50px;<br>  font-size: 20px;<br>  font-weight: 400;<br>}<br>.accordion .item h3:before{<br>  content:ââ;<br>  display:inline-block;<br>  vertical-align:middle;<br>  height: 100%;<br>}<br>.accordion .item:first-of-type{<br>  background-color: #620808;<br>  color:#f4ce74;<br>}<br>.accordion .item:nth-of-type(2){<br>  background-color: #a53f3f;<br>  color:#ffe9c1;<br>}<br>.accordion .item:nth-of-type(3){<br>  background-color: #f4ce74;<br>  color:#620808;<br>}<br>.accordion p{<br>  font-family:arial;<br>  font-size: 18px;<br>  font-weight: 400;<br>  padding: 15px;<br>  display:none;<br>    margin:0;<br>  box-shadow: inset 0 3px 7px rgba(0,0,0,.2);<br>}<br>.accordion p:first-of-type{<br>  background-color: #620808;<br>  color:#f4ce74;<br>}<br>.accordion p:nth-of-type(2){<br>  background-color: #a53f3f;<br>  color:#ffe9c1;<br>}<br>.accordion p:nth-of-type(3){<br>  background-color: #f4ce74;<br>  color:#620808;<br>}<br></style><br></p><body><br><br><section class="accordion"><br>  <div class="item"><br><br>### Item1<br><br>  </div><br>  Lorem ipsum dolor sit amet, consectetur adipisicing elit. Distinctio in error ipsa facere, veritatis fuga incidunt tempore perferendis placeat. Dolore iste laborum porro possimus officia ratione rerum cumque itaque ullam.<br>  <div class="item"><br><br>### Item2<br><br>  </div><br>  Lorem ipsum dolor sit amet, consectetur adipisicing elit. Distinctio in error ipsa facere, veritatis fuga incidunt tempore perferendis placeat. Dolore iste laborum porro possimus officia ratione rerum cumque itaque ullam.<br>  <div class="item"><br><br>### Item3<br><br>  </div><br>  Lorem ipsum dolor sit amet, consectetur adipisicing elit. Distinctio in error ipsa facere, veritatis fuga incidunt tempore perferendis placeat. Dolore iste laborum porro possimus officia ratione rerum cumque itaque ullam.<br></section><br><br>    /<em>HTML</em>/<br>    section.accordion<br>        div.item<br>            h3{Item1}<br>        p{Lorem}<br>        div.item<br>            h3{Item2}<br>        p{Lorem}<br>        div.item<br>            h3{Item3}<br>        p{Lorem}<br>    /<em>CSS</em>/<br>        body{<br>      background-color: #f6704b;<br>    }<br>    <em>{<br>      margin:0;<br>      padding: 0;<br>    }<br>    .accordion{<br>      margin:50px auto;<br>      width: 380px;<br>      background-color: #ccc;<br>      cursor:pointer;<br>    }<br>    .accordion .item{<br>      height:100px;<br>    }<br>    .accordion .item h3{<br>      display:inline-block;<br>      vertical-align:middle;<br>      height: 100%;<br>      padding-left: 50px;<br>      font-size: 20px;<br>      font-weight: 400;<br>    }<br>    .accordion .item h3:before{<br>      content:ââ;<br>      display:inline-block;<br>      vertical-align:middle;<br>      height: 100%;<br>    }<br>    .accordion .item:first-of-type{<br>      background-color: #620808;<br>      color:#f4ce74;<br>    }<br>    .accordion .item:nth-of-type(2){<br>      background-color: #a53f3f;<br>      color:#ffe9c1;<br>    }<br>    .accordion .item:nth-of-type(3){<br>      background-color: #f4ce74;<br>      color:#620808;<br>    }<br>    .accordion p{<br>      font-family:arial;<br>      font-size: 18px;<br>      font-weight: 400;<br>      padding: 15px;<br>      display:none;<br>      box-shadow: inset 0 3px 7px rgba(0,0,0,.2);<br>    }<br>    .accordion p:first-of-type{<br>      background-color: #620808;<br>      color:#f4ce74;<br>    }<br>    .accordion p:nth-of-type(2){<br>      background-color: #a53f3f;<br>      color:#ffe9c1;<br>    }<br>    .accordion p:nth-of-type(3){<br>      background-color: #f4ce74;<br>      color:#620808;<br>    }<br>    /</em>jQuery*/<br>    (function($) {<br>          âuse strictâ;<br>          $(â.itemâ).on(âclickâ,function(){<br>            $(this).next().slideToggle(100);<br>            $(âpâ).not($(this).next()).slideUp(âfastâ);<br>          });<br>        }(jQuery));<br><br><script src="https://code.jquery.com/jquery-3.0.0.min.js" integrity="sha256-JmvOoLtYsmqlsWxa7mDSLMwa6dZ9rrIdtrrVYRnDRH0=" crossorigin="anonymous"></script><br><br><script><br>    (function($) {<br>      âuse strictâ;<br>      $(â.itemâ).on(âclickâ,function(){<br>        $(this).next().slideToggle(100);<br>        $(âpâ).not($(this).next()).slideUp(âfastâ);<br>      });<br>    }(jQuery));<br>  </script><br><br></body>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS3 </tag>
            
            <tag> jQuery </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>1 Dot -&gt; 3 Dots</title>
      <link href="/2016/06/19/1-dot-3-dots/"/>
      <content type="html"><![CDATA[<p><head></head></p><p><style><br>section{<br>margin:0 auto;<br>}<br>.button{<br>  display:inline-block;<br>  font-size:30px;<br>  border:1px solid maroon;<br>  padding:10px 20px;<br>  color:maroon;<br>  position:relative;<br>}<br>.button:before{<br>  position:absolute;<br>  top: 50%;<br>  left: 50%;<br>  color:transparent;<br>  content:âÂ·â;<br>  text-shadow:0 0 transparent;<br>  font-size: 1.2em;<br>  transition: text-shadow .3s,color .3s;<br>  transform:translateX(-50%);<br>}<br>.button:hover:before{<br>  color:maroon;<br>  text-shadow: 10px 0 maroon, -10px 0 maroon;<br>}<br></style><br></p><body><br><br><section><div class="button">Button</div></section><br><br>Use <code>text-shadow</code> to generate other dots.<br><br>        /<em>HTML</em>/<br>        div.button{Button}<br>        /<em>CSS</em>/<br>        .button{<br>      display:inline-block;<br>      font-size:30px;<br>      border:1px solid maroon;<br>      padding:10px 20px;<br>      color:maroon;<br>      position:relative;<br>    }<br>    .button:before{<br>      position:absolute;<br>      top: 50%;<br>      left: 50%;<br>      color:transparent;<br>      content:âÂ·â;<br>      text-shadow:0 0 transparent;<br>      font-size: 1.2em;<br>      transition: text-shadow .3s,color .3s;<br>      transform:translateX(-50%);<br>    }<br>    .button:hover:before{<br>      color:maroon;<br>      text-shadow: 10px 0 maroon, -10px 0 maroon;<br>    }<br><br></body>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS3 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Page Scroll With CSS3</title>
      <link href="/2016/06/17/page-scroll-with-css3/"/>
      <content type="html"><![CDATA[<pre><code>.st-container{    position: absolute;    width: 100%;    height: 100%;    top: 0;    left: 0;}.st-container &amp;gt; input, .st-container &amp;gt; a{    position:fixed;    bottom: 0;    width: 20%;    cursor:pointer;    font-size: 16px;    height: 34px;    line-height: 34px;}.st-container &amp;gt; input{    opacity: 0;    z-index: 1000;}.st-container &amp;gt; a{    z-index: 10;    font-weight: 700;    background: #e23a6e;    color:#fff;    text-align: center;    text-shadow: 1px 1px 1px rgba(151,24,64,.2);}.st-container:before{    content:&quot;&quot;;    position: fixed;    width: 100%;    height: 34px;    background-color: #e23a6e;    z-index: 9;    bottom: 0;}#st-control-1, #st-control-1+a{    left:0;}#st-control-2, #st-control-2+a{    left:20%;}#st-control-3, #st-control-3+a{    left:40%;}#st-control-4, #st-control-4+a{    left:60%;}#st-control-5, #st-control-5+a{    left:80%;}.st-container &amp;gt; input:checked + a,.st-container &amp;gt; input:checked:hover + a{    background-color: #821134;}.st-container &amp;gt; input:checked + a:after,.st-container &amp;gt; input:checked:hover + a:after{    bottom:100%;    border:solid transparent;    content:&quot;&quot;;    height: 0;    width: 0;    position: absolute;    pointer-events: none;    border-bottom-color: #821134;    border-width: 20px;    left:50%;    margin-left:-20px;}.st-container &amp;gt; input:hover+a:after{    border-bottom-color: #AD244F;}.st-scroll,.st-panel{    position:relative;    width: 100%;    height: 100%;}.st-scroll{    top: 0;    left: 0;    transition:all .6s ease-in-out;}.st-panel{    background-color: #fff;    overflow: hidden;}#st-control-1:checked ~ .st-scroll{ //scroll    transform:translateY(0%);}#st-control-2:checked ~ .st-scroll{ //scroll    transform: translateY(-100%);}#st-control-3:checked ~ .st-scroll{ //scroll    transform: translateY(-200%);}#st-control-4:checked ~ .st-scroll{ //scroll    transform: translateY(-300%);}#st-control-5:checked ~ .st-scroll{ //scroll    transform: translateY(-400%);}</code></pre>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS3 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Button Transition With Background-Position</title>
      <link href="/2016/06/17/button-transition-with-background-position/"/>
      <content type="html"><![CDATA[<p><head></head></p><p><style><br>button{<br>  color:maroon;<br>  border:1px solid maroon;<br>  font-size:50px;<br>  padding:20px 40px;<br>  border-radius:15px;<br>  transition-duration:0.5s;<br>  position:relative;<br>  overflow:hidden;<br>}<br>button:hover{<br>  color:#fff;<br>}<br>.left{<br>  background:-webkit-linear-gradient(left, maroon 50%, transparent 50%);<br>  background-size:200% 100%;<br>  background-position:100% 0%;<br>}<br>.left:hover{<br>  background-position:0% 0%;<br>}<br>.angle{<br>  background:-webkit-linear-gradient(225deg, maroon 50%, transparent 50%);<br>  background-size:250% 100%;<br>}<br>.angle:hover{<br>  background-position:100% 0%;<br>}<br>.close{<br>  background:-webkit-linear-gradient(left, transparent 50%, maroon 50%);<br>  background-size:200% 100%;<br>}<br>.close:after{<br>  content:ââ;<br>  position:absolute;<br>  z-index: -1;<br>  top:0;<br>  left:0;<br>  right: 0;<br>  bottom: 0;<br>  background:-webkit-linear-gradient(left, maroon 50%, transparent 50%);<br>  background-size:200% 100%;<br>  background-position:100% 0%;<br>  transition-duration:.5s;<br>}<br>.close:hover{<br>  background-position:50% 0%;<br>}<br>.close:hover:after{<br>  background-position:50% 0%;<br>}<br>}<br></style><br></p><body><br>  <button class="left">Left</button><br><br>  <button class="angle">Angle</button><br><br>  <button class="close">Close</button><br><br><pre><code>button{  color:maroon;  border:1px solid maroon;  font-size:50px;  padding:20px 40px;  border-radius:15px;  transition-duration:0.5s;  position:relative;  overflow:hidden;}button:hover{  color:#fff;}.left{  background:-webkit-linear-gradient(left, maroon 50%, transparent 50%);  background-size:200% 100%;  background-position:100% 0%;}.left:hover{  background-position:0% 0%;}.angle{  background:-webkit-linear-gradient(225deg, maroon 50%, transparent 50%);  background-size:250% 100%;}.angle:hover{  background-position:100% 0%;}.close{  background:-webkit-linear-gradient(left, transparent 50%, maroon 50%);  background-size:200% 100%;}.close:after{  content:&quot;&quot;;  position:absolute;  z-index: -1;  top:0;  left:0;  right: 0;  bottom: 0;  background:-webkit-linear-gradient(left, maroon 50%, transparent 50%);  background-size:200% 100%;  background-position:100% 0%;  transition-duration:.5s;}.close:hover{  background-position:50% 0%;}.close:hover:after{  background-position:50% 0%;}}&lt;/pre&gt;</code><br></pre></body>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS3 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>å¾çç¿»è½¬+æå­ç¿»è½¬ç¹æ</title>
      <link href="/2016/06/17/e5-9b-be-e7-89-87-e7-bf-bb-e8-bd-ac-e6-96-87-e5-ad-97-e7-bf-bb-e8-bd-ac-e7-89-b9-e6-95-88/"/>
      <content type="html"><![CDATA[<head><br><style><br>.box{<br>  position:relative;<br>  perspective: 1000px;<br>  text-align:center;<br>}<br>.box img{<br>  width:200px;<br>  height:auto;<br>  opacity:1;<br>  transform:translateY(0) rotateX(0);<br>  transition: all 1s ease-in-out 0s;<br>}<br><br>.box:hover img{<br>  transform: translateY(-100%) rotateX(90deg);<br>  transform-origin: center bottom 0;<br>  opacity:0;<br>}<br><br>.box .over-layer{<br>  position:absolute;<br>  top:0;<br>  left:0;<br>  width:100%;<br>  height:100%;<br>  transform: translateY(100%) rotateX(-90deg);<br>    opacity:0;<br>  transform-origin:top center;<br>  transition: all 1s ease-in-out;<br>}<br>.box:hover .over-layer{<br>  transform: translateY(0) rotateX(0);<br>    opacity:1;<br>}<br></style><br></head><body><br><br><div><br>    <div class="box"><br>        <img src="http://a1.att.hudong.com/75/68/05300000467416128543684500954.jpg" alt="èå¨ä¸½è"><br>    <div class="over-layer"><br><br>### Web Designer<br><br>Description<br><br>    </div><br>    </div><br></div><br><br></body><pre><code>/*HTML*/    div.box        img[src=&quot;...&quot;]        div.over-layer            h3            p/*CSS*/.box{  position:relative;  perspective: 1000px;  text-align:center;}.box img{  width:200px;  height:auto;  opacity:1;  transform:translateY(0) rotateX(0);  transition: all 1s ease-in-out 0s;}.box:hover img{  transform: translateY(-100%) rotateX(90deg);  transform-origin: center bottom 0;  opacity:0;}.box .over-layer{  position:absolute;  top:0;  left:0;  width:100%;  height:100%;  transform: translateY(100%) rotateX(-90deg);    opacity:0;  transform-origin:top center;  transition: all 1s ease-in-out;}.box:hover .over-layer{  transform: translateY(0) rotateX(0);    opacity:1;}</code></pre>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>è½¬è§è·é©¬ç¯</title>
      <link href="/2016/06/16/e8-bd-ac-e8-a7-92-e8-b7-91-e9-a9-ac-e7-81-af/"/>
      <content type="html"><![CDATA[<head><br><style><br>.marquee{<br>  margin-top:3rem;<br>  perspective:500px;<br>  font-size:0;<br>  font-family:âMicrosoft YaHeiâ, âSegoe UIâ, âLucida Grandaâ, Helvetica, Arial;<br>}<br><br>.marquee div{<br>  display:inline-block;<br>  height:12rem;<br>  width:30rem;<br>  position:relative;<br>}<br>.marquee div{<br>  font-size:8rem;<br>  overflow:hidden;<br>}<br>.marquee div span{<br>  position:absolute;<br>  width:400%;<br>  line-height:1.4;<br>}<br>.marquee div:first-of-type{<br>  background:#e5233e;<br>  transform-origin: top right;<br>  transform: rotateY(-40deg);<br>  color:#fff;<br>}<br>.marquee div:last-of-type{<br>  background:#b31e31;<br>  transform-origin:top left;<br>  transform:rotateY(45deg);<br>  color:#f8c9d9;<br>}<br>@keyframes leftcrawl{<br>  to{   transform:translateX(-100rem);<br>}<br>}<br>@keyframes rightcrawl{<br>  to{<br>    transform:translateX(-100rem);}<br>}<br><br>.marquee div:first-of-type span{<br>  transform:translateX(60rem);<br>  animation:leftcrawl 14s linear infinite;<br>  text-shadow:4px 0 4px rgba(0,0,0,0.3);<br>}<br>.marquee div:last-of-type span{<br>  transform:translateX(43rem);<br>  animation:rightcrawl 14s ease-out infinite;<br>}<br>}<br></style><br></head><body><br><br><div class="marquee"><br>    <div><span> è·é©¬ç¯</span></div><br>    <div aria-hidden="true"><span> è·é©¬ç¯</span></div><br>  </div><br><br><pre><br><code>/*HTML*/div.marquee    div&gt;span{è·é©¬ç¯}    div&gt;span{è·é©¬ç¯}/*CSS*/.marquee{  margin-top:3rem;  perspective:500px;  font-size:0;  font-family:&quot;Microsoft YaHei&quot;, &quot;Segoe UI&quot;, &quot;Lucida Granda&quot;, Helvetica, Arial;}.marquee div{  display:inline-block;  height:12rem;  width:30rem;  position:relative;}.marquee div{  font-size:8rem;  overflow:hidden;}.marquee div span{  position:absolute;  width:400%;  line-height:1.4;}.marquee div:first-of-type{  background:#e5233e;  transform-origin: top right;  transform: rotateY(-40deg);  color:#fff;}.marquee div:last-of-type{  background:#b31e31;  transform-origin:top left;  transform:rotateY(45deg);  color:#f8c9d9;}@keyframes leftcrawl{  to{   transform:translateX(-100rem);}}@keyframes rightcrawl{  to{    transform:translateX(-100rem);}}.marquee div:first-of-type span{  transform:translateX(60rem);  animation:leftcrawl 14s linear infinite;  text-shadow:4px 0 4px rgba(0,0,0,0.3);}.marquee div:last-of-type span{  transform:translateX(43rem);  animation:rightcrawl 14s ease-out infinite;}}</code><br></pre><br><br></body>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS3 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>CSS Cube Transform</title>
      <link href="/2016/06/16/css-cube-transform/"/>
      <content type="html"><![CDATA[<p><head></head></p><p><style><br>.container{<br>  width:200px;<br>  height:200px;<br>  position:relative;<br>  perspective:1000px;<br>    margin:0 auto;<br>}<br>.cube{<br>  width:100%;<br>  height:100%;<br>  position:absolute;<br>  transform-style:preserve-3d;<br>}<br>.cube figure{<br>  width:196px;<br>  height:196px;<br>  border:2px solid #ccc;<br>  position:absolute;<br>  font-size:20px;<br>  line-height:196px;<br>  font-weight:bold;<br>  color:white;<br>  text-align:center;<br>  transition:transform 1s ease;<br>}<br>.cube:hover .front{<br>  background: hsla(   0, 100%, 50%, 0.5 );<br>  transform:translateZ(100px);<br>}<br>.cube:hover .back{<br>  background: hsla(  60, 100%, 50%, 0.5 );<br>  transform:rotateY(180deg) translateZ(100px);<br>}<br>.cube:hover .right{<br>  background: hsla( 120, 100%, 50%, 0.5 );<br>  transform: rotateY(90deg) translateZ(100px);<br>}</p><p>.cube:hover .left{<br>  background: hsla( 180, 100%, 50%, 0.5 );<br>  transform: rotateY(-90deg) translateZ(100px);<br>}<br>.cube:hover .top{<br>  background: hsla( 240, 100%, 50%, 0.5 );<br>  transform: rotateX(90deg) translateZ(100px);<br>}<br>.cube:hover .bottom{<br>  background: hsla( 300, 100%, 50%, 0.5 );<br>  transform: rotateX(-90deg) translateZ(100px);<br>}<br></style><br></p><body><br><br><div><br><div class="container"><br>  <div class="cube"><br>    <figure class="front">Front</figure><br>    <figure class="back">Back</figure><br>    <figure class="right">Right</figure><br>    <figure class="left">Left</figure><br>    <figure class="top">Top</figure><br>    <figure class="bottom">Bottom</figure><br>  </div><br></div><br><strong>Notice</strong>, when the rotate applied to the element, its coordinates will rotate with it. In this case, all Z-indices rotate to pointing outside the cube.<br><pre><br><code>/*HTML*/div.container    div.cube        fiture.front{Front}        fiture.back{Back}        fiture.right{Right}        figure.left{Left}        figure.top{Top}        figure.bottom{Bottom}/*CSS*/.container{  width:200px;  height:200px;  position:relative;  perspective:1000px;}.cube{  width:100%;  height:100%;  position:absolute;  transform-style:preserve-3d;}.cube figure{ //Set single Aspect  width:196px;  height:196px;  border:2px solid #ccc;  position:absolute;  font-size:20px;  line-height:196px;  font-weight:bold;  color:white;  text-align:center;  transition:transform 1s ease;}.cube:hover .front{   background: hsla(   0, 100%, 50%, 0.5 );   transform:translateZ(100px);}.cube:hover .back{   background: hsla(  60, 100%, 50%, 0.5 );  transform:rotateY(180deg) translateZ(100px);}.cube:hover .right{   background: hsla( 120, 100%, 50%, 0.5 );  transform: rotateY(90deg) translateZ(100px);}.cube:hover .left{  background: hsla( 180, 100%, 50%, 0.5 );  transform: rotateY(-90deg) translateZ(100px);}.cube:hover .top{   background: hsla( 240, 100%, 50%, 0.5 );   transform: rotateX(90deg) translateZ(100px);}.cube:hover .bottom{   background: hsla( 300, 100%, 50%, 0.5 );  transform: rotateX(-90deg) translateZ(100px);}</code><br></pre><br></div><br><br></body>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>CSS Progress Bar</title>
      <link href="/2016/06/16/css-progress-bar/"/>
      <content type="html"><![CDATA[<p><head><style><br>.wrapper{<br>  position:relative;<br>  overflow:visible;<br>  width:500px;<br>  margin:0 auto;<br>}<br>.bar{<br>  border:1px solid maroon;<br>  margin:40px 30px;<br>  padding: 8px 0;<br>  height:55px;<br>  background: maroon;<br>  background: -webkit-linear-gradient(left, maroon 50%, #fff 50%);<br>  background-size:200% 100%;<br>  background-position: 100% 0%;<br>  -webkit-animation: AnimationName 10s ease infinite;<br>}<br>@keyframes AnimationName{<br>  100%{<br>    background-position:0% 0%;<br>  }}<br>.text{<br>  font-size:22px;<br>  margin:15px 0;<br>  text-align:center;<br>  text-transform:uppercase;<br>  text-weight:bold;<br>  background: -webkit-linear-gradient(left, #fff 50%, maroon 50%);<br>  background-size:200% 100%;<br>  background-position: 100% 0%;<br>  -webkit-background-clip:text;<br>  -webkit-text-fill-color: transparent;<br>  animation: AnimationName 10s ease infinite;<br>}<br></style></head></p><body><br><br><div class="wrapper"><br>  <div class="bar"><br><br>      Loading Bar<br><br>  </div><br></div><br><br>    .bar{<br>      border:1px solid maroon;<br>      margin:40px 30px;<br>      padding: 8px 0;<br>      height:55px;<br>      background: maroon;<br>      background: -webkit-linear-gradient(left, maroon 50%, #fff 50%);<br>      background-size:200% 100%;<br>      background-position: 100% 0%;<br>      -webkit-animation: AnimationName 10s ease infinite;<br>    }<br>    @keyframes AnimationName{<br>      100%{<br>        background-position:0% 0%;<br>      }}<br><br>    .text{<br>      font-size:22px;<br>      margin:15px 0;<br>      text-align:center;<br>      text-transform:uppercase;<br>      text-weight:bold;<br>      background: -webkit-linear-gradient(left, #fff 50%, maroon 50%);<br>      background-size:200% 100%;<br>      background-position: 100% 0%;<br>      -webkit-background-clip:text;<br>      -webkit-text-fill-color: transparent;<br>      animation: AnimationName 10s ease infinite;<br>    }<br><br></body>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS3 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Text Gradient</title>
      <link href="/2016/06/16/text-gradient/"/>
      <content type="html"><![CDATA[<p><head></head></p><p><style><br>.background{<br>  background:#04161f;<br>  font-family:âLatoâ, sans-serif;<br>  margin:3em auto;<br>  max-width:50em;<br>}<br>.grad1{<br>  display:inline-block;<br>  font-size: 96px;<br>  margin:0;<br>  opacity:0.9;<br>  background:#fff;<br>  color:black;<br>  position:relative;<br>  text-shadow:1px 1px 0px #04161f, 1px 1px 0px #04161f, -1px -1px 0px #04161f;<br>}<br>.grad1:before, .grad1:after{<br>  position:absolute;<br>  top:0;<br>  right:0;<br>  bottom:0;<br>  left:0;<br>  pointer-events:none;<br>}<br>.grad1:before{<br>  background: -webkit-linear-gradient(left, #23966c, #faaa54, #e23b4a, #db0768, #350670);<br>  content:ââ;<br>  display:block;<br>  mix-blend-mode:screen;<br>}<br>.grad1:after{<br>  content:âCSS Gradientâ;<br>  background:#04161f;<br>  color:#fff;<br>  mix-blend-mode:multiply;<br>}<br>.grad2{<br>  font-size:72px;<br>  background:-webkit-linear-gradient(left, #23966c, #faaa54, #e23b4a, #db0768, #350670);<br>  -webkit-background-clip:text;<br>  -webkit-text-fill-color:transparent;<br>}<br></style><br></p><body><ol><li><p>Mix-Blend-Mode</p><div class="background grad1">CSS Gradient</div><p>body{<br>  background:#04161f;<br>  font-family:âLatoâ, sans-serif;<br>  margin:3em auto;<br>  max-width:50em;<br>}<br>.grad1{<br>  display:inline-block;<br>  font-size: 96px;<br>  margin:0;<br>  opacity:0.9;<br>  background:#fff;<br>  color:black;<br>  position:relative;<br>  text-shadow:1px 1px 0px #04161f, 1px 1px 0px #04161f, -1px -1px 0px #04161f;<br>}<br>.grad1:before, .grad1:after{<br>  position:absolute;<br>  top:0;<br>  right:0;<br>  bottom:0;<br>  left:0;<br>  pointer-events:none;<br>}<br>.grad1:before{<br>  background: -webkit-linear-gradient(left, #23966c, #faaa54, #e23b4a, #db0768, #350670);<br>  content:ââ;<br>  display:block;<br>  mix-blend-mode:screen;<br>}<br>.grad1:after{<br>  content:âCSS Gradientâ;<br>  background:#04161f;<br>  color:#fff;<br>  mix-blend-mode:multiply;<br>}<br>`</p></li><li>-webkit-background-clip + -webkit-text-fill-mode<br><div class="background"><div class="grad2">CSS Gradient</div></div><br><pre>`<br>.grad2{<br>  font-size:72px;<br>  background:-webkit-linear-gradient(left, #23966c, #faaa54, #e23b4a, #db0768, #350670);<br>  -webkit-background-clip:text;<br>  -webkit-text-fill-color:transparent;<br>}</pre></li></ol></body>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS3 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>CSS3 ä¸­ç Pointer-Events å±æ§</title>
      <link href="/2016/06/15/css3-e4-b8-ad-e7-9a-84-pointer-events-e5-b1-9e-e6-80-a7/"/>
      <content type="html"><![CDATA[<h3 id="åè½"><a href="#åè½" class="headerlink" title="åè½:"></a>åè½:</h3><ul><li>é»æ­¢ç¨æ·çç¹å»äº§çä»»ä½ææ</li><li>é»æ­¢é»è®¤é¼ æ æéæ ·å¼çæ¾ç¤º(æ¯å¦æ¾å¨<code>&amp;lt;a&amp;gt;</code>ä¸ä¸ä¼åæ<code>pointer</code>)</li><li>é»æ­¢ CSS éç<code>hover</code> å<code>active</code>ç¶æççå¬*   é»æ­¢è§¦å JS äºä»¶(åä¸)</li></ul>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS3 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>CSS3 Transitions Basics</title>
      <link href="/2016/06/15/css3-transitions-basics/"/>
      <content type="html"><![CDATA[<h3 id="Benefits-of-CSS-3"><a href="#Benefits-of-CSS-3" class="headerlink" title="Benefits of CSS 3"></a>Benefits of CSS 3</h3><ol><li>CSS3 Transitions are natively handled by the browser, which means they are always faster than a comparable JS animation.</li><li>JS animation is more difficult.</li></ol><h3 id="Bezier-Timing-Functions"><a href="#Bezier-Timing-Functions" class="headerlink" title="Bezier Timing Functions"></a>Bezier Timing Functions</h3><p>CSS3 has a <code>transition-timing-function</code> property which accepts keywords like <code>ease</code>, <code>ease-in</code>, and <code>linear</code>.</p><p>However we can define our own timing function using a <code>cubic-bezier</code> value. It sounds and looks complicated but can be explained with some simple diagrams.</p><ol><li><code>linear</code> curse<br><img src="http://blogs.sitepointstatic.com/images/tech/855-css3-transitions-3-chart1.png" alt=""></li><li><code>ease-in-out</code> curse<br><img src="http://blogs.sitepointstatic.com/images/tech/855-css3-transitions-3-chart2.png" alt=""><br>it starts slowly, about 12% of the animation is completed in the first 25% of time;<br>it ends slowly, about 12 % of the animation is completed in the last 25% of time</li></ol><h4 id="Whatâs-a-Bezier-Curve"><a href="#Whatâs-a-Bezier-Curve" class="headerlink" title="Whatâs a Bezier Curve"></a>Whatâs a Bezier Curve</h4><p><img src="http://upload.wikimedia.org/wikipedia/commons/thumb/f/ff/Bezier_3_big.gif/240px-Bezier_3_big.gif" alt=""></p><p>Since the animation line starts at (0, 0) and ends at (1, 1), we just need to define the points P0 and P1 in the cubic bezier value, e.g.</p><pre><code>cubic-bezier(p0x, p0y, p1x, p1y);transition-timing-function: cubic-bezier(0.25, 0.25, 0.75, 0.75) //lineartransition-timing-function: cubic-bezier(0.42,0,0.58,1) //ease-in-out`&lt;/pre&gt;&lt;pre&gt;`transition-timing-function: cubic-bezier(0.5, -0.5, 0.5, 1.5) // invalid, points cannot locate outsite (0,1)</code></pre><p><img src="http://blogs.sitepointstatic.com/images/tech/855-css3-transitions-3-chart4.png" alt=""></p><h4 id="Let-the-Tools-do-the-Work"><a href="#Let-the-Tools-do-the-Work" class="headerlink" title="Let the Tools do the Work"></a>Let the Tools do the Work</h4><p><a href="http://cubic-bezier.com/" target="_blank" rel="noopener">cubic-bezier.com</a></p><p><a href="http://matthewlein.com/ceaser/" target="_blank" rel="noopener">Ceaser</a></p><h3 id="Transition-Property-Basics"><a href="#Transition-Property-Basics" class="headerlink" title="Transition Property Basics"></a>Transition Property Basics</h3><h4 id="Which-CSS-Properties-can-be-animated"><a href="#Which-CSS-Properties-can-be-animated" class="headerlink" title="Which CSS Properties can be animated?"></a>Which CSS Properties can be animated?</h4><ul><li>width</li><li>padding</li><li>color</li><li>top</li><li>border-radius</li><li>transform</li><li>all</li></ul><p>you can set one or more to property <code>transition-property</code></p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS3 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>å¤§å¬å¸æä¹å¼ååé¨ç½²åç«¯ä»£ç </title>
      <link href="/2016/06/14/e5-a4-a7-e5-85-ac-e5-8f-b8-e6-80-8e-e4-b9-88-e5-bc-80-e5-8f-91-e5-92-8c-e9-83-a8-e7-bd-b2-e5-89-8d-e7-ab-af-e4-bb-a3-e7-a0-81/"/>
      <content type="html"><![CDATA[<h6 id="åæåºå¤-fouber"><a href="#åæåºå¤-fouber" class="headerlink" title="åæåºå¤: fouber"></a>åæåºå¤: <a href="https://github.com/fouber/blog/issues/6" target="_blank" rel="noopener">fouber</a></h6><p>ä¸ªäººæ»ç»</p><p><img src="https://raw.githubusercontent.com/fouber/blog/master/assets/resource/01.png" alt=""></p><p>å¾ä¸­ a.css æ¯é¡µé¢ index.html çæ ·å¼, å¯¹äºé«è®¿é®éçé¡µé¢èè¨, æ¯æ¬¡è®¿é® index.html é½éè¦è¯·æ± a.css, ä¼å¾å½±åæ§è½.</p><p>å æ­¤æä»¬å¸æè¿æ ·å®æ</p><p><img src="https://raw.githubusercontent.com/fouber/blog/master/assets/resource/03.png" alt=""></p><p>å©ç¨304, è®©æµè§å¨ä½¿ç¨æ¬å°ç¼å­: 304å«ååç¼å­, ä»ç¶éè¦åæå¡å¨éä¿¡ä¸æ¬¡</p><p>è¿ä¸æ­¥ä¼å, å¼ºå¶æµè§å¨ä½¿ç¨æ¬å°ç¼å­( cache-control/expires ), ä¸éè¦åæå¡å¨çå¿äº</p><p><img src="https://raw.githubusercontent.com/fouber/blog/master/assets/resource/04.png" alt=""></p><p>æ°çé®é¢: æµè§å¨ä¸åéèµæºè¯·æ±, å¦ä½æ´æ°ç¼å­?</p><p><strong>éè¿æ´æ°é¡µé¢ä¸­å¼ç¨çèµæºè·¯å¾, è®©æµè§å¨ä¸»å¨æ¾å¼ç¼å­, å è½½æ°èµæº</strong></p><p><img src="https://raw.githubusercontent.com/fouber/blog/master/assets/resource/05.png" alt=""></p><p>ä¸æ¬¡ä¸çº¿æé¾æ¥å°åæ¹ææ°çæ¬ç, å°±æ´æ°äºèµæº</p><p>å¦ææå¾å¤æ ·å¼å¼ç¨, ä½æ¯ä»ä»æ¹äºå¶ä¸­ä¸ä¸ªå¢?</p><p><img src="https://raw.githubusercontent.com/fouber/blog/master/assets/resource/07.png" alt=""></p><p>è§£å³æ¹æ³: è®©url çä¿®æ¹ä¸æä»¶åå®¹å³è, å³åªææä»¶åå®¹åçåå, æä¼æ´æ° url</p><p>å©ç¨<strong>æ°æ®æè¦ç®æ³</strong>å¯¹æä»¶è¯·æ±æè¦ä¿¡æ¯, æè¦ä¿¡æ¯åæä»¶åå®¹ä¸ä¸å¯¹åº, å°±æäºä¸ç§å¯ä»¥ç²¾ç¡®å°åä¸ªæä»¶ç²åº¦çç¼å­æ§å¶ä¾æ®.</p><p>æ URL æ¹æå¸¦æè¦ä¿¡æ¯çæ ¼å¼:</p><p><img src="https://raw.githubusercontent.com/fouber/blog/master/assets/resource/08.png" alt=""></p><p>ä»¥åå¦ææä»¶ä¿®æ¹, å°±åªæ´æ°å¯¹åºç URL äº</p><h4 id="è¿ä¸æ­¥æé«ç½ç«æ§è½"><a href="#è¿ä¸æ­¥æé«ç½ç«æ§è½" class="headerlink" title="è¿ä¸æ­¥æé«ç½ç«æ§è½"></a>è¿ä¸æ­¥æé«ç½ç«æ§è½</h4><p>æéæèµæºåå¨æç½é¡µåéç¾¤é¨ç½², éæèµæºä¼è¢«é¨ç½²å° CDN èç¹ä¸, ç½é¡µä¸­å¼ç¨çèµæºä¹ä¼åæå¯¹åºçé¨ç½²è·¯å¾</p><p><img src="https://raw.githubusercontent.com/fouber/blog/master/assets/resource/09.png" alt=""></p><p>éæèµæºä¼åæ¹æ¡</p><ul><li>éç½®è¶é¿æ¶é´çæ¬å°ç¼å­ â èçå¸¦å®½, æé«æ§è½</li><li>éç¨åå®¹æè¦ä½ä¸ºç¼å­æ´æ°ä¾æ® â ç²¾ç¡®æ§å¶ç¼å­</li><li>éæèµæº CDN é¨ç½² â ä¼åç½ç»è¯·æ±</li><li>æ´æ°èµæºåå¸è·¯å¾å®ç°éè¦çå¼åå¸ â å¹³æ»åçº§</li></ul>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>CSS æ·»å æ¡çº¹èæ¯</title>
      <link href="/2016/06/14/css-e6-b7-bb-e5-8a-a0-e6-9d-a1-e7-ba-b9-e8-83-8c-e6-99-af/"/>
      <content type="html"><![CDATA[<head><br><style><br>.bg{<br>  height:300px;<br>  width:300px;<br>    color:#fff;<br>}<br>.type1{<br>  background: linear-gradient(#fb3 20%, #58a 80%);<br>}<br>.type2{<br>background: linear-gradient(#fb3 50%, #58a 50%);<br>}<br>.type3{<br>background-size:100% 30px;<br>}<br>.type4{<br>  background: linear-gradient(45deg, #fb3 50%, #58a 50%);<br>  background-size:30px 30px;<br>}<br>.type5{<br>  background: repeating-linear-gradient(45deg, #fb3, #58a 30px)<br>}<br>.type6{<br>  background: #58a;<br>  background-image: repeating-linear-gradient(45deg, hsla(0,0%,100%,.1),hsla(0,0%,100%,.1) 15px,transparent 0, transparent 30px);<br>}<br>    </style><br>    </head><pre><code>&amp;lt;body&amp;gt;&amp;lt;div class=&quot;bg type1&quot;&amp;gt;background: linear-gradient(#fb3 20%, #58a 80%);&amp;lt;br&amp;gt;</code></pre><p>æ´ä¸ªèæ¯ä¸ä¸åæ20%ççº¯è², ä¸­é´æ¯è¿æ¸¡é¢è²</p><div class="bg type2">background: linear-gradient(#fb3 50%, #58a 50%);<br><br>ä¸ä¸ä¸¤é¨åé½æ¯çº¯è²</div><div class="bg type2 type3">æ·»å  background-size:100% 30px;<br><br>  å®½100%, é«30px, é»è®¤ repeat<br></div><div class="bg type4">æåæ¡çº¹<br><br>ä¿®æ¹ linear-gradient çè§åº¦: linear-gradient(45deg, #fb3 50%, #58a 50%)<br><br>æ·»å éå¤:background-size:30px;</div><div class="bg type5">ä½¿ç¨ repeat-linear-gradient:<br><br>background: repeating-linear-gradient(45deg, #fb3, #58a 30px)<br></div><p>&lt;</p><p>div class=âbg type6â&gt;<br>å³äºé¢è²è®¾å®, å¦ææä»¬å¸ææ¡çº¹ä½¿ç¨ç¸è¿çé¢è², å¯ä»¥ä½¿ç¨å¦ä¸æ¹æ³:</p><p>background: #58a;</p><p>background-image: repeating-linear-gradient(30deg, hsla(0,0%,100%,.1),hsla(0,0%,100%,.1) 15px,transparent 0, transparent 30px);</p><p>å¶åçæ¯æå®èæ¯ä¸­ææ·±çé¢è², å¶ä»é¢è²ç¨éæåº¦è°æ´</p><p>&lt;</p><p>div&gt;</p><p></p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS3 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>CSS ä¸­ç Clear</title>
      <link href="/2016/06/13/css-e4-b8-ad-e7-9a-84-clear/"/>
      <content type="html"><![CDATA[<h3 id="ä¸ºä»ä¹è¦æ¸é¤æµ®å¨"><a href="#ä¸ºä»ä¹è¦æ¸é¤æµ®å¨" class="headerlink" title="ä¸ºä»ä¹è¦æ¸é¤æµ®å¨"></a>ä¸ºä»ä¹è¦æ¸é¤æµ®å¨</h3><p>ä¸ä¸ªåçº§åç´ çå¦ææ²¡æè®¾ç½® <code>height</code>, åå¶é«åº¦ç±å¶å­åç´ æå¼. å¦æææå­åç´ é½æ¯æµ®å¨ç(è±ç¦»æ åææ¡£æµ), é£ä¹ç¶åç´ å°±ä¼åçâåå¡â.</p><h3 id="ä¸¤ç§æåµ"><a href="#ä¸¤ç§æåµ" class="headerlink" title="ä¸¤ç§æåµ"></a>ä¸¤ç§æåµ</h3><p>æ¸é¤æµ®å¨åæ¬æ¸é¤<strong>å­åç´ æµ®å¨</strong>åæ¸é¤<strong>ä¸çº§åç´ æµ®å¨</strong>, å¦æè¦æ¸é¤ä¸çº§åç´ æµ®å¨, åªéè¦è®¾ç½® clear:both å³å¯.<br>å¦æè¦æ¸é¤å­åç´ æµ®å¨, å¯ä»¥ç¨ç©ºæ ç­¾æ³, clearfix æ³æè overflow æ³.</p><h5 id="clear-çç¨æ³"><a href="#clear-çç¨æ³" class="headerlink" title="clear çç¨æ³"></a>clear çç¨æ³</h5><pre><code>.subElement{    clear:both; }`&lt;/pre&gt;##### clearfix(æä¼æµ®å¨é­åæ¹æ¡)ç¶åç´ æ·»å  class=clearfixç®æ´ç&lt;pre&gt;`.clearfix:before, .clearfix:after{  content:&quot;&quot;;    display:table;}.clearfix:after{  clear:both;    overflow:hidden;}.clearfix{  zoom:1;}`&lt;/pre&gt;ç»å¸ç&lt;pre&gt;`.clearfix:after{  display:block;    content:&quot;&quot;;    clear:both;    height:0;    visibility:hidden}`&lt;/pre&gt;ä½¿ç¨æ¶å¨æµ®å¨åç´ çç¶åç´ ä¸æ·»å  class=&quot;clearfix&quot;#### ç®åçæ¹æ³&lt;pre&gt;`.clearfix{  overflow:auto;  _height:1%;}`&lt;/pre&gt;#### å¸¸ç¨çæ¹æ³&lt;pre&gt;`.clearfix{  clear:both;  height:0;  overflow:hidden;}</code></pre><p>å¨éè¦æ¸é¤æµ®å¨çå°æ¹å ä¸ä¸ä¸ª div.clear æè br.clear(ä¸æ¯å¥ä¸)</p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS3 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>4 Simple Transitions of Button</title>
      <link href="/2016/05/29/4-simple-transitions-of-button/"/>
      <content type="html"><![CDATA[<h1 id="4-Simple-CSS-Transition-to-Enchance-Your-Buttons"><a href="#4-Simple-CSS-Transition-to-Enchance-Your-Buttons" class="headerlink" title="4 Simple CSS Transition to Enchance Your Buttons"></a>4 Simple CSS Transition to Enchance Your Buttons</h1><h2 id="Darken"><a href="#Darken" class="headerlink" title="Darken"></a>Darken</h2><p>Set a darker shade background color when <code>:hover</code> is activated</p><h2 id="Fade-Out"><a href="#Fade-Out" class="headerlink" title="Fade Out"></a>Fade Out</h2><p>Set opacity to 1 by default, and reduce the opacity when <code>:hover</code> is activated.</p><h2 id="Change-Color"><a href="#Change-Color" class="headerlink" title="Change Color"></a>Change Color</h2><h2 id="Inset-Border"><a href="#Inset-Border" class="headerlink" title="Inset Border"></a>Inset Border</h2><p>To create an inset of border,</p><pre><code>button: hover{  box-shadow: inset 0 0 0 5px #darkderColor;}</code></pre>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS3 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>åªä½æ¥è¯¢</title>
      <link href="/2016/05/28/e5-aa-92-e4-bd-93-e6-9f-a5-e8-af-a2/"/>
      <content type="html"><![CDATA[<h2 id="è¯­æ³"><a href="#è¯­æ³" class="headerlink" title="è¯­æ³"></a>è¯­æ³</h2><p><strong>åªä½æ¥è¯¢</strong>åæ¬ä¸ä¸ª<strong>åªä½ç±»å</strong>åè³å°ä¸ä¸ª<strong>åªä½å±æ§</strong>, è¿äº<strong>åªä½å±æ§</strong>ä¼è¢«è§£ææçæå.</p><p>å½åªä½æ¥è¯¢ä¸ºçæ¶, ç¸å³çæ ·å¼è¡¨ææ ·å¼è§åå°±ä¼æç§æ­£å¸¸ççº§èè§åè¢«åºç¨.</p><p>å³ä½¿åªä½æ¥è¯¢çç»æä¸ºå, <code>&amp;lt;link&amp;gt;</code>æ ç­¾ä¸å¸¦æåªä½æ¥è¯¢çæ ·å¼è¡¨ä»ç¶ä¼è¢«ä¸è½½.</p><h2 id="é»è¾æä½ç¬¦"><a href="#é»è¾æä½ç¬¦" class="headerlink" title="é»è¾æä½ç¬¦"></a>é»è¾æä½ç¬¦</h2><p>æä½ç¬¦ not, and å only, å¯ä»¥ç¨æ¥æå»ºå¤æçåªä½æ¥è¯¢</p><p>éå·åéç¬¦ç¸å½äº or æä½ç¬¦, å¶ä¸­ä¸ä¸ªä¸ºç, ååªä½æ¥è¯¢ç»æä¸ºç</p><p>ä¸ä¸ªåºæ¬çåªä½æ¥è¯¢, å³ä¸ä¸ªåªä½å±æ§ä¸é»è®¤æå®ç all åªä½ç±»å, å¯è½æ¯è¿æ ·å­:</p><pre><code>@media (min-width: 700px) {...}`&lt;/pre&gt;å¦æè¦æ·»å æ¨ªå±éå¶&lt;pre&gt;`@media (min-width: 700px) and (orientation: landscape) {...}`&lt;/pre&gt;### notnot å³é®å­åºç¨äºæ´ä¸ªåªä½æ¥è¯¢, å¦&lt;pre&gt;`@media not all and (monochrome){...} ç­ä»·äº@media not (all and (monochrome)) {...}`&lt;/pre&gt;å¨éå·åªä½æ¥è¯¢åè¡¨ä¸­, not ä»å¦å®ä»æå¨ç item.## åªä½å±æ§å¤§å¤æ°åªä½å±æ§é½å¸¦æ&quot; min-&quot; å&quot; max-&quot;åç¼### Color</code></pre><ul><li>å¼: <code>&amp;lt;color&amp;gt;</code></li><li>åªä½: <code>visual</code></li><li><p>æ¯å¦æ¥å min/max åç¼: æ¯</p><h4 id="ç¤ºä¾"><a href="#ç¤ºä¾" class="headerlink" title="ç¤ºä¾"></a>ç¤ºä¾</h4><p>åææè½æ¾ç¤ºé¢è²çè®¾å¤åºç¨æ ·å¼è¡¨</p><p><pre><code>@media all and (color) {...}</code></pre></p><h3 id="Aspect-ratio"><a href="#Aspect-ratio" class="headerlink" title="Aspect-ratio"></a>Aspect-ratio</h3></li><li><p>å¼: <code>&amp;lt;ratio&amp;gt;</code></p></li><li>åªä½: <code>visual, tactile</code></li><li><p>æ¯å¦æ¥åmin/max åç¼: æ¯</p><p>å®½é«æ¯ä»¥âå®½/é«âè¡¨ç¤º</p><h4 id="ç¤ºä¾-1"><a href="#ç¤ºä¾-1" class="headerlink" title="ç¤ºä¾"></a>ç¤ºä¾</h4><p>å<strong>æ¾ç¤ºåºå</strong>å®½é«æ¯è³å°1:1çè®¾å¤åºç¨æ ·å¼è¡¨</p><p><pre><code>@media screen and (min-aspect-ratio: 1/1){...}</code></pre></p><h3 id="Device-aspect-ratio"><a href="#Device-aspect-ratio" class="headerlink" title="Device-aspect-ratio"></a>Device-aspect-ratio</h3></li><li><p>å¼: <code>&amp;lt;ratio&amp;gt;</code></p></li><li>åªä½: <code>visual, tactile</code></li><li><p>æ¯å¦æ¥åmin/max åç¼: æ¯</p><h4 id="ç¤ºä¾-2"><a href="#ç¤ºä¾-2" class="headerlink" title="ç¤ºä¾"></a>ç¤ºä¾</h4><p>ä¸ºå®½å±è®¾å¤åºç¨æ ·å¼è¡¨</p><p><pre><code>@media screen and (device-aspect-ratio:16/9), screen and (device-aspect-ratio:16/10){...}</code></pre></p><h3 id="Device-height"><a href="#Device-height" class="headerlink" title="Device-height"></a>Device-height</h3></li><li><p>å¼: <code>&amp;lt;length&amp;gt;</code></p></li><li>åªä½: <code>visual, tactile</code></li><li><p>æ¯å¦æ¥å min/max åç¼: æ¯</p><p>æè¿°è¾åºè®¾å¤çé«åº¦(æ´ä¸ªå±å¹æé¡µçé«åº¦, èä¸æ¯æ¸²æçªå£çé«åº¦)</p><h4 id="å®ä¾"><a href="#å®ä¾" class="headerlink" title="å®ä¾"></a>å®ä¾</h4><p>åæ¾ç¤ºå¨æå¤§å®½åº¦800px çå±å¹ä¸çææ¡£åºç¨æ ·å¼è¡¨</p><p><pre>`&lt;link rel=âstylesheetâ media=âscreen and (max-device-height: 799px)â /&gt;</pre></p></li></ul><h3 id="Device-width"><a href="#Device-width" class="headerlink" title="Device-width"></a>Device-width</h3><ul><li>å¼: <code>&amp;lt;length&amp;gt;</code></li><li>åªä½: <code>visual, tactile</code></li><li>æ¯å¦æ¥å min/max åç¼: æ¯</li></ul><p>æè¿°è¾åºè®¾å¤çå®½åº¦</p><h3 id="Grid"><a href="#Grid" class="headerlink" title="Grid"></a>Grid</h3><ul><li>å¼: <code>&amp;lt;integer&amp;gt;</code></li><li>åªä½: all</li><li>æ¯å¦æ¥å min/max åç¼: å¦</li><li>å¤æ­è¾åºè®¾å¤æ¯ç½æ ¼è®¾å¤è¿æ¯ä½å¾è®¾å¤. å¦ææ¯ç½æ ¼è®¾å¤(ä¾å¦çµä¼ æå­æºä¸­æ­æåªè½æ¾ç¤ºä¸ç§å­å½¢ççµè¯), è¯¥å¼ä¸º1, å¦åä¸º0</li></ul><h3 id="Height"><a href="#Height" class="headerlink" title="Height"></a>Height</h3><ul><li>å¼: <code>&amp;lt;length&amp;gt;</code></li><li>åªä½: <code>visual, tactile</code></li><li>æ¯å¦æ¥å min/max åç¼: æ¯</li></ul><p>height æè¿°è¾åºè®¾å¤çæ¸²æåºåé«åº¦</p><h3 id="Monochrome"><a href="#Monochrome" class="headerlink" title="Monochrome"></a>Monochrome</h3><h3 id="Orientation"><a href="#Orientation" class="headerlink" title="Orientation"></a>Orientation</h3><ul><li>å¼: <code>&amp;lt;landscape | portrait&amp;gt;</code></li><li>åªä½: <code>visual</code></li><li>æ¯å¦æ¥å min/max åç¼: å¦</li></ul>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS3 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>å­¦ä¹  CSS å¸å±</title>
      <link href="/2016/05/28/e5-ad-a6-e4-b9-a0-css-e5-b8-83-e5-b1-80/"/>
      <content type="html"><![CDATA[<h2 id="Display-å±æ§"><a href="#Display-å±æ§" class="headerlink" title="Display å±æ§"></a>Display å±æ§</h2><p>æ¯ä¸ªåç´ é½æä¸ä¸ªé»è®¤ç display å¼, è¿ä¸ªä¸åç´ çç±»åæå³.</p><p>å¤§é¨ååç´ ä»ä»¬ç display é»è®¤ä¸º <code>blcok</code> æ <code>inline</code> .</p><p>ä¸ä¸ª <code>blcok</code> åç´ éå¸¸ç§°ä¸º <strong>åçº§åç´ </strong> , ä¸ä¸ª <code>inline</code> åç´ éå¸¸ç§°ä¸º <strong>è¡ååç´ </strong> .</p><h3 id="Block"><a href="#Block" class="headerlink" title="Block"></a>Block</h3><p>ä¸ä¸ª <code>Block</code> åç´ ä¼ä»æ°å¼å§ä¸è¡å¹¶çæ»¡å®¹å¨çå®½åº¦, é»è®¤ä¸º <code>blcok</code> çåç´ æ <code>p, form, header, footer, section</code>ç­.</p><h3 id="Inline"><a href="#Inline" class="headerlink" title="Inline"></a>Inline</h3><p>ä¸ä¸ª <code>inline</code>åç´ å¯ä»¥ä½äºæ®µè½ä¸­, åè£¹ä¸äºæå­èä¸ä¼æä¹±æ®µè½çå¸å±.</p><h3 id="None"><a href="#None" class="headerlink" title="None"></a>None</h3><p>ä¸äºç¹æ®åç´ çé»è®¤ display æ¯ä», ä¾å¦ <code>script</code>. ç¨äºä¸å é¤åç´ çæåµä¸éèæäºåç´ .</p><p>å  <code>visibility</code> ä¸å, <code>display: none</code>ä¸ä¼å¨ææ¡£æµä¸­å æ®ç©ºé´, ä½æ¯ <code>visibility: hidden</code> åä¼å¨ææ¡£æµä¸­å æ®ç©ºé´.</p><h3 id="inline-blcok"><a href="#inline-blcok" class="headerlink" title="inline-blcok"></a>inline-blcok</h3><p><code>inline</code> åç´ æ¯å¯ä»¥ä½äºæ®µè½åä¸å¯¼è´æ¢è¡ç, ä½æ¯ä¸å¯æ§å¶ <code>height</code>, <code>width</code> å±æ§</p><p><code>block</code> åç´ ç¬ç«ææ®µ, ä½æ¯å¯ä»¥æ§å¶ <code>height</code>, <code>width</code> å±æ§</p><p><code>inline-block</code> åç´ å¯ä»¥ä½äºæ®µè½ä¸­, ä¸ç¬ç«æ§å¶ <code>height</code>, <code>width</code> å±æ§</p><p><strong>æ³¨æäºé¡¹</strong>:</p><ul><li><code>vertical-align</code>å±æ§ä¼å½±åå°<code>inline-block</code>åç´ , ä½ å¯è½ä¼æä»çå¼è®¾ç½®ä¸º top</li><li>éè¦è®¾ç½®æ¯ä¸ä¸ª <code>inline-block</code> çå®½åº¦</li><li>å¨  HTML ä»£ç ä¸­å¦æä¸¤ä¸ª<code>inline-block</code>ä»£ç ä¸­æç©ºæ ¼, åå®éæçä¸­ä¼åºç°ç©ºé</li></ul><h2 id="Margin-auto"><a href="#Margin-auto" class="headerlink" title="Margin: auto"></a>Margin: auto</h2><p>è®¾ç½® <code>Block</code> åç´ ç <code>width</code> å±æ§å¯ä»¥ç»ç»ä»æ°´å¹³æ¹åå æ®å®¹å¨, åæ¶è®¾ç½® <code>margin: 0 auto;</code> å¯ä»¥ä»¤å¶å±ä¸­æ¾ç¤º.</p><h2 id="Box-sizing"><a href="#Box-sizing" class="headerlink" title="Box-sizing"></a>Box-sizing</h2><p><code>box-sizing: border-box;</code> è®¾ç½®è¯¥åç´ ççå­å°ºå¯¸ä¸º <code>border</code> çå¤å°ºå¯¸</p><pre><code>.simple{  width:500px;  margin: 20px auto;  padding: 20px;  -webkit-box-sizing: border-box;     -moz-box-sizing: border-box;          box-sizing: border-box;}// simple ç  width ä¸º border+padding+content çå°ºå¯¸, å³åç´ ç border æ´ä½å®½åº¦ä¸º width`&lt;/pre&gt;## Position### static`position`é»è®¤ä¸º `static` , ä¸ä¸ª `static`åç´ ä¸ä¼è¢«&quot;positioned&quot;, ä¸ä¸ª`position` è¢«è®¾ç½®ä¸ºå¶ä»å¼çåç´ è¡¨ç¤ºä»ä¼è¢«&quot;positioned&quot;.### relativeå¯¹`position:relativ`çåç´ è®¾ç½® `top, bottom, left, right`å±æ§å¯ä»¥ä½¿å¶åç¦»åæä½ç½®, ä½æ¯å¨ææ¡£æµä¸­å æ®åæ¥çä½ç½®, å³åç¦»åçç©ºé´å¨ææ¡£æµä¸­ä½ä¸ºå¶ä»åç´ çä½ç½®åè.### fixedä¸ä¸ª`fixed` åç´ ä¼ç¸å¯¹ window å®ä½, å³ä½¿é¡µé¢æ»å¨, ä»å¨çæµè§å¨ä¸­çä½ç½®ä¹ä¸ä¼åå. `fixed` åç´ ä¸å æ®ææ¡£æµ.### absolute`absolute` å `fixed` è¡¨ç°ç±»ä¼¼, åªæ¯åèç³»åä¸ºæè¿ç&quot;positioned&quot; ç¶çº§åç´ , å¦æä¸å­å¨è¿æ ·çç¶çº§åç´ , åä»¥ body åç´ ä¸ºåè.### float### clearç¨äºæ§å¶æ¬æµ®.&lt;pre&gt;`&amp;lt;div class=&apos;box&apos;&amp;gt;...&amp;lt;/div&amp;gt;&amp;lt;section class=&apos;after-box&apos;&amp;gt;...&amp;lt;/section&amp;gt;.box{  float:left;  width: 200px;  height: 100px;  margin: 1em;}.after-box{  clear: left // æ§å¶è¯¥åç´ å·¦ä¾§æ æµ®å¨åç´ }`&lt;/pre&gt;## æ§å¶æµ®å¨ä½¿ç¨æµ®å¨ç»å¸¸ä¼éå°ä¸äºå¤æªçæç&lt;pre&gt;`&amp;lt;div class=&apos;clearfix&apos;&amp;gt;æå­æè¿°&amp;lt;img src=&apos;http://zh.learnlayout.com/images/ilta.png&apos;&amp;gt;&amp;lt;/div&amp;gt;.img{  float:right;}.clearfix{  overflow: auto; // æ©å¤§ div é»æ­¢ img æº¢åº}`&lt;/pre&gt;## åªä½æ¥è¯¢&lt;pre&gt;`@media screen and (min-width:600px){  nav{    float:left;    width:25%;  }  section{    margin-left:25%;  }}@media screen and (max-width:599px){  nav li{    display: inline;  }}`&lt;/pre&gt;## Column&lt;pre&gt;`.three-column{  padding:1em;  -moz-column-count: 3;  -moz-column-gap: 1em;  -webkit-column-count: 3;  -webkit-column-gap: 1em;  column-count: 3;  column-gap: 1em;}`&lt;/pre&gt;å®ç° div ä¸­ä¸åå¸å±## Flexbox&lt;pre&gt;`.container{  display:-webkit-flex;  display:flex;}nav{  width:200px;}.flex-column{  -webkit-flex:1;//å©ä½å®½åº¦ç100%          flex:1;}`&lt;/pre&gt;### ä½¿ç¨  flex box å®ç°(vertical-container ååç´ )åç´å±ä¸­&lt;pre&gt;`.vertical-container{  height:300px;  display:-webkit-flex;  display:flex;  -webkit-align-items: center;         -align-items: center;  -webkti-justify-content: center;         -justify-content: center;}</code></pre>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS3 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>MDL-Tooltip</title>
      <link href="/2016/05/27/mdl-tooltip/"/>
      <content type="html"><![CDATA[<head><br><link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"><br><link rel="stylesheet" href="https://code.getmdl.io/1.1.3/material.indigo-pink.min.css"><br><script defer src="https://code.getmdl.io/1.1.3/material.min.js"></script><br></head><h3 id="Default-Tooltip"><a href="#Default-Tooltip" class="headerlink" title="Default Tooltip"></a>Default Tooltip</h3><!-- Simple Tooltip --><div class="icon material-icons" id="tt1">Title1</div><div class="mdl-tooltip" for="tt1">Follow</div><pre><code>&amp;lt;!-- Simple Tooltip --&amp;gt;&amp;lt;div class=&quot;icon material-icons&quot; id=&quot;tt1&quot;&amp;gt;Title1&amp;lt;/div&amp;gt;&amp;lt;div class=&quot;mdl-tooltip&quot; for=&quot;tt1&quot;&amp;gt;Follow&amp;lt;/div&amp;gt;`&lt;/pre&gt;### Large Tooltip&lt;!-- Simple Tooltip --&gt;&lt;div class=&quot;icon material-icons&quot; id=&quot;tt2&quot;&gt;Title2&lt;/div&gt;&lt;div class=&quot;mdl-tooltip mdl-tooltip--large&quot; for=&quot;tt2&quot;&gt;Large&lt;/div&gt;&lt;pre&gt;`&amp;lt;!-- Simple Tooltip --&amp;gt;&amp;lt;div class=&quot;icon material-icons&quot; id=&quot;tt2&quot;&amp;gt;Title2&amp;lt;/div&amp;gt;&amp;lt;div class=&quot;mdl-tooltip mdl-tooltip--large&quot; for=&quot;tt2&quot;&amp;gt;Large&amp;lt;/div&amp;gt;`&lt;/pre&gt;### Rich Tooltip&lt;!-- Rich Tooltip --&gt;&lt;div class=&quot;icon material-icons&quot; id=&quot;tt3&quot;&gt;Rich&lt;/div&gt;&lt;div class=&quot;mdl-tooltip&quot; for=&quot;tt3&quot;&gt;Upload **file.zip**&lt;/div&gt;&lt;pre&gt;`&amp;lt;!-- Rich Tooltip --&amp;gt;&amp;lt;div class=&quot;icon material-icons&quot; id=&quot;tt3&quot;&amp;gt;Rich&amp;lt;/div&amp;gt;&amp;lt;div class=&quot;mdl-tooltip&quot; for=&quot;tt3&quot;&amp;gt;Upload &amp;lt;strong style=&apos;color:yellow&apos;&amp;gt;file.zip&amp;lt;/strong&amp;gt;&amp;lt;/div&amp;gt;</code></pre>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Material Design </tag>
            
            <tag> MDL </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>MDL-Textfield</title>
      <link href="/2016/05/27/mdl-textfield/"/>
      <content type="html"><![CDATA[<head><br><link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"><br><link rel="stylesheet" href="https://code.getmdl.io/1.1.3/material.indigo-pink.min.css"><br><script defer src="https://code.getmdl.io/1.1.3/material.min.js"></script><br></head><h3 id="Text-Field-amp-Numeric-Textfield"><a href="#Text-Field-amp-Numeric-Textfield" class="headerlink" title="Text Field &amp; Numeric Textfield"></a>Text Field &amp; Numeric Textfield</h3><!-- Simple Textfield --><form action="#"><br>        <div class="mdl-textfield mdl-js-textfield"><br>            <input type="text" class="mdl-textfield__input" id="sample1"><br>            <label for="sample1" class="mdl-textfield__label">PlaceHolder..</label><br>        </div><br>    </form><pre><code>&amp;lt;br&amp;gt;&amp;lt;!-- Numeric Textfield --&amp;gt;&amp;lt;form action=&quot;#&quot;&amp;gt;    &amp;lt;div class=&quot;mdl-textfield mdl-js-textfield&quot;&amp;gt;        &amp;lt;input type=&quot;text&quot; class=&quot;mdl-textfield__input&quot; id=&quot;sample2&quot; pattern=&quot;-?[0-9]*(.[0-9]+)?&quot;&amp;gt;        &amp;lt;label for=&quot;sample2&quot; class=&quot;mdl-textfield__label&quot;&amp;gt;Numeric Textfield&amp;lt;/label&amp;gt;        &amp;lt;span class=&quot;mdl-textfield__error&quot;&amp;gt;Input is not a number!&amp;lt;/span&amp;gt;    &amp;lt;/div&amp;gt;`&lt;/pre&gt;&lt;/form&gt;&lt;pre&gt;`&amp;lt;!-- Simple Textfield --&amp;gt;    &amp;lt;form action=&quot;#&quot;&amp;gt;        &amp;lt;div class=&quot;mdl-textfield mdl-js-textfield&quot;&amp;gt;            &amp;lt;input type=&quot;text&quot; class=&quot;mdl-textfield__input&quot; id=&quot;sample1&quot;&amp;gt;            &amp;lt;label for=&quot;sample1&quot; class=&quot;mdl-textfield__label&quot;&amp;gt;PlaceHolder..&amp;lt;/label&amp;gt;        &amp;lt;/div&amp;gt;    &amp;lt;/form&amp;gt;    &amp;lt;br&amp;gt;    &amp;lt;!-- Numeric Textfield --&amp;gt;    &amp;lt;form action=&quot;#&quot;&amp;gt;        &amp;lt;div class=&quot;mdl-textfield mdl-js-textfield&quot;&amp;gt;            &amp;lt;input type=&quot;text&quot; class=&quot;mdl-textfield__input&quot; id=&quot;sample2&quot; pattern=&quot;-?[0-9]*(.[0-9]+)?&quot;&amp;gt;            &amp;lt;label for=&quot;sample2&quot; class=&quot;mdl-textfield__label&quot;&amp;gt;Numeric Textfield&amp;lt;/label&amp;gt;            &amp;lt;span class=&quot;mdl-textfield__error&quot;&amp;gt;Input is not a number!&amp;lt;/span&amp;gt;        &amp;lt;/div&amp;gt;    &amp;lt;/form&amp;gt;`&lt;/pre&gt;### Floating Label Textfield&lt;!-- Floating Label --&gt;&lt;form action=&quot;#&quot;&gt;        &lt;div class=&quot;mdl-textfield mdl-js-textfield mdl-textfield--floating-label&quot;&gt;            &lt;input type=&quot;text&quot; class=&quot;mdl-textfield__input&quot; id=&quot;sample3&quot;&gt;            &lt;label for=&quot;sample3&quot; class=&quot;mdl-textfield__label&quot;&gt;Floating&lt;/label&gt;        &lt;/div&gt;&lt;/form&gt;&lt;pre&gt;`&amp;lt;!-- Floating Label --&amp;gt;    &amp;lt;form action=&quot;#&quot;&amp;gt;        &amp;lt;div class=&quot;mdl-textfield mdl-js-textfield mdl-textfield--floating-label&quot;&amp;gt;            &amp;lt;input type=&quot;text&quot; class=&quot;mdl-textfield__input&quot; id=&quot;sample3&quot;&amp;gt;            &amp;lt;label for=&quot;sample3&quot; class=&quot;mdl-textfield__label&quot;&amp;gt;Floating&amp;lt;/label&amp;gt;        &amp;lt;/div&amp;gt;    &amp;lt;/form&amp;gt;`&lt;/pre&gt;### Multiple Line Textfield&lt;!-- Multiple Line --&gt;&lt;form action=&quot;#&quot;&gt;        &lt;div class=&quot;mdl-textfield mdl-js-textfield&quot;&gt;            &lt;textarea name=&quot;&quot; id=&quot;sample4&quot; cols=&quot;30&quot; rows=&quot;3&quot; class=&quot;mdl-textfield__input&quot; type=&quot;text&quot;&gt;&lt;/textarea&gt;            &lt;label for=&quot;sample4&quot; class=&quot;mdl-textfield__label&quot;&gt;Multiple Line&lt;/label&gt;        &lt;/div&gt;&lt;/form&gt;&lt;pre&gt;`    &amp;lt;!-- Multiple Line --&amp;gt;    &amp;lt;form action=&quot;#&quot;&amp;gt;        &amp;lt;div class=&quot;mdl-textfield mdl-js-textfield&quot;&amp;gt;            &amp;lt;textarea name=&quot;&quot; id=&quot;sample4&quot; cols=&quot;30&quot; rows=&quot;3&quot; class=&quot;mdl-textfield__input&quot; type=&quot;text&quot;&amp;gt;&amp;lt;/textarea&amp;gt;            &amp;lt;label for=&quot;sample4&quot; class=&quot;mdl-textfield__label&quot;&amp;gt;Multiple Line&amp;lt;/label&amp;gt;        &amp;lt;/div&amp;gt;    &amp;lt;/form&amp;gt;`&lt;/pre&gt;### Expandable Textfield&lt;!-- Expandable Textfield --&gt;&lt;form action=&quot;#&quot;&gt;        &lt;div class=&quot;mdl-textfield mdl-js-textfield mdl-textfield--expandable&quot;&gt;            &lt;label for=&quot;sample5&quot; class=&quot;mdl-button mdl-js-button mdl-button--icon mdl-js-ripple-effect&quot;&gt;                _S_            &lt;/label&gt;            &lt;div class=&quot;mdl-textfield__expandable-holder&quot;&gt;                &lt;input type=&quot;text&quot; class=&quot;mdl-textfield__input&quot; id=&quot;sample5&quot;&gt;                &lt;label for=&quot;sample5&quot; class=&quot;mdl-textfield__label&quot;&gt;Expandable Input&lt;/label&gt;            &lt;/div&gt;        &lt;/div&gt;&lt;/form&gt;&lt;pre&gt;`    &amp;lt;!-- Expandable Textfield --&amp;gt;    &amp;lt;form action=&quot;#&quot;&amp;gt;        &amp;lt;div class=&quot;mdl-textfield mdl-js-textfield mdl-textfield--expandable&quot;&amp;gt;            &amp;lt;label for=&quot;sample5&quot; class=&quot;mdl-button mdl-js-button mdl-button--icon mdl-js-ripple-effect&quot;&amp;gt;                &amp;lt;i class=&quot;material-icons&quot;&amp;gt;S&amp;lt;/i&amp;gt;            &amp;lt;/label&amp;gt;            &amp;lt;div class=&quot;mdl-textfield__expandable-holder&quot;&amp;gt;                &amp;lt;input type=&quot;text&quot; class=&quot;mdl-textfield__input&quot; id=&quot;sample5&quot;&amp;gt;                &amp;lt;label for=&quot;sample5&quot; class=&quot;mdl-textfield__label&quot;&amp;gt;Expandable Input&amp;lt;/label&amp;gt;            &amp;lt;/div&amp;gt;        &amp;lt;/div&amp;gt;    &amp;lt;/form&amp;gt;</code></pre>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Material Design </tag>
            
            <tag> MDL </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>MDL-Table</title>
      <link href="/2016/05/27/mdl-table/"/>
      <content type="html"><![CDATA[<head><br><link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"><br><link rel="stylesheet" href="https://code.getmdl.io/1.1.3/material.indigo-pink.min.css"><br><script defer src="https://code.getmdl.io/1.1.3/material.min.js"></script><br></head><h3 id="Selectable-Table"><a href="#Selectable-Table" class="headerlink" title="Selectable Table"></a>Selectable Table</h3><table class="mdl-data-table mdl-js-data-table mdl-data-table--selectable mdl-shadow--2dp"><br>    <thead><br>        <tr><br>            <th class="mdl-data-table__cell--non-numeric">Material</th><br>            <th>Quantity</th><br>            <th>Unit Price</th><br>        </tr><br>    </thead><br>    <tbody><br>        <tr><br>            <td class="mdl-data-table__cell--non-numeric">Acrylic(Transparent)</td><br>            <td>25</td><br>            <td>$2.90</td><br>        </tr><br>        <tr><br>            <td class="mdl-data-table__cell--non-numeric">Plywood(Birch)</td><br>            <td>50</td><br>            <td>$1.25</td><br>        </tr><br>        <tr><br>            <td class="mdl-data-table__cell--non-numeric">Laminate(Gold on Blue)</td><br>            <td>10</td><br>            <td>$2.35</td><br>        </tr><br>    </tbody><br></table><pre><code>&amp;lt;table class=&quot;mdl-data-table mdl-js-data-table mdl-data-table--selectable mdl-shadow--2dp&quot;&amp;gt;    &amp;lt;thead&amp;gt;        &amp;lt;tr&amp;gt;            &amp;lt;th class=&quot;mdl-data-table__cell--non-numeric&quot;&amp;gt;Material&amp;lt;/th&amp;gt;            &amp;lt;th&amp;gt;Quantity&amp;lt;/th&amp;gt;            &amp;lt;th&amp;gt;Unit Price&amp;lt;/th&amp;gt;        &amp;lt;/tr&amp;gt;    &amp;lt;/thead&amp;gt;    &amp;lt;tbody&amp;gt;        &amp;lt;tr&amp;gt;            &amp;lt;td class=&quot;mdl-data-table__cell--non-numeric&quot;&amp;gt;Acrylic(Transparent)&amp;lt;/td&amp;gt;            &amp;lt;td&amp;gt;25&amp;lt;/td&amp;gt;            &amp;lt;td&amp;gt;$2.90&amp;lt;/td&amp;gt;        &amp;lt;/tr&amp;gt;        &amp;lt;tr&amp;gt;            &amp;lt;td class=&quot;mdl-data-table__cell--non-numeric&quot;&amp;gt;Plywood(Birch)&amp;lt;/td&amp;gt;            &amp;lt;td&amp;gt;50&amp;lt;/td&amp;gt;            &amp;lt;td&amp;gt;$1.25&amp;lt;/td&amp;gt;        &amp;lt;/tr&amp;gt;        &amp;lt;tr&amp;gt;            &amp;lt;td class=&quot;mdl-data-table__cell--non-numeric&quot;&amp;gt;Laminate(Gold on Blue)&amp;lt;/td&amp;gt;            &amp;lt;td&amp;gt;10&amp;lt;/td&amp;gt;            &amp;lt;td&amp;gt;$2.35&amp;lt;/td&amp;gt;        &amp;lt;/tr&amp;gt;    &amp;lt;/tbody&amp;gt;&amp;lt;/table&amp;gt;</code></pre>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Material Design </tag>
            
            <tag> MDL </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>MDL-Selection</title>
      <link href="/2016/05/27/mdl-selection/"/>
      <content type="html"><![CDATA[<head><br><link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"><br><link rel="stylesheet" href="https://code.getmdl.io/1.1.3/material.indigo-pink.min.css"><br><script defer src="https://code.getmdl.io/1.1.3/material.min.js"></script><br></head><h3 id="Checkbox"><a href="#Checkbox" class="headerlink" title="Checkbox"></a>Checkbox</h3><!-- Checkbox --><label for="checkbox1" class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect"><br>        <input type="checkbox" class="mdl-checkbox__input" id="checkbox1"><br>        <span class="mdl-checkbox__label">Checkbox</span><br></label><pre><code>&amp;lt;!-- Checkbox --&amp;gt;&amp;lt;label for=&quot;checkbox1&quot; class=&quot;mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect&quot;&amp;gt;        &amp;lt;input type=&quot;checkbox&quot; class=&quot;mdl-checkbox__input&quot; id=&quot;checkbox1&quot;&amp;gt;        &amp;lt;span class=&quot;mdl-checkbox__label&quot;&amp;gt;Checkbox&amp;lt;/span&amp;gt;&amp;lt;/label&amp;gt;`&lt;/pre&gt;### Radio Button&lt;!-- Radio Button --&gt;&lt;label for=&quot;option-1&quot; class=&quot;mdl-radio mdl-js-radio mdl-js-ripple-effect&quot;&gt;    &lt;input type=&quot;button&quot; id=&quot;option-1&quot; class=&quot;mdl-radio__button&quot; name=&quot;options&quot; value=&quot;1&quot;&gt;    &lt;span class=&quot;mdl-radio__label&quot;&gt;Radio&lt;/span&gt;&lt;/label&gt;&lt;pre&gt;`&amp;lt;!-- Radio Button --&amp;gt;&amp;lt;label for=&quot;option-1&quot; class=&quot;mdl-radio mdl-js-radio mdl-js-ripple-effect&quot;&amp;gt;    &amp;lt;input type=&quot;button&quot; id=&quot;option-1&quot; class=&quot;mdl-radio__button&quot; name=&quot;options&quot; value=&quot;1&quot;&amp;gt;    &amp;lt;span class=&quot;mdl-radio__label&quot;&amp;gt;Radio&amp;lt;/span&amp;gt;&amp;lt;/label&amp;gt;`&lt;/pre&gt;### Icon Toggle&lt;!-- Icon Toggle --&gt;&lt;label for=&quot;icon-toggle-1&quot; class=&quot;mdl-icon-toggle mdl-js-icon-toggle mdl-js-ripple-effect&quot;&gt;&lt;input type=&quot;checkbox&quot; class=&quot;mdl-icon-toggle__input&quot; id=&quot;icon-toggle-1&quot;&gt;_Icon_&lt;/label&gt;&lt;pre&gt;`&amp;lt;!-- Icon Toggle --&amp;gt; &amp;lt;label for=&quot;icon-toggle-1&quot; class=&quot;mdl-icon-toggle mdl-js-icon-toggle mdl-js-ripple-effect&quot;&amp;gt;    &amp;lt;input type=&quot;checkbox&quot; class=&quot;mdl-icon-toggle__input&quot; id=&quot;icon-toggle-1&quot;&amp;gt;    &amp;lt;i class=&quot;mdl-icon-toggle__label material-icons&quot;&amp;gt;Icon&amp;lt;/i&amp;gt;&amp;lt;/label&amp;gt;`&lt;/pre&gt;### Switch&lt;!-- Switch --&gt;&lt;label for=&quot;switch-1&quot; class=&quot;mdl-switch mdl-js-switch mdl-js-ripple-effect&quot;&gt;    &lt;input type=&quot;checkbox&quot; class=&quot;mdl-switch__input&quot; id=&quot;switch-1&quot;&gt;    &lt;span class=&quot;mdl-switch__label&quot;&gt;&lt;/span&gt;&lt;/label&gt;&lt;pre&gt;`&amp;lt;!-- Switch --&amp;gt;&amp;lt;label for=&quot;switch-1&quot; class=&quot;mdl-switch mdl-js-switch mdl-js-ripple-effect&quot;&amp;gt;    &amp;lt;input type=&quot;checkbox&quot; class=&quot;mdl-switch__input&quot; id=&quot;switch-1&quot;&amp;gt;    &amp;lt;span class=&quot;mdl-switch__label&quot;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/label&amp;gt;</code></pre>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Material Design </tag>
            
            <tag> MDL </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>MDL-Snackbar</title>
      <link href="/2016/05/27/mdl-snackbar/"/>
      <content type="html"><![CDATA[<head><br><link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"><br><link rel="stylesheet" href="https://code.getmdl.io/1.1.3/material.indigo-pink.min.css"><br><script defer src="https://code.getmdl.io/1.1.3/material.min.js"></script><br></head><button id="show-snackbar" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect" type="button">Show Snackbar</button><div id="snackbar" class="mdl-snackbar mdl-js-snackbar"><br>        <div class="mdl-snackbar__text"></div><br>        <button class="mdl-snackbar__action" type="button"></button><br></div><script>(function(){'user strict'var snackbarContainer = document.querySelector('#snackbar');var showSnackbarButton = document.querySelector('#show-snackbar');var handler = function(event){showSnackbarButton.style.backgroundColor = '';};showSnackbarButton.addEventListener('click', function(){'user strict'showSnackbarButton.style.backgroundColor = '#' + Math.floor(Math.random() * 0xffffff).toString(16);var data={message: "Button Color Changed.",timeout: 2000,actionHandler: handler,actionText: "Undo"};snackbarContainer.MaterialSnackbar.showSnackbar(data);});}());</script><pre><code>&amp;lt;button id=&quot;show-snackbar&quot; class=&quot;mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect&quot; type=&quot;button&quot;&amp;gt;Show Snackbar&amp;lt;/button&amp;gt;&amp;lt;div id=&quot;snackbar&quot; class=&quot;mdl-snackbar mdl-js-snackbar&quot;&amp;gt;        &amp;lt;div class=&quot;mdl-snackbar__text&quot;&amp;gt;&amp;lt;/div&amp;gt;        &amp;lt;button class=&quot;mdl-snackbar__action&quot; type=&quot;button&quot;&amp;gt;&amp;lt;/button&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;script&amp;gt;        (function(){            &apos;user strict&apos;            var snackbarContainer = document.querySelector(&apos;#snackbar&apos;);            var showSnackbarButton = document.querySelector(&apos;#show-snackbar&apos;);            var handler = function(event){                showSnackbarButton.style.backgroundColor = &apos;&apos;;            };            showSnackbarButton.addEventListener(&apos;click&apos;, function(){                &apos;user strict&apos;                showSnackbarButton.style.backgroundColor = &apos;#&apos; + Math.floor(Math.random() * 0xffffff).toString(16);                var data={                    message: &quot;Button Color Changed.&quot;,                    timeout: 2000,                    actionHandler: handler,                    actionText: &quot;Undo&quot;                };                snackbarContainer.MaterialSnackbar.showSnackbar(data);            });        }());&amp;lt;/script&amp;gt;</code></pre>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Material Design </tag>
            
            <tag> MDL </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>MDL-Slider</title>
      <link href="/2016/05/27/mdl-slider/"/>
      <content type="html"><![CDATA[<head><br><!-- Default Slider --><br>    <input type="range" class="mdl-slider mdl-js-slider" min="0" max="100" value="0" tabindex="0"><br></head><h3 id="Default-Slider"><a href="#Default-Slider" class="headerlink" title="Default Slider"></a>Default Slider</h3><!-- Default Slider --><input type="range" class="mdl-slider mdl-js-slider" min="0" max="100" value="0" tabindex="0"><pre><code>&amp;lt;!-- Default Slider --&amp;gt;&amp;lt;input type=&quot;range&quot; class=&quot;mdl-slider mdl-js-slider&quot; min=&quot;0&quot; max=&quot;100&quot; value=&quot;0&quot; tabindex=&quot;0&quot;&amp;gt;`&lt;/pre&gt;### Slider with Starting Value&lt;!-- Slider with Starting Value --&gt;&lt;input type=&quot;range&quot; class=&quot;mdl-slider mdl-js-slider&quot; min=&quot;0&quot; max=&quot;100&quot; value=&quot;25&quot; tabindex=&quot;0&quot;&gt;&lt;pre&gt;`&amp;lt;!-- Slider with Starting Value --&amp;gt;&amp;lt;input type=&quot;range&quot; class=&quot;mdl-slider mdl-js-slider&quot; min=&quot;0&quot; max=&quot;100&quot; value=&quot;25&quot; tabindex=&quot;0&quot;&amp;gt;</code></pre>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Material Design </tag>
            
            <tag> MDL </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>MDL-Menu</title>
      <link href="/2016/05/27/mdl-menu/"/>
      <content type="html"><![CDATA[<head><br><link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"><br><link rel="stylesheet" href="https://code.getmdl.io/1.1.3/material.indigo-pink.min.css"><br><script defer src="https://code.getmdl.io/1.1.3/material.min.js"></script><br></head><h3 id="Left-Aligned-Menu-Below-Button"><a href="#Left-Aligned-Menu-Below-Button" class="headerlink" title="Left Aligned Menu Below Button"></a>Left Aligned Menu Below Button</h3><!-- Left aligned menu below button --><button id="leftBelowButton" class="mdl-button mdl-js-button mdl-button--icon mdl-button--fab"><br>    _i_<br></button><ul><li>Some Action</li><li>Another Action</li><li>Disabled Action</li><li><p>Yet Another Action</p><pre><code>&amp;lt;!-- Left aligned menu below button --&amp;gt;&amp;lt;button id=&quot;leftBelowButton&quot; class=&quot;mdl-button mdl-js-button mdl-button--icon mdl-button--fab&quot;&amp;gt;    &amp;lt;i class=&quot;material-icons&quot;&amp;gt;i&amp;lt;/i&amp;gt;&amp;lt;/button&amp;gt;&amp;lt;ul class=&quot;mdl-menu mdl-js-menu mdl-menu--bottom-left mdl-js-ripple-effect&quot; for=&quot;leftBelowButton&quot;&amp;gt;    &amp;lt;li class=&quot;mdl-menu__item&quot;&amp;gt;Some Action&amp;lt;/li&amp;gt;    &amp;lt;li class=&quot;mdl-menu__item mdl-menu__item--full-bleed-divider&quot;&amp;gt;Another Action&amp;lt;/li&amp;gt;    &amp;lt;li class=&quot;mdl-menu__item&quot; disabled&amp;gt;Disabled Action&amp;lt;/li&amp;gt;    &amp;lt;li class=&quot;mdl-menu__item&quot;&amp;gt;Yet Another Action&amp;lt;/li&amp;gt;&amp;lt;/ul&amp;gt;</code></pre><p>`</p><h3 id="Right-Aligned-Menu-Below-Button"><a href="#Right-Aligned-Menu-Below-Button" class="headerlink" title="Right Aligned Menu Below Button"></a>Right Aligned Menu Below Button</h3><!-- Right aligned menu below button --><button id="rightBelowButton" class="mdl-button mdl-js-button mdl-button--icon mdl-button--fab"><br>    _i_<br></button></li><li><p>Some Action</p></li><li>Another Action</li><li>Disabled Action</li><li><p>Yet Another Action</p><pre>`    &lt;!-- Right aligned menu below button --&gt;    &lt;button id="rightBelowButton" class="mdl-button mdl-js-button mdl-button--icon mdl-button--fab"&gt;        &lt;i class="material-icons"&gt;i&lt;/i&gt;    &lt;/button&gt;    &lt;ul class="mdl-menu mdl-js-menu mdl-menu--bottom-right mdl-js-ripple-effect" for="rightBelowButton"&gt;        &lt;li class="mdl-menu__item"&gt;Some Action&lt;/li&gt;        &lt;li class="mdl-menu__item mdl-menu__item--full-bleed-divider"&gt;Another Action&lt;/li&gt;        &lt;li class="mdl-menu__item" disabled&gt;Disabled Action&lt;/li&gt;        &lt;li class="mdl-menu__item"&gt;Yet Another Action&lt;/li&gt;    &lt;/ul&gt;`</pre><h3 id="Left-Aligned-Menu-Above-Button"><a href="#Left-Aligned-Menu-Above-Button" class="headerlink" title="Left Aligned Menu Above Button"></a>Left Aligned Menu Above Button</h3><!-- Left aligned menu above button --><button id="leftAboveButton" class="mdl-button mdl-js-button mdl-button--icon mdl-button--fab"><br>    _i_<br></button></li><li><p>Some Action</p></li><li>Another Action</li><li>Disabled Action</li><li><p>Yet Another Action</p><pre>`    &lt;!-- Left aligned menu above button --&gt;    &lt;button id="leftAboveButton" class="mdl-button mdl-js-button mdl-button--icon mdl-button--fab"&gt;        &lt;i class="material-icons"&gt;i&lt;/i&gt;    &lt;/button&gt;    &lt;ul class="mdl-menu mdl-js-menu mdl-menu--top-left mdl-js-ripple-effect" for="leftAboveButton"&gt;        &lt;li class="mdl-menu__item"&gt;Some Action&lt;/li&gt;        &lt;li class="mdl-menu__item mdl-menu__item--full-bleed-divider"&gt;Another Action&lt;/li&gt;        &lt;li class="mdl-menu__item" disabled&gt;Disabled Action&lt;/li&gt;        &lt;li class="mdl-menu__item"&gt;Yet Another Action&lt;/li&gt;    &lt;/ul&gt;`</pre><h3 id="Right-Aligned-Menu-Above-Button"><a href="#Right-Aligned-Menu-Above-Button" class="headerlink" title="Right Aligned Menu Above Button"></a>Right Aligned Menu Above Button</h3><!-- Right aligned menu above button --><button id="rightAboveButton" class="mdl-button mdl-js-button mdl-button--icon mdl-button--fab"><br>    _i_<br></button></li><li><p>Some Action</p></li><li>Another Action</li><li>Disabled Action</li><li><p>Yet Another Action</p><p><pre>`    &lt;!â Right aligned menu above button â&gt;</pre></p><pre><code>&amp;lt;button id=&quot;rightAboveButton&quot; class=&quot;mdl-button mdl-js-button mdl-button--icon mdl-button--fab&quot;&amp;gt;    &amp;lt;i class=&quot;material-icons&quot;&amp;gt;i&amp;lt;/i&amp;gt;&amp;lt;/button&amp;gt;&amp;lt;ul class=&quot;mdl-menu mdl-js-menu mdl-menu--top-right mdl-js-ripple-effect&quot; for=&quot;rightAboveButton&quot;&amp;gt;    &amp;lt;li class=&quot;mdl-menu__item&quot;&amp;gt;Some Action&amp;lt;/li&amp;gt;    &amp;lt;li class=&quot;mdl-menu__item mdl-menu__item--full-bleed-divider&quot;&amp;gt;Another Action&amp;lt;/li&amp;gt;    &amp;lt;li class=&quot;mdl-menu__item&quot; disabled&amp;gt;Disabled Action&amp;lt;/li&amp;gt;    &amp;lt;li class=&quot;mdl-menu__item&quot;&amp;gt;Yet Another Action&amp;lt;/li&amp;gt;&amp;lt;/ul&amp;gt;</code></pre></li></ul>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Material Design </tag>
            
            <tag> MDL </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>å¾è§£ Git</title>
      <link href="/2016/05/26/e5-9b-be-e8-a7-a3-git/"/>
      <content type="html"><![CDATA[<h2 id="åºæ¬ç¨æ³"><a href="#åºæ¬ç¨æ³" class="headerlink" title="åºæ¬ç¨æ³"></a>åºæ¬ç¨æ³</h2><p><img src="https://marklodato.github.io/visual-git-guide/basic-usage.svg" alt="Gitåºæ¬ç¨æ³"><br>å¾ä¸­, History å³ä¸ºæ¬å°ä»åº(local repository), Stage(Index) ä¸ºæå­ç®å½, ä¹ç§°ä¸ºç´¢å¼, Working Directory ä¸ºå·¥ä½ç®å½.</p><ul><li><code>git add *file*</code> æCurrent Working Directory ä¸çfile æ¾å¥ Stage</li><li><code>git commit</code> å¯¹ Stage çæå¿«ç§å¹¶æ¾å¥ local Repo</li><li><code>git reset -- *file*</code> ç¨æ¥å° Stage æ¢å¤å°ä¸ä¸æ¬¡ commit çç¶æ(å¿«ç§)</li><li><code>git checkout -- *file*</code> ææä»¶ä» Stage å¤å¶å° Current Working Directory, å¹¶ä¸ä¸¢å¼æ¬å°ä¿®æ¹</li></ul><p>å¯ä»¥ä½¿ç¨ <code>git reset -p</code>, <code>git checkout -p</code>, <code>git add -p</code>è¿å¥äº¤äºæ¨¡å¼.</p><p>å¯ä»¥è·³è¿ Stage, å®ç° Working Directory å Local Repo çç´æ¥äº¤æµ.<br><img src="https://marklodato.github.io/visual-git-guide/basic-usage-2.svg" alt="è·³è¿ Stage"></p><ul><li><code>git commit -a</code> ç¸å½äºè¿è¡ <code>git add</code>æWorking Directory ä¸çæä»¶æ¾å¥ Stage å¹¶ Commit</li><li><code>git commit *file*</code> è¿è¡ä¸æ¬¡åå«æåä¸æ¬¡ Commit, å¹¶å ä¸ Working Directory å¿«ç§çæäº¤, å¹¶ä¸æä»¶æ·»å å° Stage</li><li><code>git checkout HEAD</code> ä» Local Repo ä¸­ååºä¸ä¸æ¬¡ commit çå¿«ç§å¹¶åæ»</li></ul><h2 id="å¾ä¾"><a href="#å¾ä¾" class="headerlink" title="å¾ä¾"></a>å¾ä¾</h2><p><img src="https://marklodato.github.io/visual-git-guide/conventions.svg" alt="å¾ä¾"></p><h2 id="å½ä»¤è¯¦è§£"><a href="#å½ä»¤è¯¦è§£" class="headerlink" title="å½ä»¤è¯¦è§£"></a>å½ä»¤è¯¦è§£</h2><h3 id="Diff"><a href="#Diff" class="headerlink" title="Diff"></a>Diff</h3><p>æ¥çä¸¤æ¬¡æäº¤ä¹é´çåå¨<br><img src="https://marklodato.github.io/visual-git-guide/diff.svg" alt="diff"></p><h3 id="Commit"><a href="#Commit" class="headerlink" title="Commit"></a>Commit</h3><p>æ§è¡ Commit çæ¶å, git å¯¹ Stage ä¸­çæä»¶åä¸ä¸ªå¿«ç§, æäº¤ç» local repo, è®°ä¸ºæåç¶èç¹ç<strong>æ°èç¹</strong>, ç¶åæ HEAD æå<strong>æ°èç¹</strong>,<br><img src="https://marklodato.github.io/visual-git-guide/commit-master.svg" alt="commit"><br>å¾ä¸­æ§è¡ commit å, stage çæå¿«ç§å¹¶æäº¤ç» repo, è®°ä¸ºæ°èç¹ f0cec, å¶æåç¶èç¹ ed489, åæ¶ HEAD ä»ç¶èç¹è½¬ç§»è³æ°èç¹.</p><p>å³ä½¿å½ååæ¯æ¯ä»æç¥ç¶èç¹åºåç, git ä¹ä¼çææ°èç¹å¹¶æåè¯¥ç¥ç¶èç¹, å¹¶å° HEAD æåæ°èç¹<br><img src="https://marklodato.github.io/visual-git-guide/commit-maint.svg" alt="git"><br>å¾ä¸­ maint å¨ commit åæ¯ master çå­ç¶èç¹, å¨ commit ä¸åæ¯ master çç¥ç¶èç¹, æ­¤æ¶åå¹¶æè¡åæ¯å¿é¡»ç.</p><p>å¦ææ³æ´æ¹ä¸æ¬¡commit, ä½¿ç¨ <code>git commit --amend</code>, git ä¼ä½¿ç¨å½åç¶èç¹è¿è¡ä¸æ¬¡æ°çæäº¤, æ°çå­èç¹ä¾æ§æåè¯¥ç¶èç¹, æ§çæäº¤ä¼è¢«åæ¶, å¦å¾<br><img src="https://marklodato.github.io/visual-git-guide/commit-amend.svg" alt="amend"></p><h3 id="Checkout"><a href="#Checkout" class="headerlink" title="Checkout"></a>Checkout</h3><p><code>Checkout</code>ç¨äºä» Stage ä¸­ååºæä»¶æ¾å° Working Directory ä¸­, ä¹å¯ç¨äºåæ¢åæ¯</p><p>å½ç»å®æä¸ªæä»¶åæ¶, git ä¼ä»æå®çèç¹ä¸­æ·è´æä»¶å° Stage å Working Directory. æ¯å¦ <code>git checkout HEAD~ foo.c</code> ä¼ä» HEAD~(å³å½åç¶èç¹)ä¸­æ·è´ foo.c æä»¶å° Working Directory å¹¶å å° Stage, å¦æ<code>checkout</code> æ²¡ææ·»å æå®èç¹, å°±ä¼ä» Stage ä¸­æ·è´æä»¶.<br><img src="https://marklodato.github.io/visual-git-guide/checkout-files.svg" alt="checkout"></p><p>å¦æä¸æå®æä»¶å, èæ¯ç»åºä¸ä¸ªæ¬å°åæ¯å, åä¼å° HEAD æåè¯¥åæ¯, å³è½¬ä¸º current branch<br><img src="https://marklodato.github.io/visual-git-guide/checkout-branch.svg" alt="checkout"></p><p>å¦ææ²¡ææå®æä»¶åååæ¯å, èæ¯ä¸ä¸ªæ ç­¾, è¿ç¨åæ¯, SHA-1å¼, æèåæ¯ master~3ä¹ç±»çä¸è¥¿, åå¾å°ä¸ä¸ªå¿ååæ¯, ç§°ä¸º detached HEAD( è¢«åç¦»ç HEAD æ è¯)<br><img src="https://marklodato.github.io/visual-git-guide/checkout-detached.svg" alt="checkout"></p><p>å½ HEAD å¤äºåç¦»ç¶ææ¶(ä¸æåä»»ä½æåç branch), commit å¯ä»¥æ­£å¸¸æäº¤, ä½ä¸ä¼æ´æ°ä»»ä½æåç branch( ç§°ä¸ºæ°çå¿ååæ¯)<br><img src="https://marklodato.github.io/visual-git-guide/commit-detached.svg" alt="commit"></p><p>æ­¤æ¶å¦æåæ¢å°å¶ä»åæ¯, å°±æ æ³è¿åè¿ä¸ªå¿ååæ¯<br><img src="https://marklodato.github.io/visual-git-guide/checkout-after-detached.svg" alt="commit"></p><p>å¦ææ³å¯¹è¯¥å¿ååæ¯åå»ºå¼ç¨, å¯ä»¥ç¨ <code>git checkout -b *name*</code> æ¥åå»ºä¸ä¸ªæåå¿ååæ¯çæ°åæ¯<br><img src="https://marklodato.github.io/visual-git-guide/checkout-b-detached.svg" alt="commit"></p><h3 id="Reset"><a href="#Reset" class="headerlink" title="Reset"></a>Reset</h3><p><code>reset</code> æä»¤æå½ååæ¯æåå¦ä¸ä¸ªä½ç½®, å¹¶ä¸æéæ©çåå¨ Working Directory å Stage. ä¹ç¨æ¥ä» Local Repo ä¸­å¤å¶æä»¶å° Stage, ä¸ä¿®æ¹ Working Directory.</p><p>å¦æä¸ç»åæ°, åå½ååæ¯æåé£ä¸ªèç¹, å¹¶å° Stage æ¢å¤å°å¯¹åºcommit; å¦æç¨ <code>--hard</code> åæ°, å Working Directory ä¹æ¢å¤å°è¯¥èç¹çcommit, å¦æç¨ <code>--soft</code> åæ°, åé½ä¸å<br><img src="https://marklodato.github.io/visual-git-guide/reset-commit.svg" alt="reset"></p><p>å¦æä¸æä¾çæ¬å·, åé»è®¤ HEAD, è¿æ ·åæ¯æåä¸å(ä¾æ§æåå½åèç¹), ä½æ¯ Stage ä¼åæ»å°ä¸ä¸æ¬¡ commit, å¦æç¨äºâ hard, å Working Directory ä¹ä¼åæ».<br><img src="https://marklodato.github.io/visual-git-guide/reset.svg" alt="reset"></p><h3 id="Merge"><a href="#Merge" class="headerlink" title="Merge"></a>Merge</h3><p><code>merge</code> å°ä¸åç branch åå¹¶, åå¹¶å, å¶ä»åæ¯çStage å¿é¡»åå½ååæ¯ç Stage ç¸å(å³åå¹¶çå ä¸ªåæ¯éè¦æç¸åç Stage).</p><ul><li>å¦æå¦ä¸ä¸ªåæ¯æ¯å½ååæ¯çç¥ç¶èç¹, ååå¹¶å½ä»¤å°ä»ä¹ä¹ä¸å.</li><li>å¦æå½åèç¹æ¯å¦ä¸ä¸ªåæ¯çç¥ç¶èç¹, åå¸¦å¦ä¹ fast-forward åå¹¶, å³ç®åææ HEAD, å¹¶çæä¸ä¸ªæ°ç commit<br><img src="https://marklodato.github.io/visual-git-guide/merge-ff.svg" alt="merge"></li></ul><p>å¦ææ¯ä¸æ¬¡çæ­£çåå¹¶, é»è®¤æå½åèç¹(ed489)åå¦ä¸ä¸ªèç¹(33104)åä»ä»¬çå±åç¥ç¶èç¹(b325c)è¿è¡ä¸æ¬¡ä¸æ¹åå¹¶. ç»ææ¯åä¿å­Working Directory å Stage, ç¶åå¨å½åèç¹(ed489)å¤æäº¤æ°çèç¹.<br><img src="https://marklodato.github.io/visual-git-guide/merge.svg" alt="merge"></p><h3 id="Cherry-Pick"><a href="#Cherry-Pick" class="headerlink" title="Cherry Pick"></a>Cherry Pick</h3><p><code>cherry-pick</code> å½ä»¤âå¤å¶âä¸ä¸ªæäº¤èç¹å¹¶å¨å½ååæ¯åä¸æ¬¡å®å¨ä¸æ ·çæ°æäº¤(å°æèç¹ä½ä¸ºæ°èç¹).<br><img src="https://marklodato.github.io/visual-git-guide/cherry-pick.svg" alt="cherry-pick"></p><h3 id="Rebase"><a href="#Rebase" class="headerlink" title="Rebase"></a>Rebase</h3><p>è¡åæ¯åå¹¶å½ä»¤çå¦ä¸ç§éæ©. åå¹¶å§ä¸¤ä¸ªç¶åæ¯åå¹¶è¿è¡ä¸æ¬¡æäº¤, æäº¤åå²ä¸æ¯çº¿æ§ç. è¡åå¨å½ååæ¯ä¸éæ¼å¦ä¸ä¸ªåæ¯çåå², æäº¤åå²æ¯çº¿æ§ç, æ¬è´¨ä¸æ¯çº¿æ§åçèªå¨ç cherry-pick<br><img src="https://marklodato.github.io/visual-git-guide/rebase.svg" alt="rebase"></p><p>ä¸é¢ææçå½ä»¤é½å¨ topic åæ¯ä¸­è¿è¡, èä¸æ¯ master åæ¯( HEAD æå topic), å¨ master åæ¯ä¸éæ¼, å¹¶æåæ¯æåæ°çèç¹(å°±å¾ topic åæ¯è¢«åæ¶).</p><p>è¦éå¶åæ»è¿å, ä½¿ç¨ <code>--onto</code> åæ°<br><img src="https://marklodato.github.io/visual-git-guide/rebase-onto.svg" alt="rebase"></p>]]></content>
      
      <categories>
          
          <category> github </category>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> github </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>MDL-Loading</title>
      <link href="/2016/05/26/mdl-loading/"/>
      <content type="html"><![CDATA[<h3 id="Defaut-Progress-Bar"><a href="#Defaut-Progress-Bar" class="headerlink" title="Defaut Progress Bar"></a>Defaut Progress Bar</h3><pre><code>&amp;lt;!-- Simple MDL Progress Bar --&amp;gt;    &amp;lt;div class=&quot;mdl-progress mdl-js-progress&quot; id=&quot;p1&quot;&amp;gt;&amp;lt;/div&amp;gt;    &amp;lt;script&amp;gt;        document.querySelector(&apos;#p1&apos;).addEventListener(&apos;mdl-componentupgraded&apos;, function(){            this.MaterialProgress.setProgress(44);        })    &amp;lt;/script&amp;gt;`&lt;/pre&gt;### Intedeterminate Progress Bar&lt;!-- MDL Progress Bar with Indeterminate Progress --&gt;&lt;div id=&quot;p2&quot; class=&quot;mdl-progress mdl-js-progress mdl-progress__indeterminate&quot;&gt;&lt;/div&gt;&lt;pre&gt;`&amp;lt;!-- MDL Progress Bar with Indeterminate Progress --&amp;gt;&amp;lt;div id=&quot;p2&quot; class=&quot;mdl-progress mdl-js-progress mdl-progress__indeterminate&quot;&amp;gt;&amp;lt;/div&amp;gt;`&lt;/pre&gt;### Buffering Progress Bar&lt;pre&gt;`    &amp;lt;!-- MDL Progress Bar with Buffering --&amp;gt;    &amp;lt;div class=&quot;mdl-progress mdl-js-progress&quot; id=&quot;p1&quot;&amp;gt;&amp;lt;/div&amp;gt;    &amp;lt;script&amp;gt;        document.querySelector(&apos;#p1&apos;).addEventListener(&apos;mdl-componentupgraded&apos;, function(){            this.MaterialProgress.setProgress(33);            this.MaterialProgress.setBuffer(66);        })    &amp;lt;/script&amp;gt;`&lt;/pre&gt;### Default Spinner&lt;div class=&quot;mdl-spinner mdl-js-spinner is-active&quot;&gt;&lt;/div&gt;&lt;pre&gt;`&amp;lt;div class=&quot;mdl-spinner mdl-js-spinner is-active&quot;&amp;gt;&amp;lt;/div&amp;gt;`&lt;/pre&gt;### Single Color Spinner&lt;div class=&quot;mdl-spinner mdl-spinner--single-color mdl-js-spinner is-active&quot;&gt;&lt;/div&gt;&lt;pre&gt;`&amp;lt;div class=&quot;mdl-spinner mdl-spinner--single-color mdl-js-spinner is-active&quot;&amp;gt;&amp;lt;/div&amp;gt;</code></pre>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Material Design </tag>
            
            <tag> MDL </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>MDL-List</title>
      <link href="/2016/05/26/mdl-list/"/>
      <content type="html"><![CDATA[<head><br>    <meta charset="UTF-8"><br>    <title>Document</title><br>    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"><br><link rel="stylesheet" href="https://code.getmdl.io/1.1.3/material.indigo-pink.min.css"><br><script defer src="https://code.getmdl.io/1.1.3/material.min.js"></script><br></head><h3 id="Simple-List"><a href="#Simple-List" class="headerlink" title="Simple List"></a>Simple List</h3><!-- Simple List --><ul><li><span class="mdl-list__item-primary-content">Content 1</span></li><li><span class="mdl-list__item-primary-content">Content 2</span></li><li><span class="mdl-list__item-primary-content">Content 3</span></li><li><span class="mdl-list__item-primary-content">Content 4</span></li><li><p><span class="mdl-list__item-primary-content">Content 5</span></p><p>&lt;!â Simple List â&gt;<br>&lt;ul class=âmdl-listâ&gt;</p><pre><code>&amp;lt;li class=&quot;mdl-list_item&quot;&amp;gt;&amp;lt;span class=&quot;mdl-list__item-primary-content&quot;&amp;gt;Content 1&amp;lt;/span&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li class=&quot;mdl-list_item&quot;&amp;gt;&amp;lt;span class=&quot;mdl-list__item-primary-content&quot;&amp;gt;Content 2&amp;lt;/span&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li class=&quot;mdl-list_item&quot;&amp;gt;&amp;lt;span class=&quot;mdl-list__item-primary-content&quot;&amp;gt;Content 3&amp;lt;/span&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li class=&quot;mdl-list_item&quot;&amp;gt;&amp;lt;span class=&quot;mdl-list__item-primary-content&quot;&amp;gt;Content 4&amp;lt;/span&amp;gt;&amp;lt;/li&amp;gt;&amp;lt;li class=&quot;mdl-list_item&quot;&amp;gt;&amp;lt;span class=&quot;mdl-list__item-primary-content&quot;&amp;gt;Content 5&amp;lt;/span&amp;gt;&amp;lt;/li&amp;gt;</code></pre><p>&lt;/ul&gt;<br>`</p><h3 id="Icon-List"><a href="#Icon-List" class="headerlink" title="Icon List"></a>Icon List</h3><!-- Icon List --></li><li><p><span class="mdl-list__item-primary-content"></span></p><pre><code>    _1_    Content 1&lt;/span&gt;</code></pre></li><li><span class="mdl-list__item-primary-content"><pre><code>    _2_    Content 2&lt;/span&gt;</code></pre></span></li><li><span class="mdl-list__item-primary-content"><pre><code>    _3_    Content 3&lt;/span&gt;</code></pre></span></li><li><span class="mdl-list__item-primary-content"><pre><code>    _4_    Content 4&lt;/span&gt;</code></pre></span></li><li><p><span class="mdl-list__item-primary-content"></span></p><pre><code>    _5_    Content 5&lt;/span&gt;</code></pre><pre>`&lt;!-- Icon List --&gt;&lt;ul class="mdl-list"&gt;    &lt;li class="mdl-list__item"&gt;        &lt;span class="mdl-list__item-primary-content"&gt;            &lt;i class="material-icons mdl-list__item-icon"&gt;1&lt;/i&gt;            &lt;p&gt;Content 1&lt;/p&gt;        &lt;/span&gt;&lt;/li&gt;    &lt;li class="mdl-list__item"&gt;        &lt;span class="mdl-list__item-primary-content"&gt;            &lt;i class="material-icons mdl-list__item-icon"&gt;2&lt;/i&gt;            &lt;p&gt;Content 2&lt;/p&gt;        &lt;/span&gt;&lt;/li&gt;    &lt;li class="mdl-list__item"&gt;        &lt;span class="mdl-list__item-primary-content"&gt;            &lt;i class="material-icons mdl-list__item-icon"&gt;3&lt;/i&gt;            &lt;p&gt;Content 3&lt;/p&gt;        &lt;/span&gt;&lt;/li&gt;    &lt;li class="mdl-list__item"&gt;        &lt;span class="mdl-list__item-primary-content"&gt;            &lt;i class="material-icons mdl-list__item-icon"&gt;4&lt;/i&gt;            &lt;p&gt;Content 4&lt;/p&gt;        &lt;/span&gt;&lt;/li&gt;    &lt;li class="mdl-list__item"&gt;        &lt;span class="mdl-list__item-primary-content"&gt;            &lt;i class="material-icons mdl-list__item-icon"&gt;5&lt;/i&gt;            &lt;p&gt;Content 5&lt;/p&gt;        &lt;/span&gt;&lt;/li&gt;&lt;/ul&gt;`</pre><h3 id="Avatars-and-Actions"><a href="#Avatars-and-Actions" class="headerlink" title="Avatars and Actions"></a>Avatars and Actions</h3><!-- List Item with Avatar and Action --></li><li><p><span class="mdl-list__item-primary-content"></span></p><pre><code>    _A1_    &lt;span&gt;content 1&lt;/span&gt;    [Star]()&lt;/span&gt;</code></pre></li><li><span class="mdl-list__item-primary-content"><pre><code>    _A2_    &lt;span&gt;content 2&lt;/span&gt;    [Star]()&lt;/span&gt;</code></pre></span></li><li><p><span class="mdl-list__item-primary-content"></span></p><pre><code>    _A3_    &lt;span&gt;content 3&lt;/span&gt;    [Star]()&lt;/span&gt;</code></pre><pre>`&lt;!-- List Item with Avatar and Action --&gt;&lt;ul class="mdl-list"&gt;    &lt;li class="mdl-list__item"&gt;        &lt;span class="mdl-list__item-primary-content"&gt;            &lt;i class="material-icons mdl-list__item-avatar"&gt;A1&lt;/i&gt;            &lt;span&gt;content 1&lt;/span&gt;            &lt;a href="" class="mdl-list_item-secondary-action"&gt;Star&lt;/a&gt;        &lt;/span&gt;&lt;/li&gt;    &lt;li class="mdl-list__item"&gt;        &lt;span class="mdl-list__item-primary-content"&gt;            &lt;i class="material-icons mdl-list__item-avatar"&gt;A2&lt;/i&gt;            &lt;span&gt;content 2&lt;/span&gt;            &lt;a href="" class="mdl-list_item-secondary-action"&gt;Star&lt;/a&gt;        &lt;/span&gt;&lt;/li&gt;    &lt;li class="mdl-list__item"&gt;        &lt;span class="mdl-list__item-primary-content"&gt;            &lt;i class="material-icons mdl-list__item-avatar"&gt;A3&lt;/i&gt;            &lt;span&gt;content 3&lt;/span&gt;            &lt;a href="" class="mdl-list_item-secondary-action"&gt;Star&lt;/a&gt;        &lt;/span&gt;&lt;/li&gt;&lt;/ul&gt;`</pre><h3 id="Avatars-and-Controls"><a href="#Avatars-and-Controls" class="headerlink" title="Avatars and Controls"></a>Avatars and Controls</h3><!-- List with Avatar and Controls --></li><li><p><span class="mdl-list__item-primary-content"></span></p><pre><code>    _C_Checkbox&lt;/span&gt;&lt;span class=&quot;mdl-list__item-secondary-action&quot;&gt;    &lt;label for=&quot;list-checkbox-1&quot; class=&quot;mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect&quot;&gt;        &lt;input type=&quot;checkbox&quot; class=&quot;mdl-checkbox__input&quot; checked id=&quot;list-checkbox-1&quot;&gt;    &lt;/label&gt;&lt;/span&gt;</code></pre></li><li><span class="mdl-list__item-primary-content"><pre><code>    _R_    Radio&lt;/span&gt;&lt;span class=&quot;mdl-list__item-secondary-action&quot;&gt;    &lt;label for=&quot;list-option-1&quot; class=&quot;mdl-radio mdl-js-radio mdl-js-ripple-effect&quot;&gt;        &lt;input type=&quot;radio&quot; class=&quot;mdl-radio__button&quot; id=&quot;list-option-1&quot; name=&quot;options&quot; value=&quot;1&quot; checked=&quot;&quot;&gt;    &lt;/label&gt;&lt;/span&gt;</code></pre></span></li><li><p><span class="mdl-list__item-primary-content"></span></p><pre><code>    _S_    Switch&lt;/span&gt;&lt;span class=&quot;mdl-list__item-secondary-action&quot;&gt;    &lt;label for=&quot;list-switch-1&quot; class=&quot;mdl-switch mdl-js-switch mdl-js-ripple-effect&quot;&gt;&lt;input type=&quot;checkbox&quot; checked class=&quot;mdl-switch__input&quot; id=&quot;list-switch-1&quot;&gt;&lt;/label&gt;&lt;/span&gt;</code></pre><pre>`    &lt;!-- List with Avatar and Controls --&gt;    &lt;ul class="mdl-list"&gt;        &lt;li class="mdl-list__item"&gt;            &lt;span class="mdl-list__item-primary-content"&gt;                &lt;i class="material-icons mdl-list__item-avatar"&gt;C&lt;/i&gt;            Checkbox            &lt;/span&gt;            &lt;span class="mdl-list__item-secondary-action"&gt;                &lt;label for="list-checkbox-1" class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect"&gt;                    &lt;input type="checkbox" class="mdl-checkbox__input" checked id="list-checkbox-1"&gt;                &lt;/label&gt;            &lt;/span&gt;        &lt;/li&gt;        &lt;li class="mdl-list__item"&gt;            &lt;span class="mdl-list__item-primary-content"&gt;                &lt;i class="material-icons mdl-list__item-avatar"&gt;R&lt;/i&gt;                Radio            &lt;/span&gt;            &lt;span class="mdl-list__item-secondary-action"&gt;                &lt;label for="list-option-1" class="mdl-radio mdl-js-radio mdl-js-ripple-effect"&gt;                    &lt;input type="radio" class="mdl-radio__button" id="list-option-1" name="options" value="1" checked=""&gt;                &lt;/label&gt;            &lt;/span&gt;        &lt;/li&gt;        &lt;li class="mdl-list__item"&gt;            &lt;span class="mdl-list__item-primary-content"&gt;                &lt;i class="material-icons mdl-list__item-avatar"&gt;S&lt;/i&gt;                Switch            &lt;/span&gt;            &lt;span class="mdl-list__item-secondary-action"&gt;                &lt;label for="list-switch-1" class="mdl-switch mdl-js-switch mdl-js-ripple-effect"&gt;&lt;input type="checkbox" checked class="mdl-switch__input" id="list-switch-1"&gt;&lt;/label&gt;            &lt;/span&gt;        &lt;/li&gt;    &lt;/ul&gt;`</pre><h3 id="List-of-Multi-line"><a href="#List-of-Multi-line" class="headerlink" title="List of Multi-line"></a>List of Multi-line</h3><!-- Two Line List with Secondary Info and Action --></li><li><p><span class="mdl-list__item-primary-content"></span></p><pre><code>        _1_        &lt;span&gt;Content&lt;/span&gt;        &lt;span class=&quot;mdl-list__item-sub-title&quot;&gt;Subtitle&lt;/span&gt;    &lt;/span&gt;    &lt;span class=&quot;mdl-list__item-secondary-content&quot;&gt;        &lt;span class=&quot;mdl-list__item-secondary-info&quot;&gt;Actor&lt;/span&gt;        [            _Star_        ](#)    &lt;/span&gt;&lt;!-- List with Text Body --&gt;*   &lt;span class=&quot;mdl-list__item-primary-content&quot;&gt;        _2_        &lt;span&gt;Content&lt;/span&gt;        &lt;span class=&quot;mdl-list__item-text-body&quot;&gt;            Lorem ipsum dolor sit amet, consectetur adipisicing elit. Laboriosam dolor asperiores totam accusantium quaerat sint nam illum ad praesentium et, reiciendis vel doloremque ex minima ipsam sit dignissimos facilis excepturi.        &lt;/span&gt;    &lt;/span&gt;    &lt;span class=&quot;mdl-list__item-secondary-content&quot;&gt;        [            _Star_        ](#)    &lt;/span&gt;</code></pre><p><pre>`&lt;!â Two Line List with Secondary Info and Action â&gt;</pre></p><pre><code>&amp;lt;ul class=&quot;mdl-list&quot;&amp;gt;    &amp;lt;li class=&quot;mdl-list__item mdl-list__item--two-line&quot;&amp;gt;        &amp;lt;span class=&quot;mdl-list__item-primary-content&quot;&amp;gt;            &amp;lt;i class=&quot;material-icons mdl-list__item-avatar&quot;&amp;gt;1&amp;lt;/i&amp;gt;            &amp;lt;span&amp;gt;Content&amp;lt;/span&amp;gt;            &amp;lt;span class=&quot;mdl-list__item-sub-title&quot;&amp;gt;Subtitle&amp;lt;/span&amp;gt;        &amp;lt;/span&amp;gt;        &amp;lt;span class=&quot;mdl-list__item-secondary-content&quot;&amp;gt;            &amp;lt;span class=&quot;mdl-list__item-secondary-info&quot;&amp;gt;Actor&amp;lt;/span&amp;gt;            &amp;lt;a href=&quot;#&quot; class=&quot;mdl-list__item-secondary-action&quot;&amp;gt;                &amp;lt;i class=&quot;material-icons&quot;&amp;gt;Star&amp;lt;/i&amp;gt;            &amp;lt;/a&amp;gt;        &amp;lt;/span&amp;gt;    &amp;lt;/li&amp;gt;    &amp;lt;!-- List with Text Body --&amp;gt;    &amp;lt;li class=&quot;mdl-list__item mdl-list__item--three-line&quot;&amp;gt;        &amp;lt;span class=&quot;mdl-list__item-primary-content&quot;&amp;gt;            &amp;lt;i class=&quot;material-icons mdl-list__item-avatar&quot;&amp;gt;2&amp;lt;/i&amp;gt;            &amp;lt;span&amp;gt;Content&amp;lt;/span&amp;gt;            &amp;lt;span class=&quot;mdl-list__item-text-body&quot;&amp;gt;                Lorem ipsum dolor sit amet, consectetur adipisicing elit. Laboriosam dolor asperiores totam accusantium quaerat sint nam illum ad praesentium et, reiciendis vel doloremque ex minima ipsam sit dignissimos facilis excepturi.            &amp;lt;/span&amp;gt;        &amp;lt;/span&amp;gt;        &amp;lt;span class=&quot;mdl-list__item-secondary-content&quot;&amp;gt;            &amp;lt;a href=&quot;#&quot; class=&quot;mdl-list__item-secondary-action&quot;&amp;gt;                &amp;lt;i class=&quot;material-icons&quot;&amp;gt;Star&amp;lt;/i&amp;gt;            &amp;lt;/a&amp;gt;        &amp;lt;/span&amp;gt;    &amp;lt;/li&amp;gt;&amp;lt;/ul&amp;gt;</code></pre></li></ul>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Material Design </tag>
            
            <tag> MDL </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>MDL-Navigation</title>
      <link href="/2016/05/26/mdl-navigation/"/>
      <content type="html"><![CDATA[<h3 id="Transparent-Navigation"><a href="#Transparent-Navigation" class="headerlink" title="Transparent Navigation"></a>Transparent Navigation</h3><p><img src="http://7xu8mu.com1.z0.glb.clouddn.com/wp-content/uploads/Transparent%20Navigation.png" alt="Transparent Navigation"></p><pre><code>.demo-layout-transparent{        background: url(&apos;https://getmdl.io/assets/demos/transparent.jpg&apos;) center/cover;    }&amp;lt;/style&amp;gt;&amp;lt;/head&amp;gt;&amp;lt;/body&amp;gt;    &amp;lt;div class=&quot;demo-layout-transparent mdl-layout mdl-js-layout&quot;&amp;gt;        &amp;lt;header class=&quot;mdl-layout__header mdl-layout__header--transparent&quot;&amp;gt;            &amp;lt;div class=&quot;mdl-layout__header-row&quot;&amp;gt;                &amp;lt;!--Title--&amp;gt;                &amp;lt;span class=&quot;mdl-layout-title&quot;&amp;gt;Title&amp;lt;/span&amp;gt;                &amp;lt;!--Add spacer, to align navigation to the right--&amp;gt;                &amp;lt;div class=&quot;mdl-layout-spacer&quot;&amp;gt;&amp;lt;/div&amp;gt;                &amp;lt;!--Navigation--&amp;gt;                &amp;lt;nav class=&quot;mdl-navigation&quot;&amp;gt;                    &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                    &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                    &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                    &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                &amp;lt;/nav&amp;gt;            &amp;lt;/div&amp;gt;        &amp;lt;/header&amp;gt;        &amp;lt;div class=&quot;mdl-layout__drawer&quot;&amp;gt;            &amp;lt;span class=&quot;mdl-layout-title&quot;&amp;gt;Title&amp;lt;/span&amp;gt;            &amp;lt;nav class=&quot;mdl-navigation&quot;&amp;gt;                &amp;lt;nav class=&quot;mdl-navigation__link&quot; href=&quot;#&quot;&amp;gt;Link&amp;lt;/nav&amp;gt;            &amp;lt;nav class=&quot;mdl-navigation__link&quot; href=&quot;#&quot;&amp;gt;Link&amp;lt;/nav&amp;gt;            &amp;lt;nav class=&quot;mdl-navigation__link&quot; href=&quot;#&quot;&amp;gt;Link&amp;lt;/nav&amp;gt;            &amp;lt;nav class=&quot;mdl-navigation__link&quot; href=&quot;#&quot;&amp;gt;Link&amp;lt;/nav&amp;gt;            &amp;lt;/nav&amp;gt;        &amp;lt;/div&amp;gt;    &amp;lt;/div&amp;gt;`&lt;/pre&gt;### Fixed Drawer without Header(The drawer will open automatically in large screen)![Fixed Drawer](http://7xu8mu.com1.z0.glb.clouddn.com/wp-content/uploads/FixedDrawer1.png)&lt;pre&gt;`    &amp;lt;div class=&quot;mdl-layout mdl-js-layout mdl-layout--fixed-drawer&quot;&amp;gt;        &amp;lt;div class=&quot;mdl-layout__drawer&quot;&amp;gt;            &amp;lt;span class=&quot;mdl-layout-title&quot;&amp;gt;Title&amp;lt;/span&amp;gt;            &amp;lt;nav class=&quot;mdl-navigation&quot;&amp;gt;                &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;            &amp;lt;/nav&amp;gt;        &amp;lt;/div&amp;gt;    &amp;lt;/div&amp;gt;`&lt;/pre&gt;### Fixed Header(The Header shows always, even in small screen)![Fixed Header](http://7xu8mu.com1.z0.glb.clouddn.com/wp-content/uploads/FixedHeader.png)&lt;pre&gt;`    &amp;lt;div class=&quot;mdl-layout mdl-js-layout mdl-layout--fixed-header&quot;&amp;gt;        &amp;lt;header class=&quot;mdl-layout__header&quot;&amp;gt;            &amp;lt;div class=&quot;mdl-layout__header-row&quot;&amp;gt;                &amp;lt;span class=&quot;mdl-layout-title&quot;&amp;gt;Title&amp;lt;/span&amp;gt;                &amp;lt;div class=&quot;mdl-layout-spacer&quot;&amp;gt;&amp;lt;/div&amp;gt;                &amp;lt;nav class=&quot;mdl-navigation mdl-navigation--large-screen-only&quot;&amp;gt;                    &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                    &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                    &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                &amp;lt;/nav&amp;gt;            &amp;lt;/div&amp;gt;        &amp;lt;/header&amp;gt;        &amp;lt;div class=&quot;mdl-layout__drawer&quot;&amp;gt;            &amp;lt;span class=&quot;mdl-layout-title&quot;&amp;gt;                Title            &amp;lt;/span&amp;gt;            &amp;lt;nav class=&quot;mdl-navigation&quot;&amp;gt;                &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;            &amp;lt;/nav&amp;gt;        &amp;lt;/div&amp;gt;    &amp;lt;/div&amp;gt;`&lt;/pre&gt;### Fixed Header and Drawer![Fixed Header and Drawer](http://7xu8mu.com1.z0.glb.clouddn.com/wp-content/uploads/FixedHeader&amp;Drawer.png)&lt;pre&gt;`&amp;lt;div class=&quot;mdl-layout mdl-js-layout mdl-layout--fixed-drawer mdl-layout--fixed-header&quot;&amp;gt;        &amp;lt;header class=&quot;mdl-layout__header&quot;&amp;gt;            &amp;lt;div class=&quot;mdl-layout__header-row&quot;&amp;gt;                &amp;lt;div class=&quot;mdl-layout-spacer&quot;&amp;gt;&amp;lt;/div&amp;gt;                &amp;lt;div class=&quot;mdl-textfield mdl-js-textfield mdl-textfield--expandable mdl-textfield--floating-label mdl-text--align-right&quot;&amp;gt;                    &amp;lt;label for=&quot;fixed-header-drawer-exp&quot; class=&quot;mdl-button mdl-js-button mdl-button--icon&quot;&amp;gt;S&amp;lt;/label&amp;gt;                    &amp;lt;div class=&quot;mdl-textfield__expandable-holder&quot;&amp;gt;                        &amp;lt;input type=&quot;text&quot; class=&quot;mdl-textfield__input&quot; name=&quot;sample&quot; id=&quot;fixed-header-drawer-exp&quot;&amp;gt;                    &amp;lt;/div&amp;gt;                &amp;lt;/div&amp;gt;            &amp;lt;/div&amp;gt;        &amp;lt;/header&amp;gt;        &amp;lt;div class=&quot;mdl-layout__drawer&quot;&amp;gt;            &amp;lt;span class=&quot;mdl-layout-title&quot;&amp;gt;Title&amp;lt;/span&amp;gt;            &amp;lt;nav class=&quot;mdl-navigation&quot;&amp;gt;                &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;            &amp;lt;/nav&amp;gt;        &amp;lt;/div&amp;gt;    &amp;lt;/div&amp;gt;`&lt;/pre&gt;### Scrolling Header&lt;pre&gt;`&amp;lt;div class=&quot;mdl-layout mdl-js-layout&quot;&amp;gt;        &amp;lt;header class=&quot;mdl-layout__header mdl-layout__header--scroll&quot;&amp;gt;            &amp;lt;div class=&quot;mdl-layout__header-row&quot;&amp;gt;                &amp;lt;span class=&quot;mdl-layout-title&quot;&amp;gt;Title&amp;lt;/span&amp;gt;            &amp;lt;/div&amp;gt;            &amp;lt;div class=&quot;mdl-layout-spacer&quot;&amp;gt;&amp;lt;/div&amp;gt;            &amp;lt;nav class=&quot;mdl-navigation&quot;&amp;gt;                &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;            &amp;lt;/nav&amp;gt;        &amp;lt;/header&amp;gt;        &amp;lt;div class=&quot;mdl-layout__drawer&quot;&amp;gt;            &amp;lt;span class=&quot;mdl-layout-title&quot;&amp;gt;Title&amp;lt;/span&amp;gt;            &amp;lt;nav class=&quot;mdl-navigation&quot;&amp;gt;                &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                &amp;lt;a href=&quot;#&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;            &amp;lt;/nav&amp;gt;        &amp;lt;/div&amp;gt;    &amp;lt;/div&amp;gt;`&lt;/pre&gt;### Waterfall Header&lt;pre&gt;`    &amp;lt;div class=&quot;demo-layout-water mdl-layout mdl-js-layout&quot;&amp;gt;        &amp;lt;header class=&quot;mdl-layout__header mdl-layout--water&quot;&amp;gt;            &amp;lt;!-- Top Row Always Visible --&amp;gt;            &amp;lt;div class=&quot;mdl-layout__header-row&quot;&amp;gt;                &amp;lt;!-- Title --&amp;gt;                &amp;lt;span class=&quot;mdl-layout-title&quot;&amp;gt;Title&amp;lt;/span&amp;gt;                &amp;lt;div class=&quot;mdl-layout-spacer&quot;&amp;gt;&amp;lt;/div&amp;gt;                &amp;lt;div class=&quot;mdl-textfield mdl-js-textfield mdl-textfield--expandable mdl-textfield--floating-label mdl-textfield--align-right&quot;&amp;gt;                    &amp;lt;label for=&quot;waterfall-exp&quot; class=&quot;mdl-button mdl-js-button mdl-button--icon&quot;&amp;gt;                        &amp;lt;i class=&quot;material-icons&quot;&amp;gt;Search&amp;lt;/i&amp;gt;                    &amp;lt;/label&amp;gt;                    &amp;lt;div class=&quot;mdl-textfield__expandable-holder&quot;&amp;gt;                        &amp;lt;input type=&quot;text&quot; name=&quot;sample&quot; id=&quot;waterfall-exp&quot; class=&quot;mdl-textfield__input&quot;&amp;gt;                    &amp;lt;/div&amp;gt;                &amp;lt;/div&amp;gt;            &amp;lt;/div&amp;gt;            &amp;lt;!-- Bottom Row, Invisible on Scroll --&amp;gt;            &amp;lt;div class=&quot;mdl-layout__header-row&quot;&amp;gt;                &amp;lt;div class=&quot;mdl-layout-spacer&quot;&amp;gt;&amp;lt;/div&amp;gt;                &amp;lt;nav class=&quot;mdl-navigation&quot;&amp;gt;                    &amp;lt;a href=&quot;&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                    &amp;lt;a href=&quot;&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                    &amp;lt;a href=&quot;&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                    &amp;lt;a href=&quot;&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                    &amp;lt;a href=&quot;&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                &amp;lt;/nav&amp;gt;            &amp;lt;/div&amp;gt;        &amp;lt;/header&amp;gt;        &amp;lt;div class=&quot;mdl-layout__drawer&quot;&amp;gt;            &amp;lt;span class=&quot;mdl-layout-title&quot;&amp;gt;Title&amp;lt;/span&amp;gt;             &amp;lt;nav class=&quot;mdl-navigation&quot;&amp;gt;                &amp;lt;a href=&quot;&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                &amp;lt;a href=&quot;&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                &amp;lt;a href=&quot;&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                &amp;lt;a href=&quot;&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;                &amp;lt;a href=&quot;&quot; class=&quot;mdl-navigation__link&quot;&amp;gt;Link&amp;lt;/a&amp;gt;            &amp;lt;/nav&amp;gt;        &amp;lt;/div&amp;gt;    &amp;lt;/div&amp;gt;`&lt;/pre&gt;### Scrollable Tabs&lt;pre&gt;`&amp;lt;div class=&quot;mdl-layout mdl-js-layout mdl-layout--fixed-header&quot;&amp;gt;    &amp;lt;header class=&quot;mdl-layout__header&quot;&amp;gt;        &amp;lt;div class=&quot;mdl-layout__header-row&quot;&amp;gt;            &amp;lt;span class=&quot;mdl-layout-title&quot;&amp;gt;Title&amp;lt;/span&amp;gt;        &amp;lt;/div&amp;gt;        &amp;lt;!-- Tab --&amp;gt;        &amp;lt;div class=&quot;mdl-layout__tab-bar mdl-js-ripple-effect&quot;&amp;gt;            &amp;lt;a href=&quot;#scroll-tab-1&quot; class=&quot;mdl-layout__tab is-active&quot;&amp;gt;Tab 1&amp;lt;/a&amp;gt;            &amp;lt;a href=&quot;#scroll-tab-2&quot; class=&quot;mdl-layout__tab&quot;&amp;gt;Tab 2&amp;lt;/a&amp;gt;            &amp;lt;a href=&quot;#scroll-tab-3&quot; class=&quot;mdl-layout__tab&quot;&amp;gt;Tab 3&amp;lt;/a&amp;gt;            &amp;lt;a href=&quot;#scroll-tab-4&quot; class=&quot;mdl-layout__tab&quot;&amp;gt;Tab 4&amp;lt;/a&amp;gt;            &amp;lt;a href=&quot;#scroll-tab-5&quot; class=&quot;mdl-layout__tab&quot;&amp;gt;Tab 5&amp;lt;/a&amp;gt;        &amp;lt;/div&amp;gt;    &amp;lt;/header&amp;gt;    &amp;lt;div class=&quot;mdl-layout__drawer&quot;&amp;gt;        &amp;lt;span class=&quot;mdl-layout-title&quot;&amp;gt;Title&amp;lt;/span&amp;gt;    &amp;lt;/div&amp;gt;    &amp;lt;main class=&quot;mdl-layout__content&quot;&amp;gt;        &amp;lt;section class=&quot;mdl-layout__tab-panel is-active&quot; id=&quot;scroll-tab-1&quot;&amp;gt;            &amp;lt;div class=&quot;page-content&quot; style=&quot;height:500px&quot;&amp;gt;Tab 1&amp;lt;/div&amp;gt;        &amp;lt;/section&amp;gt;        &amp;lt;section class=&quot;mdl-layout__tab-panel&quot; id=&quot;scroll-tab-2&quot;&amp;gt;            &amp;lt;div class=&quot;page-content&quot; style=&quot;height:500px&quot;&amp;gt;Tab 2&amp;lt;/div&amp;gt;        &amp;lt;/section&amp;gt;        &amp;lt;section class=&quot;mdl-layout__tab-panel&quot; id=&quot;scroll-tab-3&quot;&amp;gt;            &amp;lt;div class=&quot;page-content&quot; style=&quot;height:500px&quot;&amp;gt;Tab 3&amp;lt;/div&amp;gt;        &amp;lt;/section&amp;gt;        &amp;lt;section class=&quot;mdl-layout__tab-panel&quot; id=&quot;scroll-tab-4&quot;&amp;gt;            &amp;lt;div class=&quot;page-content&quot; style=&quot;height:500px&quot;&amp;gt;Tab 4&amp;lt;/div&amp;gt;        &amp;lt;/section&amp;gt;        &amp;lt;section class=&quot;mdl-layout__tab-panel&quot; id=&quot;scroll-tab-5&quot;&amp;gt;            &amp;lt;div class=&quot;page-content&quot; style=&quot;height:500px&quot;&amp;gt;Tab 5&amp;lt;/div&amp;gt;        &amp;lt;/section&amp;gt;    &amp;lt;/main&amp;gt;&amp;lt;/div&amp;gt;`&lt;/pre&gt;### Fixed Tabs&lt;pre&gt;`&amp;lt;div class=&quot;mdl-layout mdl-js-layout mdl-layout--fixed-header mdl-layout--fixed-tabs&quot;&amp;gt;    &amp;lt;header class=&quot;mdl-layout__header&quot;&amp;gt;        &amp;lt;div class=&quot;mdl-layout__header-row&quot;&amp;gt;            &amp;lt;span class=&quot;mdl-layout-title&quot;&amp;gt;Title&amp;lt;/span&amp;gt;        &amp;lt;/div&amp;gt;        &amp;lt;div class=&quot;mdl-layout__tab-bar mdl-js-ripple-effect&quot;&amp;gt;            &amp;lt;a href=&quot;#fixed-tab-1&quot; class=&quot;mdl-layout__tab is-active&quot;&amp;gt;Tab 1&amp;lt;/a&amp;gt;            &amp;lt;a href=&quot;#fixed-tab-2&quot; class=&quot;mdl-layout__tab&quot;&amp;gt;Tab 2&amp;lt;/a&amp;gt;            &amp;lt;a href=&quot;#fixed-tab-3&quot; class=&quot;mdl-layout__tab&quot;&amp;gt;Tab 3&amp;lt;/a&amp;gt;        &amp;lt;/div&amp;gt;    &amp;lt;/header&amp;gt;    &amp;lt;div class=&quot;mdl-layout__drawer&quot;&amp;gt;        &amp;lt;span class=&quot;mdl-layout-title&quot;&amp;gt;Title&amp;lt;/span&amp;gt;    &amp;lt;/div&amp;gt;    &amp;lt;main class=&quot;mdl-layout__content&quot;&amp;gt;        &amp;lt;section class=&quot;mdl-layout__tab-panel&quot; id=&quot;fixed-tab-1&quot;&amp;gt;            &amp;lt;div class=&quot;page-content&quot; style=&quot;height:500px&quot;&amp;gt;Tab 1&amp;lt;/div&amp;gt;        &amp;lt;/section&amp;gt;        &amp;lt;section class=&quot;mdl-layout__tab-panel&quot; id=&quot;fixed-tab-2&quot;&amp;gt;            &amp;lt;div class=&quot;page-content&quot; style=&quot;height:500px&quot;&amp;gt;Tab 2&amp;lt;/div&amp;gt;        &amp;lt;/section&amp;gt;        &amp;lt;section class=&quot;mdl-layout__tab-panel&quot; id=&quot;fixed-tab-3&quot;&amp;gt;            &amp;lt;div class=&quot;page-content&quot; style=&quot;height:500px&quot;&amp;gt;Tab 3&amp;lt;/div&amp;gt;        &amp;lt;/section&amp;gt;    &amp;lt;/main&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;</code></pre>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Material Design </tag>
            
            <tag> MDL </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>MDL-Card</title>
      <link href="/2016/05/25/mdl-card/"/>
      <content type="html"><![CDATA[<h3 id="Wide-Card"><a href="#Wide-Card" class="headerlink" title="Wide Card"></a>Wide Card</h3><p><img src="http://7xu8mu.com1.z0.glb.clouddn.com/wp-content/uploads/Card-Wide.png" alt="Wide Card"></p><pre><code>    &amp;lt;style&amp;gt;        .demo-card-wide.mdl-card{            width:512px        }        .demo-card-wide&amp;gt;.mdl-card__title{            color: #fff;            height: 176px;            background: url(&quot;https://getmdl.io/assets/demos/welcome_card.jpg&quot;) center/cover;        }    &amp;lt;/style&amp;gt;&amp;lt;/head&amp;gt;&amp;lt;body&amp;gt;    &amp;lt;div class=&quot;demo-card-wide mdl-card mdl-shadow--2dp&quot;&amp;gt;        &amp;lt;div class=&quot;mdl-card__title&quot;&amp;gt;            &amp;lt;h2 class=&quot;mdl-card__title-text&quot;&amp;gt;TItle&amp;lt;/h2&amp;gt;        &amp;lt;/div&amp;gt;        &amp;lt;div class=&quot;mdl-card__supporting-text&quot;&amp;gt;            Supporting Text; Supporting Text; Supporting Text; Supporting Text; Supporting Text; Supporting Text; Supporting Text; Supporting Text; Supporting Text; Supporting Text; Supporting Text;        &amp;lt;/div&amp;gt;        &amp;lt;div class=&quot;mdl-card__actions mdl-card--border&quot;&amp;gt;            &amp;lt;a href=&quot;#&quot; class=&quot;mdl-button mdl-js-button mdl-js-ripple-effect&quot;&amp;gt;Get Start&amp;lt;/a&amp;gt;        &amp;lt;/div&amp;gt;        &amp;lt;div class=&quot;mdl-card__menu&quot;&amp;gt;            &amp;lt;button class=&quot;mdl-button mdl-js-button mdl-js-ripple-effect&quot;&amp;gt;Share&amp;lt;/button&amp;gt;        &amp;lt;/div&amp;gt;    &amp;lt;/div&amp;gt;&amp;lt;/body&amp;gt;`&lt;/pre&gt;### Square Card![Square Card](http://7xu8mu.com1.z0.glb.clouddn.com/wp-content/uploads/squareCard.png)&lt;pre&gt;`&amp;lt;style&amp;gt;    .demo-card-square.mdl-card{        width:320px;        height: 320px;    }    .demo-card-square&amp;gt;.mdl-card__title{        color: #fff;  background:    url(&apos;https://getmdl.io/assets/demos/dog.png&apos;) bottom right 15% no-repeat #46B6AC;    }&amp;lt;/style&amp;gt;&amp;lt;/head&amp;gt;&amp;lt;/body&amp;gt;&amp;lt;div class=&quot;demo-card-square mdl-card mdl-shadow--2dp&quot;&amp;gt;    &amp;lt;div class=&quot;mdl-card__title mdl-card--expand&quot;&amp;gt;        &amp;lt;h2 class=&quot;mdl-card__title-text&quot;&amp;gt;            Square Card        &amp;lt;/h2&amp;gt;    &amp;lt;/div&amp;gt;    &amp;lt;div class=&quot;mdl-card__supporting-text&quot;&amp;gt;        Supporting Text; Supporting Text; Supporting Text; Supporting Text; Supporting Text; Supporting Text; Supporting Text; Supporting Text; Supporting Text; Supporting Text; Supporting Text;    &amp;lt;/div&amp;gt;    &amp;lt;div class=&quot;mdl-card__actions mdl-card--border&quot;&amp;gt;        &amp;lt;a href=&quot;&quot; class=&quot;mdl-button mdl-js-button mdl-js-ripple-effect&quot;&amp;gt;View Update&amp;lt;/a&amp;gt;    &amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/body&amp;gt;`&lt;/pre&gt;### Image Card![Image Card](http://7xu8mu.com1.z0.glb.clouddn.com/wp-content/uploads/ImageCard.png)&lt;pre&gt;`&amp;lt;style&amp;gt;    .demo-card-image.mdl-card{        width: 256px;        height: 256px;        background: url(&apos;https://getmdl.io/assets/demos/image_card.jpg&apos;) center/cover;    }    .demo-card-image&amp;gt;.mdl-card__actions{        height: 52px;        padding:16px;        background: rgba(0,0,0,0.2);    }    .demo-card-image__filename{        color: #fff;        font-size: 14px;        font-weight: 500;    }&amp;lt;/style&amp;gt;&amp;lt;/head&amp;gt;&amp;lt;/body&amp;gt;&amp;lt;div class=&quot;demo-card-image mdl-card mdl-shadow--2dp&quot;&amp;gt;    &amp;lt;div class=&quot;mdl-cart__title mdl-card--expand&quot;&amp;gt;&amp;lt;/div&amp;gt;    &amp;lt;div class=&quot;mdl-card__actions&quot;&amp;gt;        &amp;lt;span class=&quot;demo-card-image__filename&quot;&amp;gt;Image Filename&amp;lt;/span&amp;gt;    &amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/body&amp;gt;`&lt;/pre&gt;### Event Card![Event Card](http://7xu8mu.com1.z0.glb.clouddn.com/wp-content/uploads/EventCard.png)&lt;pre&gt;`&amp;lt;style&amp;gt;    .demo-card-event.mdl-card{        width: 256px;        height: 256px;        background: #3E4EB8;    }    .demo-card-event&amp;gt;.mdl-card__actions{        border-color: rgba(255,255,255,0.2);    }    .demo-card-event&amp;gt;.mdl-card__title{        align-items: flex-start;    }    .demo-card-event&amp;gt;.mdl-card__title&amp;gt;h4{        margin-top: 0;    }    .demo-card-event&amp;gt;.mdl-card__actions{        display: flex;        box-sizing: border-box;        align-items: center;    }    .demo-card-event&amp;gt;.mdl-card__actions&amp;gt;.material-icons{        padding-right: 10px;    }    .demo-card-event&amp;gt;.mdl-card__title, .demo-card-event&amp;gt;.mdl-card__actions, .demo-card-event&amp;gt;.mdl-card__actions&amp;gt;.mdl-button{        color:#fff;    }&amp;lt;/style&amp;gt;&amp;lt;/head&amp;gt;&amp;lt;/body&amp;gt;    &amp;lt;div class=&quot;demo-card-event mdl-card mdl-shadow--2dp&quot;&amp;gt;        &amp;lt;div class=&quot;mdl-card__title mdl-card--expand&quot;&amp;gt;            &amp;lt;h4&amp;gt;                Featured event:&amp;lt;br&amp;gt;                May 24, 2016&amp;lt;br&amp;gt;                7 - 11pm            &amp;lt;/h4&amp;gt;        &amp;lt;/div&amp;gt;        &amp;lt;div class=&quot;mdl-card__actions mdl-card--border&quot;&amp;gt;            &amp;lt;a href=&quot;#&quot; class=&quot;mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect&quot;&amp;gt;                Add to Calendar            &amp;lt;/a&amp;gt;            &amp;lt;div class=&quot;mdl-layout-spacer&quot;&amp;gt;&amp;lt;/div&amp;gt;            &amp;lt;i class=&quot;material-icons&quot;&amp;gt;Evnet&amp;lt;/i&amp;gt;        &amp;lt;/div&amp;gt;    &amp;lt;/div&amp;gt;&amp;lt;/body&amp;gt;</code></pre>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>MDL-Button</title>
      <link href="/2016/05/25/mdl-button/"/>
      <content type="html"><![CDATA[<html><br>  <head><br>    <!-- Material Design Lite --><br>    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"><br>    <link rel="stylesheet" href="https://code.getmdl.io/1.1.3/material.indigo-pink.min.css"><br>    <script defer src="https://code.getmdl.io/1.1.3/material.min.js"></script><br>  </head><br><br><pre><br><!-- Colored FAB Button --><br>  <button class="mdl-button mdl-js-button mdl-button--fab mdl-button--colored mdl-js-ripple-effect">Add</button>: class=âmdl-button mdl-js-button mdl-buttonâfab mdl-buttonâcolored mdl-js-ripple-effectâ, <strong>âmdl-buttonâfabâ adds the 3D circle, âmdl-buttonâcoloredâ colors the 3D circle, âmdl-js-ripple-effectâ adds ripple effect ont the button</strong><br><br>  <!-- Raised Button --><br>  <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect">Button</button>: class=âmdl-button mdl-js-button mdl-buttonâraised mdl-js-ripple-effectâ, <strong>âmdl-buttonâraisedâ adds the 3D Rectangle on the button.</strong><br><br>  <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored">Button</button>: class=âmdl-button mdl-js-button mdl-buttonâraised mdl-buttonâcoloredâ, <strong>âmdl-buttonâcoloredâ add Primary color to Button.</strong><br><br>  <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--accent">Button</button>: class=âmdl-button mdl-js-button mdl-buttonâraised mdl-buttonâaccentâ, <strong>âmdl-buttonâaccentâ adds Accent color ont he Button.</strong><br><br>  <button class="mdl-button mdl-js-button mdl-button--primary">Button</button>: class=âmdl-button mdl-js-button mdl-buttonâprimaryâ, <strong>âmdl-buttonâprimaryâ adds primary color on the text.</strong><br><br>  <button class="mdl-button mdl-js-button mdl-button--accent">Button</button>: class=âmdl-button mdl-js-button mdl-buttonâaccentâ, <strong>âmdl-buttonâaccentâ adds accent color on the text</strong><br><br><!--   Mini FAB Button --><br>  <button class="mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab">i</button>: class=âmdl-button mdl-js-button mdl-buttonâfab mdl-buttonâmini-fabâ, <strong>âmdl-buttonâmini-fabâ make a mini buttonâ</strong><br><br>    </pre><br><br>    &lt;!â Colored FAB Button â&gt;<br>      &lt;button class=âmdl-button mdl-js-button mdl-buttonâfab mdl-buttonâcolored mdl-js-ripple-effectâ&gt;Add&lt;/button&gt;: class=âmdl-button mdl-js-button mdl-buttonâfab mdl-buttonâcolored mdl-js-ripple-effectâ, &lt;strong&gt;âmdl-buttonâfabâ adds the 3D circle, âmdl-buttonâcoloredâ colors the 3D circle, âmdl-js-ripple-effectâ adds ripple effect ont the button&lt;/strong&gt;&lt;br&gt;<br>      &lt;!â Raised Button â&gt;<br>      &lt;button class=âmdl-button mdl-js-button mdl-buttonâraised mdl-js-ripple-effectâ&gt;Button&lt;/button&gt;: class=âmdl-button mdl-js-button mdl-buttonâraised mdl-js-ripple-effectâ, &lt;strong&gt;âmdl-buttonâraisedâ adds the 3D Rectangle on the button.&lt;/strong&gt;&lt;br&gt;<br>      &lt;button class=âmdl-button mdl-js-button mdl-buttonâraised mdl-buttonâcoloredâ&gt;Button&lt;/button&gt;: class=âmdl-button mdl-js-button mdl-buttonâraised mdl-buttonâcoloredâ, &lt;strong&gt;âmdl-buttonâcoloredâ add Primary color to Button.&lt;/strong&gt;&lt;br&gt;<br>      &lt;button class=âmdl-button mdl-js-button mdl-buttonâraised mdl-buttonâaccentâ&gt;Button&lt;/button&gt;: class=âmdl-button mdl-js-button mdl-buttonâraised mdl-buttonâaccentâ, &lt;strong&gt;âmdl-buttonâaccentâ adds Accent color ont he Button.&lt;/strong&gt;&lt;br&gt;<br>      &lt;button class=âmdl-button mdl-js-button mdl-buttonâprimaryâ&gt;Button&lt;/button&gt;: class=âmdl-button mdl-js-button mdl-buttonâprimaryâ, &lt;strong&gt;âmdl-buttonâprimaryâ adds primary color on the text.&lt;/strong&gt;&lt;br&gt;<br>      &lt;button class=âmdl-button mdl-js-button mdl-buttonâaccentâ&gt;Button&lt;/button&gt;: class=âmdl-button mdl-js-button mdl-buttonâaccentâ, &lt;strong&gt;âmdl-buttonâaccentâ adds accent color on the text&lt;/strong&gt;&lt;br&gt;<br>    &lt;!â   Mini FAB Button â&gt;<br>      &lt;button class=âmdl-button mdl-js-button mdl-buttonâfab mdl-buttonâmini-fabâ&gt;i&lt;/button&gt;: class=âmdl-button mdl-js-button mdl-buttonâfab mdl-buttonâmini-fabâ, &lt;strong&gt;âmdl-buttonâmini-fabâ make a mini buttonâ&lt;/strong&gt;&lt;br&gt;<br><br></html>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Material Design </tag>
            
            <tag> MDL </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>MDL-Badge</title>
      <link href="/2016/05/24/mdl-badge/"/>
      <content type="html"><![CDATA[<head><br>    <!-- Material Design Lite --><br>    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"><br>    <link rel="stylesheet" href="https://code.getmdl.io/1.1.3/material.indigo-pink.min.css"><br>    <script defer src="https://code.getmdl.io/1.1.3/material.min.js"></script><br>  </head><pre><!-- Number badge on icon --><div class="material-icons mdl-badge mdl-badge--overlap" data-badge="1">Badge</div>: class="material-icons mdl-badge mdl-badge--overlap"<span class="mdl-badge" data-badge="2">Badge</span>: class="mdl-badge", **the material-icons makes the text bigger, and mdl-badge--overlap makes badge overlap the text**[Badge](#): Badge in the inlink[Badge](#)<span class="mdl-badge" data-badge="4"></span>: Badge outside the link[Badge](#): Badge with too many characters(12345)[Badge](#): class="mdl-badge mdl-badge--no-background"</pre><pre><code>&amp;lt;!-- Number badge on icon --&amp;gt;&amp;lt;div class=&quot;material-icons mdl-badge mdl-badge--overlap&quot; data-badge=&quot;1&quot;&amp;gt;Badge&amp;lt;/div&amp;gt;: class=&quot;material-icons mdl-badge mdl-badge--overlap&quot;&amp;lt;br&amp;gt;&amp;lt;span class=&quot;mdl-badge&quot; data-badge=&quot;2&quot;&amp;gt;Badge&amp;lt;/span&amp;gt;: class=&quot;mdl-badge&quot;, &amp;lt;strong&amp;gt;the material-icons makes the text bigger, and mdl-badge--overlap makes badge overlap the text&amp;lt;/strong&amp;gt;&amp;lt;br&amp;gt;&amp;lt;a href=&quot;#&quot; class=&quot;mdl-badge&quot; data-badge=&quot;3&quot;&amp;gt;Badge&amp;lt;/a&amp;gt;: Badge in the inlink&amp;lt;br&amp;gt;&amp;lt;a href=&quot;#&quot;&amp;gt;Badge&amp;lt;/a&amp;gt;&amp;lt;span class=&quot;mdl-badge&quot; data-badge=&quot;4&quot;&amp;gt;&amp;lt;/span&amp;gt;: Badge outside the link&amp;lt;br&amp;gt;&amp;lt;a href=&quot;#&quot; class=&quot;mdl-badge&quot; data-badge=&quot;12345&quot;&amp;gt;Badge&amp;lt;/a&amp;gt;: Badge with too many characters(12345)&amp;lt;br&amp;gt;&amp;lt;a href=&quot;#&quot; class=&quot;mdl-badge mdl-badge--no-background&quot; data-badge=&quot;6&quot;&amp;gt;Badge&amp;lt;/a&amp;gt;: class=&quot;mdl-badge mdl-badge--no-background&quot;</code></pre>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Material Design </tag>
            
            <tag> MDL </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Material Design Lite Glossary</title>
      <link href="/2016/05/24/materialdesignliteglossary/"/>
      <content type="html"><![CDATA[]]></content>
      
      <categories>
          
          <category> github </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>CFB MindMap</title>
      <link href="/2016/05/23/cfb-mindmap/"/>
      <content type="html"><![CDATA[<iframe width="100%" height="800px" src="https://embed.coggle.it/diagram/V0MZgJAlfGdrF97n/fa2bc4066df743e227a47743f2e618ad12096f3b615cb2bca7d05cd28a5107bb" frameborder="0" allowfullscreen></iframe>]]></content>
      
      <categories>
          
          <category> workNote </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>ä¾§è¾¹æ åºå®å®½åº¦, ä¸»ä½èªéåºå®½åº¦çç­é«å¸å±</title>
      <link href="/2016/05/22/e4-be-a7-e8-be-b9-e6-a0-8f-e5-9b-ba-e5-ae-9a-e5-ae-bd-e5-ba-a6-e4-b8-bb-e4-bd-93-e8-87-aa-e9-80-82-e5-ba-94-e5-ae-bd-e5-ba-a6-e7-9a-84-e7-ad-89-e9-ab-98-e5-b8-83-e5-b1-80/"/>
      <content type="html"><![CDATA[<h1 id="ä¸¤åå¸å±å®ç°"><a href="#ä¸¤åå¸å±å®ç°" class="headerlink" title="ä¸¤åå¸å±å®ç°"></a>ä¸¤åå¸å±å®ç°</h1><h2 id="æ¹æ³1-æµ®å¨å¸å±"><a href="#æ¹æ³1-æµ®å¨å¸å±" class="headerlink" title="æ¹æ³1, æµ®å¨å¸å±"></a>æ¹æ³1, æµ®å¨å¸å±</h2><p>Sidebar è®¾ç½®ä¸ºæµ®å¨, Content Body ç margin è®¾ç½®ä¸º Sidebar çå®½åº¦</p><h3 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h3><pre><code>&amp;lt;div class=&apos;sidebar&apos;&amp;gt;Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.&amp;lt;/div&amp;gt;&amp;lt;div class=&apos;contentBody&apos;&amp;gt;Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.&amp;lt;/div&amp;gt;`&lt;/pre&gt;### CSS&lt;pre&gt;`*{margin:0;padding:0}.sidebar{float:left;width: 220px;background-color: #ccc;}.contentBody{margin-left: 220px;}`&lt;/pre&gt;## æ¹æ³2, æµ®å¨åè´è¾¹è·### HTML&lt;pre&gt;`&amp;lt;div class=&apos;sidebar&apos;&amp;gt;Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.&amp;lt;/div&amp;gt;&amp;lt;div class=&apos;contentBody&apos;&amp;gt;    &amp;lt;div class=&apos;contentInner&apos;&amp;gt;    Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.    &amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;`&lt;/pre&gt;### CSS&lt;pre&gt;`.sidebar{float:left;width: 220px;margin-right: -100%;background-color: green;}.contentBody{float:left;width:100%;}.contentInner{margin-left: 220px;}`&lt;/pre&gt;# ç­é«å®ç°## Demo1### HTML&lt;pre&gt;`&amp;lt;div class=&apos;container&apos;&amp;gt;    &amp;lt;div class=&apos;wrapper&apos;&amp;gt;        &amp;lt;div class=&apos;sidebar&apos;&amp;gt;SideBar&amp;lt;/div&amp;gt;        &amp;lt;div class=&apos;content&apos;&amp;gt;Main Content&amp;lt;/div&amp;gt;    &amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;`&lt;/pre&gt;### CSS&lt;pre&gt;`.container{background-color:#ccc;}.wrapper{display:inline-block; //ä¿è¯ wrapper çæå°é«åº¦ä¸å°äºè¢« float ç sidebarborder-left: 200px solid #333; //ç­äº sidebar å®½åº¦vertical-align:bottom}.sidebar{float:left;width: 200px;margin-left: -200px; //ç­äº wrapper ç border-left å®½åº¦}.sidebar, .content{min-height: 200px;height: auto !important;height:200px;}`&lt;/pre&gt;## Demo2### HTML&lt;pre&gt;`&amp;lt;div class=&apos;container&apos;&amp;gt;    &amp;lt;div class=&apos;sidebar&apos;&amp;gt;SideBar&amp;lt;/div&amp;gt;    &amp;lt;div class=&apos;content&apos;&amp;gt;Main Content&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;`&lt;/pre&gt;### CSS&lt;pre&gt;`.sidebar{background-color:#ccc;float:left;width:200px;margin-bottom:-99999px;padding-bottom:99999px;}.content{background-color: #eee;margin-left:200px;margin-bottom:-99999px;padding-bottom:99999px;}.sidebar, .content{min-height: 200px;height:auto!important;height:200px;}`&lt;/pre&gt;## Demo3### HTML&lt;pre&gt;`&amp;lt;div class=&apos;container&apos;&amp;gt;    &amp;lt;div class=&apos;wrapper&apos;&amp;gt;        &amp;lt;div class=&apos;col1&apos;&amp;gt;Left Col&amp;lt;/div&amp;gt;        &amp;lt;div class=&apos;col2&apos;&amp;gt;Right Col&amp;lt;/div&amp;gt;    &amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;`&lt;/pre&gt;### CSS&lt;pre&gt;`.container{float:left;width:100%;background:orange;position:relative;overflow:hidden;}.wrapper{float:left;width:100%;background:green;position:relative;left:200px;}.col1{width:200px;float:left;position:relative;margin-left:-200px;}.col2{position:relative;margin-right:200px;}</code></pre>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>8 Material Design Web UI Framework</title>
      <link href="/2016/05/22/7-material-design-web-ui-framework/"/>
      <content type="html"><![CDATA[<h2 id="Origin-of-Material-Design"><a href="#Origin-of-Material-Design" class="headerlink" title="Origin of Material Design"></a><strong>Origin of Material Design</strong></h2><div style="text-align:justify"><br>Google has its own Polymer Project which embraces Material Design thourghout its Web Components. And in fact, the Polymer Project played a key role in Material Designâs development and in showcase of Material Design Concept of Web.<br></div><h2 id="8-Material-Design-Web-UI-Framework"><a href="#8-Material-Design-Web-UI-Framework" class="headerlink" title="8 Material Design Web UI Framework"></a><strong>8 Material Design Web UI Framework</strong></h2><h3 id="1-Materialize"><a href="#1-Materialize" class="headerlink" title="1. Materialize"></a>1. <a href="http://materializecss.com/" target="_blank" rel="noopener">Materialize</a></h3><p><a href="http://materializecss.com/" target="_blank" rel="noopener"><img src="https://superdevresources.com/wp-content/uploads/2014/11/materialze-framework-material-design.png" alt=""></a></p><div style="text-align:justify"><br>A modern responsive front-end framework based on Material Design. It provides an option of both CSS as well as source SCSS Files, along with JavaScript, Material Design Icon and Roboto font. Included components are basic ones such as grids, forms, buttons, navbar and cards.</div><p>Available in <a href="https://github.com/Dogfalo/materialize" target="_blank" rel="noopener"><img src="http://7xu8mu.com1.z0.glb.clouddn.com/wp-content/uploads//2016/05/1463860438_social_media_online_github.png" alt="1463860438_social_media_online_github"></a></p><h3 id="2-Material-UI"><a href="#2-Material-UI" class="headerlink" title="2. Material UI"></a>2. <a href="http://material-ui.com/" target="_blank" rel="noopener">Material UI</a></h3><p><a href="http://material-ui.com/" target="_blank" rel="noopener"><img src="https://superdevresources.com/wp-content/uploads/2014/11/material-ui-css-framework.png" alt=""></a></p><div style="text-align:justify"><br>Material UI is a CSS Framework and a Set of React Components that implement Googleâs Material Design.</div><p>Avaiblable in <a href="https://github.com/callemall/material-ui" target="_blank" rel="noopener"><img src="http://7xu8mu.com1.z0.glb.clouddn.com/wp-content/uploads//2016/05/1463860438_social_media_online_github.png" alt="github"></a></p><h3 id="3-Paper-Bootstrap-for-Bootstrap"><a href="#3-Paper-Bootstrap-for-Bootstrap" class="headerlink" title="3. Paper Bootstrap for Bootstrap"></a>3. <a href="http://bootswatch.com/paper/#" target="_blank" rel="noopener">Paper Bootstrap for Bootstrap</a></h3><p><a href="http://bootswatch.com/paper/#" target="_blank" rel="noopener"><img src="https://superdevresources.com/wp-content/uploads/2014/11/paper-bootstrap-material-design-theme.png" alt=""></a></p><div style="text-align:justify">Paper is a bootstrap theme for the Bootstrap Framework.</div><h3 id="4-Bootstrap-Material"><a href="#4-Bootstrap-Material" class="headerlink" title="4. Bootstrap Material"></a>4. <a href="http://fezvrasta.github.io/bootstrap-material-design/" target="_blank" rel="noopener">Bootstrap Material</a></h3><p><a href="http://fezvrasta.github.io/bootstrap-material-design/" target="_blank" rel="noopener"><img src="https://superdevresources.com/wp-content/uploads/2014/11/bootstrap-material-design.png" alt=""></a></p><div style="text-align:justify"><br>Similar to Paper, Bootstrap Material is another theme for Bootstrap framework and provides all the components included in Bootstrap. Besides, it covers 740 original Material Design Icons from the Google Material Design Icons Repo.</div><h3 id="5-Leaf"><a href="#5-Leaf" class="headerlink" title="5.Leaf"></a>5.<a href="http://getleaf.com/" target="_blank" rel="noopener">Leaf</a></h3><p><a href="http://getleaf.com/" target="_blank" rel="noopener"><img src="https://superdevresources.com/wp-content/uploads/2014/11/leaf-meterial-css-framework.jpg" alt=""></a></p><div style="text-align:justify"><br>Leaf is CSS Framework developed by Kim Korte based on the Googleâs material design. While still in beta, it has extensive list of components such as buttons, cards, sliders, menu, tabs etc. It includes icons by Icomoon, instead of the original Material Design Icons.</div><p>Leaf is also available on <a href="http://github.com/kkortes/leaf" target="_blank" rel="noopener"><img src="http://7xu8mu.com1.z0.glb.clouddn.com/wp-content/uploads//2016/05/1463860438_social_media_online_github.png" alt="github"></a></p><h3 id="6-MUI-CSS-Framework"><a href="#6-MUI-CSS-Framework" class="headerlink" title="6.MUI CSS Framework"></a>6.<a href="https://www.muicss.com/" target="_blank" rel="noopener">MUI CSS Framework</a></h3><p><a href="https://www.muicss.com/" target="_blank" rel="noopener"><img src="https://superdevresources.com/wp-content/uploads/2014/11/mui-material-design-css-framework.png" alt=""></a></p><div style="text-align:justify"><br>MUI is lightweighted HTML, CSS and JS Framework for building sites following Googleâs Material Design Principles. MUI is designed from the ground up to be fast, small and developer friendly. By design it only includes the basic components you need to build a site that follows Material Design Guideline.</div><p>Availabel in <a href="https://www.muicss.com/" target="_blank" rel="noopener"><img src="http://7xu8mu.com1.z0.glb.clouddn.com/wp-content/uploads//2016/05/1463860438_social_media_online_github.png" alt="github"></a></p><h3 id="7-Polymer-Project"><a href="#7-Polymer-Project" class="headerlink" title="7. Polymer Project"></a>7. <a href="https://www.polymer-project.org/docs/elements/material.html" target="_blank" rel="noopener">Polymer Project</a></h3><p><a href="https://www.polymer-project.org/docs/elements/material.html" target="_blank" rel="noopener"><img src="https://superdevresources.com/wp-content/uploads/2014/11/google-polymer-paper-material.png" alt=""></a></p><div style="text-align:justify"><br>Googleâs Polymer Project is a web framework and their embodiment of material design of teh web.<br>While still in âdeveloper previewâ, most of the components are quite mature. Polymer aims to support all major modern browser such as IE(10+), Chrome, Safari, and Firefox.</div><h3 id="8-Material-Design-Lite"><a href="#8-Material-Design-Lite" class="headerlink" title="8. Material Design Lite"></a>8. <a href="https://getmdl.io/index.html" target="_blank" rel="noopener">Material Design Lite</a></h3><p><a href="https://getmdl.io/index.html" target="_blank" rel="noopener"><img src="http://7xu8mu.com1.z0.glb.clouddn.com/wp-content/uploads//2016/05/å±å¹å¿«ç§-2016-05-22-ä¸å5.50.45.png" alt=""></a></p><div style="text-align:justify"><br>Material Design lets you add a Material Design look and feel to your website. It doesnât rely on any JS frameworks adn aims to optimize for cross devices use, gracefully degrade in older browsers, and offer an experience that is immediately accessible.<br></div><p>Availabel in <a href="https://github.com/google/material-design-lite" target="_blank" rel="noopener"><img src="http://7xu8mu.com1.z0.glb.clouddn.com/wp-content/uploads//2016/05/1463860438_social_media_online_github.png" alt="github"></a></p>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Material Design </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Git Commands</title>
      <link href="/2016/05/21/git-commands/"/>
      <content type="html"><![CDATA[<ol><li><code>git init</code> to init a working space into a git repo</li><li><code>git add filename</code> or <code>git add .</code> to track file or all files, and add them to <strong>stage</strong></li><li><code>git commit -m &quot;message&quot;</code> to commit changes to local repo</li><li>Several files can be commited together: <code>git add file1; git add file2; git commit -m &quot;add 2 files&quot;</code></li><li>Use regx: <code>git add &quot;*.txt&quot;; git commit -m &quot;add all text&quot;</code></li><li><code>git status</code> to check which file has been modified</li><li><code>git diff filename</code> to check details of modification in filename</li><li><code>git log</code> to show logs</li><li><code>git log --pretty</code> to show concise info of log, <code>git log --graph --pretty=online --abbrev-commit</code> for more info</li><li><code>git reset --hard HEAD^</code> to recover to last commit</li><li><code>git reset --hard ID</code> to recover to specific version</li><li><code>git checkout -- filename</code> to dismiss modification in local working space, e.g. if you delete text.txt in working space and want to recover it, <code>git checkout -- text.txt</code> can pull it from local repo to working space</li><li><code>git reset HEAD filename</code> to recover file from local repo</li><li><code>rm filename</code> to delete file in working space, only phisically delete the file without log</li><li><code>git rm filename</code> to delete file in working space and add a deletion operation in log waiting for commit</li><li><code>git remote add origin **https**</code> to connect to a remote repo</li><li><code>git push -u origin master</code> to push local repo to remote repo. <code>-u</code> for first push, it will connect local and remote repo for pull and push in future</li><li><code>git clone **https**</code> to clone a remote repo to local position</li><li><code>git checkout -b dev</code> create a new branch named dev, and switch to it. This command equals to <code>git branch dev; git checkout dev</code></li><li><code>git branch</code> to check current branch</li><li><code>git merge dev</code> to merge modification from dev to current branch</li><li><code>git branch -d dev</code> to delete branch dev</li><li><code>git merge</code> is <strong>Fast Forward</strong> mode which will lose merge log, <code>git merge --no-ff -m &quot;merge with no-ff&quot;</code> will keep the merge log and make a new commit(so it needs a -m), with âno-ff you can see the merge in log</li></ol><h3 id="Bug-Branch"><a href="#Bug-Branch" class="headerlink" title="Bug Branch"></a>Bug Branch</h3><p><code>git stash</code> to keep current working space</p><pre><code>git stashgit checkout mastergit checkout -b bug-101*fix the but*git add .git commit -m &apos;fix but-101&apos;git checkout mastergit merge --no-ff &apos;merge bug-101 fix&apos; bug-101git branch -d but-101git checkout dev #return to previous working branchgit stash list #check kept working space, e.g. *stash@{0}: ...git stash apply stash@{0} #recover the working space without delete it in the list**or**git stash pop stash@{0} #recover and delete it in the list`&lt;/pre&gt;### Omit unmerged Branch&lt;pre&gt;`git checkout -b new-feature #new branch for feature developmentgit add featurefilegit commit -m &quot;add new feature&quot;git checkout dev*requirement changed, the feature is dismissed**new feature has not been merged, so need force Delete*git branch -D new-feature`&lt;/pre&gt;### Coordination&lt;pre&gt;`git remote #return remote repo name, e.g. origingit remote -v #return detailsgit push origin dev #push current branch to origin devgit checkout -b dev origin/dev #create a dev, and push it to origin/devgit pull #git fetch and merge to current branch</code></pre>]]></content>
      
      <categories>
          
          <category> note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> github </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>CFB HomePage(RWD)</title>
      <link href="/2016/05/19/cfb/"/>
      <content type="html"><![CDATA[<p>Chinafiremag.cn is a non-responsive website and this is a prototype of RW one.</p>]]></content>
      
      <categories>
          
          <category> github </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS3 </tag>
            
            <tag> HTML5 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Bootstrap 4 Guide Written by BS3</title>
      <link href="/2016/05/19/bootstrap4/"/>
      <content type="html"><![CDATA[<p>Make new features of BS4 by BS3</p>]]></content>
      
      <categories>
          
          <category> github </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS3 </tag>
            
            <tag> BOOTSTRAP </tag>
            
            <tag> HTML5 </tag>
            
        </tags>
      
    </entry>
    
  
  
</search>
