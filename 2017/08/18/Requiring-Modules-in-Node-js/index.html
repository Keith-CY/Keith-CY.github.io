<!DOCTYPE html>
<html lang="en">
    <head>
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.3.4 -->

    <!-- Title -->
    
    <title>
        
            Requiring Modules in Node.js | 
        
        EzCook
    </title>

    <!-- Meta & Info -->
    <meta charset="utf-8">

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">
    
    
    
    
    
    

    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="Chen Yu">
    <meta name="description" content="null">
    <meta name="keywords" content="EzCook, JavaScript, React, RxJS, Redux">

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" sizes="192x192" href="/img/favicon.png">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!--iOS -->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="EzCook">

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://yoursite.com">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Requiring Modules in Node.js | EzCook">
    <meta property="og:description" content="null">
    

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.en.js"></script>
        
    <![endif]-->

    <!-- Import CSS & jQuery -->
    
        <link rel="stylesheet" href="/css/material.min.css">
        <link rel="stylesheet" href="/css/style.min.css">
        <!-- Config CSS -->


<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
  }

  a {
    color: #00BCD4;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #00BCD4 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #00BCD4 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #00BCD4 !important;
  }

  .toTop {
    background: #000BCD4 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #000BCD4;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #000BCD4;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #000BCD4;
  }

  .post-toc a:hover {
    color: #00BCD4;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body {
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text {
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


        <script src="/js/jquery.min.js"></script>
        <script src="/js/queue.js"></script>
    

    <!-- UC Browser Compatible -->
    <script>
        var agent = navigator.userAgent.toLowerCase();
        if(agent.indexOf('ucbrowser')>0) {
            document.write("<link rel=\"stylesheet\" href=\"/css/uc.css\">");
            alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
        }
    </script>

    

    


    <!-- Bing Background -->
    
        <script type="text/javascript">
            queue.offer(function(){
                $('body').attr('data-original', 'https://api.i-meto.com/bing?null');
            });
        </script>
    

    <!-- Custom Head -->
    
</head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->

    <!-- Left aligned menu below button -->
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Resolving-a-local-path"><span class="post-toc-number">1.</span> <span class="post-toc-text">Resolving a local path</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Requiring-a-folder"><span class="post-toc-number">2.</span> <span class="post-toc-text">Requiring a folder</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#require-resolve"><span class="post-toc-number">3.</span> <span class="post-toc-text">require.resolve</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#exports-module-exports-and-asynchronous-loading-of-modules"><span class="post-toc-number">4.</span> <span class="post-toc-text">exports, module.exports, and asynchronous loading of modules</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#JSON-and-C-C-addons"><span class="post-toc-number">5.</span> <span class="post-toc-text">JSON and C/C++ addons</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#All-code-you-write-in-Node-will-be-wrapped-in-functions"><span class="post-toc-number"></span> <span class="post-toc-text">All code you write in Node will be wrapped in functions</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#The-require-object"><span class="post-toc-number">1.</span> <span class="post-toc-text">The require object</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#All-module-can-be-cached"><span class="post-toc-number"></span> <span class="post-toc-text">All module can be cached</span></a>

        <!--
        <li class="mdl-menu__item">
            Some Action
        </li>
        -->
    </ul>




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script>
    var randomNum = Math.floor(Math.random() * 19 + 1);

    $('.post_thumbnail-random').attr('data-original', '/img/random/material-' + randomNum + '.png');
    $('.post_thumbnail-random').addClass('lazy');
</script>

        
    
            <p class="article-headline-p">
                Requiring Modules in Node.js
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="images/avatar.gif" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>Chen Yu</strong>
        <span>Aug 18, 2017</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        
    </ul>
    

    <!-- Share -->
    <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=Requiring Modules in Node.js&url=http://yoursite.com//2017/08/18/Requiring-Modules-in-Node-js/index.html&pic=&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                Share to Weibo
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=Requiring Modules in Node.js&url=http://yoursite.com//2017/08/18/Requiring-Modules-in-Node-js/index.html&via=Chen Yu" target="_blank">
            <li class="mdl-menu__item">
                Share to Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=http://yoursite.com//2017/08/18/Requiring-Modules-in-Node-js/index.html" target="_blank">
            <li class="mdl-menu__item">
                Share to Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=http://yoursite.com//2017/08/18/Requiring-Modules-in-Node-js/index.html" target="_blank">
            <li class="mdl-menu__item">
                Share to Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    

    <!-- Share Telegram -->
    
</ul>

</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">'/path/to/file'</span>)</div></pre></td></tr></table></figure>
<p>The main object exported by the <code>require</code> module is a function. When Node invokes that <code>require()</code> function with a local file path as the function’s only argument, Node goes through the following sequence of steps:</p>
<ul>
<li><p><strong>Resolving</strong>: To find the absolute path of the file.</p>
</li>
<li><p><strong>Loading</strong>: To determine the type of the file content.</p>
</li>
<li><p><strong>Wrapping</strong>: To give the file its private scope. This is what makes both the <code>require</code> and <code>module</code> objects local to every file we require.</p>
</li>
<li><p><strong>Evaluating</strong>: This is what the VM eventually does with the loaded code.</p>
</li>
<li><p><strong>Caching</strong>: So that when we require this file again, we don’t go over all the steps another time.</p>
</li>
</ul>
<h4 id="Resolving-a-local-path"><a href="#Resolving-a-local-path" class="headerlink" title="Resolving a local path"></a>Resolving a local path</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// in NODE REPL</span></div><div class="line">&gt; <span class="built_in">module</span></div><div class="line">Module: &#123;</div><div class="line">  <span class="attr">id</span>: <span class="string">'&lt;repl&gt;'</span>,</div><div class="line">  <span class="attr">exports</span>: &#123;&#125;,</div><div class="line">  <span class="attr">parent</span>: <span class="literal">undefined</span>,</div><div class="line">  <span class="attr">fielname</span>: <span class="literal">null</span>,</div><div class="line">  <span class="attr">loaded</span>: <span class="literal">false</span>,</div><div class="line">  <span class="attr">children</span>: [],</div><div class="line">  <span class="attr">paths</span>: [...]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Every module object gets an <code>id</code> property to identify it. This <code>id</code> is usually the full path to the file, but in a REPL session it’s simply <code>&lt;repl&gt;</code>.</p>
<p>Node modules have a one-to-one relation with files on the file-system. We require a module by loading the content of a file into memory.</p>
<p>However, since Node allows many ways to require a file(for example, with a relative path or a pre-configured path), before we can load the content of a file into the memory we need to find the absolute location of that file.</p>
<p>When we require a <code>find-me</code> module, without specifying a path:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">require</span>(<span class="string">'find-me'</span>)</div></pre></td></tr></table></figure>
<p>Node will look for <code>find-me.js</code> in all the paths specified by <code>module.paths</code> in order.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// in NODE REPL</span></div><div class="line">&gt; <span class="built_in">module</span>.paths</div><div class="line">[ <span class="string">'/Users/samer/learn-node/repl/node_modules'</span>,</div><div class="line">  <span class="string">'/Users/samer/learn-node/node_modules'</span>,</div><div class="line">  <span class="string">'/Users/samer/node_modules'</span>,</div><div class="line">  <span class="string">'/Users/node_modules'</span>,</div><div class="line">  <span class="string">'/node_modules'</span>,</div><div class="line">  <span class="string">'/Users/samer/.node_modules'</span>,</div><div class="line">  <span class="string">'/Users/samer/.node_libraries'</span>,</div><div class="line">  <span class="string">'/usr/local/Cellar/node/7.7.1/lib/node'</span> ]</div></pre></td></tr></table></figure>
<p>The paths list is basically a list of node_modules directories under every directory from the current directory to the root directory. It also includes a few legacy directories whose use is not recommended.</p>
<p>If Node can’t find <code>find-me.js</code> in any of these paths, it will throw a ‘cannot find module error’.</p>
<h4 id="Requiring-a-folder"><a href="#Requiring-a-folder" class="headerlink" title="Requiring a folder"></a>Requiring a folder</h4><p>Modules don’t have to be files. We can also create a <code>find-me</code> folder under <code>node_modules</code> and place an <code>index.js</code> file in there. The same <code>require(&#39;fine-me&#39;)</code> line will use that folder’s <code>index.js</code> file.</p>
<p>An <code>index.js</code> file will be used by default when we require a folder, but we can control what file name to start under the folder using the <code>main</code> property in <code>package.json</code>.</p>
<h4 id="require-resolve"><a href="#require-resolve" class="headerlink" title="require.resolve"></a>require.resolve</h4><p>If you want to only resolve the module and not execute it, you can use the <code>require.resolve</code> function. This behaves exactly the same as the main <code>require</code> function, but does not execute the file.</p>
<p><strong>This can be used, for example, to check whether an optional package is installed or not and only use it when it’s available</strong>.</p>
<h4 id="exports-module-exports-and-asynchronous-loading-of-modules"><a href="#exports-module-exports-and-asynchronous-loading-of-modules" class="headerlink" title="exports, module.exports, and asynchronous loading of modules"></a>exports, module.exports, and asynchronous loading of modules</h4><p>In any module, exports is a special object.</p>
<p><code>exports</code> variable inside each module is just a reference to <code>module.exports</code> which manages the exported properties.</p>
<p>When we reassign the <code>exports</code> variable, that reference is lost and we would be introducing a new variable instead of changing the <code>module.exports</code> object.</p>
<p>The <code>module.exports</code> object in every module is what the <code>require</code> function returns when we require that module.</p>
<p>Let’s talk about the <code>loaded</code> attribute on every module. The <code>module</code> module use the <code>loaded</code> attribute to track which modules have been loaded(true value) and which modules are still being loaded(false value).</p>
<p>The <code>exports</code> object becomes complete when Node finishes loading the module(and label it so). The whole process of requiring/loading a module is <em>synchronous</em>. That’s why we were able to see the modules fully loaded after one cycle of the event loop.</p>
<p>This also means that we cannot change the <code>exports</code> object asynchronously.</p>
<h4 id="JSON-and-C-C-addons"><a href="#JSON-and-C-C-addons" class="headerlink" title="JSON and C/C++ addons"></a>JSON and C/C++ addons</h4><p>We can natively require JSON files and C++ addon files with the require function. You don’t need to specify the extensions.</p>
<p>If a file extension was not specified, the first thing Node will try to resolve is a <code>.js</code>, then <code>.json</code>, and it will parse the <code>.json</code> file if found as a JSON text file. After that Node will try to find a binary <code>.node</code> file.</p>
<p>Requiring JSON file is useful, for example, everything you need to manage in that file is some static configuration values, or some values that you periodically read from an external source. For example, if we had the following <code>config.json</code> file:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"host"</span>: <span class="string">"localhost"</span>,</div><div class="line">  <span class="attr">"port"</span>: <span class="number">8080</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>We can require it directly like this:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> &#123; host, port &#125; = <span class="built_in">require</span>(<span class="string">'./config'</span>)</div></pre></td></tr></table></figure>
<h3 id="All-code-you-write-in-Node-will-be-wrapped-in-functions"><a href="#All-code-you-write-in-Node-will-be-wrapped-in-functions" class="headerlink" title="All code you write in Node will be wrapped in functions"></a>All code you write in Node will be wrapped in functions</h3><p>Node’s wrapping of modules is often misunderstood. To understand it, let me remind you about the <code>exports/module.exports</code> relation.</p>
<p>We can use the <code>exports</code> object to export properties, but we cannot replace the <code>exports</code> object directly because it’s just a reference to <code>module.exports</code>.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">exports.id = <span class="number">52</span>; <span class="comment">// This is ok</span></div><div class="line">exports = &#123; <span class="attr">id</span>: <span class="number">52</span> &#125;; <span class="comment">// This will not work</span></div><div class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">id</span>: <span class="number">52</span> &#125;; <span class="comment">// This is ok</span></div></pre></td></tr></table></figure>
<p>How exactly does this <code>exports</code> object, which appears to be global for every module, get defined as a reference on the <code>module</code> object?</p>
<p>In a browser, when we declare a variable in a script like this:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> answer = <span class="number">12</span>;</div></pre></td></tr></table></figure>
<p>That <code>answer</code> variable will be globally available in all scripts after the script that define it.</p>
<p>This is not the case in Node. When we define a variable in one module, the other module modules in the program will not have access to that variable. So how come variables in Node are magically scoped?</p>
<p>The answer is simple. Before compiling a module, Node wraps the module code in a function, which we can inspect using the <code>wrapper</code> property of the <code>module</code> module.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">~ $ node</div><div class="line">&gt; <span class="built_in">require</span>(<span class="string">'module'</span>).wrapper</div><div class="line">[ <span class="string">'(function (exports, require, module, __filename, __dirname) &#123; '</span>,</div><div class="line">  <span class="string">'\n&#125;);'</span> ]</div><div class="line">&gt;</div></pre></td></tr></table></figure>
<p>Node does not execute any code you write in a file directly. It executes this wrapper function which will have your code in its body.</p>
<p>This is what keeps the top-level variables that are defined in any module scoped to that module.</p>
<p>This wrapper function has 5 arguments: <code>exports</code>, <code>require</code>, <code>module</code>, <code>__filename</code>, <code>__dirname</code>. This is what makes them appear to look global when in fact they are specific to each module.</p>
<p>All of these arguments get their value when Node execute the wrapper function. <code>exports</code> is defined as a reference to <code>module.exports</code> prior to that. <code>require</code> and <code>module</code> are both specific to the function to be executed, and <code>__dirname</code>/<code>__filename</code> variables will contain the wrapped module’s directory path and absolute filename.</p>
<p>Since every module gets wrapped in a function, we can actually access that function’s arguments with the <code>arguments</code> keyword:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">~/learn-node $ echo "console.log(arguments)" &gt; index.js</div><div class="line">~/learn-node $ node index.js</div><div class="line">&#123; '0': &#123;&#125;,</div><div class="line">  '1':</div><div class="line">   &#123; [Function: require]</div><div class="line">     resolve: [Function: resolve],</div><div class="line">     main:</div><div class="line">      Module &#123;</div><div class="line">        id: '.',</div><div class="line">        exports: &#123;&#125;,</div><div class="line">        parent: null,</div><div class="line">        filename: '/Users/samer/index.js',</div><div class="line">        loaded: false,</div><div class="line">        children: [],</div><div class="line">        paths: [Object] &#125;,</div><div class="line">     extensions: &#123; ... &#125;,</div><div class="line">     cache: &#123; '/Users/samer/index.js': [Object] &#125; &#125;,</div><div class="line">  '2':</div><div class="line">   Module &#123;</div><div class="line">     id: '.',</div><div class="line">     exports: &#123;&#125;,</div><div class="line">     parent: null,</div><div class="line">     filename: '/Users/samer/index.js',</div><div class="line">     loaded: false,</div><div class="line">     children: [],</div><div class="line">     paths: [ ... ] &#125;,</div><div class="line">  '3': '/Users/samer/index.js',</div><div class="line">  '4': '/Users/samer' &#125;</div></pre></td></tr></table></figure>
<p>What happens is roughly equivalent to:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> (<span class="params">require, module, __filename, __dirname</span>) </span>&#123;</div><div class="line">  <span class="keyword">let</span> exports = <span class="built_in">module</span>.exports;</div><div class="line">  <span class="comment">// Your Code...</span></div><div class="line">  <span class="keyword">return</span> <span class="built_in">module</span>.exports;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>If we change the whole <code>exports</code> object, it would no longer be a reference to <code>module.exports</code>.</p>
<h4 id="The-require-object"><a href="#The-require-object" class="headerlink" title="The require object"></a>The require object</h4><p>There is nothing special about <code>require</code>. It’s an object that acts mainly as a function that takes a module name or path and return the <code>module.exports</code> object. We can simply override the <code>require</code> object with our own logic if we want to.</p>
<p>For exmaple, maybe for testing purposes, we want every <code>require</code> call to be mocked by default and just return a fake object instead of the required module exports object.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">require</span> = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123; <span class="attr">mocked</span>: <span class="literal">true</span> &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>After doing the above reassignment of <code>require</code>, every <code>require(&#39;something&#39;)</code> call in the script will just return the mocked object.</p>
<p>The require object also has properties of its own. We’ve seen the <code>resolve</code> property, which is a function that performs only the resolving step of the require process. We’ve also seen <code>require.extensions</code> above.</p>
<p>There is also <code>require.main</code> which can be helpful to determine if the script is being required or run directly.</p>
<p>Say, for example, that we have this simple <code>printFrame</code> function in <code>print-in-frame.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// In print-in-frame.js</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> printFrame = <span class="function">(<span class="params">size, header</span>) =&gt;</span> &#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'*'</span>.repeat(size))</div><div class="line">  <span class="built_in">console</span>.log(header)</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'*'</span>.repeat(size))</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>We want to use this file in two ways:</p>
<ul>
<li>From the command line directly like this:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">node <span class="built_in">print</span>-in-frame 8 hello</div></pre></td></tr></table></figure>
<ul>
<li>With <code>require</code></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> print = <span class="built_in">require</span>(<span class="string">'./print-in-frame.js'</span>)</div><div class="line">print(<span class="number">5</span>, <span class="string">'hello'</span>)</div></pre></td></tr></table></figure>
<p>Those are two different usages. We need a way to determine if the file is being run as a stand-alone script or if it is being required by other scripts.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> printFrame = <span class="function">(<span class="params">size, header</span>) =&gt;</span> &#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'*'</span>.repeat(size))</div><div class="line">  <span class="built_in">console</span>.log(header)</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'*'</span>.repeat(size))</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">if</span> (<span class="built_in">require</span>.main === <span class="built_in">module</span>) &#123;</div><div class="line">  <span class="comment">// the file is being executed directly</span></div><div class="line">  printFrame(process.argv[<span class="number">2</span>], process.argv[<span class="number">3</span>])</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">  <span class="built_in">module</span>.exports = printFrame</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="All-module-can-be-cached"><a href="#All-module-can-be-cached" class="headerlink" title="All module can be cached"></a>All module can be cached</h3><p>Caching is important to understand.</p>
<p>Say that we have the following <code>ascii-art.js</code> file that prints a cool looking header:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#####</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#####</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#</span></div></pre></td></tr></table></figure>
<p>We want to display this header every time we <code>require</code> the file, so when we require the file twice, we want the header to show twice:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">require</span>(<span class="string">'./ascii-arg'</span>); <span class="comment">// it will show the header</span></div><div class="line"><span class="built_in">require</span>(<span class="string">'./ascii-arg'</span>); <span class="comment">// it won't show the header</span></div></pre></td></tr></table></figure>
<p>The second require will not show the header because of modules’ caching. Node caches the first call and does not load the file on the second call.</p>
<p>We can see this cache by printing <code>require.cache</code> after the first require. The cache registry is simply an object that has a property for every required module. Those properties values are the <code>module</code> objects used for each module. We can simply delete a property from that <code>require.cache</code> object to invalidate that cache. If we do that, Node will reload the module to recache it.</p>

    

    
</div>


                

                <!-- Post Comments -->
                
                    







                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2017/08/20/Analyzing-Runtime-Performacne-with-Chrome-DevTools/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            Newer
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2017/08/18/Concurrency-and-Parallelism-Understanding-I-O/" id="post_nav-older" class="next-content">
            Older
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="images/avatar.gif" alt="Chen Yu's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        keithwhisper@gmail.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="#" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/" target="_self">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                Home
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    Archives
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2017/08/">August 2017<span class="sidebar_archives-count">18</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/07/">July 2017<span class="sidebar_archives-count">19</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/06/">June 2017<span class="sidebar_archives-count">14</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/05/">May 2017<span class="sidebar_archives-count">15</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/04/">April 2017<span class="sidebar_archives-count">9</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/03/">March 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/02/">February 2017<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/01/">January 2017<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/12/">December 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/11/">November 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/10/">October 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/09/">September 2016<span class="sidebar_archives-count">16</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/08/">August 2016<span class="sidebar_archives-count">30</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/07/">July 2016<span class="sidebar_archives-count">43</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/06/">June 2016<span class="sidebar_archives-count">25</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/05/">May 2016<span class="sidebar_archives-count">24</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">chrome_reader_mode</i>
                
                Categories
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                <a class="sidebar_archives-link" href="/categories/Soup/">Soup<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/Uncategorized/">Uncategorized<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/categories/github/">github<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/categories/github/note/">note<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/note/">note<span class="sidebar_archives-count">141</span></a></li><li><a class="sidebar_archives-link" href="/categories/note/workNote/">workNote<span class="sidebar_archives-count">19</span></a></li><li><a class="sidebar_archives-link" href="/categories/workNote/">workNote<span class="sidebar_archives-count">5</span></a>
            </ul>
        </li>
        
    

    <!-- Pages  -->
    

    <!-- Article Number  -->
    
        <li>
            <a href="/archives">
                Number of articles
                <span class="sidebar-badge">228</span>
            </a>
        </li>
        
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->

    <a href="https://github.com/viosey/hexo-theme-material"  class="sidebar-footer-text-a" target="_blank">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
            Theme - Material
            <span class="sidebar-badge badge-circle">i</span>
        </div>
    </a>


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

    <a href="https://blog.viosey.com/index.php/Material.html" target="_blank" class="sidebar-footer-text-a">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
             sidebar.about_theme
            <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></div>
    </a>

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    

    <!-- Facebook -->
    
        <a href="https://www.facebook.com/keithwhisper" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-facebook.svg);">
                <span class="visuallyhidden">Facebook</span>
            </button><!--
     --></a>
    

    <!-- Google + -->
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    
        <a href="https://github.com/Keith-CY" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-github.svg);">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- LinkedIn -->
    
        <a href="https://www.linkedin.com/in/%E5%AE%87-%E9%99%88-644b61ba/" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-linkedin.svg);">
                <span class="visuallyhidden">LinkedIn</span>
            </button><!--
     --></a>
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;
            <script type="text/javascript">
                var fd = new Date();
                document.write(fd.getFullYear());
            </script>
            &nbsp;EzCook
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import File -->

    <script src="/js/lazyload.min.js"></script>
    <script src="/js/js.min.js"></script>



    <script src="/js/nprogress.js"></script>


<script type="text/javascript">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>



    
        <script src="/js/smoothscroll.js"></script>
    














<!-- Window Load-->
<script>
    $(window).load(function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });
</script>

<!-- MathJax Load-->

<script>
    <!-- Offer LazyLoad -->
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    <!-- Start Queue -->
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

                </main>
            </div>
        </body>
    
</html>
