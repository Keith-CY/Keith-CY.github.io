<!DOCTYPE html>
<html  lang="en">
<head>
    <meta charset="utf-8">
<title>EzCook</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />







<link rel="icon" href="/images/logo.png">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css">


    
    
    
    <style>body>.footer,body>.navbar,body>.section{opacity:0}</style>
    

    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">
    

    
    

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">


    
    
    
    

<link rel="stylesheet" href="/css/back-to-top.css">


    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-136207372-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-136207372-1');
</script>


    
    
<link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>

    
    
    

    
    
    
        <script async="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    

    


<link rel="stylesheet" href="/css/style.css">
</head>
<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/logo.png" alt="EzCook" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item"
                href="/">Home</a>
                
                <a class="navbar-item"
                href="/archives">Archives</a>
                
                <a class="navbar-item"
                href="/categories">Categories</a>
                
                <a class="navbar-item"
                href="/tags">Tags</a>
                
                <a class="navbar-item"
                href="/about">About</a>
                
            </div>
            
            <div class="navbar-end">
                
                    
                    
                    <a class="navbar-item" target="_blank" title="GitHub" href="https://github.com/keith-CY">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                    
                    <a class="navbar-item" target="_blank" title="Gmail" href="mailto:keithwhisper@gmail.com">
                        
                        <i class="fas fa-envelope"></i>
                        
                    </a>
                    
                
                
                
                <a class="navbar-item search" title="Search" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-6-widescreen has-order-2 column-main">
    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-09-05T12:31:15.000Z">2017-09-05</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    a few seconds read (About 0 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/09/05/Build-a-Node-Command-Line-Interface/">Build a Node Command Line Interface</a>
            
        </h1>
        <div class="content">
            
        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-09-05T07:10:04.000Z">2017-09-05</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    14 minutes read (About 2037 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/09/05/start-up-with-ts-react-router-redux-rxjs/">Start Up With Ts, React, Router, Redux, Rxjs</a>
            
        </h1>
        <div class="content">
            <p>The <a href="https://github.com/Keith-CY/starter-of-react-redux-router-rxjs.git" target="_blank" rel="noopener">Repo</a></p>
<h3 id="Dependencies"><a href="#Dependencies" class="headerlink" title="Dependencies"></a>Dependencies</h3><figure class="highlight hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line">"devDependencies": &#123;</div><div class="line">  "@types/react": "^16.0.5",</div><div class="line">  "@types/react-dom": "^15.5.4",</div><div class="line">  "@types/react-redux": "^5.0.6",</div><div class="line">  "@types/redux-actions": "^1.2.8",</div><div class="line">  "@types/webpack": "^3.0.10",</div><div class="line">  "@types/webpack-dev-server": "^2.4.1",</div><div class="line">  "autoprefixer": "^7.1.3",</div><div class="line">  "babel-core": "^6.26.0",</div><div class="line">  "babel-loader": "^7.1.2",</div><div class="line">  "babel-preset-env": "^1.6.0",</div><div class="line">  "babel-preset-react": "^6.24.1",</div><div class="line">  "bundle-loader": "^0.5.5",</div><div class="line">  "eslint": "^4.6.1",</div><div class="line">  "eslint-config-airbnb": "^15.1.0",</div><div class="line">  "eslint-plugin-import": "^2.7.0",</div><div class="line">  "eslint-plugin-jsx-a11y": "^6.0.2",</div><div class="line">  "eslint-plugin-react": "^7.3.0",</div><div class="line">  "html-webpack-plugin": "^2.30.1",</div><div class="line">  "node-sass": "^4.5.3",</div><div class="line">  "precss": "^2.0.0",</div><div class="line">  "redux-devtools": "^3.4.0",</div><div class="line">  "redux-devtools-dock-monitor": "^1.1.2",</div><div class="line">  "redux-devtools-log-monitor": "^1.3.0",</div><div class="line">  "rimraf": "^2.6.1",</div><div class="line">  "sass-loader": "^6.0.6",</div><div class="line">  "ts-loader": "^2.3.4",</div><div class="line">  "typescript": "next",</div><div class="line">  "uglifyjs-webpack-plugin": "^0.4.6",</div><div class="line">  "webpack": "^3.5.5",</div><div class="line">  "webpack-dashboard": "^1.0.0-5",</div><div class="line">  "webpack-dev-server": "^2.7.1",</div><div class="line">  "webpack-merge": "^4.1.0"</div><div class="line">&#125;,</div><div class="line">"dependencies": &#123;</div><div class="line">  "@types/node": "^8.0.26",</div><div class="line">  "@types/react-router-dom": "^4.0.7",</div><div class="line">  "babel-plugin-transform-runtime": "^6.23.0",</div><div class="line">  "extract-text-webpack-plugin": "^3.0.0",</div><div class="line">  "react": "^15.6.1",</div><div class="line">  "react-dom": "^15.6.1",</div><div class="line">  "react-redux": "^5.0.6",</div><div class="line">  "react-router": "^4.2.0",</div><div class="line">  "react-router-dom": "^4.2.2",</div><div class="line">  "redux": "^3.7.2",</div><div class="line">  "redux-actions": "^2.2.1",</div><div class="line">  "redux-observable": "^0.16.0",</div><div class="line">  "rxjs": "^5.4.3"</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Project-Structure"><a href="#Project-Structure" class="headerlink" title="Project Structure"></a>Project Structure</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">.</div><div class="line">├── config</div><div class="line">│   ├── webpack.config.base.js</div><div class="line">│   ├── webpack.config.dev.js</div><div class="line">│   ├── webpack.config.prod.js</div><div class="line">├── src</div><div class="line">│   ├── actions</div><div class="line">│   │   ├── index.tsx</div><div class="line">│   │   ├── hello.tsx</div><div class="line">│   ├── components</div><div class="line">│   │   ├── AsyncRoute.tsx</div><div class="line">│   ├── containers</div><div class="line">│   │   ├── App.tsx</div><div class="line">│   │   ├── Header.tsx</div><div class="line">│   │   ├── Body.jsx</div><div class="line">│   │   ├── Footer.tsx</div><div class="line">│   │   ├── Index.tsx</div><div class="line">│   │   ├── Page2.tsx</div><div class="line">│   │   ├── DevTools.tsx</div><div class="line">│   ├── epics</div><div class="line">│   │   ├── index.tsx</div><div class="line">│   │   ├── hello.tsx</div><div class="line">│   ├── reducers</div><div class="line">│   │   ├── index.tsx</div><div class="line">│   │   ├── hello.tsx</div><div class="line">│   ├── store</div><div class="line">│   │   ├── index.tsx</div><div class="line">│   │   ├── configureStore.dev.tsx</div><div class="line">│   │   ├── configureStore.prod.tsx</div><div class="line">│   ├── templates</div><div class="line">│   │   ├── index.html</div><div class="line">│   ├── utils</div><div class="line">│   │   ├── connect.tsx</div><div class="line">│   │   ├── nav.tsx</div><div class="line">│   ├── app.tsx</div><div class="line">├── package.json</div><div class="line">├── tsconfig.json</div><div class="line">├── postcss.config.js</div><div class="line">├── .babelrc</div><div class="line">├── .eslintrc.js</div><div class="line">├── .gitignore</div><div class="line">├── yarn.lock</div></pre></td></tr></table></figure>
<h3 id="Step-1-Create-Project"><a href="#Step-1-Create-Project" class="headerlink" title="Step 1: Create Project"></a>Step 1: Create Project</h3><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment"># init project</span></div><div class="line">yarn init -y</div></pre></td></tr></table></figure>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment"># add eslint</span></div><div class="line">yarn add --dev eslint eslint-config-airbnb eslint-plugin-import eslint-plugin-jsx<span class="hljs-_">-a</span>11y eslint-plugin-react</div><div class="line"></div><div class="line">eslint --init</div></pre></td></tr></table></figure>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment"># add webpack</span></div><div class="line">yarn add --dev webpack webpack-dev-server webpack-dashboard webpack-merge @types/webpack @types/webpack-dev-server</div></pre></td></tr></table></figure>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment"># add loader for jsx</span></div><div class="line">yarn add --dev babel-core babel-loader babel-preset-env babel-preset-react</div><div class="line"></div><div class="line"><span class="hljs-comment"># add loader for tsx</span></div><div class="line">yarn add --dev ts-loader typescript@next</div><div class="line"></div><div class="line"><span class="hljs-comment"># add loader for css</span></div><div class="line">yarn add --dev style-loader css-loader resolve-url-loader postcss-loader node-sass sass-loader</div><div class="line"></div><div class="line"><span class="hljs-comment"># add loader for file</span></div><div class="line">yarn add --dev url-loader file-loader</div><div class="line"></div><div class="line"><span class="hljs-comment"># add plugin for js</span></div><div class="line">yarn add babel-plugin-transform-runtime</div><div class="line"></div><div class="line"><span class="hljs-comment"># add plugin for postcss</span></div><div class="line">yarn add --dev autoprefixer precss</div><div class="line"></div><div class="line"><span class="hljs-comment"># add plugin for html</span></div><div class="line">yarn add --dev html-webpack-plugin</div><div class="line"></div><div class="line"><span class="hljs-comment"># add plugin for uglifyjs</span></div><div class="line">yarn add --dev uglifyjs-webpack-plugin</div><div class="line"></div><div class="line"><span class="hljs-comment"># add plugin for extract css</span></div><div class="line">yarn add --dev extract-text-webpack-plugin</div></pre></td></tr></table></figure>
<h3 id="set-gitignore"><a href="#set-gitignore" class="headerlink" title="set gitignore"></a>set gitignore</h3><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment"># Logs</span></div><div class="line">*.log</div><div class="line"></div><div class="line"><span class="hljs-comment"># dependencies</span></div><div class="line">node_modules</div><div class="line"></div><div class="line"><span class="hljs-comment"># build</span></div><div class="line">dist</div></pre></td></tr></table></figure>
<h3 id="set-typescript-config"><a href="#set-typescript-config" class="headerlink" title="set typescript config"></a>set typescript config</h3><figure class="highlight json hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="hljs-attr">"compilerOptions"</span>: &#123;</div><div class="line">    <span class="hljs-attr">"outDir"</span>: <span class="hljs-string">"dist"</span>,</div><div class="line">    <span class="hljs-attr">"module"</span>: <span class="hljs-string">"commonjs"</span>,</div><div class="line">    <span class="hljs-attr">"target"</span>: <span class="hljs-string">"es5"</span>,</div><div class="line">    <span class="hljs-attr">"lib"</span>: [<span class="hljs-string">"es6"</span>, <span class="hljs-string">"dom"</span>],</div><div class="line">    <span class="hljs-attr">"sourceMap"</span>: <span class="hljs-literal">true</span>,</div><div class="line">    <span class="hljs-attr">"allowJs"</span>: <span class="hljs-literal">true</span>,</div><div class="line">    <span class="hljs-attr">"jsx"</span>: <span class="hljs-string">"react"</span>,</div><div class="line">    <span class="hljs-attr">"moduleResolution"</span>: <span class="hljs-string">"node"</span>,</div><div class="line">    <span class="hljs-attr">"rootDir"</span>: <span class="hljs-string">"src"</span>,</div><div class="line">    <span class="hljs-attr">"noImplicitReturns"</span>: <span class="hljs-literal">true</span>,</div><div class="line">    <span class="hljs-attr">"noImplicitThis"</span>: <span class="hljs-literal">false</span>,</div><div class="line">    <span class="hljs-attr">"noImplicitAny"</span>: <span class="hljs-literal">false</span>,</div><div class="line">    <span class="hljs-attr">"strictNullChecks"</span>: <span class="hljs-literal">true</span></div><div class="line">  &#125;,</div><div class="line">  <span class="hljs-attr">"exclude"</span>: [</div><div class="line">    <span class="hljs-string">"config"</span>,</div><div class="line">    <span class="hljs-string">"node_modules"</span>,</div><div class="line">    <span class="hljs-string">"dist"</span>,</div><div class="line">    <span class="hljs-string">"webpack"</span>,</div><div class="line">    <span class="hljs-string">"jest"</span></div><div class="line">  ],</div><div class="line">  <span class="hljs-attr">"types"</span>: [</div><div class="line">    <span class="hljs-string">"typePatches"</span></div><div class="line">  ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Set-basic-webpack-config"><a href="#Set-basic-webpack-config" class="headerlink" title="Set basic webpack config"></a>Set basic webpack config</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// /config/webpack.config.base.js</span></div><div class="line"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>)</div><div class="line"></div><div class="line"><span class="hljs-built_in">module</span>.exports = &#123;</div><div class="line">  <span class="hljs-attr">output</span>: &#123;</div><div class="line">    <span class="hljs-attr">path</span>: path.resolve(__dirname, <span class="hljs-string">'../dist'</span>),</div><div class="line">    <span class="hljs-attr">filename</span>: <span class="hljs-string">'scripts/[name]-[hash].js'</span>,</div><div class="line">    <span class="hljs-attr">chunkFilename</span>: <span class="hljs-string">'scripts/[name]-[chunkhash].js'</span>,</div><div class="line">  &#125;,</div><div class="line">  <span class="hljs-attr">module</span>: &#123;</div><div class="line">    <span class="hljs-attr">rules</span>: [</div><div class="line">      &#123;</div><div class="line">        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.tsx?$/</span>,</div><div class="line">        <span class="hljs-attr">loader</span>: <span class="hljs-string">'ts-loader'</span>,</div><div class="line">        <span class="hljs-attr">exclude</span>: <span class="hljs-regexp">/node_modules/</span></div><div class="line">      &#125;, &#123;</div><div class="line">        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.jsx?$/</span>,</div><div class="line">        <span class="hljs-attr">loader</span>: <span class="hljs-string">'babel-laoder'</span>,</div><div class="line">        <span class="hljs-attr">exclude</span>: <span class="hljs-regexp">/node_modules/</span>,</div><div class="line">      &#125;, &#123;</div><div class="line">        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.(png|jpg)$/</span>,</div><div class="line">        <span class="hljs-attr">loader</span>: <span class="hljs-string">'url-loader'</span>,</div><div class="line">        <span class="hljs-attr">options</span>: &#123;</div><div class="line">          <span class="hljs-attr">limit</span>: <span class="hljs-number">8192</span>,</div><div class="line">          <span class="hljs-attr">name</span>: <span class="hljs-string">'[name]-[hash].[ext]'</span>,</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    ]</div><div class="line">  &#125;,</div><div class="line">  <span class="hljs-attr">resolve</span>: &#123;</div><div class="line">    <span class="hljs-attr">extensions</span>: [<span class="hljs-string">'.tsx'</span>, <span class="hljs-string">'.ts'</span>, <span class="hljs-string">'.jsx'</span>, <span class="hljs-string">'.js'</span>, <span class="hljs-string">'.scss'</span>, <span class="hljs-string">'.css'</span>, <span class="hljs-string">'.json'</span>]</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Set-dev-webpack-config"><a href="#Set-dev-webpack-config" class="headerlink" title="Set dev webpack config"></a>Set dev webpack config</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// /config/webpack.config.dev.js</span></div><div class="line"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>)</div><div class="line"><span class="hljs-keyword">const</span> webpack = <span class="hljs-built_in">require</span>(<span class="hljs-string">'webpack'</span>)</div><div class="line"><span class="hljs-keyword">const</span> merge = <span class="hljs-built_in">require</span>(<span class="hljs-string">'webpack-merge'</span>)</div><div class="line"><span class="hljs-keyword">const</span> HtmlPlugin = <span class="hljs-built_in">require</span>(<span class="hljs-string">'html-webpack-plugin'</span>)</div><div class="line"><span class="hljs-keyword">const</span> DashboardPlugin = <span class="hljs-built_in">require</span>(<span class="hljs-string">'webpack-dashboard/plugin'</span>)</div><div class="line"><span class="hljs-keyword">const</span> baseConfig = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./webpack.config.base'</span>)</div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> devConfig = &#123;</div><div class="line">  <span class="hljs-attr">entry</span>: &#123;</div><div class="line">    <span class="hljs-attr">app</span>: [</div><div class="line">      <span class="hljs-string">'webpack/hot/only-dev-server'</span>,</div><div class="line">      <span class="hljs-string">'webpack-dev-server/client?http://localhost:8080'</span>,</div><div class="line">      path.resolve(__dirname, <span class="hljs-string">'../src/app.tsx'</span>),</div><div class="line">    ],</div><div class="line">  &#125;,</div><div class="line">  <span class="hljs-attr">module</span>: &#123;</div><div class="line">    <span class="hljs-attr">rules</span>: [</div><div class="line">      &#123;</div><div class="line">        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.scss$/</span>,</div><div class="line">        <span class="hljs-attr">use</span>: [</div><div class="line">          <span class="hljs-string">'style-loader'</span>,</div><div class="line">          &#123;</div><div class="line">            <span class="hljs-attr">loader</span>: <span class="hljs-string">'css-loader'</span>,</div><div class="line">            <span class="hljs-attr">options</span>: &#123;</div><div class="line">              <span class="hljs-attr">modules</span>: <span class="hljs-literal">true</span>,</div><div class="line">              <span class="hljs-attr">name</span>: <span class="hljs-string">'[local]-[name]-[hash]'</span></div><div class="line">            &#125;,</div><div class="line">          &#125;,</div><div class="line">        ],</div><div class="line">        <span class="hljs-string">'resolve-url-loader'</span>,</div><div class="line">        <span class="hljs-string">'sass-loader'</span>,</div><div class="line">      &#125;,</div><div class="line">    ],</div><div class="line">  &#125;,</div><div class="line">  <span class="hljs-attr">devtool</span>: <span class="hljs-string">'source-map'</span>,</div><div class="line">  <span class="hljs-attr">plugins</span>: [</div><div class="line">    <span class="hljs-keyword">new</span> webpack.HotModuleReplacementPlugin(),</div><div class="line">    <span class="hljs-keyword">new</span> webpack.NamedModulesPlugin(),</div><div class="line">    <span class="hljs-keyword">new</span> webpack.DefinePluing(&#123;</div><div class="line">      <span class="hljs-string">'process.env'</span>: &#123;</div><div class="line">        <span class="hljs-attr">NODE_ENV</span>: <span class="hljs-string">'development'</span>,</div><div class="line">      &#125;,</div><div class="line">    &#125;),</div><div class="line">    <span class="hljs-keyword">new</span> DashboardPlugin(),</div><div class="line">    <span class="hljs-keyword">new</span> HtmlPlugin(&#123;</div><div class="line">      <span class="hljs-attr">title</span>: <span class="hljs-string">'开发'</span>,</div><div class="line">      <span class="hljs-attr">template</span>: path.resolve(__dirname, <span class="hljs-string">'../src/temlates/index.html'</span>),</div><div class="line">    &#125;),</div><div class="line">  ],</div><div class="line">  <span class="hljs-attr">devServer</span>: &#123;</div><div class="line">    <span class="hljs-attr">hot</span>: <span class="hljs-literal">true</span>,</div><div class="line">    <span class="hljs-attr">compress</span>: <span class="hljs-literal">true</span>,</div><div class="line">    <span class="hljs-attr">historyApiFallback</span>: <span class="hljs-literal">true</span>,</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-built_in">module</span>.exports = merge(baseConfig, devConfig)</div></pre></td></tr></table></figure>
<h4 id="Set-prod-webpack-config"><a href="#Set-prod-webpack-config" class="headerlink" title="Set prod webpack config"></a>Set prod webpack config</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// /config/webpack.config.prod.js</span></div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>)</div><div class="line"><span class="hljs-keyword">const</span> webpack = <span class="hljs-built_in">require</span>(<span class="hljs-string">'webpack'</span>)</div><div class="line"><span class="hljs-keyword">const</span> merge = <span class="hljs-built_in">require</span>(<span class="hljs-string">'webpack-merge'</span>)</div><div class="line"><span class="hljs-keyword">const</span> ExtractTextPlugin = <span class="hljs-built_in">require</span>(<span class="hljs-string">'extract-text-webpack-plugin'</span>)</div><div class="line"><span class="hljs-keyword">const</span> UglifyJSPlugin = <span class="hljs-built_in">require</span>(<span class="hljs-string">'uglifyjs-webpack-plugin'</span>)</div><div class="line"><span class="hljs-keyword">const</span> HtmlPlugin = <span class="hljs-built_in">require</span>(<span class="hljs-string">'html-webpack-plugin'</span>)</div><div class="line"><span class="hljs-keyword">const</span> baseConfig = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./webpack.config.base.js'</span>)</div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> prodConfig = &#123;</div><div class="line">  <span class="hljs-attr">entry</span>: &#123;</div><div class="line">    <span class="hljs-attr">app</span>: path.resolve(__dirname, <span class="hljs-string">'../src/app.tsx'</span>),</div><div class="line">  &#125;,</div><div class="line">  <span class="hljs-attr">module</span>: &#123;</div><div class="line">    <span class="hljs-attr">rules</span>: [</div><div class="line">      test: <span class="hljs-regexp">/\.scss$/</span>,</div><div class="line">      <span class="hljs-attr">use</span>: ExtractTextPlugin.extract(&#123;</div><div class="line">        <span class="hljs-attr">fallback</span>: <span class="hljs-string">'style-loader'</span>,</div><div class="line">        <span class="hljs-attr">use</span>: [</div><div class="line">          &#123;</div><div class="line">            <span class="hljs-attr">loader</span>: <span class="hljs-string">'css-loader'</span>,</div><div class="line">            <span class="hljs-attr">options</span>: &#123;</div><div class="line">              <span class="hljs-attr">modules</span>: <span class="hljs-literal">true</span>,</div><div class="line">              <span class="hljs-attr">name</span>: <span class="hljs-string">'[local]-[name]-[hash]'</span>,</div><div class="line">              <span class="hljs-attr">importLoaders</span>: <span class="hljs-number">3</span>,</div><div class="line">            &#125;,</div><div class="line">          &#125;,</div><div class="line">        ],</div><div class="line">        <span class="hljs-attr">exclude</span>: <span class="hljs-regexp">/node_modules/</span>,</div><div class="line">      &#125;), &#123;</div><div class="line">        <span class="hljs-attr">loader</span>: <span class="hljs-string">'postcss-loader'</span>,</div><div class="line">        <span class="hljs-attr">options</span>: &#123;</div><div class="line">          <span class="hljs-attr">config</span>: path.resolve(__dirname, <span class="hljs-string">'./config/postcss.config.json'</span>)</div><div class="line">        &#125;</div><div class="line">      &#125;,</div><div class="line">      <span class="hljs-string">'resolve-url-loader'</span>,</div><div class="line">      <span class="hljs-string">'sass-loader'</span>,</div><div class="line">    ],</div><div class="line">  &#125;,</div><div class="line">  <span class="hljs-attr">devtool</span>: <span class="hljs-string">'inline-source-map'</span>,</div><div class="line">  <span class="hljs-attr">plugins</span>: [</div><div class="line">    <span class="hljs-keyword">new</span> webpack.DefinePluing(&#123;</div><div class="line">      <span class="hljs-string">'process.env.NODE_ENV'</span>: <span class="hljs-string">'production'</span>,</div><div class="line">    &#125;),</div><div class="line">    <span class="hljs-keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</div><div class="line">      <span class="hljs-attr">name</span>: <span class="hljs-string">'app'</span>,</div><div class="line">      <span class="hljs-attr">filename</span>: <span class="hljs-string">'scripts/vendor-[hash].min.js'</span>,</div><div class="line">    &#125;),</div><div class="line">    <span class="hljs-keyword">new</span> HtmlPlugin(&#123;</div><div class="line">      <span class="hljs-attr">title</span>: <span class="hljs-string">'生产'</span>,</div><div class="line">      <span class="hljs-attr">template</span>: path.resolve(__dirnaem, <span class="hljs-string">'../src/templates/index.html'</span>),</div><div class="line">      <span class="hljs-attr">minify</span>: &#123;</div><div class="line">        <span class="hljs-attr">collapseBooleanAttributes</span>: <span class="hljs-literal">true</span>,</div><div class="line">        <span class="hljs-attr">collapseInlineTagWhitespace</span>: <span class="hljs-literal">true</span>,</div><div class="line">        <span class="hljs-attr">collapseWhitespace</span>: <span class="hljs-literal">true</span>,</div><div class="line">        <span class="hljs-attr">minifyCSS</span>: <span class="hljs-literal">true</span>,</div><div class="line">        <span class="hljs-attr">minifyJS</span>: <span class="hljs-literal">true</span>,</div><div class="line">        <span class="hljs-attr">removeAttributeQuotes</span>: <span class="hljs-literal">true</span>,</div><div class="line">        <span class="hljs-attr">removeComments</span>: <span class="hljs-literal">true</span>,</div><div class="line">        <span class="hljs-attr">removeEmptyAttributes</span>: <span class="hljs-literal">true</span>,</div><div class="line">        <span class="hljs-attr">removeRedundantAttributes</span>: <span class="hljs-literal">true</span>,</div><div class="line">        <span class="hljs-attr">removeTagWhitespace</span>: <span class="hljs-literal">true</span>,</div><div class="line">      &#125;,</div><div class="line">    &#125;),</div><div class="line">    <span class="hljs-keyword">new</span> ExtractTextPlugin(&#123;</div><div class="line">      <span class="hljs-attr">filename</span>: <span class="hljs-string">'styles/[name]-[contenthash].css'</span>,</div><div class="line">    &#125;),</div><div class="line">    <span class="hljs-keyword">new</span> UglifyJSPlugin(),</div><div class="line">  ],</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Set-config-refered-by-webpack-babelrc-postcss-index-html"><a href="#Set-config-refered-by-webpack-babelrc-postcss-index-html" class="headerlink" title="Set config refered by webpack(babelrc, postcss, index.html)"></a>Set config refered by webpack(babelrc, postcss, index.html)</h3><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// /.babelrc</span></div><div class="line">&#123;</div><div class="line">  <span class="hljs-string">"presets"</span>: [</div><div class="line">    [</div><div class="line">      <span class="hljs-string">"env"</span>, &#123;</div><div class="line">        <span class="hljs-string">"targets"</span>: &#123;</div><div class="line">          <span class="hljs-string">"browsers"</span>: [<span class="hljs-string">"last 2 versions"</span>, <span class="hljs-string">"safari &gt;= 9"</span>],</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    ],</div><div class="line">    <span class="hljs-string">"react"</span>,</div><div class="line">  ],</div><div class="line">  <span class="hljs-string">"plugins"</span>: [</div><div class="line">    [<span class="hljs-string">"transform-runtime"</span>, &#123;</div><div class="line">      <span class="hljs-string">"polyfill"</span>: <span class="hljs-literal">false</span>,</div><div class="line">      <span class="hljs-string">"regenerator"</span>: <span class="hljs-literal">true</span></div><div class="line">    &#125;],</div><div class="line">  ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">const</span> precss = <span class="hljs-built_in">require</span>(<span class="hljs-string">'precss'</span>)</div><div class="line"><span class="hljs-keyword">const</span> autoprefixer = <span class="hljs-built_in">require</span>(<span class="hljs-string">'autoprefixer'</span>)</div><div class="line"></div><div class="line"><span class="hljs-built_in">module</span>.exports = &#123;</div><div class="line">  <span class="hljs-attr">plugins</span>: [</div><div class="line">    precss,</div><div class="line">    autoprefixer,</div><div class="line">  ],</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight html hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span></div><div class="line"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></div><div class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span></div><div class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span></div><div class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span>&gt;</span></div><div class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">%=</span> <span class="hljs-attr">htmlWebpackPlugin.options.title</span> %&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></div><div class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></div><div class="line"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></div><div class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></div><div class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="Step-2-Skeleton-of-React-App-React-Router"><a href="#Step-2-Skeleton-of-React-App-React-Router" class="headerlink" title="Step 2: Skeleton of React App(React + Router)"></a>Step 2: Skeleton of React App(React + Router)</h3><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">yarn add --dev bundle-laoder @types/react @types/react-dom @types/node @types/react-router-dom</div><div class="line"></div><div class="line">yarn add react react-dom react-router-dom</div></pre></td></tr></table></figure>
<p>In <code>src/app.tsx</code> render the App to html</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span></div><div class="line"><span class="hljs-keyword">import</span> &#123; render &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'react-dom'</span></div><div class="line"><span class="hljs-keyword">import</span> App <span class="hljs-keyword">from</span> <span class="hljs-string">'./containers/App'</span></div><div class="line"></div><div class="line">render(</div><div class="line">  <span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span>, document.getElementById('app') as HTMLElement</span></div><div class="line">)</div><div class="line"></div><div class="line">if (module.hot) &#123;</div><div class="line">  module.hot.accept('./containers/App', () =&gt; &#123;</div><div class="line">    const App = require('./containers/App').default</div><div class="line">    render (</div><div class="line">      <span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span>,</div><div class="line">      document.getElementById('app')</div><div class="line">    )</div><div class="line">  &#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Create-App-Represental-Component"><a href="#Create-App-Represental-Component" class="headerlink" title="Create App Represental Component"></a>Create App Represental Component</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// `./src/containers/App.tsx`</span></div><div class="line"></div><div class="line"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span></div><div class="line"><span class="hljs-keyword">import</span> &#123;</div><div class="line">  BrowserRouter <span class="hljs-keyword">as</span> Router,</div><div class="line">  Route,</div><div class="line">&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router-dom'</span></div><div class="line"><span class="hljs-keyword">import</span> Header <span class="hljs-keyword">from</span> <span class="hljs-string">'./Header'</span></div><div class="line"><span class="hljs-keyword">import</span> Body <span class="hljs-keyword">from</span> <span class="hljs-string">'./Body'</span></div><div class="line"><span class="hljs-keyword">import</span> Footer <span class="hljs-keyword">from</span> <span class="hljs-string">'./Footer'</span></div><div class="line"></div><div class="line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>&#123;</div><div class="line">  <span class="hljs-keyword">constructor</span> () &#123;</div><div class="line">    <span class="hljs-keyword">super</span> ()</div><div class="line">  &#125;</div><div class="line">  render () &#123;</div><div class="line">    <span class="hljs-keyword">return</span> (</div><div class="line">      &lt;Router&gt;</div><div class="line">        &lt;div&gt;</div><div class="line">         &lt;Route path="/" component=&#123;Header&#125; /&gt;</div><div class="line">         &lt;Route path="/" component=&#123;Body&#125; /&gt;</div><div class="line">         &lt;Route path="/" component=&#123;Footer&#125; /&gt;</div><div class="line">        &lt;/div&gt;</div><div class="line">      &lt;/Router&gt;</div><div class="line">    )</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Create-Header-Body-Footer-Containers"><a href="#Create-Header-Body-Footer-Containers" class="headerlink" title="Create Header, Body, Footer Containers"></a>Create Header, Body, Footer Containers</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// ./src/containers/Header.tsx</span></div><div class="line"></div><div class="line"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span></div><div class="line"><span class="hljs-keyword">import</span> &#123; goTo &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'..utils/nav'</span></div><div class="line"></div><div class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Header</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>&#123;</div><div class="line">  protected goTo = goTo.bind(<span class="hljs-keyword">this</span>)</div><div class="line">  <span class="hljs-keyword">constructor</span> () &#123;</div><div class="line">    <span class="hljs-keyword">super</span>()</div><div class="line">    <span class="hljs-keyword">this</span>.state = &#123;</div><div class="line">      <span class="hljs-attr">navs</span>: [</div><div class="line">        &#123; <span class="hljs-attr">label</span>: <span class="hljs-string">'首页'</span>, <span class="hljs-attr">url</span>: <span class="hljs-string">'index'</span> &#125;,</div><div class="line">        &#123; <span class="hljs-attr">label</span>: <span class="hljs-string">'第二页'</span>, <span class="hljs-attr">url</span>: <span class="hljs-string">'page2'</span> &#125;,</div><div class="line">        &#123; <span class="hljs-attr">label</span>: <span class="hljs-string">'第三页'</span>, <span class="hljs-attr">url</span>: <span class="hljs-string">'page3'</span> &#125;,</div><div class="line">      ]</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  render () &#123;</div><div class="line">    <span class="hljs-keyword">const</span> &#123; navs &#125; = <span class="hljs-keyword">this</span>.state</div><div class="line">    <span class="hljs-keyword">return</span> (</div><div class="line">      <span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span></div><div class="line">        &#123;</div><div class="line">          navs.map(</div><div class="line">            (nav: &#123;label: string, url: string&#125;) =&gt; <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;nav.url&#125;</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;this.goTo(nav.url)&#125;</span>&gt;</span>&#123;nav.label&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></div><div class="line">          )</div><div class="line">        &#125;</div><div class="line">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="line">    )</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> Header</div></pre></td></tr></table></figure>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// ./src/utils/nav.tsx</span></div><div class="line"></div><div class="line"><span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">goTo</span>(<span class="hljs-params">url: string</span>) </span>&#123;</div><div class="line">  retrn () =&gt; &#123;</div><div class="line">    <span class="hljs-keyword">this</span>.props.history.push(url)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Same structure in Body and Footer.</p>
<h4 id="Add-AsyncRoute"><a href="#Add-AsyncRoute" class="headerlink" title="Add AsyncRoute"></a>Add AsyncRoute</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span></div><div class="line"></div><div class="line">interface PassedProps extends React.Props&lt;any&gt; &#123;</div><div class="line">  <span class="hljs-attr">load</span>: any;</div><div class="line">  children: any;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Bundle</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span>&lt;<span class="hljs-title">PassedProps</span>, <span class="hljs-title">any</span>&gt; </span>&#123;</div><div class="line">  <span class="hljs-keyword">constructor</span> () &#123;</div><div class="line">    <span class="hljs-keyword">super</span>()</div><div class="line">    <span class="hljs-keyword">this</span>.state = &#123;</div><div class="line">      <span class="hljs-attr">mod</span>: <span class="hljs-literal">null</span>,</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  componentWillMount () &#123;</div><div class="line">    <span class="hljs-keyword">this</span>.load(<span class="hljs-keyword">this</span>.props)</div><div class="line">  &#125;</div><div class="line">  componentWillReceiveProps (nextProps) &#123;</div><div class="line">    <span class="hljs-keyword">if</span> (nextProps.load !== <span class="hljs-keyword">this</span>.props.load) &#123;</div><div class="line">      <span class="hljs-keyword">this</span>.load(nextProps)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  load (props) &#123;</div><div class="line">    <span class="hljs-keyword">this</span>.setState(&#123;</div><div class="line">      <span class="hljs-attr">mod</span>: <span class="hljs-literal">null</span>,</div><div class="line">    &#125;)</div><div class="line">    props.load(<span class="hljs-function">(<span class="hljs-params">mod</span>) =&gt;</span> &#123;</div><div class="line">      <span class="hljs-keyword">this</span>.setState(&#123;</div><div class="line">        <span class="hljs-attr">mod</span>: mod.default || mod,</div><div class="line">      &#125;)</div><div class="line">    &#125;)</div><div class="line">  &#125;</div><div class="line">  render () &#123;</div><div class="line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.state.mod ? <span class="hljs-keyword">this</span>.props.children(<span class="hljs-keyword">this</span>.state.mod) : <span class="hljs-literal">null</span></div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-built_in">module</span> =&gt; <span class="hljs-function"><span class="hljs-params">routerProps</span> =&gt;</span> (&lt;Bundle load=&#123;module&#125;&gt;</div><div class="line">  &#123; Comp =&gt; Comp ? &lt;Comp &#123;...routerProps&#125; /&gt; : null&#125;</div><div class="line">)</div></pre></td></tr></table></figure>
<p>And use it in body container</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span></div><div class="line"><span class="hljs-keyword">import</span> &#123; Route &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router'</span></div><div class="line"></div><div class="line"><span class="hljs-keyword">import</span> Index <span class="hljs-keyword">from</span> <span class="hljs-string">'bundle-loader?lazy!./Index'</span></div><div class="line"><span class="hljs-keyword">import</span> AsyncRoute <span class="hljs-keyword">from</span> <span class="hljs-string">'../components/AsyncRoute'</span></div><div class="line"></div><div class="line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> () =&gt; (</div><div class="line">  <span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span></div><div class="line">   <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/index"</span> <span class="hljs-attr">component</span>=<span class="hljs-string">&#123;AsyncRoute(Index)&#125;</span></span></div><div class="line">  &lt;/<span class="hljs-attr">div</span>&gt;</div><div class="line">)</div></pre></td></tr></table></figure>
<h3 id="Add-Redux"><a href="#Add-Redux" class="headerlink" title="Add Redux"></a>Add Redux</h3><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">yarn add --dev redux-devtools redux-devtools-dock-monitor redux-devtools-log-monitor</div><div class="line"></div><div class="line">yarn add redux redux-actions react-redux</div></pre></td></tr></table></figure>
<h4 id="Create-Actions"><a href="#Create-Actions" class="headerlink" title="Create Actions"></a>Create Actions</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// ./src/actions/hello.tsx</span></div><div class="line"><span class="hljs-keyword">import</span> &#123; createActions &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'redux-actions'</span></div><div class="line"></div><div class="line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> createActions(&#123;</div><div class="line">  <span class="hljs-attr">SAY_HELLO</span>: <span class="hljs-function"><span class="hljs-params">text</span> =&gt;</span> (&#123; text &#125;)</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="hljs-comment">// export</span></div><div class="line"><span class="hljs-comment">// &#123;</span></div><div class="line"><span class="hljs-comment">//   sayHello: (text: string) =&gt; (&#123; text: string &#125;)</span></div><div class="line"><span class="hljs-comment">// &#125;</span></div></pre></td></tr></table></figure>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// ./src/actions/index.tsx</span></div><div class="line"><span class="hljs-keyword">import</span> helloActions <span class="hljs-keyword">from</span> <span class="hljs-string">'./hello'</span></div><div class="line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</div><div class="line">  ...helloActions</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Create-Reducers"><a href="#Create-Reducers" class="headerlink" title="Create Reducers"></a>Create Reducers</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// ./src/reducers/hello.tsx</span></div><div class="line"><span class="hljs-keyword">import</span> &#123; handleActions &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'redux-actions'</span></div><div class="line"><span class="hljs-keyword">import</span> actions <span class="hljs-keyword">from</span> <span class="hljs-string">'../actions'</span></div><div class="line"></div><div class="line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> handleActions(&#123;</div><div class="line">  [actions.sayHello.toString()]: <span class="hljs-function">(<span class="hljs-params">state, action</span>) =&gt;</span> &#123;</div><div class="line">    <span class="hljs-keyword">return</span> &#123; ...state, ...action.payload &#125;</div><div class="line">  &#125;,</div><div class="line">&#125;, &#123;</div><div class="line">  <span class="hljs-attr">text</span>: <span class="hljs-string">''</span>,</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// ./src/reducers/index.tsx</span></div><div class="line"><span class="hljs-keyword">import</span> &#123; combineReducers &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'redux'</span></div><div class="line"><span class="hljs-keyword">import</span> helloReducer <span class="hljs-keyword">from</span> <span class="hljs-string">'./hello'</span></div><div class="line"></div><div class="line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> combineReducers(&#123;</div><div class="line">  <span class="hljs-attr">hello</span>: helloReducer,</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h4 id="Create-Store"><a href="#Create-Store" class="headerlink" title="Create Store"></a>Create Store</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// ./src/store/configureStore.dev.tsx</span></div><div class="line"></div><div class="line"><span class="hljs-keyword">import</span> &#123; createStore, applyMiddleware, compose, GenericStoreEnhancer &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'redux'</span></div><div class="line"><span class="hljs-keyword">import</span> reducer <span class="hljs-keyword">from</span> <span class="hljs-string">'../reducers'</span></div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> enhancer = compose(</div><div class="line">  <span class="hljs-comment">// applyMiddleware(...middlewares)</span></div><div class="line"></div><div class="line">  <span class="hljs-built_in">window</span>.devToolsExtension ? <span class="hljs-built_in">window</span>.devToolsExtension() : <span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f,</div><div class="line">)</div><div class="line"></div><div class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">configureStoreDev</span>(<span class="hljs-params">initState: any</span>): <span class="hljs-title">any</span> </span>&#123;</div><div class="line">  <span class="hljs-keyword">const</span> store = createStore(reducer, initState, enhancer)</div><div class="line">  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">module</span>.hot) &#123;</div><div class="line">    <span class="hljs-built_in">module</span>.hot.accpet(<span class="hljs-string">'../reducers'</span>, () =&gt; &#123;</div><div class="line">      store.replaceReducer(<span class="hljs-built_in">require</span>(<span class="hljs-string">'../reducers'</span>).default)</div><div class="line">    &#125;)</div><div class="line">  &#125;</div><div class="line">  <span class="hljs-keyword">return</span> store</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-built_in">module</span>.exports = configureStoreDev</div></pre></td></tr></table></figure>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// ./src/store/configureStoreProd</span></div><div class="line"></div><div class="line"><span class="hljs-keyword">import</span> &#123; createStore, applyMiddleware &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'redux'</span></div><div class="line"><span class="hljs-keyword">import</span> reducer <span class="hljs-keyword">from</span> <span class="hljs-string">'../reducers'</span></div><div class="line"></div><div class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">configureStoreProd</span> (<span class="hljs-params">initState: any</span>) </span>&#123;</div><div class="line">  <span class="hljs-keyword">return</span> createStore(reducer, initState)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-built_in">module</span>.exports = configureStoreProd</div></pre></td></tr></table></figure>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// ./src/store/index.jsx</span></div><div class="line"></div><div class="line"><span class="hljs-keyword">if</span> (process.env.NODE_ENV == <span class="hljs-string">'development'</span>) &#123;</div><div class="line">  <span class="hljs-built_in">module</span>.exports = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./configureStore.dev'</span>)</div><div class="line">&#125; <span class="hljs-keyword">else</span> &#123;</div><div class="line">  <span class="hljs-built_in">module</span>.exports = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./configureStore.prod'</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Add-Provider-to-Main-Container"><a href="#Add-Provider-to-Main-Container" class="headerlink" title="Add Provider to Main Container"></a>Add Provider to Main Container</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// ./container/App.tsx</span></div><div class="line"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span></div><div class="line"><span class="hljs-keyword">import</span> &#123;</div><div class="line">  BrowserRouter <span class="hljs-keyword">as</span> Router,</div><div class="line">  Route,</div><div class="line">&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router-dom'</span></div><div class="line"><span class="hljs-keyword">import</span> &#123; Provider &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'react-redux'</span></div><div class="line"><span class="hljs-keyword">import</span> Header <span class="hljs-keyword">from</span> <span class="hljs-string">'./Header'</span></div><div class="line"><span class="hljs-keyword">import</span> Body <span class="hljs-keyword">from</span> <span class="hljs-string">'./Body'</span></div><div class="line"><span class="hljs-keyword">import</span> Footer <span class="hljs-keyword">from</span> <span class="hljs-string">'./Footer'</span></div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> configureStore = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../store'</span>)</div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> store = configureStore(&#123;&#125;)</div><div class="line"></div><div class="line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>&#123;</div><div class="line">  <span class="hljs-keyword">constructor</span> () &#123;</div><div class="line">    <span class="hljs-keyword">super</span>()</div><div class="line">  &#125;</div><div class="line">  render () &#123;</div><div class="line">    returun (</div><div class="line">      &lt;Router&gt;</div><div class="line">        &lt;Provider store=&#123;store&#125;&gt;</div><div class="line">          &lt;Route path="/" component=&#123;Header&#125; /&gt;</div><div class="line">          &lt;Route path="/" component=&#123;Body&#125; /&gt;</div><div class="line">          &lt;Route path="/" component=&#123;Body&#125; /&gt;</div><div class="line">        &lt;/Provider&gt;</div><div class="line">      &lt;/Router&gt;</div><div class="line">    )</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="custom-connect-to-cache-mapStateToProps-and-mapDispatchToProps"><a href="#custom-connect-to-cache-mapStateToProps-and-mapDispatchToProps" class="headerlink" title="custom connect to cache mapStateToProps and mapDispatchToProps"></a>custom connect to cache mapStateToProps and mapDispatchToProps</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">import</span> &#123; connect &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'react-redux'</span></div><div class="line"><span class="hljs-keyword">import</span> &#123; bindActionCreators &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'redux'</span></div><div class="line"><span class="hljs-keyword">import</span> actions <span class="hljs-keyword">from</span> <span class="hljs-string">'../actions'</span></div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> mapStateToProps = <span class="hljs-function">(<span class="hljs-params">state: any</span>) =&gt;</span> state</div><div class="line"><span class="hljs-keyword">const</span> mapDispatchToProps = <span class="hljs-function">(<span class="hljs-params">dispatch: any</span>) =&gt;</span> (bindActionCreators(actions, dispatch))</div><div class="line"></div><div class="line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> (Comp: any) =&gt; connect(mapStateToProps, mapDispatchToProps)(Comp)</div></pre></td></tr></table></figure>
<h4 id="Connect-the-Presentational-Container"><a href="#Connect-the-Presentational-Container" class="headerlink" title="Connect the Presentational Container"></a>Connect the Presentational Container</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span></div><div class="line"><span class="hljs-keyword">import</span> connect <span class="hljs-keyword">from</span> <span class="hljs-string">'../utils/connect'</span></div><div class="line"><span class="hljs-keyword">import</span> &#123; goTo &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'../utils/nav'</span></div><div class="line"></div><div class="line">interface PassedProps extends React.Props&lt;any&gt; &#123;</div><div class="line">  <span class="hljs-attr">sayHello</span>: any;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Header</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span>&lt;<span class="hljs-title">PassedProps</span>, <span class="hljs-title">any</span>&gt; </span>&#123;</div><div class="line">  protected goTo = goTo.bind(<span class="hljs-keyword">this</span>)</div><div class="line">  <span class="hljs-keyword">constructor</span> () &#123;</div><div class="line">    <span class="hljs-keyword">super</span>()</div><div class="line">    <span class="hljs-keyword">this</span>.state = &#123;</div><div class="line">      <span class="hljs-attr">navs</span>: [</div><div class="line">        &#123; <span class="hljs-attr">label</span>: <span class="hljs-string">'首页'</span>, <span class="hljs-attr">url</span>: <span class="hljs-string">'index'</span> &#125;,</div><div class="line">        &#123; <span class="hljs-attr">label</span>: <span class="hljs-string">'第二页'</span>, <span class="hljs-attr">url</span>: <span class="hljs-string">'page2'</span> &#125;,</div><div class="line">        &#123; <span class="hljs-attr">label</span>: <span class="hljs-string">'第三页'</span>, <span class="hljs-attr">url</span>: <span class="hljs-string">'page3'</span> &#125;,</div><div class="line">      ]</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  componentDidMount () &#123;</div><div class="line">    <span class="hljs-keyword">this</span>.props.sayHello(<span class="hljs-string">'world'</span>)</div><div class="line">  &#125;</div><div class="line">  render () &#123;</div><div class="line">    <span class="hljs-keyword">const</span> &#123; navs &#125; = <span class="hljs-keyword">this</span>.state</div><div class="line">    <span class="hljs-keyword">return</span> (</div><div class="line">      <span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span></div><div class="line">        &#123;navs.map((nav: &#123; label: string, url: string&#125;) =&gt; <span class="hljs-tag">&lt;<span class="hljs-name">span</span></span></div><div class="line">          <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;nav.url&#125;</span></div><div class="line">          <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;this.goTo(nav.url)&#125;</span></div><div class="line">        &gt;&#123;nav.label&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>)&#125;</div><div class="line">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></div><div class="line">    )</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> connect(Header)</div></pre></td></tr></table></figure>
<h3 id="Add-Rxjs"><a href="#Add-Rxjs" class="headerlink" title="Add Rxjs"></a>Add Rxjs</h3><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yarn add rxjs redux-observable</div></pre></td></tr></table></figure>
<h4 id="Create-Epics"><a href="#Create-Epics" class="headerlink" title="Create Epics"></a>Create Epics</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// ./src/epics/hello.tsx</span></div><div class="line"><span class="hljs-keyword">import</span> <span class="hljs-string">'rxjs'</span></div><div class="line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> sayHello = <span class="hljs-function">(<span class="hljs-params">action$, store</span>) =&gt;</span></div><div class="line">  .action$.ofType(<span class="hljs-string">'SAY_HELLO'</span>)</div><div class="line">  .delay(<span class="hljs-number">1000</span>)</div><div class="line">  .map(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> (&#123;</div><div class="line">    <span class="hljs-attr">type</span>: <span class="hljs-string">'SAY_HELLO'</span>,</div><div class="line">    <span class="hljs-attr">payload</span>: &#123;</div><div class="line">      <span class="hljs-attr">text</span>: <span class="hljs-string">'got hello'</span></div><div class="line">    &#125;</div><div class="line">  &#125;))</div></pre></td></tr></table></figure>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// ./src/epcis/index.tsx</span></div><div class="line"></div><div class="line"><span class="hljs-keyword">import</span> &#123; combineEpics &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'redux-observable'</span></div><div class="line"><span class="hljs-keyword">import</span> &#123; sayHello &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'./hello'</span></div><div class="line"></div><div class="line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> combineEpics(</div><div class="line">  sayHello,</div><div class="line">)</div></pre></td></tr></table></figure>
<h4 id="Add-Epic-to-Enhancer"><a href="#Add-Epic-to-Enhancer" class="headerlink" title="Add Epic to Enhancer"></a>Add Epic to Enhancer</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">import</span> &#123; createStore, applyMiddleware, compose, GenericStoreEnhancer &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'redux'</span></div><div class="line"><span class="hljs-keyword">import</span> &#123; createEpicMiddleware &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'redux-observable'</span></div><div class="line"><span class="hljs-keyword">import</span> reducer <span class="hljs-keyword">from</span> <span class="hljs-string">'../reducers'</span></div><div class="line"><span class="hljs-keyword">import</span> epics <span class="hljs-keyword">from</span> <span class="hljs-string">'../epics'</span></div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> epicMiddleware = createEpicMiddleware(epics)</div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> enhancer = compose(</div><div class="line">  applyMiddleware(epicMiddleware),</div><div class="line">  <span class="hljs-built_in">window</span>.devToolsExtension ? <span class="hljs-built_in">window</span>.devToolsExtension() : <span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f</div><div class="line">)</div><div class="line"></div><div class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">configureStoreDev</span> (<span class="hljs-params">initState: any</span>) </span>&#123;</div><div class="line">  <span class="hljs-keyword">const</span> store = createStore(reducer, initState, enhancer)</div><div class="line">  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">module</span>.hot) &#123;</div><div class="line">    <span class="hljs-built_in">module</span>.hot.accept(<span class="hljs-string">'../reducers'</span>, () =&gt; &#123;</div><div class="line">      store.replaceReducer(<span class="hljs-built_in">require</span>(<span class="hljs-string">'../reducers'</span>).default)</div><div class="line">    &#125;)</div><div class="line">  &#125;</div><div class="line">  <span class="hljs-keyword">return</span> store</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-built_in">module</span>.exports = configureStoreDev</div></pre></td></tr></table></figure>
<h3 id="Add-Service-Worker"><a href="#Add-Service-Worker" class="headerlink" title="Add Service Worker"></a>Add Service Worker</h3><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yarn add sw-precache-webpack-plugin</div></pre></td></tr></table></figure>
<h4 id="Add-the-Plugin-in-webpack-config-prod-js"><a href="#Add-the-Plugin-in-webpack-config-prod-js" class="headerlink" title="Add the Plugin in webpack.config.prod.js"></a>Add the Plugin in webpack.config.prod.js</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">const</span> SWPrecachePluing = <span class="hljs-built_in">require</span>(<span class="hljs-string">'sw-precache-webpack-plugin'</span>)</div><div class="line">plugins: [</div><div class="line">  <span class="hljs-keyword">new</span> SWPrecachePluing()</div><div class="line">]</div></pre></td></tr></table></figure>
<h3 id="Add-Bundle-Analyzer"><a href="#Add-Bundle-Analyzer" class="headerlink" title="Add Bundle Analyzer"></a>Add Bundle Analyzer</h3><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yarn add --dev webpack-bundle-anaylzer</div></pre></td></tr></table></figure>
<h3 id="Add-the-Plugin-in-webpack-config-dev-js"><a href="#Add-the-Plugin-in-webpack-config-dev-js" class="headerlink" title="Add the Plugin in webpack.config.dev.js"></a>Add the Plugin in webpack.config.dev.js</h3><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">const</span> BundleAnalyzer = <span class="hljs-built_in">require</span>(<span class="hljs-string">'webpack-bundle-analyzer'</span>).BundleAnalyzerPlugin</div><div class="line"></div><div class="line">plugins: [</div><div class="line">  <span class="hljs-keyword">new</span> BundleAnalyzer()</div><div class="line">]</div></pre></td></tr></table></figure>
<h3 id="Add-Dll"><a href="#Add-Dll" class="headerlink" title="Add Dll"></a>Add Dll</h3><h4 id="Add-webpack-config-dll-js"><a href="#Add-webpack-config-dll-js" class="headerlink" title="Add webpack.config.dll.js"></a>Add webpack.config.dll.js</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// webpack.config.dll.js</span></div><div class="line"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>)</div><div class="line"><span class="hljs-keyword">const</span> webpack = <span class="hljs-built_in">require</span>(<span class="hljs-string">'webpack'</span>)</div><div class="line"><span class="hljs-keyword">const</span> ManifestPlugin = <span class="hljs-built_in">require</span>(<span class="hljs-string">'webpack-manifest-plugin'</span>)</div><div class="line"></div><div class="line"><span class="hljs-built_in">module</span>.exports = &#123;</div><div class="line">  <span class="hljs-attr">entry</span>: &#123;</div><div class="line">    <span class="hljs-attr">vendor</span>: [<span class="hljs-comment">/* ... */</span>],</div><div class="line">  &#125;,</div><div class="line">  <span class="hljs-attr">output</span>: &#123;</div><div class="line">    <span class="hljs-attr">path</span>: path.resolve(__dirname, <span class="hljs-string">'../lib'</span>),</div><div class="line">    <span class="hljs-attr">filename</span>: <span class="hljs-string">'[name]_[hash:5].js'</span>,</div><div class="line">    <span class="hljs-attr">library</span>: <span class="hljs-string">'[name]_[hash:5]'</span>,</div><div class="line">  &#125;,</div><div class="line">  <span class="hljs-attr">plugins</span>: [</div><div class="line">    <span class="hljs-keyword">new</span> webpack.DllPlugin(&#123;</div><div class="line">      <span class="hljs-attr">name</span>: <span class="hljs-string">'[name]_[hash:5]'</span>,</div><div class="line">      <span class="hljs-attr">path</span>: path.resolve(__dirname, <span class="hljs-string">'../lib'</span>, <span class="hljs-string">'[name]-manifest.json'</span>),</div><div class="line">    &#125;),</div><div class="line">    <span class="hljs-keyword">new</span> ManifestPlugin(),</div><div class="line">  ],</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Copy-dll-to-dist-and-refer"><a href="#Copy-dll-to-dist-and-refer" class="headerlink" title="Copy dll to dist and refer"></a>Copy dll to dist and refer</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// webpack.config.base.js</span></div><div class="line"><span class="hljs-keyword">const</span> vendorManifest = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../lib/vendor-manifest.json'</span>)</div><div class="line">plugins: [</div><div class="line">  <span class="hljs-keyword">new</span> CopyPlugin([</div><div class="line">    &#123; <span class="hljs-attr">from</span>: path.resolve(__dirname, <span class="hljs-string">'../lib/*.js'</span>) &#125;,</div><div class="line">  ]),</div><div class="line">  <span class="hljs-keyword">new</span> webpack.DllReference(&#123;</div><div class="line">    <span class="hljs-attr">manifest</span>: vendorManifest,</div><div class="line">  &#125;),</div><div class="line">]</div></pre></td></tr></table></figure>
<h3 id="Insert-Dll-files-in-html"><a href="#Insert-Dll-files-in-html" class="headerlink" title="Insert Dll files in html"></a>Insert Dll files in html</h3><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// webpack.config.dev.js</span></div><div class="line"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>)</div><div class="line"><span class="hljs-keyword">const</span> manifest = <span class="hljs-built_in">JSON</span>.parse(fs.readFileSync(path.resolve(__dirname, <span class="hljs-string">'../lib/manifest.json'</span>)))</div><div class="line"></div><div class="line"><span class="hljs-built_in">module</span>.exports = &#123;</div><div class="line">  <span class="hljs-comment">// ...</span></div><div class="line">  plugins: [</div><div class="line">    <span class="hljs-keyword">new</span> HtmlPlugin(&#123;</div><div class="line">      <span class="hljs-comment">// ...</span></div><div class="line">      dll: <span class="hljs-string">`./lib/<span class="hljs-subst">$&#123;manifest[<span class="hljs-string">'vendor.js'</span>]&#125;</span>`</span>,</div><div class="line">    &#125;),</div><div class="line">  ],</div><div class="line">&#125;</div></pre></td></tr></table></figure>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-09-05T01:41:10.000Z">2017-09-05</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    a minute read (About 172 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/09/05/Notes-on-TS-React-Redux/">Notes on TS + React + Redux</a>
            
        </h1>
        <div class="content">
            <h3 id="Add-Explicit-Props-Interface-from-Store"><a href="#Add-Explicit-Props-Interface-from-Store" class="headerlink" title="Add Explicit Props Interface from Store"></a>Add Explicit Props Interface from Store</h3><p>When I use <code>react-redux</code>, the TS Compiler always throw an error:</p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">error TS2339: Property <span class="hljs-string">'...'</span> does not exist on <span class="hljs-built_in">type</span> <span class="hljs-string">'Readonly&lt;children?: ReactNode; &#125;&gt; &amp; Readonly&lt;&#123;&#125;&gt;'</span>.</div></pre></td></tr></table></figure>
<p>That’s because Connect was not supplying an explicit interface to the container component, so it was confused by the prop that it was trying to pass.</p>
<p>So you can add an explicit interface on child component.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">interface PropsFromStore extends React.Props&lt;any&gt; &#123;</div><div class="line">  <span class="hljs-attr">propsFromStore</span>: any;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ChildComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span>&lt;<span class="hljs-title">PropsFromStore</span>, <span class="hljs-title">React</span>.<span class="hljs-title">State</span>&gt; </span>&#123;</div><div class="line">  <span class="hljs-comment">// ...</span></div><div class="line">&#125;</div><div class="line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> connect(mapStateToProps, mapDispatchToProps)(ChildComponent)</div></pre></td></tr></table></figure>
<h3 id="Add-Enhancer-to-Store-with-TS"><a href="#Add-Enhancer-to-Store-with-TS" class="headerlink" title="Add Enhancer to Store with TS"></a>Add Enhancer to Store with TS</h3><p>When I use an enhancer like:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">const</span> enhancer = compose(</div><div class="line">  applyMiddleware(...middlewares),</div><div class="line">  DevTools.instrument(),</div><div class="line">  persistState(</div><div class="line">    <span class="hljs-built_in">window</span>.location.href.match(</div><div class="line">      <span class="hljs-regexp">/[?&amp;]debug_session=([^&amp;#]+)\b/</span></div><div class="line">    )</div><div class="line">  )</div><div class="line">)</div></pre></td></tr></table></figure>
<p>I got an error like:</p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[ts] Argument of <span class="hljs-built_in">type</span> <span class="hljs-string">'Function'</span> is not assignable to parameter of <span class="hljs-built_in">type</span> <span class="hljs-string">'Func3&lt;&#123;&#125;, &#123;&#125;, &#123;&#125;, &#123;&#125;, StoreEnhancerStoreCreator&lt;&#123;&#125;&gt;&gt;'</span>.</div><div class="line">Type <span class="hljs-string">'Function'</span> provides no match <span class="hljs-keyword">for</span> the signature <span class="hljs-string">'(a1: &#123;&#125;, a2: &#123;&#125;, a3: &#123;&#125;, ...args: any[]): &#123;&#125;'</span></div></pre></td></tr></table></figure>
<p>To resolve this, just:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">import</span> &#123; GenericStoreEnhancer &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'redux'</span></div><div class="line"><span class="hljs-keyword">const</span> enhancer = compose(</div><div class="line">  applyMiddleware(...middlewares),</div><div class="line">  DevTools.instrument <span class="hljs-keyword">as</span> GenericStoreEnhancer,</div><div class="line">  persistState(</div><div class="line">    <span class="hljs-built_in">window</span>.location.href.match(</div><div class="line">      <span class="hljs-regexp">/[?&amp;]debug_session=([^&amp;#]+)\b/</span></div><div class="line">    )</div><div class="line">  )</div><div class="line">)</div></pre></td></tr></table></figure>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-09-04T10:08:45.000Z">2017-09-04</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    a few seconds read (About 88 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/09/04/AsyncRoute-with-React-Router-v4/">AsyncRoute With React-Router-V4</a>
            
        </h1>
        <div class="content">
            <figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// AsyncRoute.jsx</span></div><div class="line"><span class="hljs-keyword">import</span> React, &#123; Component &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span></div><div class="line"></div><div class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Bundle</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> </span>&#123;</div><div class="line">  constructur () &#123;</div><div class="line">    <span class="hljs-keyword">super</span>()</div><div class="line">    <span class="hljs-keyword">this</span>.state = &#123;</div><div class="line">      <span class="hljs-attr">mod</span>: <span class="hljs-literal">null</span>,</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  componentWillMount () &#123;</div><div class="line">    <span class="hljs-keyword">this</span>.load(<span class="hljs-keyword">this</span>.props)</div><div class="line">  &#125;</div><div class="line">  componentWillReceiveProps (nextProps) &#123;</div><div class="line">    <span class="hljs-keyword">if</span> (nextProps.load !== <span class="hljs-keyword">this</span>.props.load) &#123;</div><div class="line">      <span class="hljs-keyword">this</span>.load(nextProps)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  load (props) &#123;</div><div class="line">    <span class="hljs-keyword">this</span>.setState(&#123;</div><div class="line">      <span class="hljs-attr">mod</span>: <span class="hljs-literal">null</span>,</div><div class="line">    &#125;)</div><div class="line">    props.load(<span class="hljs-function">(<span class="hljs-params">mod</span>) =&gt;</span> &#123;</div><div class="line">      <span class="hljs-keyword">this</span>.setState(&#123;</div><div class="line">        <span class="hljs-attr">mod</span>: mod.default || mod,</div><div class="line">      &#125;)</div><div class="line">    &#125;)</div><div class="line">  &#125;</div><div class="line">  render () &#123;</div><div class="line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.state.mod ? <span class="hljs-keyword">this</span>.props.children(<span class="hljs-keyword">this</span>.state.mod) : <span class="hljs-literal">null</span></div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-built_in">module</span> =&gt; <span class="hljs-function"><span class="hljs-params">routerProps</span> =&gt;</span> (&lt;Bundle load=&#123;module&#125;&gt;</div><div class="line">  &#123;Comp =&gt; Comp ? &lt;Comp &#123;...routerProps&#125; /&gt; : null&#125;</div><div class="line">&lt;/Bundle&gt;</div><div class="line">)</div></pre></td></tr></table></figure>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// Body.jsx</span></div><div class="line"><span class="hljs-keyword">import</span> &#123; Route &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router-dom'</span></div><div class="line"><span class="hljs-keyword">import</span> AsyncRoute <span class="hljs-keyword">from</span> <span class="hljs-string">'./AsyncRoute'</span></div><div class="line"><span class="hljs-keyword">import</span> Page <span class="hljs-keyword">from</span> <span class="hljs-string">'bundle-loader?lazy!./Page'</span></div><div class="line"></div><div class="line">&lt;Route component=&#123;AsyncRoute(Page)&#125; /&gt;</div></pre></td></tr></table></figure>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-09-04T02:55:34.000Z">2017-09-04</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    5 minutes read (About 700 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/09/04/note-of-sw-precache/">Note of Sw-Precache</a>
            
        </h1>
        <div class="content">
            <p>A node module to generate service worker code that will precaches specific resource so they work offline.</p>
<p>Serving your local static resources cache-first means that you can get all the crucial scaffolding for your web app – your app shell – on the screen  without having to wait for any network responses.</p>
<h3 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h3><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yarn add --dev sw-precache</div></pre></td></tr></table></figure>
<h3 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h3><ol>
<li><p>Make sure your site is served using HTTPS.</p>
</li>
<li><p>incorporate <code>sw-precache</code> into your <code>node</code>-based build script.</p>
</li>
<li><p>Register the service worker JavaScript.</p>
</li>
</ol>
<h3 id="Considerations"><a href="#Considerations" class="headerlink" title="Considerations"></a>Considerations</h3><ul>
<li><p>Service worker caching should be considered a prograssive enhancement. If you follow the model of conditionally registering a service worker only if it’s supported(determined by <code>if(&#39;serviceWorker&#39; in navigator)</code>), you’ll get offline support on browsers with service workers and on browsers that don’t support service workers, the offline-specific code will never be called.</p>
</li>
<li><p>All resources that are precached will be fetched by a service worker runing in a separate thread as soon as the service worker is installed. You should be judicious in what you list in the <code>dynamicUrlsToDependencies</code> and <code>staticFileGlobs</code> options, since listing files that are non-essential(large-images that are not shown on every page, for instance) will result in browsers downloading more data than is strictly necessary.</p>
</li>
<li><p>Precaching doesn’t make sense for all types of resource. Other caching strategies can be used in conjunction with <code>sw-precache</code> to provide the best experience for your users. If you do implement additional caching logic, put the code in a separate file and include it using the <code>importScripts()</code> method.</p>
</li>
<li><p><code>sw-precache</code> uses a <strong>cache-first</strong> strategy, which results in a copy of any cached content being returned without consulting the network.</p>
</li>
</ul>
<h3 id="Use-with-webpack"><a href="#Use-with-webpack" class="headerlink" title="Use with webpack"></a>Use with webpack</h3><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yarn add --dev sw-precache-webpack-plugin</div></pre></td></tr></table></figure>
<h4 id="Basic-Usage"><a href="#Basic-Usage" class="headerlink" title="Basic Usage"></a>Basic Usage</h4><p>A simple configuration example that will work well in most production environments.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>)</div><div class="line"><span class="hljs-keyword">const</span> SWPrecachePlugin = <span class="hljs-built_in">require</span>(<span class="hljs-string">'sw-precache-webpack-plugin'</span>)</div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> PUBLIC_PATH = <span class="hljs-string">'https://www.my-project-name.com/'</span></div><div class="line"></div><div class="line"><span class="hljs-built_in">module</span>.exporst = &#123;</div><div class="line">  <span class="hljs-attr">entry</span>: &#123;</div><div class="line">    <span class="hljs-attr">main</span>: path.resolve(__dirname, <span class="hljs-string">'src/index'</span>)</div><div class="line">  &#125;,</div><div class="line">  <span class="hljs-attr">output</span>: &#123;</div><div class="line">    <span class="hljs-attr">path</span>: path.resolve(__dirname, <span class="hljs-string">'src/bundles/'</span>),</div><div class="line">    <span class="hljs-attr">filename</span>: <span class="hljs-string">'[name]-[hash].js'</span>,</div><div class="line">    <span class="hljs-attr">publicPath</span>: PUBLIC_PATH,</div><div class="line">  &#125;,</div><div class="line">  <span class="hljs-attr">plugins</span>: [</div><div class="line">    <span class="hljs-keyword">new</span> SWPrecachePlugin(&#123;</div><div class="line">      <span class="hljs-attr">cacheId</span>: <span class="hljs-string">'my-project-name'</span>,</div><div class="line">      <span class="hljs-attr">dontCacheBustUrlsMatching</span>: <span class="hljs-regexp">/\.\w&#123;8&#125;\./</span>,</div><div class="line">      <span class="hljs-attr">filename</span>: <span class="hljs-string">'service-worker.js'</span>,</div><div class="line">      <span class="hljs-attr">minify</span>: <span class="hljs-literal">true</span>,</div><div class="line">      <span class="hljs-attr">navigateFallback</span>: PUBLIC_PATH + <span class="hljs-string">'index.html'</span>,</div><div class="line">      <span class="hljs-attr">staticFileGlobsIgnorePatterns</span>: [</div><div class="line">        <span class="hljs-regexp">/\.map$/</span>,</div><div class="line">        /asset-manifest\.json$/,</div><div class="line">      ]</div><div class="line">    &#125;)</div><div class="line">  ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>This will generate a new service worker at <code>src/bundles/service-worker.js</code>, then you would register it in your application:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;</div><div class="line">  <span class="hljs-keyword">if</span> (<span class="hljs-string">'serviceWorker'</span> <span class="hljs-keyword">in</span> navigator) &#123;</div><div class="line">    navigator.serviceWorker.register(<span class="hljs-string">'./service-worker.js'</span>)</div><div class="line">  &#125;</div><div class="line">&#125;)()</div></pre></td></tr></table></figure>
<h4 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h4><ul>
<li><p>filename: string - service worker filename, default is <code>service-worker.js</code></p>
</li>
<li><p>filepath: string - service worker path and name, default is to use <code>webpack.output.path</code> + <code>options.filename</code>. This will override <code>filename</code>.</p>
</li>
<li><p>staticFileGlobsIngorePatters: [Regexp] - Define an optional array of regex patterns to filter out of staticFileGlobs.</p>
</li>
<li><p>mergeStaticsConfig: [boolean] - Merge provided staticFileGlobs and stripPrefixMulti with webpack’s config, rather than having those take precedence, default is false.</p>
</li>
<li><p>minify: [boolean] - Set to true to minify and uglify the generated service-worker, default is false.</p>
</li>
<li><p>cacheId: [string] - Not required but you should include this, it will give your service worker cache a unique name, default to <code>sw-precache-webpack-plugin</code>.</p>
</li>
<li><p>importScripts: [Array<string|object>]</string|object></p>
<ul>
<li><p>when importScripts array item is a string, converts to object format: <code>{ filename: &#39;&lt;publicPath&gt;/my-scripts.js&#39;}</code></p>
</li>
<li><p>when importScripts array item is an Object</p>
<ul>
<li><p>look for <code>chunkName</code> property</p>
</li>
<li><p>look for <code>filename</code> property</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>replacePrefix: [String] - should only be used in conjunction with <code>stripPrefix</code></p>
</li>
<li><p>staticFileGlobs: [Array<string>] - Omit this to allow the plugin to cache all your bundles’ emitted assets. If <code>mergeStaticsConfig=true</code>: this value will be merged with your bundles’ emitted assets, otherwise this value is just passed to <code>sw-precache</code> and emitted assets won’t be included.</string></p>
</li>
<li><p>stripPrefix: [String] - Same as stripPrefixMulti[stripPrefix] = ‘’</p>
</li>
<li><p>stripPrefixMulti: [Object<string,string>] - Omit this to use your webpack config’s <code>output.path</code> + <code>/</code>: <code>output.publicPath</code>.</string,string></p>
</li>
</ul>
<blockquote>
<p>Note taht all configuration options are optional. <code>SWPrecacheWebpackPlugin</code> will by default use all your assets emitted by webpack’s compiler for the <code>staticFileGlobs</code> parameter and your webpack config’s <code>{[output.path + &#39;/&#39;]: output.publicPath}</code> as the stripPrefixMulti parameter. This behavior is probably what you want, all your webpack assets will be cached by your generated service worker. Just don’t pass any arguments when you initialize this plugin, and let this plugin handle generating your <code>sw-precache</code> configuration.</p>
</blockquote>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">plugins: [</div><div class="line">  <span class="hljs-keyword">new</span> SWPrecacheWebpackPlugin(),</div><div class="line">]</div></pre></td></tr></table></figure>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-09-03T15:42:25.000Z">2017-09-03</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    a minute read (About 212 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/09/03/service-worker-with-webpack/">Service-Worker With Webpack</a>
            
        </h1>
        <div class="content">
            <figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yarn add --dev sw-precache-webpack-plugin</div></pre></td></tr></table></figure>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// webpack</span></div><div class="line"><span class="hljs-keyword">new</span> SWPrecachePlugin(&#123;</div><div class="line">  <span class="hljs-attr">cacheId</span>: <span class="hljs-string">'demo'</span>,</div><div class="line">  <span class="hljs-attr">filename</span>: <span class="hljs-string">'service-worker.js'</span>,</div><div class="line">  <span class="hljs-attr">dontCacheBustUrlsMatching</span>: <span class="hljs-literal">false</span>,</div><div class="line">  <span class="hljs-attr">staticFileGlobsIgnorePatterns</span>: [</div><div class="line">    <span class="hljs-regexp">/index\.html$/</span>,</div><div class="line">    /\.map$/,</div><div class="line">    /\.css$/,</div><div class="line">    /\.svg$/,</div><div class="line">    /\.eot$/,</div><div class="line">  ]</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>This will generate <code>service-worker.js</code> in dist.</p>
<h3 id="Add-Router"><a href="#Add-Router" class="headerlink" title="Add Router"></a>Add Router</h3><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">app.use(<span class="hljs-string">'/service-worker.js'</span>, serve(<span class="hljs-string">'./dist/service-worker.js'</span>))</div></pre></td></tr></table></figure>
<blockquote>
<p>Note: <code>[name].[ext]?[hash]</code> will not be found by sw-precache(hash will be ignored), so filename should be specified like <code>[name].[hash].[ext]</code> or so.</p>
</blockquote>
<h3 id="Cache-files-who-are-not-bundled-by-webpack"><a href="#Cache-files-who-are-not-bundled-by-webpack" class="headerlink" title="Cache files who are not bundled by webpack."></a>Cache files who are not bundled by webpack.</h3><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">new</span> SWPrecachePlugin(&#123;</div><div class="line">  <span class="hljs-attr">cacheId</span>: <span class="hljs-string">'demo'</span>,</div><div class="line">  <span class="hljs-attr">filename</span>: <span class="hljs-string">'service-worker.js'</span>,</div><div class="line">  <span class="hljs-attr">minify</span>: <span class="hljs-literal">true</span>,</div><div class="line">  <span class="hljs-comment">// add two lines</span></div><div class="line">  mergeStaticConfig: <span class="hljs-literal">true</span>,</div><div class="line">  <span class="hljs-attr">staticFileBlogs</span>: [</div><div class="line">    path.join(__dirname, <span class="hljs-string">'../dist/static/*.*'</span>),</div><div class="line">  ],</div><div class="line">  <span class="hljs-attr">dontCacheBustUrlsMatching</span>: <span class="hljs-literal">false</span>,</div><div class="line">  <span class="hljs-attr">staticFileGlobsIgnorePatterns</span>: [</div><div class="line">    <span class="hljs-regexp">/\.index\.html$/</span>,</div><div class="line">    /\.map$/,</div><div class="line">    /\.css$/,</div><div class="line">    /\.svg$/,</div><div class="line">    /\.eot$/,</div><div class="line">  ]</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="About-the-Request-URL"><a href="#About-the-Request-URL" class="headerlink" title="About the Request URL"></a>About the Request URL</h3><p>The images are cached in <code>/dist/static/*</code>, while the request url is <code>/static/*</code>.</p>
<p>In dev it can be proxied by webpack.</p>
<p>In prod it can be delegated by nginx.</p>
<p>But the plugin can fix it by itself:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">new</span> SWPrecachePlugin(&#123;</div><div class="line">  <span class="hljs-attr">cacheId</span>: <span class="hljs-string">'demo'</span>,</div><div class="line">  <span class="hljs-attr">filename</span>: <span class="hljs-string">'service-worker.js'</span>,</div><div class="line">  <span class="hljs-attr">minify</span>: <span class="hljs-literal">true</span>,</div><div class="line">  <span class="hljs-attr">mergeStaticConfig</span>: <span class="hljs-literal">true</span>,</div><div class="line">  <span class="hljs-attr">staticFileGlobs</span>: [</div><div class="line">    path.join(__dirname, <span class="hljs-string">'../dist/static/*.*'</span>)</div><div class="line">  ],</div><div class="line">  <span class="hljs-attr">stripPrefixMulti</span>: &#123;</div><div class="line">    [path.join(__dirname, <span class="hljs-string">'../dist/static'</span>)]: <span class="hljs-string">'/static'</span></div><div class="line">  &#125;,</div><div class="line">  <span class="hljs-attr">dontCacheBustUrlsMatching</span>: <span class="hljs-literal">false</span>,</div><div class="line">  <span class="hljs-attr">staticFileGlobsIgnorePatterns</span>: [</div><div class="line">    <span class="hljs-regexp">/\.index\.html$/</span>,</div><div class="line">    /\.map$/,</div><div class="line">    /\.css$/,</div><div class="line">    /\.svg$/,</div><div class="line">    /\.eot$/,</div><div class="line">  ]</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<blockquote>
<p>Note: <code>dontCacheBustUrlsMatching: false</code> will set cached key as <code>http://domain/path/to/filename?hash</code>, whose hash will change if the bundled file changed.</p>
</blockquote>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-09-03T15:01:35.000Z">2017-09-03</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    a minute read (About 193 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/09/03/snippets-of-Nginx/">Snippets of Nginx</a>
            
        </h1>
        <div class="content">
            <h3 id="nginx-conf"><a href="#nginx-conf" class="headerlink" title="nginx.conf"></a>nginx.conf</h3><p>One <code>server{}</code> for a site service.</p>
<p>Use <code>location</code> to specify router of requests.</p>
<p><code>proxy_pass target</code> to delegate inverse .</p>
<p><code>root dir</code> to specify static files directory.</p>
<p><code>server_name</code> to set domains whose requests will be handled.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// a node server listening to 3000</span></div><div class="line"><span class="hljs-comment">// handle requests from example.com</span></div><div class="line"></div><div class="line">server &#123;</div><div class="line">  <span class="hljs-attr">listen</span>: <span class="hljs-number">80</span>;</div><div class="line">  server_name: example.com;</div><div class="line">    location / &#123;</div><div class="line">      index index.html;</div><div class="line">      root: <span class="hljs-regexp">/public/</span>;</div><div class="line">      proxy_pass http:<span class="hljs-comment">//location:3000</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Gzip"><a href="#Gzip" class="headerlink" title="Gzip"></a>Gzip</h3><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">gzip on;</div><div class="line">gzip_proxied any;</div><div class="line">gzip_min_length 1024;</div><div class="line">gzip_buffers 4 8k;</div><div class="line">gzip_types text/css application/javascript application/atom+xml application/rss+xml text/plain image/svg+xml application/json text/javascript;</div></pre></td></tr></table></figure>
<h3 id="CORS"><a href="#CORS" class="headerlink" title="CORS"></a>CORS</h3><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line">  <span class="hljs-attr">listen</span>: <span class="hljs-number">80</span>;</div><div class="line">  server_name: example.com;</div><div class="line"></div><div class="line">  location / &#123;</div><div class="line">    add_header Access-Control-Allow-Origin: *;</div><div class="line">    add_header Access-Control_Allow_Credentials <span class="hljs-literal">true</span>;</div><div class="line">    add_header Access-Control-AllowMethods GET,POST,OPTIONS;</div><div class="line">    index index.html;</div><div class="line">    root: <span class="hljs-regexp">/public/</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="API-delegate"><a href="#API-delegate" class="headerlink" title="API delegate"></a>API delegate</h3><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line">  <span class="hljs-attr">listen</span>: <span class="hljs-number">80</span>;</div><div class="line">  server_name: example.com;</div><div class="line"></div><div class="line">  location /api &#123;</div><div class="line">    <span class="hljs-attr">proxy_pass</span>: https:<span class="hljs-comment">//localhost:3000;</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="HTTP-to-HTTPS"><a href="#HTTP-to-HTTPS" class="headerlink" title="HTTP to HTTPS"></a>HTTP to HTTPS</h3><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line">  <span class="hljs-attr">listen</span>: <span class="hljs-number">80</span>;</div><div class="line">  server_name: example.com, *.example.com;</div><div class="line"></div><div class="line">  location / &#123;</div><div class="line">    <span class="hljs-keyword">return</span> <span class="hljs-number">301</span> https:<span class="hljs-comment">//$host$request_uri;</span></div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">server &#123;</div><div class="line">  <span class="hljs-attr">listen</span>: <span class="hljs-number">443</span> ssl;</div><div class="line">  server_name example.com;</div><div class="line">  ssl_certificate /crts/crt.pem; <span class="hljs-comment">// add the certificate</span></div><div class="line">  ssl_certificate_key /crts/key.pem</div><div class="line">    location / &#123;</div><div class="line">      index index.html;</div><div class="line">      root: <span class="hljs-regexp">/public/</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-31T01:43:20.000Z">2017-08-31</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    8 minutes read (About 1263 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/31/Manipulate-Data-in-D3/">Manipulate Data in D3</a>
            
        </h1>
        <div class="content">
            <h3 id="Use-data-imported-from-a-csv-file-with-spaces-in-the-header"><a href="#Use-data-imported-from-a-csv-file-with-spaces-in-the-header" class="headerlink" title="Use data imported from a csv file with spaces in the header"></a>Use data imported from a csv file with spaces in the header</h3><p>When importing data from a csv file(dataSpace.csv) that has headers with spaces in the middle of some of the fields there is need to address the data slightly differently in order for it to be used easily in your JavaScript.</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Date Purchased,close</div><div class="line">1-May-12,58.13</div></pre></td></tr></table></figure>
<p>When we go to import the data using the d3.csv function, we need to reference the <code>Data Purchased</code> column in a way that makes allowances for the space. The following piece of script appears to be the most basic solution.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">d3.csv(<span class="hljs-string">'dataSpace.csv'</span>, (err, data) =&gt; &#123;</div><div class="line">  <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;</div><div class="line">  data.forEach(<span class="hljs-function"><span class="hljs-params">d</span> =&gt;</span> &#123;</div><div class="line">    d.date = parseTime(d[<span class="hljs-string">'Date Purchased'</span>])</div><div class="line">  &#125;)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="Histogram"><a href="#Histogram" class="headerlink" title="Histogram"></a>Histogram</h3><p>The <code>d3.histogram</code> function allows us to form our data into ‘bins’ that form <em>‘discrete samples into continous, non-overlapping intervals’</em>.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// dtg,value</span></div><div class="line"><span class="hljs-comment">// 01-08-2010,3</span></div><div class="line"><span class="hljs-comment">// 01-08-2010,3</span></div><div class="line"><span class="hljs-comment">// 01-08-2010,3</span></div><div class="line"><span class="hljs-comment">// 01-08-2010,3</span></div><div class="line"><span class="hljs-comment">// 01-08-2010,3.1</span></div><div class="line"><span class="hljs-comment">// 01-08-2010,3.2</span></div><div class="line"><span class="hljs-comment">// 01-08-2010,3.2</span></div><div class="line"><span class="hljs-comment">// .</span></div><div class="line"><span class="hljs-comment">// .</span></div><div class="line"><span class="hljs-comment">// .</span></div><div class="line"><span class="hljs-comment">// 31-12-2011,3.2</span></div><div class="line"><span class="hljs-comment">// 31-12-2011,3.3</span></div><div class="line"><span class="hljs-comment">// 31-12-2011,3.4</span></div><div class="line"><span class="hljs-comment">// 31-12-2011,3.5</span></div><div class="line"><span class="hljs-comment">// 31-12-2011,3.5</span></div><div class="line"><span class="hljs-comment">// 31-12-2011,4.1</span></div><div class="line"><span class="hljs-comment">// 31-12-2011,4.9</span></div><div class="line"></div><div class="line"><span class="hljs-comment">// core code</span></div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> parseDate = d3.timeParser(<span class="hljs-string">'%d-%m-%Y'</span>)</div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> xScale = d3.scaleTime()</div><div class="line">    .domain([<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-number">2010</span>, <span class="hljs-number">6</span>, <span class="hljs-number">3</span>), <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-number">2012</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>)])</div><div class="line">    .rangeRound([, width])</div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> yScale = d3.scaleLinear()</div><div class="line">    .range([height, <span class="hljs-number">0</span>])</div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> histogram = h3.histogram()</div><div class="line">    .value(<span class="hljs-function"><span class="hljs-params">d</span> =&gt;</span> d.date)</div><div class="line">    .domain(xScale.domain())</div><div class="line">    .thresholds(x.ticks.timeMonth)</div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> _data = data.map(<span class="hljs-function"><span class="hljs-params">d</span> =&gt;</span> (&#123;</div><div class="line">  <span class="hljs-attr">date</span>: parseDate(d.dtg),</div><div class="line">  <span class="hljs-attr">value</span>: d.value,</div><div class="line">&#125;))</div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> bins = histogram(_data)</div><div class="line"></div><div class="line">holder.selectAll(<span class="hljs-string">'rect'</span>)</div><div class="line">    .data(bins)</div><div class="line">  .enter().append(<span class="hljs-string">'rect'</span>)</div><div class="line">    .attr(<span class="hljs-string">'class'</span>, <span class="hljs-string">'bar'</span>)</div><div class="line">    .attr(<span class="hljs-string">'x'</span>, <span class="hljs-number">1</span>)</div><div class="line">    .attr(<span class="hljs-string">'transform'</span>, d =&gt; <span class="hljs-string">`translate(<span class="hljs-subst">$&#123;xScale(d.x0)&#125;</span>, <span class="hljs-subst">$&#123;yScale(d.length)&#125;</span>)`</span>)</div><div class="line">    .attr(<span class="hljs-string">'width'</span>, d =&gt; (xScale(d.x1 - d.x0) - <span class="hljs-number">1</span>))</div><div class="line">    .attr(<span class="hljs-string">'height'</span>, d =&gt; (height - yScale(d.length)))</div></pre></td></tr></table></figure>
<p>The key line</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">const</span> bins = histogram(_data)</div></pre></td></tr></table></figure>
<p>groups the data for the bars.</p>
<h3 id="Tree-Diagram"><a href="#Tree-Diagram" class="headerlink" title="Tree Diagram"></a>Tree Diagram</h3><p>The data requied to produce this type of layout needs to describe the relationships, but this is not necessary an onerous task.</p>
<figure class="highlight json hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Top Node"</span>,</div><div class="line">    <span class="hljs-attr">"children"</span>: [</div><div class="line">      &#123;</div><div class="line">        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Bob: Child of Top Node"</span>,</div><div class="line">        <span class="hljs-attr">"children"</span>: [</div><div class="line">          &#123;</div><div class="line">            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Son of Bob"</span></div><div class="line">          &#125;,</div><div class="line">          &#123;</div><div class="line">            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Daughter of Bob"</span></div><div class="line">          &#125;</div><div class="line">        ]</div><div class="line">      &#125;,</div><div class="line">      &#123;</div><div class="line">        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Sally: Child of Top Node"</span></div><div class="line">      &#125;</div><div class="line">    ]</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// core code</span></div><div class="line"><span class="hljs-keyword">const</span> treeData = &#123;</div><div class="line">  <span class="hljs-string">"name"</span>: <span class="hljs-string">"Top Level"</span>,</div><div class="line">  <span class="hljs-string">"children"</span>: [</div><div class="line">    &#123;</div><div class="line">      <span class="hljs-string">"name"</span>: <span class="hljs-string">"Level 2: A"</span>,</div><div class="line">      <span class="hljs-string">"children"</span>: [</div><div class="line">        &#123; <span class="hljs-string">"name"</span>: <span class="hljs-string">"Son of A"</span> &#125;,</div><div class="line">        &#123; <span class="hljs-string">"name"</span>: <span class="hljs-string">"Daughter of A"</span> &#125;</div><div class="line">      ]</div><div class="line">    &#125;,</div><div class="line">    &#123; <span class="hljs-string">"name"</span>, <span class="hljs-string">"Leve 2: B"</span>&#125;</div><div class="line">  ]</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> margin = &#123;</div><div class="line">  <span class="hljs-attr">top</span>: <span class="hljs-number">40</span>,</div><div class="line">  <span class="hljs-attr">right</span>: <span class="hljs-number">30</span>,</div><div class="line">  <span class="hljs-attr">bottom</span>: <span class="hljs-number">50</span>,</div><div class="line">  <span class="hljs-attr">left</span>: <span class="hljs-number">30</span>,</div><div class="line">&#125;</div><div class="line"><span class="hljs-keyword">const</span> width = <span class="hljs-number">660</span> - margin.left - margin.right</div><div class="line"><span class="hljs-keyword">const</span> height = <span class="hljs-number">500</span> - margin.top - margin.bottom</div><div class="line"></div><div class="line"><span class="hljs-comment">// declare a tree layout and assigns the size</span></div><div class="line"><span class="hljs-keyword">const</span> treemap = d3.tree()</div><div class="line">    .size([width, height])</div><div class="line"></div><div class="line"><span class="hljs-comment">// assigns the node data to the tree layout</span></div><div class="line"><span class="hljs-keyword">let</span> nodes = d3.hierarchy(treeData)</div><div class="line"></div><div class="line"><span class="hljs-comment">// map the node data to the tree layout</span></div><div class="line">nodes = treemap(nodes)</div><div class="line"></div><div class="line"><span class="hljs-comment">// append the svg object to the body of the page</span></div><div class="line"><span class="hljs-comment">// append a 'group' element to 'svg'</span></div><div class="line"><span class="hljs-comment">// move the 'groupd' element to the top left margin</span></div><div class="line"><span class="hljs-keyword">const</span> svg = d3.select(<span class="hljs-string">'body'</span>).append(<span class="hljs-string">'svg'</span>)</div><div class="line">    .attr(<span class="hljs-string">'width'</span>, width + margin.left + margin.right)</div><div class="line">    .attr(<span class="hljs-string">'height'</span>, height + margin.top + margin.bottom)</div><div class="line"><span class="hljs-keyword">const</span> g = svg.append(<span class="hljs-string">'g'</span>)</div><div class="line">    .attr(<span class="hljs-string">'transform'</span>, <span class="hljs-string">`translate(<span class="hljs-subst">$&#123;margin.left&#125;</span>, <span class="hljs-subst">$&#123;margin.top&#125;</span>)`</span>)</div><div class="line"></div><div class="line"><span class="hljs-comment">// add links between nodes</span></div><div class="line"><span class="hljs-keyword">const</span> link = g.selectAll(<span class="hljs-string">'.link'</span>)</div><div class="line">    .data(nodes.descendants().slice(<span class="hljs-number">1</span>))</div><div class="line">  .enter().append(<span class="hljs-string">'path'</span>)</div><div class="line">    .attr(<span class="hljs-string">'class'</span>, <span class="hljs-string">'link'</span>)</div><div class="line">    .attr(<span class="hljs-string">'d'</span>, d =&gt; &#123;</div><div class="line">      <span class="hljs-keyword">return</span> <span class="hljs-string">`M<span class="hljs-subst">$&#123;d.x&#125;</span>,<span class="hljs-subst">$&#123;d.y&#125;</span>C<span class="hljs-subst">$&#123;d.x&#125;</span>,<span class="hljs-subst">$&#123;(d.y + d.parent.y) <span class="hljs-regexp">/ 2&#125; $&#123;d.parent.x&#125;,$&#123;(d.y + d.parent.y) /</span> <span class="hljs-number">2</span>&#125;</span> <span class="hljs-subst">$&#123;d.parent.x&#125;</span>,<span class="hljs-subst">$&#123;d.parent.y&#125;</span>`</span></div><div class="line">    &#125;)</div><div class="line"></div><div class="line"><span class="hljs-comment">// add each node as a group</span></div><div class="line"><span class="hljs-keyword">const</span> node = g.selectAll(<span class="hljs-string">'.node'</span>)</div><div class="line">    .data(nodes.descendants())</div><div class="line">  .enter().append(<span class="hljs-string">'circle'</span>)</div><div class="line">    .attr(<span class="hljs-string">'class'</span>, d =&gt; &#123;</div><div class="line">      <span class="hljs-keyword">return</span> <span class="hljs-string">`node <span class="hljs-subst">$&#123;d.children ? <span class="hljs-string">'node--internal'</span> : <span class="hljs-string">'node--leaf'</span>&#125;</span>`</span></div><div class="line">    &#125;)</div><div class="line">    .attr(<span class="hljs-string">'transform'</span>, d =&gt; &#123;</div><div class="line">      <span class="hljs-string">`translate(<span class="hljs-subst">$&#123;d.x&#125;</span>, <span class="hljs-subst">$&#123;d.y&#125;</span>)`</span></div><div class="line">    &#125;)</div><div class="line"></div><div class="line"><span class="hljs-comment">// add the circle to node</span></div><div class="line">node.append(<span class="hljs-string">'circle'</span>)</div><div class="line">    .attr(<span class="hljs-string">'r'</span>, <span class="hljs-number">10</span>)</div><div class="line"></div><div class="line"><span class="hljs-comment">// add the text to the node</span></div><div class="line">node.append(<span class="hljs-string">'text'</span>)</div><div class="line">    .attr(<span class="hljs-string">'dy'</span>, <span class="hljs-string">'0.35em'</span>)</div><div class="line">    .attr(<span class="hljs-string">'y'</span>, d =&gt; (d.children ? <span class="hljs-number">-20</span> : <span class="hljs-number">20</span>))</div><div class="line">    .style(<span class="hljs-string">'text-anchor'</span>, <span class="hljs-string">'middle'</span>)</div><div class="line">    .text(<span class="hljs-function"><span class="hljs-params">d</span> =&gt;</span> d.data.name)</div></pre></td></tr></table></figure>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// declare a tree layout and assign the size</span></div><div class="line"><span class="hljs-keyword">const</span> treemap = d3.tree()</div><div class="line">    .size([width, height])</div><div class="line"></div><div class="line"><span class="hljs-comment">// assign the data to a hierarchy using parent-child relationships</span></div><div class="line"><span class="hljs-keyword">let</span> nodes = d3.hierarchy(treeData)</div><div class="line"></div><div class="line"><span class="hljs-comment">// maps the node data to the tree layout</span></div><div class="line">nodes = treemap(nodes)</div></pre></td></tr></table></figure>
<h5 id="d3-hierarchy"><a href="#d3-hierarchy" class="headerlink" title="d3.hierarchy"></a>d3.hierarchy</h5><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">const</span> nodes = d3.hierarchy(treeData, d =&gt; d.children)</div></pre></td></tr></table></figure>
<p>This assigns a range of properties to each node including:</p>
<ul>
<li><p><code>node.data</code> - the data assocaited with the node(in our case it will include the name accessible as <code>node.data.name</code>).</p>
</li>
<li><p><code>node.depth</code> - a representation of the depth or number of hops from the initial root node.</p>
</li>
<li><p><code>node.height</code> - the greatest distance from any descendants leaf nodes.</p>
</li>
<li><p><code>node.parent</code> - the parent node, or null if it’s the root node.</p>
</li>
<li><p><code>node.children</code> - child nodes or undefined for any leaf nodes.</p>
</li>
</ul>
<p>Above is the vertical tree map code.</p>
<p>If you want a horizontal tree map, you can make a transform like this.</p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/htree-02.png" alt=""></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/htree-03.png" alt=""></p>
<p>Or</p>
<figure class="highlight hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">.attr('d', d =&gt; &#123;</div><div class="line">  return `</div><div class="line">  M$&#123;d.y&#125;,$&#123;d.x&#125;</div><div class="line">  C$&#123;(d.y + d.parent.y)/2&#125;,$&#123;d.x&#125;</div><div class="line">  $&#123;(d.y + d.parent.y)/2&#125;,$&#123;d.parent.x&#125;</div><div class="line">  $&#123;d.parent.y&#125;,$&#123;d.parent.x&#125;</div><div class="line">  `</div><div class="line">&#125;)</div><div class="line"></div><div class="line">.attr('transform', d =&gt; `translate($&#123;d.y&#125;, $&#123;d.x&#125;)`)</div></pre></td></tr></table></figure>
<p>Add Images as Node</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">node.append(<span class="hljs-string">'image'</span>)</div><div class="line">    .attr(<span class="hljs-string">'xlink:href'</span>, d =&gt; d.data.icon)</div><div class="line">    .attr(<span class="hljs-string">'x'</span>, <span class="hljs-string">'-12px'</span>)</div><div class="line">    .attr(<span class="hljs-string">'y'</span>, <span class="hljs-string">'-12px'</span>)</div><div class="line">    .attr(<span class="hljs-string">'width'</span>, <span class="hljs-string">'24px'</span>)</div><div class="line">    .attr(<span class="hljs-string">'height'</span>, <span class="hljs-string">'24px'</span>)</div></pre></td></tr></table></figure>
<p>Add Interaction on Node</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">click</span> (<span class="hljs-params">d</span>) </span>&#123;</div><div class="line">  <span class="hljs-keyword">if</span> (d.children) &#123;</div><div class="line">    d._children = d.children</div><div class="line">    d.chilren = <span class="hljs-literal">null</span></div><div class="line">  &#125; <span class="hljs-keyword">else</span> &#123;</div><div class="line">    d.children = d._children</div><div class="line">    d._children = <span class="hljs-literal">null</span></div><div class="line">  &#125;</div><div class="line">  upate(d)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Sankey-Diagrams"><a href="#Sankey-Diagrams" class="headerlink" title="Sankey Diagrams"></a>Sankey Diagrams</h3><p>// Todo</p>
<h3 id="Assorted-Tips-and-Tricks"><a href="#Assorted-Tips-and-Tricks" class="headerlink" title="Assorted Tips and Tricks"></a>Assorted Tips and Tricks</h3><h4 id="Events"><a href="#Events" class="headerlink" title="Events"></a>Events</h4><ul>
<li><p><code>mousedown</code></p>
</li>
<li><p><code>mouseup</code></p>
</li>
<li><p><code>mouseover</code></p>
</li>
<li><p><code>mouseout</code></p>
</li>
<li><p><code>mousemove</code></p>
</li>
<li><p><code>click</code></p>
</li>
<li><p><code>contextmenu</code></p>
</li>
<li><p><code>dblclick</code></p>
</li>
</ul>
<h4 id="Add-Tooltips"><a href="#Add-Tooltips" class="headerlink" title="Add Tooltips"></a>Add Tooltips</h4><p>Tooltips have a marvellous duality. They are on one hand a pretty darned useful thing that aids in giving context and information where required and on the other hand, if done with a bit of care they can look stylish.</p>
<figure class="highlight css hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-selector-tag">div</span><span class="hljs-selector-class">.tooltip</span> &#123;</div><div class="line">  <span class="hljs-attribute">position</span>: absolute;</div><div class="line">  <span class="hljs-attribute">text-align</span>: center;</div><div class="line">  <span class="hljs-attribute">width</span>: <span class="hljs-number">60px</span>;</div><div class="line">  <span class="hljs-attribute">height</span>: <span class="hljs-number">28px</span>;</div><div class="line">  <span class="hljs-attribute">padding</span>: <span class="hljs-number">2px</span>;</div><div class="line">  <span class="hljs-attribute">font</span>: <span class="hljs-number">12px</span> sans-serif;</div><div class="line">  <span class="hljs-attribute">background</span>: lightsteelblue;</div><div class="line">  <span class="hljs-attribute">border</span>: <span class="hljs-number">0px</span>;</div><div class="line">  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;</div><div class="line">  <span class="hljs-attribute">pointer-events</span>: none;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">const</span> div = d3.select(<span class="hljs-string">'body'</span>).append(<span class="hljs-string">'div'</span>).attr(<span class="hljs-string">'class'</span>, <span class="hljs-string">'tooltip'</span>)</div><div class="line">.style(<span class="hljs-string">'opacity'</span>, <span class="hljs-number">0</span>)</div><div class="line"></div><div class="line">svg.selectAll(<span class="hljs-string">"circle"</span>)</div><div class="line">   .data(data)</div><div class="line"> .enter().append(<span class="hljs-string">"circle"</span>)</div><div class="line">   .attr(<span class="hljs-string">"r"</span>, <span class="hljs-number">5</span>)</div><div class="line">   .attr(<span class="hljs-string">"cx"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) </span>&#123; <span class="hljs-keyword">return</span> x(d.date); &#125;)</div><div class="line">   .attr(<span class="hljs-string">"cy"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) </span>&#123; <span class="hljs-keyword">return</span> y(d.close); &#125;)</div><div class="line">   .on(<span class="hljs-string">"mouseover"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) </span>&#123;</div><div class="line">     div.transition()</div><div class="line">       .duration(<span class="hljs-number">200</span>)</div><div class="line">       .style(<span class="hljs-string">"opacity"</span>, <span class="hljs-number">.9</span>);</div><div class="line">     div.html(formatTime(d.date) + <span class="hljs-string">"&lt;br/&gt;"</span> + d.close)</div><div class="line">       .style(<span class="hljs-string">"left"</span>, (d3.event.pageX) + <span class="hljs-string">"px"</span>)</div><div class="line">       .style(<span class="hljs-string">"top"</span>, (d3.event.pageY - <span class="hljs-number">28</span>) + <span class="hljs-string">"px"</span>);</div><div class="line">     &#125;)</div><div class="line">   .on(<span class="hljs-string">"mouseout"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) </span>&#123;</div><div class="line">     div.transition()</div><div class="line">       .duration(<span class="hljs-number">500</span>)</div><div class="line">       .style(<span class="hljs-string">"opacity"</span>, <span class="hljs-number">0</span>);</div><div class="line">     &#125;)</div></pre></td></tr></table></figure>
<p>Notice there is only one tooltip exist in the page.</p>
<h3 id="Selecting-Filtering-a-subset-of-objects"><a href="#Selecting-Filtering-a-subset-of-objects" class="headerlink" title="Selecting/Filtering a subset of objects"></a>Selecting/Filtering a subset of objects</h3><p>Filtering is fairly simple.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">svg.selectAll(<span class="hljs-string">'circle'</span>)</div><div class="line">    .data(data)</div><div class="line">  .enter().append(<span class="hljs-string">'circle'</span>)</div><div class="line">    .filter(<span class="hljs-function"><span class="hljs-params">d</span> =&gt;</span> d.close &lt; <span class="hljs-number">400</span>)</div><div class="line">    .style(<span class="hljs-string">'fill'</span>, <span class="hljs-string">'red'</span>)</div><div class="line">    .attr(<span class="hljs-string">'r'</span>, <span class="hljs-number">5</span>)</div><div class="line">    .attr(<span class="hljs-string">'cx'</span>, d =&gt; xScale(d.date))</div><div class="line">    .attr(<span class="hljs-string">'cy'</span>, d =&gt; yScale(d.close))</div></pre></td></tr></table></figure>
<h4 id="Select-Items-with-an-IF-statement"><a href="#Select-Items-with-an-IF-statement" class="headerlink" title="Select Items with an IF statement"></a>Select Items with an IF statement</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">.style(<span class="hljs-string">"fill"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) </span>&#123;   </div><div class="line">  <span class="hljs-keyword">if</span> (d.close &lt;= <span class="hljs-number">400</span>) &#123;<span class="hljs-keyword">return</span> <span class="hljs-string">"red"</span>&#125;  </div><div class="line">  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (d.close &gt;= <span class="hljs-number">620</span>) &#123;<span class="hljs-keyword">return</span> <span class="hljs-string">"lawngreen"</span>&#125; <span class="hljs-comment">// &lt;== Right here</span></div><div class="line">  <span class="hljs-keyword">else</span> &#123; <span class="hljs-keyword">return</span> <span class="hljs-string">"black"</span> &#125;  </div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h4 id="Applying-a-color-gradient-to-a-line-based-on-value"><a href="#Applying-a-color-gradient-to-a-line-based-on-value" class="headerlink" title="Applying a color gradient to a line based on value"></a>Applying a color gradient to a line based on value</h4><figure class="highlight css hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-selector-class">.line</span> &#123;</div><div class="line">  <span class="hljs-attribute">fill</span>: none;</div><div class="line">  <span class="hljs-attribute">stroke</span>: <span class="hljs-built_in">url</span>(#line-gradient);</div><div class="line">  <span class="hljs-attribute">stroke-width</span>: <span class="hljs-number">2px</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// set the gradient</span></div><div class="line"></div><div class="line"><span class="hljs-comment">// add linear gradient element</span></div><div class="line">svg.append(<span class="hljs-string">'linearGradent'</span>)</div><div class="line"><span class="hljs-comment">// add id for css anchor</span></div><div class="line">    .attr(<span class="hljs-string">'id'</span>, <span class="hljs-string">'line-gradient'</span>)</div><div class="line">    .attr(<span class="hljs-string">'gradientUnits'</span>, <span class="hljs-string">'userSpaceOnUse'</span>)</div><div class="line"><span class="hljs-comment">// use x1, y1, x2, y2 to define the bounds of the area over which the gradient will act.</span></div><div class="line"><span class="hljs-comment">// here we set x1, x2 to the same value so the gradient won't act on x direction.</span></div><div class="line">    .attr(<span class="hljs-string">'x1'</span>, <span class="hljs-number">0</span>).attr(<span class="hljs-string">'y1'</span>, yScale(<span class="hljs-number">0</span>))</div><div class="line">    .attr(<span class="hljs-string">'x2'</span>, <span class="hljs-number">0</span>).attr(<span class="hljs-string">'y2'</span>, yScale(<span class="hljs-number">1000</span>))</div><div class="line"><span class="hljs-comment">// select all 'stop' elements for the gradients, these 'stop' elements define where on the range covered by our coordinates the color start and stop(percent or decimal)</span></div><div class="line">  .selectAll(<span class="hljs-string">'stop'</span>)</div><div class="line">    .data([</div><div class="line">      &#123;<span class="hljs-attr">offset</span>: <span class="hljs-string">'0%'</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'red'</span>&#125;,</div><div class="line">      &#123;<span class="hljs-attr">offset</span>: <span class="hljs-string">'40%'</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'red'</span>&#125;,</div><div class="line">      &#123;<span class="hljs-attr">offset</span>: <span class="hljs-string">'40%'</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'black'</span>&#125;,</div><div class="line">      &#123;<span class="hljs-attr">offset</span>: <span class="hljs-string">'62%'</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'black'</span>&#125;,</div><div class="line">      &#123;<span class="hljs-attr">offset</span>: <span class="hljs-string">'62%'</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'lawngreen'</span>&#125;,</div><div class="line">      &#123;<span class="hljs-attr">offset</span>: <span class="hljs-string">'62%'</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'lawngreen'</span>&#125;,</div><div class="line">      &#123;<span class="hljs-attr">offset</span>: <span class="hljs-string">'100%'</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'lawngreen'</span>&#125;,</div><div class="line">    ])</div><div class="line">  .enter().append(<span class="hljs-string">'stop'</span>)</div><div class="line">    .attr(<span class="hljs-string">'offset'</span>, d =&gt; d.offset)</div><div class="line">    .attr(<span class="hljs-string">'stop-color'</span>, d =&gt; d.color)</div></pre></td></tr></table></figure>
<p>There is our anchor on the third line.</p>
<p>If you want to apply the gradient on area, simply change the css</p>
<p>```css<br>.area {<br>  fill: url(#area-gradient);<br>  stroke-width: 0px;<br>}</p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-30T16:03:29.000Z">2017-08-31</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    3 minutes read (About 460 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/31/Styles-in-D3/">Styles in D3</a>
            
        </h1>
        <div class="content">
            <h3 id="fill"><a href="#fill" class="headerlink" title="fill"></a>fill</h3><p>The <code>fill</code> style will fill the element being presented with a specifed color.</p>
<p>By default, most element will be filled with black.</p>
<h3 id="stroke"><a href="#stroke" class="headerlink" title="stroke"></a>stroke</h3><p>The <code>stroke</code> style applies a color to lines</p>
<h3 id="opacity"><a href="#opacity" class="headerlink" title="opacity"></a>opacity</h3><p>The <code>opacity</code> style has the effect of varying an element’s transparency.</p>
<p>The valid range for <code>opacity</code> is from 0 to 1.</p>
<p>We should make the distinction at this point that <code>opacity</code> affects the entire element, whereas the following <code>fill-opacity</code> and <code>stroke-opacity</code> affect only the fill and stroke respectively.</p>
<h3 id="fill-opacity"><a href="#fill-opacity" class="headerlink" title="fill-opacity"></a>fill-opacity</h3><p>The <code>fill-opacity</code> style changes the transparency of the fill of an element.</p>
<h3 id="stroke-opacity"><a href="#stroke-opacity" class="headerlink" title="stroke-opacity"></a>stroke-opacity</h3><p>The <code>stroke-opacity</code> style changes the transparency of the stroke of an element.</p>
<h3 id="stroke-width"><a href="#stroke-width" class="headerlink" title="stroke-width"></a>stroke-width</h3><p>The <code>stroke-width</code> style adjusts the width of the line of an element.</p>
<p>The value specified when setting <code>stroke-width</code> in pixels.</p>
<h3 id="stroke-dasharray"><a href="#stroke-dasharray" class="headerlink" title="stroke-dasharray"></a>stroke-dasharray</h3><p>The <code>stroke-dasharray</code> style allows us to form element lines with dashes instead of solid lines.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">.style(<span class="hljs-string">'stroke-dasharray'</span>, (<span class="hljs-string">'10, 3'</span>))</div></pre></td></tr></table></figure>
<h3 id="stroke-linecap"><a href="#stroke-linecap" class="headerlink" title="stroke-linecap"></a>stroke-linecap</h3><p>The <code>stroke-linecap</code> style allows control of the shape of the ends of lines.</p>
<p>There are three shape options:</p>
<ul>
<li><p><code>butt</code>: The line simply butts up to the starting or ending position and is cut off squarely.</p>
</li>
<li><p><code>round</code>: The line is rounded in propotionto its width.</p>
</li>
<li><p><code>square</code>: The line is squared off but exnteded in propotion to its width.</p>
</li>
</ul>
<h3 id="stroke-linejoin"><a href="#stroke-linejoin" class="headerlink" title="stroke-linejoin"></a>stroke-linejoin</h3><p>The <code>stroke-linejoin</code> style specifies the shape of the join of two lines. This would be used on <code>path</code>, <code>polyline</code> and <code>polygon</code>.</p>
<p>There are three line join options:</p>
<ul>
<li><p><code>miter</code>: The join is squared off as would be expected at the join of two lines.</p>
</li>
<li><p><code>round</code>: The outside portion of the join is rounded in proportion to its width.</p>
</li>
<li><p><code>bevel</code>: The join has a straight edged outer portion clipped off to provide a slightly more contoured effect while still being regular.</p>
</li>
</ul>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/EAS-41.png" alt="miter"></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/EAS-39.png" alt="round"></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/EAS-40.png" alt="bevel"></p>
<h3 id="writing-mode"><a href="#writing-mode" class="headerlink" title="writing-mode"></a>writing-mode</h3><p>The <code>writing-mode</code> style changes the orientation of the text so that it prints out top to bottom.</p>
<p>It has a single option ‘tb’ that accomplishes this.</p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/EAS-42.png" alt=""></p>
<h3 id="glyph-orientation-vertical"><a href="#glyph-orientation-vertical" class="headerlink" title="glyph-orientation-vertical"></a>glyph-orientation-vertical</h3><p>The <code>glyph-orientation-vertical</code> style changes the rotation of the individual glyphs(characters) in text and if used in conjunction with the <code>writing-mode</code> style (and set to 0) will allow the text to be displayed vertically with the letters orientation vertically as well.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">holder.append(<span class="hljs-string">'text'</span>)</div><div class="line">    .style(<span class="hljs-string">'fill'</span>, <span class="hljs-string">'black'</span>)</div><div class="line">    .style(<span class="hljs-string">'writing-mode'</span>, <span class="hljs-string">'tb'</span>)</div><div class="line">    .style(<span class="hljs-string">'glyph-orientation-vertical'</span>, <span class="hljs-number">0</span>)</div><div class="line">    .attr(<span class="hljs-string">'x'</span>, <span class="hljs-number">200</span>)</div><div class="line">    .attr(<span class="hljs-string">'y'</span>, <span class="hljs-number">100</span>)</div><div class="line">    .text(<span class="hljs-string">'Hello World'</span>)</div></pre></td></tr></table></figure>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/EAS-43.png" alt=""></p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-30T10:06:53.000Z">2017-08-30</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    3 minutes read (About 469 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/30/Attributes-in-D3/">Attributes in D3</a>
            
        </h1>
        <div class="content">
            <h3 id="x-y"><a href="#x-y" class="headerlink" title="x/y"></a>x/y</h3><p>The <code>x</code> and <code>y</code> attributes are used to designate a position on the web page. Use the <code>x</code> and <code>y</code> attributes places the anchor points for these elements at a specified location.</p>
<h3 id="x1-y1-x2-y2"><a href="#x1-y1-x2-y2" class="headerlink" title="x1, y1, x2, y2"></a>x1, y1, x2, y2</h3><p>The <code>x1</code>, <code>y1</code>, <code>x2</code>, <code>y2</code> attributes are used to designate the position of two points on the web page. These two points are connected with a line as part of the <code>line</code> element.</p>
<h3 id="points"><a href="#points" class="headerlink" title="points"></a>points</h3><p>The <code>points</code> attribute is used to set a series of points which are subsequently connected with a line and/or which may form the bounds of a shape. These are specifically associated with the <code>polyline</code> and <code>polygon</code> elements.</p>
<p>The data for the points is entered as a sequence of x,y points in the following format:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">.attr(<span class="hljs-string">'points'</span>, <span class="hljs-string">'100,50, 150,150, 150,50'</span>)</div></pre></td></tr></table></figure>
<h3 id="cx-cy"><a href="#cx-cy" class="headerlink" title="cx, cy"></a>cx, cy</h3><p>The <code>cx</code>, <code>cy</code> attributes are associated with the circle and ellipse elements and designate the center of each shape.</p>
<ul>
<li><p><code>cx</code>: The position of the center of the element in the x axis.</p>
</li>
<li><p><code>cy</code>: The position of the center of the element in the y axis.</p>
</li>
</ul>
<h3 id="rx-ry"><a href="#rx-ry" class="headerlink" title="rx, ry"></a>rx, ry</h3><p>The <code>rx</code>, <code>ry</code> attributes are associated with the ellipse element and designate the radius in the x and y directions.</p>
<ul>
<li><p><code>rx</code>: The radius of the ellipse in the x direction.</p>
</li>
<li><p><code>ry</code>: The radius of the ellipse in the y direction.</p>
</li>
</ul>
<h3 id="transform-translate-x-y-scale-k-rotate-a"><a href="#transform-translate-x-y-scale-k-rotate-a" class="headerlink" title="transform(translate(x, y), scale(k), rotate(a))"></a>transform(translate(x, y), scale(k), rotate(a))</h3><ul>
<li><p><code>translate(x, y)</code>: move the element by a relative value in x and y directions.</p>
</li>
<li><p><code>scale(k)</code>: Increase or reduce the element by a specified factor.</p>
</li>
<li><p><code>rotate(a)</code>: Rotate the element by an angular value.</p>
</li>
</ul>
<p>All transform are applied based on the origin of (0, 0).</p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/EAS-23.png" alt=""></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/EAS-24.png" alt="rotate(10)"></p>
<p>So you’d better use transform like this:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">holder.append(<span class="hljs-string">'text'</span>)</div><div class="line">    .style(<span class="hljs-string">'fill'</span>, <span class="hljs-string">'black'</span>)</div><div class="line">    .attr(<span class="hljs-string">'dy'</span>, <span class="hljs-string">'0.35em'</span>)</div><div class="line">    .attr(<span class="hljs-string">'text-anchor'</span>, <span class="hljs-string">'middle'</span>)</div><div class="line">    .attr(<span class="hljs-string">'transform'</span>, <span class="hljs-string">'translate(200, 100) rotate(10) scale(2)'</span>)</div><div class="line">    .text(<span class="hljs-string">'Hello World'</span>)</div></pre></td></tr></table></figure>
<h3 id="width-height"><a href="#width-height" class="headerlink" title="width, height"></a>width, height</h3><p><code>width</code> and <code>height</code> are required attributes of the rectagule element, <code>width</code> designates the width of the rectangle and <code>height</code> designates the height.</p>
<h3 id="text-anchor"><a href="#text-anchor" class="headerlink" title="text-anchor"></a>text-anchor</h3><p>The <code>text-anchor</code> attribute determines the justification of a text element. You can set it to <code>start</code>, <code>middle</code>, or <code>end</code>.</p>
<h3 id="dx-dy"><a href="#dx-dy" class="headerlink" title="dx, dy"></a>dx, dy</h3><p><code>dx</code> and <code>dy</code> are optional attributes that designate an offset of text elements from the anchor point in the x and y directions.</p>
<h3 id="textLength"><a href="#textLength" class="headerlink" title="textLength"></a>textLength</h3><p>The <code>textLength</code> attribute adjusts the length of the text element to fix a specified value.</p>
<h3 id="lenghtAdjust"><a href="#lenghtAdjust" class="headerlink" title="lenghtAdjust"></a>lenghtAdjust</h3><p>The <code>lengthAdjust</code> attribute allows the <code>textLength</code> attribute to have the spacing of a text element controlled to be either <code>spacing</code> or <code>spacingAndGlyphs</code>.</p>
<ul>
<li><p><code>spacing</code>: In thi soption the letters remain the same size, but the spacing between the letters and words are adjusted.</p>
</li>
<li><p><code>spacingAndGlyphs</code>: In this option the text is stretched or squeezed to fit.</p>
</li>
</ul>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-30T08:57:49.000Z">2017-08-30</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    4 minutes read (About 540 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/30/Basic-Elements-in-D3/">Basic Elements in D3</a>
            
        </h1>
        <div class="content">
            <h3 id="Circle"><a href="#Circle" class="headerlink" title="Circle"></a>Circle</h3><ul>
<li><p><code>cx</code>: The position of the center of the circle in the x direction.</p>
</li>
<li><p><code>cy</code>: The position of the center of the circle in the y direction.</p>
</li>
<li><p><code>r</code>: The radius of the circle from the <code>cx</code>, <code>cy</code> position to the perimeter of the circle.</p>
</li>
</ul>
<h3 id="Ellipse"><a href="#Ellipse" class="headerlink" title="Ellipse"></a>Ellipse</h3><ul>
<li><p><code>cx</code>: The position of the center of the ellipse in the x direction.</p>
</li>
<li><p><code>cy</code>: The position of the center of the ellipse in the y direction.</p>
</li>
<li><p><code>rx</code>: The radius of the ellipse in the x dimension.</p>
</li>
<li><p><code>ry</code>: The radius of the ellipse in the y dimension.</p>
</li>
</ul>
<h3 id="Rectangle"><a href="#Rectangle" class="headerlink" title="Rectangle"></a>Rectangle</h3><ul>
<li><p><code>x</code>: The position on the x axis of the left hand side of the rectangle.</p>
</li>
<li><p><code>y</code>: The position on the y axis of the top hand side of the rectangle.</p>
</li>
<li><p><code>width</code>: the width in pixel of the rectangle.</p>
</li>
<li><p><code>height</code>: the height in pixel of the rectangle.</p>
</li>
<li><p><code>rx</code>: the radius curve of the corner of the rectangle in the x dimension</p>
</li>
<li><p><code>ry</code>: The radius curve of the corner of the rectangle in the y dimension.</p>
</li>
</ul>
<h3 id="Line"><a href="#Line" class="headerlink" title="Line"></a>Line</h3><ul>
<li><p><code>x1</code>: The x position of the first end of the line.</p>
</li>
<li><p><code>y1</code>: The y position of the first end of the line.</p>
</li>
<li><p><code>x2</code>: The x position of the second end of the line.</p>
</li>
<li><p><code>y2</code>: The y position of the second end of the line.</p>
</li>
</ul>
<h3 id="polyline"><a href="#polyline" class="headerlink" title="polyline"></a>polyline</h3><p>A polyline is a sequence of connected lines described with a single attribute <code>points</code>.</p>
<ul>
<li><code>points</code>: The <code>points</code> attribute is a list of x,y coordinates that are the locations of the connecting points of the polyline.</li>
</ul>
<h3 id="polygon"><a href="#polygon" class="headerlink" title="polygon"></a>polygon</h3><p>A polygon is a sequnce of connected lines which form a closed shaped described with a single attribte <code>points</code></p>
<ul>
<li><code>points</code>: The <code>points</code> attribute is a list of x,y coordinates that are the locations of the connecting points of the polygon.</li>
</ul>
<h3 id="Path"><a href="#Path" class="headerlink" title="Path"></a>Path</h3><p>A path is an outline of an SVG shape which is described with a ‘mini-language’ inside a single attribute.</p>
<ul>
<li><code>d</code>: This attribute is a list of instructions that allow a shape to be drawn in a complex way using a ‘mini-language’ of command. These commands are written in a shorthand of single letters such a <code>M</code>-moveto, <code>Z</code>-closepath, <code>L</code>-lineto, <code>C</code>-curveto.</li>
</ul>
<h3 id="Clipped-Path-AKA-clipPath"><a href="#Clipped-Path-AKA-clipPath" class="headerlink" title="Clipped Path(AKA clipPath)"></a>Clipped Path(AKA clipPath)</h3><p>A clipPath is the path of a SVG shape that can be used in combination with another shape to remove any parts of the combined shape that doesn’t fall within the clipPath.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">holder.append(<span class="hljs-string">'clipPath'</span>)</div><div class="line">    .attr(<span class="hljs-string">'id'</span>, <span class="hljs-string">'ellipse-clip'</span>)</div><div class="line">  .append(<span class="hljs-string">'ellipse'</span>)</div><div class="line">    .attr(<span class="hljs-string">'cx'</span>, <span class="hljs-number">175</span>)</div><div class="line">    .attr(<span class="hljs-string">'cy'</span>, <span class="hljs-number">100</span>)</div><div class="line">    .attr(<span class="hljs-string">'rx'</span>, <span class="hljs-number">100</span>)</div><div class="line">    .attr(<span class="hljs-string">'ry'</span>, <span class="hljs-number">50</span>)</div><div class="line"></div><div class="line"></div><div class="line">holder.append(<span class="hljs-string">'rect'</span>)</div><div class="line">    .attr(<span class="hljs-string">'x'</span>, <span class="hljs-number">125</span>)</div><div class="line">    .attr(<span class="hljs-string">'y'</span>, <span class="hljs-number">75</span>)</div><div class="line">    .attr(<span class="hljs-string">'clip-path'</span>, <span class="hljs-string">'url(#ellipse-clip)'</span>)</div><div class="line">    .style(<span class="hljs-string">'fill'</span>, <span class="hljs-string">'lightgrey'</span>)</div><div class="line">    .attr(<span class="hljs-string">'height'</span>, <span class="hljs-number">100</span>)</div><div class="line">    .attr(<span class="hljs-string">'width'</span>, <span class="hljs-number">200</span>)</div></pre></td></tr></table></figure>
<h3 id="Text"><a href="#Text" class="headerlink" title="Text"></a>Text</h3><p>A text element is an SVG object which is shaped as text. It is described by two required attributes and three optional ones.</p>
<ul>
<li><p><code>x</code>: This attribute designates the anchor point location for the text in the x dimension.</p>
</li>
<li><p><code>y</code>: This attribute designates the anchor point location for the text in the y dimension.</p>
</li>
<li><p><code>dx</code>: This attribute designates the offset of the text from the anchor point in the x dimension. (ususally set to 0.35em, 0.71em)</p>
</li>
<li><p><code>dy</code>: This attribute designates the offset of the text from the anchor point in the y dimension.</p>
</li>
<li><p><code>text-anchor</code>: This attribute controls the horizontal text alignment. It has three values: <code>start</code>, <code>middle</code>, <code>end</code>.</p>
</li>
</ul>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-30T03:33:40.000Z">2017-08-30</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    9 minutes read (About 1365 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/30/Things-we-can-do-with-the-simple-Graph-of-D3/">Things We Can Do With the Simple Graph of D3</a>
            
        </h1>
        <div class="content">
            <p><a href="https://leanpub.com/d3-t-and-t-v4/read#axes" target="_blank" rel="noopener">Original</a></p>
<h3 id="Setting-up-and-configuring-the-Axes"><a href="#Setting-up-and-configuring-the-Axes" class="headerlink" title="Setting up and configuring the Axes"></a>Setting up and configuring the Axes</h3><h4 id="Change-the-text-size"><a href="#Change-the-text-size" class="headerlink" title="Change the text size"></a>Change the text size</h4><p>The default size is <strong>10px</strong> with the font type of <strong>sans-serif</strong>.</p>
<p>There are a couple of different ways that we could change the font size and either one is valid.</p>
<p>The first way is to specify the font as a style when drawing an individual axis.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">svg.append(<span class="hljs-string">'g'</span>)</div><div class="line">    .style(<span class="hljs-string">'font'</span>, <span class="hljs-string">'14px times'</span>)</div><div class="line">    .attr(<span class="hljs-string">'transform'</span>, <span class="hljs-string">`translate(0, <span class="hljs-subst">$&#123;height&#125;</span>)`</span>)</div><div class="line">    .call(d3.axisBottom(xScale))</div></pre></td></tr></table></figure>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/axes-01.png" alt=""></p>
<p>There are a few things to notice here.</p>
<p>Firstly, we do indeed have a larger font and it appears to be of the type ‘times’.</p>
<p>Secondly, the y axis has remained as 10px sans-serif.</p>
<p>Lastly, the number of values represented on the x axis has meant that with the increase in font size there is some overlapping going on</p>
<p>By this way, you can change stype of x axis while leaving y axis away.</p>
<p>But if you want to change two axis meanwhile, you’d better use class.</p>
<h4 id="Change-the-number-of-ticks-on-an-axis"><a href="#Change-the-number-of-ticks-on-an-axis" class="headerlink" title="Change the number of ticks on an axis"></a>Change the number of ticks on an axis</h4><p>Now we shall address the other problem taht cropped up when we change the size of the text. We have overlapping values on the x axis.</p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/axes-03.png" alt=""></p>
<p>The <a href="https://github.com/d3/d3-axis" target="_blank" rel="noopener">axis component</a> includes a function to specify the number of ticks on an axis.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">svg.append(<span class="hljs-string">'g'</span>)</div><div class="line">    .attr(<span class="hljs-string">'class'</span>, <span class="hljs-string">'axis'</span>)</div><div class="line">    .attr(<span class="hljs-string">'transform'</span>, <span class="hljs-string">`translate(0, <span class="hljs-subst">$&#123;height&#125;</span>)`</span>)</div><div class="line">    .call(d3.axisBottom(xScale).ticks(<span class="hljs-number">5</span>))</div></pre></td></tr></table></figure>
<p>Here you may face a confusion:</p>
<p>When you specify ticks to 5 or 4, or 3, there’re always 5 ticks, and if you specify ticks to 2, the axis ticks will be 2 representing month.</p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/axes-04.png" alt=""></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/axes-05.png" alt=""></p>
<p>This is because D3 is making a command decision for you as to how your ticks should be best displayed.</p>
<p>The following is the list of time interval that D3 will consider when setting automatic ticks on a time based aaxis:</p>
<ul>
<li><p>1, 5, 15 and 30-second</p>
</li>
<li><p>1, 5, 15 and 30-minute</p>
</li>
<li><p>1, 3, 6 and 12-hour</p>
</li>
<li><p>1 and 2-day</p>
</li>
<li><p>1-week</p>
</li>
<li><p>1 and 3-month</p>
</li>
<li><p>1-year</p>
</li>
</ul>
<p>You can specify custom time interval by <code>d3.axisBottom(xScale).ticks(d3.timeDay.every(4))</code>.</p>
<h4 id="Rotating-text-labels-for-a-graph-size"><a href="#Rotating-text-labels-for-a-graph-size" class="headerlink" title="Rotating text labels for a graph size"></a>Rotating text labels for a graph size</h4><p>An answer to the problem of overlapping axis values might to be rotate the text to provide more space.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">svg.append(<span class="hljs-string">'g'</span>)</div><div class="line">    .attr(<span class="hljs-string">'class'</span>, <span class="hljs-string">'axis'</span>)</div><div class="line">    .attr(<span class="hljs-string">'transform'</span>, <span class="hljs-string">`translate(0, <span class="hljs-subst">$&#123;height&#125;</span>)`</span>)</div><div class="line">    .call(d3.axisBottom(xScale).ticks(<span class="hljs-number">10</span>))</div><div class="line">    .selectAll(<span class="hljs-string">'text'</span>)</div><div class="line">        .style(<span class="hljs-string">'text-anchor'</span>, <span class="hljs-string">'end'</span>)</div><div class="line">        .attr(<span class="hljs-string">'dx'</span>, <span class="hljs-string">'-0.8em'</span>) <span class="hljs-comment">// move the end of the text away from the line</span></div><div class="line">        .attr(<span class="hljs-string">'dy'</span>, <span class="hljs-string">'0.15em'</span>) <span class="hljs-comment">// move the end of the text away from the line</span></div><div class="line">        .attr(<span class="hljs-string">'transform'</span>, <span class="hljs-string">'rotate(-65)'</span>)</div></pre></td></tr></table></figure>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/rotate02.png" alt=""></p>
<h4 id="Formatting-a-date-time-axis-with-specified-values"><a href="#Formatting-a-date-time-axis-with-specified-values" class="headerlink" title="Formatting a date / time axis with specified values"></a>Formatting a date / time axis with specified values</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">svg.append(<span class="hljs-string">'g'</span>)</div><div class="line">    .attr(<span class="hljs-string">'class'</span>, <span class="hljs-string">'axis'</span>)</div><div class="line">    .attr(<span class="hljs-string">'transform'</span>, <span class="hljs-string">`translate(0, <span class="hljs-subst">$&#123;height&#125;</span>)`</span>)</div><div class="line">    .call(d3.axisBottom(xScale).tickFormat(d3.timeFormat(<span class="hljs-string">'%Y-%m-%d'</span>)))</div><div class="line">  .selectAll(<span class="hljs-string">'text'</span>)</div><div class="line">    .style(<span class="hljs-string">'text-anchor'</span>, <span class="hljs-string">'end'</span>)</div><div class="line">    .attr(<span class="hljs-string">'dx'</span>, <span class="hljs-string">'-0.8em'</span>)</div><div class="line">    .attr(<span class="hljs-string">'dy'</span>, <span class="hljs-string">'0.15em'</span>)</div><div class="line">    .attr(<span class="hljs-string">'transform'</span>, <span class="hljs-string">'rotate(-65)'</span>)</div></pre></td></tr></table></figure>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/axes-07.png" alt=""></p>
<h4 id="Adding-Axis-Labels"><a href="#Adding-Axis-Labels" class="headerlink" title="Adding Axis Labels"></a>Adding Axis Labels</h4><figure class="highlight hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">// text label for the x axis</div><div class="line"></div><div class="line">svg.append('text')</div><div class="line">    .attr('transform', `translate($&#123;width/2&#125;, $&#123;height + margin.top + 20&#125;)`)</div><div class="line">    .style('text-anchor', 'middle')</div><div class="line">    .text('Date')</div></pre></td></tr></table></figure>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/date01.png" alt=""></p>
<p>Add y axis</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">svg.append(<span class="hljs-string">'text'</span>)</div><div class="line">    .attr(<span class="hljs-string">'transform'</span>, <span class="hljs-string">'rotate(-90)'</span>)</div><div class="line">    .attr(<span class="hljs-string">'y'</span>, <span class="hljs-number">0</span> - margin.left)</div><div class="line">    .attr(<span class="hljs-string">'x'</span>, <span class="hljs-number">0</span> - height / <span class="hljs-number">2</span>)</div><div class="line">    .attr(<span class="hljs-string">'dy'</span>, <span class="hljs-string">'1em'</span>)</div><div class="line">    .style(<span class="hljs-string">'text-anchor'</span>, <span class="hljs-string">'middle'</span>)</div><div class="line">    .text(<span class="hljs-string">'Value'</span>)</div></pre></td></tr></table></figure>
<p>Something may confused you:</p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/value02.png" alt=""></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/value03.png" alt=""></p>
<p>And add the title…</p>
<h4 id="Smoothing-out-graph-lines"><a href="#Smoothing-out-graph-lines" class="headerlink" title="Smoothing out graph lines"></a>Smoothing out graph lines</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">.curve(d3.curveBasis)</div></pre></td></tr></table></figure>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth03.png" alt="d3.curveLinear"></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth03a.png" alt="d3.curveLinearClosed"></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth04a.png" alt="d3.curveStep"></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth04.png" alt="d3.curveStepBefore"></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth05.png" alt="d3.curveStepAfter"></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth06.png" alt="d3.curveBasis"></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth07.png" alt="d3.curveBasisOpen"></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth08.png" alt="d3.curveLinearClosed"></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth09.png" alt="d3.curveBundle"></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth10.png" alt="d3.curveCardinal"></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth11.png" alt="d3.curveCardinalOpen"></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth12.png" alt="d3.curveCardinalClosed"></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth13.png" alt="d3.curveMonotone"></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth14.png" alt="d3.curveCatmullRom"></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth15.png" alt="d3.curveCatmullRomClosed"></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth16.png" alt="d3.curveCatmullRomOpen"></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/smooth17.png" alt=""></p>
<h4 id="Make-a-dashed-line"><a href="#Make-a-dashed-line" class="headerlink" title="Make a dashed line"></a>Make a dashed line</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">svg.append(<span class="hljs-string">'path'</span>)</div><div class="line">    .datum(data)</div><div class="line">    .attr(<span class="hljs-string">'class'</span>, <span class="hljs-string">'line'</span>)</div><div class="line">    .style(<span class="hljs-string">'stroke-dasharry'</span>, (<span class="hljs-string">'3, 3'</span>))</div><div class="line">    .attr(<span class="hljs-string">'d'</span>, line)</div></pre></td></tr></table></figure>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/dashed01.png" alt=""></p>
<p>Obviously <code>stroke-dasharray</code> is a style is a style for the path element, but the magic is the numbers.</p>
<p>Essentially they describe the on length and off length of the line. So <code>&#39;(3, 3)&#39;</code> translates to 3px on and 3px off.</p>
<p>You can try <code>&#39;5, 5, 5, 5, 5, 5, 10, 5, 10, 5, 10, 5&#39;</code></p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/dashed02.png" alt=""></p>
<p>Of course you can apply this style on axis or any where you prefer.</p>
<h4 id="Filling-an-aera-under-the-graph"><a href="#Filling-an-aera-under-the-graph" class="headerlink" title="Filling an aera under the graph"></a>Filling an aera under the graph</h4><p>Filling an area with a solid color isn’t too hard.</p>
<h5 id="CSS-for-an-area-fill"><a href="#CSS-for-an-area-fill" class="headerlink" title="CSS for an area fill"></a>CSS for an area fill</h5><figure class="highlight css hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-selector-class">.area</span> &#123;</div><div class="line">  <span class="hljs-attribute">fill</span>: lightsteelblue</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="Define-the-area-function"><a href="#Define-the-area-function" class="headerlink" title="Define the area function"></a>Define the area function</h5><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">const</span> area = d3.area()</div><div class="line">    .x(<span class="hljs-function">(<span class="hljs-params">d</span>) =&gt;</span> (xScale(d.date)))</div><div class="line">    .y0(height)</div><div class="line">    .y1(<span class="hljs-function">(<span class="hljs-params">d</span>) =&gt;</span> (yScale(d.close)))</div></pre></td></tr></table></figure>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/fill03.png" alt=""></p>
<h5 id="Draw-the-area"><a href="#Draw-the-area" class="headerlink" title="Draw the area"></a>Draw the area</h5><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">svg.append(<span class="hljs-string">'path'</span>)</div><div class="line">    .datum(data)</div><div class="line">    .attr(<span class="hljs-string">'class'</span>, <span class="hljs-string">'area'</span>)</div><div class="line">    .attr(<span class="hljs-string">'d'</span>, area)</div></pre></td></tr></table></figure>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/fill04.png" alt=""></p>
<p>If you want to fill the area above the graph</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">const</span> area = d3.area()</div><div class="line">    .x(<span class="hljs-function"><span class="hljs-params">d</span> =&gt;</span> (xScale(d.date)))</div><div class="line">    .y0(<span class="hljs-function"><span class="hljs-params">d</span> =&gt;</span> (yScale(d.close)))</div><div class="line">    y1(<span class="hljs-number">0</span>)</div></pre></td></tr></table></figure>
<h4 id="Add-a-drop-shadow-to-allow-text-to-stand-out-on-graphics"><a href="#Add-a-drop-shadow-to-allow-text-to-stand-out-on-graphics" class="headerlink" title="Add a drop shadow to allow text to stand out on graphics"></a>Add a drop shadow to allow text to stand out on graphics</h4><figure class="highlight css hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-selector-tag">text</span><span class="hljs-selector-class">.shadow</span> &#123;</div><div class="line">  <span class="hljs-attribute">stroke</span>: white;</div><div class="line">  <span class="hljs-attribute">stroke-width</span>: <span class="hljs-number">4px</span>;</div><div class="line">  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.8</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Add-grid-lines-to-a-graph"><a href="#Add-grid-lines-to-a-graph" class="headerlink" title="Add grid lines to a graph."></a>Add grid lines to a graph.</h4><p>We are going to use the axis function to generate two more axis elements(one for x and one for y) but for these ones of drawing the main lines and the labels, we’re just going to draw the tick lines.</p>
<h5 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h5><figure class="highlight css hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-selector-class">.grid</span> <span class="hljs-selector-tag">line</span> &#123;</div><div class="line">  <span class="hljs-attribute">stroke</span>: lightgrey;</div><div class="line">  <span class="hljs-attribute">stroke-opacity</span>: <span class="hljs-number">0.7</span>;</div><div class="line">  <span class="hljs-attribute">shape-rendering</span>: crispEdges;</div><div class="line">&#125;</div><div class="line"><span class="hljs-selector-class">.grid</span> <span class="hljs-selector-tag">path</span> &#123;</div><div class="line">  <span class="hljs-attribute">stroke-width</span>: <span class="hljs-number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Here we use <code>shape-rendering: crispEdges</code> to make the lines narrow.</p>
<p>And set <code>.grid path{ stroke-width: 0; }</code> to dismiss line of top and right line, it will be like this if we remove the css style:</p>
<p><img src="https://leanpub.com/site_images/d3-t-and-t-v4/grid02.png" alt=""></p>
<h5 id="Define-the-grid-line-functions"><a href="#Define-the-grid-line-functions" class="headerlink" title="Define the grid line functions"></a>Define the grid line functions</h5><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// gridlines in x axis function</span></div><div class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">make_x_gridlines</span>(<span class="hljs-params"></span>) </span>&#123;</div><div class="line">  <span class="hljs-keyword">return</span> d3.axisBottom(xScale).ticks(<span class="hljs-number">5</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-comment">// gridlines in y axis function</span></div><div class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">make_y_gridlines</span>(<span class="hljs-params"></span>) </span>&#123;</div><div class="line">  <span class="hljs-keyword">return</span> d3.axisLeft(yScale).ticks(<span class="hljs-number">5</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="Draw-the-lines"><a href="#Draw-the-lines" class="headerlink" title="Draw the lines"></a>Draw the lines</h5><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// add the x gridlines</span></div><div class="line">svg.append(<span class="hljs-string">'g'</span>)</div><div class="line">    .attr(<span class="hljs-string">'class'</span>, <span class="hljs-string">'grid'</span>)</div><div class="line">    .attr(<span class="hljs-string">'transform'</span>, <span class="hljs-string">`translate(0, <span class="hljs-subst">$&#123;height&#125;</span>)`</span>)</div><div class="line">    .call(make_x_gridlines().tickSize(-height).tickFormat(<span class="hljs-string">''</span>))</div><div class="line"></div><div class="line"><span class="hljs-comment">// add the y gridlines</span></div><div class="line">svg.append(<span class="hljs-string">'g'</span>)</div><div class="line">    .attr(<span class="hljs-string">'class'</span>, <span class="hljs-string">'grid'</span>)</div><div class="line">    .call(make_y_gridlines().tickSize(-width).tickFormat(<span class="hljs-string">''</span>))</div></pre></td></tr></table></figure>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">axis.tickSize([size])</div></pre></td></tr></table></figure>
<p>In our example, we are setting our ticks to a length that corresponding to the full height or width of the graph, which of course means that they extend across the graph and have the appearance of grid lines.</p>
<p>The last thing that is included in the code to draw the grid lines is the instruction to suppress printing any label for the ticks:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">.tickForamt(<span class="hljs-string">''</span>)</div></pre></td></tr></table></figure>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-29T12:30:15.000Z">2017-08-29</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    2 minutes read (About 291 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/29/Simple-Example-of-Line-Chart-with-D3v4/">Simple Example of Line Chart With D3v4</a>
            
        </h1>
        <div class="content">
            <h3 id="Import-D3"><a href="#Import-D3" class="headerlink" title="Import D3"></a>Import D3</h3><figure class="highlight html hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://d3js.org/d3.v4.min.js"</span>&gt;</span><span class="hljs-undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// set size</span></div><div class="line"><span class="hljs-keyword">const</span> margin = &#123;</div><div class="line">  <span class="hljs-attr">top</span>: <span class="hljs-number">50</span>,</div><div class="line">  <span class="hljs-attr">right</span>: <span class="hljs-number">50</span>,</div><div class="line">  <span class="hljs-attr">bottom</span>: <span class="hljs-number">50</span>,</div><div class="line">  <span class="hljs-attr">left</span>: <span class="hljs-number">50</span>,</div><div class="line">&#125;</div><div class="line"><span class="hljs-keyword">const</span> width = <span class="hljs-built_in">window</span>.innerWidth - margin.left - margin.right</div><div class="line"><span class="hljs-keyword">const</span> height = <span class="hljs-built_in">window</span>.innerHeight - margin.top - margin.bottom</div><div class="line"></div><div class="line"><span class="hljs-comment">// Set Point Number</span></div><div class="line"><span class="hljs-keyword">const</span> n = <span class="hljs-number">21</span></div><div class="line"></div><div class="line"><span class="hljs-comment">// X scale will use the index of our data</span></div><div class="line"><span class="hljs-keyword">const</span> xScale = d3.scaleLinear()</div><div class="line">    .domain([<span class="hljs-number">0</span>, n<span class="hljs-number">-1</span>]) <span class="hljs-comment">// input</span></div><div class="line">    .range([<span class="hljs-number">0</span>, width]) <span class="hljs-comment">// output</span></div><div class="line"></div><div class="line"><span class="hljs-comment">// Y scale will use the randomly generated number</span></div><div class="line"><span class="hljs-keyword">const</span> yScale = d3.scaleLinear()</div><div class="line">    .domain([<span class="hljs-number">0</span>, <span class="hljs-number">1</span>]) <span class="hljs-comment">// input</span></div><div class="line">    .range([height, <span class="hljs-number">0</span>]) <span class="hljs-comment">// output</span></div><div class="line"></div><div class="line"><span class="hljs-comment">// d3's line generator</span></div><div class="line"><span class="hljs-keyword">const</span> line = d3.line()</div><div class="line">    .x(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d, i</span>) </span>&#123;</div><div class="line">      <span class="hljs-keyword">return</span> xScale(i)  <span class="hljs-comment">// set the x value for the line generator</span></div><div class="line">    &#125;)</div><div class="line">    .y(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d, i</span>) </span>&#123;</div><div class="line">      <span class="hljs-keyword">return</span> d.y <span class="hljs-comment">// set the y value for the line generator</span></div><div class="line">    &#125;)</div><div class="line">    .curve(d3.curveMonotoneX) <span class="hljs-comment">// apply smoothing to the line</span></div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> dataset = d3.range(n)</div><div class="line">    .map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) </span>&#123;</div><div class="line">      <span class="hljs-keyword">return</span> &#123;</div><div class="line">        <span class="hljs-attr">y</span>: d3.randomUniform(<span class="hljs-number">1</span>)()</div><div class="line">      &#125;</div><div class="line">    &#125;)</div><div class="line"></div><div class="line"><span class="hljs-comment">// Add SVG to the page</span></div><div class="line"><span class="hljs-keyword">const</span> svg = d3.select(<span class="hljs-string">'body'</span>)</div><div class="line">  .append(<span class="hljs-string">'svg'</span>)</div><div class="line">    .attr(<span class="hljs-string">'width'</span>, width + margin.left + margin.right)</div><div class="line">    .attr(<span class="hljs-string">'height'</span>, height + margin.top + margin.bottom)</div><div class="line">  .append(<span class="hljs-string">'g'</span>)</div><div class="line">    .attr(<span class="hljs-string">'transform'</span>, <span class="hljs-string">`translate(<span class="hljs-subst">$&#123;margin.left&#125;</span>, <span class="hljs-subst">$&#123;margin.top&#125;</span>)`</span>)</div><div class="line"></div><div class="line"><span class="hljs-comment">// Call the X axis in a group tag</span></div><div class="line">svg.append(<span class="hljs-string">'g'</span>)</div><div class="line">    .attr(<span class="hljs-string">'class'</span>, <span class="hljs-string">'x axis'</span>)</div><div class="line">    .attr(<span class="hljs-string">'transform'</span>, <span class="hljs-string">`translate(0, <span class="hljs-subst">$&#123;height&#125;</span>)`</span>)</div><div class="line">    .call(d3.axisBottom(xScale)) <span class="hljs-comment">// Create an axis component with d3.axisBottom</span></div><div class="line"></div><div class="line"><span class="hljs-comment">// Call the Y axis in a group tag</span></div><div class="line">svg.append(<span class="hljs-string">'g'</span>)</div><div class="line">    .attr(<span class="hljs-string">'class'</span>, <span class="hljs-string">'y axis'</span>)</div><div class="line">    .call(d3.axisLeft(yScale))</div><div class="line"></div><div class="line"><span class="hljs-comment">// Append the path, bind the data, and call the line generator</span></div><div class="line">svg.append(<span class="hljs-string">'path'</span>)</div><div class="line">    .datum(dataset) <span class="hljs-comment">// bind data to the path</span></div><div class="line">    .attr(<span class="hljs-string">'class'</span>, <span class="hljs-string">'line'</span>)</div><div class="line">    .attr(<span class="hljs-string">'d'</span>, line) <span class="hljs-comment">// call the line generator</span></div><div class="line"></div><div class="line"><span class="hljs-comment">// Append a circle for each data point</span></div><div class="line">svg.selectAll(<span class="hljs-string">'.dot'</span>)</div><div class="line">    .data(dataset)</div><div class="line">  .enter().append(<span class="hljs-string">'circle'</span>)</div><div class="line">    .attr(<span class="hljs-string">'cx'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">d, i</span>) </span>&#123;</div><div class="line">      <span class="hljs-keyword">return</span> xScale(i)</div><div class="line">    &#125;)</div><div class="line">    .attr(<span class="hljs-string">'cy'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">d, i</span>) </span>&#123;</div><div class="line">      <span class="hljs-keyword">return</span> yScale(dy)</div><div class="line">    &#125;)</div><div class="line">    .attr(<span class="hljs-string">'r'</span>, <span class="hljs-number">5</span>)</div></pre></td></tr></table></figure>
<h3 id="Add-style"><a href="#Add-style" class="headerlink" title="Add style"></a>Add style</h3><figure class="highlight css hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-selector-class">.line</span> &#123;</div><div class="line">  <span class="hljs-attribute">fill</span>: none;</div><div class="line">  <span class="hljs-attribute">stroke</span>: cyan;</div><div class="line">  <span class="hljs-attribute">storke-width</span>: <span class="hljs-number">3</span>;</div><div class="line">&#125;</div><div class="line"><span class="hljs-selector-class">.dot</span> &#123;</div><div class="line">  <span class="hljs-attribute">fill</span>: <span class="hljs-number">#ffab00</span>;</div><div class="line">  <span class="hljs-attribute">stroke</span>: <span class="hljs-number">#FFF</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-29T08:27:11.000Z">2017-08-29</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    5 minutes read (About 676 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/29/Usage-of-Mock/">Usage of Mock</a>
            
        </h1>
        <div class="content">
            <h3 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h3><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yarn add mockjs</div></pre></td></tr></table></figure>
<h3 id="Simple-Usage"><a href="#Simple-Usage" class="headerlink" title="Simple Usage"></a>Simple Usage</h3><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">const</span> Mock = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mock'</span>)</div><div class="line"><span class="hljs-keyword">const</span> data = Mock.mock(&#123;</div><div class="line">  <span class="hljs-string">'list|1-10'</span>: [&#123;</div><div class="line">    <span class="hljs-string">'id|+1'</span>: <span class="hljs-number">1</span></div><div class="line">  &#125;]</div><div class="line">&#125;)</div><div class="line"><span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">JSON</span>.stringify(data))</div></pre></td></tr></table></figure>
<h3 id="Data-Template-Definition-DTD"><a href="#Data-Template-Definition-DTD" class="headerlink" title="Data Template Definition(DTD)"></a>Data Template Definition(DTD)</h3><p>Each attribute consists of three parts:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// attribute name</span></div><div class="line"><span class="hljs-comment">// attribute rule</span></div><div class="line"><span class="hljs-comment">// attribute value</span></div><div class="line"></div><div class="line"><span class="hljs-string">'name|rule'</span>: value</div></pre></td></tr></table></figure>
<p>rule is optional</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// rules</span></div><div class="line">&#123;</div><div class="line">  <span class="hljs-string">'name|min-max'</span>: value,</div><div class="line">  <span class="hljs-string">'name|count'</span>: value,</div><div class="line">  <span class="hljs-string">'name|min-max.dmin-dmax'</span>: value,</div><div class="line">  <span class="hljs-string">'name|min-max.dcount'</span>: value,</div><div class="line">  <span class="hljs-string">'name|count.dmin-dmax'</span>: value,</div><div class="line">  <span class="hljs-string">'name|count.dcount'</span>: value,</div><div class="line">  <span class="hljs-string">'name|+step'</span>: value,</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-string">'name|min-max'</span>: string <span class="hljs-comment">// repeat 'string' less than or equal to 'min', more than or equal 'max'</span></div><div class="line"><span class="hljs-string">'name|count'</span>: string <span class="hljs-comment">// repeat 'string' 'count' times.</span></div><div class="line"><span class="hljs-string">'name|+1'</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// auto incresing with step 1 from 0</span></div><div class="line"><span class="hljs-string">'name|min-max'</span>: number <span class="hljs-comment">// generate a number &gt;=min and &lt;=max</span></div><div class="line"><span class="hljs-string">'name|min-max.dmin-dmax'</span>: number <span class="hljs-comment">// generate a float, the integer part &gt;=min and &lt;=max, the deciaml part remains dmin - dmax bits.</span></div></pre></td></tr></table></figure>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">Mock.mock(&#123;</div><div class="line">    <span class="hljs-string">'number1|1-100.1-10'</span>: <span class="hljs-number">1</span>,</div><div class="line">    <span class="hljs-string">'number2|123.1-10'</span>: <span class="hljs-number">1</span>,</div><div class="line">    <span class="hljs-string">'number3|123.3'</span>: <span class="hljs-number">1</span>,</div><div class="line">    <span class="hljs-string">'number4|123.10'</span>: <span class="hljs-number">1.123</span></div><div class="line">&#125;)</div><div class="line"><span class="hljs-comment">// =&gt;</span></div><div class="line">&#123;</div><div class="line">    <span class="hljs-string">"number1"</span>: <span class="hljs-number">12.92</span>,</div><div class="line">    <span class="hljs-string">"number2"</span>: <span class="hljs-number">123.51</span>,</div><div class="line">    <span class="hljs-string">"number3"</span>: <span class="hljs-number">123.777</span>,</div><div class="line">    <span class="hljs-string">"number4"</span>: <span class="hljs-number">123.1231091814</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Data-Placeholder-Definition-DPD"><a href="#Data-Placeholder-Definition-DPD" class="headerlink" title="Data Placeholder Definition(DPD)"></a>Data Placeholder Definition(DPD)</h3><p>Placeholder hold a position in attribute string, and will dismiss in result.</p>
<p>Use Mock.Random to generate data.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">@placeholder</div><div class="line">@placeholder(opt1[, opt2])</div></pre></td></tr></table></figure>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">Mock.mock(&#123;</div><div class="line">    <span class="hljs-attr">name</span>: &#123;</div><div class="line">        <span class="hljs-attr">first</span>: <span class="hljs-string">'@FIRST'</span>,</div><div class="line">        <span class="hljs-attr">middle</span>: <span class="hljs-string">'@FIRST'</span>,</div><div class="line">        <span class="hljs-attr">last</span>: <span class="hljs-string">'@LAST'</span>,</div><div class="line">        <span class="hljs-attr">full</span>: <span class="hljs-string">'@first @middle @last'</span></div><div class="line">    &#125;</div><div class="line">&#125;)</div><div class="line"><span class="hljs-comment">// =&gt;</span></div><div class="line">&#123;</div><div class="line">    <span class="hljs-string">"name"</span>: &#123;</div><div class="line">        <span class="hljs-string">"first"</span>: <span class="hljs-string">"Charles"</span>,</div><div class="line">        <span class="hljs-string">"middle"</span>: <span class="hljs-string">"Brenda"</span>,</div><div class="line">        <span class="hljs-string">"last"</span>: <span class="hljs-string">"Lopez"</span>,</div><div class="line">        <span class="hljs-string">"full"</span>: <span class="hljs-string">"Charles Brenda Lopez"</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Mock-mock"><a href="#Mock-mock" class="headerlink" title="Mock.mock()"></a>Mock.mock()</h3><h4 id="Mock-mock-rurl-rtype-template-function-options"><a href="#Mock-mock-rurl-rtype-template-function-options" class="headerlink" title="Mock.mock(rurl?, rtype?, template | function(options))"></a>Mock.mock(rurl?, rtype?, template | function(options))</h4><h5 id="Mock-mock-template"><a href="#Mock-mock-template" class="headerlink" title="Mock.mock(template)"></a>Mock.mock(template)</h5><p>Generate mock data</p>
<h5 id="Mock-mock-rurl-template"><a href="#Mock-mock-rurl-template" class="headerlink" title="Mock.mock(rurl, template)"></a>Mock.mock(rurl, template)</h5><p>Intercept <code>rurl</code>(regexp) request, and generate according template.</p>
<h5 id="Mock-mock-rurl-function-options"><a href="#Mock-mock-rurl-function-options" class="headerlink" title="Mock.mock(rurl, function(options))"></a>Mock.mock(rurl, function(options))</h5><p>Intercept <code>rurl</code> request and call function(options) to return the mock data.</p>
<h5 id="Mock-mock-rurl-rtype-template"><a href="#Mock-mock-rurl-rtype-template" class="headerlink" title="Mock.mock(rurl, rtype, template)"></a>Mock.mock(rurl, rtype, template)</h5><p>Intercept the request matching <code>rurl</code> and <code>rtype</code>.</p>
<h5 id="Mock-mock-rurl-rtype-function-options"><a href="#Mock-mock-rurl-rtype-function-options" class="headerlink" title="Mock.mock(rurl, rtype, function(options))"></a>Mock.mock(rurl, rtype, function(options))</h5><p>Intercept the request matching <code>rurl</code> and <code>rtype</code>.</p>
<blockquote>
<p>options conssits of (url, type, body)</p>
</blockquote>
<h3 id="Mock-setup"><a href="#Mock-setup" class="headerlink" title="Mock.setup()"></a>Mock.setup()</h3><p>Mock.setup(settings)</p>
<p>Set action when intercept ajax request.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="hljs-attr">timeout</span>: <span class="hljs-string">''</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>timeout: set time responding time, ‘300’, ‘300-600’, default to ‘10-100’</li>
</ul>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Mock.setup(&#123;</div><div class="line">  <span class="hljs-attr">timeout</span>: <span class="hljs-string">'200-400'</span>,</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="Mock-Random"><a href="#Mock-Random" class="headerlink" title="Mock.Random"></a>Mock.Random</h3><p>Utils to generate Random data.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">var</span> Random = Mock.Random</div><div class="line">Random.email()</div><div class="line"></div><div class="line">Mock.mock(<span class="hljs-string">'@email'</span>) <span class="hljs-comment">// use with placeholder</span></div><div class="line"></div><div class="line">Mock.mock(&#123;</div><div class="line">  <span class="hljs-attr">email</span>: <span class="hljs-string">'@email'</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>| Type | Mehtod |<br>| Baisc | boolean, natural, integer, float, character, string, range, date, time, datetime, now |<br>| Image | image, dataImage |<br>| Color | color |<br>| Text | paragraph, sentence, word, title, cparagraph, csentence, cword, ctitle |<br>| Name | first, last, name, cfirst, clast, cname |<br>| Web | url, domain, email, ip, tld |<br>| Address | area, region |<br>| Helper | capitalize, upper, lower, pick, shuffle |<br>| Miscellaneous | guid, id |</p>
<h4 id="Mock-Random-boolean-min-max-current"><a href="#Mock-Random-boolean-min-max-current" class="headerlink" title="Mock.Random.boolean(min?, max?, current?)"></a>Mock.Random.boolean(min?, max?, current?)</h4><p>‘min’ and ‘max’ decide the possibility of ‘current’</p>
<p>‘current’ will appear in possibility of min/(min + max) to max(min + max)</p>
<h4 id="Mock-Random-natural-min-max"><a href="#Mock-Random-natural-min-max" class="headerlink" title="Mock.Random.natural(min?, max?)"></a>Mock.Random.natural(min?, max?)</h4><h4 id="Mock-Random-integer-min-max"><a href="#Mock-Random-integer-min-max" class="headerlink" title="Mock.Random.integer(min?, max?)"></a>Mock.Random.integer(min?, max?)</h4><h4 id="Mock-Random-float-min-max-dmin-dmax"><a href="#Mock-Random-float-min-max-dmin-dmax" class="headerlink" title="Mock.Random.float(min?, max?, dmin?, dmax?)"></a>Mock.Random.float(min?, max?, dmin?, dmax?)</h4><h4 id="Mock-Random-character-pool"><a href="#Mock-Random-character-pool" class="headerlink" title="Mock.Random.character(pool?)"></a>Mock.Random.character(pool?)</h4><p>pool represents the character pool</p>
<p>pool: ‘lower/upper/number/symbol’<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  lower: &apos;abcdefghijklmnopqrstuvwxyz&apos;,</div><div class="line">  upper: &apos;ABCDEFGHIJKLMNOPQRSTUVWXYZ&apos;,</div><div class="line">  number: 0123456789,</div><div class="line">  symbol: &apos;!@#$%^&amp;*()[]&apos;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="Mock-Random-string-pool-min-max"><a href="#Mock-Random-string-pool-min-max" class="headerlink" title="Mock.Random.string(pool?, min?, max?)"></a>Mock.Random.string(pool?, min?, max?)</h4><p>pool: available string pool<br>min: min-length, default to 3<br>max: max-length, default to 7</p>
<h4 id="Mock-Random-range-start-stop-step"><a href="#Mock-Random-range-start-stop-step" class="headerlink" title="Mock.Random.range(start?, stop, step?)"></a>Mock.Random.range(start?, stop, step?)</h4><h4 id="Mock-Random-date-format"><a href="#Mock-Random-date-format" class="headerlink" title="Mock.Random.date(format?)"></a>Mock.Random.date(format?)</h4><h4 id="Mock-Random-time-format"><a href="#Mock-Random-time-format" class="headerlink" title="Mock.Random.time(format?)"></a>Mock.Random.time(format?)</h4><h4 id="Mock-Random-datetime-format"><a href="#Mock-Random-datetime-format" class="headerlink" title="Mock.Random.datetime(format?)"></a>Mock.Random.datetime(format?)</h4><h4 id="Mock-Random-now-unit-format"><a href="#Mock-Random-now-unit-format" class="headerlink" title="Mock.Random.now(unit?, format?)"></a>Mock.Random.now(unit?, format?)</h4><h4 id="Mock-Random-image-size-background-foreground-format-text"><a href="#Mock-Random-image-size-background-foreground-format-text" class="headerlink" title="Mock.Random.image(size?, background?, foreground?, format?, text?)"></a>Mock.Random.image(size?, background?, foreground?, format?, text?)</h4><h4 id="Mock-Random-dataImage-size-text"><a href="#Mock-Random-dataImage-size-text" class="headerlink" title="Mock.Random.dataImage(size?, text?)"></a>Mock.Random.dataImage(size?, text?)</h4><h4 id="Mock-Random-color"><a href="#Mock-Random-color" class="headerlink" title="Mock.Random.color()"></a>Mock.Random.color()</h4><h4 id="Mock-Random-hex"><a href="#Mock-Random-hex" class="headerlink" title="Mock.Random.hex()"></a>Mock.Random.hex()</h4><h4 id="Mock-Random-rgb"><a href="#Mock-Random-rgb" class="headerlink" title="Mock.Random.rgb()"></a>Mock.Random.rgb()</h4><h4 id="Mock-Random-rbga"><a href="#Mock-Random-rbga" class="headerlink" title="Mock.Random.rbga()"></a>Mock.Random.rbga()</h4><h4 id="Mock-Random-hsl"><a href="#Mock-Random-hsl" class="headerlink" title="Mock.Random.hsl()"></a>Mock.Random.hsl()</h4><h4 id="Mock-Random-paragraph-null-length-min-max-Mock-Random-cparagraph-null-length-min-max"><a href="#Mock-Random-paragraph-null-length-min-max-Mock-Random-cparagraph-null-length-min-max" class="headerlink" title="Mock.Random.paragraph(null | length | min, max) | Mock.Random.cparagraph(null | length | min, max)"></a>Mock.Random.paragraph(null | length | min, max) | Mock.Random.cparagraph(null | length | min, max)</h4><h4 id="Mock-Random-sentence-null-length-min-max-Mock-Random-csentence-null-length-min-max"><a href="#Mock-Random-sentence-null-length-min-max-Mock-Random-csentence-null-length-min-max" class="headerlink" title="Mock.Random.sentence(null | length | min, max) | Mock.Random.csentence(null | length | min, max)"></a>Mock.Random.sentence(null | length | min, max) | Mock.Random.csentence(null | length | min, max)</h4><h4 id="Mock-Random-workd-null-length-min-max-Mock-Random-cword-pool-min-max"><a href="#Mock-Random-workd-null-length-min-max-Mock-Random-cword-pool-min-max" class="headerlink" title="Mock.Random.workd(null | length | min, max) | Mock.Random.cword(pool?, min?, max?)"></a>Mock.Random.workd(null | length | min, max) | Mock.Random.cword(pool?, min?, max?)</h4><h4 id="Mock-Random-title-null-length-min-max-Mock-Random-ctitle-null-length-min-max"><a href="#Mock-Random-title-null-length-min-max-Mock-Random-ctitle-null-length-min-max" class="headerlink" title="Mock.Random.title(null | length | min, max) | Mock.Random.ctitle(null | length | min, max)"></a>Mock.Random.title(null | length | min, max) | Mock.Random.ctitle(null | length | min, max)</h4><h4 id="Mock-Random-first-Mock-Random-last-Mock-Random-name-middle-Mock-Random-cfirst-Mock-Random-clast-Mock-Random-cname"><a href="#Mock-Random-first-Mock-Random-last-Mock-Random-name-middle-Mock-Random-cfirst-Mock-Random-clast-Mock-Random-cname" class="headerlink" title="Mock.Random.first() | Mock.Random.last() | Mock.Random.name(middle?) | Mock.Random.cfirst() | Mock.Random.clast() | Mock.Random.cname()"></a>Mock.Random.first() | Mock.Random.last() | Mock.Random.name(middle?) | Mock.Random.cfirst() | Mock.Random.clast() | Mock.Random.cname()</h4><h4 id="Mock-Random-url-protocol-host"><a href="#Mock-Random-url-protocol-host" class="headerlink" title="Mock.Random.url(protocol?, host?)"></a>Mock.Random.url(protocol?, host?)</h4><h4 id="Mock-Random-protocol-Mock-Random-domain-Mock-Random-tld-Mock-Random-email-domain-Mock-Random-ip"><a href="#Mock-Random-protocol-Mock-Random-domain-Mock-Random-tld-Mock-Random-email-domain-Mock-Random-ip" class="headerlink" title="Mock.Random.protocol() | Mock.Random.domain() | Mock.Random.tld() | Mock.Random.email(domain?) | Mock.Random.ip()"></a>Mock.Random.protocol() | Mock.Random.domain() | Mock.Random.tld() | Mock.Random.email(domain?) | Mock.Random.ip()</h4><h4 id="Mock-Random-region-Mock-Random-province-Mock-Random-city-prefix-Mock-Random-county-prefix-Mock-Random-zip"><a href="#Mock-Random-region-Mock-Random-province-Mock-Random-city-prefix-Mock-Random-county-prefix-Mock-Random-zip" class="headerlink" title="Mock.Random.region() | Mock.Random.province() | Mock.Random.city(prefix?) | Mock.Random.county(prefix?) | Mock.Random.zip()"></a>Mock.Random.region() | Mock.Random.province() | Mock.Random.city(prefix?) | Mock.Random.county(prefix?) | Mock.Random.zip()</h4><h4 id="Mock-Random-captilize-word-Mock-Random-upper-str-Mock-Random-lower-str-Mock-Random-pick-arr-Mock-Random-shuffle-arr"><a href="#Mock-Random-captilize-word-Mock-Random-upper-str-Mock-Random-lower-str-Mock-Random-pick-arr-Mock-Random-shuffle-arr" class="headerlink" title="Mock.Random.captilize(word) | Mock.Random.upper(str) | Mock.Random.lower(str) | Mock.Random.pick(arr) | Mock.Random.shuffle(arr)"></a>Mock.Random.captilize(word) | Mock.Random.upper(str) | Mock.Random.lower(str) | Mock.Random.pick(arr) | Mock.Random.shuffle(arr)</h4><h4 id="Mock-Random-guid"><a href="#Mock-Random-guid" class="headerlink" title="Mock.Random.guid()"></a>Mock.Random.guid()</h4><p>Generate a GUID</p>
<h4 id="Mock-Random-id"><a href="#Mock-Random-id" class="headerlink" title="Mock.Random.id()"></a>Mock.Random.id()</h4><p>Generate a Personal Identity</p>
<h4 id="Mock-Random-increment-step"><a href="#Mock-Random-increment-step" class="headerlink" title="Mock.Random.increment(step?)"></a>Mock.Random.increment(step?)</h4><h3 id="Mock-valid-template-data"><a href="#Mock-valid-template-data" class="headerlink" title="Mock.valid(template, data)"></a>Mock.valid(template, data)</h3><p>Check if the data is matching the template</p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-28T16:06:59.000Z">2017-08-29</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    18 minutes read (About 2680 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/29/Start-at-Pug/">Start at Pug</a>
            
        </h1>
        <div class="content">
            <h3 id="Install-Pug"><a href="#Install-Pug" class="headerlink" title="Install Pug"></a>Install Pug</h3><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yarn add pug</div></pre></td></tr></table></figure>
<h3 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h3><p><code>pug.compile()</code> will compile the Pug source code into a JavaScript function that takes a data object(called <code>locals</code>) as an argument. Call that resultant function with your data, then it will return a string of HTML rendered with your data.</p>
<p>The compiled function can be re-used, and called with different sets of data.</p>
<figure class="highlight html hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// - template.pug</div><div class="line">p #&#123;name&#125;'s Pug source code!</div></pre></td></tr></table></figure>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">const</span> pug = <span class="hljs-built_in">require</span>(<span class="hljs-string">'pug'</span>)</div><div class="line"><span class="hljs-comment">// Compile the source code</span></div><div class="line"><span class="hljs-keyword">const</span> compiledFunction = pug.compile(<span class="hljs-string">'template.pug'</span>)</div><div class="line"><span class="hljs-comment">// Render a set of data</span></div><div class="line"><span class="hljs-built_in">console</span>.log(compiledFunction(&#123;</div><div class="line">  <span class="hljs-attr">name</span>: <span class="hljs-string">'Timothy'</span></div><div class="line">&#125;))</div><div class="line"><span class="hljs-comment">// "&lt;p&gt;Timothy's Pug source code!&lt;/p&gt;"</span></div><div class="line"></div><div class="line"><span class="hljs-comment">// Render another set of data</span></div><div class="line"><span class="hljs-built_in">console</span>.log(compiledFunction(&#123;</div><div class="line">  <span class="hljs-attr">name</span>: <span class="hljs-string">'Forbes'</span></div><div class="line">&#125;))</div><div class="line"></div><div class="line"><span class="hljs-comment">// "&lt;p&gt;Forbes' Pug source code!&lt;/p&gt;"</span></div></pre></td></tr></table></figure>
<p>Pug also provides the <code>pug.render()</code> family of functions that combine compileing and rendering into one step. However, the template function will be re-compiled every time <code>render</code> is called, which might impact performance. Alternatively, you can use the <code>cache</code> option with <code>render</code>, which will automatically store the compiled function into an internal cache.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">const</span> pug = <span class="hljs-built_in">require</span>(<span class="hljs-string">'pug'</span>)</div><div class="line"></div><div class="line"><span class="hljs-comment">// Compile template.pug and render a set of data</span></div><div class="line"><span class="hljs-built_in">console</span>.log(pug.renderFile(<span class="hljs-string">'template.pug'</span>, &#123;</div><div class="line">  <span class="hljs-attr">name</span>: <span class="hljs-string">'Timothy'</span></div><div class="line">&#125;))</div></pre></td></tr></table></figure>
<h3 id="Use-with-Express"><a href="#Use-with-Express" class="headerlink" title="Use with Express"></a>Use with Express</h3><p>Pug fully integrates with <code>Express</code>, as a supported view engine.</p>
<h4 id="Production-Defaults"><a href="#Production-Defaults" class="headerlink" title="Production Defaults"></a>Production Defaults</h4><p>In Express, the environmental variables <code>NODE_ENV</code> is designed to inform the web application of the execution environment: whether it is in development or in production. Express and Pug automatically modify the defaults of a few options in production environment, to provide a better out-of-the-box experience for users.</p>
<p>Specifically, when <code>process.env.NODE_ENV</code> is set to <code>&#39;production&#39;</code>, and Pug is used with Express, the <code>compileDebug</code> option is <code>false</code> by default, while the <code>cache</code> option is <code>true</code>.</p>
<h3 id="API-Reference"><a href="#API-Reference" class="headerlink" title="API Reference"></a>API Reference</h3><p>All API mehtods accept the following set of options:</p>
<ul>
<li><p>filename: string</p>
<p>The name of the file being compiled. Used in exceptions, and required for relative <code>include</code> and <code>extend</code>. Default to <code>Pug</code></p>
</li>
<li><p>basedir: string</p>
<p>The root directory of all absolute inclusion</p>
</li>
<li><p>doctype: string</p>
<p>If the <code>doctype</code> is not specified as part of the template, you can specify it here. It is sometimes useful to get self-closing tags and remove mirroring of boolean attributes.</p>
</li>
<li><p>filters: object</p>
<p>Hash table of custom filters. Default to <code>undefined</code></p>
</li>
<li><p>self: boolean</p>
<p>Use a <code>self</code> namespaces to hold the locals. It will speed up the compilation, but instead of writing <code>variable</code> you will have to write <code>self.variable</code> to access to property of the locals object. Default to <code>false</code></p>
</li>
<li><p>debug: boolean</p>
<p>If set to <code>true</code>, the tokens and function body are logged to stdout</p>
</li>
<li><p>compileDebug: boolean</p>
<p>If set to <code>true</code>, the function source will be included in the compiled template for better error messages. It is enabled by default, unless used with express in production mode.</p>
</li>
<li><p>globals: Array<string></string></p>
<p>Add a list of global names to make accessible in templates</p>
</li>
<li><p>cache: boolean</p>
<p>If set to <code>true</code>, compiled functions are cached. <code>filename</code> must be set as the cache key. Only applies to <code>render</code> functions. Default to <code>false</code></p>
</li>
<li><p>inlineRuntimeFunctions: boolean</p>
<p>Inline runtime functions instead of <code>require</code>-ing them from a shared version. For <code>compileClient</code> functions, the default is <code>true</code>(so that one does not have include the runtime). For all other compilation or rendering types, the default is <code>false</code></p>
</li>
<li><p>name: string</p>
<p>The name of the template function. Only applies to <code>compileClient</code> function. Default to <code>template</code>.</p>
</li>
</ul>
<h3 id="Methods"><a href="#Methods" class="headerlink" title="Methods"></a>Methods</h3><ul>
<li><p>pug.compile(source[, options])</p>
<p>Compile a Pug template to a function, which can be rendered multiple times with different locals.</p>
<ul>
<li><p>source: string</p>
<p>the source pug template to compile</p>
</li>
<li><p>options: An option object</p>
</li>
<li><p>returns: function</p>
<p>A function to generate the HTML from an object containing locals</p>
</li>
</ul>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">var</span> pug = <span class="hljs-built_in">require</span>(<span class="hljs-string">'pug'</span>)</div><div class="line"><span class="hljs-keyword">var</span> compiledTemplate = pug.compile(<span class="hljs-string">'string of pug'</span>, options)</div><div class="line"></div><div class="line"><span class="hljs-keyword">var</span> html = compiledFunction(locals)</div></pre></td></tr></table></figure>
</li>
<li><p>pug.compileFile(path[, options])</p>
<p>Compile a Pug template from a file to a function, which can be rendered multiple times with different locals.</p>
<ul>
<li><p>path: string</p>
<p>The path to a Pug file</p>
</li>
<li><p>options: An option object</p>
</li>
<li><p>returns: function</p>
<p>A function to generate HTML from an object containing locals</p>
</li>
</ul>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">var</span> pug = <span class="hljs-built_in">require</span>(<span class="hljs-string">'pug'</span>)</div><div class="line"><span class="hljs-keyword">var</span> compiledTemplate = pug.compileFile(<span class="hljs-string">'path to pug file'</span>, options)</div><div class="line"><span class="hljs-keyword">var</span> html = compiledTemplate(locals)</div></pre></td></tr></table></figure>
</li>
<li><p>pug.compileClient(source[, options])</p>
<p>Compile a Pug template to a string of JavaScript, which can be used client side along with Pug runtime.</p>
<ul>
<li><p>source: string</p>
<p>The Pug template to compile</p>
</li>
<li><p>options: an option object</p>
</li>
<li><p>returns: string</p>
<p>A string of JavaScript representing a function</p>
</li>
</ul>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">var</span> pug = <span class="hljs-built_in">require</span>(<span class="hljs-string">'pug'</span>)</div><div class="line"><span class="hljs-keyword">var</span> compiledTemplate = pug.compileClient(<span class="hljs-string">'string of pug'</span>, options)</div><div class="line"><span class="hljs-keyword">var</span> html = compiledTemplate(locals)</div></pre></td></tr></table></figure>
</li>
<li><p>pug.render(source[, options[, callback]])</p>
<ul>
<li><p>source: string</p>
<p>The source pug template to render</p>
</li>
<li><p>options: an options object</p>
</li>
<li><p>callback: function</p>
<p>Node.js-style callback receiving the rendered results. <strong>The callback is called synchronously</strong>.</p>
</li>
<li><p>returns: string</p>
<p>The resulting HTML String</p>
</li>
</ul>
</li>
<li><p>pug.renderFile(path[, options[, callback]])</p>
<ul>
<li><p>path: string</p>
<p>the path to the pug file to render</p>
</li>
<li><p>option: an options object</p>
</li>
<li><p>callback: function</p>
<p>Node.js-style callback receiving the rendered results. <strong>This callback is called synchronously.</strong></p>
</li>
<li><p>returns: function</p>
<p>The resulting HTML stirng</p>
</li>
</ul>
</li>
</ul>
<h3 id="Attributes"><a href="#Attributes" class="headerlink" title="Attributes"></a>Attributes</h3><p>Tag attributes look similar to HTML(with optional commas), but their values are just regular JavaScript.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">a(href=<span class="hljs-string">'google.com'</span>) Google =&gt; <span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"google.com"</span>&gt;</span>Google<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span></div></pre></td></tr></table></figure>
<p>Normal JavaScript expression works fine:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">var</span> authenticated = <span class="hljs-literal">true</span></div><div class="line">body(<span class="hljs-class"><span class="hljs-keyword">class</span></span>=authenticated ? <span class="hljs-string">'authed'</span> : <span class="hljs-string">'anon'</span>) =&gt; <span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"authed"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span></div></pre></td></tr></table></figure>
<h4 id="Multiline-Attributes"><a href="#Multiline-Attributes" class="headerlink" title="Multiline Attributes"></a>Multiline Attributes</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">input(</div><div class="line">  type=<span class="hljs-string">'checkbox'</span></div><div class="line">  name=<span class="hljs-string">'agreement'</span></div><div class="line">  checked</div><div class="line">)</div><div class="line">=&gt; <span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"checkbox"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"agreement"</span> <span class="hljs-attr">checked</span> /&gt;</span></span></div></pre></td></tr></table></figure>
<p>If your JavaScript runtime supports ES6 template strings, you can use that syntax for attributes.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">input(data-json=<span class="hljs-string">`</span></div><div class="line">  &#123;</div><div class="line">    "very-long": "piece of",</div><div class="line">    "data": true</div><div class="line">  &#125;</div><div class="line">`)</div><div class="line">=&gt; <span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">data-json</span>=<span class="hljs-string">"</span></span></span></div><div class="line">  &#123;</div><div class="line">    &amp;quot;very-long&amp;quot;: &amp;quot;piece of &amp;quot;,</div><div class="line">    &amp;quot;data&amp;quot;: true</div><div class="line">  &#125;</div><div class="line">"/&gt;</div></pre></td></tr></table></figure>
<h4 id="Quoted-Attributes"><a href="#Quoted-Attributes" class="headerlink" title="Quoted Attributes"></a>Quoted Attributes</h4><p>If your attribute name contains odd character that might interfere with JavaScript syntax, either quote it using <code>&quot;&quot;</code> or <code>&#39;&#39;</code>, or use commas to separate different attributes.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">div(<span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">'div-class'</span>, (click)=<span class="hljs-string">'play()'</span>)</div><div class="line">div(<span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">'div-class'</span> <span class="hljs-string">'(click)'</span>=<span class="hljs-string">'play()'</span>)</div><div class="line">=&gt; <span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div-class"</span> (<span class="hljs-attr">click</span>)=<span class="hljs-string">"play()"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span></div></pre></td></tr></table></figure>
<h4 id="Attribute-Interpolation"><a href="#Attribute-Interpolation" class="headerlink" title="Attribute Interpolation"></a>Attribute Interpolation</h4><ul>
<li><p>Simply write the attribute in JavaScript:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">var</span> url = <span class="hljs-string">'pub-test.html'</span></div><div class="line">a(href=<span class="hljs-string">'/'</span> + url) Link =&gt; <span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">'/pub-test.html'</span>&gt;</span>Link<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span></div><div class="line"></div><div class="line"><span class="hljs-keyword">var</span> btnType = <span class="hljs-string">'info'</span></div><div class="line"><span class="hljs-keyword">var</span> btnSize = <span class="hljs-string">'lg'</span></div><div class="line">button(type=<span class="hljs-string">'button'</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">`btn btn-<span class="hljs-subst">$&#123;btnType&#125;</span> btn-<span class="hljs-subst">$&#123;btnSize&#125;</span>`</span>)</div><div class="line">=&gt; &lt;button type="button" class="btn btn-info btn-lg"&gt;&lt;button&gt;</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="Boolean-Attributes"><a href="#Boolean-Attributes" class="headerlink" title="Boolean Attributes"></a>Boolean Attributes</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">input(type=<span class="hljs-string">'checkbox'</span> checked) =&gt; &lt;input type="checkbox" checked="checked" /&gt;</div><div class="line">input(type='checkbox' checked=true) =&gt; &lt;input type="checkbox" checked="checked" /&gt;</div><div class="line">input(type='checkbox' checked=false) =&gt; &lt;input type="checkbox" /&gt;</div><div class="line">input(type='checkbox' checked=true.toString()) =&gt; &lt;input type="checkbox" checked="true" /&gt;</div></pre></td></tr></table></figure>
<h4 id="Style-Attributes"><a href="#Style-Attributes" class="headerlink" title="Style Attributes"></a>Style Attributes</h4><p>The style attribute can be a string, like any normal attribute, but it can be an object, which is handy when styles are generated by JavaScript:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">a(style=&#123;<span class="hljs-attr">color</span>: <span class="hljs-string">'red'</span>, <span class="hljs-attr">background</span>: <span class="hljs-string">'green'</span>&#125;) =&gt; <span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"color:red;background:green;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span></div></pre></td></tr></table></figure>
<h4 id="Class-Attributes"><a href="#Class-Attributes" class="headerlink" title="Class Attributes"></a>Class Attributes</h4><p>The <code>class</code> attribute can be a string, like any normal attribute, but is also can be an array of class names, which is handy when generated from JavaScript.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">var</span> classes = [<span class="hljs-string">'foo'</span>, <span class="hljs-string">'bar'</span>, <span class="hljs-string">'baz'</span>]</div><div class="line">a(<span class="hljs-class"><span class="hljs-keyword">class</span></span>=classes) =&gt; <span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"foo bar baz"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span></div><div class="line"></div><div class="line">a.bang(<span class="hljs-class"><span class="hljs-keyword">class</span></span>=classes <span class="hljs-class"><span class="hljs-keyword">class</span></span>=[bing]) =&gt; <span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"bang foo bar baz bing"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span></div></pre></td></tr></table></figure>
<p>It can also be an object which maps class names to <code>true</code> or <code>false</code> values. This is useful for applying conditional classes:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">var</span> currentURL = <span class="hljs-string">'/about'</span></div><div class="line">a(<span class="hljs-class"><span class="hljs-keyword">class</span></span>=&#123;<span class="hljs-attr">active</span>: currentURL === <span class="hljs-string">'/about'</span> href=<span class="hljs-string">'/about'</span>&#125;) =&gt; <span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"active"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span></div></pre></td></tr></table></figure>
<h4 id="Class-Literal"><a href="#Class-Literal" class="headerlink" title="Class Literal"></a>Class Literal</h4><p>Classes may be defined using a <code>.classname</code> syntax:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">a.button =&gt; <span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span></div></pre></td></tr></table></figure>
<p>Since <code>div</code>s are such a common choice of tag, it is default if you omit the tag name:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">.content =&gt; <span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span></div></pre></td></tr></table></figure>
<h4 id="ID-Literal"><a href="#ID-Literal" class="headerlink" title="ID Literal"></a>ID Literal</h4><figure class="highlight hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">a#main-link =&gt; &lt;a id="main-link"&gt;&lt;/a&gt;</div></pre></td></tr></table></figure>
<h4 id="amp-attributes"><a href="#amp-attributes" class="headerlink" title="&amp;attributes"></a>&amp;attributes</h4><p>Pronounced as <code>and attributes</code>, the <code>&amp;attributes</code> syntax can be used to expode an object into attributes of an element:</p>
<figure class="highlight hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dev#foo(data-json="foo")&amp;attributes(&#123;'data-foo': 'bar'&#125;) =&gt; &lt;div id="foo" data-json="foo" data-foo="bar" /&gt;</div></pre></td></tr></table></figure>
<h3 id="Case"><a href="#Case" class="headerlink" title="Case"></a>Case</h3><p>The <code>case</code> statement is a shorthand for JavaScript’s switch, it takes the following form:</p>
<figure class="highlight hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">var friends = 10</div><div class="line">case friends</div><div class="line">  when 0</div><div class="line">    p you have no friends</div><div class="line">  when 1</div><div class="line">    p you have a friend</div><div class="line">  default</div><div class="line">    p you have #&#123;friends&#125; friends</div></pre></td></tr></table></figure>
<h4 id="Case-Fall-Through"><a href="#Case-Fall-Through" class="headerlink" title="Case Fall Through"></a>Case Fall Through</h4><p>You can use fall through, just as you would in a JavaScript <code>switch</code> statement</p>
<figure class="highlight hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">var friends = 0</div><div class="line"></div><div class="line">case friends</div><div class="line">  when 0</div><div class="line">  when 1</div><div class="line">    p you have very few friends</div><div class="line">  default</div><div class="line">    p you have #&#123;friends&#125; friends</div></pre></td></tr></table></figure>
<p>The difference, however, is a fall through in JavaScript happens whenever a <code>break</code> statement is not explicitly included.</p>
<h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><p>Pug allows you to write inline JavaScript code in your templates. There are three types of code: Unbuffered, Buffered, and Unescaped Buffered.</p>
<h4 id="Unbuffered-Code"><a href="#Unbuffered-Code" class="headerlink" title="Unbuffered Code"></a>Unbuffered Code</h4><p>Unbuffered code starts with <code>-</code>. It does not directly add anything to the output</p>
<figure class="highlight hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">- for (var x = 0; x &lt; 3; x++)</div><div class="line">  li item</div><div class="line"></div><div class="line">=&gt;</div><div class="line"></div><div class="line">&lt;li&gt;item&lt;/li&gt;</div><div class="line">&lt;li&gt;item&lt;/li&gt;</div><div class="line">&lt;li&gt;item&lt;/li&gt;</div></pre></td></tr></table></figure>
<p>Pug also supports block unbuffered code:</p>
<figure class="highlight hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">-</div><div class="line">  var list = ['Uno', 'Dos', 'Tres', 'Cuatro', 'Cinco', 'Seis']</div><div class="line">  each item in list</div><div class="line">    li= item</div><div class="line"></div><div class="line">=&gt;</div><div class="line"></div><div class="line">  &lt;li&gt;Uno&lt;/li&gt;</div><div class="line">  &lt;li&gt;Dos&lt;/li&gt;</div><div class="line">  &lt;li&gt;Tres&lt;/li&gt;</div><div class="line">  &lt;li&gt;Cuatro&lt;/li&gt;</div><div class="line">  &lt;li&gt;Cinco&lt;/li&gt;</div><div class="line">  &lt;li&gt;Seis&lt;/li&gt;</div></pre></td></tr></table></figure>
<h4 id="Buffered-Code"><a href="#Buffered-Code" class="headerlink" title="Buffered Code"></a>Buffered Code</h4><p>Buffered code start with <code>=</code>. It evaluates the JavaScript expression and outputs the result. For security, buffered code is first HTML excaped.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">p = <span class="hljs-string">'This code is &lt;escaped&gt;!'</span></div><div class="line"></div><div class="line">=&gt; <span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>This code is &amp;lt;escaped&amp;gt;!<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span></div></pre></td></tr></table></figure>
<p>it can also be written inline with attributes, and supports the full range of JavaScript expression:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p= <span class="hljs-string">'This code is'</span> + <span class="hljs-string">' &lt;escaped&gt;!'</span> =&gt; <span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>This code is &amp;gt;escaped&amp;gt;!<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span></div></pre></td></tr></table></figure>
<h4 id="Unescaped-Buffered-Code"><a href="#Unescaped-Buffered-Code" class="headerlink" title="Unescaped Buffered Code"></a>Unescaped Buffered Code</h4><p>Unescaped buffered code starts with <code>!=</code>. It evaluates the JavaScript expression and outputs the result. Unescaped buffered code does not perform any escaping, so is unsafe for user input.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p != <span class="hljs-string">'This code is &lt;strong&gt;not&lt;/strong&gt; escaped!'</span> =&gt; <span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>This code is <span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>not<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span> escaped!<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span></div></pre></td></tr></table></figure>
<h3 id="Comments"><a href="#Comments" class="headerlink" title="Comments"></a>Comments</h3><p>Buffered comments look the same as single-line JavaScript comments. They act sort of like markup tags, producing <em>HTML</em> comments in the rendered page.</p>
<p>Like tags, buffered comments must appear on their own line:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// just some paragraphs</span></div><div class="line">p foo</div><div class="line">p bar</div><div class="line"></div><div class="line">=&gt;</div><div class="line"></div><div class="line"><span class="hljs-xml"><span class="hljs-comment">&lt;!-- just some paragraph --&gt;</span></span></div><div class="line"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>foo<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></div><div class="line"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>bar<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></div></pre></td></tr></table></figure>
<p>Pug also supports unbuffered comments, Simply ass a hyphen(<code>-</code>) to the start of the comment.</p>
<p>These are only for commenting on the Pug code itself, and <em>do not</em> appear in the rendered HTML.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">//- will not output within markup</span></div><div class="line">p foo</div><div class="line"></div><div class="line">=&gt;</div><div class="line"></div><div class="line"><span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>foo<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span></div></pre></td></tr></table></figure>
<h4 id="Block-Comments"><a href="#Block-Comments" class="headerlink" title="Block Comments"></a>Block Comments</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">body</div><div class="line"><span class="hljs-comment">//- Comments for your templates writers.</span></div><div class="line">    Use <span class="hljs-keyword">as</span> much text <span class="hljs-keyword">as</span> you want</div><div class="line"><span class="hljs-comment">// Comments for your HTML readers</span></div><div class="line">    Use <span class="hljs-keyword">as</span> much text <span class="hljs-keyword">as</span> you want</div></pre></td></tr></table></figure>
<h3 id="Conditionals"><a href="#Conditionals" class="headerlink" title="Conditionals"></a>Conditionals</h3><p>Pug’s first-class conditional syntax allows for optional parenthese.</p>
<figure class="highlight hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">- var user = &#123; description: 'foo bar baz '&#125;</div><div class="line">- var authorized = false</div><div class="line">#user</div><div class="line">  if user.description</div><div class="line">    h2.green Description</div><div class="line">    p.description= user.description</div><div class="line">  else if authorized</div><div class="line">    h2.blue Description</div><div class="line">    p.description.</div><div class="line">      User has no description</div><div class="line">      why not add one...</div><div class="line">  else</div><div class="line">    h2.red Description</div><div class="line">    p.description User has no description</div></pre></td></tr></table></figure>
<p>Pug also provides the conditional <code>unless</code> which works like a negated <code>if</code>. The following are equivalent:</p>
<figure class="highlight hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">unless user.isAnonymous</div><div class="line">  p You're logged in as #&#123;user.name&#125;</div><div class="line"></div><div class="line">=</div><div class="line"></div><div class="line">if !user.isAnonymous</div><div class="line">  p You're logged in as #&#123;user.name&#125;</div></pre></td></tr></table></figure>
<h3 id="Filters"><a href="#Filters" class="headerlink" title="Filters"></a>Filters</h3><h3 id="Include"><a href="#Include" class="headerlink" title="Include"></a>Include</h3><p>Include allow you to insert the contents of one Pug file into another.</p>
<figure class="highlight hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">// index.pug</div><div class="line">doctype html</div><div class="line">html</div><div class="line">  include includes/head.pug</div><div class="line">  body</div><div class="line">    h1 My Site</div><div class="line">    p Welcome to my super lame site</div><div class="line">    include includes/foot.pug</div><div class="line"></div><div class="line">// includes/head.pug</div><div class="line">head</div><div class="line">  title My Site</div><div class="line">  script(src='/javascripts/jquery.js')</div><div class="line">  script(src='/javascripts/app.js')</div><div class="line"></div><div class="line">// includes/foot.pug</div><div class="line">footer#footer</div><div class="line">  p Copyright (c) foobar</div></pre></td></tr></table></figure>
<p>If the path is absolute(e.g. <code>include /root.pug</code>), it is resolved by prepending <code>options.basedir</code>.</p>
<p>If no file extension is given, <code>.pug</code> is automatically appended to the file name.</p>
<h4 id="Including-Plain-Text"><a href="#Including-Plain-Text" class="headerlink" title="Including Plain Text"></a>Including Plain Text</h4><p>Including non-Pug files simply includes their raw text.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// index.pug</span></div><div class="line">doctype html</div><div class="line">html</div><div class="line">  head</div><div class="line">    style</div><div class="line">      include style.css</div><div class="line">    body</div><div class="line">      h1 My Site</div><div class="line">      p Welcome to my <span class="hljs-keyword">super</span> lame site</div><div class="line">      script</div><div class="line">        include script.js</div><div class="line"><span class="hljs-comment">// style.css</span></div><div class="line">h1 &#123;</div><div class="line">  <span class="hljs-attr">color</span>: red;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-comment">// script.js</span></div><div class="line"><span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Yor are awesome'</span>)</div></pre></td></tr></table></figure>
<h3 id="Template-Inheritance"><a href="#Template-Inheritance" class="headerlink" title="Template Inheritance"></a>Template Inheritance</h3><p>Pug supports template inheritance. Template instance works via <code>block</code> and <code>extends</code> keyword.</p>
<p>In a template, a <code>block</code> is simply a ‘block’ of Pug that a child template may replace. This process is recursive.</p>
<p>Pug blocks can provide default content, if appropriate. Providing default content is purely optional, though. The example below defines <code>block scripts</code>, <code>block content</code> and <code>block foot</code></p>
<figure class="highlight hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">// layout.pug</div><div class="line">html</div><div class="line">  head</div><div class="line">    title My Site - #&#123;title&#125;</div><div class="line">    block scripts</div><div class="line">      script(src='/jquery.js')</div><div class="line">  body</div><div class="line">    block content</div><div class="line">    block foot</div><div class="line">      #footer</div><div class="line">        p some footer content</div></pre></td></tr></table></figure>
<p>To extend this layout, create a new file and use the <code>extends</code> directive with a path to the parent template(if no file extension is given, <code>.pug</code> is automatically appended to the file name). Then define one or more blocks to override the parent block content.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// page-a.pug</span></div><div class="line">extends layout.pug</div><div class="line"></div><div class="line">block scripts</div><div class="line">  script(src=<span class="hljs-string">"/jquery.js"</span>)</div><div class="line">  script(src=<span class="hljs-string">"/pets.js"</span>)</div><div class="line"></div><div class="line">block content</div><div class="line">  h1= title</div><div class="line">  - <span class="hljs-keyword">var</span> pets = [<span class="hljs-string">'cat'</span>, <span class="hljs-string">'dog'</span>]</div><div class="line">  each petName <span class="hljs-keyword">in</span> pets</div><div class="line">    include pet.pug</div></pre></td></tr></table></figure>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// pet.pug</span></div><div class="line">p= petName</div></pre></td></tr></table></figure>
<h3 id="Block-append-prepend"><a href="#Block-append-prepend" class="headerlink" title="Block append/prepend"></a>Block append/prepend</h3><p>Pug allows you to <code>replace</code>, <code>prepend</code> and <code>append</code> blocks</p>
<p>Suppose you have default scripts in a <code>head</code> block that you wish to use on <em>every page</em> you might do this:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// layout.pug</span></div><div class="line">html</div><div class="line">  head</div><div class="line">   block head</div><div class="line">    script(src=<span class="hljs-string">"/vendor/jquery.js"</span>)</div><div class="line">    script(src=<span class="hljs-string">"/vendor/caustic.js"</span>)</div><div class="line">  body</div><div class="line">    block content</div><div class="line"></div><div class="line"><span class="hljs-comment">// page.pug</span></div><div class="line">extends layout</div><div class="line"></div><div class="line">append head</div><div class="line">  script(src=<span class="hljs-string">"/vendor/three.js"</span>)</div></pre></td></tr></table></figure>
<h3 id="Interpolation"><a href="#Interpolation" class="headerlink" title="Interpolation"></a>Interpolation</h3><h4 id="String-Interpolation-Escaped"><a href="#String-Interpolation-Escaped" class="headerlink" title="String Interpolation, Escaped"></a>String Interpolation, Escaped</h4><p>Consider the placement of the following tempalte’s locals: <code>title</code>, <code>author</code> and <code>theGreat</code></p>
<figure class="highlight hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">- var title = 'On Dogs'</div><div class="line">- var author = 'enlore'</div><div class="line">- var theGreat = '&lt;span&gt;escaped!&lt;/span&gt;'</div><div class="line"></div><div class="line">h1= title</div><div class="line">p Written by #&#123;author&#125;</div><div class="line">p This will be safe: #&#123;theGreat&#125;</div></pre></td></tr></table></figure>
<p>This can be valid JavaScript expression, so you can do whatever feels good.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">- <span class="hljs-keyword">var</span> msg = <span class="hljs-string">'not my inside voice'</span></div><div class="line">p This is $&#123;msg.toUpperCase()&#125;</div></pre></td></tr></table></figure>
<h3 id="String-Interpolation-Unescaped"><a href="#String-Interpolation-Unescaped" class="headerlink" title="String Interpolation, Unescaped"></a>String Interpolation, Unescaped</h3><p>You don’t have to play it safe, you can buffer unescaped values into your templates too</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">- <span class="hljs-keyword">var</span> riskyBusiness = <span class="hljs-string">'&lt;em&gt;Some of the girts&lt;/em&gt;'</span></div><div class="line">.quote</div><div class="line">  p joel: !&#123;riskyBusiness&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>Keep in mind that buffering unescaped content into your templates can be mighty risky if that content comes fresh from your users.</p>
</blockquote>
<h4 id="Tag-Interpolation"><a href="#Tag-Interpolation" class="headerlink" title="Tag Interpolation"></a>Tag Interpolation</h4><p>Interpolation works not only on JavaScript values, but on Pug as well, just use the tag interpolation syntax like so:</p>
<figure class="highlight hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p.</div><div class="line">  Interpolate #[strong strongly word] there</div></pre></td></tr></table></figure>
<h4 id="Whitespace-Control"><a href="#Whitespace-Control" class="headerlink" title="Whitespace Control"></a>Whitespace Control</h4><p>The tag interpolation syntax is especially useful for inline tags, where whitespace before and after the tag is significant.</p>
<p>By default, however, Pug removes all spaces before and after tags.</p>
<h3 id="Iteration"><a href="#Iteration" class="headerlink" title="Iteration"></a>Iteration</h3><p>Pug supports two primary methods of iteration: <code>each</code> and <code>while</code></p>
<h4 id="each"><a href="#each" class="headerlink" title="each"></a>each</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">ul</div><div class="line">  each val, index <span class="hljs-keyword">in</span> [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]</div><div class="line">    li=  index + <span class="hljs-string">': '</span> + val</div><div class="line"></div><div class="line">ul</div><div class="line">  each val, index <span class="hljs-keyword">in</span> &#123;<span class="hljs-number">1</span>: <span class="hljs-string">'one'</span>, <span class="hljs-number">2</span>: <span class="hljs-string">'two'</span>&#125;</div><div class="line">    li= index + <span class="hljs-string">': '</span> + val</div><div class="line"></div><div class="line">- <span class="hljs-keyword">var</span> values = []</div><div class="line">ul</div><div class="line">  each val <span class="hljs-keyword">in</span> values.length ? values : [<span class="hljs-string">'There is no value'</span>]</div><div class="line">    li= val</div><div class="line"></div><div class="line">ul</div><div class="line">  each val <span class="hljs-keyword">in</span> values</div><div class="line">    li= val</div><div class="line">  <span class="hljs-keyword">else</span></div><div class="line">    li There is no value</div></pre></td></tr></table></figure>
<h4 id="While"><a href="#While" class="headerlink" title="While"></a>While</h4><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">- <span class="hljs-keyword">var</span> n = <span class="hljs-number">0</span></div><div class="line">ul</div><div class="line">  <span class="hljs-keyword">while</span> n &lt; <span class="hljs-number">4</span></div><div class="line">    li= n++</div></pre></td></tr></table></figure>
<h3 id="Mixins"><a href="#Mixins" class="headerlink" title="Mixins"></a>Mixins</h3><p>Mixins allow you to create reusable blocks of Pug</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// Declaration</span></div><div class="line">mixin list</div><div class="line">  ul</div><div class="line">    li foo</div><div class="line">    li bar</div><div class="line">    li baz</div><div class="line"></div><div class="line"><span class="hljs-comment">// Use</span></div><div class="line">+list</div><div class="line">+list</div></pre></td></tr></table></figure>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">mixin pet(name)</div><div class="line">  li.pet= name</div><div class="line"></div><div class="line">ul</div><div class="line">  +pet(<span class="hljs-string">'cat'</span>)</div><div class="line">  +pet(<span class="hljs-string">'dog'</span>)</div><div class="line"></div><div class="line">=&gt;</div><div class="line"><span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span></span></div><div class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"pet"</span>&gt;</span>cat<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></div><div class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"pet"</span>&gt;</span>dog<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></div><div class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></div></pre></td></tr></table></figure>
<h4 id="Mixin-Attributes"><a href="#Mixin-Attributes" class="headerlink" title="Mixin Attributes"></a>Mixin Attributes</h4><p>Mixins also get an implicit <code>attributes</code> argument, which is taken from the attributes passed to the mixin</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">mixin link(href, name)</div><div class="line">  a(<span class="hljs-class"><span class="hljs-keyword">class</span>!</span>=attributes.class href=href)= name</div><div class="line"></div><div class="line">+link(<span class="hljs-string">'/foo'</span>, <span class="hljs-string">'foo'</span>)(<span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">"btn"</span>)</div><div class="line">=&gt;</div><div class="line"><span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"foo"</span>&gt;</span>foo<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span></div></pre></td></tr></table></figure>
<blockquote>
<p>Note: The values in <code>attributes</code> by default are already escaped, you should use <code>!=</code> to avoid escaping them a secondtime.</p>
</blockquote>
<h4 id="Rest-Arguments"><a href="#Rest-Arguments" class="headerlink" title="Rest Arguments"></a>Rest Arguments</h4><p>You can write mixins that takes an unknown number of arguments using the <code>rest arguments</code> syntax</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">mixin list(id, ...items)</div><div class="line">  ul(id=id)</div><div class="line">    each item <span class="hljs-keyword">in</span> items</div><div class="line">      li= item</div><div class="line"></div><div class="line">+list(<span class="hljs-string">'my-list'</span>, <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>)</div></pre></td></tr></table></figure>
<h3 id="Plain-Text"><a href="#Plain-Text" class="headerlink" title="Plain Text"></a>Plain Text</h3><p>Pug provides four ways of getting <em>plain text</em></p>
<h4 id="Inline-in-a-Tag"><a href="#Inline-in-a-Tag" class="headerlink" title="Inline in a Tag"></a>Inline in a Tag</h4><p>The easiest way to add plain text is <em>inline</em>. The first term on the line is the tag itsel. Everything after the tag and one space will be the text content of that tag.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p This is plain old &lt;em&gt;text&lt;<span class="hljs-regexp">/em&gt; content.</span></div></pre></td></tr></table></figure>
<h4 id="Literal-HTML"><a href="#Literal-HTML" class="headerlink" title="Literal HTML"></a>Literal HTML</h4><p>Whole lines are also treated as plain text when they begin with a left angle bracket (&lt;), which may occasionally be useful for writing literal HTML tags in places that could otherwise be inconvenient.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;html&gt;</div><div class="line">body</div><div class="line">  p Indenting the body tag there will make no difference</div><div class="line">  p HTML itself isn not whitespace-sensitive</div><div class="line">&lt;<span class="hljs-regexp">/html&gt;</span></div></pre></td></tr></table></figure>
<h4 id="Piped-Text"><a href="#Piped-Text" class="headerlink" title="Piped Text"></a>Piped Text</h4><p>Another way to add plain text to templates is to prefix a line with a pipe character (<code>|</code>). This method is useful for mixing plain text with inline tag.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">p</div><div class="line">  | The pipe always goes at the beginning <span class="hljs-keyword">of</span> its own line,</div><div class="line">  | not counting indentation.</div><div class="line">=&gt;</div><div class="line"><span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>The pipe always goes at the beginning of its own line, not counting indentation.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span></div></pre></td></tr></table></figure>
<h4 id="Block-in-a-Tag"><a href="#Block-in-a-Tag" class="headerlink" title="Block in a Tag"></a>Block in a Tag</h4><p>Often you might want large blocks of text wihtin a tag. To do this, just add a <code>.</code> right after the tag name, or after the closing parenthesis, if the tag has attributes.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">script.</div><div class="line">  if (usingPug)</div><div class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'You are awesome'</span>)</div><div class="line">  <span class="hljs-keyword">else</span></div><div class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'use pug'</span>)</div></pre></td></tr></table></figure>
<h3 id="Tags"><a href="#Tags" class="headerlink" title="Tags"></a>Tags</h3><p>By default, text at the start of a line (or after only white space) represents an HTML tag. Indented tags are nested.</p>
<p>To save space, Pug provides an inline syntax for nested tags.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">a: <span class="hljs-function"><span class="hljs-params">img</span> =&gt;</span> &lt;a&gt;<span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span></div></pre></td></tr></table></figure>
<p>self-closing tag</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">foo/ =&gt; &lt;foo /&gt;</div><div class="line">foo(bar='baz')/ =&gt; &lt;foo bar="baz" /&gt;</div></pre></td></tr></table></figure>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-28T12:30:03.000Z">2017-08-28</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    a minute read (About 166 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/28/mix-blend-mode/">Mix-Blend-Mode</a>
            
        </h1>
        <div class="content">
            <figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  mix-blend-mode: normal;</div><div class="line">  mix-blend-mode: multiply;</div><div class="line">  mix-blend-mode: screen;</div><div class="line">  mix-blend-mode: overlay;</div><div class="line">  mix-blend-mode: darken;</div><div class="line">  mix-blend-mode: lighten;</div><div class="line">  mix-blend-mode: color-dodge;</div><div class="line">  mix-blend-mode: color-burn;</div><div class="line">  mix-blend-mode: soft-light;</div><div class="line">  mix-blend-mode: hard-light;</div><div class="line">  mix-blend-mode: difference;</div><div class="line">  mix-blend-mode: exclusion;</div><div class="line">  mix-blend-mode: hue;</div><div class="line">  mix-blend-mode: saturation;</div><div class="line">  mix-blend-mode: color;</div><div class="line">  mix-blend-mode: luminosity;</div><div class="line">  mix-blend-mode: initial;</div><div class="line">  mix-blend-mode: inherit;</div><div class="line">  mix-blend-mode: unset;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="http://images2015.cnblogs.com/blog/608782/201705/608782-20170509102239519-1109457397.png" alt=""></p>
<h3 id="mix-blend-mode-screen"><a href="#mix-blend-mode-screen" class="headerlink" title="mix-blend-mode: screen"></a>mix-blend-mode: screen</h3><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// pug</span></div><div class="line">.container</div><div class="line">  - <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">3</span>; i++)</div><div class="line">    .box</div></pre></td></tr></table></figure>
<figure class="highlight scss hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-variable">$count</span>: <span class="hljs-number">3</span>;</div><div class="line"><span class="hljs-variable">$bgcolorlist</span>: <span class="hljs-number">#0801fb</span> <span class="hljs-number">#1ffe27</span> <span class="hljs-number">#fd1a20</span>;</div><div class="line"><span class="hljs-selector-tag">body</span> &#123;</div><div class="line">  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#291f34</span>;</div><div class="line">&#125;</div><div class="line"><span class="hljs-selector-class">.container</span> &#123;</div><div class="line">  <span class="hljs-attribute">position</span>: absolute;</div><div class="line">  <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;</div><div class="line">  <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;</div><div class="line">  <span class="hljs-attribute">top</span>: <span class="hljs-number">50%</span>;</div><div class="line">  <span class="hljs-attribute">left</span>: <span class="hljs-number">50%</span>;</div><div class="line">  trasnform: translate(-<span class="hljs-number">50%</span>, -<span class="hljs-number">50%</span>);</div><div class="line">&#125;</div><div class="line"><span class="hljs-selector-class">.box</span> &#123;</div><div class="line">  <span class="hljs-attribute">position</span>: absolute;</div><div class="line">  <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;</div><div class="line">  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;</div><div class="line">  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;</div><div class="line">  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;</div><div class="line">  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;</div><div class="line">  <span class="hljs-attribute">transform-origin</span>: <span class="hljs-number">48%</span> <span class="hljs-number">48%</span>;</div><div class="line">  mix-blend-mode: screen;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@<span class="hljs-keyword">for</span> <span class="hljs-variable">$i</span> from 1 through <span class="hljs-variable">$count</span> &#123;</div><div class="line">  <span class="hljs-selector-class">.box</span>:nth-child(#&#123;<span class="hljs-variable">$i</span>&#125;) &#123;</div><div class="line">    <span class="hljs-attribute">background-color</span>: nth($不过colorlist, $i);</div><div class="line">    <span class="hljs-attribute">animation</span>: turn <span class="hljs-number">3s</span> linear #&#123;<span class="hljs-number">1</span>-<span class="hljs-variable">$i</span>&#125;s infinite;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@keyframes turn &#123;</div><div class="line">  to &#123;</div><div class="line">    <span class="hljs-attribute">transform</span>: rotate(<span class="hljs-number">360deg</span>);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-27T15:43:20.000Z">2017-08-27</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    2 minutes read (About 272 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/27/Start-at-Headless/">Start at Headless</a>
            
        </h1>
        <div class="content">
            <p>Run Chrome without chrome, it brings all modern web platform features provided by Chromium and the Blink rendering engine to the command line.</p>
<p>A headless browser is a great tool for automated testing and server environments where you don’t need a visible UI shell.</p>
<h3 id="Starting-Headless-CLI"><a href="#Starting-Headless-CLI" class="headerlink" title="Starting Headless (CLI)"></a>Starting Headless (CLI)</h3><p>The easiest way to get started with headless mode is to open the Chrome binary from the command line. If you’ve got Chrome 59+ installed, start Chrome with the <code>-- headless</code> flag:</p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">chrome \</div><div class="line">  --headless \  <span class="hljs-comment"># Runs Chrome in headless mode</span></div><div class="line">  --disable-gpu \ <span class="hljs-comment"># Temporarily needed for now</span></div><div class="line">  --remote-debugging-port=9222 \</div><div class="line">  https://www.chromestatus.com <span class="hljs-comment"># URL to open. Defaults to about:blank</span></div></pre></td></tr></table></figure>
<p><code>chrome</code> should point to your installation of Chrome.</p>
<h3 id="Command-line-features"><a href="#Command-line-features" class="headerlink" title="Command line features"></a>Command line features</h3><p>In some cases, you may not need to programmatically script Headless Chrome. There are some useful command line flags to perform common tasks.</p>
<h4 id="Printing-the-DOM"><a href="#Printing-the-DOM" class="headerlink" title="Printing the DOM"></a>Printing the DOM</h4><p>The <code>--dump-dom</code> flag prints <code>document.body.innerHTML</code> to stdout:</p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">chrome --headless --disable-gpu --dump-dom https://www.chromestatus.com/</div></pre></td></tr></table></figure>
<h4 id="Create-a-PDF"><a href="#Create-a-PDF" class="headerlink" title="Create a PDF"></a>Create a PDF</h4><p>The <code>--print-to-pdf</code> flag creates a PDF of the page</p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">chrome --headless --disable-gpu --print-to-pdf https://chromestatus.com/</div></pre></td></tr></table></figure>
<h4 id="Taking-screenshots"><a href="#Taking-screenshots" class="headerlink" title="Taking screenshots"></a>Taking screenshots</h4><p>To capture a screenshot of a page, use the <code>--screenshot</code> flag:</p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">chrome --headless --disable-gpu --screenshot https://chromestatus.com/</div><div class="line"></div><div class="line"><span class="hljs-comment"># Size of a standard letterhead.</span></div><div class="line">chrome --headless -disable-gpu --screenshot --window-size=1280,1696 https://chromestatus.com/</div></pre></td></tr></table></figure>
<h3 id="REPL-mode"><a href="#REPL-mode" class="headerlink" title="REPL mode"></a>REPL mode</h3><p>The <code>--repl</code> flag runs Headless in a mode where you can evaluate JS expression in the browser, right from the command line:</p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">chrome --headless --disable-gpu --repl https://chromestatus.com/</div><div class="line"></div><div class="line">&gt;&gt;&gt; location.href</div><div class="line">&#123;<span class="hljs-string">"result"</span>:&#123;<span class="hljs-string">"type"</span>:<span class="hljs-string">"string"</span>,<span class="hljs-string">"value"</span>:<span class="hljs-string">"https://www.chromestatus.com/features"</span>&#125;&#125;</div><div class="line">&gt;&gt;&gt; quit</div></pre></td></tr></table></figure>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-24T02:19:44.000Z">2017-08-24</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    3 minutes read (About 387 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/24/Node-js-child-process/">Node.js Child_process</a>
            
        </h1>
        <div class="content">
            <p>Node.js runs in single-threaded, event-driven mode, which is good for improving performance via multiple child process.</p>
<p>Each child process has three stream objects:</p>
<ul>
<li><p><code>child.stdin</code></p>
</li>
<li><p><code>child.stdout</code></p>
</li>
<li><p><code>child.stderr</code></p>
</li>
</ul>
<p>All these three stream objects may share their parent’s <code>stdio</code>, or set to use their own stream object independently.</p>
<p>Node.js offers <code>child_process</code> module to create new child process:</p>
<ul>
<li><p><code>exec</code> – <code>child_process.exec</code> use child process to execute shell command, and buffer the output for callback. This means the <code>exec</code> will buffer the whole returned value in buffer, usually you should limit the buffer in 200k, if not, the process will exit with <code>Error: maxBuffer exceeded</code>.</p>
</li>
<li><p><code>spawn</code> – <code>child_process.spawn</code> use command line to create new process. spawn will return a <strong>stream object</strong> with <code>stdout</code> and <code>stderr</code>. We can use <code>stdout</code> stream to read the data returned from child process. <code>stdout</code> has event handles like <code>data</code>, <code>end</code>. You can use <code>spawn</code> when a large data will returned from child process.</p>
</li>
<li><p><code>fork</code> – <code>child_process.fork</code> is the <code>spawn</code> in special mode(specify <code>node</code> to run the command). <code>fork(&#39;./son.js&#39;)</code> equals to <code>spawn(&#39;node&#39;, [&#39;./son.js&#39;])</code>. Different from <code>spawn</code>, <code>fork</code> will build a message pipe between main and child process.</p>
</li>
</ul>
<h3 id="exec"><a href="#exec" class="headerlink" title="exec"></a>exec</h3><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">const</span> exec = <span class="hljs-built_in">require</span>(<span class="hljs-string">'child_process'</span>).exec</div><div class="line">exec(<span class="hljs-string">'dir'</span>, &#123;<span class="hljs-attr">encoding</span>: <span class="hljs-string">'utf-u'</span>&#125;, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, stdout, stderr</span>) </span>&#123;</div><div class="line">  <span class="hljs-keyword">if</span> (err) &#123;</div><div class="line">    <span class="hljs-built_in">console</span>.log(err.stack)</div><div class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Error Code: '</span> + err.code)</div><div class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Signal Received: '</span> + err.signal)</div><div class="line">  &#125;</div><div class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'data: '</span> + stdout)</div><div class="line">&#125;).on(<span class="hljs-string">'exit'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">code</span>) </span>&#123;</div><div class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'child process exit with code: '</span> + code)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="spawn"><a href="#spawn" class="headerlink" title="spawn"></a>spawn</h3><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">const</span> spawn = <span class="hljs-built_in">require</span>(<span class="hljs-string">'child_process'</span>).spawn</div><div class="line"><span class="hljs-keyword">const</span> spawnedProcess = spawn(<span class="hljs-string">'ping'</span>, [<span class="hljs-string">'127.0.0.1'</span>], &#123; <span class="hljs-attr">encoding</span>: <span class="hljs-string">'utf-8'</span>&#125;)</div><div class="line"></div><div class="line">spawnedProcess.stdout.on(<span class="hljs-string">'data'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">chunk</span>) </span>&#123;</div><div class="line">  <span class="hljs-built_in">console</span>.log(chunk.toString())</div><div class="line">&#125;)</div><div class="line"></div><div class="line">spawnedProcess.stderr.on(<span class="hljs-string">'data'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) </span>&#123;</div><div class="line">  <span class="hljs-built_in">console</span>.log(data)</div><div class="line">&#125;)</div><div class="line"></div><div class="line">spawnedProcess.on(<span class="hljs-string">'close'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">code</span>) </span>&#123;</div><div class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'close code: '</span> + code)</div><div class="line">&#125;)</div><div class="line"></div><div class="line">spawnedProcess.on(<span class="hljs-string">'exit'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">code</span>) </span>&#123;</div><div class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'exit code: '</span> + code)</div><div class="line">  fs.close(fd, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) </span>&#123;</div><div class="line">    <span class="hljs-keyword">if</span> (err) &#123;</div><div class="line">      <span class="hljs-built_in">console</span>.error(err)</div><div class="line">    &#125;</div><div class="line">  &#125;)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="fork"><a href="#fork" class="headerlink" title="fork"></a>fork</h3><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// parent.js</span></div><div class="line"><span class="hljs-built_in">console</span>.log(<span class="hljs-string">'parent pid: '</span> + process.pid)</div><div class="line"><span class="hljs-keyword">const</span> fork = <span class="hljs-built_in">require</span>(<span class="hljs-string">'child_process'</span>).fork</div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> child = fork(<span class="hljs-string">'./child.js'</span>)</div><div class="line"><span class="hljs-built_in">console</span>.log(<span class="hljs-string">'fork return pid: '</span> + child.pid)</div><div class="line">child.on(<span class="hljs-string">'message'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">msg</span>) </span>&#123;</div><div class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'parent recieve message: '</span> + <span class="hljs-built_in">JSON</span>.stringify(msg))</div><div class="line">&#125;)</div><div class="line">child.send(&#123;</div><div class="line">  <span class="hljs-attr">key</span>: <span class="hljs-string">'parent value'</span>,</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="hljs-comment">// child.js</span></div><div class="line"><span class="hljs-built_in">console</span>.log(<span class="hljs-string">'child pid: '</span> + process.pid)</div><div class="line">process.on(<span class="hljs-string">'message'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">msg</span>) </span>&#123;</div><div class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'child recieve message: '</span> + msg)</div><div class="line">&#125;)</div><div class="line">process.send(&#123;</div><div class="line">  <span class="hljs-attr">key</span>: <span class="hljs-string">'child value'</span>,</div><div class="line">&#125;)</div></pre></td></tr></table></figure>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-22T06:51:20.000Z">2017-08-22</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    17 minutes read (About 2552 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/22/Node-Child-Process/">Node Child Process</a>
            
        </h1>
        <div class="content">
            <p><img src="https://cdn-images-1.medium.com/max/2000/1*I56pPhzO1VQw8SIsv8wYNA.png" alt=""></p>
<p>Single-threaded, non-blocking performance in Node works great for a single process. But eventually, one process in one CPU is not going to be enough to handle the increasing workload of your application.</p>
<p>Using multiple processes is the best way to scale a Node application. Node is designed for building distributed applications with many nodes.</p>
<h3 id="The-Child-Process-Module"><a href="#The-Child-Process-Module" class="headerlink" title="The Child Process Module"></a>The Child Process Module</h3><p>We can easily spin a child process using Node’s <code>child_process</code> module and those child processes can easily communicate with each other with a messaging system.</p>
<p>The <code>child_process</code> module enables us to access Operating System functionalities by running any system command inside child process.</p>
<p>We can control that child process input stream, and listen to its output stream. We can also control the arguments to be passed to the underlying OS command, and we can do whatever we want with that command’s output.</p>
<p>There are four different ways to create a child process in Node: <code>spawn()</code>, <code>fork()</code>, <code>exec()</code>, <code>execFile()</code>.</p>
<h3 id="Spawned-Child-Process"><a href="#Spawned-Child-Process" class="headerlink" title="Spawned Child Process"></a>Spawned Child Process</h3><p>The <code>spawn</code> function launches a command in a new process and we can use it to pass that command any arguments. For example, here’s code to spawn a new process that will execute the <code>pwd</code> command.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">const</span> &#123; spawn &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">'child_process'</span>)</div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> child = spawn(<span class="hljs-string">'pwd'</span>)</div></pre></td></tr></table></figure>
<p>We simply destructure the <code>spawn</code> function out of the <code>child_process</code> module and execute it with the OS command as the first argument.</p>
<p>The result of executing the <code>spawn</code> function (the <code>child</code> object above) is a <code>ChildProcess</code> instance, which implements the <code>EventEmitter API</code>. This means we can register handlers for events on this child object directly. For example, we can do something when the child process exits by registering a handler for the <code>exit</code> event.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">child.on(<span class="hljs-string">'exit'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">code, signal</span>) </span>&#123;</div><div class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'child process exited with '</span> + <span class="hljs-string">`code <span class="hljs-subst">$&#123;code&#125;</span> and signal <span class="hljs-subst">$&#123;signal&#125;</span>`</span>)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>The handler above gives us the exit <code>code</code> for the child process and the <code>signal</code>, if any, that was used to terminate the child process. This <code>signal</code> variable is null when the child process exits normally.</p>
<p>The other events that we can register handlers for with the <code>ChildProcess</code> instances are <code>disconnect</code>, <code>error</code>, <code>close</code>, <code>message</code>.</p>
<ul>
<li><p>The <code>disconnect</code> event is emitted when the parent process manually calls the <code>child.disconnect</code> function.</p>
</li>
<li><p>The <code>error</code> event is emitted if the process could not be spawned or killed.</p>
</li>
<li><p>The <code>close</code> event is emitted when the <code>stdio</code> streams of a child process get closed.</p>
</li>
<li><p>The <code>message</code> event is the most important one. It’s emitted when the child process uses the <code>process.send()</code> function to send messages. This is how parent/child processes can communicate with each other.</p>
</li>
</ul>
<p>Every child process also gets the three standard <code>stdio</code> streams, which we can access using <code>child.stdin</code>, <code>child.stdout</code>, <code>child.stderr</code>.</p>
<p>When those streams get closed, the child process that was using them will emit the <code>close</code> event. This <code>close</code> event is different than the <code>exit</code> event because multiple child processes might share the same <code>stdio</code> streams and so one child process exiting does not mean that the streams got closed.</p>
<p>Since all streams are event emitters, we can listen to different events on those <code>stdio</code> stream that are attached to every child process. Unlike in a normal process though, in a child process, the <code>stdout</code>/<code>stderr</code> streams are readable streams while the <code>stdin</code> stream is a writable one. This is basically the inverse of those types as found in a main process. The events we can use for those streams are the standard ones. Most importantly, on the readable streams, we can listen to the <code>data</code> event, which will have the output of the command or any errorencoutered while executing the command:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">child.stdout.on(<span class="hljs-string">'data'</span>, (data) =&gt; &#123;</div><div class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`child stdout:\n<span class="hljs-subst">$&#123;data&#125;</span>`</span>)</div><div class="line">&#125;)</div><div class="line"></div><div class="line">child.stderr.on(<span class="hljs-string">'data'</span>, (data) =&gt; &#123;</div><div class="line">  <span class="hljs-built_in">console</span>.error(<span class="hljs-string">`child \n<span class="hljs-subst">$&#123;data&#125;</span>`</span>)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>The two handlers above will log both cases to the main process <code>stdout</code> and <code>stderr</code>. When we execute the <code>spawn</code> function above, the output of the <code>pwd</code> command gets printed and the child process exits with code <code>0</code>, which means no error occured.</p>
<p>We can pass arguments to the command that’s executed by the <code>spawn</code> function using the second argument of the <code>spawn</code> function, which is an array of all the arguments to be passed to the command.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">const</span> child = spawn(<span class="hljs-string">'find'</span>, [<span class="hljs-string">'.'</span>, <span class="hljs-string">'-type'</span>, <span class="hljs-string">'f'</span>])</div></pre></td></tr></table></figure>
<p>If an error occurs during the execution of the command, for example, if we give find an invalid destination above, the <code>child.stderr</code> <code>data</code> event handler will be triggered and the <code>exit</code> event handler will report an exit code of <code>1</code>, which signifies that an error has occured.</p>
<p>A child process <code>stdin</code> is a writable stream. We can use it to send a command some input. Just like any writable stream, the easiest way to consume it is using the <code>pipe</code> function. We simply pipe a readable stream into a writable stream. SInce the main process <code>stdin</code> is a readable stream, we can pipe that into a child process <code>stdin</code> stream.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">const</span> &#123; spawn &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">'child_process'</span>)</div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> child = spawn(<span class="hljs-string">'wc'</span>)</div><div class="line"></div><div class="line">process.stdin.pipe(child.stdin)</div><div class="line"></div><div class="line">child.stdout.on(<span class="hljs-string">'data'</span>, (data) =&gt; &#123;</div><div class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`child stdout:\n<span class="hljs-subst">$&#123;data&#125;</span>`</span>)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>In the example above, the child process invokes the <code>wc</code> command, which count lines, words, and characters in Linux. When we pipe the main process <code>stdin</code>(which is a readable stream) into the child process <code>stdin</code>(which is a writable stream). The result of this combination is that we get a standard input mode where we can type somthing and when we hit <code>Ctrl + D</code>, what we typed will be used as the input of the <code>wc</code> command.</p>
<p>We can also pipe the standard input/output of multiple processes on each other, just like we can do with Linux commands. For example, we can pipe the <code>stdout</code> of the <code>find</code> command to the <code>stdin</code> of the <code>wc</code> command to count all the files in the current directory:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">const</span> &#123; spawn &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">'child_process'</span>)</div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> find = spawn(<span class="hljs-string">'find'</span>, [<span class="hljs-string">'.'</span>, <span class="hljs-string">'-type'</span>, <span class="hljs-string">'f'</span>])</div><div class="line"><span class="hljs-keyword">const</span> wc = spawn(<span class="hljs-string">'wc'</span>, [<span class="hljs-string">'-l'</span>])</div><div class="line"></div><div class="line">find.stdout.pipe(wc.stdin)</div><div class="line"></div><div class="line">wc.stdout.on(<span class="hljs-string">'data'</span>, (data) =&gt; &#123;</div><div class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Number of files <span class="hljs-subst">$&#123;data&#125;</span>`</span>)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>Add <code>-l</code> to the <code>wc</code> command to make it count only the lines.</p>
<h3 id="Shell-Syntax-and-the-exec-Function"><a href="#Shell-Syntax-and-the-exec-Function" class="headerlink" title="Shell Syntax and the exec Function"></a>Shell Syntax and the exec Function</h3><p>By default, the <code>spawn</code> function does not create a <em>shell</em> to execute the command we pass into it. This makes it slightly more efficient than the <code>exec</code> function, which does create a shell. The <code>exec</code> function has one other major difference. It <em>buffers</em> the command’s generated output and passes the whole output value to a callback function(instead of using streams, which is what <code>spawn</code> does).</p>
<p>Here the is previous <code>find | wc</code> example implemented with an <code>exec</code> function.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">const</span> &#123; exec &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">'child_process'</span>)</div><div class="line"></div><div class="line">exec(<span class="hljs-string">'find . -type  f | wc -l'</span>, (err, stdout, stderr) =&gt; &#123;</div><div class="line">  <span class="hljs-keyword">if</span> (err) &#123;</div><div class="line">    <span class="hljs-built_in">console</span>.error(<span class="hljs-string">`exec error: <span class="hljs-subst">$&#123;err&#125;</span>`</span>)</div><div class="line">    <span class="hljs-keyword">return</span></div><div class="line">  &#125;</div><div class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Number of files <span class="hljs-subst">$&#123;stdout&#125;</span>`</span>)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>Since the <code>exec</code> function uses a shell to execute the command, we can use the <code>shell syntax</code> directly here making use of the <code>shell pipe</code> feature.</p>
<p>Note that using the shell syntax comes at a <code>security risk</code> if you’re executing any kind of dynamic input provided externally. A user can simply do a command injection attrack using shell syntax characters like ; and $(For example, <code>commnd + &#39;; rm -rf ~&#39;</code>)</p>
<p>The <code>exec</code> function buffers the output and passes it to the callback function(the second argument to <code>exec</code>) as the <code>stdout</code> argument there. This <code>stdout</code> argument is the command’s output that we want to print out.</p>
<p>The <code>exec</code> function is a good choice if you need to use the shell syntax and if the size of the data expected from te command is small(Remember <code>exec</code> will buffer the whole data in memory before returning it).</p>
<p>The <code>spawn</code> function is a much better choice when the size of the data expected from the command is large, because that data will be streamed with the standard IO objects.</p>
<p>We can make the spawned child process inherit the standard IO object of its parents if we want to, but also, more importantly, we can ke the <code>spawn</code> function use the shell syntax as well. Here’s the smae <code>find | wc</code> command implemented with the <code>spawn</code>.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">const</span> child = spawn(<span class="hljs-string">'find . -type f'</span>, &#123;</div><div class="line">  <span class="hljs-attr">stdio</span>: <span class="hljs-string">'inherit'</span>,</div><div class="line">  <span class="hljs-attr">shell</span>: <span class="hljs-literal">true</span>,</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>Because of the <code>stdio: &#39;inherit&#39;</code> option above, when we execute the code, the child process inherits the main process <code>stdin</code>, <code>stdout</code> and <code>stderr</code>. This causes the child process data events handlers to be triggered on the main <code>process.stdout</code> stream, making the script output the result right away.</p>
<p>Because of the <code>shell: true</code> option above, we were able to use the shell syntax in the passed command, just like we did with <code>exec</code>. But with this code, we still get the advantage of the streaming of data that the <code>spawn</code> function gives us. <em>THis is really the best of both worlds</em>.</p>
<p>There are a few other good options we can use in the last argument to the <code>child_process</code> function besides <code>shell</code> and <code>stdio</code>. We can, for example, use the <code>cwd</code> option to change the working directory of the script.</p>
<p>Another option we can use is the <code>env</code> option to specify the environment variables that will be visible to the new child process. The default for this option is <code>process.env</code> which gives any command access to the current process environment. If we want ot override that behavior, we can simple pass an empty object as the <code>env</code> option or new value there to be considered as the only environment variables:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">const</span> child = spawn(<span class="hljs-string">'echo $ANSWER'</span>, &#123;</div><div class="line">  <span class="hljs-attr">stdio</span>: <span class="hljs-string">'inherit'</span>,</div><div class="line">  <span class="hljs-attr">shell</span>: <span class="hljs-literal">true</span>,</div><div class="line">  <span class="hljs-attr">env</span>: &#123;</div><div class="line">    <span class="hljs-attr">ANSWER</span>: <span class="hljs-number">12</span>,</div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>The echo command above does not have access to the parent process’s environment variables. It can’t, for example, access <code>$HOME</code>, but it can accccess <code>$ANSWER</code> because it was passes as a custom environement variable through the <code>env</code> option.</p>
<p>One last important child process option to explain here is the <code>detached</code> option, which makes the child process run independently of its parent process.</p>
<p>Assuming we have a file <code>timer.js</code> that keeps the event loop busy:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</div><div class="line">  <span class="hljs-comment">// keep the event loop busy</span></div><div class="line">&#125;, <span class="hljs-number">20000</span>)</div></pre></td></tr></table></figure>
<p>We can execute it in the background using the <code>detached</code> option:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">const</span> &#123; spawn &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">'child_process'</span>)</div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> child = spawn(<span class="hljs-string">'node'</span>, [<span class="hljs-string">'timer.js'</span>], &#123;</div><div class="line">  <span class="hljs-attr">detached</span>: <span class="hljs-literal">true</span>,</div><div class="line">  <span class="hljs-attr">stdio</span>: <span class="hljs-string">'ignore'</span>,</div><div class="line">&#125;)</div><div class="line"></div><div class="line">child.unref()</div></pre></td></tr></table></figure>
<p>The exact behavior of detached child process depends on the OS. On windows, the detached child process will have its own console window while on Linux the detached child process will be made the leader of a new process groups and session.</p>
<p>It the <code>unref</code> function is called on the detached process, the parent process can exit independently of the child. This can be useful if the child is executing a long-running process, but to keep it running in the background the child’s <code>stdio</code> configurations also have to be independent of the parent.</p>
<p>The example above will run a node script(timer.js) in the background by detaching and also ignoring its parent <code>stdio</code> file descriptors so that the parent can terminate while the child keeps running in the background.</p>
<h3 id="The-execFile-function"><a href="#The-execFile-function" class="headerlink" title="The execFile function"></a>The execFile function</h3><p>If you need to execute a file without using a shell, the <code>execFile</code> function is what you need. It behaves exactly like the <code>exec</code> function, but does not use a shell, which makes it a bit more efficient. On windows, some files cannot be executed on their own, like <code>.bat</code>, <code>.cmd</code> files. Those files cannot be executed with <code>execFile</code> and either <code>exec</code> or <code>spawn</code> with shell set to true is required to execute them.</p>
<h3 id="The-Sync-Function"><a href="#The-Sync-Function" class="headerlink" title="The *Sync Function"></a>The *Sync Function</h3><p>The functions <code>spawn</code>, <code>exec</code>, <code>execFile</code> from the <code>child_process</code> module also have synchronous blocking versions that will wait until child process exits.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">const</span> &#123;</div><div class="line">  spawnSync,</div><div class="line">  execSync,</div><div class="line">  execFileSync,</div><div class="line">&#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">'child_process'</span>)</div></pre></td></tr></table></figure>
<h3 id="The-fork-function"><a href="#The-fork-function" class="headerlink" title="The fork() function"></a>The fork() function</h3><p>THe <code>fork</code> function is a variation of the <code>spawn</code> function for spawning node processes. The biggest difference between <code>spawn</code> and <code>fork</code> is that a communication channel is established to the child process when using <code>fork</code>, so we can use the <code>send</code> function on the forked along with the global <code>process</code> object itself to exchange messsages between the parent and forked processes. We do this through the <code>EventEmitter</code> module interface.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// parent.js</span></div><div class="line"><span class="hljs-keyword">const</span> &#123; fork &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">'child_process'</span>)</div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> forked = fork(<span class="hljs-string">'child.js'</span>)</div><div class="line"></div><div class="line">forked.on(<span class="hljs-string">'message'</span>, (msg) =&gt; &#123;</div><div class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Message from child'</span>, msg)</div><div class="line">&#125;)</div><div class="line"></div><div class="line">forked.send(&#123;</div><div class="line">  <span class="hljs-attr">hello</span>: <span class="hljs-string">'world'</span>,</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="hljs-comment">// child.js</span></div><div class="line"></div><div class="line">process.on(<span class="hljs-string">'message'</span>, (msg) =&gt; &#123;</div><div class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Message from parent:'</span>, msg)</div><div class="line">&#125;)</div><div class="line"><span class="hljs-keyword">let</span> counter = <span class="hljs-number">0</span></div><div class="line"></div><div class="line">setInterval(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</div><div class="line">  process.send(&#123;</div><div class="line">    <span class="hljs-attr">counter</span>: counter++</div><div class="line">  &#125;)</div><div class="line">&#125;, <span class="hljs-number">1000</span>)</div></pre></td></tr></table></figure>
<p>In the parent.js we fork <code>child.js</code>(<strong>which will execute the file with the <code>node</code> command</strong>) and then we listen for the <code>message</code> event. The <code>message</code> event will be emitted whenever the child use <code>process.send</code>.</p>
<p>The pass down messages from the parent to the child, we can execute the <code>send</code> function one the forked object it self, and then, in the child script we can listen to the <code>message</code> event on the global <code>process</code>.</p>
<p>When executing the <code>parent.js</code> file, it’ll first send down the <code>{hello: &#39;world&#39;}</code> object to be printed by the forked child process and then the forked child process will send an incremental counter value every second to be printed by the parent process.</p>
<p>Let’s do more practical example about the <code>fork</code> function.</p>
<p>Let’s say we have an http server that handles two endpoints. One of these endpoints(<code>/compute</code> below) is computationally expensive and will take a few seconds to complete. WE can use a long for loop to simulate that:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>)</div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> longComputation = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</div><div class="line">  <span class="hljs-keyword">let</span> sum = <span class="hljs-number">0</span></div><div class="line">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1e9</span>; i++) &#123;</div><div class="line">    sum += i</div><div class="line">  &#125;</div><div class="line">  <span class="hljs-keyword">return</span> sum</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> server = http.createServer()</div><div class="line"></div><div class="line">server.on(<span class="hljs-string">'request'</span>, (req, res) =&gt; &#123;</div><div class="line">  <span class="hljs-keyword">if</span> (req.url === <span class="hljs-string">'/compute'</span>) &#123;</div><div class="line">    <span class="hljs-keyword">const</span> sum = longComputation()</div><div class="line">    <span class="hljs-keyword">return</span> res.end(<span class="hljs-string">`Sum is <span class="hljs-subst">$&#123;sum&#125;</span>`</span>)</div><div class="line">  &#125; <span class="hljs-keyword">else</span> &#123;</div><div class="line">    res.end(<span class="hljs-string">'OK'</span>)</div><div class="line">  &#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line">server.listen(<span class="hljs-number">3000</span>)</div></pre></td></tr></table></figure>
<p>The program has a big problem: when the <code>/compute</code> endpoint is requested, the server will not be able to handle any other requests because the event loop is busy with the long for loop operation.</p>
<p>There are a few ways which we can solve this problem depending on the nature of the long operation but one solution that works for all operation is to just move the computational operation into another process using <code>fork</code>.</p>
<p>We first move the whole <code>longComputation</code> function into its own file and make it invoke that function when instructed via a message from the main process:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// compute.js</span></div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> longComputatioin  = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</div><div class="line">  <span class="hljs-keyword">let</span> sum = <span class="hljs-number">0</span></div><div class="line">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1e9</span>; i++) &#123;</div><div class="line">    sum += i;</div><div class="line">  &#125;</div><div class="line">  <span class="hljs-keyword">return</span> sum</div><div class="line">&#125;</div><div class="line"></div><div class="line">process.on(<span class="hljs-string">'message'</span>, (msg) =&gt; &#123;</div><div class="line">  <span class="hljs-keyword">const</span> sum = longComputatioin()</div><div class="line">  process.send(sum)</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="hljs-comment">// server.js</span></div><div class="line"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>)</div><div class="line"><span class="hljs-keyword">const</span> &#123; fork &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">'child_process'</span>)</div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> server = http.createServer()</div><div class="line"></div><div class="line">server.on(<span class="hljs-string">'request'</span>, (req, res) =&gt; &#123;</div><div class="line">  <span class="hljs-keyword">if</span> (req.url === <span class="hljs-string">'/compute'</span>) &#123;</div><div class="line">    <span class="hljs-keyword">const</span> compute = fork(<span class="hljs-string">'compute.js'</span>)</div><div class="line">    compute.send(<span class="hljs-string">'start'</span>)</div><div class="line">    compute.on(<span class="hljs-string">'message'</span>, sum =&gt; &#123;</div><div class="line">      res.end(<span class="hljs-string">`Sum is <span class="hljs-subst">$&#123;sum&#125;</span>`</span>)</div><div class="line">    &#125;)</div><div class="line">  &#125; <span class="hljs-keyword">else</span> &#123;</div><div class="line">    res.end(<span class="hljs-string">'OK'</span>)</div><div class="line">  &#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line">server.listen(<span class="hljs-number">3000</span>)</div></pre></td></tr></table></figure>
<p>When a request to <code>/compute</code> happens now with the above code, we simply send a message to the forked process to start executing the long operation. The main process’s event loop will not be blocked.</p>
<p>Once the forked process is done with the long operation, it can send its result back to the parent process using <code>process.send</code>.</p>
<p>Node’s <code>cluster</code> module is based on this idea of child process forking and load balancing the requests among the many forks.</p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-08-22T03:42:52.000Z">2017-08-22</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    20 minutes read (About 3006 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/08/22/Scaling-Node-js-App/">Scaling Node.js App</a>
            
        </h1>
        <div class="content">
            <h3 id="Strategies-of-Scalability"><a href="#Strategies-of-Scalability" class="headerlink" title="Strategies of Scalability"></a>Strategies of Scalability</h3><p>The workload is the most popular reason we scale our applications, but it’s not the only reason. We also scale our applications to increase their availability and tolerance to failure.</p>
<h4 id="Cloning"><a href="#Cloning" class="headerlink" title="Cloning"></a>Cloning</h4><p>The easiest thing to do to scale a big application is to clone it mulitple times and have each cloned instance handle part of the workload(with a load balancer). This does not cost a lot in term of development time and it’s highly effective. This strategy is the minimum you should do and Node.js has the built-in module, <code>cluster</code>, to make is easier for you to implement the cloning strategy on a single server.</p>
<h4 id="Decomposing"><a href="#Decomposing" class="headerlink" title="Decomposing"></a>Decomposing</h4><p>We can also scale an application by decomposiing it based on functionalities and services. This means having mulitple, different applications with different code bases and sometimes with their own dedicated databases and User Interfaces.</p>
<p>This strategy is commonly associated with the term <strong>Microservice</strong>, where micro indicates that those services should be small as possible, but in reality, the size of the service is not what’s important but rather the enforement of loose coupling and high cohesion between services.</p>
<h4 id="Splitting"><a href="#Splitting" class="headerlink" title="Splitting"></a>Splitting</h4><p>We can also split the application into multiple instances where each instance is responsible for only a part of the application’s data. This strategy is often named <strong>horizontal partitioning</strong>, or <strong>sharding</strong>, in database. Data partitioning requires a lookup step before each operation to determine which instance of the application to use.</p>
<p>Successfully scaling a big application should eventually implement all three strategies.</p>
<h3 id="The-Cluster-Module"><a href="#The-Cluster-Module" class="headerlink" title="The Cluster Module"></a>The Cluster Module</h3><p>The cluster module can be used to enable load balancing over an environement’s multiple CPU cores. It’s based on the child process module <code>fork</code> method and it basically allows us to fork the main application process as many times as we have CPU cores. It will then take over and load balance all requests to the main process across all forked processs.</p>
<p>The cluster module is Node’s helper for us to implement the cloning scalability strategy, but only on one machine. When you have a big machine with a lot resources or when it’s easier and cheaper to add more resources to one machine ratherthan adding new machine, the cluster module is a greate option for a really quick implementation of the cloning strategy.</p>
<p>Even small machines usually have multiple cores and even if you’re not worried about the load on your Node server, you should enable the cluster module anyway to increase your server availability and fault-tolerance.</p>
<p>It’s a simple step and when using a process manager like PM2, for example, it becomes as simple as just providing an argument to the launch command.</p>
<p>The structure of what the cluster module does is simple. We create a <em>master process</em> and that master process <em>forks</em> a number of <em>worker processes</em> and manage them. Each worker process represents an instance of the application that we want to scale. All incoming requests are handled by the master process, which is the one that decides which worker process should handle the incoming request.</p>
<p><img src="https://cdn-images-1.medium.com/max/1000/1*C7ICI8d7aAna_zTZvZ64MA.png" alt=""></p>
<p>The master process’s job is easy because it actually just uses a <em>round-robin</em> algorithm to pick a worker process. This is enabled by default on all platform except windows and it can be globally modified to let the load-balancing be handled by the operation system self.</p>
<p>The round-robin algorithm distributes the load evenly across all available processes on a rotational basis. The first request is forwarded to the first worker process, the second to the next worker process in the list, and so on. When the end of the list is reached, the algorithm starts again from the beginning.</p>
<h3 id="Load-Balancing-an-HTTP-Server"><a href="#Load-Balancing-an-HTTP-Server" class="headerlink" title="Load-Balancing an HTTP Server"></a>Load-Balancing an HTTP Server</h3><p>Let’s clone and load balance a simple HTTP server using the cluster module.</p>
<p>Here’s the simple Node’s hello-world example server slightly modified to simulate some CPU work before responding:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// server.js</span></div><div class="line"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>)</div><div class="line"><span class="hljs-keyword">const</span> pid = process.pid</div><div class="line"></div><div class="line">http.createServer(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</div><div class="line">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1e7</span>; i++) &#123;</div><div class="line">    <span class="hljs-comment">// simulate CPU work</span></div><div class="line">  &#125;</div><div class="line">  res.end(<span class="hljs-string">`Handled by process <span class="hljs-subst">$&#123;pid&#125;</span>`</span>)</div><div class="line">&#125;).listen(<span class="hljs-number">8080</span>, () =&gt; &#123;</div><div class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Started process <span class="hljs-subst">$&#123;pid&#125;</span>`</span>)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>Before we create a cluster to clone this server into multiple workers, let’s do a simple benchmark of how many requests this server can handle per second. We can use <strong>Apache benchmarking tool</strong> for that.</p>
<p>After running the simple <code>server.js</code> code above, run this <code>ab</code> command:</p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ab -c200 http://localhost:8080/</div></pre></td></tr></table></figure>
<p>This command will test-load the server with 200 concurrent connections for 10 seconds.</p>
<p><img src="https://cdn-images-1.medium.com/max/1000/1*w8VmzV81atlTzHn7pDXu1g.png" alt=""></p>
<p>The single node server was able to handle about 51 requests per seconds.</p>
<p>Now that we have a reference benchmark, we can scale the application with the cloning strategy using the cluster module.</p>
<p>On the same level as the <code>server.js</code> file above, we can create a new file(<code>cluster.js</code>) <strong>for the master process</strong> with this content:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// cluster.js</span></div><div class="line"><span class="hljs-keyword">const</span> cluster = <span class="hljs-built_in">require</span>(<span class="hljs-string">'cluster'</span>)</div><div class="line"><span class="hljs-keyword">const</span> os = <span class="hljs-built_in">require</span>(<span class="hljs-string">'os'</span>)</div><div class="line"></div><div class="line"><span class="hljs-keyword">if</span> (cluster.isMaster) &#123;</div><div class="line">  <span class="hljs-keyword">const</span> cpu = os.cpus().length</div><div class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Forking for <span class="hljs-subst">$&#123;cpu&#125;</span> CPUS`</span>)</div><div class="line">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; cpus; i++) &#123;</div><div class="line">    cluster.fork()</div><div class="line">  &#125;</div><div class="line">&#125; <span class="hljs-keyword">else</span> &#123;</div><div class="line">  <span class="hljs-built_in">require</span>(./server)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>In <code>cluster.js</code>, we first required both the <code>cluster</code> module and the <code>os</code> module, we use the <code>os</code> module to read the number of CPUS cores we can work with using <code>os.cpus()</code>.</p>
<p>The <code>cluster</code> module gives us the handy Boolean flag <code>isMaster</code> to determine if this <code>cluster.js</code> file is being loaded as a master process or not. The first time we execute this file, we will be executing the master process and that <code>isMaster</code> flag will be set to true. In this case, we can instruct the master process to fork our server as many times as we have CPU cores.</p>
<p>Now we just read the number of CPUs we have using the <code>os</code> module, then with a for loop over that number, we call the <code>cluster.fork</code> method. The for loop will simple create as many workers as the number of CPUs in the system to take advantage of all the available processing power.</p>
<p>When the <code>cluster.fork</code> line is executed from the master process, the current file, <code>cluster.js</code>, is run again, but this time in <em>worker mode</em> with the <code>isMaster</code> flag set to false.</p>
<p><em>There is actually another flag set to true in this case if you need to use it, which is the <code>isWorker</code></em> flag.</p>
<p>When the application runs as a worker, it can start doing the actual work. This is where we need to define our server logic, which, for this example, we can do by requiring the <code>server.js</code> file that we already have.</p>
<p>That’s basically it. That’s how easy it is to take advantage of all the processing power in a machine. To test the cluster, run the <code>cluster.js</code> file.</p>
<p><img src="https://cdn-images-1.medium.com/max/800/1*c0S-W4GYgCGB_maJ94ZLPw.png" alt=""></p>
<p>It’s important to understand that these are completely different Node.js processes. Each worker process here will have its own event loop and memory space.</p>
<p>When we now hit the web server multiple times, the requests will start to get handled by different worker processes with different process ids. The worker will not be exactly rotated in sequence because the cluster module performs some optimizations when picking the next worker, but the load will be somehow distributed among the different worker process.</p>
<p>We can use the same <code>ab</code> command above to load-test this cluster of processes:</p>
<p><img src="https://cdn-images-1.medium.com/max/1000/1*5_EogHG-Egf2uAMOj9PmCA.png" alt=""></p>
<p>Now the cluster can handle 181 requests per seconds.</p>
<h3 id="Broadcasting-Messages-to-All-Workers"><a href="#Broadcasting-Messages-to-All-Workers" class="headerlink" title="Broadcasting Messages to All Workers"></a>Broadcasting Messages to All Workers</h3><p>Communicating between the master process and the workers is simple because under the hood the cluster module is just using the <code>child_process.fork</code> API, which means we also have communication channels available between the master process and each workers.</p>
<p>Based on the <code>server.js</code>/<code>cluster.js</code> example above, we can access the list of worker objects using <code>cluster.workers</code>, which is an object that holds a reference to all workers and can be used to read information about these workers. Since we have communication channels between master process and all workers, to broadcast a message to all them we just need a simple loop over all the workers:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-built_in">Object</span>.values(cluster.workers).forEach(<span class="hljs-function"><span class="hljs-params">worker</span> =&gt;</span> &#123;</div><div class="line">  worker.send(<span class="hljs-string">`Hello Worker <span class="hljs-subst">$&#123;worker.pid&#125;</span>`</span>)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>We simple used <code>Object.values</code> to get an array of all workers from the <code>cluster.workers</code> object. Then for each worker we can use the <code>send</code> function to send over any value that we want.</p>
<p>In a worker file, <code>server.js</code> in our example, to read a message received from this master process, we can register a handler for the <code>message</code> event on the global <code>process</code> object:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">process.on(<span class="hljs-string">'message'</span>, (msg) =&gt; &#123;</div><div class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Message from master: <span class="hljs-subst">$&#123;msg&#125;</span>`</span>)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p><img src="https://cdn-images-1.medium.com/max/1000/1*6XfoWiNKTCiDjqar7L5_xw.png" alt=""></p>
<p>Every worker received a message from the master process. <em>Note how the workers did not start in order</em>.</p>
<p>Let’s make this communication example a little bit more practical. Let’s say we want our server to reply with the number of users we have created in our database. We will create a mock function that returns the number of users we have in the database and just have it square its value every time it’s called:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// **** Mock DB Call</span></div><div class="line"><span class="hljs-keyword">const</span> numberOfUsersInDB = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;</div><div class="line">  <span class="hljs-keyword">this</span>.count = <span class="hljs-keyword">this</span>.count || <span class="hljs-number">5</span></div><div class="line">  <span class="hljs-keyword">this</span>.count = <span class="hljs-keyword">this</span>.count * <span class="hljs-keyword">this</span>.count</div><div class="line">  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.count</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Every time <code>numberOfUsersInDB</code> is called, we’ll assume that a database connection has been made.</p>
<p>In the master process mode, we can use the same loop to broadcast the users count value to all workers:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// Right After the fork loop within the isMaster=true block</span></div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> updateWorkers = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</div><div class="line">  <span class="hljs-keyword">const</span> usersCount = numberOfUsersInDB()</div><div class="line">  <span class="hljs-built_in">Object</span>.values(cluster.workers).forEach(<span class="hljs-function"><span class="hljs-params">worker</span> =&gt;</span> &#123;</div><div class="line">    worker.send(&#123;</div><div class="line">      usersCount,</div><div class="line">    &#125;)</div><div class="line">  &#125;)</div><div class="line">&#125;</div><div class="line"></div><div class="line">updateWorkers()</div><div class="line">setInterval(updateWorkers, <span class="hljs-number">10000</span>)</div></pre></td></tr></table></figure>
<p>Here we’re invoking <code>updateWorkers</code> for the first time and then invoking it every 10 seconds using a <code>setInterval</code>. This way, every 10 seconds, all workers will receive the new user count value over the process communication channel and only one database connection will be made.</p>
<p>In the server code, we can use the <code>userCount</code> value using the same <code>message</code> event handler. We can simply cache that value with a module global variable and use it anywhere we want.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>)</div><div class="line"><span class="hljs-keyword">const</span> pid = process.pid</div><div class="line"></div><div class="line"><span class="hljs-keyword">let</span> usersCount</div><div class="line"></div><div class="line">http.createServer(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;</div><div class="line">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1e7</span>; i++);</div><div class="line">  res.write(<span class="hljs-string">`Handled by process: <span class="hljs-subst">$&#123;pid&#125;</span>`</span>)</div><div class="line">  res.end(<span class="hljs-string">`Users: &#123;usersCount&#125;`</span>)</div><div class="line">&#125;).listen(<span class="hljs-number">8080</span>, () =&gt; &#123;</div><div class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Start process <span class="hljs-subst">$&#123;pid&#125;</span>`</span>)</div><div class="line">&#125;)</div><div class="line"></div><div class="line">process.on(<span class="hljs-string">'message'</span>, msg =&gt; &#123;</div><div class="line">  usersCount = msg.usersCount</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>The above code makes the worker web server respond with the cached <code>usersCount</code> value. If you test the cluster code now, during the first 10 seconds you’ll get ‘25’ as the users count from all workers(and only one DB request would be made). Then after another 10 seconds, all workers would start reporting the new user count: 625(and only one DB request would be made).</p>
<p>This is all possible thanks to the communication channels between the master process and all workers.</p>
<h3 id="Increasing-Server-Availability"><a href="#Increasing-Server-Availability" class="headerlink" title="Increasing Server Availability"></a>Increasing Server Availability</h3><p>One of the problems in running a single instance of a Node application is that when that instance crashes, it has to be restarted. This means some downtime between these two actions, even if the process was automated as it should.</p>
<p>This also applies to the case when the server has to be restarted to deploy new code. With one instance, there will be downtime which affects the availability of the system.</p>
<p>When we have multiple instances, the availability of the system can be easily increased with just a few extra lines of code.</p>
<p>To simulate a random crash in the server process, we can simply do a <code>process.exit</code> call inside a timer that fires after a random amount of time:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// In server.js</span></div><div class="line">setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</div><div class="line">  process.exit(<span class="hljs-number">1</span>) <span class="hljs-comment">// death by random timeout</span></div><div class="line">&#125;, <span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">10000</span>)</div></pre></td></tr></table></figure>
<p>When a worker process exits like this, the master process will be notified using the <code>exit</code> event on the <code>cluster</code> model object. We can register a handler for that event and just fork a new worker process when any worker process exits.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// Right after the fork loop within the isMaster=true block</span></div><div class="line"></div><div class="line">cluster.on(<span class="hljs-string">'exit'</span>, (worker, code, signal) =&gt; &#123;</div><div class="line">  <span class="hljs-keyword">if</span> (code !== <span class="hljs-number">0</span> &amp;&amp; !worker.exitedAfterDisconnect) &#123;</div><div class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Worker <span class="hljs-subst">$&#123;worker.id&#125;</span> crashed. Starting a new worker...`</span>)</div><div class="line">    cluster.fork()</div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>It’s good to add the if condition above to make sure the worker process actually crashed and was not manually disconnected or killed by the master process itself.</p>
<p>If the main process is going to kill the worker, it can use the <code>disconnect</code> methods on the worker and in that case, the <code>exitedAfterDisconnect</code> flag will be set to true. The if statement above will guard to not fork a new worker for that case.</p>
<p>If we run the cluster with the handler above(and the random crash in server.js), after a random number of seconds, workers will start to crash and the master process will immediately fork new workers to increase the availability of the system.</p>
<p>You can actually measure the availability using the same <code>ab</code> command and see how many requests the server will not be able to handle overall.</p>
<p><img src="https://cdn-images-1.medium.com/max/1000/1*B72o6QhsyiNnEQU5Wx20RQ.png" alt=""></p>
<h3 id="Zero-downtime-Restarts"><a href="#Zero-downtime-Restarts" class="headerlink" title="Zero-downtime Restarts"></a>Zero-downtime Restarts</h3><p>We have multiple instances running, so instead of restarting them together, we can simply restart them one at a time to allow other workers to continue to serve requests while one worker is being restarted.</p>
<p>Implementing this with the cluster module is easy. Since we don’t want to restart the master process once it’s up, we need a way to send this master process a command to instruct it to start restarting its workers. This is easy on Linux system because we can simply listen to a process signal like <code>SIGUSR2</code>, which we can trigger by using the <code>kill</code> command on the process id and passing that signal:</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-comment">// In Node</span></div><div class="line">process.on(<span class="hljs-string">'SIGUSR2'</span>, () =&gt; &#123; ... &#125;)</div><div class="line"><span class="hljs-comment">// To trigger that</span></div><div class="line">$ kill -SIGUSR2 PID</div></pre></td></tr></table></figure>
<p>This way, the master process will not be killed and we have a way to instruct it to start doing something.</p>
<p><strong><code>SIGUSR2</code> is a proper signal to use here because this will be a user command. If you’re wondering why not <code>SIGUSR1</code>, it’s because Node uses that for its debugger and you want to avoid any conflicts.</strong>.</p>
<p>When the master process receives the <code>SIGUSR2</code> signal, that means it’s time for it to restart its workers, but we want to do that one worker at a time. This simply means the master process should only restart the next worker when it’s done restarting the current one.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">restartWorker</span> = (<span class="hljs-params">workerIndex</span>) =&gt; </span>&#123;</div><div class="line">  <span class="hljs-keyword">const</span> worker = workers[workerIndex]</div><div class="line">  <span class="hljs-keyword">if</span> (!worker) <span class="hljs-keyword">return</span></div><div class="line"></div><div class="line">  worker.on(<span class="hljs-string">'exit'</span>, () =&gt; &#123;</div><div class="line">    <span class="hljs-keyword">if</span> (!worker.exitedAfterDisconnect) <span class="hljs-keyword">return</span></div><div class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Exited process <span class="hljs-subst">$&#123;worker.process.pid&#125;</span>`</span>)</div><div class="line"></div><div class="line">    cluster.fork().on(<span class="hljs-string">'listening'</span>, () =&gt; &#123;</div><div class="line">      restartWorker(workerIndex + <span class="hljs-number">1</span>)</div><div class="line">    &#125;)</div><div class="line">  &#125;)</div><div class="line">  worker.disconnect()</div><div class="line">&#125;</div><div class="line"></div><div class="line">restartWorker(<span class="hljs-number">0</span>)</div></pre></td></tr></table></figure>
<p>Inside the <code>restartWorker</code> function, we got a reference to the worker to be restarted and since we will be calling this function recursively to form a sequence, we need a stop condition. When we no longer have a worker to restart, we can just return.</p>
<p>We then basically want to disconnect this worker (using <code>worker.disconnect</code>), but before restarting the next worker, we need to fork a new worker to replace this current one that we’re disconnecting.</p>
<p>We can use the <code>exit</code> event on the worker itself to fork a new worker when the current one exists, but we have to make sure that the exit action was actually triggered after a normal disconnect call. We can use the <code>exitedAfterDisconnect</code> flag. If this flag is not true, the exit was caused by something else other than our disconnect call and in that case, we should just return and do nothing. But if the flag is set to true, we can go ahead and fork a new worker to replace the one that we’re disconnecting.</p>
<p>When this new forked worker is ready, we can restart the next one.</p>
<p>However, remember that the fork process is not synchronous, so we can’t just restart the next worker after the fork call. Instead, we can monitor the <code>listening</code> event on the newly forked worker, which tells us that this worker is connected and ready. When we get this event, we can safely restart the next worker in sequence.</p>
<p>That’s all we need for a zero-downtime restart.</p>
<p>Process monitors like PM2, make all the tasks we went through so far extremely easy and give a log more features to monitor the health of a Node’s application.</p>
<h3 id="Shared-State-and-Sticky-Load-Balancing"><a href="#Shared-State-and-Sticky-Load-Balancing" class="headerlink" title="Shared State and Sticky Load Balancing"></a>Shared State and Sticky Load Balancing</h3><p>When we load balance a Node application, we lost some features that are only suitable for a single process. This problem is somehow similar to what’s known in other languages as thread safety, which is about sharing data between threads. In our case, it’s sharing data between worker processes.</p>
<p>For example, with a cluster setup, we can no longer cache things in memory because every worker process will have its own memory space, If we cache something in one worker’s memory, other workers will not have access to it.</p>
<p>If we need to cache things with a cluster setup, we have to use a separate entity and read/write to that entity’s API from all workers. This entity can be a database server or if you want to use in-memory cache you can use a server like Redis or create a dedicated Node process with a read/write API for all other workers to communicate with.</p>
<p><img src="https://cdn-images-1.medium.com/max/1000/1*dIR_CAkmtPFgtaGTOKBFkA.png" alt=""></p>
<p>Don’t look at this as a disadvantage, because using a separate entity for your application caching is part of <em>decomposing</em> your app for scalability. You should probably be doing that even if you’re running on a single core machine.</p>

        </div>
        
        
        
    </div>
</div>









    
<div class="card card-transparent">
    <nav class="pagination is-centered" role="navigation" aria-label="pagination">
        <div class="pagination-previous">
            <a class="is-flex-grow has-text-black-ter" href="/page/3/">Previous</a>
        </div>
        <div class="pagination-next">
            <a class="is-flex-grow has-text-black-ter" href="/page/5/">Next</a>
        </div>
        <ul class="pagination-list is-hidden-mobile">
            
            <li><a class="pagination-link has-text-black-ter" href="/">1</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/2/">2</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/3/">3</a></li>
            
            <li><a class="pagination-link is-current" href="/page/4/">4</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/5/">5</a></li>
            
            <li><span class="pagination-ellipsis has-text-black-ter">&hellip;</span></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/16/">16</a></li>
            
        </ul>
    </nav>
</div>
</div>
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered">
                <div>
                    
                        <img class="image is-128x128 has-mb-6" src="/images/avatar.jpg" alt="Keith Chen">
                    
                    
                    <p class="is-size-4 is-block">
                        Keith Chen
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        FE Engineer on Blockchain
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>30°17&#39;37N, 120°9&#39;41E</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Posts
                    </p>
                    <p class="title has-text-weight-normal">
                        308
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Categories
                    </p>
                    <p class="title has-text-weight-normal">
                        7
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Tags
                    </p>
                    <p class="title has-text-weight-normal">
                        92
                    </p>
                </div>
            </div>
        </nav>
        <div class="level">
            <a class="level-item button is-link is-rounded" href="https://github.com/keith-CY" target="_blank">
                Follow</a>
        </div>
        
        
    </div>
</div>
    
        
    
        

<div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Links
        </h3>
        <ul class="menu-list">
        
            <li>
                <a class="level is-mobile" href="https://github.com/keith-CY" target="_blank">
                    <span class="level-left">
                        <span class="level-item">Keith CY</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">github.com</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="https://www.linkedin.com/in/宇-陈-644b61ba" target="_blank">
                    <span class="level-left">
                        <span class="level-item">Yu Chen</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">www.linkedin.com</span>
                    </span>
                </a>
            </li>
        
        </ul>
        </div>
    </div>
</div>


    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Categories
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/Soup/">
            <span class="level-start">
                <span class="level-item">Soup</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Uncategorized/">
            <span class="level-start">
                <span class="level-item">Uncategorized</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/github/">
            <span class="level-start">
                <span class="level-item">github</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">4</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/github/note/">
            <span class="level-start">
                <span class="level-item">note</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/note/">
            <span class="level-start">
                <span class="level-item">note</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">141</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/note/workNote/">
            <span class="level-start">
                <span class="level-item">workNote</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">19</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/workNote/">
            <span class="level-start">
                <span class="level-item">workNote</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">5</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Tag Cloud
        </h3>
        <a href="/tags/AJAX/" style="font-size: 10.91px;">AJAX</a> <a href="/tags/BOOTSTRAP/" style="font-size: 10px;">BOOTSTRAP</a> <a href="/tags/Bash/" style="font-size: 11.82px;">Bash</a> <a href="/tags/BlockChain/" style="font-size: 10px;">BlockChain</a> <a href="/tags/Blockchain/" style="font-size: 10px;">Blockchain</a> <a href="/tags/CORS/" style="font-size: 10px;">CORS</a> <a href="/tags/CSS/" style="font-size: 10.91px;">CSS</a> <a href="/tags/CSS3/" style="font-size: 20px;">CSS3</a> <a href="/tags/Closure/" style="font-size: 10px;">Closure</a> <a href="/tags/CommonJS/" style="font-size: 10px;">CommonJS</a> <a href="/tags/Contract-Ethereum-Web3/" style="font-size: 10px;">Contract, Ethereum, Web3</a> <a href="/tags/Contract-Solidity/" style="font-size: 10px;">Contract, Solidity</a> <a href="/tags/D3-Example/" style="font-size: 10px;">D3, Example</a> <a href="/tags/DAPP-Solidity/" style="font-size: 10px;">DAPP, Solidity</a> <a href="/tags/DApp-Solidity/" style="font-size: 10px;">DApp, Solidity</a> <a href="/tags/DOM/" style="font-size: 12.73px;">DOM</a> <a href="/tags/DevTools/" style="font-size: 10px;">DevTools</a> <a href="/tags/Drizzle-Ethereum-BlockChain/" style="font-size: 10px;">Drizzle, Ethereum, BlockChain</a> <a href="/tags/ES6/" style="font-size: 10.91px;">ES6</a> <a href="/tags/ESLint/" style="font-size: 10px;">ESLint</a> <a href="/tags/ETH-Wallet/" style="font-size: 10px;">ETH, Wallet</a> <a href="/tags/Elixir-Phoenix-SCSS/" style="font-size: 10px;">Elixir, Phoenix, SCSS</a> <a href="/tags/Erlang-Elixir-GenServer/" style="font-size: 10px;">Erlang, Elixir, GenServer</a> <a href="/tags/Ethereum/" style="font-size: 10px;">Ethereum</a> <a href="/tags/Ethereum-IPFS/" style="font-size: 10px;">Ethereum, IPFS</a> <a href="/tags/FP/" style="font-size: 10px;">FP</a> <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/GitHub-Workflow/" style="font-size: 10px;">GitHub, Workflow</a> <a href="/tags/Go-Http-Web/" style="font-size: 10px;">Go, Http, Web</a> <a href="/tags/GraphQL-Apollo-TypeScript/" style="font-size: 10px;">GraphQL, Apollo, TypeScript</a> <a href="/tags/Gulp/" style="font-size: 11.82px;">Gulp</a> <a href="/tags/HTML5/" style="font-size: 15.45px;">HTML5</a> <a href="/tags/HTTP2-Node/" style="font-size: 10px;">HTTP2, Node</a> <a href="/tags/Html-Picture/" style="font-size: 10px;">Html, Picture</a> <a href="/tags/Immutable/" style="font-size: 10px;">Immutable</a> <a href="/tags/Int8Array/" style="font-size: 10px;">Int8Array</a> <a href="/tags/JSON-RPC/" style="font-size: 10px;">JSON-RPC</a> <a href="/tags/JavaScript/" style="font-size: 10px;">JavaScript</a> <a href="/tags/Javascript/" style="font-size: 19.09px;">Javascript</a> <a href="/tags/Koa/" style="font-size: 10.91px;">Koa</a> <a href="/tags/Koa-NPM-Package/" style="font-size: 10px;">Koa, NPM, Package</a> <a href="/tags/MDL/" style="font-size: 16.36px;">MDL</a> <a href="/tags/Material-Design/" style="font-size: 17.27px;">Material Design</a> <a href="/tags/Mock-JavaScript/" style="font-size: 10px;">Mock, JavaScript</a> <a href="/tags/MySQL/" style="font-size: 10px;">MySQL</a> <a href="/tags/NODE/" style="font-size: 13.64px;">NODE</a> <a href="/tags/NPM/" style="font-size: 10.91px;">NPM</a> <a href="/tags/Nginx/" style="font-size: 10px;">Nginx</a> <a href="/tags/Nock/" style="font-size: 10px;">Nock</a> <a href="/tags/Node-CLI/" style="font-size: 10.91px;">Node, CLI</a> <a href="/tags/Node-Fastify/" style="font-size: 10.91px;">Node, Fastify</a> <a href="/tags/Node-Graphql-Koa/" style="font-size: 10px;">Node, Graphql, Koa</a> <a href="/tags/Node-js/" style="font-size: 10.91px;">Node.js</a> <a href="/tags/Phoenix-Elixir-Ecto/" style="font-size: 10px;">Phoenix, Elixir, Ecto</a> <a href="/tags/Promise/" style="font-size: 11.82px;">Promise</a> <a href="/tags/Protobuf/" style="font-size: 10px;">Protobuf</a> <a href="/tags/Pug-HTML/" style="font-size: 10px;">Pug, HTML</a> <a href="/tags/React/" style="font-size: 18.18px;">React</a> <a href="/tags/React-Docker/" style="font-size: 10px;">React, Docker</a> <a href="/tags/React-Router-Code-splitting/" style="font-size: 10px;">React, Router, Code-splitting</a> <a href="/tags/React-Native/" style="font-size: 10px;">React-Native</a> <a href="/tags/React-Redux/" style="font-size: 10px;">React-Redux</a> <a href="/tags/React-Router/" style="font-size: 10.91px;">React-Router</a> <a href="/tags/Redux/" style="font-size: 14.55px;">Redux</a> <a href="/tags/RegExp/" style="font-size: 10px;">RegExp</a> <a href="/tags/Ruby-Rails/" style="font-size: 10px;">Ruby, Rails</a> <a href="/tags/Ruby-Rails-RoR-Mina/" style="font-size: 10px;">Ruby, Rails, RoR, Mina</a> <a href="/tags/Rust-Rocket/" style="font-size: 10px;">Rust, Rocket</a> <a href="/tags/RxJS/" style="font-size: 10px;">RxJS</a> <a href="/tags/Smart-Contract-Web3/" style="font-size: 10px;">Smart Contract, Web3</a> <a href="/tags/Solidity/" style="font-size: 12.73px;">Solidity</a> <a href="/tags/Solidity-Error-Handling/" style="font-size: 10px;">Solidity, Error Handling</a> <a href="/tags/Solidity-Public-External/" style="font-size: 10px;">Solidity, Public, External</a> <a href="/tags/Solidity-Smart-Contract/" style="font-size: 10px;">Solidity, Smart Contract</a> <a href="/tags/Thunk/" style="font-size: 10.91px;">Thunk</a> <a href="/tags/Trick/" style="font-size: 11.82px;">Trick</a> <a href="/tags/Web/" style="font-size: 10px;">Web</a> <a href="/tags/Webpack/" style="font-size: 10px;">Webpack</a> <a href="/tags/Webpack-DLL/" style="font-size: 10px;">Webpack, DLL</a> <a href="/tags/automatic/" style="font-size: 10px;">automatic</a> <a href="/tags/babel/" style="font-size: 10px;">babel</a> <a href="/tags/babel-polyfill/" style="font-size: 10px;">babel-polyfill</a> <a href="/tags/blockchain-bitcoin-bip/" style="font-size: 10.91px;">blockchain, bitcoin, bip</a> <a href="/tags/commandline/" style="font-size: 10px;">commandline</a> <a href="/tags/github/" style="font-size: 10.91px;">github</a> <a href="/tags/jQuery/" style="font-size: 10px;">jQuery</a> <a href="/tags/lecture-yc/" style="font-size: 10px;">lecture, yc</a> <a href="/tags/precache/" style="font-size: 10px;">precache</a> <a href="/tags/shell/" style="font-size: 10px;">shell</a> <a href="/tags/webpack/" style="font-size: 17.27px;">webpack</a> <a href="/tags/webpack2/" style="font-size: 11.82px;">webpack2</a> <a href="/tags/测试/" style="font-size: 11.82px;">测试</a>
    </div>
</div>

    
    
        <div class="column-right-shadow is-hidden-widescreen ">
        
            
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Recent
        </h3>
        
        <article class="media">
            
            <a href="/2019/09/16/Snippet-of-GitHub-Actions/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/gallery/thumbnails/github_actions.png" alt="Snippet of GitHub Actions">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-09-16T07:14:02.000Z">2019-09-16</time></div>
                    <a href="/2019/09/16/Snippet-of-GitHub-Actions/" class="has-link-black-ter is-size-6">Snippet of GitHub Actions</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/08/30/Methods-of-the-String-in-JavaScript/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Methods of the String in JavaScript ">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-08-30T06:26:54.000Z">2019-08-30</time></div>
                    <a href="/2019/08/30/Methods-of-the-String-in-JavaScript/" class="has-link-black-ter is-size-6">Methods of the String in JavaScript </a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/04/20/note-on-bip-173/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/gallery/thumbnails/segwit.png" alt="Note-on-Bip-173">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-04-20T08:36:54.000Z">2019-04-20</time></div>
                    <a href="/2019/04/20/note-on-bip-173/" class="has-link-black-ter is-size-6">Note-on-Bip-173</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/04/17/notes-of-building-product-talking-to-users-and-growing/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="[WIP]notes of Building Product, Talking to Users and Growing">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-04-17T03:32:32.000Z">2019-04-17</time></div>
                    <a href="/2019/04/17/notes-of-building-product-talking-to-users-and-growing/" class="has-link-black-ter is-size-6">[WIP]notes of Building Product, Talking to Users and Growing</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/03/16/keystore/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/gallery/thumbnails/keystore.jpg" alt="Keystore">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-03-16T07:22:16.000Z">2019-03-16</time></div>
                    <a href="/2019/03/16/keystore/" class="has-link-black-ter is-size-6">Keystore</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>

        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Archives
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2019/09/">
                <span class="level-start">
                    <span class="level-item">September 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/08/">
                <span class="level-start">
                    <span class="level-item">August 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/04/">
                <span class="level-start">
                    <span class="level-item">April 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/03/">
                <span class="level-start">
                    <span class="level-item">March 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/11/">
                <span class="level-start">
                    <span class="level-item">November 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/09/">
                <span class="level-start">
                    <span class="level-item">September 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/08/">
                <span class="level-start">
                    <span class="level-item">August 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/07/">
                <span class="level-start">
                    <span class="level-item">July 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/05/">
                <span class="level-start">
                    <span class="level-item">May 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/04/">
                <span class="level-start">
                    <span class="level-item">April 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/03/">
                <span class="level-start">
                    <span class="level-item">March 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/02/">
                <span class="level-start">
                    <span class="level-item">February 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/01/">
                <span class="level-start">
                    <span class="level-item">January 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/12/">
                <span class="level-start">
                    <span class="level-item">December 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/11/">
                <span class="level-start">
                    <span class="level-item">November 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">12</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/10/">
                <span class="level-start">
                    <span class="level-item">October 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/09/">
                <span class="level-start">
                    <span class="level-item">September 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">18</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/08/">
                <span class="level-start">
                    <span class="level-item">August 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">31</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/07/">
                <span class="level-start">
                    <span class="level-item">July 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">19</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/06/">
                <span class="level-start">
                    <span class="level-item">June 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">14</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/05/">
                <span class="level-start">
                    <span class="level-item">May 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">15</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/04/">
                <span class="level-start">
                    <span class="level-item">April 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">9</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/03/">
                <span class="level-start">
                    <span class="level-item">March 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/02/">
                <span class="level-start">
                    <span class="level-item">February 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/01/">
                <span class="level-start">
                    <span class="level-item">January 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/12/">
                <span class="level-start">
                    <span class="level-item">December 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/11/">
                <span class="level-start">
                    <span class="level-item">November 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/10/">
                <span class="level-start">
                    <span class="level-item">October 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/09/">
                <span class="level-start">
                    <span class="level-item">September 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">16</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/08/">
                <span class="level-start">
                    <span class="level-item">August 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">30</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/07/">
                <span class="level-start">
                    <span class="level-item">July 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">43</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/06/">
                <span class="level-start">
                    <span class="level-item">June 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">25</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/05/">
                <span class="level-start">
                    <span class="level-item">May 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">24</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
        
        </div>
    
</div>

                




<div class="column is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only has-order-3 column-right ">
    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Recent
        </h3>
        
        <article class="media">
            
            <a href="/2019/09/16/Snippet-of-GitHub-Actions/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/gallery/thumbnails/github_actions.png" alt="Snippet of GitHub Actions">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-09-16T07:14:02.000Z">2019-09-16</time></div>
                    <a href="/2019/09/16/Snippet-of-GitHub-Actions/" class="has-link-black-ter is-size-6">Snippet of GitHub Actions</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/08/30/Methods-of-the-String-in-JavaScript/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Methods of the String in JavaScript ">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-08-30T06:26:54.000Z">2019-08-30</time></div>
                    <a href="/2019/08/30/Methods-of-the-String-in-JavaScript/" class="has-link-black-ter is-size-6">Methods of the String in JavaScript </a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/04/20/note-on-bip-173/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/gallery/thumbnails/segwit.png" alt="Note-on-Bip-173">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-04-20T08:36:54.000Z">2019-04-20</time></div>
                    <a href="/2019/04/20/note-on-bip-173/" class="has-link-black-ter is-size-6">Note-on-Bip-173</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/04/17/notes-of-building-product-talking-to-users-and-growing/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="[WIP]notes of Building Product, Talking to Users and Growing">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-04-17T03:32:32.000Z">2019-04-17</time></div>
                    <a href="/2019/04/17/notes-of-building-product-talking-to-users-and-growing/" class="has-link-black-ter is-size-6">[WIP]notes of Building Product, Talking to Users and Growing</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/03/16/keystore/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/gallery/thumbnails/keystore.jpg" alt="Keystore">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-03-16T07:22:16.000Z">2019-03-16</time></div>
                    <a href="/2019/03/16/keystore/" class="has-link-black-ter is-size-6">Keystore</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>

    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Archives
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2019/09/">
                <span class="level-start">
                    <span class="level-item">September 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/08/">
                <span class="level-start">
                    <span class="level-item">August 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/04/">
                <span class="level-start">
                    <span class="level-item">April 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/03/">
                <span class="level-start">
                    <span class="level-item">March 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/11/">
                <span class="level-start">
                    <span class="level-item">November 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/09/">
                <span class="level-start">
                    <span class="level-item">September 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/08/">
                <span class="level-start">
                    <span class="level-item">August 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/07/">
                <span class="level-start">
                    <span class="level-item">July 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/05/">
                <span class="level-start">
                    <span class="level-item">May 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/04/">
                <span class="level-start">
                    <span class="level-item">April 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/03/">
                <span class="level-start">
                    <span class="level-item">March 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/02/">
                <span class="level-start">
                    <span class="level-item">February 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/01/">
                <span class="level-start">
                    <span class="level-item">January 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/12/">
                <span class="level-start">
                    <span class="level-item">December 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/11/">
                <span class="level-start">
                    <span class="level-item">November 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">12</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/10/">
                <span class="level-start">
                    <span class="level-item">October 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/09/">
                <span class="level-start">
                    <span class="level-item">September 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">18</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/08/">
                <span class="level-start">
                    <span class="level-item">August 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">31</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/07/">
                <span class="level-start">
                    <span class="level-item">July 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">19</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/06/">
                <span class="level-start">
                    <span class="level-item">June 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">14</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/05/">
                <span class="level-start">
                    <span class="level-item">May 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">15</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/04/">
                <span class="level-start">
                    <span class="level-item">April 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">9</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/03/">
                <span class="level-start">
                    <span class="level-item">March 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/02/">
                <span class="level-start">
                    <span class="level-item">February 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/01/">
                <span class="level-start">
                    <span class="level-item">January 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/12/">
                <span class="level-start">
                    <span class="level-item">December 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/11/">
                <span class="level-start">
                    <span class="level-item">November 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/10/">
                <span class="level-start">
                    <span class="level-item">October 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/09/">
                <span class="level-start">
                    <span class="level-item">September 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">16</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/08/">
                <span class="level-start">
                    <span class="level-item">August 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">30</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/07/">
                <span class="level-start">
                    <span class="level-item">July 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">43</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/06/">
                <span class="level-start">
                    <span class="level-item">June 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">25</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/05/">
                <span class="level-start">
                    <span class="level-item">May 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">24</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
    
    
</div>

            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/logo.png" alt="EzCook" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2019 Chen Yu&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a
                        href="http://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a>
                
                <br>
                <span id="busuanzi_container_site_uv">
                Visited by <span id="busuanzi_value_site_uv">0</span> users
                </span>
                
                </p>
            </div>
            <div class="level-end">
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("en");</script>


    
    
    
    <script src="/js/animation.js"></script>
    

    
    
    
    <script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
    <script src="/js/gallery.js" defer></script>
    

    
    

<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


    
    
<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>

    
    

<a id="back-to-top" title="Back to Top" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>


    
    

    
    
    
    
    
    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>
    <script src="/js/clipboard.js" defer></script>
    

    
    
    

    


<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>
</html>