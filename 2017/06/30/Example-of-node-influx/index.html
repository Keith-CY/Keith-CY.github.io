<!DOCTYPE html>
<html  lang="en">

<head>
    <meta charset="utf-8">
<title>Example of Node-Influx - EzCook</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />







<link rel="icon" href="/images/logo.png">

<link href="https://fonts.googleapis.com/css?family=Averia+Serif+Libre|DM+Serif+Text&display=swap" rel="stylesheet">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css">




    
    <style>body>.footer,body>.navbar,body>.section{opacity:0}</style>
    



    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">
    




<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">







<link rel="stylesheet" href="/css/back-to-top.css">




<script async src="https://www.googletagmanager.com/gtag/js?id=UA-136207372-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-136207372-1');
</script>




<link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>



    



    
        <script async="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    




<link rel="stylesheet" href="/css/style.css">
<script data-ad-client="ca-pub-8896169856986797" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

</head>

<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/logo.png" alt="Example of Node-Influx" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item"
                href="/">Home</a>
                
                <a class="navbar-item"
                href="/archives">Archives</a>
                
                <a class="navbar-item"
                href="/projects">Projects</a>
                
                <a class="navbar-item"
                href="https://wiki.digit-map.de/">Digit Map</a>
                
            </div>
            
            <div class="navbar-end">
                
                    
                    
                    <a class="navbar-item" target="_blank" title="GitHub" href="https://github.com/keith-CY">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                    
                    <a class="navbar-item" target="_blank" title="Gmail" href="mailto:keithwhisper@gmail.com">
                        
                        <i class="fas fa-envelope"></i>
                        
                    </a>
                    
                
                
                
                <a class="navbar-item search" title="Search" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>

    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-06-30T01:09:56.000Z">2017-06-30</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    3 minutes read (About 391 words)
                </span>
                
                
                <span class="level-item has-text-grey" id="busuanzi_container_page_pv">
                    <i class="far fa-eye"></i>
                    <span id="busuanzi_value_page_pv">0</span> visits
                </span>
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                Example of Node-Influx
            
        </h1>
        <div class="content">
            <h1 id="Express-Response-Times-Example"><a href="#Express-Response-Times-Example" class="headerlink" title="Express Response Times Example"></a>Express Response Times Example</h1><p>In this example we’ll create a server which has an index page that prints out ‘hello world’, and a page</p>
<p><code>http://localhost:3000/times</code> which prints out the last ten response times that influxDB gave us.</p>
<p>The end result should look something like this:</p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">curl <span class="hljs-_">-s</span> localhost:3000</div><div class="line">Hello world</div><div class="line"></div><div class="line">curl <span class="hljs-_">-s</span> localhost:3000/<span class="hljs-built_in">times</span> | jq</div><div class="line">[</div><div class="line">  &#123;</div><div class="line">    <span class="hljs-string">"time"</span>: <span class="hljs-string">"2016-10-09T19:13:26.815Z"</span>,</div><div class="line">    <span class="hljs-string">"duration"</span>: 205,</div><div class="line">    <span class="hljs-string">"host"</span>: <span class="hljs-string">"ares.peet.io"</span>,</div><div class="line">    <span class="hljs-string">"path"</span>: <span class="hljs-string">"/"</span></div><div class="line">    &#125;</div><div class="line">]</div></pre></td></tr></table></figure>
<p>Get started by installing and importing everything we need. This example requires Node 6.</p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install influx express</div></pre></td></tr></table></figure>
<p>Now create a new file <code>app.js</code> and start writing</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">const</span> Influx = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../../'</span>)</div><div class="line"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>)</div><div class="line"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>)</div><div class="line"><span class="hljs-keyword">const</span> os = <span class="hljs-built_in">require</span>(<span class="hljs-string">'os'</span>)</div><div class="line"></div><div class="line"><span class="hljs-keyword">const</span> app = express()</div></pre></td></tr></table></figure>
<p>Create a new influx client. We tell it to use the <code>express_response_db</code> database by default, and give it some information about the schema we’re writing. It can use this to be smarter about what data formats it writes and do some basic validation for us.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="hljs-keyword">const</span> influx = <span class="hljs-keyword">new</span> Influx.InfluxBD(&#123;</div><div class="line">  <span class="hljs-attr">host</span>: <span class="hljs-string">'localhost'</span>,</div><div class="line">  <span class="hljs-attr">database</span>: <span class="hljs-string">'express_response_db'</span>,</div><div class="line">  <span class="hljs-attr">schema</span>: [</div><div class="line">    &#123;</div><div class="line">      <span class="hljs-attr">measurement</span>: <span class="hljs-string">'response_time'</span>,</div><div class="line">      <span class="hljs-attr">fields</span>: &#123;</div><div class="line">        <span class="hljs-attr">path</span>: Influx.FieldType.STRING,</div><div class="line">        <span class="hljs-attr">duration</span>: Influx.FieldType.INTEGER</div><div class="line">      &#125;,</div><div class="line">      <span class="hljs-attr">tags</span>: [</div><div class="line">        <span class="hljs-string">'host'</span></div><div class="line">      ]</div><div class="line">    &#125;</div><div class="line">  ]</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>Now we have a working influx client!</p>
<p>We’ll make sure the database exists and boot the app.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">influx.getDatabaseName()</div><div class="line">.then(<span class="hljs-function"><span class="hljs-params">names</span> =&gt;</span> &#123;</div><div class="line">  <span class="hljs-keyword">if</span> (!names.includes(<span class="hljs-string">'express_response_db'</span>)) &#123;</div><div class="line">    <span class="hljs-keyword">return</span> influx.createDatabase(<span class="hljs-string">'express_response_db'</span>)</div><div class="line">  &#125;</div><div class="line">&#125;)</div><div class="line">.then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</div><div class="line">  http.createServer(app).listen(<span class="hljs-number">3000</span>, () =&gt; &#123;</div><div class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Listening on port 3000'</span>)</div><div class="line">  &#125;)</div><div class="line">&#125;)</div><div class="line">.catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;</div><div class="line">  <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'Error creating Influx database'</span>)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>Finally we’ll define the middleware and routes we’ll use. We have a generic middleware that records the time between when requests comes in, and the time we response to them. We also have another route called <code>/times</code> which prints out the last ten timings we recorded.</p>
<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">app.use(<span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> &#123;</div><div class="line">  <span class="hljs-keyword">const</span> start = <span class="hljs-built_in">Date</span>.now()</div><div class="line">  res.on(<span class="hljs-string">'finish'</span>, () =&gt; &#123;</div><div class="line">    <span class="hljs-keyword">const</span> duration = <span class="hljs-built_in">Date</span>.now() - start</div><div class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Request to <span class="hljs-subst">$&#123;req.path&#125;</span> took <span class="hljs-subst">$&#123;duration&#125;</span> ms`</span>)</div><div class="line">    influx.writePoints([</div><div class="line">      &#123;</div><div class="line">        <span class="hljs-attr">measurement</span>: <span class="hljs-string">'response_times'</span>,</div><div class="line">        <span class="hljs-attr">tags</span>: &#123; <span class="hljs-attr">host</span>: os.hostname() &#125;,</div><div class="line">        <span class="hljs-attr">fields</span>: &#123; duration, <span class="hljs-attr">path</span>: req.path &#125;</div><div class="line">      &#125;</div><div class="line">    ]).catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;</div><div class="line">      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Error saving data to InfluxDB: <span class="hljs-subst">$&#123;err.stack&#125;</span>`</span>)</div><div class="line">    &#125;)</div><div class="line">  &#125;)</div><div class="line">  <span class="hljs-keyword">return</span> next()</div><div class="line">&#125;)</div><div class="line"></div><div class="line">app.get(<span class="hljs-string">'/'</span>, (req, res) =&gt; &#123;</div><div class="line">  setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> res.end(<span class="hljs-string">'Hello world'</span>), <span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">500</span>)</div><div class="line">&#125;)</div><div class="line"></div><div class="line">app.get(<span class="hljs-string">'/times'</span>, (req, res) =&gt; &#123;</div><div class="line">  influx.query(<span class="hljs-string">`</span></div><div class="line">      select * from response_times</div><div class="line">      where host = <span class="hljs-subst">$&#123;Influx.<span class="hljs-built_in">escape</span>.stringLit(os.hostname())&#125;</span></div><div class="line">      order by time desc</div><div class="line">      limit 10</div><div class="line">  `).then(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> &#123;</div><div class="line">    res.json(result)</div><div class="line">  &#125;).catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;</div><div class="line">    res.status(<span class="hljs-number">500</span>).send(err.stack)</div><div class="line">  &#125;)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>

        </div>
        
        
        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="menu-label has-text-centered">Like this article? Support the author with</h3>
        <div class="buttons is-centered">
            
                <!-- Visit https://www.paypal.com/donate/buttons/ to get your donate button -->

<a class="button is-warning donate" onclick="document.getElementById(&#39;paypal-donate-form&#39;).submit()">
    <span class="icon is-small">
        <i class="fab fa-paypal"></i>
    </span>
    <span>Paypal</span>
</a>
<form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_blank" id="paypal-donate-form">
    <input type="hidden" name="cmd" value="_donations" />
    <input type="hidden" name="business" value="chen.yu.keith@foxmail.com" />
    <input type="hidden" name="currency_code" value="USD" />
</form>

                
        </div>
    </div>
</div>



<div class="card card-transparent">
    <div class="level post-navigation is-flex-wrap is-mobile">
        
        <div class="level-start">
            <a class="level level-item has-link-grey  article-nav-prev" href="/2017/06/30/Usage-of-Node-Influx/">
                <i class="level-item fas fa-chevron-left"></i>
                <span class="level-item">Usage of Node-Influx</span>
            </a>
        </div>
        
        
        <div class="level-end">
            <a class="level level-item has-link-grey  article-nav-next" href="/2017/06/29/snippets-of-koa-middlewares/">
                <span class="level-item">Snippets of Koa Middlewares</span>
                <i class="level-item fas fa-chevron-right"></i>
            </a>
        </div>
        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="title is-5 has-text-weight-normal">Comments</h3>
        
<div id="comment-container"></div>
<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
<script>
	var gitment = new Gitment({
		id: '2017/06/30/Example-of-node-influx/',
		owner: 'Keith-CY',
		repo: 'Keith-CY.github.io',
		oauth: {
			client_id: '56319e1ce36ed4313555',
			client_secret: 'ca7f10a8357d52290f5509fb54e5173a8bea0a5d',
		},
	})
	gitment.render('comment-container')
</script>

    </div>
</div>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("en");</script>


    
    
    
    <script src="/js/animation.js"></script>
    

    
    
    
    <script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
    <script src="/js/gallery.js" defer></script>
    

    
    

<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


    
    
<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>

    
    

<a id="back-to-top" title="Back to Top" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>


    
    

    
    
    
    
    
    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>
    <script src="/js/clipboard.js" defer></script>
    

    
    
    

    


<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>

</html>
