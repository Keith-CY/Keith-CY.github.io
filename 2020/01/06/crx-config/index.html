<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Crx-Config | EzCook</title><meta name="description" content="This is a detailed customized chrome extension configuration cheatsheet. Manifest12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364"><meta name="keywords" content="Chrome,Extensions"><meta name="author" content="Chen Yu"><meta name="copyright" content="Chen Yu"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/logo.png"><link rel="canonical" href="https://ezcook.de/2020/01/06/crx-config/"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin="crossorigin"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta property="og:type" content="article"><meta property="og:title" content="Crx-Config"><meta property="og:url" content="https://ezcook.de/2020/01/06/crx-config/"><meta property="og:site_name" content="EzCook"><meta property="og:description" content="This is a detailed customized chrome extension configuration cheatsheet. Manifest12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364"><meta property="og:image" content="https://ezcook.de/img/default_cover_1.jpg"><meta property="article:published_time" content="2020-01-05T17:10:11.000Z"><meta property="article:modified_time" content="2020-08-30T15:32:28.981Z"><meta name="twitter:card" content="summary"><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#000')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
  }
}

var getCookies = function (name) {
  const value = `; ${document.cookie}`
  const parts = value.split(`; ${name}=`)
  if (parts.length === 2) return parts.pop().split(';').shift()
}

var autoChangeMode = 'false'
var t = getCookies('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (Cookies.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.js" defer></script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-136207372-1"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-136207372-1');
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap"><script>var GLOBAL_CONFIG = { 
  root: '/',
  hexoversion: '5.1.1',
  algolia: {"appId":"KU7XP6WJWL","apiKey":"6806ddc27f224d4ebc2fe49dc770371c","indexName":"Blog","hits":{"per_page":6},"languages":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}.","hits_stats":"${hits} results found in ${time} ms"}},
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  bookmark: {
    message_prev: 'Press',
    message_next: 'to bookmark this page'
  },
  runtime_unit: 'days',
  runtime: false,
  copyright: {"limitCount":50,"languages":{"author":"Author: Chen Yu","link":"Link: ","source":"Source: EzCook","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source."}},
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: true    
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2020-08-30 23:32:28'
}</script><noscript><style>
#nav {
  opacity: 1
}
.justified-gallery img {
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 5.1.1"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/yudan.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">304</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">Tags</div><div class="length_num">73</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">Categories</div><div class="length_num">4</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-address-card"></i><span> About</span></a></div><div class="menus_item"><a class="site-page" href="/portfolio/"><i class="fa-fw fas fa-code"></i><span> Portfolio</span></a></div></div></div></div><div id="body-wrap"><div id="web_bg" data-type="color"></div><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Manifest"><span class="toc-number">1.</span> <span class="toc-text">Manifest</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BrowerAction-Methods"><span class="toc-number">2.</span> <span class="toc-text">BrowerAction Methods</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BrowserAction-Events"><span class="toc-number">3.</span> <span class="toc-text">BrowserAction Events</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PageAction-Methods"><span class="toc-number">4.</span> <span class="toc-text">PageAction Methods</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PageAction-Events"><span class="toc-number">5.</span> <span class="toc-text">PageAction Events</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Background"><span class="toc-number">6.</span> <span class="toc-text">Background</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Register-background-scripts"><span class="toc-number">6.1.</span> <span class="toc-text">Register background scripts</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Initialize-the-extension"><span class="toc-number">6.2.</span> <span class="toc-text">Initialize the extension</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Set-up-listeners"><span class="toc-number">6.3.</span> <span class="toc-text">Set up listeners</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Filter-events"><span class="toc-number">6.4.</span> <span class="toc-text">Filter events</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#React-to-listeners"><span class="toc-number">6.5.</span> <span class="toc-text">React to listeners</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Unload-background-scripts"><span class="toc-number">6.6.</span> <span class="toc-text">Unload background scripts</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Content-scripts"><span class="toc-number">7.</span> <span class="toc-text">Content scripts</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Work-in-isolated-worlds"><span class="toc-number">7.1.</span> <span class="toc-text">Work in isolated worlds</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Inject-scripts"><span class="toc-number">7.2.</span> <span class="toc-text">Inject scripts</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Inject-Programmatically"><span class="toc-number">7.2.1.</span> <span class="toc-text">Inject Programmatically</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Inject-declaratively"><span class="toc-number">7.2.2.</span> <span class="toc-text">Inject declaratively</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Chrome-Permissions"><span class="toc-number">8.</span> <span class="toc-text">Chrome Permissions</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Decide-which-permissions-are-required-and-which-are-optional"><span class="toc-number">8.1.</span> <span class="toc-text">Decide which permissions are required and which are optional</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Request-optional-permissions"><span class="toc-number">8.2.</span> <span class="toc-text">Request optional permissions</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Check-the-extension%E2%80%99s-current-permissions"><span class="toc-number">8.3.</span> <span class="toc-text">Check the extension’s current permissions</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Remove-the-permissions"><span class="toc-number">8.4.</span> <span class="toc-text">Remove the permissions</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Requirements"><span class="toc-number">9.</span> <span class="toc-text">Requirements</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Messages"><span class="toc-number">10.</span> <span class="toc-text">Messages</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Simple-one-time-requests"><span class="toc-number">10.1.</span> <span class="toc-text">Simple one-time requests</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Long-lived-connections"><span class="toc-number">10.2.</span> <span class="toc-text">Long-lived connections</span></a></li></ol></li></ol></div></div></div><header class="post-bg" id="page-header" style="background-image: url(/img/default_cover_1.jpg)"><nav id="nav"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">EzCook</a></span><span class="pull-right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-address-card"></i><span> About</span></a></div><div class="menus_item"><a class="site-page" href="/portfolio/"><i class="fa-fw fas fa-code"></i><span> Portfolio</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">Crx-Config</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2020-01-05T17:10:11.000Z" title="Created 2020-01-06 01:10:11">2020-01-06</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2020-08-30T15:32:28.981Z" title="Updated 2020-08-30 23:32:28">2020-08-30</time></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">Comments:</span><span class="disqus-comment-count comment-count"><a href="https://ezcook.de/2020/01/06/crx-config/#disqus_thread"></a></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><p>This is a detailed customized chrome extension configuration cheatsheet.</p>
<h2 id="Manifest"><a href="#Manifest" class="headerlink" title="Manifest"></a>Manifest</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// required</span></span><br><span class="line">  <span class="attr">&quot;manifest_version&quot;</span>: <span class="number">2</span>, <span class="comment">// integer indicates the version of the manifest file format.</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Name of Extension&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;Version of Extension&quot;</span>, <span class="comment">// One to four dot-separated integers indicating the version of the extension, &quot;1.2.3.1234&quot;, and there&#x27;s a field named &quot;version_name&quot; for displaying purpose, &quot;version_name&quot;: &quot;1.0 beta&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Recommended</span></span><br><span class="line">  <span class="attr">&quot;default_locale&quot;</span>: <span class="string">&quot;en&quot;</span>, <span class="comment">// this field is required in extensions that have a &#x27;_locales&#x27; directory and must be absent in extensions that have no &#x27;_locales&#x27; directory.</span></span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;Description of Extension&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;icons&quot;</span>: &#123;</span><br><span class="line">    <span class="comment">// One or more icons that represent the extension, app, or theme.</span></span><br><span class="line">    <span class="attr">&quot;16&quot;</span>: <span class="string">&quot;icon16.png&quot;</span>, <span class="comment">// is used as the favicon for an extension&#x27;s pages</span></span><br><span class="line">    <span class="attr">&quot;48&quot;</span>: <span class="string">&quot;icon48.png&quot;</span>, <span class="comment">// 48 x 48 icon is for extension management page</span></span><br><span class="line">    <span class="attr">&quot;128&quot;</span>: <span class="string">&quot;icon128.png&quot;</span> <span class="comment">// You should always provides a 128 x 128 icon, it&#x27;s used during installation and by the Chrome Extension Store.</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Pick one or none</span></span><br><span class="line">  <span class="attr">&quot;browser_action&quot;</span>: &#123;</span><br><span class="line">    <span class="comment">// use browser actions to put icons in the main chrome toolbar, to the right of the address bar. It can have a tooltip, a badge and a popup</span></span><br><span class="line">    <span class="attr">&quot;default_icon&quot;</span>: &#123;</span><br><span class="line">      <span class="comment">// optional, you can use browserAction.setBadgeText, browserAction.setBadgeBackgroundColor to set the badge</span></span><br><span class="line">      <span class="attr">&quot;16&quot;</span>: <span class="string">&quot;images/icon16.png&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;24&quot;</span>: <span class="string">&quot;images/icon24.png&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;32&quot;</span>: <span class="string">&quot;images/icon32.png&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;default_title&quot;</span>: <span class="string">&quot;Tooltip of Extension&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;default_popup&quot;</span>: <span class="string">&quot;popup.html&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;page_action&quot;</span>: &#123;</span><br><span class="line">    <span class="comment">// use the chrome.pageAction API to put icons in the main chrome toolbar, to the right of the address bar. Page actions represent actions that can be taken on the current page, but that aren&#x27;t applicable to all pages. Page actions appear grayed out when inactive.</span></span><br><span class="line">    <span class="attr">&quot;default_icons&quot;</span>: &#123;</span><br><span class="line">      <span class="comment">// optional</span></span><br><span class="line">      <span class="attr">&quot;16&quot;</span>: <span class="string">&quot;images/icon16.png&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;24&quot;</span>: <span class="string">&quot;images/icon24.png&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;32&quot;</span>: <span class="string">&quot;images/icon32.png&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;default_title&quot;</span>: <span class="string">&quot;Tooltip of Extension&quot;</span>, <span class="comment">// optional</span></span><br><span class="line">    <span class="attr">&quot;default_popup&quot;</span>: <span class="string">&quot;popup.html&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Optional</span></span><br><span class="line">  <span class="attr">&quot;action&quot;</span>: <span class="string">&quot;//TODO&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;author&quot;</span>: <span class="string">&quot;//TODO&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;automation&quot;</span>: <span class="string">&quot;//TODO&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;background&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;scripts&quot;</span>: [],</span><br><span class="line">    <span class="attr">&quot;persistent&quot;</span>: <span class="literal">false</span>, <span class="comment">// Recommended to be false</span></span><br><span class="line">    <span class="attr">&quot;service_worker&quot;</span>: <span class="string">&quot;path to the sw&quot;</span> <span class="comment">// Optional</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;chrome_settings_override&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;homepage&quot;</span>: <span class="string">&quot;url of homepage&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;search_provider&quot;</span>: &#123;&#125;,</span><br><span class="line">    <span class="attr">&quot;startup_pages&quot;</span>: []</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;chrome_ui_overrides&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;bookmarks_ui&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;remove_bookmark_shortcut&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">&quot;remove_button&quot;</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;chrome_url_overrides&quot;</span>: &#123;&#125;, <span class="comment">// used to override pages provided by chrome. In addition to HTML, an override page usually has CSS and JavaScript Code.</span></span><br><span class="line">  <span class="attr">&quot;commands&quot;</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">&quot;content_capabilities&quot;</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">&quot;content_scripts&quot;</span>: [&#123;&#125;],</span><br><span class="line">  <span class="attr">&quot;content_security_poligy&quot;</span>: <span class="string">&quot;policyString&quot;</span>a,</span><br><span class="line">  <span class="attr">&quot;converted_from_user-script&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;devtools_page&quot;</span>: <span class="string">&quot;//TODO&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;event_rules&quot;</span>: [],</span><br><span class="line">  <span class="attr">&quot;externally_connectable&quot;</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">&quot;file_browser_handlers&quot;</span>: [],</span><br><span class="line">  <span class="attr">&quot;file_system_provider_capabilities&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;configurable&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;multiple_mounts&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;source&quot;</span>: <span class="string">&quot;network&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;homepage_url&quot;</span>: <span class="string">&quot;http://path/to/homepage&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;import&quot;</span>: [], <span class="comment">// shared modules</span></span><br><span class="line">  <span class="attr">&quot;export&quot;</span>: [], <span class="comment">// shared modules</span></span><br><span class="line">  <span class="attr">&quot;incognito&quot;</span>: <span class="string">&quot;//TODO&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;input_components&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;key&quot;</span>: <span class="string">&quot;publicKey&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;minimum_chrome_version&quot;</span>: <span class="string">&quot;versionString&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;nacl_modules&quot;</span>: [],</span><br><span class="line">  <span class="attr">&quot;oauth2&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;offline_enabled&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;omnibox&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;keyboard&quot;</span>: <span class="string">&quot;aString&quot;</span> <span class="comment">// The omnibox allows you to register a keyword with chrome&#x27;s address bar.</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;optional_permissions&quot;</span>: [<span class="string">&quot;tabs&quot;</span>],</span><br><span class="line">  <span class="attr">&quot;options_page&quot;</span>: <span class="string">&quot;options.html&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;options_ui&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;chrome_style&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;page&quot;</span>: <span class="string">&quot;options.html&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;permissions&quot;</span>: [<span class="string">&quot;tabs&quot;</span>],</span><br><span class="line">  <span class="attr">&quot;platforms&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;replacement_web_app&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;requirements&quot;</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">&quot;sandbox&quot;</span>: [],</span><br><span class="line">  <span class="attr">&quot;short_name&quot;</span>: <span class="string">&quot;short name&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;signature&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;spellcheck&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;storage&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;managed_schema&quot;</span>: <span class="string">&quot;schema.json&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;system_indicator&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;tts_engine&quot;</span>: &#123;&#125;,</span><br><span class="line">  &quot;update_url&quot;: &quot;http://path/to/updateInfo.xml&quot;,,</span><br><span class="line">  &quot;version_name&quot;: &quot;0.1 beta&quot;,</span><br><span class="line">  &quot;web_accessible_resource&quot;: []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="BrowerAction-Methods"><a href="#BrowerAction-Methods" class="headerlink" title="BrowerAction Methods"></a>BrowerAction Methods</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chrome.browserAction.method(params)</span><br></pre></td></tr></table></figure>

<ul>
<li>setTitle({ title: string, tabId?: number }, callback)</li>
<li>getTitle({ tabId?: number }, <string>callback)</li>
<li>setIcon({ imageData?: ImageDataType | object, path?: string | object, tabId?: number }, callback)</li>
<li>setPopup({ tabId?: number, popup: string }, callback)</li>
<li>getPopup({ tabId?: number }, <string>callback)</li>
<li>setBadgeText({ text: string, tabId?: number }, callback)</li>
<li>getBadgeText({ tabId?: number }, <string>callback)</li>
<li>setBadgeBackgroundColor({ color: string or ColorArray, tabId?: number }, callback)</li>
<li>getBadgeBackgroundColor({ tabId?: number }, callback)</li>
<li>enable({ tabId?: number }, callback)</li>
<li>disable({ tabId?: number }, callback)</li>
</ul>
<h2 id="BrowserAction-Events"><a href="#BrowserAction-Events" class="headerlink" title="BrowserAction Events"></a>BrowserAction Events</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chrome.browserAction.onClicked.addEventListener(<span class="function">(<span class="params">tab: tabs.Tab</span>) =&gt;</span> &#123;&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="PageAction-Methods"><a href="#PageAction-Methods" class="headerlink" title="PageAction Methods"></a>PageAction Methods</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chrome.pageAction.method(params)</span><br></pre></td></tr></table></figure>

<ul>
<li>show({ tabId: number }, callback), the page action is shown whenever the tab is selected</li>
<li>hide({ tabId: number }, callback), hide the page action, means set the page action gray</li>
<li>setTitle({ tabId: number, title: string }, callback)</li>
<li>getTitle({ tabId: number }, <string>callback)</li>
<li>setIcon({ imageData: object | ImageDataType, path?: string | object, }), the path to the icons could be a dictionary {size =&gt; relative image path}, the actual image to be used is chosen depending on screen’s pixel density. Note that path = ‘foo’ equals to path = { ‘16’: foo }, implicitly converted into a dictionary.</li>
<li>setPopup({ tabId: number, popup: string }, callback)</li>
<li>getPopup({ tabId }, <string>callback)</li>
</ul>
<h2 id="PageAction-Events"><a href="#PageAction-Events" class="headerlink" title="PageAction Events"></a>PageAction Events</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chrome.pageAction.onClicked.addEventListener(<span class="function">(<span class="params">tab: tabs.Tab</span>) =&gt;</span> &#123;&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h2><p>Extensions are event-driven programs used to modify or enhance the chrome browsing experience. Events are browser triggers and extensions monitor them in background scripts, then react to specified instructions.</p>
<p>A background page is loaded when it is needed, and unloaded when it goes idle.</p>
<pre><code>- The extension is first installed or updated to a new version.
- The background page was listening for an event, and the event is dispatched.
- A content script or other extension sends a message.
- Another view in the extension, such as a popup, calls `runtime.getBackgroundPage`.</code></pre>
<h3 id="Register-background-scripts"><a href="#Register-background-scripts" class="headerlink" title="Register background scripts"></a>Register background scripts</h3><p>Background scripts are registered in the manifest under the “background” field. They are listed in an array of “background.scripts”.</p>
<p>Remember to set “persistent” to false unless the extension uses <code>chrome.webRequest</code> API to block or modify network requests.</p>
<h3 id="Initialize-the-extension"><a href="#Initialize-the-extension" class="headerlink" title="Initialize the extension"></a>Initialize the extension</h3><p>Listen to <code>runtime.onInstalled</code> event to initialize an extension on installation. Use this event to set a state or for one-time initialization, such as a context menu.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">chrome.runtime.onInstalled.addListener(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  chrome.contextMenu.create(&#123;</span><br><span class="line">    id: <span class="string">&#x27;sampleContextMneu&#x27;</span>,</span><br><span class="line">    title: <span class="string">&#x27;Sample Context Menu&#x27;</span>,</span><br><span class="line">    contexts: [<span class="string">&#x27;selection&#x27;</span>],</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="Set-up-listeners"><a href="#Set-up-listeners" class="headerlink" title="Set up listeners"></a>Set up listeners</h3><p>Structure background scripts around events the extension depends on. Defining functionally relevant events allows background scripts to lie dormant until those events are fired and prevents the extension from missing important triggers.</p>
<p>Listeners must be registered synchronously from the start of the page.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This will run when a bookmark is created</span></span><br><span class="line">chrome.bookmark.onCreated.addListener(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// do something</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>Do not register listeners asynchronously, as they will not be properly triggered.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DO NOT DO THIS</span></span><br><span class="line">chrome.runtime.onInstalled.addListener(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  chrome.bookmarks.onCreated.addListener(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="Filter-events"><a href="#Filter-events" class="headerlink" title="Filter events"></a>Filter events</h3><p>Use APIs that supports <code>event filters</code> to restrict listeners to the cases the extension cares about. If an extension is listening for the <code>tabs.onUpdated</code> event, try using the <code>webNavigation.onCompleted</code> event with filters instead, as the tabs API does not support filters.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">chrome.webNavigation.onCompleted.addListener(</span><br><span class="line">  () =&gt; &#123;</span><br><span class="line">    alert(<span class="string">&#x27;This is my favorite website&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    url: [</span><br><span class="line">      &#123;</span><br><span class="line">        urlMatches: <span class="string">&#x27;http://www.google.com&#x27;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="React-to-listeners"><a href="#React-to-listeners" class="headerlink" title="React to listeners"></a>React to listeners</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">chrome.runtime.onMessage.addListener(<span class="function">(<span class="params">message, callback</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (message.data === <span class="string">&#x27;setAlarm&#x27;</span>) &#123;</span><br><span class="line">    chrome.alarms.create(&#123; <span class="attr">delayInMinutes</span>: <span class="number">5</span> &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (message.data === <span class="string">&#x27;runLogic&#x27;</span>) &#123;</span><br><span class="line">    chrome.tabs.executeScript(&#123; <span class="attr">file</span>: <span class="string">&#x27;logic.js&#x27;</span> &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (message.data === <span class="string">&#x27;changeColor&#x27;</span>) &#123;</span><br><span class="line">    chrome.tabs.executeScript(&#123;</span><br><span class="line">      code: <span class="string">&#x27;document.body.style.backgroundColor=&quot;orange&quot;&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="Unload-background-scripts"><a href="#Unload-background-scripts" class="headerlink" title="Unload background scripts"></a>Unload background scripts</h3><p>Data should be persisted periodically so that important information is not lost if an extension crashes without receiving <code>onSuspend</code>. Use the <code>storage</code> API to assist with this.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chrome.storage.local.set(&#123; <span class="attr">variable</span>: <span class="string">&#x27;info&#x27;</span> &#125;)</span><br></pre></td></tr></table></figure>

<p>If an extension uses <code>message passing</code>, ensure all ports are closed. The background script will not unload until all message ports have shut.</p>
<p>Listen to <code>runtime.Port.onDisconnect</code> event will give insight to when open ports are closing. Manually close them with <code>runtime.Port.disconnect</code>.</p>
<p>Background scripts unload themself after a few seconds of inactivity. If any last minute cleanup is required, listen to <code>runtime.onSuspend</code> event.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">chrome.runtime.onSuspend.addListener(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;unloading&#x27;</span>)</span><br><span class="line">  chrome.browserAction.setBadgeText(&#123; <span class="attr">text</span>: <span class="string">&#x27;&#x27;</span> &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="Content-scripts"><a href="#Content-scripts" class="headerlink" title="Content scripts"></a>Content scripts</h2><p>Content scripts are files that run in the context of web pages. By using the standard DOM, they are able to read details of the web pages the browser visits, make changes to them and pass information to their parent extension.</p>
<p>Content scripts can access chrome APIs used by their parent extension by exchanging messages with the extension. They can also access the URL of an extension’s file with <code>chrome.runtime.getURL()</code> and use the result the same as other URLs.</p>
<p>Content scripts can access the following chrome APIs directly:</p>
<ul>
<li>i18n</li>
<li>storage</li>
<li>runtime<ul>
<li>connect</li>
<li>getManifest</li>
<li>getURL</li>
<li>id</li>
<li>onConnect</li>
<li>onMessage</li>
<li>sendMessage</li>
</ul>
</li>
</ul>
<p>Content scripts are unable to access other APIs directly.</p>
<h3 id="Work-in-isolated-worlds"><a href="#Work-in-isolated-worlds" class="headerlink" title="Work in isolated worlds"></a>Work in isolated worlds</h3><p>Content scripts live in an isolated world, allowing a content script to makes chagnes to its JavaScript environment without conflicting with the page or additional content scripts.</p>
<h3 id="Inject-scripts"><a href="#Inject-scripts" class="headerlink" title="Inject scripts"></a>Inject scripts</h3><p>Content scripts can be programmatically or declaratively injected.</p>
<h4 id="Inject-Programmatically"><a href="#Inject-Programmatically" class="headerlink" title="Inject Programmatically"></a>Inject Programmatically</h4><p>Use programmatic injection for content scripts that need to run on specific occasions.</p>
<p>To inject a programmatic content script, provide the <code>activeTab</code> permission in the manifest. This grants secure access to the active site’s host and temporary access to the <code>tabs</code> permission, enabling the content script to run on the current active tab without specifying <code>cross-origin premissions</code>.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;permissions&quot;</span>: [<span class="string">&quot;activeTab&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Then content scripts can be injected as code</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">chrome.runtime.onMessage.addListener(<span class="function">(<span class="params">message, callback</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (message === <span class="string">&#x27;changeColor&#x27;</span>) &#123;</span><br><span class="line">    chrome.tabs.executeScript(&#123;</span><br><span class="line">      code: <span class="string">&#x27;document.body.style.backgroundColor=&quot;orange&quot;&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (message === <span class="string">&#x27;runContentScript&#x27;</span>) &#123;</span><br><span class="line">    chrome.tabs.executeScript(&#123;</span><br><span class="line">      file: <span class="string">&#x27;contentScript.js&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="Inject-declaratively"><a href="#Inject-declaratively" class="headerlink" title="Inject declaratively"></a>Inject declaratively</h4><p>Use declarative injection for content scripts that should be automatically run on specified pages.</p>
<p>Declaratively injected scripts are registered in the manifest.content_scripts field.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;content_scripts&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;matches&quot;</span>: [<span class="string">&quot;http://*.nytimes.com/*&quot;</span>], <span class="comment">// required, specifies which pages this content script will be injected into.</span></span><br><span class="line">      <span class="attr">&quot;css&quot;</span>: [<span class="string">&quot;myStyles.css&quot;</span>], <span class="comment">// optional, the list of css files to be injected into the pages. They are injected orderly.</span></span><br><span class="line">      <span class="attr">&quot;js&quot;</span>: [<span class="string">&quot;contentScript.js&quot;</span>], <span class="comment">// optional, the list of js files to be injected into orderly.</span></span><br><span class="line">      <span class="attr">&quot;match_about_blank&quot;</span>: <span class="literal">false</span>, <span class="comment">// optional, whether or not to inject into the blank pages</span></span><br><span class="line">      <span class="attr">&quot;run_at&quot;</span>: <span class="string">&quot;document_idel&quot;</span>, <span class="comment">// controls when the files are injected, the preferred and default config is document_idle.</span></span><br><span class="line">      <span class="attr">&quot;all_frames&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Chrome-Permissions"><a href="#Chrome-Permissions" class="headerlink" title="Chrome Permissions"></a>Chrome Permissions</h2><p>Use the <code>chrome.permission</code> API to request declared optional permissions at run time rather than install time, so users understand why the permissions are needed and grant only those that are necessary.</p>
<h3 id="Decide-which-permissions-are-required-and-which-are-optional"><a href="#Decide-which-permissions-are-required-and-which-are-optional" class="headerlink" title="Decide which permissions are required and which are optional"></a>Decide which permissions are required and which are optional</h3><p>An extension can declare both required and optional permissions. In general, you should:</p>
<ul>
<li>Use required permissions when they are needed for your extension’s basic functionality.</li>
<li>Use optional permissions when they are needed for optional features in your extension.</li>
</ul>
<p>Advantages of required permissions:</p>
<ul>
<li>Fewer prompts: An extension can prompt the user once to accept all permissions.</li>
<li>Simpler development: Required permissions are guaranteed to be present.</li>
</ul>
<p>Advantages of optional permissions:</p>
<ul>
<li>Better security</li>
<li>Better information for users: An extension can explain why it needs a particular permission when the user enables the relevant feature.</li>
<li>Easier upgrades: When you upgrades your extension, chrome will not disable it for your users if the upgrade adds optional rather than required permissions.</li>
</ul>
<p>Declare optional permissions in your extension manifest with the <code>optional_permissions</code> key, using the same format as the <code>permission</code> field.</p>
<h3 id="Request-optional-permissions"><a href="#Request-optional-permissions" class="headerlink" title="Request optional permissions"></a>Request optional permissions</h3><p>Request the permission from within a user gesture using <code>permissions.request()</code>.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.querySelector(<span class="string">&#x27;#my-button&#x27;</span>).addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  chrome.permissions.request(</span><br><span class="line">    &#123;</span><br><span class="line">      permissions: [<span class="string">&#x27;tabs&#x27;</span>],</span><br><span class="line">      origins: [<span class="string">&#x27;http://www.google.com&#x27;</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">    (granted) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (granted) &#123;</span><br><span class="line">        <span class="comment">// do something</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// do something</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  )</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="Check-the-extension’s-current-permissions"><a href="#Check-the-extension’s-current-permissions" class="headerlink" title="Check the extension’s current permissions"></a>Check the extension’s current permissions</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">chrome.permissions.contains(</span><br><span class="line">  &#123;</span><br><span class="line">    permissions: [<span class="string">&#x27;tabs&#x27;</span>],</span><br><span class="line">    origins: [<span class="string">&#x27;http://www.google.com&#x27;</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  (result) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (result) &#123;</span><br><span class="line">      <span class="comment">// the extension has the permissions</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// the extension doesn&#x27;t have the permissions</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="Remove-the-permissions"><a href="#Remove-the-permissions" class="headerlink" title="Remove the permissions"></a>Remove the permissions</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">chrome.permissions.remove(</span><br><span class="line">  &#123;</span><br><span class="line">    permissions: [<span class="string">&#x27;tabs&#x27;</span>],</span><br><span class="line">    origins: [<span class="string">&#x27;http://www.google.com&#x27;</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  (removed) =&gt; &#123;</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">  &#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="Requirements"><a href="#Requirements" class="headerlink" title="Requirements"></a>Requirements</h2><p>Technologies required by the app or extension. Hosting sites such as chrome web store may use this list to dissuade users from installing apps or extensions that will not work on their computer.</p>
<p>Supported requirements currently include “3D” and “plugins”.</p>
<h2 id="Messages"><a href="#Messages" class="headerlink" title="Messages"></a>Messages</h2><p>Since content scripts run in the context of a web page and not the extension, they often need some way of communicating with the rest of the extension. For example, an RSS reader extension might use content script to detect the presence of an RSS feed on a page, then notify the background page in order to display a page action icon for that page.</p>
<p>Communication between extensions and their content script scripts works by using message passing. Either side can listen for message sent from the other end, and respond on the same channel. A message can contain any valid JSON object.</p>
<h3 id="Simple-one-time-requests"><a href="#Simple-one-time-requests" class="headerlink" title="Simple one-time requests"></a>Simple one-time requests</h3><p>If you only need to send a single message to another part of your extension, you should use the simplified <code>runtime.sendMessage</code> and <code>tabs.sendMessage</code>. This lets you send a one-time JSON-serializable message from a content script to extension, or vice versa, respectively.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// send a request from content script</span></span><br><span class="line">chrome.runtime.sendMessage(&#123; <span class="attr">greeting</span>: <span class="string">&#x27;hello&#x27;</span> &#125;, <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// send a request from the extension to a content script works similar, except that you need to specify which tab to send it to.</span></span><br><span class="line">chrome.tabs.query(&#123; <span class="attr">active</span>: <span class="literal">true</span>, <span class="attr">currentWindow</span>: <span class="literal">true</span> &#125;, <span class="function">(<span class="params">tabs</span>) =&gt;</span> &#123;</span><br><span class="line">  chrome.tabs.sendMessage(tabs[<span class="number">0</span>].id, &#123; <span class="attr">greeting</span>: <span class="string">&#x27;hello&#x27;</span> &#125;, <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>On the receiving end, you need to set up an <code>runtime.onMessage</code> event listener to handle the message.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">chrome.runtime.onMessage.addListener(<span class="function">(<span class="params">req, sender, sendRespond</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(sender.tab ? <span class="string">`from a content script: <span class="subst">$&#123;sender.tab.url&#125;</span>`</span> : <span class="string">`from the extension`</span>)</span><br><span class="line">  <span class="keyword">if</span> (req.greeting === <span class="string">&#x27;hello&#x27;</span>) &#123;</span><br><span class="line">    sendResponse(&#123; <span class="attr">farewell</span>: <span class="string">&#x27;goodbye&#x27;</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>In the above example, the <code>sendResponse</code> is called synchronously. If you want to call the <code>sendResponse</code> asynchronously, simple <code>return true</code> at the end.</p>
<blockquote>
<p>Note: If multiple pages are listening on the onMessage events, only the first to call <code>sendResponse</code> for a particular event will succeed in sending response. Other response will be ignored.</p>
</blockquote>
<blockquote>
<p>Note: call sendResponse synchronously or return true. Without return true, sendResponse(undefined) will be called automatically and implicitly.</p>
</blockquote>
<h3 id="Long-lived-connections"><a href="#Long-lived-connections" class="headerlink" title="Long-lived connections"></a>Long-lived connections</h3><p>Sometimes it’s useful to have a conversation lasting longer than one-time request.</p>
<p>You can open a long-lived channel from content script to an extension page, or vice versa, by using <code>runtime.connect</code> or <code>tab.connect</code>.</p>
<p>When establishing a connection, each end is given a <code>runtime.Port</code> object which is used for sending and receiving messages through that connection.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> port = chrome.runtime.connect(&#123; <span class="attr">name</span>: <span class="string">&#x27;knockknock&#x27;</span> &#125;)</span><br><span class="line">port.postMessage(&#123; <span class="attr">joke</span>: <span class="string">&#x27;Knock knock&#x27;</span> &#125;)</span><br><span class="line">port.onMessage.addListener(<span class="function">(<span class="params">msg</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (msg.question === <span class="string">&quot;Who&#x27;s there?&quot;</span>) &#123;</span><br><span class="line">    port.postMessage(&#123; <span class="attr">answer</span>: <span class="string">&#x27;Madame&#x27;</span> &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (msg.question === <span class="string">&#x27;Madame who?&#x27;</span>) &#123;</span><br><span class="line">    port.postMessage(&#123; <span class="attr">answer</span>: <span class="string">&#x27;Madame... Bovary&#x27;</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Chen Yu</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://ezcook.de/2020/01/06/crx-config/">https://ezcook.de/2020/01/06/crx-config/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Chrome/">Chrome</a><a class="post-meta__tags" href="/tags/Extensions/">Extensions</a></div><div class="post_share"><div class="social-share" data-image="/img/default_cover_1.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/01/17/Inspect-protobuf-js/"><img class="prev-cover" src="/gallery/thumbnails/pbjs.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Inspect-protobuf.js</div></div></a></div><div class="next-post pull-right"><a href="/2019/12/03/Introduction-to-MACD/"><img class="next-cover" src="/gallery/thumbnails/macd-indicator.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Introduction to MACD</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fas fa-thumbs-up fa-fw"></i><span> Related Articles</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2017/08/20/Analyzing-Runtime-Performacne-with-Chrome-DevTools/" title="Analyzing Runtime Performacne With Chrome DevTools"><img class="relatedPosts_cover" src="img/default_cover_2.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2017-08-20</div><div class="relatedPosts_title">Analyzing Runtime Performacne With Chrome DevTools</div></div></a></div><div class="relatedPosts_item"><a href="/2017/08/27/Start-at-Headless/" title="Start at Headless"><img class="relatedPosts_cover" src="img/default_cover_2.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2017-08-27</div><div class="relatedPosts_title">Start at Headless</div></div></a></div><div class="relatedPosts_item"><a href="/2018/08/27/development-of-neuron-web-extension/" title="Development of Neuron Web Extension"><img class="relatedPosts_cover" src="img/default_cover_1.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2018-08-27</div><div class="relatedPosts_title">Development of Neuron Web Extension</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div id="disqus_thread"></div></div></div></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2015 - 2020 By Chen Yu</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="font_plus" type="button" title="Increase Font Size"><i class="fas fa-plus"></i></button><button id="font_minus" type="button" title="Decrease Font Size"><i class="fas fa-minus"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></section><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="/js/search/algolia.js"></script><script>var endLoading = function () {
  document.body.style.overflow = 'auto';
  document.getElementById('loading-box').classList.add("loaded")
}
window.addEventListener('load',endLoading)</script><div class="js-pjax"><script>function loadDisqus () {
  var disqus_config = function () {
    this.page.url = 'https://ezcook.de/2020/01/06/crx-config/'
    this.page.identifier = '2020/01/06/crx-config/'
    this.page.title = 'Crx-Config'
  };

  window.disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://ezcook-de.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }
}

if ('Disqus' === 'Disqus' || !false) {
  if (false) loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script><script>if (window.DISQUSWIDGETS === undefined) {
  var d = document, s = d.createElement('script');
  s.src = 'https://ezcook-de.disqus.com/count.js';
  s.id = 'dsq-count-scr';
  (d.head || d.body).appendChild(s);
} else {
  DISQUSWIDGETS.getCount({reset: true});
}</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = [
  'title',
  'meta[name=description]',
  '#config_change',
  '#body-wrap',
  '#rightside-config-hide',
  '#rightside-config-show',
  '.js-pjax'
]

if (false) {
  pjaxSelectors.unshift('meta[property="og:image"]', 'meta[property="og:title"]', 'meta[property="og:url"]')
}

const pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
})

document.addEventListener('pjax:complete', function () {
  refreshFn()

  $('script[data-pjax]').each(function () {
    $(this).parent().append($(this).remove())
  })

  GLOBAL_CONFIG.islazyload && lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  if (typeof gtag === 'function') {
    gtag('config', 'UA-136207372-1', {'page_path': window.location.pathname});
  }

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

})

document.addEventListener('pjax:send', function () {
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  $(window).off('scroll')

  //reset readmode
  $('body').hasClass('read-mode') && $('body').removeClass('read-mode')

  //reset font-size
  $('body').css('font-size') !== originFontSize && $('body').css('font-size', parseFloat(originFontSize))
})</script></div></body></html>