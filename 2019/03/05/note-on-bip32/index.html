<!DOCTYPE html>
<html  lang="en">

<head>
    <meta charset="utf-8">
<title>Note on Bip32 - EzCook</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />







<link rel="icon" href="/images/logo.png">

<link href="https://fonts.googleapis.com/css?family=Averia+Serif+Libre|DM+Serif+Text&display=swap" rel="stylesheet">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css">




    
    <style>body>.footer,body>.navbar,body>.section{opacity:0}</style>
    



    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">
    




<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">







<link rel="stylesheet" href="/css/back-to-top.css">




<script async src="https://www.googletagmanager.com/gtag/js?id=UA-136207372-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-136207372-1');
</script>




<link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>



    



    
        <script async="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    




<link rel="stylesheet" href="/css/style.css">

</head>

<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/logo.png" alt="Note on Bip32" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item"
                href="/">Home</a>
                
                <a class="navbar-item"
                href="/archives">Archives</a>
                
                <a class="navbar-item"
                href="/projects">Projects</a>
                
                <a class="navbar-item"
                href="https://wiki.digit-map.de/">Digit Map</a>
                
            </div>
            
            <div class="navbar-end">
                
                    
                    
                    <a class="navbar-item" target="_blank" title="GitHub" href="https://github.com/keith-CY">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                    
                    <a class="navbar-item" target="_blank" title="Gmail" href="mailto:keithwhisper@gmail.com">
                        
                        <i class="fas fa-envelope"></i>
                        
                    </a>
                    
                
                
                
                <a class="navbar-item search" title="Search" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>

    <div class="card">
    
    <div class="card-image">
        <span  class="image is-7by1">
            <img class="thumbnail" src="/gallery/thumbnails/bip32.png" alt="Note on Bip32">
        </span>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-03-05T05:54:32.000Z">2019-03-05</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    6 minutes read (About 957 words)
                </span>
                
                
                <span class="level-item has-text-grey" id="busuanzi_container_page_pv">
                    <i class="far fa-eye"></i>
                    <span id="busuanzi_value_page_pv">0</span> visits
                </span>
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                Note on Bip32
            
        </h1>
        <div class="content">
            <p><a href="https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki" target="_blank" rel="noopener">wiki</a></p>
<p>The specification consists of two parts:</p>
<ol>
<li><p>a system for deriving a tree of keypairs from a single seed.</p>
</li>
<li><p>demostrate how to build a wallet structure on top of such a tree.</p>
</li>
</ol>
<h1 id="Specification-Key-derivation"><a href="#Specification-Key-derivation" class="headerlink" title="Specification: Key derivation"></a>Specification: Key derivation</h1><h2 id="Convention"><a href="#Convention" class="headerlink" title="Convention"></a>Convention</h2><p>In this text we assume the public key cryptography used in Bitcoin, namely elliptic curve cryttography using the field and curve parameters defined by secp256k1. Variables below are either:</p>
<ul>
<li><p>Integers modulo the order of the curve (referred to as n)</p>
</li>
<li><p>Coordinates of points on the curve</p>
</li>
<li><p>Byte sequences</p>
</li>
</ul>
<p>Addition (+) of two coordinate pair is defined as application of the EC group operation. Concatenation(||) is the operation of appending one byte sequence onto another.</p>
<h2 id="Extended-Keys"><a href="#Extended-Keys" class="headerlink" title="Extended Keys"></a>Extended Keys</h2><p>We are going to define a function to derive a number of child keys from a parent key. In order to prevent these from depending solely on the key itself, we extend both private key and public key first with an extra 256 bits of entropy. This extention, called the <strong>chain code</strong>, is identical for corresponding private key and public keys, and consist of 256 bits, namely 32 bytes.</p>
<p>We represent an extended private key as <code>(k, c)</code>, with <code>k</code> the normal private key and the c, the <code>chain code</code>. And extended public key is represented as <code>(K, c)</code>, with <code>K = point(k)</code> and the c the chain code.</p>
<p>Each extended key has 2^31 <strong>normal child keys</strong>, and 2^31 <strong>hardened child keys</strong>. Each of these child keys has an index. The normal child keys use indices <code>0</code> through <code>2^31 - 1</code>.</p>
<p>The hardened child keys use indices <code>2^31 - 1</code> through <code>2^32 - 1</code>.</p>
<p>To ease notation for hardened key indices, a number i_H represents i + 2 ^ 31.</p>
<h2 id="Child-key-derivation-CKB-function"><a href="#Child-key-derivation-CKB-function" class="headerlink" title="Child key derivation (CKB) function"></a>Child key derivation (CKB) function</h2><p>Given a parent extended key and an index i, it is possible to compute the corresponding child extended key. The algorithm to do so depends on whether the child is a hardened key or not.</p>
<h3 id="Private-parent-key-gt-private-child-key"><a href="#Private-parent-key-gt-private-child-key" class="headerlink" title="Private parent key =&gt; private child key"></a>Private parent key =&gt; private child key</h3><p>The function CKDpriv((k_par, c_par), i) =&gt; (k_i, c_i) computes a child extended private key from the parent extended private key.</p>
<ul>
<li>Check whether i &gt;= 2^31(whether the child is a hardened key)<ul>
<li>if so (hardened child): return failure</li>
<li>if not (normal child), let I = HMAC-SHA512(Key = c_par, Data = ser_P(K_par)||ser_32(i))</li>
</ul>
</li>
<li>Split I into two 32-byte sequences, I_L, and I_R.</li>
<li>The returned child key k_i is parse_256(I_L) + k_par(mod n)</li>
<li>The returned chain code c_i is I_R</li>
</ul>
<h3 id="Private-parent-key-gt-public-child-key"><a href="#Private-parent-key-gt-public-child-key" class="headerlink" title="Private parent key =&gt; public child key"></a>Private parent key =&gt; public child key</h3><h3 id="Public-parent-key-gt-private-child-key"><a href="#Public-parent-key-gt-private-child-key" class="headerlink" title="Public parent key =&gt; private child key"></a>Public parent key =&gt; private child key</h3><p>This is not possible.</p>
<h2 id="The-key-tree"><a href="#The-key-tree" class="headerlink" title="The key tree"></a>The key tree</h2><p>The next step is cascading serveral CKD construction to build a tree. We start with one root, the master extended key m. By evaluating CKBpriv(m, i) for several values of i, we get a number of level-1 derived nodes. As each of these is again an extended key, CKDpriv can be applied to those as well.</p>
<p>To shorten notation, we will write <code>CKDpriv(CKDpriv(CKDpriv(m, 3_H), 2), 5)</code> as <code>m/3_H/2/5</code>. Equivalently for public keys, we write <code>CKDpub(CKDpub(CKDpub(M, 3), 2), 5)</code> as <code>M/3/2/5</code>. This results in the following identities:</p>
<ul>
<li>N(m/a/b/c) = N(m/a/b)/c = N(m/a)/b/b = N(m)/a/b/c = M/a/b/c</li>
<li>N(m/a_H/b/c) = N(m/a_H/b)/c = N(m/a_H)/b/c</li>
</ul>
<p>However, N(m/a_H) cannot be rewritten as N(m)/a_H, as the latter is not possible.</p>
<h2 id="Key-identifiers"><a href="#Key-identifiers" class="headerlink" title="Key identifiers"></a>Key identifiers</h2><p>Extended keys can be identified by the Hash160(RIPED160 after SHA256) of the serialized ECDSA public key K, ignoring the chain code. This corresponds exactly to the data used in traditional Bitcoin addresses. It is not advised to represent this data in base58 format though, as it may be interpreted as an address that way.</p>
<p>The first 32 bits of the identifier are called <code>key finterprint</code>.</p>
<h2 id="Serialization-format"><a href="#Serialization-format" class="headerlink" title="Serialization format"></a>Serialization format</h2><p>Extended public and private keys are serialized as follows:</p>
<ul>
<li>4 bytes: version bytes (mainnet: 0x0488B21E public, 0x0488ADE4 private; testnet: 0x043587CF public, 0x04358394 private)</li>
<li>1 byte: depth: 0x00 for master nodes, 0x01 for level-1 derived keys.</li>
<li>4 bytes: the fingerprint of the parent’s key (0x00000000 if master key)</li>
<li>4 bytes: child number, 0x00000000 if master key</li>
<li>32 bytes: the chain code</li>
<li>33 bytes: the public key or private key data</li>
</ul>
<p>The 78 bytes structure can be encoded like other Bitcoin data in Base58, by first adding 32 checksum bits(derived from the double SHA256 checksum), and then conventing to the Base58 representation.</p>
<h1 id="Master-key-generation"><a href="#Master-key-generation" class="headerlink" title="Master key generation"></a>Master key generation</h1><p>The total number of possible extended keypairs is almost 2^512, but the produced keys are only 256 bits long, and offer about half of that in terms of security. Therefore the master keys are not generated directly, but instead from a potentially short seed value.</p>
<ul>
<li>Generate a seed byte sequence S of a chosen length(between 128 and 512 bits, 256 bits is advised) from a (P)RNG.</li>
<li>Calculate I = HMAC-SHA512(Key = “Bitcoin seed”, Data = S)</li>
<li>Split I into two 32-byte sequence, I_L and I_R</li>
<li>Use parse_256(I_L) as master secret key and I_R as master chain code.</li>
</ul>
<p>In case I_L is 0 or &gt;= n, the master key is invalid.</p>
<p><img src="https://github.com/bitcoin/bips/raw/master/bip-0032/derivation.png" alt=""></p>
<h1 id="Specification-Wallet-Structure"><a href="#Specification-Wallet-Structure" class="headerlink" title="Specification: Wallet Structure"></a>Specification: Wallet Structure</h1><h2 id="The-default-wallet-layout"><a href="#The-default-wallet-layout" class="headerlink" title="The default wallet layout"></a>The default wallet layout</h2><p>An HD Wallet is organized as several ‘accounts’. Accounts are numbered, the default account (“”) being numbered 0. Clients are not required to support more than one account, if not, they only use the default account.</p>
<p>Each account is composed of two keypair chains: an internal and an external one. The external keychain is used to generate new public addresses, while the internal one is used for all other operations(change addresses, generate addresses, anything that doesn’t need to be communicated).</p>

        </div>
        
        <div class="level is-size-7 is-uppercase">
            <div class="level-start">
                <div class="level-item">
                    <span class="is-size-6 has-text-grey has-mr-7">#</span>
                    <a class="has-link-grey -link" href="/tags/blockchain-bitcoin-bip/">blockchain, bitcoin, bip</a>
                </div>
            </div>
        </div>
        
        
        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="menu-label has-text-centered">Like this article? Support the author with</h3>
        <div class="buttons is-centered">
            
                <!-- Visit https://www.paypal.com/donate/buttons/ to get your donate button -->

<a class="button is-warning donate" onclick="document.getElementById(&#39;paypal-donate-form&#39;).submit()">
    <span class="icon is-small">
        <i class="fab fa-paypal"></i>
    </span>
    <span>Paypal</span>
</a>
<form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_blank" id="paypal-donate-form">
    <input type="hidden" name="cmd" value="_donations" />
    <input type="hidden" name="business" value="chen.yu.keith@foxmail.com" />
    <input type="hidden" name="currency_code" value="USD" />
</form>

                
        </div>
    </div>
</div>



<div class="card card-transparent">
    <div class="level post-navigation is-flex-wrap is-mobile">
        
        <div class="level-start">
            <a class="level level-item has-link-grey  article-nav-prev" href="/2019/03/16/keystore/">
                <i class="level-item fas fa-chevron-left"></i>
                <span class="level-item">Keystore</span>
            </a>
        </div>
        
        
        <div class="level-end">
            <a class="level level-item has-link-grey  article-nav-next" href="/2018/11/20/React-Hooks/">
                <span class="level-item">React Hooks</span>
                <i class="level-item fas fa-chevron-right"></i>
            </a>
        </div>
        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="title is-5 has-text-weight-normal">Comments</h3>
        
<div id="comment-container"></div>
<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
<script>
	var gitment = new Gitment({
		id: '2019/03/05/note-on-bip32/',
		owner: 'Keith-CY',
		repo: 'Keith-CY.github.io',
		oauth: {
			client_id: '56319e1ce36ed4313555',
			client_secret: 'ca7f10a8357d52290f5509fb54e5173a8bea0a5d',
		},
	})
	gitment.render('comment-container')
</script>

    </div>
</div>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("en");</script>


    
    
    
    <script src="/js/animation.js"></script>
    

    
    
    
    <script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
    <script src="/js/gallery.js" defer></script>
    

    
    

<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


    
    
<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>

    
    

<a id="back-to-top" title="Back to Top" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>


    
    

    
    
    
    
    
    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>
    <script src="/js/clipboard.js" defer></script>
    

    
    
    

    


<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>

</html>
