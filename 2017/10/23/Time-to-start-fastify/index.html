<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Time to Start Fastify | EzCook</title><meta name="description" content="Getting StartedInstall1yarn add fastify  First Server123456789101112131415&#x2F;&#x2F; Require the framework and instantiate itconst fastify &#x3D; require(&amp;#x27;fastify&amp;#x27;)()&#x2F;&#x2F; Declare a routefastify.get(&amp;#x27;&#x2F;"><meta name="keywords" content="Node.js,Fastify"><meta name="author" content="Chen Yu"><meta name="copyright" content="Chen Yu"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/logo.png"><link rel="canonical" href="https://ezcook.de/2017/10/23/Time-to-start-fastify/"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin="crossorigin"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta property="og:type" content="article"><meta property="og:title" content="Time to Start Fastify"><meta property="og:url" content="https://ezcook.de/2017/10/23/Time-to-start-fastify/"><meta property="og:site_name" content="EzCook"><meta property="og:description" content="Getting StartedInstall1yarn add fastify  First Server123456789101112131415&#x2F;&#x2F; Require the framework and instantiate itconst fastify &#x3D; require(&amp;#x27;fastify&amp;#x27;)()&#x2F;&#x2F; Declare a routefastify.get(&amp;#x27;&#x2F;"><meta property="og:image" content="https://ezcook.de/img/default_cover_1.jpg"><meta property="article:published_time" content="2017-10-23T06:50:14.000Z"><meta property="article:modified_time" content="2020-08-30T12:57:27.151Z"><meta name="twitter:card" content="summary"><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#000')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
  }
}

var getCookies = function (name) {
  const value = `; ${document.cookie}`
  const parts = value.split(`; ${name}=`)
  if (parts.length === 2) return parts.pop().split(';').shift()
}

var autoChangeMode = 'false'
var t = getCookies('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (Cookies.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.js" defer></script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-136207372-1"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-136207372-1');
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap"><script>var GLOBAL_CONFIG = { 
  root: '/',
  hexoversion: '5.1.1',
  algolia: {"appId":"KU7XP6WJWL","apiKey":"6806ddc27f224d4ebc2fe49dc770371c","indexName":"Blog","hits":{"per_page":6},"languages":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}.","hits_stats":"${hits} results found in ${time} ms"}},
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  bookmark: {
    message_prev: 'Press',
    message_next: 'to bookmark this page'
  },
  runtime_unit: 'days',
  runtime: false,
  copyright: {"limitCount":50,"languages":{"author":"Author: Chen Yu","link":"Link: ","source":"Source: EzCook","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source."}},
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: true    
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2020-08-30 20:57:27'
}</script><noscript><style>
#nav {
  opacity: 1
}
.justified-gallery img {
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 5.1.1"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/gotterdammerung.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">312</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">Tags</div><div class="length_num">77</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">Categories</div><div class="length_num">7</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-address-card"></i><span> About</span></a></div><div class="menus_item"><a class="site-page" href="/portfolio/"><i class="fa-fw fas fa-code"></i><span> Portfolio</span></a></div></div></div></div><div id="body-wrap"><div id="web_bg" data-type="color"></div><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Getting-Started"><span class="toc-number">1.</span> <span class="toc-text">Getting Started</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Install"><span class="toc-number">1.1.</span> <span class="toc-text">Install</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#First-Server"><span class="toc-number">1.2.</span> <span class="toc-text">First Server</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Schema-Serialization"><span class="toc-number">1.3.</span> <span class="toc-text">Schema Serialization</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Register"><span class="toc-number">1.4.</span> <span class="toc-text">Register</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Server-Methods"><span class="toc-number">2.</span> <span class="toc-text">Server Methods</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#server"><span class="toc-number">2.1.</span> <span class="toc-text">server</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ready"><span class="toc-number">2.2.</span> <span class="toc-text">ready</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#listen"><span class="toc-number">2.3.</span> <span class="toc-text">listen</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#route"><span class="toc-number">2.4.</span> <span class="toc-text">route</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#routes-iterator"><span class="toc-number">2.5.</span> <span class="toc-text">routes iterator</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#close"><span class="toc-number">2.6.</span> <span class="toc-text">close</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#decorate"><span class="toc-number">2.7.</span> <span class="toc-text">decorate*</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#register"><span class="toc-number">2.8.</span> <span class="toc-text">register</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#use"><span class="toc-number">2.9.</span> <span class="toc-text">use</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#addHook"><span class="toc-number">2.10.</span> <span class="toc-text">addHook</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#logger"><span class="toc-number">2.11.</span> <span class="toc-text">logger</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Inject"><span class="toc-number">2.12.</span> <span class="toc-text">Inject</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#setSchemaCompiler"><span class="toc-number">2.13.</span> <span class="toc-text">setSchemaCompiler</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#setNotFoundHandler"><span class="toc-number">2.14.</span> <span class="toc-text">setNotFoundHandler</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#setErrorHandler"><span class="toc-number">2.15.</span> <span class="toc-text">setErrorHandler</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Routes"><span class="toc-number">3.</span> <span class="toc-text">Routes</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ShortHands"><span class="toc-number">3.1.</span> <span class="toc-text">ShortHands</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Async-Await"><span class="toc-number">3.2.</span> <span class="toc-text">Async&#x2F;Await</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Route-Prefixing"><span class="toc-number">3.3.</span> <span class="toc-text">Route Prefixing</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Logging"><span class="toc-number">4.</span> <span class="toc-text">Logging</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Middlewares"><span class="toc-number">5.</span> <span class="toc-text">Middlewares</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hook"><span class="toc-number">6.</span> <span class="toc-text">Hook</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Scope"><span class="toc-number">6.1.</span> <span class="toc-text">Scope</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#beforeHandler"><span class="toc-number">6.2.</span> <span class="toc-text">beforeHandler</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Decorators"><span class="toc-number">7.</span> <span class="toc-text">Decorators</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Usage"><span class="toc-number">7.1.</span> <span class="toc-text">Usage</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#decorate-1"><span class="toc-number">7.1.1.</span> <span class="toc-text">decorate</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#decorateReply"><span class="toc-number">7.1.2.</span> <span class="toc-text">decorateReply</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#decorateRequest"><span class="toc-number">7.1.3.</span> <span class="toc-text">decorateRequest</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#extendServerError"><span class="toc-number">7.1.4.</span> <span class="toc-text">extendServerError</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Sync-and-Async"><span class="toc-number">7.2.</span> <span class="toc-text">Sync and Async</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Dependencies"><span class="toc-number">7.3.</span> <span class="toc-text">Dependencies</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#hasDecorator"><span class="toc-number">7.4.</span> <span class="toc-text">hasDecorator</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Validation-and-Serialize"><span class="toc-number">8.</span> <span class="toc-text">Validation and Serialize</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Validation"><span class="toc-number">8.1.</span> <span class="toc-text">Validation</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Schema-Compiler"><span class="toc-number">8.2.</span> <span class="toc-text">Schema Compiler</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Serialize"><span class="toc-number">8.3.</span> <span class="toc-text">Serialize</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lifecycle"><span class="toc-number">9.</span> <span class="toc-text">Lifecycle</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Reply"><span class="toc-number">10.</span> <span class="toc-text">Reply</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Code"><span class="toc-number">10.1.</span> <span class="toc-text">Code</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Header"><span class="toc-number">10.2.</span> <span class="toc-text">Header</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Redirect"><span class="toc-number">10.3.</span> <span class="toc-text">Redirect</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Type"><span class="toc-number">10.4.</span> <span class="toc-text">Type</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Serializer"><span class="toc-number">10.5.</span> <span class="toc-text">Serializer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Send"><span class="toc-number">10.6.</span> <span class="toc-text">Send</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Objects"><span class="toc-number">10.7.</span> <span class="toc-text">Objects</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Promises"><span class="toc-number">10.8.</span> <span class="toc-text">Promises</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Streams"><span class="toc-number">10.9.</span> <span class="toc-text">Streams</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Errors"><span class="toc-number">10.10.</span> <span class="toc-text">Errors</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Request"><span class="toc-number">11.</span> <span class="toc-text">Request</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Content-Type-Parser"><span class="toc-number">12.</span> <span class="toc-text">Content Type Parser</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Catch-All"><span class="toc-number">12.1.</span> <span class="toc-text">Catch All</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Plugins"><span class="toc-number">13.</span> <span class="toc-text">Plugins</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Craete-a-Plugin"><span class="toc-number">14.</span> <span class="toc-text">Craete a Plugin</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Handle-the-Scope"><span class="toc-number">14.1.</span> <span class="toc-text">Handle the Scope</span></a></li></ol></li></ol></div></div></div><header class="post-bg" id="page-header" style="background-image: url(/img/default_cover_1.jpg)"><nav id="nav"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">EzCook</a></span><span class="pull-right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-address-card"></i><span> About</span></a></div><div class="menus_item"><a class="site-page" href="/portfolio/"><i class="fa-fw fas fa-code"></i><span> Portfolio</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">Time to Start Fastify</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2017-10-23T06:50:14.000Z" title="Created 2017-10-23 14:50:14">2017-10-23</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2020-08-30T12:57:27.151Z" title="Updated 2020-08-30 20:57:27">2020-08-30</time></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">Comments:</span><span class="disqus-comment-count comment-count"><a href="https://ezcook.de/2017/10/23/Time-to-start-fastify/#disqus_thread"></a></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h3 id="Getting-Started"><a href="#Getting-Started" class="headerlink" title="Getting Started"></a>Getting Started</h3><h4 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add fastify</span><br></pre></td></tr></table></figure>

<h4 id="First-Server"><a href="#First-Server" class="headerlink" title="First Server"></a>First Server</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Require the framework and instantiate it</span></span><br><span class="line"><span class="keyword">const</span> fastify = <span class="built_in">require</span>(<span class="string">&#x27;fastify&#x27;</span>)()</span><br><span class="line"></span><br><span class="line"><span class="comment">// Declare a route</span></span><br><span class="line">fastify.get(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, reply</span>) =&gt;</span> &#123;</span><br><span class="line">  reply.send(&#123;</span><br><span class="line">    hello: <span class="string">&#x27;world&#x27;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Run the server</span></span><br><span class="line">fastify.listen(<span class="number">3000</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Server is running on <span class="subst">$&#123;fastify.server.address().port&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="Schema-Serialization"><a href="#Schema-Serialization" class="headerlink" title="Schema Serialization"></a>Schema Serialization</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fastify = <span class="built_in">require</span>(<span class="string">&#x27;fastify&#x27;</span>)()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> opts = &#123;</span><br><span class="line">  schema: &#123;</span><br><span class="line">    response: &#123;</span><br><span class="line">      <span class="number">200</span>: &#123;</span><br><span class="line">        type: <span class="string">&#x27;object&#x27;</span>,</span><br><span class="line">        properties: &#123;</span><br><span class="line">          hello: &#123; <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span> &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Declare a route with an output shcema</span></span><br><span class="line">fastify.get(<span class="string">&#x27;/&#x27;</span>, opts, <span class="function">(<span class="params">req, reply</span>) =&gt;</span> &#123;</span><br><span class="line">  replysend(&#123; <span class="attr">hello</span>: <span class="string">&#x27;world&#x27;</span> &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fastify.listen(<span class="number">3000</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Server is running on <span class="subst">$&#123;fastify.server.address().port&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="Register"><a href="#Register" class="headerlink" title="Register"></a>Register</h4><p>Register routes in seperate files</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"><span class="keyword">const</span> fastify = <span class="built_in">require</span>(<span class="string">&#x27;fastify&#x27;</span>)()</span><br><span class="line"></span><br><span class="line">fastify.register(<span class="built_in">require</span>(<span class="string">&#x27;./route&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> opts = &#123;</span><br><span class="line">  hello: <span class="string">&#x27;world&#x27;</span>,</span><br><span class="line">  something: <span class="literal">true</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fastify.register([</span><br><span class="line">  <span class="built_in">require</span>(<span class="string">&#x27;./another-route&#x27;</span>),</span><br><span class="line">  <span class="built_in">require</span>(<span class="string">&#x27;./yet-another-route&#x27;</span>),</span><br><span class="line">], opts, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fastify.listen(<span class="number">3000</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Server is running on <span class="subst">$&#123;fastify.server.address().port&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// route.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = (fastify, options, next) &#123;</span><br><span class="line">  fastify.get(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, reply</span>) =&gt;</span> &#123;</span><br><span class="line">    replysend(&#123; <span class="attr">hello</span>: <span class="string">&#x27;world&#x27;</span> &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  next()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>or <code>async/await</code>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="keyword">async</span> (fastify, options) =&gt; &#123;</span><br><span class="line">  fastify.get(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, reply</span>) =&gt;</span> &#123;</span><br><span class="line">    replysend(&#123; <span class="attr">hello</span>: <span class="string">&#x27;world&#x27;</span> &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Server-Methods"><a href="#Server-Methods" class="headerlink" title="Server Methods"></a>Server Methods</h3><h4 id="server"><a href="#server" class="headerlink" title="server"></a>server</h4><p><code>fastify.server</code>: The Node Core <code>server</code> object.</p>
<h4 id="ready"><a href="#ready" class="headerlink" title="ready"></a>ready</h4><p>Function  called when all the plugins has been loaded. It takes an error parameter if something went wrong.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastify.ready(<span class="function"><span class="params">err</span> =&gt;</span> &#123; <span class="keyword">if</span> (err) <span class="keyword">throw</span> err &#125;)</span><br></pre></td></tr></table></figure>

<h4 id="listen"><a href="#listen" class="headerlink" title="listen"></a>listen</h4><p>Starts the server on the given port after all the plugins loaded, internally waits for the <code>.ready()</code> event. The callback is the same as the Node Core.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fastify.listen(<span class="number">3000</span>, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>Specifying an address is also supported:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fastify.listen(<span class="number">3000</span>, <span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="route"><a href="#route" class="headerlink" title="route"></a>route</h4><p>Method to add routes to the server, it also have shorthands.</p>
<h4 id="routes-iterator"><a href="#routes-iterator" class="headerlink" title="routes iterator"></a>routes iterator</h4><p>The fastify instance is an Iterable object with all the registered routes. The route properties are the same the developer has declared.</p>
<h4 id="close"><a href="#close" class="headerlink" title="close"></a>close</h4><p><code>fastify.close(callback)</code>, call this function to close the server instance and run the <code>onClose</code> hook.</p>
<h4 id="decorate"><a href="#decorate" class="headerlink" title="decorate*"></a>decorate*</h4><p>Function useful if you need to decorate the fastify instance, Reply or Request.</p>
<h4 id="register"><a href="#register" class="headerlink" title="register"></a>register</h4><p>Fastify allows the user to extends its functionalities with plugins. A plugin can be a set of routes, a server decorator or whatever.</p>
<h4 id="use"><a href="#use" class="headerlink" title="use"></a>use</h4><p>Function to add middlewares to Fastify.</p>
<h4 id="addHook"><a href="#addHook" class="headerlink" title="addHook"></a>addHook</h4><p>Function to add a specific hook in the lifecycle of Fastify.</p>
<h4 id="logger"><a href="#logger" class="headerlink" title="logger"></a>logger</h4><p>The logger instance.</p>
<h4 id="Inject"><a href="#Inject" class="headerlink" title="Inject"></a>Inject</h4><p>Fake http injection(for testing purpose).</p>
<h4 id="setSchemaCompiler"><a href="#setSchemaCompiler" class="headerlink" title="setSchemaCompiler"></a>setSchemaCompiler</h4><p>Set the schema compiler for all routes.</p>
<h4 id="setNotFoundHandler"><a href="#setNotFoundHandler" class="headerlink" title="setNotFoundHandler"></a>setNotFoundHandler</h4><p><code>fastify.setNotFoundHandler(handler(req, reply))</code>: set the 404 handler. This call is fully encapsulated, so different plugins can set different not found handlers.</p>
<h4 id="setErrorHandler"><a href="#setErrorHandler" class="headerlink" title="setErrorHandler"></a>setErrorHandler</h4><p><code>fastify.setErrorHandler(handler(err, reply))</code>: set a function that will be called whenever an error happens. The handler is fully encapsulated, so different plugins can set different error handlers.</p>
<h3 id="Routes"><a href="#Routes" class="headerlink" title="Routes"></a>Routes</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastify.route(options)</span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>method</code>: currently it supports <code>DELETE</code>, <code>GET</code>, <code>HEAD</code>, <code>PATCH</code>, <code>POST</code>, <code>PUT</code>, and <code>OPTIONS</code>, it could be an array of methods.</p>
</li>
<li><p><code>url</code>: the path of the url to match this route (alias: <code>path</code>)</p>
</li>
<li><p><code>schema</code>: an object containing the schemas for the request and response. They need to be in <code>JSON Schema</code> format.</p>
<ul>
<li><p><code>body</code>: validates the body of the request if it is a POST or PUT.</p>
</li>
<li><p><code>querystring</code>: validates the querystring. This can be a complete JSON Schema Object, with the property <code>type</code> of <code>object</code> and <code>properties</code> object of parameters, or simply the values of what would be contained in the properties object as shown below.</p>
</li>
<li><p><code>params</code>: validates the params.</p>
</li>
<li><p><code>response</code>: fitler and generate a schema for the response, setting a schema allows us to have 10-20% more throughput.</p>
</li>
</ul>
</li>
<li><p><code>beforeHandler(req, res, done)</code>: a function called just before the request handler, useful if you need to perform authentication at route level for example, it could also be and array of functions.</p>
</li>
<li><p><code>handler(req, reply)</code>: the function that will handle this request.</p>
</li>
<li><p><code>request</code> if defined in <code>Request</code>.</p>
</li>
<li><p><code>reply</code> is defined in <code>Reply</code>.</p>
</li>
</ul>
<p>Exmaple</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">fastify.route(&#123;</span><br><span class="line">  method: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">  url: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">  schema: &#123;</span><br><span class="line">    querystring: &#123;</span><br><span class="line">      name: &#123; <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span> &#125;,</span><br><span class="line">      excitement: &#123; <span class="attr">type</span>: <span class="string">&#x27;integer&#x27;</span> &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    response: &#123;</span><br><span class="line">      <span class="number">200</span>: &#123;</span><br><span class="line">        type: <span class="string">&#x27;object&#x27;</span>,</span><br><span class="line">        properties: &#123;</span><br><span class="line">          hello: &#123; <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span> &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  handler: <span class="function"><span class="keyword">function</span> (<span class="params">req, reply</span>) </span>&#123;</span><br><span class="line">    reply.send(&#123;</span><br><span class="line">      hello: <span class="string">&#x27;world&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fastify.route(&#123;</span><br><span class="line">  method: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">  url: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">  schema: &#123;<span class="comment">/*..*/</span>&#125;,</span><br><span class="line">  beforeHandler: <span class="function"><span class="keyword">function</span> (<span class="params">req, reply, done</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// auth</span></span><br><span class="line">    done()</span><br><span class="line">  &#125;,</span><br><span class="line">  handler: <span class="function"><span class="keyword">function</span>(<span class="params">req, reply</span>) </span>&#123;</span><br><span class="line">    reply.send(&#123;</span><br><span class="line">      hello: <span class="string">&#x27;world&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="ShortHands"><a href="#ShortHands" class="headerlink" title="ShortHands"></a>ShortHands</h4><p><code>fastify.method(path, [options], handler)</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> opts = &#123;</span><br><span class="line">  schema: &#123;</span><br><span class="line">    response: &#123;</span><br><span class="line">      <span class="number">200</span>: &#123;</span><br><span class="line">        type: <span class="string">&#x27;object&#x27;</span>,</span><br><span class="line">        properites: &#123;</span><br><span class="line">          hello: &#123; <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span> &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fastify.get(<span class="string">&#x27;/&#x27;</span>, opts, <span class="function">(<span class="params">req, reply</span>) =&gt;</span> &#123;</span><br><span class="line">  reply.send(&#123;</span><br><span class="line">    hello: <span class="string">&#x27;world&#x27;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><code>fastify.all(path, [options], handler)</code> will add the same handler to all the supported methods.</p>
<h4 id="Async-Await"><a href="#Async-Await" class="headerlink" title="Async/Await"></a>Async/Await</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fastify.get(<span class="string">&#x27;/&#x27;</span>, options, <span class="keyword">async</span> (req, reply) =&gt; &#123;</span><br><span class="line">  <span class="keyword">var</span> data = <span class="keyword">await</span> getData()</span><br><span class="line">  <span class="keyword">var</span> processed = <span class="keyword">await</span> processData(data)</span><br><span class="line">  <span class="keyword">return</span> processed</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="Route-Prefixing"><a href="#Route-Prefixing" class="headerlink" title="Route Prefixing"></a>Route Prefixing</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"><span class="keyword">const</span> fastify = <span class="built_in">require</span>(<span class="string">&#x27;fastify&#x27;</span>)()</span><br><span class="line"></span><br><span class="line">fastify.register(<span class="built_in">require</span>(<span class="string">&#x27;./routes/v1/users&#x27;</span>), &#123;</span><br><span class="line">  prefix: <span class="string">&#x27;/v1&#x27;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// routes/v1/users</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">fastify, opts, next</span>) </span>&#123;</span><br><span class="line">  fastify.get(<span class="string">&#x27;/user&#x27;</span>, handler_v1)</span><br><span class="line">  next()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now your client can access to <code>/v1/user</code>.</p>
<p>Be aware that if you use <code>fastify-plugin</code> this option won’t work.</p>
<h3 id="Logging"><a href="#Logging" class="headerlink" title="Logging"></a>Logging</h3><p>Logging is disabled by default, and you can enable it by passing <code>&#123; logger: true &#125;</code> or <code>&#123; logger: &#123; level: &#39;info&#39; &#125; &#125;</code> when you create the fastify instance.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fastify = <span class="built_in">require</span>(<span class="string">&#x27;fastify&#x27;</span>)(&#123;</span><br><span class="line">  logger: <span class="literal">true</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fastify.get(<span class="string">&#x27;/&#x27;</span>, options, <span class="function">(<span class="params">req, reply</span>) =&gt;</span> &#123;</span><br><span class="line">  req.log.info(<span class="string">&#x27;Some info about the current request&#x27;</span>)</span><br><span class="line">  reply.send(&#123;</span><br><span class="line">    hello: <span class="string">&#x27;world&#x27;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="Middlewares"><a href="#Middlewares" class="headerlink" title="Middlewares"></a>Middlewares</h3><p>Fastify provides out of the box an asynchronous middleare engine compatible with Express and Restify middlewares.</p>
<p>Fastify middleware don’t support the full syntax <code>middleware(err, req, res, next)</code> because error handling is done inside Fastify.</p>
<p>Also if you are using a middleware taht bundles different, smaller middlewares such as helmet, we recommand to use the single module to get better performances.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fastify.use(<span class="built_in">require</span>(<span class="string">&#x27;cors&#x27;</span>)())</span><br><span class="line">fastify.use(<span class="built_in">require</span>(<span class="string">&#x27;dns-prefetch-control&#x27;</span>)())</span><br><span class="line">fastify.use(<span class="built_in">require</span>(<span class="string">&#x27;frameguard&#x27;</span>)())</span><br><span class="line">fastify.use(<span class="built_in">require</span>(<span class="string">&#x27;hide-powered-by&#x27;</span>)())</span><br><span class="line">fastify.use(<span class="built_in">require</span>(<span class="string">&#x27;hsts&#x27;</span>)())</span><br><span class="line">fastify.use(<span class="built_in">require</span>(<span class="string">&#x27;ienoopen&#x27;</span>)())</span><br><span class="line">fastify.use(<span class="built_in">require</span>(<span class="string">&#x27;x-xss-protection&#x27;</span>)())</span><br></pre></td></tr></table></figure>

<p>If you need to run a middleware only under certain path, just pass the path as first parameter to <code>use</code> and you are done.</p>
<p>Note that this does not support routes with parameters, (eg: <code>/users/:id/comments</code>) and wildcard is not supported in multiple paths.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> serveStatic = <span class="built_in">require</span>(<span class="string">&#x27;serve-static&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// single path</span></span><br><span class="line">fastify.use(<span class="string">&#x27;/css&#x27;</span>, servveStatic(<span class="string">&#x27;/asserts&#x27;</span>))</span><br><span class="line"><span class="comment">// wildcard path</span></span><br><span class="line">fastify.use(<span class="string">&#x27;/css/*&#x27;</span>, servveStatic(<span class="string">&#x27;/asserts&#x27;</span>))</span><br><span class="line"><span class="comment">// multiple paths</span></span><br><span class="line">fastify.use([<span class="string">&#x27;/css&#x27;</span>, <span class="string">&#x27;/js&#x27;</span>], servveStatic(<span class="string">&#x27;/asserts&#x27;</span>))</span><br></pre></td></tr></table></figure>

<h3 id="Hook"><a href="#Hook" class="headerlink" title="Hook"></a>Hook</h3><p>By using the hook you can interact directly inside the lifecycle of Fastify, there are three different Hooks that you can use(in order of execution):</p>
<ul>
<li><p><code>onRequest</code></p>
</li>
<li><p><code>preHandler</code></p>
</li>
<li><p><code>onResponse</code></p>
</li>
<li><p><code>onClose</code></p>
</li>
</ul>
<p>Example:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">fastify.addHook(<span class="string">&#x27;onRequest&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// some code</span></span><br><span class="line">  next()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fastify.addHook(<span class="string">&#x27;preHandler&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// some code</span></span><br><span class="line">  next()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fastify.addHook(<span class="string">&#x27;onResponse&#x27;</span>, <span class="function">(<span class="params">res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// some code</span></span><br><span class="line">  next()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>If you want to pass a custom error code to the user, just use the <code>reply.code()</code>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fastify.addHook(<span class="string">&#x27;onRequest&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// some code</span></span><br><span class="line">  reply.code(<span class="number">400</span>)</span><br><span class="line">  next(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;some error&#x27;</span>))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>The error will be handled by <code>Reply</code></p>
<p>The unique hook that is not inside the lifecycle is <code>&#39;onClose&#39;</code>, this one is triggered when you call <code>fastify.close()</code> to stop the server, and it is useful if you have some plugins that need a ‘shutdown’ part, such as a connection to database.</p>
<p>Only for this hook the parameters of the functions changes.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fastify.addHook(<span class="string">&#x27;onClose&#x27;</span>, <span class="function">(<span class="params">instance, done</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// some code</span></span><br><span class="line">  done()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="Scope"><a href="#Scope" class="headerlink" title="Scope"></a>Scope</h4><p>Except for <code>onClose</code> all the hooks are encapsulated this means that you can decide where your hooks should run by using <code>register</code>.</p>
<h4 id="beforeHandler"><a href="#beforeHandler" class="headerlink" title="beforeHandler"></a>beforeHandler</h4><p><code>beforeHandler</code> is not a standard hook like <code>preHandler</code>, but is a function that your register right in the route option that will be executed only in the specified route.</p>
<p><code>beforeHandler</code> is executed always after the <code>preHandler</code> hook.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">fastify.addHook(<span class="string">&#x27;preHander&#x27;</span>, <span class="function">(<span class="params">req, reply, done</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//  your code</span></span><br><span class="line">  done()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fastify.route(&#123;</span><br><span class="line">  method: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">  url: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">  schema: &#123;<span class="comment">/*...*/</span>&#125;,</span><br><span class="line">  beforeHandler: <span class="function">(<span class="params">req, reply, done</span>) =&gt;</span> &#123;<span class="comment">/*...*/</span> ;done()&#125;</span><br><span class="line">  handler: <span class="function">(<span class="params">req, reply</span>) =&gt;</span> &#123; reply.send(&#123; <span class="attr">hello</span>: <span class="string">&#x27;world&#x27;</span> &#125;) &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fastify.route(&#123;</span><br><span class="line">  method: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">  url: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">  shcema: &#123;<span class="comment">/*...*/</span>&#125;,</span><br><span class="line">  beforeHandler: [</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">first</span> (<span class="params">req, reply, done</span>) </span>&#123;</span><br><span class="line">      done()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">second</span> (<span class="params">req, reply, done</span>) </span>&#123;</span><br><span class="line">      done()</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  handler: <span class="function"><span class="keyword">function</span> (<span class="params">req, reply</span>) </span>&#123;</span><br><span class="line">    reply.send(&#123; <span class="attr">hello</span>: <span class="string">&#x27;world&#x27;</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="Decorators"><a href="#Decorators" class="headerlink" title="Decorators"></a>Decorators</h3><p>If you need to add functionalities to the Fastify instance, the <code>decorator</code> api is what you need.</p>
<p>This api allows you to add new properties to the Fastify instance, a property value is not restricted to be a function, could also be an object or a string for example.</p>
<h4 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h4><h5 id="decorate-1"><a href="#decorate-1" class="headerlink" title="decorate"></a>decorate</h5><p>Just call the <code>decorate</code> api and pass the name of the new property and its value.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fastify.decorate(<span class="string">&#x27;utility&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// something very useful</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>As said above, you can decorate the instance with other values and not only functions:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fastify.decorate(<span class="string">&#x27;conf&#x27;</span>, &#123;</span><br><span class="line">  db: <span class="string">&#x27;some db&#x27;</span>,</span><br><span class="line">  port: <span class="number">3000</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>Once you decorate the instance you can access the value every time you need by using the name you passed as parameter:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fastify.utility()</span><br><span class="line"><span class="built_in">console</span>.log(fastify.conf.db)</span><br></pre></td></tr></table></figure>

<p>Decorators are not <em>overwritable</em>, if you try to declare a decorator already declared, <code>decorate</code> will throw an exception.</p>
<h5 id="decorateReply"><a href="#decorateReply" class="headerlink" title="decorateReply"></a>decorateReply</h5><p>As the name suggest, this api is needed if you want to add new methods to the <code>Reply</code> core object. Just call the <code>decorateReply</code> api and pass the name of the new property and its value.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fastify.decorateReply(<span class="string">&#x27;utility&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// something very useful</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>Note: using an arrow function will break the binding of <code>this</code> to the Fastify <code>reply</code> instance.</p>
<h5 id="decorateRequest"><a href="#decorateRequest" class="headerlink" title="decorateRequest"></a>decorateRequest</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fastify.decorateRequest(<span class="string">&#x27;utility&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// something very useful</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>Note: using an arrow function will break the binding of <code>this</code> to the Fastify <code>request</code> instance.</p>
<h5 id="extendServerError"><a href="#extendServerError" class="headerlink" title="extendServerError"></a>extendServerError</h5><p>If you need to extend the standard <code>server error</code>, this api is what you need.</p>
<p>You must pass a function that returns an Object, Fastify will extend the server error with the returned object of your function. The function will receive the original error object.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">fastify.extendServerError(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    timestamp: <span class="keyword">new</span> <span class="built_in">Date</span>(),</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  The resulting object will be: &#123;</span></span><br><span class="line"><span class="comment">    error: string,</span></span><br><span class="line"><span class="comment">    message: string,</span></span><br><span class="line"><span class="comment">    statusCode: number,</span></span><br><span class="line"><span class="comment">    timestamp: date,</span></span><br><span class="line"><span class="comment">  &#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h4 id="Sync-and-Async"><a href="#Sync-and-Async" class="headerlink" title="Sync and Async"></a>Sync and Async</h4><p><code>decorate</code> is synchronous API, if you need to add a decorator that has an asynchronous bootstrap, could happen that Fastify boots up before your decorator is ready. To avoid this issue you must use <code>register</code> api in combination with <code>fastify-plugin</code>.</p>
<h4 id="Dependencies"><a href="#Dependencies" class="headerlink" title="Dependencies"></a>Dependencies</h4><p>If your decorator depends on another decorator, you can declare the dependencies of your function, it’s pretty easy, you just need to add an array of strings(representing the names of the decorators your are depending on) as third parameter.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastify.decorate(<span class="string">&#x27;utility&#x27;</span>, fn, [<span class="string">&#x27;greet&#x27;</span>, <span class="string">&#x27;log&#x27;</span>])</span><br></pre></td></tr></table></figure>

<p>If a dependency is not satisfied, <code>decorate</code> will throw an exception.</p>
<h4 id="hasDecorator"><a href="#hasDecorator" class="headerlink" title="hasDecorator"></a>hasDecorator</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastify.hasDecorator(<span class="string">&#x27;utility&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="Validation-and-Serialize"><a href="#Validation-and-Serialize" class="headerlink" title="Validation and Serialize"></a>Validation and Serialize</h3><p>Fastify uses a schema based approach and even if it is not mandatory we recommend to use JSON Schema to validate you routes and serialize your output, internally Fastify compiles the schema in a highly performance function.</p>
<h4 id="Validation"><a href="#Validation" class="headerlink" title="Validation"></a>Validation</h4><p>The route validation internally uses <code>Ajv</code>, which is highly performant JSON validator. Validate the input is very easy, just add the fields that you need inside the route schema and you are done.</p>
<p>The supported validations are</p>
<ul>
<li><p>body: Validates the body of the request if it is a POST or PUT</p>
</li>
<li><p>querystring: Validates the querystring. This can be a complete JSON Schema object, with the property type of object and properties object of parameters, or simply the values of what would be contained in the properties object as shown below.</p>
</li>
<li><p>params: Validates teh route params.</p>
</li>
<li><p>headers: Validates teh request headers.</p>
</li>
</ul>
<p>Example:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> schema = &#123;</span><br><span class="line">  body: &#123;</span><br><span class="line">    type: <span class="string">&#x27;object&#x27;</span>,</span><br><span class="line">    properties: &#123;</span><br><span class="line">      someKey: &#123; <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span>&#125;,</span><br><span class="line">      someOtherKey: &#123; <span class="attr">type</span>: <span class="string">&#x27;number&#x27;</span> &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  querystring: &#123;</span><br><span class="line">    name: &#123; <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span> &#125;,</span><br><span class="line">    excitement: &#123; <span class="attr">type</span>: <span class="string">&#x27;integer&#x27;</span> &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  params: &#123;</span><br><span class="line">    type: <span class="string">&#x27;object&#x27;</span>,</span><br><span class="line">    properties: &#123;</span><br><span class="line">      par1: &#123; <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span> &#125;,</span><br><span class="line">      par2: &#123; <span class="attr">type</span>: <span class="string">&#x27;number&#x27;</span> &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  headers: &#123;</span><br><span class="line">    type: <span class="string">&#x27;object&#x27;</span>,</span><br><span class="line">    properties: &#123;</span><br><span class="line">      <span class="string">&#x27;x-foo&#x27;</span>: &#123; <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span> &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    required: [<span class="string">&#x27;x-foo&#x27;</span>],</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Schema-Compiler"><a href="#Schema-Compiler" class="headerlink" title="Schema Compiler"></a>Schema Compiler</h4><p>The <code>schemaCompiler</code> is a function that returns a function that validates the body, url parameters, headers and query string.</p>
<p>The default <code>schemaCompiler</code> returns a function that implements the <code>ajv</code> validation interface. <code>fastify</code> use it internally to speed the valiation up.</p>
<h4 id="Serialize"><a href="#Serialize" class="headerlink" title="Serialize"></a>Serialize</h4><p>Usually you will send your data to the clients via JSON, and Fastify has a powerful tools to help you: <code>fast-json-stringify</code>, which is used if you have provided an output schema in the route options.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> schema = &#123;</span><br><span class="line">  response: &#123;</span><br><span class="line">    <span class="number">200</span>: &#123;</span><br><span class="line">      type: <span class="string">&#x27;object&#x27;</span>,</span><br><span class="line">      properties: &#123;</span><br><span class="line">        value: &#123; <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span> &#125;,</span><br><span class="line">        otherValue: &#123; <span class="attr">type</span>: <span class="string">&#x27;boolean&#x27;</span> &#125;,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>As you can see the response schema is based on the status code, if you want to use the same schema for mutliple status code, you can use <code>2xx</code>.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> schema = &#123;</span><br><span class="line">  response: &#123;</span><br><span class="line">    <span class="string">&#x27;2xx&#x27;</span>: &#123;</span><br><span class="line">      type: <span class="string">&#x27;object&#x27;</span>,</span><br><span class="line">      properties: &#123;</span><br><span class="line">        value: &#123; <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span> &#125;,</span><br><span class="line">        otherValue: &#123; <span class="attr">type</span>: <span class="string">&#x27;boolean&#x27;</span> &#125;,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="number">201</span>: &#123;</span><br><span class="line">      type: <span class="string">&#x27;object&#x27;</span>,</span><br><span class="line">      properties: &#123;</span><br><span class="line">        value: &#123; <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span> &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Lifecycle"><a href="#Lifecycle" class="headerlink" title="Lifecycle"></a>Lifecycle</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Incoming Request</span><br><span class="line">  │</span><br><span class="line">  └─▶ Instance Logger</span><br><span class="line">        │</span><br><span class="line">        └─▶ Routing</span><br><span class="line">             │</span><br><span class="line">       404 ◀─┴─▶ onRequest Hook</span><br><span class="line">                  │</span><br><span class="line">        4**&#x2F;5** ◀─┴─▶ run Middlewares</span><br><span class="line">                        │</span><br><span class="line">              4**&#x2F;5** ◀─┴─▶ Parsing</span><br><span class="line">                             │</span><br><span class="line">                       415 ◀─┴─▶ Validation</span><br><span class="line">                                   │</span><br><span class="line">                             400 ◀─┴─▶ preHandler Hook</span><br><span class="line">                                         │</span><br><span class="line">                               4**&#x2F;5** ◀─┴─▶ beforeHandler</span><br><span class="line">                                               │</span><br><span class="line">                                     4**&#x2F;5** ◀─┴─▶ User Handler</span><br><span class="line">                                                     │</span><br><span class="line">                                                     └─▶ Reply</span><br><span class="line">                                                          │ │</span><br><span class="line">                                                          │ └─▶ Outgoing Response</span><br><span class="line">                                                          │</span><br><span class="line">                                                          └─▶ onResponse Hook</span><br></pre></td></tr></table></figure>

<h3 id="Reply"><a href="#Reply" class="headerlink" title="Reply"></a>Reply</h3><p>The second parameter of the handler function is <code>Reply</code>.</p>
<p>Reply is a core Fastify object that exposes the following functions:</p>
<ul>
<li><p>.code(statusCode)</p>
</li>
<li><p>.header(name, value)</p>
</li>
<li><p>.type(value): Set the header <code>Content-Type</code></p>
</li>
<li><p>.redirect([code, ] url): default code 302</p>
</li>
<li><p>.serializer(function): Set a custom serializer for the payload</p>
</li>
<li><p>.send(payload)</p>
</li>
<li><p>.sent: A boolean value that you can use if you need to know it <code>send</code> has already been called.</p>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fastify.get(<span class="string">&#x27;/&#x27;</span>, options, <span class="function">(<span class="params">request, reply</span>) =&gt;</span> &#123;</span><br><span class="line">  reply</span><br><span class="line">    .code(<span class="number">200</span>)</span><br><span class="line">    .type(<span class="string">&#x27;application/json&#x27;</span>)</span><br><span class="line">    .send(&#123; <span class="attr">hello</span>: <span class="string">&#x27;world&#x27;</span> &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h4><p>If not set via <code>reply.code</code>, the resulting <code>statusCode</code> will be <code>200</code></p>
<h4 id="Header"><a href="#Header" class="headerlink" title="Header"></a>Header</h4><p>Sets a custom header to the response.</p>
<p>If you not set a <code>Content-Type</code> header, Fastify assumes that you are using <code>application/json</code>, unless you are send a stream, in that case Fastify recognize it and sets the <code>Content-Type</code> at <code>application/octet-stream</code>.</p>
<h4 id="Redirect"><a href="#Redirect" class="headerlink" title="Redirect"></a>Redirect</h4><p>Redirects a request to the specified url, the status code is optional, default to <code>302</code>.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reply.redirect(<span class="string">&#x27;/home&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="Type"><a href="#Type" class="headerlink" title="Type"></a>Type</h4><p>Sets the content type for the response.</p>
<p>It’s the shortcut for <code>reply.header(&#39;Content-Type&#39;, &#39;application/json&#39;)</code></p>
<h4 id="Serializer"><a href="#Serializer" class="headerlink" title="Serializer"></a>Serializer</h4><h4 id="Send"><a href="#Send" class="headerlink" title="Send"></a>Send</h4><h4 id="Objects"><a href="#Objects" class="headerlink" title="Objects"></a>Objects</h4><p>If you are sending JSON Objects, send will serialize the object with <code>fast-json-stringify</code> if you setted an output schema, otherwise <code>fast-safe-stringify</code></p>
<h4 id="Promises"><a href="#Promises" class="headerlink" title="Promises"></a>Promises</h4><p>Send handle natively the promsies and supports out of the box async-await:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">fastify.get(<span class="string">&#x27;/promises&#x27;</span>, options, <span class="function">(<span class="params">req, reply</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> promise = <span class="keyword">new</span> Prmise(<span class="comment">/*...*/</span>)</span><br><span class="line">  reply</span><br><span class="line">    .code(<span class="number">200</span>)</span><br><span class="line">    .send(promise)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fastify.get(<span class="string">&#x27;/async-await&#x27;</span>, options, <span class="keyword">async</span> (req, reply) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> res = <span class="keyword">await</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(resolve, <span class="number">200</span>, &#123; <span class="attr">hello</span>: <span class="string">&#x27;world&#x27;</span> &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="Streams"><a href="#Streams" class="headerlink" title="Streams"></a>Streams</h4><p>Send can also handle streams out of box, internally uses <code>pump</code> to avoid leaks of file description. If you are sneding a stream and you have not setted a <code>Content-Type</code> header, send will set it at <code>application/octet-stream</code>.</p>
<h4 id="Errors"><a href="#Errors" class="headerlink" title="Errors"></a>Errors</h4><p>If you pass to send an object that is an instance of Error, Fastify will automatically create error structured as the following:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  error: string, <span class="comment">// the http error message</span></span><br><span class="line">  message: string, <span class="comment">// the user error message</span></span><br><span class="line">  statusCode: number, <span class="comment">// the http status code</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Request"><a href="#Request" class="headerlink" title="Request"></a>Request</h3><p>The first parameter of the handler function is <code>Request</code>.</p>
<p>Request is a core Fastify object containing the following fields: </p>
<ul>
<li><p>query</p>
</li>
<li><p>body</p>
</li>
<li><p>params: the params matching the URL</p>
</li>
<li><p>headers</p>
</li>
<li><p>req: the incoming HTTP request from Node core</p>
</li>
<li><p>log</p>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fastify.post(<span class="string">&#x27;/:params&#x27;</span>, options, <span class="function">(<span class="params">req, reply</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(request.body)</span><br><span class="line">  <span class="built_in">console</span>.log(request.query)</span><br><span class="line">  <span class="built_in">console</span>.log(request.params)</span><br><span class="line">  <span class="built_in">console</span>.log(request.headers)</span><br><span class="line">  <span class="built_in">console</span>.log(request.req)</span><br><span class="line">  request.log.info(<span class="string">&#x27;some info&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="Content-Type-Parser"><a href="#Content-Type-Parser" class="headerlink" title="Content Type Parser"></a>Content Type Parser</h3><p>Natively Fastify supports only <code>application/json</code> content-type. If you need to support different content types you can use the <code>addContentTypeParser</code> api.</p>
<h4 id="Catch-All"><a href="#Catch-All" class="headerlink" title="Catch All"></a>Catch All</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fastify.addContentTypeParser(<span class="string">&#x27;*&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, done</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> data = <span class="string">&#x27;&#x27;</span></span><br><span class="line">  req.on(<span class="string">&#x27;data&#x27;</span>, <span class="function"><span class="params">chunk</span> =&gt;</span> &#123;data += chunk&#125;)</span><br><span class="line">  req.on(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> done(data))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="Plugins"><a href="#Plugins" class="headerlink" title="Plugins"></a>Plugins</h3><p>Fastify allows the user to extend its functionalities with plugins. A plugin can be a set of routes, a server decorator or whatever.</p>
<p>The API you will need for one or more plugins is <code>register</code>.</p>
<p>By default, <code>register</code> creates a <strong>new scope</strong>, this means that if you do some changes to the Fastify instance(via decorate), this change will not be reflected to the current context ancestors, but only to its sons.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fastify.register(plugin, [options])</span><br><span class="line"></span><br><span class="line">fastify.register([</span><br><span class="line">  <span class="built_in">require</span>(<span class="string">&#x27;./another-route&#x27;</span>),</span><br><span class="line">  <span class="built_in">require</span>(<span class="string">&#x27;./yet-another-route&#x27;</span>),</span><br><span class="line">], opts)</span><br></pre></td></tr></table></figure>

<h3 id="Craete-a-Plugin"><a href="#Craete-a-Plugin" class="headerlink" title="Craete a Plugin"></a>Craete a Plugin</h3><p>Create a plugin is very easy, you just need to create a function that takes three paremters, the <code>fastify</code> instance, an options object and the next callback.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">fastify, opts, next</span>) =&gt;</span> &#123;</span><br><span class="line">  fastify.decorate(<span class="string">&#x27;utility&#x27;</span>, <span class="function">() =&gt;</span> &#123;&#125;)</span><br><span class="line">  fastify.get(<span class="string">&#x27;/&#x27;</span>, handler)</span><br><span class="line">  next()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Handle-the-Scope"><a href="#Handle-the-Scope" class="headerlink" title="Handle the Scope"></a>Handle the Scope</h4><p>You have two ways to tell Fastify to avoid the creation of a new context:</p>
<ul>
<li><p>Use the <code>fastify-plugin</code> module</p>
</li>
<li><p>Use the <code>skip-override</code> hidden property</p>
</li>
</ul>
<p>We recomended to use the <code>fastify-plugin</code> module, because it solves this problem for you, and you can pass as parameter a version range of Fastify taht your plguin support.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fp = <span class="built_in">require</span>(<span class="string">&#x27;fastify-plguin&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = fp(<span class="function"><span class="keyword">function</span>(<span class="params">fastify, opts, next</span>) </span>&#123;</span><br><span class="line">  fastify.decorate(<span class="string">&#x27;utility&#x27;</span>, <span class="function">() =&gt;</span> &#123;&#125;)</span><br><span class="line">  next()</span><br><span class="line">&#125;, <span class="string">&#x27;0.x&#x27;</span>)</span><br></pre></td></tr></table></figure>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Chen Yu</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://ezcook.de/2017/10/23/Time-to-start-fastify/">https://ezcook.de/2017/10/23/Time-to-start-fastify/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Node-js/">Node.js</a><a class="post-meta__tags" href="/tags/Fastify/">Fastify</a></div><div class="post_share"><div class="social-share" data-image="/img/default_cover_1.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2017/10/26/Fastify-Plugin-Guide/"><img class="prev-cover" src="/img/default_cover_2.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Fastify Plugin Guide</div></div></a></div><div class="next-post pull-right"><a href="/2017/10/03/Apollo-with-TypeScript/"><img class="next-cover" src="/img/default_cover_1.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Apollo With TypeScript</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fas fa-thumbs-up fa-fw"></i><span> Related Articles</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2017/10/26/Fastify-Plugin-Guide/" title="Fastify Plugin Guide"><img class="relatedPosts_cover" src="img/default_cover_2.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2017-10-26</div><div class="relatedPosts_title">Fastify Plugin Guide</div></div></a></div><div class="relatedPosts_item"><a href="/2019/10/10/Basic-components-in-nest-js/" title="Basic Components in nest.js"><img class="relatedPosts_cover" src="/gallery/thumbnails/nestjs_components.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2019-10-10</div><div class="relatedPosts_title">Basic Components in nest.js</div></div></a></div><div class="relatedPosts_item"><a href="/2017/08/07/Build-GraphQL-Server-with-Express/" title="Build GraphQL Server With Express"><img class="relatedPosts_cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2017-08-07</div><div class="relatedPosts_title">Build GraphQL Server With Express</div></div></a></div><div class="relatedPosts_item"><a href="/2017/08/10/Build-GraphQL-Server-with-Koa/" title="Build GraphQL Server With Koa"><img class="relatedPosts_cover" src="img/default_cover_2.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2017-08-10</div><div class="relatedPosts_title">Build GraphQL Server With Koa</div></div></a></div><div class="relatedPosts_item"><a href="/2017/09/06/Build-Node-CLI/" title="Build Node CLI"><img class="relatedPosts_cover" src="img/default_cover_0.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2017-09-06</div><div class="relatedPosts_title">Build Node CLI</div></div></a></div><div class="relatedPosts_item"><a href="/2017/06/30/Example-of-node-influx/" title="Example of Node-Influx"><img class="relatedPosts_cover" src="img/default_cover_1.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2017-06-30</div><div class="relatedPosts_title">Example of Node-Influx</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div id="disqus_thread"></div></div></div></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2015 - 2021 By Chen Yu</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><script type="text/javascript" id="maid-script" mermaidoptioins="{&quot;theme&quot;:&quot;dark&quot;,&quot;background&quot;:&quot;#fff!important&quot;}" src="https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js"></script><script>if (window.mermaid) {
  var options = JSON.parse(document.getElementById('maid-script').getAttribute('mermaidoptioins'));
  mermaid.initialize(options);
}</script></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="font_plus" type="button" title="Increase Font Size"><i class="fas fa-plus"></i></button><button id="font_minus" type="button" title="Decrease Font Size"><i class="fas fa-minus"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></section><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="/js/search/algolia.js"></script><script>var endLoading = function () {
  document.body.style.overflow = 'auto';
  document.getElementById('loading-box').classList.add("loaded")
}
window.addEventListener('load',endLoading)</script><div class="js-pjax"><script>if (document.getElementsByClassName('mermaid').length) {
  if (window.mermaidJsLoad) mermaid.init()
  else {
    $.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js', function () {
      window.mermaidJsLoad = true
      mermaid.initialize({
        theme: 'default',
      })
      [object Object] && mermaid.init()
    })
  }
}</script><script>function loadDisqus () {
  var disqus_config = function () {
    this.page.url = 'https://ezcook.de/2017/10/23/Time-to-start-fastify/'
    this.page.identifier = '2017/10/23/Time-to-start-fastify/'
    this.page.title = 'Time to Start Fastify'
  };

  window.disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://ezcook-de.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }
}

if ('Disqus' === 'Disqus' || !false) {
  if (false) loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script><script>if (window.DISQUSWIDGETS === undefined) {
  var d = document, s = d.createElement('script');
  s.src = 'https://ezcook-de.disqus.com/count.js';
  s.id = 'dsq-count-scr';
  (d.head || d.body).appendChild(s);
} else {
  DISQUSWIDGETS.getCount({reset: true});
}</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = [
  'title',
  'meta[name=description]',
  '#config_change',
  '#body-wrap',
  '#rightside-config-hide',
  '#rightside-config-show',
  '.js-pjax'
]

if (false) {
  pjaxSelectors.unshift('meta[property="og:image"]', 'meta[property="og:title"]', 'meta[property="og:url"]')
}

const pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
})

document.addEventListener('pjax:complete', function () {
  refreshFn()

  $('script[data-pjax]').each(function () {
    $(this).parent().append($(this).remove())
  })

  GLOBAL_CONFIG.islazyload && lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  if (typeof gtag === 'function') {
    gtag('config', 'UA-136207372-1', {'page_path': window.location.pathname});
  }

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

})

document.addEventListener('pjax:send', function () {
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  $(window).off('scroll')

  //reset readmode
  $('body').hasClass('read-mode') && $('body').removeClass('read-mode')

  //reset font-size
  $('body').css('font-size') !== originFontSize && $('body').css('font-size', parseFloat(originFontSize))
})</script></div></body></html>