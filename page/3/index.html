<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="Hexo">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="Flux RSS"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Rechercher"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-koa-e4-bd-bf-e7-94-a8" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/09/19/koa-e4-bd-bf-e7-94-a8/" class="article-date">
  <time datetime="2016-09-18T19:02:51.000Z" itemprop="datePublished">2016-09-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/note/">note</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/09/19/koa-e4-bd-bf-e7-94-a8/">koa 使用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>Koa 当前需要 node 0.11.x 并开启 –harmony(或– harmony-generators), 因为他依赖于 ES6的 generator 特性<br><code>node --harmony my-koa-app.js</code></p>
<h3 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h3><p>Koa 应用是一个包含中间件 generator 方法数组的对象. 当请求到来时, 这些方法会以 stack-slice 的顺序执行.</p>
<p>Koa 的一大设计理念是, 通过其他底层中间件层提供高级”语法糖”, 而不是 Koa, 大大提高了框架的互操作性和健壮性, 并让中间件开发变得有趣.</p>
<p>简单例子</p>
<pre><code>var koa = require(&quot;koa&quot;);
var app = koa();
app.use(function*(){
  this.body = &quot;Hello World&quot;;
});
app.listen(3000);
`&lt;/pre&gt;

**注**: 与普通 function 不同, generator function 以 function* 的形式声明.

### 编写级联代码

koa 中间件以一种更加传统的方式级联.

以往的 Node 开发中, 级联是通过回调实现的, 用户友好度上有欠缺

Koa 借助 generator 实现了中间件架构

Koa 的执行代码的形式不再是简单的将控制权依次移交给一个又一个方法直到结束, 而是像一个回形针, 用户请求中间件, 遇到 yield next 关键字的时候, 会被传递给下游中间件(downstream), 在 yield next 捕获不到 downstream 的时候, 逆序返回执行代码(upstream)(yield next 后面的代码)

&lt;pre&gt;`var koa = require(&quot;koa&quot;);
var app = koa();

// x-response-time

app.use(function* (next){
  var start = new Date;
  yield next;
  var ms = new Date - start;
  this.set(&quot;X-Response-Time&quot;, ms+&quot;ms&quot;);
})

// logger
app.use(function* (next){
  var start = new Date;
  yield next;
  var ms = new Date - start;
  console.log(&quot;%s %s - %s&quot;, this.method, this.url, ms)
});

// response
app.use(function* (){
  this.body = &quot;Hello World&quot;;
});

app.listen(3000);
`&lt;/pre&gt;

### 应用配置

应用配置是 app 实例的属性, 目前支持以下配置:
- app.name 应用名
- app.env 执行环境, 默认是`NODE_ENV`或者`development`字符串
- app.proxy, 当该属性为 true 时, `proxy header` 参数会被添加到信任列表中

### app.listen(...)

一个 Koa 应用跟 HTTP Server 不是1-to-1关系, 一个或多个 Koa应用可以被加载到一块, 组成一个更大的包含一个 HTTP server 的应用

该方法创建并返回一个 http server, 并支持传递固定参数

&lt;pre&gt;`var koa = require(&quot;koa&quot;)
var app = koa()
app.listen(3000)
`&lt;/pre&gt;

方法 app.listen(...)是一个语法糖, 等价于

&lt;pre&gt;`var http = require(&quot;http&quot;)
var koa = require(&quot;koa&quot;)
var app = koa()
http.createServer(app.callback()).listen(3000)
`&lt;/pre&gt;

这意味着可以在多个端口使用同一个 app

&lt;pre&gt;`http.createServer(app.callback()).listen(3000)
http.createServer(app.callback()).listen(3001)
`&lt;/pre&gt;

### app.callback()

返回一个回调方法能用于 http.createServer()来处理请求, 也可以将这个回调函数挂载到 Connect/Express 应用上

### app.use(function)

将给定的 function 当做中间件加载到应用中

### app.keys=

设置 Cookie 签名密钥

### 错误处理

除非应用执行环境(NODE_ENV)被配置为&quot;test&quot;, Koa 都会将所有错误信息输出到 stderr, 如果想自定义错误处理逻辑, 可以定义一个&quot;错误事件&quot;来坚挺 Koa App 中的错误:

&lt;pre&gt;`app.on(&quot;error&quot;,function(err){
  log.error(&quot;server error&quot;, err);
})
`&lt;/pre&gt;

当 req/res 周期中出现任何错误且无法响应客户端时, koa 会把 Context(上下文)实例作为第二个参数传递给 error 事件:

&lt;pre&gt;`app.on(&quot;error&quot;, function(err, ctx){
  log.error(&quot;server error&quot;, err, ctx)
})
`&lt;/pre&gt;

### 上下文

Koa 的 Context 把 node 的 request 和 response 对象封装在一个单独对象, 并提供许多开发 web 应用和 APIs 有用的方法. 那些 HTTP Server 开发中使用非常频繁操作, 直接在 Koa 里实现, 而不是放在更高层次的框架, 这样中间件就不需要重复实现这些通用的功能.

每个请求会创建自己的 Context 实例, 在中间件中作为 receiver 引用, 或通过 this 标示引用:

&lt;pre&gt;`app.use(function* (){
  this; // is the Context
  this.request; // is a koa Request
  this.response; // is a koa Response
})
</code></pre><p>Context 的许多访问器和方法直接委托为他们的 ctx.request 或 ctx.response 的等价方法, 用于访问方便, 是完全相同的, 比如 ctx.type 和 ctx.length 委托与 response 对象, ctx.path 和 ctx.method 委托与 request.</p>
<h3 id="请求"><a href="#请求" class="headerlink" title="请求"></a>请求</h3><p>Koa Request 对象是 node 普通 request 对象之上的抽象, 提供了日常 Http Server 中更多有用的功能</p>
<h4 id="API"><a href="#API" class="headerlink" title="API"></a>API</h4><ul>
<li>request.header</li>
<li>request.headers: req.header 的别名</li>
<li>request.method: 请求方法</li>
<li>request.method=: 设置请求方法, 实现中间件的时候非常有用</li>
<li>request.length: 将请求的 Content-length 返回为数字, 或 undefined</li>
<li>request.url: 获取请求 URL</li>
<li>request.url=: 设置请求 URL<br>…</li>
</ul>
<h3 id="响应"><a href="#响应" class="headerlink" title="响应"></a>响应</h3><p>Koa Response 对象是 node 普通 response 对象之上的抽象, 提供了日常 Http Server 中有用的功能</p>
<h4 id="API-1"><a href="#API-1" class="headerlink" title="API"></a>API</h4><p>….</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/09/19/koa-e4-bd-bf-e7-94-a8/" data-id="cj1hgzf4c009ceoxhwlxinz4r" class="article-share-link">Partager</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/NODE/">NODE</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-xtemplate-e6-a8-a1-e6-9d-bf-e8-af-ad-e6-b3-95" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/09/18/xtemplate-e6-a8-a1-e6-9d-bf-e8-af-ad-e6-b3-95/" class="article-date">
  <time datetime="2016-09-18T08:21:47.000Z" itemprop="datePublished">2016-09-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/note/">note</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/09/18/xtemplate-e6-a8-a1-e6-9d-bf-e8-af-ad-e6-b3-95/">XTemplate 模板语法</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><p>变量会从当前模板的上下文查找值, 如果要输出一个变量的值, 可以使用</p>
<pre><code>{{ variable }}
`&lt;/pre&gt;

这样模板引擎会从上下文寻找变量`variable`并打印出来. 变量可以使用`.`访问其属性, 和 js 一样也可以通过`[]`访问属性

&lt;pre&gt;`{{ user.name }}
{{ user['name'] }}
`&lt;/pre&gt;

如果一个变量的值是`undefined`或`null`, 那么什么也不会输出, 也不会报错.

### 支持的数据类型

XTemplate 支持 js 中所有基本数据类型
- Boolean
- Number
- String
- Null
- Undefined
- Object
- Array

### 输出

使用`{{ foo }}`来输出`escape`之后的数据, `{{{ foo }}}`来输出`unescape`的原始数据

&lt;pre&gt;`escaped: {{ foo }}
unescaped: {{{ foo }}}
`&lt;/pre&gt;

如果希望输出最原始数据(包括`{{}}`), 那么需要使用`{{% %}}`语法

&lt;pre&gt;`{{% 
      {{ x }}
    %}}
`&lt;/pre&gt;

渲染这个模板, 会输出

&lt;pre&gt;`{{ x }}
`&lt;/pre&gt;

#### 添加注释

&lt;pre&gt;`{{! comment }}
`&lt;/pre&gt;

#### 添加空格

`{{~`删除空格前缀
    `~}}`删除空格后缀

### 作用域

每一个模板都有一个独立的作用于, 在字幕版中可以访问父模板的上下文, 但是字幕版中定义或者修改变量不会影响到父模板的变量

&lt;pre&gt;`// parent.xtpl
{{ set (a=1,b=2) }}
{{ include ('sub.xtpl') }}
in parent:
a = {{ a }}
b = {{ b }}
`&lt;/pre&gt;

&lt;pre&gt;`// sub.xtpl
in sub:
{{ set b = 3 }}
a = {{ a }}
b = {{ b }}
`&lt;/pre&gt;

渲染 parent.xtpl 得到

&lt;pre&gt;`in sub: 
a: 1
b: 3
in parent:
a: 1
b: 2
`&lt;/pre&gt;

### 根数据

通过`root.foo` 可以访问到渲染的根数据, 即调用`render`方法时传入的数据

用数据`{ name: &apos;foo&apos;, array: [{name:&apos;bar&apos;}] }`渲染下面模板:

&lt;pre&gt;`{{ #each(arr) }}
{{root.name}} {{name}}
{{/each}}
`&lt;/pre&gt;

得到

&lt;pre&gt;`foo bar
`&lt;/pre&gt;

## 方法和逻辑

可以使用变量上 js 提供的方法:

&lt;pre&gt;`var x = [1,2,3]
`&lt;/pre&gt;

&lt;pre&gt;`{{#each(x.slice(1))}}{{this}} {{/each}} // =&amp;gt; 2 3
`&lt;/pre&gt;

### 操作符

XTemplate 支持在数据上使用一些操作符:

&lt;pre&gt;`+, -, *, /, %
`&lt;/pre&gt;

&lt;pre&gt;`===, !==, &amp;gt;, &amp;gt;=, &amp;lt;, &amp;lt;=
`&lt;/pre&gt;

&lt;pre&gt;`||, &amp;amp;&amp;amp;, !
`&lt;/pre&gt;

&lt;pre&gt;`?:
`&lt;/pre&gt;

### 函数调用

如果你传递 js 的方法到模板中, 那么可以使用它

&lt;pre&gt;`{{foo(1,2,3)}}
`&lt;/pre&gt;

### 内置函数

&lt;pre&gt;`range(start, end, [step])
`&lt;/pre&gt;

不包括 end

&lt;pre&gt;`set(key = value, [key = value])
`&lt;/pre&gt;

`set` 用于定义或修改一个变量

&lt;pre&gt;`{{ set(x=1) }}
{{ set(y=3,z=2) }}
{{x}}
{{y+z}}
`&lt;/pre&gt;

渲染得到

&lt;pre&gt;`1
5
`&lt;/pre&gt;

`void`, 允许忽略模板渲染

&lt;pre&gt;`{{ set(x=1) }}
{{ void(x) }}
`&lt;/pre&gt;

将渲染空

## 命令

命令是一些特殊的区块, 对于这些特殊的区块, XTemplate 会做特殊处理. XTemplate 自带了一些内置的命令, 也可以自定义命令

`if`

&lt;pre&gt;`{{# if(variable) }}
  It is true
{{/ if}}
`&lt;/pre&gt;

如果 vairable 为 true, 则渲染命令块

&lt;pre&gt;`{{# if(variable) }}
{{ elseif (vairable)}}
{{ else }}
{{/ if }}

`with`
和 js 中的`with`类似
`&lt;/pre&gt;

var a = {
  b:1
}
```

&lt;pre&gt;`{{{#with(a)}}}
{{b}} // 1
{{/with}}
`&lt;/pre&gt;

`each`
`each`可以对 array 和 dictionary 进行迭代

&lt;pre&gt;`// array
{{ set (array = [{
      name: 'foo'
    }, {
      name: 'bar'
    }])}}

{{#each(array)}}
  {{xindex}} {{this.name}}
{{/each}}
`&lt;/pre&gt;

渲染得到

&lt;pre&gt;`0 foo
1 bar
`&lt;/pre&gt;

&lt;pre&gt;`// dictionary
{{ set (dictionary = {
      foo:'bar',
      hello:'world'
    })}}

{{#each(dictionary,'value','key')}}
  {{key}}{{value}}
{{/each}}
`&lt;/pre&gt;

渲染得到

&lt;pre&gt;`foo bar
hello world
`&lt;/pre&gt;

### 访问上层变量

在`with`和`each`中, 可以通过`../`访问外层的同名变量

&lt;pre&gt;`// {a: 1, b:[{a:2}]}
{{#with(x)}}
  {{#each(b)}}
    {{../a}}{{a}} // 12
  {{/with}}
{{/with}}
`&lt;/pre&gt;

### 宏

宏允许你定义一个可复用的代码片段

&lt;pre&gt;`{{#macro("test","param",default=1)}}
  param is {{param}} {{default}}
{{/macro}}
`&lt;/pre&gt;

现在可以调用该宏

&lt;pre&gt;`{{macro("test", "2")}}
{{macro("test","2",default=2)}}
`&lt;/pre&gt;

渲染结果

&lt;pre&gt;`param is 2 1
param is 2 2
`&lt;/pre&gt;

### include

`include` 引入其他的模板, 在共享组件的时候十分有效

&lt;pre&gt;`{{ include ('item.html') }}
`&lt;/pre&gt;

如果下网引入子模板的时候可以在子模板的上下文设置其他值, 可以通过`include`后面的参数传入

&lt;pre&gt;`// parent.html
{{ set(x='x',y='y') }}
{{ include ('sub.html', xx=x,yy=x) }}
`&lt;/pre&gt;

&lt;pre&gt;`// sub.html
x:{{x}}
y:{{y}}
xx:{{xx}}
yy:{{yy}}
`&lt;/pre&gt;

parent.html渲染结果

&lt;pre&gt;`x: x // from parent.html
y: y // from parent.html
xx: x // from sub.html
yy: x // from sub.html
`&lt;/pre&gt;

### includeOnce

功能和`include`一样, 区别在于对于同一个模板, 只在第一次调用的时候起作用.

### parse

如果希望能够让子模板拥有一个完全独立的上下文, 不需要父级作用于, 则可以使用`parse`

&lt;pre&gt;`// parent.html
{{ set(x = 'x', y = 'y') }}
{{ parse('sub.html', xx = x, yy = x) }}
`&lt;/pre&gt;

&lt;pre&gt;`// sub.html
x: {{x}}
y: {{y}}
xx: {{xx}}
yy: {{yy}}
`&lt;/pre&gt;

parent.html渲染结果

&lt;pre&gt;`x:
y:
xx:x
yy:x
`&lt;/pre&gt;

## 模板继承

当编写一个 template 的时候, 可以定义`blocks`, 这样在字幕版中可以重写这些 block

&lt;pre&gt;`// parent.xtpl
&amp;lt;!DOCTYPE html&amp;gt;
&amp;lt;html&amp;gt;
  &amp;lt;head&amp;gt;
    &amp;lt;....&amp;gt;
    {{{block ('head')}}}
  &amp;lt;/head&amp;gt;
  &amp;lt;body&amp;gt;
    {{{block ('body')}}}
  &amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;
`&lt;/pre&gt;

&lt;pre&gt;`// child.xtpl
{{ extend ('./parent.xtpl')}}

{{#block ('head')}} // overwrite head block
  &amp;lt;....&amp;gt;
{{/block}}

{{#block ('body')}} // overwrite body block
  &amp;lt;...&amp;gt;
{{/block}}
</code></pre><p>渲染 child.xtpl 可以获得新的模板下的实例</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/09/18/xtemplate-e6-a8-a1-e6-9d-bf-e8-af-ad-e6-b3-95/" data-id="cj1hgzf8i00hbeoxho1kr8kxo" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-flex-e5-b1-9e-e6-80-a7-e8-af-a6-e8-a7-a3" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/09/17/flex-e5-b1-9e-e6-80-a7-e8-af-a6-e8-a7-a3/" class="article-date">
  <time datetime="2016-09-17T08:05:53.000Z" itemprop="datePublished">2016-09-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/note/">note</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/09/17/flex-e5-b1-9e-e6-80-a7-e8-af-a6-e8-a7-a3/">Flex 属性详解</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ol>
<li>display: flex|inline-flex; (修饰Flex Container, 也就是 Flex Item的父级元素)<br>该属性修饰的元素, 其子元素将变成 flex 文档流, 称为 Flex Item</li>
</ol>
<p><strong>注意</strong>: CSS 的 columns 在 FlexContainer 上没有作用; float, clear, vertical-align 在 FlexItem 上没有作用</p>
<ol>
<li>flex-direction: row|row-reverse|column|column-reverse(修饰 Flex Container)<br>用于定义main-axis, 从而定义 flex 文档流方向<p></p></li>
<li><p>flex-wrap: nowrap|wrap|wrap-reverse; (修饰 Flex Container)<br>nowrap: 单行显示; wrap: 多行显示; wrap-reverse: 逆向多行显示</p>
</li>
<li><p>flex-flow: &lt;’flex-direction’&gt;||&lt;’flex-wrap’&gt;; (修饰 Flex Container)<br>这个是 flex-direction 和 flex-wrap 的缩写, 同时定义主轴和侧轴的文档流向</p>
</li>
<li><p>justify-content:flex-start|flex-end|center|space-between|space-around; (修饰 Flex Container)<br>定义主轴线上 Flex Item 的对齐方式</p>
</li>
</ol>
<p>flex-start: 向起始位置对齐; flex-end: 向结束位置对齐; center: 向中间靠拢; space-between: 首位 item 位于边界, 所有 items 均匀分布; space-around: 首位 item 距离边界1space, 所有 item 之间距离2space</p>
<p><img src="http://cdn.w3cplus.com/cdn/farfuture/gnLmjiUDLu3L9INIb8KPA5vE6xsQaRuSMU_UfamwmDM/mtime:1421035122/sites/default/files/styles/print_image/public/blogs/2013/flexbox-guide-2.jpg" alt=""></p>
<ol>
<li>align-item: flex-start|flex-end|center|baseline|stretch; (修饰 Flex Container)<br>定义 item 在侧轴方向的对齐方式</li>
</ol>
<p><img src="http://cdn2.w3cplus.com/cdn/farfuture/DTYyNpRoVAWKoI-BNSJ06avE6tVTibwXa3VXqoEhWbs/mtime:1421035123/sites/default/files/styles/print_image/public/blogs/2013/flexbox-guide-3.jpg" alt=""></p>
<ol>
<li>align-content: flex-start|flex-end|center|space-between|space-around|stretch(default); (修饰 Flex Container)<br>校准 item 在 container 中的对齐方式, 类似于 justify-content, 本属性在单行的容器中没有效果</li>
</ol>
<p><img src="http://cdn1.w3cplus.com/cdn/farfuture/P-M8WSERtYlnjKq2QRb-TXGdIOtTs7EIinejAJd0V0I/mtime:1421035123/sites/default/files/styles/print_image/public/blogs/2013/flexbox-guide-4.jpg" alt=""></p>
<ol>
<li><p></p><p>order: <integer>; (修饰 Flex Item)<br>手动指定显示顺序</integer></p>
</li>
<li><p>flex-grow: <number>; (修饰 Flex Item)<br>定义 Item 的扩张能力, 接受一个不带单位的值作为一个比例, 主要用来决 Item 对 Container 剩余空间的利用</number></p>
</li>
<li><p>flex-shrink: <number>; (修饰 Flex Item)<br>定义 Item 的收缩能力</number></p>
</li>
<li><p>flex-basis: <length>|auto(default); (修饰 Flex Item)<br>设置伸缩基准, 剩余的空间按照比例伸缩</length></p>
</li>
<li><p>flex: none|[&lt;’flex-grow’&gt;&lt;’flex-shrink’&gt;? || &lt;’flex-basis’&gt;]; (修饰 Flex Item)<br>flex-grow, flex-shrink, flex-basis 的缩写; 其中, 第二个和第三个参数是可选参数. 默认值是<code>0 1 auto</code></p>
</li>
<li><p>align-self: auto|flex-start|flex-end|center|baseline|stretch; (修饰 Flex Item)<br>用于覆盖单个 Item 的对齐方式.</p>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/09/17/flex-e5-b1-9e-e6-80-a7-e8-af-a6-e8-a7-a3/" data-id="cj1hgzf3e007beoxhgqceaxwn" class="article-share-link">Partager</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CSS3/">CSS3</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-react-native-basic-component" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/09/16/react-native-basic-component/" class="article-date">
  <time datetime="2016-09-16T04:54:28.000Z" itemprop="datePublished">2016-09-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/note/">note</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/09/16/react-native-basic-component/">React-Native Basic Component</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Text"><a href="#Text" class="headerlink" title="Text"></a>Text</h3><pre><code>import React, { Component } from &apos;react&apos;
import { AppRegistry, Text } from &apos;react-native&apos;
 const App = () =&amp;gt; &amp;lt;Text&amp;gt;Hello World&amp;lt;/Text&amp;gt;

 AppRegistry.registerComponent(&quot;Project&quot;, () =&amp;gt; App)
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">### Image</div></pre></td></tr></table></figure>

import React, { Component } from &apos;react&apos;
import { AppRegistry, Image } from &apos;react-native&apos;

const App = () =&amp;gt; &amp;lt;Image source = {require(&apos;./img/sample.png&apos;)} /&amp;gt;

AppRegistry.registerComponent(&quot;Project&quot;, () =&amp;gt; App)
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">### View</div></pre></td></tr></table></figure>

import React, { Component } from &apos;react&apos;
import { AppRegistry, Text, View } from &apos;react-native&apos;

const App = () =&amp;gt; (
  &amp;lt;View style={{alignItems: 'center'}} &amp;gt;
    &amp;lt;Text&amp;gt;Hello World&amp;lt;/Text&amp;gt;
  &amp;lt;/View&amp;gt;
)

AppRegistry.registerComponent(&quot;Project&quot;, () =&amp;gt; App)
`&lt;/pre&gt;

### TextInput

&lt;pre&gt;`import React from &apos;react&apos;
import { AppRegistry, TextInput, View } from &apos;react-native&apos;

const App = () =&amp;gt; (
  &amp;lt;View&amp;gt;
    &amp;lt;TextInput placeholder = &quot;Hello&quot; /&amp;gt;
  &amp;lt;/View&amp;gt;
)

AppRegistry.registerComponent(&apos;Project&apos;, () =&amp;gt; App)
`&lt;/pre&gt;

### ListView

&lt;pre&gt;`import React, { Component } from &apos;react&apos;
import { AppRegistry, Text, View, ListView } from &apos;react-native&apos;

class SimpleList extends Component {
  constructor(){
    super(props)
    var ds = new ListView.DataSource({
      rowHasChanged: (r1,r2) =&amp;gt; r1!==r2
    })

    this.state = {
      dataSource: ds.cloneWithRows([&apos;john&apos;, &apos;joel&apos;,&apos;james&apos;,&apos;jimmy&apos;,&apos;jackson&apos;])
    }

  }

  render(){
    return (
      &amp;lt;View&amp;gt;
        &amp;lt;ListView dataSource={this.state.dataSource} renderRow={(rowData) =&amp;gt; &amp;lt;Text&amp;gt;{rowData}&amp;lt;/Text&amp;gt;}
      &amp;lt;/View&amp;gt;
    )
  }
}

AppRegistry.registerComponent(&quot;Project&quot;, () =&amp;gt; SimpleList)
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/09/16/react-native-basic-component/" data-id="cj1hgzf6h00cleoxh513co2j2" class="article-share-link">Partager</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React-Native/">React-Native</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-e7-90-86-e8-a7-a3-restful-e6-9e-b6-e6-9e-84" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/09/16/e7-90-86-e8-a7-a3-restful-e6-9e-b6-e6-9e-84/" class="article-date">
  <time datetime="2016-09-16T03:59:53.000Z" itemprop="datePublished">2016-09-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/note/">note</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/09/16/e7-90-86-e8-a7-a3-restful-e6-9e-b6-e6-9e-84/">理解 RESTFul 架构</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>REST 全称 Representational State Transfer(表述性状态转移), 十一组架构约束条件和原则. 如果一个架构符合 REST 的约束条件, 那么可以称为 RESTFul 架构</p>
<p>要理解 REST 原则, 就要从资源的定义, 获取, 表述, 关联, 状态变迁等角度入手</p>
<ul>
<li>资源与 URI</li>
<li>统一资源接口</li>
<li>资源的表述</li>
<li>资源的链接</li>
<li>状态的转移</li>
</ul>
<h3 id="资源与-URI"><a href="#资源与-URI" class="headerlink" title="资源与 URI"></a>资源与 URI</h3><p>任何事物, 只要有被引用到的必要, 他就是一个资源.</p>
<p>要让一个资源可以被识别, 需要添加一个唯一标识, 在 Web 中这个唯一标识就是 URI(Uniform Resource Identifier).</p>
<p>URI 既可以看成资源的地址, 也可以看成资源的名称.</p>
<p>如果一些信息没有使用 URI 来标识, 说明他不是一个资源</p>
<p>URI 的设计应该遵循可寻址原则, 具有自描述性, 需要在形式上给人以直觉上的关联</p>
<h4 id="URI-设计上的一些技巧"><a href="#URI-设计上的一些技巧" class="headerlink" title="URI 设计上的一些技巧"></a>URI 设计上的一些技巧</h4><ol>
<li>使用 <code>_</code> 或 <code>-</code> 提高 URI 的可读性</li>
<li>使用 <code>/</code> 表示资源的层级关系</li>
<li>使用 <code>?</code> 过滤资源</li>
</ol>
<h4 id="统一资源接口"><a href="#统一资源接口" class="headerlink" title="统一资源接口"></a>统一资源接口</h4><p>RESTFul 结构应该遵循统一接口原则, 统一接口包含了一组受限的预定义操作, 不论什么样的资源, 都是通过使用相同接口进行资源访问. 接口应该使用标准 HTTP 方法如 GET, PUT, POST, 并遵循这些方法的语义</p>
<ul>
<li>POST 和 PUT 用于创建资源时的区别: 所创建的资源的 URI 是否由客户端决定.</li>
</ul>
<h3 id="资源的表述"><a href="#资源的表述" class="headerlink" title="资源的表述"></a>资源的表述</h3><p>客户端通过 HTTP 方法获取资源的表述, 而不是资源本身.</p>
<p>所谓资源的表述, 即是资源的展现, 而非其本质. 以文本为例, 可以通过 JSON, STRING 等形式表述出来, 而通过客户端获取的即是 JSON 形式的表述, 或 STRING 形式的表述.</p>
<p>客户端通过 HTTP 内容协商, 即 Accept 头请求一种特定个事的表述, 服务器则通过 Content-Type 通知客户端资源的表述形式</p>
<h3 id="资源的连接"><a href="#资源的连接" class="headerlink" title="资源的连接"></a>资源的连接</h3><p>REST 使用 HTTP 方法操作资源, 在表述格式中添加链接来引导客户端, 这种具有连接的特性称为连通</p>
<h3 id="状态的转移"><a href="#状态的转移" class="headerlink" title="状态的转移"></a>状态的转移</h3><p>无状态通信原则: 服务端不应该保存客户端的状态</p>
<h4 id="应用状态与资源状态"><a href="#应用状态与资源状态" class="headerlink" title="应用状态与资源状态"></a>应用状态与资源状态</h4><p>应该区分应用状态和资源状态, 客户端负责维护应用状态, 服务端维护资源状态. 客户端与服务端的交互应当是无状态的, 并且在每一次请求中包含处理该请求所需要的一切信息. 服务端不需要在请求间保留应用状态, 只有在接收到实际请求的时候, 服务端才会关注应用状态. 这种无状态通信原则, 使得服务端和中介能够理解独立的请求和相应. 多次请求中, 同一客户端也不再需要依赖同一服务器, 方便实现高可扩展和高可用性的服务端.</p>
<h4 id="应用状态的转移"><a href="#应用状态的转移" class="headerlink" title="应用状态的转移"></a>应用状态的转移</h4><p>“会话状态”不是作为资源状态被保存在服务端, 而是被客户端做为应用状态进行跟踪. 客户端应用状态在服务端提供的超媒体的指引下发生变迁, 服务端通过超媒体告诉客户端当前状态有哪些后续状态可以进入. 类似于网页中的’下一些’的连接.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/09/16/e7-90-86-e8-a7-a3-restful-e6-9e-b6-e6-9e-84/" data-id="cj1hgzf32006neoxh184tlk2q" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-e7-a7-bb-e5-8a-a8-e7-ab-af-border-radius-e6-ba-a2-e5-87-ba-e5-a4-84-e7-90-86" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/09/08/e7-a7-bb-e5-8a-a8-e7-ab-af-border-radius-e6-ba-a2-e5-87-ba-e5-a4-84-e7-90-86/" class="article-date">
  <time datetime="2016-09-08T02:21:25.000Z" itemprop="datePublished">2016-09-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/note/">note</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/09/08/e7-a7-bb-e5-8a-a8-e7-ab-af-border-radius-e6-ba-a2-e5-87-ba-e5-a4-84-e7-90-86/">移动端 Border-radius 溢出处理</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>问题1: 部分机型下, 设置 border-radius 以及 overflow:hidden 会造成背景颜色溢出</p>
<p>解决: background-clip: padding-box</p>
<p>原理: background-clip 是颜色颜色显示区域, 设置为 padding-box</p>
<p>问题2: transform 的子元素在父元素 overflow:hidden 之后还是会溢出</p>
<p>解决办法: 在父元素加上一段 css</p>
<pre><code>-webkit-mask-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAAA1BMVEUAAACnej3aAAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==&apos;);
</code></pre><p>这是一张1px 的纯黑色图片</p>
<p>原理: -webkit-mask-image:url(‘’), 会在图片上添加蒙版(黑色表示将内容透明, 白色表示将内容显示, 介于中间表示半透明)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/09/08/e7-a7-bb-e5-8a-a8-e7-ab-af-border-radius-e6-ba-a2-e5-87-ba-e5-a4-84-e7-90-86/" data-id="cj1hgzf2y006deoxhwizb8drx" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-e6-b5-8b-e8-af-95-e5-b0-8f-e6-8a-80-e5-b7-a7" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/09/08/e6-b5-8b-e8-af-95-e5-b0-8f-e6-8a-80-e5-b7-a7/" class="article-date">
  <time datetime="2016-09-08T02:00:52.000Z" itemprop="datePublished">2016-09-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/note/">note</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/09/08/e6-b5-8b-e8-af-95-e5-b0-8f-e6-8a-80-e5-b7-a7/">测试小技巧</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>每一个测试都要引入 expect, 可以创建一个<code>test_helper.js</code><br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"> import &#123; expect &#125; from &apos;expect&apos;</div><div class="line"> import sinon from &apos;sinon&apos;</div><div class="line"></div><div class="line">global.expect = expect</div><div class="line"> global.sinon = sinon</div><div class="line"> `然后在`mocha.opt`中添加`</div><div class="line"> --require ./test/test_helper.js</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/09/08/e6-b5-8b-e8-af-95-e5-b0-8f-e6-8a-80-e5-b7-a7/" data-id="cj1hgzf2i005keoxhgfruhfkp" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-command-line-cheat-sheet" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/09/07/command-line-cheat-sheet/" class="article-date">
  <time datetime="2016-09-06T19:02:48.000Z" itemprop="datePublished">2016-09-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/note/">note</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/09/07/command-line-cheat-sheet/">Command Line Cheat Sheet</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Directories"><a href="#Directories" class="headerlink" title="Directories"></a>Directories</h3><p>pwd: print working directory</p>
<p>cd &lt;directory&gt;: change directory to &lt;directory&gt;</p>
<p>cd ..: change directory to parent one</p>
<p>ls: list directory  contents</p>
<p>ls -la: list detailed directory contents, including hidden files</p>
<p>mkdir &lt;directory&gt;: create new directory named &lt;directory&gt;</p>
<h3 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h3><p>cat &lt;file&gt;: output the contents of &lt;file&gt;</p>
<p>less &lt;file&gt;: output the contents of &lt;file&gt; using the less command(which supports paginations etc.)</p>
<p>head &lt;file&gt;: output the first 10 lines of &lt;file&gt;</p>
<p>&lt;cmd&gt; &lt;file&gt;: impose &lt;cmd&gt; on &lt;file&gt;</p>
<p>clear: clear the command line window</p>
<h3 id="Files"><a href="#Files" class="headerlink" title="Files"></a>Files</h3><p>rm &lt;file&gt;: delete &lt;file&gt;</p>
<p>rm -r &lt;directory&gt;: clear contents of &lt;directory&gt;</p>
<p>rm -f &lt;file&gt;: force-delete &lt;file&gt;</p>
<p>rm -rf &lt;directory&gt;: force clear &lt;directory&gt;</p>
<p>mv &lt;file-old&gt; &lt;file-new&gt;: rename &lt;file-old&gt;</p>
<p>mv &lt;file&gt; &lt;directory&gt;: move file to &lt;directory&gt;</p>
<p>cp &lt;file&gt; &lt;directory&gt;: copy &lt;file&gt; to &lt;directory&gt;</p>
<p>cp -r &lt;directory1&gt; &lt;directory2&gt;:  copy whole &lt;directory1&gt; to &lt;directory2&gt;(overwrit)</p>
<p>touch &lt;file&gt;: Update file or create file</p>
<h3 id="Permissions"><a href="#Permissions" class="headerlink" title="Permissions"></a>Permissions</h3><p>chmod 755 &lt;file&gt;: change permission of &lt;file&gt; to 755</p>
<p>chmod -R 600 &lt;directory&gt;: change permission of &lt;directory&gt; and its content to 600</p>
<p>chown &lt;user&gt;:&lt;group&gt; &lt;file&gt;: Change ownership of &lt;file&gt; to &lt;user&gt; and &lt;group&gt;</p>
<h3 id="Search"><a href="#Search" class="headerlink" title="Search"></a>Search</h3><p>find &lt;dir&gt; -name ‘&lt;file&gt;’: find all files named &lt;file&gt; inside &lt;dir&gt;(support regex)</p>
<p>grep ‘&lt;text&gt;’ &lt;file&gt;: output all occurrence of &lt;text&gt; inside &lt;file&gt;(add -i for case-insensitivity)</p>
<p>grep -rl ‘text’ &lt;dir&gt;: search for all files container &lt;text&gt; inside &lt;dir&gt;</p>
<h3 id="Network"><a href="#Network" class="headerlink" title="Network"></a>Network</h3><p>ping &lt;host&gt;: ping &lt;host&gt; and display status</p>
<p>whois &lt;domain&gt;: output whois information for &lt;domain&gt;</p>
<p>curl -O &lt;url/to/file&gt;: download &lt;file&gt;(via HTTP[S] or FTP)</p>
<p>ssh &lt;username&gt;@&lt;host&gt;: establish an SSH connection to &lt;host&gt; with user &lt;username&gt;</p>
<p>scp &lt;file&gt; &lt;user&gt;@&lt;host&gt;:/remote/path: Copy &lt;file&gt; to a remote &lt;host&gt;</p>
<h3 id="Processes"><a href="#Processes" class="headerlink" title="Processes"></a>Processes</h3><p>ps ax: output currently running process</p>
<p>top: display live information about currently running processes</p>
<p>kill &lt;pid&gt;: Quit process with ID</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/09/07/command-line-cheat-sheet/" data-id="cj1hgzf0m002keoxhaenyc5rs" class="article-share-link">Partager</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Bash/">Bash</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/commandline/">commandline</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/shell/">shell</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-redux-form-e7-9a-84-e6-b7-b1-e5-9d-91-e6-85-a2-e6-85-a2-e7-a7-af-e7-b4-af" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/09/06/redux-form-e7-9a-84-e6-b7-b1-e5-9d-91-e6-85-a2-e6-85-a2-e7-a7-af-e7-b4-af/" class="article-date">
  <time datetime="2016-09-06T01:56:38.000Z" itemprop="datePublished">2016-09-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/note/">note</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/09/06/redux-form-e7-9a-84-e6-b7-b1-e5-9d-91-e6-85-a2-e6-85-a2-e7-a7-af-e7-b4-af/">Redux-Form 的深坑...慢慢积累</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>如果 Field 无法输入, 注意 state 是否是 immutable 的, 如果是, 则需要</p>
<pre><code>import { Field, reduxForm } from &apos;redux-form/immutable&apos;
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/09/06/redux-form-e7-9a-84-e6-b7-b1-e5-9d-91-e6-85-a2-e6-85-a2-e7-a7-af-e7-b4-af/" data-id="cj1hgzf6r00d9eoxh8crzh1gh" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-e7-bc-96-e5-86-99-e6-b5-8b-e8-af-95" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/09/05/e7-bc-96-e5-86-99-e6-b5-8b-e8-af-95/" class="article-date">
  <time datetime="2016-09-04T23:21:37.000Z" itemprop="datePublished">2016-09-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/note/">note</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/09/05/e7-bc-96-e5-86-99-e6-b5-8b-e8-af-95/">编写测试</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="设置"><a href="#设置" class="headerlink" title="设置"></a>设置</h3><p>使用 Mocha 作为测试引擎<br>注意因为是在 node 环境下运行, 所以不能访问 DOM</p>
<pre><code>npm install --save-dev mocha
`&lt;/pre&gt;

若想要结合 Babel 使用, 需要在 package.json 的 script 中加入一段

&lt;pre&gt;`{
  &quot;scripts&quot;: {
    ...
    &quot;test&quot;: &quot;mocha --compilers js:babel/register --recursive&quot;,
    &quot;test:watch&quot;: &quot;npm test -- --watch&quot;
  }
}
`&lt;/pre&gt;

### Action Creators

Redux 里的 action creators 会返回普通对象, 在测试 action creators 的时候我们要测试的不仅是调用了正确的action creators, 还有是否返回了正确的 action

实例

&lt;pre&gt;`export function addTodo(text){
  return {
    type: &apos;ADD_TODO&apos;,
    text
  };
}
`&lt;/pre&gt;

可以这样测试

&lt;pre&gt;`import expect form &apos;expect&apos;
import * as actions from &apos;../../actions/TodoActions&apos;;
import * as types from &apos;../../constants/ActionTypes&apos;;

describe(&apos;actions&apos;, () =&amp;gt; {
  it(&apos;should create an action to add a todo&apos;, () =&amp;gt; {
    const text = &apos;Finish docs&apos;;
    const expectedAction = {
      type: &apos;ADD_TODO&apos;,
      text
    };

    expect(actions.addTodo(text)).toEqual(&apos;expectedAction&apos;);
  })
})
`&lt;/pre&gt;

### 异步 Action Creators

对于使用Redux Thunk 或其他 middleware 的异步 Action Creator, 最好完全模拟 Redux Store 来测试.

可以使用 applyMiddleware() 和一个 mock store, 与可以用 nock 来模拟 HTTP 请求

实例:

&lt;pre&gt;`function fetchTodosRequest () {
  return {
    type: FETCH_TODOS_REQUEST
  }
}

function fetchTodosSuccess(body) {
  return {
    type: FETCH_TODOS_SUCCESS,
    body
  }
}

function fetchTodosFailure(ex) {
  return {
    type: FETCH_TODOS_FAILURE,
    ex
  }
}

export function fetchTodo () {
  return dispatch =&amp;gt; {
    dispatch(fetchTodosRequest())
    return fetch(&apos;http://example.com/todos&apos;)
      .then(res =&amp;gt; res.json())
      .then(json =&amp;gt; dispatch(fetchTodosSuccess(json.body)))
      .catch(ex =&amp;gt; dispatch(fetchTodosFailure(ex)))
  }
}
`&lt;/pre&gt;

可以这样测试

&lt;pre&gt;`import expect from &apos;expect&apos;
import { applyMiddleware } from &apos;redux&apos;
import thunk from &apos;redux-thunk&apos;
import * as actions from &apos;../../actions/counter&apos;
import * as types from &apos;../../constants/ActionTypes&apos;
import nock from &apos;nock&apos;

const middleware = [thunk]

/**
 * 使用中间件模拟 Redux Store
 */

function mockStore = (getState, expectedActions, done){
  if(!Array.isArray(expectedActions)){
    throw new Error(&apos;expectedActions should be an array of expected actions.&apos;)
  }
  if( typeof done !== &apos;undefined&apos; &amp;amp;&amp;amp; typeof done !== &apos;function&apos;){
    throw new Error(&apos;done should either be undefined or function&apos;)
  }

  function mockStoreWithoutmiddleware(){
    return {
      getState(){
        return typeof getState === &apos;function&apos; ? 
        getState():
        getState
      },

      dispatch(action){
        const expectedAction = expectedActions.shift()

        try {
          expect(action).toEqual(expectedAction)
          if(done&amp;amp;&amp;amp;!expectedActions.length){
            done()
          }
          return action
        } catch (e) {
          done(e)
        }
      }
    }
  }

  const mockStoreWithMiddleware = applyMiddleware(
    ...middlewares
  )(mockStoreWithoutMiddleware)

  return mockStoreWithMiddleware()
}

describe(&apos;async actions&apos;, () =&amp;gt; {
  afterEach(() =&amp;gt; {
    nock.clearAll()
  }) 

  it(&apos;creates FETCH_TODOS_SUCCESS when fetching todos has been done&apos;, (done) =&amp;gt; {
    nock(&apos;http://example.com&apos;)
      .get(&apos;./todos&apos;)
      .reply(200, {todos: [&apos;do something&apos;]})

    const expectedActions = [
      {type: types.FETCH_TODOS_REQUEST},
      {type: types.FETCH_TODOS_SUCCESS, body: { todos: [&apos;do something&apos;]}}
    ]
    const store = mockStore({todos: []}, expectedActions, done) 
    store.dispatch(actions.fetchTodos())
  })
})
`&lt;/pre&gt;

### Reducers 测试

Reducer 把 action 应用到当前 state, 并返回新的 state

&lt;pre&gt;`import { ADD_TODO } from &apos;../constants/ActionTypes&apos;;

const initialState = [
  {
    text: &apos;Use Redux&apos;,
    completed: false,
    id: 0
  }
]

export default function todos(state = initialState, action) {
  switch(action.type) {
    case ADD_TODO: return [
      {
        id: state.reduce((maxID, todo) =&amp;gt; Math.max(todo.id, maxId), -1) + 1, 
        completed: false,
        text: action.text
      },
      ...state
    ]
    default: return state
  }
}
`&lt;/pre&gt;

可以这样测试:

&lt;pre&gt;`import expect from &apos;expect&apos;
import reducer from &apos;../../reducers/todos&apos;
import * as types from &apos;../../constants/ActionTypes&apos;

describe(&apos;todos reducer&apos;, () =&amp;gt; {
  it(&apos;should return the initial state&apos;, () =&amp;gt; {
    expect(reducer(undefined, {})).toEqual([
      {
        text: &apos;Use Redux&apos;,
        completed: false,
        id: 0
      }
    ])
  })

  it(&apos;should handle ADD_TODO&apos;, () =&amp;gt; {
    expect(
      reducer([],{
        type: types.ADD_TODO,
        text: &apos;Run the test&apos;
      })
    ).toEqual(
      [
        {
          text: &apos;Run the test&apos;,
          completed: false,
          id: 0
        }
      ]
    )

    expect(
      reducer([
        {
          text: &apos;Use Redux&apos;,
          completed: false,
          id:0
        }
      ], {
        type: types.ADD_TODO,
        text: &apos;Run the test&apos;
      })
    ).toEqual([
      {
        text: &apos;Run the test&apos;,
        completed: false, 
        id: 1
      },
      {
        text: &apos;Use Redux&apos;,
        completed: false,
        id: 0
      }
    ])
  })
})
`&lt;/pre&gt;

### 测试 Components

React Components 的优点是, 一般都很小, 并且依赖于 props, 因此测试起来很容易.

首先安装 React Test Utilities

&lt;pre&gt;`npm install --save-dev react-addons-test-utils
`&lt;/pre&gt;

要测试 components 我们要创建一个叫`setup()` 的辅助方法, 用来把模拟过的( stubbed ) 回调函数当做 props 传入, 然后使用 React 浅渲染来渲染组建, 这样可以依据`是否调用了回调函数`的断言来写独立的测试

&lt;pre&gt;`import React, { PropTypes, Component } from &apos;react&apos;
import TodoTextInput from &apos;./TodoTextInput&apos;

class Header extends Component {
  handleSave(text){
    if(text.length !==0){
      this.props.addTodo(text)
    }
  }
  render(){
    return(
      &amp;lt;header&amp;gt;
        &amp;lt;h1&amp;gt;todos&amp;lt;/h1&amp;gt;
        &amp;lt;TodoTextInput newTodo = {true} onSave ={this.handleSave.bind(this)} placeholder = &apos;what needs to be done?&apos; /&amp;gt;
      &amp;lt;/header&amp;gt;
    )
  }
}

Header.propTypes = {
  addTodo: PropTypes.func.isRequired
}

export default Header
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/09/05/e7-bc-96-e5-86-99-e6-b5-8b-e8-af-95/" data-id="cj1hgzf3q0086eoxhqk91m8s2" class="article-share-link">Partager</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/测试/">测试</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/page/2/">&laquo; __('prev')</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/16/">16</a><a class="extend next" rel="next" href="/page/4/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Catégories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Soup/">Soup</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Uncategorized/">Uncategorized</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/github/">github</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/github/note/">note</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/note/">note</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/note/workNote/">workNote</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/workNote/">workNote</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Mot-clés</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/AJAX/">AJAX</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BOOTSTRAP/">BOOTSTRAP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Bash/">Bash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CORS/">CORS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/">CSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS3/">CSS3</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Closure/">Closure</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CommonJS/">CommonJS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DOM/">DOM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DevTools/">DevTools</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ES6/">ES6</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ESLint/">ESLint</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/FP/">FP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/">Git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gulp/">Gulp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTML5/">HTML5</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Immutable/">Immutable</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Javascript/">Javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Koa/">Koa</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MDL/">MDL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Material-Design/">Material Design</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/">MySQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NODE/">NODE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NPM/">NPM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/">Nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nock/">Nock</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Node-js/">Node.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Promise/">Promise</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/">React</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React-Native/">React-Native</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React-Redux/">React-Redux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React-Router/">React-Router</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redux/">Redux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RegExp/">RegExp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RxJS/">RxJS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Thunk/">Thunk</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Trick/">Trick</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Web/">Web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/automatic/">automatic</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/babel/">babel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/babel-polyfill/">babel-polyfill</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/commandline/">commandline</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/">github</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jQuery/">jQuery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell/">shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webpack/">webpack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webpack2/">webpack2</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/测试/">测试</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Nuage de mot-clés</h3>
    <div class="widget tagcloud">
      <a href="/tags/AJAX/" style="font-size: 10.91px;">AJAX</a> <a href="/tags/BOOTSTRAP/" style="font-size: 10px;">BOOTSTRAP</a> <a href="/tags/Bash/" style="font-size: 11.82px;">Bash</a> <a href="/tags/CORS/" style="font-size: 10px;">CORS</a> <a href="/tags/CSS/" style="font-size: 10.91px;">CSS</a> <a href="/tags/CSS3/" style="font-size: 20px;">CSS3</a> <a href="/tags/Closure/" style="font-size: 10px;">Closure</a> <a href="/tags/CommonJS/" style="font-size: 10px;">CommonJS</a> <a href="/tags/DOM/" style="font-size: 12.73px;">DOM</a> <a href="/tags/DevTools/" style="font-size: 10px;">DevTools</a> <a href="/tags/ES6/" style="font-size: 10.91px;">ES6</a> <a href="/tags/ESLint/" style="font-size: 10px;">ESLint</a> <a href="/tags/FP/" style="font-size: 10px;">FP</a> <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/Gulp/" style="font-size: 11.82px;">Gulp</a> <a href="/tags/HTML5/" style="font-size: 15.45px;">HTML5</a> <a href="/tags/Immutable/" style="font-size: 10px;">Immutable</a> <a href="/tags/Javascript/" style="font-size: 19.09px;">Javascript</a> <a href="/tags/Koa/" style="font-size: 10.91px;">Koa</a> <a href="/tags/MDL/" style="font-size: 16.36px;">MDL</a> <a href="/tags/Material-Design/" style="font-size: 17.27px;">Material Design</a> <a href="/tags/MySQL/" style="font-size: 10px;">MySQL</a> <a href="/tags/NODE/" style="font-size: 13.64px;">NODE</a> <a href="/tags/NPM/" style="font-size: 10.91px;">NPM</a> <a href="/tags/Nginx/" style="font-size: 10px;">Nginx</a> <a href="/tags/Nock/" style="font-size: 10px;">Nock</a> <a href="/tags/Node-js/" style="font-size: 10.91px;">Node.js</a> <a href="/tags/Promise/" style="font-size: 11.82px;">Promise</a> <a href="/tags/React/" style="font-size: 18.18px;">React</a> <a href="/tags/React-Native/" style="font-size: 10px;">React-Native</a> <a href="/tags/React-Redux/" style="font-size: 10px;">React-Redux</a> <a href="/tags/React-Router/" style="font-size: 10.91px;">React-Router</a> <a href="/tags/Redux/" style="font-size: 14.55px;">Redux</a> <a href="/tags/RegExp/" style="font-size: 10px;">RegExp</a> <a href="/tags/RxJS/" style="font-size: 10px;">RxJS</a> <a href="/tags/Thunk/" style="font-size: 10.91px;">Thunk</a> <a href="/tags/Trick/" style="font-size: 11.82px;">Trick</a> <a href="/tags/Web/" style="font-size: 10px;">Web</a> <a href="/tags/automatic/" style="font-size: 10px;">automatic</a> <a href="/tags/babel/" style="font-size: 10px;">babel</a> <a href="/tags/babel-polyfill/" style="font-size: 10px;">babel-polyfill</a> <a href="/tags/commandline/" style="font-size: 10px;">commandline</a> <a href="/tags/github/" style="font-size: 10.91px;">github</a> <a href="/tags/jQuery/" style="font-size: 10px;">jQuery</a> <a href="/tags/shell/" style="font-size: 10px;">shell</a> <a href="/tags/webpack/" style="font-size: 17.27px;">webpack</a> <a href="/tags/webpack2/" style="font-size: 11.82px;">webpack2</a> <a href="/tags/测试/" style="font-size: 11.82px;">测试</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Articles récents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/04/14/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2017/03/20/baisc-usage-of-redux-observable/">Baisc Usage of Redux-Observable</a>
          </li>
        
          <li>
            <a href="/2017/02/27/functor-e5-87-bd-e5-ad-90/">Functor 函子</a>
          </li>
        
          <li>
            <a href="/2017/02/22/throttle-e5-87-bd-e6-95-b0/">Throttle 函数</a>
          </li>
        
          <li>
            <a href="/2017/02/22/debounce-e5-87-bd-e6-95-b0/">Debounce 函数</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 John Doe<br>
      Propulsé by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>