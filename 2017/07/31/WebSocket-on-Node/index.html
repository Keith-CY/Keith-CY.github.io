<!DOCTYPE html>
<html  lang="en">

<head>
    <meta charset="utf-8">
<title>WS on Node - EzCook</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />







<link rel="icon" href="/images/logo.png">

<link href="https://fonts.googleapis.com/css?family=Averia+Serif+Libre|DM+Serif+Text&display=swap" rel="stylesheet">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css">




    
    <style>body>.footer,body>.navbar,body>.section{opacity:0}</style>
    



    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">
    




<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">







<link rel="stylesheet" href="/css/back-to-top.css">




<script async src="https://www.googletagmanager.com/gtag/js?id=UA-136207372-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-136207372-1');
</script>




<link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>



    



    
        <script async="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    




<link rel="stylesheet" href="/css/style.css">

</head>

<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/logo.png" alt="WS on Node" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item"
                href="/">Home</a>
                
                <a class="navbar-item"
                href="/archives">Archives</a>
                
                <a class="navbar-item"
                href="/projects">Projects</a>
                
            </div>
            
            <div class="navbar-end">
                
                    
                    
                    <a class="navbar-item" target="_blank" title="GitHub" href="https://github.com/keith-CY">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                    
                    <a class="navbar-item" target="_blank" title="Gmail" href="mailto:keithwhisper@gmail.com">
                        
                        <i class="fas fa-envelope"></i>
                        
                    </a>
                    
                
                
                
                <a class="navbar-item search" title="Search" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>

    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-07-31T07:27:46.000Z">2017-07-31</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    3 minutes read (About 450 words)
                </span>
                
                
                <span class="level-item has-text-grey" id="busuanzi_container_page_pv">
                    <i class="far fa-eye"></i>
                    <span id="busuanzi_value_page_pv">0</span> visits
                </span>
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                WS on Node
            
        </h1>
        <div class="content">
            <h3 id="Create-WS-Server"><a href="#Create-WS-Server" class="headerlink" title="Create WS Server"></a>Create WS Server</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// get WS Object</span></div><div class="line"><span class="keyword">const</span> WebSocket = <span class="built_in">require</span>(<span class="string">'ws'</span>)</div><div class="line"></div><div class="line"><span class="comment">// Create new Server Instance</span></div><div class="line"><span class="keyword">const</span> ws = <span class="keyword">new</span> WebSocket.Server(&#123;</div><div class="line">  <span class="attr">port</span>: <span class="number">80</span>, <span class="comment">// port</span></div><div class="line">  verifyClient: socketverify <span class="comment">// (optional)function to verify connection</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h4 id="new-WebSocket-Server-options-callback"><a href="#new-WebSocket-Server-options-callback" class="headerlink" title="new WebSocket.Server(options[, callback])"></a>new WebSocket.Server(options[, callback])</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">options: &#123;</div><div class="line">  host: string,</div><div class="line">  port: number,</div><div class="line">  backlog: number, // the maximum length of the queue of pending connection.</div><div class="line">  server: http.Server | https.Server, // a pre-created Node Http Server.</div><div class="line">  verifyClient: function, // a function which can be used to validate incoming connections.</div><div class="line">  handleProtocols: function, // a function which can be used to handle the WebSocket subprotocols.</div><div class="line">  path: string, // Accept only connections matching this path.</div><div class="line">  noServer: boolean, // Enable no server mode.</div><div class="line">  clientTracking: boolean, // Specifies whether or not track clients.</div><div class="line">  perMessageDeflate: boolean | object, // Enable/Disable permessage-deflate.</div><div class="line">  maxPayload: number, // Maximum allowed message size in bytes.</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Create a new server instance. One of <code>port</code>, <code>server</code>, or <code>noServer</code> must be provided or an error is thrown.</p>
<h3 id="Set-VerifyClient"><a href="#Set-VerifyClient" class="headerlink" title="Set VerifyClient"></a>Set VerifyClient</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">socketverify</span>(<span class="params">info</span>) </span>&#123;</div><div class="line">  <span class="comment">// connect if return true</span></div><div class="line">  <span class="keyword">var</span> origin = info.origin.match(<span class="comment">/*...*/</span>)</div><div class="line">  <span class="keyword">if</span> (<span class="comment">/*...*/</span>) &#123;</div><div class="line">    <span class="keyword">return</span> <span class="literal">true</span></div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> <span class="literal">false</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>If <code>verifyClient</code> is not set then the handshake is automatically accepted. If it is is provided with a single argument then that is:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">info: &#123;</div><div class="line">  origin: string, // The value in the Origin header indicated by the client.</div><div class="line">  req: http.incomingMessage, // The client HTTP GET request.</div><div class="line">  secure: boolean, // `true` is `req.connection.authorized` or `req.connection.encrypted` is set.</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>If the <code>verifyClient</code> provided with 2 arguments, the second one is <code>cb</code>, which accepts <code>result: boolean</code>, <code>code: number</code>, <code>name: string</code>.</p>
<h3 id="Handle-Request"><a href="#Handle-Request" class="headerlink" title="Handle Request"></a>Handle Request</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">ws.on(<span class="string">'connect'</span>, (socket) =&gt; &#123;</div><div class="line">  <span class="comment">// the socket is a connect to client</span></div><div class="line">  <span class="comment">// usually you should push it in an array for management</span></div><div class="line">  socket.onmessage = message</div><div class="line">  socket.onclose = close</div><div class="line">  socket.onerror = error</div><div class="line">  socket.onopen = open</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">message</span>(<span class="params">msg</span>) </span>&#123;</div><div class="line">  <span class="comment">// ...</span></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">error</span>(<span class="params">err</span>) </span>&#123;</div><div class="line">  <span class="comment">// ...</span></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">close</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="comment">// ...</span></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">open</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="comment">// ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Events"><a href="#Events" class="headerlink" title="Events"></a>Events</h4><h3 id="Methods"><a href="#Methods" class="headerlink" title="Methods"></a>Methods</h3><h4 id="Sending-msg"><a href="#Sending-msg" class="headerlink" title="Sending msg"></a>Sending msg</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">socket.send(data[, options[, callback]])</div></pre></td></tr></table></figure>
<ul>
<li><p>data: binary or string</p>
</li>
<li><p>options:</p>
<ul>
<li><p>mask: true | false  是否使用掩码</p>
</li>
<li><p>binary: true | false 是否二进制流</p>
</li>
<li><p>compress: true | false 是否压缩</p>
</li>
</ul>
</li>
<li><p>callback: 回调</p>
</li>
</ul>
<h4 id="close-connection"><a href="#close-connection" class="headerlink" title="close connection"></a>close connection</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">socket.close([code], [data])</div></pre></td></tr></table></figure>
<ul>
<li><p>code: 返回一个状态码</p>
</li>
<li><p>data: 结束连接时发送的信息</p>
</li>
</ul>
<h4 id="pause"><a href="#pause" class="headerlink" title="pause"></a>pause</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">socket.pause()</div></pre></td></tr></table></figure>
<h4 id="resume"><a href="#resume" class="headerlink" title="resume"></a>resume</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">socket.resume()</div></pre></td></tr></table></figure>
<h4 id="PING"><a href="#PING" class="headerlink" title="PING"></a>PING</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">socket.ping([data], [options], [dontFailWhenClosed])</div></pre></td></tr></table></figure>
<ul>
<li><p>data: ping 的时候发送的信息</p>
</li>
<li><p>options: 同 send</p>
</li>
<li><p>dontFailWhenClosed: true | false // 如果连接断开, 是否抛出错误</p>
</li>
</ul>
<h4 id="PONG"><a href="#PONG" class="headerlink" title="PONG"></a>PONG</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">socket.pong([data], [options], [dontFailWhenClosed])</div></pre></td></tr></table></figure>
<p>Ping 和 Pong 的区别在于, 一个包含 ping 帧(0x9), 一个包含 pong 帧(0xA)</p>
<p>pong 是对于接到 ping 之后的回应, 让双方都知道连接还存在</p>
<h4 id="stream"><a href="#stream" class="headerlink" title="stream"></a>stream</h4><h4 id="terminate"><a href="#terminate" class="headerlink" title="terminate"></a>terminate</h4>
        </div>
        
        
        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="menu-label has-text-centered">Like this article? Support the author with</h3>
        <div class="buttons is-centered">
            
                <!-- Visit https://www.paypal.com/donate/buttons/ to get your donate button -->

<a class="button is-warning donate" onclick="document.getElementById(&#39;paypal-donate-form&#39;).submit()">
    <span class="icon is-small">
        <i class="fab fa-paypal"></i>
    </span>
    <span>Paypal</span>
</a>
<form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_blank" id="paypal-donate-form">
    <input type="hidden" name="cmd" value="_donations" />
    <input type="hidden" name="business" value="chen.yu.keith@foxmail.com" />
    <input type="hidden" name="currency_code" value="USD" />
</form>

                
        </div>
    </div>
</div>



<div class="card card-transparent">
    <div class="level post-navigation is-flex-wrap is-mobile">
        
        <div class="level-start">
            <a class="level level-item has-link-grey  article-nav-prev" href="/2017/08/01/http-cache-Etag-Last-Modified-Cache-Control/">
                <i class="level-item fas fa-chevron-left"></i>
                <span class="level-item">Http Cache: Etag, Last-Modified, Cache-Control</span>
            </a>
        </div>
        
        
        <div class="level-end">
            <a class="level level-item has-link-grey  article-nav-next" href="/2017/07/31/Short-Clip-of-TypeScript(1)/">
                <span class="level-item">Short Clip of TypeScript(1)</span>
                <i class="level-item fas fa-chevron-right"></i>
            </a>
        </div>
        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="title is-5 has-text-weight-normal">Comments</h3>
        
<div id="comment-container"></div>
<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
<script>
	var gitment = new Gitment({
		id: '2017/07/31/WebSocket-on-Node/',
		owner: 'Keith-CY',
		repo: 'Keith-CY.github.io',
		oauth: {
			client_id: '56319e1ce36ed4313555',
			client_secret: 'ca7f10a8357d52290f5509fb54e5173a8bea0a5d',
		},
	})
	gitment.render('comment-container')
</script>

    </div>
</div>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("en");</script>


    
    
    
    <script src="/js/animation.js"></script>
    

    
    
    
    <script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
    <script src="/js/gallery.js" defer></script>
    

    
    

<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


    
    
<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>

    
    

<a id="back-to-top" title="Back to Top" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>


    
    

    
    
    
    
    
    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>
    <script src="/js/clipboard.js" defer></script>
    

    
    
    

    


<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>

</html>
